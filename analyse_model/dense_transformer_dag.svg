<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="1440pt" height="446pt"
 viewBox="0.00 0.00 1440.00 445.51" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.22 0.22) rotate(0) translate(4 2018.34)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-2018.34 6532.74,-2018.34 6532.74,4 -4,4"/>
<!-- input_total -->
<g id="node1" class="node">
<title>input_total</title>
<ellipse fill="lightgreen" stroke="black" cx="2937" cy="-1987.47" rx="87.86" ry="26.74"/>
<text text-anchor="middle" x="2937" y="-1991.27" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="2937" y="-1976.27" font-family="Times,serif" font-size="14.00">(B, L, d_model)</text>
</g>
<!-- split -->
<g id="node2" class="node">
<title>split</title>
<polygon fill="yellow" stroke="black" points="3076.92,-1924.6 2854.34,-1924.6 2797.08,-1848.6 3019.66,-1848.6 3076.92,-1924.6"/>
<text text-anchor="middle" x="2937" y="-1890.4" font-family="Times,serif" font-size="14.00">Split Sequence</text>
<text text-anchor="middle" x="2937" y="-1875.4" font-family="Times,serif" font-size="14.00">(B, L/P, d_model)</text>
</g>
<!-- input_total&#45;&gt;split -->
<g id="edge1" class="edge">
<title>input_total&#45;&gt;split</title>
<path fill="none" stroke="black" d="M2937,-1960.49C2937,-1952.68 2937,-1943.85 2937,-1935.1"/>
<polygon fill="black" stroke="black" points="2940.5,-1934.93 2937,-1924.93 2933.5,-1934.93 2940.5,-1934.93"/>
</g>
<!-- input_0 -->
<g id="node3" class="node">
<title>input_0</title>
<polygon fill="lightcyan" stroke="black" points="1025.5,-1812.6 888.5,-1812.6 888.5,-1759.6 1025.5,-1759.6 1025.5,-1812.6"/>
<text text-anchor="middle" x="957" y="-1797.4" font-family="Times,serif" font-size="14.00">Input Segment 0</text>
<text text-anchor="middle" x="957" y="-1782.4" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="957" y="-1767.4" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- split&#45;&gt;input_0 -->
<g id="edge2" class="edge">
<title>split&#45;&gt;input_0</title>
<path fill="none" stroke="black" d="M2820.53,-1879.81C2456,-1861.67 1342.92,-1806.3 1036.06,-1791.03"/>
<polygon fill="black" stroke="black" points="1036.08,-1787.53 1025.92,-1790.53 1035.74,-1794.52 1036.08,-1787.53"/>
</g>
<!-- input_1 -->
<g id="node30" class="node">
<title>input_1</title>
<polygon fill="lightcyan" stroke="black" points="2664.5,-1812.6 2527.5,-1812.6 2527.5,-1759.6 2664.5,-1759.6 2664.5,-1812.6"/>
<text text-anchor="middle" x="2596" y="-1797.4" font-family="Times,serif" font-size="14.00">Input Segment 1</text>
<text text-anchor="middle" x="2596" y="-1782.4" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="2596" y="-1767.4" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- split&#45;&gt;input_1 -->
<g id="edge31" class="edge">
<title>split&#45;&gt;input_1</title>
<path fill="none" stroke="black" d="M2808.57,-1848.5C2763.4,-1835.45 2714.02,-1821.19 2674.23,-1809.7"/>
<polygon fill="black" stroke="black" points="2675.18,-1806.33 2664.6,-1806.91 2673.23,-1813.05 2675.18,-1806.33"/>
</g>
<!-- input_2 -->
<g id="node57" class="node">
<title>input_2</title>
<polygon fill="lightcyan" stroke="black" points="3346.5,-1812.6 3209.5,-1812.6 3209.5,-1759.6 3346.5,-1759.6 3346.5,-1812.6"/>
<text text-anchor="middle" x="3278" y="-1797.4" font-family="Times,serif" font-size="14.00">Input Segment 2</text>
<text text-anchor="middle" x="3278" y="-1782.4" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="3278" y="-1767.4" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- split&#45;&gt;input_2 -->
<g id="edge60" class="edge">
<title>split&#45;&gt;input_2</title>
<path fill="none" stroke="black" d="M3027.93,-1859.33C3081.5,-1843.86 3148.57,-1824.49 3199.77,-1809.7"/>
<polygon fill="black" stroke="black" points="3200.82,-1813.04 3209.46,-1806.9 3198.88,-1806.31 3200.82,-1813.04"/>
</g>
<!-- input_3 -->
<g id="node84" class="node">
<title>input_3</title>
<polygon fill="lightcyan" stroke="black" points="4985.5,-1812.6 4848.5,-1812.6 4848.5,-1759.6 4985.5,-1759.6 4985.5,-1812.6"/>
<text text-anchor="middle" x="4917" y="-1797.4" font-family="Times,serif" font-size="14.00">Input Segment 3</text>
<text text-anchor="middle" x="4917" y="-1782.4" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="4917" y="-1767.4" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- split&#45;&gt;input_3 -->
<g id="edge89" class="edge">
<title>split&#45;&gt;input_3</title>
<path fill="none" stroke="black" d="M3043.8,-1880.29C3397.85,-1862.67 4528.01,-1806.45 4837.81,-1791.04"/>
<polygon fill="black" stroke="black" points="4838.23,-1794.52 4848.05,-1790.53 4837.88,-1787.53 4838.23,-1794.52"/>
</g>
<!-- qkv_proj_0 -->
<g id="node4" class="node">
<title>qkv_proj_0</title>
<polygon fill="lightblue" stroke="black" points="1106.5,-1723.6 807.5,-1723.6 807.5,-1670.6 1106.5,-1670.6 1106.5,-1723.6"/>
<text text-anchor="middle" x="957" y="-1708.4" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="957" y="-1693.4" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) &#45;&gt; (B, L/4, 3*d_model)</text>
<text text-anchor="middle" x="957" y="-1678.4" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- input_0&#45;&gt;qkv_proj_0 -->
<g id="edge3" class="edge">
<title>input_0&#45;&gt;qkv_proj_0</title>
<path fill="none" stroke="black" d="M957,-1759.47C957,-1751.49 957,-1742.53 957,-1733.98"/>
<polygon fill="black" stroke="black" points="960.5,-1733.85 957,-1723.85 953.5,-1733.85 960.5,-1733.85"/>
</g>
<!-- residual_0 -->
<g id="node22" class="node">
<title>residual_0</title>
<polygon fill="pink" stroke="black" points="842.5,-877.74 705.5,-877.74 705.5,-824.74 842.5,-824.74 842.5,-877.74"/>
<text text-anchor="middle" x="774" y="-862.54" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="774" y="-847.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="774" y="-832.54" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- input_0&#45;&gt;residual_0 -->
<g id="edge21" class="edge">
<title>input_0&#45;&gt;residual_0</title>
<path fill="none" stroke="black" d="M888.17,-1785.21C668.74,-1783.73 0,-1764.31 0,-1582.6 0,-1582.6 0,-1582.6 0,-1028.24 0,-886.77 497.91,-859.01 695.03,-853.57"/>
<polygon fill="black" stroke="black" points="695.41,-857.06 705.31,-853.3 695.22,-850.06 695.41,-857.06"/>
</g>
<!-- split_qkv_0 -->
<g id="node5" class="node">
<title>split_qkv_0</title>
<polygon fill="yellow" stroke="black" points="1138.36,-1634.6 849.85,-1634.6 775.64,-1528.6 1064.15,-1528.6 1138.36,-1634.6"/>
<text text-anchor="middle" x="957" y="-1592.9" font-family="Times,serif" font-size="14.00">Split QKV</text>
<text text-anchor="middle" x="957" y="-1577.9" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="957" y="-1562.9" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- qkv_proj_0&#45;&gt;split_qkv_0 -->
<g id="edge4" class="edge">
<title>qkv_proj_0&#45;&gt;split_qkv_0</title>
<path fill="none" stroke="black" d="M957,-1670.35C957,-1662.65 957,-1653.85 957,-1644.87"/>
<polygon fill="black" stroke="black" points="960.5,-1644.7 957,-1634.7 953.5,-1644.7 960.5,-1644.7"/>
</g>
<!-- attn_stage_0_0 -->
<g id="node6" class="node">
<title>attn_stage_0_0</title>
<polygon fill="orange" stroke="black" points="270,-1489.12 28,-1489.12 28,-1421.12 270,-1421.12 270,-1489.12"/>
<text text-anchor="middle" x="149" y="-1473.92" font-family="Times,serif" font-size="14.00">Ring Attention Stage 0</text>
<text text-anchor="middle" x="149" y="-1458.92" font-family="Times,serif" font-size="14.00">Q0 × K0 × V0</text>
<text text-anchor="middle" x="149" y="-1443.92" font-family="Times,serif" font-size="14.00">(B, L/4, L/4) × (B, L/4, d_model)</text>
<text text-anchor="middle" x="149" y="-1428.92" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- split_qkv_0&#45;&gt;attn_stage_0_0 -->
<g id="edge5" class="edge">
<title>split_qkv_0&#45;&gt;attn_stage_0_0</title>
<path fill="none" stroke="black" d="M802.47,-1566.96C664.36,-1553.25 456.94,-1528.91 279,-1492.6 277.06,-1492.2 275.11,-1491.8 273.15,-1491.37"/>
<polygon fill="black" stroke="black" points="273.79,-1487.93 263.27,-1489.17 272.27,-1494.76 273.79,-1487.93"/>
</g>
<!-- send_kv_0_0 -->
<g id="node7" class="node">
<title>send_kv_0_0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="692" cy="-1455.12" rx="123.99" ry="37.45"/>
<text text-anchor="middle" x="692" y="-1466.42" font-family="Times,serif" font-size="14.00">Send K,V to GPU1</text>
<text text-anchor="middle" x="692" y="-1451.42" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="692" y="-1436.42" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- split_qkv_0&#45;&gt;send_kv_0_0 -->
<g id="edge6" class="edge">
<title>split_qkv_0&#45;&gt;send_kv_0_0</title>
<path fill="none" stroke="black" d="M846.15,-1528.53C819.49,-1516.01 791.63,-1502.92 767.04,-1491.37"/>
<polygon fill="black" stroke="black" points="768.32,-1488.11 757.78,-1487.02 765.35,-1494.44 768.32,-1488.11"/>
</g>
<!-- send_kv_0_1 -->
<g id="node11" class="node">
<title>send_kv_0_1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="957" cy="-1455.12" rx="123.99" ry="37.45"/>
<text text-anchor="middle" x="957" y="-1466.42" font-family="Times,serif" font-size="14.00">Send K,V to GPU1</text>
<text text-anchor="middle" x="957" y="-1451.42" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="957" y="-1436.42" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- split_qkv_0&#45;&gt;send_kv_0_1 -->
<g id="edge9" class="edge">
<title>split_qkv_0&#45;&gt;send_kv_0_1</title>
<path fill="none" stroke="black" d="M957,-1528.53C957,-1520.1 957,-1511.41 957,-1503.11"/>
<polygon fill="black" stroke="black" points="960.5,-1502.85 957,-1492.85 953.5,-1502.85 960.5,-1502.85"/>
</g>
<!-- send_kv_0_2 -->
<g id="node15" class="node">
<title>send_kv_0_2</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="1222" cy="-1455.12" rx="123.99" ry="37.45"/>
<text text-anchor="middle" x="1222" y="-1466.42" font-family="Times,serif" font-size="14.00">Send K,V to GPU1</text>
<text text-anchor="middle" x="1222" y="-1451.42" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="1222" y="-1436.42" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- split_qkv_0&#45;&gt;send_kv_0_2 -->
<g id="edge13" class="edge">
<title>split_qkv_0&#45;&gt;send_kv_0_2</title>
<path fill="none" stroke="black" d="M1065.17,-1529.79C1092.7,-1516.86 1121.68,-1503.24 1147.14,-1491.29"/>
<polygon fill="black" stroke="black" points="1148.79,-1494.38 1156.35,-1486.96 1145.81,-1488.04 1148.79,-1494.38"/>
</g>
<!-- send_kv_0_3 -->
<g id="node19" class="node">
<title>send_kv_0_3</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="1487" cy="-1455.12" rx="123.99" ry="37.45"/>
<text text-anchor="middle" x="1487" y="-1466.42" font-family="Times,serif" font-size="14.00">Send K,V to GPU1</text>
<text text-anchor="middle" x="1487" y="-1451.42" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="1487" y="-1436.42" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- split_qkv_0&#45;&gt;send_kv_0_3 -->
<g id="edge17" class="edge">
<title>split_qkv_0&#45;&gt;send_kv_0_3</title>
<path fill="none" stroke="black" d="M1082.42,-1554.62C1160.97,-1537.91 1264.18,-1515.17 1355,-1492.6 1365.8,-1489.92 1377.06,-1487 1388.25,-1484.01"/>
<polygon fill="black" stroke="black" points="1389.31,-1487.35 1398.06,-1481.38 1387.49,-1480.59 1389.31,-1487.35"/>
</g>
<!-- accum_0_0 -->
<g id="node8" class="node">
<title>accum_0_0</title>
<polygon fill="lightgray" stroke="black" points="233.5,-1370.67 96.5,-1370.67 96.5,-1317.67 233.5,-1317.67 233.5,-1370.67"/>
<text text-anchor="middle" x="165" y="-1355.47" font-family="Times,serif" font-size="14.00">Initialize Output</text>
<text text-anchor="middle" x="165" y="-1340.47" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="165" y="-1325.47" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- attn_stage_0_0&#45;&gt;accum_0_0 -->
<g id="edge7" class="edge">
<title>attn_stage_0_0&#45;&gt;accum_0_0</title>
<path fill="none" stroke="black" d="M153.89,-1420.84C155.74,-1408.2 157.87,-1393.76 159.75,-1380.9"/>
<polygon fill="black" stroke="black" points="163.22,-1381.39 161.21,-1370.99 156.29,-1380.38 163.22,-1381.39"/>
</g>
<!-- accum_0_1 -->
<g id="node12" class="node">
<title>accum_0_1</title>
<polygon fill="lightgray" stroke="black" points="488,-1259.72 320,-1259.72 320,-1206.72 488,-1206.72 488,-1259.72"/>
<text text-anchor="middle" x="404" y="-1244.52" font-family="Times,serif" font-size="14.00">Accumulate Output 1</text>
<text text-anchor="middle" x="404" y="-1229.52" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="404" y="-1214.52" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- accum_0_0&#45;&gt;accum_0_1 -->
<g id="edge10" class="edge">
<title>accum_0_0&#45;&gt;accum_0_1</title>
<path fill="none" stroke="black" d="M221.03,-1317.63C256.27,-1301.56 301.87,-1280.78 338.73,-1263.97"/>
<polygon fill="black" stroke="black" points="340.26,-1267.12 347.9,-1259.79 337.35,-1260.75 340.26,-1267.12"/>
</g>
<!-- attn_stage_0_1 -->
<g id="node9" class="node">
<title>attn_stage_0_1</title>
<polygon fill="orange" stroke="black" points="525,-1378.17 283,-1378.17 283,-1310.17 525,-1310.17 525,-1378.17"/>
<text text-anchor="middle" x="404" y="-1362.97" font-family="Times,serif" font-size="14.00">Ring Attention Stage 1</text>
<text text-anchor="middle" x="404" y="-1347.97" font-family="Times,serif" font-size="14.00">Q0 × K3 × V3</text>
<text text-anchor="middle" x="404" y="-1332.97" font-family="Times,serif" font-size="14.00">(B, L/4, L/4) × (B, L/4, d_model)</text>
<text text-anchor="middle" x="404" y="-1317.97" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- attn_stage_0_1&#45;&gt;accum_0_1 -->
<g id="edge11" class="edge">
<title>attn_stage_0_1&#45;&gt;accum_0_1</title>
<path fill="none" stroke="black" d="M404,-1309.89C404,-1297.37 404,-1283.09 404,-1270.33"/>
<polygon fill="black" stroke="black" points="407.5,-1270.04 404,-1260.04 400.5,-1270.04 407.5,-1270.04"/>
</g>
<!-- recv_kv_0_1 -->
<g id="node10" class="node">
<title>recv_kv_0_1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="419" cy="-1455.12" rx="130.63" ry="37.45"/>
<text text-anchor="middle" x="419" y="-1466.42" font-family="Times,serif" font-size="14.00">Receive K,V from GPU3</text>
<text text-anchor="middle" x="419" y="-1451.42" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="419" y="-1436.42" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- recv_kv_0_1&#45;&gt;attn_stage_0_1 -->
<g id="edge8" class="edge">
<title>recv_kv_0_1&#45;&gt;attn_stage_0_1</title>
<path fill="none" stroke="black" d="M413.96,-1417.54C412.66,-1408.09 411.25,-1397.83 409.91,-1388.09"/>
<polygon fill="black" stroke="black" points="413.38,-1387.6 408.54,-1378.18 406.44,-1388.56 413.38,-1387.6"/>
</g>
<!-- accum_0_2 -->
<g id="node16" class="node">
<title>accum_0_2</title>
<polygon fill="lightgray" stroke="black" points="734,-1152.24 566,-1152.24 566,-1099.24 734,-1099.24 734,-1152.24"/>
<text text-anchor="middle" x="650" y="-1137.04" font-family="Times,serif" font-size="14.00">Accumulate Output 2</text>
<text text-anchor="middle" x="650" y="-1122.04" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="650" y="-1107.04" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- accum_0_1&#45;&gt;accum_0_2 -->
<g id="edge14" class="edge">
<title>accum_0_1&#45;&gt;accum_0_2</title>
<path fill="none" stroke="black" d="M463.55,-1206.68C498.94,-1191.51 543.99,-1172.19 580.94,-1156.35"/>
<polygon fill="black" stroke="black" points="582.33,-1159.56 590.15,-1152.4 579.58,-1153.13 582.33,-1159.56"/>
</g>
<!-- attn_stage_0_2 -->
<g id="node13" class="node">
<title>attn_stage_0_2</title>
<polygon fill="orange" stroke="black" points="771,-1267.22 529,-1267.22 529,-1199.22 771,-1199.22 771,-1267.22"/>
<text text-anchor="middle" x="650" y="-1252.02" font-family="Times,serif" font-size="14.00">Ring Attention Stage 2</text>
<text text-anchor="middle" x="650" y="-1237.02" font-family="Times,serif" font-size="14.00">Q0 × K2 × V2</text>
<text text-anchor="middle" x="650" y="-1222.02" font-family="Times,serif" font-size="14.00">(B, L/4, L/4) × (B, L/4, d_model)</text>
<text text-anchor="middle" x="650" y="-1207.02" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- attn_stage_0_2&#45;&gt;accum_0_2 -->
<g id="edge15" class="edge">
<title>attn_stage_0_2&#45;&gt;accum_0_2</title>
<path fill="none" stroke="black" d="M650,-1199.13C650,-1187.45 650,-1174.27 650,-1162.38"/>
<polygon fill="black" stroke="black" points="653.5,-1162.34 650,-1152.34 646.5,-1162.34 653.5,-1162.34"/>
</g>
<!-- recv_kv_0_2 -->
<g id="node14" class="node">
<title>recv_kv_0_2</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="674" cy="-1344.17" rx="130.63" ry="37.45"/>
<text text-anchor="middle" x="674" y="-1355.47" font-family="Times,serif" font-size="14.00">Receive K,V from GPU3</text>
<text text-anchor="middle" x="674" y="-1340.47" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="674" y="-1325.47" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- recv_kv_0_2&#45;&gt;attn_stage_0_2 -->
<g id="edge12" class="edge">
<title>recv_kv_0_2&#45;&gt;attn_stage_0_2</title>
<path fill="none" stroke="black" d="M665.94,-1306.59C663.86,-1297.14 661.6,-1286.88 659.45,-1277.13"/>
<polygon fill="black" stroke="black" points="662.84,-1276.23 657.27,-1267.22 656,-1277.74 662.84,-1276.23"/>
</g>
<!-- accum_0_3 -->
<g id="node20" class="node">
<title>accum_0_3</title>
<polygon fill="lightgray" stroke="black" points="858,-1055.74 690,-1055.74 690,-1002.74 858,-1002.74 858,-1055.74"/>
<text text-anchor="middle" x="774" y="-1040.54" font-family="Times,serif" font-size="14.00">Accumulate Output 3</text>
<text text-anchor="middle" x="774" y="-1025.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="774" y="-1010.54" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- accum_0_2&#45;&gt;accum_0_3 -->
<g id="edge18" class="edge">
<title>accum_0_2&#45;&gt;accum_0_3</title>
<path fill="none" stroke="black" d="M683.56,-1099.17C698.58,-1087.72 716.45,-1074.1 732.32,-1062"/>
<polygon fill="black" stroke="black" points="734.58,-1064.68 740.42,-1055.83 730.34,-1059.11 734.58,-1064.68"/>
</g>
<!-- attn_stage_0_3 -->
<g id="node17" class="node">
<title>attn_stage_0_3</title>
<polygon fill="orange" stroke="black" points="1018,-1159.74 776,-1159.74 776,-1091.74 1018,-1091.74 1018,-1159.74"/>
<text text-anchor="middle" x="897" y="-1144.54" font-family="Times,serif" font-size="14.00">Ring Attention Stage 3</text>
<text text-anchor="middle" x="897" y="-1129.54" font-family="Times,serif" font-size="14.00">Q0 × K1 × V1</text>
<text text-anchor="middle" x="897" y="-1114.54" font-family="Times,serif" font-size="14.00">(B, L/4, L/4) × (B, L/4, d_model)</text>
<text text-anchor="middle" x="897" y="-1099.54" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- attn_stage_0_3&#45;&gt;accum_0_3 -->
<g id="edge19" class="edge">
<title>attn_stage_0_3&#45;&gt;accum_0_3</title>
<path fill="none" stroke="black" d="M853.98,-1091.69C841.48,-1082.08 827.85,-1071.61 815.45,-1062.09"/>
<polygon fill="black" stroke="black" points="817.56,-1059.29 807.5,-1055.98 813.3,-1064.84 817.56,-1059.29"/>
</g>
<!-- recv_kv_0_3 -->
<g id="node18" class="node">
<title>recv_kv_0_3</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="920" cy="-1233.22" rx="130.63" ry="37.45"/>
<text text-anchor="middle" x="920" y="-1244.52" font-family="Times,serif" font-size="14.00">Receive K,V from GPU3</text>
<text text-anchor="middle" x="920" y="-1229.52" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="920" y="-1214.52" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- recv_kv_0_3&#45;&gt;attn_stage_0_3 -->
<g id="edge16" class="edge">
<title>recv_kv_0_3&#45;&gt;attn_stage_0_3</title>
<path fill="none" stroke="black" d="M912.02,-1195.62C910.19,-1187.24 908.23,-1178.26 906.35,-1169.64"/>
<polygon fill="black" stroke="black" points="909.75,-1168.77 904.2,-1159.74 902.91,-1170.26 909.75,-1168.77"/>
</g>
<!-- output_proj_0 -->
<g id="node21" class="node">
<title>output_proj_0</title>
<polygon fill="lightblue" stroke="black" points="916,-966.74 632,-966.74 632,-913.74 916,-913.74 916,-966.74"/>
<text text-anchor="middle" x="774" y="-951.54" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="774" y="-936.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) &#45;&gt; (B, L/4, d_model)</text>
<text text-anchor="middle" x="774" y="-921.54" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- accum_0_3&#45;&gt;output_proj_0 -->
<g id="edge20" class="edge">
<title>accum_0_3&#45;&gt;output_proj_0</title>
<path fill="none" stroke="black" d="M774,-1002.61C774,-994.63 774,-985.67 774,-977.12"/>
<polygon fill="black" stroke="black" points="777.5,-976.99 774,-966.99 770.5,-976.99 777.5,-976.99"/>
</g>
<!-- output_proj_0&#45;&gt;residual_0 -->
<g id="edge22" class="edge">
<title>output_proj_0&#45;&gt;residual_0</title>
<path fill="none" stroke="black" d="M774,-913.61C774,-905.63 774,-896.67 774,-888.12"/>
<polygon fill="black" stroke="black" points="777.5,-887.99 774,-877.99 770.5,-887.99 777.5,-887.99"/>
</g>
<!-- ln1_0 -->
<g id="node23" class="node">
<title>ln1_0</title>
<polygon fill="lightyellow" stroke="black" points="1417.5,-788.74 1280.5,-788.74 1280.5,-735.74 1417.5,-735.74 1417.5,-788.74"/>
<text text-anchor="middle" x="1349" y="-773.54" font-family="Times,serif" font-size="14.00">Layer Norm 1</text>
<text text-anchor="middle" x="1349" y="-758.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="1349" y="-743.54" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- residual_0&#45;&gt;ln1_0 -->
<g id="edge23" class="edge">
<title>residual_0&#45;&gt;ln1_0</title>
<path fill="none" stroke="black" d="M842.5,-839.88C949.75,-823.65 1156.71,-792.33 1270.05,-775.19"/>
<polygon fill="black" stroke="black" points="1270.69,-778.63 1280.06,-773.67 1269.64,-771.71 1270.69,-778.63"/>
</g>
<!-- mlp_col_0 -->
<g id="node24" class="node">
<title>mlp_col_0</title>
<polygon fill="lightcoral" stroke="black" points="1723.5,-699.74 1376.5,-699.74 1376.5,-646.74 1723.5,-646.74 1723.5,-699.74"/>
<text text-anchor="middle" x="1550" y="-684.54" font-family="Times,serif" font-size="14.00">MLP Column Parallel</text>
<text text-anchor="middle" x="1550" y="-669.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) &#45;&gt; (B, L/4, ffn_hidden_size/2)</text>
<text text-anchor="middle" x="1550" y="-654.54" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- ln1_0&#45;&gt;mlp_col_0 -->
<g id="edge24" class="edge">
<title>ln1_0&#45;&gt;mlp_col_0</title>
<path fill="none" stroke="black" d="M1407.95,-735.73C1431.06,-725.72 1457.73,-714.18 1481.68,-703.81"/>
<polygon fill="black" stroke="black" points="1483.27,-706.94 1491.05,-699.75 1480.49,-700.51 1483.27,-706.94"/>
</g>
<!-- residual2_0 -->
<g id="node27" class="node">
<title>residual2_0</title>
<polygon fill="pink" stroke="black" points="1618.5,-432.74 1481.5,-432.74 1481.5,-379.74 1618.5,-379.74 1618.5,-432.74"/>
<text text-anchor="middle" x="1550" y="-417.54" font-family="Times,serif" font-size="14.00">Residual Add 2</text>
<text text-anchor="middle" x="1550" y="-402.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="1550" y="-387.54" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- ln1_0&#45;&gt;residual2_0 -->
<g id="edge27" class="edge">
<title>ln1_0&#45;&gt;residual2_0</title>
<path fill="none" stroke="black" d="M1342.13,-735.72C1328.94,-680.59 1306.48,-548.85 1368,-468.74 1392.43,-436.93 1434.07,-421.43 1471.36,-413.95"/>
<polygon fill="black" stroke="black" points="1472.03,-417.38 1481.23,-412.12 1470.76,-410.5 1472.03,-417.38"/>
</g>
<!-- mlp_activation_0 -->
<g id="node25" class="node">
<title>mlp_activation_0</title>
<polygon fill="lightgreen" stroke="black" points="1650,-610.74 1450,-610.74 1450,-557.74 1650,-557.74 1650,-610.74"/>
<text text-anchor="middle" x="1550" y="-595.54" font-family="Times,serif" font-size="14.00">GELU Activation</text>
<text text-anchor="middle" x="1550" y="-580.54" font-family="Times,serif" font-size="14.00">(B, L/4, ffn_hidden_size/2)</text>
<text text-anchor="middle" x="1550" y="-565.54" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- mlp_col_0&#45;&gt;mlp_activation_0 -->
<g id="edge25" class="edge">
<title>mlp_col_0&#45;&gt;mlp_activation_0</title>
<path fill="none" stroke="black" d="M1550,-646.61C1550,-638.63 1550,-629.67 1550,-621.12"/>
<polygon fill="black" stroke="black" points="1553.5,-620.99 1550,-610.99 1546.5,-620.99 1553.5,-620.99"/>
</g>
<!-- mlp_row_0 -->
<g id="node26" class="node">
<title>mlp_row_0</title>
<polygon fill="lightcoral" stroke="black" points="1723.5,-521.74 1376.5,-521.74 1376.5,-468.74 1723.5,-468.74 1723.5,-521.74"/>
<text text-anchor="middle" x="1550" y="-506.54" font-family="Times,serif" font-size="14.00">MLP Row Parallel</text>
<text text-anchor="middle" x="1550" y="-491.54" font-family="Times,serif" font-size="14.00">(B, L/4, ffn_hidden_size/2) &#45;&gt; (B, L/4, d_model)</text>
<text text-anchor="middle" x="1550" y="-476.54" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- mlp_activation_0&#45;&gt;mlp_row_0 -->
<g id="edge26" class="edge">
<title>mlp_activation_0&#45;&gt;mlp_row_0</title>
<path fill="none" stroke="black" d="M1550,-557.61C1550,-549.63 1550,-540.67 1550,-532.12"/>
<polygon fill="black" stroke="black" points="1553.5,-531.99 1550,-521.99 1546.5,-531.99 1553.5,-531.99"/>
</g>
<!-- mlp_row_0&#45;&gt;residual2_0 -->
<g id="edge28" class="edge">
<title>mlp_row_0&#45;&gt;residual2_0</title>
<path fill="none" stroke="black" d="M1550,-468.61C1550,-460.63 1550,-451.67 1550,-443.12"/>
<polygon fill="black" stroke="black" points="1553.5,-442.99 1550,-432.99 1546.5,-442.99 1553.5,-442.99"/>
</g>
<!-- ln2_0 -->
<g id="node28" class="node">
<title>ln2_0</title>
<polygon fill="lightyellow" stroke="black" points="2382.5,-343.74 2245.5,-343.74 2245.5,-290.74 2382.5,-290.74 2382.5,-343.74"/>
<text text-anchor="middle" x="2314" y="-328.54" font-family="Times,serif" font-size="14.00">Layer Norm 2</text>
<text text-anchor="middle" x="2314" y="-313.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="2314" y="-298.54" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- residual2_0&#45;&gt;ln2_0 -->
<g id="edge29" class="edge">
<title>residual2_0&#45;&gt;ln2_0</title>
<path fill="none" stroke="black" d="M1618.81,-397.4C1760.8,-381.24 2085.48,-344.26 2235.43,-327.19"/>
<polygon fill="black" stroke="black" points="2235.94,-330.65 2245.48,-326.04 2235.15,-323.7 2235.94,-330.65"/>
</g>
<!-- output_seg_0 -->
<g id="node29" class="node">
<title>output_seg_0</title>
<polygon fill="lightcyan" stroke="black" points="2505.5,-254.74 2356.5,-254.74 2356.5,-201.74 2505.5,-201.74 2505.5,-254.74"/>
<text text-anchor="middle" x="2431" y="-239.54" font-family="Times,serif" font-size="14.00">Output Segment 0</text>
<text text-anchor="middle" x="2431" y="-224.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="2431" y="-209.54" font-family="Times,serif" font-size="14.00">GPU_0</text>
</g>
<!-- ln2_0&#45;&gt;output_seg_0 -->
<g id="edge30" class="edge">
<title>ln2_0&#45;&gt;output_seg_0</title>
<path fill="none" stroke="black" d="M2348.47,-290.61C2360.86,-281.4 2374.98,-270.89 2388,-261.21"/>
<polygon fill="black" stroke="black" points="2390.43,-263.77 2396.37,-254.99 2386.26,-258.15 2390.43,-263.77"/>
</g>
<!-- gather -->
<g id="node111" class="node">
<title>gather</title>
<polygon fill="yellow" stroke="black" points="2928.13,-165.74 2655.9,-165.74 2585.87,-89.74 2858.1,-89.74 2928.13,-165.74"/>
<text text-anchor="middle" x="2757" y="-131.54" font-family="Times,serif" font-size="14.00">Gather All Segments</text>
<text text-anchor="middle" x="2757" y="-116.54" font-family="Times,serif" font-size="14.00">(B, L, d_model)</text>
</g>
<!-- output_seg_0&#45;&gt;gather -->
<g id="edge118" class="edge">
<title>output_seg_0&#45;&gt;gather</title>
<path fill="none" stroke="black" d="M2505.79,-204.64C2545.9,-192.52 2596.2,-177.33 2641.23,-163.72"/>
<polygon fill="black" stroke="black" points="2642.49,-166.99 2651.05,-160.75 2640.47,-160.29 2642.49,-166.99"/>
</g>
<!-- qkv_proj_1 -->
<g id="node31" class="node">
<title>qkv_proj_1</title>
<polygon fill="lightblue" stroke="black" points="2745.5,-1723.6 2446.5,-1723.6 2446.5,-1670.6 2745.5,-1670.6 2745.5,-1723.6"/>
<text text-anchor="middle" x="2596" y="-1708.4" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="2596" y="-1693.4" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) &#45;&gt; (B, L/4, 3*d_model)</text>
<text text-anchor="middle" x="2596" y="-1678.4" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- input_1&#45;&gt;qkv_proj_1 -->
<g id="edge32" class="edge">
<title>input_1&#45;&gt;qkv_proj_1</title>
<path fill="none" stroke="black" d="M2596,-1759.47C2596,-1751.49 2596,-1742.53 2596,-1733.98"/>
<polygon fill="black" stroke="black" points="2599.5,-1733.85 2596,-1723.85 2592.5,-1733.85 2599.5,-1733.85"/>
</g>
<!-- residual_1 -->
<g id="node49" class="node">
<title>residual_1</title>
<polygon fill="pink" stroke="black" points="2451.5,-877.74 2314.5,-877.74 2314.5,-824.74 2451.5,-824.74 2451.5,-877.74"/>
<text text-anchor="middle" x="2383" y="-862.54" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="2383" y="-847.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="2383" y="-832.54" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- input_1&#45;&gt;residual_1 -->
<g id="edge50" class="edge">
<title>input_1&#45;&gt;residual_1</title>
<path fill="none" stroke="black" d="M2527.17,-1785.21C2307.74,-1783.73 1639,-1764.31 1639,-1582.6 1639,-1582.6 1639,-1582.6 1639,-1028.24 1639,-892.69 2112.57,-861.4 2304.06,-854.29"/>
<polygon fill="black" stroke="black" points="2304.47,-857.78 2314.34,-853.92 2304.22,-850.78 2304.47,-857.78"/>
</g>
<!-- split_qkv_1 -->
<g id="node32" class="node">
<title>split_qkv_1</title>
<polygon fill="yellow" stroke="black" points="2777.36,-1634.6 2488.85,-1634.6 2414.64,-1528.6 2703.15,-1528.6 2777.36,-1634.6"/>
<text text-anchor="middle" x="2596" y="-1592.9" font-family="Times,serif" font-size="14.00">Split QKV</text>
<text text-anchor="middle" x="2596" y="-1577.9" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="2596" y="-1562.9" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- qkv_proj_1&#45;&gt;split_qkv_1 -->
<g id="edge33" class="edge">
<title>qkv_proj_1&#45;&gt;split_qkv_1</title>
<path fill="none" stroke="black" d="M2596,-1670.35C2596,-1662.65 2596,-1653.85 2596,-1644.87"/>
<polygon fill="black" stroke="black" points="2599.5,-1644.7 2596,-1634.7 2592.5,-1644.7 2599.5,-1644.7"/>
</g>
<!-- attn_stage_1_0 -->
<g id="node33" class="node">
<title>attn_stage_1_0</title>
<polygon fill="orange" stroke="black" points="1909,-1489.12 1667,-1489.12 1667,-1421.12 1909,-1421.12 1909,-1489.12"/>
<text text-anchor="middle" x="1788" y="-1473.92" font-family="Times,serif" font-size="14.00">Ring Attention Stage 0</text>
<text text-anchor="middle" x="1788" y="-1458.92" font-family="Times,serif" font-size="14.00">Q1 × K1 × V1</text>
<text text-anchor="middle" x="1788" y="-1443.92" font-family="Times,serif" font-size="14.00">(B, L/4, L/4) × (B, L/4, d_model)</text>
<text text-anchor="middle" x="1788" y="-1428.92" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- split_qkv_1&#45;&gt;attn_stage_1_0 -->
<g id="edge34" class="edge">
<title>split_qkv_1&#45;&gt;attn_stage_1_0</title>
<path fill="none" stroke="black" d="M2441.47,-1566.96C2303.36,-1553.25 2095.94,-1528.91 1918,-1492.6 1916.06,-1492.2 1914.11,-1491.8 1912.15,-1491.37"/>
<polygon fill="black" stroke="black" points="1912.79,-1487.93 1902.27,-1489.17 1911.27,-1494.76 1912.79,-1487.93"/>
</g>
<!-- send_kv_1_0 -->
<g id="node34" class="node">
<title>send_kv_1_0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="2596" cy="-1455.12" rx="123.99" ry="37.45"/>
<text text-anchor="middle" x="2596" y="-1466.42" font-family="Times,serif" font-size="14.00">Send K,V to GPU2</text>
<text text-anchor="middle" x="2596" y="-1451.42" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="2596" y="-1436.42" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- split_qkv_1&#45;&gt;send_kv_1_0 -->
<g id="edge35" class="edge">
<title>split_qkv_1&#45;&gt;send_kv_1_0</title>
<path fill="none" stroke="black" d="M2596,-1528.53C2596,-1520.1 2596,-1511.41 2596,-1503.11"/>
<polygon fill="black" stroke="black" points="2599.5,-1502.85 2596,-1492.85 2592.5,-1502.85 2599.5,-1502.85"/>
</g>
<!-- send_kv_1_1 -->
<g id="node38" class="node">
<title>send_kv_1_1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="2861" cy="-1455.12" rx="123.99" ry="37.45"/>
<text text-anchor="middle" x="2861" y="-1466.42" font-family="Times,serif" font-size="14.00">Send K,V to GPU2</text>
<text text-anchor="middle" x="2861" y="-1451.42" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="2861" y="-1436.42" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- split_qkv_1&#45;&gt;send_kv_1_1 -->
<g id="edge38" class="edge">
<title>split_qkv_1&#45;&gt;send_kv_1_1</title>
<path fill="none" stroke="black" d="M2704.17,-1529.79C2731.7,-1516.86 2760.68,-1503.24 2786.14,-1491.29"/>
<polygon fill="black" stroke="black" points="2787.79,-1494.38 2795.35,-1486.96 2784.81,-1488.04 2787.79,-1494.38"/>
</g>
<!-- send_kv_1_2 -->
<g id="node42" class="node">
<title>send_kv_1_2</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="3126" cy="-1455.12" rx="123.99" ry="37.45"/>
<text text-anchor="middle" x="3126" y="-1466.42" font-family="Times,serif" font-size="14.00">Send K,V to GPU2</text>
<text text-anchor="middle" x="3126" y="-1451.42" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="3126" y="-1436.42" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- split_qkv_1&#45;&gt;send_kv_1_2 -->
<g id="edge42" class="edge">
<title>split_qkv_1&#45;&gt;send_kv_1_2</title>
<path fill="none" stroke="black" d="M2721.42,-1554.62C2799.97,-1537.91 2903.18,-1515.17 2994,-1492.6 3004.8,-1489.92 3016.06,-1487 3027.25,-1484.01"/>
<polygon fill="black" stroke="black" points="3028.31,-1487.35 3037.06,-1481.38 3026.49,-1480.59 3028.31,-1487.35"/>
</g>
<!-- send_kv_1_3 -->
<g id="node46" class="node">
<title>send_kv_1_3</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="2331" cy="-1455.12" rx="123.99" ry="37.45"/>
<text text-anchor="middle" x="2331" y="-1466.42" font-family="Times,serif" font-size="14.00">Send K,V to GPU2</text>
<text text-anchor="middle" x="2331" y="-1451.42" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="2331" y="-1436.42" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- split_qkv_1&#45;&gt;send_kv_1_3 -->
<g id="edge46" class="edge">
<title>split_qkv_1&#45;&gt;send_kv_1_3</title>
<path fill="none" stroke="black" d="M2485.15,-1528.53C2458.49,-1516.01 2430.63,-1502.92 2406.04,-1491.37"/>
<polygon fill="black" stroke="black" points="2407.32,-1488.11 2396.78,-1487.02 2404.35,-1494.44 2407.32,-1488.11"/>
</g>
<!-- accum_1_0 -->
<g id="node35" class="node">
<title>accum_1_0</title>
<polygon fill="lightgray" stroke="black" points="1872.5,-1370.67 1735.5,-1370.67 1735.5,-1317.67 1872.5,-1317.67 1872.5,-1370.67"/>
<text text-anchor="middle" x="1804" y="-1355.47" font-family="Times,serif" font-size="14.00">Initialize Output</text>
<text text-anchor="middle" x="1804" y="-1340.47" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="1804" y="-1325.47" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- attn_stage_1_0&#45;&gt;accum_1_0 -->
<g id="edge36" class="edge">
<title>attn_stage_1_0&#45;&gt;accum_1_0</title>
<path fill="none" stroke="black" d="M1792.89,-1420.84C1794.74,-1408.2 1796.87,-1393.76 1798.75,-1380.9"/>
<polygon fill="black" stroke="black" points="1802.22,-1381.39 1800.21,-1370.99 1795.29,-1380.38 1802.22,-1381.39"/>
</g>
<!-- accum_1_1 -->
<g id="node39" class="node">
<title>accum_1_1</title>
<polygon fill="lightgray" stroke="black" points="2127,-1259.72 1959,-1259.72 1959,-1206.72 2127,-1206.72 2127,-1259.72"/>
<text text-anchor="middle" x="2043" y="-1244.52" font-family="Times,serif" font-size="14.00">Accumulate Output 1</text>
<text text-anchor="middle" x="2043" y="-1229.52" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="2043" y="-1214.52" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- accum_1_0&#45;&gt;accum_1_1 -->
<g id="edge39" class="edge">
<title>accum_1_0&#45;&gt;accum_1_1</title>
<path fill="none" stroke="black" d="M1860.03,-1317.63C1895.27,-1301.56 1940.87,-1280.78 1977.73,-1263.97"/>
<polygon fill="black" stroke="black" points="1979.26,-1267.12 1986.9,-1259.79 1976.35,-1260.75 1979.26,-1267.12"/>
</g>
<!-- attn_stage_1_1 -->
<g id="node36" class="node">
<title>attn_stage_1_1</title>
<polygon fill="orange" stroke="black" points="2164,-1378.17 1922,-1378.17 1922,-1310.17 2164,-1310.17 2164,-1378.17"/>
<text text-anchor="middle" x="2043" y="-1362.97" font-family="Times,serif" font-size="14.00">Ring Attention Stage 1</text>
<text text-anchor="middle" x="2043" y="-1347.97" font-family="Times,serif" font-size="14.00">Q1 × K0 × V0</text>
<text text-anchor="middle" x="2043" y="-1332.97" font-family="Times,serif" font-size="14.00">(B, L/4, L/4) × (B, L/4, d_model)</text>
<text text-anchor="middle" x="2043" y="-1317.97" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- attn_stage_1_1&#45;&gt;accum_1_1 -->
<g id="edge40" class="edge">
<title>attn_stage_1_1&#45;&gt;accum_1_1</title>
<path fill="none" stroke="black" d="M2043,-1309.89C2043,-1297.37 2043,-1283.09 2043,-1270.33"/>
<polygon fill="black" stroke="black" points="2046.5,-1270.04 2043,-1260.04 2039.5,-1270.04 2046.5,-1270.04"/>
</g>
<!-- recv_kv_1_1 -->
<g id="node37" class="node">
<title>recv_kv_1_1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="2058" cy="-1455.12" rx="130.63" ry="37.45"/>
<text text-anchor="middle" x="2058" y="-1466.42" font-family="Times,serif" font-size="14.00">Receive K,V from GPU0</text>
<text text-anchor="middle" x="2058" y="-1451.42" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="2058" y="-1436.42" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- recv_kv_1_1&#45;&gt;attn_stage_1_1 -->
<g id="edge37" class="edge">
<title>recv_kv_1_1&#45;&gt;attn_stage_1_1</title>
<path fill="none" stroke="black" d="M2052.96,-1417.54C2051.66,-1408.09 2050.25,-1397.83 2048.91,-1388.09"/>
<polygon fill="black" stroke="black" points="2052.38,-1387.6 2047.54,-1378.18 2045.44,-1388.56 2052.38,-1387.6"/>
</g>
<!-- accum_1_2 -->
<g id="node43" class="node">
<title>accum_1_2</title>
<polygon fill="lightgray" stroke="black" points="2373,-1152.24 2205,-1152.24 2205,-1099.24 2373,-1099.24 2373,-1152.24"/>
<text text-anchor="middle" x="2289" y="-1137.04" font-family="Times,serif" font-size="14.00">Accumulate Output 2</text>
<text text-anchor="middle" x="2289" y="-1122.04" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="2289" y="-1107.04" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- accum_1_1&#45;&gt;accum_1_2 -->
<g id="edge43" class="edge">
<title>accum_1_1&#45;&gt;accum_1_2</title>
<path fill="none" stroke="black" d="M2102.55,-1206.68C2137.94,-1191.51 2182.99,-1172.19 2219.94,-1156.35"/>
<polygon fill="black" stroke="black" points="2221.33,-1159.56 2229.15,-1152.4 2218.58,-1153.13 2221.33,-1159.56"/>
</g>
<!-- attn_stage_1_2 -->
<g id="node40" class="node">
<title>attn_stage_1_2</title>
<polygon fill="orange" stroke="black" points="2410,-1267.22 2168,-1267.22 2168,-1199.22 2410,-1199.22 2410,-1267.22"/>
<text text-anchor="middle" x="2289" y="-1252.02" font-family="Times,serif" font-size="14.00">Ring Attention Stage 2</text>
<text text-anchor="middle" x="2289" y="-1237.02" font-family="Times,serif" font-size="14.00">Q1 × K3 × V3</text>
<text text-anchor="middle" x="2289" y="-1222.02" font-family="Times,serif" font-size="14.00">(B, L/4, L/4) × (B, L/4, d_model)</text>
<text text-anchor="middle" x="2289" y="-1207.02" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- attn_stage_1_2&#45;&gt;accum_1_2 -->
<g id="edge44" class="edge">
<title>attn_stage_1_2&#45;&gt;accum_1_2</title>
<path fill="none" stroke="black" d="M2289,-1199.13C2289,-1187.45 2289,-1174.27 2289,-1162.38"/>
<polygon fill="black" stroke="black" points="2292.5,-1162.34 2289,-1152.34 2285.5,-1162.34 2292.5,-1162.34"/>
</g>
<!-- recv_kv_1_2 -->
<g id="node41" class="node">
<title>recv_kv_1_2</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="2313" cy="-1344.17" rx="130.63" ry="37.45"/>
<text text-anchor="middle" x="2313" y="-1355.47" font-family="Times,serif" font-size="14.00">Receive K,V from GPU0</text>
<text text-anchor="middle" x="2313" y="-1340.47" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="2313" y="-1325.47" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- recv_kv_1_2&#45;&gt;attn_stage_1_2 -->
<g id="edge41" class="edge">
<title>recv_kv_1_2&#45;&gt;attn_stage_1_2</title>
<path fill="none" stroke="black" d="M2304.94,-1306.59C2302.86,-1297.14 2300.6,-1286.88 2298.45,-1277.13"/>
<polygon fill="black" stroke="black" points="2301.84,-1276.23 2296.27,-1267.22 2295,-1277.74 2301.84,-1276.23"/>
</g>
<!-- accum_1_3 -->
<g id="node47" class="node">
<title>accum_1_3</title>
<polygon fill="lightgray" stroke="black" points="2467,-1055.74 2299,-1055.74 2299,-1002.74 2467,-1002.74 2467,-1055.74"/>
<text text-anchor="middle" x="2383" y="-1040.54" font-family="Times,serif" font-size="14.00">Accumulate Output 3</text>
<text text-anchor="middle" x="2383" y="-1025.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="2383" y="-1010.54" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- accum_1_2&#45;&gt;accum_1_3 -->
<g id="edge47" class="edge">
<title>accum_1_2&#45;&gt;accum_1_3</title>
<path fill="none" stroke="black" d="M2314.69,-1098.92C2325.67,-1087.88 2338.62,-1074.85 2350.28,-1063.13"/>
<polygon fill="black" stroke="black" points="2352.77,-1065.59 2357.35,-1056.03 2347.81,-1060.65 2352.77,-1065.59"/>
</g>
<!-- attn_stage_1_3 -->
<g id="node44" class="node">
<title>attn_stage_1_3</title>
<polygon fill="orange" stroke="black" points="2657,-1159.74 2415,-1159.74 2415,-1091.74 2657,-1091.74 2657,-1159.74"/>
<text text-anchor="middle" x="2536" y="-1144.54" font-family="Times,serif" font-size="14.00">Ring Attention Stage 3</text>
<text text-anchor="middle" x="2536" y="-1129.54" font-family="Times,serif" font-size="14.00">Q1 × K2 × V2</text>
<text text-anchor="middle" x="2536" y="-1114.54" font-family="Times,serif" font-size="14.00">(B, L/4, L/4) × (B, L/4, d_model)</text>
<text text-anchor="middle" x="2536" y="-1099.54" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- attn_stage_1_3&#45;&gt;accum_1_3 -->
<g id="edge48" class="edge">
<title>attn_stage_1_3&#45;&gt;accum_1_3</title>
<path fill="none" stroke="black" d="M2482.49,-1091.69C2466.49,-1081.81 2449.02,-1071.02 2433.24,-1061.27"/>
<polygon fill="black" stroke="black" points="2435.02,-1058.25 2424.67,-1055.98 2431.34,-1064.21 2435.02,-1058.25"/>
</g>
<!-- recv_kv_1_3 -->
<g id="node45" class="node">
<title>recv_kv_1_3</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="2559" cy="-1233.22" rx="130.63" ry="37.45"/>
<text text-anchor="middle" x="2559" y="-1244.52" font-family="Times,serif" font-size="14.00">Receive K,V from GPU0</text>
<text text-anchor="middle" x="2559" y="-1229.52" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="2559" y="-1214.52" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- recv_kv_1_3&#45;&gt;attn_stage_1_3 -->
<g id="edge45" class="edge">
<title>recv_kv_1_3&#45;&gt;attn_stage_1_3</title>
<path fill="none" stroke="black" d="M2551.02,-1195.62C2549.19,-1187.24 2547.23,-1178.26 2545.35,-1169.64"/>
<polygon fill="black" stroke="black" points="2548.75,-1168.77 2543.2,-1159.74 2541.91,-1170.26 2548.75,-1168.77"/>
</g>
<!-- output_proj_1 -->
<g id="node48" class="node">
<title>output_proj_1</title>
<polygon fill="lightblue" stroke="black" points="2525,-966.74 2241,-966.74 2241,-913.74 2525,-913.74 2525,-966.74"/>
<text text-anchor="middle" x="2383" y="-951.54" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="2383" y="-936.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) &#45;&gt; (B, L/4, d_model)</text>
<text text-anchor="middle" x="2383" y="-921.54" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- accum_1_3&#45;&gt;output_proj_1 -->
<g id="edge49" class="edge">
<title>accum_1_3&#45;&gt;output_proj_1</title>
<path fill="none" stroke="black" d="M2383,-1002.61C2383,-994.63 2383,-985.67 2383,-977.12"/>
<polygon fill="black" stroke="black" points="2386.5,-976.99 2383,-966.99 2379.5,-976.99 2386.5,-976.99"/>
</g>
<!-- output_proj_1&#45;&gt;residual_1 -->
<g id="edge51" class="edge">
<title>output_proj_1&#45;&gt;residual_1</title>
<path fill="none" stroke="black" d="M2383,-913.61C2383,-905.63 2383,-896.67 2383,-888.12"/>
<polygon fill="black" stroke="black" points="2386.5,-887.99 2383,-877.99 2379.5,-887.99 2386.5,-887.99"/>
</g>
<!-- ln1_1 -->
<g id="node50" class="node">
<title>ln1_1</title>
<polygon fill="lightyellow" stroke="black" points="2499.5,-788.74 2362.5,-788.74 2362.5,-735.74 2499.5,-735.74 2499.5,-788.74"/>
<text text-anchor="middle" x="2431" y="-773.54" font-family="Times,serif" font-size="14.00">Layer Norm 1</text>
<text text-anchor="middle" x="2431" y="-758.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="2431" y="-743.54" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- residual_1&#45;&gt;ln1_1 -->
<g id="edge52" class="edge">
<title>residual_1&#45;&gt;ln1_1</title>
<path fill="none" stroke="black" d="M2397.14,-824.61C2401.74,-816.27 2406.92,-806.88 2411.82,-798"/>
<polygon fill="black" stroke="black" points="2415.03,-799.44 2416.79,-788.99 2408.9,-796.05 2415.03,-799.44"/>
</g>
<!-- mlp_col_1 -->
<g id="node51" class="node">
<title>mlp_col_1</title>
<polygon fill="lightcoral" stroke="black" points="2805.5,-699.74 2458.5,-699.74 2458.5,-646.74 2805.5,-646.74 2805.5,-699.74"/>
<text text-anchor="middle" x="2632" y="-684.54" font-family="Times,serif" font-size="14.00">MLP Column Parallel</text>
<text text-anchor="middle" x="2632" y="-669.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) &#45;&gt; (B, L/4, ffn_hidden_size/2)</text>
<text text-anchor="middle" x="2632" y="-654.54" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- ln1_1&#45;&gt;mlp_col_1 -->
<g id="edge53" class="edge">
<title>ln1_1&#45;&gt;mlp_col_1</title>
<path fill="none" stroke="black" d="M2489.95,-735.73C2513.06,-725.72 2539.73,-714.18 2563.68,-703.81"/>
<polygon fill="black" stroke="black" points="2565.27,-706.94 2573.05,-699.75 2562.49,-700.51 2565.27,-706.94"/>
</g>
<!-- residual2_1 -->
<g id="node54" class="node">
<title>residual2_1</title>
<polygon fill="pink" stroke="black" points="2700.5,-432.74 2563.5,-432.74 2563.5,-379.74 2700.5,-379.74 2700.5,-432.74"/>
<text text-anchor="middle" x="2632" y="-417.54" font-family="Times,serif" font-size="14.00">Residual Add 2</text>
<text text-anchor="middle" x="2632" y="-402.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="2632" y="-387.54" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- ln1_1&#45;&gt;residual2_1 -->
<g id="edge56" class="edge">
<title>ln1_1&#45;&gt;residual2_1</title>
<path fill="none" stroke="black" d="M2424.13,-735.72C2410.94,-680.59 2388.48,-548.85 2450,-468.74 2474.43,-436.93 2516.07,-421.43 2553.36,-413.95"/>
<polygon fill="black" stroke="black" points="2554.03,-417.38 2563.23,-412.12 2552.76,-410.5 2554.03,-417.38"/>
</g>
<!-- mlp_activation_1 -->
<g id="node52" class="node">
<title>mlp_activation_1</title>
<polygon fill="lightgreen" stroke="black" points="2732,-610.74 2532,-610.74 2532,-557.74 2732,-557.74 2732,-610.74"/>
<text text-anchor="middle" x="2632" y="-595.54" font-family="Times,serif" font-size="14.00">GELU Activation</text>
<text text-anchor="middle" x="2632" y="-580.54" font-family="Times,serif" font-size="14.00">(B, L/4, ffn_hidden_size/2)</text>
<text text-anchor="middle" x="2632" y="-565.54" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- mlp_col_1&#45;&gt;mlp_activation_1 -->
<g id="edge54" class="edge">
<title>mlp_col_1&#45;&gt;mlp_activation_1</title>
<path fill="none" stroke="black" d="M2632,-646.61C2632,-638.63 2632,-629.67 2632,-621.12"/>
<polygon fill="black" stroke="black" points="2635.5,-620.99 2632,-610.99 2628.5,-620.99 2635.5,-620.99"/>
</g>
<!-- mlp_row_1 -->
<g id="node53" class="node">
<title>mlp_row_1</title>
<polygon fill="lightcoral" stroke="black" points="2805.5,-521.74 2458.5,-521.74 2458.5,-468.74 2805.5,-468.74 2805.5,-521.74"/>
<text text-anchor="middle" x="2632" y="-506.54" font-family="Times,serif" font-size="14.00">MLP Row Parallel</text>
<text text-anchor="middle" x="2632" y="-491.54" font-family="Times,serif" font-size="14.00">(B, L/4, ffn_hidden_size/2) &#45;&gt; (B, L/4, d_model)</text>
<text text-anchor="middle" x="2632" y="-476.54" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- mlp_activation_1&#45;&gt;mlp_row_1 -->
<g id="edge55" class="edge">
<title>mlp_activation_1&#45;&gt;mlp_row_1</title>
<path fill="none" stroke="black" d="M2632,-557.61C2632,-549.63 2632,-540.67 2632,-532.12"/>
<polygon fill="black" stroke="black" points="2635.5,-531.99 2632,-521.99 2628.5,-531.99 2635.5,-531.99"/>
</g>
<!-- mlp_row_1&#45;&gt;residual2_1 -->
<g id="edge57" class="edge">
<title>mlp_row_1&#45;&gt;residual2_1</title>
<path fill="none" stroke="black" d="M2632,-468.61C2632,-460.63 2632,-451.67 2632,-443.12"/>
<polygon fill="black" stroke="black" points="2635.5,-442.99 2632,-432.99 2628.5,-442.99 2635.5,-442.99"/>
</g>
<!-- ln2_1 -->
<g id="node55" class="node">
<title>ln2_1</title>
<polygon fill="lightyellow" stroke="black" points="2708.5,-343.74 2571.5,-343.74 2571.5,-290.74 2708.5,-290.74 2708.5,-343.74"/>
<text text-anchor="middle" x="2640" y="-328.54" font-family="Times,serif" font-size="14.00">Layer Norm 2</text>
<text text-anchor="middle" x="2640" y="-313.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="2640" y="-298.54" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- residual2_1&#45;&gt;ln2_1 -->
<g id="edge58" class="edge">
<title>residual2_1&#45;&gt;ln2_1</title>
<path fill="none" stroke="black" d="M2634.36,-379.61C2635.09,-371.63 2635.91,-362.67 2636.7,-354.12"/>
<polygon fill="black" stroke="black" points="2640.2,-354.27 2637.63,-343.99 2633.23,-353.63 2640.2,-354.27"/>
</g>
<!-- output_seg_1 -->
<g id="node56" class="node">
<title>output_seg_1</title>
<polygon fill="lightcyan" stroke="black" points="2731.5,-254.74 2582.5,-254.74 2582.5,-201.74 2731.5,-201.74 2731.5,-254.74"/>
<text text-anchor="middle" x="2657" y="-239.54" font-family="Times,serif" font-size="14.00">Output Segment 1</text>
<text text-anchor="middle" x="2657" y="-224.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="2657" y="-209.54" font-family="Times,serif" font-size="14.00">GPU_1</text>
</g>
<!-- ln2_1&#45;&gt;output_seg_1 -->
<g id="edge59" class="edge">
<title>ln2_1&#45;&gt;output_seg_1</title>
<path fill="none" stroke="black" d="M2645.01,-290.61C2646.59,-282.54 2648.36,-273.48 2650.04,-264.84"/>
<polygon fill="black" stroke="black" points="2653.49,-265.48 2651.97,-254.99 2646.62,-264.13 2653.49,-265.48"/>
</g>
<!-- output_seg_1&#45;&gt;gather -->
<g id="edge119" class="edge">
<title>output_seg_1&#45;&gt;gather</title>
<path fill="none" stroke="black" d="M2683.01,-201.62C2691.86,-192.9 2702.02,-182.89 2711.92,-173.14"/>
<polygon fill="black" stroke="black" points="2714.4,-175.62 2719.06,-166.11 2709.48,-170.63 2714.4,-175.62"/>
</g>
<!-- qkv_proj_2 -->
<g id="node58" class="node">
<title>qkv_proj_2</title>
<polygon fill="lightblue" stroke="black" points="3994.5,-1723.6 3695.5,-1723.6 3695.5,-1670.6 3994.5,-1670.6 3994.5,-1723.6"/>
<text text-anchor="middle" x="3845" y="-1708.4" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="3845" y="-1693.4" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) &#45;&gt; (B, L/4, 3*d_model)</text>
<text text-anchor="middle" x="3845" y="-1678.4" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- input_2&#45;&gt;qkv_proj_2 -->
<g id="edge61" class="edge">
<title>input_2&#45;&gt;qkv_proj_2</title>
<path fill="none" stroke="black" d="M3346.68,-1774.56C3430.17,-1761.75 3573.77,-1739.72 3685.42,-1722.59"/>
<polygon fill="black" stroke="black" points="3686.09,-1726.02 3695.44,-1721.05 3685.03,-1719.1 3686.09,-1726.02"/>
</g>
<!-- residual_2 -->
<g id="node76" class="node">
<title>residual_2</title>
<polygon fill="pink" stroke="black" points="3346.5,-877.74 3209.5,-877.74 3209.5,-824.74 3346.5,-824.74 3346.5,-877.74"/>
<text text-anchor="middle" x="3278" y="-862.54" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="3278" y="-847.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="3278" y="-832.54" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- input_2&#45;&gt;residual_2 -->
<g id="edge79" class="edge">
<title>input_2&#45;&gt;residual_2</title>
<path fill="none" stroke="black" d="M3278,-1759.53C3278,-1721.11 3278,-1646.23 3278,-1582.6 3278,-1582.6 3278,-1582.6 3278,-1028.24 3278,-979.78 3278,-923.82 3278,-888.24"/>
<polygon fill="black" stroke="black" points="3281.5,-887.89 3278,-877.89 3274.5,-887.89 3281.5,-887.89"/>
</g>
<!-- split_qkv_2 -->
<g id="node59" class="node">
<title>split_qkv_2</title>
<polygon fill="yellow" stroke="black" points="4283.36,-1634.6 3994.85,-1634.6 3920.64,-1528.6 4209.15,-1528.6 4283.36,-1634.6"/>
<text text-anchor="middle" x="4102" y="-1592.9" font-family="Times,serif" font-size="14.00">Split QKV</text>
<text text-anchor="middle" x="4102" y="-1577.9" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="4102" y="-1562.9" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- qkv_proj_2&#45;&gt;split_qkv_2 -->
<g id="edge62" class="edge">
<title>qkv_proj_2&#45;&gt;split_qkv_2</title>
<path fill="none" stroke="black" d="M3903,-1670.49C3926.74,-1660 3955.13,-1647.46 3982.93,-1635.18"/>
<polygon fill="black" stroke="black" points="3984.6,-1638.28 3992.33,-1631.03 3981.77,-1631.87 3984.6,-1638.28"/>
</g>
<!-- attn_stage_2_0 -->
<g id="node60" class="node">
<title>attn_stage_2_0</title>
<polygon fill="orange" stroke="black" points="3548,-1489.12 3306,-1489.12 3306,-1421.12 3548,-1421.12 3548,-1489.12"/>
<text text-anchor="middle" x="3427" y="-1473.92" font-family="Times,serif" font-size="14.00">Ring Attention Stage 0</text>
<text text-anchor="middle" x="3427" y="-1458.92" font-family="Times,serif" font-size="14.00">Q2 × K2 × V2</text>
<text text-anchor="middle" x="3427" y="-1443.92" font-family="Times,serif" font-size="14.00">(B, L/4, L/4) × (B, L/4, d_model)</text>
<text text-anchor="middle" x="3427" y="-1428.92" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- split_qkv_2&#45;&gt;attn_stage_2_0 -->
<g id="edge63" class="edge">
<title>split_qkv_2&#45;&gt;attn_stage_2_0</title>
<path fill="none" stroke="black" d="M3942.21,-1559.67C3833.1,-1544.19 3685.58,-1520.92 3557,-1492.6 3555.31,-1492.23 3553.61,-1491.85 3551.89,-1491.46"/>
<polygon fill="black" stroke="black" points="3552.55,-1488.01 3542.01,-1489.14 3550.95,-1494.83 3552.55,-1488.01"/>
</g>
<!-- send_kv_2_0 -->
<g id="node61" class="node">
<title>send_kv_2_0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="3970" cy="-1455.12" rx="123.99" ry="37.45"/>
<text text-anchor="middle" x="3970" y="-1466.42" font-family="Times,serif" font-size="14.00">Send K,V to GPU3</text>
<text text-anchor="middle" x="3970" y="-1451.42" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="3970" y="-1436.42" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- split_qkv_2&#45;&gt;send_kv_2_0 -->
<g id="edge64" class="edge">
<title>split_qkv_2&#45;&gt;send_kv_2_0</title>
<path fill="none" stroke="black" d="M4046.78,-1528.53C4035.98,-1518.35 4024.79,-1507.79 4014.39,-1497.99"/>
<polygon fill="black" stroke="black" points="4016.66,-1495.31 4006.98,-1491 4011.86,-1500.41 4016.66,-1495.31"/>
</g>
<!-- send_kv_2_1 -->
<g id="node65" class="node">
<title>send_kv_2_1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="4235" cy="-1455.12" rx="123.99" ry="37.45"/>
<text text-anchor="middle" x="4235" y="-1466.42" font-family="Times,serif" font-size="14.00">Send K,V to GPU3</text>
<text text-anchor="middle" x="4235" y="-1451.42" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="4235" y="-1436.42" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- split_qkv_2&#45;&gt;send_kv_2_1 -->
<g id="edge67" class="edge">
<title>split_qkv_2&#45;&gt;send_kv_2_1</title>
<path fill="none" stroke="black" d="M4157.63,-1528.53C4168.52,-1518.35 4179.8,-1507.79 4190.27,-1497.99"/>
<polygon fill="black" stroke="black" points="4192.83,-1500.39 4197.74,-1491 4188.04,-1495.28 4192.83,-1500.39"/>
</g>
<!-- send_kv_2_2 -->
<g id="node69" class="node">
<title>send_kv_2_2</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="4500" cy="-1455.12" rx="123.99" ry="37.45"/>
<text text-anchor="middle" x="4500" y="-1466.42" font-family="Times,serif" font-size="14.00">Send K,V to GPU3</text>
<text text-anchor="middle" x="4500" y="-1451.42" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="4500" y="-1436.42" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- split_qkv_2&#45;&gt;send_kv_2_2 -->
<g id="edge71" class="edge">
<title>split_qkv_2&#45;&gt;send_kv_2_2</title>
<path fill="none" stroke="black" d="M4219.8,-1543.76C4279.05,-1525.23 4349.89,-1503.07 4405.51,-1485.67"/>
<polygon fill="black" stroke="black" points="4406.86,-1488.92 4415.36,-1482.59 4404.78,-1482.24 4406.86,-1488.92"/>
</g>
<!-- send_kv_2_3 -->
<g id="node73" class="node">
<title>send_kv_2_3</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="4765" cy="-1455.12" rx="123.99" ry="37.45"/>
<text text-anchor="middle" x="4765" y="-1466.42" font-family="Times,serif" font-size="14.00">Send K,V to GPU3</text>
<text text-anchor="middle" x="4765" y="-1451.42" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="4765" y="-1436.42" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- split_qkv_2&#45;&gt;send_kv_2_3 -->
<g id="edge75" class="edge">
<title>split_qkv_2&#45;&gt;send_kv_2_3</title>
<path fill="none" stroke="black" d="M4233.12,-1562.8C4341.04,-1547.21 4497.71,-1522.42 4633,-1492.6 4644.25,-1490.12 4655.96,-1487.27 4667.57,-1484.29"/>
<polygon fill="black" stroke="black" points="4668.49,-1487.67 4677.28,-1481.75 4666.72,-1480.89 4668.49,-1487.67"/>
</g>
<!-- accum_2_0 -->
<g id="node62" class="node">
<title>accum_2_0</title>
<polygon fill="lightgray" stroke="black" points="3495.5,-1370.67 3358.5,-1370.67 3358.5,-1317.67 3495.5,-1317.67 3495.5,-1370.67"/>
<text text-anchor="middle" x="3427" y="-1355.47" font-family="Times,serif" font-size="14.00">Initialize Output</text>
<text text-anchor="middle" x="3427" y="-1340.47" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="3427" y="-1325.47" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- attn_stage_2_0&#45;&gt;accum_2_0 -->
<g id="edge65" class="edge">
<title>attn_stage_2_0&#45;&gt;accum_2_0</title>
<path fill="none" stroke="black" d="M3427,-1420.84C3427,-1408.33 3427,-1394.04 3427,-1381.28"/>
<polygon fill="black" stroke="black" points="3430.5,-1380.99 3427,-1370.99 3423.5,-1380.99 3430.5,-1380.99"/>
</g>
<!-- accum_2_1 -->
<g id="node66" class="node">
<title>accum_2_1</title>
<polygon fill="lightgray" stroke="black" points="3644,-1259.72 3476,-1259.72 3476,-1206.72 3644,-1206.72 3644,-1259.72"/>
<text text-anchor="middle" x="3560" y="-1244.52" font-family="Times,serif" font-size="14.00">Accumulate Output 1</text>
<text text-anchor="middle" x="3560" y="-1229.52" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="3560" y="-1214.52" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- accum_2_0&#45;&gt;accum_2_1 -->
<g id="edge68" class="edge">
<title>accum_2_0&#45;&gt;accum_2_1</title>
<path fill="none" stroke="black" d="M3458.18,-1317.63C3476.81,-1302.37 3500.64,-1282.85 3520.56,-1266.52"/>
<polygon fill="black" stroke="black" points="3523.03,-1269.02 3528.55,-1259.98 3518.6,-1263.61 3523.03,-1269.02"/>
</g>
<!-- attn_stage_2_1 -->
<g id="node63" class="node">
<title>attn_stage_2_1</title>
<polygon fill="orange" stroke="black" points="3756,-1378.17 3514,-1378.17 3514,-1310.17 3756,-1310.17 3756,-1378.17"/>
<text text-anchor="middle" x="3635" y="-1362.97" font-family="Times,serif" font-size="14.00">Ring Attention Stage 1</text>
<text text-anchor="middle" x="3635" y="-1347.97" font-family="Times,serif" font-size="14.00">Q2 × K1 × V1</text>
<text text-anchor="middle" x="3635" y="-1332.97" font-family="Times,serif" font-size="14.00">(B, L/4, L/4) × (B, L/4, d_model)</text>
<text text-anchor="middle" x="3635" y="-1317.97" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- attn_stage_2_1&#45;&gt;accum_2_1 -->
<g id="edge69" class="edge">
<title>attn_stage_2_1&#45;&gt;accum_2_1</title>
<path fill="none" stroke="black" d="M3612.09,-1309.89C3603.04,-1296.75 3592.66,-1281.66 3583.55,-1268.42"/>
<polygon fill="black" stroke="black" points="3586.33,-1266.29 3577.77,-1260.04 3580.56,-1270.26 3586.33,-1266.29"/>
</g>
<!-- recv_kv_2_1 -->
<g id="node64" class="node">
<title>recv_kv_2_1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="3697" cy="-1455.12" rx="130.63" ry="37.45"/>
<text text-anchor="middle" x="3697" y="-1466.42" font-family="Times,serif" font-size="14.00">Receive K,V from GPU1</text>
<text text-anchor="middle" x="3697" y="-1451.42" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="3697" y="-1436.42" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- recv_kv_2_1&#45;&gt;attn_stage_2_1 -->
<g id="edge66" class="edge">
<title>recv_kv_2_1&#45;&gt;attn_stage_2_1</title>
<path fill="none" stroke="black" d="M3676.35,-1417.84C3670.74,-1407.98 3664.62,-1397.22 3658.84,-1387.07"/>
<polygon fill="black" stroke="black" points="3661.87,-1385.31 3653.88,-1378.35 3655.79,-1388.77 3661.87,-1385.31"/>
</g>
<!-- accum_2_2 -->
<g id="node70" class="node">
<title>accum_2_2</title>
<polygon fill="lightgray" stroke="black" points="3756,-1152.24 3588,-1152.24 3588,-1099.24 3756,-1099.24 3756,-1152.24"/>
<text text-anchor="middle" x="3672" y="-1137.04" font-family="Times,serif" font-size="14.00">Accumulate Output 2</text>
<text text-anchor="middle" x="3672" y="-1122.04" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="3672" y="-1107.04" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- accum_2_1&#45;&gt;accum_2_2 -->
<g id="edge72" class="edge">
<title>accum_2_1&#45;&gt;accum_2_2</title>
<path fill="none" stroke="black" d="M3587.11,-1206.68C3602.13,-1192.54 3620.97,-1174.79 3637.09,-1159.62"/>
<polygon fill="black" stroke="black" points="3639.87,-1161.81 3644.75,-1152.4 3635.07,-1156.71 3639.87,-1161.81"/>
</g>
<!-- attn_stage_2_2 -->
<g id="node67" class="node">
<title>attn_stage_2_2</title>
<polygon fill="orange" stroke="black" points="3904,-1267.22 3662,-1267.22 3662,-1199.22 3904,-1199.22 3904,-1267.22"/>
<text text-anchor="middle" x="3783" y="-1252.02" font-family="Times,serif" font-size="14.00">Ring Attention Stage 2</text>
<text text-anchor="middle" x="3783" y="-1237.02" font-family="Times,serif" font-size="14.00">Q2 × K0 × V0</text>
<text text-anchor="middle" x="3783" y="-1222.02" font-family="Times,serif" font-size="14.00">(B, L/4, L/4) × (B, L/4, d_model)</text>
<text text-anchor="middle" x="3783" y="-1207.02" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- attn_stage_2_2&#45;&gt;accum_2_2 -->
<g id="edge73" class="edge">
<title>attn_stage_2_2&#45;&gt;accum_2_2</title>
<path fill="none" stroke="black" d="M3748.18,-1199.13C3734.9,-1186.51 3719.76,-1172.13 3706.51,-1159.53"/>
<polygon fill="black" stroke="black" points="3708.6,-1156.69 3698.94,-1152.34 3703.78,-1161.77 3708.6,-1156.69"/>
</g>
<!-- recv_kv_2_2 -->
<g id="node68" class="node">
<title>recv_kv_2_2</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="3905" cy="-1344.17" rx="130.63" ry="37.45"/>
<text text-anchor="middle" x="3905" y="-1355.47" font-family="Times,serif" font-size="14.00">Receive K,V from GPU1</text>
<text text-anchor="middle" x="3905" y="-1340.47" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="3905" y="-1325.47" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- recv_kv_2_2&#45;&gt;attn_stage_2_2 -->
<g id="edge70" class="edge">
<title>recv_kv_2_2&#45;&gt;attn_stage_2_2</title>
<path fill="none" stroke="black" d="M3865.73,-1308.1C3853.61,-1297.28 3840.18,-1285.29 3827.73,-1274.16"/>
<polygon fill="black" stroke="black" points="3829.91,-1271.42 3820.12,-1267.37 3825.25,-1276.64 3829.91,-1271.42"/>
</g>
<!-- accum_2_3 -->
<g id="node74" class="node">
<title>accum_2_3</title>
<polygon fill="lightgray" stroke="black" points="3756,-1055.74 3588,-1055.74 3588,-1002.74 3756,-1002.74 3756,-1055.74"/>
<text text-anchor="middle" x="3672" y="-1040.54" font-family="Times,serif" font-size="14.00">Accumulate Output 3</text>
<text text-anchor="middle" x="3672" y="-1025.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="3672" y="-1010.54" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- accum_2_2&#45;&gt;accum_2_3 -->
<g id="edge76" class="edge">
<title>accum_2_2&#45;&gt;accum_2_3</title>
<path fill="none" stroke="black" d="M3672,-1098.92C3672,-1088.81 3672,-1077.05 3672,-1066.14"/>
<polygon fill="black" stroke="black" points="3675.5,-1066.03 3672,-1056.03 3668.5,-1066.03 3675.5,-1066.03"/>
</g>
<!-- attn_stage_2_3 -->
<g id="node71" class="node">
<title>attn_stage_2_3</title>
<polygon fill="orange" stroke="black" points="4095,-1159.74 3853,-1159.74 3853,-1091.74 4095,-1091.74 4095,-1159.74"/>
<text text-anchor="middle" x="3974" y="-1144.54" font-family="Times,serif" font-size="14.00">Ring Attention Stage 3</text>
<text text-anchor="middle" x="3974" y="-1129.54" font-family="Times,serif" font-size="14.00">Q2 × K3 × V3</text>
<text text-anchor="middle" x="3974" y="-1114.54" font-family="Times,serif" font-size="14.00">(B, L/4, L/4) × (B, L/4, d_model)</text>
<text text-anchor="middle" x="3974" y="-1099.54" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- attn_stage_2_3&#45;&gt;accum_2_3 -->
<g id="edge77" class="edge">
<title>attn_stage_2_3&#45;&gt;accum_2_3</title>
<path fill="none" stroke="black" d="M3868.38,-1091.69C3834.16,-1080.98 3796.52,-1069.2 3763.43,-1058.85"/>
<polygon fill="black" stroke="black" points="3764.36,-1055.47 3753.77,-1055.83 3762.27,-1062.15 3764.36,-1055.47"/>
</g>
<!-- recv_kv_2_3 -->
<g id="node72" class="node">
<title>recv_kv_2_3</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="4053" cy="-1233.22" rx="130.63" ry="37.45"/>
<text text-anchor="middle" x="4053" y="-1244.52" font-family="Times,serif" font-size="14.00">Receive K,V from GPU1</text>
<text text-anchor="middle" x="4053" y="-1229.52" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="4053" y="-1214.52" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- recv_kv_2_3&#45;&gt;attn_stage_2_3 -->
<g id="edge74" class="edge">
<title>recv_kv_2_3&#45;&gt;attn_stage_2_3</title>
<path fill="none" stroke="black" d="M4026.25,-1196.51C4019.4,-1187.35 4011.97,-1177.44 4004.92,-1168.03"/>
<polygon fill="black" stroke="black" points="4007.65,-1165.83 3998.85,-1159.92 4002.05,-1170.03 4007.65,-1165.83"/>
</g>
<!-- output_proj_2 -->
<g id="node75" class="node">
<title>output_proj_2</title>
<polygon fill="lightblue" stroke="black" points="3665,-966.74 3381,-966.74 3381,-913.74 3665,-913.74 3665,-966.74"/>
<text text-anchor="middle" x="3523" y="-951.54" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="3523" y="-936.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) &#45;&gt; (B, L/4, d_model)</text>
<text text-anchor="middle" x="3523" y="-921.54" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- accum_2_3&#45;&gt;output_proj_2 -->
<g id="edge78" class="edge">
<title>accum_2_3&#45;&gt;output_proj_2</title>
<path fill="none" stroke="black" d="M3628.1,-1002.61C3611.65,-993 3592.8,-981.99 3575.64,-971.98"/>
<polygon fill="black" stroke="black" points="3577.24,-968.86 3566.84,-966.84 3573.71,-974.9 3577.24,-968.86"/>
</g>
<!-- output_proj_2&#45;&gt;residual_2 -->
<g id="edge80" class="edge">
<title>output_proj_2&#45;&gt;residual_2</title>
<path fill="none" stroke="black" d="M3451.15,-913.73C3421.46,-903.18 3386.96,-890.93 3356.6,-880.15"/>
<polygon fill="black" stroke="black" points="3357.5,-876.76 3346.9,-876.71 3355.15,-883.35 3357.5,-876.76"/>
</g>
<!-- ln1_2 -->
<g id="node77" class="node">
<title>ln1_2</title>
<polygon fill="lightyellow" stroke="black" points="3299.5,-788.74 3162.5,-788.74 3162.5,-735.74 3299.5,-735.74 3299.5,-788.74"/>
<text text-anchor="middle" x="3231" y="-773.54" font-family="Times,serif" font-size="14.00">Layer Norm 1</text>
<text text-anchor="middle" x="3231" y="-758.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="3231" y="-743.54" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- residual_2&#45;&gt;ln1_2 -->
<g id="edge81" class="edge">
<title>residual_2&#45;&gt;ln1_2</title>
<path fill="none" stroke="black" d="M3264.15,-824.61C3259.65,-816.27 3254.58,-806.88 3249.78,-798"/>
<polygon fill="black" stroke="black" points="3252.74,-796.12 3244.91,-788.99 3246.58,-799.45 3252.74,-796.12"/>
</g>
<!-- mlp_col_2 -->
<g id="node78" class="node">
<title>mlp_col_2</title>
<polygon fill="lightcoral" stroke="black" points="3404.5,-699.74 3057.5,-699.74 3057.5,-646.74 3404.5,-646.74 3404.5,-699.74"/>
<text text-anchor="middle" x="3231" y="-684.54" font-family="Times,serif" font-size="14.00">MLP Column Parallel</text>
<text text-anchor="middle" x="3231" y="-669.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) &#45;&gt; (B, L/4, ffn_hidden_size/2)</text>
<text text-anchor="middle" x="3231" y="-654.54" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- ln1_2&#45;&gt;mlp_col_2 -->
<g id="edge82" class="edge">
<title>ln1_2&#45;&gt;mlp_col_2</title>
<path fill="none" stroke="black" d="M3231,-735.61C3231,-727.63 3231,-718.67 3231,-710.12"/>
<polygon fill="black" stroke="black" points="3234.5,-709.99 3231,-699.99 3227.5,-709.99 3234.5,-709.99"/>
</g>
<!-- residual2_2 -->
<g id="node81" class="node">
<title>residual2_2</title>
<polygon fill="pink" stroke="black" points="3098.5,-432.74 2961.5,-432.74 2961.5,-379.74 3098.5,-379.74 3098.5,-432.74"/>
<text text-anchor="middle" x="3030" y="-417.54" font-family="Times,serif" font-size="14.00">Residual Add 2</text>
<text text-anchor="middle" x="3030" y="-402.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="3030" y="-387.54" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- ln1_2&#45;&gt;residual2_2 -->
<g id="edge85" class="edge">
<title>ln1_2&#45;&gt;residual2_2</title>
<path fill="none" stroke="black" d="M3162.23,-756.36C3122.65,-749.68 3075.61,-734.39 3049,-699.74 2990.96,-624.16 3007.66,-502.65 3020.82,-442.84"/>
<polygon fill="black" stroke="black" points="3024.31,-443.28 3023.13,-432.76 3017.48,-441.72 3024.31,-443.28"/>
</g>
<!-- mlp_activation_2 -->
<g id="node79" class="node">
<title>mlp_activation_2</title>
<polygon fill="lightgreen" stroke="black" points="3331,-610.74 3131,-610.74 3131,-557.74 3331,-557.74 3331,-610.74"/>
<text text-anchor="middle" x="3231" y="-595.54" font-family="Times,serif" font-size="14.00">GELU Activation</text>
<text text-anchor="middle" x="3231" y="-580.54" font-family="Times,serif" font-size="14.00">(B, L/4, ffn_hidden_size/2)</text>
<text text-anchor="middle" x="3231" y="-565.54" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- mlp_col_2&#45;&gt;mlp_activation_2 -->
<g id="edge83" class="edge">
<title>mlp_col_2&#45;&gt;mlp_activation_2</title>
<path fill="none" stroke="black" d="M3231,-646.61C3231,-638.63 3231,-629.67 3231,-621.12"/>
<polygon fill="black" stroke="black" points="3234.5,-620.99 3231,-610.99 3227.5,-620.99 3234.5,-620.99"/>
</g>
<!-- mlp_row_2 -->
<g id="node80" class="node">
<title>mlp_row_2</title>
<polygon fill="lightcoral" stroke="black" points="3404.5,-521.74 3057.5,-521.74 3057.5,-468.74 3404.5,-468.74 3404.5,-521.74"/>
<text text-anchor="middle" x="3231" y="-506.54" font-family="Times,serif" font-size="14.00">MLP Row Parallel</text>
<text text-anchor="middle" x="3231" y="-491.54" font-family="Times,serif" font-size="14.00">(B, L/4, ffn_hidden_size/2) &#45;&gt; (B, L/4, d_model)</text>
<text text-anchor="middle" x="3231" y="-476.54" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- mlp_activation_2&#45;&gt;mlp_row_2 -->
<g id="edge84" class="edge">
<title>mlp_activation_2&#45;&gt;mlp_row_2</title>
<path fill="none" stroke="black" d="M3231,-557.61C3231,-549.63 3231,-540.67 3231,-532.12"/>
<polygon fill="black" stroke="black" points="3234.5,-531.99 3231,-521.99 3227.5,-531.99 3234.5,-531.99"/>
</g>
<!-- mlp_row_2&#45;&gt;residual2_2 -->
<g id="edge86" class="edge">
<title>mlp_row_2&#45;&gt;residual2_2</title>
<path fill="none" stroke="black" d="M3172.05,-468.73C3148.94,-458.72 3122.27,-447.18 3098.32,-436.81"/>
<polygon fill="black" stroke="black" points="3099.51,-433.51 3088.95,-432.75 3096.73,-439.94 3099.51,-433.51"/>
</g>
<!-- ln2_2 -->
<g id="node82" class="node">
<title>ln2_2</title>
<polygon fill="lightyellow" stroke="black" points="2997.5,-343.74 2860.5,-343.74 2860.5,-290.74 2997.5,-290.74 2997.5,-343.74"/>
<text text-anchor="middle" x="2929" y="-328.54" font-family="Times,serif" font-size="14.00">Layer Norm 2</text>
<text text-anchor="middle" x="2929" y="-313.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="2929" y="-298.54" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- residual2_2&#45;&gt;ln2_2 -->
<g id="edge87" class="edge">
<title>residual2_2&#45;&gt;ln2_2</title>
<path fill="none" stroke="black" d="M3000.24,-379.61C2989.75,-370.57 2977.82,-360.29 2966.76,-350.77"/>
<polygon fill="black" stroke="black" points="2968.75,-347.86 2958.89,-343.99 2964.19,-353.17 2968.75,-347.86"/>
</g>
<!-- output_seg_2 -->
<g id="node83" class="node">
<title>output_seg_2</title>
<polygon fill="lightcyan" stroke="black" points="2999.5,-254.74 2850.5,-254.74 2850.5,-201.74 2999.5,-201.74 2999.5,-254.74"/>
<text text-anchor="middle" x="2925" y="-239.54" font-family="Times,serif" font-size="14.00">Output Segment 2</text>
<text text-anchor="middle" x="2925" y="-224.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="2925" y="-209.54" font-family="Times,serif" font-size="14.00">GPU_2</text>
</g>
<!-- ln2_2&#45;&gt;output_seg_2 -->
<g id="edge88" class="edge">
<title>ln2_2&#45;&gt;output_seg_2</title>
<path fill="none" stroke="black" d="M2927.82,-290.61C2927.45,-282.63 2927.04,-273.67 2926.65,-265.12"/>
<polygon fill="black" stroke="black" points="2930.14,-264.82 2926.18,-254.99 2923.15,-265.14 2930.14,-264.82"/>
</g>
<!-- output_seg_2&#45;&gt;gather -->
<g id="edge120" class="edge">
<title>output_seg_2&#45;&gt;gather</title>
<path fill="none" stroke="black" d="M2881.3,-201.62C2865.34,-192.26 2846.84,-181.41 2829.07,-170.99"/>
<polygon fill="black" stroke="black" points="2830.81,-167.96 2820.41,-165.92 2827.27,-174 2830.81,-167.96"/>
</g>
<!-- qkv_proj_3 -->
<g id="node85" class="node">
<title>qkv_proj_3</title>
<polygon fill="lightblue" stroke="black" points="5503.5,-1723.6 5204.5,-1723.6 5204.5,-1670.6 5503.5,-1670.6 5503.5,-1723.6"/>
<text text-anchor="middle" x="5354" y="-1708.4" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5354" y="-1693.4" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) &#45;&gt; (B, L/4, 3*d_model)</text>
<text text-anchor="middle" x="5354" y="-1678.4" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- input_3&#45;&gt;qkv_proj_3 -->
<g id="edge90" class="edge">
<title>input_3&#45;&gt;qkv_proj_3</title>
<path fill="none" stroke="black" d="M4985.76,-1771.41C5047.18,-1759.18 5139.01,-1740.9 5215.61,-1725.65"/>
<polygon fill="black" stroke="black" points="5216.7,-1729 5225.83,-1723.62 5215.33,-1722.14 5216.7,-1729"/>
</g>
<!-- residual_3 -->
<g id="node103" class="node">
<title>residual_3</title>
<polygon fill="pink" stroke="black" points="4985.5,-877.74 4848.5,-877.74 4848.5,-824.74 4985.5,-824.74 4985.5,-877.74"/>
<text text-anchor="middle" x="4917" y="-862.54" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="4917" y="-847.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="4917" y="-832.54" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- input_3&#45;&gt;residual_3 -->
<g id="edge108" class="edge">
<title>input_3&#45;&gt;residual_3</title>
<path fill="none" stroke="black" d="M4917,-1759.53C4917,-1721.11 4917,-1646.23 4917,-1582.6 4917,-1582.6 4917,-1582.6 4917,-1028.24 4917,-979.78 4917,-923.82 4917,-888.24"/>
<polygon fill="black" stroke="black" points="4920.5,-887.89 4917,-877.89 4913.5,-887.89 4920.5,-887.89"/>
</g>
<!-- split_qkv_3 -->
<g id="node86" class="node">
<title>split_qkv_3</title>
<polygon fill="yellow" stroke="black" points="5926.36,-1634.6 5637.85,-1634.6 5563.64,-1528.6 5852.15,-1528.6 5926.36,-1634.6"/>
<text text-anchor="middle" x="5745" y="-1592.9" font-family="Times,serif" font-size="14.00">Split QKV</text>
<text text-anchor="middle" x="5745" y="-1577.9" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="5745" y="-1562.9" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- qkv_proj_3&#45;&gt;split_qkv_3 -->
<g id="edge91" class="edge">
<title>qkv_proj_3&#45;&gt;split_qkv_3</title>
<path fill="none" stroke="black" d="M5442.24,-1670.49C5493.44,-1655.62 5558.87,-1636.63 5615.79,-1620.11"/>
<polygon fill="black" stroke="black" points="5616.95,-1623.41 5625.58,-1617.26 5615,-1616.69 5616.95,-1623.41"/>
</g>
<!-- attn_stage_3_0 -->
<g id="node87" class="node">
<title>attn_stage_3_0</title>
<polygon fill="orange" stroke="black" points="5998,-1489.12 5756,-1489.12 5756,-1421.12 5998,-1421.12 5998,-1489.12"/>
<text text-anchor="middle" x="5877" y="-1473.92" font-family="Times,serif" font-size="14.00">Ring Attention Stage 0</text>
<text text-anchor="middle" x="5877" y="-1458.92" font-family="Times,serif" font-size="14.00">Q3 × K3 × V3</text>
<text text-anchor="middle" x="5877" y="-1443.92" font-family="Times,serif" font-size="14.00">(B, L/4, L/4) × (B, L/4, d_model)</text>
<text text-anchor="middle" x="5877" y="-1428.92" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- split_qkv_3&#45;&gt;attn_stage_3_0 -->
<g id="edge92" class="edge">
<title>split_qkv_3&#45;&gt;attn_stage_3_0</title>
<path fill="none" stroke="black" d="M5800.22,-1528.53C5811.7,-1517.71 5823.62,-1506.46 5834.56,-1496.15"/>
<polygon fill="black" stroke="black" points="5837.08,-1498.58 5841.95,-1489.17 5832.27,-1493.49 5837.08,-1498.58"/>
</g>
<!-- send_kv_3_0 -->
<g id="node88" class="node">
<title>send_kv_3_0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="6140" cy="-1455.12" rx="123.99" ry="37.45"/>
<text text-anchor="middle" x="6140" y="-1466.42" font-family="Times,serif" font-size="14.00">Send K,V to GPU0</text>
<text text-anchor="middle" x="6140" y="-1451.42" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="6140" y="-1436.42" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- split_qkv_3&#45;&gt;send_kv_3_0 -->
<g id="edge93" class="edge">
<title>split_qkv_3&#45;&gt;send_kv_3_0</title>
<path fill="none" stroke="black" d="M5862.71,-1543.51C5921.27,-1525.05 5991.07,-1503.05 6046,-1485.75"/>
<polygon fill="black" stroke="black" points="6047.24,-1489.03 6055.72,-1482.68 6045.13,-1482.35 6047.24,-1489.03"/>
</g>
<!-- send_kv_3_1 -->
<g id="node92" class="node">
<title>send_kv_3_1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="6405" cy="-1455.12" rx="123.99" ry="37.45"/>
<text text-anchor="middle" x="6405" y="-1466.42" font-family="Times,serif" font-size="14.00">Send K,V to GPU0</text>
<text text-anchor="middle" x="6405" y="-1451.42" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="6405" y="-1436.42" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- split_qkv_3&#45;&gt;send_kv_3_1 -->
<g id="edge96" class="edge">
<title>split_qkv_3&#45;&gt;send_kv_3_1</title>
<path fill="none" stroke="black" d="M5876.19,-1562.63C5983.47,-1547 6138.81,-1522.24 6273,-1492.6 6284.25,-1490.12 6295.96,-1487.27 6307.57,-1484.28"/>
<polygon fill="black" stroke="black" points="6308.49,-1487.66 6317.28,-1481.74 6306.72,-1480.88 6308.49,-1487.66"/>
</g>
<!-- send_kv_3_2 -->
<g id="node96" class="node">
<title>send_kv_3_2</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="5349" cy="-1455.12" rx="123.99" ry="37.45"/>
<text text-anchor="middle" x="5349" y="-1466.42" font-family="Times,serif" font-size="14.00">Send K,V to GPU0</text>
<text text-anchor="middle" x="5349" y="-1451.42" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="5349" y="-1436.42" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- split_qkv_3&#45;&gt;send_kv_3_2 -->
<g id="edge100" class="edge">
<title>split_qkv_3&#45;&gt;send_kv_3_2</title>
<path fill="none" stroke="black" d="M5579.35,-1528.53C5532.75,-1513.88 5483.7,-1498.46 5442.89,-1485.64"/>
<polygon fill="black" stroke="black" points="5443.82,-1482.26 5433.24,-1482.6 5441.73,-1488.94 5443.82,-1482.26"/>
</g>
<!-- send_kv_3_3 -->
<g id="node100" class="node">
<title>send_kv_3_3</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="5614" cy="-1455.12" rx="123.99" ry="37.45"/>
<text text-anchor="middle" x="5614" y="-1466.42" font-family="Times,serif" font-size="14.00">Send K,V to GPU0</text>
<text text-anchor="middle" x="5614" y="-1451.42" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="5614" y="-1436.42" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- split_qkv_3&#45;&gt;send_kv_3_3 -->
<g id="edge104" class="edge">
<title>split_qkv_3&#45;&gt;send_kv_3_3</title>
<path fill="none" stroke="black" d="M5690.2,-1528.53C5679.48,-1518.35 5668.37,-1507.79 5658.06,-1497.99"/>
<polygon fill="black" stroke="black" points="5660.36,-1495.35 5650.7,-1491 5655.54,-1500.42 5660.36,-1495.35"/>
</g>
<!-- accum_3_0 -->
<g id="node89" class="node">
<title>accum_3_0</title>
<polygon fill="lightgray" stroke="black" points="5352.5,-1370.67 5215.5,-1370.67 5215.5,-1317.67 5352.5,-1317.67 5352.5,-1370.67"/>
<text text-anchor="middle" x="5284" y="-1355.47" font-family="Times,serif" font-size="14.00">Initialize Output</text>
<text text-anchor="middle" x="5284" y="-1340.47" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="5284" y="-1325.47" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- attn_stage_3_0&#45;&gt;accum_3_0 -->
<g id="edge94" class="edge">
<title>attn_stage_3_0&#45;&gt;accum_3_0</title>
<path fill="none" stroke="black" d="M5763.84,-1421.07C5758.17,-1419.83 5752.53,-1418.67 5747,-1417.65 5577.59,-1386.24 5527.16,-1427.22 5361,-1381.65 5354.39,-1379.83 5347.64,-1377.48 5341.03,-1374.84"/>
<polygon fill="black" stroke="black" points="5342.05,-1371.47 5331.48,-1370.8 5339.33,-1377.92 5342.05,-1371.47"/>
</g>
<!-- accum_3_1 -->
<g id="node93" class="node">
<title>accum_3_1</title>
<polygon fill="lightgray" stroke="black" points="5287,-1259.72 5119,-1259.72 5119,-1206.72 5287,-1206.72 5287,-1259.72"/>
<text text-anchor="middle" x="5203" y="-1244.52" font-family="Times,serif" font-size="14.00">Accumulate Output 1</text>
<text text-anchor="middle" x="5203" y="-1229.52" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="5203" y="-1214.52" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- accum_3_0&#45;&gt;accum_3_1 -->
<g id="edge97" class="edge">
<title>accum_3_0&#45;&gt;accum_3_1</title>
<path fill="none" stroke="black" d="M5265.01,-1317.63C5254.02,-1302.84 5240.05,-1284.06 5228.16,-1268.06"/>
<polygon fill="black" stroke="black" points="5230.93,-1265.92 5222.15,-1259.98 5225.31,-1270.09 5230.93,-1265.92"/>
</g>
<!-- attn_stage_3_1 -->
<g id="node90" class="node">
<title>attn_stage_3_1</title>
<polygon fill="orange" stroke="black" points="5197,-1378.17 4955,-1378.17 4955,-1310.17 5197,-1310.17 5197,-1378.17"/>
<text text-anchor="middle" x="5076" y="-1362.97" font-family="Times,serif" font-size="14.00">Ring Attention Stage 1</text>
<text text-anchor="middle" x="5076" y="-1347.97" font-family="Times,serif" font-size="14.00">Q3 × K2 × V2</text>
<text text-anchor="middle" x="5076" y="-1332.97" font-family="Times,serif" font-size="14.00">(B, L/4, L/4) × (B, L/4, d_model)</text>
<text text-anchor="middle" x="5076" y="-1317.97" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- attn_stage_3_1&#45;&gt;accum_3_1 -->
<g id="edge98" class="edge">
<title>attn_stage_3_1&#45;&gt;accum_3_1</title>
<path fill="none" stroke="black" d="M5114.79,-1309.89C5130.7,-1296.25 5149.05,-1280.5 5164.88,-1266.92"/>
<polygon fill="black" stroke="black" points="5167.59,-1269.2 5172.9,-1260.04 5163.03,-1263.89 5167.59,-1269.2"/>
</g>
<!-- recv_kv_3_1 -->
<g id="node91" class="node">
<title>recv_kv_3_1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="5076" cy="-1455.12" rx="130.63" ry="37.45"/>
<text text-anchor="middle" x="5076" y="-1466.42" font-family="Times,serif" font-size="14.00">Receive K,V from GPU2</text>
<text text-anchor="middle" x="5076" y="-1451.42" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="5076" y="-1436.42" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- recv_kv_3_1&#45;&gt;attn_stage_3_1 -->
<g id="edge95" class="edge">
<title>recv_kv_3_1&#45;&gt;attn_stage_3_1</title>
<path fill="none" stroke="black" d="M5076,-1417.54C5076,-1408.19 5076,-1398.04 5076,-1388.39"/>
<polygon fill="black" stroke="black" points="5079.5,-1388.17 5076,-1378.18 5072.5,-1388.18 5079.5,-1388.17"/>
</g>
<!-- accum_3_2 -->
<g id="node97" class="node">
<title>accum_3_2</title>
<polygon fill="lightgray" stroke="black" points="5340,-1152.24 5172,-1152.24 5172,-1099.24 5340,-1099.24 5340,-1152.24"/>
<text text-anchor="middle" x="5256" y="-1137.04" font-family="Times,serif" font-size="14.00">Accumulate Output 2</text>
<text text-anchor="middle" x="5256" y="-1122.04" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="5256" y="-1107.04" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- accum_3_1&#45;&gt;accum_3_2 -->
<g id="edge101" class="edge">
<title>accum_3_1&#45;&gt;accum_3_2</title>
<path fill="none" stroke="black" d="M5215.83,-1206.68C5222.62,-1193.18 5231.05,-1176.4 5238.43,-1161.7"/>
<polygon fill="black" stroke="black" points="5241.74,-1162.91 5243.1,-1152.4 5235.49,-1159.77 5241.74,-1162.91"/>
</g>
<!-- attn_stage_3_2 -->
<g id="node94" class="node">
<title>attn_stage_3_2</title>
<polygon fill="orange" stroke="black" points="5547,-1267.22 5305,-1267.22 5305,-1199.22 5547,-1199.22 5547,-1267.22"/>
<text text-anchor="middle" x="5426" y="-1252.02" font-family="Times,serif" font-size="14.00">Ring Attention Stage 2</text>
<text text-anchor="middle" x="5426" y="-1237.02" font-family="Times,serif" font-size="14.00">Q3 × K1 × V1</text>
<text text-anchor="middle" x="5426" y="-1222.02" font-family="Times,serif" font-size="14.00">(B, L/4, L/4) × (B, L/4, d_model)</text>
<text text-anchor="middle" x="5426" y="-1207.02" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- attn_stage_3_2&#45;&gt;accum_3_2 -->
<g id="edge102" class="edge">
<title>attn_stage_3_2&#45;&gt;accum_3_2</title>
<path fill="none" stroke="black" d="M5372.68,-1199.13C5351.38,-1185.92 5326.98,-1170.78 5306.02,-1157.77"/>
<polygon fill="black" stroke="black" points="5307.61,-1154.64 5297.27,-1152.34 5303.92,-1160.59 5307.61,-1154.64"/>
</g>
<!-- recv_kv_3_2 -->
<g id="node95" class="node">
<title>recv_kv_3_2</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="5501" cy="-1344.17" rx="130.63" ry="37.45"/>
<text text-anchor="middle" x="5501" y="-1355.47" font-family="Times,serif" font-size="14.00">Receive K,V from GPU2</text>
<text text-anchor="middle" x="5501" y="-1340.47" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="5501" y="-1325.47" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- recv_kv_3_2&#45;&gt;attn_stage_3_2 -->
<g id="edge99" class="edge">
<title>recv_kv_3_2&#45;&gt;attn_stage_3_2</title>
<path fill="none" stroke="black" d="M5476.23,-1307.19C5469.37,-1297.22 5461.85,-1286.3 5454.78,-1276.02"/>
<polygon fill="black" stroke="black" points="5457.52,-1273.83 5448.96,-1267.58 5451.75,-1277.8 5457.52,-1273.83"/>
</g>
<!-- accum_3_3 -->
<g id="node101" class="node">
<title>accum_3_3</title>
<polygon fill="lightgray" stroke="black" points="5340,-1055.74 5172,-1055.74 5172,-1002.74 5340,-1002.74 5340,-1055.74"/>
<text text-anchor="middle" x="5256" y="-1040.54" font-family="Times,serif" font-size="14.00">Accumulate Output 3</text>
<text text-anchor="middle" x="5256" y="-1025.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="5256" y="-1010.54" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- accum_3_2&#45;&gt;accum_3_3 -->
<g id="edge105" class="edge">
<title>accum_3_2&#45;&gt;accum_3_3</title>
<path fill="none" stroke="black" d="M5256,-1098.92C5256,-1088.81 5256,-1077.05 5256,-1066.14"/>
<polygon fill="black" stroke="black" points="5259.5,-1066.03 5256,-1056.03 5252.5,-1066.03 5259.5,-1066.03"/>
</g>
<!-- attn_stage_3_3 -->
<g id="node98" class="node">
<title>attn_stage_3_3</title>
<polygon fill="orange" stroke="black" points="5735,-1159.74 5493,-1159.74 5493,-1091.74 5735,-1091.74 5735,-1159.74"/>
<text text-anchor="middle" x="5614" y="-1144.54" font-family="Times,serif" font-size="14.00">Ring Attention Stage 3</text>
<text text-anchor="middle" x="5614" y="-1129.54" font-family="Times,serif" font-size="14.00">Q3 × K0 × V0</text>
<text text-anchor="middle" x="5614" y="-1114.54" font-family="Times,serif" font-size="14.00">(B, L/4, L/4) × (B, L/4, d_model)</text>
<text text-anchor="middle" x="5614" y="-1099.54" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- attn_stage_3_3&#45;&gt;accum_3_3 -->
<g id="edge106" class="edge">
<title>attn_stage_3_3&#45;&gt;accum_3_3</title>
<path fill="none" stroke="black" d="M5492.8,-1092.75C5446.12,-1080.43 5393.57,-1066.56 5349.86,-1055.02"/>
<polygon fill="black" stroke="black" points="5350.66,-1051.61 5340.1,-1052.44 5348.87,-1058.38 5350.66,-1051.61"/>
</g>
<!-- recv_kv_3_3 -->
<g id="node99" class="node">
<title>recv_kv_3_3</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="5696" cy="-1233.22" rx="130.63" ry="37.45"/>
<text text-anchor="middle" x="5696" y="-1244.52" font-family="Times,serif" font-size="14.00">Receive K,V from GPU2</text>
<text text-anchor="middle" x="5696" y="-1229.52" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) each</text>
<text text-anchor="middle" x="5696" y="-1214.52" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- recv_kv_3_3&#45;&gt;attn_stage_3_3 -->
<g id="edge103" class="edge">
<title>recv_kv_3_3&#45;&gt;attn_stage_3_3</title>
<path fill="none" stroke="black" d="M5668.24,-1196.51C5661.12,-1187.35 5653.41,-1177.44 5646.1,-1168.03"/>
<polygon fill="black" stroke="black" points="5648.7,-1165.67 5639.8,-1159.92 5643.17,-1169.97 5648.7,-1165.67"/>
</g>
<!-- output_proj_3 -->
<g id="node102" class="node">
<title>output_proj_3</title>
<polygon fill="lightblue" stroke="black" points="5324,-966.74 5040,-966.74 5040,-913.74 5324,-913.74 5324,-966.74"/>
<text text-anchor="middle" x="5182" y="-951.54" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="5182" y="-936.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) &#45;&gt; (B, L/4, d_model)</text>
<text text-anchor="middle" x="5182" y="-921.54" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- accum_3_3&#45;&gt;output_proj_3 -->
<g id="edge107" class="edge">
<title>accum_3_3&#45;&gt;output_proj_3</title>
<path fill="none" stroke="black" d="M5234.2,-1002.61C5226.81,-993.92 5218.45,-984.09 5210.61,-974.88"/>
<polygon fill="black" stroke="black" points="5213.05,-972.34 5203.9,-966.99 5207.72,-976.87 5213.05,-972.34"/>
</g>
<!-- output_proj_3&#45;&gt;residual_3 -->
<g id="edge109" class="edge">
<title>output_proj_3&#45;&gt;residual_3</title>
<path fill="none" stroke="black" d="M5104.28,-913.73C5069.94,-902.45 5029.64,-889.22 4995.24,-877.93"/>
<polygon fill="black" stroke="black" points="4996.3,-874.59 4985.7,-874.8 4994.11,-881.24 4996.3,-874.59"/>
</g>
<!-- ln1_3 -->
<g id="node104" class="node">
<title>ln1_3</title>
<polygon fill="lightyellow" stroke="black" points="4367.5,-788.74 4230.5,-788.74 4230.5,-735.74 4367.5,-735.74 4367.5,-788.74"/>
<text text-anchor="middle" x="4299" y="-773.54" font-family="Times,serif" font-size="14.00">Layer Norm 1</text>
<text text-anchor="middle" x="4299" y="-758.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="4299" y="-743.54" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- residual_3&#45;&gt;ln1_3 -->
<g id="edge110" class="edge">
<title>residual_3&#45;&gt;ln1_3</title>
<path fill="none" stroke="black" d="M4848.2,-840.56C4732.53,-824.27 4499.78,-791.51 4377.75,-774.33"/>
<polygon fill="black" stroke="black" points="4378.12,-770.84 4367.73,-772.92 4377.14,-777.78 4378.12,-770.84"/>
</g>
<!-- mlp_col_3 -->
<g id="node105" class="node">
<title>mlp_col_3</title>
<polygon fill="lightcoral" stroke="black" points="4472.5,-699.74 4125.5,-699.74 4125.5,-646.74 4472.5,-646.74 4472.5,-699.74"/>
<text text-anchor="middle" x="4299" y="-684.54" font-family="Times,serif" font-size="14.00">MLP Column Parallel</text>
<text text-anchor="middle" x="4299" y="-669.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model) &#45;&gt; (B, L/4, ffn_hidden_size/2)</text>
<text text-anchor="middle" x="4299" y="-654.54" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- ln1_3&#45;&gt;mlp_col_3 -->
<g id="edge111" class="edge">
<title>ln1_3&#45;&gt;mlp_col_3</title>
<path fill="none" stroke="black" d="M4299,-735.61C4299,-727.63 4299,-718.67 4299,-710.12"/>
<polygon fill="black" stroke="black" points="4302.5,-709.99 4299,-699.99 4295.5,-709.99 4302.5,-709.99"/>
</g>
<!-- residual2_3 -->
<g id="node108" class="node">
<title>residual2_3</title>
<polygon fill="pink" stroke="black" points="4166.5,-432.74 4029.5,-432.74 4029.5,-379.74 4166.5,-379.74 4166.5,-432.74"/>
<text text-anchor="middle" x="4098" y="-417.54" font-family="Times,serif" font-size="14.00">Residual Add 2</text>
<text text-anchor="middle" x="4098" y="-402.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="4098" y="-387.54" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- ln1_3&#45;&gt;residual2_3 -->
<g id="edge114" class="edge">
<title>ln1_3&#45;&gt;residual2_3</title>
<path fill="none" stroke="black" d="M4230.23,-756.36C4190.65,-749.68 4143.61,-734.39 4117,-699.74 4058.96,-624.16 4075.66,-502.65 4088.82,-442.84"/>
<polygon fill="black" stroke="black" points="4092.31,-443.28 4091.13,-432.76 4085.48,-441.72 4092.31,-443.28"/>
</g>
<!-- mlp_activation_3 -->
<g id="node106" class="node">
<title>mlp_activation_3</title>
<polygon fill="lightgreen" stroke="black" points="4399,-610.74 4199,-610.74 4199,-557.74 4399,-557.74 4399,-610.74"/>
<text text-anchor="middle" x="4299" y="-595.54" font-family="Times,serif" font-size="14.00">GELU Activation</text>
<text text-anchor="middle" x="4299" y="-580.54" font-family="Times,serif" font-size="14.00">(B, L/4, ffn_hidden_size/2)</text>
<text text-anchor="middle" x="4299" y="-565.54" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- mlp_col_3&#45;&gt;mlp_activation_3 -->
<g id="edge112" class="edge">
<title>mlp_col_3&#45;&gt;mlp_activation_3</title>
<path fill="none" stroke="black" d="M4299,-646.61C4299,-638.63 4299,-629.67 4299,-621.12"/>
<polygon fill="black" stroke="black" points="4302.5,-620.99 4299,-610.99 4295.5,-620.99 4302.5,-620.99"/>
</g>
<!-- mlp_row_3 -->
<g id="node107" class="node">
<title>mlp_row_3</title>
<polygon fill="lightcoral" stroke="black" points="4472.5,-521.74 4125.5,-521.74 4125.5,-468.74 4472.5,-468.74 4472.5,-521.74"/>
<text text-anchor="middle" x="4299" y="-506.54" font-family="Times,serif" font-size="14.00">MLP Row Parallel</text>
<text text-anchor="middle" x="4299" y="-491.54" font-family="Times,serif" font-size="14.00">(B, L/4, ffn_hidden_size/2) &#45;&gt; (B, L/4, d_model)</text>
<text text-anchor="middle" x="4299" y="-476.54" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- mlp_activation_3&#45;&gt;mlp_row_3 -->
<g id="edge113" class="edge">
<title>mlp_activation_3&#45;&gt;mlp_row_3</title>
<path fill="none" stroke="black" d="M4299,-557.61C4299,-549.63 4299,-540.67 4299,-532.12"/>
<polygon fill="black" stroke="black" points="4302.5,-531.99 4299,-521.99 4295.5,-531.99 4302.5,-531.99"/>
</g>
<!-- mlp_row_3&#45;&gt;residual2_3 -->
<g id="edge115" class="edge">
<title>mlp_row_3&#45;&gt;residual2_3</title>
<path fill="none" stroke="black" d="M4240.05,-468.73C4216.94,-458.72 4190.27,-447.18 4166.32,-436.81"/>
<polygon fill="black" stroke="black" points="4167.51,-433.51 4156.95,-432.75 4164.73,-439.94 4167.51,-433.51"/>
</g>
<!-- ln2_3 -->
<g id="node109" class="node">
<title>ln2_3</title>
<polygon fill="lightyellow" stroke="black" points="3915.5,-343.74 3778.5,-343.74 3778.5,-290.74 3915.5,-290.74 3915.5,-343.74"/>
<text text-anchor="middle" x="3847" y="-328.54" font-family="Times,serif" font-size="14.00">Layer Norm 2</text>
<text text-anchor="middle" x="3847" y="-313.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="3847" y="-298.54" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- residual2_3&#45;&gt;ln2_3 -->
<g id="edge116" class="edge">
<title>residual2_3&#45;&gt;ln2_3</title>
<path fill="none" stroke="black" d="M4029.41,-381.47C3997.18,-370.29 3958.59,-356.92 3925.22,-345.35"/>
<polygon fill="black" stroke="black" points="3926.1,-341.95 3915.5,-341.98 3923.81,-348.57 3926.1,-341.95"/>
</g>
<!-- output_seg_3 -->
<g id="node110" class="node">
<title>output_seg_3</title>
<polygon fill="lightcyan" stroke="black" points="3418.5,-254.74 3269.5,-254.74 3269.5,-201.74 3418.5,-201.74 3418.5,-254.74"/>
<text text-anchor="middle" x="3344" y="-239.54" font-family="Times,serif" font-size="14.00">Output Segment 3</text>
<text text-anchor="middle" x="3344" y="-224.54" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
<text text-anchor="middle" x="3344" y="-209.54" font-family="Times,serif" font-size="14.00">GPU_3</text>
</g>
<!-- ln2_3&#45;&gt;output_seg_3 -->
<g id="edge117" class="edge">
<title>ln2_3&#45;&gt;output_seg_3</title>
<path fill="none" stroke="black" d="M3778.38,-304.37C3687.41,-288.64 3526.95,-260.88 3428.59,-243.87"/>
<polygon fill="black" stroke="black" points="3429.13,-240.41 3418.68,-242.16 3427.94,-247.31 3429.13,-240.41"/>
</g>
<!-- output_seg_3&#45;&gt;gather -->
<g id="edge121" class="edge">
<title>output_seg_3&#45;&gt;gather</title>
<path fill="none" stroke="black" d="M3269.36,-214.72C3184.23,-200.43 3042.23,-176.6 2929.29,-157.65"/>
<polygon fill="black" stroke="black" points="2929.59,-154.15 2919.15,-155.95 2928.43,-161.06 2929.59,-154.15"/>
</g>
<!-- output_total -->
<g id="node112" class="node">
<title>output_total</title>
<ellipse fill="lightgreen" stroke="black" cx="2757" cy="-26.87" rx="87.86" ry="26.74"/>
<text text-anchor="middle" x="2757" y="-30.67" font-family="Times,serif" font-size="14.00">Final Output</text>
<text text-anchor="middle" x="2757" y="-15.67" font-family="Times,serif" font-size="14.00">(B, L, d_model)</text>
</g>
<!-- gather&#45;&gt;output_total -->
<g id="edge122" class="edge">
<title>gather&#45;&gt;output_total</title>
<path fill="none" stroke="black" d="M2757,-89.64C2757,-81.24 2757,-72.34 2757,-63.98"/>
<polygon fill="black" stroke="black" points="2760.5,-63.77 2757,-53.77 2753.5,-63.77 2760.5,-63.77"/>
</g>
</g>
</svg>
