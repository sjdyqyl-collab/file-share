<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="50657pt" height="20936pt"
 viewBox="0.00 0.00 50657.00 20936.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 20932)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-20932 50653,-20932 50653,4 -4,4"/>
<text text-anchor="middle" x="25324.5" y="-37.8" font-family="Times,serif" font-size="14.00">MoE Transformer (4L, 8 Experts) &#45; 16 GPUs &#45; Ring Attention + Sequence Parallelism</text>
<text text-anchor="middle" x="25324.5" y="-22.8" font-family="Times,serif" font-size="14.00">Global: B=1024, L=16384, d_model=4096, H=32, E=8 (Top&#45;2)</text>
<text text-anchor="middle" x="25324.5" y="-7.8" font-family="Times,serif" font-size="14.00">Per GPU: L/P=1024, Experts/GPU=1</text>
<g id="clust1" class="cluster">
<title>cluster_gpu_0</title>
<path fill="lightblue" stroke="lightblue" d="M20,-61C20,-61 430,-61 430,-61 436,-61 442,-67 442,-73 442,-73 442,-20908 442,-20908 442,-20914 436,-20920 430,-20920 430,-20920 20,-20920 20,-20920 14,-20920 8,-20914 8,-20908 8,-20908 8,-73 8,-73 8,-67 14,-61 20,-61"/>
<text text-anchor="middle" x="225" y="-20904.8" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_gpu_1</title>
<path fill="lightblue" stroke="lightblue" d="M2856,-61C2856,-61 3266,-61 3266,-61 3272,-61 3278,-67 3278,-73 3278,-73 3278,-20908 3278,-20908 3278,-20914 3272,-20920 3266,-20920 3266,-20920 2856,-20920 2856,-20920 2850,-20920 2844,-20914 2844,-20908 2844,-20908 2844,-73 2844,-73 2844,-67 2850,-61 2856,-61"/>
<text text-anchor="middle" x="3061" y="-20904.8" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<g id="clust11" class="cluster">
<title>cluster_gpu_2</title>
<path fill="lightblue" stroke="lightblue" d="M3443,-61C3443,-61 3853,-61 3853,-61 3859,-61 3865,-67 3865,-73 3865,-73 3865,-20908 3865,-20908 3865,-20914 3859,-20920 3853,-20920 3853,-20920 3443,-20920 3443,-20920 3437,-20920 3431,-20914 3431,-20908 3431,-20908 3431,-73 3431,-73 3431,-67 3437,-61 3443,-61"/>
<text text-anchor="middle" x="3648" y="-20904.8" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<g id="clust16" class="cluster">
<title>cluster_gpu_3</title>
<path fill="lightblue" stroke="lightblue" d="M4030,-61C4030,-61 4440,-61 4440,-61 4446,-61 4452,-67 4452,-73 4452,-73 4452,-20908 4452,-20908 4452,-20914 4446,-20920 4440,-20920 4440,-20920 4030,-20920 4030,-20920 4024,-20920 4018,-20914 4018,-20908 4018,-20908 4018,-73 4018,-73 4018,-67 4024,-61 4030,-61"/>
<text text-anchor="middle" x="4235" y="-20904.8" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<g id="clust21" class="cluster">
<title>cluster_gpu_4</title>
<path fill="lightblue" stroke="lightblue" d="M4617,-61C4617,-61 5027,-61 5027,-61 5033,-61 5039,-67 5039,-73 5039,-73 5039,-20908 5039,-20908 5039,-20914 5033,-20920 5027,-20920 5027,-20920 4617,-20920 4617,-20920 4611,-20920 4605,-20914 4605,-20908 4605,-20908 4605,-73 4605,-73 4605,-67 4611,-61 4617,-61"/>
<text text-anchor="middle" x="4822" y="-20904.8" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<g id="clust26" class="cluster">
<title>cluster_gpu_5</title>
<path fill="lightblue" stroke="lightblue" d="M5204,-61C5204,-61 5614,-61 5614,-61 5620,-61 5626,-67 5626,-73 5626,-73 5626,-20908 5626,-20908 5626,-20914 5620,-20920 5614,-20920 5614,-20920 5204,-20920 5204,-20920 5198,-20920 5192,-20914 5192,-20908 5192,-20908 5192,-73 5192,-73 5192,-67 5198,-61 5204,-61"/>
<text text-anchor="middle" x="5409" y="-20904.8" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<g id="clust31" class="cluster">
<title>cluster_gpu_6</title>
<path fill="lightblue" stroke="lightblue" d="M5791,-61C5791,-61 6201,-61 6201,-61 6207,-61 6213,-67 6213,-73 6213,-73 6213,-20908 6213,-20908 6213,-20914 6207,-20920 6201,-20920 6201,-20920 5791,-20920 5791,-20920 5785,-20920 5779,-20914 5779,-20908 5779,-20908 5779,-73 5779,-73 5779,-67 5785,-61 5791,-61"/>
<text text-anchor="middle" x="5996" y="-20904.8" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<g id="clust36" class="cluster">
<title>cluster_gpu_7</title>
<path fill="lightblue" stroke="lightblue" d="M6378,-61C6378,-61 6788,-61 6788,-61 6794,-61 6800,-67 6800,-73 6800,-73 6800,-20908 6800,-20908 6800,-20914 6794,-20920 6788,-20920 6788,-20920 6378,-20920 6378,-20920 6372,-20920 6366,-20914 6366,-20908 6366,-20908 6366,-73 6366,-73 6366,-67 6372,-61 6378,-61"/>
<text text-anchor="middle" x="6583" y="-20904.8" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<g id="clust41" class="cluster">
<title>cluster_gpu_8</title>
<path fill="lightblue" stroke="lightblue" d="M6965,-61C6965,-61 7375,-61 7375,-61 7381,-61 7387,-67 7387,-73 7387,-73 7387,-20908 7387,-20908 7387,-20914 7381,-20920 7375,-20920 7375,-20920 6965,-20920 6965,-20920 6959,-20920 6953,-20914 6953,-20908 6953,-20908 6953,-73 6953,-73 6953,-67 6959,-61 6965,-61"/>
<text text-anchor="middle" x="7170" y="-20904.8" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<g id="clust46" class="cluster">
<title>cluster_gpu_9</title>
<path fill="lightblue" stroke="lightblue" d="M7552,-61C7552,-61 7962,-61 7962,-61 7968,-61 7974,-67 7974,-73 7974,-73 7974,-20908 7974,-20908 7974,-20914 7968,-20920 7962,-20920 7962,-20920 7552,-20920 7552,-20920 7546,-20920 7540,-20914 7540,-20908 7540,-20908 7540,-73 7540,-73 7540,-67 7546,-61 7552,-61"/>
<text text-anchor="middle" x="7757" y="-20904.8" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<g id="clust51" class="cluster">
<title>cluster_gpu_10</title>
<path fill="lightblue" stroke="lightblue" d="M8139,-61C8139,-61 8549,-61 8549,-61 8555,-61 8561,-67 8561,-73 8561,-73 8561,-20908 8561,-20908 8561,-20914 8555,-20920 8549,-20920 8549,-20920 8139,-20920 8139,-20920 8133,-20920 8127,-20914 8127,-20908 8127,-20908 8127,-73 8127,-73 8127,-67 8133,-61 8139,-61"/>
<text text-anchor="middle" x="8344" y="-20904.8" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<g id="clust56" class="cluster">
<title>cluster_gpu_11</title>
<path fill="lightblue" stroke="lightblue" d="M8726,-61C8726,-61 9136,-61 9136,-61 9142,-61 9148,-67 9148,-73 9148,-73 9148,-20908 9148,-20908 9148,-20914 9142,-20920 9136,-20920 9136,-20920 8726,-20920 8726,-20920 8720,-20920 8714,-20914 8714,-20908 8714,-20908 8714,-73 8714,-73 8714,-67 8720,-61 8726,-61"/>
<text text-anchor="middle" x="8931" y="-20904.8" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<g id="clust61" class="cluster">
<title>cluster_gpu_12</title>
<path fill="lightblue" stroke="lightblue" d="M9313,-61C9313,-61 9723,-61 9723,-61 9729,-61 9735,-67 9735,-73 9735,-73 9735,-20908 9735,-20908 9735,-20914 9729,-20920 9723,-20920 9723,-20920 9313,-20920 9313,-20920 9307,-20920 9301,-20914 9301,-20908 9301,-20908 9301,-73 9301,-73 9301,-67 9307,-61 9313,-61"/>
<text text-anchor="middle" x="9518" y="-20904.8" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<g id="clust66" class="cluster">
<title>cluster_gpu_13</title>
<path fill="lightblue" stroke="lightblue" d="M9900,-61C9900,-61 10310,-61 10310,-61 10316,-61 10322,-67 10322,-73 10322,-73 10322,-20908 10322,-20908 10322,-20914 10316,-20920 10310,-20920 10310,-20920 9900,-20920 9900,-20920 9894,-20920 9888,-20914 9888,-20908 9888,-20908 9888,-73 9888,-73 9888,-67 9894,-61 9900,-61"/>
<text text-anchor="middle" x="10105" y="-20904.8" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<g id="clust71" class="cluster">
<title>cluster_gpu_14</title>
<path fill="lightblue" stroke="lightblue" d="M10487,-61C10487,-61 10897,-61 10897,-61 10903,-61 10909,-67 10909,-73 10909,-73 10909,-20908 10909,-20908 10909,-20914 10903,-20920 10897,-20920 10897,-20920 10487,-20920 10487,-20920 10481,-20920 10475,-20914 10475,-20908 10475,-20908 10475,-73 10475,-73 10475,-67 10481,-61 10487,-61"/>
<text text-anchor="middle" x="10692" y="-20904.8" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<g id="clust76" class="cluster">
<title>cluster_gpu_15</title>
<path fill="lightblue" stroke="lightblue" d="M11074,-61C11074,-61 11484,-61 11484,-61 11490,-61 11496,-67 11496,-73 11496,-73 11496,-20908 11496,-20908 11496,-20914 11490,-20920 11484,-20920 11484,-20920 11074,-20920 11074,-20920 11068,-20920 11062,-20914 11062,-20908 11062,-20908 11062,-73 11062,-73 11062,-67 11068,-61 11074,-61"/>
<text text-anchor="middle" x="11279" y="-20904.8" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- input_0 -->
<g id="node1" class="node">
<title>input_0</title>
<polygon fill="lightgreen" stroke="black" points="318.5,-20866 131.5,-20866 131.5,-20828 318.5,-20828 318.5,-20866"/>
<text text-anchor="middle" x="225" y="-20850.8" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="225" y="-20835.8" font-family="Times,serif" font-size="14.00">X[0]: 1024×1024×4096</text>
</g>
<!-- qkv_proj_0_0 -->
<g id="node2" class="node">
<title>qkv_proj_0_0</title>
<polygon fill="none" stroke="black" points="307.5,-20755 142.5,-20755 142.5,-20702 307.5,-20702 307.5,-20755"/>
<text text-anchor="middle" x="225" y="-20739.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="225" y="-20724.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="225" y="-20709.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- input_0&#45;&gt;qkv_proj_0_0 -->
<g id="edge1" class="edge">
<title>input_0&#45;&gt;qkv_proj_0_0</title>
<path fill="none" stroke="black" d="M225,-20827.96C225,-20827.96 225,-20765.44 225,-20765.44"/>
<polygon fill="black" stroke="black" points="228.5,-20765.44 225,-20755.44 221.5,-20765.44 228.5,-20765.44"/>
</g>
<!-- qkv_reshape_0_0 -->
<g id="node3" class="node">
<title>qkv_reshape_0_0</title>
<ellipse fill="none" stroke="black" cx="225" cy="-20602" rx="148" ry="27"/>
<text text-anchor="middle" x="225" y="-20605.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="225" y="-20590.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_0_0&#45;&gt;qkv_reshape_0_0 -->
<g id="edge2" class="edge">
<title>qkv_proj_0_0&#45;&gt;qkv_reshape_0_0</title>
<path fill="none" stroke="black" d="M225,-20701.98C225,-20701.98 225,-20639.36 225,-20639.36"/>
<polygon fill="black" stroke="black" points="228.5,-20639.36 225,-20629.36 221.5,-20639.36 228.5,-20639.36"/>
</g>
<!-- ring_attn_0_0_stage_0 -->
<g id="node4" class="node">
<title>ring_attn_0_0_stage_0</title>
<polygon fill="yellow" stroke="black" points="225,-20458 16,-20390 225,-20322 434,-20390 225,-20458"/>
<text text-anchor="middle" x="225" y="-20408.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-20393.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="225" y="-20378.8" font-family="Times,serif" font-size="14.00">Q[0]×K[0]×V[0]</text>
<text text-anchor="middle" x="225" y="-20363.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- qkv_reshape_0_0&#45;&gt;ring_attn_0_0_stage_0 -->
<g id="edge3" class="edge">
<title>qkv_reshape_0_0&#45;&gt;ring_attn_0_0_stage_0</title>
<path fill="none" stroke="black" d="M225,-20574.72C225,-20574.72 225,-20468.16 225,-20468.16"/>
<polygon fill="black" stroke="black" points="228.5,-20468.16 225,-20458.16 221.5,-20468.16 228.5,-20468.16"/>
</g>
<!-- ring_attn_0_0_stage_1 -->
<g id="node5" class="node">
<title>ring_attn_0_0_stage_1</title>
<polygon fill="yellow" stroke="black" points="225,-20205 16,-20137 225,-20069 434,-20137 225,-20205"/>
<text text-anchor="middle" x="225" y="-20155.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-20140.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="225" y="-20125.8" font-family="Times,serif" font-size="14.00">Q[0]×K[15]×V[15]</text>
<text text-anchor="middle" x="225" y="-20110.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_0&#45;&gt;ring_attn_0_0_stage_1 -->
<g id="edge4" class="edge">
<title>ring_attn_0_0_stage_0&#45;&gt;ring_attn_0_0_stage_1</title>
<path fill="none" stroke="black" d="M225,-20321.87C225,-20321.87 225,-20215.25 225,-20215.25"/>
<polygon fill="black" stroke="black" points="228.5,-20215.25 225,-20205.25 221.5,-20215.25 228.5,-20215.25"/>
</g>
<!-- ring_attn_0_1_stage_0 -->
<g id="node102" class="node">
<title>ring_attn_0_1_stage_0</title>
<polygon fill="yellow" stroke="black" points="3061,-20458 2852,-20390 3061,-20322 3270,-20390 3061,-20458"/>
<text text-anchor="middle" x="3061" y="-20408.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-20393.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="3061" y="-20378.8" font-family="Times,serif" font-size="14.00">Q[1]×K[1]×V[1]</text>
<text text-anchor="middle" x="3061" y="-20363.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_0&#45;&gt;ring_attn_0_1_stage_0 -->
<g id="edge1553" class="edge">
<title>ring_attn_0_0_stage_0&#45;&gt;ring_attn_0_1_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-20390C434.11,-20390 2841.79,-20390 2841.79,-20390"/>
<polygon fill="red" stroke="red" points="2841.79,-20393.5 2851.79,-20390 2841.79,-20386.5 2841.79,-20393.5"/>
</g>
<!-- ring_attn_0_0_stage_2 -->
<g id="node6" class="node">
<title>ring_attn_0_0_stage_2</title>
<polygon fill="yellow" stroke="black" points="225,-19952 16,-19884 225,-19816 434,-19884 225,-19952"/>
<text text-anchor="middle" x="225" y="-19902.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-19887.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="225" y="-19872.8" font-family="Times,serif" font-size="14.00">Q[0]×K[14]×V[14]</text>
<text text-anchor="middle" x="225" y="-19857.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_1&#45;&gt;ring_attn_0_0_stage_2 -->
<g id="edge5" class="edge">
<title>ring_attn_0_0_stage_1&#45;&gt;ring_attn_0_0_stage_2</title>
<path fill="none" stroke="black" d="M155.33,-20091.48C155.33,-20091.48 155.33,-19939.58 155.33,-19939.58"/>
<polygon fill="black" stroke="black" points="158.83,-19939.58 155.33,-19929.58 151.83,-19939.58 158.83,-19939.58"/>
</g>
<!-- ring_attn_0_1_stage_1 -->
<g id="node103" class="node">
<title>ring_attn_0_1_stage_1</title>
<polygon fill="yellow" stroke="black" points="3061,-20205 2852,-20137 3061,-20069 3270,-20137 3061,-20205"/>
<text text-anchor="middle" x="3061" y="-20155.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-20140.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="3061" y="-20125.8" font-family="Times,serif" font-size="14.00">Q[1]×K[0]×V[0]</text>
<text text-anchor="middle" x="3061" y="-20110.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_1&#45;&gt;ring_attn_0_1_stage_1 -->
<g id="edge1554" class="edge">
<title>ring_attn_0_0_stage_1&#45;&gt;ring_attn_0_1_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-20137C434.11,-20137 2841.79,-20137 2841.79,-20137"/>
<polygon fill="red" stroke="red" points="2841.79,-20140.5 2851.79,-20137 2841.79,-20133.5 2841.79,-20140.5"/>
</g>
<!-- ring_attn_0_0_stage_3 -->
<g id="node7" class="node">
<title>ring_attn_0_0_stage_3</title>
<polygon fill="yellow" stroke="black" points="225,-19699 16,-19631 225,-19563 434,-19631 225,-19699"/>
<text text-anchor="middle" x="225" y="-19649.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-19634.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="225" y="-19619.8" font-family="Times,serif" font-size="14.00">Q[0]×K[13]×V[13]</text>
<text text-anchor="middle" x="225" y="-19604.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_2&#45;&gt;ring_attn_0_0_stage_3 -->
<g id="edge6" class="edge">
<title>ring_attn_0_0_stage_2&#45;&gt;ring_attn_0_0_stage_3</title>
<path fill="none" stroke="black" d="M155.33,-19838.48C155.33,-19838.48 155.33,-19686.58 155.33,-19686.58"/>
<polygon fill="black" stroke="black" points="158.83,-19686.58 155.33,-19676.58 151.83,-19686.58 158.83,-19686.58"/>
</g>
<!-- ring_attn_0_1_stage_2 -->
<g id="node104" class="node">
<title>ring_attn_0_1_stage_2</title>
<polygon fill="yellow" stroke="black" points="3061,-19952 2852,-19884 3061,-19816 3270,-19884 3061,-19952"/>
<text text-anchor="middle" x="3061" y="-19902.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-19887.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="3061" y="-19872.8" font-family="Times,serif" font-size="14.00">Q[1]×K[15]×V[15]</text>
<text text-anchor="middle" x="3061" y="-19857.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_2&#45;&gt;ring_attn_0_1_stage_2 -->
<g id="edge1555" class="edge">
<title>ring_attn_0_0_stage_2&#45;&gt;ring_attn_0_1_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-19884C434.11,-19884 2841.79,-19884 2841.79,-19884"/>
<polygon fill="red" stroke="red" points="2841.79,-19887.5 2851.79,-19884 2841.79,-19880.5 2841.79,-19887.5"/>
</g>
<!-- ring_attn_0_0_stage_4 -->
<g id="node8" class="node">
<title>ring_attn_0_0_stage_4</title>
<polygon fill="yellow" stroke="black" points="225,-19446 16,-19378 225,-19310 434,-19378 225,-19446"/>
<text text-anchor="middle" x="225" y="-19396.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-19381.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="225" y="-19366.8" font-family="Times,serif" font-size="14.00">Q[0]×K[12]×V[12]</text>
<text text-anchor="middle" x="225" y="-19351.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_3&#45;&gt;ring_attn_0_0_stage_4 -->
<g id="edge7" class="edge">
<title>ring_attn_0_0_stage_3&#45;&gt;ring_attn_0_0_stage_4</title>
<path fill="none" stroke="black" d="M155.33,-19585.48C155.33,-19585.48 155.33,-19433.58 155.33,-19433.58"/>
<polygon fill="black" stroke="black" points="158.83,-19433.58 155.33,-19423.58 151.83,-19433.58 158.83,-19433.58"/>
</g>
<!-- ring_attn_0_1_stage_3 -->
<g id="node105" class="node">
<title>ring_attn_0_1_stage_3</title>
<polygon fill="yellow" stroke="black" points="3061,-19699 2852,-19631 3061,-19563 3270,-19631 3061,-19699"/>
<text text-anchor="middle" x="3061" y="-19649.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-19634.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="3061" y="-19619.8" font-family="Times,serif" font-size="14.00">Q[1]×K[14]×V[14]</text>
<text text-anchor="middle" x="3061" y="-19604.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_3&#45;&gt;ring_attn_0_1_stage_3 -->
<g id="edge1556" class="edge">
<title>ring_attn_0_0_stage_3&#45;&gt;ring_attn_0_1_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-19631C434.11,-19631 2841.79,-19631 2841.79,-19631"/>
<polygon fill="red" stroke="red" points="2841.79,-19634.5 2851.79,-19631 2841.79,-19627.5 2841.79,-19634.5"/>
</g>
<!-- ring_attn_0_0_stage_5 -->
<g id="node9" class="node">
<title>ring_attn_0_0_stage_5</title>
<polygon fill="yellow" stroke="black" points="225,-19193 16,-19125 225,-19057 434,-19125 225,-19193"/>
<text text-anchor="middle" x="225" y="-19143.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-19128.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="225" y="-19113.8" font-family="Times,serif" font-size="14.00">Q[0]×K[11]×V[11]</text>
<text text-anchor="middle" x="225" y="-19098.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_4&#45;&gt;ring_attn_0_0_stage_5 -->
<g id="edge8" class="edge">
<title>ring_attn_0_0_stage_4&#45;&gt;ring_attn_0_0_stage_5</title>
<path fill="none" stroke="black" d="M155.33,-19332.48C155.33,-19332.48 155.33,-19180.58 155.33,-19180.58"/>
<polygon fill="black" stroke="black" points="158.83,-19180.58 155.33,-19170.58 151.83,-19180.58 158.83,-19180.58"/>
</g>
<!-- ring_attn_0_1_stage_4 -->
<g id="node106" class="node">
<title>ring_attn_0_1_stage_4</title>
<polygon fill="yellow" stroke="black" points="3061,-19446 2852,-19378 3061,-19310 3270,-19378 3061,-19446"/>
<text text-anchor="middle" x="3061" y="-19396.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-19381.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="3061" y="-19366.8" font-family="Times,serif" font-size="14.00">Q[1]×K[13]×V[13]</text>
<text text-anchor="middle" x="3061" y="-19351.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_4&#45;&gt;ring_attn_0_1_stage_4 -->
<g id="edge1557" class="edge">
<title>ring_attn_0_0_stage_4&#45;&gt;ring_attn_0_1_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-19378C434.11,-19378 2841.79,-19378 2841.79,-19378"/>
<polygon fill="red" stroke="red" points="2841.79,-19381.5 2851.79,-19378 2841.79,-19374.5 2841.79,-19381.5"/>
</g>
<!-- ring_attn_0_0_stage_6 -->
<g id="node10" class="node">
<title>ring_attn_0_0_stage_6</title>
<polygon fill="yellow" stroke="black" points="225,-18940 16,-18872 225,-18804 434,-18872 225,-18940"/>
<text text-anchor="middle" x="225" y="-18890.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-18875.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="225" y="-18860.8" font-family="Times,serif" font-size="14.00">Q[0]×K[10]×V[10]</text>
<text text-anchor="middle" x="225" y="-18845.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_5&#45;&gt;ring_attn_0_0_stage_6 -->
<g id="edge9" class="edge">
<title>ring_attn_0_0_stage_5&#45;&gt;ring_attn_0_0_stage_6</title>
<path fill="none" stroke="black" d="M120.5,-19090.88C120.5,-19090.88 120.5,-18916.39 120.5,-18916.39"/>
<polygon fill="black" stroke="black" points="124,-18916.39 120.5,-18906.39 117,-18916.39 124,-18916.39"/>
</g>
<!-- ring_attn_0_1_stage_5 -->
<g id="node107" class="node">
<title>ring_attn_0_1_stage_5</title>
<polygon fill="yellow" stroke="black" points="3061,-19193 2852,-19125 3061,-19057 3270,-19125 3061,-19193"/>
<text text-anchor="middle" x="3061" y="-19143.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-19128.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="3061" y="-19113.8" font-family="Times,serif" font-size="14.00">Q[1]×K[12]×V[12]</text>
<text text-anchor="middle" x="3061" y="-19098.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_5&#45;&gt;ring_attn_0_1_stage_5 -->
<g id="edge1558" class="edge">
<title>ring_attn_0_0_stage_5&#45;&gt;ring_attn_0_1_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-19125C434.11,-19125 2841.79,-19125 2841.79,-19125"/>
<polygon fill="red" stroke="red" points="2841.79,-19128.5 2851.79,-19125 2841.79,-19121.5 2841.79,-19128.5"/>
</g>
<!-- ring_attn_0_0_stage_7 -->
<g id="node11" class="node">
<title>ring_attn_0_0_stage_7</title>
<polygon fill="yellow" stroke="black" points="225,-18687 16,-18619 225,-18551 434,-18619 225,-18687"/>
<text text-anchor="middle" x="225" y="-18637.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-18622.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="225" y="-18607.8" font-family="Times,serif" font-size="14.00">Q[0]×K[9]×V[9]</text>
<text text-anchor="middle" x="225" y="-18592.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_6&#45;&gt;ring_attn_0_0_stage_7 -->
<g id="edge10" class="edge">
<title>ring_attn_0_0_stage_6&#45;&gt;ring_attn_0_0_stage_7</title>
<path fill="none" stroke="black" d="M225,-18803.87C225,-18803.87 225,-18697.25 225,-18697.25"/>
<polygon fill="black" stroke="black" points="228.5,-18697.25 225,-18687.25 221.5,-18697.25 228.5,-18697.25"/>
</g>
<!-- ring_attn_0_1_stage_6 -->
<g id="node108" class="node">
<title>ring_attn_0_1_stage_6</title>
<polygon fill="yellow" stroke="black" points="3061,-18940 2852,-18872 3061,-18804 3270,-18872 3061,-18940"/>
<text text-anchor="middle" x="3061" y="-18890.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-18875.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="3061" y="-18860.8" font-family="Times,serif" font-size="14.00">Q[1]×K[11]×V[11]</text>
<text text-anchor="middle" x="3061" y="-18845.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_6&#45;&gt;ring_attn_0_1_stage_6 -->
<g id="edge1559" class="edge">
<title>ring_attn_0_0_stage_6&#45;&gt;ring_attn_0_1_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-18872C434.11,-18872 2841.79,-18872 2841.79,-18872"/>
<polygon fill="red" stroke="red" points="2841.79,-18875.5 2851.79,-18872 2841.79,-18868.5 2841.79,-18875.5"/>
</g>
<!-- ring_attn_0_0_stage_8 -->
<g id="node12" class="node">
<title>ring_attn_0_0_stage_8</title>
<polygon fill="yellow" stroke="black" points="225,-18434 16,-18366 225,-18298 434,-18366 225,-18434"/>
<text text-anchor="middle" x="225" y="-18384.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-18369.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="225" y="-18354.8" font-family="Times,serif" font-size="14.00">Q[0]×K[8]×V[8]</text>
<text text-anchor="middle" x="225" y="-18339.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_7&#45;&gt;ring_attn_0_0_stage_8 -->
<g id="edge11" class="edge">
<title>ring_attn_0_0_stage_7&#45;&gt;ring_attn_0_0_stage_8</title>
<path fill="none" stroke="black" d="M120.5,-18584.88C120.5,-18584.88 120.5,-18410.39 120.5,-18410.39"/>
<polygon fill="black" stroke="black" points="124,-18410.39 120.5,-18400.39 117,-18410.39 124,-18410.39"/>
</g>
<!-- ring_attn_0_1_stage_7 -->
<g id="node109" class="node">
<title>ring_attn_0_1_stage_7</title>
<polygon fill="yellow" stroke="black" points="3061,-18687 2852,-18619 3061,-18551 3270,-18619 3061,-18687"/>
<text text-anchor="middle" x="3061" y="-18637.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-18622.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="3061" y="-18607.8" font-family="Times,serif" font-size="14.00">Q[1]×K[10]×V[10]</text>
<text text-anchor="middle" x="3061" y="-18592.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_7&#45;&gt;ring_attn_0_1_stage_7 -->
<g id="edge1560" class="edge">
<title>ring_attn_0_0_stage_7&#45;&gt;ring_attn_0_1_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-18619C434.11,-18619 2841.79,-18619 2841.79,-18619"/>
<polygon fill="red" stroke="red" points="2841.79,-18622.5 2851.79,-18619 2841.79,-18615.5 2841.79,-18622.5"/>
</g>
<!-- ring_attn_0_0_stage_9 -->
<g id="node13" class="node">
<title>ring_attn_0_0_stage_9</title>
<polygon fill="yellow" stroke="black" points="225,-18181 16,-18113 225,-18045 434,-18113 225,-18181"/>
<text text-anchor="middle" x="225" y="-18131.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-18116.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="225" y="-18101.8" font-family="Times,serif" font-size="14.00">Q[0]×K[7]×V[7]</text>
<text text-anchor="middle" x="225" y="-18086.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_8&#45;&gt;ring_attn_0_0_stage_9 -->
<g id="edge12" class="edge">
<title>ring_attn_0_0_stage_8&#45;&gt;ring_attn_0_0_stage_9</title>
<path fill="none" stroke="black" d="M225,-18297.87C225,-18297.87 225,-18191.25 225,-18191.25"/>
<polygon fill="black" stroke="black" points="228.5,-18191.25 225,-18181.25 221.5,-18191.25 228.5,-18191.25"/>
</g>
<!-- ring_attn_0_1_stage_8 -->
<g id="node110" class="node">
<title>ring_attn_0_1_stage_8</title>
<polygon fill="yellow" stroke="black" points="3061,-18434 2852,-18366 3061,-18298 3270,-18366 3061,-18434"/>
<text text-anchor="middle" x="3061" y="-18384.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-18369.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="3061" y="-18354.8" font-family="Times,serif" font-size="14.00">Q[1]×K[9]×V[9]</text>
<text text-anchor="middle" x="3061" y="-18339.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_8&#45;&gt;ring_attn_0_1_stage_8 -->
<g id="edge1561" class="edge">
<title>ring_attn_0_0_stage_8&#45;&gt;ring_attn_0_1_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-18366C434.11,-18366 2841.79,-18366 2841.79,-18366"/>
<polygon fill="red" stroke="red" points="2841.79,-18369.5 2851.79,-18366 2841.79,-18362.5 2841.79,-18369.5"/>
</g>
<!-- ring_attn_0_0_stage_10 -->
<g id="node14" class="node">
<title>ring_attn_0_0_stage_10</title>
<polygon fill="yellow" stroke="black" points="225,-17928 16,-17860 225,-17792 434,-17860 225,-17928"/>
<text text-anchor="middle" x="225" y="-17878.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-17863.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="225" y="-17848.8" font-family="Times,serif" font-size="14.00">Q[0]×K[6]×V[6]</text>
<text text-anchor="middle" x="225" y="-17833.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_9&#45;&gt;ring_attn_0_0_stage_10 -->
<g id="edge13" class="edge">
<title>ring_attn_0_0_stage_9&#45;&gt;ring_attn_0_0_stage_10</title>
<path fill="none" stroke="black" d="M155.33,-18067.48C155.33,-18067.48 155.33,-17915.58 155.33,-17915.58"/>
<polygon fill="black" stroke="black" points="158.83,-17915.58 155.33,-17905.58 151.83,-17915.58 158.83,-17915.58"/>
</g>
<!-- ring_attn_0_1_stage_9 -->
<g id="node111" class="node">
<title>ring_attn_0_1_stage_9</title>
<polygon fill="yellow" stroke="black" points="3061,-18181 2852,-18113 3061,-18045 3270,-18113 3061,-18181"/>
<text text-anchor="middle" x="3061" y="-18131.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-18116.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="3061" y="-18101.8" font-family="Times,serif" font-size="14.00">Q[1]×K[8]×V[8]</text>
<text text-anchor="middle" x="3061" y="-18086.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_9&#45;&gt;ring_attn_0_1_stage_9 -->
<g id="edge1562" class="edge">
<title>ring_attn_0_0_stage_9&#45;&gt;ring_attn_0_1_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-18113C434.11,-18113 2841.79,-18113 2841.79,-18113"/>
<polygon fill="red" stroke="red" points="2841.79,-18116.5 2851.79,-18113 2841.79,-18109.5 2841.79,-18116.5"/>
</g>
<!-- ring_attn_0_0_stage_11 -->
<g id="node15" class="node">
<title>ring_attn_0_0_stage_11</title>
<polygon fill="yellow" stroke="black" points="225,-17675 16,-17607 225,-17539 434,-17607 225,-17675"/>
<text text-anchor="middle" x="225" y="-17625.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-17610.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="225" y="-17595.8" font-family="Times,serif" font-size="14.00">Q[0]×K[5]×V[5]</text>
<text text-anchor="middle" x="225" y="-17580.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_10&#45;&gt;ring_attn_0_0_stage_11 -->
<g id="edge14" class="edge">
<title>ring_attn_0_0_stage_10&#45;&gt;ring_attn_0_0_stage_11</title>
<path fill="none" stroke="black" d="M120.5,-17825.88C120.5,-17825.88 120.5,-17651.39 120.5,-17651.39"/>
<polygon fill="black" stroke="black" points="124,-17651.39 120.5,-17641.39 117,-17651.39 124,-17651.39"/>
</g>
<!-- ring_attn_0_1_stage_10 -->
<g id="node112" class="node">
<title>ring_attn_0_1_stage_10</title>
<polygon fill="yellow" stroke="black" points="3061,-17928 2852,-17860 3061,-17792 3270,-17860 3061,-17928"/>
<text text-anchor="middle" x="3061" y="-17878.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-17863.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="3061" y="-17848.8" font-family="Times,serif" font-size="14.00">Q[1]×K[7]×V[7]</text>
<text text-anchor="middle" x="3061" y="-17833.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_10&#45;&gt;ring_attn_0_1_stage_10 -->
<g id="edge1563" class="edge">
<title>ring_attn_0_0_stage_10&#45;&gt;ring_attn_0_1_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-17860C434.11,-17860 2841.79,-17860 2841.79,-17860"/>
<polygon fill="red" stroke="red" points="2841.79,-17863.5 2851.79,-17860 2841.79,-17856.5 2841.79,-17863.5"/>
</g>
<!-- ring_attn_0_0_stage_12 -->
<g id="node16" class="node">
<title>ring_attn_0_0_stage_12</title>
<polygon fill="yellow" stroke="black" points="225,-17422 16,-17354 225,-17286 434,-17354 225,-17422"/>
<text text-anchor="middle" x="225" y="-17372.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-17357.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="225" y="-17342.8" font-family="Times,serif" font-size="14.00">Q[0]×K[4]×V[4]</text>
<text text-anchor="middle" x="225" y="-17327.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_11&#45;&gt;ring_attn_0_0_stage_12 -->
<g id="edge15" class="edge">
<title>ring_attn_0_0_stage_11&#45;&gt;ring_attn_0_0_stage_12</title>
<path fill="none" stroke="black" d="M155.33,-17561.48C155.33,-17561.48 155.33,-17409.58 155.33,-17409.58"/>
<polygon fill="black" stroke="black" points="158.83,-17409.58 155.33,-17399.58 151.83,-17409.58 158.83,-17409.58"/>
</g>
<!-- ring_attn_0_1_stage_11 -->
<g id="node113" class="node">
<title>ring_attn_0_1_stage_11</title>
<polygon fill="yellow" stroke="black" points="3061,-17675 2852,-17607 3061,-17539 3270,-17607 3061,-17675"/>
<text text-anchor="middle" x="3061" y="-17625.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-17610.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="3061" y="-17595.8" font-family="Times,serif" font-size="14.00">Q[1]×K[6]×V[6]</text>
<text text-anchor="middle" x="3061" y="-17580.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_11&#45;&gt;ring_attn_0_1_stage_11 -->
<g id="edge1564" class="edge">
<title>ring_attn_0_0_stage_11&#45;&gt;ring_attn_0_1_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-17607C434.11,-17607 2841.79,-17607 2841.79,-17607"/>
<polygon fill="red" stroke="red" points="2841.79,-17610.5 2851.79,-17607 2841.79,-17603.5 2841.79,-17610.5"/>
</g>
<!-- ring_attn_0_0_stage_13 -->
<g id="node17" class="node">
<title>ring_attn_0_0_stage_13</title>
<polygon fill="yellow" stroke="black" points="225,-17169 16,-17101 225,-17033 434,-17101 225,-17169"/>
<text text-anchor="middle" x="225" y="-17119.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-17104.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="225" y="-17089.8" font-family="Times,serif" font-size="14.00">Q[0]×K[3]×V[3]</text>
<text text-anchor="middle" x="225" y="-17074.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_12&#45;&gt;ring_attn_0_0_stage_13 -->
<g id="edge16" class="edge">
<title>ring_attn_0_0_stage_12&#45;&gt;ring_attn_0_0_stage_13</title>
<path fill="none" stroke="black" d="M155.33,-17308.48C155.33,-17308.48 155.33,-17156.58 155.33,-17156.58"/>
<polygon fill="black" stroke="black" points="158.83,-17156.58 155.33,-17146.58 151.83,-17156.58 158.83,-17156.58"/>
</g>
<!-- ring_attn_0_1_stage_12 -->
<g id="node114" class="node">
<title>ring_attn_0_1_stage_12</title>
<polygon fill="yellow" stroke="black" points="3061,-17422 2852,-17354 3061,-17286 3270,-17354 3061,-17422"/>
<text text-anchor="middle" x="3061" y="-17372.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-17357.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="3061" y="-17342.8" font-family="Times,serif" font-size="14.00">Q[1]×K[5]×V[5]</text>
<text text-anchor="middle" x="3061" y="-17327.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_12&#45;&gt;ring_attn_0_1_stage_12 -->
<g id="edge1565" class="edge">
<title>ring_attn_0_0_stage_12&#45;&gt;ring_attn_0_1_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-17354C434.11,-17354 2841.79,-17354 2841.79,-17354"/>
<polygon fill="red" stroke="red" points="2841.79,-17357.5 2851.79,-17354 2841.79,-17350.5 2841.79,-17357.5"/>
</g>
<!-- ring_attn_0_0_stage_14 -->
<g id="node18" class="node">
<title>ring_attn_0_0_stage_14</title>
<polygon fill="yellow" stroke="black" points="225,-16916 16,-16848 225,-16780 434,-16848 225,-16916"/>
<text text-anchor="middle" x="225" y="-16866.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-16851.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="225" y="-16836.8" font-family="Times,serif" font-size="14.00">Q[0]×K[2]×V[2]</text>
<text text-anchor="middle" x="225" y="-16821.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_13&#45;&gt;ring_attn_0_0_stage_14 -->
<g id="edge17" class="edge">
<title>ring_attn_0_0_stage_13&#45;&gt;ring_attn_0_0_stage_14</title>
<path fill="none" stroke="black" d="M225,-17032.87C225,-17032.87 225,-16926.25 225,-16926.25"/>
<polygon fill="black" stroke="black" points="228.5,-16926.25 225,-16916.25 221.5,-16926.25 228.5,-16926.25"/>
</g>
<!-- ring_attn_0_1_stage_13 -->
<g id="node115" class="node">
<title>ring_attn_0_1_stage_13</title>
<polygon fill="yellow" stroke="black" points="3061,-17169 2852,-17101 3061,-17033 3270,-17101 3061,-17169"/>
<text text-anchor="middle" x="3061" y="-17119.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-17104.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="3061" y="-17089.8" font-family="Times,serif" font-size="14.00">Q[1]×K[4]×V[4]</text>
<text text-anchor="middle" x="3061" y="-17074.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_13&#45;&gt;ring_attn_0_1_stage_13 -->
<g id="edge1566" class="edge">
<title>ring_attn_0_0_stage_13&#45;&gt;ring_attn_0_1_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-17101C434.11,-17101 2841.79,-17101 2841.79,-17101"/>
<polygon fill="red" stroke="red" points="2841.79,-17104.5 2851.79,-17101 2841.79,-17097.5 2841.79,-17104.5"/>
</g>
<!-- ring_attn_0_0_stage_15 -->
<g id="node19" class="node">
<title>ring_attn_0_0_stage_15</title>
<polygon fill="yellow" stroke="black" points="225,-16663 16,-16595 225,-16527 434,-16595 225,-16663"/>
<text text-anchor="middle" x="225" y="-16613.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-16598.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="225" y="-16583.8" font-family="Times,serif" font-size="14.00">Q[0]×K[1]×V[1]</text>
<text text-anchor="middle" x="225" y="-16568.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_14&#45;&gt;ring_attn_0_0_stage_15 -->
<g id="edge18" class="edge">
<title>ring_attn_0_0_stage_14&#45;&gt;ring_attn_0_0_stage_15</title>
<path fill="none" stroke="black" d="M155.33,-16802.48C155.33,-16802.48 155.33,-16650.58 155.33,-16650.58"/>
<polygon fill="black" stroke="black" points="158.83,-16650.58 155.33,-16640.58 151.83,-16650.58 158.83,-16650.58"/>
</g>
<!-- ring_attn_0_1_stage_14 -->
<g id="node116" class="node">
<title>ring_attn_0_1_stage_14</title>
<polygon fill="yellow" stroke="black" points="3061,-16916 2852,-16848 3061,-16780 3270,-16848 3061,-16916"/>
<text text-anchor="middle" x="3061" y="-16866.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-16851.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="3061" y="-16836.8" font-family="Times,serif" font-size="14.00">Q[1]×K[3]×V[3]</text>
<text text-anchor="middle" x="3061" y="-16821.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_14&#45;&gt;ring_attn_0_1_stage_14 -->
<g id="edge1567" class="edge">
<title>ring_attn_0_0_stage_14&#45;&gt;ring_attn_0_1_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-16848C434.11,-16848 2841.79,-16848 2841.79,-16848"/>
<polygon fill="red" stroke="red" points="2841.79,-16851.5 2851.79,-16848 2841.79,-16844.5 2841.79,-16851.5"/>
</g>
<!-- attn_out_0_0 -->
<g id="node20" class="node">
<title>attn_out_0_0</title>
<polygon fill="none" stroke="black" points="294.5,-16454 155.5,-16454 155.5,-16401 294.5,-16401 294.5,-16454"/>
<text text-anchor="middle" x="225" y="-16438.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="225" y="-16423.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="225" y="-16408.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_0_0_stage_15&#45;&gt;attn_out_0_0 -->
<g id="edge19" class="edge">
<title>ring_attn_0_0_stage_15&#45;&gt;attn_out_0_0</title>
<path fill="none" stroke="black" d="M225,-16526.87C225,-16526.87 225,-16464.18 225,-16464.18"/>
<polygon fill="black" stroke="black" points="228.5,-16464.18 225,-16454.18 221.5,-16464.18 228.5,-16464.18"/>
</g>
<!-- ring_attn_0_1_stage_15 -->
<g id="node117" class="node">
<title>ring_attn_0_1_stage_15</title>
<polygon fill="yellow" stroke="black" points="3061,-16663 2852,-16595 3061,-16527 3270,-16595 3061,-16663"/>
<text text-anchor="middle" x="3061" y="-16613.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-16598.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="3061" y="-16583.8" font-family="Times,serif" font-size="14.00">Q[1]×K[2]×V[2]</text>
<text text-anchor="middle" x="3061" y="-16568.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_0_stage_15&#45;&gt;ring_attn_0_1_stage_15 -->
<g id="edge1568" class="edge">
<title>ring_attn_0_0_stage_15&#45;&gt;ring_attn_0_1_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-16595C434.11,-16595 2841.79,-16595 2841.79,-16595"/>
<polygon fill="red" stroke="red" points="2841.79,-16598.5 2851.79,-16595 2841.79,-16591.5 2841.79,-16598.5"/>
</g>
<!-- attn_residual_0_0 -->
<g id="node21" class="node">
<title>attn_residual_0_0</title>
<ellipse fill="none" stroke="black" cx="225" cy="-16301" rx="105.5" ry="27"/>
<text text-anchor="middle" x="225" y="-16304.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="225" y="-16289.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_0_0&#45;&gt;attn_residual_0_0 -->
<g id="edge20" class="edge">
<title>attn_out_0_0&#45;&gt;attn_residual_0_0</title>
<path fill="none" stroke="black" d="M225,-16400.98C225,-16400.98 225,-16338.36 225,-16338.36"/>
<polygon fill="black" stroke="black" points="228.5,-16338.36 225,-16328.36 221.5,-16338.36 228.5,-16338.36"/>
</g>
<!-- gate_0_0 -->
<g id="node22" class="node">
<title>gate_0_0</title>
<ellipse fill="orange" stroke="black" cx="225" cy="-16163.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="225" y="-16174.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="225" y="-16159.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="225" y="-16144.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_0_0&#45;&gt;gate_0_0 -->
<g id="edge21" class="edge">
<title>attn_residual_0_0&#45;&gt;gate_0_0</title>
<path fill="none" stroke="black" d="M145.88,-16283.02C145.88,-16283.02 145.88,-16198.47 145.88,-16198.47"/>
<polygon fill="black" stroke="black" points="149.38,-16198.47 145.88,-16188.47 142.38,-16198.47 149.38,-16198.47"/>
</g>
<!-- expert_0_0_0 -->
<g id="node23" class="node">
<title>expert_0_0_0</title>
<polygon fill="lightpink" stroke="black" points="344,-15994 106,-15994 106,-15941 344,-15941 344,-15994"/>
<text text-anchor="middle" x="225" y="-15978.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="225" y="-15963.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="225" y="-15948.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_0_0&#45;&gt;expert_0_0_0 -->
<g id="edge22" class="edge">
<title>gate_0_0&#45;&gt;expert_0_0_0</title>
<path fill="none" stroke="black" d="M133.57,-16144.71C133.57,-16144.71 133.57,-16004.29 133.57,-16004.29"/>
<polygon fill="black" stroke="black" points="137.07,-16004.29 133.57,-15994.29 130.07,-16004.29 137.07,-16004.29"/>
</g>
<!-- expert_0_1_0 -->
<g id="node121" class="node">
<title>expert_0_1_0</title>
<polygon fill="lightpink" stroke="black" points="3180,-15994 2942,-15994 2942,-15941 3180,-15941 3180,-15994"/>
<text text-anchor="middle" x="3061" y="-15978.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="3061" y="-15963.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="3061" y="-15948.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_0_0&#45;&gt;expert_0_1_0 -->
<g id="edge1569" class="edge">
<title>gate_0_0&#45;&gt;expert_0_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M324.76,-16151C815.39,-16151 2948.75,-16151 2948.75,-16151 2948.75,-16151 2948.75,-16004.18 2948.75,-16004.18"/>
<polygon fill="blue" stroke="blue" points="2952.25,-16004.18 2948.75,-15994.18 2945.25,-16004.18 2952.25,-16004.18"/>
<text text-anchor="middle" x="333.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="333.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU0→GPU1</text>
<text text-anchor="middle" x="333.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="333.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_2_0 -->
<g id="node219" class="node">
<title>expert_0_2_0</title>
<polygon fill="lightpink" stroke="black" points="3767,-15994 3529,-15994 3529,-15941 3767,-15941 3767,-15994"/>
<text text-anchor="middle" x="3648" y="-15978.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="3648" y="-15963.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="3648" y="-15948.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_0_0&#45;&gt;expert_0_2_0 -->
<g id="edge1570" class="edge">
<title>gate_0_0&#45;&gt;expert_0_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M217.97,-16125.91C217.97,-16124.09 217.97,-16123 217.97,-16123 217.97,-16123 3558.13,-16123 3558.13,-16123 3558.13,-16123 3558.13,-16004.23 3558.13,-16004.23"/>
<polygon fill="blue" stroke="blue" points="3561.63,-16004.23 3558.13,-15994.23 3554.63,-16004.23 3561.63,-16004.23"/>
<text text-anchor="middle" x="507.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="507.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU0→GPU2</text>
<text text-anchor="middle" x="507.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="507.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_3_0 -->
<g id="node317" class="node">
<title>expert_0_3_0</title>
<polygon fill="lightpink" stroke="black" points="4354,-15994 4116,-15994 4116,-15941 4354,-15941 4354,-15994"/>
<text text-anchor="middle" x="4235" y="-15978.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="4235" y="-15963.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="4235" y="-15948.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_0_0&#45;&gt;expert_0_3_0 -->
<g id="edge1571" class="edge">
<title>gate_0_0&#45;&gt;expert_0_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M232.03,-16125.87C232.03,-16113.57 232.03,-16103 232.03,-16103 232.03,-16103 4146.38,-16103 4146.38,-16103 4146.38,-16103 4146.38,-16004.27 4146.38,-16004.27"/>
<polygon fill="blue" stroke="blue" points="4149.88,-16004.27 4146.38,-15994.27 4142.88,-16004.27 4149.88,-16004.27"/>
<text text-anchor="middle" x="681.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="681.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU0→GPU3</text>
<text text-anchor="middle" x="681.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="681.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_4_0 -->
<g id="node415" class="node">
<title>expert_0_4_0</title>
<polygon fill="lightpink" stroke="black" points="4941,-15994 4703,-15994 4703,-15941 4941,-15941 4941,-15994"/>
<text text-anchor="middle" x="4822" y="-15978.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="4822" y="-15963.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="4822" y="-15948.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_0_0&#45;&gt;expert_0_4_0 -->
<g id="edge1572" class="edge">
<title>gate_0_0&#45;&gt;expert_0_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M246.1,-16126.74C246.1,-16077.44 246.1,-15996 246.1,-15996 246.1,-15996 4736.6,-15996 4736.6,-15996 4736.6,-15996 4736.6,-15995.81 4736.6,-15995.81"/>
<polygon fill="blue" stroke="blue" points="4740.1,-16004.13 4736.6,-15994.13 4733.1,-16004.13 4740.1,-16004.13"/>
<text text-anchor="middle" x="855.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="855.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU0→GPU4</text>
<text text-anchor="middle" x="855.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="855.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_5_0 -->
<g id="node513" class="node">
<title>expert_0_5_0</title>
<polygon fill="lightpink" stroke="black" points="5528,-15994 5290,-15994 5290,-15941 5528,-15941 5528,-15994"/>
<text text-anchor="middle" x="5409" y="-15978.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="5409" y="-15963.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="5409" y="-15948.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_0_0&#45;&gt;expert_0_5_0 -->
<g id="edge1573" class="edge">
<title>gate_0_0&#45;&gt;expert_0_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M260.17,-16127.91C260.17,-16112.1 260.17,-16097 260.17,-16097 260.17,-16097 5323.6,-16097 5323.6,-16097 5323.6,-16097 5323.6,-16004.02 5323.6,-16004.02"/>
<polygon fill="blue" stroke="blue" points="5327.1,-16004.02 5323.6,-15994.02 5320.1,-16004.02 5327.1,-16004.02"/>
<text text-anchor="middle" x="1029.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1029.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU0→GPU5</text>
<text text-anchor="middle" x="1029.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1029.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_6_0 -->
<g id="node611" class="node">
<title>expert_0_6_0</title>
<polygon fill="lightpink" stroke="black" points="6115,-15994 5877,-15994 5877,-15941 6115,-15941 6115,-15994"/>
<text text-anchor="middle" x="5996" y="-15978.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="5996" y="-15963.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="5996" y="-15948.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_0_0&#45;&gt;expert_0_6_0 -->
<g id="edge1574" class="edge">
<title>gate_0_0&#45;&gt;expert_0_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M274.23,-16130.21C274.23,-16082.14 274.23,-15999 274.23,-15999 274.23,-15999 5753.2,-15999 5753.2,-15999 5753.2,-15999 5753.2,-15976 5753.2,-15976 5753.2,-15976 5866.73,-15976 5866.73,-15976"/>
<polygon fill="blue" stroke="blue" points="5866.73,-15979.5 5876.73,-15976 5866.73,-15972.5 5866.73,-15979.5"/>
<text text-anchor="middle" x="1203.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1203.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU0→GPU6</text>
<text text-anchor="middle" x="1203.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1203.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_7_0 -->
<g id="node709" class="node">
<title>expert_0_7_0</title>
<polygon fill="lightpink" stroke="black" points="6702,-15994 6464,-15994 6464,-15941 6702,-15941 6702,-15994"/>
<text text-anchor="middle" x="6583" y="-15978.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="6583" y="-15963.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="6583" y="-15948.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_0_0&#45;&gt;expert_0_7_0 -->
<g id="edge1575" class="edge">
<title>gate_0_0&#45;&gt;expert_0_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M304.12,-16188.45C304.12,-16211.1 304.12,-16241 304.12,-16241 304.12,-16241 6129.5,-16241 6129.5,-16241 6129.5,-16241 6129.5,-15967 6129.5,-15967 6129.5,-15967 6453.85,-15967 6453.85,-15967"/>
<polygon fill="blue" stroke="blue" points="6453.85,-15970.5 6463.85,-15967 6453.85,-15963.5 6453.85,-15970.5"/>
<text text-anchor="middle" x="1377.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1377.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU0→GPU7</text>
<text text-anchor="middle" x="1377.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1377.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_8_0 -->
<g id="node807" class="node">
<title>expert_0_8_0</title>
<polygon fill="lightpink" stroke="black" points="7289,-15994 7051,-15994 7051,-15941 7289,-15941 7289,-15994"/>
<text text-anchor="middle" x="7170" y="-15978.8" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="7170" y="-15963.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="7170" y="-15948.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_0_0&#45;&gt;expert_0_8_0 -->
<g id="edge1576" class="edge">
<title>gate_0_0&#45;&gt;expert_0_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M277.75,-16196.2C277.75,-16220.7 277.75,-16250 277.75,-16250 277.75,-16250 6761.5,-16250 6761.5,-16250 6761.5,-16250 6761.5,-15967 6761.5,-15967 6761.5,-15967 7040.75,-15967 7040.75,-15967"/>
<polygon fill="blue" stroke="blue" points="7040.75,-15970.5 7050.75,-15967 7040.75,-15963.5 7040.75,-15970.5"/>
<text text-anchor="middle" x="1551.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1551.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU0→GPU8</text>
<text text-anchor="middle" x="1551.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1551.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_9_0 -->
<g id="node905" class="node">
<title>expert_0_9_0</title>
<polygon fill="lightpink" stroke="black" points="7876,-15994 7638,-15994 7638,-15941 7876,-15941 7876,-15994"/>
<text text-anchor="middle" x="7757" y="-15978.8" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="7757" y="-15963.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="7757" y="-15948.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_0_0&#45;&gt;expert_0_9_0 -->
<g id="edge1577" class="edge">
<title>gate_0_0&#45;&gt;expert_0_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M251.38,-16199.93C251.38,-16225.44 251.38,-16255 251.38,-16255 251.38,-16255 7348.5,-16255 7348.5,-16255 7348.5,-16255 7348.5,-15967 7348.5,-15967 7348.5,-15967 7627.75,-15967 7627.75,-15967"/>
<polygon fill="blue" stroke="blue" points="7627.75,-15970.5 7637.75,-15967 7627.75,-15963.5 7627.75,-15970.5"/>
<text text-anchor="middle" x="1725.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1725.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU0→GPU9</text>
<text text-anchor="middle" x="1725.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1725.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_10_0 -->
<g id="node1003" class="node">
<title>expert_0_10_0</title>
<polygon fill="lightpink" stroke="black" points="8463,-15994 8225,-15994 8225,-15941 8463,-15941 8463,-15994"/>
<text text-anchor="middle" x="8344" y="-15978.8" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="8344" y="-15963.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="8344" y="-15948.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_0_0&#45;&gt;expert_0_10_0 -->
<g id="edge1578" class="edge">
<title>gate_0_0&#45;&gt;expert_0_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M225,-16201.24C225,-16227.94 225,-16259 225,-16259 225,-16259 7935.5,-16259 7935.5,-16259 7935.5,-16259 7935.5,-15967 7935.5,-15967 7935.5,-15967 8214.75,-15967 8214.75,-15967"/>
<polygon fill="blue" stroke="blue" points="8214.75,-15970.5 8224.75,-15967 8214.75,-15963.5 8214.75,-15970.5"/>
<text text-anchor="middle" x="1899.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1899.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU0→GPU10</text>
<text text-anchor="middle" x="1899.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1899.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_11_0 -->
<g id="node1101" class="node">
<title>expert_0_11_0</title>
<polygon fill="lightpink" stroke="black" points="9050,-15994 8812,-15994 8812,-15941 9050,-15941 9050,-15994"/>
<text text-anchor="middle" x="8931" y="-15978.8" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="8931" y="-15963.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="8931" y="-15948.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_0_0&#45;&gt;expert_0_11_0 -->
<g id="edge1579" class="edge">
<title>gate_0_0&#45;&gt;expert_0_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M198.62,-16200.07C198.62,-16228.8 198.62,-16264 198.62,-16264 198.62,-16264 8522.5,-16264 8522.5,-16264 8522.5,-16264 8522.5,-15958 8522.5,-15958 8522.5,-15958 8801.75,-15958 8801.75,-15958"/>
<polygon fill="blue" stroke="blue" points="8801.75,-15961.5 8811.75,-15958 8801.75,-15954.5 8801.75,-15961.5"/>
<text text-anchor="middle" x="2073.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2073.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU0→GPU11</text>
<text text-anchor="middle" x="2073.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="2073.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_12_0 -->
<g id="node1199" class="node">
<title>expert_0_12_0</title>
<polygon fill="lightpink" stroke="black" points="9637,-15994 9399,-15994 9399,-15941 9637,-15941 9637,-15994"/>
<text text-anchor="middle" x="9518" y="-15978.8" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="9518" y="-15963.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="9518" y="-15948.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_0_0&#45;&gt;expert_0_12_0 -->
<g id="edge1580" class="edge">
<title>gate_0_0&#45;&gt;expert_0_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M172.25,-16196.01C172.25,-16227.01 172.25,-16269 172.25,-16269 172.25,-16269 9064.5,-16269 9064.5,-16269 9064.5,-16269 9064.5,-15967 9064.5,-15967 9064.5,-15967 9388.85,-15967 9388.85,-15967"/>
<polygon fill="blue" stroke="blue" points="9388.85,-15970.5 9398.85,-15967 9388.85,-15963.5 9388.85,-15970.5"/>
<text text-anchor="middle" x="2247.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2247.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU0→GPU12</text>
<text text-anchor="middle" x="2247.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="2247.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_13_0 -->
<g id="node1297" class="node">
<title>expert_0_13_0</title>
<polygon fill="lightpink" stroke="black" points="10224,-15994 9986,-15994 9986,-15941 10224,-15941 10224,-15994"/>
<text text-anchor="middle" x="10105" y="-15978.8" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="10105" y="-15963.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="10105" y="-15948.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_0_0&#45;&gt;expert_0_13_0 -->
<g id="edge1581" class="edge">
<title>gate_0_0&#45;&gt;expert_0_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M288.3,-16133.13C288.3,-16087.36 288.3,-16006 288.3,-16006 288.3,-16006 10016.38,-16006 10016.38,-16006 10016.38,-16006 10016.38,-16004.24 10016.38,-16004.24"/>
<polygon fill="blue" stroke="blue" points="10019.88,-16004.24 10016.38,-15994.24 10012.88,-16004.24 10019.88,-16004.24"/>
<text text-anchor="middle" x="2421.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2421.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU0→GPU13</text>
<text text-anchor="middle" x="2421.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="2421.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_14_0 -->
<g id="node1395" class="node">
<title>expert_0_14_0</title>
<polygon fill="lightpink" stroke="black" points="10811,-15994 10573,-15994 10573,-15941 10811,-15941 10811,-15994"/>
<text text-anchor="middle" x="10692" y="-15978.8" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="10692" y="-15963.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="10692" y="-15948.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_0_0&#45;&gt;expert_0_14_0 -->
<g id="edge1582" class="edge">
<title>gate_0_0&#45;&gt;expert_0_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M302.37,-16137.66C302.37,-16093.21 302.37,-16007 302.37,-16007 302.37,-16007 10606.6,-16007 10606.6,-16007 10606.6,-16007 10606.6,-16004.07 10606.6,-16004.07"/>
<polygon fill="blue" stroke="blue" points="10610.1,-16004.07 10606.6,-15994.07 10603.1,-16004.07 10610.1,-16004.07"/>
<text text-anchor="middle" x="2595.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2595.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU0→GPU14</text>
<text text-anchor="middle" x="2595.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="2595.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_15_0 -->
<g id="node1493" class="node">
<title>expert_0_15_0</title>
<polygon fill="lightpink" stroke="black" points="11398,-15994 11160,-15994 11160,-15941 11398,-15941 11398,-15994"/>
<text text-anchor="middle" x="11279" y="-15978.8" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="11279" y="-15963.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="11279" y="-15948.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_0_0&#45;&gt;expert_0_15_0 -->
<g id="edge1583" class="edge">
<title>gate_0_0&#45;&gt;expert_0_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M316.43,-16144.62C316.43,-16103 316.43,-16007 316.43,-16007 316.43,-16007 11195.71,-16007 11195.71,-16007 11195.71,-16007 11195.71,-16004.07 11195.71,-16004.07"/>
<polygon fill="blue" stroke="blue" points="11199.21,-16004.07 11195.71,-15994.07 11192.21,-16004.07 11199.21,-16004.07"/>
<text text-anchor="middle" x="2769.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2769.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU0→GPU15</text>
<text text-anchor="middle" x="2769.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="2769.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_0 -->
<g id="node24" class="node">
<title>expert_reduce_0_0</title>
<ellipse fill="none" stroke="black" cx="225" cy="-15830.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="225" y="-15841.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="225" y="-15826.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="225" y="-15811.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_0_0&#45;&gt;expert_reduce_0_0 -->
<g id="edge23" class="edge">
<title>expert_0_0_0&#45;&gt;expert_reduce_0_0</title>
<path fill="none" stroke="black" d="M225,-15940.76C225,-15940.76 225,-15878.06 225,-15878.06"/>
<polygon fill="black" stroke="black" points="228.5,-15878.06 225,-15868.06 221.5,-15878.06 228.5,-15878.06"/>
</g>
<!-- moe_residual_0_0 -->
<g id="node25" class="node">
<title>moe_residual_0_0</title>
<ellipse fill="none" stroke="black" cx="225" cy="-15693" rx="105.5" ry="27"/>
<text text-anchor="middle" x="225" y="-15696.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="225" y="-15681.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_0&#45;&gt;moe_residual_0_0 -->
<g id="edge24" class="edge">
<title>expert_reduce_0_0&#45;&gt;moe_residual_0_0</title>
<path fill="none" stroke="black" d="M225,-15792.93C225,-15792.93 225,-15730.06 225,-15730.06"/>
<polygon fill="black" stroke="black" points="228.5,-15730.06 225,-15720.06 221.5,-15730.06 228.5,-15730.06"/>
</g>
<!-- qkv_proj_1_0 -->
<g id="node26" class="node">
<title>qkv_proj_1_0</title>
<polygon fill="none" stroke="black" points="307.5,-15593 142.5,-15593 142.5,-15540 307.5,-15540 307.5,-15593"/>
<text text-anchor="middle" x="225" y="-15577.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="225" y="-15562.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="225" y="-15547.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_0_0&#45;&gt;qkv_proj_1_0 -->
<g id="edge25" class="edge">
<title>moe_residual_0_0&#45;&gt;qkv_proj_1_0</title>
<path fill="none" stroke="black" d="M225,-15665.86C225,-15665.86 225,-15603.16 225,-15603.16"/>
<polygon fill="black" stroke="black" points="228.5,-15603.16 225,-15593.16 221.5,-15603.16 228.5,-15603.16"/>
</g>
<!-- qkv_reshape_1_0 -->
<g id="node27" class="node">
<title>qkv_reshape_1_0</title>
<ellipse fill="none" stroke="black" cx="225" cy="-15440" rx="148" ry="27"/>
<text text-anchor="middle" x="225" y="-15443.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="225" y="-15428.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_1_0&#45;&gt;qkv_reshape_1_0 -->
<g id="edge26" class="edge">
<title>qkv_proj_1_0&#45;&gt;qkv_reshape_1_0</title>
<path fill="none" stroke="black" d="M225,-15539.98C225,-15539.98 225,-15477.36 225,-15477.36"/>
<polygon fill="black" stroke="black" points="228.5,-15477.36 225,-15467.36 221.5,-15477.36 228.5,-15477.36"/>
</g>
<!-- ring_attn_1_0_stage_0 -->
<g id="node28" class="node">
<title>ring_attn_1_0_stage_0</title>
<polygon fill="yellow" stroke="black" points="225,-15296 16,-15228 225,-15160 434,-15228 225,-15296"/>
<text text-anchor="middle" x="225" y="-15246.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-15231.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="225" y="-15216.8" font-family="Times,serif" font-size="14.00">Q[0]×K[0]×V[0]</text>
<text text-anchor="middle" x="225" y="-15201.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- qkv_reshape_1_0&#45;&gt;ring_attn_1_0_stage_0 -->
<g id="edge27" class="edge">
<title>qkv_reshape_1_0&#45;&gt;ring_attn_1_0_stage_0</title>
<path fill="none" stroke="black" d="M225,-15412.72C225,-15412.72 225,-15306.16 225,-15306.16"/>
<polygon fill="black" stroke="black" points="228.5,-15306.16 225,-15296.16 221.5,-15306.16 228.5,-15306.16"/>
</g>
<!-- ring_attn_1_0_stage_1 -->
<g id="node29" class="node">
<title>ring_attn_1_0_stage_1</title>
<polygon fill="yellow" stroke="black" points="225,-15043 16,-14975 225,-14907 434,-14975 225,-15043"/>
<text text-anchor="middle" x="225" y="-14993.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-14978.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="225" y="-14963.8" font-family="Times,serif" font-size="14.00">Q[0]×K[15]×V[15]</text>
<text text-anchor="middle" x="225" y="-14948.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_0&#45;&gt;ring_attn_1_0_stage_1 -->
<g id="edge28" class="edge">
<title>ring_attn_1_0_stage_0&#45;&gt;ring_attn_1_0_stage_1</title>
<path fill="none" stroke="black" d="M225,-15159.87C225,-15159.87 225,-15053.25 225,-15053.25"/>
<polygon fill="black" stroke="black" points="228.5,-15053.25 225,-15043.25 221.5,-15053.25 228.5,-15053.25"/>
</g>
<!-- ring_attn_1_1_stage_0 -->
<g id="node126" class="node">
<title>ring_attn_1_1_stage_0</title>
<polygon fill="yellow" stroke="black" points="3061,-15296 2852,-15228 3061,-15160 3270,-15228 3061,-15296"/>
<text text-anchor="middle" x="3061" y="-15246.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-15231.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="3061" y="-15216.8" font-family="Times,serif" font-size="14.00">Q[1]×K[1]×V[1]</text>
<text text-anchor="middle" x="3061" y="-15201.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_0&#45;&gt;ring_attn_1_1_stage_0 -->
<g id="edge1584" class="edge">
<title>ring_attn_1_0_stage_0&#45;&gt;ring_attn_1_1_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-15228C434.11,-15228 2841.79,-15228 2841.79,-15228"/>
<polygon fill="red" stroke="red" points="2841.79,-15231.5 2851.79,-15228 2841.79,-15224.5 2841.79,-15231.5"/>
</g>
<!-- ring_attn_1_0_stage_2 -->
<g id="node30" class="node">
<title>ring_attn_1_0_stage_2</title>
<polygon fill="yellow" stroke="black" points="225,-14790 16,-14722 225,-14654 434,-14722 225,-14790"/>
<text text-anchor="middle" x="225" y="-14740.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-14725.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="225" y="-14710.8" font-family="Times,serif" font-size="14.00">Q[0]×K[14]×V[14]</text>
<text text-anchor="middle" x="225" y="-14695.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_1&#45;&gt;ring_attn_1_0_stage_2 -->
<g id="edge29" class="edge">
<title>ring_attn_1_0_stage_1&#45;&gt;ring_attn_1_0_stage_2</title>
<path fill="none" stroke="black" d="M120.5,-14940.88C120.5,-14940.88 120.5,-14766.39 120.5,-14766.39"/>
<polygon fill="black" stroke="black" points="124,-14766.39 120.5,-14756.39 117,-14766.39 124,-14766.39"/>
</g>
<!-- ring_attn_1_1_stage_1 -->
<g id="node127" class="node">
<title>ring_attn_1_1_stage_1</title>
<polygon fill="yellow" stroke="black" points="3061,-15043 2852,-14975 3061,-14907 3270,-14975 3061,-15043"/>
<text text-anchor="middle" x="3061" y="-14993.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-14978.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="3061" y="-14963.8" font-family="Times,serif" font-size="14.00">Q[1]×K[0]×V[0]</text>
<text text-anchor="middle" x="3061" y="-14948.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_1&#45;&gt;ring_attn_1_1_stage_1 -->
<g id="edge1585" class="edge">
<title>ring_attn_1_0_stage_1&#45;&gt;ring_attn_1_1_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-14975C434.11,-14975 2841.79,-14975 2841.79,-14975"/>
<polygon fill="red" stroke="red" points="2841.79,-14978.5 2851.79,-14975 2841.79,-14971.5 2841.79,-14978.5"/>
</g>
<!-- ring_attn_1_0_stage_3 -->
<g id="node31" class="node">
<title>ring_attn_1_0_stage_3</title>
<polygon fill="yellow" stroke="black" points="225,-14537 16,-14469 225,-14401 434,-14469 225,-14537"/>
<text text-anchor="middle" x="225" y="-14487.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-14472.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="225" y="-14457.8" font-family="Times,serif" font-size="14.00">Q[0]×K[13]×V[13]</text>
<text text-anchor="middle" x="225" y="-14442.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_2&#45;&gt;ring_attn_1_0_stage_3 -->
<g id="edge30" class="edge">
<title>ring_attn_1_0_stage_2&#45;&gt;ring_attn_1_0_stage_3</title>
<path fill="none" stroke="black" d="M225,-14653.87C225,-14653.87 225,-14547.25 225,-14547.25"/>
<polygon fill="black" stroke="black" points="228.5,-14547.25 225,-14537.25 221.5,-14547.25 228.5,-14547.25"/>
</g>
<!-- ring_attn_1_1_stage_2 -->
<g id="node128" class="node">
<title>ring_attn_1_1_stage_2</title>
<polygon fill="yellow" stroke="black" points="3061,-14790 2852,-14722 3061,-14654 3270,-14722 3061,-14790"/>
<text text-anchor="middle" x="3061" y="-14740.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-14725.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="3061" y="-14710.8" font-family="Times,serif" font-size="14.00">Q[1]×K[15]×V[15]</text>
<text text-anchor="middle" x="3061" y="-14695.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_2&#45;&gt;ring_attn_1_1_stage_2 -->
<g id="edge1586" class="edge">
<title>ring_attn_1_0_stage_2&#45;&gt;ring_attn_1_1_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-14722C434.11,-14722 2841.79,-14722 2841.79,-14722"/>
<polygon fill="red" stroke="red" points="2841.79,-14725.5 2851.79,-14722 2841.79,-14718.5 2841.79,-14725.5"/>
</g>
<!-- ring_attn_1_0_stage_4 -->
<g id="node32" class="node">
<title>ring_attn_1_0_stage_4</title>
<polygon fill="yellow" stroke="black" points="225,-14284 16,-14216 225,-14148 434,-14216 225,-14284"/>
<text text-anchor="middle" x="225" y="-14234.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-14219.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="225" y="-14204.8" font-family="Times,serif" font-size="14.00">Q[0]×K[12]×V[12]</text>
<text text-anchor="middle" x="225" y="-14189.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_3&#45;&gt;ring_attn_1_0_stage_4 -->
<g id="edge31" class="edge">
<title>ring_attn_1_0_stage_3&#45;&gt;ring_attn_1_0_stage_4</title>
<path fill="none" stroke="black" d="M120.5,-14434.88C120.5,-14434.88 120.5,-14260.39 120.5,-14260.39"/>
<polygon fill="black" stroke="black" points="124,-14260.39 120.5,-14250.39 117,-14260.39 124,-14260.39"/>
</g>
<!-- ring_attn_1_1_stage_3 -->
<g id="node129" class="node">
<title>ring_attn_1_1_stage_3</title>
<polygon fill="yellow" stroke="black" points="3061,-14537 2852,-14469 3061,-14401 3270,-14469 3061,-14537"/>
<text text-anchor="middle" x="3061" y="-14487.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-14472.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="3061" y="-14457.8" font-family="Times,serif" font-size="14.00">Q[1]×K[14]×V[14]</text>
<text text-anchor="middle" x="3061" y="-14442.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_3&#45;&gt;ring_attn_1_1_stage_3 -->
<g id="edge1587" class="edge">
<title>ring_attn_1_0_stage_3&#45;&gt;ring_attn_1_1_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-14469C434.11,-14469 2841.79,-14469 2841.79,-14469"/>
<polygon fill="red" stroke="red" points="2841.79,-14472.5 2851.79,-14469 2841.79,-14465.5 2841.79,-14472.5"/>
</g>
<!-- ring_attn_1_0_stage_5 -->
<g id="node33" class="node">
<title>ring_attn_1_0_stage_5</title>
<polygon fill="yellow" stroke="black" points="225,-14031 16,-13963 225,-13895 434,-13963 225,-14031"/>
<text text-anchor="middle" x="225" y="-13981.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-13966.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="225" y="-13951.8" font-family="Times,serif" font-size="14.00">Q[0]×K[11]×V[11]</text>
<text text-anchor="middle" x="225" y="-13936.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_4&#45;&gt;ring_attn_1_0_stage_5 -->
<g id="edge32" class="edge">
<title>ring_attn_1_0_stage_4&#45;&gt;ring_attn_1_0_stage_5</title>
<path fill="none" stroke="black" d="M225,-14147.87C225,-14147.87 225,-14041.25 225,-14041.25"/>
<polygon fill="black" stroke="black" points="228.5,-14041.25 225,-14031.25 221.5,-14041.25 228.5,-14041.25"/>
</g>
<!-- ring_attn_1_1_stage_4 -->
<g id="node130" class="node">
<title>ring_attn_1_1_stage_4</title>
<polygon fill="yellow" stroke="black" points="3061,-14284 2852,-14216 3061,-14148 3270,-14216 3061,-14284"/>
<text text-anchor="middle" x="3061" y="-14234.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-14219.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="3061" y="-14204.8" font-family="Times,serif" font-size="14.00">Q[1]×K[13]×V[13]</text>
<text text-anchor="middle" x="3061" y="-14189.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_4&#45;&gt;ring_attn_1_1_stage_4 -->
<g id="edge1588" class="edge">
<title>ring_attn_1_0_stage_4&#45;&gt;ring_attn_1_1_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-14216C434.11,-14216 2841.79,-14216 2841.79,-14216"/>
<polygon fill="red" stroke="red" points="2841.79,-14219.5 2851.79,-14216 2841.79,-14212.5 2841.79,-14219.5"/>
</g>
<!-- ring_attn_1_0_stage_6 -->
<g id="node34" class="node">
<title>ring_attn_1_0_stage_6</title>
<polygon fill="yellow" stroke="black" points="225,-13778 16,-13710 225,-13642 434,-13710 225,-13778"/>
<text text-anchor="middle" x="225" y="-13728.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-13713.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="225" y="-13698.8" font-family="Times,serif" font-size="14.00">Q[0]×K[10]×V[10]</text>
<text text-anchor="middle" x="225" y="-13683.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_5&#45;&gt;ring_attn_1_0_stage_6 -->
<g id="edge33" class="edge">
<title>ring_attn_1_0_stage_5&#45;&gt;ring_attn_1_0_stage_6</title>
<path fill="none" stroke="black" d="M120.5,-13928.88C120.5,-13928.88 120.5,-13754.39 120.5,-13754.39"/>
<polygon fill="black" stroke="black" points="124,-13754.39 120.5,-13744.39 117,-13754.39 124,-13754.39"/>
</g>
<!-- ring_attn_1_1_stage_5 -->
<g id="node131" class="node">
<title>ring_attn_1_1_stage_5</title>
<polygon fill="yellow" stroke="black" points="3061,-14031 2852,-13963 3061,-13895 3270,-13963 3061,-14031"/>
<text text-anchor="middle" x="3061" y="-13981.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-13966.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="3061" y="-13951.8" font-family="Times,serif" font-size="14.00">Q[1]×K[12]×V[12]</text>
<text text-anchor="middle" x="3061" y="-13936.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_5&#45;&gt;ring_attn_1_1_stage_5 -->
<g id="edge1589" class="edge">
<title>ring_attn_1_0_stage_5&#45;&gt;ring_attn_1_1_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-13963C434.11,-13963 2841.79,-13963 2841.79,-13963"/>
<polygon fill="red" stroke="red" points="2841.79,-13966.5 2851.79,-13963 2841.79,-13959.5 2841.79,-13966.5"/>
</g>
<!-- ring_attn_1_0_stage_7 -->
<g id="node35" class="node">
<title>ring_attn_1_0_stage_7</title>
<polygon fill="yellow" stroke="black" points="225,-13525 16,-13457 225,-13389 434,-13457 225,-13525"/>
<text text-anchor="middle" x="225" y="-13475.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-13460.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="225" y="-13445.8" font-family="Times,serif" font-size="14.00">Q[0]×K[9]×V[9]</text>
<text text-anchor="middle" x="225" y="-13430.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_6&#45;&gt;ring_attn_1_0_stage_7 -->
<g id="edge34" class="edge">
<title>ring_attn_1_0_stage_6&#45;&gt;ring_attn_1_0_stage_7</title>
<path fill="none" stroke="black" d="M155.33,-13664.48C155.33,-13664.48 155.33,-13512.58 155.33,-13512.58"/>
<polygon fill="black" stroke="black" points="158.83,-13512.58 155.33,-13502.58 151.83,-13512.58 158.83,-13512.58"/>
</g>
<!-- ring_attn_1_1_stage_6 -->
<g id="node132" class="node">
<title>ring_attn_1_1_stage_6</title>
<polygon fill="yellow" stroke="black" points="3061,-13778 2852,-13710 3061,-13642 3270,-13710 3061,-13778"/>
<text text-anchor="middle" x="3061" y="-13728.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-13713.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="3061" y="-13698.8" font-family="Times,serif" font-size="14.00">Q[1]×K[11]×V[11]</text>
<text text-anchor="middle" x="3061" y="-13683.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_6&#45;&gt;ring_attn_1_1_stage_6 -->
<g id="edge1590" class="edge">
<title>ring_attn_1_0_stage_6&#45;&gt;ring_attn_1_1_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-13710C434.11,-13710 2841.79,-13710 2841.79,-13710"/>
<polygon fill="red" stroke="red" points="2841.79,-13713.5 2851.79,-13710 2841.79,-13706.5 2841.79,-13713.5"/>
</g>
<!-- ring_attn_1_0_stage_8 -->
<g id="node36" class="node">
<title>ring_attn_1_0_stage_8</title>
<polygon fill="yellow" stroke="black" points="225,-13272 16,-13204 225,-13136 434,-13204 225,-13272"/>
<text text-anchor="middle" x="225" y="-13222.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-13207.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="225" y="-13192.8" font-family="Times,serif" font-size="14.00">Q[0]×K[8]×V[8]</text>
<text text-anchor="middle" x="225" y="-13177.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_7&#45;&gt;ring_attn_1_0_stage_8 -->
<g id="edge35" class="edge">
<title>ring_attn_1_0_stage_7&#45;&gt;ring_attn_1_0_stage_8</title>
<path fill="none" stroke="black" d="M155.33,-13411.48C155.33,-13411.48 155.33,-13259.58 155.33,-13259.58"/>
<polygon fill="black" stroke="black" points="158.83,-13259.58 155.33,-13249.58 151.83,-13259.58 158.83,-13259.58"/>
</g>
<!-- ring_attn_1_1_stage_7 -->
<g id="node133" class="node">
<title>ring_attn_1_1_stage_7</title>
<polygon fill="yellow" stroke="black" points="3061,-13525 2852,-13457 3061,-13389 3270,-13457 3061,-13525"/>
<text text-anchor="middle" x="3061" y="-13475.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-13460.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="3061" y="-13445.8" font-family="Times,serif" font-size="14.00">Q[1]×K[10]×V[10]</text>
<text text-anchor="middle" x="3061" y="-13430.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_7&#45;&gt;ring_attn_1_1_stage_7 -->
<g id="edge1591" class="edge">
<title>ring_attn_1_0_stage_7&#45;&gt;ring_attn_1_1_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-13457C434.11,-13457 2841.79,-13457 2841.79,-13457"/>
<polygon fill="red" stroke="red" points="2841.79,-13460.5 2851.79,-13457 2841.79,-13453.5 2841.79,-13460.5"/>
</g>
<!-- ring_attn_1_0_stage_9 -->
<g id="node37" class="node">
<title>ring_attn_1_0_stage_9</title>
<polygon fill="yellow" stroke="black" points="225,-13019 16,-12951 225,-12883 434,-12951 225,-13019"/>
<text text-anchor="middle" x="225" y="-12969.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-12954.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="225" y="-12939.8" font-family="Times,serif" font-size="14.00">Q[0]×K[7]×V[7]</text>
<text text-anchor="middle" x="225" y="-12924.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_8&#45;&gt;ring_attn_1_0_stage_9 -->
<g id="edge36" class="edge">
<title>ring_attn_1_0_stage_8&#45;&gt;ring_attn_1_0_stage_9</title>
<path fill="none" stroke="black" d="M155.33,-13158.48C155.33,-13158.48 155.33,-13006.58 155.33,-13006.58"/>
<polygon fill="black" stroke="black" points="158.83,-13006.58 155.33,-12996.58 151.83,-13006.58 158.83,-13006.58"/>
</g>
<!-- ring_attn_1_1_stage_8 -->
<g id="node134" class="node">
<title>ring_attn_1_1_stage_8</title>
<polygon fill="yellow" stroke="black" points="3061,-13272 2852,-13204 3061,-13136 3270,-13204 3061,-13272"/>
<text text-anchor="middle" x="3061" y="-13222.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-13207.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="3061" y="-13192.8" font-family="Times,serif" font-size="14.00">Q[1]×K[9]×V[9]</text>
<text text-anchor="middle" x="3061" y="-13177.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_8&#45;&gt;ring_attn_1_1_stage_8 -->
<g id="edge1592" class="edge">
<title>ring_attn_1_0_stage_8&#45;&gt;ring_attn_1_1_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-13204C434.11,-13204 2841.79,-13204 2841.79,-13204"/>
<polygon fill="red" stroke="red" points="2841.79,-13207.5 2851.79,-13204 2841.79,-13200.5 2841.79,-13207.5"/>
</g>
<!-- ring_attn_1_0_stage_10 -->
<g id="node38" class="node">
<title>ring_attn_1_0_stage_10</title>
<polygon fill="yellow" stroke="black" points="225,-12766 16,-12698 225,-12630 434,-12698 225,-12766"/>
<text text-anchor="middle" x="225" y="-12716.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-12701.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="225" y="-12686.8" font-family="Times,serif" font-size="14.00">Q[0]×K[6]×V[6]</text>
<text text-anchor="middle" x="225" y="-12671.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_9&#45;&gt;ring_attn_1_0_stage_10 -->
<g id="edge37" class="edge">
<title>ring_attn_1_0_stage_9&#45;&gt;ring_attn_1_0_stage_10</title>
<path fill="none" stroke="black" d="M155.33,-12905.48C155.33,-12905.48 155.33,-12753.58 155.33,-12753.58"/>
<polygon fill="black" stroke="black" points="158.83,-12753.58 155.33,-12743.58 151.83,-12753.58 158.83,-12753.58"/>
</g>
<!-- ring_attn_1_1_stage_9 -->
<g id="node135" class="node">
<title>ring_attn_1_1_stage_9</title>
<polygon fill="yellow" stroke="black" points="3061,-13019 2852,-12951 3061,-12883 3270,-12951 3061,-13019"/>
<text text-anchor="middle" x="3061" y="-12969.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-12954.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="3061" y="-12939.8" font-family="Times,serif" font-size="14.00">Q[1]×K[8]×V[8]</text>
<text text-anchor="middle" x="3061" y="-12924.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_9&#45;&gt;ring_attn_1_1_stage_9 -->
<g id="edge1593" class="edge">
<title>ring_attn_1_0_stage_9&#45;&gt;ring_attn_1_1_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-12951C434.11,-12951 2841.79,-12951 2841.79,-12951"/>
<polygon fill="red" stroke="red" points="2841.79,-12954.5 2851.79,-12951 2841.79,-12947.5 2841.79,-12954.5"/>
</g>
<!-- ring_attn_1_0_stage_11 -->
<g id="node39" class="node">
<title>ring_attn_1_0_stage_11</title>
<polygon fill="yellow" stroke="black" points="225,-12513 16,-12445 225,-12377 434,-12445 225,-12513"/>
<text text-anchor="middle" x="225" y="-12463.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-12448.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="225" y="-12433.8" font-family="Times,serif" font-size="14.00">Q[0]×K[5]×V[5]</text>
<text text-anchor="middle" x="225" y="-12418.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_10&#45;&gt;ring_attn_1_0_stage_11 -->
<g id="edge38" class="edge">
<title>ring_attn_1_0_stage_10&#45;&gt;ring_attn_1_0_stage_11</title>
<path fill="none" stroke="black" d="M155.33,-12652.48C155.33,-12652.48 155.33,-12500.58 155.33,-12500.58"/>
<polygon fill="black" stroke="black" points="158.83,-12500.58 155.33,-12490.58 151.83,-12500.58 158.83,-12500.58"/>
</g>
<!-- ring_attn_1_1_stage_10 -->
<g id="node136" class="node">
<title>ring_attn_1_1_stage_10</title>
<polygon fill="yellow" stroke="black" points="3061,-12766 2852,-12698 3061,-12630 3270,-12698 3061,-12766"/>
<text text-anchor="middle" x="3061" y="-12716.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-12701.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="3061" y="-12686.8" font-family="Times,serif" font-size="14.00">Q[1]×K[7]×V[7]</text>
<text text-anchor="middle" x="3061" y="-12671.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_10&#45;&gt;ring_attn_1_1_stage_10 -->
<g id="edge1594" class="edge">
<title>ring_attn_1_0_stage_10&#45;&gt;ring_attn_1_1_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-12698C434.11,-12698 2841.79,-12698 2841.79,-12698"/>
<polygon fill="red" stroke="red" points="2841.79,-12701.5 2851.79,-12698 2841.79,-12694.5 2841.79,-12701.5"/>
</g>
<!-- ring_attn_1_0_stage_12 -->
<g id="node40" class="node">
<title>ring_attn_1_0_stage_12</title>
<polygon fill="yellow" stroke="black" points="225,-12260 16,-12192 225,-12124 434,-12192 225,-12260"/>
<text text-anchor="middle" x="225" y="-12210.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-12195.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="225" y="-12180.8" font-family="Times,serif" font-size="14.00">Q[0]×K[4]×V[4]</text>
<text text-anchor="middle" x="225" y="-12165.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_11&#45;&gt;ring_attn_1_0_stage_12 -->
<g id="edge39" class="edge">
<title>ring_attn_1_0_stage_11&#45;&gt;ring_attn_1_0_stage_12</title>
<path fill="none" stroke="black" d="M225,-12376.87C225,-12376.87 225,-12270.25 225,-12270.25"/>
<polygon fill="black" stroke="black" points="228.5,-12270.25 225,-12260.25 221.5,-12270.25 228.5,-12270.25"/>
</g>
<!-- ring_attn_1_1_stage_11 -->
<g id="node137" class="node">
<title>ring_attn_1_1_stage_11</title>
<polygon fill="yellow" stroke="black" points="3061,-12513 2852,-12445 3061,-12377 3270,-12445 3061,-12513"/>
<text text-anchor="middle" x="3061" y="-12463.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-12448.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="3061" y="-12433.8" font-family="Times,serif" font-size="14.00">Q[1]×K[6]×V[6]</text>
<text text-anchor="middle" x="3061" y="-12418.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_11&#45;&gt;ring_attn_1_1_stage_11 -->
<g id="edge1595" class="edge">
<title>ring_attn_1_0_stage_11&#45;&gt;ring_attn_1_1_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-12445C434.11,-12445 2841.79,-12445 2841.79,-12445"/>
<polygon fill="red" stroke="red" points="2841.79,-12448.5 2851.79,-12445 2841.79,-12441.5 2841.79,-12448.5"/>
</g>
<!-- ring_attn_1_0_stage_13 -->
<g id="node41" class="node">
<title>ring_attn_1_0_stage_13</title>
<polygon fill="yellow" stroke="black" points="225,-12007 16,-11939 225,-11871 434,-11939 225,-12007"/>
<text text-anchor="middle" x="225" y="-11957.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-11942.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="225" y="-11927.8" font-family="Times,serif" font-size="14.00">Q[0]×K[3]×V[3]</text>
<text text-anchor="middle" x="225" y="-11912.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_12&#45;&gt;ring_attn_1_0_stage_13 -->
<g id="edge40" class="edge">
<title>ring_attn_1_0_stage_12&#45;&gt;ring_attn_1_0_stage_13</title>
<path fill="none" stroke="black" d="M155.33,-12146.48C155.33,-12146.48 155.33,-11994.58 155.33,-11994.58"/>
<polygon fill="black" stroke="black" points="158.83,-11994.58 155.33,-11984.58 151.83,-11994.58 158.83,-11994.58"/>
</g>
<!-- ring_attn_1_1_stage_12 -->
<g id="node138" class="node">
<title>ring_attn_1_1_stage_12</title>
<polygon fill="yellow" stroke="black" points="3061,-12260 2852,-12192 3061,-12124 3270,-12192 3061,-12260"/>
<text text-anchor="middle" x="3061" y="-12210.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-12195.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="3061" y="-12180.8" font-family="Times,serif" font-size="14.00">Q[1]×K[5]×V[5]</text>
<text text-anchor="middle" x="3061" y="-12165.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_12&#45;&gt;ring_attn_1_1_stage_12 -->
<g id="edge1596" class="edge">
<title>ring_attn_1_0_stage_12&#45;&gt;ring_attn_1_1_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-12192C434.11,-12192 2841.79,-12192 2841.79,-12192"/>
<polygon fill="red" stroke="red" points="2841.79,-12195.5 2851.79,-12192 2841.79,-12188.5 2841.79,-12195.5"/>
</g>
<!-- ring_attn_1_0_stage_14 -->
<g id="node42" class="node">
<title>ring_attn_1_0_stage_14</title>
<polygon fill="yellow" stroke="black" points="225,-11754 16,-11686 225,-11618 434,-11686 225,-11754"/>
<text text-anchor="middle" x="225" y="-11704.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-11689.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="225" y="-11674.8" font-family="Times,serif" font-size="14.00">Q[0]×K[2]×V[2]</text>
<text text-anchor="middle" x="225" y="-11659.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_13&#45;&gt;ring_attn_1_0_stage_14 -->
<g id="edge41" class="edge">
<title>ring_attn_1_0_stage_13&#45;&gt;ring_attn_1_0_stage_14</title>
<path fill="none" stroke="black" d="M120.5,-11904.88C120.5,-11904.88 120.5,-11730.39 120.5,-11730.39"/>
<polygon fill="black" stroke="black" points="124,-11730.39 120.5,-11720.39 117,-11730.39 124,-11730.39"/>
</g>
<!-- ring_attn_1_1_stage_13 -->
<g id="node139" class="node">
<title>ring_attn_1_1_stage_13</title>
<polygon fill="yellow" stroke="black" points="3061,-12007 2852,-11939 3061,-11871 3270,-11939 3061,-12007"/>
<text text-anchor="middle" x="3061" y="-11957.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-11942.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="3061" y="-11927.8" font-family="Times,serif" font-size="14.00">Q[1]×K[4]×V[4]</text>
<text text-anchor="middle" x="3061" y="-11912.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_13&#45;&gt;ring_attn_1_1_stage_13 -->
<g id="edge1597" class="edge">
<title>ring_attn_1_0_stage_13&#45;&gt;ring_attn_1_1_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-11939C434.11,-11939 2841.79,-11939 2841.79,-11939"/>
<polygon fill="red" stroke="red" points="2841.79,-11942.5 2851.79,-11939 2841.79,-11935.5 2841.79,-11942.5"/>
</g>
<!-- ring_attn_1_0_stage_15 -->
<g id="node43" class="node">
<title>ring_attn_1_0_stage_15</title>
<polygon fill="yellow" stroke="black" points="225,-11501 16,-11433 225,-11365 434,-11433 225,-11501"/>
<text text-anchor="middle" x="225" y="-11451.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-11436.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="225" y="-11421.8" font-family="Times,serif" font-size="14.00">Q[0]×K[1]×V[1]</text>
<text text-anchor="middle" x="225" y="-11406.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_14&#45;&gt;ring_attn_1_0_stage_15 -->
<g id="edge42" class="edge">
<title>ring_attn_1_0_stage_14&#45;&gt;ring_attn_1_0_stage_15</title>
<path fill="none" stroke="black" d="M225,-11617.87C225,-11617.87 225,-11511.25 225,-11511.25"/>
<polygon fill="black" stroke="black" points="228.5,-11511.25 225,-11501.25 221.5,-11511.25 228.5,-11511.25"/>
</g>
<!-- ring_attn_1_1_stage_14 -->
<g id="node140" class="node">
<title>ring_attn_1_1_stage_14</title>
<polygon fill="yellow" stroke="black" points="3061,-11754 2852,-11686 3061,-11618 3270,-11686 3061,-11754"/>
<text text-anchor="middle" x="3061" y="-11704.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-11689.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="3061" y="-11674.8" font-family="Times,serif" font-size="14.00">Q[1]×K[3]×V[3]</text>
<text text-anchor="middle" x="3061" y="-11659.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_14&#45;&gt;ring_attn_1_1_stage_14 -->
<g id="edge1598" class="edge">
<title>ring_attn_1_0_stage_14&#45;&gt;ring_attn_1_1_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-11686C434.11,-11686 2841.79,-11686 2841.79,-11686"/>
<polygon fill="red" stroke="red" points="2841.79,-11689.5 2851.79,-11686 2841.79,-11682.5 2841.79,-11689.5"/>
</g>
<!-- attn_out_1_0 -->
<g id="node44" class="node">
<title>attn_out_1_0</title>
<polygon fill="none" stroke="black" points="294.5,-11292 155.5,-11292 155.5,-11239 294.5,-11239 294.5,-11292"/>
<text text-anchor="middle" x="225" y="-11276.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="225" y="-11261.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="225" y="-11246.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_1_0_stage_15&#45;&gt;attn_out_1_0 -->
<g id="edge43" class="edge">
<title>ring_attn_1_0_stage_15&#45;&gt;attn_out_1_0</title>
<path fill="none" stroke="black" d="M225,-11364.87C225,-11364.87 225,-11302.18 225,-11302.18"/>
<polygon fill="black" stroke="black" points="228.5,-11302.18 225,-11292.18 221.5,-11302.18 228.5,-11302.18"/>
</g>
<!-- ring_attn_1_1_stage_15 -->
<g id="node141" class="node">
<title>ring_attn_1_1_stage_15</title>
<polygon fill="yellow" stroke="black" points="3061,-11501 2852,-11433 3061,-11365 3270,-11433 3061,-11501"/>
<text text-anchor="middle" x="3061" y="-11451.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-11436.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="3061" y="-11421.8" font-family="Times,serif" font-size="14.00">Q[1]×K[2]×V[2]</text>
<text text-anchor="middle" x="3061" y="-11406.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_0_stage_15&#45;&gt;ring_attn_1_1_stage_15 -->
<g id="edge1599" class="edge">
<title>ring_attn_1_0_stage_15&#45;&gt;ring_attn_1_1_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-11433C434.11,-11433 2841.79,-11433 2841.79,-11433"/>
<polygon fill="red" stroke="red" points="2841.79,-11436.5 2851.79,-11433 2841.79,-11429.5 2841.79,-11436.5"/>
</g>
<!-- attn_residual_1_0 -->
<g id="node45" class="node">
<title>attn_residual_1_0</title>
<ellipse fill="none" stroke="black" cx="225" cy="-11139" rx="105.5" ry="27"/>
<text text-anchor="middle" x="225" y="-11142.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="225" y="-11127.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_1_0&#45;&gt;attn_residual_1_0 -->
<g id="edge44" class="edge">
<title>attn_out_1_0&#45;&gt;attn_residual_1_0</title>
<path fill="none" stroke="black" d="M225,-11238.98C225,-11238.98 225,-11176.36 225,-11176.36"/>
<polygon fill="black" stroke="black" points="228.5,-11176.36 225,-11166.36 221.5,-11176.36 228.5,-11176.36"/>
</g>
<!-- gate_1_0 -->
<g id="node46" class="node">
<title>gate_1_0</title>
<ellipse fill="orange" stroke="black" cx="225" cy="-11001.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="225" y="-11012.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="225" y="-10997.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="225" y="-10982.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_1_0&#45;&gt;gate_1_0 -->
<g id="edge45" class="edge">
<title>attn_residual_1_0&#45;&gt;gate_1_0</title>
<path fill="none" stroke="black" d="M145.88,-11121.02C145.88,-11121.02 145.88,-11036.47 145.88,-11036.47"/>
<polygon fill="black" stroke="black" points="149.38,-11036.47 145.88,-11026.47 142.38,-11036.47 149.38,-11036.47"/>
</g>
<!-- expert_1_0_0 -->
<g id="node47" class="node">
<title>expert_1_0_0</title>
<polygon fill="lightpink" stroke="black" points="344,-10832 106,-10832 106,-10779 344,-10779 344,-10832"/>
<text text-anchor="middle" x="225" y="-10816.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="225" y="-10801.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="225" y="-10786.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_1_0&#45;&gt;expert_1_0_0 -->
<g id="edge46" class="edge">
<title>gate_1_0&#45;&gt;expert_1_0_0</title>
<path fill="none" stroke="black" d="M133.57,-10982.71C133.57,-10982.71 133.57,-10842.29 133.57,-10842.29"/>
<polygon fill="black" stroke="black" points="137.07,-10842.29 133.57,-10832.29 130.07,-10842.29 137.07,-10842.29"/>
</g>
<!-- expert_1_1_0 -->
<g id="node145" class="node">
<title>expert_1_1_0</title>
<polygon fill="lightpink" stroke="black" points="3180,-10832 2942,-10832 2942,-10779 3180,-10779 3180,-10832"/>
<text text-anchor="middle" x="3061" y="-10816.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="3061" y="-10801.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="3061" y="-10786.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_1_0&#45;&gt;expert_1_1_0 -->
<g id="edge1600" class="edge">
<title>gate_1_0&#45;&gt;expert_1_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M324.76,-10989C815.39,-10989 2948.75,-10989 2948.75,-10989 2948.75,-10989 2948.75,-10842.18 2948.75,-10842.18"/>
<polygon fill="blue" stroke="blue" points="2952.25,-10842.18 2948.75,-10832.18 2945.25,-10842.18 2952.25,-10842.18"/>
<text text-anchor="middle" x="333.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="333.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU0→GPU1</text>
<text text-anchor="middle" x="333.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="333.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_2_0 -->
<g id="node243" class="node">
<title>expert_1_2_0</title>
<polygon fill="lightpink" stroke="black" points="3767,-10832 3529,-10832 3529,-10779 3767,-10779 3767,-10832"/>
<text text-anchor="middle" x="3648" y="-10816.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="3648" y="-10801.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="3648" y="-10786.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_1_0&#45;&gt;expert_1_2_0 -->
<g id="edge1601" class="edge">
<title>gate_1_0&#45;&gt;expert_1_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M217.97,-10963.91C217.97,-10962.09 217.97,-10961 217.97,-10961 217.97,-10961 3558.13,-10961 3558.13,-10961 3558.13,-10961 3558.13,-10842.23 3558.13,-10842.23"/>
<polygon fill="blue" stroke="blue" points="3561.63,-10842.23 3558.13,-10832.23 3554.63,-10842.23 3561.63,-10842.23"/>
<text text-anchor="middle" x="507.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="507.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU0→GPU2</text>
<text text-anchor="middle" x="507.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="507.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_3_0 -->
<g id="node341" class="node">
<title>expert_1_3_0</title>
<polygon fill="lightpink" stroke="black" points="4354,-10832 4116,-10832 4116,-10779 4354,-10779 4354,-10832"/>
<text text-anchor="middle" x="4235" y="-10816.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="4235" y="-10801.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="4235" y="-10786.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_1_0&#45;&gt;expert_1_3_0 -->
<g id="edge1602" class="edge">
<title>gate_1_0&#45;&gt;expert_1_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M232.03,-10963.87C232.03,-10951.57 232.03,-10941 232.03,-10941 232.03,-10941 4146.38,-10941 4146.38,-10941 4146.38,-10941 4146.38,-10842.27 4146.38,-10842.27"/>
<polygon fill="blue" stroke="blue" points="4149.88,-10842.27 4146.38,-10832.27 4142.88,-10842.27 4149.88,-10842.27"/>
<text text-anchor="middle" x="681.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="681.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU0→GPU3</text>
<text text-anchor="middle" x="681.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="681.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_4_0 -->
<g id="node439" class="node">
<title>expert_1_4_0</title>
<polygon fill="lightpink" stroke="black" points="4941,-10832 4703,-10832 4703,-10779 4941,-10779 4941,-10832"/>
<text text-anchor="middle" x="4822" y="-10816.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="4822" y="-10801.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="4822" y="-10786.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_1_0&#45;&gt;expert_1_4_0 -->
<g id="edge1603" class="edge">
<title>gate_1_0&#45;&gt;expert_1_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M246.1,-10964.74C246.1,-10915.44 246.1,-10834 246.1,-10834 246.1,-10834 4736.6,-10834 4736.6,-10834 4736.6,-10834 4736.6,-10833.81 4736.6,-10833.81"/>
<polygon fill="blue" stroke="blue" points="4740.1,-10842.13 4736.6,-10832.13 4733.1,-10842.13 4740.1,-10842.13"/>
<text text-anchor="middle" x="855.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="855.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU0→GPU4</text>
<text text-anchor="middle" x="855.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="855.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_5_0 -->
<g id="node537" class="node">
<title>expert_1_5_0</title>
<polygon fill="lightpink" stroke="black" points="5528,-10832 5290,-10832 5290,-10779 5528,-10779 5528,-10832"/>
<text text-anchor="middle" x="5409" y="-10816.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="5409" y="-10801.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="5409" y="-10786.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_1_0&#45;&gt;expert_1_5_0 -->
<g id="edge1604" class="edge">
<title>gate_1_0&#45;&gt;expert_1_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M260.17,-10965.91C260.17,-10950.1 260.17,-10935 260.17,-10935 260.17,-10935 5323.6,-10935 5323.6,-10935 5323.6,-10935 5323.6,-10842.02 5323.6,-10842.02"/>
<polygon fill="blue" stroke="blue" points="5327.1,-10842.02 5323.6,-10832.02 5320.1,-10842.02 5327.1,-10842.02"/>
<text text-anchor="middle" x="1029.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1029.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU0→GPU5</text>
<text text-anchor="middle" x="1029.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1029.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_6_0 -->
<g id="node635" class="node">
<title>expert_1_6_0</title>
<polygon fill="lightpink" stroke="black" points="6115,-10832 5877,-10832 5877,-10779 6115,-10779 6115,-10832"/>
<text text-anchor="middle" x="5996" y="-10816.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="5996" y="-10801.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="5996" y="-10786.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_1_0&#45;&gt;expert_1_6_0 -->
<g id="edge1605" class="edge">
<title>gate_1_0&#45;&gt;expert_1_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M274.23,-10968.21C274.23,-10920.14 274.23,-10837 274.23,-10837 274.23,-10837 5719.4,-10837 5719.4,-10837 5719.4,-10837 5719.4,-10814 5719.4,-10814 5719.4,-10814 5866.69,-10814 5866.69,-10814"/>
<polygon fill="blue" stroke="blue" points="5866.69,-10817.5 5876.69,-10814 5866.69,-10810.5 5866.69,-10817.5"/>
<text text-anchor="middle" x="1203.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1203.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU0→GPU6</text>
<text text-anchor="middle" x="1203.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1203.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_7_0 -->
<g id="node733" class="node">
<title>expert_1_7_0</title>
<polygon fill="lightpink" stroke="black" points="6702,-10832 6464,-10832 6464,-10779 6702,-10779 6702,-10832"/>
<text text-anchor="middle" x="6583" y="-10816.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="6583" y="-10801.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="6583" y="-10786.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_1_0&#45;&gt;expert_1_7_0 -->
<g id="edge1606" class="edge">
<title>gate_1_0&#45;&gt;expert_1_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M304.12,-11026.45C304.12,-11049.1 304.12,-11079 304.12,-11079 304.12,-11079 6129.5,-11079 6129.5,-11079 6129.5,-11079 6129.5,-10805 6129.5,-10805 6129.5,-10805 6453.85,-10805 6453.85,-10805"/>
<polygon fill="blue" stroke="blue" points="6453.85,-10808.5 6463.85,-10805 6453.85,-10801.5 6453.85,-10808.5"/>
<text text-anchor="middle" x="1377.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1377.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU0→GPU7</text>
<text text-anchor="middle" x="1377.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1377.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_8_0 -->
<g id="node831" class="node">
<title>expert_1_8_0</title>
<polygon fill="lightpink" stroke="black" points="7289,-10832 7051,-10832 7051,-10779 7289,-10779 7289,-10832"/>
<text text-anchor="middle" x="7170" y="-10816.8" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="7170" y="-10801.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="7170" y="-10786.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_1_0&#45;&gt;expert_1_8_0 -->
<g id="edge1607" class="edge">
<title>gate_1_0&#45;&gt;expert_1_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M277.75,-11034.2C277.75,-11058.7 277.75,-11088 277.75,-11088 277.75,-11088 6761.5,-11088 6761.5,-11088 6761.5,-11088 6761.5,-10805 6761.5,-10805 6761.5,-10805 7040.75,-10805 7040.75,-10805"/>
<polygon fill="blue" stroke="blue" points="7040.75,-10808.5 7050.75,-10805 7040.75,-10801.5 7040.75,-10808.5"/>
<text text-anchor="middle" x="1551.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1551.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU0→GPU8</text>
<text text-anchor="middle" x="1551.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1551.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_9_0 -->
<g id="node929" class="node">
<title>expert_1_9_0</title>
<polygon fill="lightpink" stroke="black" points="7876,-10832 7638,-10832 7638,-10779 7876,-10779 7876,-10832"/>
<text text-anchor="middle" x="7757" y="-10816.8" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="7757" y="-10801.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="7757" y="-10786.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_1_0&#45;&gt;expert_1_9_0 -->
<g id="edge1608" class="edge">
<title>gate_1_0&#45;&gt;expert_1_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M251.38,-11037.93C251.38,-11063.44 251.38,-11093 251.38,-11093 251.38,-11093 7348.5,-11093 7348.5,-11093 7348.5,-11093 7348.5,-10805 7348.5,-10805 7348.5,-10805 7627.75,-10805 7627.75,-10805"/>
<polygon fill="blue" stroke="blue" points="7627.75,-10808.5 7637.75,-10805 7627.75,-10801.5 7627.75,-10808.5"/>
<text text-anchor="middle" x="1725.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1725.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU0→GPU9</text>
<text text-anchor="middle" x="1725.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1725.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_10_0 -->
<g id="node1027" class="node">
<title>expert_1_10_0</title>
<polygon fill="lightpink" stroke="black" points="8463,-10832 8225,-10832 8225,-10779 8463,-10779 8463,-10832"/>
<text text-anchor="middle" x="8344" y="-10816.8" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="8344" y="-10801.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="8344" y="-10786.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_1_0&#45;&gt;expert_1_10_0 -->
<g id="edge1609" class="edge">
<title>gate_1_0&#45;&gt;expert_1_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M225,-11039.24C225,-11065.94 225,-11097 225,-11097 225,-11097 7935.5,-11097 7935.5,-11097 7935.5,-11097 7935.5,-10805 7935.5,-10805 7935.5,-10805 8214.75,-10805 8214.75,-10805"/>
<polygon fill="blue" stroke="blue" points="8214.75,-10808.5 8224.75,-10805 8214.75,-10801.5 8214.75,-10808.5"/>
<text text-anchor="middle" x="1899.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1899.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU0→GPU10</text>
<text text-anchor="middle" x="1899.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1899.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_11_0 -->
<g id="node1125" class="node">
<title>expert_1_11_0</title>
<polygon fill="lightpink" stroke="black" points="9050,-10832 8812,-10832 8812,-10779 9050,-10779 9050,-10832"/>
<text text-anchor="middle" x="8931" y="-10816.8" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="8931" y="-10801.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="8931" y="-10786.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_1_0&#45;&gt;expert_1_11_0 -->
<g id="edge1610" class="edge">
<title>gate_1_0&#45;&gt;expert_1_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M198.62,-11038.07C198.62,-11066.8 198.62,-11102 198.62,-11102 198.62,-11102 8522.5,-11102 8522.5,-11102 8522.5,-11102 8522.5,-10796 8522.5,-10796 8522.5,-10796 8801.75,-10796 8801.75,-10796"/>
<polygon fill="blue" stroke="blue" points="8801.75,-10799.5 8811.75,-10796 8801.75,-10792.5 8801.75,-10799.5"/>
<text text-anchor="middle" x="2073.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2073.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU0→GPU11</text>
<text text-anchor="middle" x="2073.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="2073.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_12_0 -->
<g id="node1223" class="node">
<title>expert_1_12_0</title>
<polygon fill="lightpink" stroke="black" points="9637,-10832 9399,-10832 9399,-10779 9637,-10779 9637,-10832"/>
<text text-anchor="middle" x="9518" y="-10816.8" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="9518" y="-10801.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="9518" y="-10786.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_1_0&#45;&gt;expert_1_12_0 -->
<g id="edge1611" class="edge">
<title>gate_1_0&#45;&gt;expert_1_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M172.25,-11034.01C172.25,-11065.01 172.25,-11107 172.25,-11107 172.25,-11107 9064.5,-11107 9064.5,-11107 9064.5,-11107 9064.5,-10805 9064.5,-10805 9064.5,-10805 9388.85,-10805 9388.85,-10805"/>
<polygon fill="blue" stroke="blue" points="9388.85,-10808.5 9398.85,-10805 9388.85,-10801.5 9388.85,-10808.5"/>
<text text-anchor="middle" x="2247.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2247.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU0→GPU12</text>
<text text-anchor="middle" x="2247.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="2247.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_13_0 -->
<g id="node1321" class="node">
<title>expert_1_13_0</title>
<polygon fill="lightpink" stroke="black" points="10224,-10832 9986,-10832 9986,-10779 10224,-10779 10224,-10832"/>
<text text-anchor="middle" x="10105" y="-10816.8" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="10105" y="-10801.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="10105" y="-10786.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_1_0&#45;&gt;expert_1_13_0 -->
<g id="edge1612" class="edge">
<title>gate_1_0&#45;&gt;expert_1_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M288.3,-10971.13C288.3,-10925.36 288.3,-10844 288.3,-10844 288.3,-10844 10016.38,-10844 10016.38,-10844 10016.38,-10844 10016.38,-10842.24 10016.38,-10842.24"/>
<polygon fill="blue" stroke="blue" points="10019.88,-10842.24 10016.38,-10832.24 10012.88,-10842.24 10019.88,-10842.24"/>
<text text-anchor="middle" x="2421.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2421.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU0→GPU13</text>
<text text-anchor="middle" x="2421.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="2421.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_14_0 -->
<g id="node1419" class="node">
<title>expert_1_14_0</title>
<polygon fill="lightpink" stroke="black" points="10811,-10832 10573,-10832 10573,-10779 10811,-10779 10811,-10832"/>
<text text-anchor="middle" x="10692" y="-10816.8" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="10692" y="-10801.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="10692" y="-10786.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_1_0&#45;&gt;expert_1_14_0 -->
<g id="edge1613" class="edge">
<title>gate_1_0&#45;&gt;expert_1_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M302.37,-10975.66C302.37,-10931.21 302.37,-10845 302.37,-10845 302.37,-10845 10606.6,-10845 10606.6,-10845 10606.6,-10845 10606.6,-10842.07 10606.6,-10842.07"/>
<polygon fill="blue" stroke="blue" points="10610.1,-10842.07 10606.6,-10832.07 10603.1,-10842.07 10610.1,-10842.07"/>
<text text-anchor="middle" x="2595.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2595.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU0→GPU14</text>
<text text-anchor="middle" x="2595.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="2595.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_15_0 -->
<g id="node1517" class="node">
<title>expert_1_15_0</title>
<polygon fill="lightpink" stroke="black" points="11398,-10832 11160,-10832 11160,-10779 11398,-10779 11398,-10832"/>
<text text-anchor="middle" x="11279" y="-10816.8" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="11279" y="-10801.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="11279" y="-10786.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_1_0&#45;&gt;expert_1_15_0 -->
<g id="edge1614" class="edge">
<title>gate_1_0&#45;&gt;expert_1_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M316.43,-10982.62C316.43,-10941 316.43,-10845 316.43,-10845 316.43,-10845 11195.71,-10845 11195.71,-10845 11195.71,-10845 11195.71,-10842.07 11195.71,-10842.07"/>
<polygon fill="blue" stroke="blue" points="11199.21,-10842.07 11195.71,-10832.07 11192.21,-10842.07 11199.21,-10842.07"/>
<text text-anchor="middle" x="2769.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2769.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU0→GPU15</text>
<text text-anchor="middle" x="2769.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="2769.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_0 -->
<g id="node48" class="node">
<title>expert_reduce_1_0</title>
<ellipse fill="none" stroke="black" cx="225" cy="-10668.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="225" y="-10679.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="225" y="-10664.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="225" y="-10649.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_0_0&#45;&gt;expert_reduce_1_0 -->
<g id="edge47" class="edge">
<title>expert_1_0_0&#45;&gt;expert_reduce_1_0</title>
<path fill="none" stroke="black" d="M225,-10778.76C225,-10778.76 225,-10716.06 225,-10716.06"/>
<polygon fill="black" stroke="black" points="228.5,-10716.06 225,-10706.06 221.5,-10716.06 228.5,-10716.06"/>
</g>
<!-- moe_residual_1_0 -->
<g id="node49" class="node">
<title>moe_residual_1_0</title>
<ellipse fill="none" stroke="black" cx="225" cy="-10531" rx="105.5" ry="27"/>
<text text-anchor="middle" x="225" y="-10534.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="225" y="-10519.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_0&#45;&gt;moe_residual_1_0 -->
<g id="edge48" class="edge">
<title>expert_reduce_1_0&#45;&gt;moe_residual_1_0</title>
<path fill="none" stroke="black" d="M225,-10630.93C225,-10630.93 225,-10568.06 225,-10568.06"/>
<polygon fill="black" stroke="black" points="228.5,-10568.06 225,-10558.06 221.5,-10568.06 228.5,-10568.06"/>
</g>
<!-- qkv_proj_2_0 -->
<g id="node50" class="node">
<title>qkv_proj_2_0</title>
<polygon fill="none" stroke="black" points="307.5,-10431 142.5,-10431 142.5,-10378 307.5,-10378 307.5,-10431"/>
<text text-anchor="middle" x="225" y="-10415.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="225" y="-10400.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="225" y="-10385.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_1_0&#45;&gt;qkv_proj_2_0 -->
<g id="edge49" class="edge">
<title>moe_residual_1_0&#45;&gt;qkv_proj_2_0</title>
<path fill="none" stroke="black" d="M225,-10503.86C225,-10503.86 225,-10441.16 225,-10441.16"/>
<polygon fill="black" stroke="black" points="228.5,-10441.16 225,-10431.16 221.5,-10441.16 228.5,-10441.16"/>
</g>
<!-- qkv_reshape_2_0 -->
<g id="node51" class="node">
<title>qkv_reshape_2_0</title>
<ellipse fill="none" stroke="black" cx="225" cy="-10278" rx="148" ry="27"/>
<text text-anchor="middle" x="225" y="-10281.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="225" y="-10266.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_2_0&#45;&gt;qkv_reshape_2_0 -->
<g id="edge50" class="edge">
<title>qkv_proj_2_0&#45;&gt;qkv_reshape_2_0</title>
<path fill="none" stroke="black" d="M225,-10377.98C225,-10377.98 225,-10315.36 225,-10315.36"/>
<polygon fill="black" stroke="black" points="228.5,-10315.36 225,-10305.36 221.5,-10315.36 228.5,-10315.36"/>
</g>
<!-- ring_attn_2_0_stage_0 -->
<g id="node52" class="node">
<title>ring_attn_2_0_stage_0</title>
<polygon fill="yellow" stroke="black" points="225,-10134 16,-10066 225,-9998 434,-10066 225,-10134"/>
<text text-anchor="middle" x="225" y="-10084.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-10069.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="225" y="-10054.8" font-family="Times,serif" font-size="14.00">Q[0]×K[0]×V[0]</text>
<text text-anchor="middle" x="225" y="-10039.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- qkv_reshape_2_0&#45;&gt;ring_attn_2_0_stage_0 -->
<g id="edge51" class="edge">
<title>qkv_reshape_2_0&#45;&gt;ring_attn_2_0_stage_0</title>
<path fill="none" stroke="black" d="M225,-10250.72C225,-10250.72 225,-10144.16 225,-10144.16"/>
<polygon fill="black" stroke="black" points="228.5,-10144.16 225,-10134.16 221.5,-10144.16 228.5,-10144.16"/>
</g>
<!-- ring_attn_2_0_stage_1 -->
<g id="node53" class="node">
<title>ring_attn_2_0_stage_1</title>
<polygon fill="yellow" stroke="black" points="225,-9881 16,-9813 225,-9745 434,-9813 225,-9881"/>
<text text-anchor="middle" x="225" y="-9831.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-9816.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="225" y="-9801.8" font-family="Times,serif" font-size="14.00">Q[0]×K[15]×V[15]</text>
<text text-anchor="middle" x="225" y="-9786.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_0&#45;&gt;ring_attn_2_0_stage_1 -->
<g id="edge52" class="edge">
<title>ring_attn_2_0_stage_0&#45;&gt;ring_attn_2_0_stage_1</title>
<path fill="none" stroke="black" d="M155.33,-10020.48C155.33,-10020.48 155.33,-9868.58 155.33,-9868.58"/>
<polygon fill="black" stroke="black" points="158.83,-9868.58 155.33,-9858.58 151.83,-9868.58 158.83,-9868.58"/>
</g>
<!-- ring_attn_2_1_stage_0 -->
<g id="node150" class="node">
<title>ring_attn_2_1_stage_0</title>
<polygon fill="yellow" stroke="black" points="3061,-10134 2852,-10066 3061,-9998 3270,-10066 3061,-10134"/>
<text text-anchor="middle" x="3061" y="-10084.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-10069.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="3061" y="-10054.8" font-family="Times,serif" font-size="14.00">Q[1]×K[1]×V[1]</text>
<text text-anchor="middle" x="3061" y="-10039.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_0&#45;&gt;ring_attn_2_1_stage_0 -->
<g id="edge1615" class="edge">
<title>ring_attn_2_0_stage_0&#45;&gt;ring_attn_2_1_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-10066C434.11,-10066 2841.79,-10066 2841.79,-10066"/>
<polygon fill="red" stroke="red" points="2841.79,-10069.5 2851.79,-10066 2841.79,-10062.5 2841.79,-10069.5"/>
</g>
<!-- ring_attn_2_0_stage_2 -->
<g id="node54" class="node">
<title>ring_attn_2_0_stage_2</title>
<polygon fill="yellow" stroke="black" points="225,-9628 16,-9560 225,-9492 434,-9560 225,-9628"/>
<text text-anchor="middle" x="225" y="-9578.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-9563.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="225" y="-9548.8" font-family="Times,serif" font-size="14.00">Q[0]×K[14]×V[14]</text>
<text text-anchor="middle" x="225" y="-9533.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_1&#45;&gt;ring_attn_2_0_stage_2 -->
<g id="edge53" class="edge">
<title>ring_attn_2_0_stage_1&#45;&gt;ring_attn_2_0_stage_2</title>
<path fill="none" stroke="black" d="M155.33,-9767.48C155.33,-9767.48 155.33,-9615.58 155.33,-9615.58"/>
<polygon fill="black" stroke="black" points="158.83,-9615.58 155.33,-9605.58 151.83,-9615.58 158.83,-9615.58"/>
</g>
<!-- ring_attn_2_1_stage_1 -->
<g id="node151" class="node">
<title>ring_attn_2_1_stage_1</title>
<polygon fill="yellow" stroke="black" points="3061,-9881 2852,-9813 3061,-9745 3270,-9813 3061,-9881"/>
<text text-anchor="middle" x="3061" y="-9831.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-9816.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="3061" y="-9801.8" font-family="Times,serif" font-size="14.00">Q[1]×K[0]×V[0]</text>
<text text-anchor="middle" x="3061" y="-9786.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_1&#45;&gt;ring_attn_2_1_stage_1 -->
<g id="edge1616" class="edge">
<title>ring_attn_2_0_stage_1&#45;&gt;ring_attn_2_1_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-9813C434.11,-9813 2841.79,-9813 2841.79,-9813"/>
<polygon fill="red" stroke="red" points="2841.79,-9816.5 2851.79,-9813 2841.79,-9809.5 2841.79,-9816.5"/>
</g>
<!-- ring_attn_2_0_stage_3 -->
<g id="node55" class="node">
<title>ring_attn_2_0_stage_3</title>
<polygon fill="yellow" stroke="black" points="225,-9375 16,-9307 225,-9239 434,-9307 225,-9375"/>
<text text-anchor="middle" x="225" y="-9325.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-9310.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="225" y="-9295.8" font-family="Times,serif" font-size="14.00">Q[0]×K[13]×V[13]</text>
<text text-anchor="middle" x="225" y="-9280.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_2&#45;&gt;ring_attn_2_0_stage_3 -->
<g id="edge54" class="edge">
<title>ring_attn_2_0_stage_2&#45;&gt;ring_attn_2_0_stage_3</title>
<path fill="none" stroke="black" d="M155.33,-9514.48C155.33,-9514.48 155.33,-9362.58 155.33,-9362.58"/>
<polygon fill="black" stroke="black" points="158.83,-9362.58 155.33,-9352.58 151.83,-9362.58 158.83,-9362.58"/>
</g>
<!-- ring_attn_2_1_stage_2 -->
<g id="node152" class="node">
<title>ring_attn_2_1_stage_2</title>
<polygon fill="yellow" stroke="black" points="3061,-9628 2852,-9560 3061,-9492 3270,-9560 3061,-9628"/>
<text text-anchor="middle" x="3061" y="-9578.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-9563.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="3061" y="-9548.8" font-family="Times,serif" font-size="14.00">Q[1]×K[15]×V[15]</text>
<text text-anchor="middle" x="3061" y="-9533.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_2&#45;&gt;ring_attn_2_1_stage_2 -->
<g id="edge1617" class="edge">
<title>ring_attn_2_0_stage_2&#45;&gt;ring_attn_2_1_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-9560C434.11,-9560 2841.79,-9560 2841.79,-9560"/>
<polygon fill="red" stroke="red" points="2841.79,-9563.5 2851.79,-9560 2841.79,-9556.5 2841.79,-9563.5"/>
</g>
<!-- ring_attn_2_0_stage_4 -->
<g id="node56" class="node">
<title>ring_attn_2_0_stage_4</title>
<polygon fill="yellow" stroke="black" points="225,-9122 16,-9054 225,-8986 434,-9054 225,-9122"/>
<text text-anchor="middle" x="225" y="-9072.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-9057.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="225" y="-9042.8" font-family="Times,serif" font-size="14.00">Q[0]×K[12]×V[12]</text>
<text text-anchor="middle" x="225" y="-9027.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_3&#45;&gt;ring_attn_2_0_stage_4 -->
<g id="edge55" class="edge">
<title>ring_attn_2_0_stage_3&#45;&gt;ring_attn_2_0_stage_4</title>
<path fill="none" stroke="black" d="M225,-9238.87C225,-9238.87 225,-9132.25 225,-9132.25"/>
<polygon fill="black" stroke="black" points="228.5,-9132.25 225,-9122.25 221.5,-9132.25 228.5,-9132.25"/>
</g>
<!-- ring_attn_2_1_stage_3 -->
<g id="node153" class="node">
<title>ring_attn_2_1_stage_3</title>
<polygon fill="yellow" stroke="black" points="3061,-9375 2852,-9307 3061,-9239 3270,-9307 3061,-9375"/>
<text text-anchor="middle" x="3061" y="-9325.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-9310.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="3061" y="-9295.8" font-family="Times,serif" font-size="14.00">Q[1]×K[14]×V[14]</text>
<text text-anchor="middle" x="3061" y="-9280.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_3&#45;&gt;ring_attn_2_1_stage_3 -->
<g id="edge1618" class="edge">
<title>ring_attn_2_0_stage_3&#45;&gt;ring_attn_2_1_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-9307C434.11,-9307 2841.79,-9307 2841.79,-9307"/>
<polygon fill="red" stroke="red" points="2841.79,-9310.5 2851.79,-9307 2841.79,-9303.5 2841.79,-9310.5"/>
</g>
<!-- ring_attn_2_0_stage_5 -->
<g id="node57" class="node">
<title>ring_attn_2_0_stage_5</title>
<polygon fill="yellow" stroke="black" points="225,-8869 16,-8801 225,-8733 434,-8801 225,-8869"/>
<text text-anchor="middle" x="225" y="-8819.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-8804.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="225" y="-8789.8" font-family="Times,serif" font-size="14.00">Q[0]×K[11]×V[11]</text>
<text text-anchor="middle" x="225" y="-8774.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_4&#45;&gt;ring_attn_2_0_stage_5 -->
<g id="edge56" class="edge">
<title>ring_attn_2_0_stage_4&#45;&gt;ring_attn_2_0_stage_5</title>
<path fill="none" stroke="black" d="M155.33,-9008.48C155.33,-9008.48 155.33,-8856.58 155.33,-8856.58"/>
<polygon fill="black" stroke="black" points="158.83,-8856.58 155.33,-8846.58 151.83,-8856.58 158.83,-8856.58"/>
</g>
<!-- ring_attn_2_1_stage_4 -->
<g id="node154" class="node">
<title>ring_attn_2_1_stage_4</title>
<polygon fill="yellow" stroke="black" points="3061,-9122 2852,-9054 3061,-8986 3270,-9054 3061,-9122"/>
<text text-anchor="middle" x="3061" y="-9072.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-9057.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="3061" y="-9042.8" font-family="Times,serif" font-size="14.00">Q[1]×K[13]×V[13]</text>
<text text-anchor="middle" x="3061" y="-9027.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_4&#45;&gt;ring_attn_2_1_stage_4 -->
<g id="edge1619" class="edge">
<title>ring_attn_2_0_stage_4&#45;&gt;ring_attn_2_1_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-9054C434.11,-9054 2841.79,-9054 2841.79,-9054"/>
<polygon fill="red" stroke="red" points="2841.79,-9057.5 2851.79,-9054 2841.79,-9050.5 2841.79,-9057.5"/>
</g>
<!-- ring_attn_2_0_stage_6 -->
<g id="node58" class="node">
<title>ring_attn_2_0_stage_6</title>
<polygon fill="yellow" stroke="black" points="225,-8616 16,-8548 225,-8480 434,-8548 225,-8616"/>
<text text-anchor="middle" x="225" y="-8566.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-8551.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="225" y="-8536.8" font-family="Times,serif" font-size="14.00">Q[0]×K[10]×V[10]</text>
<text text-anchor="middle" x="225" y="-8521.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_5&#45;&gt;ring_attn_2_0_stage_6 -->
<g id="edge57" class="edge">
<title>ring_attn_2_0_stage_5&#45;&gt;ring_attn_2_0_stage_6</title>
<path fill="none" stroke="black" d="M155.33,-8755.48C155.33,-8755.48 155.33,-8603.58 155.33,-8603.58"/>
<polygon fill="black" stroke="black" points="158.83,-8603.58 155.33,-8593.58 151.83,-8603.58 158.83,-8603.58"/>
</g>
<!-- ring_attn_2_1_stage_5 -->
<g id="node155" class="node">
<title>ring_attn_2_1_stage_5</title>
<polygon fill="yellow" stroke="black" points="3061,-8869 2852,-8801 3061,-8733 3270,-8801 3061,-8869"/>
<text text-anchor="middle" x="3061" y="-8819.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-8804.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="3061" y="-8789.8" font-family="Times,serif" font-size="14.00">Q[1]×K[12]×V[12]</text>
<text text-anchor="middle" x="3061" y="-8774.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_5&#45;&gt;ring_attn_2_1_stage_5 -->
<g id="edge1620" class="edge">
<title>ring_attn_2_0_stage_5&#45;&gt;ring_attn_2_1_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-8801C434.11,-8801 2841.79,-8801 2841.79,-8801"/>
<polygon fill="red" stroke="red" points="2841.79,-8804.5 2851.79,-8801 2841.79,-8797.5 2841.79,-8804.5"/>
</g>
<!-- ring_attn_2_0_stage_7 -->
<g id="node59" class="node">
<title>ring_attn_2_0_stage_7</title>
<polygon fill="yellow" stroke="black" points="225,-8363 16,-8295 225,-8227 434,-8295 225,-8363"/>
<text text-anchor="middle" x="225" y="-8313.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-8298.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="225" y="-8283.8" font-family="Times,serif" font-size="14.00">Q[0]×K[9]×V[9]</text>
<text text-anchor="middle" x="225" y="-8268.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_6&#45;&gt;ring_attn_2_0_stage_7 -->
<g id="edge58" class="edge">
<title>ring_attn_2_0_stage_6&#45;&gt;ring_attn_2_0_stage_7</title>
<path fill="none" stroke="black" d="M120.5,-8513.88C120.5,-8513.88 120.5,-8339.39 120.5,-8339.39"/>
<polygon fill="black" stroke="black" points="124,-8339.39 120.5,-8329.39 117,-8339.39 124,-8339.39"/>
</g>
<!-- ring_attn_2_1_stage_6 -->
<g id="node156" class="node">
<title>ring_attn_2_1_stage_6</title>
<polygon fill="yellow" stroke="black" points="3061,-8616 2852,-8548 3061,-8480 3270,-8548 3061,-8616"/>
<text text-anchor="middle" x="3061" y="-8566.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-8551.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="3061" y="-8536.8" font-family="Times,serif" font-size="14.00">Q[1]×K[11]×V[11]</text>
<text text-anchor="middle" x="3061" y="-8521.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_6&#45;&gt;ring_attn_2_1_stage_6 -->
<g id="edge1621" class="edge">
<title>ring_attn_2_0_stage_6&#45;&gt;ring_attn_2_1_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-8548C434.11,-8548 2841.79,-8548 2841.79,-8548"/>
<polygon fill="red" stroke="red" points="2841.79,-8551.5 2851.79,-8548 2841.79,-8544.5 2841.79,-8551.5"/>
</g>
<!-- ring_attn_2_0_stage_8 -->
<g id="node60" class="node">
<title>ring_attn_2_0_stage_8</title>
<polygon fill="yellow" stroke="black" points="225,-8110 16,-8042 225,-7974 434,-8042 225,-8110"/>
<text text-anchor="middle" x="225" y="-8060.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-8045.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="225" y="-8030.8" font-family="Times,serif" font-size="14.00">Q[0]×K[8]×V[8]</text>
<text text-anchor="middle" x="225" y="-8015.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_7&#45;&gt;ring_attn_2_0_stage_8 -->
<g id="edge59" class="edge">
<title>ring_attn_2_0_stage_7&#45;&gt;ring_attn_2_0_stage_8</title>
<path fill="none" stroke="black" d="M155.33,-8249.48C155.33,-8249.48 155.33,-8097.58 155.33,-8097.58"/>
<polygon fill="black" stroke="black" points="158.83,-8097.58 155.33,-8087.58 151.83,-8097.58 158.83,-8097.58"/>
</g>
<!-- ring_attn_2_1_stage_7 -->
<g id="node157" class="node">
<title>ring_attn_2_1_stage_7</title>
<polygon fill="yellow" stroke="black" points="3061,-8363 2852,-8295 3061,-8227 3270,-8295 3061,-8363"/>
<text text-anchor="middle" x="3061" y="-8313.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-8298.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="3061" y="-8283.8" font-family="Times,serif" font-size="14.00">Q[1]×K[10]×V[10]</text>
<text text-anchor="middle" x="3061" y="-8268.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_7&#45;&gt;ring_attn_2_1_stage_7 -->
<g id="edge1622" class="edge">
<title>ring_attn_2_0_stage_7&#45;&gt;ring_attn_2_1_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-8295C434.11,-8295 2841.79,-8295 2841.79,-8295"/>
<polygon fill="red" stroke="red" points="2841.79,-8298.5 2851.79,-8295 2841.79,-8291.5 2841.79,-8298.5"/>
</g>
<!-- ring_attn_2_0_stage_9 -->
<g id="node61" class="node">
<title>ring_attn_2_0_stage_9</title>
<polygon fill="yellow" stroke="black" points="225,-7857 16,-7789 225,-7721 434,-7789 225,-7857"/>
<text text-anchor="middle" x="225" y="-7807.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-7792.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="225" y="-7777.8" font-family="Times,serif" font-size="14.00">Q[0]×K[7]×V[7]</text>
<text text-anchor="middle" x="225" y="-7762.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_8&#45;&gt;ring_attn_2_0_stage_9 -->
<g id="edge60" class="edge">
<title>ring_attn_2_0_stage_8&#45;&gt;ring_attn_2_0_stage_9</title>
<path fill="none" stroke="black" d="M225,-7973.87C225,-7973.87 225,-7867.25 225,-7867.25"/>
<polygon fill="black" stroke="black" points="228.5,-7867.25 225,-7857.25 221.5,-7867.25 228.5,-7867.25"/>
</g>
<!-- ring_attn_2_1_stage_8 -->
<g id="node158" class="node">
<title>ring_attn_2_1_stage_8</title>
<polygon fill="yellow" stroke="black" points="3061,-8110 2852,-8042 3061,-7974 3270,-8042 3061,-8110"/>
<text text-anchor="middle" x="3061" y="-8060.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-8045.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="3061" y="-8030.8" font-family="Times,serif" font-size="14.00">Q[1]×K[9]×V[9]</text>
<text text-anchor="middle" x="3061" y="-8015.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_8&#45;&gt;ring_attn_2_1_stage_8 -->
<g id="edge1623" class="edge">
<title>ring_attn_2_0_stage_8&#45;&gt;ring_attn_2_1_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-8042C434.11,-8042 2841.79,-8042 2841.79,-8042"/>
<polygon fill="red" stroke="red" points="2841.79,-8045.5 2851.79,-8042 2841.79,-8038.5 2841.79,-8045.5"/>
</g>
<!-- ring_attn_2_0_stage_10 -->
<g id="node62" class="node">
<title>ring_attn_2_0_stage_10</title>
<polygon fill="yellow" stroke="black" points="225,-7604 16,-7536 225,-7468 434,-7536 225,-7604"/>
<text text-anchor="middle" x="225" y="-7554.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-7539.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="225" y="-7524.8" font-family="Times,serif" font-size="14.00">Q[0]×K[6]×V[6]</text>
<text text-anchor="middle" x="225" y="-7509.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_9&#45;&gt;ring_attn_2_0_stage_10 -->
<g id="edge61" class="edge">
<title>ring_attn_2_0_stage_9&#45;&gt;ring_attn_2_0_stage_10</title>
<path fill="none" stroke="black" d="M120.5,-7754.88C120.5,-7754.88 120.5,-7580.39 120.5,-7580.39"/>
<polygon fill="black" stroke="black" points="124,-7580.39 120.5,-7570.39 117,-7580.39 124,-7580.39"/>
</g>
<!-- ring_attn_2_1_stage_9 -->
<g id="node159" class="node">
<title>ring_attn_2_1_stage_9</title>
<polygon fill="yellow" stroke="black" points="3061,-7857 2852,-7789 3061,-7721 3270,-7789 3061,-7857"/>
<text text-anchor="middle" x="3061" y="-7807.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-7792.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="3061" y="-7777.8" font-family="Times,serif" font-size="14.00">Q[1]×K[8]×V[8]</text>
<text text-anchor="middle" x="3061" y="-7762.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_9&#45;&gt;ring_attn_2_1_stage_9 -->
<g id="edge1624" class="edge">
<title>ring_attn_2_0_stage_9&#45;&gt;ring_attn_2_1_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-7789C434.11,-7789 2841.79,-7789 2841.79,-7789"/>
<polygon fill="red" stroke="red" points="2841.79,-7792.5 2851.79,-7789 2841.79,-7785.5 2841.79,-7792.5"/>
</g>
<!-- ring_attn_2_0_stage_11 -->
<g id="node63" class="node">
<title>ring_attn_2_0_stage_11</title>
<polygon fill="yellow" stroke="black" points="225,-7351 16,-7283 225,-7215 434,-7283 225,-7351"/>
<text text-anchor="middle" x="225" y="-7301.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-7286.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="225" y="-7271.8" font-family="Times,serif" font-size="14.00">Q[0]×K[5]×V[5]</text>
<text text-anchor="middle" x="225" y="-7256.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_10&#45;&gt;ring_attn_2_0_stage_11 -->
<g id="edge62" class="edge">
<title>ring_attn_2_0_stage_10&#45;&gt;ring_attn_2_0_stage_11</title>
<path fill="none" stroke="black" d="M155.33,-7490.48C155.33,-7490.48 155.33,-7338.58 155.33,-7338.58"/>
<polygon fill="black" stroke="black" points="158.83,-7338.58 155.33,-7328.58 151.83,-7338.58 158.83,-7338.58"/>
</g>
<!-- ring_attn_2_1_stage_10 -->
<g id="node160" class="node">
<title>ring_attn_2_1_stage_10</title>
<polygon fill="yellow" stroke="black" points="3061,-7604 2852,-7536 3061,-7468 3270,-7536 3061,-7604"/>
<text text-anchor="middle" x="3061" y="-7554.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-7539.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="3061" y="-7524.8" font-family="Times,serif" font-size="14.00">Q[1]×K[7]×V[7]</text>
<text text-anchor="middle" x="3061" y="-7509.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_10&#45;&gt;ring_attn_2_1_stage_10 -->
<g id="edge1625" class="edge">
<title>ring_attn_2_0_stage_10&#45;&gt;ring_attn_2_1_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-7536C434.11,-7536 2841.79,-7536 2841.79,-7536"/>
<polygon fill="red" stroke="red" points="2841.79,-7539.5 2851.79,-7536 2841.79,-7532.5 2841.79,-7539.5"/>
</g>
<!-- ring_attn_2_0_stage_12 -->
<g id="node64" class="node">
<title>ring_attn_2_0_stage_12</title>
<polygon fill="yellow" stroke="black" points="225,-7098 16,-7030 225,-6962 434,-7030 225,-7098"/>
<text text-anchor="middle" x="225" y="-7048.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-7033.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="225" y="-7018.8" font-family="Times,serif" font-size="14.00">Q[0]×K[4]×V[4]</text>
<text text-anchor="middle" x="225" y="-7003.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_11&#45;&gt;ring_attn_2_0_stage_12 -->
<g id="edge63" class="edge">
<title>ring_attn_2_0_stage_11&#45;&gt;ring_attn_2_0_stage_12</title>
<path fill="none" stroke="black" d="M155.33,-7237.48C155.33,-7237.48 155.33,-7085.58 155.33,-7085.58"/>
<polygon fill="black" stroke="black" points="158.83,-7085.58 155.33,-7075.58 151.83,-7085.58 158.83,-7085.58"/>
</g>
<!-- ring_attn_2_1_stage_11 -->
<g id="node161" class="node">
<title>ring_attn_2_1_stage_11</title>
<polygon fill="yellow" stroke="black" points="3061,-7351 2852,-7283 3061,-7215 3270,-7283 3061,-7351"/>
<text text-anchor="middle" x="3061" y="-7301.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-7286.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="3061" y="-7271.8" font-family="Times,serif" font-size="14.00">Q[1]×K[6]×V[6]</text>
<text text-anchor="middle" x="3061" y="-7256.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_11&#45;&gt;ring_attn_2_1_stage_11 -->
<g id="edge1626" class="edge">
<title>ring_attn_2_0_stage_11&#45;&gt;ring_attn_2_1_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-7283C434.11,-7283 2841.79,-7283 2841.79,-7283"/>
<polygon fill="red" stroke="red" points="2841.79,-7286.5 2851.79,-7283 2841.79,-7279.5 2841.79,-7286.5"/>
</g>
<!-- ring_attn_2_0_stage_13 -->
<g id="node65" class="node">
<title>ring_attn_2_0_stage_13</title>
<polygon fill="yellow" stroke="black" points="225,-6845 16,-6777 225,-6709 434,-6777 225,-6845"/>
<text text-anchor="middle" x="225" y="-6795.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-6780.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="225" y="-6765.8" font-family="Times,serif" font-size="14.00">Q[0]×K[3]×V[3]</text>
<text text-anchor="middle" x="225" y="-6750.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_12&#45;&gt;ring_attn_2_0_stage_13 -->
<g id="edge64" class="edge">
<title>ring_attn_2_0_stage_12&#45;&gt;ring_attn_2_0_stage_13</title>
<path fill="none" stroke="black" d="M155.33,-6984.48C155.33,-6984.48 155.33,-6832.58 155.33,-6832.58"/>
<polygon fill="black" stroke="black" points="158.83,-6832.58 155.33,-6822.58 151.83,-6832.58 158.83,-6832.58"/>
</g>
<!-- ring_attn_2_1_stage_12 -->
<g id="node162" class="node">
<title>ring_attn_2_1_stage_12</title>
<polygon fill="yellow" stroke="black" points="3061,-7098 2852,-7030 3061,-6962 3270,-7030 3061,-7098"/>
<text text-anchor="middle" x="3061" y="-7048.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-7033.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="3061" y="-7018.8" font-family="Times,serif" font-size="14.00">Q[1]×K[5]×V[5]</text>
<text text-anchor="middle" x="3061" y="-7003.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_12&#45;&gt;ring_attn_2_1_stage_12 -->
<g id="edge1627" class="edge">
<title>ring_attn_2_0_stage_12&#45;&gt;ring_attn_2_1_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-7030C434.11,-7030 2841.79,-7030 2841.79,-7030"/>
<polygon fill="red" stroke="red" points="2841.79,-7033.5 2851.79,-7030 2841.79,-7026.5 2841.79,-7033.5"/>
</g>
<!-- ring_attn_2_0_stage_14 -->
<g id="node66" class="node">
<title>ring_attn_2_0_stage_14</title>
<polygon fill="yellow" stroke="black" points="225,-6592 16,-6524 225,-6456 434,-6524 225,-6592"/>
<text text-anchor="middle" x="225" y="-6542.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-6527.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="225" y="-6512.8" font-family="Times,serif" font-size="14.00">Q[0]×K[2]×V[2]</text>
<text text-anchor="middle" x="225" y="-6497.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_13&#45;&gt;ring_attn_2_0_stage_14 -->
<g id="edge65" class="edge">
<title>ring_attn_2_0_stage_13&#45;&gt;ring_attn_2_0_stage_14</title>
<path fill="none" stroke="black" d="M225,-6708.87C225,-6708.87 225,-6602.25 225,-6602.25"/>
<polygon fill="black" stroke="black" points="228.5,-6602.25 225,-6592.25 221.5,-6602.25 228.5,-6602.25"/>
</g>
<!-- ring_attn_2_1_stage_13 -->
<g id="node163" class="node">
<title>ring_attn_2_1_stage_13</title>
<polygon fill="yellow" stroke="black" points="3061,-6845 2852,-6777 3061,-6709 3270,-6777 3061,-6845"/>
<text text-anchor="middle" x="3061" y="-6795.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-6780.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="3061" y="-6765.8" font-family="Times,serif" font-size="14.00">Q[1]×K[4]×V[4]</text>
<text text-anchor="middle" x="3061" y="-6750.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_13&#45;&gt;ring_attn_2_1_stage_13 -->
<g id="edge1628" class="edge">
<title>ring_attn_2_0_stage_13&#45;&gt;ring_attn_2_1_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-6777C434.11,-6777 2841.79,-6777 2841.79,-6777"/>
<polygon fill="red" stroke="red" points="2841.79,-6780.5 2851.79,-6777 2841.79,-6773.5 2841.79,-6780.5"/>
</g>
<!-- ring_attn_2_0_stage_15 -->
<g id="node67" class="node">
<title>ring_attn_2_0_stage_15</title>
<polygon fill="yellow" stroke="black" points="225,-6339 16,-6271 225,-6203 434,-6271 225,-6339"/>
<text text-anchor="middle" x="225" y="-6289.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-6274.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="225" y="-6259.8" font-family="Times,serif" font-size="14.00">Q[0]×K[1]×V[1]</text>
<text text-anchor="middle" x="225" y="-6244.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_14&#45;&gt;ring_attn_2_0_stage_15 -->
<g id="edge66" class="edge">
<title>ring_attn_2_0_stage_14&#45;&gt;ring_attn_2_0_stage_15</title>
<path fill="none" stroke="black" d="M155.33,-6478.48C155.33,-6478.48 155.33,-6326.58 155.33,-6326.58"/>
<polygon fill="black" stroke="black" points="158.83,-6326.58 155.33,-6316.58 151.83,-6326.58 158.83,-6326.58"/>
</g>
<!-- ring_attn_2_1_stage_14 -->
<g id="node164" class="node">
<title>ring_attn_2_1_stage_14</title>
<polygon fill="yellow" stroke="black" points="3061,-6592 2852,-6524 3061,-6456 3270,-6524 3061,-6592"/>
<text text-anchor="middle" x="3061" y="-6542.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-6527.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="3061" y="-6512.8" font-family="Times,serif" font-size="14.00">Q[1]×K[3]×V[3]</text>
<text text-anchor="middle" x="3061" y="-6497.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_14&#45;&gt;ring_attn_2_1_stage_14 -->
<g id="edge1629" class="edge">
<title>ring_attn_2_0_stage_14&#45;&gt;ring_attn_2_1_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-6524C434.11,-6524 2841.79,-6524 2841.79,-6524"/>
<polygon fill="red" stroke="red" points="2841.79,-6527.5 2851.79,-6524 2841.79,-6520.5 2841.79,-6527.5"/>
</g>
<!-- attn_out_2_0 -->
<g id="node68" class="node">
<title>attn_out_2_0</title>
<polygon fill="none" stroke="black" points="294.5,-6130 155.5,-6130 155.5,-6077 294.5,-6077 294.5,-6130"/>
<text text-anchor="middle" x="225" y="-6114.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="225" y="-6099.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="225" y="-6084.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_2_0_stage_15&#45;&gt;attn_out_2_0 -->
<g id="edge67" class="edge">
<title>ring_attn_2_0_stage_15&#45;&gt;attn_out_2_0</title>
<path fill="none" stroke="black" d="M225,-6202.87C225,-6202.87 225,-6140.18 225,-6140.18"/>
<polygon fill="black" stroke="black" points="228.5,-6140.18 225,-6130.18 221.5,-6140.18 228.5,-6140.18"/>
</g>
<!-- ring_attn_2_1_stage_15 -->
<g id="node165" class="node">
<title>ring_attn_2_1_stage_15</title>
<polygon fill="yellow" stroke="black" points="3061,-6339 2852,-6271 3061,-6203 3270,-6271 3061,-6339"/>
<text text-anchor="middle" x="3061" y="-6289.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-6274.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="3061" y="-6259.8" font-family="Times,serif" font-size="14.00">Q[1]×K[2]×V[2]</text>
<text text-anchor="middle" x="3061" y="-6244.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_0_stage_15&#45;&gt;ring_attn_2_1_stage_15 -->
<g id="edge1630" class="edge">
<title>ring_attn_2_0_stage_15&#45;&gt;ring_attn_2_1_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-6271C434.11,-6271 2841.79,-6271 2841.79,-6271"/>
<polygon fill="red" stroke="red" points="2841.79,-6274.5 2851.79,-6271 2841.79,-6267.5 2841.79,-6274.5"/>
</g>
<!-- attn_residual_2_0 -->
<g id="node69" class="node">
<title>attn_residual_2_0</title>
<ellipse fill="none" stroke="black" cx="225" cy="-5977" rx="105.5" ry="27"/>
<text text-anchor="middle" x="225" y="-5980.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="225" y="-5965.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_2_0&#45;&gt;attn_residual_2_0 -->
<g id="edge68" class="edge">
<title>attn_out_2_0&#45;&gt;attn_residual_2_0</title>
<path fill="none" stroke="black" d="M225,-6076.98C225,-6076.98 225,-6014.36 225,-6014.36"/>
<polygon fill="black" stroke="black" points="228.5,-6014.36 225,-6004.36 221.5,-6014.36 228.5,-6014.36"/>
</g>
<!-- gate_2_0 -->
<g id="node70" class="node">
<title>gate_2_0</title>
<ellipse fill="orange" stroke="black" cx="225" cy="-5839.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="225" y="-5850.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="225" y="-5835.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="225" y="-5820.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_2_0&#45;&gt;gate_2_0 -->
<g id="edge69" class="edge">
<title>attn_residual_2_0&#45;&gt;gate_2_0</title>
<path fill="none" stroke="black" d="M145.88,-5959.02C145.88,-5959.02 145.88,-5874.47 145.88,-5874.47"/>
<polygon fill="black" stroke="black" points="149.38,-5874.47 145.88,-5864.47 142.38,-5874.47 149.38,-5874.47"/>
</g>
<!-- expert_2_0_0 -->
<g id="node71" class="node">
<title>expert_2_0_0</title>
<polygon fill="lightpink" stroke="black" points="344,-5670 106,-5670 106,-5617 344,-5617 344,-5670"/>
<text text-anchor="middle" x="225" y="-5654.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="225" y="-5639.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="225" y="-5624.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_2_0&#45;&gt;expert_2_0_0 -->
<g id="edge70" class="edge">
<title>gate_2_0&#45;&gt;expert_2_0_0</title>
<path fill="none" stroke="black" d="M133.57,-5820.71C133.57,-5820.71 133.57,-5680.29 133.57,-5680.29"/>
<polygon fill="black" stroke="black" points="137.07,-5680.29 133.57,-5670.29 130.07,-5680.29 137.07,-5680.29"/>
</g>
<!-- expert_2_1_0 -->
<g id="node169" class="node">
<title>expert_2_1_0</title>
<polygon fill="lightpink" stroke="black" points="3180,-5670 2942,-5670 2942,-5617 3180,-5617 3180,-5670"/>
<text text-anchor="middle" x="3061" y="-5654.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="3061" y="-5639.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="3061" y="-5624.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_2_0&#45;&gt;expert_2_1_0 -->
<g id="edge1631" class="edge">
<title>gate_2_0&#45;&gt;expert_2_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M324.76,-5827C815.39,-5827 2948.75,-5827 2948.75,-5827 2948.75,-5827 2948.75,-5680.18 2948.75,-5680.18"/>
<polygon fill="blue" stroke="blue" points="2952.25,-5680.18 2948.75,-5670.18 2945.25,-5680.18 2952.25,-5680.18"/>
<text text-anchor="middle" x="333.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="333.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU0→GPU1</text>
<text text-anchor="middle" x="333.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="333.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_2_0 -->
<g id="node267" class="node">
<title>expert_2_2_0</title>
<polygon fill="lightpink" stroke="black" points="3767,-5670 3529,-5670 3529,-5617 3767,-5617 3767,-5670"/>
<text text-anchor="middle" x="3648" y="-5654.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="3648" y="-5639.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="3648" y="-5624.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_2_0&#45;&gt;expert_2_2_0 -->
<g id="edge1632" class="edge">
<title>gate_2_0&#45;&gt;expert_2_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M217.97,-5801.91C217.97,-5800.09 217.97,-5799 217.97,-5799 217.97,-5799 3558.13,-5799 3558.13,-5799 3558.13,-5799 3558.13,-5680.23 3558.13,-5680.23"/>
<polygon fill="blue" stroke="blue" points="3561.63,-5680.23 3558.13,-5670.23 3554.63,-5680.23 3561.63,-5680.23"/>
<text text-anchor="middle" x="507.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="507.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU0→GPU2</text>
<text text-anchor="middle" x="507.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="507.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_3_0 -->
<g id="node365" class="node">
<title>expert_2_3_0</title>
<polygon fill="lightpink" stroke="black" points="4354,-5670 4116,-5670 4116,-5617 4354,-5617 4354,-5670"/>
<text text-anchor="middle" x="4235" y="-5654.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="4235" y="-5639.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="4235" y="-5624.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_2_0&#45;&gt;expert_2_3_0 -->
<g id="edge1633" class="edge">
<title>gate_2_0&#45;&gt;expert_2_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M232.03,-5801.87C232.03,-5789.57 232.03,-5779 232.03,-5779 232.03,-5779 4146.38,-5779 4146.38,-5779 4146.38,-5779 4146.38,-5680.27 4146.38,-5680.27"/>
<polygon fill="blue" stroke="blue" points="4149.88,-5680.27 4146.38,-5670.27 4142.88,-5680.27 4149.88,-5680.27"/>
<text text-anchor="middle" x="681.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="681.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU0→GPU3</text>
<text text-anchor="middle" x="681.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="681.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_4_0 -->
<g id="node463" class="node">
<title>expert_2_4_0</title>
<polygon fill="lightpink" stroke="black" points="4941,-5670 4703,-5670 4703,-5617 4941,-5617 4941,-5670"/>
<text text-anchor="middle" x="4822" y="-5654.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="4822" y="-5639.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="4822" y="-5624.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_2_0&#45;&gt;expert_2_4_0 -->
<g id="edge1634" class="edge">
<title>gate_2_0&#45;&gt;expert_2_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M246.1,-5802.74C246.1,-5753.44 246.1,-5672 246.1,-5672 246.1,-5672 4736.6,-5672 4736.6,-5672 4736.6,-5672 4736.6,-5671.81 4736.6,-5671.81"/>
<polygon fill="blue" stroke="blue" points="4740.1,-5680.13 4736.6,-5670.13 4733.1,-5680.13 4740.1,-5680.13"/>
<text text-anchor="middle" x="855.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="855.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU0→GPU4</text>
<text text-anchor="middle" x="855.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="855.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_5_0 -->
<g id="node561" class="node">
<title>expert_2_5_0</title>
<polygon fill="lightpink" stroke="black" points="5528,-5670 5290,-5670 5290,-5617 5528,-5617 5528,-5670"/>
<text text-anchor="middle" x="5409" y="-5654.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="5409" y="-5639.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="5409" y="-5624.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_2_0&#45;&gt;expert_2_5_0 -->
<g id="edge1635" class="edge">
<title>gate_2_0&#45;&gt;expert_2_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M260.17,-5803.91C260.17,-5788.1 260.17,-5773 260.17,-5773 260.17,-5773 5323.6,-5773 5323.6,-5773 5323.6,-5773 5323.6,-5680.02 5323.6,-5680.02"/>
<polygon fill="blue" stroke="blue" points="5327.1,-5680.02 5323.6,-5670.02 5320.1,-5680.02 5327.1,-5680.02"/>
<text text-anchor="middle" x="1029.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1029.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU0→GPU5</text>
<text text-anchor="middle" x="1029.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1029.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_6_0 -->
<g id="node659" class="node">
<title>expert_2_6_0</title>
<polygon fill="lightpink" stroke="black" points="6115,-5670 5877,-5670 5877,-5617 6115,-5617 6115,-5670"/>
<text text-anchor="middle" x="5996" y="-5654.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="5996" y="-5639.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="5996" y="-5624.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_2_0&#45;&gt;expert_2_6_0 -->
<g id="edge1636" class="edge">
<title>gate_2_0&#45;&gt;expert_2_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M274.23,-5806.21C274.23,-5758.14 274.23,-5675 274.23,-5675 274.23,-5675 5685.6,-5675 5685.6,-5675 5685.6,-5675 5685.6,-5652 5685.6,-5652 5685.6,-5652 5866.88,-5652 5866.88,-5652"/>
<polygon fill="blue" stroke="blue" points="5866.88,-5655.5 5876.88,-5652 5866.88,-5648.5 5866.88,-5655.5"/>
<text text-anchor="middle" x="1203.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1203.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU0→GPU6</text>
<text text-anchor="middle" x="1203.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1203.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_7_0 -->
<g id="node757" class="node">
<title>expert_2_7_0</title>
<polygon fill="lightpink" stroke="black" points="6702,-5670 6464,-5670 6464,-5617 6702,-5617 6702,-5670"/>
<text text-anchor="middle" x="6583" y="-5654.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="6583" y="-5639.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="6583" y="-5624.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_2_0&#45;&gt;expert_2_7_0 -->
<g id="edge1637" class="edge">
<title>gate_2_0&#45;&gt;expert_2_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M304.12,-5864.45C304.12,-5887.1 304.12,-5917 304.12,-5917 304.12,-5917 6129.5,-5917 6129.5,-5917 6129.5,-5917 6129.5,-5643 6129.5,-5643 6129.5,-5643 6453.85,-5643 6453.85,-5643"/>
<polygon fill="blue" stroke="blue" points="6453.85,-5646.5 6463.85,-5643 6453.85,-5639.5 6453.85,-5646.5"/>
<text text-anchor="middle" x="1377.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1377.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU0→GPU7</text>
<text text-anchor="middle" x="1377.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1377.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_8_0 -->
<g id="node855" class="node">
<title>expert_2_8_0</title>
<polygon fill="lightpink" stroke="black" points="7289,-5670 7051,-5670 7051,-5617 7289,-5617 7289,-5670"/>
<text text-anchor="middle" x="7170" y="-5654.8" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="7170" y="-5639.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="7170" y="-5624.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_2_0&#45;&gt;expert_2_8_0 -->
<g id="edge1638" class="edge">
<title>gate_2_0&#45;&gt;expert_2_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M277.75,-5872.2C277.75,-5896.7 277.75,-5926 277.75,-5926 277.75,-5926 6761.5,-5926 6761.5,-5926 6761.5,-5926 6761.5,-5643 6761.5,-5643 6761.5,-5643 7040.75,-5643 7040.75,-5643"/>
<polygon fill="blue" stroke="blue" points="7040.75,-5646.5 7050.75,-5643 7040.75,-5639.5 7040.75,-5646.5"/>
<text text-anchor="middle" x="1551.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1551.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU0→GPU8</text>
<text text-anchor="middle" x="1551.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1551.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_9_0 -->
<g id="node953" class="node">
<title>expert_2_9_0</title>
<polygon fill="lightpink" stroke="black" points="7876,-5670 7638,-5670 7638,-5617 7876,-5617 7876,-5670"/>
<text text-anchor="middle" x="7757" y="-5654.8" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="7757" y="-5639.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="7757" y="-5624.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_2_0&#45;&gt;expert_2_9_0 -->
<g id="edge1639" class="edge">
<title>gate_2_0&#45;&gt;expert_2_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M251.38,-5875.93C251.38,-5901.44 251.38,-5931 251.38,-5931 251.38,-5931 7348.5,-5931 7348.5,-5931 7348.5,-5931 7348.5,-5643 7348.5,-5643 7348.5,-5643 7627.75,-5643 7627.75,-5643"/>
<polygon fill="blue" stroke="blue" points="7627.75,-5646.5 7637.75,-5643 7627.75,-5639.5 7627.75,-5646.5"/>
<text text-anchor="middle" x="1725.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1725.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU0→GPU9</text>
<text text-anchor="middle" x="1725.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1725.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_10_0 -->
<g id="node1051" class="node">
<title>expert_2_10_0</title>
<polygon fill="lightpink" stroke="black" points="8463,-5670 8225,-5670 8225,-5617 8463,-5617 8463,-5670"/>
<text text-anchor="middle" x="8344" y="-5654.8" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="8344" y="-5639.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="8344" y="-5624.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_2_0&#45;&gt;expert_2_10_0 -->
<g id="edge1640" class="edge">
<title>gate_2_0&#45;&gt;expert_2_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M225,-5877.24C225,-5903.94 225,-5935 225,-5935 225,-5935 7935.5,-5935 7935.5,-5935 7935.5,-5935 7935.5,-5643 7935.5,-5643 7935.5,-5643 8214.75,-5643 8214.75,-5643"/>
<polygon fill="blue" stroke="blue" points="8214.75,-5646.5 8224.75,-5643 8214.75,-5639.5 8214.75,-5646.5"/>
<text text-anchor="middle" x="1899.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1899.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU0→GPU10</text>
<text text-anchor="middle" x="1899.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1899.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_11_0 -->
<g id="node1149" class="node">
<title>expert_2_11_0</title>
<polygon fill="lightpink" stroke="black" points="9050,-5670 8812,-5670 8812,-5617 9050,-5617 9050,-5670"/>
<text text-anchor="middle" x="8931" y="-5654.8" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="8931" y="-5639.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="8931" y="-5624.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_2_0&#45;&gt;expert_2_11_0 -->
<g id="edge1641" class="edge">
<title>gate_2_0&#45;&gt;expert_2_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M198.62,-5876.07C198.62,-5904.8 198.62,-5940 198.62,-5940 198.62,-5940 8522.5,-5940 8522.5,-5940 8522.5,-5940 8522.5,-5634 8522.5,-5634 8522.5,-5634 8801.75,-5634 8801.75,-5634"/>
<polygon fill="blue" stroke="blue" points="8801.75,-5637.5 8811.75,-5634 8801.75,-5630.5 8801.75,-5637.5"/>
<text text-anchor="middle" x="2073.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2073.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU0→GPU11</text>
<text text-anchor="middle" x="2073.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="2073.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_12_0 -->
<g id="node1247" class="node">
<title>expert_2_12_0</title>
<polygon fill="lightpink" stroke="black" points="9637,-5670 9399,-5670 9399,-5617 9637,-5617 9637,-5670"/>
<text text-anchor="middle" x="9518" y="-5654.8" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="9518" y="-5639.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="9518" y="-5624.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_2_0&#45;&gt;expert_2_12_0 -->
<g id="edge1642" class="edge">
<title>gate_2_0&#45;&gt;expert_2_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M172.25,-5872.01C172.25,-5903.01 172.25,-5945 172.25,-5945 172.25,-5945 9064.5,-5945 9064.5,-5945 9064.5,-5945 9064.5,-5643 9064.5,-5643 9064.5,-5643 9388.85,-5643 9388.85,-5643"/>
<polygon fill="blue" stroke="blue" points="9388.85,-5646.5 9398.85,-5643 9388.85,-5639.5 9388.85,-5646.5"/>
<text text-anchor="middle" x="2247.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2247.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU0→GPU12</text>
<text text-anchor="middle" x="2247.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="2247.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_13_0 -->
<g id="node1345" class="node">
<title>expert_2_13_0</title>
<polygon fill="lightpink" stroke="black" points="10224,-5670 9986,-5670 9986,-5617 10224,-5617 10224,-5670"/>
<text text-anchor="middle" x="10105" y="-5654.8" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="10105" y="-5639.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="10105" y="-5624.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_2_0&#45;&gt;expert_2_13_0 -->
<g id="edge1643" class="edge">
<title>gate_2_0&#45;&gt;expert_2_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M288.3,-5809.13C288.3,-5763.36 288.3,-5682 288.3,-5682 288.3,-5682 10016.38,-5682 10016.38,-5682 10016.38,-5682 10016.38,-5680.24 10016.38,-5680.24"/>
<polygon fill="blue" stroke="blue" points="10019.88,-5680.24 10016.38,-5670.24 10012.88,-5680.24 10019.88,-5680.24"/>
<text text-anchor="middle" x="2421.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2421.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU0→GPU13</text>
<text text-anchor="middle" x="2421.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="2421.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_14_0 -->
<g id="node1443" class="node">
<title>expert_2_14_0</title>
<polygon fill="lightpink" stroke="black" points="10811,-5670 10573,-5670 10573,-5617 10811,-5617 10811,-5670"/>
<text text-anchor="middle" x="10692" y="-5654.8" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="10692" y="-5639.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="10692" y="-5624.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_2_0&#45;&gt;expert_2_14_0 -->
<g id="edge1644" class="edge">
<title>gate_2_0&#45;&gt;expert_2_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M302.37,-5813.66C302.37,-5769.21 302.37,-5683 302.37,-5683 302.37,-5683 10606.6,-5683 10606.6,-5683 10606.6,-5683 10606.6,-5680.07 10606.6,-5680.07"/>
<polygon fill="blue" stroke="blue" points="10610.1,-5680.07 10606.6,-5670.07 10603.1,-5680.07 10610.1,-5680.07"/>
<text text-anchor="middle" x="2595.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2595.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU0→GPU14</text>
<text text-anchor="middle" x="2595.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="2595.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_15_0 -->
<g id="node1541" class="node">
<title>expert_2_15_0</title>
<polygon fill="lightpink" stroke="black" points="11398,-5670 11160,-5670 11160,-5617 11398,-5617 11398,-5670"/>
<text text-anchor="middle" x="11279" y="-5654.8" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="11279" y="-5639.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="11279" y="-5624.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_2_0&#45;&gt;expert_2_15_0 -->
<g id="edge1645" class="edge">
<title>gate_2_0&#45;&gt;expert_2_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M316.43,-5820.62C316.43,-5779 316.43,-5683 316.43,-5683 316.43,-5683 11195.71,-5683 11195.71,-5683 11195.71,-5683 11195.71,-5680.07 11195.71,-5680.07"/>
<polygon fill="blue" stroke="blue" points="11199.21,-5680.07 11195.71,-5670.07 11192.21,-5680.07 11199.21,-5680.07"/>
<text text-anchor="middle" x="2769.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2769.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU0→GPU15</text>
<text text-anchor="middle" x="2769.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="2769.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_0 -->
<g id="node72" class="node">
<title>expert_reduce_2_0</title>
<ellipse fill="none" stroke="black" cx="225" cy="-5506.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="225" y="-5517.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="225" y="-5502.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="225" y="-5487.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_0_0&#45;&gt;expert_reduce_2_0 -->
<g id="edge71" class="edge">
<title>expert_2_0_0&#45;&gt;expert_reduce_2_0</title>
<path fill="none" stroke="black" d="M225,-5616.76C225,-5616.76 225,-5554.06 225,-5554.06"/>
<polygon fill="black" stroke="black" points="228.5,-5554.06 225,-5544.06 221.5,-5554.06 228.5,-5554.06"/>
</g>
<!-- moe_residual_2_0 -->
<g id="node73" class="node">
<title>moe_residual_2_0</title>
<ellipse fill="none" stroke="black" cx="225" cy="-5369" rx="105.5" ry="27"/>
<text text-anchor="middle" x="225" y="-5372.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="225" y="-5357.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_0&#45;&gt;moe_residual_2_0 -->
<g id="edge72" class="edge">
<title>expert_reduce_2_0&#45;&gt;moe_residual_2_0</title>
<path fill="none" stroke="black" d="M225,-5468.93C225,-5468.93 225,-5406.06 225,-5406.06"/>
<polygon fill="black" stroke="black" points="228.5,-5406.06 225,-5396.06 221.5,-5406.06 228.5,-5406.06"/>
</g>
<!-- qkv_proj_3_0 -->
<g id="node74" class="node">
<title>qkv_proj_3_0</title>
<polygon fill="none" stroke="black" points="307.5,-5269 142.5,-5269 142.5,-5216 307.5,-5216 307.5,-5269"/>
<text text-anchor="middle" x="225" y="-5253.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="225" y="-5238.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="225" y="-5223.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_2_0&#45;&gt;qkv_proj_3_0 -->
<g id="edge73" class="edge">
<title>moe_residual_2_0&#45;&gt;qkv_proj_3_0</title>
<path fill="none" stroke="black" d="M225,-5341.86C225,-5341.86 225,-5279.16 225,-5279.16"/>
<polygon fill="black" stroke="black" points="228.5,-5279.16 225,-5269.16 221.5,-5279.16 228.5,-5279.16"/>
</g>
<!-- qkv_reshape_3_0 -->
<g id="node75" class="node">
<title>qkv_reshape_3_0</title>
<ellipse fill="none" stroke="black" cx="225" cy="-5116" rx="148" ry="27"/>
<text text-anchor="middle" x="225" y="-5119.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="225" y="-5104.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_3_0&#45;&gt;qkv_reshape_3_0 -->
<g id="edge74" class="edge">
<title>qkv_proj_3_0&#45;&gt;qkv_reshape_3_0</title>
<path fill="none" stroke="black" d="M225,-5215.98C225,-5215.98 225,-5153.36 225,-5153.36"/>
<polygon fill="black" stroke="black" points="228.5,-5153.36 225,-5143.36 221.5,-5153.36 228.5,-5153.36"/>
</g>
<!-- ring_attn_3_0_stage_0 -->
<g id="node76" class="node">
<title>ring_attn_3_0_stage_0</title>
<polygon fill="yellow" stroke="black" points="225,-4972 16,-4904 225,-4836 434,-4904 225,-4972"/>
<text text-anchor="middle" x="225" y="-4922.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-4907.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="225" y="-4892.8" font-family="Times,serif" font-size="14.00">Q[0]×K[0]×V[0]</text>
<text text-anchor="middle" x="225" y="-4877.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- qkv_reshape_3_0&#45;&gt;ring_attn_3_0_stage_0 -->
<g id="edge75" class="edge">
<title>qkv_reshape_3_0&#45;&gt;ring_attn_3_0_stage_0</title>
<path fill="none" stroke="black" d="M225,-5088.72C225,-5088.72 225,-4982.16 225,-4982.16"/>
<polygon fill="black" stroke="black" points="228.5,-4982.16 225,-4972.16 221.5,-4982.16 228.5,-4982.16"/>
</g>
<!-- ring_attn_3_0_stage_1 -->
<g id="node77" class="node">
<title>ring_attn_3_0_stage_1</title>
<polygon fill="yellow" stroke="black" points="225,-4719 16,-4651 225,-4583 434,-4651 225,-4719"/>
<text text-anchor="middle" x="225" y="-4669.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-4654.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="225" y="-4639.8" font-family="Times,serif" font-size="14.00">Q[0]×K[15]×V[15]</text>
<text text-anchor="middle" x="225" y="-4624.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_0&#45;&gt;ring_attn_3_0_stage_1 -->
<g id="edge76" class="edge">
<title>ring_attn_3_0_stage_0&#45;&gt;ring_attn_3_0_stage_1</title>
<path fill="none" stroke="black" d="M225,-4835.87C225,-4835.87 225,-4729.25 225,-4729.25"/>
<polygon fill="black" stroke="black" points="228.5,-4729.25 225,-4719.25 221.5,-4729.25 228.5,-4729.25"/>
</g>
<!-- ring_attn_3_1_stage_0 -->
<g id="node174" class="node">
<title>ring_attn_3_1_stage_0</title>
<polygon fill="yellow" stroke="black" points="3061,-4972 2852,-4904 3061,-4836 3270,-4904 3061,-4972"/>
<text text-anchor="middle" x="3061" y="-4922.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-4907.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="3061" y="-4892.8" font-family="Times,serif" font-size="14.00">Q[1]×K[1]×V[1]</text>
<text text-anchor="middle" x="3061" y="-4877.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_0&#45;&gt;ring_attn_3_1_stage_0 -->
<g id="edge1646" class="edge">
<title>ring_attn_3_0_stage_0&#45;&gt;ring_attn_3_1_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-4904C434.11,-4904 2841.79,-4904 2841.79,-4904"/>
<polygon fill="red" stroke="red" points="2841.79,-4907.5 2851.79,-4904 2841.79,-4900.5 2841.79,-4907.5"/>
</g>
<!-- ring_attn_3_0_stage_2 -->
<g id="node78" class="node">
<title>ring_attn_3_0_stage_2</title>
<polygon fill="yellow" stroke="black" points="225,-4466 16,-4398 225,-4330 434,-4398 225,-4466"/>
<text text-anchor="middle" x="225" y="-4416.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-4401.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="225" y="-4386.8" font-family="Times,serif" font-size="14.00">Q[0]×K[14]×V[14]</text>
<text text-anchor="middle" x="225" y="-4371.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_1&#45;&gt;ring_attn_3_0_stage_2 -->
<g id="edge77" class="edge">
<title>ring_attn_3_0_stage_1&#45;&gt;ring_attn_3_0_stage_2</title>
<path fill="none" stroke="black" d="M155.33,-4605.48C155.33,-4605.48 155.33,-4453.58 155.33,-4453.58"/>
<polygon fill="black" stroke="black" points="158.83,-4453.58 155.33,-4443.58 151.83,-4453.58 158.83,-4453.58"/>
</g>
<!-- ring_attn_3_1_stage_1 -->
<g id="node175" class="node">
<title>ring_attn_3_1_stage_1</title>
<polygon fill="yellow" stroke="black" points="3061,-4719 2852,-4651 3061,-4583 3270,-4651 3061,-4719"/>
<text text-anchor="middle" x="3061" y="-4669.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-4654.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="3061" y="-4639.8" font-family="Times,serif" font-size="14.00">Q[1]×K[0]×V[0]</text>
<text text-anchor="middle" x="3061" y="-4624.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_1&#45;&gt;ring_attn_3_1_stage_1 -->
<g id="edge1647" class="edge">
<title>ring_attn_3_0_stage_1&#45;&gt;ring_attn_3_1_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-4651C434.11,-4651 2841.79,-4651 2841.79,-4651"/>
<polygon fill="red" stroke="red" points="2841.79,-4654.5 2851.79,-4651 2841.79,-4647.5 2841.79,-4654.5"/>
</g>
<!-- ring_attn_3_0_stage_3 -->
<g id="node79" class="node">
<title>ring_attn_3_0_stage_3</title>
<polygon fill="yellow" stroke="black" points="225,-4213 16,-4145 225,-4077 434,-4145 225,-4213"/>
<text text-anchor="middle" x="225" y="-4163.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-4148.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="225" y="-4133.8" font-family="Times,serif" font-size="14.00">Q[0]×K[13]×V[13]</text>
<text text-anchor="middle" x="225" y="-4118.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_2&#45;&gt;ring_attn_3_0_stage_3 -->
<g id="edge78" class="edge">
<title>ring_attn_3_0_stage_2&#45;&gt;ring_attn_3_0_stage_3</title>
<path fill="none" stroke="black" d="M155.33,-4352.48C155.33,-4352.48 155.33,-4200.58 155.33,-4200.58"/>
<polygon fill="black" stroke="black" points="158.83,-4200.58 155.33,-4190.58 151.83,-4200.58 158.83,-4200.58"/>
</g>
<!-- ring_attn_3_1_stage_2 -->
<g id="node176" class="node">
<title>ring_attn_3_1_stage_2</title>
<polygon fill="yellow" stroke="black" points="3061,-4466 2852,-4398 3061,-4330 3270,-4398 3061,-4466"/>
<text text-anchor="middle" x="3061" y="-4416.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-4401.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="3061" y="-4386.8" font-family="Times,serif" font-size="14.00">Q[1]×K[15]×V[15]</text>
<text text-anchor="middle" x="3061" y="-4371.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_2&#45;&gt;ring_attn_3_1_stage_2 -->
<g id="edge1648" class="edge">
<title>ring_attn_3_0_stage_2&#45;&gt;ring_attn_3_1_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-4398C434.11,-4398 2841.79,-4398 2841.79,-4398"/>
<polygon fill="red" stroke="red" points="2841.79,-4401.5 2851.79,-4398 2841.79,-4394.5 2841.79,-4401.5"/>
</g>
<!-- ring_attn_3_0_stage_4 -->
<g id="node80" class="node">
<title>ring_attn_3_0_stage_4</title>
<polygon fill="yellow" stroke="black" points="225,-3960 16,-3892 225,-3824 434,-3892 225,-3960"/>
<text text-anchor="middle" x="225" y="-3910.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-3895.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="225" y="-3880.8" font-family="Times,serif" font-size="14.00">Q[0]×K[12]×V[12]</text>
<text text-anchor="middle" x="225" y="-3865.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_3&#45;&gt;ring_attn_3_0_stage_4 -->
<g id="edge79" class="edge">
<title>ring_attn_3_0_stage_3&#45;&gt;ring_attn_3_0_stage_4</title>
<path fill="none" stroke="black" d="M120.5,-4110.88C120.5,-4110.88 120.5,-3936.39 120.5,-3936.39"/>
<polygon fill="black" stroke="black" points="124,-3936.39 120.5,-3926.39 117,-3936.39 124,-3936.39"/>
</g>
<!-- ring_attn_3_1_stage_3 -->
<g id="node177" class="node">
<title>ring_attn_3_1_stage_3</title>
<polygon fill="yellow" stroke="black" points="3061,-4213 2852,-4145 3061,-4077 3270,-4145 3061,-4213"/>
<text text-anchor="middle" x="3061" y="-4163.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-4148.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="3061" y="-4133.8" font-family="Times,serif" font-size="14.00">Q[1]×K[14]×V[14]</text>
<text text-anchor="middle" x="3061" y="-4118.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_3&#45;&gt;ring_attn_3_1_stage_3 -->
<g id="edge1649" class="edge">
<title>ring_attn_3_0_stage_3&#45;&gt;ring_attn_3_1_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-4145C434.11,-4145 2841.79,-4145 2841.79,-4145"/>
<polygon fill="red" stroke="red" points="2841.79,-4148.5 2851.79,-4145 2841.79,-4141.5 2841.79,-4148.5"/>
</g>
<!-- ring_attn_3_0_stage_5 -->
<g id="node81" class="node">
<title>ring_attn_3_0_stage_5</title>
<polygon fill="yellow" stroke="black" points="225,-3707 16,-3639 225,-3571 434,-3639 225,-3707"/>
<text text-anchor="middle" x="225" y="-3657.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-3642.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="225" y="-3627.8" font-family="Times,serif" font-size="14.00">Q[0]×K[11]×V[11]</text>
<text text-anchor="middle" x="225" y="-3612.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_4&#45;&gt;ring_attn_3_0_stage_5 -->
<g id="edge80" class="edge">
<title>ring_attn_3_0_stage_4&#45;&gt;ring_attn_3_0_stage_5</title>
<path fill="none" stroke="black" d="M155.33,-3846.48C155.33,-3846.48 155.33,-3694.58 155.33,-3694.58"/>
<polygon fill="black" stroke="black" points="158.83,-3694.58 155.33,-3684.58 151.83,-3694.58 158.83,-3694.58"/>
</g>
<!-- ring_attn_3_1_stage_4 -->
<g id="node178" class="node">
<title>ring_attn_3_1_stage_4</title>
<polygon fill="yellow" stroke="black" points="3061,-3960 2852,-3892 3061,-3824 3270,-3892 3061,-3960"/>
<text text-anchor="middle" x="3061" y="-3910.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-3895.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="3061" y="-3880.8" font-family="Times,serif" font-size="14.00">Q[1]×K[13]×V[13]</text>
<text text-anchor="middle" x="3061" y="-3865.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_4&#45;&gt;ring_attn_3_1_stage_4 -->
<g id="edge1650" class="edge">
<title>ring_attn_3_0_stage_4&#45;&gt;ring_attn_3_1_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-3892C434.11,-3892 2841.79,-3892 2841.79,-3892"/>
<polygon fill="red" stroke="red" points="2841.79,-3895.5 2851.79,-3892 2841.79,-3888.5 2841.79,-3895.5"/>
</g>
<!-- ring_attn_3_0_stage_6 -->
<g id="node82" class="node">
<title>ring_attn_3_0_stage_6</title>
<polygon fill="yellow" stroke="black" points="225,-3454 16,-3386 225,-3318 434,-3386 225,-3454"/>
<text text-anchor="middle" x="225" y="-3404.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-3389.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="225" y="-3374.8" font-family="Times,serif" font-size="14.00">Q[0]×K[10]×V[10]</text>
<text text-anchor="middle" x="225" y="-3359.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_5&#45;&gt;ring_attn_3_0_stage_6 -->
<g id="edge81" class="edge">
<title>ring_attn_3_0_stage_5&#45;&gt;ring_attn_3_0_stage_6</title>
<path fill="none" stroke="black" d="M225,-3570.87C225,-3570.87 225,-3464.25 225,-3464.25"/>
<polygon fill="black" stroke="black" points="228.5,-3464.25 225,-3454.25 221.5,-3464.25 228.5,-3464.25"/>
</g>
<!-- ring_attn_3_1_stage_5 -->
<g id="node179" class="node">
<title>ring_attn_3_1_stage_5</title>
<polygon fill="yellow" stroke="black" points="3061,-3707 2852,-3639 3061,-3571 3270,-3639 3061,-3707"/>
<text text-anchor="middle" x="3061" y="-3657.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-3642.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="3061" y="-3627.8" font-family="Times,serif" font-size="14.00">Q[1]×K[12]×V[12]</text>
<text text-anchor="middle" x="3061" y="-3612.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_5&#45;&gt;ring_attn_3_1_stage_5 -->
<g id="edge1651" class="edge">
<title>ring_attn_3_0_stage_5&#45;&gt;ring_attn_3_1_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-3639C434.11,-3639 2841.79,-3639 2841.79,-3639"/>
<polygon fill="red" stroke="red" points="2841.79,-3642.5 2851.79,-3639 2841.79,-3635.5 2841.79,-3642.5"/>
</g>
<!-- ring_attn_3_0_stage_7 -->
<g id="node83" class="node">
<title>ring_attn_3_0_stage_7</title>
<polygon fill="yellow" stroke="black" points="225,-3201 16,-3133 225,-3065 434,-3133 225,-3201"/>
<text text-anchor="middle" x="225" y="-3151.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-3136.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="225" y="-3121.8" font-family="Times,serif" font-size="14.00">Q[0]×K[9]×V[9]</text>
<text text-anchor="middle" x="225" y="-3106.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_6&#45;&gt;ring_attn_3_0_stage_7 -->
<g id="edge82" class="edge">
<title>ring_attn_3_0_stage_6&#45;&gt;ring_attn_3_0_stage_7</title>
<path fill="none" stroke="black" d="M120.5,-3351.88C120.5,-3351.88 120.5,-3177.39 120.5,-3177.39"/>
<polygon fill="black" stroke="black" points="124,-3177.39 120.5,-3167.39 117,-3177.39 124,-3177.39"/>
</g>
<!-- ring_attn_3_1_stage_6 -->
<g id="node180" class="node">
<title>ring_attn_3_1_stage_6</title>
<polygon fill="yellow" stroke="black" points="3061,-3454 2852,-3386 3061,-3318 3270,-3386 3061,-3454"/>
<text text-anchor="middle" x="3061" y="-3404.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-3389.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="3061" y="-3374.8" font-family="Times,serif" font-size="14.00">Q[1]×K[11]×V[11]</text>
<text text-anchor="middle" x="3061" y="-3359.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_6&#45;&gt;ring_attn_3_1_stage_6 -->
<g id="edge1652" class="edge">
<title>ring_attn_3_0_stage_6&#45;&gt;ring_attn_3_1_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-3386C434.11,-3386 2841.79,-3386 2841.79,-3386"/>
<polygon fill="red" stroke="red" points="2841.79,-3389.5 2851.79,-3386 2841.79,-3382.5 2841.79,-3389.5"/>
</g>
<!-- ring_attn_3_0_stage_8 -->
<g id="node84" class="node">
<title>ring_attn_3_0_stage_8</title>
<polygon fill="yellow" stroke="black" points="225,-2948 16,-2880 225,-2812 434,-2880 225,-2948"/>
<text text-anchor="middle" x="225" y="-2898.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-2883.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="225" y="-2868.8" font-family="Times,serif" font-size="14.00">Q[0]×K[8]×V[8]</text>
<text text-anchor="middle" x="225" y="-2853.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_7&#45;&gt;ring_attn_3_0_stage_8 -->
<g id="edge83" class="edge">
<title>ring_attn_3_0_stage_7&#45;&gt;ring_attn_3_0_stage_8</title>
<path fill="none" stroke="black" d="M225,-3064.87C225,-3064.87 225,-2958.25 225,-2958.25"/>
<polygon fill="black" stroke="black" points="228.5,-2958.25 225,-2948.25 221.5,-2958.25 228.5,-2958.25"/>
</g>
<!-- ring_attn_3_1_stage_7 -->
<g id="node181" class="node">
<title>ring_attn_3_1_stage_7</title>
<polygon fill="yellow" stroke="black" points="3061,-3201 2852,-3133 3061,-3065 3270,-3133 3061,-3201"/>
<text text-anchor="middle" x="3061" y="-3151.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-3136.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="3061" y="-3121.8" font-family="Times,serif" font-size="14.00">Q[1]×K[10]×V[10]</text>
<text text-anchor="middle" x="3061" y="-3106.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_7&#45;&gt;ring_attn_3_1_stage_7 -->
<g id="edge1653" class="edge">
<title>ring_attn_3_0_stage_7&#45;&gt;ring_attn_3_1_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-3133C434.11,-3133 2841.79,-3133 2841.79,-3133"/>
<polygon fill="red" stroke="red" points="2841.79,-3136.5 2851.79,-3133 2841.79,-3129.5 2841.79,-3136.5"/>
</g>
<!-- ring_attn_3_0_stage_9 -->
<g id="node85" class="node">
<title>ring_attn_3_0_stage_9</title>
<polygon fill="yellow" stroke="black" points="225,-2695 16,-2627 225,-2559 434,-2627 225,-2695"/>
<text text-anchor="middle" x="225" y="-2645.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-2630.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="225" y="-2615.8" font-family="Times,serif" font-size="14.00">Q[0]×K[7]×V[7]</text>
<text text-anchor="middle" x="225" y="-2600.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_8&#45;&gt;ring_attn_3_0_stage_9 -->
<g id="edge84" class="edge">
<title>ring_attn_3_0_stage_8&#45;&gt;ring_attn_3_0_stage_9</title>
<path fill="none" stroke="black" d="M120.5,-2845.88C120.5,-2845.88 120.5,-2671.39 120.5,-2671.39"/>
<polygon fill="black" stroke="black" points="124,-2671.39 120.5,-2661.39 117,-2671.39 124,-2671.39"/>
</g>
<!-- ring_attn_3_1_stage_8 -->
<g id="node182" class="node">
<title>ring_attn_3_1_stage_8</title>
<polygon fill="yellow" stroke="black" points="3061,-2948 2852,-2880 3061,-2812 3270,-2880 3061,-2948"/>
<text text-anchor="middle" x="3061" y="-2898.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-2883.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="3061" y="-2868.8" font-family="Times,serif" font-size="14.00">Q[1]×K[9]×V[9]</text>
<text text-anchor="middle" x="3061" y="-2853.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_8&#45;&gt;ring_attn_3_1_stage_8 -->
<g id="edge1654" class="edge">
<title>ring_attn_3_0_stage_8&#45;&gt;ring_attn_3_1_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-2880C434.11,-2880 2841.79,-2880 2841.79,-2880"/>
<polygon fill="red" stroke="red" points="2841.79,-2883.5 2851.79,-2880 2841.79,-2876.5 2841.79,-2883.5"/>
</g>
<!-- ring_attn_3_0_stage_10 -->
<g id="node86" class="node">
<title>ring_attn_3_0_stage_10</title>
<polygon fill="yellow" stroke="black" points="225,-2442 16,-2374 225,-2306 434,-2374 225,-2442"/>
<text text-anchor="middle" x="225" y="-2392.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-2377.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="225" y="-2362.8" font-family="Times,serif" font-size="14.00">Q[0]×K[6]×V[6]</text>
<text text-anchor="middle" x="225" y="-2347.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_9&#45;&gt;ring_attn_3_0_stage_10 -->
<g id="edge85" class="edge">
<title>ring_attn_3_0_stage_9&#45;&gt;ring_attn_3_0_stage_10</title>
<path fill="none" stroke="black" d="M155.33,-2581.48C155.33,-2581.48 155.33,-2429.58 155.33,-2429.58"/>
<polygon fill="black" stroke="black" points="158.83,-2429.58 155.33,-2419.58 151.83,-2429.58 158.83,-2429.58"/>
</g>
<!-- ring_attn_3_1_stage_9 -->
<g id="node183" class="node">
<title>ring_attn_3_1_stage_9</title>
<polygon fill="yellow" stroke="black" points="3061,-2695 2852,-2627 3061,-2559 3270,-2627 3061,-2695"/>
<text text-anchor="middle" x="3061" y="-2645.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-2630.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="3061" y="-2615.8" font-family="Times,serif" font-size="14.00">Q[1]×K[8]×V[8]</text>
<text text-anchor="middle" x="3061" y="-2600.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_9&#45;&gt;ring_attn_3_1_stage_9 -->
<g id="edge1655" class="edge">
<title>ring_attn_3_0_stage_9&#45;&gt;ring_attn_3_1_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-2627C434.11,-2627 2841.79,-2627 2841.79,-2627"/>
<polygon fill="red" stroke="red" points="2841.79,-2630.5 2851.79,-2627 2841.79,-2623.5 2841.79,-2630.5"/>
</g>
<!-- ring_attn_3_0_stage_11 -->
<g id="node87" class="node">
<title>ring_attn_3_0_stage_11</title>
<polygon fill="yellow" stroke="black" points="225,-2189 16,-2121 225,-2053 434,-2121 225,-2189"/>
<text text-anchor="middle" x="225" y="-2139.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-2124.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="225" y="-2109.8" font-family="Times,serif" font-size="14.00">Q[0]×K[5]×V[5]</text>
<text text-anchor="middle" x="225" y="-2094.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_10&#45;&gt;ring_attn_3_0_stage_11 -->
<g id="edge86" class="edge">
<title>ring_attn_3_0_stage_10&#45;&gt;ring_attn_3_0_stage_11</title>
<path fill="none" stroke="black" d="M225,-2305.87C225,-2305.87 225,-2199.25 225,-2199.25"/>
<polygon fill="black" stroke="black" points="228.5,-2199.25 225,-2189.25 221.5,-2199.25 228.5,-2199.25"/>
</g>
<!-- ring_attn_3_1_stage_10 -->
<g id="node184" class="node">
<title>ring_attn_3_1_stage_10</title>
<polygon fill="yellow" stroke="black" points="3061,-2442 2852,-2374 3061,-2306 3270,-2374 3061,-2442"/>
<text text-anchor="middle" x="3061" y="-2392.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-2377.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="3061" y="-2362.8" font-family="Times,serif" font-size="14.00">Q[1]×K[7]×V[7]</text>
<text text-anchor="middle" x="3061" y="-2347.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_10&#45;&gt;ring_attn_3_1_stage_10 -->
<g id="edge1656" class="edge">
<title>ring_attn_3_0_stage_10&#45;&gt;ring_attn_3_1_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-2374C434.11,-2374 2841.79,-2374 2841.79,-2374"/>
<polygon fill="red" stroke="red" points="2841.79,-2377.5 2851.79,-2374 2841.79,-2370.5 2841.79,-2377.5"/>
</g>
<!-- ring_attn_3_0_stage_12 -->
<g id="node88" class="node">
<title>ring_attn_3_0_stage_12</title>
<polygon fill="yellow" stroke="black" points="225,-1936 16,-1868 225,-1800 434,-1868 225,-1936"/>
<text text-anchor="middle" x="225" y="-1886.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-1871.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="225" y="-1856.8" font-family="Times,serif" font-size="14.00">Q[0]×K[4]×V[4]</text>
<text text-anchor="middle" x="225" y="-1841.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_11&#45;&gt;ring_attn_3_0_stage_12 -->
<g id="edge87" class="edge">
<title>ring_attn_3_0_stage_11&#45;&gt;ring_attn_3_0_stage_12</title>
<path fill="none" stroke="black" d="M120.5,-2086.88C120.5,-2086.88 120.5,-1912.39 120.5,-1912.39"/>
<polygon fill="black" stroke="black" points="124,-1912.39 120.5,-1902.39 117,-1912.39 124,-1912.39"/>
</g>
<!-- ring_attn_3_1_stage_11 -->
<g id="node185" class="node">
<title>ring_attn_3_1_stage_11</title>
<polygon fill="yellow" stroke="black" points="3061,-2189 2852,-2121 3061,-2053 3270,-2121 3061,-2189"/>
<text text-anchor="middle" x="3061" y="-2139.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-2124.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="3061" y="-2109.8" font-family="Times,serif" font-size="14.00">Q[1]×K[6]×V[6]</text>
<text text-anchor="middle" x="3061" y="-2094.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_11&#45;&gt;ring_attn_3_1_stage_11 -->
<g id="edge1657" class="edge">
<title>ring_attn_3_0_stage_11&#45;&gt;ring_attn_3_1_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-2121C434.11,-2121 2841.79,-2121 2841.79,-2121"/>
<polygon fill="red" stroke="red" points="2841.79,-2124.5 2851.79,-2121 2841.79,-2117.5 2841.79,-2124.5"/>
</g>
<!-- ring_attn_3_0_stage_13 -->
<g id="node89" class="node">
<title>ring_attn_3_0_stage_13</title>
<polygon fill="yellow" stroke="black" points="225,-1683 16,-1615 225,-1547 434,-1615 225,-1683"/>
<text text-anchor="middle" x="225" y="-1633.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-1618.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="225" y="-1603.8" font-family="Times,serif" font-size="14.00">Q[0]×K[3]×V[3]</text>
<text text-anchor="middle" x="225" y="-1588.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_12&#45;&gt;ring_attn_3_0_stage_13 -->
<g id="edge88" class="edge">
<title>ring_attn_3_0_stage_12&#45;&gt;ring_attn_3_0_stage_13</title>
<path fill="none" stroke="black" d="M225,-1799.87C225,-1799.87 225,-1693.25 225,-1693.25"/>
<polygon fill="black" stroke="black" points="228.5,-1693.25 225,-1683.25 221.5,-1693.25 228.5,-1693.25"/>
</g>
<!-- ring_attn_3_1_stage_12 -->
<g id="node186" class="node">
<title>ring_attn_3_1_stage_12</title>
<polygon fill="yellow" stroke="black" points="3061,-1936 2852,-1868 3061,-1800 3270,-1868 3061,-1936"/>
<text text-anchor="middle" x="3061" y="-1886.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-1871.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="3061" y="-1856.8" font-family="Times,serif" font-size="14.00">Q[1]×K[5]×V[5]</text>
<text text-anchor="middle" x="3061" y="-1841.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_12&#45;&gt;ring_attn_3_1_stage_12 -->
<g id="edge1658" class="edge">
<title>ring_attn_3_0_stage_12&#45;&gt;ring_attn_3_1_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-1868C434.11,-1868 2841.79,-1868 2841.79,-1868"/>
<polygon fill="red" stroke="red" points="2841.79,-1871.5 2851.79,-1868 2841.79,-1864.5 2841.79,-1871.5"/>
</g>
<!-- ring_attn_3_0_stage_14 -->
<g id="node90" class="node">
<title>ring_attn_3_0_stage_14</title>
<polygon fill="yellow" stroke="black" points="225,-1430 16,-1362 225,-1294 434,-1362 225,-1430"/>
<text text-anchor="middle" x="225" y="-1380.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-1365.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="225" y="-1350.8" font-family="Times,serif" font-size="14.00">Q[0]×K[2]×V[2]</text>
<text text-anchor="middle" x="225" y="-1335.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_13&#45;&gt;ring_attn_3_0_stage_14 -->
<g id="edge89" class="edge">
<title>ring_attn_3_0_stage_13&#45;&gt;ring_attn_3_0_stage_14</title>
<path fill="none" stroke="black" d="M120.5,-1580.88C120.5,-1580.88 120.5,-1406.39 120.5,-1406.39"/>
<polygon fill="black" stroke="black" points="124,-1406.39 120.5,-1396.39 117,-1406.39 124,-1406.39"/>
</g>
<!-- ring_attn_3_1_stage_13 -->
<g id="node187" class="node">
<title>ring_attn_3_1_stage_13</title>
<polygon fill="yellow" stroke="black" points="3061,-1683 2852,-1615 3061,-1547 3270,-1615 3061,-1683"/>
<text text-anchor="middle" x="3061" y="-1633.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-1618.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="3061" y="-1603.8" font-family="Times,serif" font-size="14.00">Q[1]×K[4]×V[4]</text>
<text text-anchor="middle" x="3061" y="-1588.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_13&#45;&gt;ring_attn_3_1_stage_13 -->
<g id="edge1659" class="edge">
<title>ring_attn_3_0_stage_13&#45;&gt;ring_attn_3_1_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-1615C434.11,-1615 2841.79,-1615 2841.79,-1615"/>
<polygon fill="red" stroke="red" points="2841.79,-1618.5 2851.79,-1615 2841.79,-1611.5 2841.79,-1618.5"/>
</g>
<!-- ring_attn_3_0_stage_15 -->
<g id="node91" class="node">
<title>ring_attn_3_0_stage_15</title>
<polygon fill="yellow" stroke="black" points="225,-1177 16,-1109 225,-1041 434,-1109 225,-1177"/>
<text text-anchor="middle" x="225" y="-1127.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="225" y="-1112.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="225" y="-1097.8" font-family="Times,serif" font-size="14.00">Q[0]×K[1]×V[1]</text>
<text text-anchor="middle" x="225" y="-1082.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_14&#45;&gt;ring_attn_3_0_stage_15 -->
<g id="edge90" class="edge">
<title>ring_attn_3_0_stage_14&#45;&gt;ring_attn_3_0_stage_15</title>
<path fill="none" stroke="black" d="M225,-1293.87C225,-1293.87 225,-1187.25 225,-1187.25"/>
<polygon fill="black" stroke="black" points="228.5,-1187.25 225,-1177.25 221.5,-1187.25 228.5,-1187.25"/>
</g>
<!-- ring_attn_3_1_stage_14 -->
<g id="node188" class="node">
<title>ring_attn_3_1_stage_14</title>
<polygon fill="yellow" stroke="black" points="3061,-1430 2852,-1362 3061,-1294 3270,-1362 3061,-1430"/>
<text text-anchor="middle" x="3061" y="-1380.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-1365.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="3061" y="-1350.8" font-family="Times,serif" font-size="14.00">Q[1]×K[3]×V[3]</text>
<text text-anchor="middle" x="3061" y="-1335.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_14&#45;&gt;ring_attn_3_1_stage_14 -->
<g id="edge1660" class="edge">
<title>ring_attn_3_0_stage_14&#45;&gt;ring_attn_3_1_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-1362C434.11,-1362 2841.79,-1362 2841.79,-1362"/>
<polygon fill="red" stroke="red" points="2841.79,-1365.5 2851.79,-1362 2841.79,-1358.5 2841.79,-1365.5"/>
</g>
<!-- attn_out_3_0 -->
<g id="node92" class="node">
<title>attn_out_3_0</title>
<polygon fill="none" stroke="black" points="294.5,-968 155.5,-968 155.5,-915 294.5,-915 294.5,-968"/>
<text text-anchor="middle" x="225" y="-952.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="225" y="-937.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="225" y="-922.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_3_0_stage_15&#45;&gt;attn_out_3_0 -->
<g id="edge91" class="edge">
<title>ring_attn_3_0_stage_15&#45;&gt;attn_out_3_0</title>
<path fill="none" stroke="black" d="M225,-1040.87C225,-1040.87 225,-978.18 225,-978.18"/>
<polygon fill="black" stroke="black" points="228.5,-978.18 225,-968.18 221.5,-978.18 228.5,-978.18"/>
</g>
<!-- ring_attn_3_1_stage_15 -->
<g id="node189" class="node">
<title>ring_attn_3_1_stage_15</title>
<polygon fill="yellow" stroke="black" points="3061,-1177 2852,-1109 3061,-1041 3270,-1109 3061,-1177"/>
<text text-anchor="middle" x="3061" y="-1127.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3061" y="-1112.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="3061" y="-1097.8" font-family="Times,serif" font-size="14.00">Q[1]×K[2]×V[2]</text>
<text text-anchor="middle" x="3061" y="-1082.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_0_stage_15&#45;&gt;ring_attn_3_1_stage_15 -->
<g id="edge1661" class="edge">
<title>ring_attn_3_0_stage_15&#45;&gt;ring_attn_3_1_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M434.11,-1109C434.11,-1109 2841.79,-1109 2841.79,-1109"/>
<polygon fill="red" stroke="red" points="2841.79,-1112.5 2851.79,-1109 2841.79,-1105.5 2841.79,-1112.5"/>
</g>
<!-- attn_residual_3_0 -->
<g id="node93" class="node">
<title>attn_residual_3_0</title>
<ellipse fill="none" stroke="black" cx="225" cy="-815" rx="105.5" ry="27"/>
<text text-anchor="middle" x="225" y="-818.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="225" y="-803.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_3_0&#45;&gt;attn_residual_3_0 -->
<g id="edge92" class="edge">
<title>attn_out_3_0&#45;&gt;attn_residual_3_0</title>
<path fill="none" stroke="black" d="M225,-914.98C225,-914.98 225,-852.36 225,-852.36"/>
<polygon fill="black" stroke="black" points="228.5,-852.36 225,-842.36 221.5,-852.36 228.5,-852.36"/>
</g>
<!-- gate_3_0 -->
<g id="node94" class="node">
<title>gate_3_0</title>
<ellipse fill="orange" stroke="black" cx="225" cy="-677.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="225" y="-688.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="225" y="-673.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="225" y="-658.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_3_0&#45;&gt;gate_3_0 -->
<g id="edge93" class="edge">
<title>attn_residual_3_0&#45;&gt;gate_3_0</title>
<path fill="none" stroke="black" d="M145.88,-797.02C145.88,-797.02 145.88,-712.47 145.88,-712.47"/>
<polygon fill="black" stroke="black" points="149.38,-712.47 145.88,-702.47 142.38,-712.47 149.38,-712.47"/>
</g>
<!-- expert_3_0_0 -->
<g id="node95" class="node">
<title>expert_3_0_0</title>
<polygon fill="lightpink" stroke="black" points="344,-508 106,-508 106,-455 344,-455 344,-508"/>
<text text-anchor="middle" x="225" y="-492.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="225" y="-477.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="225" y="-462.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_3_0&#45;&gt;expert_3_0_0 -->
<g id="edge94" class="edge">
<title>gate_3_0&#45;&gt;expert_3_0_0</title>
<path fill="none" stroke="black" d="M133.57,-658.71C133.57,-658.71 133.57,-518.29 133.57,-518.29"/>
<polygon fill="black" stroke="black" points="137.07,-518.29 133.57,-508.29 130.07,-518.29 137.07,-518.29"/>
</g>
<!-- expert_3_1_0 -->
<g id="node193" class="node">
<title>expert_3_1_0</title>
<polygon fill="lightpink" stroke="black" points="3180,-508 2942,-508 2942,-455 3180,-455 3180,-508"/>
<text text-anchor="middle" x="3061" y="-492.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="3061" y="-477.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="3061" y="-462.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_3_0&#45;&gt;expert_3_1_0 -->
<g id="edge1662" class="edge">
<title>gate_3_0&#45;&gt;expert_3_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M324.76,-665C815.39,-665 2948.75,-665 2948.75,-665 2948.75,-665 2948.75,-518.18 2948.75,-518.18"/>
<polygon fill="blue" stroke="blue" points="2952.25,-518.18 2948.75,-508.18 2945.25,-518.18 2952.25,-518.18"/>
<text text-anchor="middle" x="333.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="333.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU0→GPU1</text>
<text text-anchor="middle" x="333.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="333.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_2_0 -->
<g id="node291" class="node">
<title>expert_3_2_0</title>
<polygon fill="lightpink" stroke="black" points="3767,-508 3529,-508 3529,-455 3767,-455 3767,-508"/>
<text text-anchor="middle" x="3648" y="-492.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="3648" y="-477.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="3648" y="-462.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_3_0&#45;&gt;expert_3_2_0 -->
<g id="edge1663" class="edge">
<title>gate_3_0&#45;&gt;expert_3_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M217.97,-639.91C217.97,-638.09 217.97,-637 217.97,-637 217.97,-637 3558.13,-637 3558.13,-637 3558.13,-637 3558.13,-518.23 3558.13,-518.23"/>
<polygon fill="blue" stroke="blue" points="3561.63,-518.23 3558.13,-508.23 3554.63,-518.23 3561.63,-518.23"/>
<text text-anchor="middle" x="507.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="507.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU0→GPU2</text>
<text text-anchor="middle" x="507.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="507.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_3_0 -->
<g id="node389" class="node">
<title>expert_3_3_0</title>
<polygon fill="lightpink" stroke="black" points="4354,-508 4116,-508 4116,-455 4354,-455 4354,-508"/>
<text text-anchor="middle" x="4235" y="-492.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="4235" y="-477.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="4235" y="-462.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_3_0&#45;&gt;expert_3_3_0 -->
<g id="edge1664" class="edge">
<title>gate_3_0&#45;&gt;expert_3_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M232.03,-639.87C232.03,-627.57 232.03,-617 232.03,-617 232.03,-617 4146.38,-617 4146.38,-617 4146.38,-617 4146.38,-518.27 4146.38,-518.27"/>
<polygon fill="blue" stroke="blue" points="4149.88,-518.27 4146.38,-508.27 4142.88,-518.27 4149.88,-518.27"/>
<text text-anchor="middle" x="681.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="681.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU0→GPU3</text>
<text text-anchor="middle" x="681.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="681.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_4_0 -->
<g id="node487" class="node">
<title>expert_3_4_0</title>
<polygon fill="lightpink" stroke="black" points="4941,-508 4703,-508 4703,-455 4941,-455 4941,-508"/>
<text text-anchor="middle" x="4822" y="-492.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="4822" y="-477.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="4822" y="-462.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_3_0&#45;&gt;expert_3_4_0 -->
<g id="edge1665" class="edge">
<title>gate_3_0&#45;&gt;expert_3_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M246.1,-640.74C246.1,-591.44 246.1,-510 246.1,-510 246.1,-510 4736.6,-510 4736.6,-510 4736.6,-510 4736.6,-509.81 4736.6,-509.81"/>
<polygon fill="blue" stroke="blue" points="4740.1,-518.13 4736.6,-508.13 4733.1,-518.13 4740.1,-518.13"/>
<text text-anchor="middle" x="855.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="855.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU0→GPU4</text>
<text text-anchor="middle" x="855.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="855.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_5_0 -->
<g id="node585" class="node">
<title>expert_3_5_0</title>
<polygon fill="lightpink" stroke="black" points="5528,-508 5290,-508 5290,-455 5528,-455 5528,-508"/>
<text text-anchor="middle" x="5409" y="-492.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="5409" y="-477.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="5409" y="-462.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_3_0&#45;&gt;expert_3_5_0 -->
<g id="edge1666" class="edge">
<title>gate_3_0&#45;&gt;expert_3_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M260.17,-641.91C260.17,-626.1 260.17,-611 260.17,-611 260.17,-611 5323.6,-611 5323.6,-611 5323.6,-611 5323.6,-518.02 5323.6,-518.02"/>
<polygon fill="blue" stroke="blue" points="5327.1,-518.02 5323.6,-508.02 5320.1,-518.02 5327.1,-518.02"/>
<text text-anchor="middle" x="1029.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1029.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU0→GPU5</text>
<text text-anchor="middle" x="1029.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1029.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_6_0 -->
<g id="node683" class="node">
<title>expert_3_6_0</title>
<polygon fill="lightpink" stroke="black" points="6115,-508 5877,-508 5877,-455 6115,-455 6115,-508"/>
<text text-anchor="middle" x="5996" y="-492.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="5996" y="-477.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="5996" y="-462.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_3_0&#45;&gt;expert_3_6_0 -->
<g id="edge1667" class="edge">
<title>gate_3_0&#45;&gt;expert_3_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M274.23,-644.21C274.23,-596.14 274.23,-513 274.23,-513 274.23,-513 5651.8,-513 5651.8,-513 5651.8,-513 5651.8,-490 5651.8,-490 5651.8,-490 5866.58,-490 5866.58,-490"/>
<polygon fill="blue" stroke="blue" points="5866.58,-493.5 5876.58,-490 5866.58,-486.5 5866.58,-493.5"/>
<text text-anchor="middle" x="1203.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1203.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU0→GPU6</text>
<text text-anchor="middle" x="1203.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1203.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_7_0 -->
<g id="node781" class="node">
<title>expert_3_7_0</title>
<polygon fill="lightpink" stroke="black" points="6702,-508 6464,-508 6464,-455 6702,-455 6702,-508"/>
<text text-anchor="middle" x="6583" y="-492.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="6583" y="-477.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="6583" y="-462.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_3_0&#45;&gt;expert_3_7_0 -->
<g id="edge1668" class="edge">
<title>gate_3_0&#45;&gt;expert_3_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M304.12,-702.45C304.12,-725.1 304.12,-755 304.12,-755 304.12,-755 6160,-755 6160,-755 6160,-755 6160,-481 6160,-481 6160,-481 6453.76,-481 6453.76,-481"/>
<polygon fill="blue" stroke="blue" points="6453.76,-484.5 6463.76,-481 6453.76,-477.5 6453.76,-484.5"/>
<text text-anchor="middle" x="1377.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1377.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU0→GPU7</text>
<text text-anchor="middle" x="1377.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1377.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_8_0 -->
<g id="node879" class="node">
<title>expert_3_8_0</title>
<polygon fill="lightpink" stroke="black" points="7289,-508 7051,-508 7051,-455 7289,-455 7289,-508"/>
<text text-anchor="middle" x="7170" y="-492.8" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="7170" y="-477.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="7170" y="-462.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_3_0&#45;&gt;expert_3_8_0 -->
<g id="edge1669" class="edge">
<title>gate_3_0&#45;&gt;expert_3_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M277.75,-710.2C277.75,-734.7 277.75,-764 277.75,-764 277.75,-764 6747,-764 6747,-764 6747,-764 6747,-481 6747,-481 6747,-481 7040.76,-481 7040.76,-481"/>
<polygon fill="blue" stroke="blue" points="7040.76,-484.5 7050.76,-481 7040.76,-477.5 7040.76,-484.5"/>
<text text-anchor="middle" x="1551.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1551.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU0→GPU8</text>
<text text-anchor="middle" x="1551.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1551.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_9_0 -->
<g id="node977" class="node">
<title>expert_3_9_0</title>
<polygon fill="lightpink" stroke="black" points="7876,-508 7638,-508 7638,-455 7876,-455 7876,-508"/>
<text text-anchor="middle" x="7757" y="-492.8" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="7757" y="-477.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="7757" y="-462.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_3_0&#45;&gt;expert_3_9_0 -->
<g id="edge1670" class="edge">
<title>gate_3_0&#45;&gt;expert_3_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M251.38,-713.93C251.38,-739.44 251.38,-769 251.38,-769 251.38,-769 7334,-769 7334,-769 7334,-769 7334,-481 7334,-481 7334,-481 7627.76,-481 7627.76,-481"/>
<polygon fill="blue" stroke="blue" points="7627.76,-484.5 7637.76,-481 7627.76,-477.5 7627.76,-484.5"/>
<text text-anchor="middle" x="1725.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1725.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU0→GPU9</text>
<text text-anchor="middle" x="1725.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1725.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_10_0 -->
<g id="node1075" class="node">
<title>expert_3_10_0</title>
<polygon fill="lightpink" stroke="black" points="8463,-508 8225,-508 8225,-455 8463,-455 8463,-508"/>
<text text-anchor="middle" x="8344" y="-492.8" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="8344" y="-477.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="8344" y="-462.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_3_0&#45;&gt;expert_3_10_0 -->
<g id="edge1671" class="edge">
<title>gate_3_0&#45;&gt;expert_3_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M225,-715.24C225,-741.94 225,-773 225,-773 225,-773 7921,-773 7921,-773 7921,-773 7921,-481 7921,-481 7921,-481 8214.76,-481 8214.76,-481"/>
<polygon fill="blue" stroke="blue" points="8214.76,-484.5 8224.76,-481 8214.76,-477.5 8214.76,-484.5"/>
<text text-anchor="middle" x="1899.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1899.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU0→GPU10</text>
<text text-anchor="middle" x="1899.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="1899.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_11_0 -->
<g id="node1173" class="node">
<title>expert_3_11_0</title>
<polygon fill="lightpink" stroke="black" points="9050,-508 8812,-508 8812,-455 9050,-455 9050,-508"/>
<text text-anchor="middle" x="8931" y="-492.8" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="8931" y="-477.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="8931" y="-462.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_3_0&#45;&gt;expert_3_11_0 -->
<g id="edge1672" class="edge">
<title>gate_3_0&#45;&gt;expert_3_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M198.62,-714.07C198.62,-742.8 198.62,-778 198.62,-778 198.62,-778 8508,-778 8508,-778 8508,-778 8508,-472 8508,-472 8508,-472 8801.76,-472 8801.76,-472"/>
<polygon fill="blue" stroke="blue" points="8801.76,-475.5 8811.76,-472 8801.76,-468.5 8801.76,-475.5"/>
<text text-anchor="middle" x="2073.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2073.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU0→GPU11</text>
<text text-anchor="middle" x="2073.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="2073.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_12_0 -->
<g id="node1271" class="node">
<title>expert_3_12_0</title>
<polygon fill="lightpink" stroke="black" points="9637,-508 9399,-508 9399,-455 9637,-455 9637,-508"/>
<text text-anchor="middle" x="9518" y="-492.8" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="9518" y="-477.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="9518" y="-462.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_3_0&#45;&gt;expert_3_12_0 -->
<g id="edge1673" class="edge">
<title>gate_3_0&#45;&gt;expert_3_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M172.25,-710.01C172.25,-741.01 172.25,-783 172.25,-783 172.25,-783 9095,-783 9095,-783 9095,-783 9095,-481 9095,-481 9095,-481 9388.76,-481 9388.76,-481"/>
<polygon fill="blue" stroke="blue" points="9388.76,-484.5 9398.76,-481 9388.76,-477.5 9388.76,-484.5"/>
<text text-anchor="middle" x="2247.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2247.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU0→GPU12</text>
<text text-anchor="middle" x="2247.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="2247.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_13_0 -->
<g id="node1369" class="node">
<title>expert_3_13_0</title>
<polygon fill="lightpink" stroke="black" points="10224,-508 9986,-508 9986,-455 10224,-455 10224,-508"/>
<text text-anchor="middle" x="10105" y="-492.8" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="10105" y="-477.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="10105" y="-462.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_3_0&#45;&gt;expert_3_13_0 -->
<g id="edge1674" class="edge">
<title>gate_3_0&#45;&gt;expert_3_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M288.3,-647.13C288.3,-601.36 288.3,-520 288.3,-520 288.3,-520 10016.38,-520 10016.38,-520 10016.38,-520 10016.38,-518.24 10016.38,-518.24"/>
<polygon fill="blue" stroke="blue" points="10019.88,-518.24 10016.38,-508.24 10012.88,-518.24 10019.88,-518.24"/>
<text text-anchor="middle" x="2421.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2421.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU0→GPU13</text>
<text text-anchor="middle" x="2421.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="2421.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_14_0 -->
<g id="node1467" class="node">
<title>expert_3_14_0</title>
<polygon fill="lightpink" stroke="black" points="10811,-508 10573,-508 10573,-455 10811,-455 10811,-508"/>
<text text-anchor="middle" x="10692" y="-492.8" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="10692" y="-477.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="10692" y="-462.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_3_0&#45;&gt;expert_3_14_0 -->
<g id="edge1675" class="edge">
<title>gate_3_0&#45;&gt;expert_3_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M302.37,-651.66C302.37,-607.21 302.37,-521 302.37,-521 302.37,-521 10606.6,-521 10606.6,-521 10606.6,-521 10606.6,-518.07 10606.6,-518.07"/>
<polygon fill="blue" stroke="blue" points="10610.1,-518.07 10606.6,-508.07 10603.1,-518.07 10610.1,-518.07"/>
<text text-anchor="middle" x="2595.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2595.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU0→GPU14</text>
<text text-anchor="middle" x="2595.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="2595.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_15_0 -->
<g id="node1565" class="node">
<title>expert_3_15_0</title>
<polygon fill="lightpink" stroke="black" points="11398,-508 11160,-508 11160,-455 11398,-455 11398,-508"/>
<text text-anchor="middle" x="11279" y="-492.8" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="11279" y="-477.8" font-family="Times,serif" font-size="14.00">FFN: 4096→16384→4096</text>
<text text-anchor="middle" x="11279" y="-462.8" font-family="Times,serif" font-size="14.00">Capacity: 1.25×1024×1024/16</text>
</g>
<!-- gate_3_0&#45;&gt;expert_3_15_0 -->
<g id="edge1676" class="edge">
<title>gate_3_0&#45;&gt;expert_3_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M316.43,-658.62C316.43,-617 316.43,-521 316.43,-521 316.43,-521 11195.71,-521 11195.71,-521 11195.71,-521 11195.71,-518.07 11195.71,-518.07"/>
<polygon fill="blue" stroke="blue" points="11199.21,-518.07 11195.71,-508.07 11192.21,-518.07 11199.21,-518.07"/>
<text text-anchor="middle" x="2769.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2769.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU0→GPU15</text>
<text text-anchor="middle" x="2769.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="2769.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_0 -->
<g id="node96" class="node">
<title>expert_reduce_3_0</title>
<ellipse fill="none" stroke="black" cx="225" cy="-344.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="225" y="-355.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="225" y="-340.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="225" y="-325.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_0_0&#45;&gt;expert_reduce_3_0 -->
<g id="edge95" class="edge">
<title>expert_3_0_0&#45;&gt;expert_reduce_3_0</title>
<path fill="none" stroke="black" d="M225,-454.76C225,-454.76 225,-392.06 225,-392.06"/>
<polygon fill="black" stroke="black" points="228.5,-392.06 225,-382.06 221.5,-392.06 228.5,-392.06"/>
</g>
<!-- moe_residual_3_0 -->
<g id="node97" class="node">
<title>moe_residual_3_0</title>
<ellipse fill="none" stroke="black" cx="225" cy="-207" rx="105.5" ry="27"/>
<text text-anchor="middle" x="225" y="-210.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="225" y="-195.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_0&#45;&gt;moe_residual_3_0 -->
<g id="edge96" class="edge">
<title>expert_reduce_3_0&#45;&gt;moe_residual_3_0</title>
<path fill="none" stroke="black" d="M225,-306.93C225,-306.93 225,-244.06 225,-244.06"/>
<polygon fill="black" stroke="black" points="228.5,-244.06 225,-234.06 221.5,-244.06 228.5,-244.06"/>
</g>
<!-- output_0 -->
<g id="node98" class="node">
<title>output_0</title>
<polygon fill="lightcoral" stroke="black" points="318,-107 132,-107 132,-69 318,-69 318,-107"/>
<text text-anchor="middle" x="225" y="-91.8" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="225" y="-76.8" font-family="Times,serif" font-size="14.00">Y[0]: 1024×1024×4096</text>
</g>
<!-- moe_residual_3_0&#45;&gt;output_0 -->
<g id="edge97" class="edge">
<title>moe_residual_3_0&#45;&gt;output_0</title>
<path fill="none" stroke="black" d="M225,-180C225,-180 225,-117.12 225,-117.12"/>
<polygon fill="black" stroke="black" points="228.5,-117.12 225,-107.12 221.5,-117.12 228.5,-117.12"/>
</g>
<!-- input_1 -->
<g id="node99" class="node">
<title>input_1</title>
<polygon fill="lightgreen" stroke="black" points="3154.5,-20866 2967.5,-20866 2967.5,-20828 3154.5,-20828 3154.5,-20866"/>
<text text-anchor="middle" x="3061" y="-20850.8" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="3061" y="-20835.8" font-family="Times,serif" font-size="14.00">X[1]: 1024×1024×4096</text>
</g>
<!-- qkv_proj_0_1 -->
<g id="node100" class="node">
<title>qkv_proj_0_1</title>
<polygon fill="none" stroke="black" points="3143.5,-20755 2978.5,-20755 2978.5,-20702 3143.5,-20702 3143.5,-20755"/>
<text text-anchor="middle" x="3061" y="-20739.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="3061" y="-20724.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="3061" y="-20709.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- input_1&#45;&gt;qkv_proj_0_1 -->
<g id="edge98" class="edge">
<title>input_1&#45;&gt;qkv_proj_0_1</title>
<path fill="none" stroke="black" d="M3061,-20827.96C3061,-20827.96 3061,-20765.44 3061,-20765.44"/>
<polygon fill="black" stroke="black" points="3064.5,-20765.44 3061,-20755.44 3057.5,-20765.44 3064.5,-20765.44"/>
</g>
<!-- qkv_reshape_0_1 -->
<g id="node101" class="node">
<title>qkv_reshape_0_1</title>
<ellipse fill="none" stroke="black" cx="3061" cy="-20602" rx="148" ry="27"/>
<text text-anchor="middle" x="3061" y="-20605.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="3061" y="-20590.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_0_1&#45;&gt;qkv_reshape_0_1 -->
<g id="edge99" class="edge">
<title>qkv_proj_0_1&#45;&gt;qkv_reshape_0_1</title>
<path fill="none" stroke="black" d="M3061,-20701.98C3061,-20701.98 3061,-20639.36 3061,-20639.36"/>
<polygon fill="black" stroke="black" points="3064.5,-20639.36 3061,-20629.36 3057.5,-20639.36 3064.5,-20639.36"/>
</g>
<!-- qkv_reshape_0_1&#45;&gt;ring_attn_0_1_stage_0 -->
<g id="edge100" class="edge">
<title>qkv_reshape_0_1&#45;&gt;ring_attn_0_1_stage_0</title>
<path fill="none" stroke="black" d="M3061,-20574.72C3061,-20574.72 3061,-20468.16 3061,-20468.16"/>
<polygon fill="black" stroke="black" points="3064.5,-20468.16 3061,-20458.16 3057.5,-20468.16 3064.5,-20468.16"/>
</g>
<!-- ring_attn_0_1_stage_0&#45;&gt;ring_attn_0_1_stage_1 -->
<g id="edge101" class="edge">
<title>ring_attn_0_1_stage_0&#45;&gt;ring_attn_0_1_stage_1</title>
<path fill="none" stroke="black" d="M3061,-20321.87C3061,-20321.87 3061,-20215.25 3061,-20215.25"/>
<polygon fill="black" stroke="black" points="3064.5,-20215.25 3061,-20205.25 3057.5,-20215.25 3064.5,-20215.25"/>
</g>
<!-- ring_attn_0_2_stage_0 -->
<g id="node200" class="node">
<title>ring_attn_0_2_stage_0</title>
<polygon fill="yellow" stroke="black" points="3648,-20458 3439,-20390 3648,-20322 3857,-20390 3648,-20458"/>
<text text-anchor="middle" x="3648" y="-20408.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-20393.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="3648" y="-20378.8" font-family="Times,serif" font-size="14.00">Q[2]×K[2]×V[2]</text>
<text text-anchor="middle" x="3648" y="-20363.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_1_stage_0&#45;&gt;ring_attn_0_2_stage_0 -->
<g id="edge1677" class="edge">
<title>ring_attn_0_1_stage_0&#45;&gt;ring_attn_0_2_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-20390C3270.02,-20390 3428.86,-20390 3428.86,-20390"/>
<polygon fill="red" stroke="red" points="3428.86,-20393.5 3438.86,-20390 3428.86,-20386.5 3428.86,-20393.5"/>
</g>
<!-- ring_attn_0_1_stage_1&#45;&gt;ring_attn_0_1_stage_2 -->
<g id="edge102" class="edge">
<title>ring_attn_0_1_stage_1&#45;&gt;ring_attn_0_1_stage_2</title>
<path fill="none" stroke="black" d="M3061,-20068.87C3061,-20068.87 3061,-19962.25 3061,-19962.25"/>
<polygon fill="black" stroke="black" points="3064.5,-19962.25 3061,-19952.25 3057.5,-19962.25 3064.5,-19962.25"/>
</g>
<!-- ring_attn_0_2_stage_1 -->
<g id="node201" class="node">
<title>ring_attn_0_2_stage_1</title>
<polygon fill="yellow" stroke="black" points="3648,-20205 3439,-20137 3648,-20069 3857,-20137 3648,-20205"/>
<text text-anchor="middle" x="3648" y="-20155.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-20140.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="3648" y="-20125.8" font-family="Times,serif" font-size="14.00">Q[2]×K[1]×V[1]</text>
<text text-anchor="middle" x="3648" y="-20110.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_1_stage_1&#45;&gt;ring_attn_0_2_stage_1 -->
<g id="edge1678" class="edge">
<title>ring_attn_0_1_stage_1&#45;&gt;ring_attn_0_2_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-20137C3270.02,-20137 3428.86,-20137 3428.86,-20137"/>
<polygon fill="red" stroke="red" points="3428.86,-20140.5 3438.86,-20137 3428.86,-20133.5 3428.86,-20140.5"/>
</g>
<!-- ring_attn_0_1_stage_2&#45;&gt;ring_attn_0_1_stage_3 -->
<g id="edge103" class="edge">
<title>ring_attn_0_1_stage_2&#45;&gt;ring_attn_0_1_stage_3</title>
<path fill="none" stroke="black" d="M3061,-19815.87C3061,-19815.87 3061,-19709.25 3061,-19709.25"/>
<polygon fill="black" stroke="black" points="3064.5,-19709.25 3061,-19699.25 3057.5,-19709.25 3064.5,-19709.25"/>
</g>
<!-- ring_attn_0_2_stage_2 -->
<g id="node202" class="node">
<title>ring_attn_0_2_stage_2</title>
<polygon fill="yellow" stroke="black" points="3648,-19952 3439,-19884 3648,-19816 3857,-19884 3648,-19952"/>
<text text-anchor="middle" x="3648" y="-19902.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-19887.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="3648" y="-19872.8" font-family="Times,serif" font-size="14.00">Q[2]×K[0]×V[0]</text>
<text text-anchor="middle" x="3648" y="-19857.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_1_stage_2&#45;&gt;ring_attn_0_2_stage_2 -->
<g id="edge1679" class="edge">
<title>ring_attn_0_1_stage_2&#45;&gt;ring_attn_0_2_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-19884C3270.02,-19884 3428.86,-19884 3428.86,-19884"/>
<polygon fill="red" stroke="red" points="3428.86,-19887.5 3438.86,-19884 3428.86,-19880.5 3428.86,-19887.5"/>
</g>
<!-- ring_attn_0_1_stage_3&#45;&gt;ring_attn_0_1_stage_4 -->
<g id="edge104" class="edge">
<title>ring_attn_0_1_stage_3&#45;&gt;ring_attn_0_1_stage_4</title>
<path fill="none" stroke="black" d="M3061,-19562.87C3061,-19562.87 3061,-19456.25 3061,-19456.25"/>
<polygon fill="black" stroke="black" points="3064.5,-19456.25 3061,-19446.25 3057.5,-19456.25 3064.5,-19456.25"/>
</g>
<!-- ring_attn_0_2_stage_3 -->
<g id="node203" class="node">
<title>ring_attn_0_2_stage_3</title>
<polygon fill="yellow" stroke="black" points="3648,-19699 3439,-19631 3648,-19563 3857,-19631 3648,-19699"/>
<text text-anchor="middle" x="3648" y="-19649.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-19634.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="3648" y="-19619.8" font-family="Times,serif" font-size="14.00">Q[2]×K[15]×V[15]</text>
<text text-anchor="middle" x="3648" y="-19604.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_1_stage_3&#45;&gt;ring_attn_0_2_stage_3 -->
<g id="edge1680" class="edge">
<title>ring_attn_0_1_stage_3&#45;&gt;ring_attn_0_2_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-19631C3270.02,-19631 3428.86,-19631 3428.86,-19631"/>
<polygon fill="red" stroke="red" points="3428.86,-19634.5 3438.86,-19631 3428.86,-19627.5 3428.86,-19634.5"/>
</g>
<!-- ring_attn_0_1_stage_4&#45;&gt;ring_attn_0_1_stage_5 -->
<g id="edge105" class="edge">
<title>ring_attn_0_1_stage_4&#45;&gt;ring_attn_0_1_stage_5</title>
<path fill="none" stroke="black" d="M3061,-19309.87C3061,-19309.87 3061,-19203.25 3061,-19203.25"/>
<polygon fill="black" stroke="black" points="3064.5,-19203.25 3061,-19193.25 3057.5,-19203.25 3064.5,-19203.25"/>
</g>
<!-- ring_attn_0_2_stage_4 -->
<g id="node204" class="node">
<title>ring_attn_0_2_stage_4</title>
<polygon fill="yellow" stroke="black" points="3648,-19446 3439,-19378 3648,-19310 3857,-19378 3648,-19446"/>
<text text-anchor="middle" x="3648" y="-19396.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-19381.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="3648" y="-19366.8" font-family="Times,serif" font-size="14.00">Q[2]×K[14]×V[14]</text>
<text text-anchor="middle" x="3648" y="-19351.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_1_stage_4&#45;&gt;ring_attn_0_2_stage_4 -->
<g id="edge1681" class="edge">
<title>ring_attn_0_1_stage_4&#45;&gt;ring_attn_0_2_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-19378C3270.02,-19378 3428.86,-19378 3428.86,-19378"/>
<polygon fill="red" stroke="red" points="3428.86,-19381.5 3438.86,-19378 3428.86,-19374.5 3428.86,-19381.5"/>
</g>
<!-- ring_attn_0_1_stage_5&#45;&gt;ring_attn_0_1_stage_6 -->
<g id="edge106" class="edge">
<title>ring_attn_0_1_stage_5&#45;&gt;ring_attn_0_1_stage_6</title>
<path fill="none" stroke="black" d="M3061,-19056.87C3061,-19056.87 3061,-18950.25 3061,-18950.25"/>
<polygon fill="black" stroke="black" points="3064.5,-18950.25 3061,-18940.25 3057.5,-18950.25 3064.5,-18950.25"/>
</g>
<!-- ring_attn_0_2_stage_5 -->
<g id="node205" class="node">
<title>ring_attn_0_2_stage_5</title>
<polygon fill="yellow" stroke="black" points="3648,-19193 3439,-19125 3648,-19057 3857,-19125 3648,-19193"/>
<text text-anchor="middle" x="3648" y="-19143.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-19128.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="3648" y="-19113.8" font-family="Times,serif" font-size="14.00">Q[2]×K[13]×V[13]</text>
<text text-anchor="middle" x="3648" y="-19098.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_1_stage_5&#45;&gt;ring_attn_0_2_stage_5 -->
<g id="edge1682" class="edge">
<title>ring_attn_0_1_stage_5&#45;&gt;ring_attn_0_2_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-19125C3270.02,-19125 3428.86,-19125 3428.86,-19125"/>
<polygon fill="red" stroke="red" points="3428.86,-19128.5 3438.86,-19125 3428.86,-19121.5 3428.86,-19128.5"/>
</g>
<!-- ring_attn_0_1_stage_6&#45;&gt;ring_attn_0_1_stage_7 -->
<g id="edge107" class="edge">
<title>ring_attn_0_1_stage_6&#45;&gt;ring_attn_0_1_stage_7</title>
<path fill="none" stroke="black" d="M3061,-18803.87C3061,-18803.87 3061,-18697.25 3061,-18697.25"/>
<polygon fill="black" stroke="black" points="3064.5,-18697.25 3061,-18687.25 3057.5,-18697.25 3064.5,-18697.25"/>
</g>
<!-- ring_attn_0_2_stage_6 -->
<g id="node206" class="node">
<title>ring_attn_0_2_stage_6</title>
<polygon fill="yellow" stroke="black" points="3648,-18940 3439,-18872 3648,-18804 3857,-18872 3648,-18940"/>
<text text-anchor="middle" x="3648" y="-18890.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-18875.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="3648" y="-18860.8" font-family="Times,serif" font-size="14.00">Q[2]×K[12]×V[12]</text>
<text text-anchor="middle" x="3648" y="-18845.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_1_stage_6&#45;&gt;ring_attn_0_2_stage_6 -->
<g id="edge1683" class="edge">
<title>ring_attn_0_1_stage_6&#45;&gt;ring_attn_0_2_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-18872C3270.02,-18872 3428.86,-18872 3428.86,-18872"/>
<polygon fill="red" stroke="red" points="3428.86,-18875.5 3438.86,-18872 3428.86,-18868.5 3428.86,-18875.5"/>
</g>
<!-- ring_attn_0_1_stage_7&#45;&gt;ring_attn_0_1_stage_8 -->
<g id="edge108" class="edge">
<title>ring_attn_0_1_stage_7&#45;&gt;ring_attn_0_1_stage_8</title>
<path fill="none" stroke="black" d="M3061,-18550.87C3061,-18550.87 3061,-18444.25 3061,-18444.25"/>
<polygon fill="black" stroke="black" points="3064.5,-18444.25 3061,-18434.25 3057.5,-18444.25 3064.5,-18444.25"/>
</g>
<!-- ring_attn_0_2_stage_7 -->
<g id="node207" class="node">
<title>ring_attn_0_2_stage_7</title>
<polygon fill="yellow" stroke="black" points="3648,-18687 3439,-18619 3648,-18551 3857,-18619 3648,-18687"/>
<text text-anchor="middle" x="3648" y="-18637.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-18622.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="3648" y="-18607.8" font-family="Times,serif" font-size="14.00">Q[2]×K[11]×V[11]</text>
<text text-anchor="middle" x="3648" y="-18592.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_1_stage_7&#45;&gt;ring_attn_0_2_stage_7 -->
<g id="edge1684" class="edge">
<title>ring_attn_0_1_stage_7&#45;&gt;ring_attn_0_2_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-18619C3270.02,-18619 3428.86,-18619 3428.86,-18619"/>
<polygon fill="red" stroke="red" points="3428.86,-18622.5 3438.86,-18619 3428.86,-18615.5 3428.86,-18622.5"/>
</g>
<!-- ring_attn_0_1_stage_8&#45;&gt;ring_attn_0_1_stage_9 -->
<g id="edge109" class="edge">
<title>ring_attn_0_1_stage_8&#45;&gt;ring_attn_0_1_stage_9</title>
<path fill="none" stroke="black" d="M3061,-18297.87C3061,-18297.87 3061,-18191.25 3061,-18191.25"/>
<polygon fill="black" stroke="black" points="3064.5,-18191.25 3061,-18181.25 3057.5,-18191.25 3064.5,-18191.25"/>
</g>
<!-- ring_attn_0_2_stage_8 -->
<g id="node208" class="node">
<title>ring_attn_0_2_stage_8</title>
<polygon fill="yellow" stroke="black" points="3648,-18434 3439,-18366 3648,-18298 3857,-18366 3648,-18434"/>
<text text-anchor="middle" x="3648" y="-18384.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-18369.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="3648" y="-18354.8" font-family="Times,serif" font-size="14.00">Q[2]×K[10]×V[10]</text>
<text text-anchor="middle" x="3648" y="-18339.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_1_stage_8&#45;&gt;ring_attn_0_2_stage_8 -->
<g id="edge1685" class="edge">
<title>ring_attn_0_1_stage_8&#45;&gt;ring_attn_0_2_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-18366C3270.02,-18366 3428.86,-18366 3428.86,-18366"/>
<polygon fill="red" stroke="red" points="3428.86,-18369.5 3438.86,-18366 3428.86,-18362.5 3428.86,-18369.5"/>
</g>
<!-- ring_attn_0_1_stage_9&#45;&gt;ring_attn_0_1_stage_10 -->
<g id="edge110" class="edge">
<title>ring_attn_0_1_stage_9&#45;&gt;ring_attn_0_1_stage_10</title>
<path fill="none" stroke="black" d="M3061,-18044.87C3061,-18044.87 3061,-17938.25 3061,-17938.25"/>
<polygon fill="black" stroke="black" points="3064.5,-17938.25 3061,-17928.25 3057.5,-17938.25 3064.5,-17938.25"/>
</g>
<!-- ring_attn_0_2_stage_9 -->
<g id="node209" class="node">
<title>ring_attn_0_2_stage_9</title>
<polygon fill="yellow" stroke="black" points="3648,-18181 3439,-18113 3648,-18045 3857,-18113 3648,-18181"/>
<text text-anchor="middle" x="3648" y="-18131.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-18116.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="3648" y="-18101.8" font-family="Times,serif" font-size="14.00">Q[2]×K[9]×V[9]</text>
<text text-anchor="middle" x="3648" y="-18086.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_1_stage_9&#45;&gt;ring_attn_0_2_stage_9 -->
<g id="edge1686" class="edge">
<title>ring_attn_0_1_stage_9&#45;&gt;ring_attn_0_2_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-18113C3270.02,-18113 3428.86,-18113 3428.86,-18113"/>
<polygon fill="red" stroke="red" points="3428.86,-18116.5 3438.86,-18113 3428.86,-18109.5 3428.86,-18116.5"/>
</g>
<!-- ring_attn_0_1_stage_10&#45;&gt;ring_attn_0_1_stage_11 -->
<g id="edge111" class="edge">
<title>ring_attn_0_1_stage_10&#45;&gt;ring_attn_0_1_stage_11</title>
<path fill="none" stroke="black" d="M3061,-17791.87C3061,-17791.87 3061,-17685.25 3061,-17685.25"/>
<polygon fill="black" stroke="black" points="3064.5,-17685.25 3061,-17675.25 3057.5,-17685.25 3064.5,-17685.25"/>
</g>
<!-- ring_attn_0_2_stage_10 -->
<g id="node210" class="node">
<title>ring_attn_0_2_stage_10</title>
<polygon fill="yellow" stroke="black" points="3648,-17928 3439,-17860 3648,-17792 3857,-17860 3648,-17928"/>
<text text-anchor="middle" x="3648" y="-17878.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-17863.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="3648" y="-17848.8" font-family="Times,serif" font-size="14.00">Q[2]×K[8]×V[8]</text>
<text text-anchor="middle" x="3648" y="-17833.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_1_stage_10&#45;&gt;ring_attn_0_2_stage_10 -->
<g id="edge1687" class="edge">
<title>ring_attn_0_1_stage_10&#45;&gt;ring_attn_0_2_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-17860C3270.02,-17860 3428.86,-17860 3428.86,-17860"/>
<polygon fill="red" stroke="red" points="3428.86,-17863.5 3438.86,-17860 3428.86,-17856.5 3428.86,-17863.5"/>
</g>
<!-- ring_attn_0_1_stage_11&#45;&gt;ring_attn_0_1_stage_12 -->
<g id="edge112" class="edge">
<title>ring_attn_0_1_stage_11&#45;&gt;ring_attn_0_1_stage_12</title>
<path fill="none" stroke="black" d="M3061,-17538.87C3061,-17538.87 3061,-17432.25 3061,-17432.25"/>
<polygon fill="black" stroke="black" points="3064.5,-17432.25 3061,-17422.25 3057.5,-17432.25 3064.5,-17432.25"/>
</g>
<!-- ring_attn_0_2_stage_11 -->
<g id="node211" class="node">
<title>ring_attn_0_2_stage_11</title>
<polygon fill="yellow" stroke="black" points="3648,-17675 3439,-17607 3648,-17539 3857,-17607 3648,-17675"/>
<text text-anchor="middle" x="3648" y="-17625.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-17610.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="3648" y="-17595.8" font-family="Times,serif" font-size="14.00">Q[2]×K[7]×V[7]</text>
<text text-anchor="middle" x="3648" y="-17580.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_1_stage_11&#45;&gt;ring_attn_0_2_stage_11 -->
<g id="edge1688" class="edge">
<title>ring_attn_0_1_stage_11&#45;&gt;ring_attn_0_2_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-17607C3270.02,-17607 3428.86,-17607 3428.86,-17607"/>
<polygon fill="red" stroke="red" points="3428.86,-17610.5 3438.86,-17607 3428.86,-17603.5 3428.86,-17610.5"/>
</g>
<!-- ring_attn_0_1_stage_12&#45;&gt;ring_attn_0_1_stage_13 -->
<g id="edge113" class="edge">
<title>ring_attn_0_1_stage_12&#45;&gt;ring_attn_0_1_stage_13</title>
<path fill="none" stroke="black" d="M3061,-17285.87C3061,-17285.87 3061,-17179.25 3061,-17179.25"/>
<polygon fill="black" stroke="black" points="3064.5,-17179.25 3061,-17169.25 3057.5,-17179.25 3064.5,-17179.25"/>
</g>
<!-- ring_attn_0_2_stage_12 -->
<g id="node212" class="node">
<title>ring_attn_0_2_stage_12</title>
<polygon fill="yellow" stroke="black" points="3648,-17422 3439,-17354 3648,-17286 3857,-17354 3648,-17422"/>
<text text-anchor="middle" x="3648" y="-17372.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-17357.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="3648" y="-17342.8" font-family="Times,serif" font-size="14.00">Q[2]×K[6]×V[6]</text>
<text text-anchor="middle" x="3648" y="-17327.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_1_stage_12&#45;&gt;ring_attn_0_2_stage_12 -->
<g id="edge1689" class="edge">
<title>ring_attn_0_1_stage_12&#45;&gt;ring_attn_0_2_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-17354C3270.02,-17354 3428.86,-17354 3428.86,-17354"/>
<polygon fill="red" stroke="red" points="3428.86,-17357.5 3438.86,-17354 3428.86,-17350.5 3428.86,-17357.5"/>
</g>
<!-- ring_attn_0_1_stage_13&#45;&gt;ring_attn_0_1_stage_14 -->
<g id="edge114" class="edge">
<title>ring_attn_0_1_stage_13&#45;&gt;ring_attn_0_1_stage_14</title>
<path fill="none" stroke="black" d="M3061,-17032.87C3061,-17032.87 3061,-16926.25 3061,-16926.25"/>
<polygon fill="black" stroke="black" points="3064.5,-16926.25 3061,-16916.25 3057.5,-16926.25 3064.5,-16926.25"/>
</g>
<!-- ring_attn_0_2_stage_13 -->
<g id="node213" class="node">
<title>ring_attn_0_2_stage_13</title>
<polygon fill="yellow" stroke="black" points="3648,-17169 3439,-17101 3648,-17033 3857,-17101 3648,-17169"/>
<text text-anchor="middle" x="3648" y="-17119.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-17104.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="3648" y="-17089.8" font-family="Times,serif" font-size="14.00">Q[2]×K[5]×V[5]</text>
<text text-anchor="middle" x="3648" y="-17074.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_1_stage_13&#45;&gt;ring_attn_0_2_stage_13 -->
<g id="edge1690" class="edge">
<title>ring_attn_0_1_stage_13&#45;&gt;ring_attn_0_2_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-17101C3270.02,-17101 3428.86,-17101 3428.86,-17101"/>
<polygon fill="red" stroke="red" points="3428.86,-17104.5 3438.86,-17101 3428.86,-17097.5 3428.86,-17104.5"/>
</g>
<!-- ring_attn_0_1_stage_14&#45;&gt;ring_attn_0_1_stage_15 -->
<g id="edge115" class="edge">
<title>ring_attn_0_1_stage_14&#45;&gt;ring_attn_0_1_stage_15</title>
<path fill="none" stroke="black" d="M3061,-16779.87C3061,-16779.87 3061,-16673.25 3061,-16673.25"/>
<polygon fill="black" stroke="black" points="3064.5,-16673.25 3061,-16663.25 3057.5,-16673.25 3064.5,-16673.25"/>
</g>
<!-- ring_attn_0_2_stage_14 -->
<g id="node214" class="node">
<title>ring_attn_0_2_stage_14</title>
<polygon fill="yellow" stroke="black" points="3648,-16916 3439,-16848 3648,-16780 3857,-16848 3648,-16916"/>
<text text-anchor="middle" x="3648" y="-16866.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-16851.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="3648" y="-16836.8" font-family="Times,serif" font-size="14.00">Q[2]×K[4]×V[4]</text>
<text text-anchor="middle" x="3648" y="-16821.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_1_stage_14&#45;&gt;ring_attn_0_2_stage_14 -->
<g id="edge1691" class="edge">
<title>ring_attn_0_1_stage_14&#45;&gt;ring_attn_0_2_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-16848C3270.02,-16848 3428.86,-16848 3428.86,-16848"/>
<polygon fill="red" stroke="red" points="3428.86,-16851.5 3438.86,-16848 3428.86,-16844.5 3428.86,-16851.5"/>
</g>
<!-- attn_out_0_1 -->
<g id="node118" class="node">
<title>attn_out_0_1</title>
<polygon fill="none" stroke="black" points="3130.5,-16454 2991.5,-16454 2991.5,-16401 3130.5,-16401 3130.5,-16454"/>
<text text-anchor="middle" x="3061" y="-16438.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="3061" y="-16423.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="3061" y="-16408.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_0_1_stage_15&#45;&gt;attn_out_0_1 -->
<g id="edge116" class="edge">
<title>ring_attn_0_1_stage_15&#45;&gt;attn_out_0_1</title>
<path fill="none" stroke="black" d="M3061,-16526.87C3061,-16526.87 3061,-16464.18 3061,-16464.18"/>
<polygon fill="black" stroke="black" points="3064.5,-16464.18 3061,-16454.18 3057.5,-16464.18 3064.5,-16464.18"/>
</g>
<!-- ring_attn_0_2_stage_15 -->
<g id="node215" class="node">
<title>ring_attn_0_2_stage_15</title>
<polygon fill="yellow" stroke="black" points="3648,-16663 3439,-16595 3648,-16527 3857,-16595 3648,-16663"/>
<text text-anchor="middle" x="3648" y="-16613.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-16598.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="3648" y="-16583.8" font-family="Times,serif" font-size="14.00">Q[2]×K[3]×V[3]</text>
<text text-anchor="middle" x="3648" y="-16568.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_1_stage_15&#45;&gt;ring_attn_0_2_stage_15 -->
<g id="edge1692" class="edge">
<title>ring_attn_0_1_stage_15&#45;&gt;ring_attn_0_2_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-16595C3270.02,-16595 3428.86,-16595 3428.86,-16595"/>
<polygon fill="red" stroke="red" points="3428.86,-16598.5 3438.86,-16595 3428.86,-16591.5 3428.86,-16598.5"/>
</g>
<!-- attn_residual_0_1 -->
<g id="node119" class="node">
<title>attn_residual_0_1</title>
<ellipse fill="none" stroke="black" cx="3061" cy="-16301" rx="105.5" ry="27"/>
<text text-anchor="middle" x="3061" y="-16304.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="3061" y="-16289.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_0_1&#45;&gt;attn_residual_0_1 -->
<g id="edge117" class="edge">
<title>attn_out_0_1&#45;&gt;attn_residual_0_1</title>
<path fill="none" stroke="black" d="M3061,-16400.98C3061,-16400.98 3061,-16338.36 3061,-16338.36"/>
<polygon fill="black" stroke="black" points="3064.5,-16338.36 3061,-16328.36 3057.5,-16338.36 3064.5,-16338.36"/>
</g>
<!-- gate_0_1 -->
<g id="node120" class="node">
<title>gate_0_1</title>
<ellipse fill="orange" stroke="black" cx="3061" cy="-16163.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="3061" y="-16174.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="3061" y="-16159.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="3061" y="-16144.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_0_1&#45;&gt;gate_0_1 -->
<g id="edge118" class="edge">
<title>attn_residual_0_1&#45;&gt;gate_0_1</title>
<path fill="none" stroke="black" d="M3025.83,-16275.46C3025.83,-16275.46 3025.83,-16209.01 3025.83,-16209.01"/>
<polygon fill="black" stroke="black" points="3029.33,-16209.01 3025.83,-16199.01 3022.33,-16209.01 3029.33,-16209.01"/>
</g>
<!-- gate_0_1&#45;&gt;expert_0_0_0 -->
<g id="edge1693" class="edge">
<title>gate_0_1&#45;&gt;expert_0_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M2961.27,-16176C2470.82,-16176 338.21,-16176 338.21,-16176 338.21,-16176 338.21,-16004.33 338.21,-16004.33"/>
<polygon fill="blue" stroke="blue" points="341.71,-16004.33 338.21,-15994.33 334.71,-16004.33 341.71,-16004.33"/>
<text text-anchor="middle" x="11606.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="11606.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU1→GPU0</text>
<text text-anchor="middle" x="11606.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="11606.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_1&#45;&gt;expert_0_1_0 -->
<g id="edge119" class="edge">
<title>gate_0_1&#45;&gt;expert_0_1_0</title>
<path fill="none" stroke="black" d="M2965.09,-16147.79C2965.09,-16147.79 2965.09,-16004.33 2965.09,-16004.33"/>
<polygon fill="black" stroke="black" points="2968.59,-16004.33 2965.09,-15994.33 2961.59,-16004.33 2968.59,-16004.33"/>
</g>
<!-- gate_0_1&#45;&gt;expert_0_2_0 -->
<g id="edge1694" class="edge">
<title>gate_0_1&#45;&gt;expert_0_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3160.52,-16151C3299.74,-16151 3535.75,-16151 3535.75,-16151 3535.75,-16151 3535.75,-16004.18 3535.75,-16004.18"/>
<polygon fill="blue" stroke="blue" points="3539.25,-16004.18 3535.75,-15994.18 3532.25,-16004.18 3539.25,-16004.18"/>
<text text-anchor="middle" x="11780.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="11780.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU1→GPU2</text>
<text text-anchor="middle" x="11780.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="11780.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_1&#45;&gt;expert_0_3_0 -->
<g id="edge1695" class="edge">
<title>gate_0_1&#45;&gt;expert_0_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3051.41,-16125.91C3051.41,-16124.09 3051.41,-16123 3051.41,-16123 3051.41,-16123 4120.5,-16123 4120.5,-16123 4120.5,-16123 4120.5,-16004.23 4120.5,-16004.23"/>
<polygon fill="blue" stroke="blue" points="4124,-16004.23 4120.5,-15994.23 4117,-16004.23 4124,-16004.23"/>
<text text-anchor="middle" x="11954.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="11954.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU1→GPU3</text>
<text text-anchor="middle" x="11954.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="11954.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_1&#45;&gt;expert_0_4_0 -->
<g id="edge1696" class="edge">
<title>gate_0_1&#45;&gt;expert_0_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3061,-16125.82C3061,-16114.01 3061,-16104 3061,-16104 3061,-16104 4705.7,-16104 4705.7,-16104 4705.7,-16104 4705.7,-16004.14 4705.7,-16004.14"/>
<polygon fill="blue" stroke="blue" points="4709.2,-16004.14 4705.7,-15994.14 4702.2,-16004.14 4709.2,-16004.14"/>
<text text-anchor="middle" x="12128.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12128.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU1→GPU4</text>
<text text-anchor="middle" x="12128.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12128.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_1&#45;&gt;expert_0_5_0 -->
<g id="edge1697" class="edge">
<title>gate_0_1&#45;&gt;expert_0_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3070.59,-16125.98C3070.59,-16111.79 3070.59,-16099 3070.59,-16099 3070.59,-16099 5343.69,-16099 5343.69,-16099 5343.69,-16099 5343.69,-16004.11 5343.69,-16004.11"/>
<polygon fill="blue" stroke="blue" points="5347.19,-16004.11 5343.69,-15994.11 5340.19,-16004.11 5347.19,-16004.11"/>
<text text-anchor="middle" x="12302.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12302.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU1→GPU5</text>
<text text-anchor="middle" x="12302.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12302.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_1&#45;&gt;expert_0_6_0 -->
<g id="edge1698" class="edge">
<title>gate_0_1&#45;&gt;expert_0_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3080.18,-16126.6C3080.18,-16109.54 3080.18,-16093 3080.18,-16093 3080.18,-16093 5911.6,-16093 5911.6,-16093 5911.6,-16093 5911.6,-16004.12 5911.6,-16004.12"/>
<polygon fill="blue" stroke="blue" points="5915.1,-16004.12 5911.6,-15994.12 5908.1,-16004.12 5915.1,-16004.12"/>
<text text-anchor="middle" x="12476.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12476.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU1→GPU6</text>
<text text-anchor="middle" x="12476.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12476.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_1&#45;&gt;expert_0_7_0 -->
<g id="edge1699" class="edge">
<title>gate_0_1&#45;&gt;expert_0_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3089.77,-16127.34C3089.77,-16095.45 3089.77,-16054 3089.77,-16054 3089.77,-16054 6497.6,-16054 6497.6,-16054 6497.6,-16054 6497.6,-16004.39 6497.6,-16004.39"/>
<polygon fill="blue" stroke="blue" points="6501.1,-16004.39 6497.6,-15994.39 6494.1,-16004.4 6501.1,-16004.39"/>
<text text-anchor="middle" x="12650.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12650.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU1→GPU7</text>
<text text-anchor="middle" x="12650.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12650.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_1&#45;&gt;expert_0_8_0 -->
<g id="edge1700" class="edge">
<title>gate_0_1&#45;&gt;expert_0_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3099.36,-16128.27C3099.36,-16093.34 3099.36,-16045 3099.36,-16045 3099.36,-16045 7082.85,-16045 7082.85,-16045 7082.85,-16045 7082.85,-16004.17 7082.85,-16004.17"/>
<polygon fill="blue" stroke="blue" points="7086.35,-16004.17 7082.85,-15994.17 7079.35,-16004.17 7086.35,-16004.17"/>
<text text-anchor="middle" x="12824.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12824.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU1→GPU8</text>
<text text-anchor="middle" x="12824.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12824.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_1&#45;&gt;expert_0_9_0 -->
<g id="edge1701" class="edge">
<title>gate_0_1&#45;&gt;expert_0_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3108.95,-16129.93C3108.95,-16094.28 3108.95,-16043 3108.95,-16043 3108.95,-16043 7661.09,-16043 7661.09,-16043 7661.09,-16043 7661.09,-16004.33 7661.09,-16004.33"/>
<polygon fill="blue" stroke="blue" points="7664.59,-16004.33 7661.09,-15994.33 7657.59,-16004.33 7664.59,-16004.33"/>
<text text-anchor="middle" x="12998.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12998.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU1→GPU9</text>
<text text-anchor="middle" x="12998.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12998.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_1&#45;&gt;expert_0_10_0 -->
<g id="edge1702" class="edge">
<title>gate_0_1&#45;&gt;expert_0_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3096.17,-16199C3096.17,-16206.4 3096.17,-16212 3096.17,-16212 3096.17,-16212 8235.8,-16212 8235.8,-16212 8235.8,-16212 8235.8,-16004.13 8235.8,-16004.13"/>
<polygon fill="blue" stroke="blue" points="8239.3,-16004.13 8235.8,-15994.13 8232.3,-16004.13 8239.3,-16004.13"/>
<text text-anchor="middle" x="13172.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="13172.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU1→GPU10</text>
<text text-anchor="middle" x="13172.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="13172.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_1&#45;&gt;expert_0_11_0 -->
<g id="edge1703" class="edge">
<title>gate_0_1&#45;&gt;expert_0_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3118.55,-16131.78C3118.55,-16084.49 3118.55,-16001 3118.55,-16001 3118.55,-16001 8688.2,-16001 8688.2,-16001 8688.2,-16001 8688.2,-15976 8688.2,-15976 8688.2,-15976 8801.73,-15976 8801.73,-15976"/>
<polygon fill="blue" stroke="blue" points="8801.73,-15979.5 8811.73,-15976 8801.73,-15972.5 8801.73,-15979.5"/>
<text text-anchor="middle" x="13346.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="13346.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU1→GPU11</text>
<text text-anchor="middle" x="13346.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="13346.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_1&#45;&gt;expert_0_12_0 -->
<g id="edge1704" class="edge">
<title>gate_0_1&#45;&gt;expert_0_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3128.14,-16134.46C3128.14,-16092.53 3128.14,-16020 3128.14,-16020 3128.14,-16020 9430.85,-16020 9430.85,-16020 9430.85,-16020 9430.85,-16004.06 9430.85,-16004.06"/>
<polygon fill="blue" stroke="blue" points="9434.35,-16004.06 9430.85,-15994.06 9427.35,-16004.06 9434.35,-16004.06"/>
<text text-anchor="middle" x="13520.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="13520.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU1→GPU12</text>
<text text-anchor="middle" x="13520.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="13520.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_1&#45;&gt;expert_0_13_0 -->
<g id="edge1705" class="edge">
<title>gate_0_1&#45;&gt;expert_0_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3137.73,-16137.47C3137.73,-16095.13 3137.73,-16016 3137.73,-16016 3137.73,-16016 10033.26,-16016 10033.26,-16016 10033.26,-16016 10033.26,-16004.02 10033.26,-16004.02"/>
<polygon fill="blue" stroke="blue" points="10036.76,-16004.02 10033.26,-15994.02 10029.76,-16004.02 10036.76,-16004.02"/>
<text text-anchor="middle" x="13694.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="13694.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU1→GPU13</text>
<text text-anchor="middle" x="13694.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="13694.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_1&#45;&gt;expert_0_14_0 -->
<g id="edge1706" class="edge">
<title>gate_0_1&#45;&gt;expert_0_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3147.32,-16141.79C3147.32,-16099.9 3147.32,-16012 3147.32,-16012 3147.32,-16012 10626.69,-16012 10626.69,-16012 10626.69,-16012 10626.69,-16004.16 10626.69,-16004.16"/>
<polygon fill="blue" stroke="blue" points="10630.19,-16004.16 10626.69,-15994.16 10623.19,-16004.16 10630.19,-16004.16"/>
<text text-anchor="middle" x="13868.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="13868.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU1→GPU14</text>
<text text-anchor="middle" x="13868.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="13868.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_1&#45;&gt;expert_0_15_0 -->
<g id="edge1707" class="edge">
<title>gate_0_1&#45;&gt;expert_0_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3156.91,-16147.84C3156.91,-16108.56 3156.91,-16009 3156.91,-16009 3156.91,-16009 11217.92,-16009 11217.92,-16009 11217.92,-16009 11217.92,-16004.02 11217.92,-16004.02"/>
<polygon fill="blue" stroke="blue" points="11221.42,-16004.02 11217.92,-15994.02 11214.42,-16004.02 11221.42,-16004.02"/>
<text text-anchor="middle" x="14042.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14042.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU1→GPU15</text>
<text text-anchor="middle" x="14042.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14042.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_1 -->
<g id="node122" class="node">
<title>expert_reduce_0_1</title>
<ellipse fill="none" stroke="black" cx="3061" cy="-15830.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="3061" y="-15841.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="3061" y="-15826.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="3061" y="-15811.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_1_0&#45;&gt;expert_reduce_0_1 -->
<g id="edge120" class="edge">
<title>expert_0_1_0&#45;&gt;expert_reduce_0_1</title>
<path fill="none" stroke="black" d="M3061,-15940.76C3061,-15940.76 3061,-15878.06 3061,-15878.06"/>
<polygon fill="black" stroke="black" points="3064.5,-15878.06 3061,-15868.06 3057.5,-15878.06 3064.5,-15878.06"/>
</g>
<!-- moe_residual_0_1 -->
<g id="node123" class="node">
<title>moe_residual_0_1</title>
<ellipse fill="none" stroke="black" cx="3061" cy="-15693" rx="105.5" ry="27"/>
<text text-anchor="middle" x="3061" y="-15696.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="3061" y="-15681.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_1&#45;&gt;moe_residual_0_1 -->
<g id="edge121" class="edge">
<title>expert_reduce_0_1&#45;&gt;moe_residual_0_1</title>
<path fill="none" stroke="black" d="M3061,-15792.93C3061,-15792.93 3061,-15730.06 3061,-15730.06"/>
<polygon fill="black" stroke="black" points="3064.5,-15730.06 3061,-15720.06 3057.5,-15730.06 3064.5,-15730.06"/>
</g>
<!-- qkv_proj_1_1 -->
<g id="node124" class="node">
<title>qkv_proj_1_1</title>
<polygon fill="none" stroke="black" points="3143.5,-15593 2978.5,-15593 2978.5,-15540 3143.5,-15540 3143.5,-15593"/>
<text text-anchor="middle" x="3061" y="-15577.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="3061" y="-15562.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="3061" y="-15547.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_0_1&#45;&gt;qkv_proj_1_1 -->
<g id="edge122" class="edge">
<title>moe_residual_0_1&#45;&gt;qkv_proj_1_1</title>
<path fill="none" stroke="black" d="M3061,-15665.86C3061,-15665.86 3061,-15603.16 3061,-15603.16"/>
<polygon fill="black" stroke="black" points="3064.5,-15603.16 3061,-15593.16 3057.5,-15603.16 3064.5,-15603.16"/>
</g>
<!-- qkv_reshape_1_1 -->
<g id="node125" class="node">
<title>qkv_reshape_1_1</title>
<ellipse fill="none" stroke="black" cx="3061" cy="-15440" rx="148" ry="27"/>
<text text-anchor="middle" x="3061" y="-15443.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="3061" y="-15428.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_1_1&#45;&gt;qkv_reshape_1_1 -->
<g id="edge123" class="edge">
<title>qkv_proj_1_1&#45;&gt;qkv_reshape_1_1</title>
<path fill="none" stroke="black" d="M3061,-15539.98C3061,-15539.98 3061,-15477.36 3061,-15477.36"/>
<polygon fill="black" stroke="black" points="3064.5,-15477.36 3061,-15467.36 3057.5,-15477.36 3064.5,-15477.36"/>
</g>
<!-- qkv_reshape_1_1&#45;&gt;ring_attn_1_1_stage_0 -->
<g id="edge124" class="edge">
<title>qkv_reshape_1_1&#45;&gt;ring_attn_1_1_stage_0</title>
<path fill="none" stroke="black" d="M3061,-15412.72C3061,-15412.72 3061,-15306.16 3061,-15306.16"/>
<polygon fill="black" stroke="black" points="3064.5,-15306.16 3061,-15296.16 3057.5,-15306.16 3064.5,-15306.16"/>
</g>
<!-- ring_attn_1_1_stage_0&#45;&gt;ring_attn_1_1_stage_1 -->
<g id="edge125" class="edge">
<title>ring_attn_1_1_stage_0&#45;&gt;ring_attn_1_1_stage_1</title>
<path fill="none" stroke="black" d="M3061,-15159.87C3061,-15159.87 3061,-15053.25 3061,-15053.25"/>
<polygon fill="black" stroke="black" points="3064.5,-15053.25 3061,-15043.25 3057.5,-15053.25 3064.5,-15053.25"/>
</g>
<!-- ring_attn_1_2_stage_0 -->
<g id="node224" class="node">
<title>ring_attn_1_2_stage_0</title>
<polygon fill="yellow" stroke="black" points="3648,-15296 3439,-15228 3648,-15160 3857,-15228 3648,-15296"/>
<text text-anchor="middle" x="3648" y="-15246.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-15231.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="3648" y="-15216.8" font-family="Times,serif" font-size="14.00">Q[2]×K[2]×V[2]</text>
<text text-anchor="middle" x="3648" y="-15201.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_1_stage_0&#45;&gt;ring_attn_1_2_stage_0 -->
<g id="edge1708" class="edge">
<title>ring_attn_1_1_stage_0&#45;&gt;ring_attn_1_2_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-15228C3270.02,-15228 3428.86,-15228 3428.86,-15228"/>
<polygon fill="red" stroke="red" points="3428.86,-15231.5 3438.86,-15228 3428.86,-15224.5 3428.86,-15231.5"/>
</g>
<!-- ring_attn_1_1_stage_1&#45;&gt;ring_attn_1_1_stage_2 -->
<g id="edge126" class="edge">
<title>ring_attn_1_1_stage_1&#45;&gt;ring_attn_1_1_stage_2</title>
<path fill="none" stroke="black" d="M3061,-14906.87C3061,-14906.87 3061,-14800.25 3061,-14800.25"/>
<polygon fill="black" stroke="black" points="3064.5,-14800.25 3061,-14790.25 3057.5,-14800.25 3064.5,-14800.25"/>
</g>
<!-- ring_attn_1_2_stage_1 -->
<g id="node225" class="node">
<title>ring_attn_1_2_stage_1</title>
<polygon fill="yellow" stroke="black" points="3648,-15043 3439,-14975 3648,-14907 3857,-14975 3648,-15043"/>
<text text-anchor="middle" x="3648" y="-14993.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-14978.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="3648" y="-14963.8" font-family="Times,serif" font-size="14.00">Q[2]×K[1]×V[1]</text>
<text text-anchor="middle" x="3648" y="-14948.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_1_stage_1&#45;&gt;ring_attn_1_2_stage_1 -->
<g id="edge1709" class="edge">
<title>ring_attn_1_1_stage_1&#45;&gt;ring_attn_1_2_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-14975C3270.02,-14975 3428.86,-14975 3428.86,-14975"/>
<polygon fill="red" stroke="red" points="3428.86,-14978.5 3438.86,-14975 3428.86,-14971.5 3428.86,-14978.5"/>
</g>
<!-- ring_attn_1_1_stage_2&#45;&gt;ring_attn_1_1_stage_3 -->
<g id="edge127" class="edge">
<title>ring_attn_1_1_stage_2&#45;&gt;ring_attn_1_1_stage_3</title>
<path fill="none" stroke="black" d="M3061,-14653.87C3061,-14653.87 3061,-14547.25 3061,-14547.25"/>
<polygon fill="black" stroke="black" points="3064.5,-14547.25 3061,-14537.25 3057.5,-14547.25 3064.5,-14547.25"/>
</g>
<!-- ring_attn_1_2_stage_2 -->
<g id="node226" class="node">
<title>ring_attn_1_2_stage_2</title>
<polygon fill="yellow" stroke="black" points="3648,-14790 3439,-14722 3648,-14654 3857,-14722 3648,-14790"/>
<text text-anchor="middle" x="3648" y="-14740.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-14725.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="3648" y="-14710.8" font-family="Times,serif" font-size="14.00">Q[2]×K[0]×V[0]</text>
<text text-anchor="middle" x="3648" y="-14695.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_1_stage_2&#45;&gt;ring_attn_1_2_stage_2 -->
<g id="edge1710" class="edge">
<title>ring_attn_1_1_stage_2&#45;&gt;ring_attn_1_2_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-14722C3270.02,-14722 3428.86,-14722 3428.86,-14722"/>
<polygon fill="red" stroke="red" points="3428.86,-14725.5 3438.86,-14722 3428.86,-14718.5 3428.86,-14725.5"/>
</g>
<!-- ring_attn_1_1_stage_3&#45;&gt;ring_attn_1_1_stage_4 -->
<g id="edge128" class="edge">
<title>ring_attn_1_1_stage_3&#45;&gt;ring_attn_1_1_stage_4</title>
<path fill="none" stroke="black" d="M3061,-14400.87C3061,-14400.87 3061,-14294.25 3061,-14294.25"/>
<polygon fill="black" stroke="black" points="3064.5,-14294.25 3061,-14284.25 3057.5,-14294.25 3064.5,-14294.25"/>
</g>
<!-- ring_attn_1_2_stage_3 -->
<g id="node227" class="node">
<title>ring_attn_1_2_stage_3</title>
<polygon fill="yellow" stroke="black" points="3648,-14537 3439,-14469 3648,-14401 3857,-14469 3648,-14537"/>
<text text-anchor="middle" x="3648" y="-14487.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-14472.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="3648" y="-14457.8" font-family="Times,serif" font-size="14.00">Q[2]×K[15]×V[15]</text>
<text text-anchor="middle" x="3648" y="-14442.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_1_stage_3&#45;&gt;ring_attn_1_2_stage_3 -->
<g id="edge1711" class="edge">
<title>ring_attn_1_1_stage_3&#45;&gt;ring_attn_1_2_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-14469C3270.02,-14469 3428.86,-14469 3428.86,-14469"/>
<polygon fill="red" stroke="red" points="3428.86,-14472.5 3438.86,-14469 3428.86,-14465.5 3428.86,-14472.5"/>
</g>
<!-- ring_attn_1_1_stage_4&#45;&gt;ring_attn_1_1_stage_5 -->
<g id="edge129" class="edge">
<title>ring_attn_1_1_stage_4&#45;&gt;ring_attn_1_1_stage_5</title>
<path fill="none" stroke="black" d="M3061,-14147.87C3061,-14147.87 3061,-14041.25 3061,-14041.25"/>
<polygon fill="black" stroke="black" points="3064.5,-14041.25 3061,-14031.25 3057.5,-14041.25 3064.5,-14041.25"/>
</g>
<!-- ring_attn_1_2_stage_4 -->
<g id="node228" class="node">
<title>ring_attn_1_2_stage_4</title>
<polygon fill="yellow" stroke="black" points="3648,-14284 3439,-14216 3648,-14148 3857,-14216 3648,-14284"/>
<text text-anchor="middle" x="3648" y="-14234.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-14219.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="3648" y="-14204.8" font-family="Times,serif" font-size="14.00">Q[2]×K[14]×V[14]</text>
<text text-anchor="middle" x="3648" y="-14189.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_1_stage_4&#45;&gt;ring_attn_1_2_stage_4 -->
<g id="edge1712" class="edge">
<title>ring_attn_1_1_stage_4&#45;&gt;ring_attn_1_2_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-14216C3270.02,-14216 3428.86,-14216 3428.86,-14216"/>
<polygon fill="red" stroke="red" points="3428.86,-14219.5 3438.86,-14216 3428.86,-14212.5 3428.86,-14219.5"/>
</g>
<!-- ring_attn_1_1_stage_5&#45;&gt;ring_attn_1_1_stage_6 -->
<g id="edge130" class="edge">
<title>ring_attn_1_1_stage_5&#45;&gt;ring_attn_1_1_stage_6</title>
<path fill="none" stroke="black" d="M3061,-13894.87C3061,-13894.87 3061,-13788.25 3061,-13788.25"/>
<polygon fill="black" stroke="black" points="3064.5,-13788.25 3061,-13778.25 3057.5,-13788.25 3064.5,-13788.25"/>
</g>
<!-- ring_attn_1_2_stage_5 -->
<g id="node229" class="node">
<title>ring_attn_1_2_stage_5</title>
<polygon fill="yellow" stroke="black" points="3648,-14031 3439,-13963 3648,-13895 3857,-13963 3648,-14031"/>
<text text-anchor="middle" x="3648" y="-13981.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-13966.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="3648" y="-13951.8" font-family="Times,serif" font-size="14.00">Q[2]×K[13]×V[13]</text>
<text text-anchor="middle" x="3648" y="-13936.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_1_stage_5&#45;&gt;ring_attn_1_2_stage_5 -->
<g id="edge1713" class="edge">
<title>ring_attn_1_1_stage_5&#45;&gt;ring_attn_1_2_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-13963C3270.02,-13963 3428.86,-13963 3428.86,-13963"/>
<polygon fill="red" stroke="red" points="3428.86,-13966.5 3438.86,-13963 3428.86,-13959.5 3428.86,-13966.5"/>
</g>
<!-- ring_attn_1_1_stage_6&#45;&gt;ring_attn_1_1_stage_7 -->
<g id="edge131" class="edge">
<title>ring_attn_1_1_stage_6&#45;&gt;ring_attn_1_1_stage_7</title>
<path fill="none" stroke="black" d="M3061,-13641.87C3061,-13641.87 3061,-13535.25 3061,-13535.25"/>
<polygon fill="black" stroke="black" points="3064.5,-13535.25 3061,-13525.25 3057.5,-13535.25 3064.5,-13535.25"/>
</g>
<!-- ring_attn_1_2_stage_6 -->
<g id="node230" class="node">
<title>ring_attn_1_2_stage_6</title>
<polygon fill="yellow" stroke="black" points="3648,-13778 3439,-13710 3648,-13642 3857,-13710 3648,-13778"/>
<text text-anchor="middle" x="3648" y="-13728.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-13713.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="3648" y="-13698.8" font-family="Times,serif" font-size="14.00">Q[2]×K[12]×V[12]</text>
<text text-anchor="middle" x="3648" y="-13683.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_1_stage_6&#45;&gt;ring_attn_1_2_stage_6 -->
<g id="edge1714" class="edge">
<title>ring_attn_1_1_stage_6&#45;&gt;ring_attn_1_2_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-13710C3270.02,-13710 3428.86,-13710 3428.86,-13710"/>
<polygon fill="red" stroke="red" points="3428.86,-13713.5 3438.86,-13710 3428.86,-13706.5 3428.86,-13713.5"/>
</g>
<!-- ring_attn_1_1_stage_7&#45;&gt;ring_attn_1_1_stage_8 -->
<g id="edge132" class="edge">
<title>ring_attn_1_1_stage_7&#45;&gt;ring_attn_1_1_stage_8</title>
<path fill="none" stroke="black" d="M3061,-13388.87C3061,-13388.87 3061,-13282.25 3061,-13282.25"/>
<polygon fill="black" stroke="black" points="3064.5,-13282.25 3061,-13272.25 3057.5,-13282.25 3064.5,-13282.25"/>
</g>
<!-- ring_attn_1_2_stage_7 -->
<g id="node231" class="node">
<title>ring_attn_1_2_stage_7</title>
<polygon fill="yellow" stroke="black" points="3648,-13525 3439,-13457 3648,-13389 3857,-13457 3648,-13525"/>
<text text-anchor="middle" x="3648" y="-13475.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-13460.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="3648" y="-13445.8" font-family="Times,serif" font-size="14.00">Q[2]×K[11]×V[11]</text>
<text text-anchor="middle" x="3648" y="-13430.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_1_stage_7&#45;&gt;ring_attn_1_2_stage_7 -->
<g id="edge1715" class="edge">
<title>ring_attn_1_1_stage_7&#45;&gt;ring_attn_1_2_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-13457C3270.02,-13457 3428.86,-13457 3428.86,-13457"/>
<polygon fill="red" stroke="red" points="3428.86,-13460.5 3438.86,-13457 3428.86,-13453.5 3428.86,-13460.5"/>
</g>
<!-- ring_attn_1_1_stage_8&#45;&gt;ring_attn_1_1_stage_9 -->
<g id="edge133" class="edge">
<title>ring_attn_1_1_stage_8&#45;&gt;ring_attn_1_1_stage_9</title>
<path fill="none" stroke="black" d="M3061,-13135.87C3061,-13135.87 3061,-13029.25 3061,-13029.25"/>
<polygon fill="black" stroke="black" points="3064.5,-13029.25 3061,-13019.25 3057.5,-13029.25 3064.5,-13029.25"/>
</g>
<!-- ring_attn_1_2_stage_8 -->
<g id="node232" class="node">
<title>ring_attn_1_2_stage_8</title>
<polygon fill="yellow" stroke="black" points="3648,-13272 3439,-13204 3648,-13136 3857,-13204 3648,-13272"/>
<text text-anchor="middle" x="3648" y="-13222.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-13207.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="3648" y="-13192.8" font-family="Times,serif" font-size="14.00">Q[2]×K[10]×V[10]</text>
<text text-anchor="middle" x="3648" y="-13177.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_1_stage_8&#45;&gt;ring_attn_1_2_stage_8 -->
<g id="edge1716" class="edge">
<title>ring_attn_1_1_stage_8&#45;&gt;ring_attn_1_2_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-13204C3270.02,-13204 3428.86,-13204 3428.86,-13204"/>
<polygon fill="red" stroke="red" points="3428.86,-13207.5 3438.86,-13204 3428.86,-13200.5 3428.86,-13207.5"/>
</g>
<!-- ring_attn_1_1_stage_9&#45;&gt;ring_attn_1_1_stage_10 -->
<g id="edge134" class="edge">
<title>ring_attn_1_1_stage_9&#45;&gt;ring_attn_1_1_stage_10</title>
<path fill="none" stroke="black" d="M3061,-12882.87C3061,-12882.87 3061,-12776.25 3061,-12776.25"/>
<polygon fill="black" stroke="black" points="3064.5,-12776.25 3061,-12766.25 3057.5,-12776.25 3064.5,-12776.25"/>
</g>
<!-- ring_attn_1_2_stage_9 -->
<g id="node233" class="node">
<title>ring_attn_1_2_stage_9</title>
<polygon fill="yellow" stroke="black" points="3648,-13019 3439,-12951 3648,-12883 3857,-12951 3648,-13019"/>
<text text-anchor="middle" x="3648" y="-12969.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-12954.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="3648" y="-12939.8" font-family="Times,serif" font-size="14.00">Q[2]×K[9]×V[9]</text>
<text text-anchor="middle" x="3648" y="-12924.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_1_stage_9&#45;&gt;ring_attn_1_2_stage_9 -->
<g id="edge1717" class="edge">
<title>ring_attn_1_1_stage_9&#45;&gt;ring_attn_1_2_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-12951C3270.02,-12951 3428.86,-12951 3428.86,-12951"/>
<polygon fill="red" stroke="red" points="3428.86,-12954.5 3438.86,-12951 3428.86,-12947.5 3428.86,-12954.5"/>
</g>
<!-- ring_attn_1_1_stage_10&#45;&gt;ring_attn_1_1_stage_11 -->
<g id="edge135" class="edge">
<title>ring_attn_1_1_stage_10&#45;&gt;ring_attn_1_1_stage_11</title>
<path fill="none" stroke="black" d="M3061,-12629.87C3061,-12629.87 3061,-12523.25 3061,-12523.25"/>
<polygon fill="black" stroke="black" points="3064.5,-12523.25 3061,-12513.25 3057.5,-12523.25 3064.5,-12523.25"/>
</g>
<!-- ring_attn_1_2_stage_10 -->
<g id="node234" class="node">
<title>ring_attn_1_2_stage_10</title>
<polygon fill="yellow" stroke="black" points="3648,-12766 3439,-12698 3648,-12630 3857,-12698 3648,-12766"/>
<text text-anchor="middle" x="3648" y="-12716.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-12701.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="3648" y="-12686.8" font-family="Times,serif" font-size="14.00">Q[2]×K[8]×V[8]</text>
<text text-anchor="middle" x="3648" y="-12671.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_1_stage_10&#45;&gt;ring_attn_1_2_stage_10 -->
<g id="edge1718" class="edge">
<title>ring_attn_1_1_stage_10&#45;&gt;ring_attn_1_2_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-12698C3270.02,-12698 3428.86,-12698 3428.86,-12698"/>
<polygon fill="red" stroke="red" points="3428.86,-12701.5 3438.86,-12698 3428.86,-12694.5 3428.86,-12701.5"/>
</g>
<!-- ring_attn_1_1_stage_11&#45;&gt;ring_attn_1_1_stage_12 -->
<g id="edge136" class="edge">
<title>ring_attn_1_1_stage_11&#45;&gt;ring_attn_1_1_stage_12</title>
<path fill="none" stroke="black" d="M3061,-12376.87C3061,-12376.87 3061,-12270.25 3061,-12270.25"/>
<polygon fill="black" stroke="black" points="3064.5,-12270.25 3061,-12260.25 3057.5,-12270.25 3064.5,-12270.25"/>
</g>
<!-- ring_attn_1_2_stage_11 -->
<g id="node235" class="node">
<title>ring_attn_1_2_stage_11</title>
<polygon fill="yellow" stroke="black" points="3648,-12513 3439,-12445 3648,-12377 3857,-12445 3648,-12513"/>
<text text-anchor="middle" x="3648" y="-12463.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-12448.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="3648" y="-12433.8" font-family="Times,serif" font-size="14.00">Q[2]×K[7]×V[7]</text>
<text text-anchor="middle" x="3648" y="-12418.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_1_stage_11&#45;&gt;ring_attn_1_2_stage_11 -->
<g id="edge1719" class="edge">
<title>ring_attn_1_1_stage_11&#45;&gt;ring_attn_1_2_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-12445C3270.02,-12445 3428.86,-12445 3428.86,-12445"/>
<polygon fill="red" stroke="red" points="3428.86,-12448.5 3438.86,-12445 3428.86,-12441.5 3428.86,-12448.5"/>
</g>
<!-- ring_attn_1_1_stage_12&#45;&gt;ring_attn_1_1_stage_13 -->
<g id="edge137" class="edge">
<title>ring_attn_1_1_stage_12&#45;&gt;ring_attn_1_1_stage_13</title>
<path fill="none" stroke="black" d="M3061,-12123.87C3061,-12123.87 3061,-12017.25 3061,-12017.25"/>
<polygon fill="black" stroke="black" points="3064.5,-12017.25 3061,-12007.25 3057.5,-12017.25 3064.5,-12017.25"/>
</g>
<!-- ring_attn_1_2_stage_12 -->
<g id="node236" class="node">
<title>ring_attn_1_2_stage_12</title>
<polygon fill="yellow" stroke="black" points="3648,-12260 3439,-12192 3648,-12124 3857,-12192 3648,-12260"/>
<text text-anchor="middle" x="3648" y="-12210.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-12195.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="3648" y="-12180.8" font-family="Times,serif" font-size="14.00">Q[2]×K[6]×V[6]</text>
<text text-anchor="middle" x="3648" y="-12165.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_1_stage_12&#45;&gt;ring_attn_1_2_stage_12 -->
<g id="edge1720" class="edge">
<title>ring_attn_1_1_stage_12&#45;&gt;ring_attn_1_2_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-12192C3270.02,-12192 3428.86,-12192 3428.86,-12192"/>
<polygon fill="red" stroke="red" points="3428.86,-12195.5 3438.86,-12192 3428.86,-12188.5 3428.86,-12195.5"/>
</g>
<!-- ring_attn_1_1_stage_13&#45;&gt;ring_attn_1_1_stage_14 -->
<g id="edge138" class="edge">
<title>ring_attn_1_1_stage_13&#45;&gt;ring_attn_1_1_stage_14</title>
<path fill="none" stroke="black" d="M3061,-11870.87C3061,-11870.87 3061,-11764.25 3061,-11764.25"/>
<polygon fill="black" stroke="black" points="3064.5,-11764.25 3061,-11754.25 3057.5,-11764.25 3064.5,-11764.25"/>
</g>
<!-- ring_attn_1_2_stage_13 -->
<g id="node237" class="node">
<title>ring_attn_1_2_stage_13</title>
<polygon fill="yellow" stroke="black" points="3648,-12007 3439,-11939 3648,-11871 3857,-11939 3648,-12007"/>
<text text-anchor="middle" x="3648" y="-11957.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-11942.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="3648" y="-11927.8" font-family="Times,serif" font-size="14.00">Q[2]×K[5]×V[5]</text>
<text text-anchor="middle" x="3648" y="-11912.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_1_stage_13&#45;&gt;ring_attn_1_2_stage_13 -->
<g id="edge1721" class="edge">
<title>ring_attn_1_1_stage_13&#45;&gt;ring_attn_1_2_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-11939C3270.02,-11939 3428.86,-11939 3428.86,-11939"/>
<polygon fill="red" stroke="red" points="3428.86,-11942.5 3438.86,-11939 3428.86,-11935.5 3428.86,-11942.5"/>
</g>
<!-- ring_attn_1_1_stage_14&#45;&gt;ring_attn_1_1_stage_15 -->
<g id="edge139" class="edge">
<title>ring_attn_1_1_stage_14&#45;&gt;ring_attn_1_1_stage_15</title>
<path fill="none" stroke="black" d="M3061,-11617.87C3061,-11617.87 3061,-11511.25 3061,-11511.25"/>
<polygon fill="black" stroke="black" points="3064.5,-11511.25 3061,-11501.25 3057.5,-11511.25 3064.5,-11511.25"/>
</g>
<!-- ring_attn_1_2_stage_14 -->
<g id="node238" class="node">
<title>ring_attn_1_2_stage_14</title>
<polygon fill="yellow" stroke="black" points="3648,-11754 3439,-11686 3648,-11618 3857,-11686 3648,-11754"/>
<text text-anchor="middle" x="3648" y="-11704.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-11689.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="3648" y="-11674.8" font-family="Times,serif" font-size="14.00">Q[2]×K[4]×V[4]</text>
<text text-anchor="middle" x="3648" y="-11659.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_1_stage_14&#45;&gt;ring_attn_1_2_stage_14 -->
<g id="edge1722" class="edge">
<title>ring_attn_1_1_stage_14&#45;&gt;ring_attn_1_2_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-11686C3270.02,-11686 3428.86,-11686 3428.86,-11686"/>
<polygon fill="red" stroke="red" points="3428.86,-11689.5 3438.86,-11686 3428.86,-11682.5 3428.86,-11689.5"/>
</g>
<!-- attn_out_1_1 -->
<g id="node142" class="node">
<title>attn_out_1_1</title>
<polygon fill="none" stroke="black" points="3130.5,-11292 2991.5,-11292 2991.5,-11239 3130.5,-11239 3130.5,-11292"/>
<text text-anchor="middle" x="3061" y="-11276.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="3061" y="-11261.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="3061" y="-11246.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_1_1_stage_15&#45;&gt;attn_out_1_1 -->
<g id="edge140" class="edge">
<title>ring_attn_1_1_stage_15&#45;&gt;attn_out_1_1</title>
<path fill="none" stroke="black" d="M3061,-11364.87C3061,-11364.87 3061,-11302.18 3061,-11302.18"/>
<polygon fill="black" stroke="black" points="3064.5,-11302.18 3061,-11292.18 3057.5,-11302.18 3064.5,-11302.18"/>
</g>
<!-- ring_attn_1_2_stage_15 -->
<g id="node239" class="node">
<title>ring_attn_1_2_stage_15</title>
<polygon fill="yellow" stroke="black" points="3648,-11501 3439,-11433 3648,-11365 3857,-11433 3648,-11501"/>
<text text-anchor="middle" x="3648" y="-11451.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-11436.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="3648" y="-11421.8" font-family="Times,serif" font-size="14.00">Q[2]×K[3]×V[3]</text>
<text text-anchor="middle" x="3648" y="-11406.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_1_stage_15&#45;&gt;ring_attn_1_2_stage_15 -->
<g id="edge1723" class="edge">
<title>ring_attn_1_1_stage_15&#45;&gt;ring_attn_1_2_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-11433C3270.02,-11433 3428.86,-11433 3428.86,-11433"/>
<polygon fill="red" stroke="red" points="3428.86,-11436.5 3438.86,-11433 3428.86,-11429.5 3428.86,-11436.5"/>
</g>
<!-- attn_residual_1_1 -->
<g id="node143" class="node">
<title>attn_residual_1_1</title>
<ellipse fill="none" stroke="black" cx="3061" cy="-11139" rx="105.5" ry="27"/>
<text text-anchor="middle" x="3061" y="-11142.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="3061" y="-11127.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_1_1&#45;&gt;attn_residual_1_1 -->
<g id="edge141" class="edge">
<title>attn_out_1_1&#45;&gt;attn_residual_1_1</title>
<path fill="none" stroke="black" d="M3061,-11238.98C3061,-11238.98 3061,-11176.36 3061,-11176.36"/>
<polygon fill="black" stroke="black" points="3064.5,-11176.36 3061,-11166.36 3057.5,-11176.36 3064.5,-11176.36"/>
</g>
<!-- gate_1_1 -->
<g id="node144" class="node">
<title>gate_1_1</title>
<ellipse fill="orange" stroke="black" cx="3061" cy="-11001.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="3061" y="-11012.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="3061" y="-10997.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="3061" y="-10982.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_1_1&#45;&gt;gate_1_1 -->
<g id="edge142" class="edge">
<title>attn_residual_1_1&#45;&gt;gate_1_1</title>
<path fill="none" stroke="black" d="M3025.83,-11113.46C3025.83,-11113.46 3025.83,-11047.01 3025.83,-11047.01"/>
<polygon fill="black" stroke="black" points="3029.33,-11047.01 3025.83,-11037.01 3022.33,-11047.01 3029.33,-11047.01"/>
</g>
<!-- gate_1_1&#45;&gt;expert_1_0_0 -->
<g id="edge1724" class="edge">
<title>gate_1_1&#45;&gt;expert_1_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M2961.27,-11014C2470.82,-11014 338.21,-11014 338.21,-11014 338.21,-11014 338.21,-10842.33 338.21,-10842.33"/>
<polygon fill="blue" stroke="blue" points="341.71,-10842.33 338.21,-10832.33 334.71,-10842.33 341.71,-10842.33"/>
<text text-anchor="middle" x="11606.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="11606.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU1→GPU0</text>
<text text-anchor="middle" x="11606.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="11606.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_1&#45;&gt;expert_1_1_0 -->
<g id="edge143" class="edge">
<title>gate_1_1&#45;&gt;expert_1_1_0</title>
<path fill="none" stroke="black" d="M2965.09,-10985.79C2965.09,-10985.79 2965.09,-10842.33 2965.09,-10842.33"/>
<polygon fill="black" stroke="black" points="2968.59,-10842.33 2965.09,-10832.33 2961.59,-10842.33 2968.59,-10842.33"/>
</g>
<!-- gate_1_1&#45;&gt;expert_1_2_0 -->
<g id="edge1725" class="edge">
<title>gate_1_1&#45;&gt;expert_1_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3160.52,-10989C3299.74,-10989 3535.75,-10989 3535.75,-10989 3535.75,-10989 3535.75,-10842.18 3535.75,-10842.18"/>
<polygon fill="blue" stroke="blue" points="3539.25,-10842.18 3535.75,-10832.18 3532.25,-10842.18 3539.25,-10842.18"/>
<text text-anchor="middle" x="11780.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="11780.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU1→GPU2</text>
<text text-anchor="middle" x="11780.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="11780.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_1&#45;&gt;expert_1_3_0 -->
<g id="edge1726" class="edge">
<title>gate_1_1&#45;&gt;expert_1_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3051.41,-10963.91C3051.41,-10962.09 3051.41,-10961 3051.41,-10961 3051.41,-10961 4120.5,-10961 4120.5,-10961 4120.5,-10961 4120.5,-10842.23 4120.5,-10842.23"/>
<polygon fill="blue" stroke="blue" points="4124,-10842.23 4120.5,-10832.23 4117,-10842.23 4124,-10842.23"/>
<text text-anchor="middle" x="11954.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="11954.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU1→GPU3</text>
<text text-anchor="middle" x="11954.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="11954.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_1&#45;&gt;expert_1_4_0 -->
<g id="edge1727" class="edge">
<title>gate_1_1&#45;&gt;expert_1_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3061,-10963.82C3061,-10952.01 3061,-10942 3061,-10942 3061,-10942 4705.7,-10942 4705.7,-10942 4705.7,-10942 4705.7,-10842.14 4705.7,-10842.14"/>
<polygon fill="blue" stroke="blue" points="4709.2,-10842.14 4705.7,-10832.14 4702.2,-10842.14 4709.2,-10842.14"/>
<text text-anchor="middle" x="12128.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12128.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU1→GPU4</text>
<text text-anchor="middle" x="12128.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12128.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_1&#45;&gt;expert_1_5_0 -->
<g id="edge1728" class="edge">
<title>gate_1_1&#45;&gt;expert_1_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3070.59,-10963.98C3070.59,-10949.79 3070.59,-10937 3070.59,-10937 3070.59,-10937 5343.69,-10937 5343.69,-10937 5343.69,-10937 5343.69,-10842.11 5343.69,-10842.11"/>
<polygon fill="blue" stroke="blue" points="5347.19,-10842.11 5343.69,-10832.11 5340.19,-10842.11 5347.19,-10842.11"/>
<text text-anchor="middle" x="12302.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12302.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU1→GPU5</text>
<text text-anchor="middle" x="12302.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12302.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_1&#45;&gt;expert_1_6_0 -->
<g id="edge1729" class="edge">
<title>gate_1_1&#45;&gt;expert_1_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3080.18,-10964.6C3080.18,-10947.54 3080.18,-10931 3080.18,-10931 3080.18,-10931 5911.6,-10931 5911.6,-10931 5911.6,-10931 5911.6,-10842.12 5911.6,-10842.12"/>
<polygon fill="blue" stroke="blue" points="5915.1,-10842.12 5911.6,-10832.12 5908.1,-10842.12 5915.1,-10842.12"/>
<text text-anchor="middle" x="12476.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12476.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU1→GPU6</text>
<text text-anchor="middle" x="12476.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12476.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_1&#45;&gt;expert_1_7_0 -->
<g id="edge1730" class="edge">
<title>gate_1_1&#45;&gt;expert_1_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3089.77,-10965.34C3089.77,-10933.45 3089.77,-10892 3089.77,-10892 3089.77,-10892 6497.6,-10892 6497.6,-10892 6497.6,-10892 6497.6,-10842.39 6497.6,-10842.39"/>
<polygon fill="blue" stroke="blue" points="6501.1,-10842.39 6497.6,-10832.39 6494.1,-10842.4 6501.1,-10842.39"/>
<text text-anchor="middle" x="12650.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12650.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU1→GPU7</text>
<text text-anchor="middle" x="12650.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12650.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_1&#45;&gt;expert_1_8_0 -->
<g id="edge1731" class="edge">
<title>gate_1_1&#45;&gt;expert_1_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3099.36,-10966.27C3099.36,-10931.34 3099.36,-10883 3099.36,-10883 3099.36,-10883 7082.85,-10883 7082.85,-10883 7082.85,-10883 7082.85,-10842.17 7082.85,-10842.17"/>
<polygon fill="blue" stroke="blue" points="7086.35,-10842.17 7082.85,-10832.17 7079.35,-10842.17 7086.35,-10842.17"/>
<text text-anchor="middle" x="12824.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12824.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU1→GPU8</text>
<text text-anchor="middle" x="12824.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12824.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_1&#45;&gt;expert_1_9_0 -->
<g id="edge1732" class="edge">
<title>gate_1_1&#45;&gt;expert_1_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3108.95,-10967.93C3108.95,-10932.28 3108.95,-10881 3108.95,-10881 3108.95,-10881 7661.09,-10881 7661.09,-10881 7661.09,-10881 7661.09,-10842.33 7661.09,-10842.33"/>
<polygon fill="blue" stroke="blue" points="7664.59,-10842.33 7661.09,-10832.33 7657.59,-10842.33 7664.59,-10842.33"/>
<text text-anchor="middle" x="12998.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12998.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU1→GPU9</text>
<text text-anchor="middle" x="12998.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12998.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_1&#45;&gt;expert_1_10_0 -->
<g id="edge1733" class="edge">
<title>gate_1_1&#45;&gt;expert_1_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3096.17,-11037C3096.17,-11044.4 3096.17,-11050 3096.17,-11050 3096.17,-11050 8235.8,-11050 8235.8,-11050 8235.8,-11050 8235.8,-10842.13 8235.8,-10842.13"/>
<polygon fill="blue" stroke="blue" points="8239.3,-10842.13 8235.8,-10832.13 8232.3,-10842.13 8239.3,-10842.13"/>
<text text-anchor="middle" x="13172.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="13172.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU1→GPU10</text>
<text text-anchor="middle" x="13172.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="13172.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_1&#45;&gt;expert_1_11_0 -->
<g id="edge1734" class="edge">
<title>gate_1_1&#45;&gt;expert_1_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3118.55,-10969.78C3118.55,-10922.49 3118.55,-10839 3118.55,-10839 3118.55,-10839 8654.4,-10839 8654.4,-10839 8654.4,-10839 8654.4,-10814 8654.4,-10814 8654.4,-10814 8801.69,-10814 8801.69,-10814"/>
<polygon fill="blue" stroke="blue" points="8801.69,-10817.5 8811.69,-10814 8801.69,-10810.5 8801.69,-10817.5"/>
<text text-anchor="middle" x="13346.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="13346.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU1→GPU11</text>
<text text-anchor="middle" x="13346.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="13346.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_1&#45;&gt;expert_1_12_0 -->
<g id="edge1735" class="edge">
<title>gate_1_1&#45;&gt;expert_1_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3128.14,-10972.46C3128.14,-10930.53 3128.14,-10858 3128.14,-10858 3128.14,-10858 9430.85,-10858 9430.85,-10858 9430.85,-10858 9430.85,-10842.06 9430.85,-10842.06"/>
<polygon fill="blue" stroke="blue" points="9434.35,-10842.06 9430.85,-10832.06 9427.35,-10842.06 9434.35,-10842.06"/>
<text text-anchor="middle" x="13520.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="13520.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU1→GPU12</text>
<text text-anchor="middle" x="13520.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="13520.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_1&#45;&gt;expert_1_13_0 -->
<g id="edge1736" class="edge">
<title>gate_1_1&#45;&gt;expert_1_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3137.73,-10975.47C3137.73,-10933.13 3137.73,-10854 3137.73,-10854 3137.73,-10854 10033.26,-10854 10033.26,-10854 10033.26,-10854 10033.26,-10842.02 10033.26,-10842.02"/>
<polygon fill="blue" stroke="blue" points="10036.76,-10842.02 10033.26,-10832.02 10029.76,-10842.02 10036.76,-10842.02"/>
<text text-anchor="middle" x="13694.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="13694.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU1→GPU13</text>
<text text-anchor="middle" x="13694.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="13694.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_1&#45;&gt;expert_1_14_0 -->
<g id="edge1737" class="edge">
<title>gate_1_1&#45;&gt;expert_1_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3147.32,-10979.79C3147.32,-10937.9 3147.32,-10850 3147.32,-10850 3147.32,-10850 10626.69,-10850 10626.69,-10850 10626.69,-10850 10626.69,-10842.16 10626.69,-10842.16"/>
<polygon fill="blue" stroke="blue" points="10630.19,-10842.16 10626.69,-10832.16 10623.19,-10842.16 10630.19,-10842.16"/>
<text text-anchor="middle" x="13868.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="13868.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU1→GPU14</text>
<text text-anchor="middle" x="13868.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="13868.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_1&#45;&gt;expert_1_15_0 -->
<g id="edge1738" class="edge">
<title>gate_1_1&#45;&gt;expert_1_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3156.91,-10985.84C3156.91,-10946.56 3156.91,-10847 3156.91,-10847 3156.91,-10847 11217.92,-10847 11217.92,-10847 11217.92,-10847 11217.92,-10842.02 11217.92,-10842.02"/>
<polygon fill="blue" stroke="blue" points="11221.42,-10842.02 11217.92,-10832.02 11214.42,-10842.02 11221.42,-10842.02"/>
<text text-anchor="middle" x="14042.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14042.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU1→GPU15</text>
<text text-anchor="middle" x="14042.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14042.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_1 -->
<g id="node146" class="node">
<title>expert_reduce_1_1</title>
<ellipse fill="none" stroke="black" cx="3061" cy="-10668.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="3061" y="-10679.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="3061" y="-10664.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="3061" y="-10649.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_1_0&#45;&gt;expert_reduce_1_1 -->
<g id="edge144" class="edge">
<title>expert_1_1_0&#45;&gt;expert_reduce_1_1</title>
<path fill="none" stroke="black" d="M3061,-10778.76C3061,-10778.76 3061,-10716.06 3061,-10716.06"/>
<polygon fill="black" stroke="black" points="3064.5,-10716.06 3061,-10706.06 3057.5,-10716.06 3064.5,-10716.06"/>
</g>
<!-- moe_residual_1_1 -->
<g id="node147" class="node">
<title>moe_residual_1_1</title>
<ellipse fill="none" stroke="black" cx="3061" cy="-10531" rx="105.5" ry="27"/>
<text text-anchor="middle" x="3061" y="-10534.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="3061" y="-10519.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_1&#45;&gt;moe_residual_1_1 -->
<g id="edge145" class="edge">
<title>expert_reduce_1_1&#45;&gt;moe_residual_1_1</title>
<path fill="none" stroke="black" d="M3061,-10630.93C3061,-10630.93 3061,-10568.06 3061,-10568.06"/>
<polygon fill="black" stroke="black" points="3064.5,-10568.06 3061,-10558.06 3057.5,-10568.06 3064.5,-10568.06"/>
</g>
<!-- qkv_proj_2_1 -->
<g id="node148" class="node">
<title>qkv_proj_2_1</title>
<polygon fill="none" stroke="black" points="3143.5,-10431 2978.5,-10431 2978.5,-10378 3143.5,-10378 3143.5,-10431"/>
<text text-anchor="middle" x="3061" y="-10415.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="3061" y="-10400.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="3061" y="-10385.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_1_1&#45;&gt;qkv_proj_2_1 -->
<g id="edge146" class="edge">
<title>moe_residual_1_1&#45;&gt;qkv_proj_2_1</title>
<path fill="none" stroke="black" d="M3061,-10503.86C3061,-10503.86 3061,-10441.16 3061,-10441.16"/>
<polygon fill="black" stroke="black" points="3064.5,-10441.16 3061,-10431.16 3057.5,-10441.16 3064.5,-10441.16"/>
</g>
<!-- qkv_reshape_2_1 -->
<g id="node149" class="node">
<title>qkv_reshape_2_1</title>
<ellipse fill="none" stroke="black" cx="3061" cy="-10278" rx="148" ry="27"/>
<text text-anchor="middle" x="3061" y="-10281.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="3061" y="-10266.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_2_1&#45;&gt;qkv_reshape_2_1 -->
<g id="edge147" class="edge">
<title>qkv_proj_2_1&#45;&gt;qkv_reshape_2_1</title>
<path fill="none" stroke="black" d="M3061,-10377.98C3061,-10377.98 3061,-10315.36 3061,-10315.36"/>
<polygon fill="black" stroke="black" points="3064.5,-10315.36 3061,-10305.36 3057.5,-10315.36 3064.5,-10315.36"/>
</g>
<!-- qkv_reshape_2_1&#45;&gt;ring_attn_2_1_stage_0 -->
<g id="edge148" class="edge">
<title>qkv_reshape_2_1&#45;&gt;ring_attn_2_1_stage_0</title>
<path fill="none" stroke="black" d="M3061,-10250.72C3061,-10250.72 3061,-10144.16 3061,-10144.16"/>
<polygon fill="black" stroke="black" points="3064.5,-10144.16 3061,-10134.16 3057.5,-10144.16 3064.5,-10144.16"/>
</g>
<!-- ring_attn_2_1_stage_0&#45;&gt;ring_attn_2_1_stage_1 -->
<g id="edge149" class="edge">
<title>ring_attn_2_1_stage_0&#45;&gt;ring_attn_2_1_stage_1</title>
<path fill="none" stroke="black" d="M3061,-9997.87C3061,-9997.87 3061,-9891.25 3061,-9891.25"/>
<polygon fill="black" stroke="black" points="3064.5,-9891.25 3061,-9881.25 3057.5,-9891.25 3064.5,-9891.25"/>
</g>
<!-- ring_attn_2_2_stage_0 -->
<g id="node248" class="node">
<title>ring_attn_2_2_stage_0</title>
<polygon fill="yellow" stroke="black" points="3648,-10134 3439,-10066 3648,-9998 3857,-10066 3648,-10134"/>
<text text-anchor="middle" x="3648" y="-10084.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-10069.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="3648" y="-10054.8" font-family="Times,serif" font-size="14.00">Q[2]×K[2]×V[2]</text>
<text text-anchor="middle" x="3648" y="-10039.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_1_stage_0&#45;&gt;ring_attn_2_2_stage_0 -->
<g id="edge1739" class="edge">
<title>ring_attn_2_1_stage_0&#45;&gt;ring_attn_2_2_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-10066C3270.02,-10066 3428.86,-10066 3428.86,-10066"/>
<polygon fill="red" stroke="red" points="3428.86,-10069.5 3438.86,-10066 3428.86,-10062.5 3428.86,-10069.5"/>
</g>
<!-- ring_attn_2_1_stage_1&#45;&gt;ring_attn_2_1_stage_2 -->
<g id="edge150" class="edge">
<title>ring_attn_2_1_stage_1&#45;&gt;ring_attn_2_1_stage_2</title>
<path fill="none" stroke="black" d="M3061,-9744.87C3061,-9744.87 3061,-9638.25 3061,-9638.25"/>
<polygon fill="black" stroke="black" points="3064.5,-9638.25 3061,-9628.25 3057.5,-9638.25 3064.5,-9638.25"/>
</g>
<!-- ring_attn_2_2_stage_1 -->
<g id="node249" class="node">
<title>ring_attn_2_2_stage_1</title>
<polygon fill="yellow" stroke="black" points="3648,-9881 3439,-9813 3648,-9745 3857,-9813 3648,-9881"/>
<text text-anchor="middle" x="3648" y="-9831.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-9816.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="3648" y="-9801.8" font-family="Times,serif" font-size="14.00">Q[2]×K[1]×V[1]</text>
<text text-anchor="middle" x="3648" y="-9786.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_1_stage_1&#45;&gt;ring_attn_2_2_stage_1 -->
<g id="edge1740" class="edge">
<title>ring_attn_2_1_stage_1&#45;&gt;ring_attn_2_2_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-9813C3270.02,-9813 3428.86,-9813 3428.86,-9813"/>
<polygon fill="red" stroke="red" points="3428.86,-9816.5 3438.86,-9813 3428.86,-9809.5 3428.86,-9816.5"/>
</g>
<!-- ring_attn_2_1_stage_2&#45;&gt;ring_attn_2_1_stage_3 -->
<g id="edge151" class="edge">
<title>ring_attn_2_1_stage_2&#45;&gt;ring_attn_2_1_stage_3</title>
<path fill="none" stroke="black" d="M3061,-9491.87C3061,-9491.87 3061,-9385.25 3061,-9385.25"/>
<polygon fill="black" stroke="black" points="3064.5,-9385.25 3061,-9375.25 3057.5,-9385.25 3064.5,-9385.25"/>
</g>
<!-- ring_attn_2_2_stage_2 -->
<g id="node250" class="node">
<title>ring_attn_2_2_stage_2</title>
<polygon fill="yellow" stroke="black" points="3648,-9628 3439,-9560 3648,-9492 3857,-9560 3648,-9628"/>
<text text-anchor="middle" x="3648" y="-9578.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-9563.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="3648" y="-9548.8" font-family="Times,serif" font-size="14.00">Q[2]×K[0]×V[0]</text>
<text text-anchor="middle" x="3648" y="-9533.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_1_stage_2&#45;&gt;ring_attn_2_2_stage_2 -->
<g id="edge1741" class="edge">
<title>ring_attn_2_1_stage_2&#45;&gt;ring_attn_2_2_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-9560C3270.02,-9560 3428.86,-9560 3428.86,-9560"/>
<polygon fill="red" stroke="red" points="3428.86,-9563.5 3438.86,-9560 3428.86,-9556.5 3428.86,-9563.5"/>
</g>
<!-- ring_attn_2_1_stage_3&#45;&gt;ring_attn_2_1_stage_4 -->
<g id="edge152" class="edge">
<title>ring_attn_2_1_stage_3&#45;&gt;ring_attn_2_1_stage_4</title>
<path fill="none" stroke="black" d="M3061,-9238.87C3061,-9238.87 3061,-9132.25 3061,-9132.25"/>
<polygon fill="black" stroke="black" points="3064.5,-9132.25 3061,-9122.25 3057.5,-9132.25 3064.5,-9132.25"/>
</g>
<!-- ring_attn_2_2_stage_3 -->
<g id="node251" class="node">
<title>ring_attn_2_2_stage_3</title>
<polygon fill="yellow" stroke="black" points="3648,-9375 3439,-9307 3648,-9239 3857,-9307 3648,-9375"/>
<text text-anchor="middle" x="3648" y="-9325.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-9310.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="3648" y="-9295.8" font-family="Times,serif" font-size="14.00">Q[2]×K[15]×V[15]</text>
<text text-anchor="middle" x="3648" y="-9280.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_1_stage_3&#45;&gt;ring_attn_2_2_stage_3 -->
<g id="edge1742" class="edge">
<title>ring_attn_2_1_stage_3&#45;&gt;ring_attn_2_2_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-9307C3270.02,-9307 3428.86,-9307 3428.86,-9307"/>
<polygon fill="red" stroke="red" points="3428.86,-9310.5 3438.86,-9307 3428.86,-9303.5 3428.86,-9310.5"/>
</g>
<!-- ring_attn_2_1_stage_4&#45;&gt;ring_attn_2_1_stage_5 -->
<g id="edge153" class="edge">
<title>ring_attn_2_1_stage_4&#45;&gt;ring_attn_2_1_stage_5</title>
<path fill="none" stroke="black" d="M3061,-8985.87C3061,-8985.87 3061,-8879.25 3061,-8879.25"/>
<polygon fill="black" stroke="black" points="3064.5,-8879.25 3061,-8869.25 3057.5,-8879.25 3064.5,-8879.25"/>
</g>
<!-- ring_attn_2_2_stage_4 -->
<g id="node252" class="node">
<title>ring_attn_2_2_stage_4</title>
<polygon fill="yellow" stroke="black" points="3648,-9122 3439,-9054 3648,-8986 3857,-9054 3648,-9122"/>
<text text-anchor="middle" x="3648" y="-9072.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-9057.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="3648" y="-9042.8" font-family="Times,serif" font-size="14.00">Q[2]×K[14]×V[14]</text>
<text text-anchor="middle" x="3648" y="-9027.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_1_stage_4&#45;&gt;ring_attn_2_2_stage_4 -->
<g id="edge1743" class="edge">
<title>ring_attn_2_1_stage_4&#45;&gt;ring_attn_2_2_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-9054C3270.02,-9054 3428.86,-9054 3428.86,-9054"/>
<polygon fill="red" stroke="red" points="3428.86,-9057.5 3438.86,-9054 3428.86,-9050.5 3428.86,-9057.5"/>
</g>
<!-- ring_attn_2_1_stage_5&#45;&gt;ring_attn_2_1_stage_6 -->
<g id="edge154" class="edge">
<title>ring_attn_2_1_stage_5&#45;&gt;ring_attn_2_1_stage_6</title>
<path fill="none" stroke="black" d="M3061,-8732.87C3061,-8732.87 3061,-8626.25 3061,-8626.25"/>
<polygon fill="black" stroke="black" points="3064.5,-8626.25 3061,-8616.25 3057.5,-8626.25 3064.5,-8626.25"/>
</g>
<!-- ring_attn_2_2_stage_5 -->
<g id="node253" class="node">
<title>ring_attn_2_2_stage_5</title>
<polygon fill="yellow" stroke="black" points="3648,-8869 3439,-8801 3648,-8733 3857,-8801 3648,-8869"/>
<text text-anchor="middle" x="3648" y="-8819.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-8804.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="3648" y="-8789.8" font-family="Times,serif" font-size="14.00">Q[2]×K[13]×V[13]</text>
<text text-anchor="middle" x="3648" y="-8774.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_1_stage_5&#45;&gt;ring_attn_2_2_stage_5 -->
<g id="edge1744" class="edge">
<title>ring_attn_2_1_stage_5&#45;&gt;ring_attn_2_2_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-8801C3270.02,-8801 3428.86,-8801 3428.86,-8801"/>
<polygon fill="red" stroke="red" points="3428.86,-8804.5 3438.86,-8801 3428.86,-8797.5 3428.86,-8804.5"/>
</g>
<!-- ring_attn_2_1_stage_6&#45;&gt;ring_attn_2_1_stage_7 -->
<g id="edge155" class="edge">
<title>ring_attn_2_1_stage_6&#45;&gt;ring_attn_2_1_stage_7</title>
<path fill="none" stroke="black" d="M3061,-8479.87C3061,-8479.87 3061,-8373.25 3061,-8373.25"/>
<polygon fill="black" stroke="black" points="3064.5,-8373.25 3061,-8363.25 3057.5,-8373.25 3064.5,-8373.25"/>
</g>
<!-- ring_attn_2_2_stage_6 -->
<g id="node254" class="node">
<title>ring_attn_2_2_stage_6</title>
<polygon fill="yellow" stroke="black" points="3648,-8616 3439,-8548 3648,-8480 3857,-8548 3648,-8616"/>
<text text-anchor="middle" x="3648" y="-8566.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-8551.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="3648" y="-8536.8" font-family="Times,serif" font-size="14.00">Q[2]×K[12]×V[12]</text>
<text text-anchor="middle" x="3648" y="-8521.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_1_stage_6&#45;&gt;ring_attn_2_2_stage_6 -->
<g id="edge1745" class="edge">
<title>ring_attn_2_1_stage_6&#45;&gt;ring_attn_2_2_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-8548C3270.02,-8548 3428.86,-8548 3428.86,-8548"/>
<polygon fill="red" stroke="red" points="3428.86,-8551.5 3438.86,-8548 3428.86,-8544.5 3428.86,-8551.5"/>
</g>
<!-- ring_attn_2_1_stage_7&#45;&gt;ring_attn_2_1_stage_8 -->
<g id="edge156" class="edge">
<title>ring_attn_2_1_stage_7&#45;&gt;ring_attn_2_1_stage_8</title>
<path fill="none" stroke="black" d="M3061,-8226.87C3061,-8226.87 3061,-8120.25 3061,-8120.25"/>
<polygon fill="black" stroke="black" points="3064.5,-8120.25 3061,-8110.25 3057.5,-8120.25 3064.5,-8120.25"/>
</g>
<!-- ring_attn_2_2_stage_7 -->
<g id="node255" class="node">
<title>ring_attn_2_2_stage_7</title>
<polygon fill="yellow" stroke="black" points="3648,-8363 3439,-8295 3648,-8227 3857,-8295 3648,-8363"/>
<text text-anchor="middle" x="3648" y="-8313.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-8298.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="3648" y="-8283.8" font-family="Times,serif" font-size="14.00">Q[2]×K[11]×V[11]</text>
<text text-anchor="middle" x="3648" y="-8268.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_1_stage_7&#45;&gt;ring_attn_2_2_stage_7 -->
<g id="edge1746" class="edge">
<title>ring_attn_2_1_stage_7&#45;&gt;ring_attn_2_2_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-8295C3270.02,-8295 3428.86,-8295 3428.86,-8295"/>
<polygon fill="red" stroke="red" points="3428.86,-8298.5 3438.86,-8295 3428.86,-8291.5 3428.86,-8298.5"/>
</g>
<!-- ring_attn_2_1_stage_8&#45;&gt;ring_attn_2_1_stage_9 -->
<g id="edge157" class="edge">
<title>ring_attn_2_1_stage_8&#45;&gt;ring_attn_2_1_stage_9</title>
<path fill="none" stroke="black" d="M3061,-7973.87C3061,-7973.87 3061,-7867.25 3061,-7867.25"/>
<polygon fill="black" stroke="black" points="3064.5,-7867.25 3061,-7857.25 3057.5,-7867.25 3064.5,-7867.25"/>
</g>
<!-- ring_attn_2_2_stage_8 -->
<g id="node256" class="node">
<title>ring_attn_2_2_stage_8</title>
<polygon fill="yellow" stroke="black" points="3648,-8110 3439,-8042 3648,-7974 3857,-8042 3648,-8110"/>
<text text-anchor="middle" x="3648" y="-8060.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-8045.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="3648" y="-8030.8" font-family="Times,serif" font-size="14.00">Q[2]×K[10]×V[10]</text>
<text text-anchor="middle" x="3648" y="-8015.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_1_stage_8&#45;&gt;ring_attn_2_2_stage_8 -->
<g id="edge1747" class="edge">
<title>ring_attn_2_1_stage_8&#45;&gt;ring_attn_2_2_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-8042C3270.02,-8042 3428.86,-8042 3428.86,-8042"/>
<polygon fill="red" stroke="red" points="3428.86,-8045.5 3438.86,-8042 3428.86,-8038.5 3428.86,-8045.5"/>
</g>
<!-- ring_attn_2_1_stage_9&#45;&gt;ring_attn_2_1_stage_10 -->
<g id="edge158" class="edge">
<title>ring_attn_2_1_stage_9&#45;&gt;ring_attn_2_1_stage_10</title>
<path fill="none" stroke="black" d="M3061,-7720.87C3061,-7720.87 3061,-7614.25 3061,-7614.25"/>
<polygon fill="black" stroke="black" points="3064.5,-7614.25 3061,-7604.25 3057.5,-7614.25 3064.5,-7614.25"/>
</g>
<!-- ring_attn_2_2_stage_9 -->
<g id="node257" class="node">
<title>ring_attn_2_2_stage_9</title>
<polygon fill="yellow" stroke="black" points="3648,-7857 3439,-7789 3648,-7721 3857,-7789 3648,-7857"/>
<text text-anchor="middle" x="3648" y="-7807.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-7792.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="3648" y="-7777.8" font-family="Times,serif" font-size="14.00">Q[2]×K[9]×V[9]</text>
<text text-anchor="middle" x="3648" y="-7762.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_1_stage_9&#45;&gt;ring_attn_2_2_stage_9 -->
<g id="edge1748" class="edge">
<title>ring_attn_2_1_stage_9&#45;&gt;ring_attn_2_2_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-7789C3270.02,-7789 3428.86,-7789 3428.86,-7789"/>
<polygon fill="red" stroke="red" points="3428.86,-7792.5 3438.86,-7789 3428.86,-7785.5 3428.86,-7792.5"/>
</g>
<!-- ring_attn_2_1_stage_10&#45;&gt;ring_attn_2_1_stage_11 -->
<g id="edge159" class="edge">
<title>ring_attn_2_1_stage_10&#45;&gt;ring_attn_2_1_stage_11</title>
<path fill="none" stroke="black" d="M3061,-7467.87C3061,-7467.87 3061,-7361.25 3061,-7361.25"/>
<polygon fill="black" stroke="black" points="3064.5,-7361.25 3061,-7351.25 3057.5,-7361.25 3064.5,-7361.25"/>
</g>
<!-- ring_attn_2_2_stage_10 -->
<g id="node258" class="node">
<title>ring_attn_2_2_stage_10</title>
<polygon fill="yellow" stroke="black" points="3648,-7604 3439,-7536 3648,-7468 3857,-7536 3648,-7604"/>
<text text-anchor="middle" x="3648" y="-7554.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-7539.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="3648" y="-7524.8" font-family="Times,serif" font-size="14.00">Q[2]×K[8]×V[8]</text>
<text text-anchor="middle" x="3648" y="-7509.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_1_stage_10&#45;&gt;ring_attn_2_2_stage_10 -->
<g id="edge1749" class="edge">
<title>ring_attn_2_1_stage_10&#45;&gt;ring_attn_2_2_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-7536C3270.02,-7536 3428.86,-7536 3428.86,-7536"/>
<polygon fill="red" stroke="red" points="3428.86,-7539.5 3438.86,-7536 3428.86,-7532.5 3428.86,-7539.5"/>
</g>
<!-- ring_attn_2_1_stage_11&#45;&gt;ring_attn_2_1_stage_12 -->
<g id="edge160" class="edge">
<title>ring_attn_2_1_stage_11&#45;&gt;ring_attn_2_1_stage_12</title>
<path fill="none" stroke="black" d="M3061,-7214.87C3061,-7214.87 3061,-7108.25 3061,-7108.25"/>
<polygon fill="black" stroke="black" points="3064.5,-7108.25 3061,-7098.25 3057.5,-7108.25 3064.5,-7108.25"/>
</g>
<!-- ring_attn_2_2_stage_11 -->
<g id="node259" class="node">
<title>ring_attn_2_2_stage_11</title>
<polygon fill="yellow" stroke="black" points="3648,-7351 3439,-7283 3648,-7215 3857,-7283 3648,-7351"/>
<text text-anchor="middle" x="3648" y="-7301.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-7286.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="3648" y="-7271.8" font-family="Times,serif" font-size="14.00">Q[2]×K[7]×V[7]</text>
<text text-anchor="middle" x="3648" y="-7256.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_1_stage_11&#45;&gt;ring_attn_2_2_stage_11 -->
<g id="edge1750" class="edge">
<title>ring_attn_2_1_stage_11&#45;&gt;ring_attn_2_2_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-7283C3270.02,-7283 3428.86,-7283 3428.86,-7283"/>
<polygon fill="red" stroke="red" points="3428.86,-7286.5 3438.86,-7283 3428.86,-7279.5 3428.86,-7286.5"/>
</g>
<!-- ring_attn_2_1_stage_12&#45;&gt;ring_attn_2_1_stage_13 -->
<g id="edge161" class="edge">
<title>ring_attn_2_1_stage_12&#45;&gt;ring_attn_2_1_stage_13</title>
<path fill="none" stroke="black" d="M3061,-6961.87C3061,-6961.87 3061,-6855.25 3061,-6855.25"/>
<polygon fill="black" stroke="black" points="3064.5,-6855.25 3061,-6845.25 3057.5,-6855.25 3064.5,-6855.25"/>
</g>
<!-- ring_attn_2_2_stage_12 -->
<g id="node260" class="node">
<title>ring_attn_2_2_stage_12</title>
<polygon fill="yellow" stroke="black" points="3648,-7098 3439,-7030 3648,-6962 3857,-7030 3648,-7098"/>
<text text-anchor="middle" x="3648" y="-7048.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-7033.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="3648" y="-7018.8" font-family="Times,serif" font-size="14.00">Q[2]×K[6]×V[6]</text>
<text text-anchor="middle" x="3648" y="-7003.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_1_stage_12&#45;&gt;ring_attn_2_2_stage_12 -->
<g id="edge1751" class="edge">
<title>ring_attn_2_1_stage_12&#45;&gt;ring_attn_2_2_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-7030C3270.02,-7030 3428.86,-7030 3428.86,-7030"/>
<polygon fill="red" stroke="red" points="3428.86,-7033.5 3438.86,-7030 3428.86,-7026.5 3428.86,-7033.5"/>
</g>
<!-- ring_attn_2_1_stage_13&#45;&gt;ring_attn_2_1_stage_14 -->
<g id="edge162" class="edge">
<title>ring_attn_2_1_stage_13&#45;&gt;ring_attn_2_1_stage_14</title>
<path fill="none" stroke="black" d="M3061,-6708.87C3061,-6708.87 3061,-6602.25 3061,-6602.25"/>
<polygon fill="black" stroke="black" points="3064.5,-6602.25 3061,-6592.25 3057.5,-6602.25 3064.5,-6602.25"/>
</g>
<!-- ring_attn_2_2_stage_13 -->
<g id="node261" class="node">
<title>ring_attn_2_2_stage_13</title>
<polygon fill="yellow" stroke="black" points="3648,-6845 3439,-6777 3648,-6709 3857,-6777 3648,-6845"/>
<text text-anchor="middle" x="3648" y="-6795.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-6780.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="3648" y="-6765.8" font-family="Times,serif" font-size="14.00">Q[2]×K[5]×V[5]</text>
<text text-anchor="middle" x="3648" y="-6750.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_1_stage_13&#45;&gt;ring_attn_2_2_stage_13 -->
<g id="edge1752" class="edge">
<title>ring_attn_2_1_stage_13&#45;&gt;ring_attn_2_2_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-6777C3270.02,-6777 3428.86,-6777 3428.86,-6777"/>
<polygon fill="red" stroke="red" points="3428.86,-6780.5 3438.86,-6777 3428.86,-6773.5 3428.86,-6780.5"/>
</g>
<!-- ring_attn_2_1_stage_14&#45;&gt;ring_attn_2_1_stage_15 -->
<g id="edge163" class="edge">
<title>ring_attn_2_1_stage_14&#45;&gt;ring_attn_2_1_stage_15</title>
<path fill="none" stroke="black" d="M3061,-6455.87C3061,-6455.87 3061,-6349.25 3061,-6349.25"/>
<polygon fill="black" stroke="black" points="3064.5,-6349.25 3061,-6339.25 3057.5,-6349.25 3064.5,-6349.25"/>
</g>
<!-- ring_attn_2_2_stage_14 -->
<g id="node262" class="node">
<title>ring_attn_2_2_stage_14</title>
<polygon fill="yellow" stroke="black" points="3648,-6592 3439,-6524 3648,-6456 3857,-6524 3648,-6592"/>
<text text-anchor="middle" x="3648" y="-6542.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-6527.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="3648" y="-6512.8" font-family="Times,serif" font-size="14.00">Q[2]×K[4]×V[4]</text>
<text text-anchor="middle" x="3648" y="-6497.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_1_stage_14&#45;&gt;ring_attn_2_2_stage_14 -->
<g id="edge1753" class="edge">
<title>ring_attn_2_1_stage_14&#45;&gt;ring_attn_2_2_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-6524C3270.02,-6524 3428.86,-6524 3428.86,-6524"/>
<polygon fill="red" stroke="red" points="3428.86,-6527.5 3438.86,-6524 3428.86,-6520.5 3428.86,-6527.5"/>
</g>
<!-- attn_out_2_1 -->
<g id="node166" class="node">
<title>attn_out_2_1</title>
<polygon fill="none" stroke="black" points="3130.5,-6130 2991.5,-6130 2991.5,-6077 3130.5,-6077 3130.5,-6130"/>
<text text-anchor="middle" x="3061" y="-6114.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="3061" y="-6099.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="3061" y="-6084.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_2_1_stage_15&#45;&gt;attn_out_2_1 -->
<g id="edge164" class="edge">
<title>ring_attn_2_1_stage_15&#45;&gt;attn_out_2_1</title>
<path fill="none" stroke="black" d="M3061,-6202.87C3061,-6202.87 3061,-6140.18 3061,-6140.18"/>
<polygon fill="black" stroke="black" points="3064.5,-6140.18 3061,-6130.18 3057.5,-6140.18 3064.5,-6140.18"/>
</g>
<!-- ring_attn_2_2_stage_15 -->
<g id="node263" class="node">
<title>ring_attn_2_2_stage_15</title>
<polygon fill="yellow" stroke="black" points="3648,-6339 3439,-6271 3648,-6203 3857,-6271 3648,-6339"/>
<text text-anchor="middle" x="3648" y="-6289.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-6274.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="3648" y="-6259.8" font-family="Times,serif" font-size="14.00">Q[2]×K[3]×V[3]</text>
<text text-anchor="middle" x="3648" y="-6244.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_1_stage_15&#45;&gt;ring_attn_2_2_stage_15 -->
<g id="edge1754" class="edge">
<title>ring_attn_2_1_stage_15&#45;&gt;ring_attn_2_2_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-6271C3270.02,-6271 3428.86,-6271 3428.86,-6271"/>
<polygon fill="red" stroke="red" points="3428.86,-6274.5 3438.86,-6271 3428.86,-6267.5 3428.86,-6274.5"/>
</g>
<!-- attn_residual_2_1 -->
<g id="node167" class="node">
<title>attn_residual_2_1</title>
<ellipse fill="none" stroke="black" cx="3061" cy="-5977" rx="105.5" ry="27"/>
<text text-anchor="middle" x="3061" y="-5980.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="3061" y="-5965.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_2_1&#45;&gt;attn_residual_2_1 -->
<g id="edge165" class="edge">
<title>attn_out_2_1&#45;&gt;attn_residual_2_1</title>
<path fill="none" stroke="black" d="M3061,-6076.98C3061,-6076.98 3061,-6014.36 3061,-6014.36"/>
<polygon fill="black" stroke="black" points="3064.5,-6014.36 3061,-6004.36 3057.5,-6014.36 3064.5,-6014.36"/>
</g>
<!-- gate_2_1 -->
<g id="node168" class="node">
<title>gate_2_1</title>
<ellipse fill="orange" stroke="black" cx="3061" cy="-5839.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="3061" y="-5850.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="3061" y="-5835.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="3061" y="-5820.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_2_1&#45;&gt;gate_2_1 -->
<g id="edge166" class="edge">
<title>attn_residual_2_1&#45;&gt;gate_2_1</title>
<path fill="none" stroke="black" d="M3025.83,-5951.46C3025.83,-5951.46 3025.83,-5885.01 3025.83,-5885.01"/>
<polygon fill="black" stroke="black" points="3029.33,-5885.01 3025.83,-5875.01 3022.33,-5885.01 3029.33,-5885.01"/>
</g>
<!-- gate_2_1&#45;&gt;expert_2_0_0 -->
<g id="edge1755" class="edge">
<title>gate_2_1&#45;&gt;expert_2_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M2961.27,-5852C2470.82,-5852 338.21,-5852 338.21,-5852 338.21,-5852 338.21,-5680.33 338.21,-5680.33"/>
<polygon fill="blue" stroke="blue" points="341.71,-5680.33 338.21,-5670.33 334.71,-5680.33 341.71,-5680.33"/>
<text text-anchor="middle" x="11606.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="11606.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU1→GPU0</text>
<text text-anchor="middle" x="11606.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="11606.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_1&#45;&gt;expert_2_1_0 -->
<g id="edge167" class="edge">
<title>gate_2_1&#45;&gt;expert_2_1_0</title>
<path fill="none" stroke="black" d="M2965.09,-5823.79C2965.09,-5823.79 2965.09,-5680.33 2965.09,-5680.33"/>
<polygon fill="black" stroke="black" points="2968.59,-5680.33 2965.09,-5670.33 2961.59,-5680.33 2968.59,-5680.33"/>
</g>
<!-- gate_2_1&#45;&gt;expert_2_2_0 -->
<g id="edge1756" class="edge">
<title>gate_2_1&#45;&gt;expert_2_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3160.52,-5827C3299.74,-5827 3535.75,-5827 3535.75,-5827 3535.75,-5827 3535.75,-5680.18 3535.75,-5680.18"/>
<polygon fill="blue" stroke="blue" points="3539.25,-5680.18 3535.75,-5670.18 3532.25,-5680.18 3539.25,-5680.18"/>
<text text-anchor="middle" x="11780.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="11780.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU1→GPU2</text>
<text text-anchor="middle" x="11780.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="11780.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_1&#45;&gt;expert_2_3_0 -->
<g id="edge1757" class="edge">
<title>gate_2_1&#45;&gt;expert_2_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3051.41,-5801.91C3051.41,-5800.09 3051.41,-5799 3051.41,-5799 3051.41,-5799 4120.5,-5799 4120.5,-5799 4120.5,-5799 4120.5,-5680.23 4120.5,-5680.23"/>
<polygon fill="blue" stroke="blue" points="4124,-5680.23 4120.5,-5670.23 4117,-5680.23 4124,-5680.23"/>
<text text-anchor="middle" x="11954.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="11954.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU1→GPU3</text>
<text text-anchor="middle" x="11954.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="11954.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_1&#45;&gt;expert_2_4_0 -->
<g id="edge1758" class="edge">
<title>gate_2_1&#45;&gt;expert_2_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3061,-5801.82C3061,-5790.01 3061,-5780 3061,-5780 3061,-5780 4705.7,-5780 4705.7,-5780 4705.7,-5780 4705.7,-5680.14 4705.7,-5680.14"/>
<polygon fill="blue" stroke="blue" points="4709.2,-5680.14 4705.7,-5670.14 4702.2,-5680.14 4709.2,-5680.14"/>
<text text-anchor="middle" x="12128.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12128.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU1→GPU4</text>
<text text-anchor="middle" x="12128.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12128.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_1&#45;&gt;expert_2_5_0 -->
<g id="edge1759" class="edge">
<title>gate_2_1&#45;&gt;expert_2_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3070.59,-5801.98C3070.59,-5787.79 3070.59,-5775 3070.59,-5775 3070.59,-5775 5343.69,-5775 5343.69,-5775 5343.69,-5775 5343.69,-5680.11 5343.69,-5680.11"/>
<polygon fill="blue" stroke="blue" points="5347.19,-5680.11 5343.69,-5670.11 5340.19,-5680.11 5347.19,-5680.11"/>
<text text-anchor="middle" x="12302.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12302.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU1→GPU5</text>
<text text-anchor="middle" x="12302.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12302.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_1&#45;&gt;expert_2_6_0 -->
<g id="edge1760" class="edge">
<title>gate_2_1&#45;&gt;expert_2_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3080.18,-5802.6C3080.18,-5785.54 3080.18,-5769 3080.18,-5769 3080.18,-5769 5911.6,-5769 5911.6,-5769 5911.6,-5769 5911.6,-5680.12 5911.6,-5680.12"/>
<polygon fill="blue" stroke="blue" points="5915.1,-5680.12 5911.6,-5670.12 5908.1,-5680.12 5915.1,-5680.12"/>
<text text-anchor="middle" x="12476.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12476.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU1→GPU6</text>
<text text-anchor="middle" x="12476.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12476.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_1&#45;&gt;expert_2_7_0 -->
<g id="edge1761" class="edge">
<title>gate_2_1&#45;&gt;expert_2_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3089.77,-5803.34C3089.77,-5771.45 3089.77,-5730 3089.77,-5730 3089.77,-5730 6497.6,-5730 6497.6,-5730 6497.6,-5730 6497.6,-5680.39 6497.6,-5680.39"/>
<polygon fill="blue" stroke="blue" points="6501.1,-5680.39 6497.6,-5670.39 6494.1,-5680.4 6501.1,-5680.39"/>
<text text-anchor="middle" x="12650.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12650.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU1→GPU7</text>
<text text-anchor="middle" x="12650.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12650.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_1&#45;&gt;expert_2_8_0 -->
<g id="edge1762" class="edge">
<title>gate_2_1&#45;&gt;expert_2_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3099.36,-5804.27C3099.36,-5769.34 3099.36,-5721 3099.36,-5721 3099.36,-5721 7082.85,-5721 7082.85,-5721 7082.85,-5721 7082.85,-5680.17 7082.85,-5680.17"/>
<polygon fill="blue" stroke="blue" points="7086.35,-5680.17 7082.85,-5670.17 7079.35,-5680.17 7086.35,-5680.17"/>
<text text-anchor="middle" x="12824.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12824.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU1→GPU8</text>
<text text-anchor="middle" x="12824.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12824.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_1&#45;&gt;expert_2_9_0 -->
<g id="edge1763" class="edge">
<title>gate_2_1&#45;&gt;expert_2_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3108.95,-5805.93C3108.95,-5770.28 3108.95,-5719 3108.95,-5719 3108.95,-5719 7661.09,-5719 7661.09,-5719 7661.09,-5719 7661.09,-5680.33 7661.09,-5680.33"/>
<polygon fill="blue" stroke="blue" points="7664.59,-5680.33 7661.09,-5670.33 7657.59,-5680.33 7664.59,-5680.33"/>
<text text-anchor="middle" x="12998.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12998.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU1→GPU9</text>
<text text-anchor="middle" x="12998.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12998.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_1&#45;&gt;expert_2_10_0 -->
<g id="edge1764" class="edge">
<title>gate_2_1&#45;&gt;expert_2_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3096.17,-5875C3096.17,-5882.4 3096.17,-5888 3096.17,-5888 3096.17,-5888 8235.8,-5888 8235.8,-5888 8235.8,-5888 8235.8,-5680.13 8235.8,-5680.13"/>
<polygon fill="blue" stroke="blue" points="8239.3,-5680.13 8235.8,-5670.13 8232.3,-5680.13 8239.3,-5680.13"/>
<text text-anchor="middle" x="13172.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="13172.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU1→GPU10</text>
<text text-anchor="middle" x="13172.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="13172.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_1&#45;&gt;expert_2_11_0 -->
<g id="edge1765" class="edge">
<title>gate_2_1&#45;&gt;expert_2_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3118.55,-5807.78C3118.55,-5760.49 3118.55,-5677 3118.55,-5677 3118.55,-5677 8620.6,-5677 8620.6,-5677 8620.6,-5677 8620.6,-5652 8620.6,-5652 8620.6,-5652 8801.88,-5652 8801.88,-5652"/>
<polygon fill="blue" stroke="blue" points="8801.88,-5655.5 8811.88,-5652 8801.88,-5648.5 8801.88,-5655.5"/>
<text text-anchor="middle" x="13346.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="13346.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU1→GPU11</text>
<text text-anchor="middle" x="13346.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="13346.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_1&#45;&gt;expert_2_12_0 -->
<g id="edge1766" class="edge">
<title>gate_2_1&#45;&gt;expert_2_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3128.14,-5810.46C3128.14,-5768.53 3128.14,-5696 3128.14,-5696 3128.14,-5696 9430.85,-5696 9430.85,-5696 9430.85,-5696 9430.85,-5680.06 9430.85,-5680.06"/>
<polygon fill="blue" stroke="blue" points="9434.35,-5680.06 9430.85,-5670.06 9427.35,-5680.06 9434.35,-5680.06"/>
<text text-anchor="middle" x="13520.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="13520.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU1→GPU12</text>
<text text-anchor="middle" x="13520.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="13520.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_1&#45;&gt;expert_2_13_0 -->
<g id="edge1767" class="edge">
<title>gate_2_1&#45;&gt;expert_2_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3137.73,-5813.47C3137.73,-5771.13 3137.73,-5692 3137.73,-5692 3137.73,-5692 10033.26,-5692 10033.26,-5692 10033.26,-5692 10033.26,-5680.02 10033.26,-5680.02"/>
<polygon fill="blue" stroke="blue" points="10036.76,-5680.02 10033.26,-5670.02 10029.76,-5680.02 10036.76,-5680.02"/>
<text text-anchor="middle" x="13694.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="13694.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU1→GPU13</text>
<text text-anchor="middle" x="13694.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="13694.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_1&#45;&gt;expert_2_14_0 -->
<g id="edge1768" class="edge">
<title>gate_2_1&#45;&gt;expert_2_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3147.32,-5817.79C3147.32,-5775.9 3147.32,-5688 3147.32,-5688 3147.32,-5688 10626.69,-5688 10626.69,-5688 10626.69,-5688 10626.69,-5680.16 10626.69,-5680.16"/>
<polygon fill="blue" stroke="blue" points="10630.19,-5680.16 10626.69,-5670.16 10623.19,-5680.16 10630.19,-5680.16"/>
<text text-anchor="middle" x="13868.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="13868.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU1→GPU14</text>
<text text-anchor="middle" x="13868.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="13868.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_1&#45;&gt;expert_2_15_0 -->
<g id="edge1769" class="edge">
<title>gate_2_1&#45;&gt;expert_2_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3156.91,-5823.84C3156.91,-5784.56 3156.91,-5685 3156.91,-5685 3156.91,-5685 11217.92,-5685 11217.92,-5685 11217.92,-5685 11217.92,-5680.02 11217.92,-5680.02"/>
<polygon fill="blue" stroke="blue" points="11221.42,-5680.02 11217.92,-5670.02 11214.42,-5680.02 11221.42,-5680.02"/>
<text text-anchor="middle" x="14042.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14042.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU1→GPU15</text>
<text text-anchor="middle" x="14042.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14042.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_1 -->
<g id="node170" class="node">
<title>expert_reduce_2_1</title>
<ellipse fill="none" stroke="black" cx="3061" cy="-5506.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="3061" y="-5517.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="3061" y="-5502.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="3061" y="-5487.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_1_0&#45;&gt;expert_reduce_2_1 -->
<g id="edge168" class="edge">
<title>expert_2_1_0&#45;&gt;expert_reduce_2_1</title>
<path fill="none" stroke="black" d="M3061,-5616.76C3061,-5616.76 3061,-5554.06 3061,-5554.06"/>
<polygon fill="black" stroke="black" points="3064.5,-5554.06 3061,-5544.06 3057.5,-5554.06 3064.5,-5554.06"/>
</g>
<!-- moe_residual_2_1 -->
<g id="node171" class="node">
<title>moe_residual_2_1</title>
<ellipse fill="none" stroke="black" cx="3061" cy="-5369" rx="105.5" ry="27"/>
<text text-anchor="middle" x="3061" y="-5372.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="3061" y="-5357.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_1&#45;&gt;moe_residual_2_1 -->
<g id="edge169" class="edge">
<title>expert_reduce_2_1&#45;&gt;moe_residual_2_1</title>
<path fill="none" stroke="black" d="M3061,-5468.93C3061,-5468.93 3061,-5406.06 3061,-5406.06"/>
<polygon fill="black" stroke="black" points="3064.5,-5406.06 3061,-5396.06 3057.5,-5406.06 3064.5,-5406.06"/>
</g>
<!-- qkv_proj_3_1 -->
<g id="node172" class="node">
<title>qkv_proj_3_1</title>
<polygon fill="none" stroke="black" points="3143.5,-5269 2978.5,-5269 2978.5,-5216 3143.5,-5216 3143.5,-5269"/>
<text text-anchor="middle" x="3061" y="-5253.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="3061" y="-5238.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="3061" y="-5223.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_2_1&#45;&gt;qkv_proj_3_1 -->
<g id="edge170" class="edge">
<title>moe_residual_2_1&#45;&gt;qkv_proj_3_1</title>
<path fill="none" stroke="black" d="M3061,-5341.86C3061,-5341.86 3061,-5279.16 3061,-5279.16"/>
<polygon fill="black" stroke="black" points="3064.5,-5279.16 3061,-5269.16 3057.5,-5279.16 3064.5,-5279.16"/>
</g>
<!-- qkv_reshape_3_1 -->
<g id="node173" class="node">
<title>qkv_reshape_3_1</title>
<ellipse fill="none" stroke="black" cx="3061" cy="-5116" rx="148" ry="27"/>
<text text-anchor="middle" x="3061" y="-5119.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="3061" y="-5104.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_3_1&#45;&gt;qkv_reshape_3_1 -->
<g id="edge171" class="edge">
<title>qkv_proj_3_1&#45;&gt;qkv_reshape_3_1</title>
<path fill="none" stroke="black" d="M3061,-5215.98C3061,-5215.98 3061,-5153.36 3061,-5153.36"/>
<polygon fill="black" stroke="black" points="3064.5,-5153.36 3061,-5143.36 3057.5,-5153.36 3064.5,-5153.36"/>
</g>
<!-- qkv_reshape_3_1&#45;&gt;ring_attn_3_1_stage_0 -->
<g id="edge172" class="edge">
<title>qkv_reshape_3_1&#45;&gt;ring_attn_3_1_stage_0</title>
<path fill="none" stroke="black" d="M3061,-5088.72C3061,-5088.72 3061,-4982.16 3061,-4982.16"/>
<polygon fill="black" stroke="black" points="3064.5,-4982.16 3061,-4972.16 3057.5,-4982.16 3064.5,-4982.16"/>
</g>
<!-- ring_attn_3_1_stage_0&#45;&gt;ring_attn_3_1_stage_1 -->
<g id="edge173" class="edge">
<title>ring_attn_3_1_stage_0&#45;&gt;ring_attn_3_1_stage_1</title>
<path fill="none" stroke="black" d="M3061,-4835.87C3061,-4835.87 3061,-4729.25 3061,-4729.25"/>
<polygon fill="black" stroke="black" points="3064.5,-4729.25 3061,-4719.25 3057.5,-4729.25 3064.5,-4729.25"/>
</g>
<!-- ring_attn_3_2_stage_0 -->
<g id="node272" class="node">
<title>ring_attn_3_2_stage_0</title>
<polygon fill="yellow" stroke="black" points="3648,-4972 3439,-4904 3648,-4836 3857,-4904 3648,-4972"/>
<text text-anchor="middle" x="3648" y="-4922.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-4907.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="3648" y="-4892.8" font-family="Times,serif" font-size="14.00">Q[2]×K[2]×V[2]</text>
<text text-anchor="middle" x="3648" y="-4877.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_1_stage_0&#45;&gt;ring_attn_3_2_stage_0 -->
<g id="edge1770" class="edge">
<title>ring_attn_3_1_stage_0&#45;&gt;ring_attn_3_2_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-4904C3270.02,-4904 3428.86,-4904 3428.86,-4904"/>
<polygon fill="red" stroke="red" points="3428.86,-4907.5 3438.86,-4904 3428.86,-4900.5 3428.86,-4907.5"/>
</g>
<!-- ring_attn_3_1_stage_1&#45;&gt;ring_attn_3_1_stage_2 -->
<g id="edge174" class="edge">
<title>ring_attn_3_1_stage_1&#45;&gt;ring_attn_3_1_stage_2</title>
<path fill="none" stroke="black" d="M3061,-4582.87C3061,-4582.87 3061,-4476.25 3061,-4476.25"/>
<polygon fill="black" stroke="black" points="3064.5,-4476.25 3061,-4466.25 3057.5,-4476.25 3064.5,-4476.25"/>
</g>
<!-- ring_attn_3_2_stage_1 -->
<g id="node273" class="node">
<title>ring_attn_3_2_stage_1</title>
<polygon fill="yellow" stroke="black" points="3648,-4719 3439,-4651 3648,-4583 3857,-4651 3648,-4719"/>
<text text-anchor="middle" x="3648" y="-4669.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-4654.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="3648" y="-4639.8" font-family="Times,serif" font-size="14.00">Q[2]×K[1]×V[1]</text>
<text text-anchor="middle" x="3648" y="-4624.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_1_stage_1&#45;&gt;ring_attn_3_2_stage_1 -->
<g id="edge1771" class="edge">
<title>ring_attn_3_1_stage_1&#45;&gt;ring_attn_3_2_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-4651C3270.02,-4651 3428.86,-4651 3428.86,-4651"/>
<polygon fill="red" stroke="red" points="3428.86,-4654.5 3438.86,-4651 3428.86,-4647.5 3428.86,-4654.5"/>
</g>
<!-- ring_attn_3_1_stage_2&#45;&gt;ring_attn_3_1_stage_3 -->
<g id="edge175" class="edge">
<title>ring_attn_3_1_stage_2&#45;&gt;ring_attn_3_1_stage_3</title>
<path fill="none" stroke="black" d="M3061,-4329.87C3061,-4329.87 3061,-4223.25 3061,-4223.25"/>
<polygon fill="black" stroke="black" points="3064.5,-4223.25 3061,-4213.25 3057.5,-4223.25 3064.5,-4223.25"/>
</g>
<!-- ring_attn_3_2_stage_2 -->
<g id="node274" class="node">
<title>ring_attn_3_2_stage_2</title>
<polygon fill="yellow" stroke="black" points="3648,-4466 3439,-4398 3648,-4330 3857,-4398 3648,-4466"/>
<text text-anchor="middle" x="3648" y="-4416.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-4401.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="3648" y="-4386.8" font-family="Times,serif" font-size="14.00">Q[2]×K[0]×V[0]</text>
<text text-anchor="middle" x="3648" y="-4371.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_1_stage_2&#45;&gt;ring_attn_3_2_stage_2 -->
<g id="edge1772" class="edge">
<title>ring_attn_3_1_stage_2&#45;&gt;ring_attn_3_2_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-4398C3270.02,-4398 3428.86,-4398 3428.86,-4398"/>
<polygon fill="red" stroke="red" points="3428.86,-4401.5 3438.86,-4398 3428.86,-4394.5 3428.86,-4401.5"/>
</g>
<!-- ring_attn_3_1_stage_3&#45;&gt;ring_attn_3_1_stage_4 -->
<g id="edge176" class="edge">
<title>ring_attn_3_1_stage_3&#45;&gt;ring_attn_3_1_stage_4</title>
<path fill="none" stroke="black" d="M3061,-4076.87C3061,-4076.87 3061,-3970.25 3061,-3970.25"/>
<polygon fill="black" stroke="black" points="3064.5,-3970.25 3061,-3960.25 3057.5,-3970.25 3064.5,-3970.25"/>
</g>
<!-- ring_attn_3_2_stage_3 -->
<g id="node275" class="node">
<title>ring_attn_3_2_stage_3</title>
<polygon fill="yellow" stroke="black" points="3648,-4213 3439,-4145 3648,-4077 3857,-4145 3648,-4213"/>
<text text-anchor="middle" x="3648" y="-4163.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-4148.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="3648" y="-4133.8" font-family="Times,serif" font-size="14.00">Q[2]×K[15]×V[15]</text>
<text text-anchor="middle" x="3648" y="-4118.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_1_stage_3&#45;&gt;ring_attn_3_2_stage_3 -->
<g id="edge1773" class="edge">
<title>ring_attn_3_1_stage_3&#45;&gt;ring_attn_3_2_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-4145C3270.02,-4145 3428.86,-4145 3428.86,-4145"/>
<polygon fill="red" stroke="red" points="3428.86,-4148.5 3438.86,-4145 3428.86,-4141.5 3428.86,-4148.5"/>
</g>
<!-- ring_attn_3_1_stage_4&#45;&gt;ring_attn_3_1_stage_5 -->
<g id="edge177" class="edge">
<title>ring_attn_3_1_stage_4&#45;&gt;ring_attn_3_1_stage_5</title>
<path fill="none" stroke="black" d="M3061,-3823.87C3061,-3823.87 3061,-3717.25 3061,-3717.25"/>
<polygon fill="black" stroke="black" points="3064.5,-3717.25 3061,-3707.25 3057.5,-3717.25 3064.5,-3717.25"/>
</g>
<!-- ring_attn_3_2_stage_4 -->
<g id="node276" class="node">
<title>ring_attn_3_2_stage_4</title>
<polygon fill="yellow" stroke="black" points="3648,-3960 3439,-3892 3648,-3824 3857,-3892 3648,-3960"/>
<text text-anchor="middle" x="3648" y="-3910.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-3895.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="3648" y="-3880.8" font-family="Times,serif" font-size="14.00">Q[2]×K[14]×V[14]</text>
<text text-anchor="middle" x="3648" y="-3865.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_1_stage_4&#45;&gt;ring_attn_3_2_stage_4 -->
<g id="edge1774" class="edge">
<title>ring_attn_3_1_stage_4&#45;&gt;ring_attn_3_2_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-3892C3270.02,-3892 3428.86,-3892 3428.86,-3892"/>
<polygon fill="red" stroke="red" points="3428.86,-3895.5 3438.86,-3892 3428.86,-3888.5 3428.86,-3895.5"/>
</g>
<!-- ring_attn_3_1_stage_5&#45;&gt;ring_attn_3_1_stage_6 -->
<g id="edge178" class="edge">
<title>ring_attn_3_1_stage_5&#45;&gt;ring_attn_3_1_stage_6</title>
<path fill="none" stroke="black" d="M3061,-3570.87C3061,-3570.87 3061,-3464.25 3061,-3464.25"/>
<polygon fill="black" stroke="black" points="3064.5,-3464.25 3061,-3454.25 3057.5,-3464.25 3064.5,-3464.25"/>
</g>
<!-- ring_attn_3_2_stage_5 -->
<g id="node277" class="node">
<title>ring_attn_3_2_stage_5</title>
<polygon fill="yellow" stroke="black" points="3648,-3707 3439,-3639 3648,-3571 3857,-3639 3648,-3707"/>
<text text-anchor="middle" x="3648" y="-3657.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-3642.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="3648" y="-3627.8" font-family="Times,serif" font-size="14.00">Q[2]×K[13]×V[13]</text>
<text text-anchor="middle" x="3648" y="-3612.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_1_stage_5&#45;&gt;ring_attn_3_2_stage_5 -->
<g id="edge1775" class="edge">
<title>ring_attn_3_1_stage_5&#45;&gt;ring_attn_3_2_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-3639C3270.02,-3639 3428.86,-3639 3428.86,-3639"/>
<polygon fill="red" stroke="red" points="3428.86,-3642.5 3438.86,-3639 3428.86,-3635.5 3428.86,-3642.5"/>
</g>
<!-- ring_attn_3_1_stage_6&#45;&gt;ring_attn_3_1_stage_7 -->
<g id="edge179" class="edge">
<title>ring_attn_3_1_stage_6&#45;&gt;ring_attn_3_1_stage_7</title>
<path fill="none" stroke="black" d="M3061,-3317.87C3061,-3317.87 3061,-3211.25 3061,-3211.25"/>
<polygon fill="black" stroke="black" points="3064.5,-3211.25 3061,-3201.25 3057.5,-3211.25 3064.5,-3211.25"/>
</g>
<!-- ring_attn_3_2_stage_6 -->
<g id="node278" class="node">
<title>ring_attn_3_2_stage_6</title>
<polygon fill="yellow" stroke="black" points="3648,-3454 3439,-3386 3648,-3318 3857,-3386 3648,-3454"/>
<text text-anchor="middle" x="3648" y="-3404.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-3389.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="3648" y="-3374.8" font-family="Times,serif" font-size="14.00">Q[2]×K[12]×V[12]</text>
<text text-anchor="middle" x="3648" y="-3359.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_1_stage_6&#45;&gt;ring_attn_3_2_stage_6 -->
<g id="edge1776" class="edge">
<title>ring_attn_3_1_stage_6&#45;&gt;ring_attn_3_2_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-3386C3270.02,-3386 3428.86,-3386 3428.86,-3386"/>
<polygon fill="red" stroke="red" points="3428.86,-3389.5 3438.86,-3386 3428.86,-3382.5 3428.86,-3389.5"/>
</g>
<!-- ring_attn_3_1_stage_7&#45;&gt;ring_attn_3_1_stage_8 -->
<g id="edge180" class="edge">
<title>ring_attn_3_1_stage_7&#45;&gt;ring_attn_3_1_stage_8</title>
<path fill="none" stroke="black" d="M3061,-3064.87C3061,-3064.87 3061,-2958.25 3061,-2958.25"/>
<polygon fill="black" stroke="black" points="3064.5,-2958.25 3061,-2948.25 3057.5,-2958.25 3064.5,-2958.25"/>
</g>
<!-- ring_attn_3_2_stage_7 -->
<g id="node279" class="node">
<title>ring_attn_3_2_stage_7</title>
<polygon fill="yellow" stroke="black" points="3648,-3201 3439,-3133 3648,-3065 3857,-3133 3648,-3201"/>
<text text-anchor="middle" x="3648" y="-3151.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-3136.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="3648" y="-3121.8" font-family="Times,serif" font-size="14.00">Q[2]×K[11]×V[11]</text>
<text text-anchor="middle" x="3648" y="-3106.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_1_stage_7&#45;&gt;ring_attn_3_2_stage_7 -->
<g id="edge1777" class="edge">
<title>ring_attn_3_1_stage_7&#45;&gt;ring_attn_3_2_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-3133C3270.02,-3133 3428.86,-3133 3428.86,-3133"/>
<polygon fill="red" stroke="red" points="3428.86,-3136.5 3438.86,-3133 3428.86,-3129.5 3428.86,-3136.5"/>
</g>
<!-- ring_attn_3_1_stage_8&#45;&gt;ring_attn_3_1_stage_9 -->
<g id="edge181" class="edge">
<title>ring_attn_3_1_stage_8&#45;&gt;ring_attn_3_1_stage_9</title>
<path fill="none" stroke="black" d="M3061,-2811.87C3061,-2811.87 3061,-2705.25 3061,-2705.25"/>
<polygon fill="black" stroke="black" points="3064.5,-2705.25 3061,-2695.25 3057.5,-2705.25 3064.5,-2705.25"/>
</g>
<!-- ring_attn_3_2_stage_8 -->
<g id="node280" class="node">
<title>ring_attn_3_2_stage_8</title>
<polygon fill="yellow" stroke="black" points="3648,-2948 3439,-2880 3648,-2812 3857,-2880 3648,-2948"/>
<text text-anchor="middle" x="3648" y="-2898.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-2883.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="3648" y="-2868.8" font-family="Times,serif" font-size="14.00">Q[2]×K[10]×V[10]</text>
<text text-anchor="middle" x="3648" y="-2853.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_1_stage_8&#45;&gt;ring_attn_3_2_stage_8 -->
<g id="edge1778" class="edge">
<title>ring_attn_3_1_stage_8&#45;&gt;ring_attn_3_2_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-2880C3270.02,-2880 3428.86,-2880 3428.86,-2880"/>
<polygon fill="red" stroke="red" points="3428.86,-2883.5 3438.86,-2880 3428.86,-2876.5 3428.86,-2883.5"/>
</g>
<!-- ring_attn_3_1_stage_9&#45;&gt;ring_attn_3_1_stage_10 -->
<g id="edge182" class="edge">
<title>ring_attn_3_1_stage_9&#45;&gt;ring_attn_3_1_stage_10</title>
<path fill="none" stroke="black" d="M3061,-2558.87C3061,-2558.87 3061,-2452.25 3061,-2452.25"/>
<polygon fill="black" stroke="black" points="3064.5,-2452.25 3061,-2442.25 3057.5,-2452.25 3064.5,-2452.25"/>
</g>
<!-- ring_attn_3_2_stage_9 -->
<g id="node281" class="node">
<title>ring_attn_3_2_stage_9</title>
<polygon fill="yellow" stroke="black" points="3648,-2695 3439,-2627 3648,-2559 3857,-2627 3648,-2695"/>
<text text-anchor="middle" x="3648" y="-2645.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-2630.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="3648" y="-2615.8" font-family="Times,serif" font-size="14.00">Q[2]×K[9]×V[9]</text>
<text text-anchor="middle" x="3648" y="-2600.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_1_stage_9&#45;&gt;ring_attn_3_2_stage_9 -->
<g id="edge1779" class="edge">
<title>ring_attn_3_1_stage_9&#45;&gt;ring_attn_3_2_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-2627C3270.02,-2627 3428.86,-2627 3428.86,-2627"/>
<polygon fill="red" stroke="red" points="3428.86,-2630.5 3438.86,-2627 3428.86,-2623.5 3428.86,-2630.5"/>
</g>
<!-- ring_attn_3_1_stage_10&#45;&gt;ring_attn_3_1_stage_11 -->
<g id="edge183" class="edge">
<title>ring_attn_3_1_stage_10&#45;&gt;ring_attn_3_1_stage_11</title>
<path fill="none" stroke="black" d="M3061,-2305.87C3061,-2305.87 3061,-2199.25 3061,-2199.25"/>
<polygon fill="black" stroke="black" points="3064.5,-2199.25 3061,-2189.25 3057.5,-2199.25 3064.5,-2199.25"/>
</g>
<!-- ring_attn_3_2_stage_10 -->
<g id="node282" class="node">
<title>ring_attn_3_2_stage_10</title>
<polygon fill="yellow" stroke="black" points="3648,-2442 3439,-2374 3648,-2306 3857,-2374 3648,-2442"/>
<text text-anchor="middle" x="3648" y="-2392.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-2377.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="3648" y="-2362.8" font-family="Times,serif" font-size="14.00">Q[2]×K[8]×V[8]</text>
<text text-anchor="middle" x="3648" y="-2347.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_1_stage_10&#45;&gt;ring_attn_3_2_stage_10 -->
<g id="edge1780" class="edge">
<title>ring_attn_3_1_stage_10&#45;&gt;ring_attn_3_2_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-2374C3270.02,-2374 3428.86,-2374 3428.86,-2374"/>
<polygon fill="red" stroke="red" points="3428.86,-2377.5 3438.86,-2374 3428.86,-2370.5 3428.86,-2377.5"/>
</g>
<!-- ring_attn_3_1_stage_11&#45;&gt;ring_attn_3_1_stage_12 -->
<g id="edge184" class="edge">
<title>ring_attn_3_1_stage_11&#45;&gt;ring_attn_3_1_stage_12</title>
<path fill="none" stroke="black" d="M3061,-2052.87C3061,-2052.87 3061,-1946.25 3061,-1946.25"/>
<polygon fill="black" stroke="black" points="3064.5,-1946.25 3061,-1936.25 3057.5,-1946.25 3064.5,-1946.25"/>
</g>
<!-- ring_attn_3_2_stage_11 -->
<g id="node283" class="node">
<title>ring_attn_3_2_stage_11</title>
<polygon fill="yellow" stroke="black" points="3648,-2189 3439,-2121 3648,-2053 3857,-2121 3648,-2189"/>
<text text-anchor="middle" x="3648" y="-2139.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-2124.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="3648" y="-2109.8" font-family="Times,serif" font-size="14.00">Q[2]×K[7]×V[7]</text>
<text text-anchor="middle" x="3648" y="-2094.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_1_stage_11&#45;&gt;ring_attn_3_2_stage_11 -->
<g id="edge1781" class="edge">
<title>ring_attn_3_1_stage_11&#45;&gt;ring_attn_3_2_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-2121C3270.02,-2121 3428.86,-2121 3428.86,-2121"/>
<polygon fill="red" stroke="red" points="3428.86,-2124.5 3438.86,-2121 3428.86,-2117.5 3428.86,-2124.5"/>
</g>
<!-- ring_attn_3_1_stage_12&#45;&gt;ring_attn_3_1_stage_13 -->
<g id="edge185" class="edge">
<title>ring_attn_3_1_stage_12&#45;&gt;ring_attn_3_1_stage_13</title>
<path fill="none" stroke="black" d="M3061,-1799.87C3061,-1799.87 3061,-1693.25 3061,-1693.25"/>
<polygon fill="black" stroke="black" points="3064.5,-1693.25 3061,-1683.25 3057.5,-1693.25 3064.5,-1693.25"/>
</g>
<!-- ring_attn_3_2_stage_12 -->
<g id="node284" class="node">
<title>ring_attn_3_2_stage_12</title>
<polygon fill="yellow" stroke="black" points="3648,-1936 3439,-1868 3648,-1800 3857,-1868 3648,-1936"/>
<text text-anchor="middle" x="3648" y="-1886.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-1871.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="3648" y="-1856.8" font-family="Times,serif" font-size="14.00">Q[2]×K[6]×V[6]</text>
<text text-anchor="middle" x="3648" y="-1841.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_1_stage_12&#45;&gt;ring_attn_3_2_stage_12 -->
<g id="edge1782" class="edge">
<title>ring_attn_3_1_stage_12&#45;&gt;ring_attn_3_2_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-1868C3270.02,-1868 3428.86,-1868 3428.86,-1868"/>
<polygon fill="red" stroke="red" points="3428.86,-1871.5 3438.86,-1868 3428.86,-1864.5 3428.86,-1871.5"/>
</g>
<!-- ring_attn_3_1_stage_13&#45;&gt;ring_attn_3_1_stage_14 -->
<g id="edge186" class="edge">
<title>ring_attn_3_1_stage_13&#45;&gt;ring_attn_3_1_stage_14</title>
<path fill="none" stroke="black" d="M3061,-1546.87C3061,-1546.87 3061,-1440.25 3061,-1440.25"/>
<polygon fill="black" stroke="black" points="3064.5,-1440.25 3061,-1430.25 3057.5,-1440.25 3064.5,-1440.25"/>
</g>
<!-- ring_attn_3_2_stage_13 -->
<g id="node285" class="node">
<title>ring_attn_3_2_stage_13</title>
<polygon fill="yellow" stroke="black" points="3648,-1683 3439,-1615 3648,-1547 3857,-1615 3648,-1683"/>
<text text-anchor="middle" x="3648" y="-1633.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-1618.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="3648" y="-1603.8" font-family="Times,serif" font-size="14.00">Q[2]×K[5]×V[5]</text>
<text text-anchor="middle" x="3648" y="-1588.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_1_stage_13&#45;&gt;ring_attn_3_2_stage_13 -->
<g id="edge1783" class="edge">
<title>ring_attn_3_1_stage_13&#45;&gt;ring_attn_3_2_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-1615C3270.02,-1615 3428.86,-1615 3428.86,-1615"/>
<polygon fill="red" stroke="red" points="3428.86,-1618.5 3438.86,-1615 3428.86,-1611.5 3428.86,-1618.5"/>
</g>
<!-- ring_attn_3_1_stage_14&#45;&gt;ring_attn_3_1_stage_15 -->
<g id="edge187" class="edge">
<title>ring_attn_3_1_stage_14&#45;&gt;ring_attn_3_1_stage_15</title>
<path fill="none" stroke="black" d="M3061,-1293.87C3061,-1293.87 3061,-1187.25 3061,-1187.25"/>
<polygon fill="black" stroke="black" points="3064.5,-1187.25 3061,-1177.25 3057.5,-1187.25 3064.5,-1187.25"/>
</g>
<!-- ring_attn_3_2_stage_14 -->
<g id="node286" class="node">
<title>ring_attn_3_2_stage_14</title>
<polygon fill="yellow" stroke="black" points="3648,-1430 3439,-1362 3648,-1294 3857,-1362 3648,-1430"/>
<text text-anchor="middle" x="3648" y="-1380.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-1365.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="3648" y="-1350.8" font-family="Times,serif" font-size="14.00">Q[2]×K[4]×V[4]</text>
<text text-anchor="middle" x="3648" y="-1335.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_1_stage_14&#45;&gt;ring_attn_3_2_stage_14 -->
<g id="edge1784" class="edge">
<title>ring_attn_3_1_stage_14&#45;&gt;ring_attn_3_2_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-1362C3270.02,-1362 3428.86,-1362 3428.86,-1362"/>
<polygon fill="red" stroke="red" points="3428.86,-1365.5 3438.86,-1362 3428.86,-1358.5 3428.86,-1365.5"/>
</g>
<!-- attn_out_3_1 -->
<g id="node190" class="node">
<title>attn_out_3_1</title>
<polygon fill="none" stroke="black" points="3130.5,-968 2991.5,-968 2991.5,-915 3130.5,-915 3130.5,-968"/>
<text text-anchor="middle" x="3061" y="-952.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="3061" y="-937.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="3061" y="-922.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_3_1_stage_15&#45;&gt;attn_out_3_1 -->
<g id="edge188" class="edge">
<title>ring_attn_3_1_stage_15&#45;&gt;attn_out_3_1</title>
<path fill="none" stroke="black" d="M3061,-1040.87C3061,-1040.87 3061,-978.18 3061,-978.18"/>
<polygon fill="black" stroke="black" points="3064.5,-978.18 3061,-968.18 3057.5,-978.18 3064.5,-978.18"/>
</g>
<!-- ring_attn_3_2_stage_15 -->
<g id="node287" class="node">
<title>ring_attn_3_2_stage_15</title>
<polygon fill="yellow" stroke="black" points="3648,-1177 3439,-1109 3648,-1041 3857,-1109 3648,-1177"/>
<text text-anchor="middle" x="3648" y="-1127.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="3648" y="-1112.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="3648" y="-1097.8" font-family="Times,serif" font-size="14.00">Q[2]×K[3]×V[3]</text>
<text text-anchor="middle" x="3648" y="-1082.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_1_stage_15&#45;&gt;ring_attn_3_2_stage_15 -->
<g id="edge1785" class="edge">
<title>ring_attn_3_1_stage_15&#45;&gt;ring_attn_3_2_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3270.02,-1109C3270.02,-1109 3428.86,-1109 3428.86,-1109"/>
<polygon fill="red" stroke="red" points="3428.86,-1112.5 3438.86,-1109 3428.86,-1105.5 3428.86,-1112.5"/>
</g>
<!-- attn_residual_3_1 -->
<g id="node191" class="node">
<title>attn_residual_3_1</title>
<ellipse fill="none" stroke="black" cx="3061" cy="-815" rx="105.5" ry="27"/>
<text text-anchor="middle" x="3061" y="-818.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="3061" y="-803.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_3_1&#45;&gt;attn_residual_3_1 -->
<g id="edge189" class="edge">
<title>attn_out_3_1&#45;&gt;attn_residual_3_1</title>
<path fill="none" stroke="black" d="M3061,-914.98C3061,-914.98 3061,-852.36 3061,-852.36"/>
<polygon fill="black" stroke="black" points="3064.5,-852.36 3061,-842.36 3057.5,-852.36 3064.5,-852.36"/>
</g>
<!-- gate_3_1 -->
<g id="node192" class="node">
<title>gate_3_1</title>
<ellipse fill="orange" stroke="black" cx="3061" cy="-677.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="3061" y="-688.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="3061" y="-673.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="3061" y="-658.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_3_1&#45;&gt;gate_3_1 -->
<g id="edge190" class="edge">
<title>attn_residual_3_1&#45;&gt;gate_3_1</title>
<path fill="none" stroke="black" d="M3025.83,-789.46C3025.83,-789.46 3025.83,-723.01 3025.83,-723.01"/>
<polygon fill="black" stroke="black" points="3029.33,-723.01 3025.83,-713.01 3022.33,-723.01 3029.33,-723.01"/>
</g>
<!-- gate_3_1&#45;&gt;expert_3_0_0 -->
<g id="edge1786" class="edge">
<title>gate_3_1&#45;&gt;expert_3_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M2961.27,-690C2470.82,-690 338.21,-690 338.21,-690 338.21,-690 338.21,-518.33 338.21,-518.33"/>
<polygon fill="blue" stroke="blue" points="341.71,-518.33 338.21,-508.33 334.71,-518.33 341.71,-518.33"/>
<text text-anchor="middle" x="11606.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="11606.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU1→GPU0</text>
<text text-anchor="middle" x="11606.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="11606.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_1&#45;&gt;expert_3_1_0 -->
<g id="edge191" class="edge">
<title>gate_3_1&#45;&gt;expert_3_1_0</title>
<path fill="none" stroke="black" d="M2965.09,-661.79C2965.09,-661.79 2965.09,-518.33 2965.09,-518.33"/>
<polygon fill="black" stroke="black" points="2968.59,-518.33 2965.09,-508.33 2961.59,-518.33 2968.59,-518.33"/>
</g>
<!-- gate_3_1&#45;&gt;expert_3_2_0 -->
<g id="edge1787" class="edge">
<title>gate_3_1&#45;&gt;expert_3_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3160.52,-665C3299.74,-665 3535.75,-665 3535.75,-665 3535.75,-665 3535.75,-518.18 3535.75,-518.18"/>
<polygon fill="blue" stroke="blue" points="3539.25,-518.18 3535.75,-508.18 3532.25,-518.18 3539.25,-518.18"/>
<text text-anchor="middle" x="11780.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="11780.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU1→GPU2</text>
<text text-anchor="middle" x="11780.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="11780.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_1&#45;&gt;expert_3_3_0 -->
<g id="edge1788" class="edge">
<title>gate_3_1&#45;&gt;expert_3_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3051.41,-639.91C3051.41,-638.09 3051.41,-637 3051.41,-637 3051.41,-637 4120.5,-637 4120.5,-637 4120.5,-637 4120.5,-518.23 4120.5,-518.23"/>
<polygon fill="blue" stroke="blue" points="4124,-518.23 4120.5,-508.23 4117,-518.23 4124,-518.23"/>
<text text-anchor="middle" x="11954.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="11954.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU1→GPU3</text>
<text text-anchor="middle" x="11954.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="11954.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_1&#45;&gt;expert_3_4_0 -->
<g id="edge1789" class="edge">
<title>gate_3_1&#45;&gt;expert_3_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3061,-639.82C3061,-628.01 3061,-618 3061,-618 3061,-618 4705.7,-618 4705.7,-618 4705.7,-618 4705.7,-518.14 4705.7,-518.14"/>
<polygon fill="blue" stroke="blue" points="4709.2,-518.14 4705.7,-508.14 4702.2,-518.14 4709.2,-518.14"/>
<text text-anchor="middle" x="12128.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12128.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU1→GPU4</text>
<text text-anchor="middle" x="12128.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12128.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_1&#45;&gt;expert_3_5_0 -->
<g id="edge1790" class="edge">
<title>gate_3_1&#45;&gt;expert_3_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3070.59,-639.98C3070.59,-625.79 3070.59,-613 3070.59,-613 3070.59,-613 5343.69,-613 5343.69,-613 5343.69,-613 5343.69,-518.11 5343.69,-518.11"/>
<polygon fill="blue" stroke="blue" points="5347.19,-518.11 5343.69,-508.11 5340.19,-518.11 5347.19,-518.11"/>
<text text-anchor="middle" x="12302.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12302.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU1→GPU5</text>
<text text-anchor="middle" x="12302.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12302.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_1&#45;&gt;expert_3_6_0 -->
<g id="edge1791" class="edge">
<title>gate_3_1&#45;&gt;expert_3_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3080.18,-640.6C3080.18,-623.54 3080.18,-607 3080.18,-607 3080.18,-607 5911.6,-607 5911.6,-607 5911.6,-607 5911.6,-518.12 5911.6,-518.12"/>
<polygon fill="blue" stroke="blue" points="5915.1,-518.12 5911.6,-508.12 5908.1,-518.12 5915.1,-518.12"/>
<text text-anchor="middle" x="12476.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12476.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU1→GPU6</text>
<text text-anchor="middle" x="12476.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12476.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_1&#45;&gt;expert_3_7_0 -->
<g id="edge1792" class="edge">
<title>gate_3_1&#45;&gt;expert_3_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3089.77,-641.34C3089.77,-609.45 3089.77,-568 3089.77,-568 3089.77,-568 6497.6,-568 6497.6,-568 6497.6,-568 6497.6,-518.39 6497.6,-518.39"/>
<polygon fill="blue" stroke="blue" points="6501.1,-518.39 6497.6,-508.39 6494.1,-518.4 6501.1,-518.39"/>
<text text-anchor="middle" x="12650.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12650.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU1→GPU7</text>
<text text-anchor="middle" x="12650.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12650.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_1&#45;&gt;expert_3_8_0 -->
<g id="edge1793" class="edge">
<title>gate_3_1&#45;&gt;expert_3_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3099.36,-642.27C3099.36,-607.34 3099.36,-559 3099.36,-559 3099.36,-559 7082.85,-559 7082.85,-559 7082.85,-559 7082.85,-518.17 7082.85,-518.17"/>
<polygon fill="blue" stroke="blue" points="7086.35,-518.17 7082.85,-508.17 7079.35,-518.17 7086.35,-518.17"/>
<text text-anchor="middle" x="12824.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12824.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU1→GPU8</text>
<text text-anchor="middle" x="12824.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12824.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_1&#45;&gt;expert_3_9_0 -->
<g id="edge1794" class="edge">
<title>gate_3_1&#45;&gt;expert_3_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3108.95,-643.93C3108.95,-608.28 3108.95,-557 3108.95,-557 3108.95,-557 7661.09,-557 7661.09,-557 7661.09,-557 7661.09,-518.33 7661.09,-518.33"/>
<polygon fill="blue" stroke="blue" points="7664.59,-518.33 7661.09,-508.33 7657.59,-518.33 7664.59,-518.33"/>
<text text-anchor="middle" x="12998.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="12998.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU1→GPU9</text>
<text text-anchor="middle" x="12998.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="12998.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_1&#45;&gt;expert_3_10_0 -->
<g id="edge1795" class="edge">
<title>gate_3_1&#45;&gt;expert_3_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3096.17,-713C3096.17,-720.4 3096.17,-726 3096.17,-726 3096.17,-726 8235.8,-726 8235.8,-726 8235.8,-726 8235.8,-518.13 8235.8,-518.13"/>
<polygon fill="blue" stroke="blue" points="8239.3,-518.13 8235.8,-508.13 8232.3,-518.13 8239.3,-518.13"/>
<text text-anchor="middle" x="13172.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="13172.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU1→GPU10</text>
<text text-anchor="middle" x="13172.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="13172.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_1&#45;&gt;expert_3_11_0 -->
<g id="edge1796" class="edge">
<title>gate_3_1&#45;&gt;expert_3_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3118.55,-645.78C3118.55,-598.49 3118.55,-515 3118.55,-515 3118.55,-515 8586.8,-515 8586.8,-515 8586.8,-515 8586.8,-490 8586.8,-490 8586.8,-490 8801.58,-490 8801.58,-490"/>
<polygon fill="blue" stroke="blue" points="8801.58,-493.5 8811.58,-490 8801.58,-486.5 8801.58,-493.5"/>
<text text-anchor="middle" x="13346.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="13346.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU1→GPU11</text>
<text text-anchor="middle" x="13346.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="13346.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_1&#45;&gt;expert_3_12_0 -->
<g id="edge1797" class="edge">
<title>gate_3_1&#45;&gt;expert_3_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3128.14,-648.46C3128.14,-606.53 3128.14,-534 3128.14,-534 3128.14,-534 9430.85,-534 9430.85,-534 9430.85,-534 9430.85,-518.06 9430.85,-518.06"/>
<polygon fill="blue" stroke="blue" points="9434.35,-518.06 9430.85,-508.06 9427.35,-518.06 9434.35,-518.06"/>
<text text-anchor="middle" x="13520.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="13520.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU1→GPU12</text>
<text text-anchor="middle" x="13520.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="13520.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_1&#45;&gt;expert_3_13_0 -->
<g id="edge1798" class="edge">
<title>gate_3_1&#45;&gt;expert_3_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3137.73,-651.47C3137.73,-609.13 3137.73,-530 3137.73,-530 3137.73,-530 10033.26,-530 10033.26,-530 10033.26,-530 10033.26,-518.02 10033.26,-518.02"/>
<polygon fill="blue" stroke="blue" points="10036.76,-518.02 10033.26,-508.02 10029.76,-518.02 10036.76,-518.02"/>
<text text-anchor="middle" x="13694.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="13694.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU1→GPU13</text>
<text text-anchor="middle" x="13694.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="13694.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_1&#45;&gt;expert_3_14_0 -->
<g id="edge1799" class="edge">
<title>gate_3_1&#45;&gt;expert_3_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3147.32,-655.79C3147.32,-613.9 3147.32,-526 3147.32,-526 3147.32,-526 10626.69,-526 10626.69,-526 10626.69,-526 10626.69,-518.16 10626.69,-518.16"/>
<polygon fill="blue" stroke="blue" points="10630.19,-518.16 10626.69,-508.16 10623.19,-518.16 10630.19,-518.16"/>
<text text-anchor="middle" x="13868.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="13868.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU1→GPU14</text>
<text text-anchor="middle" x="13868.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="13868.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_1&#45;&gt;expert_3_15_0 -->
<g id="edge1800" class="edge">
<title>gate_3_1&#45;&gt;expert_3_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3156.91,-661.84C3156.91,-622.56 3156.91,-523 3156.91,-523 3156.91,-523 11217.92,-523 11217.92,-523 11217.92,-523 11217.92,-518.02 11217.92,-518.02"/>
<polygon fill="blue" stroke="blue" points="11221.42,-518.02 11217.92,-508.02 11214.42,-518.02 11221.42,-518.02"/>
<text text-anchor="middle" x="14042.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14042.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU1→GPU15</text>
<text text-anchor="middle" x="14042.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14042.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_1 -->
<g id="node194" class="node">
<title>expert_reduce_3_1</title>
<ellipse fill="none" stroke="black" cx="3061" cy="-344.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="3061" y="-355.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="3061" y="-340.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="3061" y="-325.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_1_0&#45;&gt;expert_reduce_3_1 -->
<g id="edge192" class="edge">
<title>expert_3_1_0&#45;&gt;expert_reduce_3_1</title>
<path fill="none" stroke="black" d="M3061,-454.76C3061,-454.76 3061,-392.06 3061,-392.06"/>
<polygon fill="black" stroke="black" points="3064.5,-392.06 3061,-382.06 3057.5,-392.06 3064.5,-392.06"/>
</g>
<!-- moe_residual_3_1 -->
<g id="node195" class="node">
<title>moe_residual_3_1</title>
<ellipse fill="none" stroke="black" cx="3061" cy="-207" rx="105.5" ry="27"/>
<text text-anchor="middle" x="3061" y="-210.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="3061" y="-195.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_1&#45;&gt;moe_residual_3_1 -->
<g id="edge193" class="edge">
<title>expert_reduce_3_1&#45;&gt;moe_residual_3_1</title>
<path fill="none" stroke="black" d="M3061,-306.93C3061,-306.93 3061,-244.06 3061,-244.06"/>
<polygon fill="black" stroke="black" points="3064.5,-244.06 3061,-234.06 3057.5,-244.06 3064.5,-244.06"/>
</g>
<!-- output_1 -->
<g id="node196" class="node">
<title>output_1</title>
<polygon fill="lightcoral" stroke="black" points="3154,-107 2968,-107 2968,-69 3154,-69 3154,-107"/>
<text text-anchor="middle" x="3061" y="-91.8" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="3061" y="-76.8" font-family="Times,serif" font-size="14.00">Y[1]: 1024×1024×4096</text>
</g>
<!-- moe_residual_3_1&#45;&gt;output_1 -->
<g id="edge194" class="edge">
<title>moe_residual_3_1&#45;&gt;output_1</title>
<path fill="none" stroke="black" d="M3061,-180C3061,-180 3061,-117.12 3061,-117.12"/>
<polygon fill="black" stroke="black" points="3064.5,-117.12 3061,-107.12 3057.5,-117.12 3064.5,-117.12"/>
</g>
<!-- input_2 -->
<g id="node197" class="node">
<title>input_2</title>
<polygon fill="lightgreen" stroke="black" points="3741.5,-20866 3554.5,-20866 3554.5,-20828 3741.5,-20828 3741.5,-20866"/>
<text text-anchor="middle" x="3648" y="-20850.8" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="3648" y="-20835.8" font-family="Times,serif" font-size="14.00">X[2]: 1024×1024×4096</text>
</g>
<!-- qkv_proj_0_2 -->
<g id="node198" class="node">
<title>qkv_proj_0_2</title>
<polygon fill="none" stroke="black" points="3730.5,-20755 3565.5,-20755 3565.5,-20702 3730.5,-20702 3730.5,-20755"/>
<text text-anchor="middle" x="3648" y="-20739.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="3648" y="-20724.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="3648" y="-20709.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- input_2&#45;&gt;qkv_proj_0_2 -->
<g id="edge195" class="edge">
<title>input_2&#45;&gt;qkv_proj_0_2</title>
<path fill="none" stroke="black" d="M3648,-20827.96C3648,-20827.96 3648,-20765.44 3648,-20765.44"/>
<polygon fill="black" stroke="black" points="3651.5,-20765.44 3648,-20755.44 3644.5,-20765.44 3651.5,-20765.44"/>
</g>
<!-- qkv_reshape_0_2 -->
<g id="node199" class="node">
<title>qkv_reshape_0_2</title>
<ellipse fill="none" stroke="black" cx="3648" cy="-20602" rx="148" ry="27"/>
<text text-anchor="middle" x="3648" y="-20605.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="3648" y="-20590.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_0_2&#45;&gt;qkv_reshape_0_2 -->
<g id="edge196" class="edge">
<title>qkv_proj_0_2&#45;&gt;qkv_reshape_0_2</title>
<path fill="none" stroke="black" d="M3648,-20701.98C3648,-20701.98 3648,-20639.36 3648,-20639.36"/>
<polygon fill="black" stroke="black" points="3651.5,-20639.36 3648,-20629.36 3644.5,-20639.36 3651.5,-20639.36"/>
</g>
<!-- qkv_reshape_0_2&#45;&gt;ring_attn_0_2_stage_0 -->
<g id="edge197" class="edge">
<title>qkv_reshape_0_2&#45;&gt;ring_attn_0_2_stage_0</title>
<path fill="none" stroke="black" d="M3648,-20574.72C3648,-20574.72 3648,-20468.16 3648,-20468.16"/>
<polygon fill="black" stroke="black" points="3651.5,-20468.16 3648,-20458.16 3644.5,-20468.16 3651.5,-20468.16"/>
</g>
<!-- ring_attn_0_2_stage_0&#45;&gt;ring_attn_0_2_stage_1 -->
<g id="edge198" class="edge">
<title>ring_attn_0_2_stage_0&#45;&gt;ring_attn_0_2_stage_1</title>
<path fill="none" stroke="black" d="M3648,-20321.87C3648,-20321.87 3648,-20215.25 3648,-20215.25"/>
<polygon fill="black" stroke="black" points="3651.5,-20215.25 3648,-20205.25 3644.5,-20215.25 3651.5,-20215.25"/>
</g>
<!-- ring_attn_0_3_stage_0 -->
<g id="node298" class="node">
<title>ring_attn_0_3_stage_0</title>
<polygon fill="yellow" stroke="black" points="4235,-20458 4026,-20390 4235,-20322 4444,-20390 4235,-20458"/>
<text text-anchor="middle" x="4235" y="-20408.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-20393.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="4235" y="-20378.8" font-family="Times,serif" font-size="14.00">Q[3]×K[3]×V[3]</text>
<text text-anchor="middle" x="4235" y="-20363.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_2_stage_0&#45;&gt;ring_attn_0_3_stage_0 -->
<g id="edge1801" class="edge">
<title>ring_attn_0_2_stage_0&#45;&gt;ring_attn_0_3_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-20390C3857.02,-20390 4015.86,-20390 4015.86,-20390"/>
<polygon fill="red" stroke="red" points="4015.86,-20393.5 4025.86,-20390 4015.86,-20386.5 4015.86,-20393.5"/>
</g>
<!-- ring_attn_0_2_stage_1&#45;&gt;ring_attn_0_2_stage_2 -->
<g id="edge199" class="edge">
<title>ring_attn_0_2_stage_1&#45;&gt;ring_attn_0_2_stage_2</title>
<path fill="none" stroke="black" d="M3648,-20068.87C3648,-20068.87 3648,-19962.25 3648,-19962.25"/>
<polygon fill="black" stroke="black" points="3651.5,-19962.25 3648,-19952.25 3644.5,-19962.25 3651.5,-19962.25"/>
</g>
<!-- ring_attn_0_3_stage_1 -->
<g id="node299" class="node">
<title>ring_attn_0_3_stage_1</title>
<polygon fill="yellow" stroke="black" points="4235,-20205 4026,-20137 4235,-20069 4444,-20137 4235,-20205"/>
<text text-anchor="middle" x="4235" y="-20155.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-20140.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="4235" y="-20125.8" font-family="Times,serif" font-size="14.00">Q[3]×K[2]×V[2]</text>
<text text-anchor="middle" x="4235" y="-20110.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_2_stage_1&#45;&gt;ring_attn_0_3_stage_1 -->
<g id="edge1802" class="edge">
<title>ring_attn_0_2_stage_1&#45;&gt;ring_attn_0_3_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-20137C3857.02,-20137 4015.86,-20137 4015.86,-20137"/>
<polygon fill="red" stroke="red" points="4015.86,-20140.5 4025.86,-20137 4015.86,-20133.5 4015.86,-20140.5"/>
</g>
<!-- ring_attn_0_2_stage_2&#45;&gt;ring_attn_0_2_stage_3 -->
<g id="edge200" class="edge">
<title>ring_attn_0_2_stage_2&#45;&gt;ring_attn_0_2_stage_3</title>
<path fill="none" stroke="black" d="M3648,-19815.87C3648,-19815.87 3648,-19709.25 3648,-19709.25"/>
<polygon fill="black" stroke="black" points="3651.5,-19709.25 3648,-19699.25 3644.5,-19709.25 3651.5,-19709.25"/>
</g>
<!-- ring_attn_0_3_stage_2 -->
<g id="node300" class="node">
<title>ring_attn_0_3_stage_2</title>
<polygon fill="yellow" stroke="black" points="4235,-19952 4026,-19884 4235,-19816 4444,-19884 4235,-19952"/>
<text text-anchor="middle" x="4235" y="-19902.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-19887.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="4235" y="-19872.8" font-family="Times,serif" font-size="14.00">Q[3]×K[1]×V[1]</text>
<text text-anchor="middle" x="4235" y="-19857.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_2_stage_2&#45;&gt;ring_attn_0_3_stage_2 -->
<g id="edge1803" class="edge">
<title>ring_attn_0_2_stage_2&#45;&gt;ring_attn_0_3_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-19884C3857.02,-19884 4015.86,-19884 4015.86,-19884"/>
<polygon fill="red" stroke="red" points="4015.86,-19887.5 4025.86,-19884 4015.86,-19880.5 4015.86,-19887.5"/>
</g>
<!-- ring_attn_0_2_stage_3&#45;&gt;ring_attn_0_2_stage_4 -->
<g id="edge201" class="edge">
<title>ring_attn_0_2_stage_3&#45;&gt;ring_attn_0_2_stage_4</title>
<path fill="none" stroke="black" d="M3648,-19562.87C3648,-19562.87 3648,-19456.25 3648,-19456.25"/>
<polygon fill="black" stroke="black" points="3651.5,-19456.25 3648,-19446.25 3644.5,-19456.25 3651.5,-19456.25"/>
</g>
<!-- ring_attn_0_3_stage_3 -->
<g id="node301" class="node">
<title>ring_attn_0_3_stage_3</title>
<polygon fill="yellow" stroke="black" points="4235,-19699 4026,-19631 4235,-19563 4444,-19631 4235,-19699"/>
<text text-anchor="middle" x="4235" y="-19649.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-19634.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="4235" y="-19619.8" font-family="Times,serif" font-size="14.00">Q[3]×K[0]×V[0]</text>
<text text-anchor="middle" x="4235" y="-19604.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_2_stage_3&#45;&gt;ring_attn_0_3_stage_3 -->
<g id="edge1804" class="edge">
<title>ring_attn_0_2_stage_3&#45;&gt;ring_attn_0_3_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-19631C3857.02,-19631 4015.86,-19631 4015.86,-19631"/>
<polygon fill="red" stroke="red" points="4015.86,-19634.5 4025.86,-19631 4015.86,-19627.5 4015.86,-19634.5"/>
</g>
<!-- ring_attn_0_2_stage_4&#45;&gt;ring_attn_0_2_stage_5 -->
<g id="edge202" class="edge">
<title>ring_attn_0_2_stage_4&#45;&gt;ring_attn_0_2_stage_5</title>
<path fill="none" stroke="black" d="M3648,-19309.87C3648,-19309.87 3648,-19203.25 3648,-19203.25"/>
<polygon fill="black" stroke="black" points="3651.5,-19203.25 3648,-19193.25 3644.5,-19203.25 3651.5,-19203.25"/>
</g>
<!-- ring_attn_0_3_stage_4 -->
<g id="node302" class="node">
<title>ring_attn_0_3_stage_4</title>
<polygon fill="yellow" stroke="black" points="4235,-19446 4026,-19378 4235,-19310 4444,-19378 4235,-19446"/>
<text text-anchor="middle" x="4235" y="-19396.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-19381.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="4235" y="-19366.8" font-family="Times,serif" font-size="14.00">Q[3]×K[15]×V[15]</text>
<text text-anchor="middle" x="4235" y="-19351.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_2_stage_4&#45;&gt;ring_attn_0_3_stage_4 -->
<g id="edge1805" class="edge">
<title>ring_attn_0_2_stage_4&#45;&gt;ring_attn_0_3_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-19378C3857.02,-19378 4015.86,-19378 4015.86,-19378"/>
<polygon fill="red" stroke="red" points="4015.86,-19381.5 4025.86,-19378 4015.86,-19374.5 4015.86,-19381.5"/>
</g>
<!-- ring_attn_0_2_stage_5&#45;&gt;ring_attn_0_2_stage_6 -->
<g id="edge203" class="edge">
<title>ring_attn_0_2_stage_5&#45;&gt;ring_attn_0_2_stage_6</title>
<path fill="none" stroke="black" d="M3648,-19056.87C3648,-19056.87 3648,-18950.25 3648,-18950.25"/>
<polygon fill="black" stroke="black" points="3651.5,-18950.25 3648,-18940.25 3644.5,-18950.25 3651.5,-18950.25"/>
</g>
<!-- ring_attn_0_3_stage_5 -->
<g id="node303" class="node">
<title>ring_attn_0_3_stage_5</title>
<polygon fill="yellow" stroke="black" points="4235,-19193 4026,-19125 4235,-19057 4444,-19125 4235,-19193"/>
<text text-anchor="middle" x="4235" y="-19143.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-19128.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="4235" y="-19113.8" font-family="Times,serif" font-size="14.00">Q[3]×K[14]×V[14]</text>
<text text-anchor="middle" x="4235" y="-19098.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_2_stage_5&#45;&gt;ring_attn_0_3_stage_5 -->
<g id="edge1806" class="edge">
<title>ring_attn_0_2_stage_5&#45;&gt;ring_attn_0_3_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-19125C3857.02,-19125 4015.86,-19125 4015.86,-19125"/>
<polygon fill="red" stroke="red" points="4015.86,-19128.5 4025.86,-19125 4015.86,-19121.5 4015.86,-19128.5"/>
</g>
<!-- ring_attn_0_2_stage_6&#45;&gt;ring_attn_0_2_stage_7 -->
<g id="edge204" class="edge">
<title>ring_attn_0_2_stage_6&#45;&gt;ring_attn_0_2_stage_7</title>
<path fill="none" stroke="black" d="M3648,-18803.87C3648,-18803.87 3648,-18697.25 3648,-18697.25"/>
<polygon fill="black" stroke="black" points="3651.5,-18697.25 3648,-18687.25 3644.5,-18697.25 3651.5,-18697.25"/>
</g>
<!-- ring_attn_0_3_stage_6 -->
<g id="node304" class="node">
<title>ring_attn_0_3_stage_6</title>
<polygon fill="yellow" stroke="black" points="4235,-18940 4026,-18872 4235,-18804 4444,-18872 4235,-18940"/>
<text text-anchor="middle" x="4235" y="-18890.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-18875.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="4235" y="-18860.8" font-family="Times,serif" font-size="14.00">Q[3]×K[13]×V[13]</text>
<text text-anchor="middle" x="4235" y="-18845.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_2_stage_6&#45;&gt;ring_attn_0_3_stage_6 -->
<g id="edge1807" class="edge">
<title>ring_attn_0_2_stage_6&#45;&gt;ring_attn_0_3_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-18872C3857.02,-18872 4015.86,-18872 4015.86,-18872"/>
<polygon fill="red" stroke="red" points="4015.86,-18875.5 4025.86,-18872 4015.86,-18868.5 4015.86,-18875.5"/>
</g>
<!-- ring_attn_0_2_stage_7&#45;&gt;ring_attn_0_2_stage_8 -->
<g id="edge205" class="edge">
<title>ring_attn_0_2_stage_7&#45;&gt;ring_attn_0_2_stage_8</title>
<path fill="none" stroke="black" d="M3648,-18550.87C3648,-18550.87 3648,-18444.25 3648,-18444.25"/>
<polygon fill="black" stroke="black" points="3651.5,-18444.25 3648,-18434.25 3644.5,-18444.25 3651.5,-18444.25"/>
</g>
<!-- ring_attn_0_3_stage_7 -->
<g id="node305" class="node">
<title>ring_attn_0_3_stage_7</title>
<polygon fill="yellow" stroke="black" points="4235,-18687 4026,-18619 4235,-18551 4444,-18619 4235,-18687"/>
<text text-anchor="middle" x="4235" y="-18637.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-18622.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="4235" y="-18607.8" font-family="Times,serif" font-size="14.00">Q[3]×K[12]×V[12]</text>
<text text-anchor="middle" x="4235" y="-18592.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_2_stage_7&#45;&gt;ring_attn_0_3_stage_7 -->
<g id="edge1808" class="edge">
<title>ring_attn_0_2_stage_7&#45;&gt;ring_attn_0_3_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-18619C3857.02,-18619 4015.86,-18619 4015.86,-18619"/>
<polygon fill="red" stroke="red" points="4015.86,-18622.5 4025.86,-18619 4015.86,-18615.5 4015.86,-18622.5"/>
</g>
<!-- ring_attn_0_2_stage_8&#45;&gt;ring_attn_0_2_stage_9 -->
<g id="edge206" class="edge">
<title>ring_attn_0_2_stage_8&#45;&gt;ring_attn_0_2_stage_9</title>
<path fill="none" stroke="black" d="M3648,-18297.87C3648,-18297.87 3648,-18191.25 3648,-18191.25"/>
<polygon fill="black" stroke="black" points="3651.5,-18191.25 3648,-18181.25 3644.5,-18191.25 3651.5,-18191.25"/>
</g>
<!-- ring_attn_0_3_stage_8 -->
<g id="node306" class="node">
<title>ring_attn_0_3_stage_8</title>
<polygon fill="yellow" stroke="black" points="4235,-18434 4026,-18366 4235,-18298 4444,-18366 4235,-18434"/>
<text text-anchor="middle" x="4235" y="-18384.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-18369.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="4235" y="-18354.8" font-family="Times,serif" font-size="14.00">Q[3]×K[11]×V[11]</text>
<text text-anchor="middle" x="4235" y="-18339.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_2_stage_8&#45;&gt;ring_attn_0_3_stage_8 -->
<g id="edge1809" class="edge">
<title>ring_attn_0_2_stage_8&#45;&gt;ring_attn_0_3_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-18366C3857.02,-18366 4015.86,-18366 4015.86,-18366"/>
<polygon fill="red" stroke="red" points="4015.86,-18369.5 4025.86,-18366 4015.86,-18362.5 4015.86,-18369.5"/>
</g>
<!-- ring_attn_0_2_stage_9&#45;&gt;ring_attn_0_2_stage_10 -->
<g id="edge207" class="edge">
<title>ring_attn_0_2_stage_9&#45;&gt;ring_attn_0_2_stage_10</title>
<path fill="none" stroke="black" d="M3648,-18044.87C3648,-18044.87 3648,-17938.25 3648,-17938.25"/>
<polygon fill="black" stroke="black" points="3651.5,-17938.25 3648,-17928.25 3644.5,-17938.25 3651.5,-17938.25"/>
</g>
<!-- ring_attn_0_3_stage_9 -->
<g id="node307" class="node">
<title>ring_attn_0_3_stage_9</title>
<polygon fill="yellow" stroke="black" points="4235,-18181 4026,-18113 4235,-18045 4444,-18113 4235,-18181"/>
<text text-anchor="middle" x="4235" y="-18131.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-18116.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="4235" y="-18101.8" font-family="Times,serif" font-size="14.00">Q[3]×K[10]×V[10]</text>
<text text-anchor="middle" x="4235" y="-18086.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_2_stage_9&#45;&gt;ring_attn_0_3_stage_9 -->
<g id="edge1810" class="edge">
<title>ring_attn_0_2_stage_9&#45;&gt;ring_attn_0_3_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-18113C3857.02,-18113 4015.86,-18113 4015.86,-18113"/>
<polygon fill="red" stroke="red" points="4015.86,-18116.5 4025.86,-18113 4015.86,-18109.5 4015.86,-18116.5"/>
</g>
<!-- ring_attn_0_2_stage_10&#45;&gt;ring_attn_0_2_stage_11 -->
<g id="edge208" class="edge">
<title>ring_attn_0_2_stage_10&#45;&gt;ring_attn_0_2_stage_11</title>
<path fill="none" stroke="black" d="M3648,-17791.87C3648,-17791.87 3648,-17685.25 3648,-17685.25"/>
<polygon fill="black" stroke="black" points="3651.5,-17685.25 3648,-17675.25 3644.5,-17685.25 3651.5,-17685.25"/>
</g>
<!-- ring_attn_0_3_stage_10 -->
<g id="node308" class="node">
<title>ring_attn_0_3_stage_10</title>
<polygon fill="yellow" stroke="black" points="4235,-17928 4026,-17860 4235,-17792 4444,-17860 4235,-17928"/>
<text text-anchor="middle" x="4235" y="-17878.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-17863.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="4235" y="-17848.8" font-family="Times,serif" font-size="14.00">Q[3]×K[9]×V[9]</text>
<text text-anchor="middle" x="4235" y="-17833.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_2_stage_10&#45;&gt;ring_attn_0_3_stage_10 -->
<g id="edge1811" class="edge">
<title>ring_attn_0_2_stage_10&#45;&gt;ring_attn_0_3_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-17860C3857.02,-17860 4015.86,-17860 4015.86,-17860"/>
<polygon fill="red" stroke="red" points="4015.86,-17863.5 4025.86,-17860 4015.86,-17856.5 4015.86,-17863.5"/>
</g>
<!-- ring_attn_0_2_stage_11&#45;&gt;ring_attn_0_2_stage_12 -->
<g id="edge209" class="edge">
<title>ring_attn_0_2_stage_11&#45;&gt;ring_attn_0_2_stage_12</title>
<path fill="none" stroke="black" d="M3648,-17538.87C3648,-17538.87 3648,-17432.25 3648,-17432.25"/>
<polygon fill="black" stroke="black" points="3651.5,-17432.25 3648,-17422.25 3644.5,-17432.25 3651.5,-17432.25"/>
</g>
<!-- ring_attn_0_3_stage_11 -->
<g id="node309" class="node">
<title>ring_attn_0_3_stage_11</title>
<polygon fill="yellow" stroke="black" points="4235,-17675 4026,-17607 4235,-17539 4444,-17607 4235,-17675"/>
<text text-anchor="middle" x="4235" y="-17625.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-17610.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="4235" y="-17595.8" font-family="Times,serif" font-size="14.00">Q[3]×K[8]×V[8]</text>
<text text-anchor="middle" x="4235" y="-17580.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_2_stage_11&#45;&gt;ring_attn_0_3_stage_11 -->
<g id="edge1812" class="edge">
<title>ring_attn_0_2_stage_11&#45;&gt;ring_attn_0_3_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-17607C3857.02,-17607 4015.86,-17607 4015.86,-17607"/>
<polygon fill="red" stroke="red" points="4015.86,-17610.5 4025.86,-17607 4015.86,-17603.5 4015.86,-17610.5"/>
</g>
<!-- ring_attn_0_2_stage_12&#45;&gt;ring_attn_0_2_stage_13 -->
<g id="edge210" class="edge">
<title>ring_attn_0_2_stage_12&#45;&gt;ring_attn_0_2_stage_13</title>
<path fill="none" stroke="black" d="M3648,-17285.87C3648,-17285.87 3648,-17179.25 3648,-17179.25"/>
<polygon fill="black" stroke="black" points="3651.5,-17179.25 3648,-17169.25 3644.5,-17179.25 3651.5,-17179.25"/>
</g>
<!-- ring_attn_0_3_stage_12 -->
<g id="node310" class="node">
<title>ring_attn_0_3_stage_12</title>
<polygon fill="yellow" stroke="black" points="4235,-17422 4026,-17354 4235,-17286 4444,-17354 4235,-17422"/>
<text text-anchor="middle" x="4235" y="-17372.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-17357.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="4235" y="-17342.8" font-family="Times,serif" font-size="14.00">Q[3]×K[7]×V[7]</text>
<text text-anchor="middle" x="4235" y="-17327.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_2_stage_12&#45;&gt;ring_attn_0_3_stage_12 -->
<g id="edge1813" class="edge">
<title>ring_attn_0_2_stage_12&#45;&gt;ring_attn_0_3_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-17354C3857.02,-17354 4015.86,-17354 4015.86,-17354"/>
<polygon fill="red" stroke="red" points="4015.86,-17357.5 4025.86,-17354 4015.86,-17350.5 4015.86,-17357.5"/>
</g>
<!-- ring_attn_0_2_stage_13&#45;&gt;ring_attn_0_2_stage_14 -->
<g id="edge211" class="edge">
<title>ring_attn_0_2_stage_13&#45;&gt;ring_attn_0_2_stage_14</title>
<path fill="none" stroke="black" d="M3648,-17032.87C3648,-17032.87 3648,-16926.25 3648,-16926.25"/>
<polygon fill="black" stroke="black" points="3651.5,-16926.25 3648,-16916.25 3644.5,-16926.25 3651.5,-16926.25"/>
</g>
<!-- ring_attn_0_3_stage_13 -->
<g id="node311" class="node">
<title>ring_attn_0_3_stage_13</title>
<polygon fill="yellow" stroke="black" points="4235,-17169 4026,-17101 4235,-17033 4444,-17101 4235,-17169"/>
<text text-anchor="middle" x="4235" y="-17119.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-17104.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="4235" y="-17089.8" font-family="Times,serif" font-size="14.00">Q[3]×K[6]×V[6]</text>
<text text-anchor="middle" x="4235" y="-17074.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_2_stage_13&#45;&gt;ring_attn_0_3_stage_13 -->
<g id="edge1814" class="edge">
<title>ring_attn_0_2_stage_13&#45;&gt;ring_attn_0_3_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-17101C3857.02,-17101 4015.86,-17101 4015.86,-17101"/>
<polygon fill="red" stroke="red" points="4015.86,-17104.5 4025.86,-17101 4015.86,-17097.5 4015.86,-17104.5"/>
</g>
<!-- ring_attn_0_2_stage_14&#45;&gt;ring_attn_0_2_stage_15 -->
<g id="edge212" class="edge">
<title>ring_attn_0_2_stage_14&#45;&gt;ring_attn_0_2_stage_15</title>
<path fill="none" stroke="black" d="M3648,-16779.87C3648,-16779.87 3648,-16673.25 3648,-16673.25"/>
<polygon fill="black" stroke="black" points="3651.5,-16673.25 3648,-16663.25 3644.5,-16673.25 3651.5,-16673.25"/>
</g>
<!-- ring_attn_0_3_stage_14 -->
<g id="node312" class="node">
<title>ring_attn_0_3_stage_14</title>
<polygon fill="yellow" stroke="black" points="4235,-16916 4026,-16848 4235,-16780 4444,-16848 4235,-16916"/>
<text text-anchor="middle" x="4235" y="-16866.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-16851.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="4235" y="-16836.8" font-family="Times,serif" font-size="14.00">Q[3]×K[5]×V[5]</text>
<text text-anchor="middle" x="4235" y="-16821.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_2_stage_14&#45;&gt;ring_attn_0_3_stage_14 -->
<g id="edge1815" class="edge">
<title>ring_attn_0_2_stage_14&#45;&gt;ring_attn_0_3_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-16848C3857.02,-16848 4015.86,-16848 4015.86,-16848"/>
<polygon fill="red" stroke="red" points="4015.86,-16851.5 4025.86,-16848 4015.86,-16844.5 4015.86,-16851.5"/>
</g>
<!-- attn_out_0_2 -->
<g id="node216" class="node">
<title>attn_out_0_2</title>
<polygon fill="none" stroke="black" points="3717.5,-16454 3578.5,-16454 3578.5,-16401 3717.5,-16401 3717.5,-16454"/>
<text text-anchor="middle" x="3648" y="-16438.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="3648" y="-16423.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="3648" y="-16408.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_0_2_stage_15&#45;&gt;attn_out_0_2 -->
<g id="edge213" class="edge">
<title>ring_attn_0_2_stage_15&#45;&gt;attn_out_0_2</title>
<path fill="none" stroke="black" d="M3648,-16526.87C3648,-16526.87 3648,-16464.18 3648,-16464.18"/>
<polygon fill="black" stroke="black" points="3651.5,-16464.18 3648,-16454.18 3644.5,-16464.18 3651.5,-16464.18"/>
</g>
<!-- ring_attn_0_3_stage_15 -->
<g id="node313" class="node">
<title>ring_attn_0_3_stage_15</title>
<polygon fill="yellow" stroke="black" points="4235,-16663 4026,-16595 4235,-16527 4444,-16595 4235,-16663"/>
<text text-anchor="middle" x="4235" y="-16613.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-16598.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="4235" y="-16583.8" font-family="Times,serif" font-size="14.00">Q[3]×K[4]×V[4]</text>
<text text-anchor="middle" x="4235" y="-16568.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_2_stage_15&#45;&gt;ring_attn_0_3_stage_15 -->
<g id="edge1816" class="edge">
<title>ring_attn_0_2_stage_15&#45;&gt;ring_attn_0_3_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-16595C3857.02,-16595 4015.86,-16595 4015.86,-16595"/>
<polygon fill="red" stroke="red" points="4015.86,-16598.5 4025.86,-16595 4015.86,-16591.5 4015.86,-16598.5"/>
</g>
<!-- attn_residual_0_2 -->
<g id="node217" class="node">
<title>attn_residual_0_2</title>
<ellipse fill="none" stroke="black" cx="3648" cy="-16301" rx="105.5" ry="27"/>
<text text-anchor="middle" x="3648" y="-16304.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="3648" y="-16289.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_0_2&#45;&gt;attn_residual_0_2 -->
<g id="edge214" class="edge">
<title>attn_out_0_2&#45;&gt;attn_residual_0_2</title>
<path fill="none" stroke="black" d="M3648,-16400.98C3648,-16400.98 3648,-16338.36 3648,-16338.36"/>
<polygon fill="black" stroke="black" points="3651.5,-16338.36 3648,-16328.36 3644.5,-16338.36 3651.5,-16338.36"/>
</g>
<!-- gate_0_2 -->
<g id="node218" class="node">
<title>gate_0_2</title>
<ellipse fill="orange" stroke="black" cx="3648" cy="-16163.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="3648" y="-16174.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="3648" y="-16159.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="3648" y="-16144.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_0_2&#45;&gt;gate_0_2 -->
<g id="edge215" class="edge">
<title>attn_residual_0_2&#45;&gt;gate_0_2</title>
<path fill="none" stroke="black" d="M3648,-16273.83C3648,-16273.83 3648,-16211.02 3648,-16211.02"/>
<polygon fill="black" stroke="black" points="3651.5,-16211.02 3648,-16201.02 3644.5,-16211.02 3651.5,-16211.02"/>
</g>
<!-- gate_0_2&#45;&gt;expert_0_0_0 -->
<g id="edge1817" class="edge">
<title>gate_0_2&#45;&gt;expert_0_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3550.31,-16148.99C3550.31,-16137.02 3550.31,-16122 3550.31,-16122 3550.31,-16122 340.14,-16122 340.14,-16122 340.14,-16122 340.14,-16004.06 340.14,-16004.06"/>
<polygon fill="blue" stroke="blue" points="343.64,-16004.06 340.14,-15994.06 336.64,-16004.06 343.64,-16004.06"/>
<text text-anchor="middle" x="14216.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14216.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU2→GPU0</text>
<text text-anchor="middle" x="14216.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14216.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_2&#45;&gt;expert_0_1_0 -->
<g id="edge1818" class="edge">
<title>gate_0_2&#45;&gt;expert_0_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3548.39,-16176C3409.42,-16176 3174.21,-16176 3174.21,-16176 3174.21,-16176 3174.21,-16004.33 3174.21,-16004.33"/>
<polygon fill="blue" stroke="blue" points="3177.71,-16004.33 3174.21,-15994.33 3170.71,-16004.33 3177.71,-16004.33"/>
<text text-anchor="middle" x="14390.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14390.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU2→GPU1</text>
<text text-anchor="middle" x="14390.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14390.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_2&#45;&gt;expert_0_2_0 -->
<g id="edge216" class="edge">
<title>gate_0_2&#45;&gt;expert_0_2_0</title>
<path fill="none" stroke="black" d="M3565.94,-16139.86C3565.94,-16139.86 3565.94,-16004.04 3565.94,-16004.04"/>
<polygon fill="black" stroke="black" points="3569.44,-16004.04 3565.94,-15994.04 3562.44,-16004.04 3569.44,-16004.04"/>
</g>
<!-- gate_0_2&#45;&gt;expert_0_3_0 -->
<g id="edge1819" class="edge">
<title>gate_0_2&#45;&gt;expert_0_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3747.7,-16151C3887.54,-16151 4125,-16151 4125,-16151 4125,-16151 4125,-16004.18 4125,-16004.18"/>
<polygon fill="blue" stroke="blue" points="4128.5,-16004.18 4125,-15994.18 4121.5,-16004.18 4128.5,-16004.18"/>
<text text-anchor="middle" x="14564.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14564.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU2→GPU3</text>
<text text-anchor="middle" x="14564.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14564.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_2&#45;&gt;expert_0_4_0 -->
<g id="edge1820" class="edge">
<title>gate_0_2&#45;&gt;expert_0_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3659.72,-16126.16C3659.72,-16114.2 3659.72,-16104 3659.72,-16104 3659.72,-16104 4708.4,-16104 4708.4,-16104 4708.4,-16104 4708.4,-16004.14 4708.4,-16004.14"/>
<polygon fill="blue" stroke="blue" points="4711.9,-16004.14 4708.4,-15994.14 4704.9,-16004.14 4711.9,-16004.14"/>
<text text-anchor="middle" x="14738.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14738.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU2→GPU4</text>
<text text-anchor="middle" x="14738.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14738.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_2&#45;&gt;expert_0_5_0 -->
<g id="edge1821" class="edge">
<title>gate_0_2&#45;&gt;expert_0_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3667.54,-16126.33C3667.54,-16076.98 3667.54,-15996 3667.54,-15996 3667.54,-15996 5293.38,-15996 5293.38,-15996 5293.38,-15996 5293.38,-15995.81 5293.38,-15995.81"/>
<polygon fill="blue" stroke="blue" points="5296.88,-16004.13 5293.38,-15994.13 5289.88,-16004.13 5296.88,-16004.13"/>
<text text-anchor="middle" x="14912.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14912.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU2→GPU5</text>
<text text-anchor="middle" x="14912.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14912.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_2&#45;&gt;expert_0_6_0 -->
<g id="edge1822" class="edge">
<title>gate_0_2&#45;&gt;expert_0_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3675.35,-16127.12C3675.35,-16110.31 3675.35,-16094 3675.35,-16094 3675.35,-16094 5932.7,-16094 5932.7,-16094 5932.7,-16094 5932.7,-16004.02 5932.7,-16004.02"/>
<polygon fill="blue" stroke="blue" points="5936.2,-16004.02 5932.7,-15994.02 5929.2,-16004.02 5936.2,-16004.02"/>
<text text-anchor="middle" x="15086.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15086.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU2→GPU6</text>
<text text-anchor="middle" x="15086.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15086.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_2&#45;&gt;expert_0_7_0 -->
<g id="edge1823" class="edge">
<title>gate_0_2&#45;&gt;expert_0_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3683.17,-16128C3683.17,-16108.81 3683.17,-16089 3683.17,-16089 3683.17,-16089 6517.69,-16089 6517.69,-16089 6517.69,-16089 6517.69,-16004.16 6517.69,-16004.16"/>
<polygon fill="blue" stroke="blue" points="6521.19,-16004.16 6517.69,-15994.16 6514.19,-16004.16 6521.19,-16004.16"/>
<text text-anchor="middle" x="15260.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15260.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU2→GPU7</text>
<text text-anchor="middle" x="15260.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15260.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_2&#45;&gt;expert_0_8_0 -->
<g id="edge1824" class="edge">
<title>gate_0_2&#45;&gt;expert_0_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3690.98,-16129.18C3690.98,-16094.81 3690.98,-16047 3690.98,-16047 3690.98,-16047 7101.2,-16047 7101.2,-16047 7101.2,-16047 7101.2,-16004.42 7101.2,-16004.42"/>
<polygon fill="blue" stroke="blue" points="7104.7,-16004.42 7101.2,-15994.42 7097.7,-16004.42 7104.7,-16004.42"/>
<text text-anchor="middle" x="15434.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15434.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU2→GPU8</text>
<text text-anchor="middle" x="15434.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15434.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_2&#45;&gt;expert_0_9_0 -->
<g id="edge1825" class="edge">
<title>gate_0_2&#45;&gt;expert_0_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3698.8,-16130.53C3698.8,-16095.16 3698.8,-16044 3698.8,-16044 3698.8,-16044 7680.27,-16044 7680.27,-16044 7680.27,-16044 7680.27,-16004.26 7680.27,-16004.26"/>
<polygon fill="blue" stroke="blue" points="7683.77,-16004.26 7680.27,-15994.26 7676.77,-16004.26 7683.77,-16004.26"/>
<text text-anchor="middle" x="15608.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15608.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU2→GPU9</text>
<text text-anchor="middle" x="15608.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15608.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_2&#45;&gt;expert_0_10_0 -->
<g id="edge1826" class="edge">
<title>gate_0_2&#45;&gt;expert_0_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3706.61,-16132.17C3706.61,-16084.44 3706.61,-15999 3706.61,-15999 3706.61,-15999 8258.6,-15999 8258.6,-15999 8258.6,-15999 8258.6,-15998.51 8258.6,-15998.51"/>
<polygon fill="blue" stroke="blue" points="8262.1,-16004.08 8258.6,-15994.08 8255.1,-16004.08 8262.1,-16004.08"/>
<text text-anchor="middle" x="15782.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15782.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU2→GPU10</text>
<text text-anchor="middle" x="15782.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15782.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_2&#45;&gt;expert_0_11_0 -->
<g id="edge1827" class="edge">
<title>gate_0_2&#45;&gt;expert_0_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3714.43,-16134.11C3714.43,-16095.91 3714.43,-16034 3714.43,-16034 3714.43,-16034 8845.6,-16034 8845.6,-16034 8845.6,-16034 8845.6,-16004.16 8845.6,-16004.16"/>
<polygon fill="blue" stroke="blue" points="8849.1,-16004.16 8845.6,-15994.16 8842.1,-16004.16 8849.1,-16004.16"/>
<text text-anchor="middle" x="15956.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15956.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU2→GPU11</text>
<text text-anchor="middle" x="15956.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15956.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_2&#45;&gt;expert_0_12_0 -->
<g id="edge1828" class="edge">
<title>gate_0_2&#45;&gt;expert_0_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3722.24,-16136.74C3722.24,-16095.98 3722.24,-16023 3722.24,-16023 3722.24,-16023 9449.2,-16023 9449.2,-16023 9449.2,-16023 9449.2,-16004.27 9449.2,-16004.27"/>
<polygon fill="blue" stroke="blue" points="9452.7,-16004.27 9449.2,-15994.27 9445.7,-16004.27 9452.7,-16004.27"/>
<text text-anchor="middle" x="16130.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="16130.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU2→GPU12</text>
<text text-anchor="middle" x="16130.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="16130.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_2&#45;&gt;expert_0_13_0 -->
<g id="edge1829" class="edge">
<title>gate_0_2&#45;&gt;expert_0_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3730.06,-16139.64C3730.06,-16098.12 3730.06,-16017 3730.06,-16017 3730.06,-16017 10050.14,-16017 10050.14,-16017 10050.14,-16017 10050.14,-16004.28 10050.14,-16004.28"/>
<polygon fill="blue" stroke="blue" points="10053.64,-16004.28 10050.14,-15994.28 10046.64,-16004.28 10053.64,-16004.28"/>
<text text-anchor="middle" x="16304.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="16304.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU2→GPU13</text>
<text text-anchor="middle" x="16304.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="16304.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_2&#45;&gt;expert_0_14_0 -->
<g id="edge1830" class="edge">
<title>gate_0_2&#45;&gt;expert_0_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3737.87,-16143.69C3737.87,-16102.63 3737.87,-16012 3737.87,-16012 3737.87,-16012 10646.79,-16012 10646.79,-16012 10646.79,-16012 10646.79,-16004.16 10646.79,-16004.16"/>
<polygon fill="blue" stroke="blue" points="10650.29,-16004.16 10646.79,-15994.16 10643.29,-16004.16 10650.29,-16004.16"/>
<text text-anchor="middle" x="16478.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="16478.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU2→GPU14</text>
<text text-anchor="middle" x="16478.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="16478.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_2&#45;&gt;expert_0_15_0 -->
<g id="edge1831" class="edge">
<title>gate_0_2&#45;&gt;expert_0_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3745.69,-16149.33C3745.69,-16111.33 3745.69,-16010 3745.69,-16010 3745.69,-16010 11240.13,-16010 11240.13,-16010 11240.13,-16010 11240.13,-16004.17 11240.13,-16004.17"/>
<polygon fill="blue" stroke="blue" points="11243.63,-16004.17 11240.13,-15994.17 11236.63,-16004.17 11243.63,-16004.17"/>
<text text-anchor="middle" x="16652.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="16652.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU2→GPU15</text>
<text text-anchor="middle" x="16652.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="16652.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_2 -->
<g id="node220" class="node">
<title>expert_reduce_0_2</title>
<ellipse fill="none" stroke="black" cx="3648" cy="-15830.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="3648" y="-15841.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="3648" y="-15826.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="3648" y="-15811.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_2_0&#45;&gt;expert_reduce_0_2 -->
<g id="edge217" class="edge">
<title>expert_0_2_0&#45;&gt;expert_reduce_0_2</title>
<path fill="none" stroke="black" d="M3648,-15940.76C3648,-15940.76 3648,-15878.06 3648,-15878.06"/>
<polygon fill="black" stroke="black" points="3651.5,-15878.06 3648,-15868.06 3644.5,-15878.06 3651.5,-15878.06"/>
</g>
<!-- moe_residual_0_2 -->
<g id="node221" class="node">
<title>moe_residual_0_2</title>
<ellipse fill="none" stroke="black" cx="3648" cy="-15693" rx="105.5" ry="27"/>
<text text-anchor="middle" x="3648" y="-15696.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="3648" y="-15681.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_2&#45;&gt;moe_residual_0_2 -->
<g id="edge218" class="edge">
<title>expert_reduce_0_2&#45;&gt;moe_residual_0_2</title>
<path fill="none" stroke="black" d="M3648,-15792.93C3648,-15792.93 3648,-15730.06 3648,-15730.06"/>
<polygon fill="black" stroke="black" points="3651.5,-15730.06 3648,-15720.06 3644.5,-15730.06 3651.5,-15730.06"/>
</g>
<!-- qkv_proj_1_2 -->
<g id="node222" class="node">
<title>qkv_proj_1_2</title>
<polygon fill="none" stroke="black" points="3730.5,-15593 3565.5,-15593 3565.5,-15540 3730.5,-15540 3730.5,-15593"/>
<text text-anchor="middle" x="3648" y="-15577.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="3648" y="-15562.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="3648" y="-15547.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_0_2&#45;&gt;qkv_proj_1_2 -->
<g id="edge219" class="edge">
<title>moe_residual_0_2&#45;&gt;qkv_proj_1_2</title>
<path fill="none" stroke="black" d="M3648,-15665.86C3648,-15665.86 3648,-15603.16 3648,-15603.16"/>
<polygon fill="black" stroke="black" points="3651.5,-15603.16 3648,-15593.16 3644.5,-15603.16 3651.5,-15603.16"/>
</g>
<!-- qkv_reshape_1_2 -->
<g id="node223" class="node">
<title>qkv_reshape_1_2</title>
<ellipse fill="none" stroke="black" cx="3648" cy="-15440" rx="148" ry="27"/>
<text text-anchor="middle" x="3648" y="-15443.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="3648" y="-15428.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_1_2&#45;&gt;qkv_reshape_1_2 -->
<g id="edge220" class="edge">
<title>qkv_proj_1_2&#45;&gt;qkv_reshape_1_2</title>
<path fill="none" stroke="black" d="M3648,-15539.98C3648,-15539.98 3648,-15477.36 3648,-15477.36"/>
<polygon fill="black" stroke="black" points="3651.5,-15477.36 3648,-15467.36 3644.5,-15477.36 3651.5,-15477.36"/>
</g>
<!-- qkv_reshape_1_2&#45;&gt;ring_attn_1_2_stage_0 -->
<g id="edge221" class="edge">
<title>qkv_reshape_1_2&#45;&gt;ring_attn_1_2_stage_0</title>
<path fill="none" stroke="black" d="M3648,-15412.72C3648,-15412.72 3648,-15306.16 3648,-15306.16"/>
<polygon fill="black" stroke="black" points="3651.5,-15306.16 3648,-15296.16 3644.5,-15306.16 3651.5,-15306.16"/>
</g>
<!-- ring_attn_1_2_stage_0&#45;&gt;ring_attn_1_2_stage_1 -->
<g id="edge222" class="edge">
<title>ring_attn_1_2_stage_0&#45;&gt;ring_attn_1_2_stage_1</title>
<path fill="none" stroke="black" d="M3648,-15159.87C3648,-15159.87 3648,-15053.25 3648,-15053.25"/>
<polygon fill="black" stroke="black" points="3651.5,-15053.25 3648,-15043.25 3644.5,-15053.25 3651.5,-15053.25"/>
</g>
<!-- ring_attn_1_3_stage_0 -->
<g id="node322" class="node">
<title>ring_attn_1_3_stage_0</title>
<polygon fill="yellow" stroke="black" points="4235,-15296 4026,-15228 4235,-15160 4444,-15228 4235,-15296"/>
<text text-anchor="middle" x="4235" y="-15246.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-15231.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="4235" y="-15216.8" font-family="Times,serif" font-size="14.00">Q[3]×K[3]×V[3]</text>
<text text-anchor="middle" x="4235" y="-15201.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_2_stage_0&#45;&gt;ring_attn_1_3_stage_0 -->
<g id="edge1832" class="edge">
<title>ring_attn_1_2_stage_0&#45;&gt;ring_attn_1_3_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-15228C3857.02,-15228 4015.86,-15228 4015.86,-15228"/>
<polygon fill="red" stroke="red" points="4015.86,-15231.5 4025.86,-15228 4015.86,-15224.5 4015.86,-15231.5"/>
</g>
<!-- ring_attn_1_2_stage_1&#45;&gt;ring_attn_1_2_stage_2 -->
<g id="edge223" class="edge">
<title>ring_attn_1_2_stage_1&#45;&gt;ring_attn_1_2_stage_2</title>
<path fill="none" stroke="black" d="M3648,-14906.87C3648,-14906.87 3648,-14800.25 3648,-14800.25"/>
<polygon fill="black" stroke="black" points="3651.5,-14800.25 3648,-14790.25 3644.5,-14800.25 3651.5,-14800.25"/>
</g>
<!-- ring_attn_1_3_stage_1 -->
<g id="node323" class="node">
<title>ring_attn_1_3_stage_1</title>
<polygon fill="yellow" stroke="black" points="4235,-15043 4026,-14975 4235,-14907 4444,-14975 4235,-15043"/>
<text text-anchor="middle" x="4235" y="-14993.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-14978.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="4235" y="-14963.8" font-family="Times,serif" font-size="14.00">Q[3]×K[2]×V[2]</text>
<text text-anchor="middle" x="4235" y="-14948.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_2_stage_1&#45;&gt;ring_attn_1_3_stage_1 -->
<g id="edge1833" class="edge">
<title>ring_attn_1_2_stage_1&#45;&gt;ring_attn_1_3_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-14975C3857.02,-14975 4015.86,-14975 4015.86,-14975"/>
<polygon fill="red" stroke="red" points="4015.86,-14978.5 4025.86,-14975 4015.86,-14971.5 4015.86,-14978.5"/>
</g>
<!-- ring_attn_1_2_stage_2&#45;&gt;ring_attn_1_2_stage_3 -->
<g id="edge224" class="edge">
<title>ring_attn_1_2_stage_2&#45;&gt;ring_attn_1_2_stage_3</title>
<path fill="none" stroke="black" d="M3648,-14653.87C3648,-14653.87 3648,-14547.25 3648,-14547.25"/>
<polygon fill="black" stroke="black" points="3651.5,-14547.25 3648,-14537.25 3644.5,-14547.25 3651.5,-14547.25"/>
</g>
<!-- ring_attn_1_3_stage_2 -->
<g id="node324" class="node">
<title>ring_attn_1_3_stage_2</title>
<polygon fill="yellow" stroke="black" points="4235,-14790 4026,-14722 4235,-14654 4444,-14722 4235,-14790"/>
<text text-anchor="middle" x="4235" y="-14740.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-14725.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="4235" y="-14710.8" font-family="Times,serif" font-size="14.00">Q[3]×K[1]×V[1]</text>
<text text-anchor="middle" x="4235" y="-14695.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_2_stage_2&#45;&gt;ring_attn_1_3_stage_2 -->
<g id="edge1834" class="edge">
<title>ring_attn_1_2_stage_2&#45;&gt;ring_attn_1_3_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-14722C3857.02,-14722 4015.86,-14722 4015.86,-14722"/>
<polygon fill="red" stroke="red" points="4015.86,-14725.5 4025.86,-14722 4015.86,-14718.5 4015.86,-14725.5"/>
</g>
<!-- ring_attn_1_2_stage_3&#45;&gt;ring_attn_1_2_stage_4 -->
<g id="edge225" class="edge">
<title>ring_attn_1_2_stage_3&#45;&gt;ring_attn_1_2_stage_4</title>
<path fill="none" stroke="black" d="M3648,-14400.87C3648,-14400.87 3648,-14294.25 3648,-14294.25"/>
<polygon fill="black" stroke="black" points="3651.5,-14294.25 3648,-14284.25 3644.5,-14294.25 3651.5,-14294.25"/>
</g>
<!-- ring_attn_1_3_stage_3 -->
<g id="node325" class="node">
<title>ring_attn_1_3_stage_3</title>
<polygon fill="yellow" stroke="black" points="4235,-14537 4026,-14469 4235,-14401 4444,-14469 4235,-14537"/>
<text text-anchor="middle" x="4235" y="-14487.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-14472.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="4235" y="-14457.8" font-family="Times,serif" font-size="14.00">Q[3]×K[0]×V[0]</text>
<text text-anchor="middle" x="4235" y="-14442.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_2_stage_3&#45;&gt;ring_attn_1_3_stage_3 -->
<g id="edge1835" class="edge">
<title>ring_attn_1_2_stage_3&#45;&gt;ring_attn_1_3_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-14469C3857.02,-14469 4015.86,-14469 4015.86,-14469"/>
<polygon fill="red" stroke="red" points="4015.86,-14472.5 4025.86,-14469 4015.86,-14465.5 4015.86,-14472.5"/>
</g>
<!-- ring_attn_1_2_stage_4&#45;&gt;ring_attn_1_2_stage_5 -->
<g id="edge226" class="edge">
<title>ring_attn_1_2_stage_4&#45;&gt;ring_attn_1_2_stage_5</title>
<path fill="none" stroke="black" d="M3648,-14147.87C3648,-14147.87 3648,-14041.25 3648,-14041.25"/>
<polygon fill="black" stroke="black" points="3651.5,-14041.25 3648,-14031.25 3644.5,-14041.25 3651.5,-14041.25"/>
</g>
<!-- ring_attn_1_3_stage_4 -->
<g id="node326" class="node">
<title>ring_attn_1_3_stage_4</title>
<polygon fill="yellow" stroke="black" points="4235,-14284 4026,-14216 4235,-14148 4444,-14216 4235,-14284"/>
<text text-anchor="middle" x="4235" y="-14234.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-14219.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="4235" y="-14204.8" font-family="Times,serif" font-size="14.00">Q[3]×K[15]×V[15]</text>
<text text-anchor="middle" x="4235" y="-14189.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_2_stage_4&#45;&gt;ring_attn_1_3_stage_4 -->
<g id="edge1836" class="edge">
<title>ring_attn_1_2_stage_4&#45;&gt;ring_attn_1_3_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-14216C3857.02,-14216 4015.86,-14216 4015.86,-14216"/>
<polygon fill="red" stroke="red" points="4015.86,-14219.5 4025.86,-14216 4015.86,-14212.5 4015.86,-14219.5"/>
</g>
<!-- ring_attn_1_2_stage_5&#45;&gt;ring_attn_1_2_stage_6 -->
<g id="edge227" class="edge">
<title>ring_attn_1_2_stage_5&#45;&gt;ring_attn_1_2_stage_6</title>
<path fill="none" stroke="black" d="M3648,-13894.87C3648,-13894.87 3648,-13788.25 3648,-13788.25"/>
<polygon fill="black" stroke="black" points="3651.5,-13788.25 3648,-13778.25 3644.5,-13788.25 3651.5,-13788.25"/>
</g>
<!-- ring_attn_1_3_stage_5 -->
<g id="node327" class="node">
<title>ring_attn_1_3_stage_5</title>
<polygon fill="yellow" stroke="black" points="4235,-14031 4026,-13963 4235,-13895 4444,-13963 4235,-14031"/>
<text text-anchor="middle" x="4235" y="-13981.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-13966.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="4235" y="-13951.8" font-family="Times,serif" font-size="14.00">Q[3]×K[14]×V[14]</text>
<text text-anchor="middle" x="4235" y="-13936.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_2_stage_5&#45;&gt;ring_attn_1_3_stage_5 -->
<g id="edge1837" class="edge">
<title>ring_attn_1_2_stage_5&#45;&gt;ring_attn_1_3_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-13963C3857.02,-13963 4015.86,-13963 4015.86,-13963"/>
<polygon fill="red" stroke="red" points="4015.86,-13966.5 4025.86,-13963 4015.86,-13959.5 4015.86,-13966.5"/>
</g>
<!-- ring_attn_1_2_stage_6&#45;&gt;ring_attn_1_2_stage_7 -->
<g id="edge228" class="edge">
<title>ring_attn_1_2_stage_6&#45;&gt;ring_attn_1_2_stage_7</title>
<path fill="none" stroke="black" d="M3648,-13641.87C3648,-13641.87 3648,-13535.25 3648,-13535.25"/>
<polygon fill="black" stroke="black" points="3651.5,-13535.25 3648,-13525.25 3644.5,-13535.25 3651.5,-13535.25"/>
</g>
<!-- ring_attn_1_3_stage_6 -->
<g id="node328" class="node">
<title>ring_attn_1_3_stage_6</title>
<polygon fill="yellow" stroke="black" points="4235,-13778 4026,-13710 4235,-13642 4444,-13710 4235,-13778"/>
<text text-anchor="middle" x="4235" y="-13728.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-13713.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="4235" y="-13698.8" font-family="Times,serif" font-size="14.00">Q[3]×K[13]×V[13]</text>
<text text-anchor="middle" x="4235" y="-13683.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_2_stage_6&#45;&gt;ring_attn_1_3_stage_6 -->
<g id="edge1838" class="edge">
<title>ring_attn_1_2_stage_6&#45;&gt;ring_attn_1_3_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-13710C3857.02,-13710 4015.86,-13710 4015.86,-13710"/>
<polygon fill="red" stroke="red" points="4015.86,-13713.5 4025.86,-13710 4015.86,-13706.5 4015.86,-13713.5"/>
</g>
<!-- ring_attn_1_2_stage_7&#45;&gt;ring_attn_1_2_stage_8 -->
<g id="edge229" class="edge">
<title>ring_attn_1_2_stage_7&#45;&gt;ring_attn_1_2_stage_8</title>
<path fill="none" stroke="black" d="M3648,-13388.87C3648,-13388.87 3648,-13282.25 3648,-13282.25"/>
<polygon fill="black" stroke="black" points="3651.5,-13282.25 3648,-13272.25 3644.5,-13282.25 3651.5,-13282.25"/>
</g>
<!-- ring_attn_1_3_stage_7 -->
<g id="node329" class="node">
<title>ring_attn_1_3_stage_7</title>
<polygon fill="yellow" stroke="black" points="4235,-13525 4026,-13457 4235,-13389 4444,-13457 4235,-13525"/>
<text text-anchor="middle" x="4235" y="-13475.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-13460.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="4235" y="-13445.8" font-family="Times,serif" font-size="14.00">Q[3]×K[12]×V[12]</text>
<text text-anchor="middle" x="4235" y="-13430.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_2_stage_7&#45;&gt;ring_attn_1_3_stage_7 -->
<g id="edge1839" class="edge">
<title>ring_attn_1_2_stage_7&#45;&gt;ring_attn_1_3_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-13457C3857.02,-13457 4015.86,-13457 4015.86,-13457"/>
<polygon fill="red" stroke="red" points="4015.86,-13460.5 4025.86,-13457 4015.86,-13453.5 4015.86,-13460.5"/>
</g>
<!-- ring_attn_1_2_stage_8&#45;&gt;ring_attn_1_2_stage_9 -->
<g id="edge230" class="edge">
<title>ring_attn_1_2_stage_8&#45;&gt;ring_attn_1_2_stage_9</title>
<path fill="none" stroke="black" d="M3648,-13135.87C3648,-13135.87 3648,-13029.25 3648,-13029.25"/>
<polygon fill="black" stroke="black" points="3651.5,-13029.25 3648,-13019.25 3644.5,-13029.25 3651.5,-13029.25"/>
</g>
<!-- ring_attn_1_3_stage_8 -->
<g id="node330" class="node">
<title>ring_attn_1_3_stage_8</title>
<polygon fill="yellow" stroke="black" points="4235,-13272 4026,-13204 4235,-13136 4444,-13204 4235,-13272"/>
<text text-anchor="middle" x="4235" y="-13222.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-13207.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="4235" y="-13192.8" font-family="Times,serif" font-size="14.00">Q[3]×K[11]×V[11]</text>
<text text-anchor="middle" x="4235" y="-13177.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_2_stage_8&#45;&gt;ring_attn_1_3_stage_8 -->
<g id="edge1840" class="edge">
<title>ring_attn_1_2_stage_8&#45;&gt;ring_attn_1_3_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-13204C3857.02,-13204 4015.86,-13204 4015.86,-13204"/>
<polygon fill="red" stroke="red" points="4015.86,-13207.5 4025.86,-13204 4015.86,-13200.5 4015.86,-13207.5"/>
</g>
<!-- ring_attn_1_2_stage_9&#45;&gt;ring_attn_1_2_stage_10 -->
<g id="edge231" class="edge">
<title>ring_attn_1_2_stage_9&#45;&gt;ring_attn_1_2_stage_10</title>
<path fill="none" stroke="black" d="M3648,-12882.87C3648,-12882.87 3648,-12776.25 3648,-12776.25"/>
<polygon fill="black" stroke="black" points="3651.5,-12776.25 3648,-12766.25 3644.5,-12776.25 3651.5,-12776.25"/>
</g>
<!-- ring_attn_1_3_stage_9 -->
<g id="node331" class="node">
<title>ring_attn_1_3_stage_9</title>
<polygon fill="yellow" stroke="black" points="4235,-13019 4026,-12951 4235,-12883 4444,-12951 4235,-13019"/>
<text text-anchor="middle" x="4235" y="-12969.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-12954.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="4235" y="-12939.8" font-family="Times,serif" font-size="14.00">Q[3]×K[10]×V[10]</text>
<text text-anchor="middle" x="4235" y="-12924.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_2_stage_9&#45;&gt;ring_attn_1_3_stage_9 -->
<g id="edge1841" class="edge">
<title>ring_attn_1_2_stage_9&#45;&gt;ring_attn_1_3_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-12951C3857.02,-12951 4015.86,-12951 4015.86,-12951"/>
<polygon fill="red" stroke="red" points="4015.86,-12954.5 4025.86,-12951 4015.86,-12947.5 4015.86,-12954.5"/>
</g>
<!-- ring_attn_1_2_stage_10&#45;&gt;ring_attn_1_2_stage_11 -->
<g id="edge232" class="edge">
<title>ring_attn_1_2_stage_10&#45;&gt;ring_attn_1_2_stage_11</title>
<path fill="none" stroke="black" d="M3648,-12629.87C3648,-12629.87 3648,-12523.25 3648,-12523.25"/>
<polygon fill="black" stroke="black" points="3651.5,-12523.25 3648,-12513.25 3644.5,-12523.25 3651.5,-12523.25"/>
</g>
<!-- ring_attn_1_3_stage_10 -->
<g id="node332" class="node">
<title>ring_attn_1_3_stage_10</title>
<polygon fill="yellow" stroke="black" points="4235,-12766 4026,-12698 4235,-12630 4444,-12698 4235,-12766"/>
<text text-anchor="middle" x="4235" y="-12716.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-12701.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="4235" y="-12686.8" font-family="Times,serif" font-size="14.00">Q[3]×K[9]×V[9]</text>
<text text-anchor="middle" x="4235" y="-12671.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_2_stage_10&#45;&gt;ring_attn_1_3_stage_10 -->
<g id="edge1842" class="edge">
<title>ring_attn_1_2_stage_10&#45;&gt;ring_attn_1_3_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-12698C3857.02,-12698 4015.86,-12698 4015.86,-12698"/>
<polygon fill="red" stroke="red" points="4015.86,-12701.5 4025.86,-12698 4015.86,-12694.5 4015.86,-12701.5"/>
</g>
<!-- ring_attn_1_2_stage_11&#45;&gt;ring_attn_1_2_stage_12 -->
<g id="edge233" class="edge">
<title>ring_attn_1_2_stage_11&#45;&gt;ring_attn_1_2_stage_12</title>
<path fill="none" stroke="black" d="M3648,-12376.87C3648,-12376.87 3648,-12270.25 3648,-12270.25"/>
<polygon fill="black" stroke="black" points="3651.5,-12270.25 3648,-12260.25 3644.5,-12270.25 3651.5,-12270.25"/>
</g>
<!-- ring_attn_1_3_stage_11 -->
<g id="node333" class="node">
<title>ring_attn_1_3_stage_11</title>
<polygon fill="yellow" stroke="black" points="4235,-12513 4026,-12445 4235,-12377 4444,-12445 4235,-12513"/>
<text text-anchor="middle" x="4235" y="-12463.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-12448.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="4235" y="-12433.8" font-family="Times,serif" font-size="14.00">Q[3]×K[8]×V[8]</text>
<text text-anchor="middle" x="4235" y="-12418.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_2_stage_11&#45;&gt;ring_attn_1_3_stage_11 -->
<g id="edge1843" class="edge">
<title>ring_attn_1_2_stage_11&#45;&gt;ring_attn_1_3_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-12445C3857.02,-12445 4015.86,-12445 4015.86,-12445"/>
<polygon fill="red" stroke="red" points="4015.86,-12448.5 4025.86,-12445 4015.86,-12441.5 4015.86,-12448.5"/>
</g>
<!-- ring_attn_1_2_stage_12&#45;&gt;ring_attn_1_2_stage_13 -->
<g id="edge234" class="edge">
<title>ring_attn_1_2_stage_12&#45;&gt;ring_attn_1_2_stage_13</title>
<path fill="none" stroke="black" d="M3648,-12123.87C3648,-12123.87 3648,-12017.25 3648,-12017.25"/>
<polygon fill="black" stroke="black" points="3651.5,-12017.25 3648,-12007.25 3644.5,-12017.25 3651.5,-12017.25"/>
</g>
<!-- ring_attn_1_3_stage_12 -->
<g id="node334" class="node">
<title>ring_attn_1_3_stage_12</title>
<polygon fill="yellow" stroke="black" points="4235,-12260 4026,-12192 4235,-12124 4444,-12192 4235,-12260"/>
<text text-anchor="middle" x="4235" y="-12210.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-12195.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="4235" y="-12180.8" font-family="Times,serif" font-size="14.00">Q[3]×K[7]×V[7]</text>
<text text-anchor="middle" x="4235" y="-12165.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_2_stage_12&#45;&gt;ring_attn_1_3_stage_12 -->
<g id="edge1844" class="edge">
<title>ring_attn_1_2_stage_12&#45;&gt;ring_attn_1_3_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-12192C3857.02,-12192 4015.86,-12192 4015.86,-12192"/>
<polygon fill="red" stroke="red" points="4015.86,-12195.5 4025.86,-12192 4015.86,-12188.5 4015.86,-12195.5"/>
</g>
<!-- ring_attn_1_2_stage_13&#45;&gt;ring_attn_1_2_stage_14 -->
<g id="edge235" class="edge">
<title>ring_attn_1_2_stage_13&#45;&gt;ring_attn_1_2_stage_14</title>
<path fill="none" stroke="black" d="M3648,-11870.87C3648,-11870.87 3648,-11764.25 3648,-11764.25"/>
<polygon fill="black" stroke="black" points="3651.5,-11764.25 3648,-11754.25 3644.5,-11764.25 3651.5,-11764.25"/>
</g>
<!-- ring_attn_1_3_stage_13 -->
<g id="node335" class="node">
<title>ring_attn_1_3_stage_13</title>
<polygon fill="yellow" stroke="black" points="4235,-12007 4026,-11939 4235,-11871 4444,-11939 4235,-12007"/>
<text text-anchor="middle" x="4235" y="-11957.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-11942.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="4235" y="-11927.8" font-family="Times,serif" font-size="14.00">Q[3]×K[6]×V[6]</text>
<text text-anchor="middle" x="4235" y="-11912.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_2_stage_13&#45;&gt;ring_attn_1_3_stage_13 -->
<g id="edge1845" class="edge">
<title>ring_attn_1_2_stage_13&#45;&gt;ring_attn_1_3_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-11939C3857.02,-11939 4015.86,-11939 4015.86,-11939"/>
<polygon fill="red" stroke="red" points="4015.86,-11942.5 4025.86,-11939 4015.86,-11935.5 4015.86,-11942.5"/>
</g>
<!-- ring_attn_1_2_stage_14&#45;&gt;ring_attn_1_2_stage_15 -->
<g id="edge236" class="edge">
<title>ring_attn_1_2_stage_14&#45;&gt;ring_attn_1_2_stage_15</title>
<path fill="none" stroke="black" d="M3648,-11617.87C3648,-11617.87 3648,-11511.25 3648,-11511.25"/>
<polygon fill="black" stroke="black" points="3651.5,-11511.25 3648,-11501.25 3644.5,-11511.25 3651.5,-11511.25"/>
</g>
<!-- ring_attn_1_3_stage_14 -->
<g id="node336" class="node">
<title>ring_attn_1_3_stage_14</title>
<polygon fill="yellow" stroke="black" points="4235,-11754 4026,-11686 4235,-11618 4444,-11686 4235,-11754"/>
<text text-anchor="middle" x="4235" y="-11704.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-11689.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="4235" y="-11674.8" font-family="Times,serif" font-size="14.00">Q[3]×K[5]×V[5]</text>
<text text-anchor="middle" x="4235" y="-11659.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_2_stage_14&#45;&gt;ring_attn_1_3_stage_14 -->
<g id="edge1846" class="edge">
<title>ring_attn_1_2_stage_14&#45;&gt;ring_attn_1_3_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-11686C3857.02,-11686 4015.86,-11686 4015.86,-11686"/>
<polygon fill="red" stroke="red" points="4015.86,-11689.5 4025.86,-11686 4015.86,-11682.5 4015.86,-11689.5"/>
</g>
<!-- attn_out_1_2 -->
<g id="node240" class="node">
<title>attn_out_1_2</title>
<polygon fill="none" stroke="black" points="3717.5,-11292 3578.5,-11292 3578.5,-11239 3717.5,-11239 3717.5,-11292"/>
<text text-anchor="middle" x="3648" y="-11276.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="3648" y="-11261.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="3648" y="-11246.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_1_2_stage_15&#45;&gt;attn_out_1_2 -->
<g id="edge237" class="edge">
<title>ring_attn_1_2_stage_15&#45;&gt;attn_out_1_2</title>
<path fill="none" stroke="black" d="M3648,-11364.87C3648,-11364.87 3648,-11302.18 3648,-11302.18"/>
<polygon fill="black" stroke="black" points="3651.5,-11302.18 3648,-11292.18 3644.5,-11302.18 3651.5,-11302.18"/>
</g>
<!-- ring_attn_1_3_stage_15 -->
<g id="node337" class="node">
<title>ring_attn_1_3_stage_15</title>
<polygon fill="yellow" stroke="black" points="4235,-11501 4026,-11433 4235,-11365 4444,-11433 4235,-11501"/>
<text text-anchor="middle" x="4235" y="-11451.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-11436.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="4235" y="-11421.8" font-family="Times,serif" font-size="14.00">Q[3]×K[4]×V[4]</text>
<text text-anchor="middle" x="4235" y="-11406.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_2_stage_15&#45;&gt;ring_attn_1_3_stage_15 -->
<g id="edge1847" class="edge">
<title>ring_attn_1_2_stage_15&#45;&gt;ring_attn_1_3_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-11433C3857.02,-11433 4015.86,-11433 4015.86,-11433"/>
<polygon fill="red" stroke="red" points="4015.86,-11436.5 4025.86,-11433 4015.86,-11429.5 4015.86,-11436.5"/>
</g>
<!-- attn_residual_1_2 -->
<g id="node241" class="node">
<title>attn_residual_1_2</title>
<ellipse fill="none" stroke="black" cx="3648" cy="-11139" rx="105.5" ry="27"/>
<text text-anchor="middle" x="3648" y="-11142.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="3648" y="-11127.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_1_2&#45;&gt;attn_residual_1_2 -->
<g id="edge238" class="edge">
<title>attn_out_1_2&#45;&gt;attn_residual_1_2</title>
<path fill="none" stroke="black" d="M3648,-11238.98C3648,-11238.98 3648,-11176.36 3648,-11176.36"/>
<polygon fill="black" stroke="black" points="3651.5,-11176.36 3648,-11166.36 3644.5,-11176.36 3651.5,-11176.36"/>
</g>
<!-- gate_1_2 -->
<g id="node242" class="node">
<title>gate_1_2</title>
<ellipse fill="orange" stroke="black" cx="3648" cy="-11001.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="3648" y="-11012.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="3648" y="-10997.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="3648" y="-10982.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_1_2&#45;&gt;gate_1_2 -->
<g id="edge239" class="edge">
<title>attn_residual_1_2&#45;&gt;gate_1_2</title>
<path fill="none" stroke="black" d="M3648,-11111.83C3648,-11111.83 3648,-11049.02 3648,-11049.02"/>
<polygon fill="black" stroke="black" points="3651.5,-11049.02 3648,-11039.02 3644.5,-11049.02 3651.5,-11049.02"/>
</g>
<!-- gate_1_2&#45;&gt;expert_1_0_0 -->
<g id="edge1848" class="edge">
<title>gate_1_2&#45;&gt;expert_1_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3550.31,-10986.99C3550.31,-10975.02 3550.31,-10960 3550.31,-10960 3550.31,-10960 340.14,-10960 340.14,-10960 340.14,-10960 340.14,-10842.06 340.14,-10842.06"/>
<polygon fill="blue" stroke="blue" points="343.64,-10842.06 340.14,-10832.06 336.64,-10842.06 343.64,-10842.06"/>
<text text-anchor="middle" x="14216.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14216.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU2→GPU0</text>
<text text-anchor="middle" x="14216.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14216.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_2&#45;&gt;expert_1_1_0 -->
<g id="edge1849" class="edge">
<title>gate_1_2&#45;&gt;expert_1_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3548.39,-11014C3409.42,-11014 3174.21,-11014 3174.21,-11014 3174.21,-11014 3174.21,-10842.33 3174.21,-10842.33"/>
<polygon fill="blue" stroke="blue" points="3177.71,-10842.33 3174.21,-10832.33 3170.71,-10842.33 3177.71,-10842.33"/>
<text text-anchor="middle" x="14390.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14390.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU2→GPU1</text>
<text text-anchor="middle" x="14390.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14390.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_2&#45;&gt;expert_1_2_0 -->
<g id="edge240" class="edge">
<title>gate_1_2&#45;&gt;expert_1_2_0</title>
<path fill="none" stroke="black" d="M3565.94,-10977.86C3565.94,-10977.86 3565.94,-10842.04 3565.94,-10842.04"/>
<polygon fill="black" stroke="black" points="3569.44,-10842.04 3565.94,-10832.04 3562.44,-10842.04 3569.44,-10842.04"/>
</g>
<!-- gate_1_2&#45;&gt;expert_1_3_0 -->
<g id="edge1850" class="edge">
<title>gate_1_2&#45;&gt;expert_1_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3747.7,-10989C3887.54,-10989 4125,-10989 4125,-10989 4125,-10989 4125,-10842.18 4125,-10842.18"/>
<polygon fill="blue" stroke="blue" points="4128.5,-10842.18 4125,-10832.18 4121.5,-10842.18 4128.5,-10842.18"/>
<text text-anchor="middle" x="14564.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14564.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU2→GPU3</text>
<text text-anchor="middle" x="14564.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14564.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_2&#45;&gt;expert_1_4_0 -->
<g id="edge1851" class="edge">
<title>gate_1_2&#45;&gt;expert_1_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3659.72,-10964.16C3659.72,-10952.2 3659.72,-10942 3659.72,-10942 3659.72,-10942 4708.4,-10942 4708.4,-10942 4708.4,-10942 4708.4,-10842.14 4708.4,-10842.14"/>
<polygon fill="blue" stroke="blue" points="4711.9,-10842.14 4708.4,-10832.14 4704.9,-10842.14 4711.9,-10842.14"/>
<text text-anchor="middle" x="14738.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14738.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU2→GPU4</text>
<text text-anchor="middle" x="14738.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14738.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_2&#45;&gt;expert_1_5_0 -->
<g id="edge1852" class="edge">
<title>gate_1_2&#45;&gt;expert_1_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3667.54,-10964.33C3667.54,-10914.98 3667.54,-10834 3667.54,-10834 3667.54,-10834 5293.38,-10834 5293.38,-10834 5293.38,-10834 5293.38,-10833.81 5293.38,-10833.81"/>
<polygon fill="blue" stroke="blue" points="5296.88,-10842.13 5293.38,-10832.13 5289.88,-10842.13 5296.88,-10842.13"/>
<text text-anchor="middle" x="14912.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14912.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU2→GPU5</text>
<text text-anchor="middle" x="14912.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14912.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_2&#45;&gt;expert_1_6_0 -->
<g id="edge1853" class="edge">
<title>gate_1_2&#45;&gt;expert_1_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3675.35,-10965.12C3675.35,-10948.31 3675.35,-10932 3675.35,-10932 3675.35,-10932 5932.7,-10932 5932.7,-10932 5932.7,-10932 5932.7,-10842.02 5932.7,-10842.02"/>
<polygon fill="blue" stroke="blue" points="5936.2,-10842.02 5932.7,-10832.02 5929.2,-10842.02 5936.2,-10842.02"/>
<text text-anchor="middle" x="15086.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15086.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU2→GPU6</text>
<text text-anchor="middle" x="15086.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15086.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_2&#45;&gt;expert_1_7_0 -->
<g id="edge1854" class="edge">
<title>gate_1_2&#45;&gt;expert_1_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3683.17,-10966C3683.17,-10946.81 3683.17,-10927 3683.17,-10927 3683.17,-10927 6517.69,-10927 6517.69,-10927 6517.69,-10927 6517.69,-10842.16 6517.69,-10842.16"/>
<polygon fill="blue" stroke="blue" points="6521.19,-10842.16 6517.69,-10832.16 6514.19,-10842.16 6521.19,-10842.16"/>
<text text-anchor="middle" x="15260.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15260.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU2→GPU7</text>
<text text-anchor="middle" x="15260.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15260.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_2&#45;&gt;expert_1_8_0 -->
<g id="edge1855" class="edge">
<title>gate_1_2&#45;&gt;expert_1_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3690.98,-10967.18C3690.98,-10932.81 3690.98,-10885 3690.98,-10885 3690.98,-10885 7101.2,-10885 7101.2,-10885 7101.2,-10885 7101.2,-10842.42 7101.2,-10842.42"/>
<polygon fill="blue" stroke="blue" points="7104.7,-10842.42 7101.2,-10832.42 7097.7,-10842.42 7104.7,-10842.42"/>
<text text-anchor="middle" x="15434.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15434.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU2→GPU8</text>
<text text-anchor="middle" x="15434.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15434.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_2&#45;&gt;expert_1_9_0 -->
<g id="edge1856" class="edge">
<title>gate_1_2&#45;&gt;expert_1_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3698.8,-10968.53C3698.8,-10933.16 3698.8,-10882 3698.8,-10882 3698.8,-10882 7680.27,-10882 7680.27,-10882 7680.27,-10882 7680.27,-10842.26 7680.27,-10842.26"/>
<polygon fill="blue" stroke="blue" points="7683.77,-10842.26 7680.27,-10832.26 7676.77,-10842.26 7683.77,-10842.26"/>
<text text-anchor="middle" x="15608.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15608.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU2→GPU9</text>
<text text-anchor="middle" x="15608.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15608.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_2&#45;&gt;expert_1_10_0 -->
<g id="edge1857" class="edge">
<title>gate_1_2&#45;&gt;expert_1_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3706.61,-10970.17C3706.61,-10922.44 3706.61,-10837 3706.61,-10837 3706.61,-10837 8258.6,-10837 8258.6,-10837 8258.6,-10837 8258.6,-10836.51 8258.6,-10836.51"/>
<polygon fill="blue" stroke="blue" points="8262.1,-10842.08 8258.6,-10832.08 8255.1,-10842.08 8262.1,-10842.08"/>
<text text-anchor="middle" x="15782.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15782.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU2→GPU10</text>
<text text-anchor="middle" x="15782.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15782.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_2&#45;&gt;expert_1_11_0 -->
<g id="edge1858" class="edge">
<title>gate_1_2&#45;&gt;expert_1_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3714.43,-10972.11C3714.43,-10933.91 3714.43,-10872 3714.43,-10872 3714.43,-10872 8845.6,-10872 8845.6,-10872 8845.6,-10872 8845.6,-10842.16 8845.6,-10842.16"/>
<polygon fill="blue" stroke="blue" points="8849.1,-10842.16 8845.6,-10832.16 8842.1,-10842.16 8849.1,-10842.16"/>
<text text-anchor="middle" x="15956.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15956.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU2→GPU11</text>
<text text-anchor="middle" x="15956.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15956.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_2&#45;&gt;expert_1_12_0 -->
<g id="edge1859" class="edge">
<title>gate_1_2&#45;&gt;expert_1_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3722.24,-10974.74C3722.24,-10933.98 3722.24,-10861 3722.24,-10861 3722.24,-10861 9449.2,-10861 9449.2,-10861 9449.2,-10861 9449.2,-10842.27 9449.2,-10842.27"/>
<polygon fill="blue" stroke="blue" points="9452.7,-10842.27 9449.2,-10832.27 9445.7,-10842.27 9452.7,-10842.27"/>
<text text-anchor="middle" x="16130.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="16130.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU2→GPU12</text>
<text text-anchor="middle" x="16130.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="16130.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_2&#45;&gt;expert_1_13_0 -->
<g id="edge1860" class="edge">
<title>gate_1_2&#45;&gt;expert_1_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3730.06,-10977.64C3730.06,-10936.12 3730.06,-10855 3730.06,-10855 3730.06,-10855 10050.14,-10855 10050.14,-10855 10050.14,-10855 10050.14,-10842.28 10050.14,-10842.28"/>
<polygon fill="blue" stroke="blue" points="10053.64,-10842.28 10050.14,-10832.28 10046.64,-10842.28 10053.64,-10842.28"/>
<text text-anchor="middle" x="16304.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="16304.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU2→GPU13</text>
<text text-anchor="middle" x="16304.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="16304.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_2&#45;&gt;expert_1_14_0 -->
<g id="edge1861" class="edge">
<title>gate_1_2&#45;&gt;expert_1_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3737.87,-10981.69C3737.87,-10940.63 3737.87,-10850 3737.87,-10850 3737.87,-10850 10646.79,-10850 10646.79,-10850 10646.79,-10850 10646.79,-10842.16 10646.79,-10842.16"/>
<polygon fill="blue" stroke="blue" points="10650.29,-10842.16 10646.79,-10832.16 10643.29,-10842.16 10650.29,-10842.16"/>
<text text-anchor="middle" x="16478.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="16478.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU2→GPU14</text>
<text text-anchor="middle" x="16478.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="16478.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_2&#45;&gt;expert_1_15_0 -->
<g id="edge1862" class="edge">
<title>gate_1_2&#45;&gt;expert_1_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3745.69,-10987.33C3745.69,-10949.33 3745.69,-10848 3745.69,-10848 3745.69,-10848 11240.13,-10848 11240.13,-10848 11240.13,-10848 11240.13,-10842.17 11240.13,-10842.17"/>
<polygon fill="blue" stroke="blue" points="11243.63,-10842.17 11240.13,-10832.17 11236.63,-10842.17 11243.63,-10842.17"/>
<text text-anchor="middle" x="16652.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="16652.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU2→GPU15</text>
<text text-anchor="middle" x="16652.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="16652.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_2 -->
<g id="node244" class="node">
<title>expert_reduce_1_2</title>
<ellipse fill="none" stroke="black" cx="3648" cy="-10668.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="3648" y="-10679.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="3648" y="-10664.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="3648" y="-10649.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_2_0&#45;&gt;expert_reduce_1_2 -->
<g id="edge241" class="edge">
<title>expert_1_2_0&#45;&gt;expert_reduce_1_2</title>
<path fill="none" stroke="black" d="M3648,-10778.76C3648,-10778.76 3648,-10716.06 3648,-10716.06"/>
<polygon fill="black" stroke="black" points="3651.5,-10716.06 3648,-10706.06 3644.5,-10716.06 3651.5,-10716.06"/>
</g>
<!-- moe_residual_1_2 -->
<g id="node245" class="node">
<title>moe_residual_1_2</title>
<ellipse fill="none" stroke="black" cx="3648" cy="-10531" rx="105.5" ry="27"/>
<text text-anchor="middle" x="3648" y="-10534.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="3648" y="-10519.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_2&#45;&gt;moe_residual_1_2 -->
<g id="edge242" class="edge">
<title>expert_reduce_1_2&#45;&gt;moe_residual_1_2</title>
<path fill="none" stroke="black" d="M3648,-10630.93C3648,-10630.93 3648,-10568.06 3648,-10568.06"/>
<polygon fill="black" stroke="black" points="3651.5,-10568.06 3648,-10558.06 3644.5,-10568.06 3651.5,-10568.06"/>
</g>
<!-- qkv_proj_2_2 -->
<g id="node246" class="node">
<title>qkv_proj_2_2</title>
<polygon fill="none" stroke="black" points="3730.5,-10431 3565.5,-10431 3565.5,-10378 3730.5,-10378 3730.5,-10431"/>
<text text-anchor="middle" x="3648" y="-10415.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="3648" y="-10400.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="3648" y="-10385.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_1_2&#45;&gt;qkv_proj_2_2 -->
<g id="edge243" class="edge">
<title>moe_residual_1_2&#45;&gt;qkv_proj_2_2</title>
<path fill="none" stroke="black" d="M3648,-10503.86C3648,-10503.86 3648,-10441.16 3648,-10441.16"/>
<polygon fill="black" stroke="black" points="3651.5,-10441.16 3648,-10431.16 3644.5,-10441.16 3651.5,-10441.16"/>
</g>
<!-- qkv_reshape_2_2 -->
<g id="node247" class="node">
<title>qkv_reshape_2_2</title>
<ellipse fill="none" stroke="black" cx="3648" cy="-10278" rx="148" ry="27"/>
<text text-anchor="middle" x="3648" y="-10281.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="3648" y="-10266.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_2_2&#45;&gt;qkv_reshape_2_2 -->
<g id="edge244" class="edge">
<title>qkv_proj_2_2&#45;&gt;qkv_reshape_2_2</title>
<path fill="none" stroke="black" d="M3648,-10377.98C3648,-10377.98 3648,-10315.36 3648,-10315.36"/>
<polygon fill="black" stroke="black" points="3651.5,-10315.36 3648,-10305.36 3644.5,-10315.36 3651.5,-10315.36"/>
</g>
<!-- qkv_reshape_2_2&#45;&gt;ring_attn_2_2_stage_0 -->
<g id="edge245" class="edge">
<title>qkv_reshape_2_2&#45;&gt;ring_attn_2_2_stage_0</title>
<path fill="none" stroke="black" d="M3648,-10250.72C3648,-10250.72 3648,-10144.16 3648,-10144.16"/>
<polygon fill="black" stroke="black" points="3651.5,-10144.16 3648,-10134.16 3644.5,-10144.16 3651.5,-10144.16"/>
</g>
<!-- ring_attn_2_2_stage_0&#45;&gt;ring_attn_2_2_stage_1 -->
<g id="edge246" class="edge">
<title>ring_attn_2_2_stage_0&#45;&gt;ring_attn_2_2_stage_1</title>
<path fill="none" stroke="black" d="M3648,-9997.87C3648,-9997.87 3648,-9891.25 3648,-9891.25"/>
<polygon fill="black" stroke="black" points="3651.5,-9891.25 3648,-9881.25 3644.5,-9891.25 3651.5,-9891.25"/>
</g>
<!-- ring_attn_2_3_stage_0 -->
<g id="node346" class="node">
<title>ring_attn_2_3_stage_0</title>
<polygon fill="yellow" stroke="black" points="4235,-10134 4026,-10066 4235,-9998 4444,-10066 4235,-10134"/>
<text text-anchor="middle" x="4235" y="-10084.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-10069.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="4235" y="-10054.8" font-family="Times,serif" font-size="14.00">Q[3]×K[3]×V[3]</text>
<text text-anchor="middle" x="4235" y="-10039.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_2_stage_0&#45;&gt;ring_attn_2_3_stage_0 -->
<g id="edge1863" class="edge">
<title>ring_attn_2_2_stage_0&#45;&gt;ring_attn_2_3_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-10066C3857.02,-10066 4015.86,-10066 4015.86,-10066"/>
<polygon fill="red" stroke="red" points="4015.86,-10069.5 4025.86,-10066 4015.86,-10062.5 4015.86,-10069.5"/>
</g>
<!-- ring_attn_2_2_stage_1&#45;&gt;ring_attn_2_2_stage_2 -->
<g id="edge247" class="edge">
<title>ring_attn_2_2_stage_1&#45;&gt;ring_attn_2_2_stage_2</title>
<path fill="none" stroke="black" d="M3648,-9744.87C3648,-9744.87 3648,-9638.25 3648,-9638.25"/>
<polygon fill="black" stroke="black" points="3651.5,-9638.25 3648,-9628.25 3644.5,-9638.25 3651.5,-9638.25"/>
</g>
<!-- ring_attn_2_3_stage_1 -->
<g id="node347" class="node">
<title>ring_attn_2_3_stage_1</title>
<polygon fill="yellow" stroke="black" points="4235,-9881 4026,-9813 4235,-9745 4444,-9813 4235,-9881"/>
<text text-anchor="middle" x="4235" y="-9831.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-9816.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="4235" y="-9801.8" font-family="Times,serif" font-size="14.00">Q[3]×K[2]×V[2]</text>
<text text-anchor="middle" x="4235" y="-9786.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_2_stage_1&#45;&gt;ring_attn_2_3_stage_1 -->
<g id="edge1864" class="edge">
<title>ring_attn_2_2_stage_1&#45;&gt;ring_attn_2_3_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-9813C3857.02,-9813 4015.86,-9813 4015.86,-9813"/>
<polygon fill="red" stroke="red" points="4015.86,-9816.5 4025.86,-9813 4015.86,-9809.5 4015.86,-9816.5"/>
</g>
<!-- ring_attn_2_2_stage_2&#45;&gt;ring_attn_2_2_stage_3 -->
<g id="edge248" class="edge">
<title>ring_attn_2_2_stage_2&#45;&gt;ring_attn_2_2_stage_3</title>
<path fill="none" stroke="black" d="M3648,-9491.87C3648,-9491.87 3648,-9385.25 3648,-9385.25"/>
<polygon fill="black" stroke="black" points="3651.5,-9385.25 3648,-9375.25 3644.5,-9385.25 3651.5,-9385.25"/>
</g>
<!-- ring_attn_2_3_stage_2 -->
<g id="node348" class="node">
<title>ring_attn_2_3_stage_2</title>
<polygon fill="yellow" stroke="black" points="4235,-9628 4026,-9560 4235,-9492 4444,-9560 4235,-9628"/>
<text text-anchor="middle" x="4235" y="-9578.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-9563.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="4235" y="-9548.8" font-family="Times,serif" font-size="14.00">Q[3]×K[1]×V[1]</text>
<text text-anchor="middle" x="4235" y="-9533.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_2_stage_2&#45;&gt;ring_attn_2_3_stage_2 -->
<g id="edge1865" class="edge">
<title>ring_attn_2_2_stage_2&#45;&gt;ring_attn_2_3_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-9560C3857.02,-9560 4015.86,-9560 4015.86,-9560"/>
<polygon fill="red" stroke="red" points="4015.86,-9563.5 4025.86,-9560 4015.86,-9556.5 4015.86,-9563.5"/>
</g>
<!-- ring_attn_2_2_stage_3&#45;&gt;ring_attn_2_2_stage_4 -->
<g id="edge249" class="edge">
<title>ring_attn_2_2_stage_3&#45;&gt;ring_attn_2_2_stage_4</title>
<path fill="none" stroke="black" d="M3648,-9238.87C3648,-9238.87 3648,-9132.25 3648,-9132.25"/>
<polygon fill="black" stroke="black" points="3651.5,-9132.25 3648,-9122.25 3644.5,-9132.25 3651.5,-9132.25"/>
</g>
<!-- ring_attn_2_3_stage_3 -->
<g id="node349" class="node">
<title>ring_attn_2_3_stage_3</title>
<polygon fill="yellow" stroke="black" points="4235,-9375 4026,-9307 4235,-9239 4444,-9307 4235,-9375"/>
<text text-anchor="middle" x="4235" y="-9325.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-9310.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="4235" y="-9295.8" font-family="Times,serif" font-size="14.00">Q[3]×K[0]×V[0]</text>
<text text-anchor="middle" x="4235" y="-9280.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_2_stage_3&#45;&gt;ring_attn_2_3_stage_3 -->
<g id="edge1866" class="edge">
<title>ring_attn_2_2_stage_3&#45;&gt;ring_attn_2_3_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-9307C3857.02,-9307 4015.86,-9307 4015.86,-9307"/>
<polygon fill="red" stroke="red" points="4015.86,-9310.5 4025.86,-9307 4015.86,-9303.5 4015.86,-9310.5"/>
</g>
<!-- ring_attn_2_2_stage_4&#45;&gt;ring_attn_2_2_stage_5 -->
<g id="edge250" class="edge">
<title>ring_attn_2_2_stage_4&#45;&gt;ring_attn_2_2_stage_5</title>
<path fill="none" stroke="black" d="M3648,-8985.87C3648,-8985.87 3648,-8879.25 3648,-8879.25"/>
<polygon fill="black" stroke="black" points="3651.5,-8879.25 3648,-8869.25 3644.5,-8879.25 3651.5,-8879.25"/>
</g>
<!-- ring_attn_2_3_stage_4 -->
<g id="node350" class="node">
<title>ring_attn_2_3_stage_4</title>
<polygon fill="yellow" stroke="black" points="4235,-9122 4026,-9054 4235,-8986 4444,-9054 4235,-9122"/>
<text text-anchor="middle" x="4235" y="-9072.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-9057.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="4235" y="-9042.8" font-family="Times,serif" font-size="14.00">Q[3]×K[15]×V[15]</text>
<text text-anchor="middle" x="4235" y="-9027.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_2_stage_4&#45;&gt;ring_attn_2_3_stage_4 -->
<g id="edge1867" class="edge">
<title>ring_attn_2_2_stage_4&#45;&gt;ring_attn_2_3_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-9054C3857.02,-9054 4015.86,-9054 4015.86,-9054"/>
<polygon fill="red" stroke="red" points="4015.86,-9057.5 4025.86,-9054 4015.86,-9050.5 4015.86,-9057.5"/>
</g>
<!-- ring_attn_2_2_stage_5&#45;&gt;ring_attn_2_2_stage_6 -->
<g id="edge251" class="edge">
<title>ring_attn_2_2_stage_5&#45;&gt;ring_attn_2_2_stage_6</title>
<path fill="none" stroke="black" d="M3648,-8732.87C3648,-8732.87 3648,-8626.25 3648,-8626.25"/>
<polygon fill="black" stroke="black" points="3651.5,-8626.25 3648,-8616.25 3644.5,-8626.25 3651.5,-8626.25"/>
</g>
<!-- ring_attn_2_3_stage_5 -->
<g id="node351" class="node">
<title>ring_attn_2_3_stage_5</title>
<polygon fill="yellow" stroke="black" points="4235,-8869 4026,-8801 4235,-8733 4444,-8801 4235,-8869"/>
<text text-anchor="middle" x="4235" y="-8819.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-8804.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="4235" y="-8789.8" font-family="Times,serif" font-size="14.00">Q[3]×K[14]×V[14]</text>
<text text-anchor="middle" x="4235" y="-8774.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_2_stage_5&#45;&gt;ring_attn_2_3_stage_5 -->
<g id="edge1868" class="edge">
<title>ring_attn_2_2_stage_5&#45;&gt;ring_attn_2_3_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-8801C3857.02,-8801 4015.86,-8801 4015.86,-8801"/>
<polygon fill="red" stroke="red" points="4015.86,-8804.5 4025.86,-8801 4015.86,-8797.5 4015.86,-8804.5"/>
</g>
<!-- ring_attn_2_2_stage_6&#45;&gt;ring_attn_2_2_stage_7 -->
<g id="edge252" class="edge">
<title>ring_attn_2_2_stage_6&#45;&gt;ring_attn_2_2_stage_7</title>
<path fill="none" stroke="black" d="M3648,-8479.87C3648,-8479.87 3648,-8373.25 3648,-8373.25"/>
<polygon fill="black" stroke="black" points="3651.5,-8373.25 3648,-8363.25 3644.5,-8373.25 3651.5,-8373.25"/>
</g>
<!-- ring_attn_2_3_stage_6 -->
<g id="node352" class="node">
<title>ring_attn_2_3_stage_6</title>
<polygon fill="yellow" stroke="black" points="4235,-8616 4026,-8548 4235,-8480 4444,-8548 4235,-8616"/>
<text text-anchor="middle" x="4235" y="-8566.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-8551.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="4235" y="-8536.8" font-family="Times,serif" font-size="14.00">Q[3]×K[13]×V[13]</text>
<text text-anchor="middle" x="4235" y="-8521.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_2_stage_6&#45;&gt;ring_attn_2_3_stage_6 -->
<g id="edge1869" class="edge">
<title>ring_attn_2_2_stage_6&#45;&gt;ring_attn_2_3_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-8548C3857.02,-8548 4015.86,-8548 4015.86,-8548"/>
<polygon fill="red" stroke="red" points="4015.86,-8551.5 4025.86,-8548 4015.86,-8544.5 4015.86,-8551.5"/>
</g>
<!-- ring_attn_2_2_stage_7&#45;&gt;ring_attn_2_2_stage_8 -->
<g id="edge253" class="edge">
<title>ring_attn_2_2_stage_7&#45;&gt;ring_attn_2_2_stage_8</title>
<path fill="none" stroke="black" d="M3648,-8226.87C3648,-8226.87 3648,-8120.25 3648,-8120.25"/>
<polygon fill="black" stroke="black" points="3651.5,-8120.25 3648,-8110.25 3644.5,-8120.25 3651.5,-8120.25"/>
</g>
<!-- ring_attn_2_3_stage_7 -->
<g id="node353" class="node">
<title>ring_attn_2_3_stage_7</title>
<polygon fill="yellow" stroke="black" points="4235,-8363 4026,-8295 4235,-8227 4444,-8295 4235,-8363"/>
<text text-anchor="middle" x="4235" y="-8313.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-8298.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="4235" y="-8283.8" font-family="Times,serif" font-size="14.00">Q[3]×K[12]×V[12]</text>
<text text-anchor="middle" x="4235" y="-8268.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_2_stage_7&#45;&gt;ring_attn_2_3_stage_7 -->
<g id="edge1870" class="edge">
<title>ring_attn_2_2_stage_7&#45;&gt;ring_attn_2_3_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-8295C3857.02,-8295 4015.86,-8295 4015.86,-8295"/>
<polygon fill="red" stroke="red" points="4015.86,-8298.5 4025.86,-8295 4015.86,-8291.5 4015.86,-8298.5"/>
</g>
<!-- ring_attn_2_2_stage_8&#45;&gt;ring_attn_2_2_stage_9 -->
<g id="edge254" class="edge">
<title>ring_attn_2_2_stage_8&#45;&gt;ring_attn_2_2_stage_9</title>
<path fill="none" stroke="black" d="M3648,-7973.87C3648,-7973.87 3648,-7867.25 3648,-7867.25"/>
<polygon fill="black" stroke="black" points="3651.5,-7867.25 3648,-7857.25 3644.5,-7867.25 3651.5,-7867.25"/>
</g>
<!-- ring_attn_2_3_stage_8 -->
<g id="node354" class="node">
<title>ring_attn_2_3_stage_8</title>
<polygon fill="yellow" stroke="black" points="4235,-8110 4026,-8042 4235,-7974 4444,-8042 4235,-8110"/>
<text text-anchor="middle" x="4235" y="-8060.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-8045.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="4235" y="-8030.8" font-family="Times,serif" font-size="14.00">Q[3]×K[11]×V[11]</text>
<text text-anchor="middle" x="4235" y="-8015.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_2_stage_8&#45;&gt;ring_attn_2_3_stage_8 -->
<g id="edge1871" class="edge">
<title>ring_attn_2_2_stage_8&#45;&gt;ring_attn_2_3_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-8042C3857.02,-8042 4015.86,-8042 4015.86,-8042"/>
<polygon fill="red" stroke="red" points="4015.86,-8045.5 4025.86,-8042 4015.86,-8038.5 4015.86,-8045.5"/>
</g>
<!-- ring_attn_2_2_stage_9&#45;&gt;ring_attn_2_2_stage_10 -->
<g id="edge255" class="edge">
<title>ring_attn_2_2_stage_9&#45;&gt;ring_attn_2_2_stage_10</title>
<path fill="none" stroke="black" d="M3648,-7720.87C3648,-7720.87 3648,-7614.25 3648,-7614.25"/>
<polygon fill="black" stroke="black" points="3651.5,-7614.25 3648,-7604.25 3644.5,-7614.25 3651.5,-7614.25"/>
</g>
<!-- ring_attn_2_3_stage_9 -->
<g id="node355" class="node">
<title>ring_attn_2_3_stage_9</title>
<polygon fill="yellow" stroke="black" points="4235,-7857 4026,-7789 4235,-7721 4444,-7789 4235,-7857"/>
<text text-anchor="middle" x="4235" y="-7807.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-7792.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="4235" y="-7777.8" font-family="Times,serif" font-size="14.00">Q[3]×K[10]×V[10]</text>
<text text-anchor="middle" x="4235" y="-7762.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_2_stage_9&#45;&gt;ring_attn_2_3_stage_9 -->
<g id="edge1872" class="edge">
<title>ring_attn_2_2_stage_9&#45;&gt;ring_attn_2_3_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-7789C3857.02,-7789 4015.86,-7789 4015.86,-7789"/>
<polygon fill="red" stroke="red" points="4015.86,-7792.5 4025.86,-7789 4015.86,-7785.5 4015.86,-7792.5"/>
</g>
<!-- ring_attn_2_2_stage_10&#45;&gt;ring_attn_2_2_stage_11 -->
<g id="edge256" class="edge">
<title>ring_attn_2_2_stage_10&#45;&gt;ring_attn_2_2_stage_11</title>
<path fill="none" stroke="black" d="M3648,-7467.87C3648,-7467.87 3648,-7361.25 3648,-7361.25"/>
<polygon fill="black" stroke="black" points="3651.5,-7361.25 3648,-7351.25 3644.5,-7361.25 3651.5,-7361.25"/>
</g>
<!-- ring_attn_2_3_stage_10 -->
<g id="node356" class="node">
<title>ring_attn_2_3_stage_10</title>
<polygon fill="yellow" stroke="black" points="4235,-7604 4026,-7536 4235,-7468 4444,-7536 4235,-7604"/>
<text text-anchor="middle" x="4235" y="-7554.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-7539.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="4235" y="-7524.8" font-family="Times,serif" font-size="14.00">Q[3]×K[9]×V[9]</text>
<text text-anchor="middle" x="4235" y="-7509.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_2_stage_10&#45;&gt;ring_attn_2_3_stage_10 -->
<g id="edge1873" class="edge">
<title>ring_attn_2_2_stage_10&#45;&gt;ring_attn_2_3_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-7536C3857.02,-7536 4015.86,-7536 4015.86,-7536"/>
<polygon fill="red" stroke="red" points="4015.86,-7539.5 4025.86,-7536 4015.86,-7532.5 4015.86,-7539.5"/>
</g>
<!-- ring_attn_2_2_stage_11&#45;&gt;ring_attn_2_2_stage_12 -->
<g id="edge257" class="edge">
<title>ring_attn_2_2_stage_11&#45;&gt;ring_attn_2_2_stage_12</title>
<path fill="none" stroke="black" d="M3648,-7214.87C3648,-7214.87 3648,-7108.25 3648,-7108.25"/>
<polygon fill="black" stroke="black" points="3651.5,-7108.25 3648,-7098.25 3644.5,-7108.25 3651.5,-7108.25"/>
</g>
<!-- ring_attn_2_3_stage_11 -->
<g id="node357" class="node">
<title>ring_attn_2_3_stage_11</title>
<polygon fill="yellow" stroke="black" points="4235,-7351 4026,-7283 4235,-7215 4444,-7283 4235,-7351"/>
<text text-anchor="middle" x="4235" y="-7301.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-7286.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="4235" y="-7271.8" font-family="Times,serif" font-size="14.00">Q[3]×K[8]×V[8]</text>
<text text-anchor="middle" x="4235" y="-7256.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_2_stage_11&#45;&gt;ring_attn_2_3_stage_11 -->
<g id="edge1874" class="edge">
<title>ring_attn_2_2_stage_11&#45;&gt;ring_attn_2_3_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-7283C3857.02,-7283 4015.86,-7283 4015.86,-7283"/>
<polygon fill="red" stroke="red" points="4015.86,-7286.5 4025.86,-7283 4015.86,-7279.5 4015.86,-7286.5"/>
</g>
<!-- ring_attn_2_2_stage_12&#45;&gt;ring_attn_2_2_stage_13 -->
<g id="edge258" class="edge">
<title>ring_attn_2_2_stage_12&#45;&gt;ring_attn_2_2_stage_13</title>
<path fill="none" stroke="black" d="M3648,-6961.87C3648,-6961.87 3648,-6855.25 3648,-6855.25"/>
<polygon fill="black" stroke="black" points="3651.5,-6855.25 3648,-6845.25 3644.5,-6855.25 3651.5,-6855.25"/>
</g>
<!-- ring_attn_2_3_stage_12 -->
<g id="node358" class="node">
<title>ring_attn_2_3_stage_12</title>
<polygon fill="yellow" stroke="black" points="4235,-7098 4026,-7030 4235,-6962 4444,-7030 4235,-7098"/>
<text text-anchor="middle" x="4235" y="-7048.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-7033.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="4235" y="-7018.8" font-family="Times,serif" font-size="14.00">Q[3]×K[7]×V[7]</text>
<text text-anchor="middle" x="4235" y="-7003.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_2_stage_12&#45;&gt;ring_attn_2_3_stage_12 -->
<g id="edge1875" class="edge">
<title>ring_attn_2_2_stage_12&#45;&gt;ring_attn_2_3_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-7030C3857.02,-7030 4015.86,-7030 4015.86,-7030"/>
<polygon fill="red" stroke="red" points="4015.86,-7033.5 4025.86,-7030 4015.86,-7026.5 4015.86,-7033.5"/>
</g>
<!-- ring_attn_2_2_stage_13&#45;&gt;ring_attn_2_2_stage_14 -->
<g id="edge259" class="edge">
<title>ring_attn_2_2_stage_13&#45;&gt;ring_attn_2_2_stage_14</title>
<path fill="none" stroke="black" d="M3648,-6708.87C3648,-6708.87 3648,-6602.25 3648,-6602.25"/>
<polygon fill="black" stroke="black" points="3651.5,-6602.25 3648,-6592.25 3644.5,-6602.25 3651.5,-6602.25"/>
</g>
<!-- ring_attn_2_3_stage_13 -->
<g id="node359" class="node">
<title>ring_attn_2_3_stage_13</title>
<polygon fill="yellow" stroke="black" points="4235,-6845 4026,-6777 4235,-6709 4444,-6777 4235,-6845"/>
<text text-anchor="middle" x="4235" y="-6795.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-6780.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="4235" y="-6765.8" font-family="Times,serif" font-size="14.00">Q[3]×K[6]×V[6]</text>
<text text-anchor="middle" x="4235" y="-6750.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_2_stage_13&#45;&gt;ring_attn_2_3_stage_13 -->
<g id="edge1876" class="edge">
<title>ring_attn_2_2_stage_13&#45;&gt;ring_attn_2_3_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-6777C3857.02,-6777 4015.86,-6777 4015.86,-6777"/>
<polygon fill="red" stroke="red" points="4015.86,-6780.5 4025.86,-6777 4015.86,-6773.5 4015.86,-6780.5"/>
</g>
<!-- ring_attn_2_2_stage_14&#45;&gt;ring_attn_2_2_stage_15 -->
<g id="edge260" class="edge">
<title>ring_attn_2_2_stage_14&#45;&gt;ring_attn_2_2_stage_15</title>
<path fill="none" stroke="black" d="M3648,-6455.87C3648,-6455.87 3648,-6349.25 3648,-6349.25"/>
<polygon fill="black" stroke="black" points="3651.5,-6349.25 3648,-6339.25 3644.5,-6349.25 3651.5,-6349.25"/>
</g>
<!-- ring_attn_2_3_stage_14 -->
<g id="node360" class="node">
<title>ring_attn_2_3_stage_14</title>
<polygon fill="yellow" stroke="black" points="4235,-6592 4026,-6524 4235,-6456 4444,-6524 4235,-6592"/>
<text text-anchor="middle" x="4235" y="-6542.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-6527.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="4235" y="-6512.8" font-family="Times,serif" font-size="14.00">Q[3]×K[5]×V[5]</text>
<text text-anchor="middle" x="4235" y="-6497.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_2_stage_14&#45;&gt;ring_attn_2_3_stage_14 -->
<g id="edge1877" class="edge">
<title>ring_attn_2_2_stage_14&#45;&gt;ring_attn_2_3_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-6524C3857.02,-6524 4015.86,-6524 4015.86,-6524"/>
<polygon fill="red" stroke="red" points="4015.86,-6527.5 4025.86,-6524 4015.86,-6520.5 4015.86,-6527.5"/>
</g>
<!-- attn_out_2_2 -->
<g id="node264" class="node">
<title>attn_out_2_2</title>
<polygon fill="none" stroke="black" points="3717.5,-6130 3578.5,-6130 3578.5,-6077 3717.5,-6077 3717.5,-6130"/>
<text text-anchor="middle" x="3648" y="-6114.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="3648" y="-6099.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="3648" y="-6084.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_2_2_stage_15&#45;&gt;attn_out_2_2 -->
<g id="edge261" class="edge">
<title>ring_attn_2_2_stage_15&#45;&gt;attn_out_2_2</title>
<path fill="none" stroke="black" d="M3648,-6202.87C3648,-6202.87 3648,-6140.18 3648,-6140.18"/>
<polygon fill="black" stroke="black" points="3651.5,-6140.18 3648,-6130.18 3644.5,-6140.18 3651.5,-6140.18"/>
</g>
<!-- ring_attn_2_3_stage_15 -->
<g id="node361" class="node">
<title>ring_attn_2_3_stage_15</title>
<polygon fill="yellow" stroke="black" points="4235,-6339 4026,-6271 4235,-6203 4444,-6271 4235,-6339"/>
<text text-anchor="middle" x="4235" y="-6289.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-6274.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="4235" y="-6259.8" font-family="Times,serif" font-size="14.00">Q[3]×K[4]×V[4]</text>
<text text-anchor="middle" x="4235" y="-6244.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_2_stage_15&#45;&gt;ring_attn_2_3_stage_15 -->
<g id="edge1878" class="edge">
<title>ring_attn_2_2_stage_15&#45;&gt;ring_attn_2_3_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-6271C3857.02,-6271 4015.86,-6271 4015.86,-6271"/>
<polygon fill="red" stroke="red" points="4015.86,-6274.5 4025.86,-6271 4015.86,-6267.5 4015.86,-6274.5"/>
</g>
<!-- attn_residual_2_2 -->
<g id="node265" class="node">
<title>attn_residual_2_2</title>
<ellipse fill="none" stroke="black" cx="3648" cy="-5977" rx="105.5" ry="27"/>
<text text-anchor="middle" x="3648" y="-5980.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="3648" y="-5965.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_2_2&#45;&gt;attn_residual_2_2 -->
<g id="edge262" class="edge">
<title>attn_out_2_2&#45;&gt;attn_residual_2_2</title>
<path fill="none" stroke="black" d="M3648,-6076.98C3648,-6076.98 3648,-6014.36 3648,-6014.36"/>
<polygon fill="black" stroke="black" points="3651.5,-6014.36 3648,-6004.36 3644.5,-6014.36 3651.5,-6014.36"/>
</g>
<!-- gate_2_2 -->
<g id="node266" class="node">
<title>gate_2_2</title>
<ellipse fill="orange" stroke="black" cx="3648" cy="-5839.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="3648" y="-5850.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="3648" y="-5835.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="3648" y="-5820.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_2_2&#45;&gt;gate_2_2 -->
<g id="edge263" class="edge">
<title>attn_residual_2_2&#45;&gt;gate_2_2</title>
<path fill="none" stroke="black" d="M3648,-5949.83C3648,-5949.83 3648,-5887.02 3648,-5887.02"/>
<polygon fill="black" stroke="black" points="3651.5,-5887.02 3648,-5877.02 3644.5,-5887.02 3651.5,-5887.02"/>
</g>
<!-- gate_2_2&#45;&gt;expert_2_0_0 -->
<g id="edge1879" class="edge">
<title>gate_2_2&#45;&gt;expert_2_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3550.31,-5824.99C3550.31,-5813.02 3550.31,-5798 3550.31,-5798 3550.31,-5798 340.14,-5798 340.14,-5798 340.14,-5798 340.14,-5680.06 340.14,-5680.06"/>
<polygon fill="blue" stroke="blue" points="343.64,-5680.06 340.14,-5670.06 336.64,-5680.06 343.64,-5680.06"/>
<text text-anchor="middle" x="14216.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14216.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU2→GPU0</text>
<text text-anchor="middle" x="14216.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14216.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_2&#45;&gt;expert_2_1_0 -->
<g id="edge1880" class="edge">
<title>gate_2_2&#45;&gt;expert_2_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3548.39,-5852C3409.42,-5852 3174.21,-5852 3174.21,-5852 3174.21,-5852 3174.21,-5680.33 3174.21,-5680.33"/>
<polygon fill="blue" stroke="blue" points="3177.71,-5680.33 3174.21,-5670.33 3170.71,-5680.33 3177.71,-5680.33"/>
<text text-anchor="middle" x="14390.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14390.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU2→GPU1</text>
<text text-anchor="middle" x="14390.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14390.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_2&#45;&gt;expert_2_2_0 -->
<g id="edge264" class="edge">
<title>gate_2_2&#45;&gt;expert_2_2_0</title>
<path fill="none" stroke="black" d="M3565.94,-5815.86C3565.94,-5815.86 3565.94,-5680.04 3565.94,-5680.04"/>
<polygon fill="black" stroke="black" points="3569.44,-5680.04 3565.94,-5670.04 3562.44,-5680.04 3569.44,-5680.04"/>
</g>
<!-- gate_2_2&#45;&gt;expert_2_3_0 -->
<g id="edge1881" class="edge">
<title>gate_2_2&#45;&gt;expert_2_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3747.7,-5827C3887.54,-5827 4125,-5827 4125,-5827 4125,-5827 4125,-5680.18 4125,-5680.18"/>
<polygon fill="blue" stroke="blue" points="4128.5,-5680.18 4125,-5670.18 4121.5,-5680.18 4128.5,-5680.18"/>
<text text-anchor="middle" x="14564.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14564.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU2→GPU3</text>
<text text-anchor="middle" x="14564.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14564.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_2&#45;&gt;expert_2_4_0 -->
<g id="edge1882" class="edge">
<title>gate_2_2&#45;&gt;expert_2_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3659.72,-5802.16C3659.72,-5790.2 3659.72,-5780 3659.72,-5780 3659.72,-5780 4708.4,-5780 4708.4,-5780 4708.4,-5780 4708.4,-5680.14 4708.4,-5680.14"/>
<polygon fill="blue" stroke="blue" points="4711.9,-5680.14 4708.4,-5670.14 4704.9,-5680.14 4711.9,-5680.14"/>
<text text-anchor="middle" x="14738.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14738.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU2→GPU4</text>
<text text-anchor="middle" x="14738.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14738.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_2&#45;&gt;expert_2_5_0 -->
<g id="edge1883" class="edge">
<title>gate_2_2&#45;&gt;expert_2_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3667.54,-5802.33C3667.54,-5752.98 3667.54,-5672 3667.54,-5672 3667.54,-5672 5293.38,-5672 5293.38,-5672 5293.38,-5672 5293.38,-5671.81 5293.38,-5671.81"/>
<polygon fill="blue" stroke="blue" points="5296.88,-5680.13 5293.38,-5670.13 5289.88,-5680.13 5296.88,-5680.13"/>
<text text-anchor="middle" x="14912.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14912.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU2→GPU5</text>
<text text-anchor="middle" x="14912.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14912.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_2&#45;&gt;expert_2_6_0 -->
<g id="edge1884" class="edge">
<title>gate_2_2&#45;&gt;expert_2_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3675.35,-5803.12C3675.35,-5786.31 3675.35,-5770 3675.35,-5770 3675.35,-5770 5932.7,-5770 5932.7,-5770 5932.7,-5770 5932.7,-5680.02 5932.7,-5680.02"/>
<polygon fill="blue" stroke="blue" points="5936.2,-5680.02 5932.7,-5670.02 5929.2,-5680.02 5936.2,-5680.02"/>
<text text-anchor="middle" x="15086.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15086.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU2→GPU6</text>
<text text-anchor="middle" x="15086.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15086.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_2&#45;&gt;expert_2_7_0 -->
<g id="edge1885" class="edge">
<title>gate_2_2&#45;&gt;expert_2_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3683.17,-5804C3683.17,-5784.81 3683.17,-5765 3683.17,-5765 3683.17,-5765 6517.69,-5765 6517.69,-5765 6517.69,-5765 6517.69,-5680.16 6517.69,-5680.16"/>
<polygon fill="blue" stroke="blue" points="6521.19,-5680.16 6517.69,-5670.16 6514.19,-5680.16 6521.19,-5680.16"/>
<text text-anchor="middle" x="15260.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15260.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU2→GPU7</text>
<text text-anchor="middle" x="15260.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15260.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_2&#45;&gt;expert_2_8_0 -->
<g id="edge1886" class="edge">
<title>gate_2_2&#45;&gt;expert_2_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3690.98,-5805.18C3690.98,-5770.81 3690.98,-5723 3690.98,-5723 3690.98,-5723 7101.2,-5723 7101.2,-5723 7101.2,-5723 7101.2,-5680.42 7101.2,-5680.42"/>
<polygon fill="blue" stroke="blue" points="7104.7,-5680.42 7101.2,-5670.42 7097.7,-5680.42 7104.7,-5680.42"/>
<text text-anchor="middle" x="15434.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15434.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU2→GPU8</text>
<text text-anchor="middle" x="15434.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15434.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_2&#45;&gt;expert_2_9_0 -->
<g id="edge1887" class="edge">
<title>gate_2_2&#45;&gt;expert_2_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3698.8,-5806.53C3698.8,-5771.16 3698.8,-5720 3698.8,-5720 3698.8,-5720 7680.27,-5720 7680.27,-5720 7680.27,-5720 7680.27,-5680.26 7680.27,-5680.26"/>
<polygon fill="blue" stroke="blue" points="7683.77,-5680.26 7680.27,-5670.26 7676.77,-5680.26 7683.77,-5680.26"/>
<text text-anchor="middle" x="15608.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15608.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU2→GPU9</text>
<text text-anchor="middle" x="15608.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15608.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_2&#45;&gt;expert_2_10_0 -->
<g id="edge1888" class="edge">
<title>gate_2_2&#45;&gt;expert_2_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3706.61,-5808.17C3706.61,-5760.44 3706.61,-5675 3706.61,-5675 3706.61,-5675 8258.6,-5675 8258.6,-5675 8258.6,-5675 8258.6,-5674.51 8258.6,-5674.51"/>
<polygon fill="blue" stroke="blue" points="8262.1,-5680.08 8258.6,-5670.08 8255.1,-5680.08 8262.1,-5680.08"/>
<text text-anchor="middle" x="15782.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15782.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU2→GPU10</text>
<text text-anchor="middle" x="15782.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15782.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_2&#45;&gt;expert_2_11_0 -->
<g id="edge1889" class="edge">
<title>gate_2_2&#45;&gt;expert_2_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3714.43,-5810.11C3714.43,-5771.91 3714.43,-5710 3714.43,-5710 3714.43,-5710 8845.6,-5710 8845.6,-5710 8845.6,-5710 8845.6,-5680.16 8845.6,-5680.16"/>
<polygon fill="blue" stroke="blue" points="8849.1,-5680.16 8845.6,-5670.16 8842.1,-5680.16 8849.1,-5680.16"/>
<text text-anchor="middle" x="15956.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15956.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU2→GPU11</text>
<text text-anchor="middle" x="15956.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15956.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_2&#45;&gt;expert_2_12_0 -->
<g id="edge1890" class="edge">
<title>gate_2_2&#45;&gt;expert_2_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3722.24,-5812.74C3722.24,-5771.98 3722.24,-5699 3722.24,-5699 3722.24,-5699 9449.2,-5699 9449.2,-5699 9449.2,-5699 9449.2,-5680.27 9449.2,-5680.27"/>
<polygon fill="blue" stroke="blue" points="9452.7,-5680.27 9449.2,-5670.27 9445.7,-5680.27 9452.7,-5680.27"/>
<text text-anchor="middle" x="16130.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="16130.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU2→GPU12</text>
<text text-anchor="middle" x="16130.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="16130.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_2&#45;&gt;expert_2_13_0 -->
<g id="edge1891" class="edge">
<title>gate_2_2&#45;&gt;expert_2_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3730.06,-5815.64C3730.06,-5774.12 3730.06,-5693 3730.06,-5693 3730.06,-5693 10050.14,-5693 10050.14,-5693 10050.14,-5693 10050.14,-5680.28 10050.14,-5680.28"/>
<polygon fill="blue" stroke="blue" points="10053.64,-5680.28 10050.14,-5670.28 10046.64,-5680.28 10053.64,-5680.28"/>
<text text-anchor="middle" x="16304.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="16304.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU2→GPU13</text>
<text text-anchor="middle" x="16304.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="16304.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_2&#45;&gt;expert_2_14_0 -->
<g id="edge1892" class="edge">
<title>gate_2_2&#45;&gt;expert_2_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3737.87,-5819.69C3737.87,-5778.63 3737.87,-5688 3737.87,-5688 3737.87,-5688 10646.79,-5688 10646.79,-5688 10646.79,-5688 10646.79,-5680.16 10646.79,-5680.16"/>
<polygon fill="blue" stroke="blue" points="10650.29,-5680.16 10646.79,-5670.16 10643.29,-5680.16 10650.29,-5680.16"/>
<text text-anchor="middle" x="16478.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="16478.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU2→GPU14</text>
<text text-anchor="middle" x="16478.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="16478.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_2&#45;&gt;expert_2_15_0 -->
<g id="edge1893" class="edge">
<title>gate_2_2&#45;&gt;expert_2_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3745.69,-5825.33C3745.69,-5787.33 3745.69,-5686 3745.69,-5686 3745.69,-5686 11240.13,-5686 11240.13,-5686 11240.13,-5686 11240.13,-5680.17 11240.13,-5680.17"/>
<polygon fill="blue" stroke="blue" points="11243.63,-5680.17 11240.13,-5670.17 11236.63,-5680.17 11243.63,-5680.17"/>
<text text-anchor="middle" x="16652.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="16652.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU2→GPU15</text>
<text text-anchor="middle" x="16652.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="16652.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_2 -->
<g id="node268" class="node">
<title>expert_reduce_2_2</title>
<ellipse fill="none" stroke="black" cx="3648" cy="-5506.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="3648" y="-5517.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="3648" y="-5502.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="3648" y="-5487.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_2_0&#45;&gt;expert_reduce_2_2 -->
<g id="edge265" class="edge">
<title>expert_2_2_0&#45;&gt;expert_reduce_2_2</title>
<path fill="none" stroke="black" d="M3648,-5616.76C3648,-5616.76 3648,-5554.06 3648,-5554.06"/>
<polygon fill="black" stroke="black" points="3651.5,-5554.06 3648,-5544.06 3644.5,-5554.06 3651.5,-5554.06"/>
</g>
<!-- moe_residual_2_2 -->
<g id="node269" class="node">
<title>moe_residual_2_2</title>
<ellipse fill="none" stroke="black" cx="3648" cy="-5369" rx="105.5" ry="27"/>
<text text-anchor="middle" x="3648" y="-5372.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="3648" y="-5357.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_2&#45;&gt;moe_residual_2_2 -->
<g id="edge266" class="edge">
<title>expert_reduce_2_2&#45;&gt;moe_residual_2_2</title>
<path fill="none" stroke="black" d="M3648,-5468.93C3648,-5468.93 3648,-5406.06 3648,-5406.06"/>
<polygon fill="black" stroke="black" points="3651.5,-5406.06 3648,-5396.06 3644.5,-5406.06 3651.5,-5406.06"/>
</g>
<!-- qkv_proj_3_2 -->
<g id="node270" class="node">
<title>qkv_proj_3_2</title>
<polygon fill="none" stroke="black" points="3730.5,-5269 3565.5,-5269 3565.5,-5216 3730.5,-5216 3730.5,-5269"/>
<text text-anchor="middle" x="3648" y="-5253.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="3648" y="-5238.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="3648" y="-5223.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_2_2&#45;&gt;qkv_proj_3_2 -->
<g id="edge267" class="edge">
<title>moe_residual_2_2&#45;&gt;qkv_proj_3_2</title>
<path fill="none" stroke="black" d="M3648,-5341.86C3648,-5341.86 3648,-5279.16 3648,-5279.16"/>
<polygon fill="black" stroke="black" points="3651.5,-5279.16 3648,-5269.16 3644.5,-5279.16 3651.5,-5279.16"/>
</g>
<!-- qkv_reshape_3_2 -->
<g id="node271" class="node">
<title>qkv_reshape_3_2</title>
<ellipse fill="none" stroke="black" cx="3648" cy="-5116" rx="148" ry="27"/>
<text text-anchor="middle" x="3648" y="-5119.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="3648" y="-5104.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_3_2&#45;&gt;qkv_reshape_3_2 -->
<g id="edge268" class="edge">
<title>qkv_proj_3_2&#45;&gt;qkv_reshape_3_2</title>
<path fill="none" stroke="black" d="M3648,-5215.98C3648,-5215.98 3648,-5153.36 3648,-5153.36"/>
<polygon fill="black" stroke="black" points="3651.5,-5153.36 3648,-5143.36 3644.5,-5153.36 3651.5,-5153.36"/>
</g>
<!-- qkv_reshape_3_2&#45;&gt;ring_attn_3_2_stage_0 -->
<g id="edge269" class="edge">
<title>qkv_reshape_3_2&#45;&gt;ring_attn_3_2_stage_0</title>
<path fill="none" stroke="black" d="M3648,-5088.72C3648,-5088.72 3648,-4982.16 3648,-4982.16"/>
<polygon fill="black" stroke="black" points="3651.5,-4982.16 3648,-4972.16 3644.5,-4982.16 3651.5,-4982.16"/>
</g>
<!-- ring_attn_3_2_stage_0&#45;&gt;ring_attn_3_2_stage_1 -->
<g id="edge270" class="edge">
<title>ring_attn_3_2_stage_0&#45;&gt;ring_attn_3_2_stage_1</title>
<path fill="none" stroke="black" d="M3648,-4835.87C3648,-4835.87 3648,-4729.25 3648,-4729.25"/>
<polygon fill="black" stroke="black" points="3651.5,-4729.25 3648,-4719.25 3644.5,-4729.25 3651.5,-4729.25"/>
</g>
<!-- ring_attn_3_3_stage_0 -->
<g id="node370" class="node">
<title>ring_attn_3_3_stage_0</title>
<polygon fill="yellow" stroke="black" points="4235,-4972 4026,-4904 4235,-4836 4444,-4904 4235,-4972"/>
<text text-anchor="middle" x="4235" y="-4922.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-4907.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="4235" y="-4892.8" font-family="Times,serif" font-size="14.00">Q[3]×K[3]×V[3]</text>
<text text-anchor="middle" x="4235" y="-4877.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_2_stage_0&#45;&gt;ring_attn_3_3_stage_0 -->
<g id="edge1894" class="edge">
<title>ring_attn_3_2_stage_0&#45;&gt;ring_attn_3_3_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-4904C3857.02,-4904 4015.86,-4904 4015.86,-4904"/>
<polygon fill="red" stroke="red" points="4015.86,-4907.5 4025.86,-4904 4015.86,-4900.5 4015.86,-4907.5"/>
</g>
<!-- ring_attn_3_2_stage_1&#45;&gt;ring_attn_3_2_stage_2 -->
<g id="edge271" class="edge">
<title>ring_attn_3_2_stage_1&#45;&gt;ring_attn_3_2_stage_2</title>
<path fill="none" stroke="black" d="M3648,-4582.87C3648,-4582.87 3648,-4476.25 3648,-4476.25"/>
<polygon fill="black" stroke="black" points="3651.5,-4476.25 3648,-4466.25 3644.5,-4476.25 3651.5,-4476.25"/>
</g>
<!-- ring_attn_3_3_stage_1 -->
<g id="node371" class="node">
<title>ring_attn_3_3_stage_1</title>
<polygon fill="yellow" stroke="black" points="4235,-4719 4026,-4651 4235,-4583 4444,-4651 4235,-4719"/>
<text text-anchor="middle" x="4235" y="-4669.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-4654.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="4235" y="-4639.8" font-family="Times,serif" font-size="14.00">Q[3]×K[2]×V[2]</text>
<text text-anchor="middle" x="4235" y="-4624.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_2_stage_1&#45;&gt;ring_attn_3_3_stage_1 -->
<g id="edge1895" class="edge">
<title>ring_attn_3_2_stage_1&#45;&gt;ring_attn_3_3_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-4651C3857.02,-4651 4015.86,-4651 4015.86,-4651"/>
<polygon fill="red" stroke="red" points="4015.86,-4654.5 4025.86,-4651 4015.86,-4647.5 4015.86,-4654.5"/>
</g>
<!-- ring_attn_3_2_stage_2&#45;&gt;ring_attn_3_2_stage_3 -->
<g id="edge272" class="edge">
<title>ring_attn_3_2_stage_2&#45;&gt;ring_attn_3_2_stage_3</title>
<path fill="none" stroke="black" d="M3648,-4329.87C3648,-4329.87 3648,-4223.25 3648,-4223.25"/>
<polygon fill="black" stroke="black" points="3651.5,-4223.25 3648,-4213.25 3644.5,-4223.25 3651.5,-4223.25"/>
</g>
<!-- ring_attn_3_3_stage_2 -->
<g id="node372" class="node">
<title>ring_attn_3_3_stage_2</title>
<polygon fill="yellow" stroke="black" points="4235,-4466 4026,-4398 4235,-4330 4444,-4398 4235,-4466"/>
<text text-anchor="middle" x="4235" y="-4416.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-4401.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="4235" y="-4386.8" font-family="Times,serif" font-size="14.00">Q[3]×K[1]×V[1]</text>
<text text-anchor="middle" x="4235" y="-4371.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_2_stage_2&#45;&gt;ring_attn_3_3_stage_2 -->
<g id="edge1896" class="edge">
<title>ring_attn_3_2_stage_2&#45;&gt;ring_attn_3_3_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-4398C3857.02,-4398 4015.86,-4398 4015.86,-4398"/>
<polygon fill="red" stroke="red" points="4015.86,-4401.5 4025.86,-4398 4015.86,-4394.5 4015.86,-4401.5"/>
</g>
<!-- ring_attn_3_2_stage_3&#45;&gt;ring_attn_3_2_stage_4 -->
<g id="edge273" class="edge">
<title>ring_attn_3_2_stage_3&#45;&gt;ring_attn_3_2_stage_4</title>
<path fill="none" stroke="black" d="M3648,-4076.87C3648,-4076.87 3648,-3970.25 3648,-3970.25"/>
<polygon fill="black" stroke="black" points="3651.5,-3970.25 3648,-3960.25 3644.5,-3970.25 3651.5,-3970.25"/>
</g>
<!-- ring_attn_3_3_stage_3 -->
<g id="node373" class="node">
<title>ring_attn_3_3_stage_3</title>
<polygon fill="yellow" stroke="black" points="4235,-4213 4026,-4145 4235,-4077 4444,-4145 4235,-4213"/>
<text text-anchor="middle" x="4235" y="-4163.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-4148.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="4235" y="-4133.8" font-family="Times,serif" font-size="14.00">Q[3]×K[0]×V[0]</text>
<text text-anchor="middle" x="4235" y="-4118.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_2_stage_3&#45;&gt;ring_attn_3_3_stage_3 -->
<g id="edge1897" class="edge">
<title>ring_attn_3_2_stage_3&#45;&gt;ring_attn_3_3_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-4145C3857.02,-4145 4015.86,-4145 4015.86,-4145"/>
<polygon fill="red" stroke="red" points="4015.86,-4148.5 4025.86,-4145 4015.86,-4141.5 4015.86,-4148.5"/>
</g>
<!-- ring_attn_3_2_stage_4&#45;&gt;ring_attn_3_2_stage_5 -->
<g id="edge274" class="edge">
<title>ring_attn_3_2_stage_4&#45;&gt;ring_attn_3_2_stage_5</title>
<path fill="none" stroke="black" d="M3648,-3823.87C3648,-3823.87 3648,-3717.25 3648,-3717.25"/>
<polygon fill="black" stroke="black" points="3651.5,-3717.25 3648,-3707.25 3644.5,-3717.25 3651.5,-3717.25"/>
</g>
<!-- ring_attn_3_3_stage_4 -->
<g id="node374" class="node">
<title>ring_attn_3_3_stage_4</title>
<polygon fill="yellow" stroke="black" points="4235,-3960 4026,-3892 4235,-3824 4444,-3892 4235,-3960"/>
<text text-anchor="middle" x="4235" y="-3910.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-3895.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="4235" y="-3880.8" font-family="Times,serif" font-size="14.00">Q[3]×K[15]×V[15]</text>
<text text-anchor="middle" x="4235" y="-3865.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_2_stage_4&#45;&gt;ring_attn_3_3_stage_4 -->
<g id="edge1898" class="edge">
<title>ring_attn_3_2_stage_4&#45;&gt;ring_attn_3_3_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-3892C3857.02,-3892 4015.86,-3892 4015.86,-3892"/>
<polygon fill="red" stroke="red" points="4015.86,-3895.5 4025.86,-3892 4015.86,-3888.5 4015.86,-3895.5"/>
</g>
<!-- ring_attn_3_2_stage_5&#45;&gt;ring_attn_3_2_stage_6 -->
<g id="edge275" class="edge">
<title>ring_attn_3_2_stage_5&#45;&gt;ring_attn_3_2_stage_6</title>
<path fill="none" stroke="black" d="M3648,-3570.87C3648,-3570.87 3648,-3464.25 3648,-3464.25"/>
<polygon fill="black" stroke="black" points="3651.5,-3464.25 3648,-3454.25 3644.5,-3464.25 3651.5,-3464.25"/>
</g>
<!-- ring_attn_3_3_stage_5 -->
<g id="node375" class="node">
<title>ring_attn_3_3_stage_5</title>
<polygon fill="yellow" stroke="black" points="4235,-3707 4026,-3639 4235,-3571 4444,-3639 4235,-3707"/>
<text text-anchor="middle" x="4235" y="-3657.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-3642.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="4235" y="-3627.8" font-family="Times,serif" font-size="14.00">Q[3]×K[14]×V[14]</text>
<text text-anchor="middle" x="4235" y="-3612.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_2_stage_5&#45;&gt;ring_attn_3_3_stage_5 -->
<g id="edge1899" class="edge">
<title>ring_attn_3_2_stage_5&#45;&gt;ring_attn_3_3_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-3639C3857.02,-3639 4015.86,-3639 4015.86,-3639"/>
<polygon fill="red" stroke="red" points="4015.86,-3642.5 4025.86,-3639 4015.86,-3635.5 4015.86,-3642.5"/>
</g>
<!-- ring_attn_3_2_stage_6&#45;&gt;ring_attn_3_2_stage_7 -->
<g id="edge276" class="edge">
<title>ring_attn_3_2_stage_6&#45;&gt;ring_attn_3_2_stage_7</title>
<path fill="none" stroke="black" d="M3648,-3317.87C3648,-3317.87 3648,-3211.25 3648,-3211.25"/>
<polygon fill="black" stroke="black" points="3651.5,-3211.25 3648,-3201.25 3644.5,-3211.25 3651.5,-3211.25"/>
</g>
<!-- ring_attn_3_3_stage_6 -->
<g id="node376" class="node">
<title>ring_attn_3_3_stage_6</title>
<polygon fill="yellow" stroke="black" points="4235,-3454 4026,-3386 4235,-3318 4444,-3386 4235,-3454"/>
<text text-anchor="middle" x="4235" y="-3404.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-3389.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="4235" y="-3374.8" font-family="Times,serif" font-size="14.00">Q[3]×K[13]×V[13]</text>
<text text-anchor="middle" x="4235" y="-3359.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_2_stage_6&#45;&gt;ring_attn_3_3_stage_6 -->
<g id="edge1900" class="edge">
<title>ring_attn_3_2_stage_6&#45;&gt;ring_attn_3_3_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-3386C3857.02,-3386 4015.86,-3386 4015.86,-3386"/>
<polygon fill="red" stroke="red" points="4015.86,-3389.5 4025.86,-3386 4015.86,-3382.5 4015.86,-3389.5"/>
</g>
<!-- ring_attn_3_2_stage_7&#45;&gt;ring_attn_3_2_stage_8 -->
<g id="edge277" class="edge">
<title>ring_attn_3_2_stage_7&#45;&gt;ring_attn_3_2_stage_8</title>
<path fill="none" stroke="black" d="M3648,-3064.87C3648,-3064.87 3648,-2958.25 3648,-2958.25"/>
<polygon fill="black" stroke="black" points="3651.5,-2958.25 3648,-2948.25 3644.5,-2958.25 3651.5,-2958.25"/>
</g>
<!-- ring_attn_3_3_stage_7 -->
<g id="node377" class="node">
<title>ring_attn_3_3_stage_7</title>
<polygon fill="yellow" stroke="black" points="4235,-3201 4026,-3133 4235,-3065 4444,-3133 4235,-3201"/>
<text text-anchor="middle" x="4235" y="-3151.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-3136.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="4235" y="-3121.8" font-family="Times,serif" font-size="14.00">Q[3]×K[12]×V[12]</text>
<text text-anchor="middle" x="4235" y="-3106.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_2_stage_7&#45;&gt;ring_attn_3_3_stage_7 -->
<g id="edge1901" class="edge">
<title>ring_attn_3_2_stage_7&#45;&gt;ring_attn_3_3_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-3133C3857.02,-3133 4015.86,-3133 4015.86,-3133"/>
<polygon fill="red" stroke="red" points="4015.86,-3136.5 4025.86,-3133 4015.86,-3129.5 4015.86,-3136.5"/>
</g>
<!-- ring_attn_3_2_stage_8&#45;&gt;ring_attn_3_2_stage_9 -->
<g id="edge278" class="edge">
<title>ring_attn_3_2_stage_8&#45;&gt;ring_attn_3_2_stage_9</title>
<path fill="none" stroke="black" d="M3648,-2811.87C3648,-2811.87 3648,-2705.25 3648,-2705.25"/>
<polygon fill="black" stroke="black" points="3651.5,-2705.25 3648,-2695.25 3644.5,-2705.25 3651.5,-2705.25"/>
</g>
<!-- ring_attn_3_3_stage_8 -->
<g id="node378" class="node">
<title>ring_attn_3_3_stage_8</title>
<polygon fill="yellow" stroke="black" points="4235,-2948 4026,-2880 4235,-2812 4444,-2880 4235,-2948"/>
<text text-anchor="middle" x="4235" y="-2898.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-2883.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="4235" y="-2868.8" font-family="Times,serif" font-size="14.00">Q[3]×K[11]×V[11]</text>
<text text-anchor="middle" x="4235" y="-2853.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_2_stage_8&#45;&gt;ring_attn_3_3_stage_8 -->
<g id="edge1902" class="edge">
<title>ring_attn_3_2_stage_8&#45;&gt;ring_attn_3_3_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-2880C3857.02,-2880 4015.86,-2880 4015.86,-2880"/>
<polygon fill="red" stroke="red" points="4015.86,-2883.5 4025.86,-2880 4015.86,-2876.5 4015.86,-2883.5"/>
</g>
<!-- ring_attn_3_2_stage_9&#45;&gt;ring_attn_3_2_stage_10 -->
<g id="edge279" class="edge">
<title>ring_attn_3_2_stage_9&#45;&gt;ring_attn_3_2_stage_10</title>
<path fill="none" stroke="black" d="M3648,-2558.87C3648,-2558.87 3648,-2452.25 3648,-2452.25"/>
<polygon fill="black" stroke="black" points="3651.5,-2452.25 3648,-2442.25 3644.5,-2452.25 3651.5,-2452.25"/>
</g>
<!-- ring_attn_3_3_stage_9 -->
<g id="node379" class="node">
<title>ring_attn_3_3_stage_9</title>
<polygon fill="yellow" stroke="black" points="4235,-2695 4026,-2627 4235,-2559 4444,-2627 4235,-2695"/>
<text text-anchor="middle" x="4235" y="-2645.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-2630.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="4235" y="-2615.8" font-family="Times,serif" font-size="14.00">Q[3]×K[10]×V[10]</text>
<text text-anchor="middle" x="4235" y="-2600.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_2_stage_9&#45;&gt;ring_attn_3_3_stage_9 -->
<g id="edge1903" class="edge">
<title>ring_attn_3_2_stage_9&#45;&gt;ring_attn_3_3_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-2627C3857.02,-2627 4015.86,-2627 4015.86,-2627"/>
<polygon fill="red" stroke="red" points="4015.86,-2630.5 4025.86,-2627 4015.86,-2623.5 4015.86,-2630.5"/>
</g>
<!-- ring_attn_3_2_stage_10&#45;&gt;ring_attn_3_2_stage_11 -->
<g id="edge280" class="edge">
<title>ring_attn_3_2_stage_10&#45;&gt;ring_attn_3_2_stage_11</title>
<path fill="none" stroke="black" d="M3648,-2305.87C3648,-2305.87 3648,-2199.25 3648,-2199.25"/>
<polygon fill="black" stroke="black" points="3651.5,-2199.25 3648,-2189.25 3644.5,-2199.25 3651.5,-2199.25"/>
</g>
<!-- ring_attn_3_3_stage_10 -->
<g id="node380" class="node">
<title>ring_attn_3_3_stage_10</title>
<polygon fill="yellow" stroke="black" points="4235,-2442 4026,-2374 4235,-2306 4444,-2374 4235,-2442"/>
<text text-anchor="middle" x="4235" y="-2392.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-2377.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="4235" y="-2362.8" font-family="Times,serif" font-size="14.00">Q[3]×K[9]×V[9]</text>
<text text-anchor="middle" x="4235" y="-2347.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_2_stage_10&#45;&gt;ring_attn_3_3_stage_10 -->
<g id="edge1904" class="edge">
<title>ring_attn_3_2_stage_10&#45;&gt;ring_attn_3_3_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-2374C3857.02,-2374 4015.86,-2374 4015.86,-2374"/>
<polygon fill="red" stroke="red" points="4015.86,-2377.5 4025.86,-2374 4015.86,-2370.5 4015.86,-2377.5"/>
</g>
<!-- ring_attn_3_2_stage_11&#45;&gt;ring_attn_3_2_stage_12 -->
<g id="edge281" class="edge">
<title>ring_attn_3_2_stage_11&#45;&gt;ring_attn_3_2_stage_12</title>
<path fill="none" stroke="black" d="M3648,-2052.87C3648,-2052.87 3648,-1946.25 3648,-1946.25"/>
<polygon fill="black" stroke="black" points="3651.5,-1946.25 3648,-1936.25 3644.5,-1946.25 3651.5,-1946.25"/>
</g>
<!-- ring_attn_3_3_stage_11 -->
<g id="node381" class="node">
<title>ring_attn_3_3_stage_11</title>
<polygon fill="yellow" stroke="black" points="4235,-2189 4026,-2121 4235,-2053 4444,-2121 4235,-2189"/>
<text text-anchor="middle" x="4235" y="-2139.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-2124.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="4235" y="-2109.8" font-family="Times,serif" font-size="14.00">Q[3]×K[8]×V[8]</text>
<text text-anchor="middle" x="4235" y="-2094.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_2_stage_11&#45;&gt;ring_attn_3_3_stage_11 -->
<g id="edge1905" class="edge">
<title>ring_attn_3_2_stage_11&#45;&gt;ring_attn_3_3_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-2121C3857.02,-2121 4015.86,-2121 4015.86,-2121"/>
<polygon fill="red" stroke="red" points="4015.86,-2124.5 4025.86,-2121 4015.86,-2117.5 4015.86,-2124.5"/>
</g>
<!-- ring_attn_3_2_stage_12&#45;&gt;ring_attn_3_2_stage_13 -->
<g id="edge282" class="edge">
<title>ring_attn_3_2_stage_12&#45;&gt;ring_attn_3_2_stage_13</title>
<path fill="none" stroke="black" d="M3648,-1799.87C3648,-1799.87 3648,-1693.25 3648,-1693.25"/>
<polygon fill="black" stroke="black" points="3651.5,-1693.25 3648,-1683.25 3644.5,-1693.25 3651.5,-1693.25"/>
</g>
<!-- ring_attn_3_3_stage_12 -->
<g id="node382" class="node">
<title>ring_attn_3_3_stage_12</title>
<polygon fill="yellow" stroke="black" points="4235,-1936 4026,-1868 4235,-1800 4444,-1868 4235,-1936"/>
<text text-anchor="middle" x="4235" y="-1886.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-1871.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="4235" y="-1856.8" font-family="Times,serif" font-size="14.00">Q[3]×K[7]×V[7]</text>
<text text-anchor="middle" x="4235" y="-1841.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_2_stage_12&#45;&gt;ring_attn_3_3_stage_12 -->
<g id="edge1906" class="edge">
<title>ring_attn_3_2_stage_12&#45;&gt;ring_attn_3_3_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-1868C3857.02,-1868 4015.86,-1868 4015.86,-1868"/>
<polygon fill="red" stroke="red" points="4015.86,-1871.5 4025.86,-1868 4015.86,-1864.5 4015.86,-1871.5"/>
</g>
<!-- ring_attn_3_2_stage_13&#45;&gt;ring_attn_3_2_stage_14 -->
<g id="edge283" class="edge">
<title>ring_attn_3_2_stage_13&#45;&gt;ring_attn_3_2_stage_14</title>
<path fill="none" stroke="black" d="M3648,-1546.87C3648,-1546.87 3648,-1440.25 3648,-1440.25"/>
<polygon fill="black" stroke="black" points="3651.5,-1440.25 3648,-1430.25 3644.5,-1440.25 3651.5,-1440.25"/>
</g>
<!-- ring_attn_3_3_stage_13 -->
<g id="node383" class="node">
<title>ring_attn_3_3_stage_13</title>
<polygon fill="yellow" stroke="black" points="4235,-1683 4026,-1615 4235,-1547 4444,-1615 4235,-1683"/>
<text text-anchor="middle" x="4235" y="-1633.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-1618.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="4235" y="-1603.8" font-family="Times,serif" font-size="14.00">Q[3]×K[6]×V[6]</text>
<text text-anchor="middle" x="4235" y="-1588.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_2_stage_13&#45;&gt;ring_attn_3_3_stage_13 -->
<g id="edge1907" class="edge">
<title>ring_attn_3_2_stage_13&#45;&gt;ring_attn_3_3_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-1615C3857.02,-1615 4015.86,-1615 4015.86,-1615"/>
<polygon fill="red" stroke="red" points="4015.86,-1618.5 4025.86,-1615 4015.86,-1611.5 4015.86,-1618.5"/>
</g>
<!-- ring_attn_3_2_stage_14&#45;&gt;ring_attn_3_2_stage_15 -->
<g id="edge284" class="edge">
<title>ring_attn_3_2_stage_14&#45;&gt;ring_attn_3_2_stage_15</title>
<path fill="none" stroke="black" d="M3648,-1293.87C3648,-1293.87 3648,-1187.25 3648,-1187.25"/>
<polygon fill="black" stroke="black" points="3651.5,-1187.25 3648,-1177.25 3644.5,-1187.25 3651.5,-1187.25"/>
</g>
<!-- ring_attn_3_3_stage_14 -->
<g id="node384" class="node">
<title>ring_attn_3_3_stage_14</title>
<polygon fill="yellow" stroke="black" points="4235,-1430 4026,-1362 4235,-1294 4444,-1362 4235,-1430"/>
<text text-anchor="middle" x="4235" y="-1380.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-1365.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="4235" y="-1350.8" font-family="Times,serif" font-size="14.00">Q[3]×K[5]×V[5]</text>
<text text-anchor="middle" x="4235" y="-1335.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_2_stage_14&#45;&gt;ring_attn_3_3_stage_14 -->
<g id="edge1908" class="edge">
<title>ring_attn_3_2_stage_14&#45;&gt;ring_attn_3_3_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-1362C3857.02,-1362 4015.86,-1362 4015.86,-1362"/>
<polygon fill="red" stroke="red" points="4015.86,-1365.5 4025.86,-1362 4015.86,-1358.5 4015.86,-1365.5"/>
</g>
<!-- attn_out_3_2 -->
<g id="node288" class="node">
<title>attn_out_3_2</title>
<polygon fill="none" stroke="black" points="3717.5,-968 3578.5,-968 3578.5,-915 3717.5,-915 3717.5,-968"/>
<text text-anchor="middle" x="3648" y="-952.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="3648" y="-937.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="3648" y="-922.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_3_2_stage_15&#45;&gt;attn_out_3_2 -->
<g id="edge285" class="edge">
<title>ring_attn_3_2_stage_15&#45;&gt;attn_out_3_2</title>
<path fill="none" stroke="black" d="M3648,-1040.87C3648,-1040.87 3648,-978.18 3648,-978.18"/>
<polygon fill="black" stroke="black" points="3651.5,-978.18 3648,-968.18 3644.5,-978.18 3651.5,-978.18"/>
</g>
<!-- ring_attn_3_3_stage_15 -->
<g id="node385" class="node">
<title>ring_attn_3_3_stage_15</title>
<polygon fill="yellow" stroke="black" points="4235,-1177 4026,-1109 4235,-1041 4444,-1109 4235,-1177"/>
<text text-anchor="middle" x="4235" y="-1127.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4235" y="-1112.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="4235" y="-1097.8" font-family="Times,serif" font-size="14.00">Q[3]×K[4]×V[4]</text>
<text text-anchor="middle" x="4235" y="-1082.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_2_stage_15&#45;&gt;ring_attn_3_3_stage_15 -->
<g id="edge1909" class="edge">
<title>ring_attn_3_2_stage_15&#45;&gt;ring_attn_3_3_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M3857.02,-1109C3857.02,-1109 4015.86,-1109 4015.86,-1109"/>
<polygon fill="red" stroke="red" points="4015.86,-1112.5 4025.86,-1109 4015.86,-1105.5 4015.86,-1112.5"/>
</g>
<!-- attn_residual_3_2 -->
<g id="node289" class="node">
<title>attn_residual_3_2</title>
<ellipse fill="none" stroke="black" cx="3648" cy="-815" rx="105.5" ry="27"/>
<text text-anchor="middle" x="3648" y="-818.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="3648" y="-803.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_3_2&#45;&gt;attn_residual_3_2 -->
<g id="edge286" class="edge">
<title>attn_out_3_2&#45;&gt;attn_residual_3_2</title>
<path fill="none" stroke="black" d="M3648,-914.98C3648,-914.98 3648,-852.36 3648,-852.36"/>
<polygon fill="black" stroke="black" points="3651.5,-852.36 3648,-842.36 3644.5,-852.36 3651.5,-852.36"/>
</g>
<!-- gate_3_2 -->
<g id="node290" class="node">
<title>gate_3_2</title>
<ellipse fill="orange" stroke="black" cx="3648" cy="-677.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="3648" y="-688.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="3648" y="-673.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="3648" y="-658.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_3_2&#45;&gt;gate_3_2 -->
<g id="edge287" class="edge">
<title>attn_residual_3_2&#45;&gt;gate_3_2</title>
<path fill="none" stroke="black" d="M3648,-787.83C3648,-787.83 3648,-725.02 3648,-725.02"/>
<polygon fill="black" stroke="black" points="3651.5,-725.02 3648,-715.02 3644.5,-725.02 3651.5,-725.02"/>
</g>
<!-- gate_3_2&#45;&gt;expert_3_0_0 -->
<g id="edge1910" class="edge">
<title>gate_3_2&#45;&gt;expert_3_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3550.31,-662.99C3550.31,-651.02 3550.31,-636 3550.31,-636 3550.31,-636 340.14,-636 340.14,-636 340.14,-636 340.14,-518.06 340.14,-518.06"/>
<polygon fill="blue" stroke="blue" points="343.64,-518.06 340.14,-508.06 336.64,-518.06 343.64,-518.06"/>
<text text-anchor="middle" x="14216.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14216.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU2→GPU0</text>
<text text-anchor="middle" x="14216.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14216.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_2&#45;&gt;expert_3_1_0 -->
<g id="edge1911" class="edge">
<title>gate_3_2&#45;&gt;expert_3_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3548.39,-690C3409.42,-690 3174.21,-690 3174.21,-690 3174.21,-690 3174.21,-518.33 3174.21,-518.33"/>
<polygon fill="blue" stroke="blue" points="3177.71,-518.33 3174.21,-508.33 3170.71,-518.33 3177.71,-518.33"/>
<text text-anchor="middle" x="14390.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14390.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU2→GPU1</text>
<text text-anchor="middle" x="14390.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14390.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_2&#45;&gt;expert_3_2_0 -->
<g id="edge288" class="edge">
<title>gate_3_2&#45;&gt;expert_3_2_0</title>
<path fill="none" stroke="black" d="M3565.94,-653.86C3565.94,-653.86 3565.94,-518.04 3565.94,-518.04"/>
<polygon fill="black" stroke="black" points="3569.44,-518.04 3565.94,-508.04 3562.44,-518.04 3569.44,-518.04"/>
</g>
<!-- gate_3_2&#45;&gt;expert_3_3_0 -->
<g id="edge1912" class="edge">
<title>gate_3_2&#45;&gt;expert_3_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3747.7,-665C3887.54,-665 4125,-665 4125,-665 4125,-665 4125,-518.18 4125,-518.18"/>
<polygon fill="blue" stroke="blue" points="4128.5,-518.18 4125,-508.18 4121.5,-518.18 4128.5,-518.18"/>
<text text-anchor="middle" x="14564.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14564.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU2→GPU3</text>
<text text-anchor="middle" x="14564.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14564.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_2&#45;&gt;expert_3_4_0 -->
<g id="edge1913" class="edge">
<title>gate_3_2&#45;&gt;expert_3_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3659.72,-640.16C3659.72,-628.2 3659.72,-618 3659.72,-618 3659.72,-618 4708.4,-618 4708.4,-618 4708.4,-618 4708.4,-518.14 4708.4,-518.14"/>
<polygon fill="blue" stroke="blue" points="4711.9,-518.14 4708.4,-508.14 4704.9,-518.14 4711.9,-518.14"/>
<text text-anchor="middle" x="14738.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14738.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU2→GPU4</text>
<text text-anchor="middle" x="14738.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14738.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_2&#45;&gt;expert_3_5_0 -->
<g id="edge1914" class="edge">
<title>gate_3_2&#45;&gt;expert_3_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3667.54,-640.33C3667.54,-590.98 3667.54,-510 3667.54,-510 3667.54,-510 5293.38,-510 5293.38,-510 5293.38,-510 5293.38,-509.81 5293.38,-509.81"/>
<polygon fill="blue" stroke="blue" points="5296.88,-518.13 5293.38,-508.13 5289.88,-518.13 5296.88,-518.13"/>
<text text-anchor="middle" x="14912.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="14912.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU2→GPU5</text>
<text text-anchor="middle" x="14912.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="14912.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_2&#45;&gt;expert_3_6_0 -->
<g id="edge1915" class="edge">
<title>gate_3_2&#45;&gt;expert_3_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3675.35,-641.12C3675.35,-624.31 3675.35,-608 3675.35,-608 3675.35,-608 5932.7,-608 5932.7,-608 5932.7,-608 5932.7,-518.02 5932.7,-518.02"/>
<polygon fill="blue" stroke="blue" points="5936.2,-518.02 5932.7,-508.02 5929.2,-518.02 5936.2,-518.02"/>
<text text-anchor="middle" x="15086.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15086.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU2→GPU6</text>
<text text-anchor="middle" x="15086.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15086.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_2&#45;&gt;expert_3_7_0 -->
<g id="edge1916" class="edge">
<title>gate_3_2&#45;&gt;expert_3_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3683.17,-642C3683.17,-622.81 3683.17,-603 3683.17,-603 3683.17,-603 6517.69,-603 6517.69,-603 6517.69,-603 6517.69,-518.16 6517.69,-518.16"/>
<polygon fill="blue" stroke="blue" points="6521.19,-518.16 6517.69,-508.16 6514.19,-518.16 6521.19,-518.16"/>
<text text-anchor="middle" x="15260.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15260.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU2→GPU7</text>
<text text-anchor="middle" x="15260.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15260.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_2&#45;&gt;expert_3_8_0 -->
<g id="edge1917" class="edge">
<title>gate_3_2&#45;&gt;expert_3_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3690.98,-643.18C3690.98,-608.81 3690.98,-561 3690.98,-561 3690.98,-561 7101.2,-561 7101.2,-561 7101.2,-561 7101.2,-518.42 7101.2,-518.42"/>
<polygon fill="blue" stroke="blue" points="7104.7,-518.42 7101.2,-508.42 7097.7,-518.42 7104.7,-518.42"/>
<text text-anchor="middle" x="15434.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15434.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU2→GPU8</text>
<text text-anchor="middle" x="15434.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15434.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_2&#45;&gt;expert_3_9_0 -->
<g id="edge1918" class="edge">
<title>gate_3_2&#45;&gt;expert_3_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3698.8,-644.53C3698.8,-609.16 3698.8,-558 3698.8,-558 3698.8,-558 7680.27,-558 7680.27,-558 7680.27,-558 7680.27,-518.26 7680.27,-518.26"/>
<polygon fill="blue" stroke="blue" points="7683.77,-518.26 7680.27,-508.26 7676.77,-518.26 7683.77,-518.26"/>
<text text-anchor="middle" x="15608.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15608.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU2→GPU9</text>
<text text-anchor="middle" x="15608.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15608.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_2&#45;&gt;expert_3_10_0 -->
<g id="edge1919" class="edge">
<title>gate_3_2&#45;&gt;expert_3_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3706.61,-646.17C3706.61,-598.44 3706.61,-513 3706.61,-513 3706.61,-513 8258.6,-513 8258.6,-513 8258.6,-513 8258.6,-512.51 8258.6,-512.51"/>
<polygon fill="blue" stroke="blue" points="8262.1,-518.08 8258.6,-508.08 8255.1,-518.08 8262.1,-518.08"/>
<text text-anchor="middle" x="15782.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15782.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU2→GPU10</text>
<text text-anchor="middle" x="15782.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15782.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_2&#45;&gt;expert_3_11_0 -->
<g id="edge1920" class="edge">
<title>gate_3_2&#45;&gt;expert_3_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3714.43,-648.11C3714.43,-609.91 3714.43,-548 3714.43,-548 3714.43,-548 8845.6,-548 8845.6,-548 8845.6,-548 8845.6,-518.16 8845.6,-518.16"/>
<polygon fill="blue" stroke="blue" points="8849.1,-518.16 8845.6,-508.16 8842.1,-518.16 8849.1,-518.16"/>
<text text-anchor="middle" x="15956.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="15956.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU2→GPU11</text>
<text text-anchor="middle" x="15956.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="15956.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_2&#45;&gt;expert_3_12_0 -->
<g id="edge1921" class="edge">
<title>gate_3_2&#45;&gt;expert_3_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3722.24,-650.74C3722.24,-609.98 3722.24,-537 3722.24,-537 3722.24,-537 9449.2,-537 9449.2,-537 9449.2,-537 9449.2,-518.27 9449.2,-518.27"/>
<polygon fill="blue" stroke="blue" points="9452.7,-518.27 9449.2,-508.27 9445.7,-518.27 9452.7,-518.27"/>
<text text-anchor="middle" x="16130.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="16130.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU2→GPU12</text>
<text text-anchor="middle" x="16130.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="16130.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_2&#45;&gt;expert_3_13_0 -->
<g id="edge1922" class="edge">
<title>gate_3_2&#45;&gt;expert_3_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3730.06,-653.64C3730.06,-612.12 3730.06,-531 3730.06,-531 3730.06,-531 10050.14,-531 10050.14,-531 10050.14,-531 10050.14,-518.28 10050.14,-518.28"/>
<polygon fill="blue" stroke="blue" points="10053.64,-518.28 10050.14,-508.28 10046.64,-518.28 10053.64,-518.28"/>
<text text-anchor="middle" x="16304.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="16304.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU2→GPU13</text>
<text text-anchor="middle" x="16304.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="16304.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_2&#45;&gt;expert_3_14_0 -->
<g id="edge1923" class="edge">
<title>gate_3_2&#45;&gt;expert_3_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3737.87,-657.69C3737.87,-616.63 3737.87,-526 3737.87,-526 3737.87,-526 10646.79,-526 10646.79,-526 10646.79,-526 10646.79,-518.16 10646.79,-518.16"/>
<polygon fill="blue" stroke="blue" points="10650.29,-518.16 10646.79,-508.16 10643.29,-518.16 10650.29,-518.16"/>
<text text-anchor="middle" x="16478.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="16478.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU2→GPU14</text>
<text text-anchor="middle" x="16478.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="16478.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_2&#45;&gt;expert_3_15_0 -->
<g id="edge1924" class="edge">
<title>gate_3_2&#45;&gt;expert_3_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3745.69,-663.33C3745.69,-625.33 3745.69,-524 3745.69,-524 3745.69,-524 11240.13,-524 11240.13,-524 11240.13,-524 11240.13,-518.17 11240.13,-518.17"/>
<polygon fill="blue" stroke="blue" points="11243.63,-518.17 11240.13,-508.17 11236.63,-518.17 11243.63,-518.17"/>
<text text-anchor="middle" x="16652.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="16652.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU2→GPU15</text>
<text text-anchor="middle" x="16652.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="16652.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_2 -->
<g id="node292" class="node">
<title>expert_reduce_3_2</title>
<ellipse fill="none" stroke="black" cx="3648" cy="-344.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="3648" y="-355.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="3648" y="-340.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="3648" y="-325.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_2_0&#45;&gt;expert_reduce_3_2 -->
<g id="edge289" class="edge">
<title>expert_3_2_0&#45;&gt;expert_reduce_3_2</title>
<path fill="none" stroke="black" d="M3648,-454.76C3648,-454.76 3648,-392.06 3648,-392.06"/>
<polygon fill="black" stroke="black" points="3651.5,-392.06 3648,-382.06 3644.5,-392.06 3651.5,-392.06"/>
</g>
<!-- moe_residual_3_2 -->
<g id="node293" class="node">
<title>moe_residual_3_2</title>
<ellipse fill="none" stroke="black" cx="3648" cy="-207" rx="105.5" ry="27"/>
<text text-anchor="middle" x="3648" y="-210.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="3648" y="-195.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_2&#45;&gt;moe_residual_3_2 -->
<g id="edge290" class="edge">
<title>expert_reduce_3_2&#45;&gt;moe_residual_3_2</title>
<path fill="none" stroke="black" d="M3648,-306.93C3648,-306.93 3648,-244.06 3648,-244.06"/>
<polygon fill="black" stroke="black" points="3651.5,-244.06 3648,-234.06 3644.5,-244.06 3651.5,-244.06"/>
</g>
<!-- output_2 -->
<g id="node294" class="node">
<title>output_2</title>
<polygon fill="lightcoral" stroke="black" points="3741,-107 3555,-107 3555,-69 3741,-69 3741,-107"/>
<text text-anchor="middle" x="3648" y="-91.8" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="3648" y="-76.8" font-family="Times,serif" font-size="14.00">Y[2]: 1024×1024×4096</text>
</g>
<!-- moe_residual_3_2&#45;&gt;output_2 -->
<g id="edge291" class="edge">
<title>moe_residual_3_2&#45;&gt;output_2</title>
<path fill="none" stroke="black" d="M3648,-180C3648,-180 3648,-117.12 3648,-117.12"/>
<polygon fill="black" stroke="black" points="3651.5,-117.12 3648,-107.12 3644.5,-117.12 3651.5,-117.12"/>
</g>
<!-- input_3 -->
<g id="node295" class="node">
<title>input_3</title>
<polygon fill="lightgreen" stroke="black" points="4328.5,-20866 4141.5,-20866 4141.5,-20828 4328.5,-20828 4328.5,-20866"/>
<text text-anchor="middle" x="4235" y="-20850.8" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="4235" y="-20835.8" font-family="Times,serif" font-size="14.00">X[3]: 1024×1024×4096</text>
</g>
<!-- qkv_proj_0_3 -->
<g id="node296" class="node">
<title>qkv_proj_0_3</title>
<polygon fill="none" stroke="black" points="4317.5,-20755 4152.5,-20755 4152.5,-20702 4317.5,-20702 4317.5,-20755"/>
<text text-anchor="middle" x="4235" y="-20739.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="4235" y="-20724.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="4235" y="-20709.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- input_3&#45;&gt;qkv_proj_0_3 -->
<g id="edge292" class="edge">
<title>input_3&#45;&gt;qkv_proj_0_3</title>
<path fill="none" stroke="black" d="M4235,-20827.96C4235,-20827.96 4235,-20765.44 4235,-20765.44"/>
<polygon fill="black" stroke="black" points="4238.5,-20765.44 4235,-20755.44 4231.5,-20765.44 4238.5,-20765.44"/>
</g>
<!-- qkv_reshape_0_3 -->
<g id="node297" class="node">
<title>qkv_reshape_0_3</title>
<ellipse fill="none" stroke="black" cx="4235" cy="-20602" rx="148" ry="27"/>
<text text-anchor="middle" x="4235" y="-20605.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="4235" y="-20590.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_0_3&#45;&gt;qkv_reshape_0_3 -->
<g id="edge293" class="edge">
<title>qkv_proj_0_3&#45;&gt;qkv_reshape_0_3</title>
<path fill="none" stroke="black" d="M4235,-20701.98C4235,-20701.98 4235,-20639.36 4235,-20639.36"/>
<polygon fill="black" stroke="black" points="4238.5,-20639.36 4235,-20629.36 4231.5,-20639.36 4238.5,-20639.36"/>
</g>
<!-- qkv_reshape_0_3&#45;&gt;ring_attn_0_3_stage_0 -->
<g id="edge294" class="edge">
<title>qkv_reshape_0_3&#45;&gt;ring_attn_0_3_stage_0</title>
<path fill="none" stroke="black" d="M4235,-20574.72C4235,-20574.72 4235,-20468.16 4235,-20468.16"/>
<polygon fill="black" stroke="black" points="4238.5,-20468.16 4235,-20458.16 4231.5,-20468.16 4238.5,-20468.16"/>
</g>
<!-- ring_attn_0_3_stage_0&#45;&gt;ring_attn_0_3_stage_1 -->
<g id="edge295" class="edge">
<title>ring_attn_0_3_stage_0&#45;&gt;ring_attn_0_3_stage_1</title>
<path fill="none" stroke="black" d="M4235,-20321.87C4235,-20321.87 4235,-20215.25 4235,-20215.25"/>
<polygon fill="black" stroke="black" points="4238.5,-20215.25 4235,-20205.25 4231.5,-20215.25 4238.5,-20215.25"/>
</g>
<!-- ring_attn_0_4_stage_0 -->
<g id="node396" class="node">
<title>ring_attn_0_4_stage_0</title>
<polygon fill="yellow" stroke="black" points="4822,-20458 4613,-20390 4822,-20322 5031,-20390 4822,-20458"/>
<text text-anchor="middle" x="4822" y="-20408.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-20393.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="4822" y="-20378.8" font-family="Times,serif" font-size="14.00">Q[4]×K[4]×V[4]</text>
<text text-anchor="middle" x="4822" y="-20363.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_3_stage_0&#45;&gt;ring_attn_0_4_stage_0 -->
<g id="edge1925" class="edge">
<title>ring_attn_0_3_stage_0&#45;&gt;ring_attn_0_4_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-20390C4444.02,-20390 4602.86,-20390 4602.86,-20390"/>
<polygon fill="red" stroke="red" points="4602.86,-20393.5 4612.86,-20390 4602.86,-20386.5 4602.86,-20393.5"/>
</g>
<!-- ring_attn_0_3_stage_1&#45;&gt;ring_attn_0_3_stage_2 -->
<g id="edge296" class="edge">
<title>ring_attn_0_3_stage_1&#45;&gt;ring_attn_0_3_stage_2</title>
<path fill="none" stroke="black" d="M4235,-20068.87C4235,-20068.87 4235,-19962.25 4235,-19962.25"/>
<polygon fill="black" stroke="black" points="4238.5,-19962.25 4235,-19952.25 4231.5,-19962.25 4238.5,-19962.25"/>
</g>
<!-- ring_attn_0_4_stage_1 -->
<g id="node397" class="node">
<title>ring_attn_0_4_stage_1</title>
<polygon fill="yellow" stroke="black" points="4822,-20205 4613,-20137 4822,-20069 5031,-20137 4822,-20205"/>
<text text-anchor="middle" x="4822" y="-20155.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-20140.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="4822" y="-20125.8" font-family="Times,serif" font-size="14.00">Q[4]×K[3]×V[3]</text>
<text text-anchor="middle" x="4822" y="-20110.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_3_stage_1&#45;&gt;ring_attn_0_4_stage_1 -->
<g id="edge1926" class="edge">
<title>ring_attn_0_3_stage_1&#45;&gt;ring_attn_0_4_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-20137C4444.02,-20137 4602.86,-20137 4602.86,-20137"/>
<polygon fill="red" stroke="red" points="4602.86,-20140.5 4612.86,-20137 4602.86,-20133.5 4602.86,-20140.5"/>
</g>
<!-- ring_attn_0_3_stage_2&#45;&gt;ring_attn_0_3_stage_3 -->
<g id="edge297" class="edge">
<title>ring_attn_0_3_stage_2&#45;&gt;ring_attn_0_3_stage_3</title>
<path fill="none" stroke="black" d="M4235,-19815.87C4235,-19815.87 4235,-19709.25 4235,-19709.25"/>
<polygon fill="black" stroke="black" points="4238.5,-19709.25 4235,-19699.25 4231.5,-19709.25 4238.5,-19709.25"/>
</g>
<!-- ring_attn_0_4_stage_2 -->
<g id="node398" class="node">
<title>ring_attn_0_4_stage_2</title>
<polygon fill="yellow" stroke="black" points="4822,-19952 4613,-19884 4822,-19816 5031,-19884 4822,-19952"/>
<text text-anchor="middle" x="4822" y="-19902.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-19887.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="4822" y="-19872.8" font-family="Times,serif" font-size="14.00">Q[4]×K[2]×V[2]</text>
<text text-anchor="middle" x="4822" y="-19857.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_3_stage_2&#45;&gt;ring_attn_0_4_stage_2 -->
<g id="edge1927" class="edge">
<title>ring_attn_0_3_stage_2&#45;&gt;ring_attn_0_4_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-19884C4444.02,-19884 4602.86,-19884 4602.86,-19884"/>
<polygon fill="red" stroke="red" points="4602.86,-19887.5 4612.86,-19884 4602.86,-19880.5 4602.86,-19887.5"/>
</g>
<!-- ring_attn_0_3_stage_3&#45;&gt;ring_attn_0_3_stage_4 -->
<g id="edge298" class="edge">
<title>ring_attn_0_3_stage_3&#45;&gt;ring_attn_0_3_stage_4</title>
<path fill="none" stroke="black" d="M4235,-19562.87C4235,-19562.87 4235,-19456.25 4235,-19456.25"/>
<polygon fill="black" stroke="black" points="4238.5,-19456.25 4235,-19446.25 4231.5,-19456.25 4238.5,-19456.25"/>
</g>
<!-- ring_attn_0_4_stage_3 -->
<g id="node399" class="node">
<title>ring_attn_0_4_stage_3</title>
<polygon fill="yellow" stroke="black" points="4822,-19699 4613,-19631 4822,-19563 5031,-19631 4822,-19699"/>
<text text-anchor="middle" x="4822" y="-19649.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-19634.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="4822" y="-19619.8" font-family="Times,serif" font-size="14.00">Q[4]×K[1]×V[1]</text>
<text text-anchor="middle" x="4822" y="-19604.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_3_stage_3&#45;&gt;ring_attn_0_4_stage_3 -->
<g id="edge1928" class="edge">
<title>ring_attn_0_3_stage_3&#45;&gt;ring_attn_0_4_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-19631C4444.02,-19631 4602.86,-19631 4602.86,-19631"/>
<polygon fill="red" stroke="red" points="4602.86,-19634.5 4612.86,-19631 4602.86,-19627.5 4602.86,-19634.5"/>
</g>
<!-- ring_attn_0_3_stage_4&#45;&gt;ring_attn_0_3_stage_5 -->
<g id="edge299" class="edge">
<title>ring_attn_0_3_stage_4&#45;&gt;ring_attn_0_3_stage_5</title>
<path fill="none" stroke="black" d="M4235,-19309.87C4235,-19309.87 4235,-19203.25 4235,-19203.25"/>
<polygon fill="black" stroke="black" points="4238.5,-19203.25 4235,-19193.25 4231.5,-19203.25 4238.5,-19203.25"/>
</g>
<!-- ring_attn_0_4_stage_4 -->
<g id="node400" class="node">
<title>ring_attn_0_4_stage_4</title>
<polygon fill="yellow" stroke="black" points="4822,-19446 4613,-19378 4822,-19310 5031,-19378 4822,-19446"/>
<text text-anchor="middle" x="4822" y="-19396.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-19381.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="4822" y="-19366.8" font-family="Times,serif" font-size="14.00">Q[4]×K[0]×V[0]</text>
<text text-anchor="middle" x="4822" y="-19351.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_3_stage_4&#45;&gt;ring_attn_0_4_stage_4 -->
<g id="edge1929" class="edge">
<title>ring_attn_0_3_stage_4&#45;&gt;ring_attn_0_4_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-19378C4444.02,-19378 4602.86,-19378 4602.86,-19378"/>
<polygon fill="red" stroke="red" points="4602.86,-19381.5 4612.86,-19378 4602.86,-19374.5 4602.86,-19381.5"/>
</g>
<!-- ring_attn_0_3_stage_5&#45;&gt;ring_attn_0_3_stage_6 -->
<g id="edge300" class="edge">
<title>ring_attn_0_3_stage_5&#45;&gt;ring_attn_0_3_stage_6</title>
<path fill="none" stroke="black" d="M4235,-19056.87C4235,-19056.87 4235,-18950.25 4235,-18950.25"/>
<polygon fill="black" stroke="black" points="4238.5,-18950.25 4235,-18940.25 4231.5,-18950.25 4238.5,-18950.25"/>
</g>
<!-- ring_attn_0_4_stage_5 -->
<g id="node401" class="node">
<title>ring_attn_0_4_stage_5</title>
<polygon fill="yellow" stroke="black" points="4822,-19193 4613,-19125 4822,-19057 5031,-19125 4822,-19193"/>
<text text-anchor="middle" x="4822" y="-19143.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-19128.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="4822" y="-19113.8" font-family="Times,serif" font-size="14.00">Q[4]×K[15]×V[15]</text>
<text text-anchor="middle" x="4822" y="-19098.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_3_stage_5&#45;&gt;ring_attn_0_4_stage_5 -->
<g id="edge1930" class="edge">
<title>ring_attn_0_3_stage_5&#45;&gt;ring_attn_0_4_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-19125C4444.02,-19125 4602.86,-19125 4602.86,-19125"/>
<polygon fill="red" stroke="red" points="4602.86,-19128.5 4612.86,-19125 4602.86,-19121.5 4602.86,-19128.5"/>
</g>
<!-- ring_attn_0_3_stage_6&#45;&gt;ring_attn_0_3_stage_7 -->
<g id="edge301" class="edge">
<title>ring_attn_0_3_stage_6&#45;&gt;ring_attn_0_3_stage_7</title>
<path fill="none" stroke="black" d="M4235,-18803.87C4235,-18803.87 4235,-18697.25 4235,-18697.25"/>
<polygon fill="black" stroke="black" points="4238.5,-18697.25 4235,-18687.25 4231.5,-18697.25 4238.5,-18697.25"/>
</g>
<!-- ring_attn_0_4_stage_6 -->
<g id="node402" class="node">
<title>ring_attn_0_4_stage_6</title>
<polygon fill="yellow" stroke="black" points="4822,-18940 4613,-18872 4822,-18804 5031,-18872 4822,-18940"/>
<text text-anchor="middle" x="4822" y="-18890.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-18875.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="4822" y="-18860.8" font-family="Times,serif" font-size="14.00">Q[4]×K[14]×V[14]</text>
<text text-anchor="middle" x="4822" y="-18845.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_3_stage_6&#45;&gt;ring_attn_0_4_stage_6 -->
<g id="edge1931" class="edge">
<title>ring_attn_0_3_stage_6&#45;&gt;ring_attn_0_4_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-18872C4444.02,-18872 4602.86,-18872 4602.86,-18872"/>
<polygon fill="red" stroke="red" points="4602.86,-18875.5 4612.86,-18872 4602.86,-18868.5 4602.86,-18875.5"/>
</g>
<!-- ring_attn_0_3_stage_7&#45;&gt;ring_attn_0_3_stage_8 -->
<g id="edge302" class="edge">
<title>ring_attn_0_3_stage_7&#45;&gt;ring_attn_0_3_stage_8</title>
<path fill="none" stroke="black" d="M4235,-18550.87C4235,-18550.87 4235,-18444.25 4235,-18444.25"/>
<polygon fill="black" stroke="black" points="4238.5,-18444.25 4235,-18434.25 4231.5,-18444.25 4238.5,-18444.25"/>
</g>
<!-- ring_attn_0_4_stage_7 -->
<g id="node403" class="node">
<title>ring_attn_0_4_stage_7</title>
<polygon fill="yellow" stroke="black" points="4822,-18687 4613,-18619 4822,-18551 5031,-18619 4822,-18687"/>
<text text-anchor="middle" x="4822" y="-18637.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-18622.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="4822" y="-18607.8" font-family="Times,serif" font-size="14.00">Q[4]×K[13]×V[13]</text>
<text text-anchor="middle" x="4822" y="-18592.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_3_stage_7&#45;&gt;ring_attn_0_4_stage_7 -->
<g id="edge1932" class="edge">
<title>ring_attn_0_3_stage_7&#45;&gt;ring_attn_0_4_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-18619C4444.02,-18619 4602.86,-18619 4602.86,-18619"/>
<polygon fill="red" stroke="red" points="4602.86,-18622.5 4612.86,-18619 4602.86,-18615.5 4602.86,-18622.5"/>
</g>
<!-- ring_attn_0_3_stage_8&#45;&gt;ring_attn_0_3_stage_9 -->
<g id="edge303" class="edge">
<title>ring_attn_0_3_stage_8&#45;&gt;ring_attn_0_3_stage_9</title>
<path fill="none" stroke="black" d="M4235,-18297.87C4235,-18297.87 4235,-18191.25 4235,-18191.25"/>
<polygon fill="black" stroke="black" points="4238.5,-18191.25 4235,-18181.25 4231.5,-18191.25 4238.5,-18191.25"/>
</g>
<!-- ring_attn_0_4_stage_8 -->
<g id="node404" class="node">
<title>ring_attn_0_4_stage_8</title>
<polygon fill="yellow" stroke="black" points="4822,-18434 4613,-18366 4822,-18298 5031,-18366 4822,-18434"/>
<text text-anchor="middle" x="4822" y="-18384.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-18369.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="4822" y="-18354.8" font-family="Times,serif" font-size="14.00">Q[4]×K[12]×V[12]</text>
<text text-anchor="middle" x="4822" y="-18339.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_3_stage_8&#45;&gt;ring_attn_0_4_stage_8 -->
<g id="edge1933" class="edge">
<title>ring_attn_0_3_stage_8&#45;&gt;ring_attn_0_4_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-18366C4444.02,-18366 4602.86,-18366 4602.86,-18366"/>
<polygon fill="red" stroke="red" points="4602.86,-18369.5 4612.86,-18366 4602.86,-18362.5 4602.86,-18369.5"/>
</g>
<!-- ring_attn_0_3_stage_9&#45;&gt;ring_attn_0_3_stage_10 -->
<g id="edge304" class="edge">
<title>ring_attn_0_3_stage_9&#45;&gt;ring_attn_0_3_stage_10</title>
<path fill="none" stroke="black" d="M4235,-18044.87C4235,-18044.87 4235,-17938.25 4235,-17938.25"/>
<polygon fill="black" stroke="black" points="4238.5,-17938.25 4235,-17928.25 4231.5,-17938.25 4238.5,-17938.25"/>
</g>
<!-- ring_attn_0_4_stage_9 -->
<g id="node405" class="node">
<title>ring_attn_0_4_stage_9</title>
<polygon fill="yellow" stroke="black" points="4822,-18181 4613,-18113 4822,-18045 5031,-18113 4822,-18181"/>
<text text-anchor="middle" x="4822" y="-18131.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-18116.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="4822" y="-18101.8" font-family="Times,serif" font-size="14.00">Q[4]×K[11]×V[11]</text>
<text text-anchor="middle" x="4822" y="-18086.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_3_stage_9&#45;&gt;ring_attn_0_4_stage_9 -->
<g id="edge1934" class="edge">
<title>ring_attn_0_3_stage_9&#45;&gt;ring_attn_0_4_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-18113C4444.02,-18113 4602.86,-18113 4602.86,-18113"/>
<polygon fill="red" stroke="red" points="4602.86,-18116.5 4612.86,-18113 4602.86,-18109.5 4602.86,-18116.5"/>
</g>
<!-- ring_attn_0_3_stage_10&#45;&gt;ring_attn_0_3_stage_11 -->
<g id="edge305" class="edge">
<title>ring_attn_0_3_stage_10&#45;&gt;ring_attn_0_3_stage_11</title>
<path fill="none" stroke="black" d="M4235,-17791.87C4235,-17791.87 4235,-17685.25 4235,-17685.25"/>
<polygon fill="black" stroke="black" points="4238.5,-17685.25 4235,-17675.25 4231.5,-17685.25 4238.5,-17685.25"/>
</g>
<!-- ring_attn_0_4_stage_10 -->
<g id="node406" class="node">
<title>ring_attn_0_4_stage_10</title>
<polygon fill="yellow" stroke="black" points="4822,-17928 4613,-17860 4822,-17792 5031,-17860 4822,-17928"/>
<text text-anchor="middle" x="4822" y="-17878.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-17863.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="4822" y="-17848.8" font-family="Times,serif" font-size="14.00">Q[4]×K[10]×V[10]</text>
<text text-anchor="middle" x="4822" y="-17833.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_3_stage_10&#45;&gt;ring_attn_0_4_stage_10 -->
<g id="edge1935" class="edge">
<title>ring_attn_0_3_stage_10&#45;&gt;ring_attn_0_4_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-17860C4444.02,-17860 4602.86,-17860 4602.86,-17860"/>
<polygon fill="red" stroke="red" points="4602.86,-17863.5 4612.86,-17860 4602.86,-17856.5 4602.86,-17863.5"/>
</g>
<!-- ring_attn_0_3_stage_11&#45;&gt;ring_attn_0_3_stage_12 -->
<g id="edge306" class="edge">
<title>ring_attn_0_3_stage_11&#45;&gt;ring_attn_0_3_stage_12</title>
<path fill="none" stroke="black" d="M4235,-17538.87C4235,-17538.87 4235,-17432.25 4235,-17432.25"/>
<polygon fill="black" stroke="black" points="4238.5,-17432.25 4235,-17422.25 4231.5,-17432.25 4238.5,-17432.25"/>
</g>
<!-- ring_attn_0_4_stage_11 -->
<g id="node407" class="node">
<title>ring_attn_0_4_stage_11</title>
<polygon fill="yellow" stroke="black" points="4822,-17675 4613,-17607 4822,-17539 5031,-17607 4822,-17675"/>
<text text-anchor="middle" x="4822" y="-17625.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-17610.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="4822" y="-17595.8" font-family="Times,serif" font-size="14.00">Q[4]×K[9]×V[9]</text>
<text text-anchor="middle" x="4822" y="-17580.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_3_stage_11&#45;&gt;ring_attn_0_4_stage_11 -->
<g id="edge1936" class="edge">
<title>ring_attn_0_3_stage_11&#45;&gt;ring_attn_0_4_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-17607C4444.02,-17607 4602.86,-17607 4602.86,-17607"/>
<polygon fill="red" stroke="red" points="4602.86,-17610.5 4612.86,-17607 4602.86,-17603.5 4602.86,-17610.5"/>
</g>
<!-- ring_attn_0_3_stage_12&#45;&gt;ring_attn_0_3_stage_13 -->
<g id="edge307" class="edge">
<title>ring_attn_0_3_stage_12&#45;&gt;ring_attn_0_3_stage_13</title>
<path fill="none" stroke="black" d="M4235,-17285.87C4235,-17285.87 4235,-17179.25 4235,-17179.25"/>
<polygon fill="black" stroke="black" points="4238.5,-17179.25 4235,-17169.25 4231.5,-17179.25 4238.5,-17179.25"/>
</g>
<!-- ring_attn_0_4_stage_12 -->
<g id="node408" class="node">
<title>ring_attn_0_4_stage_12</title>
<polygon fill="yellow" stroke="black" points="4822,-17422 4613,-17354 4822,-17286 5031,-17354 4822,-17422"/>
<text text-anchor="middle" x="4822" y="-17372.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-17357.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="4822" y="-17342.8" font-family="Times,serif" font-size="14.00">Q[4]×K[8]×V[8]</text>
<text text-anchor="middle" x="4822" y="-17327.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_3_stage_12&#45;&gt;ring_attn_0_4_stage_12 -->
<g id="edge1937" class="edge">
<title>ring_attn_0_3_stage_12&#45;&gt;ring_attn_0_4_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-17354C4444.02,-17354 4602.86,-17354 4602.86,-17354"/>
<polygon fill="red" stroke="red" points="4602.86,-17357.5 4612.86,-17354 4602.86,-17350.5 4602.86,-17357.5"/>
</g>
<!-- ring_attn_0_3_stage_13&#45;&gt;ring_attn_0_3_stage_14 -->
<g id="edge308" class="edge">
<title>ring_attn_0_3_stage_13&#45;&gt;ring_attn_0_3_stage_14</title>
<path fill="none" stroke="black" d="M4235,-17032.87C4235,-17032.87 4235,-16926.25 4235,-16926.25"/>
<polygon fill="black" stroke="black" points="4238.5,-16926.25 4235,-16916.25 4231.5,-16926.25 4238.5,-16926.25"/>
</g>
<!-- ring_attn_0_4_stage_13 -->
<g id="node409" class="node">
<title>ring_attn_0_4_stage_13</title>
<polygon fill="yellow" stroke="black" points="4822,-17169 4613,-17101 4822,-17033 5031,-17101 4822,-17169"/>
<text text-anchor="middle" x="4822" y="-17119.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-17104.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="4822" y="-17089.8" font-family="Times,serif" font-size="14.00">Q[4]×K[7]×V[7]</text>
<text text-anchor="middle" x="4822" y="-17074.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_3_stage_13&#45;&gt;ring_attn_0_4_stage_13 -->
<g id="edge1938" class="edge">
<title>ring_attn_0_3_stage_13&#45;&gt;ring_attn_0_4_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-17101C4444.02,-17101 4602.86,-17101 4602.86,-17101"/>
<polygon fill="red" stroke="red" points="4602.86,-17104.5 4612.86,-17101 4602.86,-17097.5 4602.86,-17104.5"/>
</g>
<!-- ring_attn_0_3_stage_14&#45;&gt;ring_attn_0_3_stage_15 -->
<g id="edge309" class="edge">
<title>ring_attn_0_3_stage_14&#45;&gt;ring_attn_0_3_stage_15</title>
<path fill="none" stroke="black" d="M4235,-16779.87C4235,-16779.87 4235,-16673.25 4235,-16673.25"/>
<polygon fill="black" stroke="black" points="4238.5,-16673.25 4235,-16663.25 4231.5,-16673.25 4238.5,-16673.25"/>
</g>
<!-- ring_attn_0_4_stage_14 -->
<g id="node410" class="node">
<title>ring_attn_0_4_stage_14</title>
<polygon fill="yellow" stroke="black" points="4822,-16916 4613,-16848 4822,-16780 5031,-16848 4822,-16916"/>
<text text-anchor="middle" x="4822" y="-16866.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-16851.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="4822" y="-16836.8" font-family="Times,serif" font-size="14.00">Q[4]×K[6]×V[6]</text>
<text text-anchor="middle" x="4822" y="-16821.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_3_stage_14&#45;&gt;ring_attn_0_4_stage_14 -->
<g id="edge1939" class="edge">
<title>ring_attn_0_3_stage_14&#45;&gt;ring_attn_0_4_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-16848C4444.02,-16848 4602.86,-16848 4602.86,-16848"/>
<polygon fill="red" stroke="red" points="4602.86,-16851.5 4612.86,-16848 4602.86,-16844.5 4602.86,-16851.5"/>
</g>
<!-- attn_out_0_3 -->
<g id="node314" class="node">
<title>attn_out_0_3</title>
<polygon fill="none" stroke="black" points="4304.5,-16454 4165.5,-16454 4165.5,-16401 4304.5,-16401 4304.5,-16454"/>
<text text-anchor="middle" x="4235" y="-16438.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="4235" y="-16423.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="4235" y="-16408.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_0_3_stage_15&#45;&gt;attn_out_0_3 -->
<g id="edge310" class="edge">
<title>ring_attn_0_3_stage_15&#45;&gt;attn_out_0_3</title>
<path fill="none" stroke="black" d="M4235,-16526.87C4235,-16526.87 4235,-16464.18 4235,-16464.18"/>
<polygon fill="black" stroke="black" points="4238.5,-16464.18 4235,-16454.18 4231.5,-16464.18 4238.5,-16464.18"/>
</g>
<!-- ring_attn_0_4_stage_15 -->
<g id="node411" class="node">
<title>ring_attn_0_4_stage_15</title>
<polygon fill="yellow" stroke="black" points="4822,-16663 4613,-16595 4822,-16527 5031,-16595 4822,-16663"/>
<text text-anchor="middle" x="4822" y="-16613.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-16598.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="4822" y="-16583.8" font-family="Times,serif" font-size="14.00">Q[4]×K[5]×V[5]</text>
<text text-anchor="middle" x="4822" y="-16568.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_3_stage_15&#45;&gt;ring_attn_0_4_stage_15 -->
<g id="edge1940" class="edge">
<title>ring_attn_0_3_stage_15&#45;&gt;ring_attn_0_4_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-16595C4444.02,-16595 4602.86,-16595 4602.86,-16595"/>
<polygon fill="red" stroke="red" points="4602.86,-16598.5 4612.86,-16595 4602.86,-16591.5 4602.86,-16598.5"/>
</g>
<!-- attn_residual_0_3 -->
<g id="node315" class="node">
<title>attn_residual_0_3</title>
<ellipse fill="none" stroke="black" cx="4235" cy="-16301" rx="105.5" ry="27"/>
<text text-anchor="middle" x="4235" y="-16304.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="4235" y="-16289.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_0_3&#45;&gt;attn_residual_0_3 -->
<g id="edge311" class="edge">
<title>attn_out_0_3&#45;&gt;attn_residual_0_3</title>
<path fill="none" stroke="black" d="M4235,-16400.98C4235,-16400.98 4235,-16338.36 4235,-16338.36"/>
<polygon fill="black" stroke="black" points="4238.5,-16338.36 4235,-16328.36 4231.5,-16338.36 4238.5,-16338.36"/>
</g>
<!-- gate_0_3 -->
<g id="node316" class="node">
<title>gate_0_3</title>
<ellipse fill="orange" stroke="black" cx="4235" cy="-16163.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="4235" y="-16174.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="4235" y="-16159.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="4235" y="-16144.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_0_3&#45;&gt;gate_0_3 -->
<g id="edge312" class="edge">
<title>attn_residual_0_3&#45;&gt;gate_0_3</title>
<path fill="none" stroke="black" d="M4235,-16273.83C4235,-16273.83 4235,-16211.02 4235,-16211.02"/>
<polygon fill="black" stroke="black" points="4238.5,-16211.02 4235,-16201.02 4231.5,-16211.02 4238.5,-16211.02"/>
</g>
<!-- gate_0_3&#45;&gt;expert_0_0_0 -->
<g id="edge1941" class="edge">
<title>gate_0_3&#45;&gt;expert_0_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4137.94,-16148.61C4137.94,-16130.41 4137.94,-16102 4137.94,-16102 4137.94,-16102 342.07,-16102 342.07,-16102 342.07,-16102 342.07,-16004.07 342.07,-16004.07"/>
<polygon fill="blue" stroke="blue" points="345.57,-16004.07 342.07,-15994.07 338.57,-16004.07 345.57,-16004.07"/>
<text text-anchor="middle" x="16826.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="16826.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU3→GPU0</text>
<text text-anchor="middle" x="16826.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="16826.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_3&#45;&gt;expert_0_1_0 -->
<g id="edge1942" class="edge">
<title>gate_0_3&#45;&gt;expert_0_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4154.82,-16138.78C4154.82,-16129.43 4154.82,-16121 4154.82,-16121 4154.82,-16121 3176.14,-16121 3176.14,-16121 3176.14,-16121 3176.14,-16004.24 3176.14,-16004.24"/>
<polygon fill="blue" stroke="blue" points="3179.64,-16004.24 3176.14,-15994.24 3172.64,-16004.24 3179.64,-16004.24"/>
<text text-anchor="middle" x="17000.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17000.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU3→GPU1</text>
<text text-anchor="middle" x="17000.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17000.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_3&#45;&gt;expert_0_2_0 -->
<g id="edge1943" class="edge">
<title>gate_0_3&#45;&gt;expert_0_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4135.3,-16176C3995.46,-16176 3758,-16176 3758,-16176 3758,-16176 3758,-16004.33 3758,-16004.33"/>
<polygon fill="blue" stroke="blue" points="3761.5,-16004.33 3758,-15994.33 3754.5,-16004.33 3761.5,-16004.33"/>
<text text-anchor="middle" x="17174.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17174.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU3→GPU2</text>
<text text-anchor="middle" x="17174.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17174.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_3&#45;&gt;expert_0_3_0 -->
<g id="edge313" class="edge">
<title>gate_0_3&#45;&gt;expert_0_3_0</title>
<path fill="none" stroke="black" d="M4163.26,-16135.83C4163.26,-16135.83 4163.26,-16004.08 4163.26,-16004.08"/>
<polygon fill="black" stroke="black" points="4166.76,-16004.08 4163.26,-15994.08 4159.76,-16004.08 4166.76,-16004.08"/>
</g>
<!-- gate_0_3&#45;&gt;expert_0_4_0 -->
<g id="edge1944" class="edge">
<title>gate_0_3&#45;&gt;expert_0_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4334.52,-16151C4474.09,-16151 4711.1,-16151 4711.1,-16151 4711.1,-16151 4711.1,-16004.18 4711.1,-16004.18"/>
<polygon fill="blue" stroke="blue" points="4714.6,-16004.18 4711.1,-15994.18 4707.6,-16004.18 4714.6,-16004.18"/>
<text text-anchor="middle" x="17348.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17348.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU3→GPU4</text>
<text text-anchor="middle" x="17348.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17348.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_3&#45;&gt;expert_0_5_0 -->
<g id="edge1945" class="edge">
<title>gate_0_3&#45;&gt;expert_0_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4247.66,-16126.12C4247.66,-16114.65 4247.66,-16105 4247.66,-16105 4247.66,-16105 5296.75,-16105 5296.75,-16105 5296.75,-16105 5296.75,-16004.01 5296.75,-16004.01"/>
<polygon fill="blue" stroke="blue" points="5300.25,-16004.01 5296.75,-15994.01 5293.25,-16004.01 5300.25,-16004.01"/>
<text text-anchor="middle" x="17522.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17522.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU3→GPU5</text>
<text text-anchor="middle" x="17522.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17522.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_3&#45;&gt;expert_0_6_0 -->
<g id="edge1946" class="edge">
<title>gate_0_3&#45;&gt;expert_0_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4256.1,-16126.73C4256.1,-16112.24 4256.1,-16099 4256.1,-16099 4256.1,-16099 5879.7,-16099 5879.7,-16099 5879.7,-16099 5879.7,-16004.11 5879.7,-16004.11"/>
<polygon fill="blue" stroke="blue" points="5883.2,-16004.11 5879.7,-15994.11 5876.2,-16004.11 5883.2,-16004.11"/>
<text text-anchor="middle" x="17696.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17696.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU3→GPU6</text>
<text text-anchor="middle" x="17696.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17696.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_3&#45;&gt;expert_0_7_0 -->
<g id="edge1947" class="edge">
<title>gate_0_3&#45;&gt;expert_0_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4264.54,-16127.18C4264.54,-16108.66 4264.54,-16090 4264.54,-16090 4264.54,-16090 6537.79,-16090 6537.79,-16090 6537.79,-16090 6537.79,-16004.08 6537.79,-16004.08"/>
<polygon fill="blue" stroke="blue" points="6541.29,-16004.08 6537.79,-15994.08 6534.29,-16004.08 6541.29,-16004.08"/>
<text text-anchor="middle" x="17870.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17870.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU3→GPU7</text>
<text text-anchor="middle" x="17870.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17870.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_3&#45;&gt;expert_0_8_0 -->
<g id="edge1948" class="edge">
<title>gate_0_3&#45;&gt;expert_0_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4272.98,-16128.38C4272.98,-16107.48 4272.98,-16085 4272.98,-16085 4272.98,-16085 7119.54,-16085 7119.54,-16085 7119.54,-16085 7119.54,-16004.16 7119.54,-16004.16"/>
<polygon fill="blue" stroke="blue" points="7123.04,-16004.16 7119.54,-15994.16 7116.04,-16004.16 7123.04,-16004.16"/>
<text text-anchor="middle" x="18044.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18044.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU3→GPU8</text>
<text text-anchor="middle" x="18044.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18044.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_3&#45;&gt;expert_0_9_0 -->
<g id="edge1949" class="edge">
<title>gate_0_3&#45;&gt;expert_0_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4281.42,-16129.65C4281.42,-16099.8 4281.42,-16061 4281.42,-16061 4281.42,-16061 7699.45,-16061 7699.45,-16061 7699.45,-16061 7699.45,-16004.04 7699.45,-16004.04"/>
<polygon fill="blue" stroke="blue" points="7702.95,-16004.04 7699.45,-15994.04 7695.95,-16004.04 7702.95,-16004.04"/>
<text text-anchor="middle" x="18218.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18218.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU3→GPU9</text>
<text text-anchor="middle" x="18218.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18218.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_3&#45;&gt;expert_0_10_0 -->
<g id="edge1950" class="edge">
<title>gate_0_3&#45;&gt;expert_0_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4289.86,-16131.44C4289.86,-16094.55 4289.86,-16039 4289.86,-16039 4289.86,-16039 8278.69,-16039 8278.69,-16039 8278.69,-16039 8278.69,-16004.12 8278.69,-16004.12"/>
<polygon fill="blue" stroke="blue" points="8282.19,-16004.12 8278.69,-15994.12 8275.19,-16004.12 8282.19,-16004.12"/>
<text text-anchor="middle" x="18392.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18392.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU3→GPU10</text>
<text text-anchor="middle" x="18392.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18392.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_3&#45;&gt;expert_0_11_0 -->
<g id="edge1951" class="edge">
<title>gate_0_3&#45;&gt;expert_0_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4298.3,-16133.37C4298.3,-16095.39 4298.3,-16035 4298.3,-16035 4298.3,-16035 8865.69,-16035 8865.69,-16035 8865.69,-16035 8865.69,-16004.18 8865.69,-16004.18"/>
<polygon fill="blue" stroke="blue" points="8869.19,-16004.18 8865.69,-15994.18 8862.19,-16004.18 8869.19,-16004.18"/>
<text text-anchor="middle" x="18566.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18566.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU3→GPU11</text>
<text text-anchor="middle" x="18566.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18566.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_3&#45;&gt;expert_0_12_0 -->
<g id="edge1952" class="edge">
<title>gate_0_3&#45;&gt;expert_0_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4306.74,-16135.96C4306.74,-16096.61 4306.74,-16029 4306.74,-16029 4306.74,-16029 9467.54,-16029 9467.54,-16029 9467.54,-16029 9467.54,-16004.3 9467.54,-16004.3"/>
<polygon fill="blue" stroke="blue" points="9471.04,-16004.3 9467.54,-15994.3 9464.04,-16004.3 9471.04,-16004.3"/>
<text text-anchor="middle" x="18740.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18740.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU3→GPU12</text>
<text text-anchor="middle" x="18740.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18740.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_3&#45;&gt;expert_0_13_0 -->
<g id="edge1953" class="edge">
<title>gate_0_3&#45;&gt;expert_0_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4315.18,-16138.83C4315.18,-16097.8 4315.18,-16020 4315.18,-16020 4315.18,-16020 10067.02,-16020 10067.02,-16020 10067.02,-16020 10067.02,-16004.06 10067.02,-16004.06"/>
<polygon fill="blue" stroke="blue" points="10070.52,-16004.06 10067.02,-15994.06 10063.52,-16004.06 10070.52,-16004.06"/>
<text text-anchor="middle" x="18914.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18914.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU3→GPU13</text>
<text text-anchor="middle" x="18914.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18914.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_3&#45;&gt;expert_0_14_0 -->
<g id="edge1954" class="edge">
<title>gate_0_3&#45;&gt;expert_0_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4323.62,-16142.96C4323.62,-16102.85 4323.62,-16018 4323.62,-16018 4323.62,-16018 10666.88,-16018 10666.88,-16018 10666.88,-16018 10666.88,-16004.23 10666.88,-16004.23"/>
<polygon fill="blue" stroke="blue" points="10670.38,-16004.23 10666.88,-15994.23 10663.38,-16004.23 10670.38,-16004.23"/>
<text text-anchor="middle" x="19088.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19088.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU3→GPU14</text>
<text text-anchor="middle" x="19088.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19088.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_3&#45;&gt;expert_0_15_0 -->
<g id="edge1955" class="edge">
<title>gate_0_3&#45;&gt;expert_0_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4332.06,-16148.8C4332.06,-16110.93 4332.06,-16013 4332.06,-16013 4332.06,-16013 11262.34,-16013 11262.34,-16013 11262.34,-16013 11262.34,-16004.23 11262.34,-16004.23"/>
<polygon fill="blue" stroke="blue" points="11265.84,-16004.23 11262.34,-15994.23 11258.84,-16004.23 11265.84,-16004.23"/>
<text text-anchor="middle" x="19262.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19262.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU3→GPU15</text>
<text text-anchor="middle" x="19262.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19262.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_3 -->
<g id="node318" class="node">
<title>expert_reduce_0_3</title>
<ellipse fill="none" stroke="black" cx="4235" cy="-15830.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="4235" y="-15841.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="4235" y="-15826.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="4235" y="-15811.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_3_0&#45;&gt;expert_reduce_0_3 -->
<g id="edge314" class="edge">
<title>expert_0_3_0&#45;&gt;expert_reduce_0_3</title>
<path fill="none" stroke="black" d="M4235,-15940.76C4235,-15940.76 4235,-15878.06 4235,-15878.06"/>
<polygon fill="black" stroke="black" points="4238.5,-15878.06 4235,-15868.06 4231.5,-15878.06 4238.5,-15878.06"/>
</g>
<!-- moe_residual_0_3 -->
<g id="node319" class="node">
<title>moe_residual_0_3</title>
<ellipse fill="none" stroke="black" cx="4235" cy="-15693" rx="105.5" ry="27"/>
<text text-anchor="middle" x="4235" y="-15696.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="4235" y="-15681.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_3&#45;&gt;moe_residual_0_3 -->
<g id="edge315" class="edge">
<title>expert_reduce_0_3&#45;&gt;moe_residual_0_3</title>
<path fill="none" stroke="black" d="M4235,-15792.93C4235,-15792.93 4235,-15730.06 4235,-15730.06"/>
<polygon fill="black" stroke="black" points="4238.5,-15730.06 4235,-15720.06 4231.5,-15730.06 4238.5,-15730.06"/>
</g>
<!-- qkv_proj_1_3 -->
<g id="node320" class="node">
<title>qkv_proj_1_3</title>
<polygon fill="none" stroke="black" points="4317.5,-15593 4152.5,-15593 4152.5,-15540 4317.5,-15540 4317.5,-15593"/>
<text text-anchor="middle" x="4235" y="-15577.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="4235" y="-15562.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="4235" y="-15547.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_0_3&#45;&gt;qkv_proj_1_3 -->
<g id="edge316" class="edge">
<title>moe_residual_0_3&#45;&gt;qkv_proj_1_3</title>
<path fill="none" stroke="black" d="M4235,-15665.86C4235,-15665.86 4235,-15603.16 4235,-15603.16"/>
<polygon fill="black" stroke="black" points="4238.5,-15603.16 4235,-15593.16 4231.5,-15603.16 4238.5,-15603.16"/>
</g>
<!-- qkv_reshape_1_3 -->
<g id="node321" class="node">
<title>qkv_reshape_1_3</title>
<ellipse fill="none" stroke="black" cx="4235" cy="-15440" rx="148" ry="27"/>
<text text-anchor="middle" x="4235" y="-15443.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="4235" y="-15428.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_1_3&#45;&gt;qkv_reshape_1_3 -->
<g id="edge317" class="edge">
<title>qkv_proj_1_3&#45;&gt;qkv_reshape_1_3</title>
<path fill="none" stroke="black" d="M4235,-15539.98C4235,-15539.98 4235,-15477.36 4235,-15477.36"/>
<polygon fill="black" stroke="black" points="4238.5,-15477.36 4235,-15467.36 4231.5,-15477.36 4238.5,-15477.36"/>
</g>
<!-- qkv_reshape_1_3&#45;&gt;ring_attn_1_3_stage_0 -->
<g id="edge318" class="edge">
<title>qkv_reshape_1_3&#45;&gt;ring_attn_1_3_stage_0</title>
<path fill="none" stroke="black" d="M4235,-15412.72C4235,-15412.72 4235,-15306.16 4235,-15306.16"/>
<polygon fill="black" stroke="black" points="4238.5,-15306.16 4235,-15296.16 4231.5,-15306.16 4238.5,-15306.16"/>
</g>
<!-- ring_attn_1_3_stage_0&#45;&gt;ring_attn_1_3_stage_1 -->
<g id="edge319" class="edge">
<title>ring_attn_1_3_stage_0&#45;&gt;ring_attn_1_3_stage_1</title>
<path fill="none" stroke="black" d="M4235,-15159.87C4235,-15159.87 4235,-15053.25 4235,-15053.25"/>
<polygon fill="black" stroke="black" points="4238.5,-15053.25 4235,-15043.25 4231.5,-15053.25 4238.5,-15053.25"/>
</g>
<!-- ring_attn_1_4_stage_0 -->
<g id="node420" class="node">
<title>ring_attn_1_4_stage_0</title>
<polygon fill="yellow" stroke="black" points="4822,-15296 4613,-15228 4822,-15160 5031,-15228 4822,-15296"/>
<text text-anchor="middle" x="4822" y="-15246.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-15231.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="4822" y="-15216.8" font-family="Times,serif" font-size="14.00">Q[4]×K[4]×V[4]</text>
<text text-anchor="middle" x="4822" y="-15201.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_3_stage_0&#45;&gt;ring_attn_1_4_stage_0 -->
<g id="edge1956" class="edge">
<title>ring_attn_1_3_stage_0&#45;&gt;ring_attn_1_4_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-15228C4444.02,-15228 4602.86,-15228 4602.86,-15228"/>
<polygon fill="red" stroke="red" points="4602.86,-15231.5 4612.86,-15228 4602.86,-15224.5 4602.86,-15231.5"/>
</g>
<!-- ring_attn_1_3_stage_1&#45;&gt;ring_attn_1_3_stage_2 -->
<g id="edge320" class="edge">
<title>ring_attn_1_3_stage_1&#45;&gt;ring_attn_1_3_stage_2</title>
<path fill="none" stroke="black" d="M4235,-14906.87C4235,-14906.87 4235,-14800.25 4235,-14800.25"/>
<polygon fill="black" stroke="black" points="4238.5,-14800.25 4235,-14790.25 4231.5,-14800.25 4238.5,-14800.25"/>
</g>
<!-- ring_attn_1_4_stage_1 -->
<g id="node421" class="node">
<title>ring_attn_1_4_stage_1</title>
<polygon fill="yellow" stroke="black" points="4822,-15043 4613,-14975 4822,-14907 5031,-14975 4822,-15043"/>
<text text-anchor="middle" x="4822" y="-14993.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-14978.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="4822" y="-14963.8" font-family="Times,serif" font-size="14.00">Q[4]×K[3]×V[3]</text>
<text text-anchor="middle" x="4822" y="-14948.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_3_stage_1&#45;&gt;ring_attn_1_4_stage_1 -->
<g id="edge1957" class="edge">
<title>ring_attn_1_3_stage_1&#45;&gt;ring_attn_1_4_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-14975C4444.02,-14975 4602.86,-14975 4602.86,-14975"/>
<polygon fill="red" stroke="red" points="4602.86,-14978.5 4612.86,-14975 4602.86,-14971.5 4602.86,-14978.5"/>
</g>
<!-- ring_attn_1_3_stage_2&#45;&gt;ring_attn_1_3_stage_3 -->
<g id="edge321" class="edge">
<title>ring_attn_1_3_stage_2&#45;&gt;ring_attn_1_3_stage_3</title>
<path fill="none" stroke="black" d="M4235,-14653.87C4235,-14653.87 4235,-14547.25 4235,-14547.25"/>
<polygon fill="black" stroke="black" points="4238.5,-14547.25 4235,-14537.25 4231.5,-14547.25 4238.5,-14547.25"/>
</g>
<!-- ring_attn_1_4_stage_2 -->
<g id="node422" class="node">
<title>ring_attn_1_4_stage_2</title>
<polygon fill="yellow" stroke="black" points="4822,-14790 4613,-14722 4822,-14654 5031,-14722 4822,-14790"/>
<text text-anchor="middle" x="4822" y="-14740.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-14725.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="4822" y="-14710.8" font-family="Times,serif" font-size="14.00">Q[4]×K[2]×V[2]</text>
<text text-anchor="middle" x="4822" y="-14695.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_3_stage_2&#45;&gt;ring_attn_1_4_stage_2 -->
<g id="edge1958" class="edge">
<title>ring_attn_1_3_stage_2&#45;&gt;ring_attn_1_4_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-14722C4444.02,-14722 4602.86,-14722 4602.86,-14722"/>
<polygon fill="red" stroke="red" points="4602.86,-14725.5 4612.86,-14722 4602.86,-14718.5 4602.86,-14725.5"/>
</g>
<!-- ring_attn_1_3_stage_3&#45;&gt;ring_attn_1_3_stage_4 -->
<g id="edge322" class="edge">
<title>ring_attn_1_3_stage_3&#45;&gt;ring_attn_1_3_stage_4</title>
<path fill="none" stroke="black" d="M4235,-14400.87C4235,-14400.87 4235,-14294.25 4235,-14294.25"/>
<polygon fill="black" stroke="black" points="4238.5,-14294.25 4235,-14284.25 4231.5,-14294.25 4238.5,-14294.25"/>
</g>
<!-- ring_attn_1_4_stage_3 -->
<g id="node423" class="node">
<title>ring_attn_1_4_stage_3</title>
<polygon fill="yellow" stroke="black" points="4822,-14537 4613,-14469 4822,-14401 5031,-14469 4822,-14537"/>
<text text-anchor="middle" x="4822" y="-14487.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-14472.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="4822" y="-14457.8" font-family="Times,serif" font-size="14.00">Q[4]×K[1]×V[1]</text>
<text text-anchor="middle" x="4822" y="-14442.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_3_stage_3&#45;&gt;ring_attn_1_4_stage_3 -->
<g id="edge1959" class="edge">
<title>ring_attn_1_3_stage_3&#45;&gt;ring_attn_1_4_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-14469C4444.02,-14469 4602.86,-14469 4602.86,-14469"/>
<polygon fill="red" stroke="red" points="4602.86,-14472.5 4612.86,-14469 4602.86,-14465.5 4602.86,-14472.5"/>
</g>
<!-- ring_attn_1_3_stage_4&#45;&gt;ring_attn_1_3_stage_5 -->
<g id="edge323" class="edge">
<title>ring_attn_1_3_stage_4&#45;&gt;ring_attn_1_3_stage_5</title>
<path fill="none" stroke="black" d="M4235,-14147.87C4235,-14147.87 4235,-14041.25 4235,-14041.25"/>
<polygon fill="black" stroke="black" points="4238.5,-14041.25 4235,-14031.25 4231.5,-14041.25 4238.5,-14041.25"/>
</g>
<!-- ring_attn_1_4_stage_4 -->
<g id="node424" class="node">
<title>ring_attn_1_4_stage_4</title>
<polygon fill="yellow" stroke="black" points="4822,-14284 4613,-14216 4822,-14148 5031,-14216 4822,-14284"/>
<text text-anchor="middle" x="4822" y="-14234.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-14219.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="4822" y="-14204.8" font-family="Times,serif" font-size="14.00">Q[4]×K[0]×V[0]</text>
<text text-anchor="middle" x="4822" y="-14189.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_3_stage_4&#45;&gt;ring_attn_1_4_stage_4 -->
<g id="edge1960" class="edge">
<title>ring_attn_1_3_stage_4&#45;&gt;ring_attn_1_4_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-14216C4444.02,-14216 4602.86,-14216 4602.86,-14216"/>
<polygon fill="red" stroke="red" points="4602.86,-14219.5 4612.86,-14216 4602.86,-14212.5 4602.86,-14219.5"/>
</g>
<!-- ring_attn_1_3_stage_5&#45;&gt;ring_attn_1_3_stage_6 -->
<g id="edge324" class="edge">
<title>ring_attn_1_3_stage_5&#45;&gt;ring_attn_1_3_stage_6</title>
<path fill="none" stroke="black" d="M4235,-13894.87C4235,-13894.87 4235,-13788.25 4235,-13788.25"/>
<polygon fill="black" stroke="black" points="4238.5,-13788.25 4235,-13778.25 4231.5,-13788.25 4238.5,-13788.25"/>
</g>
<!-- ring_attn_1_4_stage_5 -->
<g id="node425" class="node">
<title>ring_attn_1_4_stage_5</title>
<polygon fill="yellow" stroke="black" points="4822,-14031 4613,-13963 4822,-13895 5031,-13963 4822,-14031"/>
<text text-anchor="middle" x="4822" y="-13981.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-13966.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="4822" y="-13951.8" font-family="Times,serif" font-size="14.00">Q[4]×K[15]×V[15]</text>
<text text-anchor="middle" x="4822" y="-13936.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_3_stage_5&#45;&gt;ring_attn_1_4_stage_5 -->
<g id="edge1961" class="edge">
<title>ring_attn_1_3_stage_5&#45;&gt;ring_attn_1_4_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-13963C4444.02,-13963 4602.86,-13963 4602.86,-13963"/>
<polygon fill="red" stroke="red" points="4602.86,-13966.5 4612.86,-13963 4602.86,-13959.5 4602.86,-13966.5"/>
</g>
<!-- ring_attn_1_3_stage_6&#45;&gt;ring_attn_1_3_stage_7 -->
<g id="edge325" class="edge">
<title>ring_attn_1_3_stage_6&#45;&gt;ring_attn_1_3_stage_7</title>
<path fill="none" stroke="black" d="M4235,-13641.87C4235,-13641.87 4235,-13535.25 4235,-13535.25"/>
<polygon fill="black" stroke="black" points="4238.5,-13535.25 4235,-13525.25 4231.5,-13535.25 4238.5,-13535.25"/>
</g>
<!-- ring_attn_1_4_stage_6 -->
<g id="node426" class="node">
<title>ring_attn_1_4_stage_6</title>
<polygon fill="yellow" stroke="black" points="4822,-13778 4613,-13710 4822,-13642 5031,-13710 4822,-13778"/>
<text text-anchor="middle" x="4822" y="-13728.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-13713.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="4822" y="-13698.8" font-family="Times,serif" font-size="14.00">Q[4]×K[14]×V[14]</text>
<text text-anchor="middle" x="4822" y="-13683.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_3_stage_6&#45;&gt;ring_attn_1_4_stage_6 -->
<g id="edge1962" class="edge">
<title>ring_attn_1_3_stage_6&#45;&gt;ring_attn_1_4_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-13710C4444.02,-13710 4602.86,-13710 4602.86,-13710"/>
<polygon fill="red" stroke="red" points="4602.86,-13713.5 4612.86,-13710 4602.86,-13706.5 4602.86,-13713.5"/>
</g>
<!-- ring_attn_1_3_stage_7&#45;&gt;ring_attn_1_3_stage_8 -->
<g id="edge326" class="edge">
<title>ring_attn_1_3_stage_7&#45;&gt;ring_attn_1_3_stage_8</title>
<path fill="none" stroke="black" d="M4235,-13388.87C4235,-13388.87 4235,-13282.25 4235,-13282.25"/>
<polygon fill="black" stroke="black" points="4238.5,-13282.25 4235,-13272.25 4231.5,-13282.25 4238.5,-13282.25"/>
</g>
<!-- ring_attn_1_4_stage_7 -->
<g id="node427" class="node">
<title>ring_attn_1_4_stage_7</title>
<polygon fill="yellow" stroke="black" points="4822,-13525 4613,-13457 4822,-13389 5031,-13457 4822,-13525"/>
<text text-anchor="middle" x="4822" y="-13475.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-13460.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="4822" y="-13445.8" font-family="Times,serif" font-size="14.00">Q[4]×K[13]×V[13]</text>
<text text-anchor="middle" x="4822" y="-13430.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_3_stage_7&#45;&gt;ring_attn_1_4_stage_7 -->
<g id="edge1963" class="edge">
<title>ring_attn_1_3_stage_7&#45;&gt;ring_attn_1_4_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-13457C4444.02,-13457 4602.86,-13457 4602.86,-13457"/>
<polygon fill="red" stroke="red" points="4602.86,-13460.5 4612.86,-13457 4602.86,-13453.5 4602.86,-13460.5"/>
</g>
<!-- ring_attn_1_3_stage_8&#45;&gt;ring_attn_1_3_stage_9 -->
<g id="edge327" class="edge">
<title>ring_attn_1_3_stage_8&#45;&gt;ring_attn_1_3_stage_9</title>
<path fill="none" stroke="black" d="M4235,-13135.87C4235,-13135.87 4235,-13029.25 4235,-13029.25"/>
<polygon fill="black" stroke="black" points="4238.5,-13029.25 4235,-13019.25 4231.5,-13029.25 4238.5,-13029.25"/>
</g>
<!-- ring_attn_1_4_stage_8 -->
<g id="node428" class="node">
<title>ring_attn_1_4_stage_8</title>
<polygon fill="yellow" stroke="black" points="4822,-13272 4613,-13204 4822,-13136 5031,-13204 4822,-13272"/>
<text text-anchor="middle" x="4822" y="-13222.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-13207.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="4822" y="-13192.8" font-family="Times,serif" font-size="14.00">Q[4]×K[12]×V[12]</text>
<text text-anchor="middle" x="4822" y="-13177.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_3_stage_8&#45;&gt;ring_attn_1_4_stage_8 -->
<g id="edge1964" class="edge">
<title>ring_attn_1_3_stage_8&#45;&gt;ring_attn_1_4_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-13204C4444.02,-13204 4602.86,-13204 4602.86,-13204"/>
<polygon fill="red" stroke="red" points="4602.86,-13207.5 4612.86,-13204 4602.86,-13200.5 4602.86,-13207.5"/>
</g>
<!-- ring_attn_1_3_stage_9&#45;&gt;ring_attn_1_3_stage_10 -->
<g id="edge328" class="edge">
<title>ring_attn_1_3_stage_9&#45;&gt;ring_attn_1_3_stage_10</title>
<path fill="none" stroke="black" d="M4235,-12882.87C4235,-12882.87 4235,-12776.25 4235,-12776.25"/>
<polygon fill="black" stroke="black" points="4238.5,-12776.25 4235,-12766.25 4231.5,-12776.25 4238.5,-12776.25"/>
</g>
<!-- ring_attn_1_4_stage_9 -->
<g id="node429" class="node">
<title>ring_attn_1_4_stage_9</title>
<polygon fill="yellow" stroke="black" points="4822,-13019 4613,-12951 4822,-12883 5031,-12951 4822,-13019"/>
<text text-anchor="middle" x="4822" y="-12969.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-12954.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="4822" y="-12939.8" font-family="Times,serif" font-size="14.00">Q[4]×K[11]×V[11]</text>
<text text-anchor="middle" x="4822" y="-12924.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_3_stage_9&#45;&gt;ring_attn_1_4_stage_9 -->
<g id="edge1965" class="edge">
<title>ring_attn_1_3_stage_9&#45;&gt;ring_attn_1_4_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-12951C4444.02,-12951 4602.86,-12951 4602.86,-12951"/>
<polygon fill="red" stroke="red" points="4602.86,-12954.5 4612.86,-12951 4602.86,-12947.5 4602.86,-12954.5"/>
</g>
<!-- ring_attn_1_3_stage_10&#45;&gt;ring_attn_1_3_stage_11 -->
<g id="edge329" class="edge">
<title>ring_attn_1_3_stage_10&#45;&gt;ring_attn_1_3_stage_11</title>
<path fill="none" stroke="black" d="M4235,-12629.87C4235,-12629.87 4235,-12523.25 4235,-12523.25"/>
<polygon fill="black" stroke="black" points="4238.5,-12523.25 4235,-12513.25 4231.5,-12523.25 4238.5,-12523.25"/>
</g>
<!-- ring_attn_1_4_stage_10 -->
<g id="node430" class="node">
<title>ring_attn_1_4_stage_10</title>
<polygon fill="yellow" stroke="black" points="4822,-12766 4613,-12698 4822,-12630 5031,-12698 4822,-12766"/>
<text text-anchor="middle" x="4822" y="-12716.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-12701.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="4822" y="-12686.8" font-family="Times,serif" font-size="14.00">Q[4]×K[10]×V[10]</text>
<text text-anchor="middle" x="4822" y="-12671.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_3_stage_10&#45;&gt;ring_attn_1_4_stage_10 -->
<g id="edge1966" class="edge">
<title>ring_attn_1_3_stage_10&#45;&gt;ring_attn_1_4_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-12698C4444.02,-12698 4602.86,-12698 4602.86,-12698"/>
<polygon fill="red" stroke="red" points="4602.86,-12701.5 4612.86,-12698 4602.86,-12694.5 4602.86,-12701.5"/>
</g>
<!-- ring_attn_1_3_stage_11&#45;&gt;ring_attn_1_3_stage_12 -->
<g id="edge330" class="edge">
<title>ring_attn_1_3_stage_11&#45;&gt;ring_attn_1_3_stage_12</title>
<path fill="none" stroke="black" d="M4235,-12376.87C4235,-12376.87 4235,-12270.25 4235,-12270.25"/>
<polygon fill="black" stroke="black" points="4238.5,-12270.25 4235,-12260.25 4231.5,-12270.25 4238.5,-12270.25"/>
</g>
<!-- ring_attn_1_4_stage_11 -->
<g id="node431" class="node">
<title>ring_attn_1_4_stage_11</title>
<polygon fill="yellow" stroke="black" points="4822,-12513 4613,-12445 4822,-12377 5031,-12445 4822,-12513"/>
<text text-anchor="middle" x="4822" y="-12463.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-12448.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="4822" y="-12433.8" font-family="Times,serif" font-size="14.00">Q[4]×K[9]×V[9]</text>
<text text-anchor="middle" x="4822" y="-12418.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_3_stage_11&#45;&gt;ring_attn_1_4_stage_11 -->
<g id="edge1967" class="edge">
<title>ring_attn_1_3_stage_11&#45;&gt;ring_attn_1_4_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-12445C4444.02,-12445 4602.86,-12445 4602.86,-12445"/>
<polygon fill="red" stroke="red" points="4602.86,-12448.5 4612.86,-12445 4602.86,-12441.5 4602.86,-12448.5"/>
</g>
<!-- ring_attn_1_3_stage_12&#45;&gt;ring_attn_1_3_stage_13 -->
<g id="edge331" class="edge">
<title>ring_attn_1_3_stage_12&#45;&gt;ring_attn_1_3_stage_13</title>
<path fill="none" stroke="black" d="M4235,-12123.87C4235,-12123.87 4235,-12017.25 4235,-12017.25"/>
<polygon fill="black" stroke="black" points="4238.5,-12017.25 4235,-12007.25 4231.5,-12017.25 4238.5,-12017.25"/>
</g>
<!-- ring_attn_1_4_stage_12 -->
<g id="node432" class="node">
<title>ring_attn_1_4_stage_12</title>
<polygon fill="yellow" stroke="black" points="4822,-12260 4613,-12192 4822,-12124 5031,-12192 4822,-12260"/>
<text text-anchor="middle" x="4822" y="-12210.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-12195.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="4822" y="-12180.8" font-family="Times,serif" font-size="14.00">Q[4]×K[8]×V[8]</text>
<text text-anchor="middle" x="4822" y="-12165.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_3_stage_12&#45;&gt;ring_attn_1_4_stage_12 -->
<g id="edge1968" class="edge">
<title>ring_attn_1_3_stage_12&#45;&gt;ring_attn_1_4_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-12192C4444.02,-12192 4602.86,-12192 4602.86,-12192"/>
<polygon fill="red" stroke="red" points="4602.86,-12195.5 4612.86,-12192 4602.86,-12188.5 4602.86,-12195.5"/>
</g>
<!-- ring_attn_1_3_stage_13&#45;&gt;ring_attn_1_3_stage_14 -->
<g id="edge332" class="edge">
<title>ring_attn_1_3_stage_13&#45;&gt;ring_attn_1_3_stage_14</title>
<path fill="none" stroke="black" d="M4235,-11870.87C4235,-11870.87 4235,-11764.25 4235,-11764.25"/>
<polygon fill="black" stroke="black" points="4238.5,-11764.25 4235,-11754.25 4231.5,-11764.25 4238.5,-11764.25"/>
</g>
<!-- ring_attn_1_4_stage_13 -->
<g id="node433" class="node">
<title>ring_attn_1_4_stage_13</title>
<polygon fill="yellow" stroke="black" points="4822,-12007 4613,-11939 4822,-11871 5031,-11939 4822,-12007"/>
<text text-anchor="middle" x="4822" y="-11957.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-11942.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="4822" y="-11927.8" font-family="Times,serif" font-size="14.00">Q[4]×K[7]×V[7]</text>
<text text-anchor="middle" x="4822" y="-11912.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_3_stage_13&#45;&gt;ring_attn_1_4_stage_13 -->
<g id="edge1969" class="edge">
<title>ring_attn_1_3_stage_13&#45;&gt;ring_attn_1_4_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-11939C4444.02,-11939 4602.86,-11939 4602.86,-11939"/>
<polygon fill="red" stroke="red" points="4602.86,-11942.5 4612.86,-11939 4602.86,-11935.5 4602.86,-11942.5"/>
</g>
<!-- ring_attn_1_3_stage_14&#45;&gt;ring_attn_1_3_stage_15 -->
<g id="edge333" class="edge">
<title>ring_attn_1_3_stage_14&#45;&gt;ring_attn_1_3_stage_15</title>
<path fill="none" stroke="black" d="M4235,-11617.87C4235,-11617.87 4235,-11511.25 4235,-11511.25"/>
<polygon fill="black" stroke="black" points="4238.5,-11511.25 4235,-11501.25 4231.5,-11511.25 4238.5,-11511.25"/>
</g>
<!-- ring_attn_1_4_stage_14 -->
<g id="node434" class="node">
<title>ring_attn_1_4_stage_14</title>
<polygon fill="yellow" stroke="black" points="4822,-11754 4613,-11686 4822,-11618 5031,-11686 4822,-11754"/>
<text text-anchor="middle" x="4822" y="-11704.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-11689.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="4822" y="-11674.8" font-family="Times,serif" font-size="14.00">Q[4]×K[6]×V[6]</text>
<text text-anchor="middle" x="4822" y="-11659.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_3_stage_14&#45;&gt;ring_attn_1_4_stage_14 -->
<g id="edge1970" class="edge">
<title>ring_attn_1_3_stage_14&#45;&gt;ring_attn_1_4_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-11686C4444.02,-11686 4602.86,-11686 4602.86,-11686"/>
<polygon fill="red" stroke="red" points="4602.86,-11689.5 4612.86,-11686 4602.86,-11682.5 4602.86,-11689.5"/>
</g>
<!-- attn_out_1_3 -->
<g id="node338" class="node">
<title>attn_out_1_3</title>
<polygon fill="none" stroke="black" points="4304.5,-11292 4165.5,-11292 4165.5,-11239 4304.5,-11239 4304.5,-11292"/>
<text text-anchor="middle" x="4235" y="-11276.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="4235" y="-11261.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="4235" y="-11246.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_1_3_stage_15&#45;&gt;attn_out_1_3 -->
<g id="edge334" class="edge">
<title>ring_attn_1_3_stage_15&#45;&gt;attn_out_1_3</title>
<path fill="none" stroke="black" d="M4235,-11364.87C4235,-11364.87 4235,-11302.18 4235,-11302.18"/>
<polygon fill="black" stroke="black" points="4238.5,-11302.18 4235,-11292.18 4231.5,-11302.18 4238.5,-11302.18"/>
</g>
<!-- ring_attn_1_4_stage_15 -->
<g id="node435" class="node">
<title>ring_attn_1_4_stage_15</title>
<polygon fill="yellow" stroke="black" points="4822,-11501 4613,-11433 4822,-11365 5031,-11433 4822,-11501"/>
<text text-anchor="middle" x="4822" y="-11451.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-11436.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="4822" y="-11421.8" font-family="Times,serif" font-size="14.00">Q[4]×K[5]×V[5]</text>
<text text-anchor="middle" x="4822" y="-11406.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_3_stage_15&#45;&gt;ring_attn_1_4_stage_15 -->
<g id="edge1971" class="edge">
<title>ring_attn_1_3_stage_15&#45;&gt;ring_attn_1_4_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-11433C4444.02,-11433 4602.86,-11433 4602.86,-11433"/>
<polygon fill="red" stroke="red" points="4602.86,-11436.5 4612.86,-11433 4602.86,-11429.5 4602.86,-11436.5"/>
</g>
<!-- attn_residual_1_3 -->
<g id="node339" class="node">
<title>attn_residual_1_3</title>
<ellipse fill="none" stroke="black" cx="4235" cy="-11139" rx="105.5" ry="27"/>
<text text-anchor="middle" x="4235" y="-11142.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="4235" y="-11127.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_1_3&#45;&gt;attn_residual_1_3 -->
<g id="edge335" class="edge">
<title>attn_out_1_3&#45;&gt;attn_residual_1_3</title>
<path fill="none" stroke="black" d="M4235,-11238.98C4235,-11238.98 4235,-11176.36 4235,-11176.36"/>
<polygon fill="black" stroke="black" points="4238.5,-11176.36 4235,-11166.36 4231.5,-11176.36 4238.5,-11176.36"/>
</g>
<!-- gate_1_3 -->
<g id="node340" class="node">
<title>gate_1_3</title>
<ellipse fill="orange" stroke="black" cx="4235" cy="-11001.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="4235" y="-11012.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="4235" y="-10997.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="4235" y="-10982.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_1_3&#45;&gt;gate_1_3 -->
<g id="edge336" class="edge">
<title>attn_residual_1_3&#45;&gt;gate_1_3</title>
<path fill="none" stroke="black" d="M4235,-11111.83C4235,-11111.83 4235,-11049.02 4235,-11049.02"/>
<polygon fill="black" stroke="black" points="4238.5,-11049.02 4235,-11039.02 4231.5,-11049.02 4238.5,-11049.02"/>
</g>
<!-- gate_1_3&#45;&gt;expert_1_0_0 -->
<g id="edge1972" class="edge">
<title>gate_1_3&#45;&gt;expert_1_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4137.94,-10986.61C4137.94,-10968.41 4137.94,-10940 4137.94,-10940 4137.94,-10940 342.07,-10940 342.07,-10940 342.07,-10940 342.07,-10842.07 342.07,-10842.07"/>
<polygon fill="blue" stroke="blue" points="345.57,-10842.07 342.07,-10832.07 338.57,-10842.07 345.57,-10842.07"/>
<text text-anchor="middle" x="16826.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="16826.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU3→GPU0</text>
<text text-anchor="middle" x="16826.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="16826.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_3&#45;&gt;expert_1_1_0 -->
<g id="edge1973" class="edge">
<title>gate_1_3&#45;&gt;expert_1_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4154.82,-10976.78C4154.82,-10967.43 4154.82,-10959 4154.82,-10959 4154.82,-10959 3176.14,-10959 3176.14,-10959 3176.14,-10959 3176.14,-10842.24 3176.14,-10842.24"/>
<polygon fill="blue" stroke="blue" points="3179.64,-10842.24 3176.14,-10832.24 3172.64,-10842.24 3179.64,-10842.24"/>
<text text-anchor="middle" x="17000.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17000.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU3→GPU1</text>
<text text-anchor="middle" x="17000.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17000.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_3&#45;&gt;expert_1_2_0 -->
<g id="edge1974" class="edge">
<title>gate_1_3&#45;&gt;expert_1_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4135.3,-11014C3995.46,-11014 3758,-11014 3758,-11014 3758,-11014 3758,-10842.33 3758,-10842.33"/>
<polygon fill="blue" stroke="blue" points="3761.5,-10842.33 3758,-10832.33 3754.5,-10842.33 3761.5,-10842.33"/>
<text text-anchor="middle" x="17174.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17174.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU3→GPU2</text>
<text text-anchor="middle" x="17174.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17174.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_3&#45;&gt;expert_1_3_0 -->
<g id="edge337" class="edge">
<title>gate_1_3&#45;&gt;expert_1_3_0</title>
<path fill="none" stroke="black" d="M4163.26,-10973.83C4163.26,-10973.83 4163.26,-10842.08 4163.26,-10842.08"/>
<polygon fill="black" stroke="black" points="4166.76,-10842.08 4163.26,-10832.08 4159.76,-10842.08 4166.76,-10842.08"/>
</g>
<!-- gate_1_3&#45;&gt;expert_1_4_0 -->
<g id="edge1975" class="edge">
<title>gate_1_3&#45;&gt;expert_1_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4334.52,-10989C4474.09,-10989 4711.1,-10989 4711.1,-10989 4711.1,-10989 4711.1,-10842.18 4711.1,-10842.18"/>
<polygon fill="blue" stroke="blue" points="4714.6,-10842.18 4711.1,-10832.18 4707.6,-10842.18 4714.6,-10842.18"/>
<text text-anchor="middle" x="17348.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17348.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU3→GPU4</text>
<text text-anchor="middle" x="17348.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17348.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_3&#45;&gt;expert_1_5_0 -->
<g id="edge1976" class="edge">
<title>gate_1_3&#45;&gt;expert_1_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4247.66,-10964.12C4247.66,-10952.65 4247.66,-10943 4247.66,-10943 4247.66,-10943 5296.75,-10943 5296.75,-10943 5296.75,-10943 5296.75,-10842.01 5296.75,-10842.01"/>
<polygon fill="blue" stroke="blue" points="5300.25,-10842.01 5296.75,-10832.01 5293.25,-10842.01 5300.25,-10842.01"/>
<text text-anchor="middle" x="17522.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17522.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU3→GPU5</text>
<text text-anchor="middle" x="17522.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17522.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_3&#45;&gt;expert_1_6_0 -->
<g id="edge1977" class="edge">
<title>gate_1_3&#45;&gt;expert_1_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4256.1,-10964.73C4256.1,-10950.24 4256.1,-10937 4256.1,-10937 4256.1,-10937 5879.7,-10937 5879.7,-10937 5879.7,-10937 5879.7,-10842.11 5879.7,-10842.11"/>
<polygon fill="blue" stroke="blue" points="5883.2,-10842.11 5879.7,-10832.11 5876.2,-10842.11 5883.2,-10842.11"/>
<text text-anchor="middle" x="17696.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17696.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU3→GPU6</text>
<text text-anchor="middle" x="17696.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17696.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_3&#45;&gt;expert_1_7_0 -->
<g id="edge1978" class="edge">
<title>gate_1_3&#45;&gt;expert_1_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4264.54,-10965.18C4264.54,-10946.66 4264.54,-10928 4264.54,-10928 4264.54,-10928 6537.79,-10928 6537.79,-10928 6537.79,-10928 6537.79,-10842.08 6537.79,-10842.08"/>
<polygon fill="blue" stroke="blue" points="6541.29,-10842.08 6537.79,-10832.08 6534.29,-10842.08 6541.29,-10842.08"/>
<text text-anchor="middle" x="17870.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17870.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU3→GPU7</text>
<text text-anchor="middle" x="17870.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17870.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_3&#45;&gt;expert_1_8_0 -->
<g id="edge1979" class="edge">
<title>gate_1_3&#45;&gt;expert_1_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4272.98,-10966.38C4272.98,-10945.48 4272.98,-10923 4272.98,-10923 4272.98,-10923 7119.54,-10923 7119.54,-10923 7119.54,-10923 7119.54,-10842.16 7119.54,-10842.16"/>
<polygon fill="blue" stroke="blue" points="7123.04,-10842.16 7119.54,-10832.16 7116.04,-10842.16 7123.04,-10842.16"/>
<text text-anchor="middle" x="18044.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18044.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU3→GPU8</text>
<text text-anchor="middle" x="18044.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18044.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_3&#45;&gt;expert_1_9_0 -->
<g id="edge1980" class="edge">
<title>gate_1_3&#45;&gt;expert_1_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4281.42,-10967.65C4281.42,-10937.8 4281.42,-10899 4281.42,-10899 4281.42,-10899 7699.45,-10899 7699.45,-10899 7699.45,-10899 7699.45,-10842.04 7699.45,-10842.04"/>
<polygon fill="blue" stroke="blue" points="7702.95,-10842.04 7699.45,-10832.04 7695.95,-10842.04 7702.95,-10842.04"/>
<text text-anchor="middle" x="18218.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18218.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU3→GPU9</text>
<text text-anchor="middle" x="18218.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18218.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_3&#45;&gt;expert_1_10_0 -->
<g id="edge1981" class="edge">
<title>gate_1_3&#45;&gt;expert_1_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4289.86,-10969.44C4289.86,-10932.55 4289.86,-10877 4289.86,-10877 4289.86,-10877 8278.69,-10877 8278.69,-10877 8278.69,-10877 8278.69,-10842.12 8278.69,-10842.12"/>
<polygon fill="blue" stroke="blue" points="8282.19,-10842.12 8278.69,-10832.12 8275.19,-10842.12 8282.19,-10842.12"/>
<text text-anchor="middle" x="18392.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18392.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU3→GPU10</text>
<text text-anchor="middle" x="18392.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18392.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_3&#45;&gt;expert_1_11_0 -->
<g id="edge1982" class="edge">
<title>gate_1_3&#45;&gt;expert_1_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4298.3,-10971.37C4298.3,-10933.39 4298.3,-10873 4298.3,-10873 4298.3,-10873 8865.69,-10873 8865.69,-10873 8865.69,-10873 8865.69,-10842.18 8865.69,-10842.18"/>
<polygon fill="blue" stroke="blue" points="8869.19,-10842.18 8865.69,-10832.18 8862.19,-10842.18 8869.19,-10842.18"/>
<text text-anchor="middle" x="18566.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18566.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU3→GPU11</text>
<text text-anchor="middle" x="18566.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18566.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_3&#45;&gt;expert_1_12_0 -->
<g id="edge1983" class="edge">
<title>gate_1_3&#45;&gt;expert_1_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4306.74,-10973.96C4306.74,-10934.61 4306.74,-10867 4306.74,-10867 4306.74,-10867 9467.54,-10867 9467.54,-10867 9467.54,-10867 9467.54,-10842.3 9467.54,-10842.3"/>
<polygon fill="blue" stroke="blue" points="9471.04,-10842.3 9467.54,-10832.3 9464.04,-10842.3 9471.04,-10842.3"/>
<text text-anchor="middle" x="18740.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18740.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU3→GPU12</text>
<text text-anchor="middle" x="18740.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18740.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_3&#45;&gt;expert_1_13_0 -->
<g id="edge1984" class="edge">
<title>gate_1_3&#45;&gt;expert_1_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4315.18,-10976.83C4315.18,-10935.8 4315.18,-10858 4315.18,-10858 4315.18,-10858 10067.02,-10858 10067.02,-10858 10067.02,-10858 10067.02,-10842.06 10067.02,-10842.06"/>
<polygon fill="blue" stroke="blue" points="10070.52,-10842.06 10067.02,-10832.06 10063.52,-10842.06 10070.52,-10842.06"/>
<text text-anchor="middle" x="18914.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18914.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU3→GPU13</text>
<text text-anchor="middle" x="18914.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18914.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_3&#45;&gt;expert_1_14_0 -->
<g id="edge1985" class="edge">
<title>gate_1_3&#45;&gt;expert_1_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4323.62,-10980.96C4323.62,-10940.85 4323.62,-10856 4323.62,-10856 4323.62,-10856 10666.88,-10856 10666.88,-10856 10666.88,-10856 10666.88,-10842.23 10666.88,-10842.23"/>
<polygon fill="blue" stroke="blue" points="10670.38,-10842.23 10666.88,-10832.23 10663.38,-10842.23 10670.38,-10842.23"/>
<text text-anchor="middle" x="19088.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19088.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU3→GPU14</text>
<text text-anchor="middle" x="19088.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19088.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_3&#45;&gt;expert_1_15_0 -->
<g id="edge1986" class="edge">
<title>gate_1_3&#45;&gt;expert_1_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4332.06,-10986.8C4332.06,-10948.93 4332.06,-10851 4332.06,-10851 4332.06,-10851 11262.34,-10851 11262.34,-10851 11262.34,-10851 11262.34,-10842.23 11262.34,-10842.23"/>
<polygon fill="blue" stroke="blue" points="11265.84,-10842.23 11262.34,-10832.23 11258.84,-10842.23 11265.84,-10842.23"/>
<text text-anchor="middle" x="19262.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19262.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU3→GPU15</text>
<text text-anchor="middle" x="19262.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19262.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_3 -->
<g id="node342" class="node">
<title>expert_reduce_1_3</title>
<ellipse fill="none" stroke="black" cx="4235" cy="-10668.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="4235" y="-10679.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="4235" y="-10664.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="4235" y="-10649.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_3_0&#45;&gt;expert_reduce_1_3 -->
<g id="edge338" class="edge">
<title>expert_1_3_0&#45;&gt;expert_reduce_1_3</title>
<path fill="none" stroke="black" d="M4235,-10778.76C4235,-10778.76 4235,-10716.06 4235,-10716.06"/>
<polygon fill="black" stroke="black" points="4238.5,-10716.06 4235,-10706.06 4231.5,-10716.06 4238.5,-10716.06"/>
</g>
<!-- moe_residual_1_3 -->
<g id="node343" class="node">
<title>moe_residual_1_3</title>
<ellipse fill="none" stroke="black" cx="4235" cy="-10531" rx="105.5" ry="27"/>
<text text-anchor="middle" x="4235" y="-10534.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="4235" y="-10519.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_3&#45;&gt;moe_residual_1_3 -->
<g id="edge339" class="edge">
<title>expert_reduce_1_3&#45;&gt;moe_residual_1_3</title>
<path fill="none" stroke="black" d="M4235,-10630.93C4235,-10630.93 4235,-10568.06 4235,-10568.06"/>
<polygon fill="black" stroke="black" points="4238.5,-10568.06 4235,-10558.06 4231.5,-10568.06 4238.5,-10568.06"/>
</g>
<!-- qkv_proj_2_3 -->
<g id="node344" class="node">
<title>qkv_proj_2_3</title>
<polygon fill="none" stroke="black" points="4317.5,-10431 4152.5,-10431 4152.5,-10378 4317.5,-10378 4317.5,-10431"/>
<text text-anchor="middle" x="4235" y="-10415.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="4235" y="-10400.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="4235" y="-10385.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_1_3&#45;&gt;qkv_proj_2_3 -->
<g id="edge340" class="edge">
<title>moe_residual_1_3&#45;&gt;qkv_proj_2_3</title>
<path fill="none" stroke="black" d="M4235,-10503.86C4235,-10503.86 4235,-10441.16 4235,-10441.16"/>
<polygon fill="black" stroke="black" points="4238.5,-10441.16 4235,-10431.16 4231.5,-10441.16 4238.5,-10441.16"/>
</g>
<!-- qkv_reshape_2_3 -->
<g id="node345" class="node">
<title>qkv_reshape_2_3</title>
<ellipse fill="none" stroke="black" cx="4235" cy="-10278" rx="148" ry="27"/>
<text text-anchor="middle" x="4235" y="-10281.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="4235" y="-10266.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_2_3&#45;&gt;qkv_reshape_2_3 -->
<g id="edge341" class="edge">
<title>qkv_proj_2_3&#45;&gt;qkv_reshape_2_3</title>
<path fill="none" stroke="black" d="M4235,-10377.98C4235,-10377.98 4235,-10315.36 4235,-10315.36"/>
<polygon fill="black" stroke="black" points="4238.5,-10315.36 4235,-10305.36 4231.5,-10315.36 4238.5,-10315.36"/>
</g>
<!-- qkv_reshape_2_3&#45;&gt;ring_attn_2_3_stage_0 -->
<g id="edge342" class="edge">
<title>qkv_reshape_2_3&#45;&gt;ring_attn_2_3_stage_0</title>
<path fill="none" stroke="black" d="M4235,-10250.72C4235,-10250.72 4235,-10144.16 4235,-10144.16"/>
<polygon fill="black" stroke="black" points="4238.5,-10144.16 4235,-10134.16 4231.5,-10144.16 4238.5,-10144.16"/>
</g>
<!-- ring_attn_2_3_stage_0&#45;&gt;ring_attn_2_3_stage_1 -->
<g id="edge343" class="edge">
<title>ring_attn_2_3_stage_0&#45;&gt;ring_attn_2_3_stage_1</title>
<path fill="none" stroke="black" d="M4235,-9997.87C4235,-9997.87 4235,-9891.25 4235,-9891.25"/>
<polygon fill="black" stroke="black" points="4238.5,-9891.25 4235,-9881.25 4231.5,-9891.25 4238.5,-9891.25"/>
</g>
<!-- ring_attn_2_4_stage_0 -->
<g id="node444" class="node">
<title>ring_attn_2_4_stage_0</title>
<polygon fill="yellow" stroke="black" points="4822,-10134 4613,-10066 4822,-9998 5031,-10066 4822,-10134"/>
<text text-anchor="middle" x="4822" y="-10084.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-10069.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="4822" y="-10054.8" font-family="Times,serif" font-size="14.00">Q[4]×K[4]×V[4]</text>
<text text-anchor="middle" x="4822" y="-10039.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_3_stage_0&#45;&gt;ring_attn_2_4_stage_0 -->
<g id="edge1987" class="edge">
<title>ring_attn_2_3_stage_0&#45;&gt;ring_attn_2_4_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-10066C4444.02,-10066 4602.86,-10066 4602.86,-10066"/>
<polygon fill="red" stroke="red" points="4602.86,-10069.5 4612.86,-10066 4602.86,-10062.5 4602.86,-10069.5"/>
</g>
<!-- ring_attn_2_3_stage_1&#45;&gt;ring_attn_2_3_stage_2 -->
<g id="edge344" class="edge">
<title>ring_attn_2_3_stage_1&#45;&gt;ring_attn_2_3_stage_2</title>
<path fill="none" stroke="black" d="M4235,-9744.87C4235,-9744.87 4235,-9638.25 4235,-9638.25"/>
<polygon fill="black" stroke="black" points="4238.5,-9638.25 4235,-9628.25 4231.5,-9638.25 4238.5,-9638.25"/>
</g>
<!-- ring_attn_2_4_stage_1 -->
<g id="node445" class="node">
<title>ring_attn_2_4_stage_1</title>
<polygon fill="yellow" stroke="black" points="4822,-9881 4613,-9813 4822,-9745 5031,-9813 4822,-9881"/>
<text text-anchor="middle" x="4822" y="-9831.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-9816.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="4822" y="-9801.8" font-family="Times,serif" font-size="14.00">Q[4]×K[3]×V[3]</text>
<text text-anchor="middle" x="4822" y="-9786.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_3_stage_1&#45;&gt;ring_attn_2_4_stage_1 -->
<g id="edge1988" class="edge">
<title>ring_attn_2_3_stage_1&#45;&gt;ring_attn_2_4_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-9813C4444.02,-9813 4602.86,-9813 4602.86,-9813"/>
<polygon fill="red" stroke="red" points="4602.86,-9816.5 4612.86,-9813 4602.86,-9809.5 4602.86,-9816.5"/>
</g>
<!-- ring_attn_2_3_stage_2&#45;&gt;ring_attn_2_3_stage_3 -->
<g id="edge345" class="edge">
<title>ring_attn_2_3_stage_2&#45;&gt;ring_attn_2_3_stage_3</title>
<path fill="none" stroke="black" d="M4235,-9491.87C4235,-9491.87 4235,-9385.25 4235,-9385.25"/>
<polygon fill="black" stroke="black" points="4238.5,-9385.25 4235,-9375.25 4231.5,-9385.25 4238.5,-9385.25"/>
</g>
<!-- ring_attn_2_4_stage_2 -->
<g id="node446" class="node">
<title>ring_attn_2_4_stage_2</title>
<polygon fill="yellow" stroke="black" points="4822,-9628 4613,-9560 4822,-9492 5031,-9560 4822,-9628"/>
<text text-anchor="middle" x="4822" y="-9578.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-9563.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="4822" y="-9548.8" font-family="Times,serif" font-size="14.00">Q[4]×K[2]×V[2]</text>
<text text-anchor="middle" x="4822" y="-9533.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_3_stage_2&#45;&gt;ring_attn_2_4_stage_2 -->
<g id="edge1989" class="edge">
<title>ring_attn_2_3_stage_2&#45;&gt;ring_attn_2_4_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-9560C4444.02,-9560 4602.86,-9560 4602.86,-9560"/>
<polygon fill="red" stroke="red" points="4602.86,-9563.5 4612.86,-9560 4602.86,-9556.5 4602.86,-9563.5"/>
</g>
<!-- ring_attn_2_3_stage_3&#45;&gt;ring_attn_2_3_stage_4 -->
<g id="edge346" class="edge">
<title>ring_attn_2_3_stage_3&#45;&gt;ring_attn_2_3_stage_4</title>
<path fill="none" stroke="black" d="M4235,-9238.87C4235,-9238.87 4235,-9132.25 4235,-9132.25"/>
<polygon fill="black" stroke="black" points="4238.5,-9132.25 4235,-9122.25 4231.5,-9132.25 4238.5,-9132.25"/>
</g>
<!-- ring_attn_2_4_stage_3 -->
<g id="node447" class="node">
<title>ring_attn_2_4_stage_3</title>
<polygon fill="yellow" stroke="black" points="4822,-9375 4613,-9307 4822,-9239 5031,-9307 4822,-9375"/>
<text text-anchor="middle" x="4822" y="-9325.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-9310.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="4822" y="-9295.8" font-family="Times,serif" font-size="14.00">Q[4]×K[1]×V[1]</text>
<text text-anchor="middle" x="4822" y="-9280.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_3_stage_3&#45;&gt;ring_attn_2_4_stage_3 -->
<g id="edge1990" class="edge">
<title>ring_attn_2_3_stage_3&#45;&gt;ring_attn_2_4_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-9307C4444.02,-9307 4602.86,-9307 4602.86,-9307"/>
<polygon fill="red" stroke="red" points="4602.86,-9310.5 4612.86,-9307 4602.86,-9303.5 4602.86,-9310.5"/>
</g>
<!-- ring_attn_2_3_stage_4&#45;&gt;ring_attn_2_3_stage_5 -->
<g id="edge347" class="edge">
<title>ring_attn_2_3_stage_4&#45;&gt;ring_attn_2_3_stage_5</title>
<path fill="none" stroke="black" d="M4235,-8985.87C4235,-8985.87 4235,-8879.25 4235,-8879.25"/>
<polygon fill="black" stroke="black" points="4238.5,-8879.25 4235,-8869.25 4231.5,-8879.25 4238.5,-8879.25"/>
</g>
<!-- ring_attn_2_4_stage_4 -->
<g id="node448" class="node">
<title>ring_attn_2_4_stage_4</title>
<polygon fill="yellow" stroke="black" points="4822,-9122 4613,-9054 4822,-8986 5031,-9054 4822,-9122"/>
<text text-anchor="middle" x="4822" y="-9072.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-9057.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="4822" y="-9042.8" font-family="Times,serif" font-size="14.00">Q[4]×K[0]×V[0]</text>
<text text-anchor="middle" x="4822" y="-9027.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_3_stage_4&#45;&gt;ring_attn_2_4_stage_4 -->
<g id="edge1991" class="edge">
<title>ring_attn_2_3_stage_4&#45;&gt;ring_attn_2_4_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-9054C4444.02,-9054 4602.86,-9054 4602.86,-9054"/>
<polygon fill="red" stroke="red" points="4602.86,-9057.5 4612.86,-9054 4602.86,-9050.5 4602.86,-9057.5"/>
</g>
<!-- ring_attn_2_3_stage_5&#45;&gt;ring_attn_2_3_stage_6 -->
<g id="edge348" class="edge">
<title>ring_attn_2_3_stage_5&#45;&gt;ring_attn_2_3_stage_6</title>
<path fill="none" stroke="black" d="M4235,-8732.87C4235,-8732.87 4235,-8626.25 4235,-8626.25"/>
<polygon fill="black" stroke="black" points="4238.5,-8626.25 4235,-8616.25 4231.5,-8626.25 4238.5,-8626.25"/>
</g>
<!-- ring_attn_2_4_stage_5 -->
<g id="node449" class="node">
<title>ring_attn_2_4_stage_5</title>
<polygon fill="yellow" stroke="black" points="4822,-8869 4613,-8801 4822,-8733 5031,-8801 4822,-8869"/>
<text text-anchor="middle" x="4822" y="-8819.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-8804.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="4822" y="-8789.8" font-family="Times,serif" font-size="14.00">Q[4]×K[15]×V[15]</text>
<text text-anchor="middle" x="4822" y="-8774.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_3_stage_5&#45;&gt;ring_attn_2_4_stage_5 -->
<g id="edge1992" class="edge">
<title>ring_attn_2_3_stage_5&#45;&gt;ring_attn_2_4_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-8801C4444.02,-8801 4602.86,-8801 4602.86,-8801"/>
<polygon fill="red" stroke="red" points="4602.86,-8804.5 4612.86,-8801 4602.86,-8797.5 4602.86,-8804.5"/>
</g>
<!-- ring_attn_2_3_stage_6&#45;&gt;ring_attn_2_3_stage_7 -->
<g id="edge349" class="edge">
<title>ring_attn_2_3_stage_6&#45;&gt;ring_attn_2_3_stage_7</title>
<path fill="none" stroke="black" d="M4235,-8479.87C4235,-8479.87 4235,-8373.25 4235,-8373.25"/>
<polygon fill="black" stroke="black" points="4238.5,-8373.25 4235,-8363.25 4231.5,-8373.25 4238.5,-8373.25"/>
</g>
<!-- ring_attn_2_4_stage_6 -->
<g id="node450" class="node">
<title>ring_attn_2_4_stage_6</title>
<polygon fill="yellow" stroke="black" points="4822,-8616 4613,-8548 4822,-8480 5031,-8548 4822,-8616"/>
<text text-anchor="middle" x="4822" y="-8566.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-8551.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="4822" y="-8536.8" font-family="Times,serif" font-size="14.00">Q[4]×K[14]×V[14]</text>
<text text-anchor="middle" x="4822" y="-8521.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_3_stage_6&#45;&gt;ring_attn_2_4_stage_6 -->
<g id="edge1993" class="edge">
<title>ring_attn_2_3_stage_6&#45;&gt;ring_attn_2_4_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-8548C4444.02,-8548 4602.86,-8548 4602.86,-8548"/>
<polygon fill="red" stroke="red" points="4602.86,-8551.5 4612.86,-8548 4602.86,-8544.5 4602.86,-8551.5"/>
</g>
<!-- ring_attn_2_3_stage_7&#45;&gt;ring_attn_2_3_stage_8 -->
<g id="edge350" class="edge">
<title>ring_attn_2_3_stage_7&#45;&gt;ring_attn_2_3_stage_8</title>
<path fill="none" stroke="black" d="M4235,-8226.87C4235,-8226.87 4235,-8120.25 4235,-8120.25"/>
<polygon fill="black" stroke="black" points="4238.5,-8120.25 4235,-8110.25 4231.5,-8120.25 4238.5,-8120.25"/>
</g>
<!-- ring_attn_2_4_stage_7 -->
<g id="node451" class="node">
<title>ring_attn_2_4_stage_7</title>
<polygon fill="yellow" stroke="black" points="4822,-8363 4613,-8295 4822,-8227 5031,-8295 4822,-8363"/>
<text text-anchor="middle" x="4822" y="-8313.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-8298.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="4822" y="-8283.8" font-family="Times,serif" font-size="14.00">Q[4]×K[13]×V[13]</text>
<text text-anchor="middle" x="4822" y="-8268.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_3_stage_7&#45;&gt;ring_attn_2_4_stage_7 -->
<g id="edge1994" class="edge">
<title>ring_attn_2_3_stage_7&#45;&gt;ring_attn_2_4_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-8295C4444.02,-8295 4602.86,-8295 4602.86,-8295"/>
<polygon fill="red" stroke="red" points="4602.86,-8298.5 4612.86,-8295 4602.86,-8291.5 4602.86,-8298.5"/>
</g>
<!-- ring_attn_2_3_stage_8&#45;&gt;ring_attn_2_3_stage_9 -->
<g id="edge351" class="edge">
<title>ring_attn_2_3_stage_8&#45;&gt;ring_attn_2_3_stage_9</title>
<path fill="none" stroke="black" d="M4235,-7973.87C4235,-7973.87 4235,-7867.25 4235,-7867.25"/>
<polygon fill="black" stroke="black" points="4238.5,-7867.25 4235,-7857.25 4231.5,-7867.25 4238.5,-7867.25"/>
</g>
<!-- ring_attn_2_4_stage_8 -->
<g id="node452" class="node">
<title>ring_attn_2_4_stage_8</title>
<polygon fill="yellow" stroke="black" points="4822,-8110 4613,-8042 4822,-7974 5031,-8042 4822,-8110"/>
<text text-anchor="middle" x="4822" y="-8060.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-8045.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="4822" y="-8030.8" font-family="Times,serif" font-size="14.00">Q[4]×K[12]×V[12]</text>
<text text-anchor="middle" x="4822" y="-8015.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_3_stage_8&#45;&gt;ring_attn_2_4_stage_8 -->
<g id="edge1995" class="edge">
<title>ring_attn_2_3_stage_8&#45;&gt;ring_attn_2_4_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-8042C4444.02,-8042 4602.86,-8042 4602.86,-8042"/>
<polygon fill="red" stroke="red" points="4602.86,-8045.5 4612.86,-8042 4602.86,-8038.5 4602.86,-8045.5"/>
</g>
<!-- ring_attn_2_3_stage_9&#45;&gt;ring_attn_2_3_stage_10 -->
<g id="edge352" class="edge">
<title>ring_attn_2_3_stage_9&#45;&gt;ring_attn_2_3_stage_10</title>
<path fill="none" stroke="black" d="M4235,-7720.87C4235,-7720.87 4235,-7614.25 4235,-7614.25"/>
<polygon fill="black" stroke="black" points="4238.5,-7614.25 4235,-7604.25 4231.5,-7614.25 4238.5,-7614.25"/>
</g>
<!-- ring_attn_2_4_stage_9 -->
<g id="node453" class="node">
<title>ring_attn_2_4_stage_9</title>
<polygon fill="yellow" stroke="black" points="4822,-7857 4613,-7789 4822,-7721 5031,-7789 4822,-7857"/>
<text text-anchor="middle" x="4822" y="-7807.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-7792.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="4822" y="-7777.8" font-family="Times,serif" font-size="14.00">Q[4]×K[11]×V[11]</text>
<text text-anchor="middle" x="4822" y="-7762.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_3_stage_9&#45;&gt;ring_attn_2_4_stage_9 -->
<g id="edge1996" class="edge">
<title>ring_attn_2_3_stage_9&#45;&gt;ring_attn_2_4_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-7789C4444.02,-7789 4602.86,-7789 4602.86,-7789"/>
<polygon fill="red" stroke="red" points="4602.86,-7792.5 4612.86,-7789 4602.86,-7785.5 4602.86,-7792.5"/>
</g>
<!-- ring_attn_2_3_stage_10&#45;&gt;ring_attn_2_3_stage_11 -->
<g id="edge353" class="edge">
<title>ring_attn_2_3_stage_10&#45;&gt;ring_attn_2_3_stage_11</title>
<path fill="none" stroke="black" d="M4235,-7467.87C4235,-7467.87 4235,-7361.25 4235,-7361.25"/>
<polygon fill="black" stroke="black" points="4238.5,-7361.25 4235,-7351.25 4231.5,-7361.25 4238.5,-7361.25"/>
</g>
<!-- ring_attn_2_4_stage_10 -->
<g id="node454" class="node">
<title>ring_attn_2_4_stage_10</title>
<polygon fill="yellow" stroke="black" points="4822,-7604 4613,-7536 4822,-7468 5031,-7536 4822,-7604"/>
<text text-anchor="middle" x="4822" y="-7554.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-7539.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="4822" y="-7524.8" font-family="Times,serif" font-size="14.00">Q[4]×K[10]×V[10]</text>
<text text-anchor="middle" x="4822" y="-7509.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_3_stage_10&#45;&gt;ring_attn_2_4_stage_10 -->
<g id="edge1997" class="edge">
<title>ring_attn_2_3_stage_10&#45;&gt;ring_attn_2_4_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-7536C4444.02,-7536 4602.86,-7536 4602.86,-7536"/>
<polygon fill="red" stroke="red" points="4602.86,-7539.5 4612.86,-7536 4602.86,-7532.5 4602.86,-7539.5"/>
</g>
<!-- ring_attn_2_3_stage_11&#45;&gt;ring_attn_2_3_stage_12 -->
<g id="edge354" class="edge">
<title>ring_attn_2_3_stage_11&#45;&gt;ring_attn_2_3_stage_12</title>
<path fill="none" stroke="black" d="M4235,-7214.87C4235,-7214.87 4235,-7108.25 4235,-7108.25"/>
<polygon fill="black" stroke="black" points="4238.5,-7108.25 4235,-7098.25 4231.5,-7108.25 4238.5,-7108.25"/>
</g>
<!-- ring_attn_2_4_stage_11 -->
<g id="node455" class="node">
<title>ring_attn_2_4_stage_11</title>
<polygon fill="yellow" stroke="black" points="4822,-7351 4613,-7283 4822,-7215 5031,-7283 4822,-7351"/>
<text text-anchor="middle" x="4822" y="-7301.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-7286.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="4822" y="-7271.8" font-family="Times,serif" font-size="14.00">Q[4]×K[9]×V[9]</text>
<text text-anchor="middle" x="4822" y="-7256.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_3_stage_11&#45;&gt;ring_attn_2_4_stage_11 -->
<g id="edge1998" class="edge">
<title>ring_attn_2_3_stage_11&#45;&gt;ring_attn_2_4_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-7283C4444.02,-7283 4602.86,-7283 4602.86,-7283"/>
<polygon fill="red" stroke="red" points="4602.86,-7286.5 4612.86,-7283 4602.86,-7279.5 4602.86,-7286.5"/>
</g>
<!-- ring_attn_2_3_stage_12&#45;&gt;ring_attn_2_3_stage_13 -->
<g id="edge355" class="edge">
<title>ring_attn_2_3_stage_12&#45;&gt;ring_attn_2_3_stage_13</title>
<path fill="none" stroke="black" d="M4235,-6961.87C4235,-6961.87 4235,-6855.25 4235,-6855.25"/>
<polygon fill="black" stroke="black" points="4238.5,-6855.25 4235,-6845.25 4231.5,-6855.25 4238.5,-6855.25"/>
</g>
<!-- ring_attn_2_4_stage_12 -->
<g id="node456" class="node">
<title>ring_attn_2_4_stage_12</title>
<polygon fill="yellow" stroke="black" points="4822,-7098 4613,-7030 4822,-6962 5031,-7030 4822,-7098"/>
<text text-anchor="middle" x="4822" y="-7048.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-7033.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="4822" y="-7018.8" font-family="Times,serif" font-size="14.00">Q[4]×K[8]×V[8]</text>
<text text-anchor="middle" x="4822" y="-7003.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_3_stage_12&#45;&gt;ring_attn_2_4_stage_12 -->
<g id="edge1999" class="edge">
<title>ring_attn_2_3_stage_12&#45;&gt;ring_attn_2_4_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-7030C4444.02,-7030 4602.86,-7030 4602.86,-7030"/>
<polygon fill="red" stroke="red" points="4602.86,-7033.5 4612.86,-7030 4602.86,-7026.5 4602.86,-7033.5"/>
</g>
<!-- ring_attn_2_3_stage_13&#45;&gt;ring_attn_2_3_stage_14 -->
<g id="edge356" class="edge">
<title>ring_attn_2_3_stage_13&#45;&gt;ring_attn_2_3_stage_14</title>
<path fill="none" stroke="black" d="M4235,-6708.87C4235,-6708.87 4235,-6602.25 4235,-6602.25"/>
<polygon fill="black" stroke="black" points="4238.5,-6602.25 4235,-6592.25 4231.5,-6602.25 4238.5,-6602.25"/>
</g>
<!-- ring_attn_2_4_stage_13 -->
<g id="node457" class="node">
<title>ring_attn_2_4_stage_13</title>
<polygon fill="yellow" stroke="black" points="4822,-6845 4613,-6777 4822,-6709 5031,-6777 4822,-6845"/>
<text text-anchor="middle" x="4822" y="-6795.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-6780.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="4822" y="-6765.8" font-family="Times,serif" font-size="14.00">Q[4]×K[7]×V[7]</text>
<text text-anchor="middle" x="4822" y="-6750.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_3_stage_13&#45;&gt;ring_attn_2_4_stage_13 -->
<g id="edge2000" class="edge">
<title>ring_attn_2_3_stage_13&#45;&gt;ring_attn_2_4_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-6777C4444.02,-6777 4602.86,-6777 4602.86,-6777"/>
<polygon fill="red" stroke="red" points="4602.86,-6780.5 4612.86,-6777 4602.86,-6773.5 4602.86,-6780.5"/>
</g>
<!-- ring_attn_2_3_stage_14&#45;&gt;ring_attn_2_3_stage_15 -->
<g id="edge357" class="edge">
<title>ring_attn_2_3_stage_14&#45;&gt;ring_attn_2_3_stage_15</title>
<path fill="none" stroke="black" d="M4235,-6455.87C4235,-6455.87 4235,-6349.25 4235,-6349.25"/>
<polygon fill="black" stroke="black" points="4238.5,-6349.25 4235,-6339.25 4231.5,-6349.25 4238.5,-6349.25"/>
</g>
<!-- ring_attn_2_4_stage_14 -->
<g id="node458" class="node">
<title>ring_attn_2_4_stage_14</title>
<polygon fill="yellow" stroke="black" points="4822,-6592 4613,-6524 4822,-6456 5031,-6524 4822,-6592"/>
<text text-anchor="middle" x="4822" y="-6542.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-6527.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="4822" y="-6512.8" font-family="Times,serif" font-size="14.00">Q[4]×K[6]×V[6]</text>
<text text-anchor="middle" x="4822" y="-6497.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_3_stage_14&#45;&gt;ring_attn_2_4_stage_14 -->
<g id="edge2001" class="edge">
<title>ring_attn_2_3_stage_14&#45;&gt;ring_attn_2_4_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-6524C4444.02,-6524 4602.86,-6524 4602.86,-6524"/>
<polygon fill="red" stroke="red" points="4602.86,-6527.5 4612.86,-6524 4602.86,-6520.5 4602.86,-6527.5"/>
</g>
<!-- attn_out_2_3 -->
<g id="node362" class="node">
<title>attn_out_2_3</title>
<polygon fill="none" stroke="black" points="4304.5,-6130 4165.5,-6130 4165.5,-6077 4304.5,-6077 4304.5,-6130"/>
<text text-anchor="middle" x="4235" y="-6114.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="4235" y="-6099.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="4235" y="-6084.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_2_3_stage_15&#45;&gt;attn_out_2_3 -->
<g id="edge358" class="edge">
<title>ring_attn_2_3_stage_15&#45;&gt;attn_out_2_3</title>
<path fill="none" stroke="black" d="M4235,-6202.87C4235,-6202.87 4235,-6140.18 4235,-6140.18"/>
<polygon fill="black" stroke="black" points="4238.5,-6140.18 4235,-6130.18 4231.5,-6140.18 4238.5,-6140.18"/>
</g>
<!-- ring_attn_2_4_stage_15 -->
<g id="node459" class="node">
<title>ring_attn_2_4_stage_15</title>
<polygon fill="yellow" stroke="black" points="4822,-6339 4613,-6271 4822,-6203 5031,-6271 4822,-6339"/>
<text text-anchor="middle" x="4822" y="-6289.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-6274.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="4822" y="-6259.8" font-family="Times,serif" font-size="14.00">Q[4]×K[5]×V[5]</text>
<text text-anchor="middle" x="4822" y="-6244.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_3_stage_15&#45;&gt;ring_attn_2_4_stage_15 -->
<g id="edge2002" class="edge">
<title>ring_attn_2_3_stage_15&#45;&gt;ring_attn_2_4_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-6271C4444.02,-6271 4602.86,-6271 4602.86,-6271"/>
<polygon fill="red" stroke="red" points="4602.86,-6274.5 4612.86,-6271 4602.86,-6267.5 4602.86,-6274.5"/>
</g>
<!-- attn_residual_2_3 -->
<g id="node363" class="node">
<title>attn_residual_2_3</title>
<ellipse fill="none" stroke="black" cx="4235" cy="-5977" rx="105.5" ry="27"/>
<text text-anchor="middle" x="4235" y="-5980.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="4235" y="-5965.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_2_3&#45;&gt;attn_residual_2_3 -->
<g id="edge359" class="edge">
<title>attn_out_2_3&#45;&gt;attn_residual_2_3</title>
<path fill="none" stroke="black" d="M4235,-6076.98C4235,-6076.98 4235,-6014.36 4235,-6014.36"/>
<polygon fill="black" stroke="black" points="4238.5,-6014.36 4235,-6004.36 4231.5,-6014.36 4238.5,-6014.36"/>
</g>
<!-- gate_2_3 -->
<g id="node364" class="node">
<title>gate_2_3</title>
<ellipse fill="orange" stroke="black" cx="4235" cy="-5839.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="4235" y="-5850.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="4235" y="-5835.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="4235" y="-5820.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_2_3&#45;&gt;gate_2_3 -->
<g id="edge360" class="edge">
<title>attn_residual_2_3&#45;&gt;gate_2_3</title>
<path fill="none" stroke="black" d="M4235,-5949.83C4235,-5949.83 4235,-5887.02 4235,-5887.02"/>
<polygon fill="black" stroke="black" points="4238.5,-5887.02 4235,-5877.02 4231.5,-5887.02 4238.5,-5887.02"/>
</g>
<!-- gate_2_3&#45;&gt;expert_2_0_0 -->
<g id="edge2003" class="edge">
<title>gate_2_3&#45;&gt;expert_2_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4137.94,-5824.61C4137.94,-5806.41 4137.94,-5778 4137.94,-5778 4137.94,-5778 342.07,-5778 342.07,-5778 342.07,-5778 342.07,-5680.07 342.07,-5680.07"/>
<polygon fill="blue" stroke="blue" points="345.57,-5680.07 342.07,-5670.07 338.57,-5680.07 345.57,-5680.07"/>
<text text-anchor="middle" x="16826.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="16826.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU3→GPU0</text>
<text text-anchor="middle" x="16826.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="16826.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_3&#45;&gt;expert_2_1_0 -->
<g id="edge2004" class="edge">
<title>gate_2_3&#45;&gt;expert_2_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4154.82,-5814.78C4154.82,-5805.43 4154.82,-5797 4154.82,-5797 4154.82,-5797 3176.14,-5797 3176.14,-5797 3176.14,-5797 3176.14,-5680.24 3176.14,-5680.24"/>
<polygon fill="blue" stroke="blue" points="3179.64,-5680.24 3176.14,-5670.24 3172.64,-5680.24 3179.64,-5680.24"/>
<text text-anchor="middle" x="17000.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17000.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU3→GPU1</text>
<text text-anchor="middle" x="17000.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17000.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_3&#45;&gt;expert_2_2_0 -->
<g id="edge2005" class="edge">
<title>gate_2_3&#45;&gt;expert_2_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4135.3,-5852C3995.46,-5852 3758,-5852 3758,-5852 3758,-5852 3758,-5680.33 3758,-5680.33"/>
<polygon fill="blue" stroke="blue" points="3761.5,-5680.33 3758,-5670.33 3754.5,-5680.33 3761.5,-5680.33"/>
<text text-anchor="middle" x="17174.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17174.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU3→GPU2</text>
<text text-anchor="middle" x="17174.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17174.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_3&#45;&gt;expert_2_3_0 -->
<g id="edge361" class="edge">
<title>gate_2_3&#45;&gt;expert_2_3_0</title>
<path fill="none" stroke="black" d="M4163.26,-5811.83C4163.26,-5811.83 4163.26,-5680.08 4163.26,-5680.08"/>
<polygon fill="black" stroke="black" points="4166.76,-5680.08 4163.26,-5670.08 4159.76,-5680.08 4166.76,-5680.08"/>
</g>
<!-- gate_2_3&#45;&gt;expert_2_4_0 -->
<g id="edge2006" class="edge">
<title>gate_2_3&#45;&gt;expert_2_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4334.52,-5827C4474.09,-5827 4711.1,-5827 4711.1,-5827 4711.1,-5827 4711.1,-5680.18 4711.1,-5680.18"/>
<polygon fill="blue" stroke="blue" points="4714.6,-5680.18 4711.1,-5670.18 4707.6,-5680.18 4714.6,-5680.18"/>
<text text-anchor="middle" x="17348.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17348.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU3→GPU4</text>
<text text-anchor="middle" x="17348.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17348.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_3&#45;&gt;expert_2_5_0 -->
<g id="edge2007" class="edge">
<title>gate_2_3&#45;&gt;expert_2_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4247.66,-5802.12C4247.66,-5790.65 4247.66,-5781 4247.66,-5781 4247.66,-5781 5296.75,-5781 5296.75,-5781 5296.75,-5781 5296.75,-5680.01 5296.75,-5680.01"/>
<polygon fill="blue" stroke="blue" points="5300.25,-5680.01 5296.75,-5670.01 5293.25,-5680.01 5300.25,-5680.01"/>
<text text-anchor="middle" x="17522.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17522.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU3→GPU5</text>
<text text-anchor="middle" x="17522.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17522.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_3&#45;&gt;expert_2_6_0 -->
<g id="edge2008" class="edge">
<title>gate_2_3&#45;&gt;expert_2_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4256.1,-5802.73C4256.1,-5788.24 4256.1,-5775 4256.1,-5775 4256.1,-5775 5879.7,-5775 5879.7,-5775 5879.7,-5775 5879.7,-5680.11 5879.7,-5680.11"/>
<polygon fill="blue" stroke="blue" points="5883.2,-5680.11 5879.7,-5670.11 5876.2,-5680.11 5883.2,-5680.11"/>
<text text-anchor="middle" x="17696.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17696.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU3→GPU6</text>
<text text-anchor="middle" x="17696.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17696.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_3&#45;&gt;expert_2_7_0 -->
<g id="edge2009" class="edge">
<title>gate_2_3&#45;&gt;expert_2_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4264.54,-5803.18C4264.54,-5784.66 4264.54,-5766 4264.54,-5766 4264.54,-5766 6537.79,-5766 6537.79,-5766 6537.79,-5766 6537.79,-5680.08 6537.79,-5680.08"/>
<polygon fill="blue" stroke="blue" points="6541.29,-5680.08 6537.79,-5670.08 6534.29,-5680.08 6541.29,-5680.08"/>
<text text-anchor="middle" x="17870.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17870.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU3→GPU7</text>
<text text-anchor="middle" x="17870.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17870.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_3&#45;&gt;expert_2_8_0 -->
<g id="edge2010" class="edge">
<title>gate_2_3&#45;&gt;expert_2_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4272.98,-5804.38C4272.98,-5783.48 4272.98,-5761 4272.98,-5761 4272.98,-5761 7119.54,-5761 7119.54,-5761 7119.54,-5761 7119.54,-5680.16 7119.54,-5680.16"/>
<polygon fill="blue" stroke="blue" points="7123.04,-5680.16 7119.54,-5670.16 7116.04,-5680.16 7123.04,-5680.16"/>
<text text-anchor="middle" x="18044.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18044.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU3→GPU8</text>
<text text-anchor="middle" x="18044.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18044.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_3&#45;&gt;expert_2_9_0 -->
<g id="edge2011" class="edge">
<title>gate_2_3&#45;&gt;expert_2_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4281.42,-5805.65C4281.42,-5775.8 4281.42,-5737 4281.42,-5737 4281.42,-5737 7699.45,-5737 7699.45,-5737 7699.45,-5737 7699.45,-5680.04 7699.45,-5680.04"/>
<polygon fill="blue" stroke="blue" points="7702.95,-5680.04 7699.45,-5670.04 7695.95,-5680.04 7702.95,-5680.04"/>
<text text-anchor="middle" x="18218.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18218.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU3→GPU9</text>
<text text-anchor="middle" x="18218.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18218.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_3&#45;&gt;expert_2_10_0 -->
<g id="edge2012" class="edge">
<title>gate_2_3&#45;&gt;expert_2_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4289.86,-5807.44C4289.86,-5770.55 4289.86,-5715 4289.86,-5715 4289.86,-5715 8278.69,-5715 8278.69,-5715 8278.69,-5715 8278.69,-5680.12 8278.69,-5680.12"/>
<polygon fill="blue" stroke="blue" points="8282.19,-5680.12 8278.69,-5670.12 8275.19,-5680.12 8282.19,-5680.12"/>
<text text-anchor="middle" x="18392.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18392.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU3→GPU10</text>
<text text-anchor="middle" x="18392.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18392.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_3&#45;&gt;expert_2_11_0 -->
<g id="edge2013" class="edge">
<title>gate_2_3&#45;&gt;expert_2_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4298.3,-5809.37C4298.3,-5771.39 4298.3,-5711 4298.3,-5711 4298.3,-5711 8865.69,-5711 8865.69,-5711 8865.69,-5711 8865.69,-5680.18 8865.69,-5680.18"/>
<polygon fill="blue" stroke="blue" points="8869.19,-5680.18 8865.69,-5670.18 8862.19,-5680.18 8869.19,-5680.18"/>
<text text-anchor="middle" x="18566.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18566.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU3→GPU11</text>
<text text-anchor="middle" x="18566.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18566.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_3&#45;&gt;expert_2_12_0 -->
<g id="edge2014" class="edge">
<title>gate_2_3&#45;&gt;expert_2_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4306.74,-5811.96C4306.74,-5772.61 4306.74,-5705 4306.74,-5705 4306.74,-5705 9467.54,-5705 9467.54,-5705 9467.54,-5705 9467.54,-5680.3 9467.54,-5680.3"/>
<polygon fill="blue" stroke="blue" points="9471.04,-5680.3 9467.54,-5670.3 9464.04,-5680.3 9471.04,-5680.3"/>
<text text-anchor="middle" x="18740.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18740.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU3→GPU12</text>
<text text-anchor="middle" x="18740.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18740.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_3&#45;&gt;expert_2_13_0 -->
<g id="edge2015" class="edge">
<title>gate_2_3&#45;&gt;expert_2_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4315.18,-5814.83C4315.18,-5773.8 4315.18,-5696 4315.18,-5696 4315.18,-5696 10067.02,-5696 10067.02,-5696 10067.02,-5696 10067.02,-5680.06 10067.02,-5680.06"/>
<polygon fill="blue" stroke="blue" points="10070.52,-5680.06 10067.02,-5670.06 10063.52,-5680.06 10070.52,-5680.06"/>
<text text-anchor="middle" x="18914.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18914.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU3→GPU13</text>
<text text-anchor="middle" x="18914.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18914.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_3&#45;&gt;expert_2_14_0 -->
<g id="edge2016" class="edge">
<title>gate_2_3&#45;&gt;expert_2_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4323.62,-5818.96C4323.62,-5778.85 4323.62,-5694 4323.62,-5694 4323.62,-5694 10666.88,-5694 10666.88,-5694 10666.88,-5694 10666.88,-5680.23 10666.88,-5680.23"/>
<polygon fill="blue" stroke="blue" points="10670.38,-5680.23 10666.88,-5670.23 10663.38,-5680.23 10670.38,-5680.23"/>
<text text-anchor="middle" x="19088.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19088.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU3→GPU14</text>
<text text-anchor="middle" x="19088.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19088.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_3&#45;&gt;expert_2_15_0 -->
<g id="edge2017" class="edge">
<title>gate_2_3&#45;&gt;expert_2_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4332.06,-5824.8C4332.06,-5786.93 4332.06,-5689 4332.06,-5689 4332.06,-5689 11262.34,-5689 11262.34,-5689 11262.34,-5689 11262.34,-5680.23 11262.34,-5680.23"/>
<polygon fill="blue" stroke="blue" points="11265.84,-5680.23 11262.34,-5670.23 11258.84,-5680.23 11265.84,-5680.23"/>
<text text-anchor="middle" x="19262.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19262.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU3→GPU15</text>
<text text-anchor="middle" x="19262.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19262.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_3 -->
<g id="node366" class="node">
<title>expert_reduce_2_3</title>
<ellipse fill="none" stroke="black" cx="4235" cy="-5506.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="4235" y="-5517.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="4235" y="-5502.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="4235" y="-5487.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_3_0&#45;&gt;expert_reduce_2_3 -->
<g id="edge362" class="edge">
<title>expert_2_3_0&#45;&gt;expert_reduce_2_3</title>
<path fill="none" stroke="black" d="M4235,-5616.76C4235,-5616.76 4235,-5554.06 4235,-5554.06"/>
<polygon fill="black" stroke="black" points="4238.5,-5554.06 4235,-5544.06 4231.5,-5554.06 4238.5,-5554.06"/>
</g>
<!-- moe_residual_2_3 -->
<g id="node367" class="node">
<title>moe_residual_2_3</title>
<ellipse fill="none" stroke="black" cx="4235" cy="-5369" rx="105.5" ry="27"/>
<text text-anchor="middle" x="4235" y="-5372.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="4235" y="-5357.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_3&#45;&gt;moe_residual_2_3 -->
<g id="edge363" class="edge">
<title>expert_reduce_2_3&#45;&gt;moe_residual_2_3</title>
<path fill="none" stroke="black" d="M4235,-5468.93C4235,-5468.93 4235,-5406.06 4235,-5406.06"/>
<polygon fill="black" stroke="black" points="4238.5,-5406.06 4235,-5396.06 4231.5,-5406.06 4238.5,-5406.06"/>
</g>
<!-- qkv_proj_3_3 -->
<g id="node368" class="node">
<title>qkv_proj_3_3</title>
<polygon fill="none" stroke="black" points="4317.5,-5269 4152.5,-5269 4152.5,-5216 4317.5,-5216 4317.5,-5269"/>
<text text-anchor="middle" x="4235" y="-5253.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="4235" y="-5238.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="4235" y="-5223.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_2_3&#45;&gt;qkv_proj_3_3 -->
<g id="edge364" class="edge">
<title>moe_residual_2_3&#45;&gt;qkv_proj_3_3</title>
<path fill="none" stroke="black" d="M4235,-5341.86C4235,-5341.86 4235,-5279.16 4235,-5279.16"/>
<polygon fill="black" stroke="black" points="4238.5,-5279.16 4235,-5269.16 4231.5,-5279.16 4238.5,-5279.16"/>
</g>
<!-- qkv_reshape_3_3 -->
<g id="node369" class="node">
<title>qkv_reshape_3_3</title>
<ellipse fill="none" stroke="black" cx="4235" cy="-5116" rx="148" ry="27"/>
<text text-anchor="middle" x="4235" y="-5119.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="4235" y="-5104.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_3_3&#45;&gt;qkv_reshape_3_3 -->
<g id="edge365" class="edge">
<title>qkv_proj_3_3&#45;&gt;qkv_reshape_3_3</title>
<path fill="none" stroke="black" d="M4235,-5215.98C4235,-5215.98 4235,-5153.36 4235,-5153.36"/>
<polygon fill="black" stroke="black" points="4238.5,-5153.36 4235,-5143.36 4231.5,-5153.36 4238.5,-5153.36"/>
</g>
<!-- qkv_reshape_3_3&#45;&gt;ring_attn_3_3_stage_0 -->
<g id="edge366" class="edge">
<title>qkv_reshape_3_3&#45;&gt;ring_attn_3_3_stage_0</title>
<path fill="none" stroke="black" d="M4235,-5088.72C4235,-5088.72 4235,-4982.16 4235,-4982.16"/>
<polygon fill="black" stroke="black" points="4238.5,-4982.16 4235,-4972.16 4231.5,-4982.16 4238.5,-4982.16"/>
</g>
<!-- ring_attn_3_3_stage_0&#45;&gt;ring_attn_3_3_stage_1 -->
<g id="edge367" class="edge">
<title>ring_attn_3_3_stage_0&#45;&gt;ring_attn_3_3_stage_1</title>
<path fill="none" stroke="black" d="M4235,-4835.87C4235,-4835.87 4235,-4729.25 4235,-4729.25"/>
<polygon fill="black" stroke="black" points="4238.5,-4729.25 4235,-4719.25 4231.5,-4729.25 4238.5,-4729.25"/>
</g>
<!-- ring_attn_3_4_stage_0 -->
<g id="node468" class="node">
<title>ring_attn_3_4_stage_0</title>
<polygon fill="yellow" stroke="black" points="4822,-4972 4613,-4904 4822,-4836 5031,-4904 4822,-4972"/>
<text text-anchor="middle" x="4822" y="-4922.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-4907.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="4822" y="-4892.8" font-family="Times,serif" font-size="14.00">Q[4]×K[4]×V[4]</text>
<text text-anchor="middle" x="4822" y="-4877.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_3_stage_0&#45;&gt;ring_attn_3_4_stage_0 -->
<g id="edge2018" class="edge">
<title>ring_attn_3_3_stage_0&#45;&gt;ring_attn_3_4_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-4904C4444.02,-4904 4602.86,-4904 4602.86,-4904"/>
<polygon fill="red" stroke="red" points="4602.86,-4907.5 4612.86,-4904 4602.86,-4900.5 4602.86,-4907.5"/>
</g>
<!-- ring_attn_3_3_stage_1&#45;&gt;ring_attn_3_3_stage_2 -->
<g id="edge368" class="edge">
<title>ring_attn_3_3_stage_1&#45;&gt;ring_attn_3_3_stage_2</title>
<path fill="none" stroke="black" d="M4235,-4582.87C4235,-4582.87 4235,-4476.25 4235,-4476.25"/>
<polygon fill="black" stroke="black" points="4238.5,-4476.25 4235,-4466.25 4231.5,-4476.25 4238.5,-4476.25"/>
</g>
<!-- ring_attn_3_4_stage_1 -->
<g id="node469" class="node">
<title>ring_attn_3_4_stage_1</title>
<polygon fill="yellow" stroke="black" points="4822,-4719 4613,-4651 4822,-4583 5031,-4651 4822,-4719"/>
<text text-anchor="middle" x="4822" y="-4669.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-4654.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="4822" y="-4639.8" font-family="Times,serif" font-size="14.00">Q[4]×K[3]×V[3]</text>
<text text-anchor="middle" x="4822" y="-4624.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_3_stage_1&#45;&gt;ring_attn_3_4_stage_1 -->
<g id="edge2019" class="edge">
<title>ring_attn_3_3_stage_1&#45;&gt;ring_attn_3_4_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-4651C4444.02,-4651 4602.86,-4651 4602.86,-4651"/>
<polygon fill="red" stroke="red" points="4602.86,-4654.5 4612.86,-4651 4602.86,-4647.5 4602.86,-4654.5"/>
</g>
<!-- ring_attn_3_3_stage_2&#45;&gt;ring_attn_3_3_stage_3 -->
<g id="edge369" class="edge">
<title>ring_attn_3_3_stage_2&#45;&gt;ring_attn_3_3_stage_3</title>
<path fill="none" stroke="black" d="M4235,-4329.87C4235,-4329.87 4235,-4223.25 4235,-4223.25"/>
<polygon fill="black" stroke="black" points="4238.5,-4223.25 4235,-4213.25 4231.5,-4223.25 4238.5,-4223.25"/>
</g>
<!-- ring_attn_3_4_stage_2 -->
<g id="node470" class="node">
<title>ring_attn_3_4_stage_2</title>
<polygon fill="yellow" stroke="black" points="4822,-4466 4613,-4398 4822,-4330 5031,-4398 4822,-4466"/>
<text text-anchor="middle" x="4822" y="-4416.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-4401.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="4822" y="-4386.8" font-family="Times,serif" font-size="14.00">Q[4]×K[2]×V[2]</text>
<text text-anchor="middle" x="4822" y="-4371.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_3_stage_2&#45;&gt;ring_attn_3_4_stage_2 -->
<g id="edge2020" class="edge">
<title>ring_attn_3_3_stage_2&#45;&gt;ring_attn_3_4_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-4398C4444.02,-4398 4602.86,-4398 4602.86,-4398"/>
<polygon fill="red" stroke="red" points="4602.86,-4401.5 4612.86,-4398 4602.86,-4394.5 4602.86,-4401.5"/>
</g>
<!-- ring_attn_3_3_stage_3&#45;&gt;ring_attn_3_3_stage_4 -->
<g id="edge370" class="edge">
<title>ring_attn_3_3_stage_3&#45;&gt;ring_attn_3_3_stage_4</title>
<path fill="none" stroke="black" d="M4235,-4076.87C4235,-4076.87 4235,-3970.25 4235,-3970.25"/>
<polygon fill="black" stroke="black" points="4238.5,-3970.25 4235,-3960.25 4231.5,-3970.25 4238.5,-3970.25"/>
</g>
<!-- ring_attn_3_4_stage_3 -->
<g id="node471" class="node">
<title>ring_attn_3_4_stage_3</title>
<polygon fill="yellow" stroke="black" points="4822,-4213 4613,-4145 4822,-4077 5031,-4145 4822,-4213"/>
<text text-anchor="middle" x="4822" y="-4163.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-4148.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="4822" y="-4133.8" font-family="Times,serif" font-size="14.00">Q[4]×K[1]×V[1]</text>
<text text-anchor="middle" x="4822" y="-4118.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_3_stage_3&#45;&gt;ring_attn_3_4_stage_3 -->
<g id="edge2021" class="edge">
<title>ring_attn_3_3_stage_3&#45;&gt;ring_attn_3_4_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-4145C4444.02,-4145 4602.86,-4145 4602.86,-4145"/>
<polygon fill="red" stroke="red" points="4602.86,-4148.5 4612.86,-4145 4602.86,-4141.5 4602.86,-4148.5"/>
</g>
<!-- ring_attn_3_3_stage_4&#45;&gt;ring_attn_3_3_stage_5 -->
<g id="edge371" class="edge">
<title>ring_attn_3_3_stage_4&#45;&gt;ring_attn_3_3_stage_5</title>
<path fill="none" stroke="black" d="M4235,-3823.87C4235,-3823.87 4235,-3717.25 4235,-3717.25"/>
<polygon fill="black" stroke="black" points="4238.5,-3717.25 4235,-3707.25 4231.5,-3717.25 4238.5,-3717.25"/>
</g>
<!-- ring_attn_3_4_stage_4 -->
<g id="node472" class="node">
<title>ring_attn_3_4_stage_4</title>
<polygon fill="yellow" stroke="black" points="4822,-3960 4613,-3892 4822,-3824 5031,-3892 4822,-3960"/>
<text text-anchor="middle" x="4822" y="-3910.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-3895.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="4822" y="-3880.8" font-family="Times,serif" font-size="14.00">Q[4]×K[0]×V[0]</text>
<text text-anchor="middle" x="4822" y="-3865.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_3_stage_4&#45;&gt;ring_attn_3_4_stage_4 -->
<g id="edge2022" class="edge">
<title>ring_attn_3_3_stage_4&#45;&gt;ring_attn_3_4_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-3892C4444.02,-3892 4602.86,-3892 4602.86,-3892"/>
<polygon fill="red" stroke="red" points="4602.86,-3895.5 4612.86,-3892 4602.86,-3888.5 4602.86,-3895.5"/>
</g>
<!-- ring_attn_3_3_stage_5&#45;&gt;ring_attn_3_3_stage_6 -->
<g id="edge372" class="edge">
<title>ring_attn_3_3_stage_5&#45;&gt;ring_attn_3_3_stage_6</title>
<path fill="none" stroke="black" d="M4235,-3570.87C4235,-3570.87 4235,-3464.25 4235,-3464.25"/>
<polygon fill="black" stroke="black" points="4238.5,-3464.25 4235,-3454.25 4231.5,-3464.25 4238.5,-3464.25"/>
</g>
<!-- ring_attn_3_4_stage_5 -->
<g id="node473" class="node">
<title>ring_attn_3_4_stage_5</title>
<polygon fill="yellow" stroke="black" points="4822,-3707 4613,-3639 4822,-3571 5031,-3639 4822,-3707"/>
<text text-anchor="middle" x="4822" y="-3657.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-3642.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="4822" y="-3627.8" font-family="Times,serif" font-size="14.00">Q[4]×K[15]×V[15]</text>
<text text-anchor="middle" x="4822" y="-3612.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_3_stage_5&#45;&gt;ring_attn_3_4_stage_5 -->
<g id="edge2023" class="edge">
<title>ring_attn_3_3_stage_5&#45;&gt;ring_attn_3_4_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-3639C4444.02,-3639 4602.86,-3639 4602.86,-3639"/>
<polygon fill="red" stroke="red" points="4602.86,-3642.5 4612.86,-3639 4602.86,-3635.5 4602.86,-3642.5"/>
</g>
<!-- ring_attn_3_3_stage_6&#45;&gt;ring_attn_3_3_stage_7 -->
<g id="edge373" class="edge">
<title>ring_attn_3_3_stage_6&#45;&gt;ring_attn_3_3_stage_7</title>
<path fill="none" stroke="black" d="M4235,-3317.87C4235,-3317.87 4235,-3211.25 4235,-3211.25"/>
<polygon fill="black" stroke="black" points="4238.5,-3211.25 4235,-3201.25 4231.5,-3211.25 4238.5,-3211.25"/>
</g>
<!-- ring_attn_3_4_stage_6 -->
<g id="node474" class="node">
<title>ring_attn_3_4_stage_6</title>
<polygon fill="yellow" stroke="black" points="4822,-3454 4613,-3386 4822,-3318 5031,-3386 4822,-3454"/>
<text text-anchor="middle" x="4822" y="-3404.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-3389.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="4822" y="-3374.8" font-family="Times,serif" font-size="14.00">Q[4]×K[14]×V[14]</text>
<text text-anchor="middle" x="4822" y="-3359.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_3_stage_6&#45;&gt;ring_attn_3_4_stage_6 -->
<g id="edge2024" class="edge">
<title>ring_attn_3_3_stage_6&#45;&gt;ring_attn_3_4_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-3386C4444.02,-3386 4602.86,-3386 4602.86,-3386"/>
<polygon fill="red" stroke="red" points="4602.86,-3389.5 4612.86,-3386 4602.86,-3382.5 4602.86,-3389.5"/>
</g>
<!-- ring_attn_3_3_stage_7&#45;&gt;ring_attn_3_3_stage_8 -->
<g id="edge374" class="edge">
<title>ring_attn_3_3_stage_7&#45;&gt;ring_attn_3_3_stage_8</title>
<path fill="none" stroke="black" d="M4235,-3064.87C4235,-3064.87 4235,-2958.25 4235,-2958.25"/>
<polygon fill="black" stroke="black" points="4238.5,-2958.25 4235,-2948.25 4231.5,-2958.25 4238.5,-2958.25"/>
</g>
<!-- ring_attn_3_4_stage_7 -->
<g id="node475" class="node">
<title>ring_attn_3_4_stage_7</title>
<polygon fill="yellow" stroke="black" points="4822,-3201 4613,-3133 4822,-3065 5031,-3133 4822,-3201"/>
<text text-anchor="middle" x="4822" y="-3151.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-3136.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="4822" y="-3121.8" font-family="Times,serif" font-size="14.00">Q[4]×K[13]×V[13]</text>
<text text-anchor="middle" x="4822" y="-3106.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_3_stage_7&#45;&gt;ring_attn_3_4_stage_7 -->
<g id="edge2025" class="edge">
<title>ring_attn_3_3_stage_7&#45;&gt;ring_attn_3_4_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-3133C4444.02,-3133 4602.86,-3133 4602.86,-3133"/>
<polygon fill="red" stroke="red" points="4602.86,-3136.5 4612.86,-3133 4602.86,-3129.5 4602.86,-3136.5"/>
</g>
<!-- ring_attn_3_3_stage_8&#45;&gt;ring_attn_3_3_stage_9 -->
<g id="edge375" class="edge">
<title>ring_attn_3_3_stage_8&#45;&gt;ring_attn_3_3_stage_9</title>
<path fill="none" stroke="black" d="M4235,-2811.87C4235,-2811.87 4235,-2705.25 4235,-2705.25"/>
<polygon fill="black" stroke="black" points="4238.5,-2705.25 4235,-2695.25 4231.5,-2705.25 4238.5,-2705.25"/>
</g>
<!-- ring_attn_3_4_stage_8 -->
<g id="node476" class="node">
<title>ring_attn_3_4_stage_8</title>
<polygon fill="yellow" stroke="black" points="4822,-2948 4613,-2880 4822,-2812 5031,-2880 4822,-2948"/>
<text text-anchor="middle" x="4822" y="-2898.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-2883.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="4822" y="-2868.8" font-family="Times,serif" font-size="14.00">Q[4]×K[12]×V[12]</text>
<text text-anchor="middle" x="4822" y="-2853.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_3_stage_8&#45;&gt;ring_attn_3_4_stage_8 -->
<g id="edge2026" class="edge">
<title>ring_attn_3_3_stage_8&#45;&gt;ring_attn_3_4_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-2880C4444.02,-2880 4602.86,-2880 4602.86,-2880"/>
<polygon fill="red" stroke="red" points="4602.86,-2883.5 4612.86,-2880 4602.86,-2876.5 4602.86,-2883.5"/>
</g>
<!-- ring_attn_3_3_stage_9&#45;&gt;ring_attn_3_3_stage_10 -->
<g id="edge376" class="edge">
<title>ring_attn_3_3_stage_9&#45;&gt;ring_attn_3_3_stage_10</title>
<path fill="none" stroke="black" d="M4235,-2558.87C4235,-2558.87 4235,-2452.25 4235,-2452.25"/>
<polygon fill="black" stroke="black" points="4238.5,-2452.25 4235,-2442.25 4231.5,-2452.25 4238.5,-2452.25"/>
</g>
<!-- ring_attn_3_4_stage_9 -->
<g id="node477" class="node">
<title>ring_attn_3_4_stage_9</title>
<polygon fill="yellow" stroke="black" points="4822,-2695 4613,-2627 4822,-2559 5031,-2627 4822,-2695"/>
<text text-anchor="middle" x="4822" y="-2645.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-2630.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="4822" y="-2615.8" font-family="Times,serif" font-size="14.00">Q[4]×K[11]×V[11]</text>
<text text-anchor="middle" x="4822" y="-2600.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_3_stage_9&#45;&gt;ring_attn_3_4_stage_9 -->
<g id="edge2027" class="edge">
<title>ring_attn_3_3_stage_9&#45;&gt;ring_attn_3_4_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-2627C4444.02,-2627 4602.86,-2627 4602.86,-2627"/>
<polygon fill="red" stroke="red" points="4602.86,-2630.5 4612.86,-2627 4602.86,-2623.5 4602.86,-2630.5"/>
</g>
<!-- ring_attn_3_3_stage_10&#45;&gt;ring_attn_3_3_stage_11 -->
<g id="edge377" class="edge">
<title>ring_attn_3_3_stage_10&#45;&gt;ring_attn_3_3_stage_11</title>
<path fill="none" stroke="black" d="M4235,-2305.87C4235,-2305.87 4235,-2199.25 4235,-2199.25"/>
<polygon fill="black" stroke="black" points="4238.5,-2199.25 4235,-2189.25 4231.5,-2199.25 4238.5,-2199.25"/>
</g>
<!-- ring_attn_3_4_stage_10 -->
<g id="node478" class="node">
<title>ring_attn_3_4_stage_10</title>
<polygon fill="yellow" stroke="black" points="4822,-2442 4613,-2374 4822,-2306 5031,-2374 4822,-2442"/>
<text text-anchor="middle" x="4822" y="-2392.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-2377.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="4822" y="-2362.8" font-family="Times,serif" font-size="14.00">Q[4]×K[10]×V[10]</text>
<text text-anchor="middle" x="4822" y="-2347.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_3_stage_10&#45;&gt;ring_attn_3_4_stage_10 -->
<g id="edge2028" class="edge">
<title>ring_attn_3_3_stage_10&#45;&gt;ring_attn_3_4_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-2374C4444.02,-2374 4602.86,-2374 4602.86,-2374"/>
<polygon fill="red" stroke="red" points="4602.86,-2377.5 4612.86,-2374 4602.86,-2370.5 4602.86,-2377.5"/>
</g>
<!-- ring_attn_3_3_stage_11&#45;&gt;ring_attn_3_3_stage_12 -->
<g id="edge378" class="edge">
<title>ring_attn_3_3_stage_11&#45;&gt;ring_attn_3_3_stage_12</title>
<path fill="none" stroke="black" d="M4235,-2052.87C4235,-2052.87 4235,-1946.25 4235,-1946.25"/>
<polygon fill="black" stroke="black" points="4238.5,-1946.25 4235,-1936.25 4231.5,-1946.25 4238.5,-1946.25"/>
</g>
<!-- ring_attn_3_4_stage_11 -->
<g id="node479" class="node">
<title>ring_attn_3_4_stage_11</title>
<polygon fill="yellow" stroke="black" points="4822,-2189 4613,-2121 4822,-2053 5031,-2121 4822,-2189"/>
<text text-anchor="middle" x="4822" y="-2139.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-2124.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="4822" y="-2109.8" font-family="Times,serif" font-size="14.00">Q[4]×K[9]×V[9]</text>
<text text-anchor="middle" x="4822" y="-2094.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_3_stage_11&#45;&gt;ring_attn_3_4_stage_11 -->
<g id="edge2029" class="edge">
<title>ring_attn_3_3_stage_11&#45;&gt;ring_attn_3_4_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-2121C4444.02,-2121 4602.86,-2121 4602.86,-2121"/>
<polygon fill="red" stroke="red" points="4602.86,-2124.5 4612.86,-2121 4602.86,-2117.5 4602.86,-2124.5"/>
</g>
<!-- ring_attn_3_3_stage_12&#45;&gt;ring_attn_3_3_stage_13 -->
<g id="edge379" class="edge">
<title>ring_attn_3_3_stage_12&#45;&gt;ring_attn_3_3_stage_13</title>
<path fill="none" stroke="black" d="M4235,-1799.87C4235,-1799.87 4235,-1693.25 4235,-1693.25"/>
<polygon fill="black" stroke="black" points="4238.5,-1693.25 4235,-1683.25 4231.5,-1693.25 4238.5,-1693.25"/>
</g>
<!-- ring_attn_3_4_stage_12 -->
<g id="node480" class="node">
<title>ring_attn_3_4_stage_12</title>
<polygon fill="yellow" stroke="black" points="4822,-1936 4613,-1868 4822,-1800 5031,-1868 4822,-1936"/>
<text text-anchor="middle" x="4822" y="-1886.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-1871.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="4822" y="-1856.8" font-family="Times,serif" font-size="14.00">Q[4]×K[8]×V[8]</text>
<text text-anchor="middle" x="4822" y="-1841.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_3_stage_12&#45;&gt;ring_attn_3_4_stage_12 -->
<g id="edge2030" class="edge">
<title>ring_attn_3_3_stage_12&#45;&gt;ring_attn_3_4_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-1868C4444.02,-1868 4602.86,-1868 4602.86,-1868"/>
<polygon fill="red" stroke="red" points="4602.86,-1871.5 4612.86,-1868 4602.86,-1864.5 4602.86,-1871.5"/>
</g>
<!-- ring_attn_3_3_stage_13&#45;&gt;ring_attn_3_3_stage_14 -->
<g id="edge380" class="edge">
<title>ring_attn_3_3_stage_13&#45;&gt;ring_attn_3_3_stage_14</title>
<path fill="none" stroke="black" d="M4235,-1546.87C4235,-1546.87 4235,-1440.25 4235,-1440.25"/>
<polygon fill="black" stroke="black" points="4238.5,-1440.25 4235,-1430.25 4231.5,-1440.25 4238.5,-1440.25"/>
</g>
<!-- ring_attn_3_4_stage_13 -->
<g id="node481" class="node">
<title>ring_attn_3_4_stage_13</title>
<polygon fill="yellow" stroke="black" points="4822,-1683 4613,-1615 4822,-1547 5031,-1615 4822,-1683"/>
<text text-anchor="middle" x="4822" y="-1633.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-1618.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="4822" y="-1603.8" font-family="Times,serif" font-size="14.00">Q[4]×K[7]×V[7]</text>
<text text-anchor="middle" x="4822" y="-1588.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_3_stage_13&#45;&gt;ring_attn_3_4_stage_13 -->
<g id="edge2031" class="edge">
<title>ring_attn_3_3_stage_13&#45;&gt;ring_attn_3_4_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-1615C4444.02,-1615 4602.86,-1615 4602.86,-1615"/>
<polygon fill="red" stroke="red" points="4602.86,-1618.5 4612.86,-1615 4602.86,-1611.5 4602.86,-1618.5"/>
</g>
<!-- ring_attn_3_3_stage_14&#45;&gt;ring_attn_3_3_stage_15 -->
<g id="edge381" class="edge">
<title>ring_attn_3_3_stage_14&#45;&gt;ring_attn_3_3_stage_15</title>
<path fill="none" stroke="black" d="M4235,-1293.87C4235,-1293.87 4235,-1187.25 4235,-1187.25"/>
<polygon fill="black" stroke="black" points="4238.5,-1187.25 4235,-1177.25 4231.5,-1187.25 4238.5,-1187.25"/>
</g>
<!-- ring_attn_3_4_stage_14 -->
<g id="node482" class="node">
<title>ring_attn_3_4_stage_14</title>
<polygon fill="yellow" stroke="black" points="4822,-1430 4613,-1362 4822,-1294 5031,-1362 4822,-1430"/>
<text text-anchor="middle" x="4822" y="-1380.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-1365.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="4822" y="-1350.8" font-family="Times,serif" font-size="14.00">Q[4]×K[6]×V[6]</text>
<text text-anchor="middle" x="4822" y="-1335.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_3_stage_14&#45;&gt;ring_attn_3_4_stage_14 -->
<g id="edge2032" class="edge">
<title>ring_attn_3_3_stage_14&#45;&gt;ring_attn_3_4_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-1362C4444.02,-1362 4602.86,-1362 4602.86,-1362"/>
<polygon fill="red" stroke="red" points="4602.86,-1365.5 4612.86,-1362 4602.86,-1358.5 4602.86,-1365.5"/>
</g>
<!-- attn_out_3_3 -->
<g id="node386" class="node">
<title>attn_out_3_3</title>
<polygon fill="none" stroke="black" points="4304.5,-968 4165.5,-968 4165.5,-915 4304.5,-915 4304.5,-968"/>
<text text-anchor="middle" x="4235" y="-952.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="4235" y="-937.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="4235" y="-922.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_3_3_stage_15&#45;&gt;attn_out_3_3 -->
<g id="edge382" class="edge">
<title>ring_attn_3_3_stage_15&#45;&gt;attn_out_3_3</title>
<path fill="none" stroke="black" d="M4235,-1040.87C4235,-1040.87 4235,-978.18 4235,-978.18"/>
<polygon fill="black" stroke="black" points="4238.5,-978.18 4235,-968.18 4231.5,-978.18 4238.5,-978.18"/>
</g>
<!-- ring_attn_3_4_stage_15 -->
<g id="node483" class="node">
<title>ring_attn_3_4_stage_15</title>
<polygon fill="yellow" stroke="black" points="4822,-1177 4613,-1109 4822,-1041 5031,-1109 4822,-1177"/>
<text text-anchor="middle" x="4822" y="-1127.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="4822" y="-1112.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="4822" y="-1097.8" font-family="Times,serif" font-size="14.00">Q[4]×K[5]×V[5]</text>
<text text-anchor="middle" x="4822" y="-1082.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_3_stage_15&#45;&gt;ring_attn_3_4_stage_15 -->
<g id="edge2033" class="edge">
<title>ring_attn_3_3_stage_15&#45;&gt;ring_attn_3_4_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M4444.02,-1109C4444.02,-1109 4602.86,-1109 4602.86,-1109"/>
<polygon fill="red" stroke="red" points="4602.86,-1112.5 4612.86,-1109 4602.86,-1105.5 4602.86,-1112.5"/>
</g>
<!-- attn_residual_3_3 -->
<g id="node387" class="node">
<title>attn_residual_3_3</title>
<ellipse fill="none" stroke="black" cx="4235" cy="-815" rx="105.5" ry="27"/>
<text text-anchor="middle" x="4235" y="-818.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="4235" y="-803.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_3_3&#45;&gt;attn_residual_3_3 -->
<g id="edge383" class="edge">
<title>attn_out_3_3&#45;&gt;attn_residual_3_3</title>
<path fill="none" stroke="black" d="M4235,-914.98C4235,-914.98 4235,-852.36 4235,-852.36"/>
<polygon fill="black" stroke="black" points="4238.5,-852.36 4235,-842.36 4231.5,-852.36 4238.5,-852.36"/>
</g>
<!-- gate_3_3 -->
<g id="node388" class="node">
<title>gate_3_3</title>
<ellipse fill="orange" stroke="black" cx="4235" cy="-677.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="4235" y="-688.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="4235" y="-673.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="4235" y="-658.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_3_3&#45;&gt;gate_3_3 -->
<g id="edge384" class="edge">
<title>attn_residual_3_3&#45;&gt;gate_3_3</title>
<path fill="none" stroke="black" d="M4235,-787.83C4235,-787.83 4235,-725.02 4235,-725.02"/>
<polygon fill="black" stroke="black" points="4238.5,-725.02 4235,-715.02 4231.5,-725.02 4238.5,-725.02"/>
</g>
<!-- gate_3_3&#45;&gt;expert_3_0_0 -->
<g id="edge2034" class="edge">
<title>gate_3_3&#45;&gt;expert_3_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4137.94,-662.61C4137.94,-644.41 4137.94,-616 4137.94,-616 4137.94,-616 342.07,-616 342.07,-616 342.07,-616 342.07,-518.07 342.07,-518.07"/>
<polygon fill="blue" stroke="blue" points="345.57,-518.07 342.07,-508.07 338.57,-518.07 345.57,-518.07"/>
<text text-anchor="middle" x="16826.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="16826.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU3→GPU0</text>
<text text-anchor="middle" x="16826.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="16826.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_3&#45;&gt;expert_3_1_0 -->
<g id="edge2035" class="edge">
<title>gate_3_3&#45;&gt;expert_3_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4154.82,-652.78C4154.82,-643.43 4154.82,-635 4154.82,-635 4154.82,-635 3176.14,-635 3176.14,-635 3176.14,-635 3176.14,-518.24 3176.14,-518.24"/>
<polygon fill="blue" stroke="blue" points="3179.64,-518.24 3176.14,-508.24 3172.64,-518.24 3179.64,-518.24"/>
<text text-anchor="middle" x="17000.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17000.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU3→GPU1</text>
<text text-anchor="middle" x="17000.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17000.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_3&#45;&gt;expert_3_2_0 -->
<g id="edge2036" class="edge">
<title>gate_3_3&#45;&gt;expert_3_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4135.3,-690C3995.46,-690 3758,-690 3758,-690 3758,-690 3758,-518.33 3758,-518.33"/>
<polygon fill="blue" stroke="blue" points="3761.5,-518.33 3758,-508.33 3754.5,-518.33 3761.5,-518.33"/>
<text text-anchor="middle" x="17174.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17174.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU3→GPU2</text>
<text text-anchor="middle" x="17174.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17174.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_3&#45;&gt;expert_3_3_0 -->
<g id="edge385" class="edge">
<title>gate_3_3&#45;&gt;expert_3_3_0</title>
<path fill="none" stroke="black" d="M4163.26,-649.83C4163.26,-649.83 4163.26,-518.08 4163.26,-518.08"/>
<polygon fill="black" stroke="black" points="4166.76,-518.08 4163.26,-508.08 4159.76,-518.08 4166.76,-518.08"/>
</g>
<!-- gate_3_3&#45;&gt;expert_3_4_0 -->
<g id="edge2037" class="edge">
<title>gate_3_3&#45;&gt;expert_3_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4334.52,-665C4474.09,-665 4711.1,-665 4711.1,-665 4711.1,-665 4711.1,-518.18 4711.1,-518.18"/>
<polygon fill="blue" stroke="blue" points="4714.6,-518.18 4711.1,-508.18 4707.6,-518.18 4714.6,-518.18"/>
<text text-anchor="middle" x="17348.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17348.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU3→GPU4</text>
<text text-anchor="middle" x="17348.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17348.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_3&#45;&gt;expert_3_5_0 -->
<g id="edge2038" class="edge">
<title>gate_3_3&#45;&gt;expert_3_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4247.66,-640.12C4247.66,-628.65 4247.66,-619 4247.66,-619 4247.66,-619 5296.75,-619 5296.75,-619 5296.75,-619 5296.75,-518.01 5296.75,-518.01"/>
<polygon fill="blue" stroke="blue" points="5300.25,-518.01 5296.75,-508.01 5293.25,-518.01 5300.25,-518.01"/>
<text text-anchor="middle" x="17522.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17522.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU3→GPU5</text>
<text text-anchor="middle" x="17522.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17522.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_3&#45;&gt;expert_3_6_0 -->
<g id="edge2039" class="edge">
<title>gate_3_3&#45;&gt;expert_3_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4256.1,-640.73C4256.1,-626.24 4256.1,-613 4256.1,-613 4256.1,-613 5879.7,-613 5879.7,-613 5879.7,-613 5879.7,-518.11 5879.7,-518.11"/>
<polygon fill="blue" stroke="blue" points="5883.2,-518.11 5879.7,-508.11 5876.2,-518.11 5883.2,-518.11"/>
<text text-anchor="middle" x="17696.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17696.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU3→GPU6</text>
<text text-anchor="middle" x="17696.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17696.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_3&#45;&gt;expert_3_7_0 -->
<g id="edge2040" class="edge">
<title>gate_3_3&#45;&gt;expert_3_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4264.54,-641.18C4264.54,-622.66 4264.54,-604 4264.54,-604 4264.54,-604 6537.79,-604 6537.79,-604 6537.79,-604 6537.79,-518.08 6537.79,-518.08"/>
<polygon fill="blue" stroke="blue" points="6541.29,-518.08 6537.79,-508.08 6534.29,-518.08 6541.29,-518.08"/>
<text text-anchor="middle" x="17870.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="17870.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU3→GPU7</text>
<text text-anchor="middle" x="17870.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="17870.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_3&#45;&gt;expert_3_8_0 -->
<g id="edge2041" class="edge">
<title>gate_3_3&#45;&gt;expert_3_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4272.98,-642.38C4272.98,-621.48 4272.98,-599 4272.98,-599 4272.98,-599 7119.54,-599 7119.54,-599 7119.54,-599 7119.54,-518.16 7119.54,-518.16"/>
<polygon fill="blue" stroke="blue" points="7123.04,-518.16 7119.54,-508.16 7116.04,-518.16 7123.04,-518.16"/>
<text text-anchor="middle" x="18044.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18044.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU3→GPU8</text>
<text text-anchor="middle" x="18044.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18044.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_3&#45;&gt;expert_3_9_0 -->
<g id="edge2042" class="edge">
<title>gate_3_3&#45;&gt;expert_3_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4281.42,-643.65C4281.42,-613.8 4281.42,-575 4281.42,-575 4281.42,-575 7699.45,-575 7699.45,-575 7699.45,-575 7699.45,-518.04 7699.45,-518.04"/>
<polygon fill="blue" stroke="blue" points="7702.95,-518.04 7699.45,-508.04 7695.95,-518.04 7702.95,-518.04"/>
<text text-anchor="middle" x="18218.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18218.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU3→GPU9</text>
<text text-anchor="middle" x="18218.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18218.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_3&#45;&gt;expert_3_10_0 -->
<g id="edge2043" class="edge">
<title>gate_3_3&#45;&gt;expert_3_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4289.86,-645.44C4289.86,-608.55 4289.86,-553 4289.86,-553 4289.86,-553 8278.69,-553 8278.69,-553 8278.69,-553 8278.69,-518.12 8278.69,-518.12"/>
<polygon fill="blue" stroke="blue" points="8282.19,-518.12 8278.69,-508.12 8275.19,-518.12 8282.19,-518.12"/>
<text text-anchor="middle" x="18392.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18392.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU3→GPU10</text>
<text text-anchor="middle" x="18392.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18392.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_3&#45;&gt;expert_3_11_0 -->
<g id="edge2044" class="edge">
<title>gate_3_3&#45;&gt;expert_3_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4298.3,-647.37C4298.3,-609.39 4298.3,-549 4298.3,-549 4298.3,-549 8865.69,-549 8865.69,-549 8865.69,-549 8865.69,-518.18 8865.69,-518.18"/>
<polygon fill="blue" stroke="blue" points="8869.19,-518.18 8865.69,-508.18 8862.19,-518.18 8869.19,-518.18"/>
<text text-anchor="middle" x="18566.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18566.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU3→GPU11</text>
<text text-anchor="middle" x="18566.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18566.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_3&#45;&gt;expert_3_12_0 -->
<g id="edge2045" class="edge">
<title>gate_3_3&#45;&gt;expert_3_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4306.74,-649.96C4306.74,-610.61 4306.74,-543 4306.74,-543 4306.74,-543 9467.54,-543 9467.54,-543 9467.54,-543 9467.54,-518.3 9467.54,-518.3"/>
<polygon fill="blue" stroke="blue" points="9471.04,-518.3 9467.54,-508.3 9464.04,-518.3 9471.04,-518.3"/>
<text text-anchor="middle" x="18740.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18740.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU3→GPU12</text>
<text text-anchor="middle" x="18740.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18740.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_3&#45;&gt;expert_3_13_0 -->
<g id="edge2046" class="edge">
<title>gate_3_3&#45;&gt;expert_3_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4315.18,-652.83C4315.18,-611.8 4315.18,-534 4315.18,-534 4315.18,-534 10067.02,-534 10067.02,-534 10067.02,-534 10067.02,-518.06 10067.02,-518.06"/>
<polygon fill="blue" stroke="blue" points="10070.52,-518.06 10067.02,-508.06 10063.52,-518.06 10070.52,-518.06"/>
<text text-anchor="middle" x="18914.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="18914.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU3→GPU13</text>
<text text-anchor="middle" x="18914.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="18914.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_3&#45;&gt;expert_3_14_0 -->
<g id="edge2047" class="edge">
<title>gate_3_3&#45;&gt;expert_3_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4323.62,-656.96C4323.62,-616.85 4323.62,-532 4323.62,-532 4323.62,-532 10666.88,-532 10666.88,-532 10666.88,-532 10666.88,-518.23 10666.88,-518.23"/>
<polygon fill="blue" stroke="blue" points="10670.38,-518.23 10666.88,-508.23 10663.38,-518.23 10670.38,-518.23"/>
<text text-anchor="middle" x="19088.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19088.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU3→GPU14</text>
<text text-anchor="middle" x="19088.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19088.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_3&#45;&gt;expert_3_15_0 -->
<g id="edge2048" class="edge">
<title>gate_3_3&#45;&gt;expert_3_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4332.06,-662.8C4332.06,-624.93 4332.06,-527 4332.06,-527 4332.06,-527 11262.34,-527 11262.34,-527 11262.34,-527 11262.34,-518.23 11262.34,-518.23"/>
<polygon fill="blue" stroke="blue" points="11265.84,-518.23 11262.34,-508.23 11258.84,-518.23 11265.84,-518.23"/>
<text text-anchor="middle" x="19262.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19262.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU3→GPU15</text>
<text text-anchor="middle" x="19262.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19262.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_3 -->
<g id="node390" class="node">
<title>expert_reduce_3_3</title>
<ellipse fill="none" stroke="black" cx="4235" cy="-344.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="4235" y="-355.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="4235" y="-340.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="4235" y="-325.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_3_0&#45;&gt;expert_reduce_3_3 -->
<g id="edge386" class="edge">
<title>expert_3_3_0&#45;&gt;expert_reduce_3_3</title>
<path fill="none" stroke="black" d="M4235,-454.76C4235,-454.76 4235,-392.06 4235,-392.06"/>
<polygon fill="black" stroke="black" points="4238.5,-392.06 4235,-382.06 4231.5,-392.06 4238.5,-392.06"/>
</g>
<!-- moe_residual_3_3 -->
<g id="node391" class="node">
<title>moe_residual_3_3</title>
<ellipse fill="none" stroke="black" cx="4235" cy="-207" rx="105.5" ry="27"/>
<text text-anchor="middle" x="4235" y="-210.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="4235" y="-195.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_3&#45;&gt;moe_residual_3_3 -->
<g id="edge387" class="edge">
<title>expert_reduce_3_3&#45;&gt;moe_residual_3_3</title>
<path fill="none" stroke="black" d="M4235,-306.93C4235,-306.93 4235,-244.06 4235,-244.06"/>
<polygon fill="black" stroke="black" points="4238.5,-244.06 4235,-234.06 4231.5,-244.06 4238.5,-244.06"/>
</g>
<!-- output_3 -->
<g id="node392" class="node">
<title>output_3</title>
<polygon fill="lightcoral" stroke="black" points="4328,-107 4142,-107 4142,-69 4328,-69 4328,-107"/>
<text text-anchor="middle" x="4235" y="-91.8" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="4235" y="-76.8" font-family="Times,serif" font-size="14.00">Y[3]: 1024×1024×4096</text>
</g>
<!-- moe_residual_3_3&#45;&gt;output_3 -->
<g id="edge388" class="edge">
<title>moe_residual_3_3&#45;&gt;output_3</title>
<path fill="none" stroke="black" d="M4235,-180C4235,-180 4235,-117.12 4235,-117.12"/>
<polygon fill="black" stroke="black" points="4238.5,-117.12 4235,-107.12 4231.5,-117.12 4238.5,-117.12"/>
</g>
<!-- input_4 -->
<g id="node393" class="node">
<title>input_4</title>
<polygon fill="lightgreen" stroke="black" points="4915.5,-20866 4728.5,-20866 4728.5,-20828 4915.5,-20828 4915.5,-20866"/>
<text text-anchor="middle" x="4822" y="-20850.8" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="4822" y="-20835.8" font-family="Times,serif" font-size="14.00">X[4]: 1024×1024×4096</text>
</g>
<!-- qkv_proj_0_4 -->
<g id="node394" class="node">
<title>qkv_proj_0_4</title>
<polygon fill="none" stroke="black" points="4904.5,-20755 4739.5,-20755 4739.5,-20702 4904.5,-20702 4904.5,-20755"/>
<text text-anchor="middle" x="4822" y="-20739.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="4822" y="-20724.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="4822" y="-20709.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- input_4&#45;&gt;qkv_proj_0_4 -->
<g id="edge389" class="edge">
<title>input_4&#45;&gt;qkv_proj_0_4</title>
<path fill="none" stroke="black" d="M4822,-20827.96C4822,-20827.96 4822,-20765.44 4822,-20765.44"/>
<polygon fill="black" stroke="black" points="4825.5,-20765.44 4822,-20755.44 4818.5,-20765.44 4825.5,-20765.44"/>
</g>
<!-- qkv_reshape_0_4 -->
<g id="node395" class="node">
<title>qkv_reshape_0_4</title>
<ellipse fill="none" stroke="black" cx="4822" cy="-20602" rx="148" ry="27"/>
<text text-anchor="middle" x="4822" y="-20605.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="4822" y="-20590.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_0_4&#45;&gt;qkv_reshape_0_4 -->
<g id="edge390" class="edge">
<title>qkv_proj_0_4&#45;&gt;qkv_reshape_0_4</title>
<path fill="none" stroke="black" d="M4822,-20701.98C4822,-20701.98 4822,-20639.36 4822,-20639.36"/>
<polygon fill="black" stroke="black" points="4825.5,-20639.36 4822,-20629.36 4818.5,-20639.36 4825.5,-20639.36"/>
</g>
<!-- qkv_reshape_0_4&#45;&gt;ring_attn_0_4_stage_0 -->
<g id="edge391" class="edge">
<title>qkv_reshape_0_4&#45;&gt;ring_attn_0_4_stage_0</title>
<path fill="none" stroke="black" d="M4822,-20574.72C4822,-20574.72 4822,-20468.16 4822,-20468.16"/>
<polygon fill="black" stroke="black" points="4825.5,-20468.16 4822,-20458.16 4818.5,-20468.16 4825.5,-20468.16"/>
</g>
<!-- ring_attn_0_4_stage_0&#45;&gt;ring_attn_0_4_stage_1 -->
<g id="edge392" class="edge">
<title>ring_attn_0_4_stage_0&#45;&gt;ring_attn_0_4_stage_1</title>
<path fill="none" stroke="black" d="M4822,-20321.87C4822,-20321.87 4822,-20215.25 4822,-20215.25"/>
<polygon fill="black" stroke="black" points="4825.5,-20215.25 4822,-20205.25 4818.5,-20215.25 4825.5,-20215.25"/>
</g>
<!-- ring_attn_0_5_stage_0 -->
<g id="node494" class="node">
<title>ring_attn_0_5_stage_0</title>
<polygon fill="yellow" stroke="black" points="5409,-20458 5200,-20390 5409,-20322 5618,-20390 5409,-20458"/>
<text text-anchor="middle" x="5409" y="-20408.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-20393.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="5409" y="-20378.8" font-family="Times,serif" font-size="14.00">Q[5]×K[5]×V[5]</text>
<text text-anchor="middle" x="5409" y="-20363.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_4_stage_0&#45;&gt;ring_attn_0_5_stage_0 -->
<g id="edge2049" class="edge">
<title>ring_attn_0_4_stage_0&#45;&gt;ring_attn_0_5_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-20390C5031.02,-20390 5189.86,-20390 5189.86,-20390"/>
<polygon fill="red" stroke="red" points="5189.86,-20393.5 5199.86,-20390 5189.86,-20386.5 5189.86,-20393.5"/>
</g>
<!-- ring_attn_0_4_stage_1&#45;&gt;ring_attn_0_4_stage_2 -->
<g id="edge393" class="edge">
<title>ring_attn_0_4_stage_1&#45;&gt;ring_attn_0_4_stage_2</title>
<path fill="none" stroke="black" d="M4822,-20068.87C4822,-20068.87 4822,-19962.25 4822,-19962.25"/>
<polygon fill="black" stroke="black" points="4825.5,-19962.25 4822,-19952.25 4818.5,-19962.25 4825.5,-19962.25"/>
</g>
<!-- ring_attn_0_5_stage_1 -->
<g id="node495" class="node">
<title>ring_attn_0_5_stage_1</title>
<polygon fill="yellow" stroke="black" points="5409,-20205 5200,-20137 5409,-20069 5618,-20137 5409,-20205"/>
<text text-anchor="middle" x="5409" y="-20155.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-20140.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="5409" y="-20125.8" font-family="Times,serif" font-size="14.00">Q[5]×K[4]×V[4]</text>
<text text-anchor="middle" x="5409" y="-20110.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_4_stage_1&#45;&gt;ring_attn_0_5_stage_1 -->
<g id="edge2050" class="edge">
<title>ring_attn_0_4_stage_1&#45;&gt;ring_attn_0_5_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-20137C5031.02,-20137 5189.86,-20137 5189.86,-20137"/>
<polygon fill="red" stroke="red" points="5189.86,-20140.5 5199.86,-20137 5189.86,-20133.5 5189.86,-20140.5"/>
</g>
<!-- ring_attn_0_4_stage_2&#45;&gt;ring_attn_0_4_stage_3 -->
<g id="edge394" class="edge">
<title>ring_attn_0_4_stage_2&#45;&gt;ring_attn_0_4_stage_3</title>
<path fill="none" stroke="black" d="M4822,-19815.87C4822,-19815.87 4822,-19709.25 4822,-19709.25"/>
<polygon fill="black" stroke="black" points="4825.5,-19709.25 4822,-19699.25 4818.5,-19709.25 4825.5,-19709.25"/>
</g>
<!-- ring_attn_0_5_stage_2 -->
<g id="node496" class="node">
<title>ring_attn_0_5_stage_2</title>
<polygon fill="yellow" stroke="black" points="5409,-19952 5200,-19884 5409,-19816 5618,-19884 5409,-19952"/>
<text text-anchor="middle" x="5409" y="-19902.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-19887.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="5409" y="-19872.8" font-family="Times,serif" font-size="14.00">Q[5]×K[3]×V[3]</text>
<text text-anchor="middle" x="5409" y="-19857.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_4_stage_2&#45;&gt;ring_attn_0_5_stage_2 -->
<g id="edge2051" class="edge">
<title>ring_attn_0_4_stage_2&#45;&gt;ring_attn_0_5_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-19884C5031.02,-19884 5189.86,-19884 5189.86,-19884"/>
<polygon fill="red" stroke="red" points="5189.86,-19887.5 5199.86,-19884 5189.86,-19880.5 5189.86,-19887.5"/>
</g>
<!-- ring_attn_0_4_stage_3&#45;&gt;ring_attn_0_4_stage_4 -->
<g id="edge395" class="edge">
<title>ring_attn_0_4_stage_3&#45;&gt;ring_attn_0_4_stage_4</title>
<path fill="none" stroke="black" d="M4822,-19562.87C4822,-19562.87 4822,-19456.25 4822,-19456.25"/>
<polygon fill="black" stroke="black" points="4825.5,-19456.25 4822,-19446.25 4818.5,-19456.25 4825.5,-19456.25"/>
</g>
<!-- ring_attn_0_5_stage_3 -->
<g id="node497" class="node">
<title>ring_attn_0_5_stage_3</title>
<polygon fill="yellow" stroke="black" points="5409,-19699 5200,-19631 5409,-19563 5618,-19631 5409,-19699"/>
<text text-anchor="middle" x="5409" y="-19649.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-19634.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="5409" y="-19619.8" font-family="Times,serif" font-size="14.00">Q[5]×K[2]×V[2]</text>
<text text-anchor="middle" x="5409" y="-19604.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_4_stage_3&#45;&gt;ring_attn_0_5_stage_3 -->
<g id="edge2052" class="edge">
<title>ring_attn_0_4_stage_3&#45;&gt;ring_attn_0_5_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-19631C5031.02,-19631 5189.86,-19631 5189.86,-19631"/>
<polygon fill="red" stroke="red" points="5189.86,-19634.5 5199.86,-19631 5189.86,-19627.5 5189.86,-19634.5"/>
</g>
<!-- ring_attn_0_4_stage_4&#45;&gt;ring_attn_0_4_stage_5 -->
<g id="edge396" class="edge">
<title>ring_attn_0_4_stage_4&#45;&gt;ring_attn_0_4_stage_5</title>
<path fill="none" stroke="black" d="M4822,-19309.87C4822,-19309.87 4822,-19203.25 4822,-19203.25"/>
<polygon fill="black" stroke="black" points="4825.5,-19203.25 4822,-19193.25 4818.5,-19203.25 4825.5,-19203.25"/>
</g>
<!-- ring_attn_0_5_stage_4 -->
<g id="node498" class="node">
<title>ring_attn_0_5_stage_4</title>
<polygon fill="yellow" stroke="black" points="5409,-19446 5200,-19378 5409,-19310 5618,-19378 5409,-19446"/>
<text text-anchor="middle" x="5409" y="-19396.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-19381.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="5409" y="-19366.8" font-family="Times,serif" font-size="14.00">Q[5]×K[1]×V[1]</text>
<text text-anchor="middle" x="5409" y="-19351.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_4_stage_4&#45;&gt;ring_attn_0_5_stage_4 -->
<g id="edge2053" class="edge">
<title>ring_attn_0_4_stage_4&#45;&gt;ring_attn_0_5_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-19378C5031.02,-19378 5189.86,-19378 5189.86,-19378"/>
<polygon fill="red" stroke="red" points="5189.86,-19381.5 5199.86,-19378 5189.86,-19374.5 5189.86,-19381.5"/>
</g>
<!-- ring_attn_0_4_stage_5&#45;&gt;ring_attn_0_4_stage_6 -->
<g id="edge397" class="edge">
<title>ring_attn_0_4_stage_5&#45;&gt;ring_attn_0_4_stage_6</title>
<path fill="none" stroke="black" d="M4822,-19056.87C4822,-19056.87 4822,-18950.25 4822,-18950.25"/>
<polygon fill="black" stroke="black" points="4825.5,-18950.25 4822,-18940.25 4818.5,-18950.25 4825.5,-18950.25"/>
</g>
<!-- ring_attn_0_5_stage_5 -->
<g id="node499" class="node">
<title>ring_attn_0_5_stage_5</title>
<polygon fill="yellow" stroke="black" points="5409,-19193 5200,-19125 5409,-19057 5618,-19125 5409,-19193"/>
<text text-anchor="middle" x="5409" y="-19143.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-19128.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="5409" y="-19113.8" font-family="Times,serif" font-size="14.00">Q[5]×K[0]×V[0]</text>
<text text-anchor="middle" x="5409" y="-19098.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_4_stage_5&#45;&gt;ring_attn_0_5_stage_5 -->
<g id="edge2054" class="edge">
<title>ring_attn_0_4_stage_5&#45;&gt;ring_attn_0_5_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-19125C5031.02,-19125 5189.86,-19125 5189.86,-19125"/>
<polygon fill="red" stroke="red" points="5189.86,-19128.5 5199.86,-19125 5189.86,-19121.5 5189.86,-19128.5"/>
</g>
<!-- ring_attn_0_4_stage_6&#45;&gt;ring_attn_0_4_stage_7 -->
<g id="edge398" class="edge">
<title>ring_attn_0_4_stage_6&#45;&gt;ring_attn_0_4_stage_7</title>
<path fill="none" stroke="black" d="M4822,-18803.87C4822,-18803.87 4822,-18697.25 4822,-18697.25"/>
<polygon fill="black" stroke="black" points="4825.5,-18697.25 4822,-18687.25 4818.5,-18697.25 4825.5,-18697.25"/>
</g>
<!-- ring_attn_0_5_stage_6 -->
<g id="node500" class="node">
<title>ring_attn_0_5_stage_6</title>
<polygon fill="yellow" stroke="black" points="5409,-18940 5200,-18872 5409,-18804 5618,-18872 5409,-18940"/>
<text text-anchor="middle" x="5409" y="-18890.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-18875.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="5409" y="-18860.8" font-family="Times,serif" font-size="14.00">Q[5]×K[15]×V[15]</text>
<text text-anchor="middle" x="5409" y="-18845.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_4_stage_6&#45;&gt;ring_attn_0_5_stage_6 -->
<g id="edge2055" class="edge">
<title>ring_attn_0_4_stage_6&#45;&gt;ring_attn_0_5_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-18872C5031.02,-18872 5189.86,-18872 5189.86,-18872"/>
<polygon fill="red" stroke="red" points="5189.86,-18875.5 5199.86,-18872 5189.86,-18868.5 5189.86,-18875.5"/>
</g>
<!-- ring_attn_0_4_stage_7&#45;&gt;ring_attn_0_4_stage_8 -->
<g id="edge399" class="edge">
<title>ring_attn_0_4_stage_7&#45;&gt;ring_attn_0_4_stage_8</title>
<path fill="none" stroke="black" d="M4822,-18550.87C4822,-18550.87 4822,-18444.25 4822,-18444.25"/>
<polygon fill="black" stroke="black" points="4825.5,-18444.25 4822,-18434.25 4818.5,-18444.25 4825.5,-18444.25"/>
</g>
<!-- ring_attn_0_5_stage_7 -->
<g id="node501" class="node">
<title>ring_attn_0_5_stage_7</title>
<polygon fill="yellow" stroke="black" points="5409,-18687 5200,-18619 5409,-18551 5618,-18619 5409,-18687"/>
<text text-anchor="middle" x="5409" y="-18637.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-18622.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="5409" y="-18607.8" font-family="Times,serif" font-size="14.00">Q[5]×K[14]×V[14]</text>
<text text-anchor="middle" x="5409" y="-18592.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_4_stage_7&#45;&gt;ring_attn_0_5_stage_7 -->
<g id="edge2056" class="edge">
<title>ring_attn_0_4_stage_7&#45;&gt;ring_attn_0_5_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-18619C5031.02,-18619 5189.86,-18619 5189.86,-18619"/>
<polygon fill="red" stroke="red" points="5189.86,-18622.5 5199.86,-18619 5189.86,-18615.5 5189.86,-18622.5"/>
</g>
<!-- ring_attn_0_4_stage_8&#45;&gt;ring_attn_0_4_stage_9 -->
<g id="edge400" class="edge">
<title>ring_attn_0_4_stage_8&#45;&gt;ring_attn_0_4_stage_9</title>
<path fill="none" stroke="black" d="M4822,-18297.87C4822,-18297.87 4822,-18191.25 4822,-18191.25"/>
<polygon fill="black" stroke="black" points="4825.5,-18191.25 4822,-18181.25 4818.5,-18191.25 4825.5,-18191.25"/>
</g>
<!-- ring_attn_0_5_stage_8 -->
<g id="node502" class="node">
<title>ring_attn_0_5_stage_8</title>
<polygon fill="yellow" stroke="black" points="5409,-18434 5200,-18366 5409,-18298 5618,-18366 5409,-18434"/>
<text text-anchor="middle" x="5409" y="-18384.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-18369.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="5409" y="-18354.8" font-family="Times,serif" font-size="14.00">Q[5]×K[13]×V[13]</text>
<text text-anchor="middle" x="5409" y="-18339.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_4_stage_8&#45;&gt;ring_attn_0_5_stage_8 -->
<g id="edge2057" class="edge">
<title>ring_attn_0_4_stage_8&#45;&gt;ring_attn_0_5_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-18366C5031.02,-18366 5189.86,-18366 5189.86,-18366"/>
<polygon fill="red" stroke="red" points="5189.86,-18369.5 5199.86,-18366 5189.86,-18362.5 5189.86,-18369.5"/>
</g>
<!-- ring_attn_0_4_stage_9&#45;&gt;ring_attn_0_4_stage_10 -->
<g id="edge401" class="edge">
<title>ring_attn_0_4_stage_9&#45;&gt;ring_attn_0_4_stage_10</title>
<path fill="none" stroke="black" d="M4822,-18044.87C4822,-18044.87 4822,-17938.25 4822,-17938.25"/>
<polygon fill="black" stroke="black" points="4825.5,-17938.25 4822,-17928.25 4818.5,-17938.25 4825.5,-17938.25"/>
</g>
<!-- ring_attn_0_5_stage_9 -->
<g id="node503" class="node">
<title>ring_attn_0_5_stage_9</title>
<polygon fill="yellow" stroke="black" points="5409,-18181 5200,-18113 5409,-18045 5618,-18113 5409,-18181"/>
<text text-anchor="middle" x="5409" y="-18131.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-18116.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="5409" y="-18101.8" font-family="Times,serif" font-size="14.00">Q[5]×K[12]×V[12]</text>
<text text-anchor="middle" x="5409" y="-18086.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_4_stage_9&#45;&gt;ring_attn_0_5_stage_9 -->
<g id="edge2058" class="edge">
<title>ring_attn_0_4_stage_9&#45;&gt;ring_attn_0_5_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-18113C5031.02,-18113 5189.86,-18113 5189.86,-18113"/>
<polygon fill="red" stroke="red" points="5189.86,-18116.5 5199.86,-18113 5189.86,-18109.5 5189.86,-18116.5"/>
</g>
<!-- ring_attn_0_4_stage_10&#45;&gt;ring_attn_0_4_stage_11 -->
<g id="edge402" class="edge">
<title>ring_attn_0_4_stage_10&#45;&gt;ring_attn_0_4_stage_11</title>
<path fill="none" stroke="black" d="M4822,-17791.87C4822,-17791.87 4822,-17685.25 4822,-17685.25"/>
<polygon fill="black" stroke="black" points="4825.5,-17685.25 4822,-17675.25 4818.5,-17685.25 4825.5,-17685.25"/>
</g>
<!-- ring_attn_0_5_stage_10 -->
<g id="node504" class="node">
<title>ring_attn_0_5_stage_10</title>
<polygon fill="yellow" stroke="black" points="5409,-17928 5200,-17860 5409,-17792 5618,-17860 5409,-17928"/>
<text text-anchor="middle" x="5409" y="-17878.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-17863.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="5409" y="-17848.8" font-family="Times,serif" font-size="14.00">Q[5]×K[11]×V[11]</text>
<text text-anchor="middle" x="5409" y="-17833.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_4_stage_10&#45;&gt;ring_attn_0_5_stage_10 -->
<g id="edge2059" class="edge">
<title>ring_attn_0_4_stage_10&#45;&gt;ring_attn_0_5_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-17860C5031.02,-17860 5189.86,-17860 5189.86,-17860"/>
<polygon fill="red" stroke="red" points="5189.86,-17863.5 5199.86,-17860 5189.86,-17856.5 5189.86,-17863.5"/>
</g>
<!-- ring_attn_0_4_stage_11&#45;&gt;ring_attn_0_4_stage_12 -->
<g id="edge403" class="edge">
<title>ring_attn_0_4_stage_11&#45;&gt;ring_attn_0_4_stage_12</title>
<path fill="none" stroke="black" d="M4822,-17538.87C4822,-17538.87 4822,-17432.25 4822,-17432.25"/>
<polygon fill="black" stroke="black" points="4825.5,-17432.25 4822,-17422.25 4818.5,-17432.25 4825.5,-17432.25"/>
</g>
<!-- ring_attn_0_5_stage_11 -->
<g id="node505" class="node">
<title>ring_attn_0_5_stage_11</title>
<polygon fill="yellow" stroke="black" points="5409,-17675 5200,-17607 5409,-17539 5618,-17607 5409,-17675"/>
<text text-anchor="middle" x="5409" y="-17625.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-17610.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="5409" y="-17595.8" font-family="Times,serif" font-size="14.00">Q[5]×K[10]×V[10]</text>
<text text-anchor="middle" x="5409" y="-17580.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_4_stage_11&#45;&gt;ring_attn_0_5_stage_11 -->
<g id="edge2060" class="edge">
<title>ring_attn_0_4_stage_11&#45;&gt;ring_attn_0_5_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-17607C5031.02,-17607 5189.86,-17607 5189.86,-17607"/>
<polygon fill="red" stroke="red" points="5189.86,-17610.5 5199.86,-17607 5189.86,-17603.5 5189.86,-17610.5"/>
</g>
<!-- ring_attn_0_4_stage_12&#45;&gt;ring_attn_0_4_stage_13 -->
<g id="edge404" class="edge">
<title>ring_attn_0_4_stage_12&#45;&gt;ring_attn_0_4_stage_13</title>
<path fill="none" stroke="black" d="M4822,-17285.87C4822,-17285.87 4822,-17179.25 4822,-17179.25"/>
<polygon fill="black" stroke="black" points="4825.5,-17179.25 4822,-17169.25 4818.5,-17179.25 4825.5,-17179.25"/>
</g>
<!-- ring_attn_0_5_stage_12 -->
<g id="node506" class="node">
<title>ring_attn_0_5_stage_12</title>
<polygon fill="yellow" stroke="black" points="5409,-17422 5200,-17354 5409,-17286 5618,-17354 5409,-17422"/>
<text text-anchor="middle" x="5409" y="-17372.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-17357.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="5409" y="-17342.8" font-family="Times,serif" font-size="14.00">Q[5]×K[9]×V[9]</text>
<text text-anchor="middle" x="5409" y="-17327.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_4_stage_12&#45;&gt;ring_attn_0_5_stage_12 -->
<g id="edge2061" class="edge">
<title>ring_attn_0_4_stage_12&#45;&gt;ring_attn_0_5_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-17354C5031.02,-17354 5189.86,-17354 5189.86,-17354"/>
<polygon fill="red" stroke="red" points="5189.86,-17357.5 5199.86,-17354 5189.86,-17350.5 5189.86,-17357.5"/>
</g>
<!-- ring_attn_0_4_stage_13&#45;&gt;ring_attn_0_4_stage_14 -->
<g id="edge405" class="edge">
<title>ring_attn_0_4_stage_13&#45;&gt;ring_attn_0_4_stage_14</title>
<path fill="none" stroke="black" d="M4822,-17032.87C4822,-17032.87 4822,-16926.25 4822,-16926.25"/>
<polygon fill="black" stroke="black" points="4825.5,-16926.25 4822,-16916.25 4818.5,-16926.25 4825.5,-16926.25"/>
</g>
<!-- ring_attn_0_5_stage_13 -->
<g id="node507" class="node">
<title>ring_attn_0_5_stage_13</title>
<polygon fill="yellow" stroke="black" points="5409,-17169 5200,-17101 5409,-17033 5618,-17101 5409,-17169"/>
<text text-anchor="middle" x="5409" y="-17119.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-17104.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="5409" y="-17089.8" font-family="Times,serif" font-size="14.00">Q[5]×K[8]×V[8]</text>
<text text-anchor="middle" x="5409" y="-17074.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_4_stage_13&#45;&gt;ring_attn_0_5_stage_13 -->
<g id="edge2062" class="edge">
<title>ring_attn_0_4_stage_13&#45;&gt;ring_attn_0_5_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-17101C5031.02,-17101 5189.86,-17101 5189.86,-17101"/>
<polygon fill="red" stroke="red" points="5189.86,-17104.5 5199.86,-17101 5189.86,-17097.5 5189.86,-17104.5"/>
</g>
<!-- ring_attn_0_4_stage_14&#45;&gt;ring_attn_0_4_stage_15 -->
<g id="edge406" class="edge">
<title>ring_attn_0_4_stage_14&#45;&gt;ring_attn_0_4_stage_15</title>
<path fill="none" stroke="black" d="M4822,-16779.87C4822,-16779.87 4822,-16673.25 4822,-16673.25"/>
<polygon fill="black" stroke="black" points="4825.5,-16673.25 4822,-16663.25 4818.5,-16673.25 4825.5,-16673.25"/>
</g>
<!-- ring_attn_0_5_stage_14 -->
<g id="node508" class="node">
<title>ring_attn_0_5_stage_14</title>
<polygon fill="yellow" stroke="black" points="5409,-16916 5200,-16848 5409,-16780 5618,-16848 5409,-16916"/>
<text text-anchor="middle" x="5409" y="-16866.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-16851.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="5409" y="-16836.8" font-family="Times,serif" font-size="14.00">Q[5]×K[7]×V[7]</text>
<text text-anchor="middle" x="5409" y="-16821.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_4_stage_14&#45;&gt;ring_attn_0_5_stage_14 -->
<g id="edge2063" class="edge">
<title>ring_attn_0_4_stage_14&#45;&gt;ring_attn_0_5_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-16848C5031.02,-16848 5189.86,-16848 5189.86,-16848"/>
<polygon fill="red" stroke="red" points="5189.86,-16851.5 5199.86,-16848 5189.86,-16844.5 5189.86,-16851.5"/>
</g>
<!-- attn_out_0_4 -->
<g id="node412" class="node">
<title>attn_out_0_4</title>
<polygon fill="none" stroke="black" points="4891.5,-16454 4752.5,-16454 4752.5,-16401 4891.5,-16401 4891.5,-16454"/>
<text text-anchor="middle" x="4822" y="-16438.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="4822" y="-16423.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="4822" y="-16408.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_0_4_stage_15&#45;&gt;attn_out_0_4 -->
<g id="edge407" class="edge">
<title>ring_attn_0_4_stage_15&#45;&gt;attn_out_0_4</title>
<path fill="none" stroke="black" d="M4822,-16526.87C4822,-16526.87 4822,-16464.18 4822,-16464.18"/>
<polygon fill="black" stroke="black" points="4825.5,-16464.18 4822,-16454.18 4818.5,-16464.18 4825.5,-16464.18"/>
</g>
<!-- ring_attn_0_5_stage_15 -->
<g id="node509" class="node">
<title>ring_attn_0_5_stage_15</title>
<polygon fill="yellow" stroke="black" points="5409,-16663 5200,-16595 5409,-16527 5618,-16595 5409,-16663"/>
<text text-anchor="middle" x="5409" y="-16613.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-16598.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="5409" y="-16583.8" font-family="Times,serif" font-size="14.00">Q[5]×K[6]×V[6]</text>
<text text-anchor="middle" x="5409" y="-16568.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_4_stage_15&#45;&gt;ring_attn_0_5_stage_15 -->
<g id="edge2064" class="edge">
<title>ring_attn_0_4_stage_15&#45;&gt;ring_attn_0_5_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-16595C5031.02,-16595 5189.86,-16595 5189.86,-16595"/>
<polygon fill="red" stroke="red" points="5189.86,-16598.5 5199.86,-16595 5189.86,-16591.5 5189.86,-16598.5"/>
</g>
<!-- attn_residual_0_4 -->
<g id="node413" class="node">
<title>attn_residual_0_4</title>
<ellipse fill="none" stroke="black" cx="4822" cy="-16301" rx="105.5" ry="27"/>
<text text-anchor="middle" x="4822" y="-16304.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="4822" y="-16289.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_0_4&#45;&gt;attn_residual_0_4 -->
<g id="edge408" class="edge">
<title>attn_out_0_4&#45;&gt;attn_residual_0_4</title>
<path fill="none" stroke="black" d="M4822,-16400.98C4822,-16400.98 4822,-16338.36 4822,-16338.36"/>
<polygon fill="black" stroke="black" points="4825.5,-16338.36 4822,-16328.36 4818.5,-16338.36 4825.5,-16338.36"/>
</g>
<!-- gate_0_4 -->
<g id="node414" class="node">
<title>gate_0_4</title>
<ellipse fill="orange" stroke="black" cx="4822" cy="-16163.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="4822" y="-16174.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="4822" y="-16159.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="4822" y="-16144.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_0_4&#45;&gt;gate_0_4 -->
<g id="edge409" class="edge">
<title>attn_residual_0_4&#45;&gt;gate_0_4</title>
<path fill="none" stroke="black" d="M4769.25,-16277.36C4769.25,-16277.36 4769.25,-16206.08 4769.25,-16206.08"/>
<polygon fill="black" stroke="black" points="4772.75,-16206.08 4769.25,-16196.08 4765.75,-16206.08 4772.75,-16206.08"/>
</g>
<!-- gate_0_4&#45;&gt;expert_0_0_0 -->
<g id="edge2065" class="edge">
<title>gate_0_4&#45;&gt;expert_0_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4726.55,-16147.4C4726.55,-16136.85 4726.55,-16125 4726.55,-16125 4726.55,-16125 147.63,-16125 147.63,-16125 147.63,-16125 147.63,-16004.22 147.63,-16004.22"/>
<polygon fill="blue" stroke="blue" points="151.13,-16004.22 147.63,-15994.22 144.13,-16004.22 151.13,-16004.22"/>
<text text-anchor="middle" x="19436.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19436.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU4→GPU0</text>
<text text-anchor="middle" x="19436.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19436.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_4&#45;&gt;expert_0_1_0 -->
<g id="edge2066" class="edge">
<title>gate_0_4&#45;&gt;expert_0_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4746.64,-16136.99C4746.64,-16119.96 4746.64,-16101 4746.64,-16101 4746.64,-16101 3178.07,-16101 3178.07,-16101 3178.07,-16101 3178.07,-16004.19 3178.07,-16004.19"/>
<polygon fill="blue" stroke="blue" points="3181.57,-16004.19 3178.07,-15994.19 3174.57,-16004.19 3181.57,-16004.19"/>
<text text-anchor="middle" x="19610.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19610.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU4→GPU1</text>
<text text-anchor="middle" x="19610.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19610.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_4&#45;&gt;expert_0_2_0 -->
<g id="edge2067" class="edge">
<title>gate_0_4&#45;&gt;expert_0_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4756.69,-16133.76C4756.69,-16126.12 4756.69,-16120 4756.69,-16120 4756.69,-16120 3762.5,-16120 3762.5,-16120 3762.5,-16120 3762.5,-16004.06 3762.5,-16004.06"/>
<polygon fill="blue" stroke="blue" points="3766,-16004.06 3762.5,-15994.06 3759,-16004.06 3766,-16004.06"/>
<text text-anchor="middle" x="19784.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19784.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU4→GPU2</text>
<text text-anchor="middle" x="19784.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19784.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_4&#45;&gt;expert_0_3_0 -->
<g id="edge2068" class="edge">
<title>gate_0_4&#45;&gt;expert_0_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4722.3,-16176C4582.46,-16176 4345,-16176 4345,-16176 4345,-16176 4345,-16004.33 4345,-16004.33"/>
<polygon fill="blue" stroke="blue" points="4348.5,-16004.33 4345,-15994.33 4341.5,-16004.33 4348.5,-16004.33"/>
<text text-anchor="middle" x="19958.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19958.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU4→GPU3</text>
<text text-anchor="middle" x="19958.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19958.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_4&#45;&gt;expert_0_4_0 -->
<g id="edge410" class="edge">
<title>gate_0_4&#45;&gt;expert_0_4_0</title>
<path fill="none" stroke="black" d="M4766.74,-16131.13C4766.74,-16131.13 4766.74,-16004.24 4766.74,-16004.24"/>
<polygon fill="black" stroke="black" points="4770.24,-16004.24 4766.74,-15994.24 4763.24,-16004.24 4770.24,-16004.24"/>
</g>
<!-- gate_0_4&#45;&gt;expert_0_5_0 -->
<g id="edge2069" class="edge">
<title>gate_0_4&#45;&gt;expert_0_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4921.65,-16151C5061.77,-16151 5300.12,-16151 5300.12,-16151 5300.12,-16151 5300.12,-16004.18 5300.12,-16004.18"/>
<polygon fill="blue" stroke="blue" points="5303.63,-16004.18 5300.12,-15994.18 5296.63,-16004.18 5303.63,-16004.18"/>
<text text-anchor="middle" x="20132.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="20132.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU4→GPU5</text>
<text text-anchor="middle" x="20132.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="20132.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_4&#45;&gt;expert_0_6_0 -->
<g id="edge2070" class="edge">
<title>gate_0_4&#45;&gt;expert_0_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4847.12,-16126.76C4847.12,-16115.49 4847.12,-16106 4847.12,-16106 4847.12,-16106 5882.4,-16106 5882.4,-16106 5882.4,-16106 5882.4,-16004.2 5882.4,-16004.2"/>
<polygon fill="blue" stroke="blue" points="5885.9,-16004.2 5882.4,-15994.2 5878.9,-16004.2 5885.9,-16004.2"/>
<text text-anchor="middle" x="20306.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="20306.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU4→GPU6</text>
<text text-anchor="middle" x="20306.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="20306.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_4&#45;&gt;expert_0_7_0 -->
<g id="edge2071" class="edge">
<title>gate_0_4&#45;&gt;expert_0_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4857.17,-16128.05C4857.17,-16111.33 4857.17,-16095 4857.17,-16095 4857.17,-16095 6467.38,-16095 6467.38,-16095 6467.38,-16095 6467.38,-16004.23 6467.38,-16004.23"/>
<polygon fill="blue" stroke="blue" points="6470.88,-16004.23 6467.38,-15994.23 6463.88,-16004.23 6470.88,-16004.23"/>
<text text-anchor="middle" x="20480.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="20480.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU4→GPU7</text>
<text text-anchor="middle" x="20480.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="20480.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_4&#45;&gt;expert_0_8_0 -->
<g id="edge2072" class="edge">
<title>gate_0_4&#45;&gt;expert_0_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4867.21,-16129.3C4867.21,-16108.14 4867.21,-16085 4867.21,-16085 4867.21,-16085 7137.89,-16085 7137.89,-16085 7137.89,-16085 7137.89,-16004.16 7137.89,-16004.16"/>
<polygon fill="blue" stroke="blue" points="7141.39,-16004.16 7137.89,-15994.16 7134.39,-16004.16 7141.39,-16004.16"/>
<text text-anchor="middle" x="20654.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="20654.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU4→GPU8</text>
<text text-anchor="middle" x="20654.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="20654.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_4&#45;&gt;expert_0_9_0 -->
<g id="edge2073" class="edge">
<title>gate_0_4&#45;&gt;expert_0_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4877.26,-16131.37C4877.26,-16108.2 4877.26,-16081 4877.26,-16081 4877.26,-16081 7718.64,-16081 7718.64,-16081 7718.64,-16081 7718.64,-16004.11 7718.64,-16004.11"/>
<polygon fill="blue" stroke="blue" points="7722.14,-16004.11 7718.64,-15994.11 7715.14,-16004.11 7722.14,-16004.11"/>
<text text-anchor="middle" x="20828.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="20828.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU4→GPU9</text>
<text text-anchor="middle" x="20828.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="20828.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_4&#45;&gt;expert_0_10_0 -->
<g id="edge2074" class="edge">
<title>gate_0_4&#45;&gt;expert_0_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4887.31,-16133.85C4887.31,-16101.73 4887.31,-16055 4887.31,-16055 4887.31,-16055 8298.79,-16055 8298.79,-16055 8298.79,-16055 8298.79,-16004.23 8298.79,-16004.23"/>
<polygon fill="blue" stroke="blue" points="8302.29,-16004.23 8298.79,-15994.23 8295.29,-16004.23 8302.29,-16004.23"/>
<text text-anchor="middle" x="21002.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21002.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU4→GPU10</text>
<text text-anchor="middle" x="21002.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21002.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_4&#45;&gt;expert_0_11_0 -->
<g id="edge2075" class="edge">
<title>gate_0_4&#45;&gt;expert_0_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4897.36,-16137.08C4897.36,-16099.74 4897.36,-16036 4897.36,-16036 4897.36,-16036 8885.79,-16036 8885.79,-16036 8885.79,-16036 8885.79,-16004.18 8885.79,-16004.18"/>
<polygon fill="blue" stroke="blue" points="8889.29,-16004.18 8885.79,-15994.18 8882.29,-16004.18 8889.29,-16004.18"/>
<text text-anchor="middle" x="21176.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21176.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU4→GPU11</text>
<text text-anchor="middle" x="21176.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21176.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_4&#45;&gt;expert_0_12_0 -->
<g id="edge2076" class="edge">
<title>gate_0_4&#45;&gt;expert_0_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4907.4,-16141.46C4907.4,-16103.54 4907.4,-16030 4907.4,-16030 4907.4,-16030 9485.89,-16030 9485.89,-16030 9485.89,-16030 9485.89,-16004.01 9485.89,-16004.01"/>
<polygon fill="blue" stroke="blue" points="9489.39,-16004.01 9485.89,-15994.01 9482.39,-16004.01 9489.39,-16004.01"/>
<text text-anchor="middle" x="21350.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21350.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU4→GPU12</text>
<text text-anchor="middle" x="21350.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21350.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_4&#45;&gt;expert_0_13_0 -->
<g id="edge2077" class="edge">
<title>gate_0_4&#45;&gt;expert_0_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4917.45,-16147.38C4917.45,-16110.48 4917.45,-16023 4917.45,-16023 4917.45,-16023 10083.9,-16023 10083.9,-16023 10083.9,-16023 10083.9,-16004.27 10083.9,-16004.27"/>
<polygon fill="blue" stroke="blue" points="10087.4,-16004.27 10083.9,-15994.27 10080.4,-16004.27 10087.4,-16004.27"/>
<text text-anchor="middle" x="21524.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21524.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU4→GPU13</text>
<text text-anchor="middle" x="21524.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21524.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_4&#45;&gt;expert_0_14_0 -->
<g id="edge2078" class="edge">
<title>gate_0_4&#45;&gt;expert_0_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4874.75,-16196.25C4874.75,-16212.62 4874.75,-16229 4874.75,-16229 4874.75,-16229 10802,-16229 10802,-16229 10802,-16229 10802,-16004.01 10802,-16004.01"/>
<polygon fill="blue" stroke="blue" points="10805.5,-16004.01 10802,-15994.01 10798.5,-16004.01 10805.5,-16004.01"/>
<text text-anchor="middle" x="21698.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21698.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU4→GPU14</text>
<text text-anchor="middle" x="21698.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21698.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_4&#45;&gt;expert_0_15_0 -->
<g id="edge2079" class="edge">
<title>gate_0_4&#45;&gt;expert_0_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4822,-16201.3C4822,-16223.8 4822,-16248 4822,-16248 4822,-16248 11391.25,-16248 11391.25,-16248 11391.25,-16248 11391.25,-16004.14 11391.25,-16004.14"/>
<polygon fill="blue" stroke="blue" points="11394.75,-16004.14 11391.25,-15994.14 11387.75,-16004.14 11394.75,-16004.14"/>
<text text-anchor="middle" x="21872.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21872.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU4→GPU15</text>
<text text-anchor="middle" x="21872.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21872.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_4 -->
<g id="node416" class="node">
<title>expert_reduce_0_4</title>
<ellipse fill="none" stroke="black" cx="4822" cy="-15830.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="4822" y="-15841.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="4822" y="-15826.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="4822" y="-15811.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_4_0&#45;&gt;expert_reduce_0_4 -->
<g id="edge411" class="edge">
<title>expert_0_4_0&#45;&gt;expert_reduce_0_4</title>
<path fill="none" stroke="black" d="M4822,-15940.76C4822,-15940.76 4822,-15878.06 4822,-15878.06"/>
<polygon fill="black" stroke="black" points="4825.5,-15878.06 4822,-15868.06 4818.5,-15878.06 4825.5,-15878.06"/>
</g>
<!-- moe_residual_0_4 -->
<g id="node417" class="node">
<title>moe_residual_0_4</title>
<ellipse fill="none" stroke="black" cx="4822" cy="-15693" rx="105.5" ry="27"/>
<text text-anchor="middle" x="4822" y="-15696.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="4822" y="-15681.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_4&#45;&gt;moe_residual_0_4 -->
<g id="edge412" class="edge">
<title>expert_reduce_0_4&#45;&gt;moe_residual_0_4</title>
<path fill="none" stroke="black" d="M4822,-15792.93C4822,-15792.93 4822,-15730.06 4822,-15730.06"/>
<polygon fill="black" stroke="black" points="4825.5,-15730.06 4822,-15720.06 4818.5,-15730.06 4825.5,-15730.06"/>
</g>
<!-- qkv_proj_1_4 -->
<g id="node418" class="node">
<title>qkv_proj_1_4</title>
<polygon fill="none" stroke="black" points="4904.5,-15593 4739.5,-15593 4739.5,-15540 4904.5,-15540 4904.5,-15593"/>
<text text-anchor="middle" x="4822" y="-15577.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="4822" y="-15562.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="4822" y="-15547.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_0_4&#45;&gt;qkv_proj_1_4 -->
<g id="edge413" class="edge">
<title>moe_residual_0_4&#45;&gt;qkv_proj_1_4</title>
<path fill="none" stroke="black" d="M4822,-15665.86C4822,-15665.86 4822,-15603.16 4822,-15603.16"/>
<polygon fill="black" stroke="black" points="4825.5,-15603.16 4822,-15593.16 4818.5,-15603.16 4825.5,-15603.16"/>
</g>
<!-- qkv_reshape_1_4 -->
<g id="node419" class="node">
<title>qkv_reshape_1_4</title>
<ellipse fill="none" stroke="black" cx="4822" cy="-15440" rx="148" ry="27"/>
<text text-anchor="middle" x="4822" y="-15443.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="4822" y="-15428.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_1_4&#45;&gt;qkv_reshape_1_4 -->
<g id="edge414" class="edge">
<title>qkv_proj_1_4&#45;&gt;qkv_reshape_1_4</title>
<path fill="none" stroke="black" d="M4822,-15539.98C4822,-15539.98 4822,-15477.36 4822,-15477.36"/>
<polygon fill="black" stroke="black" points="4825.5,-15477.36 4822,-15467.36 4818.5,-15477.36 4825.5,-15477.36"/>
</g>
<!-- qkv_reshape_1_4&#45;&gt;ring_attn_1_4_stage_0 -->
<g id="edge415" class="edge">
<title>qkv_reshape_1_4&#45;&gt;ring_attn_1_4_stage_0</title>
<path fill="none" stroke="black" d="M4822,-15412.72C4822,-15412.72 4822,-15306.16 4822,-15306.16"/>
<polygon fill="black" stroke="black" points="4825.5,-15306.16 4822,-15296.16 4818.5,-15306.16 4825.5,-15306.16"/>
</g>
<!-- ring_attn_1_4_stage_0&#45;&gt;ring_attn_1_4_stage_1 -->
<g id="edge416" class="edge">
<title>ring_attn_1_4_stage_0&#45;&gt;ring_attn_1_4_stage_1</title>
<path fill="none" stroke="black" d="M4822,-15159.87C4822,-15159.87 4822,-15053.25 4822,-15053.25"/>
<polygon fill="black" stroke="black" points="4825.5,-15053.25 4822,-15043.25 4818.5,-15053.25 4825.5,-15053.25"/>
</g>
<!-- ring_attn_1_5_stage_0 -->
<g id="node518" class="node">
<title>ring_attn_1_5_stage_0</title>
<polygon fill="yellow" stroke="black" points="5409,-15296 5200,-15228 5409,-15160 5618,-15228 5409,-15296"/>
<text text-anchor="middle" x="5409" y="-15246.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-15231.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="5409" y="-15216.8" font-family="Times,serif" font-size="14.00">Q[5]×K[5]×V[5]</text>
<text text-anchor="middle" x="5409" y="-15201.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_4_stage_0&#45;&gt;ring_attn_1_5_stage_0 -->
<g id="edge2080" class="edge">
<title>ring_attn_1_4_stage_0&#45;&gt;ring_attn_1_5_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-15228C5031.02,-15228 5189.86,-15228 5189.86,-15228"/>
<polygon fill="red" stroke="red" points="5189.86,-15231.5 5199.86,-15228 5189.86,-15224.5 5189.86,-15231.5"/>
</g>
<!-- ring_attn_1_4_stage_1&#45;&gt;ring_attn_1_4_stage_2 -->
<g id="edge417" class="edge">
<title>ring_attn_1_4_stage_1&#45;&gt;ring_attn_1_4_stage_2</title>
<path fill="none" stroke="black" d="M4822,-14906.87C4822,-14906.87 4822,-14800.25 4822,-14800.25"/>
<polygon fill="black" stroke="black" points="4825.5,-14800.25 4822,-14790.25 4818.5,-14800.25 4825.5,-14800.25"/>
</g>
<!-- ring_attn_1_5_stage_1 -->
<g id="node519" class="node">
<title>ring_attn_1_5_stage_1</title>
<polygon fill="yellow" stroke="black" points="5409,-15043 5200,-14975 5409,-14907 5618,-14975 5409,-15043"/>
<text text-anchor="middle" x="5409" y="-14993.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-14978.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="5409" y="-14963.8" font-family="Times,serif" font-size="14.00">Q[5]×K[4]×V[4]</text>
<text text-anchor="middle" x="5409" y="-14948.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_4_stage_1&#45;&gt;ring_attn_1_5_stage_1 -->
<g id="edge2081" class="edge">
<title>ring_attn_1_4_stage_1&#45;&gt;ring_attn_1_5_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-14975C5031.02,-14975 5189.86,-14975 5189.86,-14975"/>
<polygon fill="red" stroke="red" points="5189.86,-14978.5 5199.86,-14975 5189.86,-14971.5 5189.86,-14978.5"/>
</g>
<!-- ring_attn_1_4_stage_2&#45;&gt;ring_attn_1_4_stage_3 -->
<g id="edge418" class="edge">
<title>ring_attn_1_4_stage_2&#45;&gt;ring_attn_1_4_stage_3</title>
<path fill="none" stroke="black" d="M4822,-14653.87C4822,-14653.87 4822,-14547.25 4822,-14547.25"/>
<polygon fill="black" stroke="black" points="4825.5,-14547.25 4822,-14537.25 4818.5,-14547.25 4825.5,-14547.25"/>
</g>
<!-- ring_attn_1_5_stage_2 -->
<g id="node520" class="node">
<title>ring_attn_1_5_stage_2</title>
<polygon fill="yellow" stroke="black" points="5409,-14790 5200,-14722 5409,-14654 5618,-14722 5409,-14790"/>
<text text-anchor="middle" x="5409" y="-14740.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-14725.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="5409" y="-14710.8" font-family="Times,serif" font-size="14.00">Q[5]×K[3]×V[3]</text>
<text text-anchor="middle" x="5409" y="-14695.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_4_stage_2&#45;&gt;ring_attn_1_5_stage_2 -->
<g id="edge2082" class="edge">
<title>ring_attn_1_4_stage_2&#45;&gt;ring_attn_1_5_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-14722C5031.02,-14722 5189.86,-14722 5189.86,-14722"/>
<polygon fill="red" stroke="red" points="5189.86,-14725.5 5199.86,-14722 5189.86,-14718.5 5189.86,-14725.5"/>
</g>
<!-- ring_attn_1_4_stage_3&#45;&gt;ring_attn_1_4_stage_4 -->
<g id="edge419" class="edge">
<title>ring_attn_1_4_stage_3&#45;&gt;ring_attn_1_4_stage_4</title>
<path fill="none" stroke="black" d="M4822,-14400.87C4822,-14400.87 4822,-14294.25 4822,-14294.25"/>
<polygon fill="black" stroke="black" points="4825.5,-14294.25 4822,-14284.25 4818.5,-14294.25 4825.5,-14294.25"/>
</g>
<!-- ring_attn_1_5_stage_3 -->
<g id="node521" class="node">
<title>ring_attn_1_5_stage_3</title>
<polygon fill="yellow" stroke="black" points="5409,-14537 5200,-14469 5409,-14401 5618,-14469 5409,-14537"/>
<text text-anchor="middle" x="5409" y="-14487.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-14472.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="5409" y="-14457.8" font-family="Times,serif" font-size="14.00">Q[5]×K[2]×V[2]</text>
<text text-anchor="middle" x="5409" y="-14442.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_4_stage_3&#45;&gt;ring_attn_1_5_stage_3 -->
<g id="edge2083" class="edge">
<title>ring_attn_1_4_stage_3&#45;&gt;ring_attn_1_5_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-14469C5031.02,-14469 5189.86,-14469 5189.86,-14469"/>
<polygon fill="red" stroke="red" points="5189.86,-14472.5 5199.86,-14469 5189.86,-14465.5 5189.86,-14472.5"/>
</g>
<!-- ring_attn_1_4_stage_4&#45;&gt;ring_attn_1_4_stage_5 -->
<g id="edge420" class="edge">
<title>ring_attn_1_4_stage_4&#45;&gt;ring_attn_1_4_stage_5</title>
<path fill="none" stroke="black" d="M4822,-14147.87C4822,-14147.87 4822,-14041.25 4822,-14041.25"/>
<polygon fill="black" stroke="black" points="4825.5,-14041.25 4822,-14031.25 4818.5,-14041.25 4825.5,-14041.25"/>
</g>
<!-- ring_attn_1_5_stage_4 -->
<g id="node522" class="node">
<title>ring_attn_1_5_stage_4</title>
<polygon fill="yellow" stroke="black" points="5409,-14284 5200,-14216 5409,-14148 5618,-14216 5409,-14284"/>
<text text-anchor="middle" x="5409" y="-14234.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-14219.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="5409" y="-14204.8" font-family="Times,serif" font-size="14.00">Q[5]×K[1]×V[1]</text>
<text text-anchor="middle" x="5409" y="-14189.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_4_stage_4&#45;&gt;ring_attn_1_5_stage_4 -->
<g id="edge2084" class="edge">
<title>ring_attn_1_4_stage_4&#45;&gt;ring_attn_1_5_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-14216C5031.02,-14216 5189.86,-14216 5189.86,-14216"/>
<polygon fill="red" stroke="red" points="5189.86,-14219.5 5199.86,-14216 5189.86,-14212.5 5189.86,-14219.5"/>
</g>
<!-- ring_attn_1_4_stage_5&#45;&gt;ring_attn_1_4_stage_6 -->
<g id="edge421" class="edge">
<title>ring_attn_1_4_stage_5&#45;&gt;ring_attn_1_4_stage_6</title>
<path fill="none" stroke="black" d="M4822,-13894.87C4822,-13894.87 4822,-13788.25 4822,-13788.25"/>
<polygon fill="black" stroke="black" points="4825.5,-13788.25 4822,-13778.25 4818.5,-13788.25 4825.5,-13788.25"/>
</g>
<!-- ring_attn_1_5_stage_5 -->
<g id="node523" class="node">
<title>ring_attn_1_5_stage_5</title>
<polygon fill="yellow" stroke="black" points="5409,-14031 5200,-13963 5409,-13895 5618,-13963 5409,-14031"/>
<text text-anchor="middle" x="5409" y="-13981.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-13966.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="5409" y="-13951.8" font-family="Times,serif" font-size="14.00">Q[5]×K[0]×V[0]</text>
<text text-anchor="middle" x="5409" y="-13936.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_4_stage_5&#45;&gt;ring_attn_1_5_stage_5 -->
<g id="edge2085" class="edge">
<title>ring_attn_1_4_stage_5&#45;&gt;ring_attn_1_5_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-13963C5031.02,-13963 5189.86,-13963 5189.86,-13963"/>
<polygon fill="red" stroke="red" points="5189.86,-13966.5 5199.86,-13963 5189.86,-13959.5 5189.86,-13966.5"/>
</g>
<!-- ring_attn_1_4_stage_6&#45;&gt;ring_attn_1_4_stage_7 -->
<g id="edge422" class="edge">
<title>ring_attn_1_4_stage_6&#45;&gt;ring_attn_1_4_stage_7</title>
<path fill="none" stroke="black" d="M4822,-13641.87C4822,-13641.87 4822,-13535.25 4822,-13535.25"/>
<polygon fill="black" stroke="black" points="4825.5,-13535.25 4822,-13525.25 4818.5,-13535.25 4825.5,-13535.25"/>
</g>
<!-- ring_attn_1_5_stage_6 -->
<g id="node524" class="node">
<title>ring_attn_1_5_stage_6</title>
<polygon fill="yellow" stroke="black" points="5409,-13778 5200,-13710 5409,-13642 5618,-13710 5409,-13778"/>
<text text-anchor="middle" x="5409" y="-13728.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-13713.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="5409" y="-13698.8" font-family="Times,serif" font-size="14.00">Q[5]×K[15]×V[15]</text>
<text text-anchor="middle" x="5409" y="-13683.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_4_stage_6&#45;&gt;ring_attn_1_5_stage_6 -->
<g id="edge2086" class="edge">
<title>ring_attn_1_4_stage_6&#45;&gt;ring_attn_1_5_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-13710C5031.02,-13710 5189.86,-13710 5189.86,-13710"/>
<polygon fill="red" stroke="red" points="5189.86,-13713.5 5199.86,-13710 5189.86,-13706.5 5189.86,-13713.5"/>
</g>
<!-- ring_attn_1_4_stage_7&#45;&gt;ring_attn_1_4_stage_8 -->
<g id="edge423" class="edge">
<title>ring_attn_1_4_stage_7&#45;&gt;ring_attn_1_4_stage_8</title>
<path fill="none" stroke="black" d="M4822,-13388.87C4822,-13388.87 4822,-13282.25 4822,-13282.25"/>
<polygon fill="black" stroke="black" points="4825.5,-13282.25 4822,-13272.25 4818.5,-13282.25 4825.5,-13282.25"/>
</g>
<!-- ring_attn_1_5_stage_7 -->
<g id="node525" class="node">
<title>ring_attn_1_5_stage_7</title>
<polygon fill="yellow" stroke="black" points="5409,-13525 5200,-13457 5409,-13389 5618,-13457 5409,-13525"/>
<text text-anchor="middle" x="5409" y="-13475.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-13460.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="5409" y="-13445.8" font-family="Times,serif" font-size="14.00">Q[5]×K[14]×V[14]</text>
<text text-anchor="middle" x="5409" y="-13430.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_4_stage_7&#45;&gt;ring_attn_1_5_stage_7 -->
<g id="edge2087" class="edge">
<title>ring_attn_1_4_stage_7&#45;&gt;ring_attn_1_5_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-13457C5031.02,-13457 5189.86,-13457 5189.86,-13457"/>
<polygon fill="red" stroke="red" points="5189.86,-13460.5 5199.86,-13457 5189.86,-13453.5 5189.86,-13460.5"/>
</g>
<!-- ring_attn_1_4_stage_8&#45;&gt;ring_attn_1_4_stage_9 -->
<g id="edge424" class="edge">
<title>ring_attn_1_4_stage_8&#45;&gt;ring_attn_1_4_stage_9</title>
<path fill="none" stroke="black" d="M4822,-13135.87C4822,-13135.87 4822,-13029.25 4822,-13029.25"/>
<polygon fill="black" stroke="black" points="4825.5,-13029.25 4822,-13019.25 4818.5,-13029.25 4825.5,-13029.25"/>
</g>
<!-- ring_attn_1_5_stage_8 -->
<g id="node526" class="node">
<title>ring_attn_1_5_stage_8</title>
<polygon fill="yellow" stroke="black" points="5409,-13272 5200,-13204 5409,-13136 5618,-13204 5409,-13272"/>
<text text-anchor="middle" x="5409" y="-13222.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-13207.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="5409" y="-13192.8" font-family="Times,serif" font-size="14.00">Q[5]×K[13]×V[13]</text>
<text text-anchor="middle" x="5409" y="-13177.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_4_stage_8&#45;&gt;ring_attn_1_5_stage_8 -->
<g id="edge2088" class="edge">
<title>ring_attn_1_4_stage_8&#45;&gt;ring_attn_1_5_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-13204C5031.02,-13204 5189.86,-13204 5189.86,-13204"/>
<polygon fill="red" stroke="red" points="5189.86,-13207.5 5199.86,-13204 5189.86,-13200.5 5189.86,-13207.5"/>
</g>
<!-- ring_attn_1_4_stage_9&#45;&gt;ring_attn_1_4_stage_10 -->
<g id="edge425" class="edge">
<title>ring_attn_1_4_stage_9&#45;&gt;ring_attn_1_4_stage_10</title>
<path fill="none" stroke="black" d="M4822,-12882.87C4822,-12882.87 4822,-12776.25 4822,-12776.25"/>
<polygon fill="black" stroke="black" points="4825.5,-12776.25 4822,-12766.25 4818.5,-12776.25 4825.5,-12776.25"/>
</g>
<!-- ring_attn_1_5_stage_9 -->
<g id="node527" class="node">
<title>ring_attn_1_5_stage_9</title>
<polygon fill="yellow" stroke="black" points="5409,-13019 5200,-12951 5409,-12883 5618,-12951 5409,-13019"/>
<text text-anchor="middle" x="5409" y="-12969.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-12954.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="5409" y="-12939.8" font-family="Times,serif" font-size="14.00">Q[5]×K[12]×V[12]</text>
<text text-anchor="middle" x="5409" y="-12924.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_4_stage_9&#45;&gt;ring_attn_1_5_stage_9 -->
<g id="edge2089" class="edge">
<title>ring_attn_1_4_stage_9&#45;&gt;ring_attn_1_5_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-12951C5031.02,-12951 5189.86,-12951 5189.86,-12951"/>
<polygon fill="red" stroke="red" points="5189.86,-12954.5 5199.86,-12951 5189.86,-12947.5 5189.86,-12954.5"/>
</g>
<!-- ring_attn_1_4_stage_10&#45;&gt;ring_attn_1_4_stage_11 -->
<g id="edge426" class="edge">
<title>ring_attn_1_4_stage_10&#45;&gt;ring_attn_1_4_stage_11</title>
<path fill="none" stroke="black" d="M4822,-12629.87C4822,-12629.87 4822,-12523.25 4822,-12523.25"/>
<polygon fill="black" stroke="black" points="4825.5,-12523.25 4822,-12513.25 4818.5,-12523.25 4825.5,-12523.25"/>
</g>
<!-- ring_attn_1_5_stage_10 -->
<g id="node528" class="node">
<title>ring_attn_1_5_stage_10</title>
<polygon fill="yellow" stroke="black" points="5409,-12766 5200,-12698 5409,-12630 5618,-12698 5409,-12766"/>
<text text-anchor="middle" x="5409" y="-12716.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-12701.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="5409" y="-12686.8" font-family="Times,serif" font-size="14.00">Q[5]×K[11]×V[11]</text>
<text text-anchor="middle" x="5409" y="-12671.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_4_stage_10&#45;&gt;ring_attn_1_5_stage_10 -->
<g id="edge2090" class="edge">
<title>ring_attn_1_4_stage_10&#45;&gt;ring_attn_1_5_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-12698C5031.02,-12698 5189.86,-12698 5189.86,-12698"/>
<polygon fill="red" stroke="red" points="5189.86,-12701.5 5199.86,-12698 5189.86,-12694.5 5189.86,-12701.5"/>
</g>
<!-- ring_attn_1_4_stage_11&#45;&gt;ring_attn_1_4_stage_12 -->
<g id="edge427" class="edge">
<title>ring_attn_1_4_stage_11&#45;&gt;ring_attn_1_4_stage_12</title>
<path fill="none" stroke="black" d="M4822,-12376.87C4822,-12376.87 4822,-12270.25 4822,-12270.25"/>
<polygon fill="black" stroke="black" points="4825.5,-12270.25 4822,-12260.25 4818.5,-12270.25 4825.5,-12270.25"/>
</g>
<!-- ring_attn_1_5_stage_11 -->
<g id="node529" class="node">
<title>ring_attn_1_5_stage_11</title>
<polygon fill="yellow" stroke="black" points="5409,-12513 5200,-12445 5409,-12377 5618,-12445 5409,-12513"/>
<text text-anchor="middle" x="5409" y="-12463.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-12448.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="5409" y="-12433.8" font-family="Times,serif" font-size="14.00">Q[5]×K[10]×V[10]</text>
<text text-anchor="middle" x="5409" y="-12418.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_4_stage_11&#45;&gt;ring_attn_1_5_stage_11 -->
<g id="edge2091" class="edge">
<title>ring_attn_1_4_stage_11&#45;&gt;ring_attn_1_5_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-12445C5031.02,-12445 5189.86,-12445 5189.86,-12445"/>
<polygon fill="red" stroke="red" points="5189.86,-12448.5 5199.86,-12445 5189.86,-12441.5 5189.86,-12448.5"/>
</g>
<!-- ring_attn_1_4_stage_12&#45;&gt;ring_attn_1_4_stage_13 -->
<g id="edge428" class="edge">
<title>ring_attn_1_4_stage_12&#45;&gt;ring_attn_1_4_stage_13</title>
<path fill="none" stroke="black" d="M4822,-12123.87C4822,-12123.87 4822,-12017.25 4822,-12017.25"/>
<polygon fill="black" stroke="black" points="4825.5,-12017.25 4822,-12007.25 4818.5,-12017.25 4825.5,-12017.25"/>
</g>
<!-- ring_attn_1_5_stage_12 -->
<g id="node530" class="node">
<title>ring_attn_1_5_stage_12</title>
<polygon fill="yellow" stroke="black" points="5409,-12260 5200,-12192 5409,-12124 5618,-12192 5409,-12260"/>
<text text-anchor="middle" x="5409" y="-12210.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-12195.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="5409" y="-12180.8" font-family="Times,serif" font-size="14.00">Q[5]×K[9]×V[9]</text>
<text text-anchor="middle" x="5409" y="-12165.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_4_stage_12&#45;&gt;ring_attn_1_5_stage_12 -->
<g id="edge2092" class="edge">
<title>ring_attn_1_4_stage_12&#45;&gt;ring_attn_1_5_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-12192C5031.02,-12192 5189.86,-12192 5189.86,-12192"/>
<polygon fill="red" stroke="red" points="5189.86,-12195.5 5199.86,-12192 5189.86,-12188.5 5189.86,-12195.5"/>
</g>
<!-- ring_attn_1_4_stage_13&#45;&gt;ring_attn_1_4_stage_14 -->
<g id="edge429" class="edge">
<title>ring_attn_1_4_stage_13&#45;&gt;ring_attn_1_4_stage_14</title>
<path fill="none" stroke="black" d="M4822,-11870.87C4822,-11870.87 4822,-11764.25 4822,-11764.25"/>
<polygon fill="black" stroke="black" points="4825.5,-11764.25 4822,-11754.25 4818.5,-11764.25 4825.5,-11764.25"/>
</g>
<!-- ring_attn_1_5_stage_13 -->
<g id="node531" class="node">
<title>ring_attn_1_5_stage_13</title>
<polygon fill="yellow" stroke="black" points="5409,-12007 5200,-11939 5409,-11871 5618,-11939 5409,-12007"/>
<text text-anchor="middle" x="5409" y="-11957.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-11942.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="5409" y="-11927.8" font-family="Times,serif" font-size="14.00">Q[5]×K[8]×V[8]</text>
<text text-anchor="middle" x="5409" y="-11912.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_4_stage_13&#45;&gt;ring_attn_1_5_stage_13 -->
<g id="edge2093" class="edge">
<title>ring_attn_1_4_stage_13&#45;&gt;ring_attn_1_5_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-11939C5031.02,-11939 5189.86,-11939 5189.86,-11939"/>
<polygon fill="red" stroke="red" points="5189.86,-11942.5 5199.86,-11939 5189.86,-11935.5 5189.86,-11942.5"/>
</g>
<!-- ring_attn_1_4_stage_14&#45;&gt;ring_attn_1_4_stage_15 -->
<g id="edge430" class="edge">
<title>ring_attn_1_4_stage_14&#45;&gt;ring_attn_1_4_stage_15</title>
<path fill="none" stroke="black" d="M4822,-11617.87C4822,-11617.87 4822,-11511.25 4822,-11511.25"/>
<polygon fill="black" stroke="black" points="4825.5,-11511.25 4822,-11501.25 4818.5,-11511.25 4825.5,-11511.25"/>
</g>
<!-- ring_attn_1_5_stage_14 -->
<g id="node532" class="node">
<title>ring_attn_1_5_stage_14</title>
<polygon fill="yellow" stroke="black" points="5409,-11754 5200,-11686 5409,-11618 5618,-11686 5409,-11754"/>
<text text-anchor="middle" x="5409" y="-11704.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-11689.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="5409" y="-11674.8" font-family="Times,serif" font-size="14.00">Q[5]×K[7]×V[7]</text>
<text text-anchor="middle" x="5409" y="-11659.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_4_stage_14&#45;&gt;ring_attn_1_5_stage_14 -->
<g id="edge2094" class="edge">
<title>ring_attn_1_4_stage_14&#45;&gt;ring_attn_1_5_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-11686C5031.02,-11686 5189.86,-11686 5189.86,-11686"/>
<polygon fill="red" stroke="red" points="5189.86,-11689.5 5199.86,-11686 5189.86,-11682.5 5189.86,-11689.5"/>
</g>
<!-- attn_out_1_4 -->
<g id="node436" class="node">
<title>attn_out_1_4</title>
<polygon fill="none" stroke="black" points="4891.5,-11292 4752.5,-11292 4752.5,-11239 4891.5,-11239 4891.5,-11292"/>
<text text-anchor="middle" x="4822" y="-11276.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="4822" y="-11261.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="4822" y="-11246.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_1_4_stage_15&#45;&gt;attn_out_1_4 -->
<g id="edge431" class="edge">
<title>ring_attn_1_4_stage_15&#45;&gt;attn_out_1_4</title>
<path fill="none" stroke="black" d="M4822,-11364.87C4822,-11364.87 4822,-11302.18 4822,-11302.18"/>
<polygon fill="black" stroke="black" points="4825.5,-11302.18 4822,-11292.18 4818.5,-11302.18 4825.5,-11302.18"/>
</g>
<!-- ring_attn_1_5_stage_15 -->
<g id="node533" class="node">
<title>ring_attn_1_5_stage_15</title>
<polygon fill="yellow" stroke="black" points="5409,-11501 5200,-11433 5409,-11365 5618,-11433 5409,-11501"/>
<text text-anchor="middle" x="5409" y="-11451.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-11436.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="5409" y="-11421.8" font-family="Times,serif" font-size="14.00">Q[5]×K[6]×V[6]</text>
<text text-anchor="middle" x="5409" y="-11406.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_4_stage_15&#45;&gt;ring_attn_1_5_stage_15 -->
<g id="edge2095" class="edge">
<title>ring_attn_1_4_stage_15&#45;&gt;ring_attn_1_5_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-11433C5031.02,-11433 5189.86,-11433 5189.86,-11433"/>
<polygon fill="red" stroke="red" points="5189.86,-11436.5 5199.86,-11433 5189.86,-11429.5 5189.86,-11436.5"/>
</g>
<!-- attn_residual_1_4 -->
<g id="node437" class="node">
<title>attn_residual_1_4</title>
<ellipse fill="none" stroke="black" cx="4822" cy="-11139" rx="105.5" ry="27"/>
<text text-anchor="middle" x="4822" y="-11142.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="4822" y="-11127.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_1_4&#45;&gt;attn_residual_1_4 -->
<g id="edge432" class="edge">
<title>attn_out_1_4&#45;&gt;attn_residual_1_4</title>
<path fill="none" stroke="black" d="M4822,-11238.98C4822,-11238.98 4822,-11176.36 4822,-11176.36"/>
<polygon fill="black" stroke="black" points="4825.5,-11176.36 4822,-11166.36 4818.5,-11176.36 4825.5,-11176.36"/>
</g>
<!-- gate_1_4 -->
<g id="node438" class="node">
<title>gate_1_4</title>
<ellipse fill="orange" stroke="black" cx="4822" cy="-11001.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="4822" y="-11012.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="4822" y="-10997.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="4822" y="-10982.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_1_4&#45;&gt;gate_1_4 -->
<g id="edge433" class="edge">
<title>attn_residual_1_4&#45;&gt;gate_1_4</title>
<path fill="none" stroke="black" d="M4769.25,-11115.36C4769.25,-11115.36 4769.25,-11044.08 4769.25,-11044.08"/>
<polygon fill="black" stroke="black" points="4772.75,-11044.08 4769.25,-11034.08 4765.75,-11044.08 4772.75,-11044.08"/>
</g>
<!-- gate_1_4&#45;&gt;expert_1_0_0 -->
<g id="edge2096" class="edge">
<title>gate_1_4&#45;&gt;expert_1_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4726.55,-10985.4C4726.55,-10974.85 4726.55,-10963 4726.55,-10963 4726.55,-10963 147.63,-10963 147.63,-10963 147.63,-10963 147.63,-10842.22 147.63,-10842.22"/>
<polygon fill="blue" stroke="blue" points="151.13,-10842.22 147.63,-10832.22 144.13,-10842.22 151.13,-10842.22"/>
<text text-anchor="middle" x="19436.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19436.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU4→GPU0</text>
<text text-anchor="middle" x="19436.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19436.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_4&#45;&gt;expert_1_1_0 -->
<g id="edge2097" class="edge">
<title>gate_1_4&#45;&gt;expert_1_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4746.64,-10974.99C4746.64,-10957.96 4746.64,-10939 4746.64,-10939 4746.64,-10939 3178.07,-10939 3178.07,-10939 3178.07,-10939 3178.07,-10842.19 3178.07,-10842.19"/>
<polygon fill="blue" stroke="blue" points="3181.57,-10842.19 3178.07,-10832.19 3174.57,-10842.19 3181.57,-10842.19"/>
<text text-anchor="middle" x="19610.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19610.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU4→GPU1</text>
<text text-anchor="middle" x="19610.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19610.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_4&#45;&gt;expert_1_2_0 -->
<g id="edge2098" class="edge">
<title>gate_1_4&#45;&gt;expert_1_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4756.69,-10971.76C4756.69,-10964.12 4756.69,-10958 4756.69,-10958 4756.69,-10958 3762.5,-10958 3762.5,-10958 3762.5,-10958 3762.5,-10842.06 3762.5,-10842.06"/>
<polygon fill="blue" stroke="blue" points="3766,-10842.06 3762.5,-10832.06 3759,-10842.06 3766,-10842.06"/>
<text text-anchor="middle" x="19784.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19784.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU4→GPU2</text>
<text text-anchor="middle" x="19784.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19784.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_4&#45;&gt;expert_1_3_0 -->
<g id="edge2099" class="edge">
<title>gate_1_4&#45;&gt;expert_1_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4722.3,-11014C4582.46,-11014 4345,-11014 4345,-11014 4345,-11014 4345,-10842.33 4345,-10842.33"/>
<polygon fill="blue" stroke="blue" points="4348.5,-10842.33 4345,-10832.33 4341.5,-10842.33 4348.5,-10842.33"/>
<text text-anchor="middle" x="19958.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19958.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU4→GPU3</text>
<text text-anchor="middle" x="19958.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19958.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_4&#45;&gt;expert_1_4_0 -->
<g id="edge434" class="edge">
<title>gate_1_4&#45;&gt;expert_1_4_0</title>
<path fill="none" stroke="black" d="M4766.74,-10969.13C4766.74,-10969.13 4766.74,-10842.24 4766.74,-10842.24"/>
<polygon fill="black" stroke="black" points="4770.24,-10842.24 4766.74,-10832.24 4763.24,-10842.24 4770.24,-10842.24"/>
</g>
<!-- gate_1_4&#45;&gt;expert_1_5_0 -->
<g id="edge2100" class="edge">
<title>gate_1_4&#45;&gt;expert_1_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4921.65,-10989C5061.77,-10989 5300.12,-10989 5300.12,-10989 5300.12,-10989 5300.12,-10842.18 5300.12,-10842.18"/>
<polygon fill="blue" stroke="blue" points="5303.63,-10842.18 5300.12,-10832.18 5296.63,-10842.18 5303.63,-10842.18"/>
<text text-anchor="middle" x="20132.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="20132.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU4→GPU5</text>
<text text-anchor="middle" x="20132.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="20132.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_4&#45;&gt;expert_1_6_0 -->
<g id="edge2101" class="edge">
<title>gate_1_4&#45;&gt;expert_1_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4847.12,-10964.76C4847.12,-10953.49 4847.12,-10944 4847.12,-10944 4847.12,-10944 5882.4,-10944 5882.4,-10944 5882.4,-10944 5882.4,-10842.2 5882.4,-10842.2"/>
<polygon fill="blue" stroke="blue" points="5885.9,-10842.2 5882.4,-10832.2 5878.9,-10842.2 5885.9,-10842.2"/>
<text text-anchor="middle" x="20306.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="20306.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU4→GPU6</text>
<text text-anchor="middle" x="20306.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="20306.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_4&#45;&gt;expert_1_7_0 -->
<g id="edge2102" class="edge">
<title>gate_1_4&#45;&gt;expert_1_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4857.17,-10966.05C4857.17,-10949.33 4857.17,-10933 4857.17,-10933 4857.17,-10933 6467.38,-10933 6467.38,-10933 6467.38,-10933 6467.38,-10842.23 6467.38,-10842.23"/>
<polygon fill="blue" stroke="blue" points="6470.88,-10842.23 6467.38,-10832.23 6463.88,-10842.23 6470.88,-10842.23"/>
<text text-anchor="middle" x="20480.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="20480.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU4→GPU7</text>
<text text-anchor="middle" x="20480.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="20480.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_4&#45;&gt;expert_1_8_0 -->
<g id="edge2103" class="edge">
<title>gate_1_4&#45;&gt;expert_1_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4867.21,-10967.3C4867.21,-10946.14 4867.21,-10923 4867.21,-10923 4867.21,-10923 7137.89,-10923 7137.89,-10923 7137.89,-10923 7137.89,-10842.16 7137.89,-10842.16"/>
<polygon fill="blue" stroke="blue" points="7141.39,-10842.16 7137.89,-10832.16 7134.39,-10842.16 7141.39,-10842.16"/>
<text text-anchor="middle" x="20654.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="20654.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU4→GPU8</text>
<text text-anchor="middle" x="20654.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="20654.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_4&#45;&gt;expert_1_9_0 -->
<g id="edge2104" class="edge">
<title>gate_1_4&#45;&gt;expert_1_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4877.26,-10969.37C4877.26,-10946.2 4877.26,-10919 4877.26,-10919 4877.26,-10919 7718.64,-10919 7718.64,-10919 7718.64,-10919 7718.64,-10842.11 7718.64,-10842.11"/>
<polygon fill="blue" stroke="blue" points="7722.14,-10842.11 7718.64,-10832.11 7715.14,-10842.11 7722.14,-10842.11"/>
<text text-anchor="middle" x="20828.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="20828.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU4→GPU9</text>
<text text-anchor="middle" x="20828.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="20828.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_4&#45;&gt;expert_1_10_0 -->
<g id="edge2105" class="edge">
<title>gate_1_4&#45;&gt;expert_1_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4887.31,-10971.85C4887.31,-10939.73 4887.31,-10893 4887.31,-10893 4887.31,-10893 8298.79,-10893 8298.79,-10893 8298.79,-10893 8298.79,-10842.23 8298.79,-10842.23"/>
<polygon fill="blue" stroke="blue" points="8302.29,-10842.23 8298.79,-10832.23 8295.29,-10842.23 8302.29,-10842.23"/>
<text text-anchor="middle" x="21002.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21002.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU4→GPU10</text>
<text text-anchor="middle" x="21002.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21002.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_4&#45;&gt;expert_1_11_0 -->
<g id="edge2106" class="edge">
<title>gate_1_4&#45;&gt;expert_1_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4897.36,-10975.08C4897.36,-10937.74 4897.36,-10874 4897.36,-10874 4897.36,-10874 8885.79,-10874 8885.79,-10874 8885.79,-10874 8885.79,-10842.18 8885.79,-10842.18"/>
<polygon fill="blue" stroke="blue" points="8889.29,-10842.18 8885.79,-10832.18 8882.29,-10842.18 8889.29,-10842.18"/>
<text text-anchor="middle" x="21176.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21176.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU4→GPU11</text>
<text text-anchor="middle" x="21176.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21176.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_4&#45;&gt;expert_1_12_0 -->
<g id="edge2107" class="edge">
<title>gate_1_4&#45;&gt;expert_1_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4907.4,-10979.46C4907.4,-10941.54 4907.4,-10868 4907.4,-10868 4907.4,-10868 9485.89,-10868 9485.89,-10868 9485.89,-10868 9485.89,-10842.01 9485.89,-10842.01"/>
<polygon fill="blue" stroke="blue" points="9489.39,-10842.01 9485.89,-10832.01 9482.39,-10842.01 9489.39,-10842.01"/>
<text text-anchor="middle" x="21350.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21350.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU4→GPU12</text>
<text text-anchor="middle" x="21350.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21350.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_4&#45;&gt;expert_1_13_0 -->
<g id="edge2108" class="edge">
<title>gate_1_4&#45;&gt;expert_1_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4917.45,-10985.38C4917.45,-10948.48 4917.45,-10861 4917.45,-10861 4917.45,-10861 10083.9,-10861 10083.9,-10861 10083.9,-10861 10083.9,-10842.27 10083.9,-10842.27"/>
<polygon fill="blue" stroke="blue" points="10087.4,-10842.27 10083.9,-10832.27 10080.4,-10842.27 10087.4,-10842.27"/>
<text text-anchor="middle" x="21524.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21524.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU4→GPU13</text>
<text text-anchor="middle" x="21524.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21524.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_4&#45;&gt;expert_1_14_0 -->
<g id="edge2109" class="edge">
<title>gate_1_4&#45;&gt;expert_1_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4874.75,-11034.25C4874.75,-11050.62 4874.75,-11067 4874.75,-11067 4874.75,-11067 10802,-11067 10802,-11067 10802,-11067 10802,-10842.01 10802,-10842.01"/>
<polygon fill="blue" stroke="blue" points="10805.5,-10842.01 10802,-10832.01 10798.5,-10842.01 10805.5,-10842.01"/>
<text text-anchor="middle" x="21698.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21698.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU4→GPU14</text>
<text text-anchor="middle" x="21698.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21698.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_4&#45;&gt;expert_1_15_0 -->
<g id="edge2110" class="edge">
<title>gate_1_4&#45;&gt;expert_1_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4822,-11039.3C4822,-11061.8 4822,-11086 4822,-11086 4822,-11086 11391.25,-11086 11391.25,-11086 11391.25,-11086 11391.25,-10842.14 11391.25,-10842.14"/>
<polygon fill="blue" stroke="blue" points="11394.75,-10842.14 11391.25,-10832.14 11387.75,-10842.14 11394.75,-10842.14"/>
<text text-anchor="middle" x="21872.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21872.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU4→GPU15</text>
<text text-anchor="middle" x="21872.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21872.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_4 -->
<g id="node440" class="node">
<title>expert_reduce_1_4</title>
<ellipse fill="none" stroke="black" cx="4822" cy="-10668.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="4822" y="-10679.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="4822" y="-10664.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="4822" y="-10649.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_4_0&#45;&gt;expert_reduce_1_4 -->
<g id="edge435" class="edge">
<title>expert_1_4_0&#45;&gt;expert_reduce_1_4</title>
<path fill="none" stroke="black" d="M4822,-10778.76C4822,-10778.76 4822,-10716.06 4822,-10716.06"/>
<polygon fill="black" stroke="black" points="4825.5,-10716.06 4822,-10706.06 4818.5,-10716.06 4825.5,-10716.06"/>
</g>
<!-- moe_residual_1_4 -->
<g id="node441" class="node">
<title>moe_residual_1_4</title>
<ellipse fill="none" stroke="black" cx="4822" cy="-10531" rx="105.5" ry="27"/>
<text text-anchor="middle" x="4822" y="-10534.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="4822" y="-10519.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_4&#45;&gt;moe_residual_1_4 -->
<g id="edge436" class="edge">
<title>expert_reduce_1_4&#45;&gt;moe_residual_1_4</title>
<path fill="none" stroke="black" d="M4822,-10630.93C4822,-10630.93 4822,-10568.06 4822,-10568.06"/>
<polygon fill="black" stroke="black" points="4825.5,-10568.06 4822,-10558.06 4818.5,-10568.06 4825.5,-10568.06"/>
</g>
<!-- qkv_proj_2_4 -->
<g id="node442" class="node">
<title>qkv_proj_2_4</title>
<polygon fill="none" stroke="black" points="4904.5,-10431 4739.5,-10431 4739.5,-10378 4904.5,-10378 4904.5,-10431"/>
<text text-anchor="middle" x="4822" y="-10415.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="4822" y="-10400.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="4822" y="-10385.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_1_4&#45;&gt;qkv_proj_2_4 -->
<g id="edge437" class="edge">
<title>moe_residual_1_4&#45;&gt;qkv_proj_2_4</title>
<path fill="none" stroke="black" d="M4822,-10503.86C4822,-10503.86 4822,-10441.16 4822,-10441.16"/>
<polygon fill="black" stroke="black" points="4825.5,-10441.16 4822,-10431.16 4818.5,-10441.16 4825.5,-10441.16"/>
</g>
<!-- qkv_reshape_2_4 -->
<g id="node443" class="node">
<title>qkv_reshape_2_4</title>
<ellipse fill="none" stroke="black" cx="4822" cy="-10278" rx="148" ry="27"/>
<text text-anchor="middle" x="4822" y="-10281.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="4822" y="-10266.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_2_4&#45;&gt;qkv_reshape_2_4 -->
<g id="edge438" class="edge">
<title>qkv_proj_2_4&#45;&gt;qkv_reshape_2_4</title>
<path fill="none" stroke="black" d="M4822,-10377.98C4822,-10377.98 4822,-10315.36 4822,-10315.36"/>
<polygon fill="black" stroke="black" points="4825.5,-10315.36 4822,-10305.36 4818.5,-10315.36 4825.5,-10315.36"/>
</g>
<!-- qkv_reshape_2_4&#45;&gt;ring_attn_2_4_stage_0 -->
<g id="edge439" class="edge">
<title>qkv_reshape_2_4&#45;&gt;ring_attn_2_4_stage_0</title>
<path fill="none" stroke="black" d="M4822,-10250.72C4822,-10250.72 4822,-10144.16 4822,-10144.16"/>
<polygon fill="black" stroke="black" points="4825.5,-10144.16 4822,-10134.16 4818.5,-10144.16 4825.5,-10144.16"/>
</g>
<!-- ring_attn_2_4_stage_0&#45;&gt;ring_attn_2_4_stage_1 -->
<g id="edge440" class="edge">
<title>ring_attn_2_4_stage_0&#45;&gt;ring_attn_2_4_stage_1</title>
<path fill="none" stroke="black" d="M4822,-9997.87C4822,-9997.87 4822,-9891.25 4822,-9891.25"/>
<polygon fill="black" stroke="black" points="4825.5,-9891.25 4822,-9881.25 4818.5,-9891.25 4825.5,-9891.25"/>
</g>
<!-- ring_attn_2_5_stage_0 -->
<g id="node542" class="node">
<title>ring_attn_2_5_stage_0</title>
<polygon fill="yellow" stroke="black" points="5409,-10134 5200,-10066 5409,-9998 5618,-10066 5409,-10134"/>
<text text-anchor="middle" x="5409" y="-10084.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-10069.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="5409" y="-10054.8" font-family="Times,serif" font-size="14.00">Q[5]×K[5]×V[5]</text>
<text text-anchor="middle" x="5409" y="-10039.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_4_stage_0&#45;&gt;ring_attn_2_5_stage_0 -->
<g id="edge2111" class="edge">
<title>ring_attn_2_4_stage_0&#45;&gt;ring_attn_2_5_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-10066C5031.02,-10066 5189.86,-10066 5189.86,-10066"/>
<polygon fill="red" stroke="red" points="5189.86,-10069.5 5199.86,-10066 5189.86,-10062.5 5189.86,-10069.5"/>
</g>
<!-- ring_attn_2_4_stage_1&#45;&gt;ring_attn_2_4_stage_2 -->
<g id="edge441" class="edge">
<title>ring_attn_2_4_stage_1&#45;&gt;ring_attn_2_4_stage_2</title>
<path fill="none" stroke="black" d="M4822,-9744.87C4822,-9744.87 4822,-9638.25 4822,-9638.25"/>
<polygon fill="black" stroke="black" points="4825.5,-9638.25 4822,-9628.25 4818.5,-9638.25 4825.5,-9638.25"/>
</g>
<!-- ring_attn_2_5_stage_1 -->
<g id="node543" class="node">
<title>ring_attn_2_5_stage_1</title>
<polygon fill="yellow" stroke="black" points="5409,-9881 5200,-9813 5409,-9745 5618,-9813 5409,-9881"/>
<text text-anchor="middle" x="5409" y="-9831.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-9816.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="5409" y="-9801.8" font-family="Times,serif" font-size="14.00">Q[5]×K[4]×V[4]</text>
<text text-anchor="middle" x="5409" y="-9786.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_4_stage_1&#45;&gt;ring_attn_2_5_stage_1 -->
<g id="edge2112" class="edge">
<title>ring_attn_2_4_stage_1&#45;&gt;ring_attn_2_5_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-9813C5031.02,-9813 5189.86,-9813 5189.86,-9813"/>
<polygon fill="red" stroke="red" points="5189.86,-9816.5 5199.86,-9813 5189.86,-9809.5 5189.86,-9816.5"/>
</g>
<!-- ring_attn_2_4_stage_2&#45;&gt;ring_attn_2_4_stage_3 -->
<g id="edge442" class="edge">
<title>ring_attn_2_4_stage_2&#45;&gt;ring_attn_2_4_stage_3</title>
<path fill="none" stroke="black" d="M4822,-9491.87C4822,-9491.87 4822,-9385.25 4822,-9385.25"/>
<polygon fill="black" stroke="black" points="4825.5,-9385.25 4822,-9375.25 4818.5,-9385.25 4825.5,-9385.25"/>
</g>
<!-- ring_attn_2_5_stage_2 -->
<g id="node544" class="node">
<title>ring_attn_2_5_stage_2</title>
<polygon fill="yellow" stroke="black" points="5409,-9628 5200,-9560 5409,-9492 5618,-9560 5409,-9628"/>
<text text-anchor="middle" x="5409" y="-9578.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-9563.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="5409" y="-9548.8" font-family="Times,serif" font-size="14.00">Q[5]×K[3]×V[3]</text>
<text text-anchor="middle" x="5409" y="-9533.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_4_stage_2&#45;&gt;ring_attn_2_5_stage_2 -->
<g id="edge2113" class="edge">
<title>ring_attn_2_4_stage_2&#45;&gt;ring_attn_2_5_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-9560C5031.02,-9560 5189.86,-9560 5189.86,-9560"/>
<polygon fill="red" stroke="red" points="5189.86,-9563.5 5199.86,-9560 5189.86,-9556.5 5189.86,-9563.5"/>
</g>
<!-- ring_attn_2_4_stage_3&#45;&gt;ring_attn_2_4_stage_4 -->
<g id="edge443" class="edge">
<title>ring_attn_2_4_stage_3&#45;&gt;ring_attn_2_4_stage_4</title>
<path fill="none" stroke="black" d="M4822,-9238.87C4822,-9238.87 4822,-9132.25 4822,-9132.25"/>
<polygon fill="black" stroke="black" points="4825.5,-9132.25 4822,-9122.25 4818.5,-9132.25 4825.5,-9132.25"/>
</g>
<!-- ring_attn_2_5_stage_3 -->
<g id="node545" class="node">
<title>ring_attn_2_5_stage_3</title>
<polygon fill="yellow" stroke="black" points="5409,-9375 5200,-9307 5409,-9239 5618,-9307 5409,-9375"/>
<text text-anchor="middle" x="5409" y="-9325.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-9310.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="5409" y="-9295.8" font-family="Times,serif" font-size="14.00">Q[5]×K[2]×V[2]</text>
<text text-anchor="middle" x="5409" y="-9280.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_4_stage_3&#45;&gt;ring_attn_2_5_stage_3 -->
<g id="edge2114" class="edge">
<title>ring_attn_2_4_stage_3&#45;&gt;ring_attn_2_5_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-9307C5031.02,-9307 5189.86,-9307 5189.86,-9307"/>
<polygon fill="red" stroke="red" points="5189.86,-9310.5 5199.86,-9307 5189.86,-9303.5 5189.86,-9310.5"/>
</g>
<!-- ring_attn_2_4_stage_4&#45;&gt;ring_attn_2_4_stage_5 -->
<g id="edge444" class="edge">
<title>ring_attn_2_4_stage_4&#45;&gt;ring_attn_2_4_stage_5</title>
<path fill="none" stroke="black" d="M4822,-8985.87C4822,-8985.87 4822,-8879.25 4822,-8879.25"/>
<polygon fill="black" stroke="black" points="4825.5,-8879.25 4822,-8869.25 4818.5,-8879.25 4825.5,-8879.25"/>
</g>
<!-- ring_attn_2_5_stage_4 -->
<g id="node546" class="node">
<title>ring_attn_2_5_stage_4</title>
<polygon fill="yellow" stroke="black" points="5409,-9122 5200,-9054 5409,-8986 5618,-9054 5409,-9122"/>
<text text-anchor="middle" x="5409" y="-9072.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-9057.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="5409" y="-9042.8" font-family="Times,serif" font-size="14.00">Q[5]×K[1]×V[1]</text>
<text text-anchor="middle" x="5409" y="-9027.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_4_stage_4&#45;&gt;ring_attn_2_5_stage_4 -->
<g id="edge2115" class="edge">
<title>ring_attn_2_4_stage_4&#45;&gt;ring_attn_2_5_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-9054C5031.02,-9054 5189.86,-9054 5189.86,-9054"/>
<polygon fill="red" stroke="red" points="5189.86,-9057.5 5199.86,-9054 5189.86,-9050.5 5189.86,-9057.5"/>
</g>
<!-- ring_attn_2_4_stage_5&#45;&gt;ring_attn_2_4_stage_6 -->
<g id="edge445" class="edge">
<title>ring_attn_2_4_stage_5&#45;&gt;ring_attn_2_4_stage_6</title>
<path fill="none" stroke="black" d="M4822,-8732.87C4822,-8732.87 4822,-8626.25 4822,-8626.25"/>
<polygon fill="black" stroke="black" points="4825.5,-8626.25 4822,-8616.25 4818.5,-8626.25 4825.5,-8626.25"/>
</g>
<!-- ring_attn_2_5_stage_5 -->
<g id="node547" class="node">
<title>ring_attn_2_5_stage_5</title>
<polygon fill="yellow" stroke="black" points="5409,-8869 5200,-8801 5409,-8733 5618,-8801 5409,-8869"/>
<text text-anchor="middle" x="5409" y="-8819.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-8804.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="5409" y="-8789.8" font-family="Times,serif" font-size="14.00">Q[5]×K[0]×V[0]</text>
<text text-anchor="middle" x="5409" y="-8774.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_4_stage_5&#45;&gt;ring_attn_2_5_stage_5 -->
<g id="edge2116" class="edge">
<title>ring_attn_2_4_stage_5&#45;&gt;ring_attn_2_5_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-8801C5031.02,-8801 5189.86,-8801 5189.86,-8801"/>
<polygon fill="red" stroke="red" points="5189.86,-8804.5 5199.86,-8801 5189.86,-8797.5 5189.86,-8804.5"/>
</g>
<!-- ring_attn_2_4_stage_6&#45;&gt;ring_attn_2_4_stage_7 -->
<g id="edge446" class="edge">
<title>ring_attn_2_4_stage_6&#45;&gt;ring_attn_2_4_stage_7</title>
<path fill="none" stroke="black" d="M4822,-8479.87C4822,-8479.87 4822,-8373.25 4822,-8373.25"/>
<polygon fill="black" stroke="black" points="4825.5,-8373.25 4822,-8363.25 4818.5,-8373.25 4825.5,-8373.25"/>
</g>
<!-- ring_attn_2_5_stage_6 -->
<g id="node548" class="node">
<title>ring_attn_2_5_stage_6</title>
<polygon fill="yellow" stroke="black" points="5409,-8616 5200,-8548 5409,-8480 5618,-8548 5409,-8616"/>
<text text-anchor="middle" x="5409" y="-8566.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-8551.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="5409" y="-8536.8" font-family="Times,serif" font-size="14.00">Q[5]×K[15]×V[15]</text>
<text text-anchor="middle" x="5409" y="-8521.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_4_stage_6&#45;&gt;ring_attn_2_5_stage_6 -->
<g id="edge2117" class="edge">
<title>ring_attn_2_4_stage_6&#45;&gt;ring_attn_2_5_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-8548C5031.02,-8548 5189.86,-8548 5189.86,-8548"/>
<polygon fill="red" stroke="red" points="5189.86,-8551.5 5199.86,-8548 5189.86,-8544.5 5189.86,-8551.5"/>
</g>
<!-- ring_attn_2_4_stage_7&#45;&gt;ring_attn_2_4_stage_8 -->
<g id="edge447" class="edge">
<title>ring_attn_2_4_stage_7&#45;&gt;ring_attn_2_4_stage_8</title>
<path fill="none" stroke="black" d="M4822,-8226.87C4822,-8226.87 4822,-8120.25 4822,-8120.25"/>
<polygon fill="black" stroke="black" points="4825.5,-8120.25 4822,-8110.25 4818.5,-8120.25 4825.5,-8120.25"/>
</g>
<!-- ring_attn_2_5_stage_7 -->
<g id="node549" class="node">
<title>ring_attn_2_5_stage_7</title>
<polygon fill="yellow" stroke="black" points="5409,-8363 5200,-8295 5409,-8227 5618,-8295 5409,-8363"/>
<text text-anchor="middle" x="5409" y="-8313.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-8298.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="5409" y="-8283.8" font-family="Times,serif" font-size="14.00">Q[5]×K[14]×V[14]</text>
<text text-anchor="middle" x="5409" y="-8268.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_4_stage_7&#45;&gt;ring_attn_2_5_stage_7 -->
<g id="edge2118" class="edge">
<title>ring_attn_2_4_stage_7&#45;&gt;ring_attn_2_5_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-8295C5031.02,-8295 5189.86,-8295 5189.86,-8295"/>
<polygon fill="red" stroke="red" points="5189.86,-8298.5 5199.86,-8295 5189.86,-8291.5 5189.86,-8298.5"/>
</g>
<!-- ring_attn_2_4_stage_8&#45;&gt;ring_attn_2_4_stage_9 -->
<g id="edge448" class="edge">
<title>ring_attn_2_4_stage_8&#45;&gt;ring_attn_2_4_stage_9</title>
<path fill="none" stroke="black" d="M4822,-7973.87C4822,-7973.87 4822,-7867.25 4822,-7867.25"/>
<polygon fill="black" stroke="black" points="4825.5,-7867.25 4822,-7857.25 4818.5,-7867.25 4825.5,-7867.25"/>
</g>
<!-- ring_attn_2_5_stage_8 -->
<g id="node550" class="node">
<title>ring_attn_2_5_stage_8</title>
<polygon fill="yellow" stroke="black" points="5409,-8110 5200,-8042 5409,-7974 5618,-8042 5409,-8110"/>
<text text-anchor="middle" x="5409" y="-8060.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-8045.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="5409" y="-8030.8" font-family="Times,serif" font-size="14.00">Q[5]×K[13]×V[13]</text>
<text text-anchor="middle" x="5409" y="-8015.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_4_stage_8&#45;&gt;ring_attn_2_5_stage_8 -->
<g id="edge2119" class="edge">
<title>ring_attn_2_4_stage_8&#45;&gt;ring_attn_2_5_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-8042C5031.02,-8042 5189.86,-8042 5189.86,-8042"/>
<polygon fill="red" stroke="red" points="5189.86,-8045.5 5199.86,-8042 5189.86,-8038.5 5189.86,-8045.5"/>
</g>
<!-- ring_attn_2_4_stage_9&#45;&gt;ring_attn_2_4_stage_10 -->
<g id="edge449" class="edge">
<title>ring_attn_2_4_stage_9&#45;&gt;ring_attn_2_4_stage_10</title>
<path fill="none" stroke="black" d="M4822,-7720.87C4822,-7720.87 4822,-7614.25 4822,-7614.25"/>
<polygon fill="black" stroke="black" points="4825.5,-7614.25 4822,-7604.25 4818.5,-7614.25 4825.5,-7614.25"/>
</g>
<!-- ring_attn_2_5_stage_9 -->
<g id="node551" class="node">
<title>ring_attn_2_5_stage_9</title>
<polygon fill="yellow" stroke="black" points="5409,-7857 5200,-7789 5409,-7721 5618,-7789 5409,-7857"/>
<text text-anchor="middle" x="5409" y="-7807.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-7792.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="5409" y="-7777.8" font-family="Times,serif" font-size="14.00">Q[5]×K[12]×V[12]</text>
<text text-anchor="middle" x="5409" y="-7762.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_4_stage_9&#45;&gt;ring_attn_2_5_stage_9 -->
<g id="edge2120" class="edge">
<title>ring_attn_2_4_stage_9&#45;&gt;ring_attn_2_5_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-7789C5031.02,-7789 5189.86,-7789 5189.86,-7789"/>
<polygon fill="red" stroke="red" points="5189.86,-7792.5 5199.86,-7789 5189.86,-7785.5 5189.86,-7792.5"/>
</g>
<!-- ring_attn_2_4_stage_10&#45;&gt;ring_attn_2_4_stage_11 -->
<g id="edge450" class="edge">
<title>ring_attn_2_4_stage_10&#45;&gt;ring_attn_2_4_stage_11</title>
<path fill="none" stroke="black" d="M4822,-7467.87C4822,-7467.87 4822,-7361.25 4822,-7361.25"/>
<polygon fill="black" stroke="black" points="4825.5,-7361.25 4822,-7351.25 4818.5,-7361.25 4825.5,-7361.25"/>
</g>
<!-- ring_attn_2_5_stage_10 -->
<g id="node552" class="node">
<title>ring_attn_2_5_stage_10</title>
<polygon fill="yellow" stroke="black" points="5409,-7604 5200,-7536 5409,-7468 5618,-7536 5409,-7604"/>
<text text-anchor="middle" x="5409" y="-7554.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-7539.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="5409" y="-7524.8" font-family="Times,serif" font-size="14.00">Q[5]×K[11]×V[11]</text>
<text text-anchor="middle" x="5409" y="-7509.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_4_stage_10&#45;&gt;ring_attn_2_5_stage_10 -->
<g id="edge2121" class="edge">
<title>ring_attn_2_4_stage_10&#45;&gt;ring_attn_2_5_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-7536C5031.02,-7536 5189.86,-7536 5189.86,-7536"/>
<polygon fill="red" stroke="red" points="5189.86,-7539.5 5199.86,-7536 5189.86,-7532.5 5189.86,-7539.5"/>
</g>
<!-- ring_attn_2_4_stage_11&#45;&gt;ring_attn_2_4_stage_12 -->
<g id="edge451" class="edge">
<title>ring_attn_2_4_stage_11&#45;&gt;ring_attn_2_4_stage_12</title>
<path fill="none" stroke="black" d="M4822,-7214.87C4822,-7214.87 4822,-7108.25 4822,-7108.25"/>
<polygon fill="black" stroke="black" points="4825.5,-7108.25 4822,-7098.25 4818.5,-7108.25 4825.5,-7108.25"/>
</g>
<!-- ring_attn_2_5_stage_11 -->
<g id="node553" class="node">
<title>ring_attn_2_5_stage_11</title>
<polygon fill="yellow" stroke="black" points="5409,-7351 5200,-7283 5409,-7215 5618,-7283 5409,-7351"/>
<text text-anchor="middle" x="5409" y="-7301.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-7286.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="5409" y="-7271.8" font-family="Times,serif" font-size="14.00">Q[5]×K[10]×V[10]</text>
<text text-anchor="middle" x="5409" y="-7256.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_4_stage_11&#45;&gt;ring_attn_2_5_stage_11 -->
<g id="edge2122" class="edge">
<title>ring_attn_2_4_stage_11&#45;&gt;ring_attn_2_5_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-7283C5031.02,-7283 5189.86,-7283 5189.86,-7283"/>
<polygon fill="red" stroke="red" points="5189.86,-7286.5 5199.86,-7283 5189.86,-7279.5 5189.86,-7286.5"/>
</g>
<!-- ring_attn_2_4_stage_12&#45;&gt;ring_attn_2_4_stage_13 -->
<g id="edge452" class="edge">
<title>ring_attn_2_4_stage_12&#45;&gt;ring_attn_2_4_stage_13</title>
<path fill="none" stroke="black" d="M4822,-6961.87C4822,-6961.87 4822,-6855.25 4822,-6855.25"/>
<polygon fill="black" stroke="black" points="4825.5,-6855.25 4822,-6845.25 4818.5,-6855.25 4825.5,-6855.25"/>
</g>
<!-- ring_attn_2_5_stage_12 -->
<g id="node554" class="node">
<title>ring_attn_2_5_stage_12</title>
<polygon fill="yellow" stroke="black" points="5409,-7098 5200,-7030 5409,-6962 5618,-7030 5409,-7098"/>
<text text-anchor="middle" x="5409" y="-7048.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-7033.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="5409" y="-7018.8" font-family="Times,serif" font-size="14.00">Q[5]×K[9]×V[9]</text>
<text text-anchor="middle" x="5409" y="-7003.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_4_stage_12&#45;&gt;ring_attn_2_5_stage_12 -->
<g id="edge2123" class="edge">
<title>ring_attn_2_4_stage_12&#45;&gt;ring_attn_2_5_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-7030C5031.02,-7030 5189.86,-7030 5189.86,-7030"/>
<polygon fill="red" stroke="red" points="5189.86,-7033.5 5199.86,-7030 5189.86,-7026.5 5189.86,-7033.5"/>
</g>
<!-- ring_attn_2_4_stage_13&#45;&gt;ring_attn_2_4_stage_14 -->
<g id="edge453" class="edge">
<title>ring_attn_2_4_stage_13&#45;&gt;ring_attn_2_4_stage_14</title>
<path fill="none" stroke="black" d="M4822,-6708.87C4822,-6708.87 4822,-6602.25 4822,-6602.25"/>
<polygon fill="black" stroke="black" points="4825.5,-6602.25 4822,-6592.25 4818.5,-6602.25 4825.5,-6602.25"/>
</g>
<!-- ring_attn_2_5_stage_13 -->
<g id="node555" class="node">
<title>ring_attn_2_5_stage_13</title>
<polygon fill="yellow" stroke="black" points="5409,-6845 5200,-6777 5409,-6709 5618,-6777 5409,-6845"/>
<text text-anchor="middle" x="5409" y="-6795.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-6780.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="5409" y="-6765.8" font-family="Times,serif" font-size="14.00">Q[5]×K[8]×V[8]</text>
<text text-anchor="middle" x="5409" y="-6750.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_4_stage_13&#45;&gt;ring_attn_2_5_stage_13 -->
<g id="edge2124" class="edge">
<title>ring_attn_2_4_stage_13&#45;&gt;ring_attn_2_5_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-6777C5031.02,-6777 5189.86,-6777 5189.86,-6777"/>
<polygon fill="red" stroke="red" points="5189.86,-6780.5 5199.86,-6777 5189.86,-6773.5 5189.86,-6780.5"/>
</g>
<!-- ring_attn_2_4_stage_14&#45;&gt;ring_attn_2_4_stage_15 -->
<g id="edge454" class="edge">
<title>ring_attn_2_4_stage_14&#45;&gt;ring_attn_2_4_stage_15</title>
<path fill="none" stroke="black" d="M4822,-6455.87C4822,-6455.87 4822,-6349.25 4822,-6349.25"/>
<polygon fill="black" stroke="black" points="4825.5,-6349.25 4822,-6339.25 4818.5,-6349.25 4825.5,-6349.25"/>
</g>
<!-- ring_attn_2_5_stage_14 -->
<g id="node556" class="node">
<title>ring_attn_2_5_stage_14</title>
<polygon fill="yellow" stroke="black" points="5409,-6592 5200,-6524 5409,-6456 5618,-6524 5409,-6592"/>
<text text-anchor="middle" x="5409" y="-6542.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-6527.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="5409" y="-6512.8" font-family="Times,serif" font-size="14.00">Q[5]×K[7]×V[7]</text>
<text text-anchor="middle" x="5409" y="-6497.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_4_stage_14&#45;&gt;ring_attn_2_5_stage_14 -->
<g id="edge2125" class="edge">
<title>ring_attn_2_4_stage_14&#45;&gt;ring_attn_2_5_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-6524C5031.02,-6524 5189.86,-6524 5189.86,-6524"/>
<polygon fill="red" stroke="red" points="5189.86,-6527.5 5199.86,-6524 5189.86,-6520.5 5189.86,-6527.5"/>
</g>
<!-- attn_out_2_4 -->
<g id="node460" class="node">
<title>attn_out_2_4</title>
<polygon fill="none" stroke="black" points="4891.5,-6130 4752.5,-6130 4752.5,-6077 4891.5,-6077 4891.5,-6130"/>
<text text-anchor="middle" x="4822" y="-6114.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="4822" y="-6099.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="4822" y="-6084.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_2_4_stage_15&#45;&gt;attn_out_2_4 -->
<g id="edge455" class="edge">
<title>ring_attn_2_4_stage_15&#45;&gt;attn_out_2_4</title>
<path fill="none" stroke="black" d="M4822,-6202.87C4822,-6202.87 4822,-6140.18 4822,-6140.18"/>
<polygon fill="black" stroke="black" points="4825.5,-6140.18 4822,-6130.18 4818.5,-6140.18 4825.5,-6140.18"/>
</g>
<!-- ring_attn_2_5_stage_15 -->
<g id="node557" class="node">
<title>ring_attn_2_5_stage_15</title>
<polygon fill="yellow" stroke="black" points="5409,-6339 5200,-6271 5409,-6203 5618,-6271 5409,-6339"/>
<text text-anchor="middle" x="5409" y="-6289.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-6274.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="5409" y="-6259.8" font-family="Times,serif" font-size="14.00">Q[5]×K[6]×V[6]</text>
<text text-anchor="middle" x="5409" y="-6244.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_4_stage_15&#45;&gt;ring_attn_2_5_stage_15 -->
<g id="edge2126" class="edge">
<title>ring_attn_2_4_stage_15&#45;&gt;ring_attn_2_5_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-6271C5031.02,-6271 5189.86,-6271 5189.86,-6271"/>
<polygon fill="red" stroke="red" points="5189.86,-6274.5 5199.86,-6271 5189.86,-6267.5 5189.86,-6274.5"/>
</g>
<!-- attn_residual_2_4 -->
<g id="node461" class="node">
<title>attn_residual_2_4</title>
<ellipse fill="none" stroke="black" cx="4822" cy="-5977" rx="105.5" ry="27"/>
<text text-anchor="middle" x="4822" y="-5980.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="4822" y="-5965.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_2_4&#45;&gt;attn_residual_2_4 -->
<g id="edge456" class="edge">
<title>attn_out_2_4&#45;&gt;attn_residual_2_4</title>
<path fill="none" stroke="black" d="M4822,-6076.98C4822,-6076.98 4822,-6014.36 4822,-6014.36"/>
<polygon fill="black" stroke="black" points="4825.5,-6014.36 4822,-6004.36 4818.5,-6014.36 4825.5,-6014.36"/>
</g>
<!-- gate_2_4 -->
<g id="node462" class="node">
<title>gate_2_4</title>
<ellipse fill="orange" stroke="black" cx="4822" cy="-5839.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="4822" y="-5850.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="4822" y="-5835.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="4822" y="-5820.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_2_4&#45;&gt;gate_2_4 -->
<g id="edge457" class="edge">
<title>attn_residual_2_4&#45;&gt;gate_2_4</title>
<path fill="none" stroke="black" d="M4769.25,-5953.36C4769.25,-5953.36 4769.25,-5882.08 4769.25,-5882.08"/>
<polygon fill="black" stroke="black" points="4772.75,-5882.08 4769.25,-5872.08 4765.75,-5882.08 4772.75,-5882.08"/>
</g>
<!-- gate_2_4&#45;&gt;expert_2_0_0 -->
<g id="edge2127" class="edge">
<title>gate_2_4&#45;&gt;expert_2_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4726.55,-5823.4C4726.55,-5812.85 4726.55,-5801 4726.55,-5801 4726.55,-5801 147.63,-5801 147.63,-5801 147.63,-5801 147.63,-5680.22 147.63,-5680.22"/>
<polygon fill="blue" stroke="blue" points="151.13,-5680.22 147.63,-5670.22 144.13,-5680.22 151.13,-5680.22"/>
<text text-anchor="middle" x="19436.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19436.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU4→GPU0</text>
<text text-anchor="middle" x="19436.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19436.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_4&#45;&gt;expert_2_1_0 -->
<g id="edge2128" class="edge">
<title>gate_2_4&#45;&gt;expert_2_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4746.64,-5812.99C4746.64,-5795.96 4746.64,-5777 4746.64,-5777 4746.64,-5777 3178.07,-5777 3178.07,-5777 3178.07,-5777 3178.07,-5680.19 3178.07,-5680.19"/>
<polygon fill="blue" stroke="blue" points="3181.57,-5680.19 3178.07,-5670.19 3174.57,-5680.19 3181.57,-5680.19"/>
<text text-anchor="middle" x="19610.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19610.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU4→GPU1</text>
<text text-anchor="middle" x="19610.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19610.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_4&#45;&gt;expert_2_2_0 -->
<g id="edge2129" class="edge">
<title>gate_2_4&#45;&gt;expert_2_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4756.69,-5809.76C4756.69,-5802.12 4756.69,-5796 4756.69,-5796 4756.69,-5796 3762.5,-5796 3762.5,-5796 3762.5,-5796 3762.5,-5680.06 3762.5,-5680.06"/>
<polygon fill="blue" stroke="blue" points="3766,-5680.06 3762.5,-5670.06 3759,-5680.06 3766,-5680.06"/>
<text text-anchor="middle" x="19784.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19784.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU4→GPU2</text>
<text text-anchor="middle" x="19784.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19784.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_4&#45;&gt;expert_2_3_0 -->
<g id="edge2130" class="edge">
<title>gate_2_4&#45;&gt;expert_2_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4722.3,-5852C4582.46,-5852 4345,-5852 4345,-5852 4345,-5852 4345,-5680.33 4345,-5680.33"/>
<polygon fill="blue" stroke="blue" points="4348.5,-5680.33 4345,-5670.33 4341.5,-5680.33 4348.5,-5680.33"/>
<text text-anchor="middle" x="19958.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19958.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU4→GPU3</text>
<text text-anchor="middle" x="19958.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19958.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_4&#45;&gt;expert_2_4_0 -->
<g id="edge458" class="edge">
<title>gate_2_4&#45;&gt;expert_2_4_0</title>
<path fill="none" stroke="black" d="M4766.74,-5807.13C4766.74,-5807.13 4766.74,-5680.24 4766.74,-5680.24"/>
<polygon fill="black" stroke="black" points="4770.24,-5680.24 4766.74,-5670.24 4763.24,-5680.24 4770.24,-5680.24"/>
</g>
<!-- gate_2_4&#45;&gt;expert_2_5_0 -->
<g id="edge2131" class="edge">
<title>gate_2_4&#45;&gt;expert_2_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4921.65,-5827C5061.77,-5827 5300.12,-5827 5300.12,-5827 5300.12,-5827 5300.12,-5680.18 5300.12,-5680.18"/>
<polygon fill="blue" stroke="blue" points="5303.63,-5680.18 5300.12,-5670.18 5296.63,-5680.18 5303.63,-5680.18"/>
<text text-anchor="middle" x="20132.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="20132.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU4→GPU5</text>
<text text-anchor="middle" x="20132.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="20132.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_4&#45;&gt;expert_2_6_0 -->
<g id="edge2132" class="edge">
<title>gate_2_4&#45;&gt;expert_2_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4847.12,-5802.76C4847.12,-5791.49 4847.12,-5782 4847.12,-5782 4847.12,-5782 5882.4,-5782 5882.4,-5782 5882.4,-5782 5882.4,-5680.2 5882.4,-5680.2"/>
<polygon fill="blue" stroke="blue" points="5885.9,-5680.2 5882.4,-5670.2 5878.9,-5680.2 5885.9,-5680.2"/>
<text text-anchor="middle" x="20306.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="20306.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU4→GPU6</text>
<text text-anchor="middle" x="20306.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="20306.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_4&#45;&gt;expert_2_7_0 -->
<g id="edge2133" class="edge">
<title>gate_2_4&#45;&gt;expert_2_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4857.17,-5804.05C4857.17,-5787.33 4857.17,-5771 4857.17,-5771 4857.17,-5771 6467.38,-5771 6467.38,-5771 6467.38,-5771 6467.38,-5680.23 6467.38,-5680.23"/>
<polygon fill="blue" stroke="blue" points="6470.88,-5680.23 6467.38,-5670.23 6463.88,-5680.23 6470.88,-5680.23"/>
<text text-anchor="middle" x="20480.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="20480.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU4→GPU7</text>
<text text-anchor="middle" x="20480.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="20480.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_4&#45;&gt;expert_2_8_0 -->
<g id="edge2134" class="edge">
<title>gate_2_4&#45;&gt;expert_2_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4867.21,-5805.3C4867.21,-5784.14 4867.21,-5761 4867.21,-5761 4867.21,-5761 7137.89,-5761 7137.89,-5761 7137.89,-5761 7137.89,-5680.16 7137.89,-5680.16"/>
<polygon fill="blue" stroke="blue" points="7141.39,-5680.16 7137.89,-5670.16 7134.39,-5680.16 7141.39,-5680.16"/>
<text text-anchor="middle" x="20654.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="20654.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU4→GPU8</text>
<text text-anchor="middle" x="20654.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="20654.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_4&#45;&gt;expert_2_9_0 -->
<g id="edge2135" class="edge">
<title>gate_2_4&#45;&gt;expert_2_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4877.26,-5807.37C4877.26,-5784.2 4877.26,-5757 4877.26,-5757 4877.26,-5757 7718.64,-5757 7718.64,-5757 7718.64,-5757 7718.64,-5680.11 7718.64,-5680.11"/>
<polygon fill="blue" stroke="blue" points="7722.14,-5680.11 7718.64,-5670.11 7715.14,-5680.11 7722.14,-5680.11"/>
<text text-anchor="middle" x="20828.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="20828.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU4→GPU9</text>
<text text-anchor="middle" x="20828.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="20828.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_4&#45;&gt;expert_2_10_0 -->
<g id="edge2136" class="edge">
<title>gate_2_4&#45;&gt;expert_2_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4887.31,-5809.85C4887.31,-5777.73 4887.31,-5731 4887.31,-5731 4887.31,-5731 8298.79,-5731 8298.79,-5731 8298.79,-5731 8298.79,-5680.23 8298.79,-5680.23"/>
<polygon fill="blue" stroke="blue" points="8302.29,-5680.23 8298.79,-5670.23 8295.29,-5680.23 8302.29,-5680.23"/>
<text text-anchor="middle" x="21002.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21002.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU4→GPU10</text>
<text text-anchor="middle" x="21002.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21002.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_4&#45;&gt;expert_2_11_0 -->
<g id="edge2137" class="edge">
<title>gate_2_4&#45;&gt;expert_2_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4897.36,-5813.08C4897.36,-5775.74 4897.36,-5712 4897.36,-5712 4897.36,-5712 8885.79,-5712 8885.79,-5712 8885.79,-5712 8885.79,-5680.18 8885.79,-5680.18"/>
<polygon fill="blue" stroke="blue" points="8889.29,-5680.18 8885.79,-5670.18 8882.29,-5680.18 8889.29,-5680.18"/>
<text text-anchor="middle" x="21176.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21176.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU4→GPU11</text>
<text text-anchor="middle" x="21176.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21176.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_4&#45;&gt;expert_2_12_0 -->
<g id="edge2138" class="edge">
<title>gate_2_4&#45;&gt;expert_2_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4907.4,-5817.46C4907.4,-5779.54 4907.4,-5706 4907.4,-5706 4907.4,-5706 9485.89,-5706 9485.89,-5706 9485.89,-5706 9485.89,-5680.01 9485.89,-5680.01"/>
<polygon fill="blue" stroke="blue" points="9489.39,-5680.01 9485.89,-5670.01 9482.39,-5680.01 9489.39,-5680.01"/>
<text text-anchor="middle" x="21350.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21350.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU4→GPU12</text>
<text text-anchor="middle" x="21350.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21350.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_4&#45;&gt;expert_2_13_0 -->
<g id="edge2139" class="edge">
<title>gate_2_4&#45;&gt;expert_2_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4917.45,-5823.38C4917.45,-5786.48 4917.45,-5699 4917.45,-5699 4917.45,-5699 10083.9,-5699 10083.9,-5699 10083.9,-5699 10083.9,-5680.27 10083.9,-5680.27"/>
<polygon fill="blue" stroke="blue" points="10087.4,-5680.27 10083.9,-5670.27 10080.4,-5680.27 10087.4,-5680.27"/>
<text text-anchor="middle" x="21524.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21524.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU4→GPU13</text>
<text text-anchor="middle" x="21524.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21524.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_4&#45;&gt;expert_2_14_0 -->
<g id="edge2140" class="edge">
<title>gate_2_4&#45;&gt;expert_2_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4874.75,-5872.25C4874.75,-5888.62 4874.75,-5905 4874.75,-5905 4874.75,-5905 10802,-5905 10802,-5905 10802,-5905 10802,-5680.01 10802,-5680.01"/>
<polygon fill="blue" stroke="blue" points="10805.5,-5680.01 10802,-5670.01 10798.5,-5680.01 10805.5,-5680.01"/>
<text text-anchor="middle" x="21698.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21698.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU4→GPU14</text>
<text text-anchor="middle" x="21698.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21698.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_4&#45;&gt;expert_2_15_0 -->
<g id="edge2141" class="edge">
<title>gate_2_4&#45;&gt;expert_2_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4822,-5877.3C4822,-5899.8 4822,-5924 4822,-5924 4822,-5924 11391.25,-5924 11391.25,-5924 11391.25,-5924 11391.25,-5680.14 11391.25,-5680.14"/>
<polygon fill="blue" stroke="blue" points="11394.75,-5680.14 11391.25,-5670.14 11387.75,-5680.14 11394.75,-5680.14"/>
<text text-anchor="middle" x="21872.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21872.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU4→GPU15</text>
<text text-anchor="middle" x="21872.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21872.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_4 -->
<g id="node464" class="node">
<title>expert_reduce_2_4</title>
<ellipse fill="none" stroke="black" cx="4822" cy="-5506.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="4822" y="-5517.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="4822" y="-5502.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="4822" y="-5487.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_4_0&#45;&gt;expert_reduce_2_4 -->
<g id="edge459" class="edge">
<title>expert_2_4_0&#45;&gt;expert_reduce_2_4</title>
<path fill="none" stroke="black" d="M4822,-5616.76C4822,-5616.76 4822,-5554.06 4822,-5554.06"/>
<polygon fill="black" stroke="black" points="4825.5,-5554.06 4822,-5544.06 4818.5,-5554.06 4825.5,-5554.06"/>
</g>
<!-- moe_residual_2_4 -->
<g id="node465" class="node">
<title>moe_residual_2_4</title>
<ellipse fill="none" stroke="black" cx="4822" cy="-5369" rx="105.5" ry="27"/>
<text text-anchor="middle" x="4822" y="-5372.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="4822" y="-5357.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_4&#45;&gt;moe_residual_2_4 -->
<g id="edge460" class="edge">
<title>expert_reduce_2_4&#45;&gt;moe_residual_2_4</title>
<path fill="none" stroke="black" d="M4822,-5468.93C4822,-5468.93 4822,-5406.06 4822,-5406.06"/>
<polygon fill="black" stroke="black" points="4825.5,-5406.06 4822,-5396.06 4818.5,-5406.06 4825.5,-5406.06"/>
</g>
<!-- qkv_proj_3_4 -->
<g id="node466" class="node">
<title>qkv_proj_3_4</title>
<polygon fill="none" stroke="black" points="4904.5,-5269 4739.5,-5269 4739.5,-5216 4904.5,-5216 4904.5,-5269"/>
<text text-anchor="middle" x="4822" y="-5253.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="4822" y="-5238.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="4822" y="-5223.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_2_4&#45;&gt;qkv_proj_3_4 -->
<g id="edge461" class="edge">
<title>moe_residual_2_4&#45;&gt;qkv_proj_3_4</title>
<path fill="none" stroke="black" d="M4822,-5341.86C4822,-5341.86 4822,-5279.16 4822,-5279.16"/>
<polygon fill="black" stroke="black" points="4825.5,-5279.16 4822,-5269.16 4818.5,-5279.16 4825.5,-5279.16"/>
</g>
<!-- qkv_reshape_3_4 -->
<g id="node467" class="node">
<title>qkv_reshape_3_4</title>
<ellipse fill="none" stroke="black" cx="4822" cy="-5116" rx="148" ry="27"/>
<text text-anchor="middle" x="4822" y="-5119.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="4822" y="-5104.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_3_4&#45;&gt;qkv_reshape_3_4 -->
<g id="edge462" class="edge">
<title>qkv_proj_3_4&#45;&gt;qkv_reshape_3_4</title>
<path fill="none" stroke="black" d="M4822,-5215.98C4822,-5215.98 4822,-5153.36 4822,-5153.36"/>
<polygon fill="black" stroke="black" points="4825.5,-5153.36 4822,-5143.36 4818.5,-5153.36 4825.5,-5153.36"/>
</g>
<!-- qkv_reshape_3_4&#45;&gt;ring_attn_3_4_stage_0 -->
<g id="edge463" class="edge">
<title>qkv_reshape_3_4&#45;&gt;ring_attn_3_4_stage_0</title>
<path fill="none" stroke="black" d="M4822,-5088.72C4822,-5088.72 4822,-4982.16 4822,-4982.16"/>
<polygon fill="black" stroke="black" points="4825.5,-4982.16 4822,-4972.16 4818.5,-4982.16 4825.5,-4982.16"/>
</g>
<!-- ring_attn_3_4_stage_0&#45;&gt;ring_attn_3_4_stage_1 -->
<g id="edge464" class="edge">
<title>ring_attn_3_4_stage_0&#45;&gt;ring_attn_3_4_stage_1</title>
<path fill="none" stroke="black" d="M4822,-4835.87C4822,-4835.87 4822,-4729.25 4822,-4729.25"/>
<polygon fill="black" stroke="black" points="4825.5,-4729.25 4822,-4719.25 4818.5,-4729.25 4825.5,-4729.25"/>
</g>
<!-- ring_attn_3_5_stage_0 -->
<g id="node566" class="node">
<title>ring_attn_3_5_stage_0</title>
<polygon fill="yellow" stroke="black" points="5409,-4972 5200,-4904 5409,-4836 5618,-4904 5409,-4972"/>
<text text-anchor="middle" x="5409" y="-4922.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-4907.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="5409" y="-4892.8" font-family="Times,serif" font-size="14.00">Q[5]×K[5]×V[5]</text>
<text text-anchor="middle" x="5409" y="-4877.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_4_stage_0&#45;&gt;ring_attn_3_5_stage_0 -->
<g id="edge2142" class="edge">
<title>ring_attn_3_4_stage_0&#45;&gt;ring_attn_3_5_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-4904C5031.02,-4904 5189.86,-4904 5189.86,-4904"/>
<polygon fill="red" stroke="red" points="5189.86,-4907.5 5199.86,-4904 5189.86,-4900.5 5189.86,-4907.5"/>
</g>
<!-- ring_attn_3_4_stage_1&#45;&gt;ring_attn_3_4_stage_2 -->
<g id="edge465" class="edge">
<title>ring_attn_3_4_stage_1&#45;&gt;ring_attn_3_4_stage_2</title>
<path fill="none" stroke="black" d="M4822,-4582.87C4822,-4582.87 4822,-4476.25 4822,-4476.25"/>
<polygon fill="black" stroke="black" points="4825.5,-4476.25 4822,-4466.25 4818.5,-4476.25 4825.5,-4476.25"/>
</g>
<!-- ring_attn_3_5_stage_1 -->
<g id="node567" class="node">
<title>ring_attn_3_5_stage_1</title>
<polygon fill="yellow" stroke="black" points="5409,-4719 5200,-4651 5409,-4583 5618,-4651 5409,-4719"/>
<text text-anchor="middle" x="5409" y="-4669.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-4654.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="5409" y="-4639.8" font-family="Times,serif" font-size="14.00">Q[5]×K[4]×V[4]</text>
<text text-anchor="middle" x="5409" y="-4624.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_4_stage_1&#45;&gt;ring_attn_3_5_stage_1 -->
<g id="edge2143" class="edge">
<title>ring_attn_3_4_stage_1&#45;&gt;ring_attn_3_5_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-4651C5031.02,-4651 5189.86,-4651 5189.86,-4651"/>
<polygon fill="red" stroke="red" points="5189.86,-4654.5 5199.86,-4651 5189.86,-4647.5 5189.86,-4654.5"/>
</g>
<!-- ring_attn_3_4_stage_2&#45;&gt;ring_attn_3_4_stage_3 -->
<g id="edge466" class="edge">
<title>ring_attn_3_4_stage_2&#45;&gt;ring_attn_3_4_stage_3</title>
<path fill="none" stroke="black" d="M4822,-4329.87C4822,-4329.87 4822,-4223.25 4822,-4223.25"/>
<polygon fill="black" stroke="black" points="4825.5,-4223.25 4822,-4213.25 4818.5,-4223.25 4825.5,-4223.25"/>
</g>
<!-- ring_attn_3_5_stage_2 -->
<g id="node568" class="node">
<title>ring_attn_3_5_stage_2</title>
<polygon fill="yellow" stroke="black" points="5409,-4466 5200,-4398 5409,-4330 5618,-4398 5409,-4466"/>
<text text-anchor="middle" x="5409" y="-4416.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-4401.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="5409" y="-4386.8" font-family="Times,serif" font-size="14.00">Q[5]×K[3]×V[3]</text>
<text text-anchor="middle" x="5409" y="-4371.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_4_stage_2&#45;&gt;ring_attn_3_5_stage_2 -->
<g id="edge2144" class="edge">
<title>ring_attn_3_4_stage_2&#45;&gt;ring_attn_3_5_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-4398C5031.02,-4398 5189.86,-4398 5189.86,-4398"/>
<polygon fill="red" stroke="red" points="5189.86,-4401.5 5199.86,-4398 5189.86,-4394.5 5189.86,-4401.5"/>
</g>
<!-- ring_attn_3_4_stage_3&#45;&gt;ring_attn_3_4_stage_4 -->
<g id="edge467" class="edge">
<title>ring_attn_3_4_stage_3&#45;&gt;ring_attn_3_4_stage_4</title>
<path fill="none" stroke="black" d="M4822,-4076.87C4822,-4076.87 4822,-3970.25 4822,-3970.25"/>
<polygon fill="black" stroke="black" points="4825.5,-3970.25 4822,-3960.25 4818.5,-3970.25 4825.5,-3970.25"/>
</g>
<!-- ring_attn_3_5_stage_3 -->
<g id="node569" class="node">
<title>ring_attn_3_5_stage_3</title>
<polygon fill="yellow" stroke="black" points="5409,-4213 5200,-4145 5409,-4077 5618,-4145 5409,-4213"/>
<text text-anchor="middle" x="5409" y="-4163.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-4148.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="5409" y="-4133.8" font-family="Times,serif" font-size="14.00">Q[5]×K[2]×V[2]</text>
<text text-anchor="middle" x="5409" y="-4118.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_4_stage_3&#45;&gt;ring_attn_3_5_stage_3 -->
<g id="edge2145" class="edge">
<title>ring_attn_3_4_stage_3&#45;&gt;ring_attn_3_5_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-4145C5031.02,-4145 5189.86,-4145 5189.86,-4145"/>
<polygon fill="red" stroke="red" points="5189.86,-4148.5 5199.86,-4145 5189.86,-4141.5 5189.86,-4148.5"/>
</g>
<!-- ring_attn_3_4_stage_4&#45;&gt;ring_attn_3_4_stage_5 -->
<g id="edge468" class="edge">
<title>ring_attn_3_4_stage_4&#45;&gt;ring_attn_3_4_stage_5</title>
<path fill="none" stroke="black" d="M4822,-3823.87C4822,-3823.87 4822,-3717.25 4822,-3717.25"/>
<polygon fill="black" stroke="black" points="4825.5,-3717.25 4822,-3707.25 4818.5,-3717.25 4825.5,-3717.25"/>
</g>
<!-- ring_attn_3_5_stage_4 -->
<g id="node570" class="node">
<title>ring_attn_3_5_stage_4</title>
<polygon fill="yellow" stroke="black" points="5409,-3960 5200,-3892 5409,-3824 5618,-3892 5409,-3960"/>
<text text-anchor="middle" x="5409" y="-3910.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-3895.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="5409" y="-3880.8" font-family="Times,serif" font-size="14.00">Q[5]×K[1]×V[1]</text>
<text text-anchor="middle" x="5409" y="-3865.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_4_stage_4&#45;&gt;ring_attn_3_5_stage_4 -->
<g id="edge2146" class="edge">
<title>ring_attn_3_4_stage_4&#45;&gt;ring_attn_3_5_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-3892C5031.02,-3892 5189.86,-3892 5189.86,-3892"/>
<polygon fill="red" stroke="red" points="5189.86,-3895.5 5199.86,-3892 5189.86,-3888.5 5189.86,-3895.5"/>
</g>
<!-- ring_attn_3_4_stage_5&#45;&gt;ring_attn_3_4_stage_6 -->
<g id="edge469" class="edge">
<title>ring_attn_3_4_stage_5&#45;&gt;ring_attn_3_4_stage_6</title>
<path fill="none" stroke="black" d="M4822,-3570.87C4822,-3570.87 4822,-3464.25 4822,-3464.25"/>
<polygon fill="black" stroke="black" points="4825.5,-3464.25 4822,-3454.25 4818.5,-3464.25 4825.5,-3464.25"/>
</g>
<!-- ring_attn_3_5_stage_5 -->
<g id="node571" class="node">
<title>ring_attn_3_5_stage_5</title>
<polygon fill="yellow" stroke="black" points="5409,-3707 5200,-3639 5409,-3571 5618,-3639 5409,-3707"/>
<text text-anchor="middle" x="5409" y="-3657.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-3642.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="5409" y="-3627.8" font-family="Times,serif" font-size="14.00">Q[5]×K[0]×V[0]</text>
<text text-anchor="middle" x="5409" y="-3612.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_4_stage_5&#45;&gt;ring_attn_3_5_stage_5 -->
<g id="edge2147" class="edge">
<title>ring_attn_3_4_stage_5&#45;&gt;ring_attn_3_5_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-3639C5031.02,-3639 5189.86,-3639 5189.86,-3639"/>
<polygon fill="red" stroke="red" points="5189.86,-3642.5 5199.86,-3639 5189.86,-3635.5 5189.86,-3642.5"/>
</g>
<!-- ring_attn_3_4_stage_6&#45;&gt;ring_attn_3_4_stage_7 -->
<g id="edge470" class="edge">
<title>ring_attn_3_4_stage_6&#45;&gt;ring_attn_3_4_stage_7</title>
<path fill="none" stroke="black" d="M4822,-3317.87C4822,-3317.87 4822,-3211.25 4822,-3211.25"/>
<polygon fill="black" stroke="black" points="4825.5,-3211.25 4822,-3201.25 4818.5,-3211.25 4825.5,-3211.25"/>
</g>
<!-- ring_attn_3_5_stage_6 -->
<g id="node572" class="node">
<title>ring_attn_3_5_stage_6</title>
<polygon fill="yellow" stroke="black" points="5409,-3454 5200,-3386 5409,-3318 5618,-3386 5409,-3454"/>
<text text-anchor="middle" x="5409" y="-3404.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-3389.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="5409" y="-3374.8" font-family="Times,serif" font-size="14.00">Q[5]×K[15]×V[15]</text>
<text text-anchor="middle" x="5409" y="-3359.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_4_stage_6&#45;&gt;ring_attn_3_5_stage_6 -->
<g id="edge2148" class="edge">
<title>ring_attn_3_4_stage_6&#45;&gt;ring_attn_3_5_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-3386C5031.02,-3386 5189.86,-3386 5189.86,-3386"/>
<polygon fill="red" stroke="red" points="5189.86,-3389.5 5199.86,-3386 5189.86,-3382.5 5189.86,-3389.5"/>
</g>
<!-- ring_attn_3_4_stage_7&#45;&gt;ring_attn_3_4_stage_8 -->
<g id="edge471" class="edge">
<title>ring_attn_3_4_stage_7&#45;&gt;ring_attn_3_4_stage_8</title>
<path fill="none" stroke="black" d="M4822,-3064.87C4822,-3064.87 4822,-2958.25 4822,-2958.25"/>
<polygon fill="black" stroke="black" points="4825.5,-2958.25 4822,-2948.25 4818.5,-2958.25 4825.5,-2958.25"/>
</g>
<!-- ring_attn_3_5_stage_7 -->
<g id="node573" class="node">
<title>ring_attn_3_5_stage_7</title>
<polygon fill="yellow" stroke="black" points="5409,-3201 5200,-3133 5409,-3065 5618,-3133 5409,-3201"/>
<text text-anchor="middle" x="5409" y="-3151.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-3136.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="5409" y="-3121.8" font-family="Times,serif" font-size="14.00">Q[5]×K[14]×V[14]</text>
<text text-anchor="middle" x="5409" y="-3106.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_4_stage_7&#45;&gt;ring_attn_3_5_stage_7 -->
<g id="edge2149" class="edge">
<title>ring_attn_3_4_stage_7&#45;&gt;ring_attn_3_5_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-3133C5031.02,-3133 5189.86,-3133 5189.86,-3133"/>
<polygon fill="red" stroke="red" points="5189.86,-3136.5 5199.86,-3133 5189.86,-3129.5 5189.86,-3136.5"/>
</g>
<!-- ring_attn_3_4_stage_8&#45;&gt;ring_attn_3_4_stage_9 -->
<g id="edge472" class="edge">
<title>ring_attn_3_4_stage_8&#45;&gt;ring_attn_3_4_stage_9</title>
<path fill="none" stroke="black" d="M4822,-2811.87C4822,-2811.87 4822,-2705.25 4822,-2705.25"/>
<polygon fill="black" stroke="black" points="4825.5,-2705.25 4822,-2695.25 4818.5,-2705.25 4825.5,-2705.25"/>
</g>
<!-- ring_attn_3_5_stage_8 -->
<g id="node574" class="node">
<title>ring_attn_3_5_stage_8</title>
<polygon fill="yellow" stroke="black" points="5409,-2948 5200,-2880 5409,-2812 5618,-2880 5409,-2948"/>
<text text-anchor="middle" x="5409" y="-2898.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-2883.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="5409" y="-2868.8" font-family="Times,serif" font-size="14.00">Q[5]×K[13]×V[13]</text>
<text text-anchor="middle" x="5409" y="-2853.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_4_stage_8&#45;&gt;ring_attn_3_5_stage_8 -->
<g id="edge2150" class="edge">
<title>ring_attn_3_4_stage_8&#45;&gt;ring_attn_3_5_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-2880C5031.02,-2880 5189.86,-2880 5189.86,-2880"/>
<polygon fill="red" stroke="red" points="5189.86,-2883.5 5199.86,-2880 5189.86,-2876.5 5189.86,-2883.5"/>
</g>
<!-- ring_attn_3_4_stage_9&#45;&gt;ring_attn_3_4_stage_10 -->
<g id="edge473" class="edge">
<title>ring_attn_3_4_stage_9&#45;&gt;ring_attn_3_4_stage_10</title>
<path fill="none" stroke="black" d="M4822,-2558.87C4822,-2558.87 4822,-2452.25 4822,-2452.25"/>
<polygon fill="black" stroke="black" points="4825.5,-2452.25 4822,-2442.25 4818.5,-2452.25 4825.5,-2452.25"/>
</g>
<!-- ring_attn_3_5_stage_9 -->
<g id="node575" class="node">
<title>ring_attn_3_5_stage_9</title>
<polygon fill="yellow" stroke="black" points="5409,-2695 5200,-2627 5409,-2559 5618,-2627 5409,-2695"/>
<text text-anchor="middle" x="5409" y="-2645.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-2630.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="5409" y="-2615.8" font-family="Times,serif" font-size="14.00">Q[5]×K[12]×V[12]</text>
<text text-anchor="middle" x="5409" y="-2600.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_4_stage_9&#45;&gt;ring_attn_3_5_stage_9 -->
<g id="edge2151" class="edge">
<title>ring_attn_3_4_stage_9&#45;&gt;ring_attn_3_5_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-2627C5031.02,-2627 5189.86,-2627 5189.86,-2627"/>
<polygon fill="red" stroke="red" points="5189.86,-2630.5 5199.86,-2627 5189.86,-2623.5 5189.86,-2630.5"/>
</g>
<!-- ring_attn_3_4_stage_10&#45;&gt;ring_attn_3_4_stage_11 -->
<g id="edge474" class="edge">
<title>ring_attn_3_4_stage_10&#45;&gt;ring_attn_3_4_stage_11</title>
<path fill="none" stroke="black" d="M4822,-2305.87C4822,-2305.87 4822,-2199.25 4822,-2199.25"/>
<polygon fill="black" stroke="black" points="4825.5,-2199.25 4822,-2189.25 4818.5,-2199.25 4825.5,-2199.25"/>
</g>
<!-- ring_attn_3_5_stage_10 -->
<g id="node576" class="node">
<title>ring_attn_3_5_stage_10</title>
<polygon fill="yellow" stroke="black" points="5409,-2442 5200,-2374 5409,-2306 5618,-2374 5409,-2442"/>
<text text-anchor="middle" x="5409" y="-2392.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-2377.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="5409" y="-2362.8" font-family="Times,serif" font-size="14.00">Q[5]×K[11]×V[11]</text>
<text text-anchor="middle" x="5409" y="-2347.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_4_stage_10&#45;&gt;ring_attn_3_5_stage_10 -->
<g id="edge2152" class="edge">
<title>ring_attn_3_4_stage_10&#45;&gt;ring_attn_3_5_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-2374C5031.02,-2374 5189.86,-2374 5189.86,-2374"/>
<polygon fill="red" stroke="red" points="5189.86,-2377.5 5199.86,-2374 5189.86,-2370.5 5189.86,-2377.5"/>
</g>
<!-- ring_attn_3_4_stage_11&#45;&gt;ring_attn_3_4_stage_12 -->
<g id="edge475" class="edge">
<title>ring_attn_3_4_stage_11&#45;&gt;ring_attn_3_4_stage_12</title>
<path fill="none" stroke="black" d="M4822,-2052.87C4822,-2052.87 4822,-1946.25 4822,-1946.25"/>
<polygon fill="black" stroke="black" points="4825.5,-1946.25 4822,-1936.25 4818.5,-1946.25 4825.5,-1946.25"/>
</g>
<!-- ring_attn_3_5_stage_11 -->
<g id="node577" class="node">
<title>ring_attn_3_5_stage_11</title>
<polygon fill="yellow" stroke="black" points="5409,-2189 5200,-2121 5409,-2053 5618,-2121 5409,-2189"/>
<text text-anchor="middle" x="5409" y="-2139.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-2124.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="5409" y="-2109.8" font-family="Times,serif" font-size="14.00">Q[5]×K[10]×V[10]</text>
<text text-anchor="middle" x="5409" y="-2094.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_4_stage_11&#45;&gt;ring_attn_3_5_stage_11 -->
<g id="edge2153" class="edge">
<title>ring_attn_3_4_stage_11&#45;&gt;ring_attn_3_5_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-2121C5031.02,-2121 5189.86,-2121 5189.86,-2121"/>
<polygon fill="red" stroke="red" points="5189.86,-2124.5 5199.86,-2121 5189.86,-2117.5 5189.86,-2124.5"/>
</g>
<!-- ring_attn_3_4_stage_12&#45;&gt;ring_attn_3_4_stage_13 -->
<g id="edge476" class="edge">
<title>ring_attn_3_4_stage_12&#45;&gt;ring_attn_3_4_stage_13</title>
<path fill="none" stroke="black" d="M4822,-1799.87C4822,-1799.87 4822,-1693.25 4822,-1693.25"/>
<polygon fill="black" stroke="black" points="4825.5,-1693.25 4822,-1683.25 4818.5,-1693.25 4825.5,-1693.25"/>
</g>
<!-- ring_attn_3_5_stage_12 -->
<g id="node578" class="node">
<title>ring_attn_3_5_stage_12</title>
<polygon fill="yellow" stroke="black" points="5409,-1936 5200,-1868 5409,-1800 5618,-1868 5409,-1936"/>
<text text-anchor="middle" x="5409" y="-1886.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-1871.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="5409" y="-1856.8" font-family="Times,serif" font-size="14.00">Q[5]×K[9]×V[9]</text>
<text text-anchor="middle" x="5409" y="-1841.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_4_stage_12&#45;&gt;ring_attn_3_5_stage_12 -->
<g id="edge2154" class="edge">
<title>ring_attn_3_4_stage_12&#45;&gt;ring_attn_3_5_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-1868C5031.02,-1868 5189.86,-1868 5189.86,-1868"/>
<polygon fill="red" stroke="red" points="5189.86,-1871.5 5199.86,-1868 5189.86,-1864.5 5189.86,-1871.5"/>
</g>
<!-- ring_attn_3_4_stage_13&#45;&gt;ring_attn_3_4_stage_14 -->
<g id="edge477" class="edge">
<title>ring_attn_3_4_stage_13&#45;&gt;ring_attn_3_4_stage_14</title>
<path fill="none" stroke="black" d="M4822,-1546.87C4822,-1546.87 4822,-1440.25 4822,-1440.25"/>
<polygon fill="black" stroke="black" points="4825.5,-1440.25 4822,-1430.25 4818.5,-1440.25 4825.5,-1440.25"/>
</g>
<!-- ring_attn_3_5_stage_13 -->
<g id="node579" class="node">
<title>ring_attn_3_5_stage_13</title>
<polygon fill="yellow" stroke="black" points="5409,-1683 5200,-1615 5409,-1547 5618,-1615 5409,-1683"/>
<text text-anchor="middle" x="5409" y="-1633.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-1618.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="5409" y="-1603.8" font-family="Times,serif" font-size="14.00">Q[5]×K[8]×V[8]</text>
<text text-anchor="middle" x="5409" y="-1588.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_4_stage_13&#45;&gt;ring_attn_3_5_stage_13 -->
<g id="edge2155" class="edge">
<title>ring_attn_3_4_stage_13&#45;&gt;ring_attn_3_5_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-1615C5031.02,-1615 5189.86,-1615 5189.86,-1615"/>
<polygon fill="red" stroke="red" points="5189.86,-1618.5 5199.86,-1615 5189.86,-1611.5 5189.86,-1618.5"/>
</g>
<!-- ring_attn_3_4_stage_14&#45;&gt;ring_attn_3_4_stage_15 -->
<g id="edge478" class="edge">
<title>ring_attn_3_4_stage_14&#45;&gt;ring_attn_3_4_stage_15</title>
<path fill="none" stroke="black" d="M4822,-1293.87C4822,-1293.87 4822,-1187.25 4822,-1187.25"/>
<polygon fill="black" stroke="black" points="4825.5,-1187.25 4822,-1177.25 4818.5,-1187.25 4825.5,-1187.25"/>
</g>
<!-- ring_attn_3_5_stage_14 -->
<g id="node580" class="node">
<title>ring_attn_3_5_stage_14</title>
<polygon fill="yellow" stroke="black" points="5409,-1430 5200,-1362 5409,-1294 5618,-1362 5409,-1430"/>
<text text-anchor="middle" x="5409" y="-1380.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-1365.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="5409" y="-1350.8" font-family="Times,serif" font-size="14.00">Q[5]×K[7]×V[7]</text>
<text text-anchor="middle" x="5409" y="-1335.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_4_stage_14&#45;&gt;ring_attn_3_5_stage_14 -->
<g id="edge2156" class="edge">
<title>ring_attn_3_4_stage_14&#45;&gt;ring_attn_3_5_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-1362C5031.02,-1362 5189.86,-1362 5189.86,-1362"/>
<polygon fill="red" stroke="red" points="5189.86,-1365.5 5199.86,-1362 5189.86,-1358.5 5189.86,-1365.5"/>
</g>
<!-- attn_out_3_4 -->
<g id="node484" class="node">
<title>attn_out_3_4</title>
<polygon fill="none" stroke="black" points="4891.5,-968 4752.5,-968 4752.5,-915 4891.5,-915 4891.5,-968"/>
<text text-anchor="middle" x="4822" y="-952.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="4822" y="-937.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="4822" y="-922.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_3_4_stage_15&#45;&gt;attn_out_3_4 -->
<g id="edge479" class="edge">
<title>ring_attn_3_4_stage_15&#45;&gt;attn_out_3_4</title>
<path fill="none" stroke="black" d="M4822,-1040.87C4822,-1040.87 4822,-978.18 4822,-978.18"/>
<polygon fill="black" stroke="black" points="4825.5,-978.18 4822,-968.18 4818.5,-978.18 4825.5,-978.18"/>
</g>
<!-- ring_attn_3_5_stage_15 -->
<g id="node581" class="node">
<title>ring_attn_3_5_stage_15</title>
<polygon fill="yellow" stroke="black" points="5409,-1177 5200,-1109 5409,-1041 5618,-1109 5409,-1177"/>
<text text-anchor="middle" x="5409" y="-1127.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5409" y="-1112.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="5409" y="-1097.8" font-family="Times,serif" font-size="14.00">Q[5]×K[6]×V[6]</text>
<text text-anchor="middle" x="5409" y="-1082.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_4_stage_15&#45;&gt;ring_attn_3_5_stage_15 -->
<g id="edge2157" class="edge">
<title>ring_attn_3_4_stage_15&#45;&gt;ring_attn_3_5_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5031.02,-1109C5031.02,-1109 5189.86,-1109 5189.86,-1109"/>
<polygon fill="red" stroke="red" points="5189.86,-1112.5 5199.86,-1109 5189.86,-1105.5 5189.86,-1112.5"/>
</g>
<!-- attn_residual_3_4 -->
<g id="node485" class="node">
<title>attn_residual_3_4</title>
<ellipse fill="none" stroke="black" cx="4822" cy="-815" rx="105.5" ry="27"/>
<text text-anchor="middle" x="4822" y="-818.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="4822" y="-803.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_3_4&#45;&gt;attn_residual_3_4 -->
<g id="edge480" class="edge">
<title>attn_out_3_4&#45;&gt;attn_residual_3_4</title>
<path fill="none" stroke="black" d="M4822,-914.98C4822,-914.98 4822,-852.36 4822,-852.36"/>
<polygon fill="black" stroke="black" points="4825.5,-852.36 4822,-842.36 4818.5,-852.36 4825.5,-852.36"/>
</g>
<!-- gate_3_4 -->
<g id="node486" class="node">
<title>gate_3_4</title>
<ellipse fill="orange" stroke="black" cx="4822" cy="-677.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="4822" y="-688.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="4822" y="-673.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="4822" y="-658.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_3_4&#45;&gt;gate_3_4 -->
<g id="edge481" class="edge">
<title>attn_residual_3_4&#45;&gt;gate_3_4</title>
<path fill="none" stroke="black" d="M4769.25,-791.36C4769.25,-791.36 4769.25,-720.08 4769.25,-720.08"/>
<polygon fill="black" stroke="black" points="4772.75,-720.08 4769.25,-710.08 4765.75,-720.08 4772.75,-720.08"/>
</g>
<!-- gate_3_4&#45;&gt;expert_3_0_0 -->
<g id="edge2158" class="edge">
<title>gate_3_4&#45;&gt;expert_3_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4726.55,-661.4C4726.55,-650.85 4726.55,-639 4726.55,-639 4726.55,-639 147.63,-639 147.63,-639 147.63,-639 147.63,-518.22 147.63,-518.22"/>
<polygon fill="blue" stroke="blue" points="151.13,-518.22 147.63,-508.22 144.13,-518.22 151.13,-518.22"/>
<text text-anchor="middle" x="19436.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19436.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU4→GPU0</text>
<text text-anchor="middle" x="19436.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19436.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_4&#45;&gt;expert_3_1_0 -->
<g id="edge2159" class="edge">
<title>gate_3_4&#45;&gt;expert_3_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4746.64,-650.99C4746.64,-633.96 4746.64,-615 4746.64,-615 4746.64,-615 3178.07,-615 3178.07,-615 3178.07,-615 3178.07,-518.19 3178.07,-518.19"/>
<polygon fill="blue" stroke="blue" points="3181.57,-518.19 3178.07,-508.19 3174.57,-518.19 3181.57,-518.19"/>
<text text-anchor="middle" x="19610.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19610.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU4→GPU1</text>
<text text-anchor="middle" x="19610.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19610.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_4&#45;&gt;expert_3_2_0 -->
<g id="edge2160" class="edge">
<title>gate_3_4&#45;&gt;expert_3_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4756.69,-647.76C4756.69,-640.12 4756.69,-634 4756.69,-634 4756.69,-634 3762.5,-634 3762.5,-634 3762.5,-634 3762.5,-518.06 3762.5,-518.06"/>
<polygon fill="blue" stroke="blue" points="3766,-518.06 3762.5,-508.06 3759,-518.06 3766,-518.06"/>
<text text-anchor="middle" x="19784.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19784.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU4→GPU2</text>
<text text-anchor="middle" x="19784.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19784.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_4&#45;&gt;expert_3_3_0 -->
<g id="edge2161" class="edge">
<title>gate_3_4&#45;&gt;expert_3_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4722.3,-690C4582.46,-690 4345,-690 4345,-690 4345,-690 4345,-518.33 4345,-518.33"/>
<polygon fill="blue" stroke="blue" points="4348.5,-518.33 4345,-508.33 4341.5,-518.33 4348.5,-518.33"/>
<text text-anchor="middle" x="19958.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="19958.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU4→GPU3</text>
<text text-anchor="middle" x="19958.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="19958.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_4&#45;&gt;expert_3_4_0 -->
<g id="edge482" class="edge">
<title>gate_3_4&#45;&gt;expert_3_4_0</title>
<path fill="none" stroke="black" d="M4766.74,-645.13C4766.74,-645.13 4766.74,-518.24 4766.74,-518.24"/>
<polygon fill="black" stroke="black" points="4770.24,-518.24 4766.74,-508.24 4763.24,-518.24 4770.24,-518.24"/>
</g>
<!-- gate_3_4&#45;&gt;expert_3_5_0 -->
<g id="edge2162" class="edge">
<title>gate_3_4&#45;&gt;expert_3_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4921.65,-665C5061.77,-665 5300.12,-665 5300.12,-665 5300.12,-665 5300.12,-518.18 5300.12,-518.18"/>
<polygon fill="blue" stroke="blue" points="5303.63,-518.18 5300.12,-508.18 5296.63,-518.18 5303.63,-518.18"/>
<text text-anchor="middle" x="20132.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="20132.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU4→GPU5</text>
<text text-anchor="middle" x="20132.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="20132.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_4&#45;&gt;expert_3_6_0 -->
<g id="edge2163" class="edge">
<title>gate_3_4&#45;&gt;expert_3_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4847.12,-640.76C4847.12,-629.49 4847.12,-620 4847.12,-620 4847.12,-620 5882.4,-620 5882.4,-620 5882.4,-620 5882.4,-518.2 5882.4,-518.2"/>
<polygon fill="blue" stroke="blue" points="5885.9,-518.2 5882.4,-508.2 5878.9,-518.2 5885.9,-518.2"/>
<text text-anchor="middle" x="20306.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="20306.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU4→GPU6</text>
<text text-anchor="middle" x="20306.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="20306.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_4&#45;&gt;expert_3_7_0 -->
<g id="edge2164" class="edge">
<title>gate_3_4&#45;&gt;expert_3_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4857.17,-642.05C4857.17,-625.33 4857.17,-609 4857.17,-609 4857.17,-609 6467.38,-609 6467.38,-609 6467.38,-609 6467.38,-518.23 6467.38,-518.23"/>
<polygon fill="blue" stroke="blue" points="6470.88,-518.23 6467.38,-508.23 6463.88,-518.23 6470.88,-518.23"/>
<text text-anchor="middle" x="20480.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="20480.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU4→GPU7</text>
<text text-anchor="middle" x="20480.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="20480.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_4&#45;&gt;expert_3_8_0 -->
<g id="edge2165" class="edge">
<title>gate_3_4&#45;&gt;expert_3_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4867.21,-643.3C4867.21,-622.14 4867.21,-599 4867.21,-599 4867.21,-599 7137.89,-599 7137.89,-599 7137.89,-599 7137.89,-518.16 7137.89,-518.16"/>
<polygon fill="blue" stroke="blue" points="7141.39,-518.16 7137.89,-508.16 7134.39,-518.16 7141.39,-518.16"/>
<text text-anchor="middle" x="20654.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="20654.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU4→GPU8</text>
<text text-anchor="middle" x="20654.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="20654.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_4&#45;&gt;expert_3_9_0 -->
<g id="edge2166" class="edge">
<title>gate_3_4&#45;&gt;expert_3_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4877.26,-645.37C4877.26,-622.2 4877.26,-595 4877.26,-595 4877.26,-595 7718.64,-595 7718.64,-595 7718.64,-595 7718.64,-518.11 7718.64,-518.11"/>
<polygon fill="blue" stroke="blue" points="7722.14,-518.11 7718.64,-508.11 7715.14,-518.11 7722.14,-518.11"/>
<text text-anchor="middle" x="20828.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="20828.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU4→GPU9</text>
<text text-anchor="middle" x="20828.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="20828.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_4&#45;&gt;expert_3_10_0 -->
<g id="edge2167" class="edge">
<title>gate_3_4&#45;&gt;expert_3_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4887.31,-647.85C4887.31,-615.73 4887.31,-569 4887.31,-569 4887.31,-569 8298.79,-569 8298.79,-569 8298.79,-569 8298.79,-518.23 8298.79,-518.23"/>
<polygon fill="blue" stroke="blue" points="8302.29,-518.23 8298.79,-508.23 8295.29,-518.23 8302.29,-518.23"/>
<text text-anchor="middle" x="21002.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21002.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU4→GPU10</text>
<text text-anchor="middle" x="21002.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21002.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_4&#45;&gt;expert_3_11_0 -->
<g id="edge2168" class="edge">
<title>gate_3_4&#45;&gt;expert_3_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4897.36,-651.08C4897.36,-613.74 4897.36,-550 4897.36,-550 4897.36,-550 8885.79,-550 8885.79,-550 8885.79,-550 8885.79,-518.18 8885.79,-518.18"/>
<polygon fill="blue" stroke="blue" points="8889.29,-518.18 8885.79,-508.18 8882.29,-518.18 8889.29,-518.18"/>
<text text-anchor="middle" x="21176.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21176.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU4→GPU11</text>
<text text-anchor="middle" x="21176.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21176.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_4&#45;&gt;expert_3_12_0 -->
<g id="edge2169" class="edge">
<title>gate_3_4&#45;&gt;expert_3_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4907.4,-655.46C4907.4,-617.54 4907.4,-544 4907.4,-544 4907.4,-544 9485.89,-544 9485.89,-544 9485.89,-544 9485.89,-518.01 9485.89,-518.01"/>
<polygon fill="blue" stroke="blue" points="9489.39,-518.01 9485.89,-508.01 9482.39,-518.01 9489.39,-518.01"/>
<text text-anchor="middle" x="21350.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21350.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU4→GPU12</text>
<text text-anchor="middle" x="21350.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21350.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_4&#45;&gt;expert_3_13_0 -->
<g id="edge2170" class="edge">
<title>gate_3_4&#45;&gt;expert_3_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4917.45,-661.38C4917.45,-624.48 4917.45,-537 4917.45,-537 4917.45,-537 10083.9,-537 10083.9,-537 10083.9,-537 10083.9,-518.27 10083.9,-518.27"/>
<polygon fill="blue" stroke="blue" points="10087.4,-518.27 10083.9,-508.27 10080.4,-518.27 10087.4,-518.27"/>
<text text-anchor="middle" x="21524.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21524.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU4→GPU13</text>
<text text-anchor="middle" x="21524.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21524.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_4&#45;&gt;expert_3_14_0 -->
<g id="edge2171" class="edge">
<title>gate_3_4&#45;&gt;expert_3_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4874.75,-710.25C4874.75,-726.62 4874.75,-743 4874.75,-743 4874.75,-743 10802,-743 10802,-743 10802,-743 10802,-518.01 10802,-518.01"/>
<polygon fill="blue" stroke="blue" points="10805.5,-518.01 10802,-508.01 10798.5,-518.01 10805.5,-518.01"/>
<text text-anchor="middle" x="21698.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21698.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU4→GPU14</text>
<text text-anchor="middle" x="21698.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21698.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_4&#45;&gt;expert_3_15_0 -->
<g id="edge2172" class="edge">
<title>gate_3_4&#45;&gt;expert_3_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4822,-715.3C4822,-737.8 4822,-762 4822,-762 4822,-762 11391.25,-762 11391.25,-762 11391.25,-762 11391.25,-518.14 11391.25,-518.14"/>
<polygon fill="blue" stroke="blue" points="11394.75,-518.14 11391.25,-508.14 11387.75,-518.14 11394.75,-518.14"/>
<text text-anchor="middle" x="21872.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="21872.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU4→GPU15</text>
<text text-anchor="middle" x="21872.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="21872.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_4 -->
<g id="node488" class="node">
<title>expert_reduce_3_4</title>
<ellipse fill="none" stroke="black" cx="4822" cy="-344.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="4822" y="-355.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="4822" y="-340.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="4822" y="-325.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_4_0&#45;&gt;expert_reduce_3_4 -->
<g id="edge483" class="edge">
<title>expert_3_4_0&#45;&gt;expert_reduce_3_4</title>
<path fill="none" stroke="black" d="M4822,-454.76C4822,-454.76 4822,-392.06 4822,-392.06"/>
<polygon fill="black" stroke="black" points="4825.5,-392.06 4822,-382.06 4818.5,-392.06 4825.5,-392.06"/>
</g>
<!-- moe_residual_3_4 -->
<g id="node489" class="node">
<title>moe_residual_3_4</title>
<ellipse fill="none" stroke="black" cx="4822" cy="-207" rx="105.5" ry="27"/>
<text text-anchor="middle" x="4822" y="-210.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="4822" y="-195.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_4&#45;&gt;moe_residual_3_4 -->
<g id="edge484" class="edge">
<title>expert_reduce_3_4&#45;&gt;moe_residual_3_4</title>
<path fill="none" stroke="black" d="M4822,-306.93C4822,-306.93 4822,-244.06 4822,-244.06"/>
<polygon fill="black" stroke="black" points="4825.5,-244.06 4822,-234.06 4818.5,-244.06 4825.5,-244.06"/>
</g>
<!-- output_4 -->
<g id="node490" class="node">
<title>output_4</title>
<polygon fill="lightcoral" stroke="black" points="4915,-107 4729,-107 4729,-69 4915,-69 4915,-107"/>
<text text-anchor="middle" x="4822" y="-91.8" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="4822" y="-76.8" font-family="Times,serif" font-size="14.00">Y[4]: 1024×1024×4096</text>
</g>
<!-- moe_residual_3_4&#45;&gt;output_4 -->
<g id="edge485" class="edge">
<title>moe_residual_3_4&#45;&gt;output_4</title>
<path fill="none" stroke="black" d="M4822,-180C4822,-180 4822,-117.12 4822,-117.12"/>
<polygon fill="black" stroke="black" points="4825.5,-117.12 4822,-107.12 4818.5,-117.12 4825.5,-117.12"/>
</g>
<!-- input_5 -->
<g id="node491" class="node">
<title>input_5</title>
<polygon fill="lightgreen" stroke="black" points="5502.5,-20866 5315.5,-20866 5315.5,-20828 5502.5,-20828 5502.5,-20866"/>
<text text-anchor="middle" x="5409" y="-20850.8" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="5409" y="-20835.8" font-family="Times,serif" font-size="14.00">X[5]: 1024×1024×4096</text>
</g>
<!-- qkv_proj_0_5 -->
<g id="node492" class="node">
<title>qkv_proj_0_5</title>
<polygon fill="none" stroke="black" points="5491.5,-20755 5326.5,-20755 5326.5,-20702 5491.5,-20702 5491.5,-20755"/>
<text text-anchor="middle" x="5409" y="-20739.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5409" y="-20724.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="5409" y="-20709.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- input_5&#45;&gt;qkv_proj_0_5 -->
<g id="edge486" class="edge">
<title>input_5&#45;&gt;qkv_proj_0_5</title>
<path fill="none" stroke="black" d="M5409,-20827.96C5409,-20827.96 5409,-20765.44 5409,-20765.44"/>
<polygon fill="black" stroke="black" points="5412.5,-20765.44 5409,-20755.44 5405.5,-20765.44 5412.5,-20765.44"/>
</g>
<!-- qkv_reshape_0_5 -->
<g id="node493" class="node">
<title>qkv_reshape_0_5</title>
<ellipse fill="none" stroke="black" cx="5409" cy="-20602" rx="148" ry="27"/>
<text text-anchor="middle" x="5409" y="-20605.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="5409" y="-20590.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_0_5&#45;&gt;qkv_reshape_0_5 -->
<g id="edge487" class="edge">
<title>qkv_proj_0_5&#45;&gt;qkv_reshape_0_5</title>
<path fill="none" stroke="black" d="M5409,-20701.98C5409,-20701.98 5409,-20639.36 5409,-20639.36"/>
<polygon fill="black" stroke="black" points="5412.5,-20639.36 5409,-20629.36 5405.5,-20639.36 5412.5,-20639.36"/>
</g>
<!-- qkv_reshape_0_5&#45;&gt;ring_attn_0_5_stage_0 -->
<g id="edge488" class="edge">
<title>qkv_reshape_0_5&#45;&gt;ring_attn_0_5_stage_0</title>
<path fill="none" stroke="black" d="M5409,-20574.72C5409,-20574.72 5409,-20468.16 5409,-20468.16"/>
<polygon fill="black" stroke="black" points="5412.5,-20468.16 5409,-20458.16 5405.5,-20468.16 5412.5,-20468.16"/>
</g>
<!-- ring_attn_0_5_stage_0&#45;&gt;ring_attn_0_5_stage_1 -->
<g id="edge489" class="edge">
<title>ring_attn_0_5_stage_0&#45;&gt;ring_attn_0_5_stage_1</title>
<path fill="none" stroke="black" d="M5409,-20321.87C5409,-20321.87 5409,-20215.25 5409,-20215.25"/>
<polygon fill="black" stroke="black" points="5412.5,-20215.25 5409,-20205.25 5405.5,-20215.25 5412.5,-20215.25"/>
</g>
<!-- ring_attn_0_6_stage_0 -->
<g id="node592" class="node">
<title>ring_attn_0_6_stage_0</title>
<polygon fill="yellow" stroke="black" points="5996,-20458 5787,-20390 5996,-20322 6205,-20390 5996,-20458"/>
<text text-anchor="middle" x="5996" y="-20408.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-20393.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="5996" y="-20378.8" font-family="Times,serif" font-size="14.00">Q[6]×K[6]×V[6]</text>
<text text-anchor="middle" x="5996" y="-20363.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_5_stage_0&#45;&gt;ring_attn_0_6_stage_0 -->
<g id="edge2173" class="edge">
<title>ring_attn_0_5_stage_0&#45;&gt;ring_attn_0_6_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-20390C5618.02,-20390 5776.86,-20390 5776.86,-20390"/>
<polygon fill="red" stroke="red" points="5776.86,-20393.5 5786.86,-20390 5776.86,-20386.5 5776.86,-20393.5"/>
</g>
<!-- ring_attn_0_5_stage_1&#45;&gt;ring_attn_0_5_stage_2 -->
<g id="edge490" class="edge">
<title>ring_attn_0_5_stage_1&#45;&gt;ring_attn_0_5_stage_2</title>
<path fill="none" stroke="black" d="M5409,-20068.87C5409,-20068.87 5409,-19962.25 5409,-19962.25"/>
<polygon fill="black" stroke="black" points="5412.5,-19962.25 5409,-19952.25 5405.5,-19962.25 5412.5,-19962.25"/>
</g>
<!-- ring_attn_0_6_stage_1 -->
<g id="node593" class="node">
<title>ring_attn_0_6_stage_1</title>
<polygon fill="yellow" stroke="black" points="5996,-20205 5787,-20137 5996,-20069 6205,-20137 5996,-20205"/>
<text text-anchor="middle" x="5996" y="-20155.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-20140.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="5996" y="-20125.8" font-family="Times,serif" font-size="14.00">Q[6]×K[5]×V[5]</text>
<text text-anchor="middle" x="5996" y="-20110.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_5_stage_1&#45;&gt;ring_attn_0_6_stage_1 -->
<g id="edge2174" class="edge">
<title>ring_attn_0_5_stage_1&#45;&gt;ring_attn_0_6_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-20137C5618.02,-20137 5776.86,-20137 5776.86,-20137"/>
<polygon fill="red" stroke="red" points="5776.86,-20140.5 5786.86,-20137 5776.86,-20133.5 5776.86,-20140.5"/>
</g>
<!-- ring_attn_0_5_stage_2&#45;&gt;ring_attn_0_5_stage_3 -->
<g id="edge491" class="edge">
<title>ring_attn_0_5_stage_2&#45;&gt;ring_attn_0_5_stage_3</title>
<path fill="none" stroke="black" d="M5409,-19815.87C5409,-19815.87 5409,-19709.25 5409,-19709.25"/>
<polygon fill="black" stroke="black" points="5412.5,-19709.25 5409,-19699.25 5405.5,-19709.25 5412.5,-19709.25"/>
</g>
<!-- ring_attn_0_6_stage_2 -->
<g id="node594" class="node">
<title>ring_attn_0_6_stage_2</title>
<polygon fill="yellow" stroke="black" points="5996,-19952 5787,-19884 5996,-19816 6205,-19884 5996,-19952"/>
<text text-anchor="middle" x="5996" y="-19902.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-19887.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="5996" y="-19872.8" font-family="Times,serif" font-size="14.00">Q[6]×K[4]×V[4]</text>
<text text-anchor="middle" x="5996" y="-19857.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_5_stage_2&#45;&gt;ring_attn_0_6_stage_2 -->
<g id="edge2175" class="edge">
<title>ring_attn_0_5_stage_2&#45;&gt;ring_attn_0_6_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-19884C5618.02,-19884 5776.86,-19884 5776.86,-19884"/>
<polygon fill="red" stroke="red" points="5776.86,-19887.5 5786.86,-19884 5776.86,-19880.5 5776.86,-19887.5"/>
</g>
<!-- ring_attn_0_5_stage_3&#45;&gt;ring_attn_0_5_stage_4 -->
<g id="edge492" class="edge">
<title>ring_attn_0_5_stage_3&#45;&gt;ring_attn_0_5_stage_4</title>
<path fill="none" stroke="black" d="M5409,-19562.87C5409,-19562.87 5409,-19456.25 5409,-19456.25"/>
<polygon fill="black" stroke="black" points="5412.5,-19456.25 5409,-19446.25 5405.5,-19456.25 5412.5,-19456.25"/>
</g>
<!-- ring_attn_0_6_stage_3 -->
<g id="node595" class="node">
<title>ring_attn_0_6_stage_3</title>
<polygon fill="yellow" stroke="black" points="5996,-19699 5787,-19631 5996,-19563 6205,-19631 5996,-19699"/>
<text text-anchor="middle" x="5996" y="-19649.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-19634.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="5996" y="-19619.8" font-family="Times,serif" font-size="14.00">Q[6]×K[3]×V[3]</text>
<text text-anchor="middle" x="5996" y="-19604.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_5_stage_3&#45;&gt;ring_attn_0_6_stage_3 -->
<g id="edge2176" class="edge">
<title>ring_attn_0_5_stage_3&#45;&gt;ring_attn_0_6_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-19631C5618.02,-19631 5776.86,-19631 5776.86,-19631"/>
<polygon fill="red" stroke="red" points="5776.86,-19634.5 5786.86,-19631 5776.86,-19627.5 5776.86,-19634.5"/>
</g>
<!-- ring_attn_0_5_stage_4&#45;&gt;ring_attn_0_5_stage_5 -->
<g id="edge493" class="edge">
<title>ring_attn_0_5_stage_4&#45;&gt;ring_attn_0_5_stage_5</title>
<path fill="none" stroke="black" d="M5409,-19309.87C5409,-19309.87 5409,-19203.25 5409,-19203.25"/>
<polygon fill="black" stroke="black" points="5412.5,-19203.25 5409,-19193.25 5405.5,-19203.25 5412.5,-19203.25"/>
</g>
<!-- ring_attn_0_6_stage_4 -->
<g id="node596" class="node">
<title>ring_attn_0_6_stage_4</title>
<polygon fill="yellow" stroke="black" points="5996,-19446 5787,-19378 5996,-19310 6205,-19378 5996,-19446"/>
<text text-anchor="middle" x="5996" y="-19396.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-19381.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="5996" y="-19366.8" font-family="Times,serif" font-size="14.00">Q[6]×K[2]×V[2]</text>
<text text-anchor="middle" x="5996" y="-19351.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_5_stage_4&#45;&gt;ring_attn_0_6_stage_4 -->
<g id="edge2177" class="edge">
<title>ring_attn_0_5_stage_4&#45;&gt;ring_attn_0_6_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-19378C5618.02,-19378 5776.86,-19378 5776.86,-19378"/>
<polygon fill="red" stroke="red" points="5776.86,-19381.5 5786.86,-19378 5776.86,-19374.5 5776.86,-19381.5"/>
</g>
<!-- ring_attn_0_5_stage_5&#45;&gt;ring_attn_0_5_stage_6 -->
<g id="edge494" class="edge">
<title>ring_attn_0_5_stage_5&#45;&gt;ring_attn_0_5_stage_6</title>
<path fill="none" stroke="black" d="M5409,-19056.87C5409,-19056.87 5409,-18950.25 5409,-18950.25"/>
<polygon fill="black" stroke="black" points="5412.5,-18950.25 5409,-18940.25 5405.5,-18950.25 5412.5,-18950.25"/>
</g>
<!-- ring_attn_0_6_stage_5 -->
<g id="node597" class="node">
<title>ring_attn_0_6_stage_5</title>
<polygon fill="yellow" stroke="black" points="5996,-19193 5787,-19125 5996,-19057 6205,-19125 5996,-19193"/>
<text text-anchor="middle" x="5996" y="-19143.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-19128.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="5996" y="-19113.8" font-family="Times,serif" font-size="14.00">Q[6]×K[1]×V[1]</text>
<text text-anchor="middle" x="5996" y="-19098.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_5_stage_5&#45;&gt;ring_attn_0_6_stage_5 -->
<g id="edge2178" class="edge">
<title>ring_attn_0_5_stage_5&#45;&gt;ring_attn_0_6_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-19125C5618.02,-19125 5776.86,-19125 5776.86,-19125"/>
<polygon fill="red" stroke="red" points="5776.86,-19128.5 5786.86,-19125 5776.86,-19121.5 5776.86,-19128.5"/>
</g>
<!-- ring_attn_0_5_stage_6&#45;&gt;ring_attn_0_5_stage_7 -->
<g id="edge495" class="edge">
<title>ring_attn_0_5_stage_6&#45;&gt;ring_attn_0_5_stage_7</title>
<path fill="none" stroke="black" d="M5409,-18803.87C5409,-18803.87 5409,-18697.25 5409,-18697.25"/>
<polygon fill="black" stroke="black" points="5412.5,-18697.25 5409,-18687.25 5405.5,-18697.25 5412.5,-18697.25"/>
</g>
<!-- ring_attn_0_6_stage_6 -->
<g id="node598" class="node">
<title>ring_attn_0_6_stage_6</title>
<polygon fill="yellow" stroke="black" points="5996,-18940 5787,-18872 5996,-18804 6205,-18872 5996,-18940"/>
<text text-anchor="middle" x="5996" y="-18890.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-18875.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="5996" y="-18860.8" font-family="Times,serif" font-size="14.00">Q[6]×K[0]×V[0]</text>
<text text-anchor="middle" x="5996" y="-18845.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_5_stage_6&#45;&gt;ring_attn_0_6_stage_6 -->
<g id="edge2179" class="edge">
<title>ring_attn_0_5_stage_6&#45;&gt;ring_attn_0_6_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-18872C5618.02,-18872 5776.86,-18872 5776.86,-18872"/>
<polygon fill="red" stroke="red" points="5776.86,-18875.5 5786.86,-18872 5776.86,-18868.5 5776.86,-18875.5"/>
</g>
<!-- ring_attn_0_5_stage_7&#45;&gt;ring_attn_0_5_stage_8 -->
<g id="edge496" class="edge">
<title>ring_attn_0_5_stage_7&#45;&gt;ring_attn_0_5_stage_8</title>
<path fill="none" stroke="black" d="M5409,-18550.87C5409,-18550.87 5409,-18444.25 5409,-18444.25"/>
<polygon fill="black" stroke="black" points="5412.5,-18444.25 5409,-18434.25 5405.5,-18444.25 5412.5,-18444.25"/>
</g>
<!-- ring_attn_0_6_stage_7 -->
<g id="node599" class="node">
<title>ring_attn_0_6_stage_7</title>
<polygon fill="yellow" stroke="black" points="5996,-18687 5787,-18619 5996,-18551 6205,-18619 5996,-18687"/>
<text text-anchor="middle" x="5996" y="-18637.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-18622.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="5996" y="-18607.8" font-family="Times,serif" font-size="14.00">Q[6]×K[15]×V[15]</text>
<text text-anchor="middle" x="5996" y="-18592.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_5_stage_7&#45;&gt;ring_attn_0_6_stage_7 -->
<g id="edge2180" class="edge">
<title>ring_attn_0_5_stage_7&#45;&gt;ring_attn_0_6_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-18619C5618.02,-18619 5776.86,-18619 5776.86,-18619"/>
<polygon fill="red" stroke="red" points="5776.86,-18622.5 5786.86,-18619 5776.86,-18615.5 5776.86,-18622.5"/>
</g>
<!-- ring_attn_0_5_stage_8&#45;&gt;ring_attn_0_5_stage_9 -->
<g id="edge497" class="edge">
<title>ring_attn_0_5_stage_8&#45;&gt;ring_attn_0_5_stage_9</title>
<path fill="none" stroke="black" d="M5409,-18297.87C5409,-18297.87 5409,-18191.25 5409,-18191.25"/>
<polygon fill="black" stroke="black" points="5412.5,-18191.25 5409,-18181.25 5405.5,-18191.25 5412.5,-18191.25"/>
</g>
<!-- ring_attn_0_6_stage_8 -->
<g id="node600" class="node">
<title>ring_attn_0_6_stage_8</title>
<polygon fill="yellow" stroke="black" points="5996,-18434 5787,-18366 5996,-18298 6205,-18366 5996,-18434"/>
<text text-anchor="middle" x="5996" y="-18384.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-18369.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="5996" y="-18354.8" font-family="Times,serif" font-size="14.00">Q[6]×K[14]×V[14]</text>
<text text-anchor="middle" x="5996" y="-18339.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_5_stage_8&#45;&gt;ring_attn_0_6_stage_8 -->
<g id="edge2181" class="edge">
<title>ring_attn_0_5_stage_8&#45;&gt;ring_attn_0_6_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-18366C5618.02,-18366 5776.86,-18366 5776.86,-18366"/>
<polygon fill="red" stroke="red" points="5776.86,-18369.5 5786.86,-18366 5776.86,-18362.5 5776.86,-18369.5"/>
</g>
<!-- ring_attn_0_5_stage_9&#45;&gt;ring_attn_0_5_stage_10 -->
<g id="edge498" class="edge">
<title>ring_attn_0_5_stage_9&#45;&gt;ring_attn_0_5_stage_10</title>
<path fill="none" stroke="black" d="M5409,-18044.87C5409,-18044.87 5409,-17938.25 5409,-17938.25"/>
<polygon fill="black" stroke="black" points="5412.5,-17938.25 5409,-17928.25 5405.5,-17938.25 5412.5,-17938.25"/>
</g>
<!-- ring_attn_0_6_stage_9 -->
<g id="node601" class="node">
<title>ring_attn_0_6_stage_9</title>
<polygon fill="yellow" stroke="black" points="5996,-18181 5787,-18113 5996,-18045 6205,-18113 5996,-18181"/>
<text text-anchor="middle" x="5996" y="-18131.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-18116.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="5996" y="-18101.8" font-family="Times,serif" font-size="14.00">Q[6]×K[13]×V[13]</text>
<text text-anchor="middle" x="5996" y="-18086.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_5_stage_9&#45;&gt;ring_attn_0_6_stage_9 -->
<g id="edge2182" class="edge">
<title>ring_attn_0_5_stage_9&#45;&gt;ring_attn_0_6_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-18113C5618.02,-18113 5776.86,-18113 5776.86,-18113"/>
<polygon fill="red" stroke="red" points="5776.86,-18116.5 5786.86,-18113 5776.86,-18109.5 5776.86,-18116.5"/>
</g>
<!-- ring_attn_0_5_stage_10&#45;&gt;ring_attn_0_5_stage_11 -->
<g id="edge499" class="edge">
<title>ring_attn_0_5_stage_10&#45;&gt;ring_attn_0_5_stage_11</title>
<path fill="none" stroke="black" d="M5409,-17791.87C5409,-17791.87 5409,-17685.25 5409,-17685.25"/>
<polygon fill="black" stroke="black" points="5412.5,-17685.25 5409,-17675.25 5405.5,-17685.25 5412.5,-17685.25"/>
</g>
<!-- ring_attn_0_6_stage_10 -->
<g id="node602" class="node">
<title>ring_attn_0_6_stage_10</title>
<polygon fill="yellow" stroke="black" points="5996,-17928 5787,-17860 5996,-17792 6205,-17860 5996,-17928"/>
<text text-anchor="middle" x="5996" y="-17878.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-17863.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="5996" y="-17848.8" font-family="Times,serif" font-size="14.00">Q[6]×K[12]×V[12]</text>
<text text-anchor="middle" x="5996" y="-17833.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_5_stage_10&#45;&gt;ring_attn_0_6_stage_10 -->
<g id="edge2183" class="edge">
<title>ring_attn_0_5_stage_10&#45;&gt;ring_attn_0_6_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-17860C5618.02,-17860 5776.86,-17860 5776.86,-17860"/>
<polygon fill="red" stroke="red" points="5776.86,-17863.5 5786.86,-17860 5776.86,-17856.5 5776.86,-17863.5"/>
</g>
<!-- ring_attn_0_5_stage_11&#45;&gt;ring_attn_0_5_stage_12 -->
<g id="edge500" class="edge">
<title>ring_attn_0_5_stage_11&#45;&gt;ring_attn_0_5_stage_12</title>
<path fill="none" stroke="black" d="M5409,-17538.87C5409,-17538.87 5409,-17432.25 5409,-17432.25"/>
<polygon fill="black" stroke="black" points="5412.5,-17432.25 5409,-17422.25 5405.5,-17432.25 5412.5,-17432.25"/>
</g>
<!-- ring_attn_0_6_stage_11 -->
<g id="node603" class="node">
<title>ring_attn_0_6_stage_11</title>
<polygon fill="yellow" stroke="black" points="5996,-17675 5787,-17607 5996,-17539 6205,-17607 5996,-17675"/>
<text text-anchor="middle" x="5996" y="-17625.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-17610.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="5996" y="-17595.8" font-family="Times,serif" font-size="14.00">Q[6]×K[11]×V[11]</text>
<text text-anchor="middle" x="5996" y="-17580.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_5_stage_11&#45;&gt;ring_attn_0_6_stage_11 -->
<g id="edge2184" class="edge">
<title>ring_attn_0_5_stage_11&#45;&gt;ring_attn_0_6_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-17607C5618.02,-17607 5776.86,-17607 5776.86,-17607"/>
<polygon fill="red" stroke="red" points="5776.86,-17610.5 5786.86,-17607 5776.86,-17603.5 5776.86,-17610.5"/>
</g>
<!-- ring_attn_0_5_stage_12&#45;&gt;ring_attn_0_5_stage_13 -->
<g id="edge501" class="edge">
<title>ring_attn_0_5_stage_12&#45;&gt;ring_attn_0_5_stage_13</title>
<path fill="none" stroke="black" d="M5409,-17285.87C5409,-17285.87 5409,-17179.25 5409,-17179.25"/>
<polygon fill="black" stroke="black" points="5412.5,-17179.25 5409,-17169.25 5405.5,-17179.25 5412.5,-17179.25"/>
</g>
<!-- ring_attn_0_6_stage_12 -->
<g id="node604" class="node">
<title>ring_attn_0_6_stage_12</title>
<polygon fill="yellow" stroke="black" points="5996,-17422 5787,-17354 5996,-17286 6205,-17354 5996,-17422"/>
<text text-anchor="middle" x="5996" y="-17372.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-17357.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="5996" y="-17342.8" font-family="Times,serif" font-size="14.00">Q[6]×K[10]×V[10]</text>
<text text-anchor="middle" x="5996" y="-17327.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_5_stage_12&#45;&gt;ring_attn_0_6_stage_12 -->
<g id="edge2185" class="edge">
<title>ring_attn_0_5_stage_12&#45;&gt;ring_attn_0_6_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-17354C5618.02,-17354 5776.86,-17354 5776.86,-17354"/>
<polygon fill="red" stroke="red" points="5776.86,-17357.5 5786.86,-17354 5776.86,-17350.5 5776.86,-17357.5"/>
</g>
<!-- ring_attn_0_5_stage_13&#45;&gt;ring_attn_0_5_stage_14 -->
<g id="edge502" class="edge">
<title>ring_attn_0_5_stage_13&#45;&gt;ring_attn_0_5_stage_14</title>
<path fill="none" stroke="black" d="M5409,-17032.87C5409,-17032.87 5409,-16926.25 5409,-16926.25"/>
<polygon fill="black" stroke="black" points="5412.5,-16926.25 5409,-16916.25 5405.5,-16926.25 5412.5,-16926.25"/>
</g>
<!-- ring_attn_0_6_stage_13 -->
<g id="node605" class="node">
<title>ring_attn_0_6_stage_13</title>
<polygon fill="yellow" stroke="black" points="5996,-17169 5787,-17101 5996,-17033 6205,-17101 5996,-17169"/>
<text text-anchor="middle" x="5996" y="-17119.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-17104.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="5996" y="-17089.8" font-family="Times,serif" font-size="14.00">Q[6]×K[9]×V[9]</text>
<text text-anchor="middle" x="5996" y="-17074.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_5_stage_13&#45;&gt;ring_attn_0_6_stage_13 -->
<g id="edge2186" class="edge">
<title>ring_attn_0_5_stage_13&#45;&gt;ring_attn_0_6_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-17101C5618.02,-17101 5776.86,-17101 5776.86,-17101"/>
<polygon fill="red" stroke="red" points="5776.86,-17104.5 5786.86,-17101 5776.86,-17097.5 5776.86,-17104.5"/>
</g>
<!-- ring_attn_0_5_stage_14&#45;&gt;ring_attn_0_5_stage_15 -->
<g id="edge503" class="edge">
<title>ring_attn_0_5_stage_14&#45;&gt;ring_attn_0_5_stage_15</title>
<path fill="none" stroke="black" d="M5409,-16779.87C5409,-16779.87 5409,-16673.25 5409,-16673.25"/>
<polygon fill="black" stroke="black" points="5412.5,-16673.25 5409,-16663.25 5405.5,-16673.25 5412.5,-16673.25"/>
</g>
<!-- ring_attn_0_6_stage_14 -->
<g id="node606" class="node">
<title>ring_attn_0_6_stage_14</title>
<polygon fill="yellow" stroke="black" points="5996,-16916 5787,-16848 5996,-16780 6205,-16848 5996,-16916"/>
<text text-anchor="middle" x="5996" y="-16866.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-16851.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="5996" y="-16836.8" font-family="Times,serif" font-size="14.00">Q[6]×K[8]×V[8]</text>
<text text-anchor="middle" x="5996" y="-16821.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_5_stage_14&#45;&gt;ring_attn_0_6_stage_14 -->
<g id="edge2187" class="edge">
<title>ring_attn_0_5_stage_14&#45;&gt;ring_attn_0_6_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-16848C5618.02,-16848 5776.86,-16848 5776.86,-16848"/>
<polygon fill="red" stroke="red" points="5776.86,-16851.5 5786.86,-16848 5776.86,-16844.5 5776.86,-16851.5"/>
</g>
<!-- attn_out_0_5 -->
<g id="node510" class="node">
<title>attn_out_0_5</title>
<polygon fill="none" stroke="black" points="5478.5,-16454 5339.5,-16454 5339.5,-16401 5478.5,-16401 5478.5,-16454"/>
<text text-anchor="middle" x="5409" y="-16438.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="5409" y="-16423.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="5409" y="-16408.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_0_5_stage_15&#45;&gt;attn_out_0_5 -->
<g id="edge504" class="edge">
<title>ring_attn_0_5_stage_15&#45;&gt;attn_out_0_5</title>
<path fill="none" stroke="black" d="M5409,-16526.87C5409,-16526.87 5409,-16464.18 5409,-16464.18"/>
<polygon fill="black" stroke="black" points="5412.5,-16464.18 5409,-16454.18 5405.5,-16464.18 5412.5,-16464.18"/>
</g>
<!-- ring_attn_0_6_stage_15 -->
<g id="node607" class="node">
<title>ring_attn_0_6_stage_15</title>
<polygon fill="yellow" stroke="black" points="5996,-16663 5787,-16595 5996,-16527 6205,-16595 5996,-16663"/>
<text text-anchor="middle" x="5996" y="-16613.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-16598.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="5996" y="-16583.8" font-family="Times,serif" font-size="14.00">Q[6]×K[7]×V[7]</text>
<text text-anchor="middle" x="5996" y="-16568.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_5_stage_15&#45;&gt;ring_attn_0_6_stage_15 -->
<g id="edge2188" class="edge">
<title>ring_attn_0_5_stage_15&#45;&gt;ring_attn_0_6_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-16595C5618.02,-16595 5776.86,-16595 5776.86,-16595"/>
<polygon fill="red" stroke="red" points="5776.86,-16598.5 5786.86,-16595 5776.86,-16591.5 5776.86,-16598.5"/>
</g>
<!-- attn_residual_0_5 -->
<g id="node511" class="node">
<title>attn_residual_0_5</title>
<ellipse fill="none" stroke="black" cx="5409" cy="-16301" rx="105.5" ry="27"/>
<text text-anchor="middle" x="5409" y="-16304.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="5409" y="-16289.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_0_5&#45;&gt;attn_residual_0_5 -->
<g id="edge505" class="edge">
<title>attn_out_0_5&#45;&gt;attn_residual_0_5</title>
<path fill="none" stroke="black" d="M5409,-16400.98C5409,-16400.98 5409,-16338.36 5409,-16338.36"/>
<polygon fill="black" stroke="black" points="5412.5,-16338.36 5409,-16328.36 5405.5,-16338.36 5412.5,-16338.36"/>
</g>
<!-- gate_0_5 -->
<g id="node512" class="node">
<title>gate_0_5</title>
<ellipse fill="orange" stroke="black" cx="5409" cy="-16163.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="5409" y="-16174.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="5409" y="-16159.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="5409" y="-16144.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_0_5&#45;&gt;gate_0_5 -->
<g id="edge506" class="edge">
<title>attn_residual_0_5&#45;&gt;gate_0_5</title>
<path fill="none" stroke="black" d="M5356.25,-16277.36C5356.25,-16277.36 5356.25,-16206.08 5356.25,-16206.08"/>
<polygon fill="black" stroke="black" points="5359.75,-16206.08 5356.25,-16196.08 5352.75,-16206.08 5359.75,-16206.08"/>
</g>
<!-- gate_0_5&#45;&gt;expert_0_0_0 -->
<g id="edge2189" class="edge">
<title>gate_0_5&#45;&gt;expert_0_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5313.55,-16147.31C5313.55,-16127.91 5313.55,-16098 5313.55,-16098 5313.55,-16098 161.7,-16098 161.7,-16098 161.7,-16098 161.7,-16004.22 161.7,-16004.22"/>
<polygon fill="blue" stroke="blue" points="165.2,-16004.22 161.7,-15994.22 158.2,-16004.22 165.2,-16004.22"/>
<text text-anchor="middle" x="22046.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22046.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU5→GPU0</text>
<text text-anchor="middle" x="22046.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22046.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_5&#45;&gt;expert_0_1_0 -->
<g id="edge2190" class="edge">
<title>gate_0_5&#45;&gt;expert_0_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5333.64,-16137.21C5333.64,-16118.26 5333.64,-16096 5333.64,-16096 5333.64,-16096 2974.68,-16096 2974.68,-16096 2974.68,-16096 2974.68,-16004.13 2974.68,-16004.13"/>
<polygon fill="blue" stroke="blue" points="2978.18,-16004.13 2974.68,-15994.13 2971.18,-16004.13 2978.18,-16004.13"/>
<text text-anchor="middle" x="22220.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22220.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU5→GPU1</text>
<text text-anchor="middle" x="22220.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22220.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_5&#45;&gt;expert_0_2_0 -->
<g id="edge2191" class="edge">
<title>gate_0_5&#45;&gt;expert_0_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5353.74,-16131.52C5353.74,-16116.14 5353.74,-16101 5353.74,-16101 5353.74,-16101 3573.76,-16101 3573.76,-16101 3573.76,-16101 3573.76,-16004.19 3573.76,-16004.19"/>
<polygon fill="blue" stroke="blue" points="3577.26,-16004.19 3573.76,-15994.19 3570.26,-16004.19 3577.26,-16004.19"/>
<text text-anchor="middle" x="22394.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22394.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU5→GPU2</text>
<text text-anchor="middle" x="22394.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22394.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_5&#45;&gt;expert_0_3_0 -->
<g id="edge2192" class="edge">
<title>gate_0_5&#45;&gt;expert_0_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5363.79,-16129.23C5363.79,-16123.83 5363.79,-16120 5363.79,-16120 5363.79,-16120 4349.5,-16120 4349.5,-16120 4349.5,-16120 4349.5,-16004.06 4349.5,-16004.06"/>
<polygon fill="blue" stroke="blue" points="4353,-16004.06 4349.5,-15994.06 4346,-16004.06 4353,-16004.06"/>
<text text-anchor="middle" x="22568.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22568.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU5→GPU3</text>
<text text-anchor="middle" x="22568.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22568.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_5&#45;&gt;expert_0_4_0 -->
<g id="edge2193" class="edge">
<title>gate_0_5&#45;&gt;expert_0_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5309.3,-16176C5169.46,-16176 4932,-16176 4932,-16176 4932,-16176 4932,-16004.33 4932,-16004.33"/>
<polygon fill="blue" stroke="blue" points="4935.5,-16004.33 4932,-15994.33 4928.5,-16004.33 4935.5,-16004.33"/>
<text text-anchor="middle" x="22742.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22742.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU5→GPU4</text>
<text text-anchor="middle" x="22742.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22742.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_5&#45;&gt;expert_0_5_0 -->
<g id="edge507" class="edge">
<title>gate_0_5&#45;&gt;expert_0_5_0</title>
<path fill="none" stroke="black" d="M5373.83,-16128.01C5373.83,-16128.01 5373.83,-16004.24 5373.83,-16004.24"/>
<polygon fill="black" stroke="black" points="5377.33,-16004.24 5373.83,-15994.24 5370.33,-16004.24 5377.33,-16004.24"/>
</g>
<!-- gate_0_5&#45;&gt;expert_0_6_0 -->
<g id="edge2194" class="edge">
<title>gate_0_5&#45;&gt;expert_0_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5508.52,-16151C5648.09,-16151 5885.1,-16151 5885.1,-16151 5885.1,-16151 5885.1,-16004.18 5885.1,-16004.18"/>
<polygon fill="blue" stroke="blue" points="5888.6,-16004.18 5885.1,-15994.18 5881.6,-16004.18 5888.6,-16004.18"/>
<text text-anchor="middle" x="22916.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22916.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU5→GPU6</text>
<text text-anchor="middle" x="22916.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22916.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_5&#45;&gt;expert_0_7_0 -->
<g id="edge2195" class="edge">
<title>gate_0_5&#45;&gt;expert_0_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5444.17,-16128.04C5444.17,-16116.69 5444.17,-16107 5444.17,-16107 5444.17,-16107 6470.75,-16107 6470.75,-16107 6470.75,-16107 6470.75,-16004.07 6470.75,-16004.07"/>
<polygon fill="blue" stroke="blue" points="6474.25,-16004.07 6470.75,-15994.07 6467.25,-16004.07 6474.25,-16004.07"/>
<text text-anchor="middle" x="23090.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23090.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU5→GPU7</text>
<text text-anchor="middle" x="23090.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23090.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_5&#45;&gt;expert_0_8_0 -->
<g id="edge2196" class="edge">
<title>gate_0_5&#45;&gt;expert_0_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5454.21,-16129.33C5454.21,-16110.14 5454.21,-16090 5454.21,-16090 5454.21,-16090 7054.38,-16090 7054.38,-16090 7054.38,-16090 7054.38,-16004.08 7054.38,-16004.08"/>
<polygon fill="blue" stroke="blue" points="7057.88,-16004.08 7054.38,-15994.08 7050.88,-16004.08 7057.88,-16004.08"/>
<text text-anchor="middle" x="23264.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23264.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU5→GPU8</text>
<text text-anchor="middle" x="23264.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23264.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_5&#45;&gt;expert_0_9_0 -->
<g id="edge2197" class="edge">
<title>gate_0_5&#45;&gt;expert_0_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5464.26,-16131.29C5464.26,-16108.51 5464.26,-16082 5464.26,-16082 5464.26,-16082 7737.82,-16082 7737.82,-16082 7737.82,-16082 7737.82,-16004.06 7737.82,-16004.06"/>
<polygon fill="blue" stroke="blue" points="7741.32,-16004.06 7737.82,-15994.06 7734.32,-16004.06 7741.32,-16004.06"/>
<text text-anchor="middle" x="23438.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23438.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU5→GPU9</text>
<text text-anchor="middle" x="23438.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23438.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_5&#45;&gt;expert_0_10_0 -->
<g id="edge2198" class="edge">
<title>gate_0_5&#45;&gt;expert_0_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5474.31,-16133.73C5474.31,-16108.71 5474.31,-16077 5474.31,-16077 5474.31,-16077 8318.88,-16077 8318.88,-16077 8318.88,-16077 8318.88,-16004.01 8318.88,-16004.01"/>
<polygon fill="blue" stroke="blue" points="8322.38,-16004.01 8318.88,-15994.01 8315.38,-16004.01 8322.38,-16004.01"/>
<text text-anchor="middle" x="23612.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23612.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU5→GPU10</text>
<text text-anchor="middle" x="23612.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23612.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_5&#45;&gt;expert_0_11_0 -->
<g id="edge2199" class="edge">
<title>gate_0_5&#45;&gt;expert_0_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5484.36,-16137.1C5484.36,-16100.55 5484.36,-16039 5484.36,-16039 5484.36,-16039 8905.88,-16039 8905.88,-16039 8905.88,-16039 8905.88,-16004.12 8905.88,-16004.12"/>
<polygon fill="blue" stroke="blue" points="8909.38,-16004.12 8905.88,-15994.12 8902.38,-16004.12 8909.38,-16004.12"/>
<text text-anchor="middle" x="23786.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23786.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU5→GPU11</text>
<text text-anchor="middle" x="23786.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23786.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_5&#45;&gt;expert_0_12_0 -->
<g id="edge2200" class="edge">
<title>gate_0_5&#45;&gt;expert_0_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5494.4,-16141.32C5494.4,-16103.6 5494.4,-16031 5494.4,-16031 5494.4,-16031 9504.24,-16031 9504.24,-16031 9504.24,-16031 9504.24,-16004.06 9504.24,-16004.06"/>
<polygon fill="blue" stroke="blue" points="9507.74,-16004.06 9504.24,-15994.06 9500.74,-16004.06 9507.74,-16004.06"/>
<text text-anchor="middle" x="23960.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23960.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU5→GPU12</text>
<text text-anchor="middle" x="23960.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23960.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_5&#45;&gt;expert_0_13_0 -->
<g id="edge2201" class="edge">
<title>gate_0_5&#45;&gt;expert_0_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5504.45,-16147.5C5504.45,-16110.86 5504.45,-16024 5504.45,-16024 5504.45,-16024 10100.78,-16024 10100.78,-16024 10100.78,-16024 10100.78,-16004.1 10100.78,-16004.1"/>
<polygon fill="blue" stroke="blue" points="10104.28,-16004.1 10100.78,-15994.1 10097.28,-16004.1 10104.28,-16004.1"/>
<text text-anchor="middle" x="24134.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="24134.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU5→GPU13</text>
<text text-anchor="middle" x="24134.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="24134.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_5&#45;&gt;expert_0_14_0 -->
<g id="edge2202" class="edge">
<title>gate_0_5&#45;&gt;expert_0_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5461.75,-16196.12C5461.75,-16206.34 5461.75,-16215 5461.75,-16215 5461.75,-16215 10583.8,-16215 10583.8,-16215 10583.8,-16215 10583.8,-16004.46 10583.8,-16004.46"/>
<polygon fill="blue" stroke="blue" points="10587.3,-16004.46 10583.8,-15994.46 10580.3,-16004.46 10587.3,-16004.46"/>
<text text-anchor="middle" x="24308.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="24308.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU5→GPU14</text>
<text text-anchor="middle" x="24308.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="24308.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_5&#45;&gt;expert_0_15_0 -->
<g id="edge2203" class="edge">
<title>gate_0_5&#45;&gt;expert_0_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5409,-16201.2C5409,-16216.66 5409,-16231 5409,-16231 5409,-16231 11171.81,-16231 11171.81,-16231 11171.81,-16231 11171.81,-16004.22 11171.81,-16004.22"/>
<polygon fill="blue" stroke="blue" points="11175.31,-16004.22 11171.81,-15994.22 11168.31,-16004.22 11175.31,-16004.22"/>
<text text-anchor="middle" x="24482.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="24482.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU5→GPU15</text>
<text text-anchor="middle" x="24482.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="24482.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_5 -->
<g id="node514" class="node">
<title>expert_reduce_0_5</title>
<ellipse fill="none" stroke="black" cx="5409" cy="-15830.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="5409" y="-15841.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="5409" y="-15826.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="5409" y="-15811.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_5_0&#45;&gt;expert_reduce_0_5 -->
<g id="edge508" class="edge">
<title>expert_0_5_0&#45;&gt;expert_reduce_0_5</title>
<path fill="none" stroke="black" d="M5409,-15940.76C5409,-15940.76 5409,-15878.06 5409,-15878.06"/>
<polygon fill="black" stroke="black" points="5412.5,-15878.06 5409,-15868.06 5405.5,-15878.06 5412.5,-15878.06"/>
</g>
<!-- moe_residual_0_5 -->
<g id="node515" class="node">
<title>moe_residual_0_5</title>
<ellipse fill="none" stroke="black" cx="5409" cy="-15693" rx="105.5" ry="27"/>
<text text-anchor="middle" x="5409" y="-15696.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="5409" y="-15681.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_5&#45;&gt;moe_residual_0_5 -->
<g id="edge509" class="edge">
<title>expert_reduce_0_5&#45;&gt;moe_residual_0_5</title>
<path fill="none" stroke="black" d="M5409,-15792.93C5409,-15792.93 5409,-15730.06 5409,-15730.06"/>
<polygon fill="black" stroke="black" points="5412.5,-15730.06 5409,-15720.06 5405.5,-15730.06 5412.5,-15730.06"/>
</g>
<!-- qkv_proj_1_5 -->
<g id="node516" class="node">
<title>qkv_proj_1_5</title>
<polygon fill="none" stroke="black" points="5491.5,-15593 5326.5,-15593 5326.5,-15540 5491.5,-15540 5491.5,-15593"/>
<text text-anchor="middle" x="5409" y="-15577.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5409" y="-15562.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="5409" y="-15547.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_0_5&#45;&gt;qkv_proj_1_5 -->
<g id="edge510" class="edge">
<title>moe_residual_0_5&#45;&gt;qkv_proj_1_5</title>
<path fill="none" stroke="black" d="M5409,-15665.86C5409,-15665.86 5409,-15603.16 5409,-15603.16"/>
<polygon fill="black" stroke="black" points="5412.5,-15603.16 5409,-15593.16 5405.5,-15603.16 5412.5,-15603.16"/>
</g>
<!-- qkv_reshape_1_5 -->
<g id="node517" class="node">
<title>qkv_reshape_1_5</title>
<ellipse fill="none" stroke="black" cx="5409" cy="-15440" rx="148" ry="27"/>
<text text-anchor="middle" x="5409" y="-15443.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="5409" y="-15428.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_1_5&#45;&gt;qkv_reshape_1_5 -->
<g id="edge511" class="edge">
<title>qkv_proj_1_5&#45;&gt;qkv_reshape_1_5</title>
<path fill="none" stroke="black" d="M5409,-15539.98C5409,-15539.98 5409,-15477.36 5409,-15477.36"/>
<polygon fill="black" stroke="black" points="5412.5,-15477.36 5409,-15467.36 5405.5,-15477.36 5412.5,-15477.36"/>
</g>
<!-- qkv_reshape_1_5&#45;&gt;ring_attn_1_5_stage_0 -->
<g id="edge512" class="edge">
<title>qkv_reshape_1_5&#45;&gt;ring_attn_1_5_stage_0</title>
<path fill="none" stroke="black" d="M5409,-15412.72C5409,-15412.72 5409,-15306.16 5409,-15306.16"/>
<polygon fill="black" stroke="black" points="5412.5,-15306.16 5409,-15296.16 5405.5,-15306.16 5412.5,-15306.16"/>
</g>
<!-- ring_attn_1_5_stage_0&#45;&gt;ring_attn_1_5_stage_1 -->
<g id="edge513" class="edge">
<title>ring_attn_1_5_stage_0&#45;&gt;ring_attn_1_5_stage_1</title>
<path fill="none" stroke="black" d="M5409,-15159.87C5409,-15159.87 5409,-15053.25 5409,-15053.25"/>
<polygon fill="black" stroke="black" points="5412.5,-15053.25 5409,-15043.25 5405.5,-15053.25 5412.5,-15053.25"/>
</g>
<!-- ring_attn_1_6_stage_0 -->
<g id="node616" class="node">
<title>ring_attn_1_6_stage_0</title>
<polygon fill="yellow" stroke="black" points="5996,-15296 5787,-15228 5996,-15160 6205,-15228 5996,-15296"/>
<text text-anchor="middle" x="5996" y="-15246.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-15231.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="5996" y="-15216.8" font-family="Times,serif" font-size="14.00">Q[6]×K[6]×V[6]</text>
<text text-anchor="middle" x="5996" y="-15201.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_5_stage_0&#45;&gt;ring_attn_1_6_stage_0 -->
<g id="edge2204" class="edge">
<title>ring_attn_1_5_stage_0&#45;&gt;ring_attn_1_6_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-15228C5618.02,-15228 5776.86,-15228 5776.86,-15228"/>
<polygon fill="red" stroke="red" points="5776.86,-15231.5 5786.86,-15228 5776.86,-15224.5 5776.86,-15231.5"/>
</g>
<!-- ring_attn_1_5_stage_1&#45;&gt;ring_attn_1_5_stage_2 -->
<g id="edge514" class="edge">
<title>ring_attn_1_5_stage_1&#45;&gt;ring_attn_1_5_stage_2</title>
<path fill="none" stroke="black" d="M5409,-14906.87C5409,-14906.87 5409,-14800.25 5409,-14800.25"/>
<polygon fill="black" stroke="black" points="5412.5,-14800.25 5409,-14790.25 5405.5,-14800.25 5412.5,-14800.25"/>
</g>
<!-- ring_attn_1_6_stage_1 -->
<g id="node617" class="node">
<title>ring_attn_1_6_stage_1</title>
<polygon fill="yellow" stroke="black" points="5996,-15043 5787,-14975 5996,-14907 6205,-14975 5996,-15043"/>
<text text-anchor="middle" x="5996" y="-14993.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-14978.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="5996" y="-14963.8" font-family="Times,serif" font-size="14.00">Q[6]×K[5]×V[5]</text>
<text text-anchor="middle" x="5996" y="-14948.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_5_stage_1&#45;&gt;ring_attn_1_6_stage_1 -->
<g id="edge2205" class="edge">
<title>ring_attn_1_5_stage_1&#45;&gt;ring_attn_1_6_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-14975C5618.02,-14975 5776.86,-14975 5776.86,-14975"/>
<polygon fill="red" stroke="red" points="5776.86,-14978.5 5786.86,-14975 5776.86,-14971.5 5776.86,-14978.5"/>
</g>
<!-- ring_attn_1_5_stage_2&#45;&gt;ring_attn_1_5_stage_3 -->
<g id="edge515" class="edge">
<title>ring_attn_1_5_stage_2&#45;&gt;ring_attn_1_5_stage_3</title>
<path fill="none" stroke="black" d="M5409,-14653.87C5409,-14653.87 5409,-14547.25 5409,-14547.25"/>
<polygon fill="black" stroke="black" points="5412.5,-14547.25 5409,-14537.25 5405.5,-14547.25 5412.5,-14547.25"/>
</g>
<!-- ring_attn_1_6_stage_2 -->
<g id="node618" class="node">
<title>ring_attn_1_6_stage_2</title>
<polygon fill="yellow" stroke="black" points="5996,-14790 5787,-14722 5996,-14654 6205,-14722 5996,-14790"/>
<text text-anchor="middle" x="5996" y="-14740.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-14725.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="5996" y="-14710.8" font-family="Times,serif" font-size="14.00">Q[6]×K[4]×V[4]</text>
<text text-anchor="middle" x="5996" y="-14695.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_5_stage_2&#45;&gt;ring_attn_1_6_stage_2 -->
<g id="edge2206" class="edge">
<title>ring_attn_1_5_stage_2&#45;&gt;ring_attn_1_6_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-14722C5618.02,-14722 5776.86,-14722 5776.86,-14722"/>
<polygon fill="red" stroke="red" points="5776.86,-14725.5 5786.86,-14722 5776.86,-14718.5 5776.86,-14725.5"/>
</g>
<!-- ring_attn_1_5_stage_3&#45;&gt;ring_attn_1_5_stage_4 -->
<g id="edge516" class="edge">
<title>ring_attn_1_5_stage_3&#45;&gt;ring_attn_1_5_stage_4</title>
<path fill="none" stroke="black" d="M5409,-14400.87C5409,-14400.87 5409,-14294.25 5409,-14294.25"/>
<polygon fill="black" stroke="black" points="5412.5,-14294.25 5409,-14284.25 5405.5,-14294.25 5412.5,-14294.25"/>
</g>
<!-- ring_attn_1_6_stage_3 -->
<g id="node619" class="node">
<title>ring_attn_1_6_stage_3</title>
<polygon fill="yellow" stroke="black" points="5996,-14537 5787,-14469 5996,-14401 6205,-14469 5996,-14537"/>
<text text-anchor="middle" x="5996" y="-14487.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-14472.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="5996" y="-14457.8" font-family="Times,serif" font-size="14.00">Q[6]×K[3]×V[3]</text>
<text text-anchor="middle" x="5996" y="-14442.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_5_stage_3&#45;&gt;ring_attn_1_6_stage_3 -->
<g id="edge2207" class="edge">
<title>ring_attn_1_5_stage_3&#45;&gt;ring_attn_1_6_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-14469C5618.02,-14469 5776.86,-14469 5776.86,-14469"/>
<polygon fill="red" stroke="red" points="5776.86,-14472.5 5786.86,-14469 5776.86,-14465.5 5776.86,-14472.5"/>
</g>
<!-- ring_attn_1_5_stage_4&#45;&gt;ring_attn_1_5_stage_5 -->
<g id="edge517" class="edge">
<title>ring_attn_1_5_stage_4&#45;&gt;ring_attn_1_5_stage_5</title>
<path fill="none" stroke="black" d="M5409,-14147.87C5409,-14147.87 5409,-14041.25 5409,-14041.25"/>
<polygon fill="black" stroke="black" points="5412.5,-14041.25 5409,-14031.25 5405.5,-14041.25 5412.5,-14041.25"/>
</g>
<!-- ring_attn_1_6_stage_4 -->
<g id="node620" class="node">
<title>ring_attn_1_6_stage_4</title>
<polygon fill="yellow" stroke="black" points="5996,-14284 5787,-14216 5996,-14148 6205,-14216 5996,-14284"/>
<text text-anchor="middle" x="5996" y="-14234.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-14219.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="5996" y="-14204.8" font-family="Times,serif" font-size="14.00">Q[6]×K[2]×V[2]</text>
<text text-anchor="middle" x="5996" y="-14189.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_5_stage_4&#45;&gt;ring_attn_1_6_stage_4 -->
<g id="edge2208" class="edge">
<title>ring_attn_1_5_stage_4&#45;&gt;ring_attn_1_6_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-14216C5618.02,-14216 5776.86,-14216 5776.86,-14216"/>
<polygon fill="red" stroke="red" points="5776.86,-14219.5 5786.86,-14216 5776.86,-14212.5 5776.86,-14219.5"/>
</g>
<!-- ring_attn_1_5_stage_5&#45;&gt;ring_attn_1_5_stage_6 -->
<g id="edge518" class="edge">
<title>ring_attn_1_5_stage_5&#45;&gt;ring_attn_1_5_stage_6</title>
<path fill="none" stroke="black" d="M5409,-13894.87C5409,-13894.87 5409,-13788.25 5409,-13788.25"/>
<polygon fill="black" stroke="black" points="5412.5,-13788.25 5409,-13778.25 5405.5,-13788.25 5412.5,-13788.25"/>
</g>
<!-- ring_attn_1_6_stage_5 -->
<g id="node621" class="node">
<title>ring_attn_1_6_stage_5</title>
<polygon fill="yellow" stroke="black" points="5996,-14031 5787,-13963 5996,-13895 6205,-13963 5996,-14031"/>
<text text-anchor="middle" x="5996" y="-13981.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-13966.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="5996" y="-13951.8" font-family="Times,serif" font-size="14.00">Q[6]×K[1]×V[1]</text>
<text text-anchor="middle" x="5996" y="-13936.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_5_stage_5&#45;&gt;ring_attn_1_6_stage_5 -->
<g id="edge2209" class="edge">
<title>ring_attn_1_5_stage_5&#45;&gt;ring_attn_1_6_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-13963C5618.02,-13963 5776.86,-13963 5776.86,-13963"/>
<polygon fill="red" stroke="red" points="5776.86,-13966.5 5786.86,-13963 5776.86,-13959.5 5776.86,-13966.5"/>
</g>
<!-- ring_attn_1_5_stage_6&#45;&gt;ring_attn_1_5_stage_7 -->
<g id="edge519" class="edge">
<title>ring_attn_1_5_stage_6&#45;&gt;ring_attn_1_5_stage_7</title>
<path fill="none" stroke="black" d="M5409,-13641.87C5409,-13641.87 5409,-13535.25 5409,-13535.25"/>
<polygon fill="black" stroke="black" points="5412.5,-13535.25 5409,-13525.25 5405.5,-13535.25 5412.5,-13535.25"/>
</g>
<!-- ring_attn_1_6_stage_6 -->
<g id="node622" class="node">
<title>ring_attn_1_6_stage_6</title>
<polygon fill="yellow" stroke="black" points="5996,-13778 5787,-13710 5996,-13642 6205,-13710 5996,-13778"/>
<text text-anchor="middle" x="5996" y="-13728.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-13713.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="5996" y="-13698.8" font-family="Times,serif" font-size="14.00">Q[6]×K[0]×V[0]</text>
<text text-anchor="middle" x="5996" y="-13683.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_5_stage_6&#45;&gt;ring_attn_1_6_stage_6 -->
<g id="edge2210" class="edge">
<title>ring_attn_1_5_stage_6&#45;&gt;ring_attn_1_6_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-13710C5618.02,-13710 5776.86,-13710 5776.86,-13710"/>
<polygon fill="red" stroke="red" points="5776.86,-13713.5 5786.86,-13710 5776.86,-13706.5 5776.86,-13713.5"/>
</g>
<!-- ring_attn_1_5_stage_7&#45;&gt;ring_attn_1_5_stage_8 -->
<g id="edge520" class="edge">
<title>ring_attn_1_5_stage_7&#45;&gt;ring_attn_1_5_stage_8</title>
<path fill="none" stroke="black" d="M5409,-13388.87C5409,-13388.87 5409,-13282.25 5409,-13282.25"/>
<polygon fill="black" stroke="black" points="5412.5,-13282.25 5409,-13272.25 5405.5,-13282.25 5412.5,-13282.25"/>
</g>
<!-- ring_attn_1_6_stage_7 -->
<g id="node623" class="node">
<title>ring_attn_1_6_stage_7</title>
<polygon fill="yellow" stroke="black" points="5996,-13525 5787,-13457 5996,-13389 6205,-13457 5996,-13525"/>
<text text-anchor="middle" x="5996" y="-13475.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-13460.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="5996" y="-13445.8" font-family="Times,serif" font-size="14.00">Q[6]×K[15]×V[15]</text>
<text text-anchor="middle" x="5996" y="-13430.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_5_stage_7&#45;&gt;ring_attn_1_6_stage_7 -->
<g id="edge2211" class="edge">
<title>ring_attn_1_5_stage_7&#45;&gt;ring_attn_1_6_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-13457C5618.02,-13457 5776.86,-13457 5776.86,-13457"/>
<polygon fill="red" stroke="red" points="5776.86,-13460.5 5786.86,-13457 5776.86,-13453.5 5776.86,-13460.5"/>
</g>
<!-- ring_attn_1_5_stage_8&#45;&gt;ring_attn_1_5_stage_9 -->
<g id="edge521" class="edge">
<title>ring_attn_1_5_stage_8&#45;&gt;ring_attn_1_5_stage_9</title>
<path fill="none" stroke="black" d="M5409,-13135.87C5409,-13135.87 5409,-13029.25 5409,-13029.25"/>
<polygon fill="black" stroke="black" points="5412.5,-13029.25 5409,-13019.25 5405.5,-13029.25 5412.5,-13029.25"/>
</g>
<!-- ring_attn_1_6_stage_8 -->
<g id="node624" class="node">
<title>ring_attn_1_6_stage_8</title>
<polygon fill="yellow" stroke="black" points="5996,-13272 5787,-13204 5996,-13136 6205,-13204 5996,-13272"/>
<text text-anchor="middle" x="5996" y="-13222.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-13207.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="5996" y="-13192.8" font-family="Times,serif" font-size="14.00">Q[6]×K[14]×V[14]</text>
<text text-anchor="middle" x="5996" y="-13177.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_5_stage_8&#45;&gt;ring_attn_1_6_stage_8 -->
<g id="edge2212" class="edge">
<title>ring_attn_1_5_stage_8&#45;&gt;ring_attn_1_6_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-13204C5618.02,-13204 5776.86,-13204 5776.86,-13204"/>
<polygon fill="red" stroke="red" points="5776.86,-13207.5 5786.86,-13204 5776.86,-13200.5 5776.86,-13207.5"/>
</g>
<!-- ring_attn_1_5_stage_9&#45;&gt;ring_attn_1_5_stage_10 -->
<g id="edge522" class="edge">
<title>ring_attn_1_5_stage_9&#45;&gt;ring_attn_1_5_stage_10</title>
<path fill="none" stroke="black" d="M5409,-12882.87C5409,-12882.87 5409,-12776.25 5409,-12776.25"/>
<polygon fill="black" stroke="black" points="5412.5,-12776.25 5409,-12766.25 5405.5,-12776.25 5412.5,-12776.25"/>
</g>
<!-- ring_attn_1_6_stage_9 -->
<g id="node625" class="node">
<title>ring_attn_1_6_stage_9</title>
<polygon fill="yellow" stroke="black" points="5996,-13019 5787,-12951 5996,-12883 6205,-12951 5996,-13019"/>
<text text-anchor="middle" x="5996" y="-12969.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-12954.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="5996" y="-12939.8" font-family="Times,serif" font-size="14.00">Q[6]×K[13]×V[13]</text>
<text text-anchor="middle" x="5996" y="-12924.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_5_stage_9&#45;&gt;ring_attn_1_6_stage_9 -->
<g id="edge2213" class="edge">
<title>ring_attn_1_5_stage_9&#45;&gt;ring_attn_1_6_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-12951C5618.02,-12951 5776.86,-12951 5776.86,-12951"/>
<polygon fill="red" stroke="red" points="5776.86,-12954.5 5786.86,-12951 5776.86,-12947.5 5776.86,-12954.5"/>
</g>
<!-- ring_attn_1_5_stage_10&#45;&gt;ring_attn_1_5_stage_11 -->
<g id="edge523" class="edge">
<title>ring_attn_1_5_stage_10&#45;&gt;ring_attn_1_5_stage_11</title>
<path fill="none" stroke="black" d="M5409,-12629.87C5409,-12629.87 5409,-12523.25 5409,-12523.25"/>
<polygon fill="black" stroke="black" points="5412.5,-12523.25 5409,-12513.25 5405.5,-12523.25 5412.5,-12523.25"/>
</g>
<!-- ring_attn_1_6_stage_10 -->
<g id="node626" class="node">
<title>ring_attn_1_6_stage_10</title>
<polygon fill="yellow" stroke="black" points="5996,-12766 5787,-12698 5996,-12630 6205,-12698 5996,-12766"/>
<text text-anchor="middle" x="5996" y="-12716.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-12701.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="5996" y="-12686.8" font-family="Times,serif" font-size="14.00">Q[6]×K[12]×V[12]</text>
<text text-anchor="middle" x="5996" y="-12671.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_5_stage_10&#45;&gt;ring_attn_1_6_stage_10 -->
<g id="edge2214" class="edge">
<title>ring_attn_1_5_stage_10&#45;&gt;ring_attn_1_6_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-12698C5618.02,-12698 5776.86,-12698 5776.86,-12698"/>
<polygon fill="red" stroke="red" points="5776.86,-12701.5 5786.86,-12698 5776.86,-12694.5 5776.86,-12701.5"/>
</g>
<!-- ring_attn_1_5_stage_11&#45;&gt;ring_attn_1_5_stage_12 -->
<g id="edge524" class="edge">
<title>ring_attn_1_5_stage_11&#45;&gt;ring_attn_1_5_stage_12</title>
<path fill="none" stroke="black" d="M5409,-12376.87C5409,-12376.87 5409,-12270.25 5409,-12270.25"/>
<polygon fill="black" stroke="black" points="5412.5,-12270.25 5409,-12260.25 5405.5,-12270.25 5412.5,-12270.25"/>
</g>
<!-- ring_attn_1_6_stage_11 -->
<g id="node627" class="node">
<title>ring_attn_1_6_stage_11</title>
<polygon fill="yellow" stroke="black" points="5996,-12513 5787,-12445 5996,-12377 6205,-12445 5996,-12513"/>
<text text-anchor="middle" x="5996" y="-12463.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-12448.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="5996" y="-12433.8" font-family="Times,serif" font-size="14.00">Q[6]×K[11]×V[11]</text>
<text text-anchor="middle" x="5996" y="-12418.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_5_stage_11&#45;&gt;ring_attn_1_6_stage_11 -->
<g id="edge2215" class="edge">
<title>ring_attn_1_5_stage_11&#45;&gt;ring_attn_1_6_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-12445C5618.02,-12445 5776.86,-12445 5776.86,-12445"/>
<polygon fill="red" stroke="red" points="5776.86,-12448.5 5786.86,-12445 5776.86,-12441.5 5776.86,-12448.5"/>
</g>
<!-- ring_attn_1_5_stage_12&#45;&gt;ring_attn_1_5_stage_13 -->
<g id="edge525" class="edge">
<title>ring_attn_1_5_stage_12&#45;&gt;ring_attn_1_5_stage_13</title>
<path fill="none" stroke="black" d="M5409,-12123.87C5409,-12123.87 5409,-12017.25 5409,-12017.25"/>
<polygon fill="black" stroke="black" points="5412.5,-12017.25 5409,-12007.25 5405.5,-12017.25 5412.5,-12017.25"/>
</g>
<!-- ring_attn_1_6_stage_12 -->
<g id="node628" class="node">
<title>ring_attn_1_6_stage_12</title>
<polygon fill="yellow" stroke="black" points="5996,-12260 5787,-12192 5996,-12124 6205,-12192 5996,-12260"/>
<text text-anchor="middle" x="5996" y="-12210.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-12195.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="5996" y="-12180.8" font-family="Times,serif" font-size="14.00">Q[6]×K[10]×V[10]</text>
<text text-anchor="middle" x="5996" y="-12165.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_5_stage_12&#45;&gt;ring_attn_1_6_stage_12 -->
<g id="edge2216" class="edge">
<title>ring_attn_1_5_stage_12&#45;&gt;ring_attn_1_6_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-12192C5618.02,-12192 5776.86,-12192 5776.86,-12192"/>
<polygon fill="red" stroke="red" points="5776.86,-12195.5 5786.86,-12192 5776.86,-12188.5 5776.86,-12195.5"/>
</g>
<!-- ring_attn_1_5_stage_13&#45;&gt;ring_attn_1_5_stage_14 -->
<g id="edge526" class="edge">
<title>ring_attn_1_5_stage_13&#45;&gt;ring_attn_1_5_stage_14</title>
<path fill="none" stroke="black" d="M5409,-11870.87C5409,-11870.87 5409,-11764.25 5409,-11764.25"/>
<polygon fill="black" stroke="black" points="5412.5,-11764.25 5409,-11754.25 5405.5,-11764.25 5412.5,-11764.25"/>
</g>
<!-- ring_attn_1_6_stage_13 -->
<g id="node629" class="node">
<title>ring_attn_1_6_stage_13</title>
<polygon fill="yellow" stroke="black" points="5996,-12007 5787,-11939 5996,-11871 6205,-11939 5996,-12007"/>
<text text-anchor="middle" x="5996" y="-11957.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-11942.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="5996" y="-11927.8" font-family="Times,serif" font-size="14.00">Q[6]×K[9]×V[9]</text>
<text text-anchor="middle" x="5996" y="-11912.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_5_stage_13&#45;&gt;ring_attn_1_6_stage_13 -->
<g id="edge2217" class="edge">
<title>ring_attn_1_5_stage_13&#45;&gt;ring_attn_1_6_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-11939C5618.02,-11939 5776.86,-11939 5776.86,-11939"/>
<polygon fill="red" stroke="red" points="5776.86,-11942.5 5786.86,-11939 5776.86,-11935.5 5776.86,-11942.5"/>
</g>
<!-- ring_attn_1_5_stage_14&#45;&gt;ring_attn_1_5_stage_15 -->
<g id="edge527" class="edge">
<title>ring_attn_1_5_stage_14&#45;&gt;ring_attn_1_5_stage_15</title>
<path fill="none" stroke="black" d="M5409,-11617.87C5409,-11617.87 5409,-11511.25 5409,-11511.25"/>
<polygon fill="black" stroke="black" points="5412.5,-11511.25 5409,-11501.25 5405.5,-11511.25 5412.5,-11511.25"/>
</g>
<!-- ring_attn_1_6_stage_14 -->
<g id="node630" class="node">
<title>ring_attn_1_6_stage_14</title>
<polygon fill="yellow" stroke="black" points="5996,-11754 5787,-11686 5996,-11618 6205,-11686 5996,-11754"/>
<text text-anchor="middle" x="5996" y="-11704.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-11689.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="5996" y="-11674.8" font-family="Times,serif" font-size="14.00">Q[6]×K[8]×V[8]</text>
<text text-anchor="middle" x="5996" y="-11659.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_5_stage_14&#45;&gt;ring_attn_1_6_stage_14 -->
<g id="edge2218" class="edge">
<title>ring_attn_1_5_stage_14&#45;&gt;ring_attn_1_6_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-11686C5618.02,-11686 5776.86,-11686 5776.86,-11686"/>
<polygon fill="red" stroke="red" points="5776.86,-11689.5 5786.86,-11686 5776.86,-11682.5 5776.86,-11689.5"/>
</g>
<!-- attn_out_1_5 -->
<g id="node534" class="node">
<title>attn_out_1_5</title>
<polygon fill="none" stroke="black" points="5478.5,-11292 5339.5,-11292 5339.5,-11239 5478.5,-11239 5478.5,-11292"/>
<text text-anchor="middle" x="5409" y="-11276.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="5409" y="-11261.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="5409" y="-11246.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_1_5_stage_15&#45;&gt;attn_out_1_5 -->
<g id="edge528" class="edge">
<title>ring_attn_1_5_stage_15&#45;&gt;attn_out_1_5</title>
<path fill="none" stroke="black" d="M5409,-11364.87C5409,-11364.87 5409,-11302.18 5409,-11302.18"/>
<polygon fill="black" stroke="black" points="5412.5,-11302.18 5409,-11292.18 5405.5,-11302.18 5412.5,-11302.18"/>
</g>
<!-- ring_attn_1_6_stage_15 -->
<g id="node631" class="node">
<title>ring_attn_1_6_stage_15</title>
<polygon fill="yellow" stroke="black" points="5996,-11501 5787,-11433 5996,-11365 6205,-11433 5996,-11501"/>
<text text-anchor="middle" x="5996" y="-11451.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-11436.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="5996" y="-11421.8" font-family="Times,serif" font-size="14.00">Q[6]×K[7]×V[7]</text>
<text text-anchor="middle" x="5996" y="-11406.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_5_stage_15&#45;&gt;ring_attn_1_6_stage_15 -->
<g id="edge2219" class="edge">
<title>ring_attn_1_5_stage_15&#45;&gt;ring_attn_1_6_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-11433C5618.02,-11433 5776.86,-11433 5776.86,-11433"/>
<polygon fill="red" stroke="red" points="5776.86,-11436.5 5786.86,-11433 5776.86,-11429.5 5776.86,-11436.5"/>
</g>
<!-- attn_residual_1_5 -->
<g id="node535" class="node">
<title>attn_residual_1_5</title>
<ellipse fill="none" stroke="black" cx="5409" cy="-11139" rx="105.5" ry="27"/>
<text text-anchor="middle" x="5409" y="-11142.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="5409" y="-11127.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_1_5&#45;&gt;attn_residual_1_5 -->
<g id="edge529" class="edge">
<title>attn_out_1_5&#45;&gt;attn_residual_1_5</title>
<path fill="none" stroke="black" d="M5409,-11238.98C5409,-11238.98 5409,-11176.36 5409,-11176.36"/>
<polygon fill="black" stroke="black" points="5412.5,-11176.36 5409,-11166.36 5405.5,-11176.36 5412.5,-11176.36"/>
</g>
<!-- gate_1_5 -->
<g id="node536" class="node">
<title>gate_1_5</title>
<ellipse fill="orange" stroke="black" cx="5409" cy="-11001.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="5409" y="-11012.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="5409" y="-10997.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="5409" y="-10982.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_1_5&#45;&gt;gate_1_5 -->
<g id="edge530" class="edge">
<title>attn_residual_1_5&#45;&gt;gate_1_5</title>
<path fill="none" stroke="black" d="M5356.25,-11115.36C5356.25,-11115.36 5356.25,-11044.08 5356.25,-11044.08"/>
<polygon fill="black" stroke="black" points="5359.75,-11044.08 5356.25,-11034.08 5352.75,-11044.08 5359.75,-11044.08"/>
</g>
<!-- gate_1_5&#45;&gt;expert_1_0_0 -->
<g id="edge2220" class="edge">
<title>gate_1_5&#45;&gt;expert_1_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5313.55,-10985.31C5313.55,-10965.91 5313.55,-10936 5313.55,-10936 5313.55,-10936 161.7,-10936 161.7,-10936 161.7,-10936 161.7,-10842.22 161.7,-10842.22"/>
<polygon fill="blue" stroke="blue" points="165.2,-10842.22 161.7,-10832.22 158.2,-10842.22 165.2,-10842.22"/>
<text text-anchor="middle" x="22046.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22046.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU5→GPU0</text>
<text text-anchor="middle" x="22046.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22046.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_5&#45;&gt;expert_1_1_0 -->
<g id="edge2221" class="edge">
<title>gate_1_5&#45;&gt;expert_1_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5333.64,-10975.21C5333.64,-10956.26 5333.64,-10934 5333.64,-10934 5333.64,-10934 2974.68,-10934 2974.68,-10934 2974.68,-10934 2974.68,-10842.13 2974.68,-10842.13"/>
<polygon fill="blue" stroke="blue" points="2978.18,-10842.13 2974.68,-10832.13 2971.18,-10842.13 2978.18,-10842.13"/>
<text text-anchor="middle" x="22220.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22220.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU5→GPU1</text>
<text text-anchor="middle" x="22220.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22220.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_5&#45;&gt;expert_1_2_0 -->
<g id="edge2222" class="edge">
<title>gate_1_5&#45;&gt;expert_1_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5353.74,-10969.52C5353.74,-10954.14 5353.74,-10939 5353.74,-10939 5353.74,-10939 3573.76,-10939 3573.76,-10939 3573.76,-10939 3573.76,-10842.19 3573.76,-10842.19"/>
<polygon fill="blue" stroke="blue" points="3577.26,-10842.19 3573.76,-10832.19 3570.26,-10842.19 3577.26,-10842.19"/>
<text text-anchor="middle" x="22394.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22394.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU5→GPU2</text>
<text text-anchor="middle" x="22394.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22394.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_5&#45;&gt;expert_1_3_0 -->
<g id="edge2223" class="edge">
<title>gate_1_5&#45;&gt;expert_1_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5363.79,-10967.23C5363.79,-10961.83 5363.79,-10958 5363.79,-10958 5363.79,-10958 4349.5,-10958 4349.5,-10958 4349.5,-10958 4349.5,-10842.06 4349.5,-10842.06"/>
<polygon fill="blue" stroke="blue" points="4353,-10842.06 4349.5,-10832.06 4346,-10842.06 4353,-10842.06"/>
<text text-anchor="middle" x="22568.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22568.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU5→GPU3</text>
<text text-anchor="middle" x="22568.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22568.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_5&#45;&gt;expert_1_4_0 -->
<g id="edge2224" class="edge">
<title>gate_1_5&#45;&gt;expert_1_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5309.3,-11014C5169.46,-11014 4932,-11014 4932,-11014 4932,-11014 4932,-10842.33 4932,-10842.33"/>
<polygon fill="blue" stroke="blue" points="4935.5,-10842.33 4932,-10832.33 4928.5,-10842.33 4935.5,-10842.33"/>
<text text-anchor="middle" x="22742.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22742.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU5→GPU4</text>
<text text-anchor="middle" x="22742.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22742.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_5&#45;&gt;expert_1_5_0 -->
<g id="edge531" class="edge">
<title>gate_1_5&#45;&gt;expert_1_5_0</title>
<path fill="none" stroke="black" d="M5373.83,-10966.01C5373.83,-10966.01 5373.83,-10842.24 5373.83,-10842.24"/>
<polygon fill="black" stroke="black" points="5377.33,-10842.24 5373.83,-10832.24 5370.33,-10842.24 5377.33,-10842.24"/>
</g>
<!-- gate_1_5&#45;&gt;expert_1_6_0 -->
<g id="edge2225" class="edge">
<title>gate_1_5&#45;&gt;expert_1_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5508.52,-10989C5648.09,-10989 5885.1,-10989 5885.1,-10989 5885.1,-10989 5885.1,-10842.18 5885.1,-10842.18"/>
<polygon fill="blue" stroke="blue" points="5888.6,-10842.18 5885.1,-10832.18 5881.6,-10842.18 5888.6,-10842.18"/>
<text text-anchor="middle" x="22916.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22916.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU5→GPU6</text>
<text text-anchor="middle" x="22916.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22916.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_5&#45;&gt;expert_1_7_0 -->
<g id="edge2226" class="edge">
<title>gate_1_5&#45;&gt;expert_1_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5444.17,-10966.04C5444.17,-10954.69 5444.17,-10945 5444.17,-10945 5444.17,-10945 6470.75,-10945 6470.75,-10945 6470.75,-10945 6470.75,-10842.07 6470.75,-10842.07"/>
<polygon fill="blue" stroke="blue" points="6474.25,-10842.07 6470.75,-10832.07 6467.25,-10842.07 6474.25,-10842.07"/>
<text text-anchor="middle" x="23090.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23090.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU5→GPU7</text>
<text text-anchor="middle" x="23090.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23090.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_5&#45;&gt;expert_1_8_0 -->
<g id="edge2227" class="edge">
<title>gate_1_5&#45;&gt;expert_1_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5454.21,-10967.33C5454.21,-10948.14 5454.21,-10928 5454.21,-10928 5454.21,-10928 7054.38,-10928 7054.38,-10928 7054.38,-10928 7054.38,-10842.08 7054.38,-10842.08"/>
<polygon fill="blue" stroke="blue" points="7057.88,-10842.08 7054.38,-10832.08 7050.88,-10842.08 7057.88,-10842.08"/>
<text text-anchor="middle" x="23264.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23264.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU5→GPU8</text>
<text text-anchor="middle" x="23264.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23264.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_5&#45;&gt;expert_1_9_0 -->
<g id="edge2228" class="edge">
<title>gate_1_5&#45;&gt;expert_1_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5464.26,-10969.29C5464.26,-10946.51 5464.26,-10920 5464.26,-10920 5464.26,-10920 7737.82,-10920 7737.82,-10920 7737.82,-10920 7737.82,-10842.06 7737.82,-10842.06"/>
<polygon fill="blue" stroke="blue" points="7741.32,-10842.06 7737.82,-10832.06 7734.32,-10842.06 7741.32,-10842.06"/>
<text text-anchor="middle" x="23438.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23438.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU5→GPU9</text>
<text text-anchor="middle" x="23438.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23438.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_5&#45;&gt;expert_1_10_0 -->
<g id="edge2229" class="edge">
<title>gate_1_5&#45;&gt;expert_1_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5474.31,-10971.73C5474.31,-10946.71 5474.31,-10915 5474.31,-10915 5474.31,-10915 8318.88,-10915 8318.88,-10915 8318.88,-10915 8318.88,-10842.01 8318.88,-10842.01"/>
<polygon fill="blue" stroke="blue" points="8322.38,-10842.01 8318.88,-10832.01 8315.38,-10842.01 8322.38,-10842.01"/>
<text text-anchor="middle" x="23612.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23612.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU5→GPU10</text>
<text text-anchor="middle" x="23612.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23612.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_5&#45;&gt;expert_1_11_0 -->
<g id="edge2230" class="edge">
<title>gate_1_5&#45;&gt;expert_1_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5484.36,-10975.1C5484.36,-10938.55 5484.36,-10877 5484.36,-10877 5484.36,-10877 8905.88,-10877 8905.88,-10877 8905.88,-10877 8905.88,-10842.12 8905.88,-10842.12"/>
<polygon fill="blue" stroke="blue" points="8909.38,-10842.12 8905.88,-10832.12 8902.38,-10842.12 8909.38,-10842.12"/>
<text text-anchor="middle" x="23786.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23786.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU5→GPU11</text>
<text text-anchor="middle" x="23786.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23786.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_5&#45;&gt;expert_1_12_0 -->
<g id="edge2231" class="edge">
<title>gate_1_5&#45;&gt;expert_1_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5494.4,-10979.32C5494.4,-10941.6 5494.4,-10869 5494.4,-10869 5494.4,-10869 9504.24,-10869 9504.24,-10869 9504.24,-10869 9504.24,-10842.06 9504.24,-10842.06"/>
<polygon fill="blue" stroke="blue" points="9507.74,-10842.06 9504.24,-10832.06 9500.74,-10842.06 9507.74,-10842.06"/>
<text text-anchor="middle" x="23960.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23960.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU5→GPU12</text>
<text text-anchor="middle" x="23960.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23960.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_5&#45;&gt;expert_1_13_0 -->
<g id="edge2232" class="edge">
<title>gate_1_5&#45;&gt;expert_1_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5504.45,-10985.5C5504.45,-10948.86 5504.45,-10862 5504.45,-10862 5504.45,-10862 10100.78,-10862 10100.78,-10862 10100.78,-10862 10100.78,-10842.1 10100.78,-10842.1"/>
<polygon fill="blue" stroke="blue" points="10104.28,-10842.1 10100.78,-10832.1 10097.28,-10842.1 10104.28,-10842.1"/>
<text text-anchor="middle" x="24134.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="24134.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU5→GPU13</text>
<text text-anchor="middle" x="24134.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="24134.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_5&#45;&gt;expert_1_14_0 -->
<g id="edge2233" class="edge">
<title>gate_1_5&#45;&gt;expert_1_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5461.75,-11034.12C5461.75,-11044.34 5461.75,-11053 5461.75,-11053 5461.75,-11053 10583.8,-11053 10583.8,-11053 10583.8,-11053 10583.8,-10842.46 10583.8,-10842.46"/>
<polygon fill="blue" stroke="blue" points="10587.3,-10842.46 10583.8,-10832.46 10580.3,-10842.46 10587.3,-10842.46"/>
<text text-anchor="middle" x="24308.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="24308.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU5→GPU14</text>
<text text-anchor="middle" x="24308.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="24308.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_5&#45;&gt;expert_1_15_0 -->
<g id="edge2234" class="edge">
<title>gate_1_5&#45;&gt;expert_1_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5409,-11039.2C5409,-11054.66 5409,-11069 5409,-11069 5409,-11069 11171.81,-11069 11171.81,-11069 11171.81,-11069 11171.81,-10842.22 11171.81,-10842.22"/>
<polygon fill="blue" stroke="blue" points="11175.31,-10842.22 11171.81,-10832.22 11168.31,-10842.22 11175.31,-10842.22"/>
<text text-anchor="middle" x="24482.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="24482.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU5→GPU15</text>
<text text-anchor="middle" x="24482.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="24482.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_5 -->
<g id="node538" class="node">
<title>expert_reduce_1_5</title>
<ellipse fill="none" stroke="black" cx="5409" cy="-10668.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="5409" y="-10679.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="5409" y="-10664.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="5409" y="-10649.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_5_0&#45;&gt;expert_reduce_1_5 -->
<g id="edge532" class="edge">
<title>expert_1_5_0&#45;&gt;expert_reduce_1_5</title>
<path fill="none" stroke="black" d="M5409,-10778.76C5409,-10778.76 5409,-10716.06 5409,-10716.06"/>
<polygon fill="black" stroke="black" points="5412.5,-10716.06 5409,-10706.06 5405.5,-10716.06 5412.5,-10716.06"/>
</g>
<!-- moe_residual_1_5 -->
<g id="node539" class="node">
<title>moe_residual_1_5</title>
<ellipse fill="none" stroke="black" cx="5409" cy="-10531" rx="105.5" ry="27"/>
<text text-anchor="middle" x="5409" y="-10534.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="5409" y="-10519.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_5&#45;&gt;moe_residual_1_5 -->
<g id="edge533" class="edge">
<title>expert_reduce_1_5&#45;&gt;moe_residual_1_5</title>
<path fill="none" stroke="black" d="M5409,-10630.93C5409,-10630.93 5409,-10568.06 5409,-10568.06"/>
<polygon fill="black" stroke="black" points="5412.5,-10568.06 5409,-10558.06 5405.5,-10568.06 5412.5,-10568.06"/>
</g>
<!-- qkv_proj_2_5 -->
<g id="node540" class="node">
<title>qkv_proj_2_5</title>
<polygon fill="none" stroke="black" points="5491.5,-10431 5326.5,-10431 5326.5,-10378 5491.5,-10378 5491.5,-10431"/>
<text text-anchor="middle" x="5409" y="-10415.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5409" y="-10400.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="5409" y="-10385.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_1_5&#45;&gt;qkv_proj_2_5 -->
<g id="edge534" class="edge">
<title>moe_residual_1_5&#45;&gt;qkv_proj_2_5</title>
<path fill="none" stroke="black" d="M5409,-10503.86C5409,-10503.86 5409,-10441.16 5409,-10441.16"/>
<polygon fill="black" stroke="black" points="5412.5,-10441.16 5409,-10431.16 5405.5,-10441.16 5412.5,-10441.16"/>
</g>
<!-- qkv_reshape_2_5 -->
<g id="node541" class="node">
<title>qkv_reshape_2_5</title>
<ellipse fill="none" stroke="black" cx="5409" cy="-10278" rx="148" ry="27"/>
<text text-anchor="middle" x="5409" y="-10281.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="5409" y="-10266.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_2_5&#45;&gt;qkv_reshape_2_5 -->
<g id="edge535" class="edge">
<title>qkv_proj_2_5&#45;&gt;qkv_reshape_2_5</title>
<path fill="none" stroke="black" d="M5409,-10377.98C5409,-10377.98 5409,-10315.36 5409,-10315.36"/>
<polygon fill="black" stroke="black" points="5412.5,-10315.36 5409,-10305.36 5405.5,-10315.36 5412.5,-10315.36"/>
</g>
<!-- qkv_reshape_2_5&#45;&gt;ring_attn_2_5_stage_0 -->
<g id="edge536" class="edge">
<title>qkv_reshape_2_5&#45;&gt;ring_attn_2_5_stage_0</title>
<path fill="none" stroke="black" d="M5409,-10250.72C5409,-10250.72 5409,-10144.16 5409,-10144.16"/>
<polygon fill="black" stroke="black" points="5412.5,-10144.16 5409,-10134.16 5405.5,-10144.16 5412.5,-10144.16"/>
</g>
<!-- ring_attn_2_5_stage_0&#45;&gt;ring_attn_2_5_stage_1 -->
<g id="edge537" class="edge">
<title>ring_attn_2_5_stage_0&#45;&gt;ring_attn_2_5_stage_1</title>
<path fill="none" stroke="black" d="M5409,-9997.87C5409,-9997.87 5409,-9891.25 5409,-9891.25"/>
<polygon fill="black" stroke="black" points="5412.5,-9891.25 5409,-9881.25 5405.5,-9891.25 5412.5,-9891.25"/>
</g>
<!-- ring_attn_2_6_stage_0 -->
<g id="node640" class="node">
<title>ring_attn_2_6_stage_0</title>
<polygon fill="yellow" stroke="black" points="5996,-10134 5787,-10066 5996,-9998 6205,-10066 5996,-10134"/>
<text text-anchor="middle" x="5996" y="-10084.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-10069.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="5996" y="-10054.8" font-family="Times,serif" font-size="14.00">Q[6]×K[6]×V[6]</text>
<text text-anchor="middle" x="5996" y="-10039.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_5_stage_0&#45;&gt;ring_attn_2_6_stage_0 -->
<g id="edge2235" class="edge">
<title>ring_attn_2_5_stage_0&#45;&gt;ring_attn_2_6_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-10066C5618.02,-10066 5776.86,-10066 5776.86,-10066"/>
<polygon fill="red" stroke="red" points="5776.86,-10069.5 5786.86,-10066 5776.86,-10062.5 5776.86,-10069.5"/>
</g>
<!-- ring_attn_2_5_stage_1&#45;&gt;ring_attn_2_5_stage_2 -->
<g id="edge538" class="edge">
<title>ring_attn_2_5_stage_1&#45;&gt;ring_attn_2_5_stage_2</title>
<path fill="none" stroke="black" d="M5409,-9744.87C5409,-9744.87 5409,-9638.25 5409,-9638.25"/>
<polygon fill="black" stroke="black" points="5412.5,-9638.25 5409,-9628.25 5405.5,-9638.25 5412.5,-9638.25"/>
</g>
<!-- ring_attn_2_6_stage_1 -->
<g id="node641" class="node">
<title>ring_attn_2_6_stage_1</title>
<polygon fill="yellow" stroke="black" points="5996,-9881 5787,-9813 5996,-9745 6205,-9813 5996,-9881"/>
<text text-anchor="middle" x="5996" y="-9831.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-9816.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="5996" y="-9801.8" font-family="Times,serif" font-size="14.00">Q[6]×K[5]×V[5]</text>
<text text-anchor="middle" x="5996" y="-9786.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_5_stage_1&#45;&gt;ring_attn_2_6_stage_1 -->
<g id="edge2236" class="edge">
<title>ring_attn_2_5_stage_1&#45;&gt;ring_attn_2_6_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-9813C5618.02,-9813 5776.86,-9813 5776.86,-9813"/>
<polygon fill="red" stroke="red" points="5776.86,-9816.5 5786.86,-9813 5776.86,-9809.5 5776.86,-9816.5"/>
</g>
<!-- ring_attn_2_5_stage_2&#45;&gt;ring_attn_2_5_stage_3 -->
<g id="edge539" class="edge">
<title>ring_attn_2_5_stage_2&#45;&gt;ring_attn_2_5_stage_3</title>
<path fill="none" stroke="black" d="M5409,-9491.87C5409,-9491.87 5409,-9385.25 5409,-9385.25"/>
<polygon fill="black" stroke="black" points="5412.5,-9385.25 5409,-9375.25 5405.5,-9385.25 5412.5,-9385.25"/>
</g>
<!-- ring_attn_2_6_stage_2 -->
<g id="node642" class="node">
<title>ring_attn_2_6_stage_2</title>
<polygon fill="yellow" stroke="black" points="5996,-9628 5787,-9560 5996,-9492 6205,-9560 5996,-9628"/>
<text text-anchor="middle" x="5996" y="-9578.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-9563.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="5996" y="-9548.8" font-family="Times,serif" font-size="14.00">Q[6]×K[4]×V[4]</text>
<text text-anchor="middle" x="5996" y="-9533.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_5_stage_2&#45;&gt;ring_attn_2_6_stage_2 -->
<g id="edge2237" class="edge">
<title>ring_attn_2_5_stage_2&#45;&gt;ring_attn_2_6_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-9560C5618.02,-9560 5776.86,-9560 5776.86,-9560"/>
<polygon fill="red" stroke="red" points="5776.86,-9563.5 5786.86,-9560 5776.86,-9556.5 5776.86,-9563.5"/>
</g>
<!-- ring_attn_2_5_stage_3&#45;&gt;ring_attn_2_5_stage_4 -->
<g id="edge540" class="edge">
<title>ring_attn_2_5_stage_3&#45;&gt;ring_attn_2_5_stage_4</title>
<path fill="none" stroke="black" d="M5409,-9238.87C5409,-9238.87 5409,-9132.25 5409,-9132.25"/>
<polygon fill="black" stroke="black" points="5412.5,-9132.25 5409,-9122.25 5405.5,-9132.25 5412.5,-9132.25"/>
</g>
<!-- ring_attn_2_6_stage_3 -->
<g id="node643" class="node">
<title>ring_attn_2_6_stage_3</title>
<polygon fill="yellow" stroke="black" points="5996,-9375 5787,-9307 5996,-9239 6205,-9307 5996,-9375"/>
<text text-anchor="middle" x="5996" y="-9325.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-9310.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="5996" y="-9295.8" font-family="Times,serif" font-size="14.00">Q[6]×K[3]×V[3]</text>
<text text-anchor="middle" x="5996" y="-9280.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_5_stage_3&#45;&gt;ring_attn_2_6_stage_3 -->
<g id="edge2238" class="edge">
<title>ring_attn_2_5_stage_3&#45;&gt;ring_attn_2_6_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-9307C5618.02,-9307 5776.86,-9307 5776.86,-9307"/>
<polygon fill="red" stroke="red" points="5776.86,-9310.5 5786.86,-9307 5776.86,-9303.5 5776.86,-9310.5"/>
</g>
<!-- ring_attn_2_5_stage_4&#45;&gt;ring_attn_2_5_stage_5 -->
<g id="edge541" class="edge">
<title>ring_attn_2_5_stage_4&#45;&gt;ring_attn_2_5_stage_5</title>
<path fill="none" stroke="black" d="M5409,-8985.87C5409,-8985.87 5409,-8879.25 5409,-8879.25"/>
<polygon fill="black" stroke="black" points="5412.5,-8879.25 5409,-8869.25 5405.5,-8879.25 5412.5,-8879.25"/>
</g>
<!-- ring_attn_2_6_stage_4 -->
<g id="node644" class="node">
<title>ring_attn_2_6_stage_4</title>
<polygon fill="yellow" stroke="black" points="5996,-9122 5787,-9054 5996,-8986 6205,-9054 5996,-9122"/>
<text text-anchor="middle" x="5996" y="-9072.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-9057.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="5996" y="-9042.8" font-family="Times,serif" font-size="14.00">Q[6]×K[2]×V[2]</text>
<text text-anchor="middle" x="5996" y="-9027.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_5_stage_4&#45;&gt;ring_attn_2_6_stage_4 -->
<g id="edge2239" class="edge">
<title>ring_attn_2_5_stage_4&#45;&gt;ring_attn_2_6_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-9054C5618.02,-9054 5776.86,-9054 5776.86,-9054"/>
<polygon fill="red" stroke="red" points="5776.86,-9057.5 5786.86,-9054 5776.86,-9050.5 5776.86,-9057.5"/>
</g>
<!-- ring_attn_2_5_stage_5&#45;&gt;ring_attn_2_5_stage_6 -->
<g id="edge542" class="edge">
<title>ring_attn_2_5_stage_5&#45;&gt;ring_attn_2_5_stage_6</title>
<path fill="none" stroke="black" d="M5409,-8732.87C5409,-8732.87 5409,-8626.25 5409,-8626.25"/>
<polygon fill="black" stroke="black" points="5412.5,-8626.25 5409,-8616.25 5405.5,-8626.25 5412.5,-8626.25"/>
</g>
<!-- ring_attn_2_6_stage_5 -->
<g id="node645" class="node">
<title>ring_attn_2_6_stage_5</title>
<polygon fill="yellow" stroke="black" points="5996,-8869 5787,-8801 5996,-8733 6205,-8801 5996,-8869"/>
<text text-anchor="middle" x="5996" y="-8819.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-8804.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="5996" y="-8789.8" font-family="Times,serif" font-size="14.00">Q[6]×K[1]×V[1]</text>
<text text-anchor="middle" x="5996" y="-8774.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_5_stage_5&#45;&gt;ring_attn_2_6_stage_5 -->
<g id="edge2240" class="edge">
<title>ring_attn_2_5_stage_5&#45;&gt;ring_attn_2_6_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-8801C5618.02,-8801 5776.86,-8801 5776.86,-8801"/>
<polygon fill="red" stroke="red" points="5776.86,-8804.5 5786.86,-8801 5776.86,-8797.5 5776.86,-8804.5"/>
</g>
<!-- ring_attn_2_5_stage_6&#45;&gt;ring_attn_2_5_stage_7 -->
<g id="edge543" class="edge">
<title>ring_attn_2_5_stage_6&#45;&gt;ring_attn_2_5_stage_7</title>
<path fill="none" stroke="black" d="M5409,-8479.87C5409,-8479.87 5409,-8373.25 5409,-8373.25"/>
<polygon fill="black" stroke="black" points="5412.5,-8373.25 5409,-8363.25 5405.5,-8373.25 5412.5,-8373.25"/>
</g>
<!-- ring_attn_2_6_stage_6 -->
<g id="node646" class="node">
<title>ring_attn_2_6_stage_6</title>
<polygon fill="yellow" stroke="black" points="5996,-8616 5787,-8548 5996,-8480 6205,-8548 5996,-8616"/>
<text text-anchor="middle" x="5996" y="-8566.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-8551.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="5996" y="-8536.8" font-family="Times,serif" font-size="14.00">Q[6]×K[0]×V[0]</text>
<text text-anchor="middle" x="5996" y="-8521.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_5_stage_6&#45;&gt;ring_attn_2_6_stage_6 -->
<g id="edge2241" class="edge">
<title>ring_attn_2_5_stage_6&#45;&gt;ring_attn_2_6_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-8548C5618.02,-8548 5776.86,-8548 5776.86,-8548"/>
<polygon fill="red" stroke="red" points="5776.86,-8551.5 5786.86,-8548 5776.86,-8544.5 5776.86,-8551.5"/>
</g>
<!-- ring_attn_2_5_stage_7&#45;&gt;ring_attn_2_5_stage_8 -->
<g id="edge544" class="edge">
<title>ring_attn_2_5_stage_7&#45;&gt;ring_attn_2_5_stage_8</title>
<path fill="none" stroke="black" d="M5409,-8226.87C5409,-8226.87 5409,-8120.25 5409,-8120.25"/>
<polygon fill="black" stroke="black" points="5412.5,-8120.25 5409,-8110.25 5405.5,-8120.25 5412.5,-8120.25"/>
</g>
<!-- ring_attn_2_6_stage_7 -->
<g id="node647" class="node">
<title>ring_attn_2_6_stage_7</title>
<polygon fill="yellow" stroke="black" points="5996,-8363 5787,-8295 5996,-8227 6205,-8295 5996,-8363"/>
<text text-anchor="middle" x="5996" y="-8313.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-8298.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="5996" y="-8283.8" font-family="Times,serif" font-size="14.00">Q[6]×K[15]×V[15]</text>
<text text-anchor="middle" x="5996" y="-8268.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_5_stage_7&#45;&gt;ring_attn_2_6_stage_7 -->
<g id="edge2242" class="edge">
<title>ring_attn_2_5_stage_7&#45;&gt;ring_attn_2_6_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-8295C5618.02,-8295 5776.86,-8295 5776.86,-8295"/>
<polygon fill="red" stroke="red" points="5776.86,-8298.5 5786.86,-8295 5776.86,-8291.5 5776.86,-8298.5"/>
</g>
<!-- ring_attn_2_5_stage_8&#45;&gt;ring_attn_2_5_stage_9 -->
<g id="edge545" class="edge">
<title>ring_attn_2_5_stage_8&#45;&gt;ring_attn_2_5_stage_9</title>
<path fill="none" stroke="black" d="M5409,-7973.87C5409,-7973.87 5409,-7867.25 5409,-7867.25"/>
<polygon fill="black" stroke="black" points="5412.5,-7867.25 5409,-7857.25 5405.5,-7867.25 5412.5,-7867.25"/>
</g>
<!-- ring_attn_2_6_stage_8 -->
<g id="node648" class="node">
<title>ring_attn_2_6_stage_8</title>
<polygon fill="yellow" stroke="black" points="5996,-8110 5787,-8042 5996,-7974 6205,-8042 5996,-8110"/>
<text text-anchor="middle" x="5996" y="-8060.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-8045.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="5996" y="-8030.8" font-family="Times,serif" font-size="14.00">Q[6]×K[14]×V[14]</text>
<text text-anchor="middle" x="5996" y="-8015.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_5_stage_8&#45;&gt;ring_attn_2_6_stage_8 -->
<g id="edge2243" class="edge">
<title>ring_attn_2_5_stage_8&#45;&gt;ring_attn_2_6_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-8042C5618.02,-8042 5776.86,-8042 5776.86,-8042"/>
<polygon fill="red" stroke="red" points="5776.86,-8045.5 5786.86,-8042 5776.86,-8038.5 5776.86,-8045.5"/>
</g>
<!-- ring_attn_2_5_stage_9&#45;&gt;ring_attn_2_5_stage_10 -->
<g id="edge546" class="edge">
<title>ring_attn_2_5_stage_9&#45;&gt;ring_attn_2_5_stage_10</title>
<path fill="none" stroke="black" d="M5409,-7720.87C5409,-7720.87 5409,-7614.25 5409,-7614.25"/>
<polygon fill="black" stroke="black" points="5412.5,-7614.25 5409,-7604.25 5405.5,-7614.25 5412.5,-7614.25"/>
</g>
<!-- ring_attn_2_6_stage_9 -->
<g id="node649" class="node">
<title>ring_attn_2_6_stage_9</title>
<polygon fill="yellow" stroke="black" points="5996,-7857 5787,-7789 5996,-7721 6205,-7789 5996,-7857"/>
<text text-anchor="middle" x="5996" y="-7807.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-7792.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="5996" y="-7777.8" font-family="Times,serif" font-size="14.00">Q[6]×K[13]×V[13]</text>
<text text-anchor="middle" x="5996" y="-7762.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_5_stage_9&#45;&gt;ring_attn_2_6_stage_9 -->
<g id="edge2244" class="edge">
<title>ring_attn_2_5_stage_9&#45;&gt;ring_attn_2_6_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-7789C5618.02,-7789 5776.86,-7789 5776.86,-7789"/>
<polygon fill="red" stroke="red" points="5776.86,-7792.5 5786.86,-7789 5776.86,-7785.5 5776.86,-7792.5"/>
</g>
<!-- ring_attn_2_5_stage_10&#45;&gt;ring_attn_2_5_stage_11 -->
<g id="edge547" class="edge">
<title>ring_attn_2_5_stage_10&#45;&gt;ring_attn_2_5_stage_11</title>
<path fill="none" stroke="black" d="M5409,-7467.87C5409,-7467.87 5409,-7361.25 5409,-7361.25"/>
<polygon fill="black" stroke="black" points="5412.5,-7361.25 5409,-7351.25 5405.5,-7361.25 5412.5,-7361.25"/>
</g>
<!-- ring_attn_2_6_stage_10 -->
<g id="node650" class="node">
<title>ring_attn_2_6_stage_10</title>
<polygon fill="yellow" stroke="black" points="5996,-7604 5787,-7536 5996,-7468 6205,-7536 5996,-7604"/>
<text text-anchor="middle" x="5996" y="-7554.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-7539.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="5996" y="-7524.8" font-family="Times,serif" font-size="14.00">Q[6]×K[12]×V[12]</text>
<text text-anchor="middle" x="5996" y="-7509.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_5_stage_10&#45;&gt;ring_attn_2_6_stage_10 -->
<g id="edge2245" class="edge">
<title>ring_attn_2_5_stage_10&#45;&gt;ring_attn_2_6_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-7536C5618.02,-7536 5776.86,-7536 5776.86,-7536"/>
<polygon fill="red" stroke="red" points="5776.86,-7539.5 5786.86,-7536 5776.86,-7532.5 5776.86,-7539.5"/>
</g>
<!-- ring_attn_2_5_stage_11&#45;&gt;ring_attn_2_5_stage_12 -->
<g id="edge548" class="edge">
<title>ring_attn_2_5_stage_11&#45;&gt;ring_attn_2_5_stage_12</title>
<path fill="none" stroke="black" d="M5409,-7214.87C5409,-7214.87 5409,-7108.25 5409,-7108.25"/>
<polygon fill="black" stroke="black" points="5412.5,-7108.25 5409,-7098.25 5405.5,-7108.25 5412.5,-7108.25"/>
</g>
<!-- ring_attn_2_6_stage_11 -->
<g id="node651" class="node">
<title>ring_attn_2_6_stage_11</title>
<polygon fill="yellow" stroke="black" points="5996,-7351 5787,-7283 5996,-7215 6205,-7283 5996,-7351"/>
<text text-anchor="middle" x="5996" y="-7301.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-7286.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="5996" y="-7271.8" font-family="Times,serif" font-size="14.00">Q[6]×K[11]×V[11]</text>
<text text-anchor="middle" x="5996" y="-7256.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_5_stage_11&#45;&gt;ring_attn_2_6_stage_11 -->
<g id="edge2246" class="edge">
<title>ring_attn_2_5_stage_11&#45;&gt;ring_attn_2_6_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-7283C5618.02,-7283 5776.86,-7283 5776.86,-7283"/>
<polygon fill="red" stroke="red" points="5776.86,-7286.5 5786.86,-7283 5776.86,-7279.5 5776.86,-7286.5"/>
</g>
<!-- ring_attn_2_5_stage_12&#45;&gt;ring_attn_2_5_stage_13 -->
<g id="edge549" class="edge">
<title>ring_attn_2_5_stage_12&#45;&gt;ring_attn_2_5_stage_13</title>
<path fill="none" stroke="black" d="M5409,-6961.87C5409,-6961.87 5409,-6855.25 5409,-6855.25"/>
<polygon fill="black" stroke="black" points="5412.5,-6855.25 5409,-6845.25 5405.5,-6855.25 5412.5,-6855.25"/>
</g>
<!-- ring_attn_2_6_stage_12 -->
<g id="node652" class="node">
<title>ring_attn_2_6_stage_12</title>
<polygon fill="yellow" stroke="black" points="5996,-7098 5787,-7030 5996,-6962 6205,-7030 5996,-7098"/>
<text text-anchor="middle" x="5996" y="-7048.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-7033.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="5996" y="-7018.8" font-family="Times,serif" font-size="14.00">Q[6]×K[10]×V[10]</text>
<text text-anchor="middle" x="5996" y="-7003.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_5_stage_12&#45;&gt;ring_attn_2_6_stage_12 -->
<g id="edge2247" class="edge">
<title>ring_attn_2_5_stage_12&#45;&gt;ring_attn_2_6_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-7030C5618.02,-7030 5776.86,-7030 5776.86,-7030"/>
<polygon fill="red" stroke="red" points="5776.86,-7033.5 5786.86,-7030 5776.86,-7026.5 5776.86,-7033.5"/>
</g>
<!-- ring_attn_2_5_stage_13&#45;&gt;ring_attn_2_5_stage_14 -->
<g id="edge550" class="edge">
<title>ring_attn_2_5_stage_13&#45;&gt;ring_attn_2_5_stage_14</title>
<path fill="none" stroke="black" d="M5409,-6708.87C5409,-6708.87 5409,-6602.25 5409,-6602.25"/>
<polygon fill="black" stroke="black" points="5412.5,-6602.25 5409,-6592.25 5405.5,-6602.25 5412.5,-6602.25"/>
</g>
<!-- ring_attn_2_6_stage_13 -->
<g id="node653" class="node">
<title>ring_attn_2_6_stage_13</title>
<polygon fill="yellow" stroke="black" points="5996,-6845 5787,-6777 5996,-6709 6205,-6777 5996,-6845"/>
<text text-anchor="middle" x="5996" y="-6795.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-6780.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="5996" y="-6765.8" font-family="Times,serif" font-size="14.00">Q[6]×K[9]×V[9]</text>
<text text-anchor="middle" x="5996" y="-6750.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_5_stage_13&#45;&gt;ring_attn_2_6_stage_13 -->
<g id="edge2248" class="edge">
<title>ring_attn_2_5_stage_13&#45;&gt;ring_attn_2_6_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-6777C5618.02,-6777 5776.86,-6777 5776.86,-6777"/>
<polygon fill="red" stroke="red" points="5776.86,-6780.5 5786.86,-6777 5776.86,-6773.5 5776.86,-6780.5"/>
</g>
<!-- ring_attn_2_5_stage_14&#45;&gt;ring_attn_2_5_stage_15 -->
<g id="edge551" class="edge">
<title>ring_attn_2_5_stage_14&#45;&gt;ring_attn_2_5_stage_15</title>
<path fill="none" stroke="black" d="M5409,-6455.87C5409,-6455.87 5409,-6349.25 5409,-6349.25"/>
<polygon fill="black" stroke="black" points="5412.5,-6349.25 5409,-6339.25 5405.5,-6349.25 5412.5,-6349.25"/>
</g>
<!-- ring_attn_2_6_stage_14 -->
<g id="node654" class="node">
<title>ring_attn_2_6_stage_14</title>
<polygon fill="yellow" stroke="black" points="5996,-6592 5787,-6524 5996,-6456 6205,-6524 5996,-6592"/>
<text text-anchor="middle" x="5996" y="-6542.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-6527.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="5996" y="-6512.8" font-family="Times,serif" font-size="14.00">Q[6]×K[8]×V[8]</text>
<text text-anchor="middle" x="5996" y="-6497.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_5_stage_14&#45;&gt;ring_attn_2_6_stage_14 -->
<g id="edge2249" class="edge">
<title>ring_attn_2_5_stage_14&#45;&gt;ring_attn_2_6_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-6524C5618.02,-6524 5776.86,-6524 5776.86,-6524"/>
<polygon fill="red" stroke="red" points="5776.86,-6527.5 5786.86,-6524 5776.86,-6520.5 5776.86,-6527.5"/>
</g>
<!-- attn_out_2_5 -->
<g id="node558" class="node">
<title>attn_out_2_5</title>
<polygon fill="none" stroke="black" points="5478.5,-6130 5339.5,-6130 5339.5,-6077 5478.5,-6077 5478.5,-6130"/>
<text text-anchor="middle" x="5409" y="-6114.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="5409" y="-6099.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="5409" y="-6084.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_2_5_stage_15&#45;&gt;attn_out_2_5 -->
<g id="edge552" class="edge">
<title>ring_attn_2_5_stage_15&#45;&gt;attn_out_2_5</title>
<path fill="none" stroke="black" d="M5409,-6202.87C5409,-6202.87 5409,-6140.18 5409,-6140.18"/>
<polygon fill="black" stroke="black" points="5412.5,-6140.18 5409,-6130.18 5405.5,-6140.18 5412.5,-6140.18"/>
</g>
<!-- ring_attn_2_6_stage_15 -->
<g id="node655" class="node">
<title>ring_attn_2_6_stage_15</title>
<polygon fill="yellow" stroke="black" points="5996,-6339 5787,-6271 5996,-6203 6205,-6271 5996,-6339"/>
<text text-anchor="middle" x="5996" y="-6289.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-6274.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="5996" y="-6259.8" font-family="Times,serif" font-size="14.00">Q[6]×K[7]×V[7]</text>
<text text-anchor="middle" x="5996" y="-6244.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_5_stage_15&#45;&gt;ring_attn_2_6_stage_15 -->
<g id="edge2250" class="edge">
<title>ring_attn_2_5_stage_15&#45;&gt;ring_attn_2_6_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-6271C5618.02,-6271 5776.86,-6271 5776.86,-6271"/>
<polygon fill="red" stroke="red" points="5776.86,-6274.5 5786.86,-6271 5776.86,-6267.5 5776.86,-6274.5"/>
</g>
<!-- attn_residual_2_5 -->
<g id="node559" class="node">
<title>attn_residual_2_5</title>
<ellipse fill="none" stroke="black" cx="5409" cy="-5977" rx="105.5" ry="27"/>
<text text-anchor="middle" x="5409" y="-5980.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="5409" y="-5965.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_2_5&#45;&gt;attn_residual_2_5 -->
<g id="edge553" class="edge">
<title>attn_out_2_5&#45;&gt;attn_residual_2_5</title>
<path fill="none" stroke="black" d="M5409,-6076.98C5409,-6076.98 5409,-6014.36 5409,-6014.36"/>
<polygon fill="black" stroke="black" points="5412.5,-6014.36 5409,-6004.36 5405.5,-6014.36 5412.5,-6014.36"/>
</g>
<!-- gate_2_5 -->
<g id="node560" class="node">
<title>gate_2_5</title>
<ellipse fill="orange" stroke="black" cx="5409" cy="-5839.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="5409" y="-5850.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="5409" y="-5835.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="5409" y="-5820.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_2_5&#45;&gt;gate_2_5 -->
<g id="edge554" class="edge">
<title>attn_residual_2_5&#45;&gt;gate_2_5</title>
<path fill="none" stroke="black" d="M5356.25,-5953.36C5356.25,-5953.36 5356.25,-5882.08 5356.25,-5882.08"/>
<polygon fill="black" stroke="black" points="5359.75,-5882.08 5356.25,-5872.08 5352.75,-5882.08 5359.75,-5882.08"/>
</g>
<!-- gate_2_5&#45;&gt;expert_2_0_0 -->
<g id="edge2251" class="edge">
<title>gate_2_5&#45;&gt;expert_2_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5313.55,-5823.31C5313.55,-5803.91 5313.55,-5774 5313.55,-5774 5313.55,-5774 161.7,-5774 161.7,-5774 161.7,-5774 161.7,-5680.22 161.7,-5680.22"/>
<polygon fill="blue" stroke="blue" points="165.2,-5680.22 161.7,-5670.22 158.2,-5680.22 165.2,-5680.22"/>
<text text-anchor="middle" x="22046.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22046.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU5→GPU0</text>
<text text-anchor="middle" x="22046.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22046.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_5&#45;&gt;expert_2_1_0 -->
<g id="edge2252" class="edge">
<title>gate_2_5&#45;&gt;expert_2_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5333.64,-5813.21C5333.64,-5794.26 5333.64,-5772 5333.64,-5772 5333.64,-5772 2974.68,-5772 2974.68,-5772 2974.68,-5772 2974.68,-5680.13 2974.68,-5680.13"/>
<polygon fill="blue" stroke="blue" points="2978.18,-5680.13 2974.68,-5670.13 2971.18,-5680.13 2978.18,-5680.13"/>
<text text-anchor="middle" x="22220.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22220.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU5→GPU1</text>
<text text-anchor="middle" x="22220.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22220.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_5&#45;&gt;expert_2_2_0 -->
<g id="edge2253" class="edge">
<title>gate_2_5&#45;&gt;expert_2_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5353.74,-5807.52C5353.74,-5792.14 5353.74,-5777 5353.74,-5777 5353.74,-5777 3573.76,-5777 3573.76,-5777 3573.76,-5777 3573.76,-5680.19 3573.76,-5680.19"/>
<polygon fill="blue" stroke="blue" points="3577.26,-5680.19 3573.76,-5670.19 3570.26,-5680.19 3577.26,-5680.19"/>
<text text-anchor="middle" x="22394.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22394.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU5→GPU2</text>
<text text-anchor="middle" x="22394.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22394.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_5&#45;&gt;expert_2_3_0 -->
<g id="edge2254" class="edge">
<title>gate_2_5&#45;&gt;expert_2_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5363.79,-5805.23C5363.79,-5799.83 5363.79,-5796 5363.79,-5796 5363.79,-5796 4349.5,-5796 4349.5,-5796 4349.5,-5796 4349.5,-5680.06 4349.5,-5680.06"/>
<polygon fill="blue" stroke="blue" points="4353,-5680.06 4349.5,-5670.06 4346,-5680.06 4353,-5680.06"/>
<text text-anchor="middle" x="22568.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22568.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU5→GPU3</text>
<text text-anchor="middle" x="22568.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22568.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_5&#45;&gt;expert_2_4_0 -->
<g id="edge2255" class="edge">
<title>gate_2_5&#45;&gt;expert_2_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5309.3,-5852C5169.46,-5852 4932,-5852 4932,-5852 4932,-5852 4932,-5680.33 4932,-5680.33"/>
<polygon fill="blue" stroke="blue" points="4935.5,-5680.33 4932,-5670.33 4928.5,-5680.33 4935.5,-5680.33"/>
<text text-anchor="middle" x="22742.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22742.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU5→GPU4</text>
<text text-anchor="middle" x="22742.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22742.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_5&#45;&gt;expert_2_5_0 -->
<g id="edge555" class="edge">
<title>gate_2_5&#45;&gt;expert_2_5_0</title>
<path fill="none" stroke="black" d="M5373.83,-5804.01C5373.83,-5804.01 5373.83,-5680.24 5373.83,-5680.24"/>
<polygon fill="black" stroke="black" points="5377.33,-5680.24 5373.83,-5670.24 5370.33,-5680.24 5377.33,-5680.24"/>
</g>
<!-- gate_2_5&#45;&gt;expert_2_6_0 -->
<g id="edge2256" class="edge">
<title>gate_2_5&#45;&gt;expert_2_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5508.52,-5827C5648.09,-5827 5885.1,-5827 5885.1,-5827 5885.1,-5827 5885.1,-5680.18 5885.1,-5680.18"/>
<polygon fill="blue" stroke="blue" points="5888.6,-5680.18 5885.1,-5670.18 5881.6,-5680.18 5888.6,-5680.18"/>
<text text-anchor="middle" x="22916.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22916.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU5→GPU6</text>
<text text-anchor="middle" x="22916.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22916.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_5&#45;&gt;expert_2_7_0 -->
<g id="edge2257" class="edge">
<title>gate_2_5&#45;&gt;expert_2_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5444.17,-5804.04C5444.17,-5792.69 5444.17,-5783 5444.17,-5783 5444.17,-5783 6470.75,-5783 6470.75,-5783 6470.75,-5783 6470.75,-5680.07 6470.75,-5680.07"/>
<polygon fill="blue" stroke="blue" points="6474.25,-5680.07 6470.75,-5670.07 6467.25,-5680.07 6474.25,-5680.07"/>
<text text-anchor="middle" x="23090.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23090.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU5→GPU7</text>
<text text-anchor="middle" x="23090.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23090.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_5&#45;&gt;expert_2_8_0 -->
<g id="edge2258" class="edge">
<title>gate_2_5&#45;&gt;expert_2_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5454.21,-5805.33C5454.21,-5786.14 5454.21,-5766 5454.21,-5766 5454.21,-5766 7054.38,-5766 7054.38,-5766 7054.38,-5766 7054.38,-5680.08 7054.38,-5680.08"/>
<polygon fill="blue" stroke="blue" points="7057.88,-5680.08 7054.38,-5670.08 7050.88,-5680.08 7057.88,-5680.08"/>
<text text-anchor="middle" x="23264.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23264.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU5→GPU8</text>
<text text-anchor="middle" x="23264.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23264.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_5&#45;&gt;expert_2_9_0 -->
<g id="edge2259" class="edge">
<title>gate_2_5&#45;&gt;expert_2_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5464.26,-5807.29C5464.26,-5784.51 5464.26,-5758 5464.26,-5758 5464.26,-5758 7737.82,-5758 7737.82,-5758 7737.82,-5758 7737.82,-5680.06 7737.82,-5680.06"/>
<polygon fill="blue" stroke="blue" points="7741.32,-5680.06 7737.82,-5670.06 7734.32,-5680.06 7741.32,-5680.06"/>
<text text-anchor="middle" x="23438.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23438.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU5→GPU9</text>
<text text-anchor="middle" x="23438.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23438.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_5&#45;&gt;expert_2_10_0 -->
<g id="edge2260" class="edge">
<title>gate_2_5&#45;&gt;expert_2_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5474.31,-5809.73C5474.31,-5784.71 5474.31,-5753 5474.31,-5753 5474.31,-5753 8318.88,-5753 8318.88,-5753 8318.88,-5753 8318.88,-5680.01 8318.88,-5680.01"/>
<polygon fill="blue" stroke="blue" points="8322.38,-5680.01 8318.88,-5670.01 8315.38,-5680.01 8322.38,-5680.01"/>
<text text-anchor="middle" x="23612.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23612.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU5→GPU10</text>
<text text-anchor="middle" x="23612.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23612.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_5&#45;&gt;expert_2_11_0 -->
<g id="edge2261" class="edge">
<title>gate_2_5&#45;&gt;expert_2_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5484.36,-5813.1C5484.36,-5776.55 5484.36,-5715 5484.36,-5715 5484.36,-5715 8905.88,-5715 8905.88,-5715 8905.88,-5715 8905.88,-5680.12 8905.88,-5680.12"/>
<polygon fill="blue" stroke="blue" points="8909.38,-5680.12 8905.88,-5670.12 8902.38,-5680.12 8909.38,-5680.12"/>
<text text-anchor="middle" x="23786.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23786.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU5→GPU11</text>
<text text-anchor="middle" x="23786.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23786.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_5&#45;&gt;expert_2_12_0 -->
<g id="edge2262" class="edge">
<title>gate_2_5&#45;&gt;expert_2_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5494.4,-5817.32C5494.4,-5779.6 5494.4,-5707 5494.4,-5707 5494.4,-5707 9504.24,-5707 9504.24,-5707 9504.24,-5707 9504.24,-5680.06 9504.24,-5680.06"/>
<polygon fill="blue" stroke="blue" points="9507.74,-5680.06 9504.24,-5670.06 9500.74,-5680.06 9507.74,-5680.06"/>
<text text-anchor="middle" x="23960.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23960.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU5→GPU12</text>
<text text-anchor="middle" x="23960.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23960.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_5&#45;&gt;expert_2_13_0 -->
<g id="edge2263" class="edge">
<title>gate_2_5&#45;&gt;expert_2_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5504.45,-5823.5C5504.45,-5786.86 5504.45,-5700 5504.45,-5700 5504.45,-5700 10100.78,-5700 10100.78,-5700 10100.78,-5700 10100.78,-5680.1 10100.78,-5680.1"/>
<polygon fill="blue" stroke="blue" points="10104.28,-5680.1 10100.78,-5670.1 10097.28,-5680.1 10104.28,-5680.1"/>
<text text-anchor="middle" x="24134.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="24134.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU5→GPU13</text>
<text text-anchor="middle" x="24134.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="24134.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_5&#45;&gt;expert_2_14_0 -->
<g id="edge2264" class="edge">
<title>gate_2_5&#45;&gt;expert_2_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5461.75,-5872.12C5461.75,-5882.34 5461.75,-5891 5461.75,-5891 5461.75,-5891 10583.8,-5891 10583.8,-5891 10583.8,-5891 10583.8,-5680.46 10583.8,-5680.46"/>
<polygon fill="blue" stroke="blue" points="10587.3,-5680.46 10583.8,-5670.46 10580.3,-5680.46 10587.3,-5680.46"/>
<text text-anchor="middle" x="24308.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="24308.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU5→GPU14</text>
<text text-anchor="middle" x="24308.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="24308.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_5&#45;&gt;expert_2_15_0 -->
<g id="edge2265" class="edge">
<title>gate_2_5&#45;&gt;expert_2_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5409,-5877.2C5409,-5892.66 5409,-5907 5409,-5907 5409,-5907 11171.81,-5907 11171.81,-5907 11171.81,-5907 11171.81,-5680.22 11171.81,-5680.22"/>
<polygon fill="blue" stroke="blue" points="11175.31,-5680.22 11171.81,-5670.22 11168.31,-5680.22 11175.31,-5680.22"/>
<text text-anchor="middle" x="24482.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="24482.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU5→GPU15</text>
<text text-anchor="middle" x="24482.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="24482.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_5 -->
<g id="node562" class="node">
<title>expert_reduce_2_5</title>
<ellipse fill="none" stroke="black" cx="5409" cy="-5506.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="5409" y="-5517.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="5409" y="-5502.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="5409" y="-5487.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_5_0&#45;&gt;expert_reduce_2_5 -->
<g id="edge556" class="edge">
<title>expert_2_5_0&#45;&gt;expert_reduce_2_5</title>
<path fill="none" stroke="black" d="M5409,-5616.76C5409,-5616.76 5409,-5554.06 5409,-5554.06"/>
<polygon fill="black" stroke="black" points="5412.5,-5554.06 5409,-5544.06 5405.5,-5554.06 5412.5,-5554.06"/>
</g>
<!-- moe_residual_2_5 -->
<g id="node563" class="node">
<title>moe_residual_2_5</title>
<ellipse fill="none" stroke="black" cx="5409" cy="-5369" rx="105.5" ry="27"/>
<text text-anchor="middle" x="5409" y="-5372.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="5409" y="-5357.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_5&#45;&gt;moe_residual_2_5 -->
<g id="edge557" class="edge">
<title>expert_reduce_2_5&#45;&gt;moe_residual_2_5</title>
<path fill="none" stroke="black" d="M5409,-5468.93C5409,-5468.93 5409,-5406.06 5409,-5406.06"/>
<polygon fill="black" stroke="black" points="5412.5,-5406.06 5409,-5396.06 5405.5,-5406.06 5412.5,-5406.06"/>
</g>
<!-- qkv_proj_3_5 -->
<g id="node564" class="node">
<title>qkv_proj_3_5</title>
<polygon fill="none" stroke="black" points="5491.5,-5269 5326.5,-5269 5326.5,-5216 5491.5,-5216 5491.5,-5269"/>
<text text-anchor="middle" x="5409" y="-5253.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5409" y="-5238.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="5409" y="-5223.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_2_5&#45;&gt;qkv_proj_3_5 -->
<g id="edge558" class="edge">
<title>moe_residual_2_5&#45;&gt;qkv_proj_3_5</title>
<path fill="none" stroke="black" d="M5409,-5341.86C5409,-5341.86 5409,-5279.16 5409,-5279.16"/>
<polygon fill="black" stroke="black" points="5412.5,-5279.16 5409,-5269.16 5405.5,-5279.16 5412.5,-5279.16"/>
</g>
<!-- qkv_reshape_3_5 -->
<g id="node565" class="node">
<title>qkv_reshape_3_5</title>
<ellipse fill="none" stroke="black" cx="5409" cy="-5116" rx="148" ry="27"/>
<text text-anchor="middle" x="5409" y="-5119.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="5409" y="-5104.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_3_5&#45;&gt;qkv_reshape_3_5 -->
<g id="edge559" class="edge">
<title>qkv_proj_3_5&#45;&gt;qkv_reshape_3_5</title>
<path fill="none" stroke="black" d="M5409,-5215.98C5409,-5215.98 5409,-5153.36 5409,-5153.36"/>
<polygon fill="black" stroke="black" points="5412.5,-5153.36 5409,-5143.36 5405.5,-5153.36 5412.5,-5153.36"/>
</g>
<!-- qkv_reshape_3_5&#45;&gt;ring_attn_3_5_stage_0 -->
<g id="edge560" class="edge">
<title>qkv_reshape_3_5&#45;&gt;ring_attn_3_5_stage_0</title>
<path fill="none" stroke="black" d="M5409,-5088.72C5409,-5088.72 5409,-4982.16 5409,-4982.16"/>
<polygon fill="black" stroke="black" points="5412.5,-4982.16 5409,-4972.16 5405.5,-4982.16 5412.5,-4982.16"/>
</g>
<!-- ring_attn_3_5_stage_0&#45;&gt;ring_attn_3_5_stage_1 -->
<g id="edge561" class="edge">
<title>ring_attn_3_5_stage_0&#45;&gt;ring_attn_3_5_stage_1</title>
<path fill="none" stroke="black" d="M5409,-4835.87C5409,-4835.87 5409,-4729.25 5409,-4729.25"/>
<polygon fill="black" stroke="black" points="5412.5,-4729.25 5409,-4719.25 5405.5,-4729.25 5412.5,-4729.25"/>
</g>
<!-- ring_attn_3_6_stage_0 -->
<g id="node664" class="node">
<title>ring_attn_3_6_stage_0</title>
<polygon fill="yellow" stroke="black" points="5996,-4972 5787,-4904 5996,-4836 6205,-4904 5996,-4972"/>
<text text-anchor="middle" x="5996" y="-4922.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-4907.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="5996" y="-4892.8" font-family="Times,serif" font-size="14.00">Q[6]×K[6]×V[6]</text>
<text text-anchor="middle" x="5996" y="-4877.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_5_stage_0&#45;&gt;ring_attn_3_6_stage_0 -->
<g id="edge2266" class="edge">
<title>ring_attn_3_5_stage_0&#45;&gt;ring_attn_3_6_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-4904C5618.02,-4904 5776.86,-4904 5776.86,-4904"/>
<polygon fill="red" stroke="red" points="5776.86,-4907.5 5786.86,-4904 5776.86,-4900.5 5776.86,-4907.5"/>
</g>
<!-- ring_attn_3_5_stage_1&#45;&gt;ring_attn_3_5_stage_2 -->
<g id="edge562" class="edge">
<title>ring_attn_3_5_stage_1&#45;&gt;ring_attn_3_5_stage_2</title>
<path fill="none" stroke="black" d="M5409,-4582.87C5409,-4582.87 5409,-4476.25 5409,-4476.25"/>
<polygon fill="black" stroke="black" points="5412.5,-4476.25 5409,-4466.25 5405.5,-4476.25 5412.5,-4476.25"/>
</g>
<!-- ring_attn_3_6_stage_1 -->
<g id="node665" class="node">
<title>ring_attn_3_6_stage_1</title>
<polygon fill="yellow" stroke="black" points="5996,-4719 5787,-4651 5996,-4583 6205,-4651 5996,-4719"/>
<text text-anchor="middle" x="5996" y="-4669.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-4654.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="5996" y="-4639.8" font-family="Times,serif" font-size="14.00">Q[6]×K[5]×V[5]</text>
<text text-anchor="middle" x="5996" y="-4624.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_5_stage_1&#45;&gt;ring_attn_3_6_stage_1 -->
<g id="edge2267" class="edge">
<title>ring_attn_3_5_stage_1&#45;&gt;ring_attn_3_6_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-4651C5618.02,-4651 5776.86,-4651 5776.86,-4651"/>
<polygon fill="red" stroke="red" points="5776.86,-4654.5 5786.86,-4651 5776.86,-4647.5 5776.86,-4654.5"/>
</g>
<!-- ring_attn_3_5_stage_2&#45;&gt;ring_attn_3_5_stage_3 -->
<g id="edge563" class="edge">
<title>ring_attn_3_5_stage_2&#45;&gt;ring_attn_3_5_stage_3</title>
<path fill="none" stroke="black" d="M5409,-4329.87C5409,-4329.87 5409,-4223.25 5409,-4223.25"/>
<polygon fill="black" stroke="black" points="5412.5,-4223.25 5409,-4213.25 5405.5,-4223.25 5412.5,-4223.25"/>
</g>
<!-- ring_attn_3_6_stage_2 -->
<g id="node666" class="node">
<title>ring_attn_3_6_stage_2</title>
<polygon fill="yellow" stroke="black" points="5996,-4466 5787,-4398 5996,-4330 6205,-4398 5996,-4466"/>
<text text-anchor="middle" x="5996" y="-4416.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-4401.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="5996" y="-4386.8" font-family="Times,serif" font-size="14.00">Q[6]×K[4]×V[4]</text>
<text text-anchor="middle" x="5996" y="-4371.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_5_stage_2&#45;&gt;ring_attn_3_6_stage_2 -->
<g id="edge2268" class="edge">
<title>ring_attn_3_5_stage_2&#45;&gt;ring_attn_3_6_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-4398C5618.02,-4398 5776.86,-4398 5776.86,-4398"/>
<polygon fill="red" stroke="red" points="5776.86,-4401.5 5786.86,-4398 5776.86,-4394.5 5776.86,-4401.5"/>
</g>
<!-- ring_attn_3_5_stage_3&#45;&gt;ring_attn_3_5_stage_4 -->
<g id="edge564" class="edge">
<title>ring_attn_3_5_stage_3&#45;&gt;ring_attn_3_5_stage_4</title>
<path fill="none" stroke="black" d="M5409,-4076.87C5409,-4076.87 5409,-3970.25 5409,-3970.25"/>
<polygon fill="black" stroke="black" points="5412.5,-3970.25 5409,-3960.25 5405.5,-3970.25 5412.5,-3970.25"/>
</g>
<!-- ring_attn_3_6_stage_3 -->
<g id="node667" class="node">
<title>ring_attn_3_6_stage_3</title>
<polygon fill="yellow" stroke="black" points="5996,-4213 5787,-4145 5996,-4077 6205,-4145 5996,-4213"/>
<text text-anchor="middle" x="5996" y="-4163.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-4148.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="5996" y="-4133.8" font-family="Times,serif" font-size="14.00">Q[6]×K[3]×V[3]</text>
<text text-anchor="middle" x="5996" y="-4118.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_5_stage_3&#45;&gt;ring_attn_3_6_stage_3 -->
<g id="edge2269" class="edge">
<title>ring_attn_3_5_stage_3&#45;&gt;ring_attn_3_6_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-4145C5618.02,-4145 5776.86,-4145 5776.86,-4145"/>
<polygon fill="red" stroke="red" points="5776.86,-4148.5 5786.86,-4145 5776.86,-4141.5 5776.86,-4148.5"/>
</g>
<!-- ring_attn_3_5_stage_4&#45;&gt;ring_attn_3_5_stage_5 -->
<g id="edge565" class="edge">
<title>ring_attn_3_5_stage_4&#45;&gt;ring_attn_3_5_stage_5</title>
<path fill="none" stroke="black" d="M5409,-3823.87C5409,-3823.87 5409,-3717.25 5409,-3717.25"/>
<polygon fill="black" stroke="black" points="5412.5,-3717.25 5409,-3707.25 5405.5,-3717.25 5412.5,-3717.25"/>
</g>
<!-- ring_attn_3_6_stage_4 -->
<g id="node668" class="node">
<title>ring_attn_3_6_stage_4</title>
<polygon fill="yellow" stroke="black" points="5996,-3960 5787,-3892 5996,-3824 6205,-3892 5996,-3960"/>
<text text-anchor="middle" x="5996" y="-3910.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-3895.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="5996" y="-3880.8" font-family="Times,serif" font-size="14.00">Q[6]×K[2]×V[2]</text>
<text text-anchor="middle" x="5996" y="-3865.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_5_stage_4&#45;&gt;ring_attn_3_6_stage_4 -->
<g id="edge2270" class="edge">
<title>ring_attn_3_5_stage_4&#45;&gt;ring_attn_3_6_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-3892C5618.02,-3892 5776.86,-3892 5776.86,-3892"/>
<polygon fill="red" stroke="red" points="5776.86,-3895.5 5786.86,-3892 5776.86,-3888.5 5776.86,-3895.5"/>
</g>
<!-- ring_attn_3_5_stage_5&#45;&gt;ring_attn_3_5_stage_6 -->
<g id="edge566" class="edge">
<title>ring_attn_3_5_stage_5&#45;&gt;ring_attn_3_5_stage_6</title>
<path fill="none" stroke="black" d="M5409,-3570.87C5409,-3570.87 5409,-3464.25 5409,-3464.25"/>
<polygon fill="black" stroke="black" points="5412.5,-3464.25 5409,-3454.25 5405.5,-3464.25 5412.5,-3464.25"/>
</g>
<!-- ring_attn_3_6_stage_5 -->
<g id="node669" class="node">
<title>ring_attn_3_6_stage_5</title>
<polygon fill="yellow" stroke="black" points="5996,-3707 5787,-3639 5996,-3571 6205,-3639 5996,-3707"/>
<text text-anchor="middle" x="5996" y="-3657.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-3642.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="5996" y="-3627.8" font-family="Times,serif" font-size="14.00">Q[6]×K[1]×V[1]</text>
<text text-anchor="middle" x="5996" y="-3612.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_5_stage_5&#45;&gt;ring_attn_3_6_stage_5 -->
<g id="edge2271" class="edge">
<title>ring_attn_3_5_stage_5&#45;&gt;ring_attn_3_6_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-3639C5618.02,-3639 5776.86,-3639 5776.86,-3639"/>
<polygon fill="red" stroke="red" points="5776.86,-3642.5 5786.86,-3639 5776.86,-3635.5 5776.86,-3642.5"/>
</g>
<!-- ring_attn_3_5_stage_6&#45;&gt;ring_attn_3_5_stage_7 -->
<g id="edge567" class="edge">
<title>ring_attn_3_5_stage_6&#45;&gt;ring_attn_3_5_stage_7</title>
<path fill="none" stroke="black" d="M5409,-3317.87C5409,-3317.87 5409,-3211.25 5409,-3211.25"/>
<polygon fill="black" stroke="black" points="5412.5,-3211.25 5409,-3201.25 5405.5,-3211.25 5412.5,-3211.25"/>
</g>
<!-- ring_attn_3_6_stage_6 -->
<g id="node670" class="node">
<title>ring_attn_3_6_stage_6</title>
<polygon fill="yellow" stroke="black" points="5996,-3454 5787,-3386 5996,-3318 6205,-3386 5996,-3454"/>
<text text-anchor="middle" x="5996" y="-3404.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-3389.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="5996" y="-3374.8" font-family="Times,serif" font-size="14.00">Q[6]×K[0]×V[0]</text>
<text text-anchor="middle" x="5996" y="-3359.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_5_stage_6&#45;&gt;ring_attn_3_6_stage_6 -->
<g id="edge2272" class="edge">
<title>ring_attn_3_5_stage_6&#45;&gt;ring_attn_3_6_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-3386C5618.02,-3386 5776.86,-3386 5776.86,-3386"/>
<polygon fill="red" stroke="red" points="5776.86,-3389.5 5786.86,-3386 5776.86,-3382.5 5776.86,-3389.5"/>
</g>
<!-- ring_attn_3_5_stage_7&#45;&gt;ring_attn_3_5_stage_8 -->
<g id="edge568" class="edge">
<title>ring_attn_3_5_stage_7&#45;&gt;ring_attn_3_5_stage_8</title>
<path fill="none" stroke="black" d="M5409,-3064.87C5409,-3064.87 5409,-2958.25 5409,-2958.25"/>
<polygon fill="black" stroke="black" points="5412.5,-2958.25 5409,-2948.25 5405.5,-2958.25 5412.5,-2958.25"/>
</g>
<!-- ring_attn_3_6_stage_7 -->
<g id="node671" class="node">
<title>ring_attn_3_6_stage_7</title>
<polygon fill="yellow" stroke="black" points="5996,-3201 5787,-3133 5996,-3065 6205,-3133 5996,-3201"/>
<text text-anchor="middle" x="5996" y="-3151.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-3136.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="5996" y="-3121.8" font-family="Times,serif" font-size="14.00">Q[6]×K[15]×V[15]</text>
<text text-anchor="middle" x="5996" y="-3106.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_5_stage_7&#45;&gt;ring_attn_3_6_stage_7 -->
<g id="edge2273" class="edge">
<title>ring_attn_3_5_stage_7&#45;&gt;ring_attn_3_6_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-3133C5618.02,-3133 5776.86,-3133 5776.86,-3133"/>
<polygon fill="red" stroke="red" points="5776.86,-3136.5 5786.86,-3133 5776.86,-3129.5 5776.86,-3136.5"/>
</g>
<!-- ring_attn_3_5_stage_8&#45;&gt;ring_attn_3_5_stage_9 -->
<g id="edge569" class="edge">
<title>ring_attn_3_5_stage_8&#45;&gt;ring_attn_3_5_stage_9</title>
<path fill="none" stroke="black" d="M5409,-2811.87C5409,-2811.87 5409,-2705.25 5409,-2705.25"/>
<polygon fill="black" stroke="black" points="5412.5,-2705.25 5409,-2695.25 5405.5,-2705.25 5412.5,-2705.25"/>
</g>
<!-- ring_attn_3_6_stage_8 -->
<g id="node672" class="node">
<title>ring_attn_3_6_stage_8</title>
<polygon fill="yellow" stroke="black" points="5996,-2948 5787,-2880 5996,-2812 6205,-2880 5996,-2948"/>
<text text-anchor="middle" x="5996" y="-2898.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-2883.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="5996" y="-2868.8" font-family="Times,serif" font-size="14.00">Q[6]×K[14]×V[14]</text>
<text text-anchor="middle" x="5996" y="-2853.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_5_stage_8&#45;&gt;ring_attn_3_6_stage_8 -->
<g id="edge2274" class="edge">
<title>ring_attn_3_5_stage_8&#45;&gt;ring_attn_3_6_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-2880C5618.02,-2880 5776.86,-2880 5776.86,-2880"/>
<polygon fill="red" stroke="red" points="5776.86,-2883.5 5786.86,-2880 5776.86,-2876.5 5776.86,-2883.5"/>
</g>
<!-- ring_attn_3_5_stage_9&#45;&gt;ring_attn_3_5_stage_10 -->
<g id="edge570" class="edge">
<title>ring_attn_3_5_stage_9&#45;&gt;ring_attn_3_5_stage_10</title>
<path fill="none" stroke="black" d="M5409,-2558.87C5409,-2558.87 5409,-2452.25 5409,-2452.25"/>
<polygon fill="black" stroke="black" points="5412.5,-2452.25 5409,-2442.25 5405.5,-2452.25 5412.5,-2452.25"/>
</g>
<!-- ring_attn_3_6_stage_9 -->
<g id="node673" class="node">
<title>ring_attn_3_6_stage_9</title>
<polygon fill="yellow" stroke="black" points="5996,-2695 5787,-2627 5996,-2559 6205,-2627 5996,-2695"/>
<text text-anchor="middle" x="5996" y="-2645.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-2630.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="5996" y="-2615.8" font-family="Times,serif" font-size="14.00">Q[6]×K[13]×V[13]</text>
<text text-anchor="middle" x="5996" y="-2600.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_5_stage_9&#45;&gt;ring_attn_3_6_stage_9 -->
<g id="edge2275" class="edge">
<title>ring_attn_3_5_stage_9&#45;&gt;ring_attn_3_6_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-2627C5618.02,-2627 5776.86,-2627 5776.86,-2627"/>
<polygon fill="red" stroke="red" points="5776.86,-2630.5 5786.86,-2627 5776.86,-2623.5 5776.86,-2630.5"/>
</g>
<!-- ring_attn_3_5_stage_10&#45;&gt;ring_attn_3_5_stage_11 -->
<g id="edge571" class="edge">
<title>ring_attn_3_5_stage_10&#45;&gt;ring_attn_3_5_stage_11</title>
<path fill="none" stroke="black" d="M5409,-2305.87C5409,-2305.87 5409,-2199.25 5409,-2199.25"/>
<polygon fill="black" stroke="black" points="5412.5,-2199.25 5409,-2189.25 5405.5,-2199.25 5412.5,-2199.25"/>
</g>
<!-- ring_attn_3_6_stage_10 -->
<g id="node674" class="node">
<title>ring_attn_3_6_stage_10</title>
<polygon fill="yellow" stroke="black" points="5996,-2442 5787,-2374 5996,-2306 6205,-2374 5996,-2442"/>
<text text-anchor="middle" x="5996" y="-2392.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-2377.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="5996" y="-2362.8" font-family="Times,serif" font-size="14.00">Q[6]×K[12]×V[12]</text>
<text text-anchor="middle" x="5996" y="-2347.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_5_stage_10&#45;&gt;ring_attn_3_6_stage_10 -->
<g id="edge2276" class="edge">
<title>ring_attn_3_5_stage_10&#45;&gt;ring_attn_3_6_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-2374C5618.02,-2374 5776.86,-2374 5776.86,-2374"/>
<polygon fill="red" stroke="red" points="5776.86,-2377.5 5786.86,-2374 5776.86,-2370.5 5776.86,-2377.5"/>
</g>
<!-- ring_attn_3_5_stage_11&#45;&gt;ring_attn_3_5_stage_12 -->
<g id="edge572" class="edge">
<title>ring_attn_3_5_stage_11&#45;&gt;ring_attn_3_5_stage_12</title>
<path fill="none" stroke="black" d="M5409,-2052.87C5409,-2052.87 5409,-1946.25 5409,-1946.25"/>
<polygon fill="black" stroke="black" points="5412.5,-1946.25 5409,-1936.25 5405.5,-1946.25 5412.5,-1946.25"/>
</g>
<!-- ring_attn_3_6_stage_11 -->
<g id="node675" class="node">
<title>ring_attn_3_6_stage_11</title>
<polygon fill="yellow" stroke="black" points="5996,-2189 5787,-2121 5996,-2053 6205,-2121 5996,-2189"/>
<text text-anchor="middle" x="5996" y="-2139.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-2124.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="5996" y="-2109.8" font-family="Times,serif" font-size="14.00">Q[6]×K[11]×V[11]</text>
<text text-anchor="middle" x="5996" y="-2094.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_5_stage_11&#45;&gt;ring_attn_3_6_stage_11 -->
<g id="edge2277" class="edge">
<title>ring_attn_3_5_stage_11&#45;&gt;ring_attn_3_6_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-2121C5618.02,-2121 5776.86,-2121 5776.86,-2121"/>
<polygon fill="red" stroke="red" points="5776.86,-2124.5 5786.86,-2121 5776.86,-2117.5 5776.86,-2124.5"/>
</g>
<!-- ring_attn_3_5_stage_12&#45;&gt;ring_attn_3_5_stage_13 -->
<g id="edge573" class="edge">
<title>ring_attn_3_5_stage_12&#45;&gt;ring_attn_3_5_stage_13</title>
<path fill="none" stroke="black" d="M5409,-1799.87C5409,-1799.87 5409,-1693.25 5409,-1693.25"/>
<polygon fill="black" stroke="black" points="5412.5,-1693.25 5409,-1683.25 5405.5,-1693.25 5412.5,-1693.25"/>
</g>
<!-- ring_attn_3_6_stage_12 -->
<g id="node676" class="node">
<title>ring_attn_3_6_stage_12</title>
<polygon fill="yellow" stroke="black" points="5996,-1936 5787,-1868 5996,-1800 6205,-1868 5996,-1936"/>
<text text-anchor="middle" x="5996" y="-1886.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-1871.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="5996" y="-1856.8" font-family="Times,serif" font-size="14.00">Q[6]×K[10]×V[10]</text>
<text text-anchor="middle" x="5996" y="-1841.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_5_stage_12&#45;&gt;ring_attn_3_6_stage_12 -->
<g id="edge2278" class="edge">
<title>ring_attn_3_5_stage_12&#45;&gt;ring_attn_3_6_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-1868C5618.02,-1868 5776.86,-1868 5776.86,-1868"/>
<polygon fill="red" stroke="red" points="5776.86,-1871.5 5786.86,-1868 5776.86,-1864.5 5776.86,-1871.5"/>
</g>
<!-- ring_attn_3_5_stage_13&#45;&gt;ring_attn_3_5_stage_14 -->
<g id="edge574" class="edge">
<title>ring_attn_3_5_stage_13&#45;&gt;ring_attn_3_5_stage_14</title>
<path fill="none" stroke="black" d="M5409,-1546.87C5409,-1546.87 5409,-1440.25 5409,-1440.25"/>
<polygon fill="black" stroke="black" points="5412.5,-1440.25 5409,-1430.25 5405.5,-1440.25 5412.5,-1440.25"/>
</g>
<!-- ring_attn_3_6_stage_13 -->
<g id="node677" class="node">
<title>ring_attn_3_6_stage_13</title>
<polygon fill="yellow" stroke="black" points="5996,-1683 5787,-1615 5996,-1547 6205,-1615 5996,-1683"/>
<text text-anchor="middle" x="5996" y="-1633.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-1618.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="5996" y="-1603.8" font-family="Times,serif" font-size="14.00">Q[6]×K[9]×V[9]</text>
<text text-anchor="middle" x="5996" y="-1588.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_5_stage_13&#45;&gt;ring_attn_3_6_stage_13 -->
<g id="edge2279" class="edge">
<title>ring_attn_3_5_stage_13&#45;&gt;ring_attn_3_6_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-1615C5618.02,-1615 5776.86,-1615 5776.86,-1615"/>
<polygon fill="red" stroke="red" points="5776.86,-1618.5 5786.86,-1615 5776.86,-1611.5 5776.86,-1618.5"/>
</g>
<!-- ring_attn_3_5_stage_14&#45;&gt;ring_attn_3_5_stage_15 -->
<g id="edge575" class="edge">
<title>ring_attn_3_5_stage_14&#45;&gt;ring_attn_3_5_stage_15</title>
<path fill="none" stroke="black" d="M5409,-1293.87C5409,-1293.87 5409,-1187.25 5409,-1187.25"/>
<polygon fill="black" stroke="black" points="5412.5,-1187.25 5409,-1177.25 5405.5,-1187.25 5412.5,-1187.25"/>
</g>
<!-- ring_attn_3_6_stage_14 -->
<g id="node678" class="node">
<title>ring_attn_3_6_stage_14</title>
<polygon fill="yellow" stroke="black" points="5996,-1430 5787,-1362 5996,-1294 6205,-1362 5996,-1430"/>
<text text-anchor="middle" x="5996" y="-1380.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-1365.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="5996" y="-1350.8" font-family="Times,serif" font-size="14.00">Q[6]×K[8]×V[8]</text>
<text text-anchor="middle" x="5996" y="-1335.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_5_stage_14&#45;&gt;ring_attn_3_6_stage_14 -->
<g id="edge2280" class="edge">
<title>ring_attn_3_5_stage_14&#45;&gt;ring_attn_3_6_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-1362C5618.02,-1362 5776.86,-1362 5776.86,-1362"/>
<polygon fill="red" stroke="red" points="5776.86,-1365.5 5786.86,-1362 5776.86,-1358.5 5776.86,-1365.5"/>
</g>
<!-- attn_out_3_5 -->
<g id="node582" class="node">
<title>attn_out_3_5</title>
<polygon fill="none" stroke="black" points="5478.5,-968 5339.5,-968 5339.5,-915 5478.5,-915 5478.5,-968"/>
<text text-anchor="middle" x="5409" y="-952.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="5409" y="-937.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="5409" y="-922.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_3_5_stage_15&#45;&gt;attn_out_3_5 -->
<g id="edge576" class="edge">
<title>ring_attn_3_5_stage_15&#45;&gt;attn_out_3_5</title>
<path fill="none" stroke="black" d="M5409,-1040.87C5409,-1040.87 5409,-978.18 5409,-978.18"/>
<polygon fill="black" stroke="black" points="5412.5,-978.18 5409,-968.18 5405.5,-978.18 5412.5,-978.18"/>
</g>
<!-- ring_attn_3_6_stage_15 -->
<g id="node679" class="node">
<title>ring_attn_3_6_stage_15</title>
<polygon fill="yellow" stroke="black" points="5996,-1177 5787,-1109 5996,-1041 6205,-1109 5996,-1177"/>
<text text-anchor="middle" x="5996" y="-1127.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="5996" y="-1112.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="5996" y="-1097.8" font-family="Times,serif" font-size="14.00">Q[6]×K[7]×V[7]</text>
<text text-anchor="middle" x="5996" y="-1082.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_5_stage_15&#45;&gt;ring_attn_3_6_stage_15 -->
<g id="edge2281" class="edge">
<title>ring_attn_3_5_stage_15&#45;&gt;ring_attn_3_6_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M5618.02,-1109C5618.02,-1109 5776.86,-1109 5776.86,-1109"/>
<polygon fill="red" stroke="red" points="5776.86,-1112.5 5786.86,-1109 5776.86,-1105.5 5776.86,-1112.5"/>
</g>
<!-- attn_residual_3_5 -->
<g id="node583" class="node">
<title>attn_residual_3_5</title>
<ellipse fill="none" stroke="black" cx="5409" cy="-815" rx="105.5" ry="27"/>
<text text-anchor="middle" x="5409" y="-818.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="5409" y="-803.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_3_5&#45;&gt;attn_residual_3_5 -->
<g id="edge577" class="edge">
<title>attn_out_3_5&#45;&gt;attn_residual_3_5</title>
<path fill="none" stroke="black" d="M5409,-914.98C5409,-914.98 5409,-852.36 5409,-852.36"/>
<polygon fill="black" stroke="black" points="5412.5,-852.36 5409,-842.36 5405.5,-852.36 5412.5,-852.36"/>
</g>
<!-- gate_3_5 -->
<g id="node584" class="node">
<title>gate_3_5</title>
<ellipse fill="orange" stroke="black" cx="5409" cy="-677.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="5409" y="-688.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="5409" y="-673.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="5409" y="-658.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_3_5&#45;&gt;gate_3_5 -->
<g id="edge578" class="edge">
<title>attn_residual_3_5&#45;&gt;gate_3_5</title>
<path fill="none" stroke="black" d="M5356.25,-791.36C5356.25,-791.36 5356.25,-720.08 5356.25,-720.08"/>
<polygon fill="black" stroke="black" points="5359.75,-720.08 5356.25,-710.08 5352.75,-720.08 5359.75,-720.08"/>
</g>
<!-- gate_3_5&#45;&gt;expert_3_0_0 -->
<g id="edge2282" class="edge">
<title>gate_3_5&#45;&gt;expert_3_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5313.55,-661.31C5313.55,-641.91 5313.55,-612 5313.55,-612 5313.55,-612 161.7,-612 161.7,-612 161.7,-612 161.7,-518.22 161.7,-518.22"/>
<polygon fill="blue" stroke="blue" points="165.2,-518.22 161.7,-508.22 158.2,-518.22 165.2,-518.22"/>
<text text-anchor="middle" x="22046.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22046.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU5→GPU0</text>
<text text-anchor="middle" x="22046.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22046.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_5&#45;&gt;expert_3_1_0 -->
<g id="edge2283" class="edge">
<title>gate_3_5&#45;&gt;expert_3_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5333.64,-651.21C5333.64,-632.26 5333.64,-610 5333.64,-610 5333.64,-610 2974.68,-610 2974.68,-610 2974.68,-610 2974.68,-518.13 2974.68,-518.13"/>
<polygon fill="blue" stroke="blue" points="2978.18,-518.13 2974.68,-508.13 2971.18,-518.13 2978.18,-518.13"/>
<text text-anchor="middle" x="22220.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22220.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU5→GPU1</text>
<text text-anchor="middle" x="22220.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22220.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_5&#45;&gt;expert_3_2_0 -->
<g id="edge2284" class="edge">
<title>gate_3_5&#45;&gt;expert_3_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5353.74,-645.52C5353.74,-630.14 5353.74,-615 5353.74,-615 5353.74,-615 3573.76,-615 3573.76,-615 3573.76,-615 3573.76,-518.19 3573.76,-518.19"/>
<polygon fill="blue" stroke="blue" points="3577.26,-518.19 3573.76,-508.19 3570.26,-518.19 3577.26,-518.19"/>
<text text-anchor="middle" x="22394.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22394.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU5→GPU2</text>
<text text-anchor="middle" x="22394.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22394.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_5&#45;&gt;expert_3_3_0 -->
<g id="edge2285" class="edge">
<title>gate_3_5&#45;&gt;expert_3_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5363.79,-643.23C5363.79,-637.83 5363.79,-634 5363.79,-634 5363.79,-634 4349.5,-634 4349.5,-634 4349.5,-634 4349.5,-518.06 4349.5,-518.06"/>
<polygon fill="blue" stroke="blue" points="4353,-518.06 4349.5,-508.06 4346,-518.06 4353,-518.06"/>
<text text-anchor="middle" x="22568.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22568.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU5→GPU3</text>
<text text-anchor="middle" x="22568.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22568.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_5&#45;&gt;expert_3_4_0 -->
<g id="edge2286" class="edge">
<title>gate_3_5&#45;&gt;expert_3_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5309.3,-690C5169.46,-690 4932,-690 4932,-690 4932,-690 4932,-518.33 4932,-518.33"/>
<polygon fill="blue" stroke="blue" points="4935.5,-518.33 4932,-508.33 4928.5,-518.33 4935.5,-518.33"/>
<text text-anchor="middle" x="22742.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22742.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU5→GPU4</text>
<text text-anchor="middle" x="22742.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22742.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_5&#45;&gt;expert_3_5_0 -->
<g id="edge579" class="edge">
<title>gate_3_5&#45;&gt;expert_3_5_0</title>
<path fill="none" stroke="black" d="M5373.83,-642.01C5373.83,-642.01 5373.83,-518.24 5373.83,-518.24"/>
<polygon fill="black" stroke="black" points="5377.33,-518.24 5373.83,-508.24 5370.33,-518.24 5377.33,-518.24"/>
</g>
<!-- gate_3_5&#45;&gt;expert_3_6_0 -->
<g id="edge2287" class="edge">
<title>gate_3_5&#45;&gt;expert_3_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5508.52,-665C5648.09,-665 5885.1,-665 5885.1,-665 5885.1,-665 5885.1,-518.18 5885.1,-518.18"/>
<polygon fill="blue" stroke="blue" points="5888.6,-518.18 5885.1,-508.18 5881.6,-518.18 5888.6,-518.18"/>
<text text-anchor="middle" x="22916.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="22916.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU5→GPU6</text>
<text text-anchor="middle" x="22916.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="22916.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_5&#45;&gt;expert_3_7_0 -->
<g id="edge2288" class="edge">
<title>gate_3_5&#45;&gt;expert_3_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5444.17,-642.04C5444.17,-630.69 5444.17,-621 5444.17,-621 5444.17,-621 6470.75,-621 6470.75,-621 6470.75,-621 6470.75,-518.07 6470.75,-518.07"/>
<polygon fill="blue" stroke="blue" points="6474.25,-518.07 6470.75,-508.07 6467.25,-518.07 6474.25,-518.07"/>
<text text-anchor="middle" x="23090.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23090.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU5→GPU7</text>
<text text-anchor="middle" x="23090.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23090.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_5&#45;&gt;expert_3_8_0 -->
<g id="edge2289" class="edge">
<title>gate_3_5&#45;&gt;expert_3_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5454.21,-643.33C5454.21,-624.14 5454.21,-604 5454.21,-604 5454.21,-604 7054.38,-604 7054.38,-604 7054.38,-604 7054.38,-518.08 7054.38,-518.08"/>
<polygon fill="blue" stroke="blue" points="7057.88,-518.08 7054.38,-508.08 7050.88,-518.08 7057.88,-518.08"/>
<text text-anchor="middle" x="23264.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23264.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU5→GPU8</text>
<text text-anchor="middle" x="23264.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23264.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_5&#45;&gt;expert_3_9_0 -->
<g id="edge2290" class="edge">
<title>gate_3_5&#45;&gt;expert_3_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5464.26,-645.29C5464.26,-622.51 5464.26,-596 5464.26,-596 5464.26,-596 7737.82,-596 7737.82,-596 7737.82,-596 7737.82,-518.06 7737.82,-518.06"/>
<polygon fill="blue" stroke="blue" points="7741.32,-518.06 7737.82,-508.06 7734.32,-518.06 7741.32,-518.06"/>
<text text-anchor="middle" x="23438.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23438.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU5→GPU9</text>
<text text-anchor="middle" x="23438.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23438.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_5&#45;&gt;expert_3_10_0 -->
<g id="edge2291" class="edge">
<title>gate_3_5&#45;&gt;expert_3_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5474.31,-647.73C5474.31,-622.71 5474.31,-591 5474.31,-591 5474.31,-591 8318.88,-591 8318.88,-591 8318.88,-591 8318.88,-518.01 8318.88,-518.01"/>
<polygon fill="blue" stroke="blue" points="8322.38,-518.01 8318.88,-508.01 8315.38,-518.01 8322.38,-518.01"/>
<text text-anchor="middle" x="23612.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23612.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU5→GPU10</text>
<text text-anchor="middle" x="23612.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23612.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_5&#45;&gt;expert_3_11_0 -->
<g id="edge2292" class="edge">
<title>gate_3_5&#45;&gt;expert_3_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5484.36,-651.1C5484.36,-614.55 5484.36,-553 5484.36,-553 5484.36,-553 8905.88,-553 8905.88,-553 8905.88,-553 8905.88,-518.12 8905.88,-518.12"/>
<polygon fill="blue" stroke="blue" points="8909.38,-518.12 8905.88,-508.12 8902.38,-518.12 8909.38,-518.12"/>
<text text-anchor="middle" x="23786.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23786.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU5→GPU11</text>
<text text-anchor="middle" x="23786.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23786.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_5&#45;&gt;expert_3_12_0 -->
<g id="edge2293" class="edge">
<title>gate_3_5&#45;&gt;expert_3_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5494.4,-655.32C5494.4,-617.6 5494.4,-545 5494.4,-545 5494.4,-545 9504.24,-545 9504.24,-545 9504.24,-545 9504.24,-518.06 9504.24,-518.06"/>
<polygon fill="blue" stroke="blue" points="9507.74,-518.06 9504.24,-508.06 9500.74,-518.06 9507.74,-518.06"/>
<text text-anchor="middle" x="23960.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="23960.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU5→GPU12</text>
<text text-anchor="middle" x="23960.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="23960.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_5&#45;&gt;expert_3_13_0 -->
<g id="edge2294" class="edge">
<title>gate_3_5&#45;&gt;expert_3_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5504.45,-661.5C5504.45,-624.86 5504.45,-538 5504.45,-538 5504.45,-538 10100.78,-538 10100.78,-538 10100.78,-538 10100.78,-518.1 10100.78,-518.1"/>
<polygon fill="blue" stroke="blue" points="10104.28,-518.1 10100.78,-508.1 10097.28,-518.1 10104.28,-518.1"/>
<text text-anchor="middle" x="24134.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="24134.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU5→GPU13</text>
<text text-anchor="middle" x="24134.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="24134.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_5&#45;&gt;expert_3_14_0 -->
<g id="edge2295" class="edge">
<title>gate_3_5&#45;&gt;expert_3_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5461.75,-710.12C5461.75,-720.34 5461.75,-729 5461.75,-729 5461.75,-729 10583.8,-729 10583.8,-729 10583.8,-729 10583.8,-518.46 10583.8,-518.46"/>
<polygon fill="blue" stroke="blue" points="10587.3,-518.46 10583.8,-508.46 10580.3,-518.46 10587.3,-518.46"/>
<text text-anchor="middle" x="24308.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="24308.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU5→GPU14</text>
<text text-anchor="middle" x="24308.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="24308.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_5&#45;&gt;expert_3_15_0 -->
<g id="edge2296" class="edge">
<title>gate_3_5&#45;&gt;expert_3_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5409,-715.2C5409,-730.66 5409,-745 5409,-745 5409,-745 11171.81,-745 11171.81,-745 11171.81,-745 11171.81,-518.22 11171.81,-518.22"/>
<polygon fill="blue" stroke="blue" points="11175.31,-518.22 11171.81,-508.22 11168.31,-518.22 11175.31,-518.22"/>
<text text-anchor="middle" x="24482.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="24482.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU5→GPU15</text>
<text text-anchor="middle" x="24482.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="24482.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_5 -->
<g id="node586" class="node">
<title>expert_reduce_3_5</title>
<ellipse fill="none" stroke="black" cx="5409" cy="-344.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="5409" y="-355.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="5409" y="-340.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="5409" y="-325.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_5_0&#45;&gt;expert_reduce_3_5 -->
<g id="edge580" class="edge">
<title>expert_3_5_0&#45;&gt;expert_reduce_3_5</title>
<path fill="none" stroke="black" d="M5409,-454.76C5409,-454.76 5409,-392.06 5409,-392.06"/>
<polygon fill="black" stroke="black" points="5412.5,-392.06 5409,-382.06 5405.5,-392.06 5412.5,-392.06"/>
</g>
<!-- moe_residual_3_5 -->
<g id="node587" class="node">
<title>moe_residual_3_5</title>
<ellipse fill="none" stroke="black" cx="5409" cy="-207" rx="105.5" ry="27"/>
<text text-anchor="middle" x="5409" y="-210.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="5409" y="-195.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_5&#45;&gt;moe_residual_3_5 -->
<g id="edge581" class="edge">
<title>expert_reduce_3_5&#45;&gt;moe_residual_3_5</title>
<path fill="none" stroke="black" d="M5409,-306.93C5409,-306.93 5409,-244.06 5409,-244.06"/>
<polygon fill="black" stroke="black" points="5412.5,-244.06 5409,-234.06 5405.5,-244.06 5412.5,-244.06"/>
</g>
<!-- output_5 -->
<g id="node588" class="node">
<title>output_5</title>
<polygon fill="lightcoral" stroke="black" points="5502,-107 5316,-107 5316,-69 5502,-69 5502,-107"/>
<text text-anchor="middle" x="5409" y="-91.8" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="5409" y="-76.8" font-family="Times,serif" font-size="14.00">Y[5]: 1024×1024×4096</text>
</g>
<!-- moe_residual_3_5&#45;&gt;output_5 -->
<g id="edge582" class="edge">
<title>moe_residual_3_5&#45;&gt;output_5</title>
<path fill="none" stroke="black" d="M5409,-180C5409,-180 5409,-117.12 5409,-117.12"/>
<polygon fill="black" stroke="black" points="5412.5,-117.12 5409,-107.12 5405.5,-117.12 5412.5,-117.12"/>
</g>
<!-- input_6 -->
<g id="node589" class="node">
<title>input_6</title>
<polygon fill="lightgreen" stroke="black" points="6089.5,-20866 5902.5,-20866 5902.5,-20828 6089.5,-20828 6089.5,-20866"/>
<text text-anchor="middle" x="5996" y="-20850.8" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="5996" y="-20835.8" font-family="Times,serif" font-size="14.00">X[6]: 1024×1024×4096</text>
</g>
<!-- qkv_proj_0_6 -->
<g id="node590" class="node">
<title>qkv_proj_0_6</title>
<polygon fill="none" stroke="black" points="6078.5,-20755 5913.5,-20755 5913.5,-20702 6078.5,-20702 6078.5,-20755"/>
<text text-anchor="middle" x="5996" y="-20739.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5996" y="-20724.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="5996" y="-20709.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- input_6&#45;&gt;qkv_proj_0_6 -->
<g id="edge583" class="edge">
<title>input_6&#45;&gt;qkv_proj_0_6</title>
<path fill="none" stroke="black" d="M5996,-20827.96C5996,-20827.96 5996,-20765.44 5996,-20765.44"/>
<polygon fill="black" stroke="black" points="5999.5,-20765.44 5996,-20755.44 5992.5,-20765.44 5999.5,-20765.44"/>
</g>
<!-- qkv_reshape_0_6 -->
<g id="node591" class="node">
<title>qkv_reshape_0_6</title>
<ellipse fill="none" stroke="black" cx="5996" cy="-20602" rx="148" ry="27"/>
<text text-anchor="middle" x="5996" y="-20605.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="5996" y="-20590.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_0_6&#45;&gt;qkv_reshape_0_6 -->
<g id="edge584" class="edge">
<title>qkv_proj_0_6&#45;&gt;qkv_reshape_0_6</title>
<path fill="none" stroke="black" d="M5996,-20701.98C5996,-20701.98 5996,-20639.36 5996,-20639.36"/>
<polygon fill="black" stroke="black" points="5999.5,-20639.36 5996,-20629.36 5992.5,-20639.36 5999.5,-20639.36"/>
</g>
<!-- qkv_reshape_0_6&#45;&gt;ring_attn_0_6_stage_0 -->
<g id="edge585" class="edge">
<title>qkv_reshape_0_6&#45;&gt;ring_attn_0_6_stage_0</title>
<path fill="none" stroke="black" d="M5996,-20574.72C5996,-20574.72 5996,-20468.16 5996,-20468.16"/>
<polygon fill="black" stroke="black" points="5999.5,-20468.16 5996,-20458.16 5992.5,-20468.16 5999.5,-20468.16"/>
</g>
<!-- ring_attn_0_6_stage_0&#45;&gt;ring_attn_0_6_stage_1 -->
<g id="edge586" class="edge">
<title>ring_attn_0_6_stage_0&#45;&gt;ring_attn_0_6_stage_1</title>
<path fill="none" stroke="black" d="M5996,-20321.87C5996,-20321.87 5996,-20215.25 5996,-20215.25"/>
<polygon fill="black" stroke="black" points="5999.5,-20215.25 5996,-20205.25 5992.5,-20215.25 5999.5,-20215.25"/>
</g>
<!-- ring_attn_0_7_stage_0 -->
<g id="node690" class="node">
<title>ring_attn_0_7_stage_0</title>
<polygon fill="yellow" stroke="black" points="6583,-20458 6374,-20390 6583,-20322 6792,-20390 6583,-20458"/>
<text text-anchor="middle" x="6583" y="-20408.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-20393.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="6583" y="-20378.8" font-family="Times,serif" font-size="14.00">Q[7]×K[7]×V[7]</text>
<text text-anchor="middle" x="6583" y="-20363.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_6_stage_0&#45;&gt;ring_attn_0_7_stage_0 -->
<g id="edge2297" class="edge">
<title>ring_attn_0_6_stage_0&#45;&gt;ring_attn_0_7_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-20390C6205.02,-20390 6363.86,-20390 6363.86,-20390"/>
<polygon fill="red" stroke="red" points="6363.86,-20393.5 6373.86,-20390 6363.86,-20386.5 6363.86,-20393.5"/>
</g>
<!-- ring_attn_0_6_stage_1&#45;&gt;ring_attn_0_6_stage_2 -->
<g id="edge587" class="edge">
<title>ring_attn_0_6_stage_1&#45;&gt;ring_attn_0_6_stage_2</title>
<path fill="none" stroke="black" d="M5996,-20068.87C5996,-20068.87 5996,-19962.25 5996,-19962.25"/>
<polygon fill="black" stroke="black" points="5999.5,-19962.25 5996,-19952.25 5992.5,-19962.25 5999.5,-19962.25"/>
</g>
<!-- ring_attn_0_7_stage_1 -->
<g id="node691" class="node">
<title>ring_attn_0_7_stage_1</title>
<polygon fill="yellow" stroke="black" points="6583,-20205 6374,-20137 6583,-20069 6792,-20137 6583,-20205"/>
<text text-anchor="middle" x="6583" y="-20155.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-20140.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="6583" y="-20125.8" font-family="Times,serif" font-size="14.00">Q[7]×K[6]×V[6]</text>
<text text-anchor="middle" x="6583" y="-20110.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_6_stage_1&#45;&gt;ring_attn_0_7_stage_1 -->
<g id="edge2298" class="edge">
<title>ring_attn_0_6_stage_1&#45;&gt;ring_attn_0_7_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-20137C6205.02,-20137 6363.86,-20137 6363.86,-20137"/>
<polygon fill="red" stroke="red" points="6363.86,-20140.5 6373.86,-20137 6363.86,-20133.5 6363.86,-20140.5"/>
</g>
<!-- ring_attn_0_6_stage_2&#45;&gt;ring_attn_0_6_stage_3 -->
<g id="edge588" class="edge">
<title>ring_attn_0_6_stage_2&#45;&gt;ring_attn_0_6_stage_3</title>
<path fill="none" stroke="black" d="M5996,-19815.87C5996,-19815.87 5996,-19709.25 5996,-19709.25"/>
<polygon fill="black" stroke="black" points="5999.5,-19709.25 5996,-19699.25 5992.5,-19709.25 5999.5,-19709.25"/>
</g>
<!-- ring_attn_0_7_stage_2 -->
<g id="node692" class="node">
<title>ring_attn_0_7_stage_2</title>
<polygon fill="yellow" stroke="black" points="6583,-19952 6374,-19884 6583,-19816 6792,-19884 6583,-19952"/>
<text text-anchor="middle" x="6583" y="-19902.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-19887.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="6583" y="-19872.8" font-family="Times,serif" font-size="14.00">Q[7]×K[5]×V[5]</text>
<text text-anchor="middle" x="6583" y="-19857.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_6_stage_2&#45;&gt;ring_attn_0_7_stage_2 -->
<g id="edge2299" class="edge">
<title>ring_attn_0_6_stage_2&#45;&gt;ring_attn_0_7_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-19884C6205.02,-19884 6363.86,-19884 6363.86,-19884"/>
<polygon fill="red" stroke="red" points="6363.86,-19887.5 6373.86,-19884 6363.86,-19880.5 6363.86,-19887.5"/>
</g>
<!-- ring_attn_0_6_stage_3&#45;&gt;ring_attn_0_6_stage_4 -->
<g id="edge589" class="edge">
<title>ring_attn_0_6_stage_3&#45;&gt;ring_attn_0_6_stage_4</title>
<path fill="none" stroke="black" d="M5996,-19562.87C5996,-19562.87 5996,-19456.25 5996,-19456.25"/>
<polygon fill="black" stroke="black" points="5999.5,-19456.25 5996,-19446.25 5992.5,-19456.25 5999.5,-19456.25"/>
</g>
<!-- ring_attn_0_7_stage_3 -->
<g id="node693" class="node">
<title>ring_attn_0_7_stage_3</title>
<polygon fill="yellow" stroke="black" points="6583,-19699 6374,-19631 6583,-19563 6792,-19631 6583,-19699"/>
<text text-anchor="middle" x="6583" y="-19649.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-19634.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="6583" y="-19619.8" font-family="Times,serif" font-size="14.00">Q[7]×K[4]×V[4]</text>
<text text-anchor="middle" x="6583" y="-19604.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_6_stage_3&#45;&gt;ring_attn_0_7_stage_3 -->
<g id="edge2300" class="edge">
<title>ring_attn_0_6_stage_3&#45;&gt;ring_attn_0_7_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-19631C6205.02,-19631 6363.86,-19631 6363.86,-19631"/>
<polygon fill="red" stroke="red" points="6363.86,-19634.5 6373.86,-19631 6363.86,-19627.5 6363.86,-19634.5"/>
</g>
<!-- ring_attn_0_6_stage_4&#45;&gt;ring_attn_0_6_stage_5 -->
<g id="edge590" class="edge">
<title>ring_attn_0_6_stage_4&#45;&gt;ring_attn_0_6_stage_5</title>
<path fill="none" stroke="black" d="M5996,-19309.87C5996,-19309.87 5996,-19203.25 5996,-19203.25"/>
<polygon fill="black" stroke="black" points="5999.5,-19203.25 5996,-19193.25 5992.5,-19203.25 5999.5,-19203.25"/>
</g>
<!-- ring_attn_0_7_stage_4 -->
<g id="node694" class="node">
<title>ring_attn_0_7_stage_4</title>
<polygon fill="yellow" stroke="black" points="6583,-19446 6374,-19378 6583,-19310 6792,-19378 6583,-19446"/>
<text text-anchor="middle" x="6583" y="-19396.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-19381.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="6583" y="-19366.8" font-family="Times,serif" font-size="14.00">Q[7]×K[3]×V[3]</text>
<text text-anchor="middle" x="6583" y="-19351.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_6_stage_4&#45;&gt;ring_attn_0_7_stage_4 -->
<g id="edge2301" class="edge">
<title>ring_attn_0_6_stage_4&#45;&gt;ring_attn_0_7_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-19378C6205.02,-19378 6363.86,-19378 6363.86,-19378"/>
<polygon fill="red" stroke="red" points="6363.86,-19381.5 6373.86,-19378 6363.86,-19374.5 6363.86,-19381.5"/>
</g>
<!-- ring_attn_0_6_stage_5&#45;&gt;ring_attn_0_6_stage_6 -->
<g id="edge591" class="edge">
<title>ring_attn_0_6_stage_5&#45;&gt;ring_attn_0_6_stage_6</title>
<path fill="none" stroke="black" d="M5996,-19056.87C5996,-19056.87 5996,-18950.25 5996,-18950.25"/>
<polygon fill="black" stroke="black" points="5999.5,-18950.25 5996,-18940.25 5992.5,-18950.25 5999.5,-18950.25"/>
</g>
<!-- ring_attn_0_7_stage_5 -->
<g id="node695" class="node">
<title>ring_attn_0_7_stage_5</title>
<polygon fill="yellow" stroke="black" points="6583,-19193 6374,-19125 6583,-19057 6792,-19125 6583,-19193"/>
<text text-anchor="middle" x="6583" y="-19143.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-19128.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="6583" y="-19113.8" font-family="Times,serif" font-size="14.00">Q[7]×K[2]×V[2]</text>
<text text-anchor="middle" x="6583" y="-19098.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_6_stage_5&#45;&gt;ring_attn_0_7_stage_5 -->
<g id="edge2302" class="edge">
<title>ring_attn_0_6_stage_5&#45;&gt;ring_attn_0_7_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-19125C6205.02,-19125 6363.86,-19125 6363.86,-19125"/>
<polygon fill="red" stroke="red" points="6363.86,-19128.5 6373.86,-19125 6363.86,-19121.5 6363.86,-19128.5"/>
</g>
<!-- ring_attn_0_6_stage_6&#45;&gt;ring_attn_0_6_stage_7 -->
<g id="edge592" class="edge">
<title>ring_attn_0_6_stage_6&#45;&gt;ring_attn_0_6_stage_7</title>
<path fill="none" stroke="black" d="M5996,-18803.87C5996,-18803.87 5996,-18697.25 5996,-18697.25"/>
<polygon fill="black" stroke="black" points="5999.5,-18697.25 5996,-18687.25 5992.5,-18697.25 5999.5,-18697.25"/>
</g>
<!-- ring_attn_0_7_stage_6 -->
<g id="node696" class="node">
<title>ring_attn_0_7_stage_6</title>
<polygon fill="yellow" stroke="black" points="6583,-18940 6374,-18872 6583,-18804 6792,-18872 6583,-18940"/>
<text text-anchor="middle" x="6583" y="-18890.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-18875.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="6583" y="-18860.8" font-family="Times,serif" font-size="14.00">Q[7]×K[1]×V[1]</text>
<text text-anchor="middle" x="6583" y="-18845.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_6_stage_6&#45;&gt;ring_attn_0_7_stage_6 -->
<g id="edge2303" class="edge">
<title>ring_attn_0_6_stage_6&#45;&gt;ring_attn_0_7_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-18872C6205.02,-18872 6363.86,-18872 6363.86,-18872"/>
<polygon fill="red" stroke="red" points="6363.86,-18875.5 6373.86,-18872 6363.86,-18868.5 6363.86,-18875.5"/>
</g>
<!-- ring_attn_0_6_stage_7&#45;&gt;ring_attn_0_6_stage_8 -->
<g id="edge593" class="edge">
<title>ring_attn_0_6_stage_7&#45;&gt;ring_attn_0_6_stage_8</title>
<path fill="none" stroke="black" d="M5996,-18550.87C5996,-18550.87 5996,-18444.25 5996,-18444.25"/>
<polygon fill="black" stroke="black" points="5999.5,-18444.25 5996,-18434.25 5992.5,-18444.25 5999.5,-18444.25"/>
</g>
<!-- ring_attn_0_7_stage_7 -->
<g id="node697" class="node">
<title>ring_attn_0_7_stage_7</title>
<polygon fill="yellow" stroke="black" points="6583,-18687 6374,-18619 6583,-18551 6792,-18619 6583,-18687"/>
<text text-anchor="middle" x="6583" y="-18637.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-18622.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="6583" y="-18607.8" font-family="Times,serif" font-size="14.00">Q[7]×K[0]×V[0]</text>
<text text-anchor="middle" x="6583" y="-18592.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_6_stage_7&#45;&gt;ring_attn_0_7_stage_7 -->
<g id="edge2304" class="edge">
<title>ring_attn_0_6_stage_7&#45;&gt;ring_attn_0_7_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-18619C6205.02,-18619 6363.86,-18619 6363.86,-18619"/>
<polygon fill="red" stroke="red" points="6363.86,-18622.5 6373.86,-18619 6363.86,-18615.5 6363.86,-18622.5"/>
</g>
<!-- ring_attn_0_6_stage_8&#45;&gt;ring_attn_0_6_stage_9 -->
<g id="edge594" class="edge">
<title>ring_attn_0_6_stage_8&#45;&gt;ring_attn_0_6_stage_9</title>
<path fill="none" stroke="black" d="M5996,-18297.87C5996,-18297.87 5996,-18191.25 5996,-18191.25"/>
<polygon fill="black" stroke="black" points="5999.5,-18191.25 5996,-18181.25 5992.5,-18191.25 5999.5,-18191.25"/>
</g>
<!-- ring_attn_0_7_stage_8 -->
<g id="node698" class="node">
<title>ring_attn_0_7_stage_8</title>
<polygon fill="yellow" stroke="black" points="6583,-18434 6374,-18366 6583,-18298 6792,-18366 6583,-18434"/>
<text text-anchor="middle" x="6583" y="-18384.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-18369.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="6583" y="-18354.8" font-family="Times,serif" font-size="14.00">Q[7]×K[15]×V[15]</text>
<text text-anchor="middle" x="6583" y="-18339.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_6_stage_8&#45;&gt;ring_attn_0_7_stage_8 -->
<g id="edge2305" class="edge">
<title>ring_attn_0_6_stage_8&#45;&gt;ring_attn_0_7_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-18366C6205.02,-18366 6363.86,-18366 6363.86,-18366"/>
<polygon fill="red" stroke="red" points="6363.86,-18369.5 6373.86,-18366 6363.86,-18362.5 6363.86,-18369.5"/>
</g>
<!-- ring_attn_0_6_stage_9&#45;&gt;ring_attn_0_6_stage_10 -->
<g id="edge595" class="edge">
<title>ring_attn_0_6_stage_9&#45;&gt;ring_attn_0_6_stage_10</title>
<path fill="none" stroke="black" d="M5996,-18044.87C5996,-18044.87 5996,-17938.25 5996,-17938.25"/>
<polygon fill="black" stroke="black" points="5999.5,-17938.25 5996,-17928.25 5992.5,-17938.25 5999.5,-17938.25"/>
</g>
<!-- ring_attn_0_7_stage_9 -->
<g id="node699" class="node">
<title>ring_attn_0_7_stage_9</title>
<polygon fill="yellow" stroke="black" points="6583,-18181 6374,-18113 6583,-18045 6792,-18113 6583,-18181"/>
<text text-anchor="middle" x="6583" y="-18131.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-18116.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="6583" y="-18101.8" font-family="Times,serif" font-size="14.00">Q[7]×K[14]×V[14]</text>
<text text-anchor="middle" x="6583" y="-18086.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_6_stage_9&#45;&gt;ring_attn_0_7_stage_9 -->
<g id="edge2306" class="edge">
<title>ring_attn_0_6_stage_9&#45;&gt;ring_attn_0_7_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-18113C6205.02,-18113 6363.86,-18113 6363.86,-18113"/>
<polygon fill="red" stroke="red" points="6363.86,-18116.5 6373.86,-18113 6363.86,-18109.5 6363.86,-18116.5"/>
</g>
<!-- ring_attn_0_6_stage_10&#45;&gt;ring_attn_0_6_stage_11 -->
<g id="edge596" class="edge">
<title>ring_attn_0_6_stage_10&#45;&gt;ring_attn_0_6_stage_11</title>
<path fill="none" stroke="black" d="M5996,-17791.87C5996,-17791.87 5996,-17685.25 5996,-17685.25"/>
<polygon fill="black" stroke="black" points="5999.5,-17685.25 5996,-17675.25 5992.5,-17685.25 5999.5,-17685.25"/>
</g>
<!-- ring_attn_0_7_stage_10 -->
<g id="node700" class="node">
<title>ring_attn_0_7_stage_10</title>
<polygon fill="yellow" stroke="black" points="6583,-17928 6374,-17860 6583,-17792 6792,-17860 6583,-17928"/>
<text text-anchor="middle" x="6583" y="-17878.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-17863.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="6583" y="-17848.8" font-family="Times,serif" font-size="14.00">Q[7]×K[13]×V[13]</text>
<text text-anchor="middle" x="6583" y="-17833.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_6_stage_10&#45;&gt;ring_attn_0_7_stage_10 -->
<g id="edge2307" class="edge">
<title>ring_attn_0_6_stage_10&#45;&gt;ring_attn_0_7_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-17860C6205.02,-17860 6363.86,-17860 6363.86,-17860"/>
<polygon fill="red" stroke="red" points="6363.86,-17863.5 6373.86,-17860 6363.86,-17856.5 6363.86,-17863.5"/>
</g>
<!-- ring_attn_0_6_stage_11&#45;&gt;ring_attn_0_6_stage_12 -->
<g id="edge597" class="edge">
<title>ring_attn_0_6_stage_11&#45;&gt;ring_attn_0_6_stage_12</title>
<path fill="none" stroke="black" d="M5996,-17538.87C5996,-17538.87 5996,-17432.25 5996,-17432.25"/>
<polygon fill="black" stroke="black" points="5999.5,-17432.25 5996,-17422.25 5992.5,-17432.25 5999.5,-17432.25"/>
</g>
<!-- ring_attn_0_7_stage_11 -->
<g id="node701" class="node">
<title>ring_attn_0_7_stage_11</title>
<polygon fill="yellow" stroke="black" points="6583,-17675 6374,-17607 6583,-17539 6792,-17607 6583,-17675"/>
<text text-anchor="middle" x="6583" y="-17625.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-17610.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="6583" y="-17595.8" font-family="Times,serif" font-size="14.00">Q[7]×K[12]×V[12]</text>
<text text-anchor="middle" x="6583" y="-17580.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_6_stage_11&#45;&gt;ring_attn_0_7_stage_11 -->
<g id="edge2308" class="edge">
<title>ring_attn_0_6_stage_11&#45;&gt;ring_attn_0_7_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-17607C6205.02,-17607 6363.86,-17607 6363.86,-17607"/>
<polygon fill="red" stroke="red" points="6363.86,-17610.5 6373.86,-17607 6363.86,-17603.5 6363.86,-17610.5"/>
</g>
<!-- ring_attn_0_6_stage_12&#45;&gt;ring_attn_0_6_stage_13 -->
<g id="edge598" class="edge">
<title>ring_attn_0_6_stage_12&#45;&gt;ring_attn_0_6_stage_13</title>
<path fill="none" stroke="black" d="M5996,-17285.87C5996,-17285.87 5996,-17179.25 5996,-17179.25"/>
<polygon fill="black" stroke="black" points="5999.5,-17179.25 5996,-17169.25 5992.5,-17179.25 5999.5,-17179.25"/>
</g>
<!-- ring_attn_0_7_stage_12 -->
<g id="node702" class="node">
<title>ring_attn_0_7_stage_12</title>
<polygon fill="yellow" stroke="black" points="6583,-17422 6374,-17354 6583,-17286 6792,-17354 6583,-17422"/>
<text text-anchor="middle" x="6583" y="-17372.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-17357.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="6583" y="-17342.8" font-family="Times,serif" font-size="14.00">Q[7]×K[11]×V[11]</text>
<text text-anchor="middle" x="6583" y="-17327.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_6_stage_12&#45;&gt;ring_attn_0_7_stage_12 -->
<g id="edge2309" class="edge">
<title>ring_attn_0_6_stage_12&#45;&gt;ring_attn_0_7_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-17354C6205.02,-17354 6363.86,-17354 6363.86,-17354"/>
<polygon fill="red" stroke="red" points="6363.86,-17357.5 6373.86,-17354 6363.86,-17350.5 6363.86,-17357.5"/>
</g>
<!-- ring_attn_0_6_stage_13&#45;&gt;ring_attn_0_6_stage_14 -->
<g id="edge599" class="edge">
<title>ring_attn_0_6_stage_13&#45;&gt;ring_attn_0_6_stage_14</title>
<path fill="none" stroke="black" d="M5996,-17032.87C5996,-17032.87 5996,-16926.25 5996,-16926.25"/>
<polygon fill="black" stroke="black" points="5999.5,-16926.25 5996,-16916.25 5992.5,-16926.25 5999.5,-16926.25"/>
</g>
<!-- ring_attn_0_7_stage_13 -->
<g id="node703" class="node">
<title>ring_attn_0_7_stage_13</title>
<polygon fill="yellow" stroke="black" points="6583,-17169 6374,-17101 6583,-17033 6792,-17101 6583,-17169"/>
<text text-anchor="middle" x="6583" y="-17119.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-17104.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="6583" y="-17089.8" font-family="Times,serif" font-size="14.00">Q[7]×K[10]×V[10]</text>
<text text-anchor="middle" x="6583" y="-17074.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_6_stage_13&#45;&gt;ring_attn_0_7_stage_13 -->
<g id="edge2310" class="edge">
<title>ring_attn_0_6_stage_13&#45;&gt;ring_attn_0_7_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-17101C6205.02,-17101 6363.86,-17101 6363.86,-17101"/>
<polygon fill="red" stroke="red" points="6363.86,-17104.5 6373.86,-17101 6363.86,-17097.5 6363.86,-17104.5"/>
</g>
<!-- ring_attn_0_6_stage_14&#45;&gt;ring_attn_0_6_stage_15 -->
<g id="edge600" class="edge">
<title>ring_attn_0_6_stage_14&#45;&gt;ring_attn_0_6_stage_15</title>
<path fill="none" stroke="black" d="M5996,-16779.87C5996,-16779.87 5996,-16673.25 5996,-16673.25"/>
<polygon fill="black" stroke="black" points="5999.5,-16673.25 5996,-16663.25 5992.5,-16673.25 5999.5,-16673.25"/>
</g>
<!-- ring_attn_0_7_stage_14 -->
<g id="node704" class="node">
<title>ring_attn_0_7_stage_14</title>
<polygon fill="yellow" stroke="black" points="6583,-16916 6374,-16848 6583,-16780 6792,-16848 6583,-16916"/>
<text text-anchor="middle" x="6583" y="-16866.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-16851.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="6583" y="-16836.8" font-family="Times,serif" font-size="14.00">Q[7]×K[9]×V[9]</text>
<text text-anchor="middle" x="6583" y="-16821.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_6_stage_14&#45;&gt;ring_attn_0_7_stage_14 -->
<g id="edge2311" class="edge">
<title>ring_attn_0_6_stage_14&#45;&gt;ring_attn_0_7_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-16848C6205.02,-16848 6363.86,-16848 6363.86,-16848"/>
<polygon fill="red" stroke="red" points="6363.86,-16851.5 6373.86,-16848 6363.86,-16844.5 6363.86,-16851.5"/>
</g>
<!-- attn_out_0_6 -->
<g id="node608" class="node">
<title>attn_out_0_6</title>
<polygon fill="none" stroke="black" points="6065.5,-16454 5926.5,-16454 5926.5,-16401 6065.5,-16401 6065.5,-16454"/>
<text text-anchor="middle" x="5996" y="-16438.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="5996" y="-16423.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="5996" y="-16408.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_0_6_stage_15&#45;&gt;attn_out_0_6 -->
<g id="edge601" class="edge">
<title>ring_attn_0_6_stage_15&#45;&gt;attn_out_0_6</title>
<path fill="none" stroke="black" d="M5996,-16526.87C5996,-16526.87 5996,-16464.18 5996,-16464.18"/>
<polygon fill="black" stroke="black" points="5999.5,-16464.18 5996,-16454.18 5992.5,-16464.18 5999.5,-16464.18"/>
</g>
<!-- ring_attn_0_7_stage_15 -->
<g id="node705" class="node">
<title>ring_attn_0_7_stage_15</title>
<polygon fill="yellow" stroke="black" points="6583,-16663 6374,-16595 6583,-16527 6792,-16595 6583,-16663"/>
<text text-anchor="middle" x="6583" y="-16613.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-16598.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="6583" y="-16583.8" font-family="Times,serif" font-size="14.00">Q[7]×K[8]×V[8]</text>
<text text-anchor="middle" x="6583" y="-16568.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_6_stage_15&#45;&gt;ring_attn_0_7_stage_15 -->
<g id="edge2312" class="edge">
<title>ring_attn_0_6_stage_15&#45;&gt;ring_attn_0_7_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-16595C6205.02,-16595 6363.86,-16595 6363.86,-16595"/>
<polygon fill="red" stroke="red" points="6363.86,-16598.5 6373.86,-16595 6363.86,-16591.5 6363.86,-16598.5"/>
</g>
<!-- attn_residual_0_6 -->
<g id="node609" class="node">
<title>attn_residual_0_6</title>
<ellipse fill="none" stroke="black" cx="5996" cy="-16301" rx="105.5" ry="27"/>
<text text-anchor="middle" x="5996" y="-16304.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="5996" y="-16289.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_0_6&#45;&gt;attn_residual_0_6 -->
<g id="edge602" class="edge">
<title>attn_out_0_6&#45;&gt;attn_residual_0_6</title>
<path fill="none" stroke="black" d="M5996,-16400.98C5996,-16400.98 5996,-16338.36 5996,-16338.36"/>
<polygon fill="black" stroke="black" points="5999.5,-16338.36 5996,-16328.36 5992.5,-16338.36 5999.5,-16338.36"/>
</g>
<!-- gate_0_6 -->
<g id="node610" class="node">
<title>gate_0_6</title>
<ellipse fill="orange" stroke="black" cx="5996" cy="-16163.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="5996" y="-16174.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="5996" y="-16159.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="5996" y="-16144.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_0_6&#45;&gt;gate_0_6 -->
<g id="edge603" class="edge">
<title>attn_residual_0_6&#45;&gt;gate_0_6</title>
<path fill="none" stroke="black" d="M5996,-16273.83C5996,-16273.83 5996,-16211.02 5996,-16211.02"/>
<polygon fill="black" stroke="black" points="5999.5,-16211.02 5996,-16201.02 5992.5,-16211.02 5999.5,-16211.02"/>
</g>
<!-- gate_0_6&#45;&gt;expert_0_0_0 -->
<g id="edge2313" class="edge">
<title>gate_0_6&#45;&gt;expert_0_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5943.25,-16196.21C5943.25,-16211.34 5943.25,-16226 5943.25,-16226 5943.25,-16226 336.29,-16226 336.29,-16226 336.29,-16226 336.29,-16004.19 336.29,-16004.19"/>
<polygon fill="blue" stroke="blue" points="339.79,-16004.19 336.29,-15994.19 332.79,-16004.19 339.79,-16004.19"/>
<text text-anchor="middle" x="24656.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="24656.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU6→GPU0</text>
<text text-anchor="middle" x="24656.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="24656.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_6&#45;&gt;expert_0_1_0 -->
<g id="edge2314" class="edge">
<title>gate_0_6&#45;&gt;expert_0_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5901.05,-16147.15C5901.05,-16126.32 5901.05,-16093 5901.05,-16093 5901.05,-16093 2984.27,-16093 2984.27,-16093 2984.27,-16093 2984.27,-16004.12 2984.27,-16004.12"/>
<polygon fill="blue" stroke="blue" points="2987.77,-16004.12 2984.27,-15994.12 2980.77,-16004.12 2987.77,-16004.12"/>
<text text-anchor="middle" x="24830.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="24830.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU6→GPU1</text>
<text text-anchor="middle" x="24830.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="24830.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_6&#45;&gt;expert_0_2_0 -->
<g id="edge2315" class="edge">
<title>gate_0_6&#45;&gt;expert_0_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5922.15,-16136.47C5922.15,-16116.22 5922.15,-16092 5922.15,-16092 5922.15,-16092 3581.57,-16092 3581.57,-16092 3581.57,-16092 3581.57,-16004.21 3581.57,-16004.21"/>
<polygon fill="blue" stroke="blue" points="3585.07,-16004.21 3581.57,-15994.21 3578.07,-16004.21 3585.07,-16004.21"/>
<text text-anchor="middle" x="25004.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25004.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU6→GPU2</text>
<text text-anchor="middle" x="25004.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25004.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_6&#45;&gt;expert_0_3_0 -->
<g id="edge2316" class="edge">
<title>gate_0_6&#45;&gt;expert_0_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5943.25,-16131.01C5943.25,-16115.38 5943.25,-16100 5943.25,-16100 5943.25,-16100 4171.7,-16100 4171.7,-16100 4171.7,-16100 4171.7,-16004.31 4171.7,-16004.31"/>
<polygon fill="blue" stroke="blue" points="4175.2,-16004.31 4171.7,-15994.31 4168.2,-16004.31 4175.2,-16004.31"/>
<text text-anchor="middle" x="25178.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25178.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU6→GPU3</text>
<text text-anchor="middle" x="25178.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25178.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_6&#45;&gt;expert_0_4_0 -->
<g id="edge2317" class="edge">
<title>gate_0_6&#45;&gt;expert_0_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5953.8,-16128.88C5953.8,-16123.13 5953.8,-16119 5953.8,-16119 5953.8,-16119 4936.5,-16119 4936.5,-16119 4936.5,-16119 4936.5,-16004.24 4936.5,-16004.24"/>
<polygon fill="blue" stroke="blue" points="4940,-16004.24 4936.5,-15994.24 4933,-16004.24 4940,-16004.24"/>
<text text-anchor="middle" x="25352.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25352.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU6→GPU4</text>
<text text-anchor="middle" x="25352.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25352.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_6&#45;&gt;expert_0_5_0 -->
<g id="edge2318" class="edge">
<title>gate_0_6&#45;&gt;expert_0_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5896.48,-16176C5757.26,-16176 5521.25,-16176 5521.25,-16176 5521.25,-16176 5521.25,-16004.33 5521.25,-16004.33"/>
<polygon fill="blue" stroke="blue" points="5524.75,-16004.33 5521.25,-15994.33 5517.75,-16004.33 5524.75,-16004.33"/>
<text text-anchor="middle" x="25526.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25526.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU6→GPU5</text>
<text text-anchor="middle" x="25526.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25526.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_6&#45;&gt;expert_0_6_0 -->
<g id="edge604" class="edge">
<title>gate_0_6&#45;&gt;expert_0_6_0</title>
<path fill="none" stroke="black" d="M5964.35,-16127.55C5964.35,-16127.55 5964.35,-16004.11 5964.35,-16004.11"/>
<polygon fill="black" stroke="black" points="5967.85,-16004.11 5964.35,-15994.11 5960.85,-16004.11 5967.85,-16004.11"/>
</g>
<!-- gate_0_6&#45;&gt;expert_0_7_0 -->
<g id="edge2319" class="edge">
<title>gate_0_6&#45;&gt;expert_0_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6095.65,-16151C6235.77,-16151 6474.12,-16151 6474.12,-16151 6474.12,-16151 6474.12,-16004.18 6474.12,-16004.18"/>
<polygon fill="blue" stroke="blue" points="6477.63,-16004.18 6474.12,-15994.18 6470.63,-16004.18 6477.63,-16004.18"/>
<text text-anchor="middle" x="25700.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25700.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU6→GPU7</text>
<text text-anchor="middle" x="25700.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25700.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_6&#45;&gt;expert_0_8_0 -->
<g id="edge2320" class="edge">
<title>gate_0_6&#45;&gt;expert_0_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6027.65,-16127.72C6027.65,-16116.5 6027.65,-16107 6027.65,-16107 6027.65,-16107 7057.75,-16107 7057.75,-16107 7057.75,-16107 7057.75,-16004.07 7057.75,-16004.07"/>
<polygon fill="blue" stroke="blue" points="7061.25,-16004.07 7057.75,-15994.07 7054.25,-16004.07 7061.25,-16004.07"/>
<text text-anchor="middle" x="25874.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25874.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU6→GPU8</text>
<text text-anchor="middle" x="25874.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25874.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_6&#45;&gt;expert_0_9_0 -->
<g id="edge2321" class="edge">
<title>gate_0_6&#45;&gt;expert_0_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6038.2,-16128.83C6038.2,-16108.2 6038.2,-16086 6038.2,-16086 6038.2,-16086 7641.38,-16086 7641.38,-16086 7641.38,-16086 7641.38,-16004.09 7641.38,-16004.09"/>
<polygon fill="blue" stroke="blue" points="7644.88,-16004.09 7641.38,-15994.09 7637.88,-16004.09 7644.88,-16004.09"/>
<text text-anchor="middle" x="26048.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26048.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU6→GPU9</text>
<text text-anchor="middle" x="26048.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26048.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_6&#45;&gt;expert_0_10_0 -->
<g id="edge2322" class="edge">
<title>gate_0_6&#45;&gt;expert_0_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6048.75,-16130.69C6048.75,-16106.58 6048.75,-16078 6048.75,-16078 6048.75,-16078 8338.98,-16078 8338.98,-16078 8338.98,-16078 8338.98,-16004.25 8338.98,-16004.25"/>
<polygon fill="blue" stroke="blue" points="8342.48,-16004.25 8338.98,-15994.25 8335.48,-16004.25 8342.48,-16004.25"/>
<text text-anchor="middle" x="26222.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26222.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU6→GPU10</text>
<text text-anchor="middle" x="26222.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26222.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_6&#45;&gt;expert_0_11_0 -->
<g id="edge2323" class="edge">
<title>gate_0_6&#45;&gt;expert_0_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6059.3,-16133.2C6059.3,-16107.23 6059.3,-16074 6059.3,-16074 6059.3,-16074 8925.98,-16074 8925.98,-16074 8925.98,-16074 8925.98,-16004.1 8925.98,-16004.1"/>
<polygon fill="blue" stroke="blue" points="8929.48,-16004.1 8925.98,-15994.1 8922.48,-16004.1 8929.48,-16004.1"/>
<text text-anchor="middle" x="26396.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26396.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU6→GPU11</text>
<text text-anchor="middle" x="26396.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26396.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_6&#45;&gt;expert_0_12_0 -->
<g id="edge2324" class="edge">
<title>gate_0_6&#45;&gt;expert_0_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6069.85,-16136.67C6069.85,-16099.54 6069.85,-16037 6069.85,-16037 6069.85,-16037 9522.59,-16037 9522.59,-16037 9522.59,-16037 9522.59,-16004.17 9522.59,-16004.17"/>
<polygon fill="blue" stroke="blue" points="9526.09,-16004.17 9522.59,-15994.17 9519.09,-16004.17 9526.09,-16004.17"/>
<text text-anchor="middle" x="26570.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26570.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU6→GPU12</text>
<text text-anchor="middle" x="26570.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26570.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_6&#45;&gt;expert_0_13_0 -->
<g id="edge2325" class="edge">
<title>gate_0_6&#45;&gt;expert_0_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6080.4,-16140.94C6080.4,-16101.69 6080.4,-16025 6080.4,-16025 6080.4,-16025 10117.66,-16025 10117.66,-16025 10117.66,-16025 10117.66,-16004.23 10117.66,-16004.23"/>
<polygon fill="blue" stroke="blue" points="10121.16,-16004.23 10117.66,-15994.23 10114.16,-16004.23 10121.16,-16004.23"/>
<text text-anchor="middle" x="26744.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26744.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU6→GPU13</text>
<text text-anchor="middle" x="26744.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26744.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_6&#45;&gt;expert_0_14_0 -->
<g id="edge2326" class="edge">
<title>gate_0_6&#45;&gt;expert_0_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6090.95,-16146.91C6090.95,-16110.34 6090.95,-16026 6090.95,-16026 6090.95,-16026 10676.93,-16026 10676.93,-16026 10676.93,-16026 10676.93,-16004.01 10676.93,-16004.01"/>
<polygon fill="blue" stroke="blue" points="10680.43,-16004.01 10676.93,-15994.01 10673.43,-16004.01 10680.43,-16004.01"/>
<text text-anchor="middle" x="26918.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26918.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU6→GPU14</text>
<text text-anchor="middle" x="26918.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26918.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_6&#45;&gt;expert_0_15_0 -->
<g id="edge2327" class="edge">
<title>gate_0_6&#45;&gt;expert_0_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6048.75,-16196.16C6048.75,-16207.3 6048.75,-16217 6048.75,-16217 6048.75,-16217 11170.12,-16217 11170.12,-16217 11170.12,-16217 11170.12,-16004.2 11170.12,-16004.2"/>
<polygon fill="blue" stroke="blue" points="11173.63,-16004.2 11170.12,-15994.2 11166.63,-16004.2 11173.63,-16004.2"/>
<text text-anchor="middle" x="27092.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27092.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU6→GPU15</text>
<text text-anchor="middle" x="27092.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27092.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_6 -->
<g id="node612" class="node">
<title>expert_reduce_0_6</title>
<ellipse fill="none" stroke="black" cx="5996" cy="-15830.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="5996" y="-15841.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="5996" y="-15826.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="5996" y="-15811.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_6_0&#45;&gt;expert_reduce_0_6 -->
<g id="edge605" class="edge">
<title>expert_0_6_0&#45;&gt;expert_reduce_0_6</title>
<path fill="none" stroke="black" d="M5996,-15940.76C5996,-15940.76 5996,-15878.06 5996,-15878.06"/>
<polygon fill="black" stroke="black" points="5999.5,-15878.06 5996,-15868.06 5992.5,-15878.06 5999.5,-15878.06"/>
</g>
<!-- moe_residual_0_6 -->
<g id="node613" class="node">
<title>moe_residual_0_6</title>
<ellipse fill="none" stroke="black" cx="5996" cy="-15693" rx="105.5" ry="27"/>
<text text-anchor="middle" x="5996" y="-15696.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="5996" y="-15681.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_6&#45;&gt;moe_residual_0_6 -->
<g id="edge606" class="edge">
<title>expert_reduce_0_6&#45;&gt;moe_residual_0_6</title>
<path fill="none" stroke="black" d="M5996,-15792.93C5996,-15792.93 5996,-15730.06 5996,-15730.06"/>
<polygon fill="black" stroke="black" points="5999.5,-15730.06 5996,-15720.06 5992.5,-15730.06 5999.5,-15730.06"/>
</g>
<!-- qkv_proj_1_6 -->
<g id="node614" class="node">
<title>qkv_proj_1_6</title>
<polygon fill="none" stroke="black" points="6078.5,-15593 5913.5,-15593 5913.5,-15540 6078.5,-15540 6078.5,-15593"/>
<text text-anchor="middle" x="5996" y="-15577.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5996" y="-15562.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="5996" y="-15547.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_0_6&#45;&gt;qkv_proj_1_6 -->
<g id="edge607" class="edge">
<title>moe_residual_0_6&#45;&gt;qkv_proj_1_6</title>
<path fill="none" stroke="black" d="M5996,-15665.86C5996,-15665.86 5996,-15603.16 5996,-15603.16"/>
<polygon fill="black" stroke="black" points="5999.5,-15603.16 5996,-15593.16 5992.5,-15603.16 5999.5,-15603.16"/>
</g>
<!-- qkv_reshape_1_6 -->
<g id="node615" class="node">
<title>qkv_reshape_1_6</title>
<ellipse fill="none" stroke="black" cx="5996" cy="-15440" rx="148" ry="27"/>
<text text-anchor="middle" x="5996" y="-15443.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="5996" y="-15428.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_1_6&#45;&gt;qkv_reshape_1_6 -->
<g id="edge608" class="edge">
<title>qkv_proj_1_6&#45;&gt;qkv_reshape_1_6</title>
<path fill="none" stroke="black" d="M5996,-15539.98C5996,-15539.98 5996,-15477.36 5996,-15477.36"/>
<polygon fill="black" stroke="black" points="5999.5,-15477.36 5996,-15467.36 5992.5,-15477.36 5999.5,-15477.36"/>
</g>
<!-- qkv_reshape_1_6&#45;&gt;ring_attn_1_6_stage_0 -->
<g id="edge609" class="edge">
<title>qkv_reshape_1_6&#45;&gt;ring_attn_1_6_stage_0</title>
<path fill="none" stroke="black" d="M5996,-15412.72C5996,-15412.72 5996,-15306.16 5996,-15306.16"/>
<polygon fill="black" stroke="black" points="5999.5,-15306.16 5996,-15296.16 5992.5,-15306.16 5999.5,-15306.16"/>
</g>
<!-- ring_attn_1_6_stage_0&#45;&gt;ring_attn_1_6_stage_1 -->
<g id="edge610" class="edge">
<title>ring_attn_1_6_stage_0&#45;&gt;ring_attn_1_6_stage_1</title>
<path fill="none" stroke="black" d="M5996,-15159.87C5996,-15159.87 5996,-15053.25 5996,-15053.25"/>
<polygon fill="black" stroke="black" points="5999.5,-15053.25 5996,-15043.25 5992.5,-15053.25 5999.5,-15053.25"/>
</g>
<!-- ring_attn_1_7_stage_0 -->
<g id="node714" class="node">
<title>ring_attn_1_7_stage_0</title>
<polygon fill="yellow" stroke="black" points="6583,-15296 6374,-15228 6583,-15160 6792,-15228 6583,-15296"/>
<text text-anchor="middle" x="6583" y="-15246.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-15231.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="6583" y="-15216.8" font-family="Times,serif" font-size="14.00">Q[7]×K[7]×V[7]</text>
<text text-anchor="middle" x="6583" y="-15201.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_6_stage_0&#45;&gt;ring_attn_1_7_stage_0 -->
<g id="edge2328" class="edge">
<title>ring_attn_1_6_stage_0&#45;&gt;ring_attn_1_7_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-15228C6205.02,-15228 6363.86,-15228 6363.86,-15228"/>
<polygon fill="red" stroke="red" points="6363.86,-15231.5 6373.86,-15228 6363.86,-15224.5 6363.86,-15231.5"/>
</g>
<!-- ring_attn_1_6_stage_1&#45;&gt;ring_attn_1_6_stage_2 -->
<g id="edge611" class="edge">
<title>ring_attn_1_6_stage_1&#45;&gt;ring_attn_1_6_stage_2</title>
<path fill="none" stroke="black" d="M5996,-14906.87C5996,-14906.87 5996,-14800.25 5996,-14800.25"/>
<polygon fill="black" stroke="black" points="5999.5,-14800.25 5996,-14790.25 5992.5,-14800.25 5999.5,-14800.25"/>
</g>
<!-- ring_attn_1_7_stage_1 -->
<g id="node715" class="node">
<title>ring_attn_1_7_stage_1</title>
<polygon fill="yellow" stroke="black" points="6583,-15043 6374,-14975 6583,-14907 6792,-14975 6583,-15043"/>
<text text-anchor="middle" x="6583" y="-14993.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-14978.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="6583" y="-14963.8" font-family="Times,serif" font-size="14.00">Q[7]×K[6]×V[6]</text>
<text text-anchor="middle" x="6583" y="-14948.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_6_stage_1&#45;&gt;ring_attn_1_7_stage_1 -->
<g id="edge2329" class="edge">
<title>ring_attn_1_6_stage_1&#45;&gt;ring_attn_1_7_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-14975C6205.02,-14975 6363.86,-14975 6363.86,-14975"/>
<polygon fill="red" stroke="red" points="6363.86,-14978.5 6373.86,-14975 6363.86,-14971.5 6363.86,-14978.5"/>
</g>
<!-- ring_attn_1_6_stage_2&#45;&gt;ring_attn_1_6_stage_3 -->
<g id="edge612" class="edge">
<title>ring_attn_1_6_stage_2&#45;&gt;ring_attn_1_6_stage_3</title>
<path fill="none" stroke="black" d="M5996,-14653.87C5996,-14653.87 5996,-14547.25 5996,-14547.25"/>
<polygon fill="black" stroke="black" points="5999.5,-14547.25 5996,-14537.25 5992.5,-14547.25 5999.5,-14547.25"/>
</g>
<!-- ring_attn_1_7_stage_2 -->
<g id="node716" class="node">
<title>ring_attn_1_7_stage_2</title>
<polygon fill="yellow" stroke="black" points="6583,-14790 6374,-14722 6583,-14654 6792,-14722 6583,-14790"/>
<text text-anchor="middle" x="6583" y="-14740.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-14725.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="6583" y="-14710.8" font-family="Times,serif" font-size="14.00">Q[7]×K[5]×V[5]</text>
<text text-anchor="middle" x="6583" y="-14695.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_6_stage_2&#45;&gt;ring_attn_1_7_stage_2 -->
<g id="edge2330" class="edge">
<title>ring_attn_1_6_stage_2&#45;&gt;ring_attn_1_7_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-14722C6205.02,-14722 6363.86,-14722 6363.86,-14722"/>
<polygon fill="red" stroke="red" points="6363.86,-14725.5 6373.86,-14722 6363.86,-14718.5 6363.86,-14725.5"/>
</g>
<!-- ring_attn_1_6_stage_3&#45;&gt;ring_attn_1_6_stage_4 -->
<g id="edge613" class="edge">
<title>ring_attn_1_6_stage_3&#45;&gt;ring_attn_1_6_stage_4</title>
<path fill="none" stroke="black" d="M5996,-14400.87C5996,-14400.87 5996,-14294.25 5996,-14294.25"/>
<polygon fill="black" stroke="black" points="5999.5,-14294.25 5996,-14284.25 5992.5,-14294.25 5999.5,-14294.25"/>
</g>
<!-- ring_attn_1_7_stage_3 -->
<g id="node717" class="node">
<title>ring_attn_1_7_stage_3</title>
<polygon fill="yellow" stroke="black" points="6583,-14537 6374,-14469 6583,-14401 6792,-14469 6583,-14537"/>
<text text-anchor="middle" x="6583" y="-14487.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-14472.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="6583" y="-14457.8" font-family="Times,serif" font-size="14.00">Q[7]×K[4]×V[4]</text>
<text text-anchor="middle" x="6583" y="-14442.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_6_stage_3&#45;&gt;ring_attn_1_7_stage_3 -->
<g id="edge2331" class="edge">
<title>ring_attn_1_6_stage_3&#45;&gt;ring_attn_1_7_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-14469C6205.02,-14469 6363.86,-14469 6363.86,-14469"/>
<polygon fill="red" stroke="red" points="6363.86,-14472.5 6373.86,-14469 6363.86,-14465.5 6363.86,-14472.5"/>
</g>
<!-- ring_attn_1_6_stage_4&#45;&gt;ring_attn_1_6_stage_5 -->
<g id="edge614" class="edge">
<title>ring_attn_1_6_stage_4&#45;&gt;ring_attn_1_6_stage_5</title>
<path fill="none" stroke="black" d="M5996,-14147.87C5996,-14147.87 5996,-14041.25 5996,-14041.25"/>
<polygon fill="black" stroke="black" points="5999.5,-14041.25 5996,-14031.25 5992.5,-14041.25 5999.5,-14041.25"/>
</g>
<!-- ring_attn_1_7_stage_4 -->
<g id="node718" class="node">
<title>ring_attn_1_7_stage_4</title>
<polygon fill="yellow" stroke="black" points="6583,-14284 6374,-14216 6583,-14148 6792,-14216 6583,-14284"/>
<text text-anchor="middle" x="6583" y="-14234.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-14219.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="6583" y="-14204.8" font-family="Times,serif" font-size="14.00">Q[7]×K[3]×V[3]</text>
<text text-anchor="middle" x="6583" y="-14189.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_6_stage_4&#45;&gt;ring_attn_1_7_stage_4 -->
<g id="edge2332" class="edge">
<title>ring_attn_1_6_stage_4&#45;&gt;ring_attn_1_7_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-14216C6205.02,-14216 6363.86,-14216 6363.86,-14216"/>
<polygon fill="red" stroke="red" points="6363.86,-14219.5 6373.86,-14216 6363.86,-14212.5 6363.86,-14219.5"/>
</g>
<!-- ring_attn_1_6_stage_5&#45;&gt;ring_attn_1_6_stage_6 -->
<g id="edge615" class="edge">
<title>ring_attn_1_6_stage_5&#45;&gt;ring_attn_1_6_stage_6</title>
<path fill="none" stroke="black" d="M5996,-13894.87C5996,-13894.87 5996,-13788.25 5996,-13788.25"/>
<polygon fill="black" stroke="black" points="5999.5,-13788.25 5996,-13778.25 5992.5,-13788.25 5999.5,-13788.25"/>
</g>
<!-- ring_attn_1_7_stage_5 -->
<g id="node719" class="node">
<title>ring_attn_1_7_stage_5</title>
<polygon fill="yellow" stroke="black" points="6583,-14031 6374,-13963 6583,-13895 6792,-13963 6583,-14031"/>
<text text-anchor="middle" x="6583" y="-13981.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-13966.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="6583" y="-13951.8" font-family="Times,serif" font-size="14.00">Q[7]×K[2]×V[2]</text>
<text text-anchor="middle" x="6583" y="-13936.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_6_stage_5&#45;&gt;ring_attn_1_7_stage_5 -->
<g id="edge2333" class="edge">
<title>ring_attn_1_6_stage_5&#45;&gt;ring_attn_1_7_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-13963C6205.02,-13963 6363.86,-13963 6363.86,-13963"/>
<polygon fill="red" stroke="red" points="6363.86,-13966.5 6373.86,-13963 6363.86,-13959.5 6363.86,-13966.5"/>
</g>
<!-- ring_attn_1_6_stage_6&#45;&gt;ring_attn_1_6_stage_7 -->
<g id="edge616" class="edge">
<title>ring_attn_1_6_stage_6&#45;&gt;ring_attn_1_6_stage_7</title>
<path fill="none" stroke="black" d="M5996,-13641.87C5996,-13641.87 5996,-13535.25 5996,-13535.25"/>
<polygon fill="black" stroke="black" points="5999.5,-13535.25 5996,-13525.25 5992.5,-13535.25 5999.5,-13535.25"/>
</g>
<!-- ring_attn_1_7_stage_6 -->
<g id="node720" class="node">
<title>ring_attn_1_7_stage_6</title>
<polygon fill="yellow" stroke="black" points="6583,-13778 6374,-13710 6583,-13642 6792,-13710 6583,-13778"/>
<text text-anchor="middle" x="6583" y="-13728.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-13713.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="6583" y="-13698.8" font-family="Times,serif" font-size="14.00">Q[7]×K[1]×V[1]</text>
<text text-anchor="middle" x="6583" y="-13683.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_6_stage_6&#45;&gt;ring_attn_1_7_stage_6 -->
<g id="edge2334" class="edge">
<title>ring_attn_1_6_stage_6&#45;&gt;ring_attn_1_7_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-13710C6205.02,-13710 6363.86,-13710 6363.86,-13710"/>
<polygon fill="red" stroke="red" points="6363.86,-13713.5 6373.86,-13710 6363.86,-13706.5 6363.86,-13713.5"/>
</g>
<!-- ring_attn_1_6_stage_7&#45;&gt;ring_attn_1_6_stage_8 -->
<g id="edge617" class="edge">
<title>ring_attn_1_6_stage_7&#45;&gt;ring_attn_1_6_stage_8</title>
<path fill="none" stroke="black" d="M5996,-13388.87C5996,-13388.87 5996,-13282.25 5996,-13282.25"/>
<polygon fill="black" stroke="black" points="5999.5,-13282.25 5996,-13272.25 5992.5,-13282.25 5999.5,-13282.25"/>
</g>
<!-- ring_attn_1_7_stage_7 -->
<g id="node721" class="node">
<title>ring_attn_1_7_stage_7</title>
<polygon fill="yellow" stroke="black" points="6583,-13525 6374,-13457 6583,-13389 6792,-13457 6583,-13525"/>
<text text-anchor="middle" x="6583" y="-13475.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-13460.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="6583" y="-13445.8" font-family="Times,serif" font-size="14.00">Q[7]×K[0]×V[0]</text>
<text text-anchor="middle" x="6583" y="-13430.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_6_stage_7&#45;&gt;ring_attn_1_7_stage_7 -->
<g id="edge2335" class="edge">
<title>ring_attn_1_6_stage_7&#45;&gt;ring_attn_1_7_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-13457C6205.02,-13457 6363.86,-13457 6363.86,-13457"/>
<polygon fill="red" stroke="red" points="6363.86,-13460.5 6373.86,-13457 6363.86,-13453.5 6363.86,-13460.5"/>
</g>
<!-- ring_attn_1_6_stage_8&#45;&gt;ring_attn_1_6_stage_9 -->
<g id="edge618" class="edge">
<title>ring_attn_1_6_stage_8&#45;&gt;ring_attn_1_6_stage_9</title>
<path fill="none" stroke="black" d="M5996,-13135.87C5996,-13135.87 5996,-13029.25 5996,-13029.25"/>
<polygon fill="black" stroke="black" points="5999.5,-13029.25 5996,-13019.25 5992.5,-13029.25 5999.5,-13029.25"/>
</g>
<!-- ring_attn_1_7_stage_8 -->
<g id="node722" class="node">
<title>ring_attn_1_7_stage_8</title>
<polygon fill="yellow" stroke="black" points="6583,-13272 6374,-13204 6583,-13136 6792,-13204 6583,-13272"/>
<text text-anchor="middle" x="6583" y="-13222.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-13207.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="6583" y="-13192.8" font-family="Times,serif" font-size="14.00">Q[7]×K[15]×V[15]</text>
<text text-anchor="middle" x="6583" y="-13177.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_6_stage_8&#45;&gt;ring_attn_1_7_stage_8 -->
<g id="edge2336" class="edge">
<title>ring_attn_1_6_stage_8&#45;&gt;ring_attn_1_7_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-13204C6205.02,-13204 6363.86,-13204 6363.86,-13204"/>
<polygon fill="red" stroke="red" points="6363.86,-13207.5 6373.86,-13204 6363.86,-13200.5 6363.86,-13207.5"/>
</g>
<!-- ring_attn_1_6_stage_9&#45;&gt;ring_attn_1_6_stage_10 -->
<g id="edge619" class="edge">
<title>ring_attn_1_6_stage_9&#45;&gt;ring_attn_1_6_stage_10</title>
<path fill="none" stroke="black" d="M5996,-12882.87C5996,-12882.87 5996,-12776.25 5996,-12776.25"/>
<polygon fill="black" stroke="black" points="5999.5,-12776.25 5996,-12766.25 5992.5,-12776.25 5999.5,-12776.25"/>
</g>
<!-- ring_attn_1_7_stage_9 -->
<g id="node723" class="node">
<title>ring_attn_1_7_stage_9</title>
<polygon fill="yellow" stroke="black" points="6583,-13019 6374,-12951 6583,-12883 6792,-12951 6583,-13019"/>
<text text-anchor="middle" x="6583" y="-12969.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-12954.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="6583" y="-12939.8" font-family="Times,serif" font-size="14.00">Q[7]×K[14]×V[14]</text>
<text text-anchor="middle" x="6583" y="-12924.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_6_stage_9&#45;&gt;ring_attn_1_7_stage_9 -->
<g id="edge2337" class="edge">
<title>ring_attn_1_6_stage_9&#45;&gt;ring_attn_1_7_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-12951C6205.02,-12951 6363.86,-12951 6363.86,-12951"/>
<polygon fill="red" stroke="red" points="6363.86,-12954.5 6373.86,-12951 6363.86,-12947.5 6363.86,-12954.5"/>
</g>
<!-- ring_attn_1_6_stage_10&#45;&gt;ring_attn_1_6_stage_11 -->
<g id="edge620" class="edge">
<title>ring_attn_1_6_stage_10&#45;&gt;ring_attn_1_6_stage_11</title>
<path fill="none" stroke="black" d="M5996,-12629.87C5996,-12629.87 5996,-12523.25 5996,-12523.25"/>
<polygon fill="black" stroke="black" points="5999.5,-12523.25 5996,-12513.25 5992.5,-12523.25 5999.5,-12523.25"/>
</g>
<!-- ring_attn_1_7_stage_10 -->
<g id="node724" class="node">
<title>ring_attn_1_7_stage_10</title>
<polygon fill="yellow" stroke="black" points="6583,-12766 6374,-12698 6583,-12630 6792,-12698 6583,-12766"/>
<text text-anchor="middle" x="6583" y="-12716.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-12701.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="6583" y="-12686.8" font-family="Times,serif" font-size="14.00">Q[7]×K[13]×V[13]</text>
<text text-anchor="middle" x="6583" y="-12671.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_6_stage_10&#45;&gt;ring_attn_1_7_stage_10 -->
<g id="edge2338" class="edge">
<title>ring_attn_1_6_stage_10&#45;&gt;ring_attn_1_7_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-12698C6205.02,-12698 6363.86,-12698 6363.86,-12698"/>
<polygon fill="red" stroke="red" points="6363.86,-12701.5 6373.86,-12698 6363.86,-12694.5 6363.86,-12701.5"/>
</g>
<!-- ring_attn_1_6_stage_11&#45;&gt;ring_attn_1_6_stage_12 -->
<g id="edge621" class="edge">
<title>ring_attn_1_6_stage_11&#45;&gt;ring_attn_1_6_stage_12</title>
<path fill="none" stroke="black" d="M5996,-12376.87C5996,-12376.87 5996,-12270.25 5996,-12270.25"/>
<polygon fill="black" stroke="black" points="5999.5,-12270.25 5996,-12260.25 5992.5,-12270.25 5999.5,-12270.25"/>
</g>
<!-- ring_attn_1_7_stage_11 -->
<g id="node725" class="node">
<title>ring_attn_1_7_stage_11</title>
<polygon fill="yellow" stroke="black" points="6583,-12513 6374,-12445 6583,-12377 6792,-12445 6583,-12513"/>
<text text-anchor="middle" x="6583" y="-12463.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-12448.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="6583" y="-12433.8" font-family="Times,serif" font-size="14.00">Q[7]×K[12]×V[12]</text>
<text text-anchor="middle" x="6583" y="-12418.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_6_stage_11&#45;&gt;ring_attn_1_7_stage_11 -->
<g id="edge2339" class="edge">
<title>ring_attn_1_6_stage_11&#45;&gt;ring_attn_1_7_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-12445C6205.02,-12445 6363.86,-12445 6363.86,-12445"/>
<polygon fill="red" stroke="red" points="6363.86,-12448.5 6373.86,-12445 6363.86,-12441.5 6363.86,-12448.5"/>
</g>
<!-- ring_attn_1_6_stage_12&#45;&gt;ring_attn_1_6_stage_13 -->
<g id="edge622" class="edge">
<title>ring_attn_1_6_stage_12&#45;&gt;ring_attn_1_6_stage_13</title>
<path fill="none" stroke="black" d="M5996,-12123.87C5996,-12123.87 5996,-12017.25 5996,-12017.25"/>
<polygon fill="black" stroke="black" points="5999.5,-12017.25 5996,-12007.25 5992.5,-12017.25 5999.5,-12017.25"/>
</g>
<!-- ring_attn_1_7_stage_12 -->
<g id="node726" class="node">
<title>ring_attn_1_7_stage_12</title>
<polygon fill="yellow" stroke="black" points="6583,-12260 6374,-12192 6583,-12124 6792,-12192 6583,-12260"/>
<text text-anchor="middle" x="6583" y="-12210.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-12195.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="6583" y="-12180.8" font-family="Times,serif" font-size="14.00">Q[7]×K[11]×V[11]</text>
<text text-anchor="middle" x="6583" y="-12165.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_6_stage_12&#45;&gt;ring_attn_1_7_stage_12 -->
<g id="edge2340" class="edge">
<title>ring_attn_1_6_stage_12&#45;&gt;ring_attn_1_7_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-12192C6205.02,-12192 6363.86,-12192 6363.86,-12192"/>
<polygon fill="red" stroke="red" points="6363.86,-12195.5 6373.86,-12192 6363.86,-12188.5 6363.86,-12195.5"/>
</g>
<!-- ring_attn_1_6_stage_13&#45;&gt;ring_attn_1_6_stage_14 -->
<g id="edge623" class="edge">
<title>ring_attn_1_6_stage_13&#45;&gt;ring_attn_1_6_stage_14</title>
<path fill="none" stroke="black" d="M5996,-11870.87C5996,-11870.87 5996,-11764.25 5996,-11764.25"/>
<polygon fill="black" stroke="black" points="5999.5,-11764.25 5996,-11754.25 5992.5,-11764.25 5999.5,-11764.25"/>
</g>
<!-- ring_attn_1_7_stage_13 -->
<g id="node727" class="node">
<title>ring_attn_1_7_stage_13</title>
<polygon fill="yellow" stroke="black" points="6583,-12007 6374,-11939 6583,-11871 6792,-11939 6583,-12007"/>
<text text-anchor="middle" x="6583" y="-11957.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-11942.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="6583" y="-11927.8" font-family="Times,serif" font-size="14.00">Q[7]×K[10]×V[10]</text>
<text text-anchor="middle" x="6583" y="-11912.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_6_stage_13&#45;&gt;ring_attn_1_7_stage_13 -->
<g id="edge2341" class="edge">
<title>ring_attn_1_6_stage_13&#45;&gt;ring_attn_1_7_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-11939C6205.02,-11939 6363.86,-11939 6363.86,-11939"/>
<polygon fill="red" stroke="red" points="6363.86,-11942.5 6373.86,-11939 6363.86,-11935.5 6363.86,-11942.5"/>
</g>
<!-- ring_attn_1_6_stage_14&#45;&gt;ring_attn_1_6_stage_15 -->
<g id="edge624" class="edge">
<title>ring_attn_1_6_stage_14&#45;&gt;ring_attn_1_6_stage_15</title>
<path fill="none" stroke="black" d="M5996,-11617.87C5996,-11617.87 5996,-11511.25 5996,-11511.25"/>
<polygon fill="black" stroke="black" points="5999.5,-11511.25 5996,-11501.25 5992.5,-11511.25 5999.5,-11511.25"/>
</g>
<!-- ring_attn_1_7_stage_14 -->
<g id="node728" class="node">
<title>ring_attn_1_7_stage_14</title>
<polygon fill="yellow" stroke="black" points="6583,-11754 6374,-11686 6583,-11618 6792,-11686 6583,-11754"/>
<text text-anchor="middle" x="6583" y="-11704.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-11689.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="6583" y="-11674.8" font-family="Times,serif" font-size="14.00">Q[7]×K[9]×V[9]</text>
<text text-anchor="middle" x="6583" y="-11659.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_6_stage_14&#45;&gt;ring_attn_1_7_stage_14 -->
<g id="edge2342" class="edge">
<title>ring_attn_1_6_stage_14&#45;&gt;ring_attn_1_7_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-11686C6205.02,-11686 6363.86,-11686 6363.86,-11686"/>
<polygon fill="red" stroke="red" points="6363.86,-11689.5 6373.86,-11686 6363.86,-11682.5 6363.86,-11689.5"/>
</g>
<!-- attn_out_1_6 -->
<g id="node632" class="node">
<title>attn_out_1_6</title>
<polygon fill="none" stroke="black" points="6065.5,-11292 5926.5,-11292 5926.5,-11239 6065.5,-11239 6065.5,-11292"/>
<text text-anchor="middle" x="5996" y="-11276.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="5996" y="-11261.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="5996" y="-11246.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_1_6_stage_15&#45;&gt;attn_out_1_6 -->
<g id="edge625" class="edge">
<title>ring_attn_1_6_stage_15&#45;&gt;attn_out_1_6</title>
<path fill="none" stroke="black" d="M5996,-11364.87C5996,-11364.87 5996,-11302.18 5996,-11302.18"/>
<polygon fill="black" stroke="black" points="5999.5,-11302.18 5996,-11292.18 5992.5,-11302.18 5999.5,-11302.18"/>
</g>
<!-- ring_attn_1_7_stage_15 -->
<g id="node729" class="node">
<title>ring_attn_1_7_stage_15</title>
<polygon fill="yellow" stroke="black" points="6583,-11501 6374,-11433 6583,-11365 6792,-11433 6583,-11501"/>
<text text-anchor="middle" x="6583" y="-11451.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-11436.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="6583" y="-11421.8" font-family="Times,serif" font-size="14.00">Q[7]×K[8]×V[8]</text>
<text text-anchor="middle" x="6583" y="-11406.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_6_stage_15&#45;&gt;ring_attn_1_7_stage_15 -->
<g id="edge2343" class="edge">
<title>ring_attn_1_6_stage_15&#45;&gt;ring_attn_1_7_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-11433C6205.02,-11433 6363.86,-11433 6363.86,-11433"/>
<polygon fill="red" stroke="red" points="6363.86,-11436.5 6373.86,-11433 6363.86,-11429.5 6363.86,-11436.5"/>
</g>
<!-- attn_residual_1_6 -->
<g id="node633" class="node">
<title>attn_residual_1_6</title>
<ellipse fill="none" stroke="black" cx="5996" cy="-11139" rx="105.5" ry="27"/>
<text text-anchor="middle" x="5996" y="-11142.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="5996" y="-11127.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_1_6&#45;&gt;attn_residual_1_6 -->
<g id="edge626" class="edge">
<title>attn_out_1_6&#45;&gt;attn_residual_1_6</title>
<path fill="none" stroke="black" d="M5996,-11238.98C5996,-11238.98 5996,-11176.36 5996,-11176.36"/>
<polygon fill="black" stroke="black" points="5999.5,-11176.36 5996,-11166.36 5992.5,-11176.36 5999.5,-11176.36"/>
</g>
<!-- gate_1_6 -->
<g id="node634" class="node">
<title>gate_1_6</title>
<ellipse fill="orange" stroke="black" cx="5996" cy="-11001.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="5996" y="-11012.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="5996" y="-10997.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="5996" y="-10982.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_1_6&#45;&gt;gate_1_6 -->
<g id="edge627" class="edge">
<title>attn_residual_1_6&#45;&gt;gate_1_6</title>
<path fill="none" stroke="black" d="M5996,-11111.83C5996,-11111.83 5996,-11049.02 5996,-11049.02"/>
<polygon fill="black" stroke="black" points="5999.5,-11049.02 5996,-11039.02 5992.5,-11049.02 5999.5,-11049.02"/>
</g>
<!-- gate_1_6&#45;&gt;expert_1_0_0 -->
<g id="edge2344" class="edge">
<title>gate_1_6&#45;&gt;expert_1_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5943.25,-11034.21C5943.25,-11049.34 5943.25,-11064 5943.25,-11064 5943.25,-11064 336.29,-11064 336.29,-11064 336.29,-11064 336.29,-10842.19 336.29,-10842.19"/>
<polygon fill="blue" stroke="blue" points="339.79,-10842.19 336.29,-10832.19 332.79,-10842.19 339.79,-10842.19"/>
<text text-anchor="middle" x="24656.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="24656.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU6→GPU0</text>
<text text-anchor="middle" x="24656.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="24656.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_6&#45;&gt;expert_1_1_0 -->
<g id="edge2345" class="edge">
<title>gate_1_6&#45;&gt;expert_1_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5901.05,-10985.15C5901.05,-10964.32 5901.05,-10931 5901.05,-10931 5901.05,-10931 2984.27,-10931 2984.27,-10931 2984.27,-10931 2984.27,-10842.12 2984.27,-10842.12"/>
<polygon fill="blue" stroke="blue" points="2987.77,-10842.12 2984.27,-10832.12 2980.77,-10842.12 2987.77,-10842.12"/>
<text text-anchor="middle" x="24830.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="24830.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU6→GPU1</text>
<text text-anchor="middle" x="24830.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="24830.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_6&#45;&gt;expert_1_2_0 -->
<g id="edge2346" class="edge">
<title>gate_1_6&#45;&gt;expert_1_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5922.15,-10974.47C5922.15,-10954.22 5922.15,-10930 5922.15,-10930 5922.15,-10930 3581.57,-10930 3581.57,-10930 3581.57,-10930 3581.57,-10842.21 3581.57,-10842.21"/>
<polygon fill="blue" stroke="blue" points="3585.07,-10842.21 3581.57,-10832.21 3578.07,-10842.21 3585.07,-10842.21"/>
<text text-anchor="middle" x="25004.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25004.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU6→GPU2</text>
<text text-anchor="middle" x="25004.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25004.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_6&#45;&gt;expert_1_3_0 -->
<g id="edge2347" class="edge">
<title>gate_1_6&#45;&gt;expert_1_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5943.25,-10969.01C5943.25,-10953.38 5943.25,-10938 5943.25,-10938 5943.25,-10938 4171.7,-10938 4171.7,-10938 4171.7,-10938 4171.7,-10842.31 4171.7,-10842.31"/>
<polygon fill="blue" stroke="blue" points="4175.2,-10842.31 4171.7,-10832.31 4168.2,-10842.31 4175.2,-10842.31"/>
<text text-anchor="middle" x="25178.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25178.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU6→GPU3</text>
<text text-anchor="middle" x="25178.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25178.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_6&#45;&gt;expert_1_4_0 -->
<g id="edge2348" class="edge">
<title>gate_1_6&#45;&gt;expert_1_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5953.8,-10966.88C5953.8,-10961.13 5953.8,-10957 5953.8,-10957 5953.8,-10957 4936.5,-10957 4936.5,-10957 4936.5,-10957 4936.5,-10842.24 4936.5,-10842.24"/>
<polygon fill="blue" stroke="blue" points="4940,-10842.24 4936.5,-10832.24 4933,-10842.24 4940,-10842.24"/>
<text text-anchor="middle" x="25352.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25352.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU6→GPU4</text>
<text text-anchor="middle" x="25352.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25352.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_6&#45;&gt;expert_1_5_0 -->
<g id="edge2349" class="edge">
<title>gate_1_6&#45;&gt;expert_1_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5896.48,-11014C5757.26,-11014 5521.25,-11014 5521.25,-11014 5521.25,-11014 5521.25,-10842.33 5521.25,-10842.33"/>
<polygon fill="blue" stroke="blue" points="5524.75,-10842.33 5521.25,-10832.33 5517.75,-10842.33 5524.75,-10842.33"/>
<text text-anchor="middle" x="25526.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25526.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU6→GPU5</text>
<text text-anchor="middle" x="25526.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25526.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_6&#45;&gt;expert_1_6_0 -->
<g id="edge628" class="edge">
<title>gate_1_6&#45;&gt;expert_1_6_0</title>
<path fill="none" stroke="black" d="M5964.35,-10965.55C5964.35,-10965.55 5964.35,-10842.11 5964.35,-10842.11"/>
<polygon fill="black" stroke="black" points="5967.85,-10842.11 5964.35,-10832.11 5960.85,-10842.11 5967.85,-10842.11"/>
</g>
<!-- gate_1_6&#45;&gt;expert_1_7_0 -->
<g id="edge2350" class="edge">
<title>gate_1_6&#45;&gt;expert_1_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6095.65,-10989C6235.77,-10989 6474.12,-10989 6474.12,-10989 6474.12,-10989 6474.12,-10842.18 6474.12,-10842.18"/>
<polygon fill="blue" stroke="blue" points="6477.63,-10842.18 6474.12,-10832.18 6470.63,-10842.18 6477.63,-10842.18"/>
<text text-anchor="middle" x="25700.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25700.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU6→GPU7</text>
<text text-anchor="middle" x="25700.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25700.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_6&#45;&gt;expert_1_8_0 -->
<g id="edge2351" class="edge">
<title>gate_1_6&#45;&gt;expert_1_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6027.65,-10965.72C6027.65,-10954.5 6027.65,-10945 6027.65,-10945 6027.65,-10945 7057.75,-10945 7057.75,-10945 7057.75,-10945 7057.75,-10842.07 7057.75,-10842.07"/>
<polygon fill="blue" stroke="blue" points="7061.25,-10842.07 7057.75,-10832.07 7054.25,-10842.07 7061.25,-10842.07"/>
<text text-anchor="middle" x="25874.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25874.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU6→GPU8</text>
<text text-anchor="middle" x="25874.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25874.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_6&#45;&gt;expert_1_9_0 -->
<g id="edge2352" class="edge">
<title>gate_1_6&#45;&gt;expert_1_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6038.2,-10966.83C6038.2,-10946.2 6038.2,-10924 6038.2,-10924 6038.2,-10924 7641.38,-10924 7641.38,-10924 7641.38,-10924 7641.38,-10842.09 7641.38,-10842.09"/>
<polygon fill="blue" stroke="blue" points="7644.88,-10842.09 7641.38,-10832.09 7637.88,-10842.09 7644.88,-10842.09"/>
<text text-anchor="middle" x="26048.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26048.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU6→GPU9</text>
<text text-anchor="middle" x="26048.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26048.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_6&#45;&gt;expert_1_10_0 -->
<g id="edge2353" class="edge">
<title>gate_1_6&#45;&gt;expert_1_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6048.75,-10968.69C6048.75,-10944.58 6048.75,-10916 6048.75,-10916 6048.75,-10916 8338.98,-10916 8338.98,-10916 8338.98,-10916 8338.98,-10842.25 8338.98,-10842.25"/>
<polygon fill="blue" stroke="blue" points="8342.48,-10842.25 8338.98,-10832.25 8335.48,-10842.25 8342.48,-10842.25"/>
<text text-anchor="middle" x="26222.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26222.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU6→GPU10</text>
<text text-anchor="middle" x="26222.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26222.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_6&#45;&gt;expert_1_11_0 -->
<g id="edge2354" class="edge">
<title>gate_1_6&#45;&gt;expert_1_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6059.3,-10971.2C6059.3,-10945.23 6059.3,-10912 6059.3,-10912 6059.3,-10912 8925.98,-10912 8925.98,-10912 8925.98,-10912 8925.98,-10842.1 8925.98,-10842.1"/>
<polygon fill="blue" stroke="blue" points="8929.48,-10842.1 8925.98,-10832.1 8922.48,-10842.1 8929.48,-10842.1"/>
<text text-anchor="middle" x="26396.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26396.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU6→GPU11</text>
<text text-anchor="middle" x="26396.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26396.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_6&#45;&gt;expert_1_12_0 -->
<g id="edge2355" class="edge">
<title>gate_1_6&#45;&gt;expert_1_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6069.85,-10974.67C6069.85,-10937.54 6069.85,-10875 6069.85,-10875 6069.85,-10875 9522.59,-10875 9522.59,-10875 9522.59,-10875 9522.59,-10842.17 9522.59,-10842.17"/>
<polygon fill="blue" stroke="blue" points="9526.09,-10842.17 9522.59,-10832.17 9519.09,-10842.17 9526.09,-10842.17"/>
<text text-anchor="middle" x="26570.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26570.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU6→GPU12</text>
<text text-anchor="middle" x="26570.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26570.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_6&#45;&gt;expert_1_13_0 -->
<g id="edge2356" class="edge">
<title>gate_1_6&#45;&gt;expert_1_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6080.4,-10978.94C6080.4,-10939.69 6080.4,-10863 6080.4,-10863 6080.4,-10863 10117.66,-10863 10117.66,-10863 10117.66,-10863 10117.66,-10842.23 10117.66,-10842.23"/>
<polygon fill="blue" stroke="blue" points="10121.16,-10842.23 10117.66,-10832.23 10114.16,-10842.23 10121.16,-10842.23"/>
<text text-anchor="middle" x="26744.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26744.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU6→GPU13</text>
<text text-anchor="middle" x="26744.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26744.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_6&#45;&gt;expert_1_14_0 -->
<g id="edge2357" class="edge">
<title>gate_1_6&#45;&gt;expert_1_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6090.95,-10984.91C6090.95,-10948.34 6090.95,-10864 6090.95,-10864 6090.95,-10864 10676.93,-10864 10676.93,-10864 10676.93,-10864 10676.93,-10842.01 10676.93,-10842.01"/>
<polygon fill="blue" stroke="blue" points="10680.43,-10842.01 10676.93,-10832.01 10673.43,-10842.01 10680.43,-10842.01"/>
<text text-anchor="middle" x="26918.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26918.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU6→GPU14</text>
<text text-anchor="middle" x="26918.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26918.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_6&#45;&gt;expert_1_15_0 -->
<g id="edge2358" class="edge">
<title>gate_1_6&#45;&gt;expert_1_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6048.75,-11034.16C6048.75,-11045.3 6048.75,-11055 6048.75,-11055 6048.75,-11055 11170.12,-11055 11170.12,-11055 11170.12,-11055 11170.12,-10842.2 11170.12,-10842.2"/>
<polygon fill="blue" stroke="blue" points="11173.63,-10842.2 11170.12,-10832.2 11166.63,-10842.2 11173.63,-10842.2"/>
<text text-anchor="middle" x="27092.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27092.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU6→GPU15</text>
<text text-anchor="middle" x="27092.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27092.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_6 -->
<g id="node636" class="node">
<title>expert_reduce_1_6</title>
<ellipse fill="none" stroke="black" cx="5996" cy="-10668.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="5996" y="-10679.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="5996" y="-10664.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="5996" y="-10649.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_6_0&#45;&gt;expert_reduce_1_6 -->
<g id="edge629" class="edge">
<title>expert_1_6_0&#45;&gt;expert_reduce_1_6</title>
<path fill="none" stroke="black" d="M5996,-10778.76C5996,-10778.76 5996,-10716.06 5996,-10716.06"/>
<polygon fill="black" stroke="black" points="5999.5,-10716.06 5996,-10706.06 5992.5,-10716.06 5999.5,-10716.06"/>
</g>
<!-- moe_residual_1_6 -->
<g id="node637" class="node">
<title>moe_residual_1_6</title>
<ellipse fill="none" stroke="black" cx="5996" cy="-10531" rx="105.5" ry="27"/>
<text text-anchor="middle" x="5996" y="-10534.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="5996" y="-10519.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_6&#45;&gt;moe_residual_1_6 -->
<g id="edge630" class="edge">
<title>expert_reduce_1_6&#45;&gt;moe_residual_1_6</title>
<path fill="none" stroke="black" d="M5996,-10630.93C5996,-10630.93 5996,-10568.06 5996,-10568.06"/>
<polygon fill="black" stroke="black" points="5999.5,-10568.06 5996,-10558.06 5992.5,-10568.06 5999.5,-10568.06"/>
</g>
<!-- qkv_proj_2_6 -->
<g id="node638" class="node">
<title>qkv_proj_2_6</title>
<polygon fill="none" stroke="black" points="6078.5,-10431 5913.5,-10431 5913.5,-10378 6078.5,-10378 6078.5,-10431"/>
<text text-anchor="middle" x="5996" y="-10415.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5996" y="-10400.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="5996" y="-10385.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_1_6&#45;&gt;qkv_proj_2_6 -->
<g id="edge631" class="edge">
<title>moe_residual_1_6&#45;&gt;qkv_proj_2_6</title>
<path fill="none" stroke="black" d="M5996,-10503.86C5996,-10503.86 5996,-10441.16 5996,-10441.16"/>
<polygon fill="black" stroke="black" points="5999.5,-10441.16 5996,-10431.16 5992.5,-10441.16 5999.5,-10441.16"/>
</g>
<!-- qkv_reshape_2_6 -->
<g id="node639" class="node">
<title>qkv_reshape_2_6</title>
<ellipse fill="none" stroke="black" cx="5996" cy="-10278" rx="148" ry="27"/>
<text text-anchor="middle" x="5996" y="-10281.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="5996" y="-10266.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_2_6&#45;&gt;qkv_reshape_2_6 -->
<g id="edge632" class="edge">
<title>qkv_proj_2_6&#45;&gt;qkv_reshape_2_6</title>
<path fill="none" stroke="black" d="M5996,-10377.98C5996,-10377.98 5996,-10315.36 5996,-10315.36"/>
<polygon fill="black" stroke="black" points="5999.5,-10315.36 5996,-10305.36 5992.5,-10315.36 5999.5,-10315.36"/>
</g>
<!-- qkv_reshape_2_6&#45;&gt;ring_attn_2_6_stage_0 -->
<g id="edge633" class="edge">
<title>qkv_reshape_2_6&#45;&gt;ring_attn_2_6_stage_0</title>
<path fill="none" stroke="black" d="M5996,-10250.72C5996,-10250.72 5996,-10144.16 5996,-10144.16"/>
<polygon fill="black" stroke="black" points="5999.5,-10144.16 5996,-10134.16 5992.5,-10144.16 5999.5,-10144.16"/>
</g>
<!-- ring_attn_2_6_stage_0&#45;&gt;ring_attn_2_6_stage_1 -->
<g id="edge634" class="edge">
<title>ring_attn_2_6_stage_0&#45;&gt;ring_attn_2_6_stage_1</title>
<path fill="none" stroke="black" d="M5996,-9997.87C5996,-9997.87 5996,-9891.25 5996,-9891.25"/>
<polygon fill="black" stroke="black" points="5999.5,-9891.25 5996,-9881.25 5992.5,-9891.25 5999.5,-9891.25"/>
</g>
<!-- ring_attn_2_7_stage_0 -->
<g id="node738" class="node">
<title>ring_attn_2_7_stage_0</title>
<polygon fill="yellow" stroke="black" points="6583,-10134 6374,-10066 6583,-9998 6792,-10066 6583,-10134"/>
<text text-anchor="middle" x="6583" y="-10084.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-10069.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="6583" y="-10054.8" font-family="Times,serif" font-size="14.00">Q[7]×K[7]×V[7]</text>
<text text-anchor="middle" x="6583" y="-10039.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_6_stage_0&#45;&gt;ring_attn_2_7_stage_0 -->
<g id="edge2359" class="edge">
<title>ring_attn_2_6_stage_0&#45;&gt;ring_attn_2_7_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-10066C6205.02,-10066 6363.86,-10066 6363.86,-10066"/>
<polygon fill="red" stroke="red" points="6363.86,-10069.5 6373.86,-10066 6363.86,-10062.5 6363.86,-10069.5"/>
</g>
<!-- ring_attn_2_6_stage_1&#45;&gt;ring_attn_2_6_stage_2 -->
<g id="edge635" class="edge">
<title>ring_attn_2_6_stage_1&#45;&gt;ring_attn_2_6_stage_2</title>
<path fill="none" stroke="black" d="M5996,-9744.87C5996,-9744.87 5996,-9638.25 5996,-9638.25"/>
<polygon fill="black" stroke="black" points="5999.5,-9638.25 5996,-9628.25 5992.5,-9638.25 5999.5,-9638.25"/>
</g>
<!-- ring_attn_2_7_stage_1 -->
<g id="node739" class="node">
<title>ring_attn_2_7_stage_1</title>
<polygon fill="yellow" stroke="black" points="6583,-9881 6374,-9813 6583,-9745 6792,-9813 6583,-9881"/>
<text text-anchor="middle" x="6583" y="-9831.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-9816.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="6583" y="-9801.8" font-family="Times,serif" font-size="14.00">Q[7]×K[6]×V[6]</text>
<text text-anchor="middle" x="6583" y="-9786.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_6_stage_1&#45;&gt;ring_attn_2_7_stage_1 -->
<g id="edge2360" class="edge">
<title>ring_attn_2_6_stage_1&#45;&gt;ring_attn_2_7_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-9813C6205.02,-9813 6363.86,-9813 6363.86,-9813"/>
<polygon fill="red" stroke="red" points="6363.86,-9816.5 6373.86,-9813 6363.86,-9809.5 6363.86,-9816.5"/>
</g>
<!-- ring_attn_2_6_stage_2&#45;&gt;ring_attn_2_6_stage_3 -->
<g id="edge636" class="edge">
<title>ring_attn_2_6_stage_2&#45;&gt;ring_attn_2_6_stage_3</title>
<path fill="none" stroke="black" d="M5996,-9491.87C5996,-9491.87 5996,-9385.25 5996,-9385.25"/>
<polygon fill="black" stroke="black" points="5999.5,-9385.25 5996,-9375.25 5992.5,-9385.25 5999.5,-9385.25"/>
</g>
<!-- ring_attn_2_7_stage_2 -->
<g id="node740" class="node">
<title>ring_attn_2_7_stage_2</title>
<polygon fill="yellow" stroke="black" points="6583,-9628 6374,-9560 6583,-9492 6792,-9560 6583,-9628"/>
<text text-anchor="middle" x="6583" y="-9578.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-9563.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="6583" y="-9548.8" font-family="Times,serif" font-size="14.00">Q[7]×K[5]×V[5]</text>
<text text-anchor="middle" x="6583" y="-9533.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_6_stage_2&#45;&gt;ring_attn_2_7_stage_2 -->
<g id="edge2361" class="edge">
<title>ring_attn_2_6_stage_2&#45;&gt;ring_attn_2_7_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-9560C6205.02,-9560 6363.86,-9560 6363.86,-9560"/>
<polygon fill="red" stroke="red" points="6363.86,-9563.5 6373.86,-9560 6363.86,-9556.5 6363.86,-9563.5"/>
</g>
<!-- ring_attn_2_6_stage_3&#45;&gt;ring_attn_2_6_stage_4 -->
<g id="edge637" class="edge">
<title>ring_attn_2_6_stage_3&#45;&gt;ring_attn_2_6_stage_4</title>
<path fill="none" stroke="black" d="M5996,-9238.87C5996,-9238.87 5996,-9132.25 5996,-9132.25"/>
<polygon fill="black" stroke="black" points="5999.5,-9132.25 5996,-9122.25 5992.5,-9132.25 5999.5,-9132.25"/>
</g>
<!-- ring_attn_2_7_stage_3 -->
<g id="node741" class="node">
<title>ring_attn_2_7_stage_3</title>
<polygon fill="yellow" stroke="black" points="6583,-9375 6374,-9307 6583,-9239 6792,-9307 6583,-9375"/>
<text text-anchor="middle" x="6583" y="-9325.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-9310.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="6583" y="-9295.8" font-family="Times,serif" font-size="14.00">Q[7]×K[4]×V[4]</text>
<text text-anchor="middle" x="6583" y="-9280.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_6_stage_3&#45;&gt;ring_attn_2_7_stage_3 -->
<g id="edge2362" class="edge">
<title>ring_attn_2_6_stage_3&#45;&gt;ring_attn_2_7_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-9307C6205.02,-9307 6363.86,-9307 6363.86,-9307"/>
<polygon fill="red" stroke="red" points="6363.86,-9310.5 6373.86,-9307 6363.86,-9303.5 6363.86,-9310.5"/>
</g>
<!-- ring_attn_2_6_stage_4&#45;&gt;ring_attn_2_6_stage_5 -->
<g id="edge638" class="edge">
<title>ring_attn_2_6_stage_4&#45;&gt;ring_attn_2_6_stage_5</title>
<path fill="none" stroke="black" d="M5996,-8985.87C5996,-8985.87 5996,-8879.25 5996,-8879.25"/>
<polygon fill="black" stroke="black" points="5999.5,-8879.25 5996,-8869.25 5992.5,-8879.25 5999.5,-8879.25"/>
</g>
<!-- ring_attn_2_7_stage_4 -->
<g id="node742" class="node">
<title>ring_attn_2_7_stage_4</title>
<polygon fill="yellow" stroke="black" points="6583,-9122 6374,-9054 6583,-8986 6792,-9054 6583,-9122"/>
<text text-anchor="middle" x="6583" y="-9072.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-9057.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="6583" y="-9042.8" font-family="Times,serif" font-size="14.00">Q[7]×K[3]×V[3]</text>
<text text-anchor="middle" x="6583" y="-9027.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_6_stage_4&#45;&gt;ring_attn_2_7_stage_4 -->
<g id="edge2363" class="edge">
<title>ring_attn_2_6_stage_4&#45;&gt;ring_attn_2_7_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-9054C6205.02,-9054 6363.86,-9054 6363.86,-9054"/>
<polygon fill="red" stroke="red" points="6363.86,-9057.5 6373.86,-9054 6363.86,-9050.5 6363.86,-9057.5"/>
</g>
<!-- ring_attn_2_6_stage_5&#45;&gt;ring_attn_2_6_stage_6 -->
<g id="edge639" class="edge">
<title>ring_attn_2_6_stage_5&#45;&gt;ring_attn_2_6_stage_6</title>
<path fill="none" stroke="black" d="M5996,-8732.87C5996,-8732.87 5996,-8626.25 5996,-8626.25"/>
<polygon fill="black" stroke="black" points="5999.5,-8626.25 5996,-8616.25 5992.5,-8626.25 5999.5,-8626.25"/>
</g>
<!-- ring_attn_2_7_stage_5 -->
<g id="node743" class="node">
<title>ring_attn_2_7_stage_5</title>
<polygon fill="yellow" stroke="black" points="6583,-8869 6374,-8801 6583,-8733 6792,-8801 6583,-8869"/>
<text text-anchor="middle" x="6583" y="-8819.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-8804.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="6583" y="-8789.8" font-family="Times,serif" font-size="14.00">Q[7]×K[2]×V[2]</text>
<text text-anchor="middle" x="6583" y="-8774.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_6_stage_5&#45;&gt;ring_attn_2_7_stage_5 -->
<g id="edge2364" class="edge">
<title>ring_attn_2_6_stage_5&#45;&gt;ring_attn_2_7_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-8801C6205.02,-8801 6363.86,-8801 6363.86,-8801"/>
<polygon fill="red" stroke="red" points="6363.86,-8804.5 6373.86,-8801 6363.86,-8797.5 6363.86,-8804.5"/>
</g>
<!-- ring_attn_2_6_stage_6&#45;&gt;ring_attn_2_6_stage_7 -->
<g id="edge640" class="edge">
<title>ring_attn_2_6_stage_6&#45;&gt;ring_attn_2_6_stage_7</title>
<path fill="none" stroke="black" d="M5996,-8479.87C5996,-8479.87 5996,-8373.25 5996,-8373.25"/>
<polygon fill="black" stroke="black" points="5999.5,-8373.25 5996,-8363.25 5992.5,-8373.25 5999.5,-8373.25"/>
</g>
<!-- ring_attn_2_7_stage_6 -->
<g id="node744" class="node">
<title>ring_attn_2_7_stage_6</title>
<polygon fill="yellow" stroke="black" points="6583,-8616 6374,-8548 6583,-8480 6792,-8548 6583,-8616"/>
<text text-anchor="middle" x="6583" y="-8566.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-8551.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="6583" y="-8536.8" font-family="Times,serif" font-size="14.00">Q[7]×K[1]×V[1]</text>
<text text-anchor="middle" x="6583" y="-8521.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_6_stage_6&#45;&gt;ring_attn_2_7_stage_6 -->
<g id="edge2365" class="edge">
<title>ring_attn_2_6_stage_6&#45;&gt;ring_attn_2_7_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-8548C6205.02,-8548 6363.86,-8548 6363.86,-8548"/>
<polygon fill="red" stroke="red" points="6363.86,-8551.5 6373.86,-8548 6363.86,-8544.5 6363.86,-8551.5"/>
</g>
<!-- ring_attn_2_6_stage_7&#45;&gt;ring_attn_2_6_stage_8 -->
<g id="edge641" class="edge">
<title>ring_attn_2_6_stage_7&#45;&gt;ring_attn_2_6_stage_8</title>
<path fill="none" stroke="black" d="M5996,-8226.87C5996,-8226.87 5996,-8120.25 5996,-8120.25"/>
<polygon fill="black" stroke="black" points="5999.5,-8120.25 5996,-8110.25 5992.5,-8120.25 5999.5,-8120.25"/>
</g>
<!-- ring_attn_2_7_stage_7 -->
<g id="node745" class="node">
<title>ring_attn_2_7_stage_7</title>
<polygon fill="yellow" stroke="black" points="6583,-8363 6374,-8295 6583,-8227 6792,-8295 6583,-8363"/>
<text text-anchor="middle" x="6583" y="-8313.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-8298.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="6583" y="-8283.8" font-family="Times,serif" font-size="14.00">Q[7]×K[0]×V[0]</text>
<text text-anchor="middle" x="6583" y="-8268.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_6_stage_7&#45;&gt;ring_attn_2_7_stage_7 -->
<g id="edge2366" class="edge">
<title>ring_attn_2_6_stage_7&#45;&gt;ring_attn_2_7_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-8295C6205.02,-8295 6363.86,-8295 6363.86,-8295"/>
<polygon fill="red" stroke="red" points="6363.86,-8298.5 6373.86,-8295 6363.86,-8291.5 6363.86,-8298.5"/>
</g>
<!-- ring_attn_2_6_stage_8&#45;&gt;ring_attn_2_6_stage_9 -->
<g id="edge642" class="edge">
<title>ring_attn_2_6_stage_8&#45;&gt;ring_attn_2_6_stage_9</title>
<path fill="none" stroke="black" d="M5996,-7973.87C5996,-7973.87 5996,-7867.25 5996,-7867.25"/>
<polygon fill="black" stroke="black" points="5999.5,-7867.25 5996,-7857.25 5992.5,-7867.25 5999.5,-7867.25"/>
</g>
<!-- ring_attn_2_7_stage_8 -->
<g id="node746" class="node">
<title>ring_attn_2_7_stage_8</title>
<polygon fill="yellow" stroke="black" points="6583,-8110 6374,-8042 6583,-7974 6792,-8042 6583,-8110"/>
<text text-anchor="middle" x="6583" y="-8060.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-8045.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="6583" y="-8030.8" font-family="Times,serif" font-size="14.00">Q[7]×K[15]×V[15]</text>
<text text-anchor="middle" x="6583" y="-8015.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_6_stage_8&#45;&gt;ring_attn_2_7_stage_8 -->
<g id="edge2367" class="edge">
<title>ring_attn_2_6_stage_8&#45;&gt;ring_attn_2_7_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-8042C6205.02,-8042 6363.86,-8042 6363.86,-8042"/>
<polygon fill="red" stroke="red" points="6363.86,-8045.5 6373.86,-8042 6363.86,-8038.5 6363.86,-8045.5"/>
</g>
<!-- ring_attn_2_6_stage_9&#45;&gt;ring_attn_2_6_stage_10 -->
<g id="edge643" class="edge">
<title>ring_attn_2_6_stage_9&#45;&gt;ring_attn_2_6_stage_10</title>
<path fill="none" stroke="black" d="M5996,-7720.87C5996,-7720.87 5996,-7614.25 5996,-7614.25"/>
<polygon fill="black" stroke="black" points="5999.5,-7614.25 5996,-7604.25 5992.5,-7614.25 5999.5,-7614.25"/>
</g>
<!-- ring_attn_2_7_stage_9 -->
<g id="node747" class="node">
<title>ring_attn_2_7_stage_9</title>
<polygon fill="yellow" stroke="black" points="6583,-7857 6374,-7789 6583,-7721 6792,-7789 6583,-7857"/>
<text text-anchor="middle" x="6583" y="-7807.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-7792.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="6583" y="-7777.8" font-family="Times,serif" font-size="14.00">Q[7]×K[14]×V[14]</text>
<text text-anchor="middle" x="6583" y="-7762.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_6_stage_9&#45;&gt;ring_attn_2_7_stage_9 -->
<g id="edge2368" class="edge">
<title>ring_attn_2_6_stage_9&#45;&gt;ring_attn_2_7_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-7789C6205.02,-7789 6363.86,-7789 6363.86,-7789"/>
<polygon fill="red" stroke="red" points="6363.86,-7792.5 6373.86,-7789 6363.86,-7785.5 6363.86,-7792.5"/>
</g>
<!-- ring_attn_2_6_stage_10&#45;&gt;ring_attn_2_6_stage_11 -->
<g id="edge644" class="edge">
<title>ring_attn_2_6_stage_10&#45;&gt;ring_attn_2_6_stage_11</title>
<path fill="none" stroke="black" d="M5996,-7467.87C5996,-7467.87 5996,-7361.25 5996,-7361.25"/>
<polygon fill="black" stroke="black" points="5999.5,-7361.25 5996,-7351.25 5992.5,-7361.25 5999.5,-7361.25"/>
</g>
<!-- ring_attn_2_7_stage_10 -->
<g id="node748" class="node">
<title>ring_attn_2_7_stage_10</title>
<polygon fill="yellow" stroke="black" points="6583,-7604 6374,-7536 6583,-7468 6792,-7536 6583,-7604"/>
<text text-anchor="middle" x="6583" y="-7554.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-7539.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="6583" y="-7524.8" font-family="Times,serif" font-size="14.00">Q[7]×K[13]×V[13]</text>
<text text-anchor="middle" x="6583" y="-7509.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_6_stage_10&#45;&gt;ring_attn_2_7_stage_10 -->
<g id="edge2369" class="edge">
<title>ring_attn_2_6_stage_10&#45;&gt;ring_attn_2_7_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-7536C6205.02,-7536 6363.86,-7536 6363.86,-7536"/>
<polygon fill="red" stroke="red" points="6363.86,-7539.5 6373.86,-7536 6363.86,-7532.5 6363.86,-7539.5"/>
</g>
<!-- ring_attn_2_6_stage_11&#45;&gt;ring_attn_2_6_stage_12 -->
<g id="edge645" class="edge">
<title>ring_attn_2_6_stage_11&#45;&gt;ring_attn_2_6_stage_12</title>
<path fill="none" stroke="black" d="M5996,-7214.87C5996,-7214.87 5996,-7108.25 5996,-7108.25"/>
<polygon fill="black" stroke="black" points="5999.5,-7108.25 5996,-7098.25 5992.5,-7108.25 5999.5,-7108.25"/>
</g>
<!-- ring_attn_2_7_stage_11 -->
<g id="node749" class="node">
<title>ring_attn_2_7_stage_11</title>
<polygon fill="yellow" stroke="black" points="6583,-7351 6374,-7283 6583,-7215 6792,-7283 6583,-7351"/>
<text text-anchor="middle" x="6583" y="-7301.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-7286.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="6583" y="-7271.8" font-family="Times,serif" font-size="14.00">Q[7]×K[12]×V[12]</text>
<text text-anchor="middle" x="6583" y="-7256.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_6_stage_11&#45;&gt;ring_attn_2_7_stage_11 -->
<g id="edge2370" class="edge">
<title>ring_attn_2_6_stage_11&#45;&gt;ring_attn_2_7_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-7283C6205.02,-7283 6363.86,-7283 6363.86,-7283"/>
<polygon fill="red" stroke="red" points="6363.86,-7286.5 6373.86,-7283 6363.86,-7279.5 6363.86,-7286.5"/>
</g>
<!-- ring_attn_2_6_stage_12&#45;&gt;ring_attn_2_6_stage_13 -->
<g id="edge646" class="edge">
<title>ring_attn_2_6_stage_12&#45;&gt;ring_attn_2_6_stage_13</title>
<path fill="none" stroke="black" d="M5996,-6961.87C5996,-6961.87 5996,-6855.25 5996,-6855.25"/>
<polygon fill="black" stroke="black" points="5999.5,-6855.25 5996,-6845.25 5992.5,-6855.25 5999.5,-6855.25"/>
</g>
<!-- ring_attn_2_7_stage_12 -->
<g id="node750" class="node">
<title>ring_attn_2_7_stage_12</title>
<polygon fill="yellow" stroke="black" points="6583,-7098 6374,-7030 6583,-6962 6792,-7030 6583,-7098"/>
<text text-anchor="middle" x="6583" y="-7048.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-7033.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="6583" y="-7018.8" font-family="Times,serif" font-size="14.00">Q[7]×K[11]×V[11]</text>
<text text-anchor="middle" x="6583" y="-7003.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_6_stage_12&#45;&gt;ring_attn_2_7_stage_12 -->
<g id="edge2371" class="edge">
<title>ring_attn_2_6_stage_12&#45;&gt;ring_attn_2_7_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-7030C6205.02,-7030 6363.86,-7030 6363.86,-7030"/>
<polygon fill="red" stroke="red" points="6363.86,-7033.5 6373.86,-7030 6363.86,-7026.5 6363.86,-7033.5"/>
</g>
<!-- ring_attn_2_6_stage_13&#45;&gt;ring_attn_2_6_stage_14 -->
<g id="edge647" class="edge">
<title>ring_attn_2_6_stage_13&#45;&gt;ring_attn_2_6_stage_14</title>
<path fill="none" stroke="black" d="M5996,-6708.87C5996,-6708.87 5996,-6602.25 5996,-6602.25"/>
<polygon fill="black" stroke="black" points="5999.5,-6602.25 5996,-6592.25 5992.5,-6602.25 5999.5,-6602.25"/>
</g>
<!-- ring_attn_2_7_stage_13 -->
<g id="node751" class="node">
<title>ring_attn_2_7_stage_13</title>
<polygon fill="yellow" stroke="black" points="6583,-6845 6374,-6777 6583,-6709 6792,-6777 6583,-6845"/>
<text text-anchor="middle" x="6583" y="-6795.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-6780.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="6583" y="-6765.8" font-family="Times,serif" font-size="14.00">Q[7]×K[10]×V[10]</text>
<text text-anchor="middle" x="6583" y="-6750.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_6_stage_13&#45;&gt;ring_attn_2_7_stage_13 -->
<g id="edge2372" class="edge">
<title>ring_attn_2_6_stage_13&#45;&gt;ring_attn_2_7_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-6777C6205.02,-6777 6363.86,-6777 6363.86,-6777"/>
<polygon fill="red" stroke="red" points="6363.86,-6780.5 6373.86,-6777 6363.86,-6773.5 6363.86,-6780.5"/>
</g>
<!-- ring_attn_2_6_stage_14&#45;&gt;ring_attn_2_6_stage_15 -->
<g id="edge648" class="edge">
<title>ring_attn_2_6_stage_14&#45;&gt;ring_attn_2_6_stage_15</title>
<path fill="none" stroke="black" d="M5996,-6455.87C5996,-6455.87 5996,-6349.25 5996,-6349.25"/>
<polygon fill="black" stroke="black" points="5999.5,-6349.25 5996,-6339.25 5992.5,-6349.25 5999.5,-6349.25"/>
</g>
<!-- ring_attn_2_7_stage_14 -->
<g id="node752" class="node">
<title>ring_attn_2_7_stage_14</title>
<polygon fill="yellow" stroke="black" points="6583,-6592 6374,-6524 6583,-6456 6792,-6524 6583,-6592"/>
<text text-anchor="middle" x="6583" y="-6542.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-6527.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="6583" y="-6512.8" font-family="Times,serif" font-size="14.00">Q[7]×K[9]×V[9]</text>
<text text-anchor="middle" x="6583" y="-6497.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_6_stage_14&#45;&gt;ring_attn_2_7_stage_14 -->
<g id="edge2373" class="edge">
<title>ring_attn_2_6_stage_14&#45;&gt;ring_attn_2_7_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-6524C6205.02,-6524 6363.86,-6524 6363.86,-6524"/>
<polygon fill="red" stroke="red" points="6363.86,-6527.5 6373.86,-6524 6363.86,-6520.5 6363.86,-6527.5"/>
</g>
<!-- attn_out_2_6 -->
<g id="node656" class="node">
<title>attn_out_2_6</title>
<polygon fill="none" stroke="black" points="6065.5,-6130 5926.5,-6130 5926.5,-6077 6065.5,-6077 6065.5,-6130"/>
<text text-anchor="middle" x="5996" y="-6114.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="5996" y="-6099.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="5996" y="-6084.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_2_6_stage_15&#45;&gt;attn_out_2_6 -->
<g id="edge649" class="edge">
<title>ring_attn_2_6_stage_15&#45;&gt;attn_out_2_6</title>
<path fill="none" stroke="black" d="M5996,-6202.87C5996,-6202.87 5996,-6140.18 5996,-6140.18"/>
<polygon fill="black" stroke="black" points="5999.5,-6140.18 5996,-6130.18 5992.5,-6140.18 5999.5,-6140.18"/>
</g>
<!-- ring_attn_2_7_stage_15 -->
<g id="node753" class="node">
<title>ring_attn_2_7_stage_15</title>
<polygon fill="yellow" stroke="black" points="6583,-6339 6374,-6271 6583,-6203 6792,-6271 6583,-6339"/>
<text text-anchor="middle" x="6583" y="-6289.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-6274.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="6583" y="-6259.8" font-family="Times,serif" font-size="14.00">Q[7]×K[8]×V[8]</text>
<text text-anchor="middle" x="6583" y="-6244.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_6_stage_15&#45;&gt;ring_attn_2_7_stage_15 -->
<g id="edge2374" class="edge">
<title>ring_attn_2_6_stage_15&#45;&gt;ring_attn_2_7_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-6271C6205.02,-6271 6363.86,-6271 6363.86,-6271"/>
<polygon fill="red" stroke="red" points="6363.86,-6274.5 6373.86,-6271 6363.86,-6267.5 6363.86,-6274.5"/>
</g>
<!-- attn_residual_2_6 -->
<g id="node657" class="node">
<title>attn_residual_2_6</title>
<ellipse fill="none" stroke="black" cx="5996" cy="-5977" rx="105.5" ry="27"/>
<text text-anchor="middle" x="5996" y="-5980.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="5996" y="-5965.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_2_6&#45;&gt;attn_residual_2_6 -->
<g id="edge650" class="edge">
<title>attn_out_2_6&#45;&gt;attn_residual_2_6</title>
<path fill="none" stroke="black" d="M5996,-6076.98C5996,-6076.98 5996,-6014.36 5996,-6014.36"/>
<polygon fill="black" stroke="black" points="5999.5,-6014.36 5996,-6004.36 5992.5,-6014.36 5999.5,-6014.36"/>
</g>
<!-- gate_2_6 -->
<g id="node658" class="node">
<title>gate_2_6</title>
<ellipse fill="orange" stroke="black" cx="5996" cy="-5839.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="5996" y="-5850.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="5996" y="-5835.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="5996" y="-5820.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_2_6&#45;&gt;gate_2_6 -->
<g id="edge651" class="edge">
<title>attn_residual_2_6&#45;&gt;gate_2_6</title>
<path fill="none" stroke="black" d="M5996,-5949.83C5996,-5949.83 5996,-5887.02 5996,-5887.02"/>
<polygon fill="black" stroke="black" points="5999.5,-5887.02 5996,-5877.02 5992.5,-5887.02 5999.5,-5887.02"/>
</g>
<!-- gate_2_6&#45;&gt;expert_2_0_0 -->
<g id="edge2375" class="edge">
<title>gate_2_6&#45;&gt;expert_2_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5943.25,-5872.21C5943.25,-5887.34 5943.25,-5902 5943.25,-5902 5943.25,-5902 336.29,-5902 336.29,-5902 336.29,-5902 336.29,-5680.19 336.29,-5680.19"/>
<polygon fill="blue" stroke="blue" points="339.79,-5680.19 336.29,-5670.19 332.79,-5680.19 339.79,-5680.19"/>
<text text-anchor="middle" x="24656.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="24656.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU6→GPU0</text>
<text text-anchor="middle" x="24656.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="24656.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_6&#45;&gt;expert_2_1_0 -->
<g id="edge2376" class="edge">
<title>gate_2_6&#45;&gt;expert_2_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5901.05,-5823.15C5901.05,-5802.32 5901.05,-5769 5901.05,-5769 5901.05,-5769 2984.27,-5769 2984.27,-5769 2984.27,-5769 2984.27,-5680.12 2984.27,-5680.12"/>
<polygon fill="blue" stroke="blue" points="2987.77,-5680.12 2984.27,-5670.12 2980.77,-5680.12 2987.77,-5680.12"/>
<text text-anchor="middle" x="24830.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="24830.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU6→GPU1</text>
<text text-anchor="middle" x="24830.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="24830.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_6&#45;&gt;expert_2_2_0 -->
<g id="edge2377" class="edge">
<title>gate_2_6&#45;&gt;expert_2_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5922.15,-5812.47C5922.15,-5792.22 5922.15,-5768 5922.15,-5768 5922.15,-5768 3581.57,-5768 3581.57,-5768 3581.57,-5768 3581.57,-5680.21 3581.57,-5680.21"/>
<polygon fill="blue" stroke="blue" points="3585.07,-5680.21 3581.57,-5670.21 3578.07,-5680.21 3585.07,-5680.21"/>
<text text-anchor="middle" x="25004.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25004.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU6→GPU2</text>
<text text-anchor="middle" x="25004.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25004.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_6&#45;&gt;expert_2_3_0 -->
<g id="edge2378" class="edge">
<title>gate_2_6&#45;&gt;expert_2_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5943.25,-5807.01C5943.25,-5791.38 5943.25,-5776 5943.25,-5776 5943.25,-5776 4171.7,-5776 4171.7,-5776 4171.7,-5776 4171.7,-5680.31 4171.7,-5680.31"/>
<polygon fill="blue" stroke="blue" points="4175.2,-5680.31 4171.7,-5670.31 4168.2,-5680.31 4175.2,-5680.31"/>
<text text-anchor="middle" x="25178.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25178.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU6→GPU3</text>
<text text-anchor="middle" x="25178.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25178.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_6&#45;&gt;expert_2_4_0 -->
<g id="edge2379" class="edge">
<title>gate_2_6&#45;&gt;expert_2_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5953.8,-5804.88C5953.8,-5799.13 5953.8,-5795 5953.8,-5795 5953.8,-5795 4936.5,-5795 4936.5,-5795 4936.5,-5795 4936.5,-5680.24 4936.5,-5680.24"/>
<polygon fill="blue" stroke="blue" points="4940,-5680.24 4936.5,-5670.24 4933,-5680.24 4940,-5680.24"/>
<text text-anchor="middle" x="25352.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25352.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU6→GPU4</text>
<text text-anchor="middle" x="25352.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25352.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_6&#45;&gt;expert_2_5_0 -->
<g id="edge2380" class="edge">
<title>gate_2_6&#45;&gt;expert_2_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5896.48,-5852C5757.26,-5852 5521.25,-5852 5521.25,-5852 5521.25,-5852 5521.25,-5680.33 5521.25,-5680.33"/>
<polygon fill="blue" stroke="blue" points="5524.75,-5680.33 5521.25,-5670.33 5517.75,-5680.33 5524.75,-5680.33"/>
<text text-anchor="middle" x="25526.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25526.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU6→GPU5</text>
<text text-anchor="middle" x="25526.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25526.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_6&#45;&gt;expert_2_6_0 -->
<g id="edge652" class="edge">
<title>gate_2_6&#45;&gt;expert_2_6_0</title>
<path fill="none" stroke="black" d="M5964.35,-5803.55C5964.35,-5803.55 5964.35,-5680.11 5964.35,-5680.11"/>
<polygon fill="black" stroke="black" points="5967.85,-5680.11 5964.35,-5670.11 5960.85,-5680.11 5967.85,-5680.11"/>
</g>
<!-- gate_2_6&#45;&gt;expert_2_7_0 -->
<g id="edge2381" class="edge">
<title>gate_2_6&#45;&gt;expert_2_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6095.65,-5827C6235.77,-5827 6474.12,-5827 6474.12,-5827 6474.12,-5827 6474.12,-5680.18 6474.12,-5680.18"/>
<polygon fill="blue" stroke="blue" points="6477.63,-5680.18 6474.12,-5670.18 6470.63,-5680.18 6477.63,-5680.18"/>
<text text-anchor="middle" x="25700.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25700.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU6→GPU7</text>
<text text-anchor="middle" x="25700.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25700.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_6&#45;&gt;expert_2_8_0 -->
<g id="edge2382" class="edge">
<title>gate_2_6&#45;&gt;expert_2_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6027.65,-5803.72C6027.65,-5792.5 6027.65,-5783 6027.65,-5783 6027.65,-5783 7057.75,-5783 7057.75,-5783 7057.75,-5783 7057.75,-5680.07 7057.75,-5680.07"/>
<polygon fill="blue" stroke="blue" points="7061.25,-5680.07 7057.75,-5670.07 7054.25,-5680.07 7061.25,-5680.07"/>
<text text-anchor="middle" x="25874.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25874.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU6→GPU8</text>
<text text-anchor="middle" x="25874.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25874.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_6&#45;&gt;expert_2_9_0 -->
<g id="edge2383" class="edge">
<title>gate_2_6&#45;&gt;expert_2_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6038.2,-5804.83C6038.2,-5784.2 6038.2,-5762 6038.2,-5762 6038.2,-5762 7641.38,-5762 7641.38,-5762 7641.38,-5762 7641.38,-5680.09 7641.38,-5680.09"/>
<polygon fill="blue" stroke="blue" points="7644.88,-5680.09 7641.38,-5670.09 7637.88,-5680.09 7644.88,-5680.09"/>
<text text-anchor="middle" x="26048.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26048.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU6→GPU9</text>
<text text-anchor="middle" x="26048.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26048.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_6&#45;&gt;expert_2_10_0 -->
<g id="edge2384" class="edge">
<title>gate_2_6&#45;&gt;expert_2_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6048.75,-5806.69C6048.75,-5782.58 6048.75,-5754 6048.75,-5754 6048.75,-5754 8338.98,-5754 8338.98,-5754 8338.98,-5754 8338.98,-5680.25 8338.98,-5680.25"/>
<polygon fill="blue" stroke="blue" points="8342.48,-5680.25 8338.98,-5670.25 8335.48,-5680.25 8342.48,-5680.25"/>
<text text-anchor="middle" x="26222.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26222.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU6→GPU10</text>
<text text-anchor="middle" x="26222.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26222.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_6&#45;&gt;expert_2_11_0 -->
<g id="edge2385" class="edge">
<title>gate_2_6&#45;&gt;expert_2_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6059.3,-5809.2C6059.3,-5783.23 6059.3,-5750 6059.3,-5750 6059.3,-5750 8925.98,-5750 8925.98,-5750 8925.98,-5750 8925.98,-5680.1 8925.98,-5680.1"/>
<polygon fill="blue" stroke="blue" points="8929.48,-5680.1 8925.98,-5670.1 8922.48,-5680.1 8929.48,-5680.1"/>
<text text-anchor="middle" x="26396.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26396.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU6→GPU11</text>
<text text-anchor="middle" x="26396.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26396.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_6&#45;&gt;expert_2_12_0 -->
<g id="edge2386" class="edge">
<title>gate_2_6&#45;&gt;expert_2_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6069.85,-5812.67C6069.85,-5775.54 6069.85,-5713 6069.85,-5713 6069.85,-5713 9522.59,-5713 9522.59,-5713 9522.59,-5713 9522.59,-5680.17 9522.59,-5680.17"/>
<polygon fill="blue" stroke="blue" points="9526.09,-5680.17 9522.59,-5670.17 9519.09,-5680.17 9526.09,-5680.17"/>
<text text-anchor="middle" x="26570.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26570.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU6→GPU12</text>
<text text-anchor="middle" x="26570.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26570.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_6&#45;&gt;expert_2_13_0 -->
<g id="edge2387" class="edge">
<title>gate_2_6&#45;&gt;expert_2_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6080.4,-5816.94C6080.4,-5777.69 6080.4,-5701 6080.4,-5701 6080.4,-5701 10117.66,-5701 10117.66,-5701 10117.66,-5701 10117.66,-5680.23 10117.66,-5680.23"/>
<polygon fill="blue" stroke="blue" points="10121.16,-5680.23 10117.66,-5670.23 10114.16,-5680.23 10121.16,-5680.23"/>
<text text-anchor="middle" x="26744.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26744.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU6→GPU13</text>
<text text-anchor="middle" x="26744.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26744.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_6&#45;&gt;expert_2_14_0 -->
<g id="edge2388" class="edge">
<title>gate_2_6&#45;&gt;expert_2_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6090.95,-5822.91C6090.95,-5786.34 6090.95,-5702 6090.95,-5702 6090.95,-5702 10676.93,-5702 10676.93,-5702 10676.93,-5702 10676.93,-5680.01 10676.93,-5680.01"/>
<polygon fill="blue" stroke="blue" points="10680.43,-5680.01 10676.93,-5670.01 10673.43,-5680.01 10680.43,-5680.01"/>
<text text-anchor="middle" x="26918.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26918.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU6→GPU14</text>
<text text-anchor="middle" x="26918.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26918.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_6&#45;&gt;expert_2_15_0 -->
<g id="edge2389" class="edge">
<title>gate_2_6&#45;&gt;expert_2_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6048.75,-5872.16C6048.75,-5883.3 6048.75,-5893 6048.75,-5893 6048.75,-5893 11170.12,-5893 11170.12,-5893 11170.12,-5893 11170.12,-5680.2 11170.12,-5680.2"/>
<polygon fill="blue" stroke="blue" points="11173.63,-5680.2 11170.12,-5670.2 11166.63,-5680.2 11173.63,-5680.2"/>
<text text-anchor="middle" x="27092.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27092.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU6→GPU15</text>
<text text-anchor="middle" x="27092.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27092.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_6 -->
<g id="node660" class="node">
<title>expert_reduce_2_6</title>
<ellipse fill="none" stroke="black" cx="5996" cy="-5506.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="5996" y="-5517.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="5996" y="-5502.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="5996" y="-5487.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_6_0&#45;&gt;expert_reduce_2_6 -->
<g id="edge653" class="edge">
<title>expert_2_6_0&#45;&gt;expert_reduce_2_6</title>
<path fill="none" stroke="black" d="M5996,-5616.76C5996,-5616.76 5996,-5554.06 5996,-5554.06"/>
<polygon fill="black" stroke="black" points="5999.5,-5554.06 5996,-5544.06 5992.5,-5554.06 5999.5,-5554.06"/>
</g>
<!-- moe_residual_2_6 -->
<g id="node661" class="node">
<title>moe_residual_2_6</title>
<ellipse fill="none" stroke="black" cx="5996" cy="-5369" rx="105.5" ry="27"/>
<text text-anchor="middle" x="5996" y="-5372.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="5996" y="-5357.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_6&#45;&gt;moe_residual_2_6 -->
<g id="edge654" class="edge">
<title>expert_reduce_2_6&#45;&gt;moe_residual_2_6</title>
<path fill="none" stroke="black" d="M5996,-5468.93C5996,-5468.93 5996,-5406.06 5996,-5406.06"/>
<polygon fill="black" stroke="black" points="5999.5,-5406.06 5996,-5396.06 5992.5,-5406.06 5999.5,-5406.06"/>
</g>
<!-- qkv_proj_3_6 -->
<g id="node662" class="node">
<title>qkv_proj_3_6</title>
<polygon fill="none" stroke="black" points="6078.5,-5269 5913.5,-5269 5913.5,-5216 6078.5,-5216 6078.5,-5269"/>
<text text-anchor="middle" x="5996" y="-5253.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5996" y="-5238.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="5996" y="-5223.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_2_6&#45;&gt;qkv_proj_3_6 -->
<g id="edge655" class="edge">
<title>moe_residual_2_6&#45;&gt;qkv_proj_3_6</title>
<path fill="none" stroke="black" d="M5996,-5341.86C5996,-5341.86 5996,-5279.16 5996,-5279.16"/>
<polygon fill="black" stroke="black" points="5999.5,-5279.16 5996,-5269.16 5992.5,-5279.16 5999.5,-5279.16"/>
</g>
<!-- qkv_reshape_3_6 -->
<g id="node663" class="node">
<title>qkv_reshape_3_6</title>
<ellipse fill="none" stroke="black" cx="5996" cy="-5116" rx="148" ry="27"/>
<text text-anchor="middle" x="5996" y="-5119.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="5996" y="-5104.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_3_6&#45;&gt;qkv_reshape_3_6 -->
<g id="edge656" class="edge">
<title>qkv_proj_3_6&#45;&gt;qkv_reshape_3_6</title>
<path fill="none" stroke="black" d="M5996,-5215.98C5996,-5215.98 5996,-5153.36 5996,-5153.36"/>
<polygon fill="black" stroke="black" points="5999.5,-5153.36 5996,-5143.36 5992.5,-5153.36 5999.5,-5153.36"/>
</g>
<!-- qkv_reshape_3_6&#45;&gt;ring_attn_3_6_stage_0 -->
<g id="edge657" class="edge">
<title>qkv_reshape_3_6&#45;&gt;ring_attn_3_6_stage_0</title>
<path fill="none" stroke="black" d="M5996,-5088.72C5996,-5088.72 5996,-4982.16 5996,-4982.16"/>
<polygon fill="black" stroke="black" points="5999.5,-4982.16 5996,-4972.16 5992.5,-4982.16 5999.5,-4982.16"/>
</g>
<!-- ring_attn_3_6_stage_0&#45;&gt;ring_attn_3_6_stage_1 -->
<g id="edge658" class="edge">
<title>ring_attn_3_6_stage_0&#45;&gt;ring_attn_3_6_stage_1</title>
<path fill="none" stroke="black" d="M5996,-4835.87C5996,-4835.87 5996,-4729.25 5996,-4729.25"/>
<polygon fill="black" stroke="black" points="5999.5,-4729.25 5996,-4719.25 5992.5,-4729.25 5999.5,-4729.25"/>
</g>
<!-- ring_attn_3_7_stage_0 -->
<g id="node762" class="node">
<title>ring_attn_3_7_stage_0</title>
<polygon fill="yellow" stroke="black" points="6583,-4972 6374,-4904 6583,-4836 6792,-4904 6583,-4972"/>
<text text-anchor="middle" x="6583" y="-4922.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-4907.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="6583" y="-4892.8" font-family="Times,serif" font-size="14.00">Q[7]×K[7]×V[7]</text>
<text text-anchor="middle" x="6583" y="-4877.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_6_stage_0&#45;&gt;ring_attn_3_7_stage_0 -->
<g id="edge2390" class="edge">
<title>ring_attn_3_6_stage_0&#45;&gt;ring_attn_3_7_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-4904C6205.02,-4904 6363.86,-4904 6363.86,-4904"/>
<polygon fill="red" stroke="red" points="6363.86,-4907.5 6373.86,-4904 6363.86,-4900.5 6363.86,-4907.5"/>
</g>
<!-- ring_attn_3_6_stage_1&#45;&gt;ring_attn_3_6_stage_2 -->
<g id="edge659" class="edge">
<title>ring_attn_3_6_stage_1&#45;&gt;ring_attn_3_6_stage_2</title>
<path fill="none" stroke="black" d="M5996,-4582.87C5996,-4582.87 5996,-4476.25 5996,-4476.25"/>
<polygon fill="black" stroke="black" points="5999.5,-4476.25 5996,-4466.25 5992.5,-4476.25 5999.5,-4476.25"/>
</g>
<!-- ring_attn_3_7_stage_1 -->
<g id="node763" class="node">
<title>ring_attn_3_7_stage_1</title>
<polygon fill="yellow" stroke="black" points="6583,-4719 6374,-4651 6583,-4583 6792,-4651 6583,-4719"/>
<text text-anchor="middle" x="6583" y="-4669.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-4654.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="6583" y="-4639.8" font-family="Times,serif" font-size="14.00">Q[7]×K[6]×V[6]</text>
<text text-anchor="middle" x="6583" y="-4624.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_6_stage_1&#45;&gt;ring_attn_3_7_stage_1 -->
<g id="edge2391" class="edge">
<title>ring_attn_3_6_stage_1&#45;&gt;ring_attn_3_7_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-4651C6205.02,-4651 6363.86,-4651 6363.86,-4651"/>
<polygon fill="red" stroke="red" points="6363.86,-4654.5 6373.86,-4651 6363.86,-4647.5 6363.86,-4654.5"/>
</g>
<!-- ring_attn_3_6_stage_2&#45;&gt;ring_attn_3_6_stage_3 -->
<g id="edge660" class="edge">
<title>ring_attn_3_6_stage_2&#45;&gt;ring_attn_3_6_stage_3</title>
<path fill="none" stroke="black" d="M5996,-4329.87C5996,-4329.87 5996,-4223.25 5996,-4223.25"/>
<polygon fill="black" stroke="black" points="5999.5,-4223.25 5996,-4213.25 5992.5,-4223.25 5999.5,-4223.25"/>
</g>
<!-- ring_attn_3_7_stage_2 -->
<g id="node764" class="node">
<title>ring_attn_3_7_stage_2</title>
<polygon fill="yellow" stroke="black" points="6583,-4466 6374,-4398 6583,-4330 6792,-4398 6583,-4466"/>
<text text-anchor="middle" x="6583" y="-4416.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-4401.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="6583" y="-4386.8" font-family="Times,serif" font-size="14.00">Q[7]×K[5]×V[5]</text>
<text text-anchor="middle" x="6583" y="-4371.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_6_stage_2&#45;&gt;ring_attn_3_7_stage_2 -->
<g id="edge2392" class="edge">
<title>ring_attn_3_6_stage_2&#45;&gt;ring_attn_3_7_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-4398C6205.02,-4398 6363.86,-4398 6363.86,-4398"/>
<polygon fill="red" stroke="red" points="6363.86,-4401.5 6373.86,-4398 6363.86,-4394.5 6363.86,-4401.5"/>
</g>
<!-- ring_attn_3_6_stage_3&#45;&gt;ring_attn_3_6_stage_4 -->
<g id="edge661" class="edge">
<title>ring_attn_3_6_stage_3&#45;&gt;ring_attn_3_6_stage_4</title>
<path fill="none" stroke="black" d="M5996,-4076.87C5996,-4076.87 5996,-3970.25 5996,-3970.25"/>
<polygon fill="black" stroke="black" points="5999.5,-3970.25 5996,-3960.25 5992.5,-3970.25 5999.5,-3970.25"/>
</g>
<!-- ring_attn_3_7_stage_3 -->
<g id="node765" class="node">
<title>ring_attn_3_7_stage_3</title>
<polygon fill="yellow" stroke="black" points="6583,-4213 6374,-4145 6583,-4077 6792,-4145 6583,-4213"/>
<text text-anchor="middle" x="6583" y="-4163.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-4148.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="6583" y="-4133.8" font-family="Times,serif" font-size="14.00">Q[7]×K[4]×V[4]</text>
<text text-anchor="middle" x="6583" y="-4118.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_6_stage_3&#45;&gt;ring_attn_3_7_stage_3 -->
<g id="edge2393" class="edge">
<title>ring_attn_3_6_stage_3&#45;&gt;ring_attn_3_7_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-4145C6205.02,-4145 6363.86,-4145 6363.86,-4145"/>
<polygon fill="red" stroke="red" points="6363.86,-4148.5 6373.86,-4145 6363.86,-4141.5 6363.86,-4148.5"/>
</g>
<!-- ring_attn_3_6_stage_4&#45;&gt;ring_attn_3_6_stage_5 -->
<g id="edge662" class="edge">
<title>ring_attn_3_6_stage_4&#45;&gt;ring_attn_3_6_stage_5</title>
<path fill="none" stroke="black" d="M5996,-3823.87C5996,-3823.87 5996,-3717.25 5996,-3717.25"/>
<polygon fill="black" stroke="black" points="5999.5,-3717.25 5996,-3707.25 5992.5,-3717.25 5999.5,-3717.25"/>
</g>
<!-- ring_attn_3_7_stage_4 -->
<g id="node766" class="node">
<title>ring_attn_3_7_stage_4</title>
<polygon fill="yellow" stroke="black" points="6583,-3960 6374,-3892 6583,-3824 6792,-3892 6583,-3960"/>
<text text-anchor="middle" x="6583" y="-3910.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-3895.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="6583" y="-3880.8" font-family="Times,serif" font-size="14.00">Q[7]×K[3]×V[3]</text>
<text text-anchor="middle" x="6583" y="-3865.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_6_stage_4&#45;&gt;ring_attn_3_7_stage_4 -->
<g id="edge2394" class="edge">
<title>ring_attn_3_6_stage_4&#45;&gt;ring_attn_3_7_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-3892C6205.02,-3892 6363.86,-3892 6363.86,-3892"/>
<polygon fill="red" stroke="red" points="6363.86,-3895.5 6373.86,-3892 6363.86,-3888.5 6363.86,-3895.5"/>
</g>
<!-- ring_attn_3_6_stage_5&#45;&gt;ring_attn_3_6_stage_6 -->
<g id="edge663" class="edge">
<title>ring_attn_3_6_stage_5&#45;&gt;ring_attn_3_6_stage_6</title>
<path fill="none" stroke="black" d="M5996,-3570.87C5996,-3570.87 5996,-3464.25 5996,-3464.25"/>
<polygon fill="black" stroke="black" points="5999.5,-3464.25 5996,-3454.25 5992.5,-3464.25 5999.5,-3464.25"/>
</g>
<!-- ring_attn_3_7_stage_5 -->
<g id="node767" class="node">
<title>ring_attn_3_7_stage_5</title>
<polygon fill="yellow" stroke="black" points="6583,-3707 6374,-3639 6583,-3571 6792,-3639 6583,-3707"/>
<text text-anchor="middle" x="6583" y="-3657.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-3642.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="6583" y="-3627.8" font-family="Times,serif" font-size="14.00">Q[7]×K[2]×V[2]</text>
<text text-anchor="middle" x="6583" y="-3612.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_6_stage_5&#45;&gt;ring_attn_3_7_stage_5 -->
<g id="edge2395" class="edge">
<title>ring_attn_3_6_stage_5&#45;&gt;ring_attn_3_7_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-3639C6205.02,-3639 6363.86,-3639 6363.86,-3639"/>
<polygon fill="red" stroke="red" points="6363.86,-3642.5 6373.86,-3639 6363.86,-3635.5 6363.86,-3642.5"/>
</g>
<!-- ring_attn_3_6_stage_6&#45;&gt;ring_attn_3_6_stage_7 -->
<g id="edge664" class="edge">
<title>ring_attn_3_6_stage_6&#45;&gt;ring_attn_3_6_stage_7</title>
<path fill="none" stroke="black" d="M5996,-3317.87C5996,-3317.87 5996,-3211.25 5996,-3211.25"/>
<polygon fill="black" stroke="black" points="5999.5,-3211.25 5996,-3201.25 5992.5,-3211.25 5999.5,-3211.25"/>
</g>
<!-- ring_attn_3_7_stage_6 -->
<g id="node768" class="node">
<title>ring_attn_3_7_stage_6</title>
<polygon fill="yellow" stroke="black" points="6583,-3454 6374,-3386 6583,-3318 6792,-3386 6583,-3454"/>
<text text-anchor="middle" x="6583" y="-3404.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-3389.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="6583" y="-3374.8" font-family="Times,serif" font-size="14.00">Q[7]×K[1]×V[1]</text>
<text text-anchor="middle" x="6583" y="-3359.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_6_stage_6&#45;&gt;ring_attn_3_7_stage_6 -->
<g id="edge2396" class="edge">
<title>ring_attn_3_6_stage_6&#45;&gt;ring_attn_3_7_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-3386C6205.02,-3386 6363.86,-3386 6363.86,-3386"/>
<polygon fill="red" stroke="red" points="6363.86,-3389.5 6373.86,-3386 6363.86,-3382.5 6363.86,-3389.5"/>
</g>
<!-- ring_attn_3_6_stage_7&#45;&gt;ring_attn_3_6_stage_8 -->
<g id="edge665" class="edge">
<title>ring_attn_3_6_stage_7&#45;&gt;ring_attn_3_6_stage_8</title>
<path fill="none" stroke="black" d="M5996,-3064.87C5996,-3064.87 5996,-2958.25 5996,-2958.25"/>
<polygon fill="black" stroke="black" points="5999.5,-2958.25 5996,-2948.25 5992.5,-2958.25 5999.5,-2958.25"/>
</g>
<!-- ring_attn_3_7_stage_7 -->
<g id="node769" class="node">
<title>ring_attn_3_7_stage_7</title>
<polygon fill="yellow" stroke="black" points="6583,-3201 6374,-3133 6583,-3065 6792,-3133 6583,-3201"/>
<text text-anchor="middle" x="6583" y="-3151.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-3136.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="6583" y="-3121.8" font-family="Times,serif" font-size="14.00">Q[7]×K[0]×V[0]</text>
<text text-anchor="middle" x="6583" y="-3106.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_6_stage_7&#45;&gt;ring_attn_3_7_stage_7 -->
<g id="edge2397" class="edge">
<title>ring_attn_3_6_stage_7&#45;&gt;ring_attn_3_7_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-3133C6205.02,-3133 6363.86,-3133 6363.86,-3133"/>
<polygon fill="red" stroke="red" points="6363.86,-3136.5 6373.86,-3133 6363.86,-3129.5 6363.86,-3136.5"/>
</g>
<!-- ring_attn_3_6_stage_8&#45;&gt;ring_attn_3_6_stage_9 -->
<g id="edge666" class="edge">
<title>ring_attn_3_6_stage_8&#45;&gt;ring_attn_3_6_stage_9</title>
<path fill="none" stroke="black" d="M5996,-2811.87C5996,-2811.87 5996,-2705.25 5996,-2705.25"/>
<polygon fill="black" stroke="black" points="5999.5,-2705.25 5996,-2695.25 5992.5,-2705.25 5999.5,-2705.25"/>
</g>
<!-- ring_attn_3_7_stage_8 -->
<g id="node770" class="node">
<title>ring_attn_3_7_stage_8</title>
<polygon fill="yellow" stroke="black" points="6583,-2948 6374,-2880 6583,-2812 6792,-2880 6583,-2948"/>
<text text-anchor="middle" x="6583" y="-2898.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-2883.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="6583" y="-2868.8" font-family="Times,serif" font-size="14.00">Q[7]×K[15]×V[15]</text>
<text text-anchor="middle" x="6583" y="-2853.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_6_stage_8&#45;&gt;ring_attn_3_7_stage_8 -->
<g id="edge2398" class="edge">
<title>ring_attn_3_6_stage_8&#45;&gt;ring_attn_3_7_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-2880C6205.02,-2880 6363.86,-2880 6363.86,-2880"/>
<polygon fill="red" stroke="red" points="6363.86,-2883.5 6373.86,-2880 6363.86,-2876.5 6363.86,-2883.5"/>
</g>
<!-- ring_attn_3_6_stage_9&#45;&gt;ring_attn_3_6_stage_10 -->
<g id="edge667" class="edge">
<title>ring_attn_3_6_stage_9&#45;&gt;ring_attn_3_6_stage_10</title>
<path fill="none" stroke="black" d="M5996,-2558.87C5996,-2558.87 5996,-2452.25 5996,-2452.25"/>
<polygon fill="black" stroke="black" points="5999.5,-2452.25 5996,-2442.25 5992.5,-2452.25 5999.5,-2452.25"/>
</g>
<!-- ring_attn_3_7_stage_9 -->
<g id="node771" class="node">
<title>ring_attn_3_7_stage_9</title>
<polygon fill="yellow" stroke="black" points="6583,-2695 6374,-2627 6583,-2559 6792,-2627 6583,-2695"/>
<text text-anchor="middle" x="6583" y="-2645.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-2630.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="6583" y="-2615.8" font-family="Times,serif" font-size="14.00">Q[7]×K[14]×V[14]</text>
<text text-anchor="middle" x="6583" y="-2600.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_6_stage_9&#45;&gt;ring_attn_3_7_stage_9 -->
<g id="edge2399" class="edge">
<title>ring_attn_3_6_stage_9&#45;&gt;ring_attn_3_7_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-2627C6205.02,-2627 6363.86,-2627 6363.86,-2627"/>
<polygon fill="red" stroke="red" points="6363.86,-2630.5 6373.86,-2627 6363.86,-2623.5 6363.86,-2630.5"/>
</g>
<!-- ring_attn_3_6_stage_10&#45;&gt;ring_attn_3_6_stage_11 -->
<g id="edge668" class="edge">
<title>ring_attn_3_6_stage_10&#45;&gt;ring_attn_3_6_stage_11</title>
<path fill="none" stroke="black" d="M5996,-2305.87C5996,-2305.87 5996,-2199.25 5996,-2199.25"/>
<polygon fill="black" stroke="black" points="5999.5,-2199.25 5996,-2189.25 5992.5,-2199.25 5999.5,-2199.25"/>
</g>
<!-- ring_attn_3_7_stage_10 -->
<g id="node772" class="node">
<title>ring_attn_3_7_stage_10</title>
<polygon fill="yellow" stroke="black" points="6583,-2442 6374,-2374 6583,-2306 6792,-2374 6583,-2442"/>
<text text-anchor="middle" x="6583" y="-2392.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-2377.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="6583" y="-2362.8" font-family="Times,serif" font-size="14.00">Q[7]×K[13]×V[13]</text>
<text text-anchor="middle" x="6583" y="-2347.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_6_stage_10&#45;&gt;ring_attn_3_7_stage_10 -->
<g id="edge2400" class="edge">
<title>ring_attn_3_6_stage_10&#45;&gt;ring_attn_3_7_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-2374C6205.02,-2374 6363.86,-2374 6363.86,-2374"/>
<polygon fill="red" stroke="red" points="6363.86,-2377.5 6373.86,-2374 6363.86,-2370.5 6363.86,-2377.5"/>
</g>
<!-- ring_attn_3_6_stage_11&#45;&gt;ring_attn_3_6_stage_12 -->
<g id="edge669" class="edge">
<title>ring_attn_3_6_stage_11&#45;&gt;ring_attn_3_6_stage_12</title>
<path fill="none" stroke="black" d="M5996,-2052.87C5996,-2052.87 5996,-1946.25 5996,-1946.25"/>
<polygon fill="black" stroke="black" points="5999.5,-1946.25 5996,-1936.25 5992.5,-1946.25 5999.5,-1946.25"/>
</g>
<!-- ring_attn_3_7_stage_11 -->
<g id="node773" class="node">
<title>ring_attn_3_7_stage_11</title>
<polygon fill="yellow" stroke="black" points="6583,-2189 6374,-2121 6583,-2053 6792,-2121 6583,-2189"/>
<text text-anchor="middle" x="6583" y="-2139.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-2124.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="6583" y="-2109.8" font-family="Times,serif" font-size="14.00">Q[7]×K[12]×V[12]</text>
<text text-anchor="middle" x="6583" y="-2094.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_6_stage_11&#45;&gt;ring_attn_3_7_stage_11 -->
<g id="edge2401" class="edge">
<title>ring_attn_3_6_stage_11&#45;&gt;ring_attn_3_7_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-2121C6205.02,-2121 6363.86,-2121 6363.86,-2121"/>
<polygon fill="red" stroke="red" points="6363.86,-2124.5 6373.86,-2121 6363.86,-2117.5 6363.86,-2124.5"/>
</g>
<!-- ring_attn_3_6_stage_12&#45;&gt;ring_attn_3_6_stage_13 -->
<g id="edge670" class="edge">
<title>ring_attn_3_6_stage_12&#45;&gt;ring_attn_3_6_stage_13</title>
<path fill="none" stroke="black" d="M5996,-1799.87C5996,-1799.87 5996,-1693.25 5996,-1693.25"/>
<polygon fill="black" stroke="black" points="5999.5,-1693.25 5996,-1683.25 5992.5,-1693.25 5999.5,-1693.25"/>
</g>
<!-- ring_attn_3_7_stage_12 -->
<g id="node774" class="node">
<title>ring_attn_3_7_stage_12</title>
<polygon fill="yellow" stroke="black" points="6583,-1936 6374,-1868 6583,-1800 6792,-1868 6583,-1936"/>
<text text-anchor="middle" x="6583" y="-1886.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-1871.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="6583" y="-1856.8" font-family="Times,serif" font-size="14.00">Q[7]×K[11]×V[11]</text>
<text text-anchor="middle" x="6583" y="-1841.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_6_stage_12&#45;&gt;ring_attn_3_7_stage_12 -->
<g id="edge2402" class="edge">
<title>ring_attn_3_6_stage_12&#45;&gt;ring_attn_3_7_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-1868C6205.02,-1868 6363.86,-1868 6363.86,-1868"/>
<polygon fill="red" stroke="red" points="6363.86,-1871.5 6373.86,-1868 6363.86,-1864.5 6363.86,-1871.5"/>
</g>
<!-- ring_attn_3_6_stage_13&#45;&gt;ring_attn_3_6_stage_14 -->
<g id="edge671" class="edge">
<title>ring_attn_3_6_stage_13&#45;&gt;ring_attn_3_6_stage_14</title>
<path fill="none" stroke="black" d="M5996,-1546.87C5996,-1546.87 5996,-1440.25 5996,-1440.25"/>
<polygon fill="black" stroke="black" points="5999.5,-1440.25 5996,-1430.25 5992.5,-1440.25 5999.5,-1440.25"/>
</g>
<!-- ring_attn_3_7_stage_13 -->
<g id="node775" class="node">
<title>ring_attn_3_7_stage_13</title>
<polygon fill="yellow" stroke="black" points="6583,-1683 6374,-1615 6583,-1547 6792,-1615 6583,-1683"/>
<text text-anchor="middle" x="6583" y="-1633.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-1618.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="6583" y="-1603.8" font-family="Times,serif" font-size="14.00">Q[7]×K[10]×V[10]</text>
<text text-anchor="middle" x="6583" y="-1588.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_6_stage_13&#45;&gt;ring_attn_3_7_stage_13 -->
<g id="edge2403" class="edge">
<title>ring_attn_3_6_stage_13&#45;&gt;ring_attn_3_7_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-1615C6205.02,-1615 6363.86,-1615 6363.86,-1615"/>
<polygon fill="red" stroke="red" points="6363.86,-1618.5 6373.86,-1615 6363.86,-1611.5 6363.86,-1618.5"/>
</g>
<!-- ring_attn_3_6_stage_14&#45;&gt;ring_attn_3_6_stage_15 -->
<g id="edge672" class="edge">
<title>ring_attn_3_6_stage_14&#45;&gt;ring_attn_3_6_stage_15</title>
<path fill="none" stroke="black" d="M5996,-1293.87C5996,-1293.87 5996,-1187.25 5996,-1187.25"/>
<polygon fill="black" stroke="black" points="5999.5,-1187.25 5996,-1177.25 5992.5,-1187.25 5999.5,-1187.25"/>
</g>
<!-- ring_attn_3_7_stage_14 -->
<g id="node776" class="node">
<title>ring_attn_3_7_stage_14</title>
<polygon fill="yellow" stroke="black" points="6583,-1430 6374,-1362 6583,-1294 6792,-1362 6583,-1430"/>
<text text-anchor="middle" x="6583" y="-1380.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-1365.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="6583" y="-1350.8" font-family="Times,serif" font-size="14.00">Q[7]×K[9]×V[9]</text>
<text text-anchor="middle" x="6583" y="-1335.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_6_stage_14&#45;&gt;ring_attn_3_7_stage_14 -->
<g id="edge2404" class="edge">
<title>ring_attn_3_6_stage_14&#45;&gt;ring_attn_3_7_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-1362C6205.02,-1362 6363.86,-1362 6363.86,-1362"/>
<polygon fill="red" stroke="red" points="6363.86,-1365.5 6373.86,-1362 6363.86,-1358.5 6363.86,-1365.5"/>
</g>
<!-- attn_out_3_6 -->
<g id="node680" class="node">
<title>attn_out_3_6</title>
<polygon fill="none" stroke="black" points="6065.5,-968 5926.5,-968 5926.5,-915 6065.5,-915 6065.5,-968"/>
<text text-anchor="middle" x="5996" y="-952.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="5996" y="-937.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="5996" y="-922.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_3_6_stage_15&#45;&gt;attn_out_3_6 -->
<g id="edge673" class="edge">
<title>ring_attn_3_6_stage_15&#45;&gt;attn_out_3_6</title>
<path fill="none" stroke="black" d="M5996,-1040.87C5996,-1040.87 5996,-978.18 5996,-978.18"/>
<polygon fill="black" stroke="black" points="5999.5,-978.18 5996,-968.18 5992.5,-978.18 5999.5,-978.18"/>
</g>
<!-- ring_attn_3_7_stage_15 -->
<g id="node777" class="node">
<title>ring_attn_3_7_stage_15</title>
<polygon fill="yellow" stroke="black" points="6583,-1177 6374,-1109 6583,-1041 6792,-1109 6583,-1177"/>
<text text-anchor="middle" x="6583" y="-1127.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="6583" y="-1112.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="6583" y="-1097.8" font-family="Times,serif" font-size="14.00">Q[7]×K[8]×V[8]</text>
<text text-anchor="middle" x="6583" y="-1082.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_6_stage_15&#45;&gt;ring_attn_3_7_stage_15 -->
<g id="edge2405" class="edge">
<title>ring_attn_3_6_stage_15&#45;&gt;ring_attn_3_7_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6205.02,-1109C6205.02,-1109 6363.86,-1109 6363.86,-1109"/>
<polygon fill="red" stroke="red" points="6363.86,-1112.5 6373.86,-1109 6363.86,-1105.5 6363.86,-1112.5"/>
</g>
<!-- attn_residual_3_6 -->
<g id="node681" class="node">
<title>attn_residual_3_6</title>
<ellipse fill="none" stroke="black" cx="5996" cy="-815" rx="105.5" ry="27"/>
<text text-anchor="middle" x="5996" y="-818.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="5996" y="-803.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_3_6&#45;&gt;attn_residual_3_6 -->
<g id="edge674" class="edge">
<title>attn_out_3_6&#45;&gt;attn_residual_3_6</title>
<path fill="none" stroke="black" d="M5996,-914.98C5996,-914.98 5996,-852.36 5996,-852.36"/>
<polygon fill="black" stroke="black" points="5999.5,-852.36 5996,-842.36 5992.5,-852.36 5999.5,-852.36"/>
</g>
<!-- gate_3_6 -->
<g id="node682" class="node">
<title>gate_3_6</title>
<ellipse fill="orange" stroke="black" cx="5996" cy="-677.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="5996" y="-688.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="5996" y="-673.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="5996" y="-658.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_3_6&#45;&gt;gate_3_6 -->
<g id="edge675" class="edge">
<title>attn_residual_3_6&#45;&gt;gate_3_6</title>
<path fill="none" stroke="black" d="M5996,-787.83C5996,-787.83 5996,-725.02 5996,-725.02"/>
<polygon fill="black" stroke="black" points="5999.5,-725.02 5996,-715.02 5992.5,-725.02 5999.5,-725.02"/>
</g>
<!-- gate_3_6&#45;&gt;expert_3_0_0 -->
<g id="edge2406" class="edge">
<title>gate_3_6&#45;&gt;expert_3_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5943.25,-710.21C5943.25,-725.34 5943.25,-740 5943.25,-740 5943.25,-740 336.29,-740 336.29,-740 336.29,-740 336.29,-518.19 336.29,-518.19"/>
<polygon fill="blue" stroke="blue" points="339.79,-518.19 336.29,-508.19 332.79,-518.19 339.79,-518.19"/>
<text text-anchor="middle" x="24656.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="24656.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU6→GPU0</text>
<text text-anchor="middle" x="24656.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="24656.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_6&#45;&gt;expert_3_1_0 -->
<g id="edge2407" class="edge">
<title>gate_3_6&#45;&gt;expert_3_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5901.05,-661.15C5901.05,-640.32 5901.05,-607 5901.05,-607 5901.05,-607 2984.27,-607 2984.27,-607 2984.27,-607 2984.27,-518.12 2984.27,-518.12"/>
<polygon fill="blue" stroke="blue" points="2987.77,-518.12 2984.27,-508.12 2980.77,-518.12 2987.77,-518.12"/>
<text text-anchor="middle" x="24830.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="24830.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU6→GPU1</text>
<text text-anchor="middle" x="24830.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="24830.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_6&#45;&gt;expert_3_2_0 -->
<g id="edge2408" class="edge">
<title>gate_3_6&#45;&gt;expert_3_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5922.15,-650.47C5922.15,-630.22 5922.15,-606 5922.15,-606 5922.15,-606 3581.57,-606 3581.57,-606 3581.57,-606 3581.57,-518.21 3581.57,-518.21"/>
<polygon fill="blue" stroke="blue" points="3585.07,-518.21 3581.57,-508.21 3578.07,-518.21 3585.07,-518.21"/>
<text text-anchor="middle" x="25004.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25004.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU6→GPU2</text>
<text text-anchor="middle" x="25004.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25004.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_6&#45;&gt;expert_3_3_0 -->
<g id="edge2409" class="edge">
<title>gate_3_6&#45;&gt;expert_3_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5943.25,-645.01C5943.25,-629.38 5943.25,-614 5943.25,-614 5943.25,-614 4171.7,-614 4171.7,-614 4171.7,-614 4171.7,-518.31 4171.7,-518.31"/>
<polygon fill="blue" stroke="blue" points="4175.2,-518.31 4171.7,-508.31 4168.2,-518.31 4175.2,-518.31"/>
<text text-anchor="middle" x="25178.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25178.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU6→GPU3</text>
<text text-anchor="middle" x="25178.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25178.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_6&#45;&gt;expert_3_4_0 -->
<g id="edge2410" class="edge">
<title>gate_3_6&#45;&gt;expert_3_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5953.8,-642.88C5953.8,-637.13 5953.8,-633 5953.8,-633 5953.8,-633 4936.5,-633 4936.5,-633 4936.5,-633 4936.5,-518.24 4936.5,-518.24"/>
<polygon fill="blue" stroke="blue" points="4940,-518.24 4936.5,-508.24 4933,-518.24 4940,-518.24"/>
<text text-anchor="middle" x="25352.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25352.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU6→GPU4</text>
<text text-anchor="middle" x="25352.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25352.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_6&#45;&gt;expert_3_5_0 -->
<g id="edge2411" class="edge">
<title>gate_3_6&#45;&gt;expert_3_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5896.48,-690C5757.26,-690 5521.25,-690 5521.25,-690 5521.25,-690 5521.25,-518.33 5521.25,-518.33"/>
<polygon fill="blue" stroke="blue" points="5524.75,-518.33 5521.25,-508.33 5517.75,-518.33 5524.75,-518.33"/>
<text text-anchor="middle" x="25526.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25526.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU6→GPU5</text>
<text text-anchor="middle" x="25526.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25526.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_6&#45;&gt;expert_3_6_0 -->
<g id="edge676" class="edge">
<title>gate_3_6&#45;&gt;expert_3_6_0</title>
<path fill="none" stroke="black" d="M5964.35,-641.55C5964.35,-641.55 5964.35,-518.11 5964.35,-518.11"/>
<polygon fill="black" stroke="black" points="5967.85,-518.11 5964.35,-508.11 5960.85,-518.11 5967.85,-518.11"/>
</g>
<!-- gate_3_6&#45;&gt;expert_3_7_0 -->
<g id="edge2412" class="edge">
<title>gate_3_6&#45;&gt;expert_3_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6095.65,-665C6235.77,-665 6474.12,-665 6474.12,-665 6474.12,-665 6474.12,-518.18 6474.12,-518.18"/>
<polygon fill="blue" stroke="blue" points="6477.63,-518.18 6474.12,-508.18 6470.63,-518.18 6477.63,-518.18"/>
<text text-anchor="middle" x="25700.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25700.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU6→GPU7</text>
<text text-anchor="middle" x="25700.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25700.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_6&#45;&gt;expert_3_8_0 -->
<g id="edge2413" class="edge">
<title>gate_3_6&#45;&gt;expert_3_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6027.65,-641.72C6027.65,-630.5 6027.65,-621 6027.65,-621 6027.65,-621 7057.75,-621 7057.75,-621 7057.75,-621 7057.75,-518.07 7057.75,-518.07"/>
<polygon fill="blue" stroke="blue" points="7061.25,-518.07 7057.75,-508.07 7054.25,-518.07 7061.25,-518.07"/>
<text text-anchor="middle" x="25874.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="25874.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU6→GPU8</text>
<text text-anchor="middle" x="25874.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="25874.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_6&#45;&gt;expert_3_9_0 -->
<g id="edge2414" class="edge">
<title>gate_3_6&#45;&gt;expert_3_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6038.2,-642.83C6038.2,-622.2 6038.2,-600 6038.2,-600 6038.2,-600 7641.38,-600 7641.38,-600 7641.38,-600 7641.38,-518.09 7641.38,-518.09"/>
<polygon fill="blue" stroke="blue" points="7644.88,-518.09 7641.38,-508.09 7637.88,-518.09 7644.88,-518.09"/>
<text text-anchor="middle" x="26048.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26048.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU6→GPU9</text>
<text text-anchor="middle" x="26048.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26048.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_6&#45;&gt;expert_3_10_0 -->
<g id="edge2415" class="edge">
<title>gate_3_6&#45;&gt;expert_3_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6048.75,-644.69C6048.75,-620.58 6048.75,-592 6048.75,-592 6048.75,-592 8338.98,-592 8338.98,-592 8338.98,-592 8338.98,-518.25 8338.98,-518.25"/>
<polygon fill="blue" stroke="blue" points="8342.48,-518.25 8338.98,-508.25 8335.48,-518.25 8342.48,-518.25"/>
<text text-anchor="middle" x="26222.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26222.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU6→GPU10</text>
<text text-anchor="middle" x="26222.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26222.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_6&#45;&gt;expert_3_11_0 -->
<g id="edge2416" class="edge">
<title>gate_3_6&#45;&gt;expert_3_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6059.3,-647.2C6059.3,-621.23 6059.3,-588 6059.3,-588 6059.3,-588 8925.98,-588 8925.98,-588 8925.98,-588 8925.98,-518.1 8925.98,-518.1"/>
<polygon fill="blue" stroke="blue" points="8929.48,-518.1 8925.98,-508.1 8922.48,-518.1 8929.48,-518.1"/>
<text text-anchor="middle" x="26396.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26396.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU6→GPU11</text>
<text text-anchor="middle" x="26396.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26396.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_6&#45;&gt;expert_3_12_0 -->
<g id="edge2417" class="edge">
<title>gate_3_6&#45;&gt;expert_3_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6069.85,-650.67C6069.85,-613.54 6069.85,-551 6069.85,-551 6069.85,-551 9522.59,-551 9522.59,-551 9522.59,-551 9522.59,-518.17 9522.59,-518.17"/>
<polygon fill="blue" stroke="blue" points="9526.09,-518.17 9522.59,-508.17 9519.09,-518.17 9526.09,-518.17"/>
<text text-anchor="middle" x="26570.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26570.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU6→GPU12</text>
<text text-anchor="middle" x="26570.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26570.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_6&#45;&gt;expert_3_13_0 -->
<g id="edge2418" class="edge">
<title>gate_3_6&#45;&gt;expert_3_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6080.4,-654.94C6080.4,-615.69 6080.4,-539 6080.4,-539 6080.4,-539 10117.66,-539 10117.66,-539 10117.66,-539 10117.66,-518.23 10117.66,-518.23"/>
<polygon fill="blue" stroke="blue" points="10121.16,-518.23 10117.66,-508.23 10114.16,-518.23 10121.16,-518.23"/>
<text text-anchor="middle" x="26744.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26744.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU6→GPU13</text>
<text text-anchor="middle" x="26744.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26744.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_6&#45;&gt;expert_3_14_0 -->
<g id="edge2419" class="edge">
<title>gate_3_6&#45;&gt;expert_3_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6090.95,-660.91C6090.95,-624.34 6090.95,-540 6090.95,-540 6090.95,-540 10676.93,-540 10676.93,-540 10676.93,-540 10676.93,-518.01 10676.93,-518.01"/>
<polygon fill="blue" stroke="blue" points="10680.43,-518.01 10676.93,-508.01 10673.43,-518.01 10680.43,-518.01"/>
<text text-anchor="middle" x="26918.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="26918.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU6→GPU14</text>
<text text-anchor="middle" x="26918.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="26918.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_6&#45;&gt;expert_3_15_0 -->
<g id="edge2420" class="edge">
<title>gate_3_6&#45;&gt;expert_3_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6048.75,-710.16C6048.75,-721.3 6048.75,-731 6048.75,-731 6048.75,-731 11170.12,-731 11170.12,-731 11170.12,-731 11170.12,-518.2 11170.12,-518.2"/>
<polygon fill="blue" stroke="blue" points="11173.63,-518.2 11170.12,-508.2 11166.63,-518.2 11173.63,-518.2"/>
<text text-anchor="middle" x="27092.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27092.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU6→GPU15</text>
<text text-anchor="middle" x="27092.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27092.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_6 -->
<g id="node684" class="node">
<title>expert_reduce_3_6</title>
<ellipse fill="none" stroke="black" cx="5996" cy="-344.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="5996" y="-355.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="5996" y="-340.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="5996" y="-325.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_6_0&#45;&gt;expert_reduce_3_6 -->
<g id="edge677" class="edge">
<title>expert_3_6_0&#45;&gt;expert_reduce_3_6</title>
<path fill="none" stroke="black" d="M5996,-454.76C5996,-454.76 5996,-392.06 5996,-392.06"/>
<polygon fill="black" stroke="black" points="5999.5,-392.06 5996,-382.06 5992.5,-392.06 5999.5,-392.06"/>
</g>
<!-- moe_residual_3_6 -->
<g id="node685" class="node">
<title>moe_residual_3_6</title>
<ellipse fill="none" stroke="black" cx="5996" cy="-207" rx="105.5" ry="27"/>
<text text-anchor="middle" x="5996" y="-210.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="5996" y="-195.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_6&#45;&gt;moe_residual_3_6 -->
<g id="edge678" class="edge">
<title>expert_reduce_3_6&#45;&gt;moe_residual_3_6</title>
<path fill="none" stroke="black" d="M5996,-306.93C5996,-306.93 5996,-244.06 5996,-244.06"/>
<polygon fill="black" stroke="black" points="5999.5,-244.06 5996,-234.06 5992.5,-244.06 5999.5,-244.06"/>
</g>
<!-- output_6 -->
<g id="node686" class="node">
<title>output_6</title>
<polygon fill="lightcoral" stroke="black" points="6089,-107 5903,-107 5903,-69 6089,-69 6089,-107"/>
<text text-anchor="middle" x="5996" y="-91.8" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="5996" y="-76.8" font-family="Times,serif" font-size="14.00">Y[6]: 1024×1024×4096</text>
</g>
<!-- moe_residual_3_6&#45;&gt;output_6 -->
<g id="edge679" class="edge">
<title>moe_residual_3_6&#45;&gt;output_6</title>
<path fill="none" stroke="black" d="M5996,-180C5996,-180 5996,-117.12 5996,-117.12"/>
<polygon fill="black" stroke="black" points="5999.5,-117.12 5996,-107.12 5992.5,-117.12 5999.5,-117.12"/>
</g>
<!-- input_7 -->
<g id="node687" class="node">
<title>input_7</title>
<polygon fill="lightgreen" stroke="black" points="6676.5,-20866 6489.5,-20866 6489.5,-20828 6676.5,-20828 6676.5,-20866"/>
<text text-anchor="middle" x="6583" y="-20850.8" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="6583" y="-20835.8" font-family="Times,serif" font-size="14.00">X[7]: 1024×1024×4096</text>
</g>
<!-- qkv_proj_0_7 -->
<g id="node688" class="node">
<title>qkv_proj_0_7</title>
<polygon fill="none" stroke="black" points="6665.5,-20755 6500.5,-20755 6500.5,-20702 6665.5,-20702 6665.5,-20755"/>
<text text-anchor="middle" x="6583" y="-20739.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="6583" y="-20724.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="6583" y="-20709.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- input_7&#45;&gt;qkv_proj_0_7 -->
<g id="edge680" class="edge">
<title>input_7&#45;&gt;qkv_proj_0_7</title>
<path fill="none" stroke="black" d="M6583,-20827.96C6583,-20827.96 6583,-20765.44 6583,-20765.44"/>
<polygon fill="black" stroke="black" points="6586.5,-20765.44 6583,-20755.44 6579.5,-20765.44 6586.5,-20765.44"/>
</g>
<!-- qkv_reshape_0_7 -->
<g id="node689" class="node">
<title>qkv_reshape_0_7</title>
<ellipse fill="none" stroke="black" cx="6583" cy="-20602" rx="148" ry="27"/>
<text text-anchor="middle" x="6583" y="-20605.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="6583" y="-20590.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_0_7&#45;&gt;qkv_reshape_0_7 -->
<g id="edge681" class="edge">
<title>qkv_proj_0_7&#45;&gt;qkv_reshape_0_7</title>
<path fill="none" stroke="black" d="M6583,-20701.98C6583,-20701.98 6583,-20639.36 6583,-20639.36"/>
<polygon fill="black" stroke="black" points="6586.5,-20639.36 6583,-20629.36 6579.5,-20639.36 6586.5,-20639.36"/>
</g>
<!-- qkv_reshape_0_7&#45;&gt;ring_attn_0_7_stage_0 -->
<g id="edge682" class="edge">
<title>qkv_reshape_0_7&#45;&gt;ring_attn_0_7_stage_0</title>
<path fill="none" stroke="black" d="M6583,-20574.72C6583,-20574.72 6583,-20468.16 6583,-20468.16"/>
<polygon fill="black" stroke="black" points="6586.5,-20468.16 6583,-20458.16 6579.5,-20468.16 6586.5,-20468.16"/>
</g>
<!-- ring_attn_0_7_stage_0&#45;&gt;ring_attn_0_7_stage_1 -->
<g id="edge683" class="edge">
<title>ring_attn_0_7_stage_0&#45;&gt;ring_attn_0_7_stage_1</title>
<path fill="none" stroke="black" d="M6583,-20321.87C6583,-20321.87 6583,-20215.25 6583,-20215.25"/>
<polygon fill="black" stroke="black" points="6586.5,-20215.25 6583,-20205.25 6579.5,-20215.25 6586.5,-20215.25"/>
</g>
<!-- ring_attn_0_8_stage_0 -->
<g id="node788" class="node">
<title>ring_attn_0_8_stage_0</title>
<polygon fill="yellow" stroke="black" points="7170,-20458 6961,-20390 7170,-20322 7379,-20390 7170,-20458"/>
<text text-anchor="middle" x="7170" y="-20408.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-20393.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="7170" y="-20378.8" font-family="Times,serif" font-size="14.00">Q[8]×K[8]×V[8]</text>
<text text-anchor="middle" x="7170" y="-20363.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_7_stage_0&#45;&gt;ring_attn_0_8_stage_0 -->
<g id="edge2421" class="edge">
<title>ring_attn_0_7_stage_0&#45;&gt;ring_attn_0_8_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-20390C6792.02,-20390 6950.86,-20390 6950.86,-20390"/>
<polygon fill="red" stroke="red" points="6950.86,-20393.5 6960.86,-20390 6950.86,-20386.5 6950.86,-20393.5"/>
</g>
<!-- ring_attn_0_7_stage_1&#45;&gt;ring_attn_0_7_stage_2 -->
<g id="edge684" class="edge">
<title>ring_attn_0_7_stage_1&#45;&gt;ring_attn_0_7_stage_2</title>
<path fill="none" stroke="black" d="M6583,-20068.87C6583,-20068.87 6583,-19962.25 6583,-19962.25"/>
<polygon fill="black" stroke="black" points="6586.5,-19962.25 6583,-19952.25 6579.5,-19962.25 6586.5,-19962.25"/>
</g>
<!-- ring_attn_0_8_stage_1 -->
<g id="node789" class="node">
<title>ring_attn_0_8_stage_1</title>
<polygon fill="yellow" stroke="black" points="7170,-20205 6961,-20137 7170,-20069 7379,-20137 7170,-20205"/>
<text text-anchor="middle" x="7170" y="-20155.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-20140.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="7170" y="-20125.8" font-family="Times,serif" font-size="14.00">Q[8]×K[7]×V[7]</text>
<text text-anchor="middle" x="7170" y="-20110.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_7_stage_1&#45;&gt;ring_attn_0_8_stage_1 -->
<g id="edge2422" class="edge">
<title>ring_attn_0_7_stage_1&#45;&gt;ring_attn_0_8_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-20137C6792.02,-20137 6950.86,-20137 6950.86,-20137"/>
<polygon fill="red" stroke="red" points="6950.86,-20140.5 6960.86,-20137 6950.86,-20133.5 6950.86,-20140.5"/>
</g>
<!-- ring_attn_0_7_stage_2&#45;&gt;ring_attn_0_7_stage_3 -->
<g id="edge685" class="edge">
<title>ring_attn_0_7_stage_2&#45;&gt;ring_attn_0_7_stage_3</title>
<path fill="none" stroke="black" d="M6583,-19815.87C6583,-19815.87 6583,-19709.25 6583,-19709.25"/>
<polygon fill="black" stroke="black" points="6586.5,-19709.25 6583,-19699.25 6579.5,-19709.25 6586.5,-19709.25"/>
</g>
<!-- ring_attn_0_8_stage_2 -->
<g id="node790" class="node">
<title>ring_attn_0_8_stage_2</title>
<polygon fill="yellow" stroke="black" points="7170,-19952 6961,-19884 7170,-19816 7379,-19884 7170,-19952"/>
<text text-anchor="middle" x="7170" y="-19902.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-19887.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="7170" y="-19872.8" font-family="Times,serif" font-size="14.00">Q[8]×K[6]×V[6]</text>
<text text-anchor="middle" x="7170" y="-19857.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_7_stage_2&#45;&gt;ring_attn_0_8_stage_2 -->
<g id="edge2423" class="edge">
<title>ring_attn_0_7_stage_2&#45;&gt;ring_attn_0_8_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-19884C6792.02,-19884 6950.86,-19884 6950.86,-19884"/>
<polygon fill="red" stroke="red" points="6950.86,-19887.5 6960.86,-19884 6950.86,-19880.5 6950.86,-19887.5"/>
</g>
<!-- ring_attn_0_7_stage_3&#45;&gt;ring_attn_0_7_stage_4 -->
<g id="edge686" class="edge">
<title>ring_attn_0_7_stage_3&#45;&gt;ring_attn_0_7_stage_4</title>
<path fill="none" stroke="black" d="M6583,-19562.87C6583,-19562.87 6583,-19456.25 6583,-19456.25"/>
<polygon fill="black" stroke="black" points="6586.5,-19456.25 6583,-19446.25 6579.5,-19456.25 6586.5,-19456.25"/>
</g>
<!-- ring_attn_0_8_stage_3 -->
<g id="node791" class="node">
<title>ring_attn_0_8_stage_3</title>
<polygon fill="yellow" stroke="black" points="7170,-19699 6961,-19631 7170,-19563 7379,-19631 7170,-19699"/>
<text text-anchor="middle" x="7170" y="-19649.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-19634.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="7170" y="-19619.8" font-family="Times,serif" font-size="14.00">Q[8]×K[5]×V[5]</text>
<text text-anchor="middle" x="7170" y="-19604.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_7_stage_3&#45;&gt;ring_attn_0_8_stage_3 -->
<g id="edge2424" class="edge">
<title>ring_attn_0_7_stage_3&#45;&gt;ring_attn_0_8_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-19631C6792.02,-19631 6950.86,-19631 6950.86,-19631"/>
<polygon fill="red" stroke="red" points="6950.86,-19634.5 6960.86,-19631 6950.86,-19627.5 6950.86,-19634.5"/>
</g>
<!-- ring_attn_0_7_stage_4&#45;&gt;ring_attn_0_7_stage_5 -->
<g id="edge687" class="edge">
<title>ring_attn_0_7_stage_4&#45;&gt;ring_attn_0_7_stage_5</title>
<path fill="none" stroke="black" d="M6583,-19309.87C6583,-19309.87 6583,-19203.25 6583,-19203.25"/>
<polygon fill="black" stroke="black" points="6586.5,-19203.25 6583,-19193.25 6579.5,-19203.25 6586.5,-19203.25"/>
</g>
<!-- ring_attn_0_8_stage_4 -->
<g id="node792" class="node">
<title>ring_attn_0_8_stage_4</title>
<polygon fill="yellow" stroke="black" points="7170,-19446 6961,-19378 7170,-19310 7379,-19378 7170,-19446"/>
<text text-anchor="middle" x="7170" y="-19396.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-19381.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="7170" y="-19366.8" font-family="Times,serif" font-size="14.00">Q[8]×K[4]×V[4]</text>
<text text-anchor="middle" x="7170" y="-19351.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_7_stage_4&#45;&gt;ring_attn_0_8_stage_4 -->
<g id="edge2425" class="edge">
<title>ring_attn_0_7_stage_4&#45;&gt;ring_attn_0_8_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-19378C6792.02,-19378 6950.86,-19378 6950.86,-19378"/>
<polygon fill="red" stroke="red" points="6950.86,-19381.5 6960.86,-19378 6950.86,-19374.5 6950.86,-19381.5"/>
</g>
<!-- ring_attn_0_7_stage_5&#45;&gt;ring_attn_0_7_stage_6 -->
<g id="edge688" class="edge">
<title>ring_attn_0_7_stage_5&#45;&gt;ring_attn_0_7_stage_6</title>
<path fill="none" stroke="black" d="M6583,-19056.87C6583,-19056.87 6583,-18950.25 6583,-18950.25"/>
<polygon fill="black" stroke="black" points="6586.5,-18950.25 6583,-18940.25 6579.5,-18950.25 6586.5,-18950.25"/>
</g>
<!-- ring_attn_0_8_stage_5 -->
<g id="node793" class="node">
<title>ring_attn_0_8_stage_5</title>
<polygon fill="yellow" stroke="black" points="7170,-19193 6961,-19125 7170,-19057 7379,-19125 7170,-19193"/>
<text text-anchor="middle" x="7170" y="-19143.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-19128.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="7170" y="-19113.8" font-family="Times,serif" font-size="14.00">Q[8]×K[3]×V[3]</text>
<text text-anchor="middle" x="7170" y="-19098.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_7_stage_5&#45;&gt;ring_attn_0_8_stage_5 -->
<g id="edge2426" class="edge">
<title>ring_attn_0_7_stage_5&#45;&gt;ring_attn_0_8_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-19125C6792.02,-19125 6950.86,-19125 6950.86,-19125"/>
<polygon fill="red" stroke="red" points="6950.86,-19128.5 6960.86,-19125 6950.86,-19121.5 6950.86,-19128.5"/>
</g>
<!-- ring_attn_0_7_stage_6&#45;&gt;ring_attn_0_7_stage_7 -->
<g id="edge689" class="edge">
<title>ring_attn_0_7_stage_6&#45;&gt;ring_attn_0_7_stage_7</title>
<path fill="none" stroke="black" d="M6583,-18803.87C6583,-18803.87 6583,-18697.25 6583,-18697.25"/>
<polygon fill="black" stroke="black" points="6586.5,-18697.25 6583,-18687.25 6579.5,-18697.25 6586.5,-18697.25"/>
</g>
<!-- ring_attn_0_8_stage_6 -->
<g id="node794" class="node">
<title>ring_attn_0_8_stage_6</title>
<polygon fill="yellow" stroke="black" points="7170,-18940 6961,-18872 7170,-18804 7379,-18872 7170,-18940"/>
<text text-anchor="middle" x="7170" y="-18890.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-18875.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="7170" y="-18860.8" font-family="Times,serif" font-size="14.00">Q[8]×K[2]×V[2]</text>
<text text-anchor="middle" x="7170" y="-18845.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_7_stage_6&#45;&gt;ring_attn_0_8_stage_6 -->
<g id="edge2427" class="edge">
<title>ring_attn_0_7_stage_6&#45;&gt;ring_attn_0_8_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-18872C6792.02,-18872 6950.86,-18872 6950.86,-18872"/>
<polygon fill="red" stroke="red" points="6950.86,-18875.5 6960.86,-18872 6950.86,-18868.5 6950.86,-18875.5"/>
</g>
<!-- ring_attn_0_7_stage_7&#45;&gt;ring_attn_0_7_stage_8 -->
<g id="edge690" class="edge">
<title>ring_attn_0_7_stage_7&#45;&gt;ring_attn_0_7_stage_8</title>
<path fill="none" stroke="black" d="M6583,-18550.87C6583,-18550.87 6583,-18444.25 6583,-18444.25"/>
<polygon fill="black" stroke="black" points="6586.5,-18444.25 6583,-18434.25 6579.5,-18444.25 6586.5,-18444.25"/>
</g>
<!-- ring_attn_0_8_stage_7 -->
<g id="node795" class="node">
<title>ring_attn_0_8_stage_7</title>
<polygon fill="yellow" stroke="black" points="7170,-18687 6961,-18619 7170,-18551 7379,-18619 7170,-18687"/>
<text text-anchor="middle" x="7170" y="-18637.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-18622.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="7170" y="-18607.8" font-family="Times,serif" font-size="14.00">Q[8]×K[1]×V[1]</text>
<text text-anchor="middle" x="7170" y="-18592.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_7_stage_7&#45;&gt;ring_attn_0_8_stage_7 -->
<g id="edge2428" class="edge">
<title>ring_attn_0_7_stage_7&#45;&gt;ring_attn_0_8_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-18619C6792.02,-18619 6950.86,-18619 6950.86,-18619"/>
<polygon fill="red" stroke="red" points="6950.86,-18622.5 6960.86,-18619 6950.86,-18615.5 6950.86,-18622.5"/>
</g>
<!-- ring_attn_0_7_stage_8&#45;&gt;ring_attn_0_7_stage_9 -->
<g id="edge691" class="edge">
<title>ring_attn_0_7_stage_8&#45;&gt;ring_attn_0_7_stage_9</title>
<path fill="none" stroke="black" d="M6583,-18297.87C6583,-18297.87 6583,-18191.25 6583,-18191.25"/>
<polygon fill="black" stroke="black" points="6586.5,-18191.25 6583,-18181.25 6579.5,-18191.25 6586.5,-18191.25"/>
</g>
<!-- ring_attn_0_8_stage_8 -->
<g id="node796" class="node">
<title>ring_attn_0_8_stage_8</title>
<polygon fill="yellow" stroke="black" points="7170,-18434 6961,-18366 7170,-18298 7379,-18366 7170,-18434"/>
<text text-anchor="middle" x="7170" y="-18384.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-18369.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="7170" y="-18354.8" font-family="Times,serif" font-size="14.00">Q[8]×K[0]×V[0]</text>
<text text-anchor="middle" x="7170" y="-18339.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_7_stage_8&#45;&gt;ring_attn_0_8_stage_8 -->
<g id="edge2429" class="edge">
<title>ring_attn_0_7_stage_8&#45;&gt;ring_attn_0_8_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-18366C6792.02,-18366 6950.86,-18366 6950.86,-18366"/>
<polygon fill="red" stroke="red" points="6950.86,-18369.5 6960.86,-18366 6950.86,-18362.5 6950.86,-18369.5"/>
</g>
<!-- ring_attn_0_7_stage_9&#45;&gt;ring_attn_0_7_stage_10 -->
<g id="edge692" class="edge">
<title>ring_attn_0_7_stage_9&#45;&gt;ring_attn_0_7_stage_10</title>
<path fill="none" stroke="black" d="M6583,-18044.87C6583,-18044.87 6583,-17938.25 6583,-17938.25"/>
<polygon fill="black" stroke="black" points="6586.5,-17938.25 6583,-17928.25 6579.5,-17938.25 6586.5,-17938.25"/>
</g>
<!-- ring_attn_0_8_stage_9 -->
<g id="node797" class="node">
<title>ring_attn_0_8_stage_9</title>
<polygon fill="yellow" stroke="black" points="7170,-18181 6961,-18113 7170,-18045 7379,-18113 7170,-18181"/>
<text text-anchor="middle" x="7170" y="-18131.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-18116.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="7170" y="-18101.8" font-family="Times,serif" font-size="14.00">Q[8]×K[15]×V[15]</text>
<text text-anchor="middle" x="7170" y="-18086.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_7_stage_9&#45;&gt;ring_attn_0_8_stage_9 -->
<g id="edge2430" class="edge">
<title>ring_attn_0_7_stage_9&#45;&gt;ring_attn_0_8_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-18113C6792.02,-18113 6950.86,-18113 6950.86,-18113"/>
<polygon fill="red" stroke="red" points="6950.86,-18116.5 6960.86,-18113 6950.86,-18109.5 6950.86,-18116.5"/>
</g>
<!-- ring_attn_0_7_stage_10&#45;&gt;ring_attn_0_7_stage_11 -->
<g id="edge693" class="edge">
<title>ring_attn_0_7_stage_10&#45;&gt;ring_attn_0_7_stage_11</title>
<path fill="none" stroke="black" d="M6583,-17791.87C6583,-17791.87 6583,-17685.25 6583,-17685.25"/>
<polygon fill="black" stroke="black" points="6586.5,-17685.25 6583,-17675.25 6579.5,-17685.25 6586.5,-17685.25"/>
</g>
<!-- ring_attn_0_8_stage_10 -->
<g id="node798" class="node">
<title>ring_attn_0_8_stage_10</title>
<polygon fill="yellow" stroke="black" points="7170,-17928 6961,-17860 7170,-17792 7379,-17860 7170,-17928"/>
<text text-anchor="middle" x="7170" y="-17878.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-17863.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="7170" y="-17848.8" font-family="Times,serif" font-size="14.00">Q[8]×K[14]×V[14]</text>
<text text-anchor="middle" x="7170" y="-17833.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_7_stage_10&#45;&gt;ring_attn_0_8_stage_10 -->
<g id="edge2431" class="edge">
<title>ring_attn_0_7_stage_10&#45;&gt;ring_attn_0_8_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-17860C6792.02,-17860 6950.86,-17860 6950.86,-17860"/>
<polygon fill="red" stroke="red" points="6950.86,-17863.5 6960.86,-17860 6950.86,-17856.5 6950.86,-17863.5"/>
</g>
<!-- ring_attn_0_7_stage_11&#45;&gt;ring_attn_0_7_stage_12 -->
<g id="edge694" class="edge">
<title>ring_attn_0_7_stage_11&#45;&gt;ring_attn_0_7_stage_12</title>
<path fill="none" stroke="black" d="M6583,-17538.87C6583,-17538.87 6583,-17432.25 6583,-17432.25"/>
<polygon fill="black" stroke="black" points="6586.5,-17432.25 6583,-17422.25 6579.5,-17432.25 6586.5,-17432.25"/>
</g>
<!-- ring_attn_0_8_stage_11 -->
<g id="node799" class="node">
<title>ring_attn_0_8_stage_11</title>
<polygon fill="yellow" stroke="black" points="7170,-17675 6961,-17607 7170,-17539 7379,-17607 7170,-17675"/>
<text text-anchor="middle" x="7170" y="-17625.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-17610.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="7170" y="-17595.8" font-family="Times,serif" font-size="14.00">Q[8]×K[13]×V[13]</text>
<text text-anchor="middle" x="7170" y="-17580.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_7_stage_11&#45;&gt;ring_attn_0_8_stage_11 -->
<g id="edge2432" class="edge">
<title>ring_attn_0_7_stage_11&#45;&gt;ring_attn_0_8_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-17607C6792.02,-17607 6950.86,-17607 6950.86,-17607"/>
<polygon fill="red" stroke="red" points="6950.86,-17610.5 6960.86,-17607 6950.86,-17603.5 6950.86,-17610.5"/>
</g>
<!-- ring_attn_0_7_stage_12&#45;&gt;ring_attn_0_7_stage_13 -->
<g id="edge695" class="edge">
<title>ring_attn_0_7_stage_12&#45;&gt;ring_attn_0_7_stage_13</title>
<path fill="none" stroke="black" d="M6583,-17285.87C6583,-17285.87 6583,-17179.25 6583,-17179.25"/>
<polygon fill="black" stroke="black" points="6586.5,-17179.25 6583,-17169.25 6579.5,-17179.25 6586.5,-17179.25"/>
</g>
<!-- ring_attn_0_8_stage_12 -->
<g id="node800" class="node">
<title>ring_attn_0_8_stage_12</title>
<polygon fill="yellow" stroke="black" points="7170,-17422 6961,-17354 7170,-17286 7379,-17354 7170,-17422"/>
<text text-anchor="middle" x="7170" y="-17372.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-17357.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="7170" y="-17342.8" font-family="Times,serif" font-size="14.00">Q[8]×K[12]×V[12]</text>
<text text-anchor="middle" x="7170" y="-17327.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_7_stage_12&#45;&gt;ring_attn_0_8_stage_12 -->
<g id="edge2433" class="edge">
<title>ring_attn_0_7_stage_12&#45;&gt;ring_attn_0_8_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-17354C6792.02,-17354 6950.86,-17354 6950.86,-17354"/>
<polygon fill="red" stroke="red" points="6950.86,-17357.5 6960.86,-17354 6950.86,-17350.5 6950.86,-17357.5"/>
</g>
<!-- ring_attn_0_7_stage_13&#45;&gt;ring_attn_0_7_stage_14 -->
<g id="edge696" class="edge">
<title>ring_attn_0_7_stage_13&#45;&gt;ring_attn_0_7_stage_14</title>
<path fill="none" stroke="black" d="M6583,-17032.87C6583,-17032.87 6583,-16926.25 6583,-16926.25"/>
<polygon fill="black" stroke="black" points="6586.5,-16926.25 6583,-16916.25 6579.5,-16926.25 6586.5,-16926.25"/>
</g>
<!-- ring_attn_0_8_stage_13 -->
<g id="node801" class="node">
<title>ring_attn_0_8_stage_13</title>
<polygon fill="yellow" stroke="black" points="7170,-17169 6961,-17101 7170,-17033 7379,-17101 7170,-17169"/>
<text text-anchor="middle" x="7170" y="-17119.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-17104.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="7170" y="-17089.8" font-family="Times,serif" font-size="14.00">Q[8]×K[11]×V[11]</text>
<text text-anchor="middle" x="7170" y="-17074.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_7_stage_13&#45;&gt;ring_attn_0_8_stage_13 -->
<g id="edge2434" class="edge">
<title>ring_attn_0_7_stage_13&#45;&gt;ring_attn_0_8_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-17101C6792.02,-17101 6950.86,-17101 6950.86,-17101"/>
<polygon fill="red" stroke="red" points="6950.86,-17104.5 6960.86,-17101 6950.86,-17097.5 6950.86,-17104.5"/>
</g>
<!-- ring_attn_0_7_stage_14&#45;&gt;ring_attn_0_7_stage_15 -->
<g id="edge697" class="edge">
<title>ring_attn_0_7_stage_14&#45;&gt;ring_attn_0_7_stage_15</title>
<path fill="none" stroke="black" d="M6583,-16779.87C6583,-16779.87 6583,-16673.25 6583,-16673.25"/>
<polygon fill="black" stroke="black" points="6586.5,-16673.25 6583,-16663.25 6579.5,-16673.25 6586.5,-16673.25"/>
</g>
<!-- ring_attn_0_8_stage_14 -->
<g id="node802" class="node">
<title>ring_attn_0_8_stage_14</title>
<polygon fill="yellow" stroke="black" points="7170,-16916 6961,-16848 7170,-16780 7379,-16848 7170,-16916"/>
<text text-anchor="middle" x="7170" y="-16866.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-16851.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="7170" y="-16836.8" font-family="Times,serif" font-size="14.00">Q[8]×K[10]×V[10]</text>
<text text-anchor="middle" x="7170" y="-16821.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_7_stage_14&#45;&gt;ring_attn_0_8_stage_14 -->
<g id="edge2435" class="edge">
<title>ring_attn_0_7_stage_14&#45;&gt;ring_attn_0_8_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-16848C6792.02,-16848 6950.86,-16848 6950.86,-16848"/>
<polygon fill="red" stroke="red" points="6950.86,-16851.5 6960.86,-16848 6950.86,-16844.5 6950.86,-16851.5"/>
</g>
<!-- attn_out_0_7 -->
<g id="node706" class="node">
<title>attn_out_0_7</title>
<polygon fill="none" stroke="black" points="6652.5,-16454 6513.5,-16454 6513.5,-16401 6652.5,-16401 6652.5,-16454"/>
<text text-anchor="middle" x="6583" y="-16438.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="6583" y="-16423.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="6583" y="-16408.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_0_7_stage_15&#45;&gt;attn_out_0_7 -->
<g id="edge698" class="edge">
<title>ring_attn_0_7_stage_15&#45;&gt;attn_out_0_7</title>
<path fill="none" stroke="black" d="M6583,-16526.87C6583,-16526.87 6583,-16464.18 6583,-16464.18"/>
<polygon fill="black" stroke="black" points="6586.5,-16464.18 6583,-16454.18 6579.5,-16464.18 6586.5,-16464.18"/>
</g>
<!-- ring_attn_0_8_stage_15 -->
<g id="node803" class="node">
<title>ring_attn_0_8_stage_15</title>
<polygon fill="yellow" stroke="black" points="7170,-16663 6961,-16595 7170,-16527 7379,-16595 7170,-16663"/>
<text text-anchor="middle" x="7170" y="-16613.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-16598.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="7170" y="-16583.8" font-family="Times,serif" font-size="14.00">Q[8]×K[9]×V[9]</text>
<text text-anchor="middle" x="7170" y="-16568.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_7_stage_15&#45;&gt;ring_attn_0_8_stage_15 -->
<g id="edge2436" class="edge">
<title>ring_attn_0_7_stage_15&#45;&gt;ring_attn_0_8_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-16595C6792.02,-16595 6950.86,-16595 6950.86,-16595"/>
<polygon fill="red" stroke="red" points="6950.86,-16598.5 6960.86,-16595 6950.86,-16591.5 6950.86,-16598.5"/>
</g>
<!-- attn_residual_0_7 -->
<g id="node707" class="node">
<title>attn_residual_0_7</title>
<ellipse fill="none" stroke="black" cx="6583" cy="-16301" rx="105.5" ry="27"/>
<text text-anchor="middle" x="6583" y="-16304.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="6583" y="-16289.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_0_7&#45;&gt;attn_residual_0_7 -->
<g id="edge699" class="edge">
<title>attn_out_0_7&#45;&gt;attn_residual_0_7</title>
<path fill="none" stroke="black" d="M6583,-16400.98C6583,-16400.98 6583,-16338.36 6583,-16338.36"/>
<polygon fill="black" stroke="black" points="6586.5,-16338.36 6583,-16328.36 6579.5,-16338.36 6586.5,-16338.36"/>
</g>
<!-- gate_0_7 -->
<g id="node708" class="node">
<title>gate_0_7</title>
<ellipse fill="orange" stroke="black" cx="6583" cy="-16163.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="6583" y="-16174.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="6583" y="-16159.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="6583" y="-16144.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_0_7&#45;&gt;gate_0_7 -->
<g id="edge700" class="edge">
<title>attn_residual_0_7&#45;&gt;gate_0_7</title>
<path fill="none" stroke="black" d="M6583,-16273.83C6583,-16273.83 6583,-16211.02 6583,-16211.02"/>
<polygon fill="black" stroke="black" points="6586.5,-16211.02 6583,-16201.02 6579.5,-16211.02 6586.5,-16211.02"/>
</g>
<!-- gate_0_7&#45;&gt;expert_0_0_0 -->
<g id="edge2437" class="edge">
<title>gate_0_7&#45;&gt;expert_0_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6530.25,-16196.29C6530.25,-16218.19 6530.25,-16243 6530.25,-16243 6530.25,-16243 334.36,-16243 334.36,-16243 334.36,-16243 334.36,-16004.17 334.36,-16004.17"/>
<polygon fill="blue" stroke="blue" points="337.86,-16004.17 334.36,-15994.17 330.86,-16004.17 337.86,-16004.17"/>
<text text-anchor="middle" x="27266.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27266.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU7→GPU0</text>
<text text-anchor="middle" x="27266.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27266.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_7&#45;&gt;expert_0_1_0 -->
<g id="edge2438" class="edge">
<title>gate_0_7&#45;&gt;expert_0_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6487.55,-16147.49C6487.55,-16125.33 6487.55,-16088 6487.55,-16088 6487.55,-16088 2993.86,-16088 2993.86,-16088 2993.86,-16088 2993.86,-16004.24 2993.86,-16004.24"/>
<polygon fill="blue" stroke="blue" points="2997.36,-16004.24 2993.86,-15994.24 2990.36,-16004.24 2997.36,-16004.24"/>
<text text-anchor="middle" x="27440.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27440.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU7→GPU1</text>
<text text-anchor="middle" x="27440.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27440.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_7&#45;&gt;expert_0_2_0 -->
<g id="edge2439" class="edge">
<title>gate_0_7&#45;&gt;expert_0_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6507.64,-16137.03C6507.64,-16104.34 6507.64,-16053 6507.64,-16053 6507.64,-16053 3589.39,-16053 3589.39,-16053 3589.39,-16053 3589.39,-16004.08 3589.39,-16004.08"/>
<polygon fill="blue" stroke="blue" points="3592.89,-16004.08 3589.39,-15994.08 3585.89,-16004.08 3592.89,-16004.08"/>
<text text-anchor="middle" x="27614.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27614.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU7→GPU2</text>
<text text-anchor="middle" x="27614.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27614.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_7&#45;&gt;expert_0_3_0 -->
<g id="edge2440" class="edge">
<title>gate_0_7&#45;&gt;expert_0_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6527.74,-16131.48C6527.74,-16110.9 6527.74,-16088 6527.74,-16088 6527.74,-16088 4180.14,-16088 4180.14,-16088 4180.14,-16088 4180.14,-16004.24 4180.14,-16004.24"/>
<polygon fill="blue" stroke="blue" points="4183.64,-16004.24 4180.14,-15994.24 4176.64,-16004.24 4183.64,-16004.24"/>
<text text-anchor="middle" x="27788.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27788.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU7→GPU3</text>
<text text-anchor="middle" x="27788.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27788.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_7&#45;&gt;expert_0_4_0 -->
<g id="edge2441" class="edge">
<title>gate_0_7&#45;&gt;expert_0_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6547.83,-16127.77C6547.83,-16111.58 6547.83,-16096 6547.83,-16096 6547.83,-16096 4776.79,-16096 4776.79,-16096 4776.79,-16096 4776.79,-16004.13 4776.79,-16004.13"/>
<polygon fill="blue" stroke="blue" points="4780.29,-16004.13 4776.79,-15994.13 4773.29,-16004.13 4780.29,-16004.13"/>
<text text-anchor="middle" x="27962.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27962.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU7→GPU4</text>
<text text-anchor="middle" x="27962.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27962.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_7&#45;&gt;expert_0_5_0 -->
<g id="edge2442" class="edge">
<title>gate_0_7&#45;&gt;expert_0_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6557.88,-16126.77C6557.88,-16121.6 6557.88,-16118 6557.88,-16118 6557.88,-16118 5524.62,-16118 5524.62,-16118 5524.62,-16118 5524.62,-16004.06 5524.62,-16004.06"/>
<polygon fill="blue" stroke="blue" points="5528.13,-16004.06 5524.62,-15994.06 5521.13,-16004.06 5528.13,-16004.06"/>
<text text-anchor="middle" x="28136.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="28136.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU7→GPU5</text>
<text text-anchor="middle" x="28136.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="28136.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_7&#45;&gt;expert_0_6_0 -->
<g id="edge2443" class="edge">
<title>gate_0_7&#45;&gt;expert_0_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6483.48,-16176C6344.26,-16176 6108.25,-16176 6108.25,-16176 6108.25,-16176 6108.25,-16004.33 6108.25,-16004.33"/>
<polygon fill="blue" stroke="blue" points="6111.75,-16004.33 6108.25,-15994.33 6104.75,-16004.33 6111.75,-16004.33"/>
<text text-anchor="middle" x="28310.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="28310.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU7→GPU6</text>
<text text-anchor="middle" x="28310.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="28310.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_7&#45;&gt;expert_0_7_0 -->
<g id="edge701" class="edge">
<title>gate_0_7&#45;&gt;expert_0_7_0</title>
<path fill="none" stroke="black" d="M6567.93,-16126.17C6567.93,-16126.17 6567.93,-16004.01 6567.93,-16004.01"/>
<polygon fill="black" stroke="black" points="6571.43,-16004.01 6567.93,-15994.01 6564.43,-16004.01 6571.43,-16004.01"/>
</g>
<!-- gate_0_7&#45;&gt;expert_0_8_0 -->
<g id="edge2444" class="edge">
<title>gate_0_7&#45;&gt;expert_0_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6682.65,-16151C6822.77,-16151 7061.12,-16151 7061.12,-16151 7061.12,-16151 7061.12,-16004.18 7061.12,-16004.18"/>
<polygon fill="blue" stroke="blue" points="7064.63,-16004.18 7061.12,-15994.18 7057.63,-16004.18 7064.63,-16004.18"/>
<text text-anchor="middle" x="28484.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="28484.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU7→GPU8</text>
<text text-anchor="middle" x="28484.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="28484.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_7&#45;&gt;expert_0_9_0 -->
<g id="edge2445" class="edge">
<title>gate_0_7&#45;&gt;expert_0_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6628.21,-16129.62C6628.21,-16118.06 6628.21,-16108 6628.21,-16108 6628.21,-16108 7644.75,-16108 7644.75,-16108 7644.75,-16108 7644.75,-16004.26 7644.75,-16004.26"/>
<polygon fill="blue" stroke="blue" points="7648.25,-16004.26 7644.75,-15994.26 7641.25,-16004.26 7648.25,-16004.26"/>
<text text-anchor="middle" x="28658.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="28658.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU7→GPU9</text>
<text text-anchor="middle" x="28658.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="28658.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_7&#45;&gt;expert_0_10_0 -->
<g id="edge2446" class="edge">
<title>gate_0_7&#45;&gt;expert_0_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6638.26,-16131.29C6638.26,-16108.51 6638.26,-16082 6638.26,-16082 6638.26,-16082 8227.7,-16082 8227.7,-16082 8227.7,-16082 8227.7,-16004.06 8227.7,-16004.06"/>
<polygon fill="blue" stroke="blue" points="8231.2,-16004.06 8227.7,-15994.06 8224.2,-16004.06 8231.2,-16004.06"/>
<text text-anchor="middle" x="28832.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="28832.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU7→GPU10</text>
<text text-anchor="middle" x="28832.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="28832.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_7&#45;&gt;expert_0_11_0 -->
<g id="edge2447" class="edge">
<title>gate_0_7&#45;&gt;expert_0_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6648.31,-16133.7C6648.31,-16107.66 6648.31,-16074 6648.31,-16074 6648.31,-16074 8946.07,-16074 8946.07,-16074 8946.07,-16074 8946.07,-16004.1 8946.07,-16004.1"/>
<polygon fill="blue" stroke="blue" points="8949.57,-16004.1 8946.07,-15994.1 8942.57,-16004.1 8949.57,-16004.1"/>
<text text-anchor="middle" x="29006.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29006.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU7→GPU11</text>
<text text-anchor="middle" x="29006.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29006.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_7&#45;&gt;expert_0_12_0 -->
<g id="edge2448" class="edge">
<title>gate_0_7&#45;&gt;expert_0_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6658.36,-16136.96C6658.36,-16109.31 6658.36,-16070 6658.36,-16070 6658.36,-16070 9540.93,-16070 9540.93,-16070 9540.93,-16070 9540.93,-16004.16 9540.93,-16004.16"/>
<polygon fill="blue" stroke="blue" points="9544.43,-16004.16 9540.93,-15994.16 9537.43,-16004.16 9544.43,-16004.16"/>
<text text-anchor="middle" x="29180.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29180.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU7→GPU12</text>
<text text-anchor="middle" x="29180.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29180.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_7&#45;&gt;expert_0_13_0 -->
<g id="edge2449" class="edge">
<title>gate_0_7&#45;&gt;expert_0_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6668.4,-16141.32C6668.4,-16103.6 6668.4,-16031 6668.4,-16031 6668.4,-16031 10134.54,-16031 10134.54,-16031 10134.54,-16031 10134.54,-16004.06 10134.54,-16004.06"/>
<polygon fill="blue" stroke="blue" points="10138.04,-16004.06 10134.54,-15994.06 10131.04,-16004.06 10138.04,-16004.06"/>
<text text-anchor="middle" x="29354.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29354.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU7→GPU13</text>
<text text-anchor="middle" x="29354.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29354.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_7&#45;&gt;expert_0_14_0 -->
<g id="edge2450" class="edge">
<title>gate_0_7&#45;&gt;expert_0_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6678.45,-16147.46C6678.45,-16111.19 6678.45,-16026 6678.45,-16026 6678.45,-16026 10697.02,-16026 10697.02,-16026 10697.02,-16026 10697.02,-16004.01 10697.02,-16004.01"/>
<polygon fill="blue" stroke="blue" points="10700.52,-16004.01 10697.02,-15994.01 10693.52,-16004.01 10700.52,-16004.01"/>
<text text-anchor="middle" x="29528.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29528.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU7→GPU14</text>
<text text-anchor="middle" x="29528.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29528.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_7&#45;&gt;expert_0_15_0 -->
<g id="edge2451" class="edge">
<title>gate_0_7&#45;&gt;expert_0_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6635.75,-16196.12C6635.75,-16200.21 6635.75,-16203 6635.75,-16203 6635.75,-16203 11168.44,-16203 11168.44,-16203 11168.44,-16203 11168.44,-16004.06 11168.44,-16004.06"/>
<polygon fill="blue" stroke="blue" points="11171.94,-16004.06 11168.44,-15994.06 11164.94,-16004.06 11171.94,-16004.06"/>
<text text-anchor="middle" x="29702.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29702.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU7→GPU15</text>
<text text-anchor="middle" x="29702.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29702.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_7 -->
<g id="node710" class="node">
<title>expert_reduce_0_7</title>
<ellipse fill="none" stroke="black" cx="6583" cy="-15830.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="6583" y="-15841.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="6583" y="-15826.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="6583" y="-15811.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_7_0&#45;&gt;expert_reduce_0_7 -->
<g id="edge702" class="edge">
<title>expert_0_7_0&#45;&gt;expert_reduce_0_7</title>
<path fill="none" stroke="black" d="M6583,-15940.76C6583,-15940.76 6583,-15878.06 6583,-15878.06"/>
<polygon fill="black" stroke="black" points="6586.5,-15878.06 6583,-15868.06 6579.5,-15878.06 6586.5,-15878.06"/>
</g>
<!-- moe_residual_0_7 -->
<g id="node711" class="node">
<title>moe_residual_0_7</title>
<ellipse fill="none" stroke="black" cx="6583" cy="-15693" rx="105.5" ry="27"/>
<text text-anchor="middle" x="6583" y="-15696.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="6583" y="-15681.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_7&#45;&gt;moe_residual_0_7 -->
<g id="edge703" class="edge">
<title>expert_reduce_0_7&#45;&gt;moe_residual_0_7</title>
<path fill="none" stroke="black" d="M6583,-15792.93C6583,-15792.93 6583,-15730.06 6583,-15730.06"/>
<polygon fill="black" stroke="black" points="6586.5,-15730.06 6583,-15720.06 6579.5,-15730.06 6586.5,-15730.06"/>
</g>
<!-- qkv_proj_1_7 -->
<g id="node712" class="node">
<title>qkv_proj_1_7</title>
<polygon fill="none" stroke="black" points="6665.5,-15593 6500.5,-15593 6500.5,-15540 6665.5,-15540 6665.5,-15593"/>
<text text-anchor="middle" x="6583" y="-15577.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="6583" y="-15562.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="6583" y="-15547.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_0_7&#45;&gt;qkv_proj_1_7 -->
<g id="edge704" class="edge">
<title>moe_residual_0_7&#45;&gt;qkv_proj_1_7</title>
<path fill="none" stroke="black" d="M6583,-15665.86C6583,-15665.86 6583,-15603.16 6583,-15603.16"/>
<polygon fill="black" stroke="black" points="6586.5,-15603.16 6583,-15593.16 6579.5,-15603.16 6586.5,-15603.16"/>
</g>
<!-- qkv_reshape_1_7 -->
<g id="node713" class="node">
<title>qkv_reshape_1_7</title>
<ellipse fill="none" stroke="black" cx="6583" cy="-15440" rx="148" ry="27"/>
<text text-anchor="middle" x="6583" y="-15443.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="6583" y="-15428.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_1_7&#45;&gt;qkv_reshape_1_7 -->
<g id="edge705" class="edge">
<title>qkv_proj_1_7&#45;&gt;qkv_reshape_1_7</title>
<path fill="none" stroke="black" d="M6583,-15539.98C6583,-15539.98 6583,-15477.36 6583,-15477.36"/>
<polygon fill="black" stroke="black" points="6586.5,-15477.36 6583,-15467.36 6579.5,-15477.36 6586.5,-15477.36"/>
</g>
<!-- qkv_reshape_1_7&#45;&gt;ring_attn_1_7_stage_0 -->
<g id="edge706" class="edge">
<title>qkv_reshape_1_7&#45;&gt;ring_attn_1_7_stage_0</title>
<path fill="none" stroke="black" d="M6583,-15412.72C6583,-15412.72 6583,-15306.16 6583,-15306.16"/>
<polygon fill="black" stroke="black" points="6586.5,-15306.16 6583,-15296.16 6579.5,-15306.16 6586.5,-15306.16"/>
</g>
<!-- ring_attn_1_7_stage_0&#45;&gt;ring_attn_1_7_stage_1 -->
<g id="edge707" class="edge">
<title>ring_attn_1_7_stage_0&#45;&gt;ring_attn_1_7_stage_1</title>
<path fill="none" stroke="black" d="M6583,-15159.87C6583,-15159.87 6583,-15053.25 6583,-15053.25"/>
<polygon fill="black" stroke="black" points="6586.5,-15053.25 6583,-15043.25 6579.5,-15053.25 6586.5,-15053.25"/>
</g>
<!-- ring_attn_1_8_stage_0 -->
<g id="node812" class="node">
<title>ring_attn_1_8_stage_0</title>
<polygon fill="yellow" stroke="black" points="7170,-15296 6961,-15228 7170,-15160 7379,-15228 7170,-15296"/>
<text text-anchor="middle" x="7170" y="-15246.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-15231.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="7170" y="-15216.8" font-family="Times,serif" font-size="14.00">Q[8]×K[8]×V[8]</text>
<text text-anchor="middle" x="7170" y="-15201.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_7_stage_0&#45;&gt;ring_attn_1_8_stage_0 -->
<g id="edge2452" class="edge">
<title>ring_attn_1_7_stage_0&#45;&gt;ring_attn_1_8_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-15228C6792.02,-15228 6950.86,-15228 6950.86,-15228"/>
<polygon fill="red" stroke="red" points="6950.86,-15231.5 6960.86,-15228 6950.86,-15224.5 6950.86,-15231.5"/>
</g>
<!-- ring_attn_1_7_stage_1&#45;&gt;ring_attn_1_7_stage_2 -->
<g id="edge708" class="edge">
<title>ring_attn_1_7_stage_1&#45;&gt;ring_attn_1_7_stage_2</title>
<path fill="none" stroke="black" d="M6583,-14906.87C6583,-14906.87 6583,-14800.25 6583,-14800.25"/>
<polygon fill="black" stroke="black" points="6586.5,-14800.25 6583,-14790.25 6579.5,-14800.25 6586.5,-14800.25"/>
</g>
<!-- ring_attn_1_8_stage_1 -->
<g id="node813" class="node">
<title>ring_attn_1_8_stage_1</title>
<polygon fill="yellow" stroke="black" points="7170,-15043 6961,-14975 7170,-14907 7379,-14975 7170,-15043"/>
<text text-anchor="middle" x="7170" y="-14993.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-14978.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="7170" y="-14963.8" font-family="Times,serif" font-size="14.00">Q[8]×K[7]×V[7]</text>
<text text-anchor="middle" x="7170" y="-14948.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_7_stage_1&#45;&gt;ring_attn_1_8_stage_1 -->
<g id="edge2453" class="edge">
<title>ring_attn_1_7_stage_1&#45;&gt;ring_attn_1_8_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-14975C6792.02,-14975 6950.86,-14975 6950.86,-14975"/>
<polygon fill="red" stroke="red" points="6950.86,-14978.5 6960.86,-14975 6950.86,-14971.5 6950.86,-14978.5"/>
</g>
<!-- ring_attn_1_7_stage_2&#45;&gt;ring_attn_1_7_stage_3 -->
<g id="edge709" class="edge">
<title>ring_attn_1_7_stage_2&#45;&gt;ring_attn_1_7_stage_3</title>
<path fill="none" stroke="black" d="M6583,-14653.87C6583,-14653.87 6583,-14547.25 6583,-14547.25"/>
<polygon fill="black" stroke="black" points="6586.5,-14547.25 6583,-14537.25 6579.5,-14547.25 6586.5,-14547.25"/>
</g>
<!-- ring_attn_1_8_stage_2 -->
<g id="node814" class="node">
<title>ring_attn_1_8_stage_2</title>
<polygon fill="yellow" stroke="black" points="7170,-14790 6961,-14722 7170,-14654 7379,-14722 7170,-14790"/>
<text text-anchor="middle" x="7170" y="-14740.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-14725.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="7170" y="-14710.8" font-family="Times,serif" font-size="14.00">Q[8]×K[6]×V[6]</text>
<text text-anchor="middle" x="7170" y="-14695.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_7_stage_2&#45;&gt;ring_attn_1_8_stage_2 -->
<g id="edge2454" class="edge">
<title>ring_attn_1_7_stage_2&#45;&gt;ring_attn_1_8_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-14722C6792.02,-14722 6950.86,-14722 6950.86,-14722"/>
<polygon fill="red" stroke="red" points="6950.86,-14725.5 6960.86,-14722 6950.86,-14718.5 6950.86,-14725.5"/>
</g>
<!-- ring_attn_1_7_stage_3&#45;&gt;ring_attn_1_7_stage_4 -->
<g id="edge710" class="edge">
<title>ring_attn_1_7_stage_3&#45;&gt;ring_attn_1_7_stage_4</title>
<path fill="none" stroke="black" d="M6583,-14400.87C6583,-14400.87 6583,-14294.25 6583,-14294.25"/>
<polygon fill="black" stroke="black" points="6586.5,-14294.25 6583,-14284.25 6579.5,-14294.25 6586.5,-14294.25"/>
</g>
<!-- ring_attn_1_8_stage_3 -->
<g id="node815" class="node">
<title>ring_attn_1_8_stage_3</title>
<polygon fill="yellow" stroke="black" points="7170,-14537 6961,-14469 7170,-14401 7379,-14469 7170,-14537"/>
<text text-anchor="middle" x="7170" y="-14487.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-14472.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="7170" y="-14457.8" font-family="Times,serif" font-size="14.00">Q[8]×K[5]×V[5]</text>
<text text-anchor="middle" x="7170" y="-14442.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_7_stage_3&#45;&gt;ring_attn_1_8_stage_3 -->
<g id="edge2455" class="edge">
<title>ring_attn_1_7_stage_3&#45;&gt;ring_attn_1_8_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-14469C6792.02,-14469 6950.86,-14469 6950.86,-14469"/>
<polygon fill="red" stroke="red" points="6950.86,-14472.5 6960.86,-14469 6950.86,-14465.5 6950.86,-14472.5"/>
</g>
<!-- ring_attn_1_7_stage_4&#45;&gt;ring_attn_1_7_stage_5 -->
<g id="edge711" class="edge">
<title>ring_attn_1_7_stage_4&#45;&gt;ring_attn_1_7_stage_5</title>
<path fill="none" stroke="black" d="M6583,-14147.87C6583,-14147.87 6583,-14041.25 6583,-14041.25"/>
<polygon fill="black" stroke="black" points="6586.5,-14041.25 6583,-14031.25 6579.5,-14041.25 6586.5,-14041.25"/>
</g>
<!-- ring_attn_1_8_stage_4 -->
<g id="node816" class="node">
<title>ring_attn_1_8_stage_4</title>
<polygon fill="yellow" stroke="black" points="7170,-14284 6961,-14216 7170,-14148 7379,-14216 7170,-14284"/>
<text text-anchor="middle" x="7170" y="-14234.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-14219.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="7170" y="-14204.8" font-family="Times,serif" font-size="14.00">Q[8]×K[4]×V[4]</text>
<text text-anchor="middle" x="7170" y="-14189.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_7_stage_4&#45;&gt;ring_attn_1_8_stage_4 -->
<g id="edge2456" class="edge">
<title>ring_attn_1_7_stage_4&#45;&gt;ring_attn_1_8_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-14216C6792.02,-14216 6950.86,-14216 6950.86,-14216"/>
<polygon fill="red" stroke="red" points="6950.86,-14219.5 6960.86,-14216 6950.86,-14212.5 6950.86,-14219.5"/>
</g>
<!-- ring_attn_1_7_stage_5&#45;&gt;ring_attn_1_7_stage_6 -->
<g id="edge712" class="edge">
<title>ring_attn_1_7_stage_5&#45;&gt;ring_attn_1_7_stage_6</title>
<path fill="none" stroke="black" d="M6583,-13894.87C6583,-13894.87 6583,-13788.25 6583,-13788.25"/>
<polygon fill="black" stroke="black" points="6586.5,-13788.25 6583,-13778.25 6579.5,-13788.25 6586.5,-13788.25"/>
</g>
<!-- ring_attn_1_8_stage_5 -->
<g id="node817" class="node">
<title>ring_attn_1_8_stage_5</title>
<polygon fill="yellow" stroke="black" points="7170,-14031 6961,-13963 7170,-13895 7379,-13963 7170,-14031"/>
<text text-anchor="middle" x="7170" y="-13981.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-13966.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="7170" y="-13951.8" font-family="Times,serif" font-size="14.00">Q[8]×K[3]×V[3]</text>
<text text-anchor="middle" x="7170" y="-13936.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_7_stage_5&#45;&gt;ring_attn_1_8_stage_5 -->
<g id="edge2457" class="edge">
<title>ring_attn_1_7_stage_5&#45;&gt;ring_attn_1_8_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-13963C6792.02,-13963 6950.86,-13963 6950.86,-13963"/>
<polygon fill="red" stroke="red" points="6950.86,-13966.5 6960.86,-13963 6950.86,-13959.5 6950.86,-13966.5"/>
</g>
<!-- ring_attn_1_7_stage_6&#45;&gt;ring_attn_1_7_stage_7 -->
<g id="edge713" class="edge">
<title>ring_attn_1_7_stage_6&#45;&gt;ring_attn_1_7_stage_7</title>
<path fill="none" stroke="black" d="M6583,-13641.87C6583,-13641.87 6583,-13535.25 6583,-13535.25"/>
<polygon fill="black" stroke="black" points="6586.5,-13535.25 6583,-13525.25 6579.5,-13535.25 6586.5,-13535.25"/>
</g>
<!-- ring_attn_1_8_stage_6 -->
<g id="node818" class="node">
<title>ring_attn_1_8_stage_6</title>
<polygon fill="yellow" stroke="black" points="7170,-13778 6961,-13710 7170,-13642 7379,-13710 7170,-13778"/>
<text text-anchor="middle" x="7170" y="-13728.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-13713.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="7170" y="-13698.8" font-family="Times,serif" font-size="14.00">Q[8]×K[2]×V[2]</text>
<text text-anchor="middle" x="7170" y="-13683.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_7_stage_6&#45;&gt;ring_attn_1_8_stage_6 -->
<g id="edge2458" class="edge">
<title>ring_attn_1_7_stage_6&#45;&gt;ring_attn_1_8_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-13710C6792.02,-13710 6950.86,-13710 6950.86,-13710"/>
<polygon fill="red" stroke="red" points="6950.86,-13713.5 6960.86,-13710 6950.86,-13706.5 6950.86,-13713.5"/>
</g>
<!-- ring_attn_1_7_stage_7&#45;&gt;ring_attn_1_7_stage_8 -->
<g id="edge714" class="edge">
<title>ring_attn_1_7_stage_7&#45;&gt;ring_attn_1_7_stage_8</title>
<path fill="none" stroke="black" d="M6583,-13388.87C6583,-13388.87 6583,-13282.25 6583,-13282.25"/>
<polygon fill="black" stroke="black" points="6586.5,-13282.25 6583,-13272.25 6579.5,-13282.25 6586.5,-13282.25"/>
</g>
<!-- ring_attn_1_8_stage_7 -->
<g id="node819" class="node">
<title>ring_attn_1_8_stage_7</title>
<polygon fill="yellow" stroke="black" points="7170,-13525 6961,-13457 7170,-13389 7379,-13457 7170,-13525"/>
<text text-anchor="middle" x="7170" y="-13475.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-13460.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="7170" y="-13445.8" font-family="Times,serif" font-size="14.00">Q[8]×K[1]×V[1]</text>
<text text-anchor="middle" x="7170" y="-13430.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_7_stage_7&#45;&gt;ring_attn_1_8_stage_7 -->
<g id="edge2459" class="edge">
<title>ring_attn_1_7_stage_7&#45;&gt;ring_attn_1_8_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-13457C6792.02,-13457 6950.86,-13457 6950.86,-13457"/>
<polygon fill="red" stroke="red" points="6950.86,-13460.5 6960.86,-13457 6950.86,-13453.5 6950.86,-13460.5"/>
</g>
<!-- ring_attn_1_7_stage_8&#45;&gt;ring_attn_1_7_stage_9 -->
<g id="edge715" class="edge">
<title>ring_attn_1_7_stage_8&#45;&gt;ring_attn_1_7_stage_9</title>
<path fill="none" stroke="black" d="M6583,-13135.87C6583,-13135.87 6583,-13029.25 6583,-13029.25"/>
<polygon fill="black" stroke="black" points="6586.5,-13029.25 6583,-13019.25 6579.5,-13029.25 6586.5,-13029.25"/>
</g>
<!-- ring_attn_1_8_stage_8 -->
<g id="node820" class="node">
<title>ring_attn_1_8_stage_8</title>
<polygon fill="yellow" stroke="black" points="7170,-13272 6961,-13204 7170,-13136 7379,-13204 7170,-13272"/>
<text text-anchor="middle" x="7170" y="-13222.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-13207.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="7170" y="-13192.8" font-family="Times,serif" font-size="14.00">Q[8]×K[0]×V[0]</text>
<text text-anchor="middle" x="7170" y="-13177.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_7_stage_8&#45;&gt;ring_attn_1_8_stage_8 -->
<g id="edge2460" class="edge">
<title>ring_attn_1_7_stage_8&#45;&gt;ring_attn_1_8_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-13204C6792.02,-13204 6950.86,-13204 6950.86,-13204"/>
<polygon fill="red" stroke="red" points="6950.86,-13207.5 6960.86,-13204 6950.86,-13200.5 6950.86,-13207.5"/>
</g>
<!-- ring_attn_1_7_stage_9&#45;&gt;ring_attn_1_7_stage_10 -->
<g id="edge716" class="edge">
<title>ring_attn_1_7_stage_9&#45;&gt;ring_attn_1_7_stage_10</title>
<path fill="none" stroke="black" d="M6583,-12882.87C6583,-12882.87 6583,-12776.25 6583,-12776.25"/>
<polygon fill="black" stroke="black" points="6586.5,-12776.25 6583,-12766.25 6579.5,-12776.25 6586.5,-12776.25"/>
</g>
<!-- ring_attn_1_8_stage_9 -->
<g id="node821" class="node">
<title>ring_attn_1_8_stage_9</title>
<polygon fill="yellow" stroke="black" points="7170,-13019 6961,-12951 7170,-12883 7379,-12951 7170,-13019"/>
<text text-anchor="middle" x="7170" y="-12969.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-12954.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="7170" y="-12939.8" font-family="Times,serif" font-size="14.00">Q[8]×K[15]×V[15]</text>
<text text-anchor="middle" x="7170" y="-12924.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_7_stage_9&#45;&gt;ring_attn_1_8_stage_9 -->
<g id="edge2461" class="edge">
<title>ring_attn_1_7_stage_9&#45;&gt;ring_attn_1_8_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-12951C6792.02,-12951 6950.86,-12951 6950.86,-12951"/>
<polygon fill="red" stroke="red" points="6950.86,-12954.5 6960.86,-12951 6950.86,-12947.5 6950.86,-12954.5"/>
</g>
<!-- ring_attn_1_7_stage_10&#45;&gt;ring_attn_1_7_stage_11 -->
<g id="edge717" class="edge">
<title>ring_attn_1_7_stage_10&#45;&gt;ring_attn_1_7_stage_11</title>
<path fill="none" stroke="black" d="M6583,-12629.87C6583,-12629.87 6583,-12523.25 6583,-12523.25"/>
<polygon fill="black" stroke="black" points="6586.5,-12523.25 6583,-12513.25 6579.5,-12523.25 6586.5,-12523.25"/>
</g>
<!-- ring_attn_1_8_stage_10 -->
<g id="node822" class="node">
<title>ring_attn_1_8_stage_10</title>
<polygon fill="yellow" stroke="black" points="7170,-12766 6961,-12698 7170,-12630 7379,-12698 7170,-12766"/>
<text text-anchor="middle" x="7170" y="-12716.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-12701.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="7170" y="-12686.8" font-family="Times,serif" font-size="14.00">Q[8]×K[14]×V[14]</text>
<text text-anchor="middle" x="7170" y="-12671.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_7_stage_10&#45;&gt;ring_attn_1_8_stage_10 -->
<g id="edge2462" class="edge">
<title>ring_attn_1_7_stage_10&#45;&gt;ring_attn_1_8_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-12698C6792.02,-12698 6950.86,-12698 6950.86,-12698"/>
<polygon fill="red" stroke="red" points="6950.86,-12701.5 6960.86,-12698 6950.86,-12694.5 6950.86,-12701.5"/>
</g>
<!-- ring_attn_1_7_stage_11&#45;&gt;ring_attn_1_7_stage_12 -->
<g id="edge718" class="edge">
<title>ring_attn_1_7_stage_11&#45;&gt;ring_attn_1_7_stage_12</title>
<path fill="none" stroke="black" d="M6583,-12376.87C6583,-12376.87 6583,-12270.25 6583,-12270.25"/>
<polygon fill="black" stroke="black" points="6586.5,-12270.25 6583,-12260.25 6579.5,-12270.25 6586.5,-12270.25"/>
</g>
<!-- ring_attn_1_8_stage_11 -->
<g id="node823" class="node">
<title>ring_attn_1_8_stage_11</title>
<polygon fill="yellow" stroke="black" points="7170,-12513 6961,-12445 7170,-12377 7379,-12445 7170,-12513"/>
<text text-anchor="middle" x="7170" y="-12463.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-12448.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="7170" y="-12433.8" font-family="Times,serif" font-size="14.00">Q[8]×K[13]×V[13]</text>
<text text-anchor="middle" x="7170" y="-12418.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_7_stage_11&#45;&gt;ring_attn_1_8_stage_11 -->
<g id="edge2463" class="edge">
<title>ring_attn_1_7_stage_11&#45;&gt;ring_attn_1_8_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-12445C6792.02,-12445 6950.86,-12445 6950.86,-12445"/>
<polygon fill="red" stroke="red" points="6950.86,-12448.5 6960.86,-12445 6950.86,-12441.5 6950.86,-12448.5"/>
</g>
<!-- ring_attn_1_7_stage_12&#45;&gt;ring_attn_1_7_stage_13 -->
<g id="edge719" class="edge">
<title>ring_attn_1_7_stage_12&#45;&gt;ring_attn_1_7_stage_13</title>
<path fill="none" stroke="black" d="M6583,-12123.87C6583,-12123.87 6583,-12017.25 6583,-12017.25"/>
<polygon fill="black" stroke="black" points="6586.5,-12017.25 6583,-12007.25 6579.5,-12017.25 6586.5,-12017.25"/>
</g>
<!-- ring_attn_1_8_stage_12 -->
<g id="node824" class="node">
<title>ring_attn_1_8_stage_12</title>
<polygon fill="yellow" stroke="black" points="7170,-12260 6961,-12192 7170,-12124 7379,-12192 7170,-12260"/>
<text text-anchor="middle" x="7170" y="-12210.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-12195.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="7170" y="-12180.8" font-family="Times,serif" font-size="14.00">Q[8]×K[12]×V[12]</text>
<text text-anchor="middle" x="7170" y="-12165.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_7_stage_12&#45;&gt;ring_attn_1_8_stage_12 -->
<g id="edge2464" class="edge">
<title>ring_attn_1_7_stage_12&#45;&gt;ring_attn_1_8_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-12192C6792.02,-12192 6950.86,-12192 6950.86,-12192"/>
<polygon fill="red" stroke="red" points="6950.86,-12195.5 6960.86,-12192 6950.86,-12188.5 6950.86,-12195.5"/>
</g>
<!-- ring_attn_1_7_stage_13&#45;&gt;ring_attn_1_7_stage_14 -->
<g id="edge720" class="edge">
<title>ring_attn_1_7_stage_13&#45;&gt;ring_attn_1_7_stage_14</title>
<path fill="none" stroke="black" d="M6583,-11870.87C6583,-11870.87 6583,-11764.25 6583,-11764.25"/>
<polygon fill="black" stroke="black" points="6586.5,-11764.25 6583,-11754.25 6579.5,-11764.25 6586.5,-11764.25"/>
</g>
<!-- ring_attn_1_8_stage_13 -->
<g id="node825" class="node">
<title>ring_attn_1_8_stage_13</title>
<polygon fill="yellow" stroke="black" points="7170,-12007 6961,-11939 7170,-11871 7379,-11939 7170,-12007"/>
<text text-anchor="middle" x="7170" y="-11957.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-11942.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="7170" y="-11927.8" font-family="Times,serif" font-size="14.00">Q[8]×K[11]×V[11]</text>
<text text-anchor="middle" x="7170" y="-11912.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_7_stage_13&#45;&gt;ring_attn_1_8_stage_13 -->
<g id="edge2465" class="edge">
<title>ring_attn_1_7_stage_13&#45;&gt;ring_attn_1_8_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-11939C6792.02,-11939 6950.86,-11939 6950.86,-11939"/>
<polygon fill="red" stroke="red" points="6950.86,-11942.5 6960.86,-11939 6950.86,-11935.5 6950.86,-11942.5"/>
</g>
<!-- ring_attn_1_7_stage_14&#45;&gt;ring_attn_1_7_stage_15 -->
<g id="edge721" class="edge">
<title>ring_attn_1_7_stage_14&#45;&gt;ring_attn_1_7_stage_15</title>
<path fill="none" stroke="black" d="M6583,-11617.87C6583,-11617.87 6583,-11511.25 6583,-11511.25"/>
<polygon fill="black" stroke="black" points="6586.5,-11511.25 6583,-11501.25 6579.5,-11511.25 6586.5,-11511.25"/>
</g>
<!-- ring_attn_1_8_stage_14 -->
<g id="node826" class="node">
<title>ring_attn_1_8_stage_14</title>
<polygon fill="yellow" stroke="black" points="7170,-11754 6961,-11686 7170,-11618 7379,-11686 7170,-11754"/>
<text text-anchor="middle" x="7170" y="-11704.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-11689.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="7170" y="-11674.8" font-family="Times,serif" font-size="14.00">Q[8]×K[10]×V[10]</text>
<text text-anchor="middle" x="7170" y="-11659.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_7_stage_14&#45;&gt;ring_attn_1_8_stage_14 -->
<g id="edge2466" class="edge">
<title>ring_attn_1_7_stage_14&#45;&gt;ring_attn_1_8_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-11686C6792.02,-11686 6950.86,-11686 6950.86,-11686"/>
<polygon fill="red" stroke="red" points="6950.86,-11689.5 6960.86,-11686 6950.86,-11682.5 6950.86,-11689.5"/>
</g>
<!-- attn_out_1_7 -->
<g id="node730" class="node">
<title>attn_out_1_7</title>
<polygon fill="none" stroke="black" points="6652.5,-11292 6513.5,-11292 6513.5,-11239 6652.5,-11239 6652.5,-11292"/>
<text text-anchor="middle" x="6583" y="-11276.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="6583" y="-11261.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="6583" y="-11246.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_1_7_stage_15&#45;&gt;attn_out_1_7 -->
<g id="edge722" class="edge">
<title>ring_attn_1_7_stage_15&#45;&gt;attn_out_1_7</title>
<path fill="none" stroke="black" d="M6583,-11364.87C6583,-11364.87 6583,-11302.18 6583,-11302.18"/>
<polygon fill="black" stroke="black" points="6586.5,-11302.18 6583,-11292.18 6579.5,-11302.18 6586.5,-11302.18"/>
</g>
<!-- ring_attn_1_8_stage_15 -->
<g id="node827" class="node">
<title>ring_attn_1_8_stage_15</title>
<polygon fill="yellow" stroke="black" points="7170,-11501 6961,-11433 7170,-11365 7379,-11433 7170,-11501"/>
<text text-anchor="middle" x="7170" y="-11451.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-11436.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="7170" y="-11421.8" font-family="Times,serif" font-size="14.00">Q[8]×K[9]×V[9]</text>
<text text-anchor="middle" x="7170" y="-11406.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_7_stage_15&#45;&gt;ring_attn_1_8_stage_15 -->
<g id="edge2467" class="edge">
<title>ring_attn_1_7_stage_15&#45;&gt;ring_attn_1_8_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-11433C6792.02,-11433 6950.86,-11433 6950.86,-11433"/>
<polygon fill="red" stroke="red" points="6950.86,-11436.5 6960.86,-11433 6950.86,-11429.5 6950.86,-11436.5"/>
</g>
<!-- attn_residual_1_7 -->
<g id="node731" class="node">
<title>attn_residual_1_7</title>
<ellipse fill="none" stroke="black" cx="6583" cy="-11139" rx="105.5" ry="27"/>
<text text-anchor="middle" x="6583" y="-11142.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="6583" y="-11127.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_1_7&#45;&gt;attn_residual_1_7 -->
<g id="edge723" class="edge">
<title>attn_out_1_7&#45;&gt;attn_residual_1_7</title>
<path fill="none" stroke="black" d="M6583,-11238.98C6583,-11238.98 6583,-11176.36 6583,-11176.36"/>
<polygon fill="black" stroke="black" points="6586.5,-11176.36 6583,-11166.36 6579.5,-11176.36 6586.5,-11176.36"/>
</g>
<!-- gate_1_7 -->
<g id="node732" class="node">
<title>gate_1_7</title>
<ellipse fill="orange" stroke="black" cx="6583" cy="-11001.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="6583" y="-11012.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="6583" y="-10997.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="6583" y="-10982.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_1_7&#45;&gt;gate_1_7 -->
<g id="edge724" class="edge">
<title>attn_residual_1_7&#45;&gt;gate_1_7</title>
<path fill="none" stroke="black" d="M6583,-11111.83C6583,-11111.83 6583,-11049.02 6583,-11049.02"/>
<polygon fill="black" stroke="black" points="6586.5,-11049.02 6583,-11039.02 6579.5,-11049.02 6586.5,-11049.02"/>
</g>
<!-- gate_1_7&#45;&gt;expert_1_0_0 -->
<g id="edge2468" class="edge">
<title>gate_1_7&#45;&gt;expert_1_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6530.25,-11034.29C6530.25,-11056.19 6530.25,-11081 6530.25,-11081 6530.25,-11081 334.36,-11081 334.36,-11081 334.36,-11081 334.36,-10842.17 334.36,-10842.17"/>
<polygon fill="blue" stroke="blue" points="337.86,-10842.17 334.36,-10832.17 330.86,-10842.17 337.86,-10842.17"/>
<text text-anchor="middle" x="27266.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27266.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU7→GPU0</text>
<text text-anchor="middle" x="27266.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27266.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_7&#45;&gt;expert_1_1_0 -->
<g id="edge2469" class="edge">
<title>gate_1_7&#45;&gt;expert_1_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6487.55,-10985.49C6487.55,-10963.33 6487.55,-10926 6487.55,-10926 6487.55,-10926 2993.86,-10926 2993.86,-10926 2993.86,-10926 2993.86,-10842.24 2993.86,-10842.24"/>
<polygon fill="blue" stroke="blue" points="2997.36,-10842.24 2993.86,-10832.24 2990.36,-10842.24 2997.36,-10842.24"/>
<text text-anchor="middle" x="27440.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27440.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU7→GPU1</text>
<text text-anchor="middle" x="27440.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27440.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_7&#45;&gt;expert_1_2_0 -->
<g id="edge2470" class="edge">
<title>gate_1_7&#45;&gt;expert_1_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6507.64,-10975.03C6507.64,-10942.34 6507.64,-10891 6507.64,-10891 6507.64,-10891 3589.39,-10891 3589.39,-10891 3589.39,-10891 3589.39,-10842.08 3589.39,-10842.08"/>
<polygon fill="blue" stroke="blue" points="3592.89,-10842.08 3589.39,-10832.08 3585.89,-10842.08 3592.89,-10842.08"/>
<text text-anchor="middle" x="27614.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27614.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU7→GPU2</text>
<text text-anchor="middle" x="27614.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27614.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_7&#45;&gt;expert_1_3_0 -->
<g id="edge2471" class="edge">
<title>gate_1_7&#45;&gt;expert_1_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6527.74,-10969.48C6527.74,-10948.9 6527.74,-10926 6527.74,-10926 6527.74,-10926 4180.14,-10926 4180.14,-10926 4180.14,-10926 4180.14,-10842.24 4180.14,-10842.24"/>
<polygon fill="blue" stroke="blue" points="4183.64,-10842.24 4180.14,-10832.24 4176.64,-10842.24 4183.64,-10842.24"/>
<text text-anchor="middle" x="27788.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27788.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU7→GPU3</text>
<text text-anchor="middle" x="27788.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27788.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_7&#45;&gt;expert_1_4_0 -->
<g id="edge2472" class="edge">
<title>gate_1_7&#45;&gt;expert_1_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6547.83,-10965.77C6547.83,-10949.58 6547.83,-10934 6547.83,-10934 6547.83,-10934 4776.79,-10934 4776.79,-10934 4776.79,-10934 4776.79,-10842.13 4776.79,-10842.13"/>
<polygon fill="blue" stroke="blue" points="4780.29,-10842.13 4776.79,-10832.13 4773.29,-10842.13 4780.29,-10842.13"/>
<text text-anchor="middle" x="27962.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27962.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU7→GPU4</text>
<text text-anchor="middle" x="27962.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27962.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_7&#45;&gt;expert_1_5_0 -->
<g id="edge2473" class="edge">
<title>gate_1_7&#45;&gt;expert_1_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6557.88,-10964.77C6557.88,-10959.6 6557.88,-10956 6557.88,-10956 6557.88,-10956 5524.62,-10956 5524.62,-10956 5524.62,-10956 5524.62,-10842.06 5524.62,-10842.06"/>
<polygon fill="blue" stroke="blue" points="5528.13,-10842.06 5524.62,-10832.06 5521.13,-10842.06 5528.13,-10842.06"/>
<text text-anchor="middle" x="28136.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="28136.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU7→GPU5</text>
<text text-anchor="middle" x="28136.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="28136.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_7&#45;&gt;expert_1_6_0 -->
<g id="edge2474" class="edge">
<title>gate_1_7&#45;&gt;expert_1_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6483.48,-11014C6344.26,-11014 6108.25,-11014 6108.25,-11014 6108.25,-11014 6108.25,-10842.33 6108.25,-10842.33"/>
<polygon fill="blue" stroke="blue" points="6111.75,-10842.33 6108.25,-10832.33 6104.75,-10842.33 6111.75,-10842.33"/>
<text text-anchor="middle" x="28310.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="28310.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU7→GPU6</text>
<text text-anchor="middle" x="28310.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="28310.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_7&#45;&gt;expert_1_7_0 -->
<g id="edge725" class="edge">
<title>gate_1_7&#45;&gt;expert_1_7_0</title>
<path fill="none" stroke="black" d="M6567.93,-10964.17C6567.93,-10964.17 6567.93,-10842.01 6567.93,-10842.01"/>
<polygon fill="black" stroke="black" points="6571.43,-10842.01 6567.93,-10832.01 6564.43,-10842.01 6571.43,-10842.01"/>
</g>
<!-- gate_1_7&#45;&gt;expert_1_8_0 -->
<g id="edge2475" class="edge">
<title>gate_1_7&#45;&gt;expert_1_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6682.65,-10989C6822.77,-10989 7061.12,-10989 7061.12,-10989 7061.12,-10989 7061.12,-10842.18 7061.12,-10842.18"/>
<polygon fill="blue" stroke="blue" points="7064.63,-10842.18 7061.12,-10832.18 7057.63,-10842.18 7064.63,-10842.18"/>
<text text-anchor="middle" x="28484.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="28484.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU7→GPU8</text>
<text text-anchor="middle" x="28484.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="28484.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_7&#45;&gt;expert_1_9_0 -->
<g id="edge2476" class="edge">
<title>gate_1_7&#45;&gt;expert_1_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6628.21,-10967.62C6628.21,-10956.06 6628.21,-10946 6628.21,-10946 6628.21,-10946 7644.75,-10946 7644.75,-10946 7644.75,-10946 7644.75,-10842.26 7644.75,-10842.26"/>
<polygon fill="blue" stroke="blue" points="7648.25,-10842.26 7644.75,-10832.26 7641.25,-10842.26 7648.25,-10842.26"/>
<text text-anchor="middle" x="28658.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="28658.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU7→GPU9</text>
<text text-anchor="middle" x="28658.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="28658.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_7&#45;&gt;expert_1_10_0 -->
<g id="edge2477" class="edge">
<title>gate_1_7&#45;&gt;expert_1_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6638.26,-10969.29C6638.26,-10946.51 6638.26,-10920 6638.26,-10920 6638.26,-10920 8227.7,-10920 8227.7,-10920 8227.7,-10920 8227.7,-10842.06 8227.7,-10842.06"/>
<polygon fill="blue" stroke="blue" points="8231.2,-10842.06 8227.7,-10832.06 8224.2,-10842.06 8231.2,-10842.06"/>
<text text-anchor="middle" x="28832.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="28832.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU7→GPU10</text>
<text text-anchor="middle" x="28832.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="28832.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_7&#45;&gt;expert_1_11_0 -->
<g id="edge2478" class="edge">
<title>gate_1_7&#45;&gt;expert_1_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6648.31,-10971.7C6648.31,-10945.66 6648.31,-10912 6648.31,-10912 6648.31,-10912 8946.07,-10912 8946.07,-10912 8946.07,-10912 8946.07,-10842.1 8946.07,-10842.1"/>
<polygon fill="blue" stroke="blue" points="8949.57,-10842.1 8946.07,-10832.1 8942.57,-10842.1 8949.57,-10842.1"/>
<text text-anchor="middle" x="29006.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29006.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU7→GPU11</text>
<text text-anchor="middle" x="29006.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29006.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_7&#45;&gt;expert_1_12_0 -->
<g id="edge2479" class="edge">
<title>gate_1_7&#45;&gt;expert_1_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6658.36,-10974.96C6658.36,-10947.31 6658.36,-10908 6658.36,-10908 6658.36,-10908 9540.93,-10908 9540.93,-10908 9540.93,-10908 9540.93,-10842.16 9540.93,-10842.16"/>
<polygon fill="blue" stroke="blue" points="9544.43,-10842.16 9540.93,-10832.16 9537.43,-10842.16 9544.43,-10842.16"/>
<text text-anchor="middle" x="29180.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29180.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU7→GPU12</text>
<text text-anchor="middle" x="29180.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29180.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_7&#45;&gt;expert_1_13_0 -->
<g id="edge2480" class="edge">
<title>gate_1_7&#45;&gt;expert_1_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6668.4,-10979.32C6668.4,-10941.6 6668.4,-10869 6668.4,-10869 6668.4,-10869 10134.54,-10869 10134.54,-10869 10134.54,-10869 10134.54,-10842.06 10134.54,-10842.06"/>
<polygon fill="blue" stroke="blue" points="10138.04,-10842.06 10134.54,-10832.06 10131.04,-10842.06 10138.04,-10842.06"/>
<text text-anchor="middle" x="29354.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29354.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU7→GPU13</text>
<text text-anchor="middle" x="29354.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29354.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_7&#45;&gt;expert_1_14_0 -->
<g id="edge2481" class="edge">
<title>gate_1_7&#45;&gt;expert_1_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6678.45,-10985.46C6678.45,-10949.19 6678.45,-10864 6678.45,-10864 6678.45,-10864 10697.02,-10864 10697.02,-10864 10697.02,-10864 10697.02,-10842.01 10697.02,-10842.01"/>
<polygon fill="blue" stroke="blue" points="10700.52,-10842.01 10697.02,-10832.01 10693.52,-10842.01 10700.52,-10842.01"/>
<text text-anchor="middle" x="29528.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29528.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU7→GPU14</text>
<text text-anchor="middle" x="29528.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29528.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_7&#45;&gt;expert_1_15_0 -->
<g id="edge2482" class="edge">
<title>gate_1_7&#45;&gt;expert_1_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6635.75,-11034.12C6635.75,-11038.21 6635.75,-11041 6635.75,-11041 6635.75,-11041 11168.44,-11041 11168.44,-11041 11168.44,-11041 11168.44,-10842.06 11168.44,-10842.06"/>
<polygon fill="blue" stroke="blue" points="11171.94,-10842.06 11168.44,-10832.06 11164.94,-10842.06 11171.94,-10842.06"/>
<text text-anchor="middle" x="29702.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29702.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU7→GPU15</text>
<text text-anchor="middle" x="29702.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29702.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_7 -->
<g id="node734" class="node">
<title>expert_reduce_1_7</title>
<ellipse fill="none" stroke="black" cx="6583" cy="-10668.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="6583" y="-10679.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="6583" y="-10664.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="6583" y="-10649.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_7_0&#45;&gt;expert_reduce_1_7 -->
<g id="edge726" class="edge">
<title>expert_1_7_0&#45;&gt;expert_reduce_1_7</title>
<path fill="none" stroke="black" d="M6583,-10778.76C6583,-10778.76 6583,-10716.06 6583,-10716.06"/>
<polygon fill="black" stroke="black" points="6586.5,-10716.06 6583,-10706.06 6579.5,-10716.06 6586.5,-10716.06"/>
</g>
<!-- moe_residual_1_7 -->
<g id="node735" class="node">
<title>moe_residual_1_7</title>
<ellipse fill="none" stroke="black" cx="6583" cy="-10531" rx="105.5" ry="27"/>
<text text-anchor="middle" x="6583" y="-10534.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="6583" y="-10519.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_7&#45;&gt;moe_residual_1_7 -->
<g id="edge727" class="edge">
<title>expert_reduce_1_7&#45;&gt;moe_residual_1_7</title>
<path fill="none" stroke="black" d="M6583,-10630.93C6583,-10630.93 6583,-10568.06 6583,-10568.06"/>
<polygon fill="black" stroke="black" points="6586.5,-10568.06 6583,-10558.06 6579.5,-10568.06 6586.5,-10568.06"/>
</g>
<!-- qkv_proj_2_7 -->
<g id="node736" class="node">
<title>qkv_proj_2_7</title>
<polygon fill="none" stroke="black" points="6665.5,-10431 6500.5,-10431 6500.5,-10378 6665.5,-10378 6665.5,-10431"/>
<text text-anchor="middle" x="6583" y="-10415.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="6583" y="-10400.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="6583" y="-10385.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_1_7&#45;&gt;qkv_proj_2_7 -->
<g id="edge728" class="edge">
<title>moe_residual_1_7&#45;&gt;qkv_proj_2_7</title>
<path fill="none" stroke="black" d="M6583,-10503.86C6583,-10503.86 6583,-10441.16 6583,-10441.16"/>
<polygon fill="black" stroke="black" points="6586.5,-10441.16 6583,-10431.16 6579.5,-10441.16 6586.5,-10441.16"/>
</g>
<!-- qkv_reshape_2_7 -->
<g id="node737" class="node">
<title>qkv_reshape_2_7</title>
<ellipse fill="none" stroke="black" cx="6583" cy="-10278" rx="148" ry="27"/>
<text text-anchor="middle" x="6583" y="-10281.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="6583" y="-10266.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_2_7&#45;&gt;qkv_reshape_2_7 -->
<g id="edge729" class="edge">
<title>qkv_proj_2_7&#45;&gt;qkv_reshape_2_7</title>
<path fill="none" stroke="black" d="M6583,-10377.98C6583,-10377.98 6583,-10315.36 6583,-10315.36"/>
<polygon fill="black" stroke="black" points="6586.5,-10315.36 6583,-10305.36 6579.5,-10315.36 6586.5,-10315.36"/>
</g>
<!-- qkv_reshape_2_7&#45;&gt;ring_attn_2_7_stage_0 -->
<g id="edge730" class="edge">
<title>qkv_reshape_2_7&#45;&gt;ring_attn_2_7_stage_0</title>
<path fill="none" stroke="black" d="M6583,-10250.72C6583,-10250.72 6583,-10144.16 6583,-10144.16"/>
<polygon fill="black" stroke="black" points="6586.5,-10144.16 6583,-10134.16 6579.5,-10144.16 6586.5,-10144.16"/>
</g>
<!-- ring_attn_2_7_stage_0&#45;&gt;ring_attn_2_7_stage_1 -->
<g id="edge731" class="edge">
<title>ring_attn_2_7_stage_0&#45;&gt;ring_attn_2_7_stage_1</title>
<path fill="none" stroke="black" d="M6583,-9997.87C6583,-9997.87 6583,-9891.25 6583,-9891.25"/>
<polygon fill="black" stroke="black" points="6586.5,-9891.25 6583,-9881.25 6579.5,-9891.25 6586.5,-9891.25"/>
</g>
<!-- ring_attn_2_8_stage_0 -->
<g id="node836" class="node">
<title>ring_attn_2_8_stage_0</title>
<polygon fill="yellow" stroke="black" points="7170,-10134 6961,-10066 7170,-9998 7379,-10066 7170,-10134"/>
<text text-anchor="middle" x="7170" y="-10084.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-10069.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="7170" y="-10054.8" font-family="Times,serif" font-size="14.00">Q[8]×K[8]×V[8]</text>
<text text-anchor="middle" x="7170" y="-10039.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_7_stage_0&#45;&gt;ring_attn_2_8_stage_0 -->
<g id="edge2483" class="edge">
<title>ring_attn_2_7_stage_0&#45;&gt;ring_attn_2_8_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-10066C6792.02,-10066 6950.86,-10066 6950.86,-10066"/>
<polygon fill="red" stroke="red" points="6950.86,-10069.5 6960.86,-10066 6950.86,-10062.5 6950.86,-10069.5"/>
</g>
<!-- ring_attn_2_7_stage_1&#45;&gt;ring_attn_2_7_stage_2 -->
<g id="edge732" class="edge">
<title>ring_attn_2_7_stage_1&#45;&gt;ring_attn_2_7_stage_2</title>
<path fill="none" stroke="black" d="M6583,-9744.87C6583,-9744.87 6583,-9638.25 6583,-9638.25"/>
<polygon fill="black" stroke="black" points="6586.5,-9638.25 6583,-9628.25 6579.5,-9638.25 6586.5,-9638.25"/>
</g>
<!-- ring_attn_2_8_stage_1 -->
<g id="node837" class="node">
<title>ring_attn_2_8_stage_1</title>
<polygon fill="yellow" stroke="black" points="7170,-9881 6961,-9813 7170,-9745 7379,-9813 7170,-9881"/>
<text text-anchor="middle" x="7170" y="-9831.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-9816.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="7170" y="-9801.8" font-family="Times,serif" font-size="14.00">Q[8]×K[7]×V[7]</text>
<text text-anchor="middle" x="7170" y="-9786.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_7_stage_1&#45;&gt;ring_attn_2_8_stage_1 -->
<g id="edge2484" class="edge">
<title>ring_attn_2_7_stage_1&#45;&gt;ring_attn_2_8_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-9813C6792.02,-9813 6950.86,-9813 6950.86,-9813"/>
<polygon fill="red" stroke="red" points="6950.86,-9816.5 6960.86,-9813 6950.86,-9809.5 6950.86,-9816.5"/>
</g>
<!-- ring_attn_2_7_stage_2&#45;&gt;ring_attn_2_7_stage_3 -->
<g id="edge733" class="edge">
<title>ring_attn_2_7_stage_2&#45;&gt;ring_attn_2_7_stage_3</title>
<path fill="none" stroke="black" d="M6583,-9491.87C6583,-9491.87 6583,-9385.25 6583,-9385.25"/>
<polygon fill="black" stroke="black" points="6586.5,-9385.25 6583,-9375.25 6579.5,-9385.25 6586.5,-9385.25"/>
</g>
<!-- ring_attn_2_8_stage_2 -->
<g id="node838" class="node">
<title>ring_attn_2_8_stage_2</title>
<polygon fill="yellow" stroke="black" points="7170,-9628 6961,-9560 7170,-9492 7379,-9560 7170,-9628"/>
<text text-anchor="middle" x="7170" y="-9578.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-9563.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="7170" y="-9548.8" font-family="Times,serif" font-size="14.00">Q[8]×K[6]×V[6]</text>
<text text-anchor="middle" x="7170" y="-9533.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_7_stage_2&#45;&gt;ring_attn_2_8_stage_2 -->
<g id="edge2485" class="edge">
<title>ring_attn_2_7_stage_2&#45;&gt;ring_attn_2_8_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-9560C6792.02,-9560 6950.86,-9560 6950.86,-9560"/>
<polygon fill="red" stroke="red" points="6950.86,-9563.5 6960.86,-9560 6950.86,-9556.5 6950.86,-9563.5"/>
</g>
<!-- ring_attn_2_7_stage_3&#45;&gt;ring_attn_2_7_stage_4 -->
<g id="edge734" class="edge">
<title>ring_attn_2_7_stage_3&#45;&gt;ring_attn_2_7_stage_4</title>
<path fill="none" stroke="black" d="M6583,-9238.87C6583,-9238.87 6583,-9132.25 6583,-9132.25"/>
<polygon fill="black" stroke="black" points="6586.5,-9132.25 6583,-9122.25 6579.5,-9132.25 6586.5,-9132.25"/>
</g>
<!-- ring_attn_2_8_stage_3 -->
<g id="node839" class="node">
<title>ring_attn_2_8_stage_3</title>
<polygon fill="yellow" stroke="black" points="7170,-9375 6961,-9307 7170,-9239 7379,-9307 7170,-9375"/>
<text text-anchor="middle" x="7170" y="-9325.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-9310.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="7170" y="-9295.8" font-family="Times,serif" font-size="14.00">Q[8]×K[5]×V[5]</text>
<text text-anchor="middle" x="7170" y="-9280.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_7_stage_3&#45;&gt;ring_attn_2_8_stage_3 -->
<g id="edge2486" class="edge">
<title>ring_attn_2_7_stage_3&#45;&gt;ring_attn_2_8_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-9307C6792.02,-9307 6950.86,-9307 6950.86,-9307"/>
<polygon fill="red" stroke="red" points="6950.86,-9310.5 6960.86,-9307 6950.86,-9303.5 6950.86,-9310.5"/>
</g>
<!-- ring_attn_2_7_stage_4&#45;&gt;ring_attn_2_7_stage_5 -->
<g id="edge735" class="edge">
<title>ring_attn_2_7_stage_4&#45;&gt;ring_attn_2_7_stage_5</title>
<path fill="none" stroke="black" d="M6583,-8985.87C6583,-8985.87 6583,-8879.25 6583,-8879.25"/>
<polygon fill="black" stroke="black" points="6586.5,-8879.25 6583,-8869.25 6579.5,-8879.25 6586.5,-8879.25"/>
</g>
<!-- ring_attn_2_8_stage_4 -->
<g id="node840" class="node">
<title>ring_attn_2_8_stage_4</title>
<polygon fill="yellow" stroke="black" points="7170,-9122 6961,-9054 7170,-8986 7379,-9054 7170,-9122"/>
<text text-anchor="middle" x="7170" y="-9072.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-9057.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="7170" y="-9042.8" font-family="Times,serif" font-size="14.00">Q[8]×K[4]×V[4]</text>
<text text-anchor="middle" x="7170" y="-9027.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_7_stage_4&#45;&gt;ring_attn_2_8_stage_4 -->
<g id="edge2487" class="edge">
<title>ring_attn_2_7_stage_4&#45;&gt;ring_attn_2_8_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-9054C6792.02,-9054 6950.86,-9054 6950.86,-9054"/>
<polygon fill="red" stroke="red" points="6950.86,-9057.5 6960.86,-9054 6950.86,-9050.5 6950.86,-9057.5"/>
</g>
<!-- ring_attn_2_7_stage_5&#45;&gt;ring_attn_2_7_stage_6 -->
<g id="edge736" class="edge">
<title>ring_attn_2_7_stage_5&#45;&gt;ring_attn_2_7_stage_6</title>
<path fill="none" stroke="black" d="M6583,-8732.87C6583,-8732.87 6583,-8626.25 6583,-8626.25"/>
<polygon fill="black" stroke="black" points="6586.5,-8626.25 6583,-8616.25 6579.5,-8626.25 6586.5,-8626.25"/>
</g>
<!-- ring_attn_2_8_stage_5 -->
<g id="node841" class="node">
<title>ring_attn_2_8_stage_5</title>
<polygon fill="yellow" stroke="black" points="7170,-8869 6961,-8801 7170,-8733 7379,-8801 7170,-8869"/>
<text text-anchor="middle" x="7170" y="-8819.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-8804.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="7170" y="-8789.8" font-family="Times,serif" font-size="14.00">Q[8]×K[3]×V[3]</text>
<text text-anchor="middle" x="7170" y="-8774.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_7_stage_5&#45;&gt;ring_attn_2_8_stage_5 -->
<g id="edge2488" class="edge">
<title>ring_attn_2_7_stage_5&#45;&gt;ring_attn_2_8_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-8801C6792.02,-8801 6950.86,-8801 6950.86,-8801"/>
<polygon fill="red" stroke="red" points="6950.86,-8804.5 6960.86,-8801 6950.86,-8797.5 6950.86,-8804.5"/>
</g>
<!-- ring_attn_2_7_stage_6&#45;&gt;ring_attn_2_7_stage_7 -->
<g id="edge737" class="edge">
<title>ring_attn_2_7_stage_6&#45;&gt;ring_attn_2_7_stage_7</title>
<path fill="none" stroke="black" d="M6583,-8479.87C6583,-8479.87 6583,-8373.25 6583,-8373.25"/>
<polygon fill="black" stroke="black" points="6586.5,-8373.25 6583,-8363.25 6579.5,-8373.25 6586.5,-8373.25"/>
</g>
<!-- ring_attn_2_8_stage_6 -->
<g id="node842" class="node">
<title>ring_attn_2_8_stage_6</title>
<polygon fill="yellow" stroke="black" points="7170,-8616 6961,-8548 7170,-8480 7379,-8548 7170,-8616"/>
<text text-anchor="middle" x="7170" y="-8566.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-8551.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="7170" y="-8536.8" font-family="Times,serif" font-size="14.00">Q[8]×K[2]×V[2]</text>
<text text-anchor="middle" x="7170" y="-8521.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_7_stage_6&#45;&gt;ring_attn_2_8_stage_6 -->
<g id="edge2489" class="edge">
<title>ring_attn_2_7_stage_6&#45;&gt;ring_attn_2_8_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-8548C6792.02,-8548 6950.86,-8548 6950.86,-8548"/>
<polygon fill="red" stroke="red" points="6950.86,-8551.5 6960.86,-8548 6950.86,-8544.5 6950.86,-8551.5"/>
</g>
<!-- ring_attn_2_7_stage_7&#45;&gt;ring_attn_2_7_stage_8 -->
<g id="edge738" class="edge">
<title>ring_attn_2_7_stage_7&#45;&gt;ring_attn_2_7_stage_8</title>
<path fill="none" stroke="black" d="M6583,-8226.87C6583,-8226.87 6583,-8120.25 6583,-8120.25"/>
<polygon fill="black" stroke="black" points="6586.5,-8120.25 6583,-8110.25 6579.5,-8120.25 6586.5,-8120.25"/>
</g>
<!-- ring_attn_2_8_stage_7 -->
<g id="node843" class="node">
<title>ring_attn_2_8_stage_7</title>
<polygon fill="yellow" stroke="black" points="7170,-8363 6961,-8295 7170,-8227 7379,-8295 7170,-8363"/>
<text text-anchor="middle" x="7170" y="-8313.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-8298.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="7170" y="-8283.8" font-family="Times,serif" font-size="14.00">Q[8]×K[1]×V[1]</text>
<text text-anchor="middle" x="7170" y="-8268.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_7_stage_7&#45;&gt;ring_attn_2_8_stage_7 -->
<g id="edge2490" class="edge">
<title>ring_attn_2_7_stage_7&#45;&gt;ring_attn_2_8_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-8295C6792.02,-8295 6950.86,-8295 6950.86,-8295"/>
<polygon fill="red" stroke="red" points="6950.86,-8298.5 6960.86,-8295 6950.86,-8291.5 6950.86,-8298.5"/>
</g>
<!-- ring_attn_2_7_stage_8&#45;&gt;ring_attn_2_7_stage_9 -->
<g id="edge739" class="edge">
<title>ring_attn_2_7_stage_8&#45;&gt;ring_attn_2_7_stage_9</title>
<path fill="none" stroke="black" d="M6583,-7973.87C6583,-7973.87 6583,-7867.25 6583,-7867.25"/>
<polygon fill="black" stroke="black" points="6586.5,-7867.25 6583,-7857.25 6579.5,-7867.25 6586.5,-7867.25"/>
</g>
<!-- ring_attn_2_8_stage_8 -->
<g id="node844" class="node">
<title>ring_attn_2_8_stage_8</title>
<polygon fill="yellow" stroke="black" points="7170,-8110 6961,-8042 7170,-7974 7379,-8042 7170,-8110"/>
<text text-anchor="middle" x="7170" y="-8060.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-8045.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="7170" y="-8030.8" font-family="Times,serif" font-size="14.00">Q[8]×K[0]×V[0]</text>
<text text-anchor="middle" x="7170" y="-8015.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_7_stage_8&#45;&gt;ring_attn_2_8_stage_8 -->
<g id="edge2491" class="edge">
<title>ring_attn_2_7_stage_8&#45;&gt;ring_attn_2_8_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-8042C6792.02,-8042 6950.86,-8042 6950.86,-8042"/>
<polygon fill="red" stroke="red" points="6950.86,-8045.5 6960.86,-8042 6950.86,-8038.5 6950.86,-8045.5"/>
</g>
<!-- ring_attn_2_7_stage_9&#45;&gt;ring_attn_2_7_stage_10 -->
<g id="edge740" class="edge">
<title>ring_attn_2_7_stage_9&#45;&gt;ring_attn_2_7_stage_10</title>
<path fill="none" stroke="black" d="M6583,-7720.87C6583,-7720.87 6583,-7614.25 6583,-7614.25"/>
<polygon fill="black" stroke="black" points="6586.5,-7614.25 6583,-7604.25 6579.5,-7614.25 6586.5,-7614.25"/>
</g>
<!-- ring_attn_2_8_stage_9 -->
<g id="node845" class="node">
<title>ring_attn_2_8_stage_9</title>
<polygon fill="yellow" stroke="black" points="7170,-7857 6961,-7789 7170,-7721 7379,-7789 7170,-7857"/>
<text text-anchor="middle" x="7170" y="-7807.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-7792.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="7170" y="-7777.8" font-family="Times,serif" font-size="14.00">Q[8]×K[15]×V[15]</text>
<text text-anchor="middle" x="7170" y="-7762.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_7_stage_9&#45;&gt;ring_attn_2_8_stage_9 -->
<g id="edge2492" class="edge">
<title>ring_attn_2_7_stage_9&#45;&gt;ring_attn_2_8_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-7789C6792.02,-7789 6950.86,-7789 6950.86,-7789"/>
<polygon fill="red" stroke="red" points="6950.86,-7792.5 6960.86,-7789 6950.86,-7785.5 6950.86,-7792.5"/>
</g>
<!-- ring_attn_2_7_stage_10&#45;&gt;ring_attn_2_7_stage_11 -->
<g id="edge741" class="edge">
<title>ring_attn_2_7_stage_10&#45;&gt;ring_attn_2_7_stage_11</title>
<path fill="none" stroke="black" d="M6583,-7467.87C6583,-7467.87 6583,-7361.25 6583,-7361.25"/>
<polygon fill="black" stroke="black" points="6586.5,-7361.25 6583,-7351.25 6579.5,-7361.25 6586.5,-7361.25"/>
</g>
<!-- ring_attn_2_8_stage_10 -->
<g id="node846" class="node">
<title>ring_attn_2_8_stage_10</title>
<polygon fill="yellow" stroke="black" points="7170,-7604 6961,-7536 7170,-7468 7379,-7536 7170,-7604"/>
<text text-anchor="middle" x="7170" y="-7554.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-7539.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="7170" y="-7524.8" font-family="Times,serif" font-size="14.00">Q[8]×K[14]×V[14]</text>
<text text-anchor="middle" x="7170" y="-7509.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_7_stage_10&#45;&gt;ring_attn_2_8_stage_10 -->
<g id="edge2493" class="edge">
<title>ring_attn_2_7_stage_10&#45;&gt;ring_attn_2_8_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-7536C6792.02,-7536 6950.86,-7536 6950.86,-7536"/>
<polygon fill="red" stroke="red" points="6950.86,-7539.5 6960.86,-7536 6950.86,-7532.5 6950.86,-7539.5"/>
</g>
<!-- ring_attn_2_7_stage_11&#45;&gt;ring_attn_2_7_stage_12 -->
<g id="edge742" class="edge">
<title>ring_attn_2_7_stage_11&#45;&gt;ring_attn_2_7_stage_12</title>
<path fill="none" stroke="black" d="M6583,-7214.87C6583,-7214.87 6583,-7108.25 6583,-7108.25"/>
<polygon fill="black" stroke="black" points="6586.5,-7108.25 6583,-7098.25 6579.5,-7108.25 6586.5,-7108.25"/>
</g>
<!-- ring_attn_2_8_stage_11 -->
<g id="node847" class="node">
<title>ring_attn_2_8_stage_11</title>
<polygon fill="yellow" stroke="black" points="7170,-7351 6961,-7283 7170,-7215 7379,-7283 7170,-7351"/>
<text text-anchor="middle" x="7170" y="-7301.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-7286.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="7170" y="-7271.8" font-family="Times,serif" font-size="14.00">Q[8]×K[13]×V[13]</text>
<text text-anchor="middle" x="7170" y="-7256.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_7_stage_11&#45;&gt;ring_attn_2_8_stage_11 -->
<g id="edge2494" class="edge">
<title>ring_attn_2_7_stage_11&#45;&gt;ring_attn_2_8_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-7283C6792.02,-7283 6950.86,-7283 6950.86,-7283"/>
<polygon fill="red" stroke="red" points="6950.86,-7286.5 6960.86,-7283 6950.86,-7279.5 6950.86,-7286.5"/>
</g>
<!-- ring_attn_2_7_stage_12&#45;&gt;ring_attn_2_7_stage_13 -->
<g id="edge743" class="edge">
<title>ring_attn_2_7_stage_12&#45;&gt;ring_attn_2_7_stage_13</title>
<path fill="none" stroke="black" d="M6583,-6961.87C6583,-6961.87 6583,-6855.25 6583,-6855.25"/>
<polygon fill="black" stroke="black" points="6586.5,-6855.25 6583,-6845.25 6579.5,-6855.25 6586.5,-6855.25"/>
</g>
<!-- ring_attn_2_8_stage_12 -->
<g id="node848" class="node">
<title>ring_attn_2_8_stage_12</title>
<polygon fill="yellow" stroke="black" points="7170,-7098 6961,-7030 7170,-6962 7379,-7030 7170,-7098"/>
<text text-anchor="middle" x="7170" y="-7048.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-7033.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="7170" y="-7018.8" font-family="Times,serif" font-size="14.00">Q[8]×K[12]×V[12]</text>
<text text-anchor="middle" x="7170" y="-7003.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_7_stage_12&#45;&gt;ring_attn_2_8_stage_12 -->
<g id="edge2495" class="edge">
<title>ring_attn_2_7_stage_12&#45;&gt;ring_attn_2_8_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-7030C6792.02,-7030 6950.86,-7030 6950.86,-7030"/>
<polygon fill="red" stroke="red" points="6950.86,-7033.5 6960.86,-7030 6950.86,-7026.5 6950.86,-7033.5"/>
</g>
<!-- ring_attn_2_7_stage_13&#45;&gt;ring_attn_2_7_stage_14 -->
<g id="edge744" class="edge">
<title>ring_attn_2_7_stage_13&#45;&gt;ring_attn_2_7_stage_14</title>
<path fill="none" stroke="black" d="M6583,-6708.87C6583,-6708.87 6583,-6602.25 6583,-6602.25"/>
<polygon fill="black" stroke="black" points="6586.5,-6602.25 6583,-6592.25 6579.5,-6602.25 6586.5,-6602.25"/>
</g>
<!-- ring_attn_2_8_stage_13 -->
<g id="node849" class="node">
<title>ring_attn_2_8_stage_13</title>
<polygon fill="yellow" stroke="black" points="7170,-6845 6961,-6777 7170,-6709 7379,-6777 7170,-6845"/>
<text text-anchor="middle" x="7170" y="-6795.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-6780.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="7170" y="-6765.8" font-family="Times,serif" font-size="14.00">Q[8]×K[11]×V[11]</text>
<text text-anchor="middle" x="7170" y="-6750.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_7_stage_13&#45;&gt;ring_attn_2_8_stage_13 -->
<g id="edge2496" class="edge">
<title>ring_attn_2_7_stage_13&#45;&gt;ring_attn_2_8_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-6777C6792.02,-6777 6950.86,-6777 6950.86,-6777"/>
<polygon fill="red" stroke="red" points="6950.86,-6780.5 6960.86,-6777 6950.86,-6773.5 6950.86,-6780.5"/>
</g>
<!-- ring_attn_2_7_stage_14&#45;&gt;ring_attn_2_7_stage_15 -->
<g id="edge745" class="edge">
<title>ring_attn_2_7_stage_14&#45;&gt;ring_attn_2_7_stage_15</title>
<path fill="none" stroke="black" d="M6583,-6455.87C6583,-6455.87 6583,-6349.25 6583,-6349.25"/>
<polygon fill="black" stroke="black" points="6586.5,-6349.25 6583,-6339.25 6579.5,-6349.25 6586.5,-6349.25"/>
</g>
<!-- ring_attn_2_8_stage_14 -->
<g id="node850" class="node">
<title>ring_attn_2_8_stage_14</title>
<polygon fill="yellow" stroke="black" points="7170,-6592 6961,-6524 7170,-6456 7379,-6524 7170,-6592"/>
<text text-anchor="middle" x="7170" y="-6542.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-6527.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="7170" y="-6512.8" font-family="Times,serif" font-size="14.00">Q[8]×K[10]×V[10]</text>
<text text-anchor="middle" x="7170" y="-6497.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_7_stage_14&#45;&gt;ring_attn_2_8_stage_14 -->
<g id="edge2497" class="edge">
<title>ring_attn_2_7_stage_14&#45;&gt;ring_attn_2_8_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-6524C6792.02,-6524 6950.86,-6524 6950.86,-6524"/>
<polygon fill="red" stroke="red" points="6950.86,-6527.5 6960.86,-6524 6950.86,-6520.5 6950.86,-6527.5"/>
</g>
<!-- attn_out_2_7 -->
<g id="node754" class="node">
<title>attn_out_2_7</title>
<polygon fill="none" stroke="black" points="6652.5,-6130 6513.5,-6130 6513.5,-6077 6652.5,-6077 6652.5,-6130"/>
<text text-anchor="middle" x="6583" y="-6114.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="6583" y="-6099.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="6583" y="-6084.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_2_7_stage_15&#45;&gt;attn_out_2_7 -->
<g id="edge746" class="edge">
<title>ring_attn_2_7_stage_15&#45;&gt;attn_out_2_7</title>
<path fill="none" stroke="black" d="M6583,-6202.87C6583,-6202.87 6583,-6140.18 6583,-6140.18"/>
<polygon fill="black" stroke="black" points="6586.5,-6140.18 6583,-6130.18 6579.5,-6140.18 6586.5,-6140.18"/>
</g>
<!-- ring_attn_2_8_stage_15 -->
<g id="node851" class="node">
<title>ring_attn_2_8_stage_15</title>
<polygon fill="yellow" stroke="black" points="7170,-6339 6961,-6271 7170,-6203 7379,-6271 7170,-6339"/>
<text text-anchor="middle" x="7170" y="-6289.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-6274.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="7170" y="-6259.8" font-family="Times,serif" font-size="14.00">Q[8]×K[9]×V[9]</text>
<text text-anchor="middle" x="7170" y="-6244.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_7_stage_15&#45;&gt;ring_attn_2_8_stage_15 -->
<g id="edge2498" class="edge">
<title>ring_attn_2_7_stage_15&#45;&gt;ring_attn_2_8_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-6271C6792.02,-6271 6950.86,-6271 6950.86,-6271"/>
<polygon fill="red" stroke="red" points="6950.86,-6274.5 6960.86,-6271 6950.86,-6267.5 6950.86,-6274.5"/>
</g>
<!-- attn_residual_2_7 -->
<g id="node755" class="node">
<title>attn_residual_2_7</title>
<ellipse fill="none" stroke="black" cx="6583" cy="-5977" rx="105.5" ry="27"/>
<text text-anchor="middle" x="6583" y="-5980.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="6583" y="-5965.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_2_7&#45;&gt;attn_residual_2_7 -->
<g id="edge747" class="edge">
<title>attn_out_2_7&#45;&gt;attn_residual_2_7</title>
<path fill="none" stroke="black" d="M6583,-6076.98C6583,-6076.98 6583,-6014.36 6583,-6014.36"/>
<polygon fill="black" stroke="black" points="6586.5,-6014.36 6583,-6004.36 6579.5,-6014.36 6586.5,-6014.36"/>
</g>
<!-- gate_2_7 -->
<g id="node756" class="node">
<title>gate_2_7</title>
<ellipse fill="orange" stroke="black" cx="6583" cy="-5839.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="6583" y="-5850.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="6583" y="-5835.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="6583" y="-5820.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_2_7&#45;&gt;gate_2_7 -->
<g id="edge748" class="edge">
<title>attn_residual_2_7&#45;&gt;gate_2_7</title>
<path fill="none" stroke="black" d="M6583,-5949.83C6583,-5949.83 6583,-5887.02 6583,-5887.02"/>
<polygon fill="black" stroke="black" points="6586.5,-5887.02 6583,-5877.02 6579.5,-5887.02 6586.5,-5887.02"/>
</g>
<!-- gate_2_7&#45;&gt;expert_2_0_0 -->
<g id="edge2499" class="edge">
<title>gate_2_7&#45;&gt;expert_2_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6530.25,-5872.29C6530.25,-5894.19 6530.25,-5919 6530.25,-5919 6530.25,-5919 334.36,-5919 334.36,-5919 334.36,-5919 334.36,-5680.17 334.36,-5680.17"/>
<polygon fill="blue" stroke="blue" points="337.86,-5680.17 334.36,-5670.17 330.86,-5680.17 337.86,-5680.17"/>
<text text-anchor="middle" x="27266.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27266.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU7→GPU0</text>
<text text-anchor="middle" x="27266.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27266.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_7&#45;&gt;expert_2_1_0 -->
<g id="edge2500" class="edge">
<title>gate_2_7&#45;&gt;expert_2_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6487.55,-5823.49C6487.55,-5801.33 6487.55,-5764 6487.55,-5764 6487.55,-5764 2993.86,-5764 2993.86,-5764 2993.86,-5764 2993.86,-5680.24 2993.86,-5680.24"/>
<polygon fill="blue" stroke="blue" points="2997.36,-5680.24 2993.86,-5670.24 2990.36,-5680.24 2997.36,-5680.24"/>
<text text-anchor="middle" x="27440.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27440.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU7→GPU1</text>
<text text-anchor="middle" x="27440.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27440.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_7&#45;&gt;expert_2_2_0 -->
<g id="edge2501" class="edge">
<title>gate_2_7&#45;&gt;expert_2_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6507.64,-5813.03C6507.64,-5780.34 6507.64,-5729 6507.64,-5729 6507.64,-5729 3589.39,-5729 3589.39,-5729 3589.39,-5729 3589.39,-5680.08 3589.39,-5680.08"/>
<polygon fill="blue" stroke="blue" points="3592.89,-5680.08 3589.39,-5670.08 3585.89,-5680.08 3592.89,-5680.08"/>
<text text-anchor="middle" x="27614.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27614.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU7→GPU2</text>
<text text-anchor="middle" x="27614.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27614.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_7&#45;&gt;expert_2_3_0 -->
<g id="edge2502" class="edge">
<title>gate_2_7&#45;&gt;expert_2_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6527.74,-5807.48C6527.74,-5786.9 6527.74,-5764 6527.74,-5764 6527.74,-5764 4180.14,-5764 4180.14,-5764 4180.14,-5764 4180.14,-5680.24 4180.14,-5680.24"/>
<polygon fill="blue" stroke="blue" points="4183.64,-5680.24 4180.14,-5670.24 4176.64,-5680.24 4183.64,-5680.24"/>
<text text-anchor="middle" x="27788.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27788.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU7→GPU3</text>
<text text-anchor="middle" x="27788.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27788.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_7&#45;&gt;expert_2_4_0 -->
<g id="edge2503" class="edge">
<title>gate_2_7&#45;&gt;expert_2_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6547.83,-5803.77C6547.83,-5787.58 6547.83,-5772 6547.83,-5772 6547.83,-5772 4776.79,-5772 4776.79,-5772 4776.79,-5772 4776.79,-5680.13 4776.79,-5680.13"/>
<polygon fill="blue" stroke="blue" points="4780.29,-5680.13 4776.79,-5670.13 4773.29,-5680.13 4780.29,-5680.13"/>
<text text-anchor="middle" x="27962.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27962.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU7→GPU4</text>
<text text-anchor="middle" x="27962.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27962.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_7&#45;&gt;expert_2_5_0 -->
<g id="edge2504" class="edge">
<title>gate_2_7&#45;&gt;expert_2_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6557.88,-5802.77C6557.88,-5797.6 6557.88,-5794 6557.88,-5794 6557.88,-5794 5524.62,-5794 5524.62,-5794 5524.62,-5794 5524.62,-5680.06 5524.62,-5680.06"/>
<polygon fill="blue" stroke="blue" points="5528.13,-5680.06 5524.62,-5670.06 5521.13,-5680.06 5528.13,-5680.06"/>
<text text-anchor="middle" x="28136.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="28136.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU7→GPU5</text>
<text text-anchor="middle" x="28136.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="28136.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_7&#45;&gt;expert_2_6_0 -->
<g id="edge2505" class="edge">
<title>gate_2_7&#45;&gt;expert_2_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6483.48,-5852C6344.26,-5852 6108.25,-5852 6108.25,-5852 6108.25,-5852 6108.25,-5680.33 6108.25,-5680.33"/>
<polygon fill="blue" stroke="blue" points="6111.75,-5680.33 6108.25,-5670.33 6104.75,-5680.33 6111.75,-5680.33"/>
<text text-anchor="middle" x="28310.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="28310.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU7→GPU6</text>
<text text-anchor="middle" x="28310.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="28310.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_7&#45;&gt;expert_2_7_0 -->
<g id="edge749" class="edge">
<title>gate_2_7&#45;&gt;expert_2_7_0</title>
<path fill="none" stroke="black" d="M6567.93,-5802.17C6567.93,-5802.17 6567.93,-5680.01 6567.93,-5680.01"/>
<polygon fill="black" stroke="black" points="6571.43,-5680.01 6567.93,-5670.01 6564.43,-5680.01 6571.43,-5680.01"/>
</g>
<!-- gate_2_7&#45;&gt;expert_2_8_0 -->
<g id="edge2506" class="edge">
<title>gate_2_7&#45;&gt;expert_2_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6682.65,-5827C6822.77,-5827 7061.12,-5827 7061.12,-5827 7061.12,-5827 7061.12,-5680.18 7061.12,-5680.18"/>
<polygon fill="blue" stroke="blue" points="7064.63,-5680.18 7061.12,-5670.18 7057.63,-5680.18 7064.63,-5680.18"/>
<text text-anchor="middle" x="28484.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="28484.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU7→GPU8</text>
<text text-anchor="middle" x="28484.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="28484.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_7&#45;&gt;expert_2_9_0 -->
<g id="edge2507" class="edge">
<title>gate_2_7&#45;&gt;expert_2_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6628.21,-5805.62C6628.21,-5794.06 6628.21,-5784 6628.21,-5784 6628.21,-5784 7644.75,-5784 7644.75,-5784 7644.75,-5784 7644.75,-5680.26 7644.75,-5680.26"/>
<polygon fill="blue" stroke="blue" points="7648.25,-5680.26 7644.75,-5670.26 7641.25,-5680.26 7648.25,-5680.26"/>
<text text-anchor="middle" x="28658.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="28658.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU7→GPU9</text>
<text text-anchor="middle" x="28658.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="28658.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_7&#45;&gt;expert_2_10_0 -->
<g id="edge2508" class="edge">
<title>gate_2_7&#45;&gt;expert_2_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6638.26,-5807.29C6638.26,-5784.51 6638.26,-5758 6638.26,-5758 6638.26,-5758 8227.7,-5758 8227.7,-5758 8227.7,-5758 8227.7,-5680.06 8227.7,-5680.06"/>
<polygon fill="blue" stroke="blue" points="8231.2,-5680.06 8227.7,-5670.06 8224.2,-5680.06 8231.2,-5680.06"/>
<text text-anchor="middle" x="28832.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="28832.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU7→GPU10</text>
<text text-anchor="middle" x="28832.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="28832.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_7&#45;&gt;expert_2_11_0 -->
<g id="edge2509" class="edge">
<title>gate_2_7&#45;&gt;expert_2_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6648.31,-5809.7C6648.31,-5783.66 6648.31,-5750 6648.31,-5750 6648.31,-5750 8946.07,-5750 8946.07,-5750 8946.07,-5750 8946.07,-5680.1 8946.07,-5680.1"/>
<polygon fill="blue" stroke="blue" points="8949.57,-5680.1 8946.07,-5670.1 8942.57,-5680.1 8949.57,-5680.1"/>
<text text-anchor="middle" x="29006.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29006.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU7→GPU11</text>
<text text-anchor="middle" x="29006.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29006.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_7&#45;&gt;expert_2_12_0 -->
<g id="edge2510" class="edge">
<title>gate_2_7&#45;&gt;expert_2_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6658.36,-5812.96C6658.36,-5785.31 6658.36,-5746 6658.36,-5746 6658.36,-5746 9540.93,-5746 9540.93,-5746 9540.93,-5746 9540.93,-5680.16 9540.93,-5680.16"/>
<polygon fill="blue" stroke="blue" points="9544.43,-5680.16 9540.93,-5670.16 9537.43,-5680.16 9544.43,-5680.16"/>
<text text-anchor="middle" x="29180.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29180.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU7→GPU12</text>
<text text-anchor="middle" x="29180.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29180.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_7&#45;&gt;expert_2_13_0 -->
<g id="edge2511" class="edge">
<title>gate_2_7&#45;&gt;expert_2_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6668.4,-5817.32C6668.4,-5779.6 6668.4,-5707 6668.4,-5707 6668.4,-5707 10134.54,-5707 10134.54,-5707 10134.54,-5707 10134.54,-5680.06 10134.54,-5680.06"/>
<polygon fill="blue" stroke="blue" points="10138.04,-5680.06 10134.54,-5670.06 10131.04,-5680.06 10138.04,-5680.06"/>
<text text-anchor="middle" x="29354.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29354.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU7→GPU13</text>
<text text-anchor="middle" x="29354.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29354.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_7&#45;&gt;expert_2_14_0 -->
<g id="edge2512" class="edge">
<title>gate_2_7&#45;&gt;expert_2_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6678.45,-5823.46C6678.45,-5787.19 6678.45,-5702 6678.45,-5702 6678.45,-5702 10697.02,-5702 10697.02,-5702 10697.02,-5702 10697.02,-5680.01 10697.02,-5680.01"/>
<polygon fill="blue" stroke="blue" points="10700.52,-5680.01 10697.02,-5670.01 10693.52,-5680.01 10700.52,-5680.01"/>
<text text-anchor="middle" x="29528.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29528.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU7→GPU14</text>
<text text-anchor="middle" x="29528.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29528.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_7&#45;&gt;expert_2_15_0 -->
<g id="edge2513" class="edge">
<title>gate_2_7&#45;&gt;expert_2_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6635.75,-5872.12C6635.75,-5876.21 6635.75,-5879 6635.75,-5879 6635.75,-5879 11168.44,-5879 11168.44,-5879 11168.44,-5879 11168.44,-5680.06 11168.44,-5680.06"/>
<polygon fill="blue" stroke="blue" points="11171.94,-5680.06 11168.44,-5670.06 11164.94,-5680.06 11171.94,-5680.06"/>
<text text-anchor="middle" x="29702.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29702.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU7→GPU15</text>
<text text-anchor="middle" x="29702.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29702.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_7 -->
<g id="node758" class="node">
<title>expert_reduce_2_7</title>
<ellipse fill="none" stroke="black" cx="6583" cy="-5506.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="6583" y="-5517.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="6583" y="-5502.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="6583" y="-5487.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_7_0&#45;&gt;expert_reduce_2_7 -->
<g id="edge750" class="edge">
<title>expert_2_7_0&#45;&gt;expert_reduce_2_7</title>
<path fill="none" stroke="black" d="M6583,-5616.76C6583,-5616.76 6583,-5554.06 6583,-5554.06"/>
<polygon fill="black" stroke="black" points="6586.5,-5554.06 6583,-5544.06 6579.5,-5554.06 6586.5,-5554.06"/>
</g>
<!-- moe_residual_2_7 -->
<g id="node759" class="node">
<title>moe_residual_2_7</title>
<ellipse fill="none" stroke="black" cx="6583" cy="-5369" rx="105.5" ry="27"/>
<text text-anchor="middle" x="6583" y="-5372.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="6583" y="-5357.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_7&#45;&gt;moe_residual_2_7 -->
<g id="edge751" class="edge">
<title>expert_reduce_2_7&#45;&gt;moe_residual_2_7</title>
<path fill="none" stroke="black" d="M6583,-5468.93C6583,-5468.93 6583,-5406.06 6583,-5406.06"/>
<polygon fill="black" stroke="black" points="6586.5,-5406.06 6583,-5396.06 6579.5,-5406.06 6586.5,-5406.06"/>
</g>
<!-- qkv_proj_3_7 -->
<g id="node760" class="node">
<title>qkv_proj_3_7</title>
<polygon fill="none" stroke="black" points="6665.5,-5269 6500.5,-5269 6500.5,-5216 6665.5,-5216 6665.5,-5269"/>
<text text-anchor="middle" x="6583" y="-5253.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="6583" y="-5238.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="6583" y="-5223.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_2_7&#45;&gt;qkv_proj_3_7 -->
<g id="edge752" class="edge">
<title>moe_residual_2_7&#45;&gt;qkv_proj_3_7</title>
<path fill="none" stroke="black" d="M6583,-5341.86C6583,-5341.86 6583,-5279.16 6583,-5279.16"/>
<polygon fill="black" stroke="black" points="6586.5,-5279.16 6583,-5269.16 6579.5,-5279.16 6586.5,-5279.16"/>
</g>
<!-- qkv_reshape_3_7 -->
<g id="node761" class="node">
<title>qkv_reshape_3_7</title>
<ellipse fill="none" stroke="black" cx="6583" cy="-5116" rx="148" ry="27"/>
<text text-anchor="middle" x="6583" y="-5119.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="6583" y="-5104.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_3_7&#45;&gt;qkv_reshape_3_7 -->
<g id="edge753" class="edge">
<title>qkv_proj_3_7&#45;&gt;qkv_reshape_3_7</title>
<path fill="none" stroke="black" d="M6583,-5215.98C6583,-5215.98 6583,-5153.36 6583,-5153.36"/>
<polygon fill="black" stroke="black" points="6586.5,-5153.36 6583,-5143.36 6579.5,-5153.36 6586.5,-5153.36"/>
</g>
<!-- qkv_reshape_3_7&#45;&gt;ring_attn_3_7_stage_0 -->
<g id="edge754" class="edge">
<title>qkv_reshape_3_7&#45;&gt;ring_attn_3_7_stage_0</title>
<path fill="none" stroke="black" d="M6583,-5088.72C6583,-5088.72 6583,-4982.16 6583,-4982.16"/>
<polygon fill="black" stroke="black" points="6586.5,-4982.16 6583,-4972.16 6579.5,-4982.16 6586.5,-4982.16"/>
</g>
<!-- ring_attn_3_7_stage_0&#45;&gt;ring_attn_3_7_stage_1 -->
<g id="edge755" class="edge">
<title>ring_attn_3_7_stage_0&#45;&gt;ring_attn_3_7_stage_1</title>
<path fill="none" stroke="black" d="M6583,-4835.87C6583,-4835.87 6583,-4729.25 6583,-4729.25"/>
<polygon fill="black" stroke="black" points="6586.5,-4729.25 6583,-4719.25 6579.5,-4729.25 6586.5,-4729.25"/>
</g>
<!-- ring_attn_3_8_stage_0 -->
<g id="node860" class="node">
<title>ring_attn_3_8_stage_0</title>
<polygon fill="yellow" stroke="black" points="7170,-4972 6961,-4904 7170,-4836 7379,-4904 7170,-4972"/>
<text text-anchor="middle" x="7170" y="-4922.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-4907.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="7170" y="-4892.8" font-family="Times,serif" font-size="14.00">Q[8]×K[8]×V[8]</text>
<text text-anchor="middle" x="7170" y="-4877.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_7_stage_0&#45;&gt;ring_attn_3_8_stage_0 -->
<g id="edge2514" class="edge">
<title>ring_attn_3_7_stage_0&#45;&gt;ring_attn_3_8_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-4904C6792.02,-4904 6950.86,-4904 6950.86,-4904"/>
<polygon fill="red" stroke="red" points="6950.86,-4907.5 6960.86,-4904 6950.86,-4900.5 6950.86,-4907.5"/>
</g>
<!-- ring_attn_3_7_stage_1&#45;&gt;ring_attn_3_7_stage_2 -->
<g id="edge756" class="edge">
<title>ring_attn_3_7_stage_1&#45;&gt;ring_attn_3_7_stage_2</title>
<path fill="none" stroke="black" d="M6583,-4582.87C6583,-4582.87 6583,-4476.25 6583,-4476.25"/>
<polygon fill="black" stroke="black" points="6586.5,-4476.25 6583,-4466.25 6579.5,-4476.25 6586.5,-4476.25"/>
</g>
<!-- ring_attn_3_8_stage_1 -->
<g id="node861" class="node">
<title>ring_attn_3_8_stage_1</title>
<polygon fill="yellow" stroke="black" points="7170,-4719 6961,-4651 7170,-4583 7379,-4651 7170,-4719"/>
<text text-anchor="middle" x="7170" y="-4669.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-4654.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="7170" y="-4639.8" font-family="Times,serif" font-size="14.00">Q[8]×K[7]×V[7]</text>
<text text-anchor="middle" x="7170" y="-4624.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_7_stage_1&#45;&gt;ring_attn_3_8_stage_1 -->
<g id="edge2515" class="edge">
<title>ring_attn_3_7_stage_1&#45;&gt;ring_attn_3_8_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-4651C6792.02,-4651 6950.86,-4651 6950.86,-4651"/>
<polygon fill="red" stroke="red" points="6950.86,-4654.5 6960.86,-4651 6950.86,-4647.5 6950.86,-4654.5"/>
</g>
<!-- ring_attn_3_7_stage_2&#45;&gt;ring_attn_3_7_stage_3 -->
<g id="edge757" class="edge">
<title>ring_attn_3_7_stage_2&#45;&gt;ring_attn_3_7_stage_3</title>
<path fill="none" stroke="black" d="M6583,-4329.87C6583,-4329.87 6583,-4223.25 6583,-4223.25"/>
<polygon fill="black" stroke="black" points="6586.5,-4223.25 6583,-4213.25 6579.5,-4223.25 6586.5,-4223.25"/>
</g>
<!-- ring_attn_3_8_stage_2 -->
<g id="node862" class="node">
<title>ring_attn_3_8_stage_2</title>
<polygon fill="yellow" stroke="black" points="7170,-4466 6961,-4398 7170,-4330 7379,-4398 7170,-4466"/>
<text text-anchor="middle" x="7170" y="-4416.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-4401.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="7170" y="-4386.8" font-family="Times,serif" font-size="14.00">Q[8]×K[6]×V[6]</text>
<text text-anchor="middle" x="7170" y="-4371.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_7_stage_2&#45;&gt;ring_attn_3_8_stage_2 -->
<g id="edge2516" class="edge">
<title>ring_attn_3_7_stage_2&#45;&gt;ring_attn_3_8_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-4398C6792.02,-4398 6950.86,-4398 6950.86,-4398"/>
<polygon fill="red" stroke="red" points="6950.86,-4401.5 6960.86,-4398 6950.86,-4394.5 6950.86,-4401.5"/>
</g>
<!-- ring_attn_3_7_stage_3&#45;&gt;ring_attn_3_7_stage_4 -->
<g id="edge758" class="edge">
<title>ring_attn_3_7_stage_3&#45;&gt;ring_attn_3_7_stage_4</title>
<path fill="none" stroke="black" d="M6583,-4076.87C6583,-4076.87 6583,-3970.25 6583,-3970.25"/>
<polygon fill="black" stroke="black" points="6586.5,-3970.25 6583,-3960.25 6579.5,-3970.25 6586.5,-3970.25"/>
</g>
<!-- ring_attn_3_8_stage_3 -->
<g id="node863" class="node">
<title>ring_attn_3_8_stage_3</title>
<polygon fill="yellow" stroke="black" points="7170,-4213 6961,-4145 7170,-4077 7379,-4145 7170,-4213"/>
<text text-anchor="middle" x="7170" y="-4163.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-4148.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="7170" y="-4133.8" font-family="Times,serif" font-size="14.00">Q[8]×K[5]×V[5]</text>
<text text-anchor="middle" x="7170" y="-4118.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_7_stage_3&#45;&gt;ring_attn_3_8_stage_3 -->
<g id="edge2517" class="edge">
<title>ring_attn_3_7_stage_3&#45;&gt;ring_attn_3_8_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-4145C6792.02,-4145 6950.86,-4145 6950.86,-4145"/>
<polygon fill="red" stroke="red" points="6950.86,-4148.5 6960.86,-4145 6950.86,-4141.5 6950.86,-4148.5"/>
</g>
<!-- ring_attn_3_7_stage_4&#45;&gt;ring_attn_3_7_stage_5 -->
<g id="edge759" class="edge">
<title>ring_attn_3_7_stage_4&#45;&gt;ring_attn_3_7_stage_5</title>
<path fill="none" stroke="black" d="M6583,-3823.87C6583,-3823.87 6583,-3717.25 6583,-3717.25"/>
<polygon fill="black" stroke="black" points="6586.5,-3717.25 6583,-3707.25 6579.5,-3717.25 6586.5,-3717.25"/>
</g>
<!-- ring_attn_3_8_stage_4 -->
<g id="node864" class="node">
<title>ring_attn_3_8_stage_4</title>
<polygon fill="yellow" stroke="black" points="7170,-3960 6961,-3892 7170,-3824 7379,-3892 7170,-3960"/>
<text text-anchor="middle" x="7170" y="-3910.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-3895.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="7170" y="-3880.8" font-family="Times,serif" font-size="14.00">Q[8]×K[4]×V[4]</text>
<text text-anchor="middle" x="7170" y="-3865.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_7_stage_4&#45;&gt;ring_attn_3_8_stage_4 -->
<g id="edge2518" class="edge">
<title>ring_attn_3_7_stage_4&#45;&gt;ring_attn_3_8_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-3892C6792.02,-3892 6950.86,-3892 6950.86,-3892"/>
<polygon fill="red" stroke="red" points="6950.86,-3895.5 6960.86,-3892 6950.86,-3888.5 6950.86,-3895.5"/>
</g>
<!-- ring_attn_3_7_stage_5&#45;&gt;ring_attn_3_7_stage_6 -->
<g id="edge760" class="edge">
<title>ring_attn_3_7_stage_5&#45;&gt;ring_attn_3_7_stage_6</title>
<path fill="none" stroke="black" d="M6583,-3570.87C6583,-3570.87 6583,-3464.25 6583,-3464.25"/>
<polygon fill="black" stroke="black" points="6586.5,-3464.25 6583,-3454.25 6579.5,-3464.25 6586.5,-3464.25"/>
</g>
<!-- ring_attn_3_8_stage_5 -->
<g id="node865" class="node">
<title>ring_attn_3_8_stage_5</title>
<polygon fill="yellow" stroke="black" points="7170,-3707 6961,-3639 7170,-3571 7379,-3639 7170,-3707"/>
<text text-anchor="middle" x="7170" y="-3657.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-3642.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="7170" y="-3627.8" font-family="Times,serif" font-size="14.00">Q[8]×K[3]×V[3]</text>
<text text-anchor="middle" x="7170" y="-3612.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_7_stage_5&#45;&gt;ring_attn_3_8_stage_5 -->
<g id="edge2519" class="edge">
<title>ring_attn_3_7_stage_5&#45;&gt;ring_attn_3_8_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-3639C6792.02,-3639 6950.86,-3639 6950.86,-3639"/>
<polygon fill="red" stroke="red" points="6950.86,-3642.5 6960.86,-3639 6950.86,-3635.5 6950.86,-3642.5"/>
</g>
<!-- ring_attn_3_7_stage_6&#45;&gt;ring_attn_3_7_stage_7 -->
<g id="edge761" class="edge">
<title>ring_attn_3_7_stage_6&#45;&gt;ring_attn_3_7_stage_7</title>
<path fill="none" stroke="black" d="M6583,-3317.87C6583,-3317.87 6583,-3211.25 6583,-3211.25"/>
<polygon fill="black" stroke="black" points="6586.5,-3211.25 6583,-3201.25 6579.5,-3211.25 6586.5,-3211.25"/>
</g>
<!-- ring_attn_3_8_stage_6 -->
<g id="node866" class="node">
<title>ring_attn_3_8_stage_6</title>
<polygon fill="yellow" stroke="black" points="7170,-3454 6961,-3386 7170,-3318 7379,-3386 7170,-3454"/>
<text text-anchor="middle" x="7170" y="-3404.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-3389.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="7170" y="-3374.8" font-family="Times,serif" font-size="14.00">Q[8]×K[2]×V[2]</text>
<text text-anchor="middle" x="7170" y="-3359.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_7_stage_6&#45;&gt;ring_attn_3_8_stage_6 -->
<g id="edge2520" class="edge">
<title>ring_attn_3_7_stage_6&#45;&gt;ring_attn_3_8_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-3386C6792.02,-3386 6950.86,-3386 6950.86,-3386"/>
<polygon fill="red" stroke="red" points="6950.86,-3389.5 6960.86,-3386 6950.86,-3382.5 6950.86,-3389.5"/>
</g>
<!-- ring_attn_3_7_stage_7&#45;&gt;ring_attn_3_7_stage_8 -->
<g id="edge762" class="edge">
<title>ring_attn_3_7_stage_7&#45;&gt;ring_attn_3_7_stage_8</title>
<path fill="none" stroke="black" d="M6583,-3064.87C6583,-3064.87 6583,-2958.25 6583,-2958.25"/>
<polygon fill="black" stroke="black" points="6586.5,-2958.25 6583,-2948.25 6579.5,-2958.25 6586.5,-2958.25"/>
</g>
<!-- ring_attn_3_8_stage_7 -->
<g id="node867" class="node">
<title>ring_attn_3_8_stage_7</title>
<polygon fill="yellow" stroke="black" points="7170,-3201 6961,-3133 7170,-3065 7379,-3133 7170,-3201"/>
<text text-anchor="middle" x="7170" y="-3151.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-3136.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="7170" y="-3121.8" font-family="Times,serif" font-size="14.00">Q[8]×K[1]×V[1]</text>
<text text-anchor="middle" x="7170" y="-3106.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_7_stage_7&#45;&gt;ring_attn_3_8_stage_7 -->
<g id="edge2521" class="edge">
<title>ring_attn_3_7_stage_7&#45;&gt;ring_attn_3_8_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-3133C6792.02,-3133 6950.86,-3133 6950.86,-3133"/>
<polygon fill="red" stroke="red" points="6950.86,-3136.5 6960.86,-3133 6950.86,-3129.5 6950.86,-3136.5"/>
</g>
<!-- ring_attn_3_7_stage_8&#45;&gt;ring_attn_3_7_stage_9 -->
<g id="edge763" class="edge">
<title>ring_attn_3_7_stage_8&#45;&gt;ring_attn_3_7_stage_9</title>
<path fill="none" stroke="black" d="M6583,-2811.87C6583,-2811.87 6583,-2705.25 6583,-2705.25"/>
<polygon fill="black" stroke="black" points="6586.5,-2705.25 6583,-2695.25 6579.5,-2705.25 6586.5,-2705.25"/>
</g>
<!-- ring_attn_3_8_stage_8 -->
<g id="node868" class="node">
<title>ring_attn_3_8_stage_8</title>
<polygon fill="yellow" stroke="black" points="7170,-2948 6961,-2880 7170,-2812 7379,-2880 7170,-2948"/>
<text text-anchor="middle" x="7170" y="-2898.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-2883.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="7170" y="-2868.8" font-family="Times,serif" font-size="14.00">Q[8]×K[0]×V[0]</text>
<text text-anchor="middle" x="7170" y="-2853.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_7_stage_8&#45;&gt;ring_attn_3_8_stage_8 -->
<g id="edge2522" class="edge">
<title>ring_attn_3_7_stage_8&#45;&gt;ring_attn_3_8_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-2880C6792.02,-2880 6950.86,-2880 6950.86,-2880"/>
<polygon fill="red" stroke="red" points="6950.86,-2883.5 6960.86,-2880 6950.86,-2876.5 6950.86,-2883.5"/>
</g>
<!-- ring_attn_3_7_stage_9&#45;&gt;ring_attn_3_7_stage_10 -->
<g id="edge764" class="edge">
<title>ring_attn_3_7_stage_9&#45;&gt;ring_attn_3_7_stage_10</title>
<path fill="none" stroke="black" d="M6583,-2558.87C6583,-2558.87 6583,-2452.25 6583,-2452.25"/>
<polygon fill="black" stroke="black" points="6586.5,-2452.25 6583,-2442.25 6579.5,-2452.25 6586.5,-2452.25"/>
</g>
<!-- ring_attn_3_8_stage_9 -->
<g id="node869" class="node">
<title>ring_attn_3_8_stage_9</title>
<polygon fill="yellow" stroke="black" points="7170,-2695 6961,-2627 7170,-2559 7379,-2627 7170,-2695"/>
<text text-anchor="middle" x="7170" y="-2645.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-2630.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="7170" y="-2615.8" font-family="Times,serif" font-size="14.00">Q[8]×K[15]×V[15]</text>
<text text-anchor="middle" x="7170" y="-2600.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_7_stage_9&#45;&gt;ring_attn_3_8_stage_9 -->
<g id="edge2523" class="edge">
<title>ring_attn_3_7_stage_9&#45;&gt;ring_attn_3_8_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-2627C6792.02,-2627 6950.86,-2627 6950.86,-2627"/>
<polygon fill="red" stroke="red" points="6950.86,-2630.5 6960.86,-2627 6950.86,-2623.5 6950.86,-2630.5"/>
</g>
<!-- ring_attn_3_7_stage_10&#45;&gt;ring_attn_3_7_stage_11 -->
<g id="edge765" class="edge">
<title>ring_attn_3_7_stage_10&#45;&gt;ring_attn_3_7_stage_11</title>
<path fill="none" stroke="black" d="M6583,-2305.87C6583,-2305.87 6583,-2199.25 6583,-2199.25"/>
<polygon fill="black" stroke="black" points="6586.5,-2199.25 6583,-2189.25 6579.5,-2199.25 6586.5,-2199.25"/>
</g>
<!-- ring_attn_3_8_stage_10 -->
<g id="node870" class="node">
<title>ring_attn_3_8_stage_10</title>
<polygon fill="yellow" stroke="black" points="7170,-2442 6961,-2374 7170,-2306 7379,-2374 7170,-2442"/>
<text text-anchor="middle" x="7170" y="-2392.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-2377.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="7170" y="-2362.8" font-family="Times,serif" font-size="14.00">Q[8]×K[14]×V[14]</text>
<text text-anchor="middle" x="7170" y="-2347.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_7_stage_10&#45;&gt;ring_attn_3_8_stage_10 -->
<g id="edge2524" class="edge">
<title>ring_attn_3_7_stage_10&#45;&gt;ring_attn_3_8_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-2374C6792.02,-2374 6950.86,-2374 6950.86,-2374"/>
<polygon fill="red" stroke="red" points="6950.86,-2377.5 6960.86,-2374 6950.86,-2370.5 6950.86,-2377.5"/>
</g>
<!-- ring_attn_3_7_stage_11&#45;&gt;ring_attn_3_7_stage_12 -->
<g id="edge766" class="edge">
<title>ring_attn_3_7_stage_11&#45;&gt;ring_attn_3_7_stage_12</title>
<path fill="none" stroke="black" d="M6583,-2052.87C6583,-2052.87 6583,-1946.25 6583,-1946.25"/>
<polygon fill="black" stroke="black" points="6586.5,-1946.25 6583,-1936.25 6579.5,-1946.25 6586.5,-1946.25"/>
</g>
<!-- ring_attn_3_8_stage_11 -->
<g id="node871" class="node">
<title>ring_attn_3_8_stage_11</title>
<polygon fill="yellow" stroke="black" points="7170,-2189 6961,-2121 7170,-2053 7379,-2121 7170,-2189"/>
<text text-anchor="middle" x="7170" y="-2139.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-2124.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="7170" y="-2109.8" font-family="Times,serif" font-size="14.00">Q[8]×K[13]×V[13]</text>
<text text-anchor="middle" x="7170" y="-2094.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_7_stage_11&#45;&gt;ring_attn_3_8_stage_11 -->
<g id="edge2525" class="edge">
<title>ring_attn_3_7_stage_11&#45;&gt;ring_attn_3_8_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-2121C6792.02,-2121 6950.86,-2121 6950.86,-2121"/>
<polygon fill="red" stroke="red" points="6950.86,-2124.5 6960.86,-2121 6950.86,-2117.5 6950.86,-2124.5"/>
</g>
<!-- ring_attn_3_7_stage_12&#45;&gt;ring_attn_3_7_stage_13 -->
<g id="edge767" class="edge">
<title>ring_attn_3_7_stage_12&#45;&gt;ring_attn_3_7_stage_13</title>
<path fill="none" stroke="black" d="M6583,-1799.87C6583,-1799.87 6583,-1693.25 6583,-1693.25"/>
<polygon fill="black" stroke="black" points="6586.5,-1693.25 6583,-1683.25 6579.5,-1693.25 6586.5,-1693.25"/>
</g>
<!-- ring_attn_3_8_stage_12 -->
<g id="node872" class="node">
<title>ring_attn_3_8_stage_12</title>
<polygon fill="yellow" stroke="black" points="7170,-1936 6961,-1868 7170,-1800 7379,-1868 7170,-1936"/>
<text text-anchor="middle" x="7170" y="-1886.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-1871.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="7170" y="-1856.8" font-family="Times,serif" font-size="14.00">Q[8]×K[12]×V[12]</text>
<text text-anchor="middle" x="7170" y="-1841.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_7_stage_12&#45;&gt;ring_attn_3_8_stage_12 -->
<g id="edge2526" class="edge">
<title>ring_attn_3_7_stage_12&#45;&gt;ring_attn_3_8_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-1868C6792.02,-1868 6950.86,-1868 6950.86,-1868"/>
<polygon fill="red" stroke="red" points="6950.86,-1871.5 6960.86,-1868 6950.86,-1864.5 6950.86,-1871.5"/>
</g>
<!-- ring_attn_3_7_stage_13&#45;&gt;ring_attn_3_7_stage_14 -->
<g id="edge768" class="edge">
<title>ring_attn_3_7_stage_13&#45;&gt;ring_attn_3_7_stage_14</title>
<path fill="none" stroke="black" d="M6583,-1546.87C6583,-1546.87 6583,-1440.25 6583,-1440.25"/>
<polygon fill="black" stroke="black" points="6586.5,-1440.25 6583,-1430.25 6579.5,-1440.25 6586.5,-1440.25"/>
</g>
<!-- ring_attn_3_8_stage_13 -->
<g id="node873" class="node">
<title>ring_attn_3_8_stage_13</title>
<polygon fill="yellow" stroke="black" points="7170,-1683 6961,-1615 7170,-1547 7379,-1615 7170,-1683"/>
<text text-anchor="middle" x="7170" y="-1633.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-1618.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="7170" y="-1603.8" font-family="Times,serif" font-size="14.00">Q[8]×K[11]×V[11]</text>
<text text-anchor="middle" x="7170" y="-1588.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_7_stage_13&#45;&gt;ring_attn_3_8_stage_13 -->
<g id="edge2527" class="edge">
<title>ring_attn_3_7_stage_13&#45;&gt;ring_attn_3_8_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-1615C6792.02,-1615 6950.86,-1615 6950.86,-1615"/>
<polygon fill="red" stroke="red" points="6950.86,-1618.5 6960.86,-1615 6950.86,-1611.5 6950.86,-1618.5"/>
</g>
<!-- ring_attn_3_7_stage_14&#45;&gt;ring_attn_3_7_stage_15 -->
<g id="edge769" class="edge">
<title>ring_attn_3_7_stage_14&#45;&gt;ring_attn_3_7_stage_15</title>
<path fill="none" stroke="black" d="M6583,-1293.87C6583,-1293.87 6583,-1187.25 6583,-1187.25"/>
<polygon fill="black" stroke="black" points="6586.5,-1187.25 6583,-1177.25 6579.5,-1187.25 6586.5,-1187.25"/>
</g>
<!-- ring_attn_3_8_stage_14 -->
<g id="node874" class="node">
<title>ring_attn_3_8_stage_14</title>
<polygon fill="yellow" stroke="black" points="7170,-1430 6961,-1362 7170,-1294 7379,-1362 7170,-1430"/>
<text text-anchor="middle" x="7170" y="-1380.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-1365.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="7170" y="-1350.8" font-family="Times,serif" font-size="14.00">Q[8]×K[10]×V[10]</text>
<text text-anchor="middle" x="7170" y="-1335.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_7_stage_14&#45;&gt;ring_attn_3_8_stage_14 -->
<g id="edge2528" class="edge">
<title>ring_attn_3_7_stage_14&#45;&gt;ring_attn_3_8_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-1362C6792.02,-1362 6950.86,-1362 6950.86,-1362"/>
<polygon fill="red" stroke="red" points="6950.86,-1365.5 6960.86,-1362 6950.86,-1358.5 6950.86,-1365.5"/>
</g>
<!-- attn_out_3_7 -->
<g id="node778" class="node">
<title>attn_out_3_7</title>
<polygon fill="none" stroke="black" points="6652.5,-968 6513.5,-968 6513.5,-915 6652.5,-915 6652.5,-968"/>
<text text-anchor="middle" x="6583" y="-952.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="6583" y="-937.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="6583" y="-922.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_3_7_stage_15&#45;&gt;attn_out_3_7 -->
<g id="edge770" class="edge">
<title>ring_attn_3_7_stage_15&#45;&gt;attn_out_3_7</title>
<path fill="none" stroke="black" d="M6583,-1040.87C6583,-1040.87 6583,-978.18 6583,-978.18"/>
<polygon fill="black" stroke="black" points="6586.5,-978.18 6583,-968.18 6579.5,-978.18 6586.5,-978.18"/>
</g>
<!-- ring_attn_3_8_stage_15 -->
<g id="node875" class="node">
<title>ring_attn_3_8_stage_15</title>
<polygon fill="yellow" stroke="black" points="7170,-1177 6961,-1109 7170,-1041 7379,-1109 7170,-1177"/>
<text text-anchor="middle" x="7170" y="-1127.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7170" y="-1112.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="7170" y="-1097.8" font-family="Times,serif" font-size="14.00">Q[8]×K[9]×V[9]</text>
<text text-anchor="middle" x="7170" y="-1082.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_7_stage_15&#45;&gt;ring_attn_3_8_stage_15 -->
<g id="edge2529" class="edge">
<title>ring_attn_3_7_stage_15&#45;&gt;ring_attn_3_8_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M6792.02,-1109C6792.02,-1109 6950.86,-1109 6950.86,-1109"/>
<polygon fill="red" stroke="red" points="6950.86,-1112.5 6960.86,-1109 6950.86,-1105.5 6950.86,-1112.5"/>
</g>
<!-- attn_residual_3_7 -->
<g id="node779" class="node">
<title>attn_residual_3_7</title>
<ellipse fill="none" stroke="black" cx="6583" cy="-815" rx="105.5" ry="27"/>
<text text-anchor="middle" x="6583" y="-818.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="6583" y="-803.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_3_7&#45;&gt;attn_residual_3_7 -->
<g id="edge771" class="edge">
<title>attn_out_3_7&#45;&gt;attn_residual_3_7</title>
<path fill="none" stroke="black" d="M6583,-914.98C6583,-914.98 6583,-852.36 6583,-852.36"/>
<polygon fill="black" stroke="black" points="6586.5,-852.36 6583,-842.36 6579.5,-852.36 6586.5,-852.36"/>
</g>
<!-- gate_3_7 -->
<g id="node780" class="node">
<title>gate_3_7</title>
<ellipse fill="orange" stroke="black" cx="6583" cy="-677.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="6583" y="-688.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="6583" y="-673.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="6583" y="-658.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_3_7&#45;&gt;gate_3_7 -->
<g id="edge772" class="edge">
<title>attn_residual_3_7&#45;&gt;gate_3_7</title>
<path fill="none" stroke="black" d="M6583,-787.83C6583,-787.83 6583,-725.02 6583,-725.02"/>
<polygon fill="black" stroke="black" points="6586.5,-725.02 6583,-715.02 6579.5,-725.02 6586.5,-725.02"/>
</g>
<!-- gate_3_7&#45;&gt;expert_3_0_0 -->
<g id="edge2530" class="edge">
<title>gate_3_7&#45;&gt;expert_3_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6530.25,-710.29C6530.25,-732.19 6530.25,-757 6530.25,-757 6530.25,-757 334.36,-757 334.36,-757 334.36,-757 334.36,-518.17 334.36,-518.17"/>
<polygon fill="blue" stroke="blue" points="337.86,-518.17 334.36,-508.17 330.86,-518.17 337.86,-518.17"/>
<text text-anchor="middle" x="27266.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27266.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU7→GPU0</text>
<text text-anchor="middle" x="27266.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27266.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_7&#45;&gt;expert_3_1_0 -->
<g id="edge2531" class="edge">
<title>gate_3_7&#45;&gt;expert_3_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6487.55,-661.49C6487.55,-639.33 6487.55,-602 6487.55,-602 6487.55,-602 2993.86,-602 2993.86,-602 2993.86,-602 2993.86,-518.24 2993.86,-518.24"/>
<polygon fill="blue" stroke="blue" points="2997.36,-518.24 2993.86,-508.24 2990.36,-518.24 2997.36,-518.24"/>
<text text-anchor="middle" x="27440.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27440.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU7→GPU1</text>
<text text-anchor="middle" x="27440.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27440.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_7&#45;&gt;expert_3_2_0 -->
<g id="edge2532" class="edge">
<title>gate_3_7&#45;&gt;expert_3_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6507.64,-651.03C6507.64,-618.34 6507.64,-567 6507.64,-567 6507.64,-567 3589.39,-567 3589.39,-567 3589.39,-567 3589.39,-518.08 3589.39,-518.08"/>
<polygon fill="blue" stroke="blue" points="3592.89,-518.08 3589.39,-508.08 3585.89,-518.08 3592.89,-518.08"/>
<text text-anchor="middle" x="27614.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27614.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU7→GPU2</text>
<text text-anchor="middle" x="27614.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27614.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_7&#45;&gt;expert_3_3_0 -->
<g id="edge2533" class="edge">
<title>gate_3_7&#45;&gt;expert_3_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6527.74,-645.48C6527.74,-624.9 6527.74,-602 6527.74,-602 6527.74,-602 4180.14,-602 4180.14,-602 4180.14,-602 4180.14,-518.24 4180.14,-518.24"/>
<polygon fill="blue" stroke="blue" points="4183.64,-518.24 4180.14,-508.24 4176.64,-518.24 4183.64,-518.24"/>
<text text-anchor="middle" x="27788.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27788.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU7→GPU3</text>
<text text-anchor="middle" x="27788.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27788.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_7&#45;&gt;expert_3_4_0 -->
<g id="edge2534" class="edge">
<title>gate_3_7&#45;&gt;expert_3_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6547.83,-641.77C6547.83,-625.58 6547.83,-610 6547.83,-610 6547.83,-610 4776.79,-610 4776.79,-610 4776.79,-610 4776.79,-518.13 4776.79,-518.13"/>
<polygon fill="blue" stroke="blue" points="4780.29,-518.13 4776.79,-508.13 4773.29,-518.13 4780.29,-518.13"/>
<text text-anchor="middle" x="27962.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="27962.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU7→GPU4</text>
<text text-anchor="middle" x="27962.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="27962.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_7&#45;&gt;expert_3_5_0 -->
<g id="edge2535" class="edge">
<title>gate_3_7&#45;&gt;expert_3_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6557.88,-640.77C6557.88,-635.6 6557.88,-632 6557.88,-632 6557.88,-632 5524.62,-632 5524.62,-632 5524.62,-632 5524.62,-518.06 5524.62,-518.06"/>
<polygon fill="blue" stroke="blue" points="5528.13,-518.06 5524.62,-508.06 5521.13,-518.06 5528.13,-518.06"/>
<text text-anchor="middle" x="28136.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="28136.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU7→GPU5</text>
<text text-anchor="middle" x="28136.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="28136.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_7&#45;&gt;expert_3_6_0 -->
<g id="edge2536" class="edge">
<title>gate_3_7&#45;&gt;expert_3_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6483.48,-690C6344.26,-690 6108.25,-690 6108.25,-690 6108.25,-690 6108.25,-518.33 6108.25,-518.33"/>
<polygon fill="blue" stroke="blue" points="6111.75,-518.33 6108.25,-508.33 6104.75,-518.33 6111.75,-518.33"/>
<text text-anchor="middle" x="28310.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="28310.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU7→GPU6</text>
<text text-anchor="middle" x="28310.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="28310.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_7&#45;&gt;expert_3_7_0 -->
<g id="edge773" class="edge">
<title>gate_3_7&#45;&gt;expert_3_7_0</title>
<path fill="none" stroke="black" d="M6567.93,-640.17C6567.93,-640.17 6567.93,-518.01 6567.93,-518.01"/>
<polygon fill="black" stroke="black" points="6571.43,-518.01 6567.93,-508.01 6564.43,-518.01 6571.43,-518.01"/>
</g>
<!-- gate_3_7&#45;&gt;expert_3_8_0 -->
<g id="edge2537" class="edge">
<title>gate_3_7&#45;&gt;expert_3_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6682.65,-665C6822.77,-665 7061.12,-665 7061.12,-665 7061.12,-665 7061.12,-518.18 7061.12,-518.18"/>
<polygon fill="blue" stroke="blue" points="7064.63,-518.18 7061.12,-508.18 7057.63,-518.18 7064.63,-518.18"/>
<text text-anchor="middle" x="28484.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="28484.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU7→GPU8</text>
<text text-anchor="middle" x="28484.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="28484.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_7&#45;&gt;expert_3_9_0 -->
<g id="edge2538" class="edge">
<title>gate_3_7&#45;&gt;expert_3_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6628.21,-643.62C6628.21,-632.06 6628.21,-622 6628.21,-622 6628.21,-622 7644.75,-622 7644.75,-622 7644.75,-622 7644.75,-518.26 7644.75,-518.26"/>
<polygon fill="blue" stroke="blue" points="7648.25,-518.26 7644.75,-508.26 7641.25,-518.26 7648.25,-518.26"/>
<text text-anchor="middle" x="28658.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="28658.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU7→GPU9</text>
<text text-anchor="middle" x="28658.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="28658.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_7&#45;&gt;expert_3_10_0 -->
<g id="edge2539" class="edge">
<title>gate_3_7&#45;&gt;expert_3_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6638.26,-645.29C6638.26,-622.51 6638.26,-596 6638.26,-596 6638.26,-596 8227.7,-596 8227.7,-596 8227.7,-596 8227.7,-518.06 8227.7,-518.06"/>
<polygon fill="blue" stroke="blue" points="8231.2,-518.06 8227.7,-508.06 8224.2,-518.06 8231.2,-518.06"/>
<text text-anchor="middle" x="28832.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="28832.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU7→GPU10</text>
<text text-anchor="middle" x="28832.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="28832.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_7&#45;&gt;expert_3_11_0 -->
<g id="edge2540" class="edge">
<title>gate_3_7&#45;&gt;expert_3_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6648.31,-647.7C6648.31,-621.66 6648.31,-588 6648.31,-588 6648.31,-588 8946.07,-588 8946.07,-588 8946.07,-588 8946.07,-518.1 8946.07,-518.1"/>
<polygon fill="blue" stroke="blue" points="8949.57,-518.1 8946.07,-508.1 8942.57,-518.1 8949.57,-518.1"/>
<text text-anchor="middle" x="29006.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29006.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU7→GPU11</text>
<text text-anchor="middle" x="29006.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29006.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_7&#45;&gt;expert_3_12_0 -->
<g id="edge2541" class="edge">
<title>gate_3_7&#45;&gt;expert_3_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6658.36,-650.96C6658.36,-623.31 6658.36,-584 6658.36,-584 6658.36,-584 9540.93,-584 9540.93,-584 9540.93,-584 9540.93,-518.16 9540.93,-518.16"/>
<polygon fill="blue" stroke="blue" points="9544.43,-518.16 9540.93,-508.16 9537.43,-518.16 9544.43,-518.16"/>
<text text-anchor="middle" x="29180.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29180.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU7→GPU12</text>
<text text-anchor="middle" x="29180.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29180.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_7&#45;&gt;expert_3_13_0 -->
<g id="edge2542" class="edge">
<title>gate_3_7&#45;&gt;expert_3_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6668.4,-655.32C6668.4,-617.6 6668.4,-545 6668.4,-545 6668.4,-545 10134.54,-545 10134.54,-545 10134.54,-545 10134.54,-518.06 10134.54,-518.06"/>
<polygon fill="blue" stroke="blue" points="10138.04,-518.06 10134.54,-508.06 10131.04,-518.06 10138.04,-518.06"/>
<text text-anchor="middle" x="29354.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29354.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU7→GPU13</text>
<text text-anchor="middle" x="29354.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29354.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_7&#45;&gt;expert_3_14_0 -->
<g id="edge2543" class="edge">
<title>gate_3_7&#45;&gt;expert_3_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6678.45,-661.46C6678.45,-625.19 6678.45,-540 6678.45,-540 6678.45,-540 10697.02,-540 10697.02,-540 10697.02,-540 10697.02,-518.01 10697.02,-518.01"/>
<polygon fill="blue" stroke="blue" points="10700.52,-518.01 10697.02,-508.01 10693.52,-518.01 10700.52,-518.01"/>
<text text-anchor="middle" x="29528.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29528.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU7→GPU14</text>
<text text-anchor="middle" x="29528.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29528.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_7&#45;&gt;expert_3_15_0 -->
<g id="edge2544" class="edge">
<title>gate_3_7&#45;&gt;expert_3_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6635.75,-710.12C6635.75,-714.21 6635.75,-717 6635.75,-717 6635.75,-717 11168.44,-717 11168.44,-717 11168.44,-717 11168.44,-518.06 11168.44,-518.06"/>
<polygon fill="blue" stroke="blue" points="11171.94,-518.06 11168.44,-508.06 11164.94,-518.06 11171.94,-518.06"/>
<text text-anchor="middle" x="29702.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29702.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU7→GPU15</text>
<text text-anchor="middle" x="29702.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29702.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_7 -->
<g id="node782" class="node">
<title>expert_reduce_3_7</title>
<ellipse fill="none" stroke="black" cx="6583" cy="-344.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="6583" y="-355.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="6583" y="-340.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="6583" y="-325.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_7_0&#45;&gt;expert_reduce_3_7 -->
<g id="edge774" class="edge">
<title>expert_3_7_0&#45;&gt;expert_reduce_3_7</title>
<path fill="none" stroke="black" d="M6583,-454.76C6583,-454.76 6583,-392.06 6583,-392.06"/>
<polygon fill="black" stroke="black" points="6586.5,-392.06 6583,-382.06 6579.5,-392.06 6586.5,-392.06"/>
</g>
<!-- moe_residual_3_7 -->
<g id="node783" class="node">
<title>moe_residual_3_7</title>
<ellipse fill="none" stroke="black" cx="6583" cy="-207" rx="105.5" ry="27"/>
<text text-anchor="middle" x="6583" y="-210.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="6583" y="-195.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_7&#45;&gt;moe_residual_3_7 -->
<g id="edge775" class="edge">
<title>expert_reduce_3_7&#45;&gt;moe_residual_3_7</title>
<path fill="none" stroke="black" d="M6583,-306.93C6583,-306.93 6583,-244.06 6583,-244.06"/>
<polygon fill="black" stroke="black" points="6586.5,-244.06 6583,-234.06 6579.5,-244.06 6586.5,-244.06"/>
</g>
<!-- output_7 -->
<g id="node784" class="node">
<title>output_7</title>
<polygon fill="lightcoral" stroke="black" points="6676,-107 6490,-107 6490,-69 6676,-69 6676,-107"/>
<text text-anchor="middle" x="6583" y="-91.8" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="6583" y="-76.8" font-family="Times,serif" font-size="14.00">Y[7]: 1024×1024×4096</text>
</g>
<!-- moe_residual_3_7&#45;&gt;output_7 -->
<g id="edge776" class="edge">
<title>moe_residual_3_7&#45;&gt;output_7</title>
<path fill="none" stroke="black" d="M6583,-180C6583,-180 6583,-117.12 6583,-117.12"/>
<polygon fill="black" stroke="black" points="6586.5,-117.12 6583,-107.12 6579.5,-117.12 6586.5,-117.12"/>
</g>
<!-- input_8 -->
<g id="node785" class="node">
<title>input_8</title>
<polygon fill="lightgreen" stroke="black" points="7263.5,-20866 7076.5,-20866 7076.5,-20828 7263.5,-20828 7263.5,-20866"/>
<text text-anchor="middle" x="7170" y="-20850.8" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="7170" y="-20835.8" font-family="Times,serif" font-size="14.00">X[8]: 1024×1024×4096</text>
</g>
<!-- qkv_proj_0_8 -->
<g id="node786" class="node">
<title>qkv_proj_0_8</title>
<polygon fill="none" stroke="black" points="7252.5,-20755 7087.5,-20755 7087.5,-20702 7252.5,-20702 7252.5,-20755"/>
<text text-anchor="middle" x="7170" y="-20739.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="7170" y="-20724.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="7170" y="-20709.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- input_8&#45;&gt;qkv_proj_0_8 -->
<g id="edge777" class="edge">
<title>input_8&#45;&gt;qkv_proj_0_8</title>
<path fill="none" stroke="black" d="M7170,-20827.96C7170,-20827.96 7170,-20765.44 7170,-20765.44"/>
<polygon fill="black" stroke="black" points="7173.5,-20765.44 7170,-20755.44 7166.5,-20765.44 7173.5,-20765.44"/>
</g>
<!-- qkv_reshape_0_8 -->
<g id="node787" class="node">
<title>qkv_reshape_0_8</title>
<ellipse fill="none" stroke="black" cx="7170" cy="-20602" rx="148" ry="27"/>
<text text-anchor="middle" x="7170" y="-20605.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="7170" y="-20590.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_0_8&#45;&gt;qkv_reshape_0_8 -->
<g id="edge778" class="edge">
<title>qkv_proj_0_8&#45;&gt;qkv_reshape_0_8</title>
<path fill="none" stroke="black" d="M7170,-20701.98C7170,-20701.98 7170,-20639.36 7170,-20639.36"/>
<polygon fill="black" stroke="black" points="7173.5,-20639.36 7170,-20629.36 7166.5,-20639.36 7173.5,-20639.36"/>
</g>
<!-- qkv_reshape_0_8&#45;&gt;ring_attn_0_8_stage_0 -->
<g id="edge779" class="edge">
<title>qkv_reshape_0_8&#45;&gt;ring_attn_0_8_stage_0</title>
<path fill="none" stroke="black" d="M7170,-20574.72C7170,-20574.72 7170,-20468.16 7170,-20468.16"/>
<polygon fill="black" stroke="black" points="7173.5,-20468.16 7170,-20458.16 7166.5,-20468.16 7173.5,-20468.16"/>
</g>
<!-- ring_attn_0_8_stage_0&#45;&gt;ring_attn_0_8_stage_1 -->
<g id="edge780" class="edge">
<title>ring_attn_0_8_stage_0&#45;&gt;ring_attn_0_8_stage_1</title>
<path fill="none" stroke="black" d="M7170,-20321.87C7170,-20321.87 7170,-20215.25 7170,-20215.25"/>
<polygon fill="black" stroke="black" points="7173.5,-20215.25 7170,-20205.25 7166.5,-20215.25 7173.5,-20215.25"/>
</g>
<!-- ring_attn_0_9_stage_0 -->
<g id="node886" class="node">
<title>ring_attn_0_9_stage_0</title>
<polygon fill="yellow" stroke="black" points="7757,-20458 7548,-20390 7757,-20322 7966,-20390 7757,-20458"/>
<text text-anchor="middle" x="7757" y="-20408.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-20393.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="7757" y="-20378.8" font-family="Times,serif" font-size="14.00">Q[9]×K[9]×V[9]</text>
<text text-anchor="middle" x="7757" y="-20363.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_8_stage_0&#45;&gt;ring_attn_0_9_stage_0 -->
<g id="edge2545" class="edge">
<title>ring_attn_0_8_stage_0&#45;&gt;ring_attn_0_9_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-20390C7379.02,-20390 7537.86,-20390 7537.86,-20390"/>
<polygon fill="red" stroke="red" points="7537.86,-20393.5 7547.86,-20390 7537.86,-20386.5 7537.86,-20393.5"/>
</g>
<!-- ring_attn_0_8_stage_1&#45;&gt;ring_attn_0_8_stage_2 -->
<g id="edge781" class="edge">
<title>ring_attn_0_8_stage_1&#45;&gt;ring_attn_0_8_stage_2</title>
<path fill="none" stroke="black" d="M7170,-20068.87C7170,-20068.87 7170,-19962.25 7170,-19962.25"/>
<polygon fill="black" stroke="black" points="7173.5,-19962.25 7170,-19952.25 7166.5,-19962.25 7173.5,-19962.25"/>
</g>
<!-- ring_attn_0_9_stage_1 -->
<g id="node887" class="node">
<title>ring_attn_0_9_stage_1</title>
<polygon fill="yellow" stroke="black" points="7757,-20205 7548,-20137 7757,-20069 7966,-20137 7757,-20205"/>
<text text-anchor="middle" x="7757" y="-20155.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-20140.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="7757" y="-20125.8" font-family="Times,serif" font-size="14.00">Q[9]×K[8]×V[8]</text>
<text text-anchor="middle" x="7757" y="-20110.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_8_stage_1&#45;&gt;ring_attn_0_9_stage_1 -->
<g id="edge2546" class="edge">
<title>ring_attn_0_8_stage_1&#45;&gt;ring_attn_0_9_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-20137C7379.02,-20137 7537.86,-20137 7537.86,-20137"/>
<polygon fill="red" stroke="red" points="7537.86,-20140.5 7547.86,-20137 7537.86,-20133.5 7537.86,-20140.5"/>
</g>
<!-- ring_attn_0_8_stage_2&#45;&gt;ring_attn_0_8_stage_3 -->
<g id="edge782" class="edge">
<title>ring_attn_0_8_stage_2&#45;&gt;ring_attn_0_8_stage_3</title>
<path fill="none" stroke="black" d="M7170,-19815.87C7170,-19815.87 7170,-19709.25 7170,-19709.25"/>
<polygon fill="black" stroke="black" points="7173.5,-19709.25 7170,-19699.25 7166.5,-19709.25 7173.5,-19709.25"/>
</g>
<!-- ring_attn_0_9_stage_2 -->
<g id="node888" class="node">
<title>ring_attn_0_9_stage_2</title>
<polygon fill="yellow" stroke="black" points="7757,-19952 7548,-19884 7757,-19816 7966,-19884 7757,-19952"/>
<text text-anchor="middle" x="7757" y="-19902.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-19887.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="7757" y="-19872.8" font-family="Times,serif" font-size="14.00">Q[9]×K[7]×V[7]</text>
<text text-anchor="middle" x="7757" y="-19857.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_8_stage_2&#45;&gt;ring_attn_0_9_stage_2 -->
<g id="edge2547" class="edge">
<title>ring_attn_0_8_stage_2&#45;&gt;ring_attn_0_9_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-19884C7379.02,-19884 7537.86,-19884 7537.86,-19884"/>
<polygon fill="red" stroke="red" points="7537.86,-19887.5 7547.86,-19884 7537.86,-19880.5 7537.86,-19887.5"/>
</g>
<!-- ring_attn_0_8_stage_3&#45;&gt;ring_attn_0_8_stage_4 -->
<g id="edge783" class="edge">
<title>ring_attn_0_8_stage_3&#45;&gt;ring_attn_0_8_stage_4</title>
<path fill="none" stroke="black" d="M7170,-19562.87C7170,-19562.87 7170,-19456.25 7170,-19456.25"/>
<polygon fill="black" stroke="black" points="7173.5,-19456.25 7170,-19446.25 7166.5,-19456.25 7173.5,-19456.25"/>
</g>
<!-- ring_attn_0_9_stage_3 -->
<g id="node889" class="node">
<title>ring_attn_0_9_stage_3</title>
<polygon fill="yellow" stroke="black" points="7757,-19699 7548,-19631 7757,-19563 7966,-19631 7757,-19699"/>
<text text-anchor="middle" x="7757" y="-19649.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-19634.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="7757" y="-19619.8" font-family="Times,serif" font-size="14.00">Q[9]×K[6]×V[6]</text>
<text text-anchor="middle" x="7757" y="-19604.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_8_stage_3&#45;&gt;ring_attn_0_9_stage_3 -->
<g id="edge2548" class="edge">
<title>ring_attn_0_8_stage_3&#45;&gt;ring_attn_0_9_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-19631C7379.02,-19631 7537.86,-19631 7537.86,-19631"/>
<polygon fill="red" stroke="red" points="7537.86,-19634.5 7547.86,-19631 7537.86,-19627.5 7537.86,-19634.5"/>
</g>
<!-- ring_attn_0_8_stage_4&#45;&gt;ring_attn_0_8_stage_5 -->
<g id="edge784" class="edge">
<title>ring_attn_0_8_stage_4&#45;&gt;ring_attn_0_8_stage_5</title>
<path fill="none" stroke="black" d="M7170,-19309.87C7170,-19309.87 7170,-19203.25 7170,-19203.25"/>
<polygon fill="black" stroke="black" points="7173.5,-19203.25 7170,-19193.25 7166.5,-19203.25 7173.5,-19203.25"/>
</g>
<!-- ring_attn_0_9_stage_4 -->
<g id="node890" class="node">
<title>ring_attn_0_9_stage_4</title>
<polygon fill="yellow" stroke="black" points="7757,-19446 7548,-19378 7757,-19310 7966,-19378 7757,-19446"/>
<text text-anchor="middle" x="7757" y="-19396.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-19381.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="7757" y="-19366.8" font-family="Times,serif" font-size="14.00">Q[9]×K[5]×V[5]</text>
<text text-anchor="middle" x="7757" y="-19351.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_8_stage_4&#45;&gt;ring_attn_0_9_stage_4 -->
<g id="edge2549" class="edge">
<title>ring_attn_0_8_stage_4&#45;&gt;ring_attn_0_9_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-19378C7379.02,-19378 7537.86,-19378 7537.86,-19378"/>
<polygon fill="red" stroke="red" points="7537.86,-19381.5 7547.86,-19378 7537.86,-19374.5 7537.86,-19381.5"/>
</g>
<!-- ring_attn_0_8_stage_5&#45;&gt;ring_attn_0_8_stage_6 -->
<g id="edge785" class="edge">
<title>ring_attn_0_8_stage_5&#45;&gt;ring_attn_0_8_stage_6</title>
<path fill="none" stroke="black" d="M7170,-19056.87C7170,-19056.87 7170,-18950.25 7170,-18950.25"/>
<polygon fill="black" stroke="black" points="7173.5,-18950.25 7170,-18940.25 7166.5,-18950.25 7173.5,-18950.25"/>
</g>
<!-- ring_attn_0_9_stage_5 -->
<g id="node891" class="node">
<title>ring_attn_0_9_stage_5</title>
<polygon fill="yellow" stroke="black" points="7757,-19193 7548,-19125 7757,-19057 7966,-19125 7757,-19193"/>
<text text-anchor="middle" x="7757" y="-19143.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-19128.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="7757" y="-19113.8" font-family="Times,serif" font-size="14.00">Q[9]×K[4]×V[4]</text>
<text text-anchor="middle" x="7757" y="-19098.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_8_stage_5&#45;&gt;ring_attn_0_9_stage_5 -->
<g id="edge2550" class="edge">
<title>ring_attn_0_8_stage_5&#45;&gt;ring_attn_0_9_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-19125C7379.02,-19125 7537.86,-19125 7537.86,-19125"/>
<polygon fill="red" stroke="red" points="7537.86,-19128.5 7547.86,-19125 7537.86,-19121.5 7537.86,-19128.5"/>
</g>
<!-- ring_attn_0_8_stage_6&#45;&gt;ring_attn_0_8_stage_7 -->
<g id="edge786" class="edge">
<title>ring_attn_0_8_stage_6&#45;&gt;ring_attn_0_8_stage_7</title>
<path fill="none" stroke="black" d="M7170,-18803.87C7170,-18803.87 7170,-18697.25 7170,-18697.25"/>
<polygon fill="black" stroke="black" points="7173.5,-18697.25 7170,-18687.25 7166.5,-18697.25 7173.5,-18697.25"/>
</g>
<!-- ring_attn_0_9_stage_6 -->
<g id="node892" class="node">
<title>ring_attn_0_9_stage_6</title>
<polygon fill="yellow" stroke="black" points="7757,-18940 7548,-18872 7757,-18804 7966,-18872 7757,-18940"/>
<text text-anchor="middle" x="7757" y="-18890.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-18875.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="7757" y="-18860.8" font-family="Times,serif" font-size="14.00">Q[9]×K[3]×V[3]</text>
<text text-anchor="middle" x="7757" y="-18845.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_8_stage_6&#45;&gt;ring_attn_0_9_stage_6 -->
<g id="edge2551" class="edge">
<title>ring_attn_0_8_stage_6&#45;&gt;ring_attn_0_9_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-18872C7379.02,-18872 7537.86,-18872 7537.86,-18872"/>
<polygon fill="red" stroke="red" points="7537.86,-18875.5 7547.86,-18872 7537.86,-18868.5 7537.86,-18875.5"/>
</g>
<!-- ring_attn_0_8_stage_7&#45;&gt;ring_attn_0_8_stage_8 -->
<g id="edge787" class="edge">
<title>ring_attn_0_8_stage_7&#45;&gt;ring_attn_0_8_stage_8</title>
<path fill="none" stroke="black" d="M7170,-18550.87C7170,-18550.87 7170,-18444.25 7170,-18444.25"/>
<polygon fill="black" stroke="black" points="7173.5,-18444.25 7170,-18434.25 7166.5,-18444.25 7173.5,-18444.25"/>
</g>
<!-- ring_attn_0_9_stage_7 -->
<g id="node893" class="node">
<title>ring_attn_0_9_stage_7</title>
<polygon fill="yellow" stroke="black" points="7757,-18687 7548,-18619 7757,-18551 7966,-18619 7757,-18687"/>
<text text-anchor="middle" x="7757" y="-18637.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-18622.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="7757" y="-18607.8" font-family="Times,serif" font-size="14.00">Q[9]×K[2]×V[2]</text>
<text text-anchor="middle" x="7757" y="-18592.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_8_stage_7&#45;&gt;ring_attn_0_9_stage_7 -->
<g id="edge2552" class="edge">
<title>ring_attn_0_8_stage_7&#45;&gt;ring_attn_0_9_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-18619C7379.02,-18619 7537.86,-18619 7537.86,-18619"/>
<polygon fill="red" stroke="red" points="7537.86,-18622.5 7547.86,-18619 7537.86,-18615.5 7537.86,-18622.5"/>
</g>
<!-- ring_attn_0_8_stage_8&#45;&gt;ring_attn_0_8_stage_9 -->
<g id="edge788" class="edge">
<title>ring_attn_0_8_stage_8&#45;&gt;ring_attn_0_8_stage_9</title>
<path fill="none" stroke="black" d="M7170,-18297.87C7170,-18297.87 7170,-18191.25 7170,-18191.25"/>
<polygon fill="black" stroke="black" points="7173.5,-18191.25 7170,-18181.25 7166.5,-18191.25 7173.5,-18191.25"/>
</g>
<!-- ring_attn_0_9_stage_8 -->
<g id="node894" class="node">
<title>ring_attn_0_9_stage_8</title>
<polygon fill="yellow" stroke="black" points="7757,-18434 7548,-18366 7757,-18298 7966,-18366 7757,-18434"/>
<text text-anchor="middle" x="7757" y="-18384.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-18369.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="7757" y="-18354.8" font-family="Times,serif" font-size="14.00">Q[9]×K[1]×V[1]</text>
<text text-anchor="middle" x="7757" y="-18339.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_8_stage_8&#45;&gt;ring_attn_0_9_stage_8 -->
<g id="edge2553" class="edge">
<title>ring_attn_0_8_stage_8&#45;&gt;ring_attn_0_9_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-18366C7379.02,-18366 7537.86,-18366 7537.86,-18366"/>
<polygon fill="red" stroke="red" points="7537.86,-18369.5 7547.86,-18366 7537.86,-18362.5 7537.86,-18369.5"/>
</g>
<!-- ring_attn_0_8_stage_9&#45;&gt;ring_attn_0_8_stage_10 -->
<g id="edge789" class="edge">
<title>ring_attn_0_8_stage_9&#45;&gt;ring_attn_0_8_stage_10</title>
<path fill="none" stroke="black" d="M7170,-18044.87C7170,-18044.87 7170,-17938.25 7170,-17938.25"/>
<polygon fill="black" stroke="black" points="7173.5,-17938.25 7170,-17928.25 7166.5,-17938.25 7173.5,-17938.25"/>
</g>
<!-- ring_attn_0_9_stage_9 -->
<g id="node895" class="node">
<title>ring_attn_0_9_stage_9</title>
<polygon fill="yellow" stroke="black" points="7757,-18181 7548,-18113 7757,-18045 7966,-18113 7757,-18181"/>
<text text-anchor="middle" x="7757" y="-18131.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-18116.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="7757" y="-18101.8" font-family="Times,serif" font-size="14.00">Q[9]×K[0]×V[0]</text>
<text text-anchor="middle" x="7757" y="-18086.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_8_stage_9&#45;&gt;ring_attn_0_9_stage_9 -->
<g id="edge2554" class="edge">
<title>ring_attn_0_8_stage_9&#45;&gt;ring_attn_0_9_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-18113C7379.02,-18113 7537.86,-18113 7537.86,-18113"/>
<polygon fill="red" stroke="red" points="7537.86,-18116.5 7547.86,-18113 7537.86,-18109.5 7537.86,-18116.5"/>
</g>
<!-- ring_attn_0_8_stage_10&#45;&gt;ring_attn_0_8_stage_11 -->
<g id="edge790" class="edge">
<title>ring_attn_0_8_stage_10&#45;&gt;ring_attn_0_8_stage_11</title>
<path fill="none" stroke="black" d="M7170,-17791.87C7170,-17791.87 7170,-17685.25 7170,-17685.25"/>
<polygon fill="black" stroke="black" points="7173.5,-17685.25 7170,-17675.25 7166.5,-17685.25 7173.5,-17685.25"/>
</g>
<!-- ring_attn_0_9_stage_10 -->
<g id="node896" class="node">
<title>ring_attn_0_9_stage_10</title>
<polygon fill="yellow" stroke="black" points="7757,-17928 7548,-17860 7757,-17792 7966,-17860 7757,-17928"/>
<text text-anchor="middle" x="7757" y="-17878.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-17863.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="7757" y="-17848.8" font-family="Times,serif" font-size="14.00">Q[9]×K[15]×V[15]</text>
<text text-anchor="middle" x="7757" y="-17833.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_8_stage_10&#45;&gt;ring_attn_0_9_stage_10 -->
<g id="edge2555" class="edge">
<title>ring_attn_0_8_stage_10&#45;&gt;ring_attn_0_9_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-17860C7379.02,-17860 7537.86,-17860 7537.86,-17860"/>
<polygon fill="red" stroke="red" points="7537.86,-17863.5 7547.86,-17860 7537.86,-17856.5 7537.86,-17863.5"/>
</g>
<!-- ring_attn_0_8_stage_11&#45;&gt;ring_attn_0_8_stage_12 -->
<g id="edge791" class="edge">
<title>ring_attn_0_8_stage_11&#45;&gt;ring_attn_0_8_stage_12</title>
<path fill="none" stroke="black" d="M7170,-17538.87C7170,-17538.87 7170,-17432.25 7170,-17432.25"/>
<polygon fill="black" stroke="black" points="7173.5,-17432.25 7170,-17422.25 7166.5,-17432.25 7173.5,-17432.25"/>
</g>
<!-- ring_attn_0_9_stage_11 -->
<g id="node897" class="node">
<title>ring_attn_0_9_stage_11</title>
<polygon fill="yellow" stroke="black" points="7757,-17675 7548,-17607 7757,-17539 7966,-17607 7757,-17675"/>
<text text-anchor="middle" x="7757" y="-17625.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-17610.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="7757" y="-17595.8" font-family="Times,serif" font-size="14.00">Q[9]×K[14]×V[14]</text>
<text text-anchor="middle" x="7757" y="-17580.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_8_stage_11&#45;&gt;ring_attn_0_9_stage_11 -->
<g id="edge2556" class="edge">
<title>ring_attn_0_8_stage_11&#45;&gt;ring_attn_0_9_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-17607C7379.02,-17607 7537.86,-17607 7537.86,-17607"/>
<polygon fill="red" stroke="red" points="7537.86,-17610.5 7547.86,-17607 7537.86,-17603.5 7537.86,-17610.5"/>
</g>
<!-- ring_attn_0_8_stage_12&#45;&gt;ring_attn_0_8_stage_13 -->
<g id="edge792" class="edge">
<title>ring_attn_0_8_stage_12&#45;&gt;ring_attn_0_8_stage_13</title>
<path fill="none" stroke="black" d="M7170,-17285.87C7170,-17285.87 7170,-17179.25 7170,-17179.25"/>
<polygon fill="black" stroke="black" points="7173.5,-17179.25 7170,-17169.25 7166.5,-17179.25 7173.5,-17179.25"/>
</g>
<!-- ring_attn_0_9_stage_12 -->
<g id="node898" class="node">
<title>ring_attn_0_9_stage_12</title>
<polygon fill="yellow" stroke="black" points="7757,-17422 7548,-17354 7757,-17286 7966,-17354 7757,-17422"/>
<text text-anchor="middle" x="7757" y="-17372.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-17357.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="7757" y="-17342.8" font-family="Times,serif" font-size="14.00">Q[9]×K[13]×V[13]</text>
<text text-anchor="middle" x="7757" y="-17327.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_8_stage_12&#45;&gt;ring_attn_0_9_stage_12 -->
<g id="edge2557" class="edge">
<title>ring_attn_0_8_stage_12&#45;&gt;ring_attn_0_9_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-17354C7379.02,-17354 7537.86,-17354 7537.86,-17354"/>
<polygon fill="red" stroke="red" points="7537.86,-17357.5 7547.86,-17354 7537.86,-17350.5 7537.86,-17357.5"/>
</g>
<!-- ring_attn_0_8_stage_13&#45;&gt;ring_attn_0_8_stage_14 -->
<g id="edge793" class="edge">
<title>ring_attn_0_8_stage_13&#45;&gt;ring_attn_0_8_stage_14</title>
<path fill="none" stroke="black" d="M7170,-17032.87C7170,-17032.87 7170,-16926.25 7170,-16926.25"/>
<polygon fill="black" stroke="black" points="7173.5,-16926.25 7170,-16916.25 7166.5,-16926.25 7173.5,-16926.25"/>
</g>
<!-- ring_attn_0_9_stage_13 -->
<g id="node899" class="node">
<title>ring_attn_0_9_stage_13</title>
<polygon fill="yellow" stroke="black" points="7757,-17169 7548,-17101 7757,-17033 7966,-17101 7757,-17169"/>
<text text-anchor="middle" x="7757" y="-17119.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-17104.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="7757" y="-17089.8" font-family="Times,serif" font-size="14.00">Q[9]×K[12]×V[12]</text>
<text text-anchor="middle" x="7757" y="-17074.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_8_stage_13&#45;&gt;ring_attn_0_9_stage_13 -->
<g id="edge2558" class="edge">
<title>ring_attn_0_8_stage_13&#45;&gt;ring_attn_0_9_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-17101C7379.02,-17101 7537.86,-17101 7537.86,-17101"/>
<polygon fill="red" stroke="red" points="7537.86,-17104.5 7547.86,-17101 7537.86,-17097.5 7537.86,-17104.5"/>
</g>
<!-- ring_attn_0_8_stage_14&#45;&gt;ring_attn_0_8_stage_15 -->
<g id="edge794" class="edge">
<title>ring_attn_0_8_stage_14&#45;&gt;ring_attn_0_8_stage_15</title>
<path fill="none" stroke="black" d="M7170,-16779.87C7170,-16779.87 7170,-16673.25 7170,-16673.25"/>
<polygon fill="black" stroke="black" points="7173.5,-16673.25 7170,-16663.25 7166.5,-16673.25 7173.5,-16673.25"/>
</g>
<!-- ring_attn_0_9_stage_14 -->
<g id="node900" class="node">
<title>ring_attn_0_9_stage_14</title>
<polygon fill="yellow" stroke="black" points="7757,-16916 7548,-16848 7757,-16780 7966,-16848 7757,-16916"/>
<text text-anchor="middle" x="7757" y="-16866.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-16851.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="7757" y="-16836.8" font-family="Times,serif" font-size="14.00">Q[9]×K[11]×V[11]</text>
<text text-anchor="middle" x="7757" y="-16821.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_8_stage_14&#45;&gt;ring_attn_0_9_stage_14 -->
<g id="edge2559" class="edge">
<title>ring_attn_0_8_stage_14&#45;&gt;ring_attn_0_9_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-16848C7379.02,-16848 7537.86,-16848 7537.86,-16848"/>
<polygon fill="red" stroke="red" points="7537.86,-16851.5 7547.86,-16848 7537.86,-16844.5 7537.86,-16851.5"/>
</g>
<!-- attn_out_0_8 -->
<g id="node804" class="node">
<title>attn_out_0_8</title>
<polygon fill="none" stroke="black" points="7239.5,-16454 7100.5,-16454 7100.5,-16401 7239.5,-16401 7239.5,-16454"/>
<text text-anchor="middle" x="7170" y="-16438.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="7170" y="-16423.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="7170" y="-16408.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_0_8_stage_15&#45;&gt;attn_out_0_8 -->
<g id="edge795" class="edge">
<title>ring_attn_0_8_stage_15&#45;&gt;attn_out_0_8</title>
<path fill="none" stroke="black" d="M7170,-16526.87C7170,-16526.87 7170,-16464.18 7170,-16464.18"/>
<polygon fill="black" stroke="black" points="7173.5,-16464.18 7170,-16454.18 7166.5,-16464.18 7173.5,-16464.18"/>
</g>
<!-- ring_attn_0_9_stage_15 -->
<g id="node901" class="node">
<title>ring_attn_0_9_stage_15</title>
<polygon fill="yellow" stroke="black" points="7757,-16663 7548,-16595 7757,-16527 7966,-16595 7757,-16663"/>
<text text-anchor="middle" x="7757" y="-16613.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-16598.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="7757" y="-16583.8" font-family="Times,serif" font-size="14.00">Q[9]×K[10]×V[10]</text>
<text text-anchor="middle" x="7757" y="-16568.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_8_stage_15&#45;&gt;ring_attn_0_9_stage_15 -->
<g id="edge2560" class="edge">
<title>ring_attn_0_8_stage_15&#45;&gt;ring_attn_0_9_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-16595C7379.02,-16595 7537.86,-16595 7537.86,-16595"/>
<polygon fill="red" stroke="red" points="7537.86,-16598.5 7547.86,-16595 7537.86,-16591.5 7537.86,-16598.5"/>
</g>
<!-- attn_residual_0_8 -->
<g id="node805" class="node">
<title>attn_residual_0_8</title>
<ellipse fill="none" stroke="black" cx="7170" cy="-16301" rx="105.5" ry="27"/>
<text text-anchor="middle" x="7170" y="-16304.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="7170" y="-16289.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_0_8&#45;&gt;attn_residual_0_8 -->
<g id="edge796" class="edge">
<title>attn_out_0_8&#45;&gt;attn_residual_0_8</title>
<path fill="none" stroke="black" d="M7170,-16400.98C7170,-16400.98 7170,-16338.36 7170,-16338.36"/>
<polygon fill="black" stroke="black" points="7173.5,-16338.36 7170,-16328.36 7166.5,-16338.36 7173.5,-16338.36"/>
</g>
<!-- gate_0_8 -->
<g id="node806" class="node">
<title>gate_0_8</title>
<ellipse fill="orange" stroke="black" cx="7170" cy="-16163.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="7170" y="-16174.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="7170" y="-16159.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="7170" y="-16144.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_0_8&#45;&gt;gate_0_8 -->
<g id="edge797" class="edge">
<title>attn_residual_0_8&#45;&gt;gate_0_8</title>
<path fill="none" stroke="black" d="M7205.17,-16275.46C7205.17,-16275.46 7205.17,-16209.01 7205.17,-16209.01"/>
<polygon fill="black" stroke="black" points="7208.67,-16209.01 7205.17,-16199.01 7201.67,-16209.01 7208.67,-16209.01"/>
</g>
<!-- gate_0_8&#45;&gt;expert_0_0_0 -->
<g id="edge2561" class="edge">
<title>gate_0_8&#45;&gt;expert_0_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7134.83,-16198.99C7134.83,-16223.61 7134.83,-16252 7134.83,-16252 7134.83,-16252 332.43,-16252 332.43,-16252 332.43,-16252 332.43,-16004.01 332.43,-16004.01"/>
<polygon fill="blue" stroke="blue" points="335.93,-16004.01 332.43,-15994.01 328.93,-16004.01 335.93,-16004.01"/>
<text text-anchor="middle" x="29876.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29876.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU8→GPU0</text>
<text text-anchor="middle" x="29876.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29876.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_8&#45;&gt;expert_0_1_0 -->
<g id="edge2562" class="edge">
<title>gate_0_8&#45;&gt;expert_0_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7073.67,-16148.14C7073.67,-16116.29 7073.67,-16046 7073.67,-16046 7073.67,-16046 3003.45,-16046 3003.45,-16046 3003.45,-16046 3003.45,-16004.08 3003.45,-16004.08"/>
<polygon fill="blue" stroke="blue" points="3006.95,-16004.08 3003.45,-15994.08 2999.95,-16004.08 3006.95,-16004.08"/>
<text text-anchor="middle" x="30050.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30050.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU8→GPU1</text>
<text text-anchor="middle" x="30050.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30050.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_8&#45;&gt;expert_0_2_0 -->
<g id="edge2563" class="edge">
<title>gate_0_8&#45;&gt;expert_0_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7092.02,-16138.08C7092.02,-16103.26 7092.02,-16045 7092.02,-16045 7092.02,-16045 3597.2,-16045 3597.2,-16045 3597.2,-16045 3597.2,-16004.17 3597.2,-16004.17"/>
<polygon fill="blue" stroke="blue" points="3600.7,-16004.17 3597.2,-15994.17 3593.7,-16004.17 3600.7,-16004.17"/>
<text text-anchor="middle" x="30224.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30224.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU8→GPU2</text>
<text text-anchor="middle" x="30224.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30224.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_8&#45;&gt;expert_0_3_0 -->
<g id="edge2564" class="edge">
<title>gate_0_8&#45;&gt;expert_0_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7110.37,-16132.43C7110.37,-16099.74 7110.37,-16053 7110.37,-16053 7110.37,-16053 4188.58,-16053 4188.58,-16053 4188.58,-16053 4188.58,-16004.08 4188.58,-16004.08"/>
<polygon fill="blue" stroke="blue" points="4192.08,-16004.08 4188.58,-15994.08 4185.08,-16004.08 4192.08,-16004.08"/>
<text text-anchor="middle" x="30398.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30398.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU8→GPU3</text>
<text text-anchor="middle" x="30398.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30398.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_8&#45;&gt;expert_0_4_0 -->
<g id="edge2565" class="edge">
<title>gate_0_8&#45;&gt;expert_0_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7128.72,-16128.86C7128.72,-16107.44 7128.72,-16084 7128.72,-16084 7128.72,-16084 4786.83,-16084 4786.83,-16084 4786.83,-16084 4786.83,-16004.23 4786.83,-16004.23"/>
<polygon fill="blue" stroke="blue" points="4790.33,-16004.23 4786.83,-15994.23 4783.33,-16004.23 4790.33,-16004.23"/>
<text text-anchor="middle" x="30572.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30572.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU8→GPU4</text>
<text text-anchor="middle" x="30572.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30572.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_8&#45;&gt;expert_0_5_0 -->
<g id="edge2566" class="edge">
<title>gate_0_8&#45;&gt;expert_0_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7147.07,-16126.83C7147.07,-16108.84 7147.07,-16091 7147.07,-16091 7147.07,-16091 5383.88,-16091 5383.88,-16091 5383.88,-16091 5383.88,-16004.3 5383.88,-16004.3"/>
<polygon fill="blue" stroke="blue" points="5387.38,-16004.3 5383.88,-15994.3 5380.38,-16004.3 5387.38,-16004.3"/>
<text text-anchor="middle" x="30746.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30746.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU8→GPU5</text>
<text text-anchor="middle" x="30746.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30746.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_8&#45;&gt;expert_0_6_0 -->
<g id="edge2567" class="edge">
<title>gate_0_8&#45;&gt;expert_0_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7156.24,-16125.97C7156.24,-16120.68 7156.24,-16117 7156.24,-16117 7156.24,-16117 6111.62,-16117 6111.62,-16117 6111.62,-16117 6111.62,-16004.23 6111.62,-16004.23"/>
<polygon fill="blue" stroke="blue" points="6115.13,-16004.23 6111.62,-15994.23 6108.13,-16004.23 6115.13,-16004.23"/>
<text text-anchor="middle" x="30920.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30920.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU8→GPU6</text>
<text text-anchor="middle" x="30920.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30920.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_8&#45;&gt;expert_0_7_0 -->
<g id="edge2568" class="edge">
<title>gate_0_8&#45;&gt;expert_0_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7070.48,-16176C6931.26,-16176 6695.25,-16176 6695.25,-16176 6695.25,-16176 6695.25,-16004.33 6695.25,-16004.33"/>
<polygon fill="blue" stroke="blue" points="6698.75,-16004.33 6695.25,-15994.33 6691.75,-16004.33 6698.75,-16004.33"/>
<text text-anchor="middle" x="31094.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31094.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU8→GPU7</text>
<text text-anchor="middle" x="31094.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31094.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_8&#45;&gt;expert_0_8_0 -->
<g id="edge798" class="edge">
<title>gate_0_8&#45;&gt;expert_0_8_0</title>
<path fill="none" stroke="black" d="M7165.41,-16125.71C7165.41,-16125.71 7165.41,-16004.18 7165.41,-16004.18"/>
<polygon fill="black" stroke="black" points="7168.91,-16004.18 7165.41,-15994.18 7161.91,-16004.18 7168.91,-16004.18"/>
</g>
<!-- gate_0_8&#45;&gt;expert_0_9_0 -->
<g id="edge2569" class="edge">
<title>gate_0_8&#45;&gt;expert_0_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7269.65,-16151C7409.77,-16151 7648.12,-16151 7648.12,-16151 7648.12,-16151 7648.12,-16004.18 7648.12,-16004.18"/>
<polygon fill="blue" stroke="blue" points="7651.63,-16004.18 7648.12,-15994.18 7644.63,-16004.18 7651.63,-16004.18"/>
<text text-anchor="middle" x="31268.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31268.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU8→GPU9</text>
<text text-anchor="middle" x="31268.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31268.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_8&#45;&gt;expert_0_10_0 -->
<g id="edge2570" class="edge">
<title>gate_0_8&#45;&gt;expert_0_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7220.46,-16130.54C7220.46,-16119.06 7220.46,-16109 7220.46,-16109 7220.46,-16109 8230.4,-16109 8230.4,-16109 8230.4,-16109 8230.4,-16004.12 8230.4,-16004.12"/>
<polygon fill="blue" stroke="blue" points="8233.9,-16004.12 8230.4,-15994.12 8226.9,-16004.12 8233.9,-16004.12"/>
<text text-anchor="middle" x="31442.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31442.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU8→GPU10</text>
<text text-anchor="middle" x="31442.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31442.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_8&#45;&gt;expert_0_11_0 -->
<g id="edge2571" class="edge">
<title>gate_0_8&#45;&gt;expert_0_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7229.63,-16132.52C7229.63,-16108.4 7229.63,-16079 7229.63,-16079 7229.63,-16079 8815.38,-16079 8815.38,-16079 8815.38,-16079 8815.38,-16004.21 8815.38,-16004.21"/>
<polygon fill="blue" stroke="blue" points="8818.88,-16004.21 8815.38,-15994.21 8811.88,-16004.21 8818.88,-16004.21"/>
<text text-anchor="middle" x="31616.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31616.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU8→GPU11</text>
<text text-anchor="middle" x="31616.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31616.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_8&#45;&gt;expert_0_12_0 -->
<g id="edge2572" class="edge">
<title>gate_0_8&#45;&gt;expert_0_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7238.8,-16134.99C7238.8,-16107.81 7238.8,-16071 7238.8,-16071 7238.8,-16071 9559.28,-16071 9559.28,-16071 9559.28,-16071 9559.28,-16004.15 9559.28,-16004.15"/>
<polygon fill="blue" stroke="blue" points="9562.78,-16004.15 9559.28,-15994.15 9555.78,-16004.15 9562.78,-16004.15"/>
<text text-anchor="middle" x="31790.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31790.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU8→GPU12</text>
<text text-anchor="middle" x="31790.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31790.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_8&#45;&gt;expert_0_13_0 -->
<g id="edge2573" class="edge">
<title>gate_0_8&#45;&gt;expert_0_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7247.98,-16138.14C7247.98,-16109.25 7247.98,-16066 7247.98,-16066 7247.98,-16066 10151.42,-16066 10151.42,-16066 10151.42,-16066 10151.42,-16004.16 10151.42,-16004.16"/>
<polygon fill="blue" stroke="blue" points="10154.92,-16004.16 10151.42,-15994.16 10147.92,-16004.16 10154.92,-16004.16"/>
<text text-anchor="middle" x="31964.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31964.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU8→GPU13</text>
<text text-anchor="middle" x="31964.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31964.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_8&#45;&gt;expert_0_14_0 -->
<g id="edge2574" class="edge">
<title>gate_0_8&#45;&gt;expert_0_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7257.15,-16142.17C7257.15,-16103.78 7257.15,-16027 7257.15,-16027 7257.15,-16027 10717.12,-16027 10717.12,-16027 10717.12,-16027 10717.12,-16004.12 10717.12,-16004.12"/>
<polygon fill="blue" stroke="blue" points="10720.62,-16004.12 10717.12,-15994.12 10713.62,-16004.12 10720.62,-16004.12"/>
<text text-anchor="middle" x="32138.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="32138.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU8→GPU14</text>
<text text-anchor="middle" x="32138.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="32138.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_8&#45;&gt;expert_0_15_0 -->
<g id="edge2575" class="edge">
<title>gate_0_8&#45;&gt;expert_0_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7266.33,-16147.79C7266.33,-16115.99 7266.33,-16047 7266.33,-16047 7266.33,-16047 11284.55,-16047 11284.55,-16047 11284.55,-16047 11284.55,-16004.42 11284.55,-16004.42"/>
<polygon fill="blue" stroke="blue" points="11288.05,-16004.42 11284.55,-15994.42 11281.05,-16004.42 11288.05,-16004.42"/>
<text text-anchor="middle" x="32312.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="32312.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU8→GPU15</text>
<text text-anchor="middle" x="32312.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="32312.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_8 -->
<g id="node808" class="node">
<title>expert_reduce_0_8</title>
<ellipse fill="none" stroke="black" cx="7170" cy="-15830.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="7170" y="-15841.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="7170" y="-15826.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="7170" y="-15811.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_8_0&#45;&gt;expert_reduce_0_8 -->
<g id="edge799" class="edge">
<title>expert_0_8_0&#45;&gt;expert_reduce_0_8</title>
<path fill="none" stroke="black" d="M7170,-15940.76C7170,-15940.76 7170,-15878.06 7170,-15878.06"/>
<polygon fill="black" stroke="black" points="7173.5,-15878.06 7170,-15868.06 7166.5,-15878.06 7173.5,-15878.06"/>
</g>
<!-- moe_residual_0_8 -->
<g id="node809" class="node">
<title>moe_residual_0_8</title>
<ellipse fill="none" stroke="black" cx="7170" cy="-15693" rx="105.5" ry="27"/>
<text text-anchor="middle" x="7170" y="-15696.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="7170" y="-15681.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_8&#45;&gt;moe_residual_0_8 -->
<g id="edge800" class="edge">
<title>expert_reduce_0_8&#45;&gt;moe_residual_0_8</title>
<path fill="none" stroke="black" d="M7170,-15792.93C7170,-15792.93 7170,-15730.06 7170,-15730.06"/>
<polygon fill="black" stroke="black" points="7173.5,-15730.06 7170,-15720.06 7166.5,-15730.06 7173.5,-15730.06"/>
</g>
<!-- qkv_proj_1_8 -->
<g id="node810" class="node">
<title>qkv_proj_1_8</title>
<polygon fill="none" stroke="black" points="7252.5,-15593 7087.5,-15593 7087.5,-15540 7252.5,-15540 7252.5,-15593"/>
<text text-anchor="middle" x="7170" y="-15577.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="7170" y="-15562.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="7170" y="-15547.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_0_8&#45;&gt;qkv_proj_1_8 -->
<g id="edge801" class="edge">
<title>moe_residual_0_8&#45;&gt;qkv_proj_1_8</title>
<path fill="none" stroke="black" d="M7170,-15665.86C7170,-15665.86 7170,-15603.16 7170,-15603.16"/>
<polygon fill="black" stroke="black" points="7173.5,-15603.16 7170,-15593.16 7166.5,-15603.16 7173.5,-15603.16"/>
</g>
<!-- qkv_reshape_1_8 -->
<g id="node811" class="node">
<title>qkv_reshape_1_8</title>
<ellipse fill="none" stroke="black" cx="7170" cy="-15440" rx="148" ry="27"/>
<text text-anchor="middle" x="7170" y="-15443.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="7170" y="-15428.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_1_8&#45;&gt;qkv_reshape_1_8 -->
<g id="edge802" class="edge">
<title>qkv_proj_1_8&#45;&gt;qkv_reshape_1_8</title>
<path fill="none" stroke="black" d="M7170,-15539.98C7170,-15539.98 7170,-15477.36 7170,-15477.36"/>
<polygon fill="black" stroke="black" points="7173.5,-15477.36 7170,-15467.36 7166.5,-15477.36 7173.5,-15477.36"/>
</g>
<!-- qkv_reshape_1_8&#45;&gt;ring_attn_1_8_stage_0 -->
<g id="edge803" class="edge">
<title>qkv_reshape_1_8&#45;&gt;ring_attn_1_8_stage_0</title>
<path fill="none" stroke="black" d="M7170,-15412.72C7170,-15412.72 7170,-15306.16 7170,-15306.16"/>
<polygon fill="black" stroke="black" points="7173.5,-15306.16 7170,-15296.16 7166.5,-15306.16 7173.5,-15306.16"/>
</g>
<!-- ring_attn_1_8_stage_0&#45;&gt;ring_attn_1_8_stage_1 -->
<g id="edge804" class="edge">
<title>ring_attn_1_8_stage_0&#45;&gt;ring_attn_1_8_stage_1</title>
<path fill="none" stroke="black" d="M7170,-15159.87C7170,-15159.87 7170,-15053.25 7170,-15053.25"/>
<polygon fill="black" stroke="black" points="7173.5,-15053.25 7170,-15043.25 7166.5,-15053.25 7173.5,-15053.25"/>
</g>
<!-- ring_attn_1_9_stage_0 -->
<g id="node910" class="node">
<title>ring_attn_1_9_stage_0</title>
<polygon fill="yellow" stroke="black" points="7757,-15296 7548,-15228 7757,-15160 7966,-15228 7757,-15296"/>
<text text-anchor="middle" x="7757" y="-15246.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-15231.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="7757" y="-15216.8" font-family="Times,serif" font-size="14.00">Q[9]×K[9]×V[9]</text>
<text text-anchor="middle" x="7757" y="-15201.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_8_stage_0&#45;&gt;ring_attn_1_9_stage_0 -->
<g id="edge2576" class="edge">
<title>ring_attn_1_8_stage_0&#45;&gt;ring_attn_1_9_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-15228C7379.02,-15228 7537.86,-15228 7537.86,-15228"/>
<polygon fill="red" stroke="red" points="7537.86,-15231.5 7547.86,-15228 7537.86,-15224.5 7537.86,-15231.5"/>
</g>
<!-- ring_attn_1_8_stage_1&#45;&gt;ring_attn_1_8_stage_2 -->
<g id="edge805" class="edge">
<title>ring_attn_1_8_stage_1&#45;&gt;ring_attn_1_8_stage_2</title>
<path fill="none" stroke="black" d="M7170,-14906.87C7170,-14906.87 7170,-14800.25 7170,-14800.25"/>
<polygon fill="black" stroke="black" points="7173.5,-14800.25 7170,-14790.25 7166.5,-14800.25 7173.5,-14800.25"/>
</g>
<!-- ring_attn_1_9_stage_1 -->
<g id="node911" class="node">
<title>ring_attn_1_9_stage_1</title>
<polygon fill="yellow" stroke="black" points="7757,-15043 7548,-14975 7757,-14907 7966,-14975 7757,-15043"/>
<text text-anchor="middle" x="7757" y="-14993.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-14978.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="7757" y="-14963.8" font-family="Times,serif" font-size="14.00">Q[9]×K[8]×V[8]</text>
<text text-anchor="middle" x="7757" y="-14948.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_8_stage_1&#45;&gt;ring_attn_1_9_stage_1 -->
<g id="edge2577" class="edge">
<title>ring_attn_1_8_stage_1&#45;&gt;ring_attn_1_9_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-14975C7379.02,-14975 7537.86,-14975 7537.86,-14975"/>
<polygon fill="red" stroke="red" points="7537.86,-14978.5 7547.86,-14975 7537.86,-14971.5 7537.86,-14978.5"/>
</g>
<!-- ring_attn_1_8_stage_2&#45;&gt;ring_attn_1_8_stage_3 -->
<g id="edge806" class="edge">
<title>ring_attn_1_8_stage_2&#45;&gt;ring_attn_1_8_stage_3</title>
<path fill="none" stroke="black" d="M7170,-14653.87C7170,-14653.87 7170,-14547.25 7170,-14547.25"/>
<polygon fill="black" stroke="black" points="7173.5,-14547.25 7170,-14537.25 7166.5,-14547.25 7173.5,-14547.25"/>
</g>
<!-- ring_attn_1_9_stage_2 -->
<g id="node912" class="node">
<title>ring_attn_1_9_stage_2</title>
<polygon fill="yellow" stroke="black" points="7757,-14790 7548,-14722 7757,-14654 7966,-14722 7757,-14790"/>
<text text-anchor="middle" x="7757" y="-14740.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-14725.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="7757" y="-14710.8" font-family="Times,serif" font-size="14.00">Q[9]×K[7]×V[7]</text>
<text text-anchor="middle" x="7757" y="-14695.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_8_stage_2&#45;&gt;ring_attn_1_9_stage_2 -->
<g id="edge2578" class="edge">
<title>ring_attn_1_8_stage_2&#45;&gt;ring_attn_1_9_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-14722C7379.02,-14722 7537.86,-14722 7537.86,-14722"/>
<polygon fill="red" stroke="red" points="7537.86,-14725.5 7547.86,-14722 7537.86,-14718.5 7537.86,-14725.5"/>
</g>
<!-- ring_attn_1_8_stage_3&#45;&gt;ring_attn_1_8_stage_4 -->
<g id="edge807" class="edge">
<title>ring_attn_1_8_stage_3&#45;&gt;ring_attn_1_8_stage_4</title>
<path fill="none" stroke="black" d="M7170,-14400.87C7170,-14400.87 7170,-14294.25 7170,-14294.25"/>
<polygon fill="black" stroke="black" points="7173.5,-14294.25 7170,-14284.25 7166.5,-14294.25 7173.5,-14294.25"/>
</g>
<!-- ring_attn_1_9_stage_3 -->
<g id="node913" class="node">
<title>ring_attn_1_9_stage_3</title>
<polygon fill="yellow" stroke="black" points="7757,-14537 7548,-14469 7757,-14401 7966,-14469 7757,-14537"/>
<text text-anchor="middle" x="7757" y="-14487.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-14472.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="7757" y="-14457.8" font-family="Times,serif" font-size="14.00">Q[9]×K[6]×V[6]</text>
<text text-anchor="middle" x="7757" y="-14442.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_8_stage_3&#45;&gt;ring_attn_1_9_stage_3 -->
<g id="edge2579" class="edge">
<title>ring_attn_1_8_stage_3&#45;&gt;ring_attn_1_9_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-14469C7379.02,-14469 7537.86,-14469 7537.86,-14469"/>
<polygon fill="red" stroke="red" points="7537.86,-14472.5 7547.86,-14469 7537.86,-14465.5 7537.86,-14472.5"/>
</g>
<!-- ring_attn_1_8_stage_4&#45;&gt;ring_attn_1_8_stage_5 -->
<g id="edge808" class="edge">
<title>ring_attn_1_8_stage_4&#45;&gt;ring_attn_1_8_stage_5</title>
<path fill="none" stroke="black" d="M7170,-14147.87C7170,-14147.87 7170,-14041.25 7170,-14041.25"/>
<polygon fill="black" stroke="black" points="7173.5,-14041.25 7170,-14031.25 7166.5,-14041.25 7173.5,-14041.25"/>
</g>
<!-- ring_attn_1_9_stage_4 -->
<g id="node914" class="node">
<title>ring_attn_1_9_stage_4</title>
<polygon fill="yellow" stroke="black" points="7757,-14284 7548,-14216 7757,-14148 7966,-14216 7757,-14284"/>
<text text-anchor="middle" x="7757" y="-14234.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-14219.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="7757" y="-14204.8" font-family="Times,serif" font-size="14.00">Q[9]×K[5]×V[5]</text>
<text text-anchor="middle" x="7757" y="-14189.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_8_stage_4&#45;&gt;ring_attn_1_9_stage_4 -->
<g id="edge2580" class="edge">
<title>ring_attn_1_8_stage_4&#45;&gt;ring_attn_1_9_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-14216C7379.02,-14216 7537.86,-14216 7537.86,-14216"/>
<polygon fill="red" stroke="red" points="7537.86,-14219.5 7547.86,-14216 7537.86,-14212.5 7537.86,-14219.5"/>
</g>
<!-- ring_attn_1_8_stage_5&#45;&gt;ring_attn_1_8_stage_6 -->
<g id="edge809" class="edge">
<title>ring_attn_1_8_stage_5&#45;&gt;ring_attn_1_8_stage_6</title>
<path fill="none" stroke="black" d="M7170,-13894.87C7170,-13894.87 7170,-13788.25 7170,-13788.25"/>
<polygon fill="black" stroke="black" points="7173.5,-13788.25 7170,-13778.25 7166.5,-13788.25 7173.5,-13788.25"/>
</g>
<!-- ring_attn_1_9_stage_5 -->
<g id="node915" class="node">
<title>ring_attn_1_9_stage_5</title>
<polygon fill="yellow" stroke="black" points="7757,-14031 7548,-13963 7757,-13895 7966,-13963 7757,-14031"/>
<text text-anchor="middle" x="7757" y="-13981.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-13966.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="7757" y="-13951.8" font-family="Times,serif" font-size="14.00">Q[9]×K[4]×V[4]</text>
<text text-anchor="middle" x="7757" y="-13936.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_8_stage_5&#45;&gt;ring_attn_1_9_stage_5 -->
<g id="edge2581" class="edge">
<title>ring_attn_1_8_stage_5&#45;&gt;ring_attn_1_9_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-13963C7379.02,-13963 7537.86,-13963 7537.86,-13963"/>
<polygon fill="red" stroke="red" points="7537.86,-13966.5 7547.86,-13963 7537.86,-13959.5 7537.86,-13966.5"/>
</g>
<!-- ring_attn_1_8_stage_6&#45;&gt;ring_attn_1_8_stage_7 -->
<g id="edge810" class="edge">
<title>ring_attn_1_8_stage_6&#45;&gt;ring_attn_1_8_stage_7</title>
<path fill="none" stroke="black" d="M7170,-13641.87C7170,-13641.87 7170,-13535.25 7170,-13535.25"/>
<polygon fill="black" stroke="black" points="7173.5,-13535.25 7170,-13525.25 7166.5,-13535.25 7173.5,-13535.25"/>
</g>
<!-- ring_attn_1_9_stage_6 -->
<g id="node916" class="node">
<title>ring_attn_1_9_stage_6</title>
<polygon fill="yellow" stroke="black" points="7757,-13778 7548,-13710 7757,-13642 7966,-13710 7757,-13778"/>
<text text-anchor="middle" x="7757" y="-13728.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-13713.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="7757" y="-13698.8" font-family="Times,serif" font-size="14.00">Q[9]×K[3]×V[3]</text>
<text text-anchor="middle" x="7757" y="-13683.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_8_stage_6&#45;&gt;ring_attn_1_9_stage_6 -->
<g id="edge2582" class="edge">
<title>ring_attn_1_8_stage_6&#45;&gt;ring_attn_1_9_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-13710C7379.02,-13710 7537.86,-13710 7537.86,-13710"/>
<polygon fill="red" stroke="red" points="7537.86,-13713.5 7547.86,-13710 7537.86,-13706.5 7537.86,-13713.5"/>
</g>
<!-- ring_attn_1_8_stage_7&#45;&gt;ring_attn_1_8_stage_8 -->
<g id="edge811" class="edge">
<title>ring_attn_1_8_stage_7&#45;&gt;ring_attn_1_8_stage_8</title>
<path fill="none" stroke="black" d="M7170,-13388.87C7170,-13388.87 7170,-13282.25 7170,-13282.25"/>
<polygon fill="black" stroke="black" points="7173.5,-13282.25 7170,-13272.25 7166.5,-13282.25 7173.5,-13282.25"/>
</g>
<!-- ring_attn_1_9_stage_7 -->
<g id="node917" class="node">
<title>ring_attn_1_9_stage_7</title>
<polygon fill="yellow" stroke="black" points="7757,-13525 7548,-13457 7757,-13389 7966,-13457 7757,-13525"/>
<text text-anchor="middle" x="7757" y="-13475.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-13460.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="7757" y="-13445.8" font-family="Times,serif" font-size="14.00">Q[9]×K[2]×V[2]</text>
<text text-anchor="middle" x="7757" y="-13430.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_8_stage_7&#45;&gt;ring_attn_1_9_stage_7 -->
<g id="edge2583" class="edge">
<title>ring_attn_1_8_stage_7&#45;&gt;ring_attn_1_9_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-13457C7379.02,-13457 7537.86,-13457 7537.86,-13457"/>
<polygon fill="red" stroke="red" points="7537.86,-13460.5 7547.86,-13457 7537.86,-13453.5 7537.86,-13460.5"/>
</g>
<!-- ring_attn_1_8_stage_8&#45;&gt;ring_attn_1_8_stage_9 -->
<g id="edge812" class="edge">
<title>ring_attn_1_8_stage_8&#45;&gt;ring_attn_1_8_stage_9</title>
<path fill="none" stroke="black" d="M7170,-13135.87C7170,-13135.87 7170,-13029.25 7170,-13029.25"/>
<polygon fill="black" stroke="black" points="7173.5,-13029.25 7170,-13019.25 7166.5,-13029.25 7173.5,-13029.25"/>
</g>
<!-- ring_attn_1_9_stage_8 -->
<g id="node918" class="node">
<title>ring_attn_1_9_stage_8</title>
<polygon fill="yellow" stroke="black" points="7757,-13272 7548,-13204 7757,-13136 7966,-13204 7757,-13272"/>
<text text-anchor="middle" x="7757" y="-13222.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-13207.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="7757" y="-13192.8" font-family="Times,serif" font-size="14.00">Q[9]×K[1]×V[1]</text>
<text text-anchor="middle" x="7757" y="-13177.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_8_stage_8&#45;&gt;ring_attn_1_9_stage_8 -->
<g id="edge2584" class="edge">
<title>ring_attn_1_8_stage_8&#45;&gt;ring_attn_1_9_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-13204C7379.02,-13204 7537.86,-13204 7537.86,-13204"/>
<polygon fill="red" stroke="red" points="7537.86,-13207.5 7547.86,-13204 7537.86,-13200.5 7537.86,-13207.5"/>
</g>
<!-- ring_attn_1_8_stage_9&#45;&gt;ring_attn_1_8_stage_10 -->
<g id="edge813" class="edge">
<title>ring_attn_1_8_stage_9&#45;&gt;ring_attn_1_8_stage_10</title>
<path fill="none" stroke="black" d="M7170,-12882.87C7170,-12882.87 7170,-12776.25 7170,-12776.25"/>
<polygon fill="black" stroke="black" points="7173.5,-12776.25 7170,-12766.25 7166.5,-12776.25 7173.5,-12776.25"/>
</g>
<!-- ring_attn_1_9_stage_9 -->
<g id="node919" class="node">
<title>ring_attn_1_9_stage_9</title>
<polygon fill="yellow" stroke="black" points="7757,-13019 7548,-12951 7757,-12883 7966,-12951 7757,-13019"/>
<text text-anchor="middle" x="7757" y="-12969.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-12954.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="7757" y="-12939.8" font-family="Times,serif" font-size="14.00">Q[9]×K[0]×V[0]</text>
<text text-anchor="middle" x="7757" y="-12924.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_8_stage_9&#45;&gt;ring_attn_1_9_stage_9 -->
<g id="edge2585" class="edge">
<title>ring_attn_1_8_stage_9&#45;&gt;ring_attn_1_9_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-12951C7379.02,-12951 7537.86,-12951 7537.86,-12951"/>
<polygon fill="red" stroke="red" points="7537.86,-12954.5 7547.86,-12951 7537.86,-12947.5 7537.86,-12954.5"/>
</g>
<!-- ring_attn_1_8_stage_10&#45;&gt;ring_attn_1_8_stage_11 -->
<g id="edge814" class="edge">
<title>ring_attn_1_8_stage_10&#45;&gt;ring_attn_1_8_stage_11</title>
<path fill="none" stroke="black" d="M7170,-12629.87C7170,-12629.87 7170,-12523.25 7170,-12523.25"/>
<polygon fill="black" stroke="black" points="7173.5,-12523.25 7170,-12513.25 7166.5,-12523.25 7173.5,-12523.25"/>
</g>
<!-- ring_attn_1_9_stage_10 -->
<g id="node920" class="node">
<title>ring_attn_1_9_stage_10</title>
<polygon fill="yellow" stroke="black" points="7757,-12766 7548,-12698 7757,-12630 7966,-12698 7757,-12766"/>
<text text-anchor="middle" x="7757" y="-12716.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-12701.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="7757" y="-12686.8" font-family="Times,serif" font-size="14.00">Q[9]×K[15]×V[15]</text>
<text text-anchor="middle" x="7757" y="-12671.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_8_stage_10&#45;&gt;ring_attn_1_9_stage_10 -->
<g id="edge2586" class="edge">
<title>ring_attn_1_8_stage_10&#45;&gt;ring_attn_1_9_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-12698C7379.02,-12698 7537.86,-12698 7537.86,-12698"/>
<polygon fill="red" stroke="red" points="7537.86,-12701.5 7547.86,-12698 7537.86,-12694.5 7537.86,-12701.5"/>
</g>
<!-- ring_attn_1_8_stage_11&#45;&gt;ring_attn_1_8_stage_12 -->
<g id="edge815" class="edge">
<title>ring_attn_1_8_stage_11&#45;&gt;ring_attn_1_8_stage_12</title>
<path fill="none" stroke="black" d="M7170,-12376.87C7170,-12376.87 7170,-12270.25 7170,-12270.25"/>
<polygon fill="black" stroke="black" points="7173.5,-12270.25 7170,-12260.25 7166.5,-12270.25 7173.5,-12270.25"/>
</g>
<!-- ring_attn_1_9_stage_11 -->
<g id="node921" class="node">
<title>ring_attn_1_9_stage_11</title>
<polygon fill="yellow" stroke="black" points="7757,-12513 7548,-12445 7757,-12377 7966,-12445 7757,-12513"/>
<text text-anchor="middle" x="7757" y="-12463.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-12448.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="7757" y="-12433.8" font-family="Times,serif" font-size="14.00">Q[9]×K[14]×V[14]</text>
<text text-anchor="middle" x="7757" y="-12418.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_8_stage_11&#45;&gt;ring_attn_1_9_stage_11 -->
<g id="edge2587" class="edge">
<title>ring_attn_1_8_stage_11&#45;&gt;ring_attn_1_9_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-12445C7379.02,-12445 7537.86,-12445 7537.86,-12445"/>
<polygon fill="red" stroke="red" points="7537.86,-12448.5 7547.86,-12445 7537.86,-12441.5 7537.86,-12448.5"/>
</g>
<!-- ring_attn_1_8_stage_12&#45;&gt;ring_attn_1_8_stage_13 -->
<g id="edge816" class="edge">
<title>ring_attn_1_8_stage_12&#45;&gt;ring_attn_1_8_stage_13</title>
<path fill="none" stroke="black" d="M7170,-12123.87C7170,-12123.87 7170,-12017.25 7170,-12017.25"/>
<polygon fill="black" stroke="black" points="7173.5,-12017.25 7170,-12007.25 7166.5,-12017.25 7173.5,-12017.25"/>
</g>
<!-- ring_attn_1_9_stage_12 -->
<g id="node922" class="node">
<title>ring_attn_1_9_stage_12</title>
<polygon fill="yellow" stroke="black" points="7757,-12260 7548,-12192 7757,-12124 7966,-12192 7757,-12260"/>
<text text-anchor="middle" x="7757" y="-12210.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-12195.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="7757" y="-12180.8" font-family="Times,serif" font-size="14.00">Q[9]×K[13]×V[13]</text>
<text text-anchor="middle" x="7757" y="-12165.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_8_stage_12&#45;&gt;ring_attn_1_9_stage_12 -->
<g id="edge2588" class="edge">
<title>ring_attn_1_8_stage_12&#45;&gt;ring_attn_1_9_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-12192C7379.02,-12192 7537.86,-12192 7537.86,-12192"/>
<polygon fill="red" stroke="red" points="7537.86,-12195.5 7547.86,-12192 7537.86,-12188.5 7537.86,-12195.5"/>
</g>
<!-- ring_attn_1_8_stage_13&#45;&gt;ring_attn_1_8_stage_14 -->
<g id="edge817" class="edge">
<title>ring_attn_1_8_stage_13&#45;&gt;ring_attn_1_8_stage_14</title>
<path fill="none" stroke="black" d="M7170,-11870.87C7170,-11870.87 7170,-11764.25 7170,-11764.25"/>
<polygon fill="black" stroke="black" points="7173.5,-11764.25 7170,-11754.25 7166.5,-11764.25 7173.5,-11764.25"/>
</g>
<!-- ring_attn_1_9_stage_13 -->
<g id="node923" class="node">
<title>ring_attn_1_9_stage_13</title>
<polygon fill="yellow" stroke="black" points="7757,-12007 7548,-11939 7757,-11871 7966,-11939 7757,-12007"/>
<text text-anchor="middle" x="7757" y="-11957.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-11942.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="7757" y="-11927.8" font-family="Times,serif" font-size="14.00">Q[9]×K[12]×V[12]</text>
<text text-anchor="middle" x="7757" y="-11912.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_8_stage_13&#45;&gt;ring_attn_1_9_stage_13 -->
<g id="edge2589" class="edge">
<title>ring_attn_1_8_stage_13&#45;&gt;ring_attn_1_9_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-11939C7379.02,-11939 7537.86,-11939 7537.86,-11939"/>
<polygon fill="red" stroke="red" points="7537.86,-11942.5 7547.86,-11939 7537.86,-11935.5 7537.86,-11942.5"/>
</g>
<!-- ring_attn_1_8_stage_14&#45;&gt;ring_attn_1_8_stage_15 -->
<g id="edge818" class="edge">
<title>ring_attn_1_8_stage_14&#45;&gt;ring_attn_1_8_stage_15</title>
<path fill="none" stroke="black" d="M7170,-11617.87C7170,-11617.87 7170,-11511.25 7170,-11511.25"/>
<polygon fill="black" stroke="black" points="7173.5,-11511.25 7170,-11501.25 7166.5,-11511.25 7173.5,-11511.25"/>
</g>
<!-- ring_attn_1_9_stage_14 -->
<g id="node924" class="node">
<title>ring_attn_1_9_stage_14</title>
<polygon fill="yellow" stroke="black" points="7757,-11754 7548,-11686 7757,-11618 7966,-11686 7757,-11754"/>
<text text-anchor="middle" x="7757" y="-11704.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-11689.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="7757" y="-11674.8" font-family="Times,serif" font-size="14.00">Q[9]×K[11]×V[11]</text>
<text text-anchor="middle" x="7757" y="-11659.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_8_stage_14&#45;&gt;ring_attn_1_9_stage_14 -->
<g id="edge2590" class="edge">
<title>ring_attn_1_8_stage_14&#45;&gt;ring_attn_1_9_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-11686C7379.02,-11686 7537.86,-11686 7537.86,-11686"/>
<polygon fill="red" stroke="red" points="7537.86,-11689.5 7547.86,-11686 7537.86,-11682.5 7537.86,-11689.5"/>
</g>
<!-- attn_out_1_8 -->
<g id="node828" class="node">
<title>attn_out_1_8</title>
<polygon fill="none" stroke="black" points="7239.5,-11292 7100.5,-11292 7100.5,-11239 7239.5,-11239 7239.5,-11292"/>
<text text-anchor="middle" x="7170" y="-11276.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="7170" y="-11261.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="7170" y="-11246.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_1_8_stage_15&#45;&gt;attn_out_1_8 -->
<g id="edge819" class="edge">
<title>ring_attn_1_8_stage_15&#45;&gt;attn_out_1_8</title>
<path fill="none" stroke="black" d="M7170,-11364.87C7170,-11364.87 7170,-11302.18 7170,-11302.18"/>
<polygon fill="black" stroke="black" points="7173.5,-11302.18 7170,-11292.18 7166.5,-11302.18 7173.5,-11302.18"/>
</g>
<!-- ring_attn_1_9_stage_15 -->
<g id="node925" class="node">
<title>ring_attn_1_9_stage_15</title>
<polygon fill="yellow" stroke="black" points="7757,-11501 7548,-11433 7757,-11365 7966,-11433 7757,-11501"/>
<text text-anchor="middle" x="7757" y="-11451.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-11436.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="7757" y="-11421.8" font-family="Times,serif" font-size="14.00">Q[9]×K[10]×V[10]</text>
<text text-anchor="middle" x="7757" y="-11406.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_8_stage_15&#45;&gt;ring_attn_1_9_stage_15 -->
<g id="edge2591" class="edge">
<title>ring_attn_1_8_stage_15&#45;&gt;ring_attn_1_9_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-11433C7379.02,-11433 7537.86,-11433 7537.86,-11433"/>
<polygon fill="red" stroke="red" points="7537.86,-11436.5 7547.86,-11433 7537.86,-11429.5 7537.86,-11436.5"/>
</g>
<!-- attn_residual_1_8 -->
<g id="node829" class="node">
<title>attn_residual_1_8</title>
<ellipse fill="none" stroke="black" cx="7170" cy="-11139" rx="105.5" ry="27"/>
<text text-anchor="middle" x="7170" y="-11142.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="7170" y="-11127.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_1_8&#45;&gt;attn_residual_1_8 -->
<g id="edge820" class="edge">
<title>attn_out_1_8&#45;&gt;attn_residual_1_8</title>
<path fill="none" stroke="black" d="M7170,-11238.98C7170,-11238.98 7170,-11176.36 7170,-11176.36"/>
<polygon fill="black" stroke="black" points="7173.5,-11176.36 7170,-11166.36 7166.5,-11176.36 7173.5,-11176.36"/>
</g>
<!-- gate_1_8 -->
<g id="node830" class="node">
<title>gate_1_8</title>
<ellipse fill="orange" stroke="black" cx="7170" cy="-11001.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="7170" y="-11012.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="7170" y="-10997.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="7170" y="-10982.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_1_8&#45;&gt;gate_1_8 -->
<g id="edge821" class="edge">
<title>attn_residual_1_8&#45;&gt;gate_1_8</title>
<path fill="none" stroke="black" d="M7205.17,-11113.46C7205.17,-11113.46 7205.17,-11047.01 7205.17,-11047.01"/>
<polygon fill="black" stroke="black" points="7208.67,-11047.01 7205.17,-11037.01 7201.67,-11047.01 7208.67,-11047.01"/>
</g>
<!-- gate_1_8&#45;&gt;expert_1_0_0 -->
<g id="edge2592" class="edge">
<title>gate_1_8&#45;&gt;expert_1_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7134.83,-11036.99C7134.83,-11061.61 7134.83,-11090 7134.83,-11090 7134.83,-11090 332.43,-11090 332.43,-11090 332.43,-11090 332.43,-10842.01 332.43,-10842.01"/>
<polygon fill="blue" stroke="blue" points="335.93,-10842.01 332.43,-10832.01 328.93,-10842.01 335.93,-10842.01"/>
<text text-anchor="middle" x="29876.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29876.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU8→GPU0</text>
<text text-anchor="middle" x="29876.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29876.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_8&#45;&gt;expert_1_1_0 -->
<g id="edge2593" class="edge">
<title>gate_1_8&#45;&gt;expert_1_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7073.67,-10986.14C7073.67,-10954.29 7073.67,-10884 7073.67,-10884 7073.67,-10884 3003.45,-10884 3003.45,-10884 3003.45,-10884 3003.45,-10842.08 3003.45,-10842.08"/>
<polygon fill="blue" stroke="blue" points="3006.95,-10842.08 3003.45,-10832.08 2999.95,-10842.08 3006.95,-10842.08"/>
<text text-anchor="middle" x="30050.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30050.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU8→GPU1</text>
<text text-anchor="middle" x="30050.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30050.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_8&#45;&gt;expert_1_2_0 -->
<g id="edge2594" class="edge">
<title>gate_1_8&#45;&gt;expert_1_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7092.02,-10976.08C7092.02,-10941.26 7092.02,-10883 7092.02,-10883 7092.02,-10883 3597.2,-10883 3597.2,-10883 3597.2,-10883 3597.2,-10842.17 3597.2,-10842.17"/>
<polygon fill="blue" stroke="blue" points="3600.7,-10842.17 3597.2,-10832.17 3593.7,-10842.17 3600.7,-10842.17"/>
<text text-anchor="middle" x="30224.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30224.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU8→GPU2</text>
<text text-anchor="middle" x="30224.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30224.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_8&#45;&gt;expert_1_3_0 -->
<g id="edge2595" class="edge">
<title>gate_1_8&#45;&gt;expert_1_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7110.37,-10970.43C7110.37,-10937.74 7110.37,-10891 7110.37,-10891 7110.37,-10891 4188.58,-10891 4188.58,-10891 4188.58,-10891 4188.58,-10842.08 4188.58,-10842.08"/>
<polygon fill="blue" stroke="blue" points="4192.08,-10842.08 4188.58,-10832.08 4185.08,-10842.08 4192.08,-10842.08"/>
<text text-anchor="middle" x="30398.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30398.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU8→GPU3</text>
<text text-anchor="middle" x="30398.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30398.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_8&#45;&gt;expert_1_4_0 -->
<g id="edge2596" class="edge">
<title>gate_1_8&#45;&gt;expert_1_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7128.72,-10966.86C7128.72,-10945.44 7128.72,-10922 7128.72,-10922 7128.72,-10922 4786.83,-10922 4786.83,-10922 4786.83,-10922 4786.83,-10842.23 4786.83,-10842.23"/>
<polygon fill="blue" stroke="blue" points="4790.33,-10842.23 4786.83,-10832.23 4783.33,-10842.23 4790.33,-10842.23"/>
<text text-anchor="middle" x="30572.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30572.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU8→GPU4</text>
<text text-anchor="middle" x="30572.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30572.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_8&#45;&gt;expert_1_5_0 -->
<g id="edge2597" class="edge">
<title>gate_1_8&#45;&gt;expert_1_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7147.07,-10964.83C7147.07,-10946.84 7147.07,-10929 7147.07,-10929 7147.07,-10929 5383.88,-10929 5383.88,-10929 5383.88,-10929 5383.88,-10842.3 5383.88,-10842.3"/>
<polygon fill="blue" stroke="blue" points="5387.38,-10842.3 5383.88,-10832.3 5380.38,-10842.3 5387.38,-10842.3"/>
<text text-anchor="middle" x="30746.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30746.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU8→GPU5</text>
<text text-anchor="middle" x="30746.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30746.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_8&#45;&gt;expert_1_6_0 -->
<g id="edge2598" class="edge">
<title>gate_1_8&#45;&gt;expert_1_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7156.24,-10963.97C7156.24,-10958.68 7156.24,-10955 7156.24,-10955 7156.24,-10955 6111.62,-10955 6111.62,-10955 6111.62,-10955 6111.62,-10842.23 6111.62,-10842.23"/>
<polygon fill="blue" stroke="blue" points="6115.13,-10842.23 6111.62,-10832.23 6108.13,-10842.23 6115.13,-10842.23"/>
<text text-anchor="middle" x="30920.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30920.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU8→GPU6</text>
<text text-anchor="middle" x="30920.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30920.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_8&#45;&gt;expert_1_7_0 -->
<g id="edge2599" class="edge">
<title>gate_1_8&#45;&gt;expert_1_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7070.48,-11014C6931.26,-11014 6695.25,-11014 6695.25,-11014 6695.25,-11014 6695.25,-10842.33 6695.25,-10842.33"/>
<polygon fill="blue" stroke="blue" points="6698.75,-10842.33 6695.25,-10832.33 6691.75,-10842.33 6698.75,-10842.33"/>
<text text-anchor="middle" x="31094.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31094.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU8→GPU7</text>
<text text-anchor="middle" x="31094.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31094.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_8&#45;&gt;expert_1_8_0 -->
<g id="edge822" class="edge">
<title>gate_1_8&#45;&gt;expert_1_8_0</title>
<path fill="none" stroke="black" d="M7165.41,-10963.71C7165.41,-10963.71 7165.41,-10842.18 7165.41,-10842.18"/>
<polygon fill="black" stroke="black" points="7168.91,-10842.18 7165.41,-10832.18 7161.91,-10842.18 7168.91,-10842.18"/>
</g>
<!-- gate_1_8&#45;&gt;expert_1_9_0 -->
<g id="edge2600" class="edge">
<title>gate_1_8&#45;&gt;expert_1_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7269.65,-10989C7409.77,-10989 7648.12,-10989 7648.12,-10989 7648.12,-10989 7648.12,-10842.18 7648.12,-10842.18"/>
<polygon fill="blue" stroke="blue" points="7651.63,-10842.18 7648.12,-10832.18 7644.63,-10842.18 7651.63,-10842.18"/>
<text text-anchor="middle" x="31268.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31268.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU8→GPU9</text>
<text text-anchor="middle" x="31268.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31268.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_8&#45;&gt;expert_1_10_0 -->
<g id="edge2601" class="edge">
<title>gate_1_8&#45;&gt;expert_1_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7220.46,-10968.54C7220.46,-10957.06 7220.46,-10947 7220.46,-10947 7220.46,-10947 8230.4,-10947 8230.4,-10947 8230.4,-10947 8230.4,-10842.12 8230.4,-10842.12"/>
<polygon fill="blue" stroke="blue" points="8233.9,-10842.12 8230.4,-10832.12 8226.9,-10842.12 8233.9,-10842.12"/>
<text text-anchor="middle" x="31442.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31442.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU8→GPU10</text>
<text text-anchor="middle" x="31442.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31442.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_8&#45;&gt;expert_1_11_0 -->
<g id="edge2602" class="edge">
<title>gate_1_8&#45;&gt;expert_1_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7229.63,-10970.52C7229.63,-10946.4 7229.63,-10917 7229.63,-10917 7229.63,-10917 8815.38,-10917 8815.38,-10917 8815.38,-10917 8815.38,-10842.21 8815.38,-10842.21"/>
<polygon fill="blue" stroke="blue" points="8818.88,-10842.21 8815.38,-10832.21 8811.88,-10842.21 8818.88,-10842.21"/>
<text text-anchor="middle" x="31616.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31616.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU8→GPU11</text>
<text text-anchor="middle" x="31616.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31616.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_8&#45;&gt;expert_1_12_0 -->
<g id="edge2603" class="edge">
<title>gate_1_8&#45;&gt;expert_1_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7238.8,-10972.99C7238.8,-10945.81 7238.8,-10909 7238.8,-10909 7238.8,-10909 9559.28,-10909 9559.28,-10909 9559.28,-10909 9559.28,-10842.15 9559.28,-10842.15"/>
<polygon fill="blue" stroke="blue" points="9562.78,-10842.15 9559.28,-10832.15 9555.78,-10842.15 9562.78,-10842.15"/>
<text text-anchor="middle" x="31790.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31790.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU8→GPU12</text>
<text text-anchor="middle" x="31790.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31790.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_8&#45;&gt;expert_1_13_0 -->
<g id="edge2604" class="edge">
<title>gate_1_8&#45;&gt;expert_1_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7247.98,-10976.14C7247.98,-10947.25 7247.98,-10904 7247.98,-10904 7247.98,-10904 10151.42,-10904 10151.42,-10904 10151.42,-10904 10151.42,-10842.16 10151.42,-10842.16"/>
<polygon fill="blue" stroke="blue" points="10154.92,-10842.16 10151.42,-10832.16 10147.92,-10842.16 10154.92,-10842.16"/>
<text text-anchor="middle" x="31964.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31964.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU8→GPU13</text>
<text text-anchor="middle" x="31964.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31964.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_8&#45;&gt;expert_1_14_0 -->
<g id="edge2605" class="edge">
<title>gate_1_8&#45;&gt;expert_1_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7257.15,-10980.17C7257.15,-10941.78 7257.15,-10865 7257.15,-10865 7257.15,-10865 10717.12,-10865 10717.12,-10865 10717.12,-10865 10717.12,-10842.12 10717.12,-10842.12"/>
<polygon fill="blue" stroke="blue" points="10720.62,-10842.12 10717.12,-10832.12 10713.62,-10842.12 10720.62,-10842.12"/>
<text text-anchor="middle" x="32138.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="32138.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU8→GPU14</text>
<text text-anchor="middle" x="32138.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="32138.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_8&#45;&gt;expert_1_15_0 -->
<g id="edge2606" class="edge">
<title>gate_1_8&#45;&gt;expert_1_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7266.33,-10985.79C7266.33,-10953.99 7266.33,-10885 7266.33,-10885 7266.33,-10885 11284.55,-10885 11284.55,-10885 11284.55,-10885 11284.55,-10842.42 11284.55,-10842.42"/>
<polygon fill="blue" stroke="blue" points="11288.05,-10842.42 11284.55,-10832.42 11281.05,-10842.42 11288.05,-10842.42"/>
<text text-anchor="middle" x="32312.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="32312.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU8→GPU15</text>
<text text-anchor="middle" x="32312.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="32312.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_8 -->
<g id="node832" class="node">
<title>expert_reduce_1_8</title>
<ellipse fill="none" stroke="black" cx="7170" cy="-10668.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="7170" y="-10679.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="7170" y="-10664.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="7170" y="-10649.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_8_0&#45;&gt;expert_reduce_1_8 -->
<g id="edge823" class="edge">
<title>expert_1_8_0&#45;&gt;expert_reduce_1_8</title>
<path fill="none" stroke="black" d="M7170,-10778.76C7170,-10778.76 7170,-10716.06 7170,-10716.06"/>
<polygon fill="black" stroke="black" points="7173.5,-10716.06 7170,-10706.06 7166.5,-10716.06 7173.5,-10716.06"/>
</g>
<!-- moe_residual_1_8 -->
<g id="node833" class="node">
<title>moe_residual_1_8</title>
<ellipse fill="none" stroke="black" cx="7170" cy="-10531" rx="105.5" ry="27"/>
<text text-anchor="middle" x="7170" y="-10534.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="7170" y="-10519.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_8&#45;&gt;moe_residual_1_8 -->
<g id="edge824" class="edge">
<title>expert_reduce_1_8&#45;&gt;moe_residual_1_8</title>
<path fill="none" stroke="black" d="M7170,-10630.93C7170,-10630.93 7170,-10568.06 7170,-10568.06"/>
<polygon fill="black" stroke="black" points="7173.5,-10568.06 7170,-10558.06 7166.5,-10568.06 7173.5,-10568.06"/>
</g>
<!-- qkv_proj_2_8 -->
<g id="node834" class="node">
<title>qkv_proj_2_8</title>
<polygon fill="none" stroke="black" points="7252.5,-10431 7087.5,-10431 7087.5,-10378 7252.5,-10378 7252.5,-10431"/>
<text text-anchor="middle" x="7170" y="-10415.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="7170" y="-10400.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="7170" y="-10385.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_1_8&#45;&gt;qkv_proj_2_8 -->
<g id="edge825" class="edge">
<title>moe_residual_1_8&#45;&gt;qkv_proj_2_8</title>
<path fill="none" stroke="black" d="M7170,-10503.86C7170,-10503.86 7170,-10441.16 7170,-10441.16"/>
<polygon fill="black" stroke="black" points="7173.5,-10441.16 7170,-10431.16 7166.5,-10441.16 7173.5,-10441.16"/>
</g>
<!-- qkv_reshape_2_8 -->
<g id="node835" class="node">
<title>qkv_reshape_2_8</title>
<ellipse fill="none" stroke="black" cx="7170" cy="-10278" rx="148" ry="27"/>
<text text-anchor="middle" x="7170" y="-10281.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="7170" y="-10266.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_2_8&#45;&gt;qkv_reshape_2_8 -->
<g id="edge826" class="edge">
<title>qkv_proj_2_8&#45;&gt;qkv_reshape_2_8</title>
<path fill="none" stroke="black" d="M7170,-10377.98C7170,-10377.98 7170,-10315.36 7170,-10315.36"/>
<polygon fill="black" stroke="black" points="7173.5,-10315.36 7170,-10305.36 7166.5,-10315.36 7173.5,-10315.36"/>
</g>
<!-- qkv_reshape_2_8&#45;&gt;ring_attn_2_8_stage_0 -->
<g id="edge827" class="edge">
<title>qkv_reshape_2_8&#45;&gt;ring_attn_2_8_stage_0</title>
<path fill="none" stroke="black" d="M7170,-10250.72C7170,-10250.72 7170,-10144.16 7170,-10144.16"/>
<polygon fill="black" stroke="black" points="7173.5,-10144.16 7170,-10134.16 7166.5,-10144.16 7173.5,-10144.16"/>
</g>
<!-- ring_attn_2_8_stage_0&#45;&gt;ring_attn_2_8_stage_1 -->
<g id="edge828" class="edge">
<title>ring_attn_2_8_stage_0&#45;&gt;ring_attn_2_8_stage_1</title>
<path fill="none" stroke="black" d="M7170,-9997.87C7170,-9997.87 7170,-9891.25 7170,-9891.25"/>
<polygon fill="black" stroke="black" points="7173.5,-9891.25 7170,-9881.25 7166.5,-9891.25 7173.5,-9891.25"/>
</g>
<!-- ring_attn_2_9_stage_0 -->
<g id="node934" class="node">
<title>ring_attn_2_9_stage_0</title>
<polygon fill="yellow" stroke="black" points="7757,-10134 7548,-10066 7757,-9998 7966,-10066 7757,-10134"/>
<text text-anchor="middle" x="7757" y="-10084.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-10069.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="7757" y="-10054.8" font-family="Times,serif" font-size="14.00">Q[9]×K[9]×V[9]</text>
<text text-anchor="middle" x="7757" y="-10039.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_8_stage_0&#45;&gt;ring_attn_2_9_stage_0 -->
<g id="edge2607" class="edge">
<title>ring_attn_2_8_stage_0&#45;&gt;ring_attn_2_9_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-10066C7379.02,-10066 7537.86,-10066 7537.86,-10066"/>
<polygon fill="red" stroke="red" points="7537.86,-10069.5 7547.86,-10066 7537.86,-10062.5 7537.86,-10069.5"/>
</g>
<!-- ring_attn_2_8_stage_1&#45;&gt;ring_attn_2_8_stage_2 -->
<g id="edge829" class="edge">
<title>ring_attn_2_8_stage_1&#45;&gt;ring_attn_2_8_stage_2</title>
<path fill="none" stroke="black" d="M7170,-9744.87C7170,-9744.87 7170,-9638.25 7170,-9638.25"/>
<polygon fill="black" stroke="black" points="7173.5,-9638.25 7170,-9628.25 7166.5,-9638.25 7173.5,-9638.25"/>
</g>
<!-- ring_attn_2_9_stage_1 -->
<g id="node935" class="node">
<title>ring_attn_2_9_stage_1</title>
<polygon fill="yellow" stroke="black" points="7757,-9881 7548,-9813 7757,-9745 7966,-9813 7757,-9881"/>
<text text-anchor="middle" x="7757" y="-9831.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-9816.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="7757" y="-9801.8" font-family="Times,serif" font-size="14.00">Q[9]×K[8]×V[8]</text>
<text text-anchor="middle" x="7757" y="-9786.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_8_stage_1&#45;&gt;ring_attn_2_9_stage_1 -->
<g id="edge2608" class="edge">
<title>ring_attn_2_8_stage_1&#45;&gt;ring_attn_2_9_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-9813C7379.02,-9813 7537.86,-9813 7537.86,-9813"/>
<polygon fill="red" stroke="red" points="7537.86,-9816.5 7547.86,-9813 7537.86,-9809.5 7537.86,-9816.5"/>
</g>
<!-- ring_attn_2_8_stage_2&#45;&gt;ring_attn_2_8_stage_3 -->
<g id="edge830" class="edge">
<title>ring_attn_2_8_stage_2&#45;&gt;ring_attn_2_8_stage_3</title>
<path fill="none" stroke="black" d="M7170,-9491.87C7170,-9491.87 7170,-9385.25 7170,-9385.25"/>
<polygon fill="black" stroke="black" points="7173.5,-9385.25 7170,-9375.25 7166.5,-9385.25 7173.5,-9385.25"/>
</g>
<!-- ring_attn_2_9_stage_2 -->
<g id="node936" class="node">
<title>ring_attn_2_9_stage_2</title>
<polygon fill="yellow" stroke="black" points="7757,-9628 7548,-9560 7757,-9492 7966,-9560 7757,-9628"/>
<text text-anchor="middle" x="7757" y="-9578.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-9563.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="7757" y="-9548.8" font-family="Times,serif" font-size="14.00">Q[9]×K[7]×V[7]</text>
<text text-anchor="middle" x="7757" y="-9533.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_8_stage_2&#45;&gt;ring_attn_2_9_stage_2 -->
<g id="edge2609" class="edge">
<title>ring_attn_2_8_stage_2&#45;&gt;ring_attn_2_9_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-9560C7379.02,-9560 7537.86,-9560 7537.86,-9560"/>
<polygon fill="red" stroke="red" points="7537.86,-9563.5 7547.86,-9560 7537.86,-9556.5 7537.86,-9563.5"/>
</g>
<!-- ring_attn_2_8_stage_3&#45;&gt;ring_attn_2_8_stage_4 -->
<g id="edge831" class="edge">
<title>ring_attn_2_8_stage_3&#45;&gt;ring_attn_2_8_stage_4</title>
<path fill="none" stroke="black" d="M7170,-9238.87C7170,-9238.87 7170,-9132.25 7170,-9132.25"/>
<polygon fill="black" stroke="black" points="7173.5,-9132.25 7170,-9122.25 7166.5,-9132.25 7173.5,-9132.25"/>
</g>
<!-- ring_attn_2_9_stage_3 -->
<g id="node937" class="node">
<title>ring_attn_2_9_stage_3</title>
<polygon fill="yellow" stroke="black" points="7757,-9375 7548,-9307 7757,-9239 7966,-9307 7757,-9375"/>
<text text-anchor="middle" x="7757" y="-9325.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-9310.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="7757" y="-9295.8" font-family="Times,serif" font-size="14.00">Q[9]×K[6]×V[6]</text>
<text text-anchor="middle" x="7757" y="-9280.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_8_stage_3&#45;&gt;ring_attn_2_9_stage_3 -->
<g id="edge2610" class="edge">
<title>ring_attn_2_8_stage_3&#45;&gt;ring_attn_2_9_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-9307C7379.02,-9307 7537.86,-9307 7537.86,-9307"/>
<polygon fill="red" stroke="red" points="7537.86,-9310.5 7547.86,-9307 7537.86,-9303.5 7537.86,-9310.5"/>
</g>
<!-- ring_attn_2_8_stage_4&#45;&gt;ring_attn_2_8_stage_5 -->
<g id="edge832" class="edge">
<title>ring_attn_2_8_stage_4&#45;&gt;ring_attn_2_8_stage_5</title>
<path fill="none" stroke="black" d="M7170,-8985.87C7170,-8985.87 7170,-8879.25 7170,-8879.25"/>
<polygon fill="black" stroke="black" points="7173.5,-8879.25 7170,-8869.25 7166.5,-8879.25 7173.5,-8879.25"/>
</g>
<!-- ring_attn_2_9_stage_4 -->
<g id="node938" class="node">
<title>ring_attn_2_9_stage_4</title>
<polygon fill="yellow" stroke="black" points="7757,-9122 7548,-9054 7757,-8986 7966,-9054 7757,-9122"/>
<text text-anchor="middle" x="7757" y="-9072.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-9057.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="7757" y="-9042.8" font-family="Times,serif" font-size="14.00">Q[9]×K[5]×V[5]</text>
<text text-anchor="middle" x="7757" y="-9027.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_8_stage_4&#45;&gt;ring_attn_2_9_stage_4 -->
<g id="edge2611" class="edge">
<title>ring_attn_2_8_stage_4&#45;&gt;ring_attn_2_9_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-9054C7379.02,-9054 7537.86,-9054 7537.86,-9054"/>
<polygon fill="red" stroke="red" points="7537.86,-9057.5 7547.86,-9054 7537.86,-9050.5 7537.86,-9057.5"/>
</g>
<!-- ring_attn_2_8_stage_5&#45;&gt;ring_attn_2_8_stage_6 -->
<g id="edge833" class="edge">
<title>ring_attn_2_8_stage_5&#45;&gt;ring_attn_2_8_stage_6</title>
<path fill="none" stroke="black" d="M7170,-8732.87C7170,-8732.87 7170,-8626.25 7170,-8626.25"/>
<polygon fill="black" stroke="black" points="7173.5,-8626.25 7170,-8616.25 7166.5,-8626.25 7173.5,-8626.25"/>
</g>
<!-- ring_attn_2_9_stage_5 -->
<g id="node939" class="node">
<title>ring_attn_2_9_stage_5</title>
<polygon fill="yellow" stroke="black" points="7757,-8869 7548,-8801 7757,-8733 7966,-8801 7757,-8869"/>
<text text-anchor="middle" x="7757" y="-8819.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-8804.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="7757" y="-8789.8" font-family="Times,serif" font-size="14.00">Q[9]×K[4]×V[4]</text>
<text text-anchor="middle" x="7757" y="-8774.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_8_stage_5&#45;&gt;ring_attn_2_9_stage_5 -->
<g id="edge2612" class="edge">
<title>ring_attn_2_8_stage_5&#45;&gt;ring_attn_2_9_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-8801C7379.02,-8801 7537.86,-8801 7537.86,-8801"/>
<polygon fill="red" stroke="red" points="7537.86,-8804.5 7547.86,-8801 7537.86,-8797.5 7537.86,-8804.5"/>
</g>
<!-- ring_attn_2_8_stage_6&#45;&gt;ring_attn_2_8_stage_7 -->
<g id="edge834" class="edge">
<title>ring_attn_2_8_stage_6&#45;&gt;ring_attn_2_8_stage_7</title>
<path fill="none" stroke="black" d="M7170,-8479.87C7170,-8479.87 7170,-8373.25 7170,-8373.25"/>
<polygon fill="black" stroke="black" points="7173.5,-8373.25 7170,-8363.25 7166.5,-8373.25 7173.5,-8373.25"/>
</g>
<!-- ring_attn_2_9_stage_6 -->
<g id="node940" class="node">
<title>ring_attn_2_9_stage_6</title>
<polygon fill="yellow" stroke="black" points="7757,-8616 7548,-8548 7757,-8480 7966,-8548 7757,-8616"/>
<text text-anchor="middle" x="7757" y="-8566.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-8551.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="7757" y="-8536.8" font-family="Times,serif" font-size="14.00">Q[9]×K[3]×V[3]</text>
<text text-anchor="middle" x="7757" y="-8521.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_8_stage_6&#45;&gt;ring_attn_2_9_stage_6 -->
<g id="edge2613" class="edge">
<title>ring_attn_2_8_stage_6&#45;&gt;ring_attn_2_9_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-8548C7379.02,-8548 7537.86,-8548 7537.86,-8548"/>
<polygon fill="red" stroke="red" points="7537.86,-8551.5 7547.86,-8548 7537.86,-8544.5 7537.86,-8551.5"/>
</g>
<!-- ring_attn_2_8_stage_7&#45;&gt;ring_attn_2_8_stage_8 -->
<g id="edge835" class="edge">
<title>ring_attn_2_8_stage_7&#45;&gt;ring_attn_2_8_stage_8</title>
<path fill="none" stroke="black" d="M7170,-8226.87C7170,-8226.87 7170,-8120.25 7170,-8120.25"/>
<polygon fill="black" stroke="black" points="7173.5,-8120.25 7170,-8110.25 7166.5,-8120.25 7173.5,-8120.25"/>
</g>
<!-- ring_attn_2_9_stage_7 -->
<g id="node941" class="node">
<title>ring_attn_2_9_stage_7</title>
<polygon fill="yellow" stroke="black" points="7757,-8363 7548,-8295 7757,-8227 7966,-8295 7757,-8363"/>
<text text-anchor="middle" x="7757" y="-8313.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-8298.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="7757" y="-8283.8" font-family="Times,serif" font-size="14.00">Q[9]×K[2]×V[2]</text>
<text text-anchor="middle" x="7757" y="-8268.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_8_stage_7&#45;&gt;ring_attn_2_9_stage_7 -->
<g id="edge2614" class="edge">
<title>ring_attn_2_8_stage_7&#45;&gt;ring_attn_2_9_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-8295C7379.02,-8295 7537.86,-8295 7537.86,-8295"/>
<polygon fill="red" stroke="red" points="7537.86,-8298.5 7547.86,-8295 7537.86,-8291.5 7537.86,-8298.5"/>
</g>
<!-- ring_attn_2_8_stage_8&#45;&gt;ring_attn_2_8_stage_9 -->
<g id="edge836" class="edge">
<title>ring_attn_2_8_stage_8&#45;&gt;ring_attn_2_8_stage_9</title>
<path fill="none" stroke="black" d="M7170,-7973.87C7170,-7973.87 7170,-7867.25 7170,-7867.25"/>
<polygon fill="black" stroke="black" points="7173.5,-7867.25 7170,-7857.25 7166.5,-7867.25 7173.5,-7867.25"/>
</g>
<!-- ring_attn_2_9_stage_8 -->
<g id="node942" class="node">
<title>ring_attn_2_9_stage_8</title>
<polygon fill="yellow" stroke="black" points="7757,-8110 7548,-8042 7757,-7974 7966,-8042 7757,-8110"/>
<text text-anchor="middle" x="7757" y="-8060.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-8045.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="7757" y="-8030.8" font-family="Times,serif" font-size="14.00">Q[9]×K[1]×V[1]</text>
<text text-anchor="middle" x="7757" y="-8015.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_8_stage_8&#45;&gt;ring_attn_2_9_stage_8 -->
<g id="edge2615" class="edge">
<title>ring_attn_2_8_stage_8&#45;&gt;ring_attn_2_9_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-8042C7379.02,-8042 7537.86,-8042 7537.86,-8042"/>
<polygon fill="red" stroke="red" points="7537.86,-8045.5 7547.86,-8042 7537.86,-8038.5 7537.86,-8045.5"/>
</g>
<!-- ring_attn_2_8_stage_9&#45;&gt;ring_attn_2_8_stage_10 -->
<g id="edge837" class="edge">
<title>ring_attn_2_8_stage_9&#45;&gt;ring_attn_2_8_stage_10</title>
<path fill="none" stroke="black" d="M7170,-7720.87C7170,-7720.87 7170,-7614.25 7170,-7614.25"/>
<polygon fill="black" stroke="black" points="7173.5,-7614.25 7170,-7604.25 7166.5,-7614.25 7173.5,-7614.25"/>
</g>
<!-- ring_attn_2_9_stage_9 -->
<g id="node943" class="node">
<title>ring_attn_2_9_stage_9</title>
<polygon fill="yellow" stroke="black" points="7757,-7857 7548,-7789 7757,-7721 7966,-7789 7757,-7857"/>
<text text-anchor="middle" x="7757" y="-7807.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-7792.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="7757" y="-7777.8" font-family="Times,serif" font-size="14.00">Q[9]×K[0]×V[0]</text>
<text text-anchor="middle" x="7757" y="-7762.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_8_stage_9&#45;&gt;ring_attn_2_9_stage_9 -->
<g id="edge2616" class="edge">
<title>ring_attn_2_8_stage_9&#45;&gt;ring_attn_2_9_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-7789C7379.02,-7789 7537.86,-7789 7537.86,-7789"/>
<polygon fill="red" stroke="red" points="7537.86,-7792.5 7547.86,-7789 7537.86,-7785.5 7537.86,-7792.5"/>
</g>
<!-- ring_attn_2_8_stage_10&#45;&gt;ring_attn_2_8_stage_11 -->
<g id="edge838" class="edge">
<title>ring_attn_2_8_stage_10&#45;&gt;ring_attn_2_8_stage_11</title>
<path fill="none" stroke="black" d="M7170,-7467.87C7170,-7467.87 7170,-7361.25 7170,-7361.25"/>
<polygon fill="black" stroke="black" points="7173.5,-7361.25 7170,-7351.25 7166.5,-7361.25 7173.5,-7361.25"/>
</g>
<!-- ring_attn_2_9_stage_10 -->
<g id="node944" class="node">
<title>ring_attn_2_9_stage_10</title>
<polygon fill="yellow" stroke="black" points="7757,-7604 7548,-7536 7757,-7468 7966,-7536 7757,-7604"/>
<text text-anchor="middle" x="7757" y="-7554.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-7539.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="7757" y="-7524.8" font-family="Times,serif" font-size="14.00">Q[9]×K[15]×V[15]</text>
<text text-anchor="middle" x="7757" y="-7509.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_8_stage_10&#45;&gt;ring_attn_2_9_stage_10 -->
<g id="edge2617" class="edge">
<title>ring_attn_2_8_stage_10&#45;&gt;ring_attn_2_9_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-7536C7379.02,-7536 7537.86,-7536 7537.86,-7536"/>
<polygon fill="red" stroke="red" points="7537.86,-7539.5 7547.86,-7536 7537.86,-7532.5 7537.86,-7539.5"/>
</g>
<!-- ring_attn_2_8_stage_11&#45;&gt;ring_attn_2_8_stage_12 -->
<g id="edge839" class="edge">
<title>ring_attn_2_8_stage_11&#45;&gt;ring_attn_2_8_stage_12</title>
<path fill="none" stroke="black" d="M7170,-7214.87C7170,-7214.87 7170,-7108.25 7170,-7108.25"/>
<polygon fill="black" stroke="black" points="7173.5,-7108.25 7170,-7098.25 7166.5,-7108.25 7173.5,-7108.25"/>
</g>
<!-- ring_attn_2_9_stage_11 -->
<g id="node945" class="node">
<title>ring_attn_2_9_stage_11</title>
<polygon fill="yellow" stroke="black" points="7757,-7351 7548,-7283 7757,-7215 7966,-7283 7757,-7351"/>
<text text-anchor="middle" x="7757" y="-7301.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-7286.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="7757" y="-7271.8" font-family="Times,serif" font-size="14.00">Q[9]×K[14]×V[14]</text>
<text text-anchor="middle" x="7757" y="-7256.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_8_stage_11&#45;&gt;ring_attn_2_9_stage_11 -->
<g id="edge2618" class="edge">
<title>ring_attn_2_8_stage_11&#45;&gt;ring_attn_2_9_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-7283C7379.02,-7283 7537.86,-7283 7537.86,-7283"/>
<polygon fill="red" stroke="red" points="7537.86,-7286.5 7547.86,-7283 7537.86,-7279.5 7537.86,-7286.5"/>
</g>
<!-- ring_attn_2_8_stage_12&#45;&gt;ring_attn_2_8_stage_13 -->
<g id="edge840" class="edge">
<title>ring_attn_2_8_stage_12&#45;&gt;ring_attn_2_8_stage_13</title>
<path fill="none" stroke="black" d="M7170,-6961.87C7170,-6961.87 7170,-6855.25 7170,-6855.25"/>
<polygon fill="black" stroke="black" points="7173.5,-6855.25 7170,-6845.25 7166.5,-6855.25 7173.5,-6855.25"/>
</g>
<!-- ring_attn_2_9_stage_12 -->
<g id="node946" class="node">
<title>ring_attn_2_9_stage_12</title>
<polygon fill="yellow" stroke="black" points="7757,-7098 7548,-7030 7757,-6962 7966,-7030 7757,-7098"/>
<text text-anchor="middle" x="7757" y="-7048.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-7033.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="7757" y="-7018.8" font-family="Times,serif" font-size="14.00">Q[9]×K[13]×V[13]</text>
<text text-anchor="middle" x="7757" y="-7003.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_8_stage_12&#45;&gt;ring_attn_2_9_stage_12 -->
<g id="edge2619" class="edge">
<title>ring_attn_2_8_stage_12&#45;&gt;ring_attn_2_9_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-7030C7379.02,-7030 7537.86,-7030 7537.86,-7030"/>
<polygon fill="red" stroke="red" points="7537.86,-7033.5 7547.86,-7030 7537.86,-7026.5 7537.86,-7033.5"/>
</g>
<!-- ring_attn_2_8_stage_13&#45;&gt;ring_attn_2_8_stage_14 -->
<g id="edge841" class="edge">
<title>ring_attn_2_8_stage_13&#45;&gt;ring_attn_2_8_stage_14</title>
<path fill="none" stroke="black" d="M7170,-6708.87C7170,-6708.87 7170,-6602.25 7170,-6602.25"/>
<polygon fill="black" stroke="black" points="7173.5,-6602.25 7170,-6592.25 7166.5,-6602.25 7173.5,-6602.25"/>
</g>
<!-- ring_attn_2_9_stage_13 -->
<g id="node947" class="node">
<title>ring_attn_2_9_stage_13</title>
<polygon fill="yellow" stroke="black" points="7757,-6845 7548,-6777 7757,-6709 7966,-6777 7757,-6845"/>
<text text-anchor="middle" x="7757" y="-6795.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-6780.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="7757" y="-6765.8" font-family="Times,serif" font-size="14.00">Q[9]×K[12]×V[12]</text>
<text text-anchor="middle" x="7757" y="-6750.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_8_stage_13&#45;&gt;ring_attn_2_9_stage_13 -->
<g id="edge2620" class="edge">
<title>ring_attn_2_8_stage_13&#45;&gt;ring_attn_2_9_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-6777C7379.02,-6777 7537.86,-6777 7537.86,-6777"/>
<polygon fill="red" stroke="red" points="7537.86,-6780.5 7547.86,-6777 7537.86,-6773.5 7537.86,-6780.5"/>
</g>
<!-- ring_attn_2_8_stage_14&#45;&gt;ring_attn_2_8_stage_15 -->
<g id="edge842" class="edge">
<title>ring_attn_2_8_stage_14&#45;&gt;ring_attn_2_8_stage_15</title>
<path fill="none" stroke="black" d="M7170,-6455.87C7170,-6455.87 7170,-6349.25 7170,-6349.25"/>
<polygon fill="black" stroke="black" points="7173.5,-6349.25 7170,-6339.25 7166.5,-6349.25 7173.5,-6349.25"/>
</g>
<!-- ring_attn_2_9_stage_14 -->
<g id="node948" class="node">
<title>ring_attn_2_9_stage_14</title>
<polygon fill="yellow" stroke="black" points="7757,-6592 7548,-6524 7757,-6456 7966,-6524 7757,-6592"/>
<text text-anchor="middle" x="7757" y="-6542.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-6527.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="7757" y="-6512.8" font-family="Times,serif" font-size="14.00">Q[9]×K[11]×V[11]</text>
<text text-anchor="middle" x="7757" y="-6497.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_8_stage_14&#45;&gt;ring_attn_2_9_stage_14 -->
<g id="edge2621" class="edge">
<title>ring_attn_2_8_stage_14&#45;&gt;ring_attn_2_9_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-6524C7379.02,-6524 7537.86,-6524 7537.86,-6524"/>
<polygon fill="red" stroke="red" points="7537.86,-6527.5 7547.86,-6524 7537.86,-6520.5 7537.86,-6527.5"/>
</g>
<!-- attn_out_2_8 -->
<g id="node852" class="node">
<title>attn_out_2_8</title>
<polygon fill="none" stroke="black" points="7239.5,-6130 7100.5,-6130 7100.5,-6077 7239.5,-6077 7239.5,-6130"/>
<text text-anchor="middle" x="7170" y="-6114.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="7170" y="-6099.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="7170" y="-6084.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_2_8_stage_15&#45;&gt;attn_out_2_8 -->
<g id="edge843" class="edge">
<title>ring_attn_2_8_stage_15&#45;&gt;attn_out_2_8</title>
<path fill="none" stroke="black" d="M7170,-6202.87C7170,-6202.87 7170,-6140.18 7170,-6140.18"/>
<polygon fill="black" stroke="black" points="7173.5,-6140.18 7170,-6130.18 7166.5,-6140.18 7173.5,-6140.18"/>
</g>
<!-- ring_attn_2_9_stage_15 -->
<g id="node949" class="node">
<title>ring_attn_2_9_stage_15</title>
<polygon fill="yellow" stroke="black" points="7757,-6339 7548,-6271 7757,-6203 7966,-6271 7757,-6339"/>
<text text-anchor="middle" x="7757" y="-6289.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-6274.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="7757" y="-6259.8" font-family="Times,serif" font-size="14.00">Q[9]×K[10]×V[10]</text>
<text text-anchor="middle" x="7757" y="-6244.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_8_stage_15&#45;&gt;ring_attn_2_9_stage_15 -->
<g id="edge2622" class="edge">
<title>ring_attn_2_8_stage_15&#45;&gt;ring_attn_2_9_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-6271C7379.02,-6271 7537.86,-6271 7537.86,-6271"/>
<polygon fill="red" stroke="red" points="7537.86,-6274.5 7547.86,-6271 7537.86,-6267.5 7537.86,-6274.5"/>
</g>
<!-- attn_residual_2_8 -->
<g id="node853" class="node">
<title>attn_residual_2_8</title>
<ellipse fill="none" stroke="black" cx="7170" cy="-5977" rx="105.5" ry="27"/>
<text text-anchor="middle" x="7170" y="-5980.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="7170" y="-5965.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_2_8&#45;&gt;attn_residual_2_8 -->
<g id="edge844" class="edge">
<title>attn_out_2_8&#45;&gt;attn_residual_2_8</title>
<path fill="none" stroke="black" d="M7170,-6076.98C7170,-6076.98 7170,-6014.36 7170,-6014.36"/>
<polygon fill="black" stroke="black" points="7173.5,-6014.36 7170,-6004.36 7166.5,-6014.36 7173.5,-6014.36"/>
</g>
<!-- gate_2_8 -->
<g id="node854" class="node">
<title>gate_2_8</title>
<ellipse fill="orange" stroke="black" cx="7170" cy="-5839.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="7170" y="-5850.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="7170" y="-5835.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="7170" y="-5820.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_2_8&#45;&gt;gate_2_8 -->
<g id="edge845" class="edge">
<title>attn_residual_2_8&#45;&gt;gate_2_8</title>
<path fill="none" stroke="black" d="M7205.17,-5951.46C7205.17,-5951.46 7205.17,-5885.01 7205.17,-5885.01"/>
<polygon fill="black" stroke="black" points="7208.67,-5885.01 7205.17,-5875.01 7201.67,-5885.01 7208.67,-5885.01"/>
</g>
<!-- gate_2_8&#45;&gt;expert_2_0_0 -->
<g id="edge2623" class="edge">
<title>gate_2_8&#45;&gt;expert_2_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7134.83,-5874.99C7134.83,-5899.61 7134.83,-5928 7134.83,-5928 7134.83,-5928 332.43,-5928 332.43,-5928 332.43,-5928 332.43,-5680.01 332.43,-5680.01"/>
<polygon fill="blue" stroke="blue" points="335.93,-5680.01 332.43,-5670.01 328.93,-5680.01 335.93,-5680.01"/>
<text text-anchor="middle" x="29876.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29876.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU8→GPU0</text>
<text text-anchor="middle" x="29876.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29876.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_8&#45;&gt;expert_2_1_0 -->
<g id="edge2624" class="edge">
<title>gate_2_8&#45;&gt;expert_2_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7073.67,-5824.14C7073.67,-5792.29 7073.67,-5722 7073.67,-5722 7073.67,-5722 3003.45,-5722 3003.45,-5722 3003.45,-5722 3003.45,-5680.08 3003.45,-5680.08"/>
<polygon fill="blue" stroke="blue" points="3006.95,-5680.08 3003.45,-5670.08 2999.95,-5680.08 3006.95,-5680.08"/>
<text text-anchor="middle" x="30050.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30050.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU8→GPU1</text>
<text text-anchor="middle" x="30050.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30050.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_8&#45;&gt;expert_2_2_0 -->
<g id="edge2625" class="edge">
<title>gate_2_8&#45;&gt;expert_2_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7092.02,-5814.08C7092.02,-5779.26 7092.02,-5721 7092.02,-5721 7092.02,-5721 3597.2,-5721 3597.2,-5721 3597.2,-5721 3597.2,-5680.17 3597.2,-5680.17"/>
<polygon fill="blue" stroke="blue" points="3600.7,-5680.17 3597.2,-5670.17 3593.7,-5680.17 3600.7,-5680.17"/>
<text text-anchor="middle" x="30224.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30224.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU8→GPU2</text>
<text text-anchor="middle" x="30224.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30224.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_8&#45;&gt;expert_2_3_0 -->
<g id="edge2626" class="edge">
<title>gate_2_8&#45;&gt;expert_2_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7110.37,-5808.43C7110.37,-5775.74 7110.37,-5729 7110.37,-5729 7110.37,-5729 4188.58,-5729 4188.58,-5729 4188.58,-5729 4188.58,-5680.08 4188.58,-5680.08"/>
<polygon fill="blue" stroke="blue" points="4192.08,-5680.08 4188.58,-5670.08 4185.08,-5680.08 4192.08,-5680.08"/>
<text text-anchor="middle" x="30398.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30398.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU8→GPU3</text>
<text text-anchor="middle" x="30398.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30398.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_8&#45;&gt;expert_2_4_0 -->
<g id="edge2627" class="edge">
<title>gate_2_8&#45;&gt;expert_2_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7128.72,-5804.86C7128.72,-5783.44 7128.72,-5760 7128.72,-5760 7128.72,-5760 4786.83,-5760 4786.83,-5760 4786.83,-5760 4786.83,-5680.23 4786.83,-5680.23"/>
<polygon fill="blue" stroke="blue" points="4790.33,-5680.23 4786.83,-5670.23 4783.33,-5680.23 4790.33,-5680.23"/>
<text text-anchor="middle" x="30572.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30572.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU8→GPU4</text>
<text text-anchor="middle" x="30572.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30572.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_8&#45;&gt;expert_2_5_0 -->
<g id="edge2628" class="edge">
<title>gate_2_8&#45;&gt;expert_2_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7147.07,-5802.83C7147.07,-5784.84 7147.07,-5767 7147.07,-5767 7147.07,-5767 5383.88,-5767 5383.88,-5767 5383.88,-5767 5383.88,-5680.3 5383.88,-5680.3"/>
<polygon fill="blue" stroke="blue" points="5387.38,-5680.3 5383.88,-5670.3 5380.38,-5680.3 5387.38,-5680.3"/>
<text text-anchor="middle" x="30746.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30746.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU8→GPU5</text>
<text text-anchor="middle" x="30746.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30746.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_8&#45;&gt;expert_2_6_0 -->
<g id="edge2629" class="edge">
<title>gate_2_8&#45;&gt;expert_2_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7156.24,-5801.97C7156.24,-5796.68 7156.24,-5793 7156.24,-5793 7156.24,-5793 6111.62,-5793 6111.62,-5793 6111.62,-5793 6111.62,-5680.23 6111.62,-5680.23"/>
<polygon fill="blue" stroke="blue" points="6115.13,-5680.23 6111.62,-5670.23 6108.13,-5680.23 6115.13,-5680.23"/>
<text text-anchor="middle" x="30920.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30920.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU8→GPU6</text>
<text text-anchor="middle" x="30920.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30920.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_8&#45;&gt;expert_2_7_0 -->
<g id="edge2630" class="edge">
<title>gate_2_8&#45;&gt;expert_2_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7070.48,-5852C6931.26,-5852 6695.25,-5852 6695.25,-5852 6695.25,-5852 6695.25,-5680.33 6695.25,-5680.33"/>
<polygon fill="blue" stroke="blue" points="6698.75,-5680.33 6695.25,-5670.33 6691.75,-5680.33 6698.75,-5680.33"/>
<text text-anchor="middle" x="31094.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31094.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU8→GPU7</text>
<text text-anchor="middle" x="31094.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31094.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_8&#45;&gt;expert_2_8_0 -->
<g id="edge846" class="edge">
<title>gate_2_8&#45;&gt;expert_2_8_0</title>
<path fill="none" stroke="black" d="M7165.41,-5801.71C7165.41,-5801.71 7165.41,-5680.18 7165.41,-5680.18"/>
<polygon fill="black" stroke="black" points="7168.91,-5680.18 7165.41,-5670.18 7161.91,-5680.18 7168.91,-5680.18"/>
</g>
<!-- gate_2_8&#45;&gt;expert_2_9_0 -->
<g id="edge2631" class="edge">
<title>gate_2_8&#45;&gt;expert_2_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7269.65,-5827C7409.77,-5827 7648.12,-5827 7648.12,-5827 7648.12,-5827 7648.12,-5680.18 7648.12,-5680.18"/>
<polygon fill="blue" stroke="blue" points="7651.63,-5680.18 7648.12,-5670.18 7644.63,-5680.18 7651.63,-5680.18"/>
<text text-anchor="middle" x="31268.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31268.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU8→GPU9</text>
<text text-anchor="middle" x="31268.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31268.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_8&#45;&gt;expert_2_10_0 -->
<g id="edge2632" class="edge">
<title>gate_2_8&#45;&gt;expert_2_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7220.46,-5806.54C7220.46,-5795.06 7220.46,-5785 7220.46,-5785 7220.46,-5785 8230.4,-5785 8230.4,-5785 8230.4,-5785 8230.4,-5680.12 8230.4,-5680.12"/>
<polygon fill="blue" stroke="blue" points="8233.9,-5680.12 8230.4,-5670.12 8226.9,-5680.12 8233.9,-5680.12"/>
<text text-anchor="middle" x="31442.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31442.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU8→GPU10</text>
<text text-anchor="middle" x="31442.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31442.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_8&#45;&gt;expert_2_11_0 -->
<g id="edge2633" class="edge">
<title>gate_2_8&#45;&gt;expert_2_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7229.63,-5808.52C7229.63,-5784.4 7229.63,-5755 7229.63,-5755 7229.63,-5755 8815.38,-5755 8815.38,-5755 8815.38,-5755 8815.38,-5680.21 8815.38,-5680.21"/>
<polygon fill="blue" stroke="blue" points="8818.88,-5680.21 8815.38,-5670.21 8811.88,-5680.21 8818.88,-5680.21"/>
<text text-anchor="middle" x="31616.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31616.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU8→GPU11</text>
<text text-anchor="middle" x="31616.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31616.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_8&#45;&gt;expert_2_12_0 -->
<g id="edge2634" class="edge">
<title>gate_2_8&#45;&gt;expert_2_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7238.8,-5810.99C7238.8,-5783.81 7238.8,-5747 7238.8,-5747 7238.8,-5747 9559.28,-5747 9559.28,-5747 9559.28,-5747 9559.28,-5680.15 9559.28,-5680.15"/>
<polygon fill="blue" stroke="blue" points="9562.78,-5680.15 9559.28,-5670.15 9555.78,-5680.15 9562.78,-5680.15"/>
<text text-anchor="middle" x="31790.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31790.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU8→GPU12</text>
<text text-anchor="middle" x="31790.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31790.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_8&#45;&gt;expert_2_13_0 -->
<g id="edge2635" class="edge">
<title>gate_2_8&#45;&gt;expert_2_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7247.98,-5814.14C7247.98,-5785.25 7247.98,-5742 7247.98,-5742 7247.98,-5742 10151.42,-5742 10151.42,-5742 10151.42,-5742 10151.42,-5680.16 10151.42,-5680.16"/>
<polygon fill="blue" stroke="blue" points="10154.92,-5680.16 10151.42,-5670.16 10147.92,-5680.16 10154.92,-5680.16"/>
<text text-anchor="middle" x="31964.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31964.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU8→GPU13</text>
<text text-anchor="middle" x="31964.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31964.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_8&#45;&gt;expert_2_14_0 -->
<g id="edge2636" class="edge">
<title>gate_2_8&#45;&gt;expert_2_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7257.15,-5818.17C7257.15,-5779.78 7257.15,-5703 7257.15,-5703 7257.15,-5703 10717.12,-5703 10717.12,-5703 10717.12,-5703 10717.12,-5680.12 10717.12,-5680.12"/>
<polygon fill="blue" stroke="blue" points="10720.62,-5680.12 10717.12,-5670.12 10713.62,-5680.12 10720.62,-5680.12"/>
<text text-anchor="middle" x="32138.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="32138.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU8→GPU14</text>
<text text-anchor="middle" x="32138.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="32138.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_8&#45;&gt;expert_2_15_0 -->
<g id="edge2637" class="edge">
<title>gate_2_8&#45;&gt;expert_2_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7266.33,-5823.79C7266.33,-5791.99 7266.33,-5723 7266.33,-5723 7266.33,-5723 11284.55,-5723 11284.55,-5723 11284.55,-5723 11284.55,-5680.42 11284.55,-5680.42"/>
<polygon fill="blue" stroke="blue" points="11288.05,-5680.42 11284.55,-5670.42 11281.05,-5680.42 11288.05,-5680.42"/>
<text text-anchor="middle" x="32312.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="32312.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU8→GPU15</text>
<text text-anchor="middle" x="32312.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="32312.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_8 -->
<g id="node856" class="node">
<title>expert_reduce_2_8</title>
<ellipse fill="none" stroke="black" cx="7170" cy="-5506.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="7170" y="-5517.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="7170" y="-5502.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="7170" y="-5487.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_8_0&#45;&gt;expert_reduce_2_8 -->
<g id="edge847" class="edge">
<title>expert_2_8_0&#45;&gt;expert_reduce_2_8</title>
<path fill="none" stroke="black" d="M7170,-5616.76C7170,-5616.76 7170,-5554.06 7170,-5554.06"/>
<polygon fill="black" stroke="black" points="7173.5,-5554.06 7170,-5544.06 7166.5,-5554.06 7173.5,-5554.06"/>
</g>
<!-- moe_residual_2_8 -->
<g id="node857" class="node">
<title>moe_residual_2_8</title>
<ellipse fill="none" stroke="black" cx="7170" cy="-5369" rx="105.5" ry="27"/>
<text text-anchor="middle" x="7170" y="-5372.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="7170" y="-5357.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_8&#45;&gt;moe_residual_2_8 -->
<g id="edge848" class="edge">
<title>expert_reduce_2_8&#45;&gt;moe_residual_2_8</title>
<path fill="none" stroke="black" d="M7170,-5468.93C7170,-5468.93 7170,-5406.06 7170,-5406.06"/>
<polygon fill="black" stroke="black" points="7173.5,-5406.06 7170,-5396.06 7166.5,-5406.06 7173.5,-5406.06"/>
</g>
<!-- qkv_proj_3_8 -->
<g id="node858" class="node">
<title>qkv_proj_3_8</title>
<polygon fill="none" stroke="black" points="7252.5,-5269 7087.5,-5269 7087.5,-5216 7252.5,-5216 7252.5,-5269"/>
<text text-anchor="middle" x="7170" y="-5253.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="7170" y="-5238.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="7170" y="-5223.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_2_8&#45;&gt;qkv_proj_3_8 -->
<g id="edge849" class="edge">
<title>moe_residual_2_8&#45;&gt;qkv_proj_3_8</title>
<path fill="none" stroke="black" d="M7170,-5341.86C7170,-5341.86 7170,-5279.16 7170,-5279.16"/>
<polygon fill="black" stroke="black" points="7173.5,-5279.16 7170,-5269.16 7166.5,-5279.16 7173.5,-5279.16"/>
</g>
<!-- qkv_reshape_3_8 -->
<g id="node859" class="node">
<title>qkv_reshape_3_8</title>
<ellipse fill="none" stroke="black" cx="7170" cy="-5116" rx="148" ry="27"/>
<text text-anchor="middle" x="7170" y="-5119.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="7170" y="-5104.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_3_8&#45;&gt;qkv_reshape_3_8 -->
<g id="edge850" class="edge">
<title>qkv_proj_3_8&#45;&gt;qkv_reshape_3_8</title>
<path fill="none" stroke="black" d="M7170,-5215.98C7170,-5215.98 7170,-5153.36 7170,-5153.36"/>
<polygon fill="black" stroke="black" points="7173.5,-5153.36 7170,-5143.36 7166.5,-5153.36 7173.5,-5153.36"/>
</g>
<!-- qkv_reshape_3_8&#45;&gt;ring_attn_3_8_stage_0 -->
<g id="edge851" class="edge">
<title>qkv_reshape_3_8&#45;&gt;ring_attn_3_8_stage_0</title>
<path fill="none" stroke="black" d="M7170,-5088.72C7170,-5088.72 7170,-4982.16 7170,-4982.16"/>
<polygon fill="black" stroke="black" points="7173.5,-4982.16 7170,-4972.16 7166.5,-4982.16 7173.5,-4982.16"/>
</g>
<!-- ring_attn_3_8_stage_0&#45;&gt;ring_attn_3_8_stage_1 -->
<g id="edge852" class="edge">
<title>ring_attn_3_8_stage_0&#45;&gt;ring_attn_3_8_stage_1</title>
<path fill="none" stroke="black" d="M7170,-4835.87C7170,-4835.87 7170,-4729.25 7170,-4729.25"/>
<polygon fill="black" stroke="black" points="7173.5,-4729.25 7170,-4719.25 7166.5,-4729.25 7173.5,-4729.25"/>
</g>
<!-- ring_attn_3_9_stage_0 -->
<g id="node958" class="node">
<title>ring_attn_3_9_stage_0</title>
<polygon fill="yellow" stroke="black" points="7757,-4972 7548,-4904 7757,-4836 7966,-4904 7757,-4972"/>
<text text-anchor="middle" x="7757" y="-4922.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-4907.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="7757" y="-4892.8" font-family="Times,serif" font-size="14.00">Q[9]×K[9]×V[9]</text>
<text text-anchor="middle" x="7757" y="-4877.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_8_stage_0&#45;&gt;ring_attn_3_9_stage_0 -->
<g id="edge2638" class="edge">
<title>ring_attn_3_8_stage_0&#45;&gt;ring_attn_3_9_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-4904C7379.02,-4904 7537.86,-4904 7537.86,-4904"/>
<polygon fill="red" stroke="red" points="7537.86,-4907.5 7547.86,-4904 7537.86,-4900.5 7537.86,-4907.5"/>
</g>
<!-- ring_attn_3_8_stage_1&#45;&gt;ring_attn_3_8_stage_2 -->
<g id="edge853" class="edge">
<title>ring_attn_3_8_stage_1&#45;&gt;ring_attn_3_8_stage_2</title>
<path fill="none" stroke="black" d="M7170,-4582.87C7170,-4582.87 7170,-4476.25 7170,-4476.25"/>
<polygon fill="black" stroke="black" points="7173.5,-4476.25 7170,-4466.25 7166.5,-4476.25 7173.5,-4476.25"/>
</g>
<!-- ring_attn_3_9_stage_1 -->
<g id="node959" class="node">
<title>ring_attn_3_9_stage_1</title>
<polygon fill="yellow" stroke="black" points="7757,-4719 7548,-4651 7757,-4583 7966,-4651 7757,-4719"/>
<text text-anchor="middle" x="7757" y="-4669.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-4654.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="7757" y="-4639.8" font-family="Times,serif" font-size="14.00">Q[9]×K[8]×V[8]</text>
<text text-anchor="middle" x="7757" y="-4624.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_8_stage_1&#45;&gt;ring_attn_3_9_stage_1 -->
<g id="edge2639" class="edge">
<title>ring_attn_3_8_stage_1&#45;&gt;ring_attn_3_9_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-4651C7379.02,-4651 7537.86,-4651 7537.86,-4651"/>
<polygon fill="red" stroke="red" points="7537.86,-4654.5 7547.86,-4651 7537.86,-4647.5 7537.86,-4654.5"/>
</g>
<!-- ring_attn_3_8_stage_2&#45;&gt;ring_attn_3_8_stage_3 -->
<g id="edge854" class="edge">
<title>ring_attn_3_8_stage_2&#45;&gt;ring_attn_3_8_stage_3</title>
<path fill="none" stroke="black" d="M7170,-4329.87C7170,-4329.87 7170,-4223.25 7170,-4223.25"/>
<polygon fill="black" stroke="black" points="7173.5,-4223.25 7170,-4213.25 7166.5,-4223.25 7173.5,-4223.25"/>
</g>
<!-- ring_attn_3_9_stage_2 -->
<g id="node960" class="node">
<title>ring_attn_3_9_stage_2</title>
<polygon fill="yellow" stroke="black" points="7757,-4466 7548,-4398 7757,-4330 7966,-4398 7757,-4466"/>
<text text-anchor="middle" x="7757" y="-4416.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-4401.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="7757" y="-4386.8" font-family="Times,serif" font-size="14.00">Q[9]×K[7]×V[7]</text>
<text text-anchor="middle" x="7757" y="-4371.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_8_stage_2&#45;&gt;ring_attn_3_9_stage_2 -->
<g id="edge2640" class="edge">
<title>ring_attn_3_8_stage_2&#45;&gt;ring_attn_3_9_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-4398C7379.02,-4398 7537.86,-4398 7537.86,-4398"/>
<polygon fill="red" stroke="red" points="7537.86,-4401.5 7547.86,-4398 7537.86,-4394.5 7537.86,-4401.5"/>
</g>
<!-- ring_attn_3_8_stage_3&#45;&gt;ring_attn_3_8_stage_4 -->
<g id="edge855" class="edge">
<title>ring_attn_3_8_stage_3&#45;&gt;ring_attn_3_8_stage_4</title>
<path fill="none" stroke="black" d="M7170,-4076.87C7170,-4076.87 7170,-3970.25 7170,-3970.25"/>
<polygon fill="black" stroke="black" points="7173.5,-3970.25 7170,-3960.25 7166.5,-3970.25 7173.5,-3970.25"/>
</g>
<!-- ring_attn_3_9_stage_3 -->
<g id="node961" class="node">
<title>ring_attn_3_9_stage_3</title>
<polygon fill="yellow" stroke="black" points="7757,-4213 7548,-4145 7757,-4077 7966,-4145 7757,-4213"/>
<text text-anchor="middle" x="7757" y="-4163.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-4148.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="7757" y="-4133.8" font-family="Times,serif" font-size="14.00">Q[9]×K[6]×V[6]</text>
<text text-anchor="middle" x="7757" y="-4118.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_8_stage_3&#45;&gt;ring_attn_3_9_stage_3 -->
<g id="edge2641" class="edge">
<title>ring_attn_3_8_stage_3&#45;&gt;ring_attn_3_9_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-4145C7379.02,-4145 7537.86,-4145 7537.86,-4145"/>
<polygon fill="red" stroke="red" points="7537.86,-4148.5 7547.86,-4145 7537.86,-4141.5 7537.86,-4148.5"/>
</g>
<!-- ring_attn_3_8_stage_4&#45;&gt;ring_attn_3_8_stage_5 -->
<g id="edge856" class="edge">
<title>ring_attn_3_8_stage_4&#45;&gt;ring_attn_3_8_stage_5</title>
<path fill="none" stroke="black" d="M7170,-3823.87C7170,-3823.87 7170,-3717.25 7170,-3717.25"/>
<polygon fill="black" stroke="black" points="7173.5,-3717.25 7170,-3707.25 7166.5,-3717.25 7173.5,-3717.25"/>
</g>
<!-- ring_attn_3_9_stage_4 -->
<g id="node962" class="node">
<title>ring_attn_3_9_stage_4</title>
<polygon fill="yellow" stroke="black" points="7757,-3960 7548,-3892 7757,-3824 7966,-3892 7757,-3960"/>
<text text-anchor="middle" x="7757" y="-3910.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-3895.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="7757" y="-3880.8" font-family="Times,serif" font-size="14.00">Q[9]×K[5]×V[5]</text>
<text text-anchor="middle" x="7757" y="-3865.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_8_stage_4&#45;&gt;ring_attn_3_9_stage_4 -->
<g id="edge2642" class="edge">
<title>ring_attn_3_8_stage_4&#45;&gt;ring_attn_3_9_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-3892C7379.02,-3892 7537.86,-3892 7537.86,-3892"/>
<polygon fill="red" stroke="red" points="7537.86,-3895.5 7547.86,-3892 7537.86,-3888.5 7537.86,-3895.5"/>
</g>
<!-- ring_attn_3_8_stage_5&#45;&gt;ring_attn_3_8_stage_6 -->
<g id="edge857" class="edge">
<title>ring_attn_3_8_stage_5&#45;&gt;ring_attn_3_8_stage_6</title>
<path fill="none" stroke="black" d="M7170,-3570.87C7170,-3570.87 7170,-3464.25 7170,-3464.25"/>
<polygon fill="black" stroke="black" points="7173.5,-3464.25 7170,-3454.25 7166.5,-3464.25 7173.5,-3464.25"/>
</g>
<!-- ring_attn_3_9_stage_5 -->
<g id="node963" class="node">
<title>ring_attn_3_9_stage_5</title>
<polygon fill="yellow" stroke="black" points="7757,-3707 7548,-3639 7757,-3571 7966,-3639 7757,-3707"/>
<text text-anchor="middle" x="7757" y="-3657.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-3642.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="7757" y="-3627.8" font-family="Times,serif" font-size="14.00">Q[9]×K[4]×V[4]</text>
<text text-anchor="middle" x="7757" y="-3612.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_8_stage_5&#45;&gt;ring_attn_3_9_stage_5 -->
<g id="edge2643" class="edge">
<title>ring_attn_3_8_stage_5&#45;&gt;ring_attn_3_9_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-3639C7379.02,-3639 7537.86,-3639 7537.86,-3639"/>
<polygon fill="red" stroke="red" points="7537.86,-3642.5 7547.86,-3639 7537.86,-3635.5 7537.86,-3642.5"/>
</g>
<!-- ring_attn_3_8_stage_6&#45;&gt;ring_attn_3_8_stage_7 -->
<g id="edge858" class="edge">
<title>ring_attn_3_8_stage_6&#45;&gt;ring_attn_3_8_stage_7</title>
<path fill="none" stroke="black" d="M7170,-3317.87C7170,-3317.87 7170,-3211.25 7170,-3211.25"/>
<polygon fill="black" stroke="black" points="7173.5,-3211.25 7170,-3201.25 7166.5,-3211.25 7173.5,-3211.25"/>
</g>
<!-- ring_attn_3_9_stage_6 -->
<g id="node964" class="node">
<title>ring_attn_3_9_stage_6</title>
<polygon fill="yellow" stroke="black" points="7757,-3454 7548,-3386 7757,-3318 7966,-3386 7757,-3454"/>
<text text-anchor="middle" x="7757" y="-3404.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-3389.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="7757" y="-3374.8" font-family="Times,serif" font-size="14.00">Q[9]×K[3]×V[3]</text>
<text text-anchor="middle" x="7757" y="-3359.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_8_stage_6&#45;&gt;ring_attn_3_9_stage_6 -->
<g id="edge2644" class="edge">
<title>ring_attn_3_8_stage_6&#45;&gt;ring_attn_3_9_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-3386C7379.02,-3386 7537.86,-3386 7537.86,-3386"/>
<polygon fill="red" stroke="red" points="7537.86,-3389.5 7547.86,-3386 7537.86,-3382.5 7537.86,-3389.5"/>
</g>
<!-- ring_attn_3_8_stage_7&#45;&gt;ring_attn_3_8_stage_8 -->
<g id="edge859" class="edge">
<title>ring_attn_3_8_stage_7&#45;&gt;ring_attn_3_8_stage_8</title>
<path fill="none" stroke="black" d="M7170,-3064.87C7170,-3064.87 7170,-2958.25 7170,-2958.25"/>
<polygon fill="black" stroke="black" points="7173.5,-2958.25 7170,-2948.25 7166.5,-2958.25 7173.5,-2958.25"/>
</g>
<!-- ring_attn_3_9_stage_7 -->
<g id="node965" class="node">
<title>ring_attn_3_9_stage_7</title>
<polygon fill="yellow" stroke="black" points="7757,-3201 7548,-3133 7757,-3065 7966,-3133 7757,-3201"/>
<text text-anchor="middle" x="7757" y="-3151.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-3136.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="7757" y="-3121.8" font-family="Times,serif" font-size="14.00">Q[9]×K[2]×V[2]</text>
<text text-anchor="middle" x="7757" y="-3106.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_8_stage_7&#45;&gt;ring_attn_3_9_stage_7 -->
<g id="edge2645" class="edge">
<title>ring_attn_3_8_stage_7&#45;&gt;ring_attn_3_9_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-3133C7379.02,-3133 7537.86,-3133 7537.86,-3133"/>
<polygon fill="red" stroke="red" points="7537.86,-3136.5 7547.86,-3133 7537.86,-3129.5 7537.86,-3136.5"/>
</g>
<!-- ring_attn_3_8_stage_8&#45;&gt;ring_attn_3_8_stage_9 -->
<g id="edge860" class="edge">
<title>ring_attn_3_8_stage_8&#45;&gt;ring_attn_3_8_stage_9</title>
<path fill="none" stroke="black" d="M7170,-2811.87C7170,-2811.87 7170,-2705.25 7170,-2705.25"/>
<polygon fill="black" stroke="black" points="7173.5,-2705.25 7170,-2695.25 7166.5,-2705.25 7173.5,-2705.25"/>
</g>
<!-- ring_attn_3_9_stage_8 -->
<g id="node966" class="node">
<title>ring_attn_3_9_stage_8</title>
<polygon fill="yellow" stroke="black" points="7757,-2948 7548,-2880 7757,-2812 7966,-2880 7757,-2948"/>
<text text-anchor="middle" x="7757" y="-2898.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-2883.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="7757" y="-2868.8" font-family="Times,serif" font-size="14.00">Q[9]×K[1]×V[1]</text>
<text text-anchor="middle" x="7757" y="-2853.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_8_stage_8&#45;&gt;ring_attn_3_9_stage_8 -->
<g id="edge2646" class="edge">
<title>ring_attn_3_8_stage_8&#45;&gt;ring_attn_3_9_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-2880C7379.02,-2880 7537.86,-2880 7537.86,-2880"/>
<polygon fill="red" stroke="red" points="7537.86,-2883.5 7547.86,-2880 7537.86,-2876.5 7537.86,-2883.5"/>
</g>
<!-- ring_attn_3_8_stage_9&#45;&gt;ring_attn_3_8_stage_10 -->
<g id="edge861" class="edge">
<title>ring_attn_3_8_stage_9&#45;&gt;ring_attn_3_8_stage_10</title>
<path fill="none" stroke="black" d="M7170,-2558.87C7170,-2558.87 7170,-2452.25 7170,-2452.25"/>
<polygon fill="black" stroke="black" points="7173.5,-2452.25 7170,-2442.25 7166.5,-2452.25 7173.5,-2452.25"/>
</g>
<!-- ring_attn_3_9_stage_9 -->
<g id="node967" class="node">
<title>ring_attn_3_9_stage_9</title>
<polygon fill="yellow" stroke="black" points="7757,-2695 7548,-2627 7757,-2559 7966,-2627 7757,-2695"/>
<text text-anchor="middle" x="7757" y="-2645.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-2630.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="7757" y="-2615.8" font-family="Times,serif" font-size="14.00">Q[9]×K[0]×V[0]</text>
<text text-anchor="middle" x="7757" y="-2600.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_8_stage_9&#45;&gt;ring_attn_3_9_stage_9 -->
<g id="edge2647" class="edge">
<title>ring_attn_3_8_stage_9&#45;&gt;ring_attn_3_9_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-2627C7379.02,-2627 7537.86,-2627 7537.86,-2627"/>
<polygon fill="red" stroke="red" points="7537.86,-2630.5 7547.86,-2627 7537.86,-2623.5 7537.86,-2630.5"/>
</g>
<!-- ring_attn_3_8_stage_10&#45;&gt;ring_attn_3_8_stage_11 -->
<g id="edge862" class="edge">
<title>ring_attn_3_8_stage_10&#45;&gt;ring_attn_3_8_stage_11</title>
<path fill="none" stroke="black" d="M7170,-2305.87C7170,-2305.87 7170,-2199.25 7170,-2199.25"/>
<polygon fill="black" stroke="black" points="7173.5,-2199.25 7170,-2189.25 7166.5,-2199.25 7173.5,-2199.25"/>
</g>
<!-- ring_attn_3_9_stage_10 -->
<g id="node968" class="node">
<title>ring_attn_3_9_stage_10</title>
<polygon fill="yellow" stroke="black" points="7757,-2442 7548,-2374 7757,-2306 7966,-2374 7757,-2442"/>
<text text-anchor="middle" x="7757" y="-2392.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-2377.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="7757" y="-2362.8" font-family="Times,serif" font-size="14.00">Q[9]×K[15]×V[15]</text>
<text text-anchor="middle" x="7757" y="-2347.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_8_stage_10&#45;&gt;ring_attn_3_9_stage_10 -->
<g id="edge2648" class="edge">
<title>ring_attn_3_8_stage_10&#45;&gt;ring_attn_3_9_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-2374C7379.02,-2374 7537.86,-2374 7537.86,-2374"/>
<polygon fill="red" stroke="red" points="7537.86,-2377.5 7547.86,-2374 7537.86,-2370.5 7537.86,-2377.5"/>
</g>
<!-- ring_attn_3_8_stage_11&#45;&gt;ring_attn_3_8_stage_12 -->
<g id="edge863" class="edge">
<title>ring_attn_3_8_stage_11&#45;&gt;ring_attn_3_8_stage_12</title>
<path fill="none" stroke="black" d="M7170,-2052.87C7170,-2052.87 7170,-1946.25 7170,-1946.25"/>
<polygon fill="black" stroke="black" points="7173.5,-1946.25 7170,-1936.25 7166.5,-1946.25 7173.5,-1946.25"/>
</g>
<!-- ring_attn_3_9_stage_11 -->
<g id="node969" class="node">
<title>ring_attn_3_9_stage_11</title>
<polygon fill="yellow" stroke="black" points="7757,-2189 7548,-2121 7757,-2053 7966,-2121 7757,-2189"/>
<text text-anchor="middle" x="7757" y="-2139.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-2124.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="7757" y="-2109.8" font-family="Times,serif" font-size="14.00">Q[9]×K[14]×V[14]</text>
<text text-anchor="middle" x="7757" y="-2094.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_8_stage_11&#45;&gt;ring_attn_3_9_stage_11 -->
<g id="edge2649" class="edge">
<title>ring_attn_3_8_stage_11&#45;&gt;ring_attn_3_9_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-2121C7379.02,-2121 7537.86,-2121 7537.86,-2121"/>
<polygon fill="red" stroke="red" points="7537.86,-2124.5 7547.86,-2121 7537.86,-2117.5 7537.86,-2124.5"/>
</g>
<!-- ring_attn_3_8_stage_12&#45;&gt;ring_attn_3_8_stage_13 -->
<g id="edge864" class="edge">
<title>ring_attn_3_8_stage_12&#45;&gt;ring_attn_3_8_stage_13</title>
<path fill="none" stroke="black" d="M7170,-1799.87C7170,-1799.87 7170,-1693.25 7170,-1693.25"/>
<polygon fill="black" stroke="black" points="7173.5,-1693.25 7170,-1683.25 7166.5,-1693.25 7173.5,-1693.25"/>
</g>
<!-- ring_attn_3_9_stage_12 -->
<g id="node970" class="node">
<title>ring_attn_3_9_stage_12</title>
<polygon fill="yellow" stroke="black" points="7757,-1936 7548,-1868 7757,-1800 7966,-1868 7757,-1936"/>
<text text-anchor="middle" x="7757" y="-1886.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-1871.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="7757" y="-1856.8" font-family="Times,serif" font-size="14.00">Q[9]×K[13]×V[13]</text>
<text text-anchor="middle" x="7757" y="-1841.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_8_stage_12&#45;&gt;ring_attn_3_9_stage_12 -->
<g id="edge2650" class="edge">
<title>ring_attn_3_8_stage_12&#45;&gt;ring_attn_3_9_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-1868C7379.02,-1868 7537.86,-1868 7537.86,-1868"/>
<polygon fill="red" stroke="red" points="7537.86,-1871.5 7547.86,-1868 7537.86,-1864.5 7537.86,-1871.5"/>
</g>
<!-- ring_attn_3_8_stage_13&#45;&gt;ring_attn_3_8_stage_14 -->
<g id="edge865" class="edge">
<title>ring_attn_3_8_stage_13&#45;&gt;ring_attn_3_8_stage_14</title>
<path fill="none" stroke="black" d="M7170,-1546.87C7170,-1546.87 7170,-1440.25 7170,-1440.25"/>
<polygon fill="black" stroke="black" points="7173.5,-1440.25 7170,-1430.25 7166.5,-1440.25 7173.5,-1440.25"/>
</g>
<!-- ring_attn_3_9_stage_13 -->
<g id="node971" class="node">
<title>ring_attn_3_9_stage_13</title>
<polygon fill="yellow" stroke="black" points="7757,-1683 7548,-1615 7757,-1547 7966,-1615 7757,-1683"/>
<text text-anchor="middle" x="7757" y="-1633.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-1618.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="7757" y="-1603.8" font-family="Times,serif" font-size="14.00">Q[9]×K[12]×V[12]</text>
<text text-anchor="middle" x="7757" y="-1588.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_8_stage_13&#45;&gt;ring_attn_3_9_stage_13 -->
<g id="edge2651" class="edge">
<title>ring_attn_3_8_stage_13&#45;&gt;ring_attn_3_9_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-1615C7379.02,-1615 7537.86,-1615 7537.86,-1615"/>
<polygon fill="red" stroke="red" points="7537.86,-1618.5 7547.86,-1615 7537.86,-1611.5 7537.86,-1618.5"/>
</g>
<!-- ring_attn_3_8_stage_14&#45;&gt;ring_attn_3_8_stage_15 -->
<g id="edge866" class="edge">
<title>ring_attn_3_8_stage_14&#45;&gt;ring_attn_3_8_stage_15</title>
<path fill="none" stroke="black" d="M7170,-1293.87C7170,-1293.87 7170,-1187.25 7170,-1187.25"/>
<polygon fill="black" stroke="black" points="7173.5,-1187.25 7170,-1177.25 7166.5,-1187.25 7173.5,-1187.25"/>
</g>
<!-- ring_attn_3_9_stage_14 -->
<g id="node972" class="node">
<title>ring_attn_3_9_stage_14</title>
<polygon fill="yellow" stroke="black" points="7757,-1430 7548,-1362 7757,-1294 7966,-1362 7757,-1430"/>
<text text-anchor="middle" x="7757" y="-1380.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-1365.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="7757" y="-1350.8" font-family="Times,serif" font-size="14.00">Q[9]×K[11]×V[11]</text>
<text text-anchor="middle" x="7757" y="-1335.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_8_stage_14&#45;&gt;ring_attn_3_9_stage_14 -->
<g id="edge2652" class="edge">
<title>ring_attn_3_8_stage_14&#45;&gt;ring_attn_3_9_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-1362C7379.02,-1362 7537.86,-1362 7537.86,-1362"/>
<polygon fill="red" stroke="red" points="7537.86,-1365.5 7547.86,-1362 7537.86,-1358.5 7537.86,-1365.5"/>
</g>
<!-- attn_out_3_8 -->
<g id="node876" class="node">
<title>attn_out_3_8</title>
<polygon fill="none" stroke="black" points="7239.5,-968 7100.5,-968 7100.5,-915 7239.5,-915 7239.5,-968"/>
<text text-anchor="middle" x="7170" y="-952.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="7170" y="-937.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="7170" y="-922.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_3_8_stage_15&#45;&gt;attn_out_3_8 -->
<g id="edge867" class="edge">
<title>ring_attn_3_8_stage_15&#45;&gt;attn_out_3_8</title>
<path fill="none" stroke="black" d="M7170,-1040.87C7170,-1040.87 7170,-978.18 7170,-978.18"/>
<polygon fill="black" stroke="black" points="7173.5,-978.18 7170,-968.18 7166.5,-978.18 7173.5,-978.18"/>
</g>
<!-- ring_attn_3_9_stage_15 -->
<g id="node973" class="node">
<title>ring_attn_3_9_stage_15</title>
<polygon fill="yellow" stroke="black" points="7757,-1177 7548,-1109 7757,-1041 7966,-1109 7757,-1177"/>
<text text-anchor="middle" x="7757" y="-1127.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="7757" y="-1112.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="7757" y="-1097.8" font-family="Times,serif" font-size="14.00">Q[9]×K[10]×V[10]</text>
<text text-anchor="middle" x="7757" y="-1082.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_8_stage_15&#45;&gt;ring_attn_3_9_stage_15 -->
<g id="edge2653" class="edge">
<title>ring_attn_3_8_stage_15&#45;&gt;ring_attn_3_9_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7379.02,-1109C7379.02,-1109 7537.86,-1109 7537.86,-1109"/>
<polygon fill="red" stroke="red" points="7537.86,-1112.5 7547.86,-1109 7537.86,-1105.5 7537.86,-1112.5"/>
</g>
<!-- attn_residual_3_8 -->
<g id="node877" class="node">
<title>attn_residual_3_8</title>
<ellipse fill="none" stroke="black" cx="7170" cy="-815" rx="105.5" ry="27"/>
<text text-anchor="middle" x="7170" y="-818.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="7170" y="-803.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_3_8&#45;&gt;attn_residual_3_8 -->
<g id="edge868" class="edge">
<title>attn_out_3_8&#45;&gt;attn_residual_3_8</title>
<path fill="none" stroke="black" d="M7170,-914.98C7170,-914.98 7170,-852.36 7170,-852.36"/>
<polygon fill="black" stroke="black" points="7173.5,-852.36 7170,-842.36 7166.5,-852.36 7173.5,-852.36"/>
</g>
<!-- gate_3_8 -->
<g id="node878" class="node">
<title>gate_3_8</title>
<ellipse fill="orange" stroke="black" cx="7170" cy="-677.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="7170" y="-688.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="7170" y="-673.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="7170" y="-658.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_3_8&#45;&gt;gate_3_8 -->
<g id="edge869" class="edge">
<title>attn_residual_3_8&#45;&gt;gate_3_8</title>
<path fill="none" stroke="black" d="M7205.17,-789.46C7205.17,-789.46 7205.17,-723.01 7205.17,-723.01"/>
<polygon fill="black" stroke="black" points="7208.67,-723.01 7205.17,-713.01 7201.67,-723.01 7208.67,-723.01"/>
</g>
<!-- gate_3_8&#45;&gt;expert_3_0_0 -->
<g id="edge2654" class="edge">
<title>gate_3_8&#45;&gt;expert_3_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7134.83,-712.99C7134.83,-737.61 7134.83,-766 7134.83,-766 7134.83,-766 332.43,-766 332.43,-766 332.43,-766 332.43,-518.01 332.43,-518.01"/>
<polygon fill="blue" stroke="blue" points="335.93,-518.01 332.43,-508.01 328.93,-518.01 335.93,-518.01"/>
<text text-anchor="middle" x="29876.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="29876.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU8→GPU0</text>
<text text-anchor="middle" x="29876.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="29876.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_8&#45;&gt;expert_3_1_0 -->
<g id="edge2655" class="edge">
<title>gate_3_8&#45;&gt;expert_3_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7073.67,-662.14C7073.67,-630.29 7073.67,-560 7073.67,-560 7073.67,-560 3003.45,-560 3003.45,-560 3003.45,-560 3003.45,-518.08 3003.45,-518.08"/>
<polygon fill="blue" stroke="blue" points="3006.95,-518.08 3003.45,-508.08 2999.95,-518.08 3006.95,-518.08"/>
<text text-anchor="middle" x="30050.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30050.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU8→GPU1</text>
<text text-anchor="middle" x="30050.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30050.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_8&#45;&gt;expert_3_2_0 -->
<g id="edge2656" class="edge">
<title>gate_3_8&#45;&gt;expert_3_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7092.02,-652.08C7092.02,-617.26 7092.02,-559 7092.02,-559 7092.02,-559 3597.2,-559 3597.2,-559 3597.2,-559 3597.2,-518.17 3597.2,-518.17"/>
<polygon fill="blue" stroke="blue" points="3600.7,-518.17 3597.2,-508.17 3593.7,-518.17 3600.7,-518.17"/>
<text text-anchor="middle" x="30224.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30224.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU8→GPU2</text>
<text text-anchor="middle" x="30224.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30224.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_8&#45;&gt;expert_3_3_0 -->
<g id="edge2657" class="edge">
<title>gate_3_8&#45;&gt;expert_3_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7110.37,-646.43C7110.37,-613.74 7110.37,-567 7110.37,-567 7110.37,-567 4188.58,-567 4188.58,-567 4188.58,-567 4188.58,-518.08 4188.58,-518.08"/>
<polygon fill="blue" stroke="blue" points="4192.08,-518.08 4188.58,-508.08 4185.08,-518.08 4192.08,-518.08"/>
<text text-anchor="middle" x="30398.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30398.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU8→GPU3</text>
<text text-anchor="middle" x="30398.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30398.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_8&#45;&gt;expert_3_4_0 -->
<g id="edge2658" class="edge">
<title>gate_3_8&#45;&gt;expert_3_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7128.72,-642.86C7128.72,-621.44 7128.72,-598 7128.72,-598 7128.72,-598 4786.83,-598 4786.83,-598 4786.83,-598 4786.83,-518.23 4786.83,-518.23"/>
<polygon fill="blue" stroke="blue" points="4790.33,-518.23 4786.83,-508.23 4783.33,-518.23 4790.33,-518.23"/>
<text text-anchor="middle" x="30572.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30572.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU8→GPU4</text>
<text text-anchor="middle" x="30572.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30572.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_8&#45;&gt;expert_3_5_0 -->
<g id="edge2659" class="edge">
<title>gate_3_8&#45;&gt;expert_3_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7147.07,-640.83C7147.07,-622.84 7147.07,-605 7147.07,-605 7147.07,-605 5383.88,-605 5383.88,-605 5383.88,-605 5383.88,-518.3 5383.88,-518.3"/>
<polygon fill="blue" stroke="blue" points="5387.38,-518.3 5383.88,-508.3 5380.38,-518.3 5387.38,-518.3"/>
<text text-anchor="middle" x="30746.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30746.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU8→GPU5</text>
<text text-anchor="middle" x="30746.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30746.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_8&#45;&gt;expert_3_6_0 -->
<g id="edge2660" class="edge">
<title>gate_3_8&#45;&gt;expert_3_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7156.24,-639.97C7156.24,-634.68 7156.24,-631 7156.24,-631 7156.24,-631 6111.62,-631 6111.62,-631 6111.62,-631 6111.62,-518.23 6111.62,-518.23"/>
<polygon fill="blue" stroke="blue" points="6115.13,-518.23 6111.62,-508.23 6108.13,-518.23 6115.13,-518.23"/>
<text text-anchor="middle" x="30920.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="30920.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU8→GPU6</text>
<text text-anchor="middle" x="30920.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="30920.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_8&#45;&gt;expert_3_7_0 -->
<g id="edge2661" class="edge">
<title>gate_3_8&#45;&gt;expert_3_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7070.48,-690C6931.26,-690 6695.25,-690 6695.25,-690 6695.25,-690 6695.25,-518.33 6695.25,-518.33"/>
<polygon fill="blue" stroke="blue" points="6698.75,-518.33 6695.25,-508.33 6691.75,-518.33 6698.75,-518.33"/>
<text text-anchor="middle" x="31094.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31094.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU8→GPU7</text>
<text text-anchor="middle" x="31094.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31094.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_8&#45;&gt;expert_3_8_0 -->
<g id="edge870" class="edge">
<title>gate_3_8&#45;&gt;expert_3_8_0</title>
<path fill="none" stroke="black" d="M7165.41,-639.71C7165.41,-639.71 7165.41,-518.18 7165.41,-518.18"/>
<polygon fill="black" stroke="black" points="7168.91,-518.18 7165.41,-508.18 7161.91,-518.18 7168.91,-518.18"/>
</g>
<!-- gate_3_8&#45;&gt;expert_3_9_0 -->
<g id="edge2662" class="edge">
<title>gate_3_8&#45;&gt;expert_3_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7269.65,-665C7409.77,-665 7648.12,-665 7648.12,-665 7648.12,-665 7648.12,-518.18 7648.12,-518.18"/>
<polygon fill="blue" stroke="blue" points="7651.63,-518.18 7648.12,-508.18 7644.63,-518.18 7651.63,-518.18"/>
<text text-anchor="middle" x="31268.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31268.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU8→GPU9</text>
<text text-anchor="middle" x="31268.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31268.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_8&#45;&gt;expert_3_10_0 -->
<g id="edge2663" class="edge">
<title>gate_3_8&#45;&gt;expert_3_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7220.46,-644.54C7220.46,-633.06 7220.46,-623 7220.46,-623 7220.46,-623 8230.4,-623 8230.4,-623 8230.4,-623 8230.4,-518.12 8230.4,-518.12"/>
<polygon fill="blue" stroke="blue" points="8233.9,-518.12 8230.4,-508.12 8226.9,-518.12 8233.9,-518.12"/>
<text text-anchor="middle" x="31442.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31442.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU8→GPU10</text>
<text text-anchor="middle" x="31442.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31442.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_8&#45;&gt;expert_3_11_0 -->
<g id="edge2664" class="edge">
<title>gate_3_8&#45;&gt;expert_3_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7229.63,-646.52C7229.63,-622.4 7229.63,-593 7229.63,-593 7229.63,-593 8815.38,-593 8815.38,-593 8815.38,-593 8815.38,-518.21 8815.38,-518.21"/>
<polygon fill="blue" stroke="blue" points="8818.88,-518.21 8815.38,-508.21 8811.88,-518.21 8818.88,-518.21"/>
<text text-anchor="middle" x="31616.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31616.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU8→GPU11</text>
<text text-anchor="middle" x="31616.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31616.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_8&#45;&gt;expert_3_12_0 -->
<g id="edge2665" class="edge">
<title>gate_3_8&#45;&gt;expert_3_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7238.8,-648.99C7238.8,-621.81 7238.8,-585 7238.8,-585 7238.8,-585 9559.28,-585 9559.28,-585 9559.28,-585 9559.28,-518.15 9559.28,-518.15"/>
<polygon fill="blue" stroke="blue" points="9562.78,-518.15 9559.28,-508.15 9555.78,-518.15 9562.78,-518.15"/>
<text text-anchor="middle" x="31790.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31790.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU8→GPU12</text>
<text text-anchor="middle" x="31790.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31790.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_8&#45;&gt;expert_3_13_0 -->
<g id="edge2666" class="edge">
<title>gate_3_8&#45;&gt;expert_3_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7247.98,-652.14C7247.98,-623.25 7247.98,-580 7247.98,-580 7247.98,-580 10151.42,-580 10151.42,-580 10151.42,-580 10151.42,-518.16 10151.42,-518.16"/>
<polygon fill="blue" stroke="blue" points="10154.92,-518.16 10151.42,-508.16 10147.92,-518.16 10154.92,-518.16"/>
<text text-anchor="middle" x="31964.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="31964.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU8→GPU13</text>
<text text-anchor="middle" x="31964.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="31964.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_8&#45;&gt;expert_3_14_0 -->
<g id="edge2667" class="edge">
<title>gate_3_8&#45;&gt;expert_3_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7257.15,-656.17C7257.15,-617.78 7257.15,-541 7257.15,-541 7257.15,-541 10717.12,-541 10717.12,-541 10717.12,-541 10717.12,-518.12 10717.12,-518.12"/>
<polygon fill="blue" stroke="blue" points="10720.62,-518.12 10717.12,-508.12 10713.62,-518.12 10720.62,-518.12"/>
<text text-anchor="middle" x="32138.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="32138.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU8→GPU14</text>
<text text-anchor="middle" x="32138.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="32138.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_8&#45;&gt;expert_3_15_0 -->
<g id="edge2668" class="edge">
<title>gate_3_8&#45;&gt;expert_3_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7266.33,-661.79C7266.33,-629.99 7266.33,-561 7266.33,-561 7266.33,-561 11284.55,-561 11284.55,-561 11284.55,-561 11284.55,-518.42 11284.55,-518.42"/>
<polygon fill="blue" stroke="blue" points="11288.05,-518.42 11284.55,-508.42 11281.05,-518.42 11288.05,-518.42"/>
<text text-anchor="middle" x="32312.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="32312.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU8→GPU15</text>
<text text-anchor="middle" x="32312.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="32312.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_8 -->
<g id="node880" class="node">
<title>expert_reduce_3_8</title>
<ellipse fill="none" stroke="black" cx="7170" cy="-344.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="7170" y="-355.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="7170" y="-340.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="7170" y="-325.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_8_0&#45;&gt;expert_reduce_3_8 -->
<g id="edge871" class="edge">
<title>expert_3_8_0&#45;&gt;expert_reduce_3_8</title>
<path fill="none" stroke="black" d="M7170,-454.76C7170,-454.76 7170,-392.06 7170,-392.06"/>
<polygon fill="black" stroke="black" points="7173.5,-392.06 7170,-382.06 7166.5,-392.06 7173.5,-392.06"/>
</g>
<!-- moe_residual_3_8 -->
<g id="node881" class="node">
<title>moe_residual_3_8</title>
<ellipse fill="none" stroke="black" cx="7170" cy="-207" rx="105.5" ry="27"/>
<text text-anchor="middle" x="7170" y="-210.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="7170" y="-195.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_8&#45;&gt;moe_residual_3_8 -->
<g id="edge872" class="edge">
<title>expert_reduce_3_8&#45;&gt;moe_residual_3_8</title>
<path fill="none" stroke="black" d="M7170,-306.93C7170,-306.93 7170,-244.06 7170,-244.06"/>
<polygon fill="black" stroke="black" points="7173.5,-244.06 7170,-234.06 7166.5,-244.06 7173.5,-244.06"/>
</g>
<!-- output_8 -->
<g id="node882" class="node">
<title>output_8</title>
<polygon fill="lightcoral" stroke="black" points="7263,-107 7077,-107 7077,-69 7263,-69 7263,-107"/>
<text text-anchor="middle" x="7170" y="-91.8" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="7170" y="-76.8" font-family="Times,serif" font-size="14.00">Y[8]: 1024×1024×4096</text>
</g>
<!-- moe_residual_3_8&#45;&gt;output_8 -->
<g id="edge873" class="edge">
<title>moe_residual_3_8&#45;&gt;output_8</title>
<path fill="none" stroke="black" d="M7170,-180C7170,-180 7170,-117.12 7170,-117.12"/>
<polygon fill="black" stroke="black" points="7173.5,-117.12 7170,-107.12 7166.5,-117.12 7173.5,-117.12"/>
</g>
<!-- input_9 -->
<g id="node883" class="node">
<title>input_9</title>
<polygon fill="lightgreen" stroke="black" points="7850.5,-20866 7663.5,-20866 7663.5,-20828 7850.5,-20828 7850.5,-20866"/>
<text text-anchor="middle" x="7757" y="-20850.8" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="7757" y="-20835.8" font-family="Times,serif" font-size="14.00">X[9]: 1024×1024×4096</text>
</g>
<!-- qkv_proj_0_9 -->
<g id="node884" class="node">
<title>qkv_proj_0_9</title>
<polygon fill="none" stroke="black" points="7839.5,-20755 7674.5,-20755 7674.5,-20702 7839.5,-20702 7839.5,-20755"/>
<text text-anchor="middle" x="7757" y="-20739.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="7757" y="-20724.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="7757" y="-20709.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- input_9&#45;&gt;qkv_proj_0_9 -->
<g id="edge874" class="edge">
<title>input_9&#45;&gt;qkv_proj_0_9</title>
<path fill="none" stroke="black" d="M7757,-20827.96C7757,-20827.96 7757,-20765.44 7757,-20765.44"/>
<polygon fill="black" stroke="black" points="7760.5,-20765.44 7757,-20755.44 7753.5,-20765.44 7760.5,-20765.44"/>
</g>
<!-- qkv_reshape_0_9 -->
<g id="node885" class="node">
<title>qkv_reshape_0_9</title>
<ellipse fill="none" stroke="black" cx="7757" cy="-20602" rx="148" ry="27"/>
<text text-anchor="middle" x="7757" y="-20605.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="7757" y="-20590.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_0_9&#45;&gt;qkv_reshape_0_9 -->
<g id="edge875" class="edge">
<title>qkv_proj_0_9&#45;&gt;qkv_reshape_0_9</title>
<path fill="none" stroke="black" d="M7757,-20701.98C7757,-20701.98 7757,-20639.36 7757,-20639.36"/>
<polygon fill="black" stroke="black" points="7760.5,-20639.36 7757,-20629.36 7753.5,-20639.36 7760.5,-20639.36"/>
</g>
<!-- qkv_reshape_0_9&#45;&gt;ring_attn_0_9_stage_0 -->
<g id="edge876" class="edge">
<title>qkv_reshape_0_9&#45;&gt;ring_attn_0_9_stage_0</title>
<path fill="none" stroke="black" d="M7757,-20574.72C7757,-20574.72 7757,-20468.16 7757,-20468.16"/>
<polygon fill="black" stroke="black" points="7760.5,-20468.16 7757,-20458.16 7753.5,-20468.16 7760.5,-20468.16"/>
</g>
<!-- ring_attn_0_9_stage_0&#45;&gt;ring_attn_0_9_stage_1 -->
<g id="edge877" class="edge">
<title>ring_attn_0_9_stage_0&#45;&gt;ring_attn_0_9_stage_1</title>
<path fill="none" stroke="black" d="M7757,-20321.87C7757,-20321.87 7757,-20215.25 7757,-20215.25"/>
<polygon fill="black" stroke="black" points="7760.5,-20215.25 7757,-20205.25 7753.5,-20215.25 7760.5,-20215.25"/>
</g>
<!-- ring_attn_0_10_stage_0 -->
<g id="node984" class="node">
<title>ring_attn_0_10_stage_0</title>
<polygon fill="yellow" stroke="black" points="8344,-20458 8135,-20390 8344,-20322 8553,-20390 8344,-20458"/>
<text text-anchor="middle" x="8344" y="-20408.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-20393.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="8344" y="-20378.8" font-family="Times,serif" font-size="14.00">Q[10]×K[10]×V[10]</text>
<text text-anchor="middle" x="8344" y="-20363.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_9_stage_0&#45;&gt;ring_attn_0_10_stage_0 -->
<g id="edge2669" class="edge">
<title>ring_attn_0_9_stage_0&#45;&gt;ring_attn_0_10_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-20390C7966.02,-20390 8124.86,-20390 8124.86,-20390"/>
<polygon fill="red" stroke="red" points="8124.86,-20393.5 8134.86,-20390 8124.86,-20386.5 8124.86,-20393.5"/>
</g>
<!-- ring_attn_0_9_stage_1&#45;&gt;ring_attn_0_9_stage_2 -->
<g id="edge878" class="edge">
<title>ring_attn_0_9_stage_1&#45;&gt;ring_attn_0_9_stage_2</title>
<path fill="none" stroke="black" d="M7757,-20068.87C7757,-20068.87 7757,-19962.25 7757,-19962.25"/>
<polygon fill="black" stroke="black" points="7760.5,-19962.25 7757,-19952.25 7753.5,-19962.25 7760.5,-19962.25"/>
</g>
<!-- ring_attn_0_10_stage_1 -->
<g id="node985" class="node">
<title>ring_attn_0_10_stage_1</title>
<polygon fill="yellow" stroke="black" points="8344,-20205 8135,-20137 8344,-20069 8553,-20137 8344,-20205"/>
<text text-anchor="middle" x="8344" y="-20155.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-20140.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="8344" y="-20125.8" font-family="Times,serif" font-size="14.00">Q[10]×K[9]×V[9]</text>
<text text-anchor="middle" x="8344" y="-20110.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_9_stage_1&#45;&gt;ring_attn_0_10_stage_1 -->
<g id="edge2670" class="edge">
<title>ring_attn_0_9_stage_1&#45;&gt;ring_attn_0_10_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-20137C7966.02,-20137 8124.86,-20137 8124.86,-20137"/>
<polygon fill="red" stroke="red" points="8124.86,-20140.5 8134.86,-20137 8124.86,-20133.5 8124.86,-20140.5"/>
</g>
<!-- ring_attn_0_9_stage_2&#45;&gt;ring_attn_0_9_stage_3 -->
<g id="edge879" class="edge">
<title>ring_attn_0_9_stage_2&#45;&gt;ring_attn_0_9_stage_3</title>
<path fill="none" stroke="black" d="M7757,-19815.87C7757,-19815.87 7757,-19709.25 7757,-19709.25"/>
<polygon fill="black" stroke="black" points="7760.5,-19709.25 7757,-19699.25 7753.5,-19709.25 7760.5,-19709.25"/>
</g>
<!-- ring_attn_0_10_stage_2 -->
<g id="node986" class="node">
<title>ring_attn_0_10_stage_2</title>
<polygon fill="yellow" stroke="black" points="8344,-19952 8135,-19884 8344,-19816 8553,-19884 8344,-19952"/>
<text text-anchor="middle" x="8344" y="-19902.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-19887.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="8344" y="-19872.8" font-family="Times,serif" font-size="14.00">Q[10]×K[8]×V[8]</text>
<text text-anchor="middle" x="8344" y="-19857.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_9_stage_2&#45;&gt;ring_attn_0_10_stage_2 -->
<g id="edge2671" class="edge">
<title>ring_attn_0_9_stage_2&#45;&gt;ring_attn_0_10_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-19884C7966.02,-19884 8124.86,-19884 8124.86,-19884"/>
<polygon fill="red" stroke="red" points="8124.86,-19887.5 8134.86,-19884 8124.86,-19880.5 8124.86,-19887.5"/>
</g>
<!-- ring_attn_0_9_stage_3&#45;&gt;ring_attn_0_9_stage_4 -->
<g id="edge880" class="edge">
<title>ring_attn_0_9_stage_3&#45;&gt;ring_attn_0_9_stage_4</title>
<path fill="none" stroke="black" d="M7757,-19562.87C7757,-19562.87 7757,-19456.25 7757,-19456.25"/>
<polygon fill="black" stroke="black" points="7760.5,-19456.25 7757,-19446.25 7753.5,-19456.25 7760.5,-19456.25"/>
</g>
<!-- ring_attn_0_10_stage_3 -->
<g id="node987" class="node">
<title>ring_attn_0_10_stage_3</title>
<polygon fill="yellow" stroke="black" points="8344,-19699 8135,-19631 8344,-19563 8553,-19631 8344,-19699"/>
<text text-anchor="middle" x="8344" y="-19649.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-19634.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="8344" y="-19619.8" font-family="Times,serif" font-size="14.00">Q[10]×K[7]×V[7]</text>
<text text-anchor="middle" x="8344" y="-19604.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_9_stage_3&#45;&gt;ring_attn_0_10_stage_3 -->
<g id="edge2672" class="edge">
<title>ring_attn_0_9_stage_3&#45;&gt;ring_attn_0_10_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-19631C7966.02,-19631 8124.86,-19631 8124.86,-19631"/>
<polygon fill="red" stroke="red" points="8124.86,-19634.5 8134.86,-19631 8124.86,-19627.5 8124.86,-19634.5"/>
</g>
<!-- ring_attn_0_9_stage_4&#45;&gt;ring_attn_0_9_stage_5 -->
<g id="edge881" class="edge">
<title>ring_attn_0_9_stage_4&#45;&gt;ring_attn_0_9_stage_5</title>
<path fill="none" stroke="black" d="M7757,-19309.87C7757,-19309.87 7757,-19203.25 7757,-19203.25"/>
<polygon fill="black" stroke="black" points="7760.5,-19203.25 7757,-19193.25 7753.5,-19203.25 7760.5,-19203.25"/>
</g>
<!-- ring_attn_0_10_stage_4 -->
<g id="node988" class="node">
<title>ring_attn_0_10_stage_4</title>
<polygon fill="yellow" stroke="black" points="8344,-19446 8135,-19378 8344,-19310 8553,-19378 8344,-19446"/>
<text text-anchor="middle" x="8344" y="-19396.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-19381.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="8344" y="-19366.8" font-family="Times,serif" font-size="14.00">Q[10]×K[6]×V[6]</text>
<text text-anchor="middle" x="8344" y="-19351.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_9_stage_4&#45;&gt;ring_attn_0_10_stage_4 -->
<g id="edge2673" class="edge">
<title>ring_attn_0_9_stage_4&#45;&gt;ring_attn_0_10_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-19378C7966.02,-19378 8124.86,-19378 8124.86,-19378"/>
<polygon fill="red" stroke="red" points="8124.86,-19381.5 8134.86,-19378 8124.86,-19374.5 8124.86,-19381.5"/>
</g>
<!-- ring_attn_0_9_stage_5&#45;&gt;ring_attn_0_9_stage_6 -->
<g id="edge882" class="edge">
<title>ring_attn_0_9_stage_5&#45;&gt;ring_attn_0_9_stage_6</title>
<path fill="none" stroke="black" d="M7757,-19056.87C7757,-19056.87 7757,-18950.25 7757,-18950.25"/>
<polygon fill="black" stroke="black" points="7760.5,-18950.25 7757,-18940.25 7753.5,-18950.25 7760.5,-18950.25"/>
</g>
<!-- ring_attn_0_10_stage_5 -->
<g id="node989" class="node">
<title>ring_attn_0_10_stage_5</title>
<polygon fill="yellow" stroke="black" points="8344,-19193 8135,-19125 8344,-19057 8553,-19125 8344,-19193"/>
<text text-anchor="middle" x="8344" y="-19143.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-19128.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="8344" y="-19113.8" font-family="Times,serif" font-size="14.00">Q[10]×K[5]×V[5]</text>
<text text-anchor="middle" x="8344" y="-19098.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_9_stage_5&#45;&gt;ring_attn_0_10_stage_5 -->
<g id="edge2674" class="edge">
<title>ring_attn_0_9_stage_5&#45;&gt;ring_attn_0_10_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-19125C7966.02,-19125 8124.86,-19125 8124.86,-19125"/>
<polygon fill="red" stroke="red" points="8124.86,-19128.5 8134.86,-19125 8124.86,-19121.5 8124.86,-19128.5"/>
</g>
<!-- ring_attn_0_9_stage_6&#45;&gt;ring_attn_0_9_stage_7 -->
<g id="edge883" class="edge">
<title>ring_attn_0_9_stage_6&#45;&gt;ring_attn_0_9_stage_7</title>
<path fill="none" stroke="black" d="M7757,-18803.87C7757,-18803.87 7757,-18697.25 7757,-18697.25"/>
<polygon fill="black" stroke="black" points="7760.5,-18697.25 7757,-18687.25 7753.5,-18697.25 7760.5,-18697.25"/>
</g>
<!-- ring_attn_0_10_stage_6 -->
<g id="node990" class="node">
<title>ring_attn_0_10_stage_6</title>
<polygon fill="yellow" stroke="black" points="8344,-18940 8135,-18872 8344,-18804 8553,-18872 8344,-18940"/>
<text text-anchor="middle" x="8344" y="-18890.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-18875.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="8344" y="-18860.8" font-family="Times,serif" font-size="14.00">Q[10]×K[4]×V[4]</text>
<text text-anchor="middle" x="8344" y="-18845.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_9_stage_6&#45;&gt;ring_attn_0_10_stage_6 -->
<g id="edge2675" class="edge">
<title>ring_attn_0_9_stage_6&#45;&gt;ring_attn_0_10_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-18872C7966.02,-18872 8124.86,-18872 8124.86,-18872"/>
<polygon fill="red" stroke="red" points="8124.86,-18875.5 8134.86,-18872 8124.86,-18868.5 8124.86,-18875.5"/>
</g>
<!-- ring_attn_0_9_stage_7&#45;&gt;ring_attn_0_9_stage_8 -->
<g id="edge884" class="edge">
<title>ring_attn_0_9_stage_7&#45;&gt;ring_attn_0_9_stage_8</title>
<path fill="none" stroke="black" d="M7757,-18550.87C7757,-18550.87 7757,-18444.25 7757,-18444.25"/>
<polygon fill="black" stroke="black" points="7760.5,-18444.25 7757,-18434.25 7753.5,-18444.25 7760.5,-18444.25"/>
</g>
<!-- ring_attn_0_10_stage_7 -->
<g id="node991" class="node">
<title>ring_attn_0_10_stage_7</title>
<polygon fill="yellow" stroke="black" points="8344,-18687 8135,-18619 8344,-18551 8553,-18619 8344,-18687"/>
<text text-anchor="middle" x="8344" y="-18637.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-18622.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="8344" y="-18607.8" font-family="Times,serif" font-size="14.00">Q[10]×K[3]×V[3]</text>
<text text-anchor="middle" x="8344" y="-18592.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_9_stage_7&#45;&gt;ring_attn_0_10_stage_7 -->
<g id="edge2676" class="edge">
<title>ring_attn_0_9_stage_7&#45;&gt;ring_attn_0_10_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-18619C7966.02,-18619 8124.86,-18619 8124.86,-18619"/>
<polygon fill="red" stroke="red" points="8124.86,-18622.5 8134.86,-18619 8124.86,-18615.5 8124.86,-18622.5"/>
</g>
<!-- ring_attn_0_9_stage_8&#45;&gt;ring_attn_0_9_stage_9 -->
<g id="edge885" class="edge">
<title>ring_attn_0_9_stage_8&#45;&gt;ring_attn_0_9_stage_9</title>
<path fill="none" stroke="black" d="M7757,-18297.87C7757,-18297.87 7757,-18191.25 7757,-18191.25"/>
<polygon fill="black" stroke="black" points="7760.5,-18191.25 7757,-18181.25 7753.5,-18191.25 7760.5,-18191.25"/>
</g>
<!-- ring_attn_0_10_stage_8 -->
<g id="node992" class="node">
<title>ring_attn_0_10_stage_8</title>
<polygon fill="yellow" stroke="black" points="8344,-18434 8135,-18366 8344,-18298 8553,-18366 8344,-18434"/>
<text text-anchor="middle" x="8344" y="-18384.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-18369.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="8344" y="-18354.8" font-family="Times,serif" font-size="14.00">Q[10]×K[2]×V[2]</text>
<text text-anchor="middle" x="8344" y="-18339.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_9_stage_8&#45;&gt;ring_attn_0_10_stage_8 -->
<g id="edge2677" class="edge">
<title>ring_attn_0_9_stage_8&#45;&gt;ring_attn_0_10_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-18366C7966.02,-18366 8124.86,-18366 8124.86,-18366"/>
<polygon fill="red" stroke="red" points="8124.86,-18369.5 8134.86,-18366 8124.86,-18362.5 8124.86,-18369.5"/>
</g>
<!-- ring_attn_0_9_stage_9&#45;&gt;ring_attn_0_9_stage_10 -->
<g id="edge886" class="edge">
<title>ring_attn_0_9_stage_9&#45;&gt;ring_attn_0_9_stage_10</title>
<path fill="none" stroke="black" d="M7757,-18044.87C7757,-18044.87 7757,-17938.25 7757,-17938.25"/>
<polygon fill="black" stroke="black" points="7760.5,-17938.25 7757,-17928.25 7753.5,-17938.25 7760.5,-17938.25"/>
</g>
<!-- ring_attn_0_10_stage_9 -->
<g id="node993" class="node">
<title>ring_attn_0_10_stage_9</title>
<polygon fill="yellow" stroke="black" points="8344,-18181 8135,-18113 8344,-18045 8553,-18113 8344,-18181"/>
<text text-anchor="middle" x="8344" y="-18131.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-18116.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="8344" y="-18101.8" font-family="Times,serif" font-size="14.00">Q[10]×K[1]×V[1]</text>
<text text-anchor="middle" x="8344" y="-18086.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_9_stage_9&#45;&gt;ring_attn_0_10_stage_9 -->
<g id="edge2678" class="edge">
<title>ring_attn_0_9_stage_9&#45;&gt;ring_attn_0_10_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-18113C7966.02,-18113 8124.86,-18113 8124.86,-18113"/>
<polygon fill="red" stroke="red" points="8124.86,-18116.5 8134.86,-18113 8124.86,-18109.5 8124.86,-18116.5"/>
</g>
<!-- ring_attn_0_9_stage_10&#45;&gt;ring_attn_0_9_stage_11 -->
<g id="edge887" class="edge">
<title>ring_attn_0_9_stage_10&#45;&gt;ring_attn_0_9_stage_11</title>
<path fill="none" stroke="black" d="M7757,-17791.87C7757,-17791.87 7757,-17685.25 7757,-17685.25"/>
<polygon fill="black" stroke="black" points="7760.5,-17685.25 7757,-17675.25 7753.5,-17685.25 7760.5,-17685.25"/>
</g>
<!-- ring_attn_0_10_stage_10 -->
<g id="node994" class="node">
<title>ring_attn_0_10_stage_10</title>
<polygon fill="yellow" stroke="black" points="8344,-17928 8135,-17860 8344,-17792 8553,-17860 8344,-17928"/>
<text text-anchor="middle" x="8344" y="-17878.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-17863.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="8344" y="-17848.8" font-family="Times,serif" font-size="14.00">Q[10]×K[0]×V[0]</text>
<text text-anchor="middle" x="8344" y="-17833.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_9_stage_10&#45;&gt;ring_attn_0_10_stage_10 -->
<g id="edge2679" class="edge">
<title>ring_attn_0_9_stage_10&#45;&gt;ring_attn_0_10_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-17860C7966.02,-17860 8124.86,-17860 8124.86,-17860"/>
<polygon fill="red" stroke="red" points="8124.86,-17863.5 8134.86,-17860 8124.86,-17856.5 8124.86,-17863.5"/>
</g>
<!-- ring_attn_0_9_stage_11&#45;&gt;ring_attn_0_9_stage_12 -->
<g id="edge888" class="edge">
<title>ring_attn_0_9_stage_11&#45;&gt;ring_attn_0_9_stage_12</title>
<path fill="none" stroke="black" d="M7757,-17538.87C7757,-17538.87 7757,-17432.25 7757,-17432.25"/>
<polygon fill="black" stroke="black" points="7760.5,-17432.25 7757,-17422.25 7753.5,-17432.25 7760.5,-17432.25"/>
</g>
<!-- ring_attn_0_10_stage_11 -->
<g id="node995" class="node">
<title>ring_attn_0_10_stage_11</title>
<polygon fill="yellow" stroke="black" points="8344,-17675 8135,-17607 8344,-17539 8553,-17607 8344,-17675"/>
<text text-anchor="middle" x="8344" y="-17625.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-17610.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="8344" y="-17595.8" font-family="Times,serif" font-size="14.00">Q[10]×K[15]×V[15]</text>
<text text-anchor="middle" x="8344" y="-17580.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_9_stage_11&#45;&gt;ring_attn_0_10_stage_11 -->
<g id="edge2680" class="edge">
<title>ring_attn_0_9_stage_11&#45;&gt;ring_attn_0_10_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-17607C7966.02,-17607 8124.86,-17607 8124.86,-17607"/>
<polygon fill="red" stroke="red" points="8124.86,-17610.5 8134.86,-17607 8124.86,-17603.5 8124.86,-17610.5"/>
</g>
<!-- ring_attn_0_9_stage_12&#45;&gt;ring_attn_0_9_stage_13 -->
<g id="edge889" class="edge">
<title>ring_attn_0_9_stage_12&#45;&gt;ring_attn_0_9_stage_13</title>
<path fill="none" stroke="black" d="M7757,-17285.87C7757,-17285.87 7757,-17179.25 7757,-17179.25"/>
<polygon fill="black" stroke="black" points="7760.5,-17179.25 7757,-17169.25 7753.5,-17179.25 7760.5,-17179.25"/>
</g>
<!-- ring_attn_0_10_stage_12 -->
<g id="node996" class="node">
<title>ring_attn_0_10_stage_12</title>
<polygon fill="yellow" stroke="black" points="8344,-17422 8135,-17354 8344,-17286 8553,-17354 8344,-17422"/>
<text text-anchor="middle" x="8344" y="-17372.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-17357.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="8344" y="-17342.8" font-family="Times,serif" font-size="14.00">Q[10]×K[14]×V[14]</text>
<text text-anchor="middle" x="8344" y="-17327.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_9_stage_12&#45;&gt;ring_attn_0_10_stage_12 -->
<g id="edge2681" class="edge">
<title>ring_attn_0_9_stage_12&#45;&gt;ring_attn_0_10_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-17354C7966.02,-17354 8124.86,-17354 8124.86,-17354"/>
<polygon fill="red" stroke="red" points="8124.86,-17357.5 8134.86,-17354 8124.86,-17350.5 8124.86,-17357.5"/>
</g>
<!-- ring_attn_0_9_stage_13&#45;&gt;ring_attn_0_9_stage_14 -->
<g id="edge890" class="edge">
<title>ring_attn_0_9_stage_13&#45;&gt;ring_attn_0_9_stage_14</title>
<path fill="none" stroke="black" d="M7757,-17032.87C7757,-17032.87 7757,-16926.25 7757,-16926.25"/>
<polygon fill="black" stroke="black" points="7760.5,-16926.25 7757,-16916.25 7753.5,-16926.25 7760.5,-16926.25"/>
</g>
<!-- ring_attn_0_10_stage_13 -->
<g id="node997" class="node">
<title>ring_attn_0_10_stage_13</title>
<polygon fill="yellow" stroke="black" points="8344,-17169 8135,-17101 8344,-17033 8553,-17101 8344,-17169"/>
<text text-anchor="middle" x="8344" y="-17119.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-17104.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="8344" y="-17089.8" font-family="Times,serif" font-size="14.00">Q[10]×K[13]×V[13]</text>
<text text-anchor="middle" x="8344" y="-17074.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_9_stage_13&#45;&gt;ring_attn_0_10_stage_13 -->
<g id="edge2682" class="edge">
<title>ring_attn_0_9_stage_13&#45;&gt;ring_attn_0_10_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-17101C7966.02,-17101 8124.86,-17101 8124.86,-17101"/>
<polygon fill="red" stroke="red" points="8124.86,-17104.5 8134.86,-17101 8124.86,-17097.5 8124.86,-17104.5"/>
</g>
<!-- ring_attn_0_9_stage_14&#45;&gt;ring_attn_0_9_stage_15 -->
<g id="edge891" class="edge">
<title>ring_attn_0_9_stage_14&#45;&gt;ring_attn_0_9_stage_15</title>
<path fill="none" stroke="black" d="M7757,-16779.87C7757,-16779.87 7757,-16673.25 7757,-16673.25"/>
<polygon fill="black" stroke="black" points="7760.5,-16673.25 7757,-16663.25 7753.5,-16673.25 7760.5,-16673.25"/>
</g>
<!-- ring_attn_0_10_stage_14 -->
<g id="node998" class="node">
<title>ring_attn_0_10_stage_14</title>
<polygon fill="yellow" stroke="black" points="8344,-16916 8135,-16848 8344,-16780 8553,-16848 8344,-16916"/>
<text text-anchor="middle" x="8344" y="-16866.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-16851.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="8344" y="-16836.8" font-family="Times,serif" font-size="14.00">Q[10]×K[12]×V[12]</text>
<text text-anchor="middle" x="8344" y="-16821.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_9_stage_14&#45;&gt;ring_attn_0_10_stage_14 -->
<g id="edge2683" class="edge">
<title>ring_attn_0_9_stage_14&#45;&gt;ring_attn_0_10_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-16848C7966.02,-16848 8124.86,-16848 8124.86,-16848"/>
<polygon fill="red" stroke="red" points="8124.86,-16851.5 8134.86,-16848 8124.86,-16844.5 8124.86,-16851.5"/>
</g>
<!-- attn_out_0_9 -->
<g id="node902" class="node">
<title>attn_out_0_9</title>
<polygon fill="none" stroke="black" points="7826.5,-16454 7687.5,-16454 7687.5,-16401 7826.5,-16401 7826.5,-16454"/>
<text text-anchor="middle" x="7757" y="-16438.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="7757" y="-16423.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="7757" y="-16408.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_0_9_stage_15&#45;&gt;attn_out_0_9 -->
<g id="edge892" class="edge">
<title>ring_attn_0_9_stage_15&#45;&gt;attn_out_0_9</title>
<path fill="none" stroke="black" d="M7757,-16526.87C7757,-16526.87 7757,-16464.18 7757,-16464.18"/>
<polygon fill="black" stroke="black" points="7760.5,-16464.18 7757,-16454.18 7753.5,-16464.18 7760.5,-16464.18"/>
</g>
<!-- ring_attn_0_10_stage_15 -->
<g id="node999" class="node">
<title>ring_attn_0_10_stage_15</title>
<polygon fill="yellow" stroke="black" points="8344,-16663 8135,-16595 8344,-16527 8553,-16595 8344,-16663"/>
<text text-anchor="middle" x="8344" y="-16613.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-16598.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="8344" y="-16583.8" font-family="Times,serif" font-size="14.00">Q[10]×K[11]×V[11]</text>
<text text-anchor="middle" x="8344" y="-16568.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_9_stage_15&#45;&gt;ring_attn_0_10_stage_15 -->
<g id="edge2684" class="edge">
<title>ring_attn_0_9_stage_15&#45;&gt;ring_attn_0_10_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-16595C7966.02,-16595 8124.86,-16595 8124.86,-16595"/>
<polygon fill="red" stroke="red" points="8124.86,-16598.5 8134.86,-16595 8124.86,-16591.5 8124.86,-16598.5"/>
</g>
<!-- attn_residual_0_9 -->
<g id="node903" class="node">
<title>attn_residual_0_9</title>
<ellipse fill="none" stroke="black" cx="7757" cy="-16301" rx="105.5" ry="27"/>
<text text-anchor="middle" x="7757" y="-16304.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="7757" y="-16289.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_0_9&#45;&gt;attn_residual_0_9 -->
<g id="edge893" class="edge">
<title>attn_out_0_9&#45;&gt;attn_residual_0_9</title>
<path fill="none" stroke="black" d="M7757,-16400.98C7757,-16400.98 7757,-16338.36 7757,-16338.36"/>
<polygon fill="black" stroke="black" points="7760.5,-16338.36 7757,-16328.36 7753.5,-16338.36 7760.5,-16338.36"/>
</g>
<!-- gate_0_9 -->
<g id="node904" class="node">
<title>gate_0_9</title>
<ellipse fill="orange" stroke="black" cx="7757" cy="-16163.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="7757" y="-16174.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="7757" y="-16159.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="7757" y="-16144.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_0_9&#45;&gt;gate_0_9 -->
<g id="edge894" class="edge">
<title>attn_residual_0_9&#45;&gt;gate_0_9</title>
<path fill="none" stroke="black" d="M7809.75,-16277.36C7809.75,-16277.36 7809.75,-16206.08 7809.75,-16206.08"/>
<polygon fill="black" stroke="black" points="7813.25,-16206.08 7809.75,-16196.08 7806.25,-16206.08 7813.25,-16206.08"/>
</g>
<!-- gate_0_9&#45;&gt;expert_0_0_0 -->
<g id="edge2685" class="edge">
<title>gate_0_9&#45;&gt;expert_0_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7757,-16201.26C7757,-16227.21 7757,-16257 7757,-16257 7757,-16257 116.8,-16257 116.8,-16257 116.8,-16257 116.8,-16004.22 116.8,-16004.22"/>
<polygon fill="blue" stroke="blue" points="120.3,-16004.22 116.8,-15994.22 113.3,-16004.22 120.3,-16004.22"/>
<text text-anchor="middle" x="32486.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="32486.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU9→GPU0</text>
<text text-anchor="middle" x="32486.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="32486.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_9&#45;&gt;expert_0_1_0 -->
<g id="edge2686" class="edge">
<title>gate_0_9&#45;&gt;expert_0_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7704.25,-16196.2C7704.25,-16201.34 7704.25,-16205 7704.25,-16205 7704.25,-16205 3172.29,-16205 3172.29,-16205 3172.29,-16205 3172.29,-16004.28 3172.29,-16004.28"/>
<polygon fill="blue" stroke="blue" points="3175.79,-16004.28 3172.29,-15994.28 3168.79,-16004.28 3175.79,-16004.28"/>
<text text-anchor="middle" x="32660.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="32660.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU9→GPU1</text>
<text text-anchor="middle" x="32660.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="32660.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_9&#45;&gt;expert_0_2_0 -->
<g id="edge2687" class="edge">
<title>gate_0_9&#45;&gt;expert_0_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7670.68,-16141.78C7670.68,-16106.83 7670.68,-16042 7670.68,-16042 7670.68,-16042 3605.02,-16042 3605.02,-16042 3605.02,-16042 3605.02,-16004.4 3605.02,-16004.4"/>
<polygon fill="blue" stroke="blue" points="3608.52,-16004.4 3605.02,-15994.4 3601.52,-16004.4 3608.52,-16004.4"/>
<text text-anchor="middle" x="32834.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="32834.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU9→GPU2</text>
<text text-anchor="middle" x="32834.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="32834.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_9&#45;&gt;expert_0_3_0 -->
<g id="edge2688" class="edge">
<title>gate_0_9&#45;&gt;expert_0_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7689.86,-16134.5C7689.86,-16101.46 7689.86,-16052 7689.86,-16052 7689.86,-16052 4197.02,-16052 4197.02,-16052 4197.02,-16052 4197.02,-16004.24 4197.02,-16004.24"/>
<polygon fill="blue" stroke="blue" points="4200.52,-16004.24 4197.02,-15994.24 4193.52,-16004.24 4200.52,-16004.24"/>
<text text-anchor="middle" x="33008.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33008.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU9→GPU3</text>
<text text-anchor="middle" x="33008.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33008.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_9&#45;&gt;expert_0_4_0 -->
<g id="edge2689" class="edge">
<title>gate_0_9&#45;&gt;expert_0_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7709.05,-16129.9C7709.05,-16099.68 7709.05,-16060 7709.05,-16060 7709.05,-16060 4796.88,-16060 4796.88,-16060 4796.88,-16060 4796.88,-16004.25 4796.88,-16004.25"/>
<polygon fill="blue" stroke="blue" points="4800.38,-16004.25 4796.88,-15994.25 4793.38,-16004.25 4800.38,-16004.25"/>
<text text-anchor="middle" x="33182.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33182.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU9→GPU4</text>
<text text-anchor="middle" x="33182.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33182.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_9&#45;&gt;expert_0_5_0 -->
<g id="edge2690" class="edge">
<title>gate_0_9&#45;&gt;expert_0_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7728.23,-16127.12C7728.23,-16104.62 7728.23,-16080 7728.23,-16080 7728.23,-16080 5393.93,-16080 5393.93,-16080 5393.93,-16080 5393.93,-16004.16 5393.93,-16004.16"/>
<polygon fill="blue" stroke="blue" points="5397.43,-16004.16 5393.93,-15994.16 5390.43,-16004.16 5397.43,-16004.16"/>
<text text-anchor="middle" x="33356.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33356.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU9→GPU5</text>
<text text-anchor="middle" x="33356.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33356.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_9&#45;&gt;expert_0_6_0 -->
<g id="edge2691" class="edge">
<title>gate_0_9&#45;&gt;expert_0_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7747.41,-16126.15C7747.41,-16106.73 7747.41,-16087 7747.41,-16087 7747.41,-16087 5974.9,-16087 5974.9,-16087 5974.9,-16087 5974.9,-16004.02 5974.9,-16004.02"/>
<polygon fill="blue" stroke="blue" points="5978.4,-16004.02 5974.9,-15994.02 5971.4,-16004.02 5978.4,-16004.02"/>
<text text-anchor="middle" x="33530.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33530.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU9→GPU6</text>
<text text-anchor="middle" x="33530.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33530.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_9&#45;&gt;expert_0_7_0 -->
<g id="edge2692" class="edge">
<title>gate_0_9&#45;&gt;expert_0_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7757,-16125.97C7757,-16120.68 7757,-16117 7757,-16117 7757,-16117 6698.62,-16117 6698.62,-16117 6698.62,-16117 6698.62,-16004.23 6698.62,-16004.23"/>
<polygon fill="blue" stroke="blue" points="6702.13,-16004.23 6698.62,-15994.23 6695.13,-16004.23 6702.13,-16004.23"/>
<text text-anchor="middle" x="33704.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33704.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU9→GPU7</text>
<text text-anchor="middle" x="33704.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33704.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_9&#45;&gt;expert_0_8_0 -->
<g id="edge2693" class="edge">
<title>gate_0_9&#45;&gt;expert_0_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7657.3,-16176C7517.46,-16176 7280,-16176 7280,-16176 7280,-16176 7280,-16004.33 7280,-16004.33"/>
<polygon fill="blue" stroke="blue" points="7283.5,-16004.33 7280,-15994.33 7276.5,-16004.33 7283.5,-16004.33"/>
<text text-anchor="middle" x="33878.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33878.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU9→GPU8</text>
<text text-anchor="middle" x="33878.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33878.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_9&#45;&gt;expert_0_9_0 -->
<g id="edge895" class="edge">
<title>gate_0_9&#45;&gt;expert_0_9_0</title>
<path fill="none" stroke="black" d="M7766.59,-16125.71C7766.59,-16125.71 7766.59,-16004.18 7766.59,-16004.18"/>
<polygon fill="black" stroke="black" points="7770.09,-16004.18 7766.59,-15994.18 7763.09,-16004.18 7770.09,-16004.18"/>
</g>
<!-- gate_0_9&#45;&gt;expert_0_10_0 -->
<g id="edge2694" class="edge">
<title>gate_0_9&#45;&gt;expert_0_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7856.52,-16151C7996.09,-16151 8233.1,-16151 8233.1,-16151 8233.1,-16151 8233.1,-16004.18 8233.1,-16004.18"/>
<polygon fill="blue" stroke="blue" points="8236.6,-16004.18 8233.1,-15994.18 8229.6,-16004.18 8236.6,-16004.18"/>
<text text-anchor="middle" x="34052.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34052.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU9→GPU10</text>
<text text-anchor="middle" x="34052.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34052.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_9&#45;&gt;expert_0_11_0 -->
<g id="edge2695" class="edge">
<title>gate_0_9&#45;&gt;expert_0_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7814.55,-16131.8C7814.55,-16119.81 7814.55,-16109 7814.55,-16109 7814.55,-16109 8818.75,-16109 8818.75,-16109 8818.75,-16109 8818.75,-16004.12 8818.75,-16004.12"/>
<polygon fill="blue" stroke="blue" points="8822.25,-16004.12 8818.75,-15994.12 8815.25,-16004.12 8822.25,-16004.12"/>
<text text-anchor="middle" x="34226.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34226.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU9→GPU11</text>
<text text-anchor="middle" x="34226.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34226.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_9&#45;&gt;expert_0_12_0 -->
<g id="edge2696" class="edge">
<title>gate_0_9&#45;&gt;expert_0_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7824.14,-16134.52C7824.14,-16108.71 7824.14,-16075 7824.14,-16075 7824.14,-16075 9402.38,-16075 9402.38,-16075 9402.38,-16075 9402.38,-16004.07 9402.38,-16004.07"/>
<polygon fill="blue" stroke="blue" points="9405.88,-16004.07 9402.38,-15994.07 9398.88,-16004.07 9405.88,-16004.07"/>
<text text-anchor="middle" x="34400.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34400.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU9→GPU12</text>
<text text-anchor="middle" x="34400.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34400.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_9&#45;&gt;expert_0_13_0 -->
<g id="edge2697" class="edge">
<title>gate_0_9&#45;&gt;expert_0_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7833.73,-16137.64C7833.73,-16109.06 7833.73,-16067 7833.73,-16067 7833.73,-16067 10168.3,-16067 10168.3,-16067 10168.3,-16067 10168.3,-16004.16 10168.3,-16004.16"/>
<polygon fill="blue" stroke="blue" points="10171.8,-16004.16 10168.3,-15994.16 10164.8,-16004.16 10171.8,-16004.16"/>
<text text-anchor="middle" x="34574.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34574.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU9→GPU13</text>
<text text-anchor="middle" x="34574.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34574.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_9&#45;&gt;expert_0_14_0 -->
<g id="edge2698" class="edge">
<title>gate_0_9&#45;&gt;expert_0_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7843.32,-16141.76C7843.32,-16111.67 7843.32,-16061 7843.32,-16061 7843.32,-16061 10737.21,-16061 10737.21,-16061 10737.21,-16061 10737.21,-16004.04 10737.21,-16004.04"/>
<polygon fill="blue" stroke="blue" points="10740.71,-16004.04 10737.21,-15994.04 10733.71,-16004.04 10740.71,-16004.04"/>
<text text-anchor="middle" x="34748.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34748.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU9→GPU14</text>
<text text-anchor="middle" x="34748.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34748.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_9&#45;&gt;expert_0_15_0 -->
<g id="edge2699" class="edge">
<title>gate_0_9&#45;&gt;expert_0_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7852.91,-16147.49C7852.91,-16117.31 7852.91,-16055 7852.91,-16055 7852.91,-16055 11306.76,-16055 11306.76,-16055 11306.76,-16055 11306.76,-16004.23 11306.76,-16004.23"/>
<polygon fill="blue" stroke="blue" points="11310.26,-16004.23 11306.76,-15994.23 11303.26,-16004.23 11310.26,-16004.23"/>
<text text-anchor="middle" x="34922.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34922.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU9→GPU15</text>
<text text-anchor="middle" x="34922.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34922.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_9 -->
<g id="node906" class="node">
<title>expert_reduce_0_9</title>
<ellipse fill="none" stroke="black" cx="7757" cy="-15830.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="7757" y="-15841.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="7757" y="-15826.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="7757" y="-15811.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_9_0&#45;&gt;expert_reduce_0_9 -->
<g id="edge896" class="edge">
<title>expert_0_9_0&#45;&gt;expert_reduce_0_9</title>
<path fill="none" stroke="black" d="M7757,-15940.76C7757,-15940.76 7757,-15878.06 7757,-15878.06"/>
<polygon fill="black" stroke="black" points="7760.5,-15878.06 7757,-15868.06 7753.5,-15878.06 7760.5,-15878.06"/>
</g>
<!-- moe_residual_0_9 -->
<g id="node907" class="node">
<title>moe_residual_0_9</title>
<ellipse fill="none" stroke="black" cx="7757" cy="-15693" rx="105.5" ry="27"/>
<text text-anchor="middle" x="7757" y="-15696.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="7757" y="-15681.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_9&#45;&gt;moe_residual_0_9 -->
<g id="edge897" class="edge">
<title>expert_reduce_0_9&#45;&gt;moe_residual_0_9</title>
<path fill="none" stroke="black" d="M7757,-15792.93C7757,-15792.93 7757,-15730.06 7757,-15730.06"/>
<polygon fill="black" stroke="black" points="7760.5,-15730.06 7757,-15720.06 7753.5,-15730.06 7760.5,-15730.06"/>
</g>
<!-- qkv_proj_1_9 -->
<g id="node908" class="node">
<title>qkv_proj_1_9</title>
<polygon fill="none" stroke="black" points="7839.5,-15593 7674.5,-15593 7674.5,-15540 7839.5,-15540 7839.5,-15593"/>
<text text-anchor="middle" x="7757" y="-15577.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="7757" y="-15562.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="7757" y="-15547.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_0_9&#45;&gt;qkv_proj_1_9 -->
<g id="edge898" class="edge">
<title>moe_residual_0_9&#45;&gt;qkv_proj_1_9</title>
<path fill="none" stroke="black" d="M7757,-15665.86C7757,-15665.86 7757,-15603.16 7757,-15603.16"/>
<polygon fill="black" stroke="black" points="7760.5,-15603.16 7757,-15593.16 7753.5,-15603.16 7760.5,-15603.16"/>
</g>
<!-- qkv_reshape_1_9 -->
<g id="node909" class="node">
<title>qkv_reshape_1_9</title>
<ellipse fill="none" stroke="black" cx="7757" cy="-15440" rx="148" ry="27"/>
<text text-anchor="middle" x="7757" y="-15443.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="7757" y="-15428.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_1_9&#45;&gt;qkv_reshape_1_9 -->
<g id="edge899" class="edge">
<title>qkv_proj_1_9&#45;&gt;qkv_reshape_1_9</title>
<path fill="none" stroke="black" d="M7757,-15539.98C7757,-15539.98 7757,-15477.36 7757,-15477.36"/>
<polygon fill="black" stroke="black" points="7760.5,-15477.36 7757,-15467.36 7753.5,-15477.36 7760.5,-15477.36"/>
</g>
<!-- qkv_reshape_1_9&#45;&gt;ring_attn_1_9_stage_0 -->
<g id="edge900" class="edge">
<title>qkv_reshape_1_9&#45;&gt;ring_attn_1_9_stage_0</title>
<path fill="none" stroke="black" d="M7757,-15412.72C7757,-15412.72 7757,-15306.16 7757,-15306.16"/>
<polygon fill="black" stroke="black" points="7760.5,-15306.16 7757,-15296.16 7753.5,-15306.16 7760.5,-15306.16"/>
</g>
<!-- ring_attn_1_9_stage_0&#45;&gt;ring_attn_1_9_stage_1 -->
<g id="edge901" class="edge">
<title>ring_attn_1_9_stage_0&#45;&gt;ring_attn_1_9_stage_1</title>
<path fill="none" stroke="black" d="M7757,-15159.87C7757,-15159.87 7757,-15053.25 7757,-15053.25"/>
<polygon fill="black" stroke="black" points="7760.5,-15053.25 7757,-15043.25 7753.5,-15053.25 7760.5,-15053.25"/>
</g>
<!-- ring_attn_1_10_stage_0 -->
<g id="node1008" class="node">
<title>ring_attn_1_10_stage_0</title>
<polygon fill="yellow" stroke="black" points="8344,-15296 8135,-15228 8344,-15160 8553,-15228 8344,-15296"/>
<text text-anchor="middle" x="8344" y="-15246.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-15231.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="8344" y="-15216.8" font-family="Times,serif" font-size="14.00">Q[10]×K[10]×V[10]</text>
<text text-anchor="middle" x="8344" y="-15201.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_9_stage_0&#45;&gt;ring_attn_1_10_stage_0 -->
<g id="edge2700" class="edge">
<title>ring_attn_1_9_stage_0&#45;&gt;ring_attn_1_10_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-15228C7966.02,-15228 8124.86,-15228 8124.86,-15228"/>
<polygon fill="red" stroke="red" points="8124.86,-15231.5 8134.86,-15228 8124.86,-15224.5 8124.86,-15231.5"/>
</g>
<!-- ring_attn_1_9_stage_1&#45;&gt;ring_attn_1_9_stage_2 -->
<g id="edge902" class="edge">
<title>ring_attn_1_9_stage_1&#45;&gt;ring_attn_1_9_stage_2</title>
<path fill="none" stroke="black" d="M7757,-14906.87C7757,-14906.87 7757,-14800.25 7757,-14800.25"/>
<polygon fill="black" stroke="black" points="7760.5,-14800.25 7757,-14790.25 7753.5,-14800.25 7760.5,-14800.25"/>
</g>
<!-- ring_attn_1_10_stage_1 -->
<g id="node1009" class="node">
<title>ring_attn_1_10_stage_1</title>
<polygon fill="yellow" stroke="black" points="8344,-15043 8135,-14975 8344,-14907 8553,-14975 8344,-15043"/>
<text text-anchor="middle" x="8344" y="-14993.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-14978.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="8344" y="-14963.8" font-family="Times,serif" font-size="14.00">Q[10]×K[9]×V[9]</text>
<text text-anchor="middle" x="8344" y="-14948.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_9_stage_1&#45;&gt;ring_attn_1_10_stage_1 -->
<g id="edge2701" class="edge">
<title>ring_attn_1_9_stage_1&#45;&gt;ring_attn_1_10_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-14975C7966.02,-14975 8124.86,-14975 8124.86,-14975"/>
<polygon fill="red" stroke="red" points="8124.86,-14978.5 8134.86,-14975 8124.86,-14971.5 8124.86,-14978.5"/>
</g>
<!-- ring_attn_1_9_stage_2&#45;&gt;ring_attn_1_9_stage_3 -->
<g id="edge903" class="edge">
<title>ring_attn_1_9_stage_2&#45;&gt;ring_attn_1_9_stage_3</title>
<path fill="none" stroke="black" d="M7757,-14653.87C7757,-14653.87 7757,-14547.25 7757,-14547.25"/>
<polygon fill="black" stroke="black" points="7760.5,-14547.25 7757,-14537.25 7753.5,-14547.25 7760.5,-14547.25"/>
</g>
<!-- ring_attn_1_10_stage_2 -->
<g id="node1010" class="node">
<title>ring_attn_1_10_stage_2</title>
<polygon fill="yellow" stroke="black" points="8344,-14790 8135,-14722 8344,-14654 8553,-14722 8344,-14790"/>
<text text-anchor="middle" x="8344" y="-14740.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-14725.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="8344" y="-14710.8" font-family="Times,serif" font-size="14.00">Q[10]×K[8]×V[8]</text>
<text text-anchor="middle" x="8344" y="-14695.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_9_stage_2&#45;&gt;ring_attn_1_10_stage_2 -->
<g id="edge2702" class="edge">
<title>ring_attn_1_9_stage_2&#45;&gt;ring_attn_1_10_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-14722C7966.02,-14722 8124.86,-14722 8124.86,-14722"/>
<polygon fill="red" stroke="red" points="8124.86,-14725.5 8134.86,-14722 8124.86,-14718.5 8124.86,-14725.5"/>
</g>
<!-- ring_attn_1_9_stage_3&#45;&gt;ring_attn_1_9_stage_4 -->
<g id="edge904" class="edge">
<title>ring_attn_1_9_stage_3&#45;&gt;ring_attn_1_9_stage_4</title>
<path fill="none" stroke="black" d="M7757,-14400.87C7757,-14400.87 7757,-14294.25 7757,-14294.25"/>
<polygon fill="black" stroke="black" points="7760.5,-14294.25 7757,-14284.25 7753.5,-14294.25 7760.5,-14294.25"/>
</g>
<!-- ring_attn_1_10_stage_3 -->
<g id="node1011" class="node">
<title>ring_attn_1_10_stage_3</title>
<polygon fill="yellow" stroke="black" points="8344,-14537 8135,-14469 8344,-14401 8553,-14469 8344,-14537"/>
<text text-anchor="middle" x="8344" y="-14487.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-14472.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="8344" y="-14457.8" font-family="Times,serif" font-size="14.00">Q[10]×K[7]×V[7]</text>
<text text-anchor="middle" x="8344" y="-14442.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_9_stage_3&#45;&gt;ring_attn_1_10_stage_3 -->
<g id="edge2703" class="edge">
<title>ring_attn_1_9_stage_3&#45;&gt;ring_attn_1_10_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-14469C7966.02,-14469 8124.86,-14469 8124.86,-14469"/>
<polygon fill="red" stroke="red" points="8124.86,-14472.5 8134.86,-14469 8124.86,-14465.5 8124.86,-14472.5"/>
</g>
<!-- ring_attn_1_9_stage_4&#45;&gt;ring_attn_1_9_stage_5 -->
<g id="edge905" class="edge">
<title>ring_attn_1_9_stage_4&#45;&gt;ring_attn_1_9_stage_5</title>
<path fill="none" stroke="black" d="M7757,-14147.87C7757,-14147.87 7757,-14041.25 7757,-14041.25"/>
<polygon fill="black" stroke="black" points="7760.5,-14041.25 7757,-14031.25 7753.5,-14041.25 7760.5,-14041.25"/>
</g>
<!-- ring_attn_1_10_stage_4 -->
<g id="node1012" class="node">
<title>ring_attn_1_10_stage_4</title>
<polygon fill="yellow" stroke="black" points="8344,-14284 8135,-14216 8344,-14148 8553,-14216 8344,-14284"/>
<text text-anchor="middle" x="8344" y="-14234.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-14219.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="8344" y="-14204.8" font-family="Times,serif" font-size="14.00">Q[10]×K[6]×V[6]</text>
<text text-anchor="middle" x="8344" y="-14189.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_9_stage_4&#45;&gt;ring_attn_1_10_stage_4 -->
<g id="edge2704" class="edge">
<title>ring_attn_1_9_stage_4&#45;&gt;ring_attn_1_10_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-14216C7966.02,-14216 8124.86,-14216 8124.86,-14216"/>
<polygon fill="red" stroke="red" points="8124.86,-14219.5 8134.86,-14216 8124.86,-14212.5 8124.86,-14219.5"/>
</g>
<!-- ring_attn_1_9_stage_5&#45;&gt;ring_attn_1_9_stage_6 -->
<g id="edge906" class="edge">
<title>ring_attn_1_9_stage_5&#45;&gt;ring_attn_1_9_stage_6</title>
<path fill="none" stroke="black" d="M7757,-13894.87C7757,-13894.87 7757,-13788.25 7757,-13788.25"/>
<polygon fill="black" stroke="black" points="7760.5,-13788.25 7757,-13778.25 7753.5,-13788.25 7760.5,-13788.25"/>
</g>
<!-- ring_attn_1_10_stage_5 -->
<g id="node1013" class="node">
<title>ring_attn_1_10_stage_5</title>
<polygon fill="yellow" stroke="black" points="8344,-14031 8135,-13963 8344,-13895 8553,-13963 8344,-14031"/>
<text text-anchor="middle" x="8344" y="-13981.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-13966.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="8344" y="-13951.8" font-family="Times,serif" font-size="14.00">Q[10]×K[5]×V[5]</text>
<text text-anchor="middle" x="8344" y="-13936.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_9_stage_5&#45;&gt;ring_attn_1_10_stage_5 -->
<g id="edge2705" class="edge">
<title>ring_attn_1_9_stage_5&#45;&gt;ring_attn_1_10_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-13963C7966.02,-13963 8124.86,-13963 8124.86,-13963"/>
<polygon fill="red" stroke="red" points="8124.86,-13966.5 8134.86,-13963 8124.86,-13959.5 8124.86,-13966.5"/>
</g>
<!-- ring_attn_1_9_stage_6&#45;&gt;ring_attn_1_9_stage_7 -->
<g id="edge907" class="edge">
<title>ring_attn_1_9_stage_6&#45;&gt;ring_attn_1_9_stage_7</title>
<path fill="none" stroke="black" d="M7757,-13641.87C7757,-13641.87 7757,-13535.25 7757,-13535.25"/>
<polygon fill="black" stroke="black" points="7760.5,-13535.25 7757,-13525.25 7753.5,-13535.25 7760.5,-13535.25"/>
</g>
<!-- ring_attn_1_10_stage_6 -->
<g id="node1014" class="node">
<title>ring_attn_1_10_stage_6</title>
<polygon fill="yellow" stroke="black" points="8344,-13778 8135,-13710 8344,-13642 8553,-13710 8344,-13778"/>
<text text-anchor="middle" x="8344" y="-13728.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-13713.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="8344" y="-13698.8" font-family="Times,serif" font-size="14.00">Q[10]×K[4]×V[4]</text>
<text text-anchor="middle" x="8344" y="-13683.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_9_stage_6&#45;&gt;ring_attn_1_10_stage_6 -->
<g id="edge2706" class="edge">
<title>ring_attn_1_9_stage_6&#45;&gt;ring_attn_1_10_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-13710C7966.02,-13710 8124.86,-13710 8124.86,-13710"/>
<polygon fill="red" stroke="red" points="8124.86,-13713.5 8134.86,-13710 8124.86,-13706.5 8124.86,-13713.5"/>
</g>
<!-- ring_attn_1_9_stage_7&#45;&gt;ring_attn_1_9_stage_8 -->
<g id="edge908" class="edge">
<title>ring_attn_1_9_stage_7&#45;&gt;ring_attn_1_9_stage_8</title>
<path fill="none" stroke="black" d="M7757,-13388.87C7757,-13388.87 7757,-13282.25 7757,-13282.25"/>
<polygon fill="black" stroke="black" points="7760.5,-13282.25 7757,-13272.25 7753.5,-13282.25 7760.5,-13282.25"/>
</g>
<!-- ring_attn_1_10_stage_7 -->
<g id="node1015" class="node">
<title>ring_attn_1_10_stage_7</title>
<polygon fill="yellow" stroke="black" points="8344,-13525 8135,-13457 8344,-13389 8553,-13457 8344,-13525"/>
<text text-anchor="middle" x="8344" y="-13475.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-13460.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="8344" y="-13445.8" font-family="Times,serif" font-size="14.00">Q[10]×K[3]×V[3]</text>
<text text-anchor="middle" x="8344" y="-13430.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_9_stage_7&#45;&gt;ring_attn_1_10_stage_7 -->
<g id="edge2707" class="edge">
<title>ring_attn_1_9_stage_7&#45;&gt;ring_attn_1_10_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-13457C7966.02,-13457 8124.86,-13457 8124.86,-13457"/>
<polygon fill="red" stroke="red" points="8124.86,-13460.5 8134.86,-13457 8124.86,-13453.5 8124.86,-13460.5"/>
</g>
<!-- ring_attn_1_9_stage_8&#45;&gt;ring_attn_1_9_stage_9 -->
<g id="edge909" class="edge">
<title>ring_attn_1_9_stage_8&#45;&gt;ring_attn_1_9_stage_9</title>
<path fill="none" stroke="black" d="M7757,-13135.87C7757,-13135.87 7757,-13029.25 7757,-13029.25"/>
<polygon fill="black" stroke="black" points="7760.5,-13029.25 7757,-13019.25 7753.5,-13029.25 7760.5,-13029.25"/>
</g>
<!-- ring_attn_1_10_stage_8 -->
<g id="node1016" class="node">
<title>ring_attn_1_10_stage_8</title>
<polygon fill="yellow" stroke="black" points="8344,-13272 8135,-13204 8344,-13136 8553,-13204 8344,-13272"/>
<text text-anchor="middle" x="8344" y="-13222.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-13207.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="8344" y="-13192.8" font-family="Times,serif" font-size="14.00">Q[10]×K[2]×V[2]</text>
<text text-anchor="middle" x="8344" y="-13177.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_9_stage_8&#45;&gt;ring_attn_1_10_stage_8 -->
<g id="edge2708" class="edge">
<title>ring_attn_1_9_stage_8&#45;&gt;ring_attn_1_10_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-13204C7966.02,-13204 8124.86,-13204 8124.86,-13204"/>
<polygon fill="red" stroke="red" points="8124.86,-13207.5 8134.86,-13204 8124.86,-13200.5 8124.86,-13207.5"/>
</g>
<!-- ring_attn_1_9_stage_9&#45;&gt;ring_attn_1_9_stage_10 -->
<g id="edge910" class="edge">
<title>ring_attn_1_9_stage_9&#45;&gt;ring_attn_1_9_stage_10</title>
<path fill="none" stroke="black" d="M7757,-12882.87C7757,-12882.87 7757,-12776.25 7757,-12776.25"/>
<polygon fill="black" stroke="black" points="7760.5,-12776.25 7757,-12766.25 7753.5,-12776.25 7760.5,-12776.25"/>
</g>
<!-- ring_attn_1_10_stage_9 -->
<g id="node1017" class="node">
<title>ring_attn_1_10_stage_9</title>
<polygon fill="yellow" stroke="black" points="8344,-13019 8135,-12951 8344,-12883 8553,-12951 8344,-13019"/>
<text text-anchor="middle" x="8344" y="-12969.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-12954.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="8344" y="-12939.8" font-family="Times,serif" font-size="14.00">Q[10]×K[1]×V[1]</text>
<text text-anchor="middle" x="8344" y="-12924.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_9_stage_9&#45;&gt;ring_attn_1_10_stage_9 -->
<g id="edge2709" class="edge">
<title>ring_attn_1_9_stage_9&#45;&gt;ring_attn_1_10_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-12951C7966.02,-12951 8124.86,-12951 8124.86,-12951"/>
<polygon fill="red" stroke="red" points="8124.86,-12954.5 8134.86,-12951 8124.86,-12947.5 8124.86,-12954.5"/>
</g>
<!-- ring_attn_1_9_stage_10&#45;&gt;ring_attn_1_9_stage_11 -->
<g id="edge911" class="edge">
<title>ring_attn_1_9_stage_10&#45;&gt;ring_attn_1_9_stage_11</title>
<path fill="none" stroke="black" d="M7757,-12629.87C7757,-12629.87 7757,-12523.25 7757,-12523.25"/>
<polygon fill="black" stroke="black" points="7760.5,-12523.25 7757,-12513.25 7753.5,-12523.25 7760.5,-12523.25"/>
</g>
<!-- ring_attn_1_10_stage_10 -->
<g id="node1018" class="node">
<title>ring_attn_1_10_stage_10</title>
<polygon fill="yellow" stroke="black" points="8344,-12766 8135,-12698 8344,-12630 8553,-12698 8344,-12766"/>
<text text-anchor="middle" x="8344" y="-12716.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-12701.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="8344" y="-12686.8" font-family="Times,serif" font-size="14.00">Q[10]×K[0]×V[0]</text>
<text text-anchor="middle" x="8344" y="-12671.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_9_stage_10&#45;&gt;ring_attn_1_10_stage_10 -->
<g id="edge2710" class="edge">
<title>ring_attn_1_9_stage_10&#45;&gt;ring_attn_1_10_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-12698C7966.02,-12698 8124.86,-12698 8124.86,-12698"/>
<polygon fill="red" stroke="red" points="8124.86,-12701.5 8134.86,-12698 8124.86,-12694.5 8124.86,-12701.5"/>
</g>
<!-- ring_attn_1_9_stage_11&#45;&gt;ring_attn_1_9_stage_12 -->
<g id="edge912" class="edge">
<title>ring_attn_1_9_stage_11&#45;&gt;ring_attn_1_9_stage_12</title>
<path fill="none" stroke="black" d="M7757,-12376.87C7757,-12376.87 7757,-12270.25 7757,-12270.25"/>
<polygon fill="black" stroke="black" points="7760.5,-12270.25 7757,-12260.25 7753.5,-12270.25 7760.5,-12270.25"/>
</g>
<!-- ring_attn_1_10_stage_11 -->
<g id="node1019" class="node">
<title>ring_attn_1_10_stage_11</title>
<polygon fill="yellow" stroke="black" points="8344,-12513 8135,-12445 8344,-12377 8553,-12445 8344,-12513"/>
<text text-anchor="middle" x="8344" y="-12463.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-12448.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="8344" y="-12433.8" font-family="Times,serif" font-size="14.00">Q[10]×K[15]×V[15]</text>
<text text-anchor="middle" x="8344" y="-12418.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_9_stage_11&#45;&gt;ring_attn_1_10_stage_11 -->
<g id="edge2711" class="edge">
<title>ring_attn_1_9_stage_11&#45;&gt;ring_attn_1_10_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-12445C7966.02,-12445 8124.86,-12445 8124.86,-12445"/>
<polygon fill="red" stroke="red" points="8124.86,-12448.5 8134.86,-12445 8124.86,-12441.5 8124.86,-12448.5"/>
</g>
<!-- ring_attn_1_9_stage_12&#45;&gt;ring_attn_1_9_stage_13 -->
<g id="edge913" class="edge">
<title>ring_attn_1_9_stage_12&#45;&gt;ring_attn_1_9_stage_13</title>
<path fill="none" stroke="black" d="M7757,-12123.87C7757,-12123.87 7757,-12017.25 7757,-12017.25"/>
<polygon fill="black" stroke="black" points="7760.5,-12017.25 7757,-12007.25 7753.5,-12017.25 7760.5,-12017.25"/>
</g>
<!-- ring_attn_1_10_stage_12 -->
<g id="node1020" class="node">
<title>ring_attn_1_10_stage_12</title>
<polygon fill="yellow" stroke="black" points="8344,-12260 8135,-12192 8344,-12124 8553,-12192 8344,-12260"/>
<text text-anchor="middle" x="8344" y="-12210.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-12195.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="8344" y="-12180.8" font-family="Times,serif" font-size="14.00">Q[10]×K[14]×V[14]</text>
<text text-anchor="middle" x="8344" y="-12165.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_9_stage_12&#45;&gt;ring_attn_1_10_stage_12 -->
<g id="edge2712" class="edge">
<title>ring_attn_1_9_stage_12&#45;&gt;ring_attn_1_10_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-12192C7966.02,-12192 8124.86,-12192 8124.86,-12192"/>
<polygon fill="red" stroke="red" points="8124.86,-12195.5 8134.86,-12192 8124.86,-12188.5 8124.86,-12195.5"/>
</g>
<!-- ring_attn_1_9_stage_13&#45;&gt;ring_attn_1_9_stage_14 -->
<g id="edge914" class="edge">
<title>ring_attn_1_9_stage_13&#45;&gt;ring_attn_1_9_stage_14</title>
<path fill="none" stroke="black" d="M7757,-11870.87C7757,-11870.87 7757,-11764.25 7757,-11764.25"/>
<polygon fill="black" stroke="black" points="7760.5,-11764.25 7757,-11754.25 7753.5,-11764.25 7760.5,-11764.25"/>
</g>
<!-- ring_attn_1_10_stage_13 -->
<g id="node1021" class="node">
<title>ring_attn_1_10_stage_13</title>
<polygon fill="yellow" stroke="black" points="8344,-12007 8135,-11939 8344,-11871 8553,-11939 8344,-12007"/>
<text text-anchor="middle" x="8344" y="-11957.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-11942.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="8344" y="-11927.8" font-family="Times,serif" font-size="14.00">Q[10]×K[13]×V[13]</text>
<text text-anchor="middle" x="8344" y="-11912.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_9_stage_13&#45;&gt;ring_attn_1_10_stage_13 -->
<g id="edge2713" class="edge">
<title>ring_attn_1_9_stage_13&#45;&gt;ring_attn_1_10_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-11939C7966.02,-11939 8124.86,-11939 8124.86,-11939"/>
<polygon fill="red" stroke="red" points="8124.86,-11942.5 8134.86,-11939 8124.86,-11935.5 8124.86,-11942.5"/>
</g>
<!-- ring_attn_1_9_stage_14&#45;&gt;ring_attn_1_9_stage_15 -->
<g id="edge915" class="edge">
<title>ring_attn_1_9_stage_14&#45;&gt;ring_attn_1_9_stage_15</title>
<path fill="none" stroke="black" d="M7757,-11617.87C7757,-11617.87 7757,-11511.25 7757,-11511.25"/>
<polygon fill="black" stroke="black" points="7760.5,-11511.25 7757,-11501.25 7753.5,-11511.25 7760.5,-11511.25"/>
</g>
<!-- ring_attn_1_10_stage_14 -->
<g id="node1022" class="node">
<title>ring_attn_1_10_stage_14</title>
<polygon fill="yellow" stroke="black" points="8344,-11754 8135,-11686 8344,-11618 8553,-11686 8344,-11754"/>
<text text-anchor="middle" x="8344" y="-11704.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-11689.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="8344" y="-11674.8" font-family="Times,serif" font-size="14.00">Q[10]×K[12]×V[12]</text>
<text text-anchor="middle" x="8344" y="-11659.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_9_stage_14&#45;&gt;ring_attn_1_10_stage_14 -->
<g id="edge2714" class="edge">
<title>ring_attn_1_9_stage_14&#45;&gt;ring_attn_1_10_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-11686C7966.02,-11686 8124.86,-11686 8124.86,-11686"/>
<polygon fill="red" stroke="red" points="8124.86,-11689.5 8134.86,-11686 8124.86,-11682.5 8124.86,-11689.5"/>
</g>
<!-- attn_out_1_9 -->
<g id="node926" class="node">
<title>attn_out_1_9</title>
<polygon fill="none" stroke="black" points="7826.5,-11292 7687.5,-11292 7687.5,-11239 7826.5,-11239 7826.5,-11292"/>
<text text-anchor="middle" x="7757" y="-11276.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="7757" y="-11261.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="7757" y="-11246.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_1_9_stage_15&#45;&gt;attn_out_1_9 -->
<g id="edge916" class="edge">
<title>ring_attn_1_9_stage_15&#45;&gt;attn_out_1_9</title>
<path fill="none" stroke="black" d="M7757,-11364.87C7757,-11364.87 7757,-11302.18 7757,-11302.18"/>
<polygon fill="black" stroke="black" points="7760.5,-11302.18 7757,-11292.18 7753.5,-11302.18 7760.5,-11302.18"/>
</g>
<!-- ring_attn_1_10_stage_15 -->
<g id="node1023" class="node">
<title>ring_attn_1_10_stage_15</title>
<polygon fill="yellow" stroke="black" points="8344,-11501 8135,-11433 8344,-11365 8553,-11433 8344,-11501"/>
<text text-anchor="middle" x="8344" y="-11451.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-11436.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="8344" y="-11421.8" font-family="Times,serif" font-size="14.00">Q[10]×K[11]×V[11]</text>
<text text-anchor="middle" x="8344" y="-11406.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_9_stage_15&#45;&gt;ring_attn_1_10_stage_15 -->
<g id="edge2715" class="edge">
<title>ring_attn_1_9_stage_15&#45;&gt;ring_attn_1_10_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-11433C7966.02,-11433 8124.86,-11433 8124.86,-11433"/>
<polygon fill="red" stroke="red" points="8124.86,-11436.5 8134.86,-11433 8124.86,-11429.5 8124.86,-11436.5"/>
</g>
<!-- attn_residual_1_9 -->
<g id="node927" class="node">
<title>attn_residual_1_9</title>
<ellipse fill="none" stroke="black" cx="7757" cy="-11139" rx="105.5" ry="27"/>
<text text-anchor="middle" x="7757" y="-11142.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="7757" y="-11127.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_1_9&#45;&gt;attn_residual_1_9 -->
<g id="edge917" class="edge">
<title>attn_out_1_9&#45;&gt;attn_residual_1_9</title>
<path fill="none" stroke="black" d="M7757,-11238.98C7757,-11238.98 7757,-11176.36 7757,-11176.36"/>
<polygon fill="black" stroke="black" points="7760.5,-11176.36 7757,-11166.36 7753.5,-11176.36 7760.5,-11176.36"/>
</g>
<!-- gate_1_9 -->
<g id="node928" class="node">
<title>gate_1_9</title>
<ellipse fill="orange" stroke="black" cx="7757" cy="-11001.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="7757" y="-11012.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="7757" y="-10997.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="7757" y="-10982.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_1_9&#45;&gt;gate_1_9 -->
<g id="edge918" class="edge">
<title>attn_residual_1_9&#45;&gt;gate_1_9</title>
<path fill="none" stroke="black" d="M7809.75,-11115.36C7809.75,-11115.36 7809.75,-11044.08 7809.75,-11044.08"/>
<polygon fill="black" stroke="black" points="7813.25,-11044.08 7809.75,-11034.08 7806.25,-11044.08 7813.25,-11044.08"/>
</g>
<!-- gate_1_9&#45;&gt;expert_1_0_0 -->
<g id="edge2716" class="edge">
<title>gate_1_9&#45;&gt;expert_1_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7757,-11039.26C7757,-11065.21 7757,-11095 7757,-11095 7757,-11095 116.8,-11095 116.8,-11095 116.8,-11095 116.8,-10842.22 116.8,-10842.22"/>
<polygon fill="blue" stroke="blue" points="120.3,-10842.22 116.8,-10832.22 113.3,-10842.22 120.3,-10842.22"/>
<text text-anchor="middle" x="32486.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="32486.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU9→GPU0</text>
<text text-anchor="middle" x="32486.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="32486.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_9&#45;&gt;expert_1_1_0 -->
<g id="edge2717" class="edge">
<title>gate_1_9&#45;&gt;expert_1_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7704.25,-11034.2C7704.25,-11039.34 7704.25,-11043 7704.25,-11043 7704.25,-11043 3172.29,-11043 3172.29,-11043 3172.29,-11043 3172.29,-10842.28 3172.29,-10842.28"/>
<polygon fill="blue" stroke="blue" points="3175.79,-10842.28 3172.29,-10832.28 3168.79,-10842.28 3175.79,-10842.28"/>
<text text-anchor="middle" x="32660.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="32660.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU9→GPU1</text>
<text text-anchor="middle" x="32660.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="32660.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_9&#45;&gt;expert_1_2_0 -->
<g id="edge2718" class="edge">
<title>gate_1_9&#45;&gt;expert_1_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7670.68,-10979.78C7670.68,-10944.83 7670.68,-10880 7670.68,-10880 7670.68,-10880 3605.02,-10880 3605.02,-10880 3605.02,-10880 3605.02,-10842.4 3605.02,-10842.4"/>
<polygon fill="blue" stroke="blue" points="3608.52,-10842.4 3605.02,-10832.4 3601.52,-10842.4 3608.52,-10842.4"/>
<text text-anchor="middle" x="32834.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="32834.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU9→GPU2</text>
<text text-anchor="middle" x="32834.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="32834.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_9&#45;&gt;expert_1_3_0 -->
<g id="edge2719" class="edge">
<title>gate_1_9&#45;&gt;expert_1_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7689.86,-10972.5C7689.86,-10939.46 7689.86,-10890 7689.86,-10890 7689.86,-10890 4197.02,-10890 4197.02,-10890 4197.02,-10890 4197.02,-10842.24 4197.02,-10842.24"/>
<polygon fill="blue" stroke="blue" points="4200.52,-10842.24 4197.02,-10832.24 4193.52,-10842.24 4200.52,-10842.24"/>
<text text-anchor="middle" x="33008.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33008.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU9→GPU3</text>
<text text-anchor="middle" x="33008.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33008.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_9&#45;&gt;expert_1_4_0 -->
<g id="edge2720" class="edge">
<title>gate_1_9&#45;&gt;expert_1_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7709.05,-10967.9C7709.05,-10937.68 7709.05,-10898 7709.05,-10898 7709.05,-10898 4796.88,-10898 4796.88,-10898 4796.88,-10898 4796.88,-10842.25 4796.88,-10842.25"/>
<polygon fill="blue" stroke="blue" points="4800.38,-10842.25 4796.88,-10832.25 4793.38,-10842.25 4800.38,-10842.25"/>
<text text-anchor="middle" x="33182.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33182.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU9→GPU4</text>
<text text-anchor="middle" x="33182.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33182.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_9&#45;&gt;expert_1_5_0 -->
<g id="edge2721" class="edge">
<title>gate_1_9&#45;&gt;expert_1_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7728.23,-10965.12C7728.23,-10942.62 7728.23,-10918 7728.23,-10918 7728.23,-10918 5393.93,-10918 5393.93,-10918 5393.93,-10918 5393.93,-10842.16 5393.93,-10842.16"/>
<polygon fill="blue" stroke="blue" points="5397.43,-10842.16 5393.93,-10832.16 5390.43,-10842.16 5397.43,-10842.16"/>
<text text-anchor="middle" x="33356.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33356.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU9→GPU5</text>
<text text-anchor="middle" x="33356.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33356.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_9&#45;&gt;expert_1_6_0 -->
<g id="edge2722" class="edge">
<title>gate_1_9&#45;&gt;expert_1_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7747.41,-10964.15C7747.41,-10944.73 7747.41,-10925 7747.41,-10925 7747.41,-10925 5974.9,-10925 5974.9,-10925 5974.9,-10925 5974.9,-10842.02 5974.9,-10842.02"/>
<polygon fill="blue" stroke="blue" points="5978.4,-10842.02 5974.9,-10832.02 5971.4,-10842.02 5978.4,-10842.02"/>
<text text-anchor="middle" x="33530.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33530.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU9→GPU6</text>
<text text-anchor="middle" x="33530.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33530.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_9&#45;&gt;expert_1_7_0 -->
<g id="edge2723" class="edge">
<title>gate_1_9&#45;&gt;expert_1_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7757,-10963.97C7757,-10958.68 7757,-10955 7757,-10955 7757,-10955 6698.62,-10955 6698.62,-10955 6698.62,-10955 6698.62,-10842.23 6698.62,-10842.23"/>
<polygon fill="blue" stroke="blue" points="6702.13,-10842.23 6698.62,-10832.23 6695.13,-10842.23 6702.13,-10842.23"/>
<text text-anchor="middle" x="33704.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33704.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU9→GPU7</text>
<text text-anchor="middle" x="33704.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33704.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_9&#45;&gt;expert_1_8_0 -->
<g id="edge2724" class="edge">
<title>gate_1_9&#45;&gt;expert_1_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7657.3,-11014C7517.46,-11014 7280,-11014 7280,-11014 7280,-11014 7280,-10842.33 7280,-10842.33"/>
<polygon fill="blue" stroke="blue" points="7283.5,-10842.33 7280,-10832.33 7276.5,-10842.33 7283.5,-10842.33"/>
<text text-anchor="middle" x="33878.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33878.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU9→GPU8</text>
<text text-anchor="middle" x="33878.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33878.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_9&#45;&gt;expert_1_9_0 -->
<g id="edge919" class="edge">
<title>gate_1_9&#45;&gt;expert_1_9_0</title>
<path fill="none" stroke="black" d="M7766.59,-10963.71C7766.59,-10963.71 7766.59,-10842.18 7766.59,-10842.18"/>
<polygon fill="black" stroke="black" points="7770.09,-10842.18 7766.59,-10832.18 7763.09,-10842.18 7770.09,-10842.18"/>
</g>
<!-- gate_1_9&#45;&gt;expert_1_10_0 -->
<g id="edge2725" class="edge">
<title>gate_1_9&#45;&gt;expert_1_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7856.52,-10989C7996.09,-10989 8233.1,-10989 8233.1,-10989 8233.1,-10989 8233.1,-10842.18 8233.1,-10842.18"/>
<polygon fill="blue" stroke="blue" points="8236.6,-10842.18 8233.1,-10832.18 8229.6,-10842.18 8236.6,-10842.18"/>
<text text-anchor="middle" x="34052.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34052.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU9→GPU10</text>
<text text-anchor="middle" x="34052.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34052.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_9&#45;&gt;expert_1_11_0 -->
<g id="edge2726" class="edge">
<title>gate_1_9&#45;&gt;expert_1_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7814.55,-10969.8C7814.55,-10957.81 7814.55,-10947 7814.55,-10947 7814.55,-10947 8818.75,-10947 8818.75,-10947 8818.75,-10947 8818.75,-10842.12 8818.75,-10842.12"/>
<polygon fill="blue" stroke="blue" points="8822.25,-10842.12 8818.75,-10832.12 8815.25,-10842.12 8822.25,-10842.12"/>
<text text-anchor="middle" x="34226.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34226.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU9→GPU11</text>
<text text-anchor="middle" x="34226.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34226.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_9&#45;&gt;expert_1_12_0 -->
<g id="edge2727" class="edge">
<title>gate_1_9&#45;&gt;expert_1_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7824.14,-10972.52C7824.14,-10946.71 7824.14,-10913 7824.14,-10913 7824.14,-10913 9402.38,-10913 9402.38,-10913 9402.38,-10913 9402.38,-10842.07 9402.38,-10842.07"/>
<polygon fill="blue" stroke="blue" points="9405.88,-10842.07 9402.38,-10832.07 9398.88,-10842.07 9405.88,-10842.07"/>
<text text-anchor="middle" x="34400.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34400.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU9→GPU12</text>
<text text-anchor="middle" x="34400.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34400.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_9&#45;&gt;expert_1_13_0 -->
<g id="edge2728" class="edge">
<title>gate_1_9&#45;&gt;expert_1_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7833.73,-10975.64C7833.73,-10947.06 7833.73,-10905 7833.73,-10905 7833.73,-10905 10168.3,-10905 10168.3,-10905 10168.3,-10905 10168.3,-10842.16 10168.3,-10842.16"/>
<polygon fill="blue" stroke="blue" points="10171.8,-10842.16 10168.3,-10832.16 10164.8,-10842.16 10171.8,-10842.16"/>
<text text-anchor="middle" x="34574.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34574.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU9→GPU13</text>
<text text-anchor="middle" x="34574.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34574.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_9&#45;&gt;expert_1_14_0 -->
<g id="edge2729" class="edge">
<title>gate_1_9&#45;&gt;expert_1_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7843.32,-10979.76C7843.32,-10949.67 7843.32,-10899 7843.32,-10899 7843.32,-10899 10737.21,-10899 10737.21,-10899 10737.21,-10899 10737.21,-10842.04 10737.21,-10842.04"/>
<polygon fill="blue" stroke="blue" points="10740.71,-10842.04 10737.21,-10832.04 10733.71,-10842.04 10740.71,-10842.04"/>
<text text-anchor="middle" x="34748.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34748.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU9→GPU14</text>
<text text-anchor="middle" x="34748.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34748.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_9&#45;&gt;expert_1_15_0 -->
<g id="edge2730" class="edge">
<title>gate_1_9&#45;&gt;expert_1_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7852.91,-10985.49C7852.91,-10955.31 7852.91,-10893 7852.91,-10893 7852.91,-10893 11306.76,-10893 11306.76,-10893 11306.76,-10893 11306.76,-10842.23 11306.76,-10842.23"/>
<polygon fill="blue" stroke="blue" points="11310.26,-10842.23 11306.76,-10832.23 11303.26,-10842.23 11310.26,-10842.23"/>
<text text-anchor="middle" x="34922.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34922.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU9→GPU15</text>
<text text-anchor="middle" x="34922.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34922.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_9 -->
<g id="node930" class="node">
<title>expert_reduce_1_9</title>
<ellipse fill="none" stroke="black" cx="7757" cy="-10668.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="7757" y="-10679.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="7757" y="-10664.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="7757" y="-10649.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_9_0&#45;&gt;expert_reduce_1_9 -->
<g id="edge920" class="edge">
<title>expert_1_9_0&#45;&gt;expert_reduce_1_9</title>
<path fill="none" stroke="black" d="M7757,-10778.76C7757,-10778.76 7757,-10716.06 7757,-10716.06"/>
<polygon fill="black" stroke="black" points="7760.5,-10716.06 7757,-10706.06 7753.5,-10716.06 7760.5,-10716.06"/>
</g>
<!-- moe_residual_1_9 -->
<g id="node931" class="node">
<title>moe_residual_1_9</title>
<ellipse fill="none" stroke="black" cx="7757" cy="-10531" rx="105.5" ry="27"/>
<text text-anchor="middle" x="7757" y="-10534.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="7757" y="-10519.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_9&#45;&gt;moe_residual_1_9 -->
<g id="edge921" class="edge">
<title>expert_reduce_1_9&#45;&gt;moe_residual_1_9</title>
<path fill="none" stroke="black" d="M7757,-10630.93C7757,-10630.93 7757,-10568.06 7757,-10568.06"/>
<polygon fill="black" stroke="black" points="7760.5,-10568.06 7757,-10558.06 7753.5,-10568.06 7760.5,-10568.06"/>
</g>
<!-- qkv_proj_2_9 -->
<g id="node932" class="node">
<title>qkv_proj_2_9</title>
<polygon fill="none" stroke="black" points="7839.5,-10431 7674.5,-10431 7674.5,-10378 7839.5,-10378 7839.5,-10431"/>
<text text-anchor="middle" x="7757" y="-10415.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="7757" y="-10400.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="7757" y="-10385.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_1_9&#45;&gt;qkv_proj_2_9 -->
<g id="edge922" class="edge">
<title>moe_residual_1_9&#45;&gt;qkv_proj_2_9</title>
<path fill="none" stroke="black" d="M7757,-10503.86C7757,-10503.86 7757,-10441.16 7757,-10441.16"/>
<polygon fill="black" stroke="black" points="7760.5,-10441.16 7757,-10431.16 7753.5,-10441.16 7760.5,-10441.16"/>
</g>
<!-- qkv_reshape_2_9 -->
<g id="node933" class="node">
<title>qkv_reshape_2_9</title>
<ellipse fill="none" stroke="black" cx="7757" cy="-10278" rx="148" ry="27"/>
<text text-anchor="middle" x="7757" y="-10281.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="7757" y="-10266.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_2_9&#45;&gt;qkv_reshape_2_9 -->
<g id="edge923" class="edge">
<title>qkv_proj_2_9&#45;&gt;qkv_reshape_2_9</title>
<path fill="none" stroke="black" d="M7757,-10377.98C7757,-10377.98 7757,-10315.36 7757,-10315.36"/>
<polygon fill="black" stroke="black" points="7760.5,-10315.36 7757,-10305.36 7753.5,-10315.36 7760.5,-10315.36"/>
</g>
<!-- qkv_reshape_2_9&#45;&gt;ring_attn_2_9_stage_0 -->
<g id="edge924" class="edge">
<title>qkv_reshape_2_9&#45;&gt;ring_attn_2_9_stage_0</title>
<path fill="none" stroke="black" d="M7757,-10250.72C7757,-10250.72 7757,-10144.16 7757,-10144.16"/>
<polygon fill="black" stroke="black" points="7760.5,-10144.16 7757,-10134.16 7753.5,-10144.16 7760.5,-10144.16"/>
</g>
<!-- ring_attn_2_9_stage_0&#45;&gt;ring_attn_2_9_stage_1 -->
<g id="edge925" class="edge">
<title>ring_attn_2_9_stage_0&#45;&gt;ring_attn_2_9_stage_1</title>
<path fill="none" stroke="black" d="M7757,-9997.87C7757,-9997.87 7757,-9891.25 7757,-9891.25"/>
<polygon fill="black" stroke="black" points="7760.5,-9891.25 7757,-9881.25 7753.5,-9891.25 7760.5,-9891.25"/>
</g>
<!-- ring_attn_2_10_stage_0 -->
<g id="node1032" class="node">
<title>ring_attn_2_10_stage_0</title>
<polygon fill="yellow" stroke="black" points="8344,-10134 8135,-10066 8344,-9998 8553,-10066 8344,-10134"/>
<text text-anchor="middle" x="8344" y="-10084.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-10069.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="8344" y="-10054.8" font-family="Times,serif" font-size="14.00">Q[10]×K[10]×V[10]</text>
<text text-anchor="middle" x="8344" y="-10039.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_9_stage_0&#45;&gt;ring_attn_2_10_stage_0 -->
<g id="edge2731" class="edge">
<title>ring_attn_2_9_stage_0&#45;&gt;ring_attn_2_10_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-10066C7966.02,-10066 8124.86,-10066 8124.86,-10066"/>
<polygon fill="red" stroke="red" points="8124.86,-10069.5 8134.86,-10066 8124.86,-10062.5 8124.86,-10069.5"/>
</g>
<!-- ring_attn_2_9_stage_1&#45;&gt;ring_attn_2_9_stage_2 -->
<g id="edge926" class="edge">
<title>ring_attn_2_9_stage_1&#45;&gt;ring_attn_2_9_stage_2</title>
<path fill="none" stroke="black" d="M7757,-9744.87C7757,-9744.87 7757,-9638.25 7757,-9638.25"/>
<polygon fill="black" stroke="black" points="7760.5,-9638.25 7757,-9628.25 7753.5,-9638.25 7760.5,-9638.25"/>
</g>
<!-- ring_attn_2_10_stage_1 -->
<g id="node1033" class="node">
<title>ring_attn_2_10_stage_1</title>
<polygon fill="yellow" stroke="black" points="8344,-9881 8135,-9813 8344,-9745 8553,-9813 8344,-9881"/>
<text text-anchor="middle" x="8344" y="-9831.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-9816.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="8344" y="-9801.8" font-family="Times,serif" font-size="14.00">Q[10]×K[9]×V[9]</text>
<text text-anchor="middle" x="8344" y="-9786.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_9_stage_1&#45;&gt;ring_attn_2_10_stage_1 -->
<g id="edge2732" class="edge">
<title>ring_attn_2_9_stage_1&#45;&gt;ring_attn_2_10_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-9813C7966.02,-9813 8124.86,-9813 8124.86,-9813"/>
<polygon fill="red" stroke="red" points="8124.86,-9816.5 8134.86,-9813 8124.86,-9809.5 8124.86,-9816.5"/>
</g>
<!-- ring_attn_2_9_stage_2&#45;&gt;ring_attn_2_9_stage_3 -->
<g id="edge927" class="edge">
<title>ring_attn_2_9_stage_2&#45;&gt;ring_attn_2_9_stage_3</title>
<path fill="none" stroke="black" d="M7757,-9491.87C7757,-9491.87 7757,-9385.25 7757,-9385.25"/>
<polygon fill="black" stroke="black" points="7760.5,-9385.25 7757,-9375.25 7753.5,-9385.25 7760.5,-9385.25"/>
</g>
<!-- ring_attn_2_10_stage_2 -->
<g id="node1034" class="node">
<title>ring_attn_2_10_stage_2</title>
<polygon fill="yellow" stroke="black" points="8344,-9628 8135,-9560 8344,-9492 8553,-9560 8344,-9628"/>
<text text-anchor="middle" x="8344" y="-9578.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-9563.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="8344" y="-9548.8" font-family="Times,serif" font-size="14.00">Q[10]×K[8]×V[8]</text>
<text text-anchor="middle" x="8344" y="-9533.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_9_stage_2&#45;&gt;ring_attn_2_10_stage_2 -->
<g id="edge2733" class="edge">
<title>ring_attn_2_9_stage_2&#45;&gt;ring_attn_2_10_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-9560C7966.02,-9560 8124.86,-9560 8124.86,-9560"/>
<polygon fill="red" stroke="red" points="8124.86,-9563.5 8134.86,-9560 8124.86,-9556.5 8124.86,-9563.5"/>
</g>
<!-- ring_attn_2_9_stage_3&#45;&gt;ring_attn_2_9_stage_4 -->
<g id="edge928" class="edge">
<title>ring_attn_2_9_stage_3&#45;&gt;ring_attn_2_9_stage_4</title>
<path fill="none" stroke="black" d="M7757,-9238.87C7757,-9238.87 7757,-9132.25 7757,-9132.25"/>
<polygon fill="black" stroke="black" points="7760.5,-9132.25 7757,-9122.25 7753.5,-9132.25 7760.5,-9132.25"/>
</g>
<!-- ring_attn_2_10_stage_3 -->
<g id="node1035" class="node">
<title>ring_attn_2_10_stage_3</title>
<polygon fill="yellow" stroke="black" points="8344,-9375 8135,-9307 8344,-9239 8553,-9307 8344,-9375"/>
<text text-anchor="middle" x="8344" y="-9325.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-9310.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="8344" y="-9295.8" font-family="Times,serif" font-size="14.00">Q[10]×K[7]×V[7]</text>
<text text-anchor="middle" x="8344" y="-9280.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_9_stage_3&#45;&gt;ring_attn_2_10_stage_3 -->
<g id="edge2734" class="edge">
<title>ring_attn_2_9_stage_3&#45;&gt;ring_attn_2_10_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-9307C7966.02,-9307 8124.86,-9307 8124.86,-9307"/>
<polygon fill="red" stroke="red" points="8124.86,-9310.5 8134.86,-9307 8124.86,-9303.5 8124.86,-9310.5"/>
</g>
<!-- ring_attn_2_9_stage_4&#45;&gt;ring_attn_2_9_stage_5 -->
<g id="edge929" class="edge">
<title>ring_attn_2_9_stage_4&#45;&gt;ring_attn_2_9_stage_5</title>
<path fill="none" stroke="black" d="M7757,-8985.87C7757,-8985.87 7757,-8879.25 7757,-8879.25"/>
<polygon fill="black" stroke="black" points="7760.5,-8879.25 7757,-8869.25 7753.5,-8879.25 7760.5,-8879.25"/>
</g>
<!-- ring_attn_2_10_stage_4 -->
<g id="node1036" class="node">
<title>ring_attn_2_10_stage_4</title>
<polygon fill="yellow" stroke="black" points="8344,-9122 8135,-9054 8344,-8986 8553,-9054 8344,-9122"/>
<text text-anchor="middle" x="8344" y="-9072.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-9057.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="8344" y="-9042.8" font-family="Times,serif" font-size="14.00">Q[10]×K[6]×V[6]</text>
<text text-anchor="middle" x="8344" y="-9027.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_9_stage_4&#45;&gt;ring_attn_2_10_stage_4 -->
<g id="edge2735" class="edge">
<title>ring_attn_2_9_stage_4&#45;&gt;ring_attn_2_10_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-9054C7966.02,-9054 8124.86,-9054 8124.86,-9054"/>
<polygon fill="red" stroke="red" points="8124.86,-9057.5 8134.86,-9054 8124.86,-9050.5 8124.86,-9057.5"/>
</g>
<!-- ring_attn_2_9_stage_5&#45;&gt;ring_attn_2_9_stage_6 -->
<g id="edge930" class="edge">
<title>ring_attn_2_9_stage_5&#45;&gt;ring_attn_2_9_stage_6</title>
<path fill="none" stroke="black" d="M7757,-8732.87C7757,-8732.87 7757,-8626.25 7757,-8626.25"/>
<polygon fill="black" stroke="black" points="7760.5,-8626.25 7757,-8616.25 7753.5,-8626.25 7760.5,-8626.25"/>
</g>
<!-- ring_attn_2_10_stage_5 -->
<g id="node1037" class="node">
<title>ring_attn_2_10_stage_5</title>
<polygon fill="yellow" stroke="black" points="8344,-8869 8135,-8801 8344,-8733 8553,-8801 8344,-8869"/>
<text text-anchor="middle" x="8344" y="-8819.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-8804.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="8344" y="-8789.8" font-family="Times,serif" font-size="14.00">Q[10]×K[5]×V[5]</text>
<text text-anchor="middle" x="8344" y="-8774.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_9_stage_5&#45;&gt;ring_attn_2_10_stage_5 -->
<g id="edge2736" class="edge">
<title>ring_attn_2_9_stage_5&#45;&gt;ring_attn_2_10_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-8801C7966.02,-8801 8124.86,-8801 8124.86,-8801"/>
<polygon fill="red" stroke="red" points="8124.86,-8804.5 8134.86,-8801 8124.86,-8797.5 8124.86,-8804.5"/>
</g>
<!-- ring_attn_2_9_stage_6&#45;&gt;ring_attn_2_9_stage_7 -->
<g id="edge931" class="edge">
<title>ring_attn_2_9_stage_6&#45;&gt;ring_attn_2_9_stage_7</title>
<path fill="none" stroke="black" d="M7757,-8479.87C7757,-8479.87 7757,-8373.25 7757,-8373.25"/>
<polygon fill="black" stroke="black" points="7760.5,-8373.25 7757,-8363.25 7753.5,-8373.25 7760.5,-8373.25"/>
</g>
<!-- ring_attn_2_10_stage_6 -->
<g id="node1038" class="node">
<title>ring_attn_2_10_stage_6</title>
<polygon fill="yellow" stroke="black" points="8344,-8616 8135,-8548 8344,-8480 8553,-8548 8344,-8616"/>
<text text-anchor="middle" x="8344" y="-8566.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-8551.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="8344" y="-8536.8" font-family="Times,serif" font-size="14.00">Q[10]×K[4]×V[4]</text>
<text text-anchor="middle" x="8344" y="-8521.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_9_stage_6&#45;&gt;ring_attn_2_10_stage_6 -->
<g id="edge2737" class="edge">
<title>ring_attn_2_9_stage_6&#45;&gt;ring_attn_2_10_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-8548C7966.02,-8548 8124.86,-8548 8124.86,-8548"/>
<polygon fill="red" stroke="red" points="8124.86,-8551.5 8134.86,-8548 8124.86,-8544.5 8124.86,-8551.5"/>
</g>
<!-- ring_attn_2_9_stage_7&#45;&gt;ring_attn_2_9_stage_8 -->
<g id="edge932" class="edge">
<title>ring_attn_2_9_stage_7&#45;&gt;ring_attn_2_9_stage_8</title>
<path fill="none" stroke="black" d="M7757,-8226.87C7757,-8226.87 7757,-8120.25 7757,-8120.25"/>
<polygon fill="black" stroke="black" points="7760.5,-8120.25 7757,-8110.25 7753.5,-8120.25 7760.5,-8120.25"/>
</g>
<!-- ring_attn_2_10_stage_7 -->
<g id="node1039" class="node">
<title>ring_attn_2_10_stage_7</title>
<polygon fill="yellow" stroke="black" points="8344,-8363 8135,-8295 8344,-8227 8553,-8295 8344,-8363"/>
<text text-anchor="middle" x="8344" y="-8313.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-8298.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="8344" y="-8283.8" font-family="Times,serif" font-size="14.00">Q[10]×K[3]×V[3]</text>
<text text-anchor="middle" x="8344" y="-8268.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_9_stage_7&#45;&gt;ring_attn_2_10_stage_7 -->
<g id="edge2738" class="edge">
<title>ring_attn_2_9_stage_7&#45;&gt;ring_attn_2_10_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-8295C7966.02,-8295 8124.86,-8295 8124.86,-8295"/>
<polygon fill="red" stroke="red" points="8124.86,-8298.5 8134.86,-8295 8124.86,-8291.5 8124.86,-8298.5"/>
</g>
<!-- ring_attn_2_9_stage_8&#45;&gt;ring_attn_2_9_stage_9 -->
<g id="edge933" class="edge">
<title>ring_attn_2_9_stage_8&#45;&gt;ring_attn_2_9_stage_9</title>
<path fill="none" stroke="black" d="M7757,-7973.87C7757,-7973.87 7757,-7867.25 7757,-7867.25"/>
<polygon fill="black" stroke="black" points="7760.5,-7867.25 7757,-7857.25 7753.5,-7867.25 7760.5,-7867.25"/>
</g>
<!-- ring_attn_2_10_stage_8 -->
<g id="node1040" class="node">
<title>ring_attn_2_10_stage_8</title>
<polygon fill="yellow" stroke="black" points="8344,-8110 8135,-8042 8344,-7974 8553,-8042 8344,-8110"/>
<text text-anchor="middle" x="8344" y="-8060.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-8045.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="8344" y="-8030.8" font-family="Times,serif" font-size="14.00">Q[10]×K[2]×V[2]</text>
<text text-anchor="middle" x="8344" y="-8015.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_9_stage_8&#45;&gt;ring_attn_2_10_stage_8 -->
<g id="edge2739" class="edge">
<title>ring_attn_2_9_stage_8&#45;&gt;ring_attn_2_10_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-8042C7966.02,-8042 8124.86,-8042 8124.86,-8042"/>
<polygon fill="red" stroke="red" points="8124.86,-8045.5 8134.86,-8042 8124.86,-8038.5 8124.86,-8045.5"/>
</g>
<!-- ring_attn_2_9_stage_9&#45;&gt;ring_attn_2_9_stage_10 -->
<g id="edge934" class="edge">
<title>ring_attn_2_9_stage_9&#45;&gt;ring_attn_2_9_stage_10</title>
<path fill="none" stroke="black" d="M7757,-7720.87C7757,-7720.87 7757,-7614.25 7757,-7614.25"/>
<polygon fill="black" stroke="black" points="7760.5,-7614.25 7757,-7604.25 7753.5,-7614.25 7760.5,-7614.25"/>
</g>
<!-- ring_attn_2_10_stage_9 -->
<g id="node1041" class="node">
<title>ring_attn_2_10_stage_9</title>
<polygon fill="yellow" stroke="black" points="8344,-7857 8135,-7789 8344,-7721 8553,-7789 8344,-7857"/>
<text text-anchor="middle" x="8344" y="-7807.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-7792.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="8344" y="-7777.8" font-family="Times,serif" font-size="14.00">Q[10]×K[1]×V[1]</text>
<text text-anchor="middle" x="8344" y="-7762.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_9_stage_9&#45;&gt;ring_attn_2_10_stage_9 -->
<g id="edge2740" class="edge">
<title>ring_attn_2_9_stage_9&#45;&gt;ring_attn_2_10_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-7789C7966.02,-7789 8124.86,-7789 8124.86,-7789"/>
<polygon fill="red" stroke="red" points="8124.86,-7792.5 8134.86,-7789 8124.86,-7785.5 8124.86,-7792.5"/>
</g>
<!-- ring_attn_2_9_stage_10&#45;&gt;ring_attn_2_9_stage_11 -->
<g id="edge935" class="edge">
<title>ring_attn_2_9_stage_10&#45;&gt;ring_attn_2_9_stage_11</title>
<path fill="none" stroke="black" d="M7757,-7467.87C7757,-7467.87 7757,-7361.25 7757,-7361.25"/>
<polygon fill="black" stroke="black" points="7760.5,-7361.25 7757,-7351.25 7753.5,-7361.25 7760.5,-7361.25"/>
</g>
<!-- ring_attn_2_10_stage_10 -->
<g id="node1042" class="node">
<title>ring_attn_2_10_stage_10</title>
<polygon fill="yellow" stroke="black" points="8344,-7604 8135,-7536 8344,-7468 8553,-7536 8344,-7604"/>
<text text-anchor="middle" x="8344" y="-7554.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-7539.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="8344" y="-7524.8" font-family="Times,serif" font-size="14.00">Q[10]×K[0]×V[0]</text>
<text text-anchor="middle" x="8344" y="-7509.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_9_stage_10&#45;&gt;ring_attn_2_10_stage_10 -->
<g id="edge2741" class="edge">
<title>ring_attn_2_9_stage_10&#45;&gt;ring_attn_2_10_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-7536C7966.02,-7536 8124.86,-7536 8124.86,-7536"/>
<polygon fill="red" stroke="red" points="8124.86,-7539.5 8134.86,-7536 8124.86,-7532.5 8124.86,-7539.5"/>
</g>
<!-- ring_attn_2_9_stage_11&#45;&gt;ring_attn_2_9_stage_12 -->
<g id="edge936" class="edge">
<title>ring_attn_2_9_stage_11&#45;&gt;ring_attn_2_9_stage_12</title>
<path fill="none" stroke="black" d="M7757,-7214.87C7757,-7214.87 7757,-7108.25 7757,-7108.25"/>
<polygon fill="black" stroke="black" points="7760.5,-7108.25 7757,-7098.25 7753.5,-7108.25 7760.5,-7108.25"/>
</g>
<!-- ring_attn_2_10_stage_11 -->
<g id="node1043" class="node">
<title>ring_attn_2_10_stage_11</title>
<polygon fill="yellow" stroke="black" points="8344,-7351 8135,-7283 8344,-7215 8553,-7283 8344,-7351"/>
<text text-anchor="middle" x="8344" y="-7301.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-7286.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="8344" y="-7271.8" font-family="Times,serif" font-size="14.00">Q[10]×K[15]×V[15]</text>
<text text-anchor="middle" x="8344" y="-7256.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_9_stage_11&#45;&gt;ring_attn_2_10_stage_11 -->
<g id="edge2742" class="edge">
<title>ring_attn_2_9_stage_11&#45;&gt;ring_attn_2_10_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-7283C7966.02,-7283 8124.86,-7283 8124.86,-7283"/>
<polygon fill="red" stroke="red" points="8124.86,-7286.5 8134.86,-7283 8124.86,-7279.5 8124.86,-7286.5"/>
</g>
<!-- ring_attn_2_9_stage_12&#45;&gt;ring_attn_2_9_stage_13 -->
<g id="edge937" class="edge">
<title>ring_attn_2_9_stage_12&#45;&gt;ring_attn_2_9_stage_13</title>
<path fill="none" stroke="black" d="M7757,-6961.87C7757,-6961.87 7757,-6855.25 7757,-6855.25"/>
<polygon fill="black" stroke="black" points="7760.5,-6855.25 7757,-6845.25 7753.5,-6855.25 7760.5,-6855.25"/>
</g>
<!-- ring_attn_2_10_stage_12 -->
<g id="node1044" class="node">
<title>ring_attn_2_10_stage_12</title>
<polygon fill="yellow" stroke="black" points="8344,-7098 8135,-7030 8344,-6962 8553,-7030 8344,-7098"/>
<text text-anchor="middle" x="8344" y="-7048.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-7033.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="8344" y="-7018.8" font-family="Times,serif" font-size="14.00">Q[10]×K[14]×V[14]</text>
<text text-anchor="middle" x="8344" y="-7003.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_9_stage_12&#45;&gt;ring_attn_2_10_stage_12 -->
<g id="edge2743" class="edge">
<title>ring_attn_2_9_stage_12&#45;&gt;ring_attn_2_10_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-7030C7966.02,-7030 8124.86,-7030 8124.86,-7030"/>
<polygon fill="red" stroke="red" points="8124.86,-7033.5 8134.86,-7030 8124.86,-7026.5 8124.86,-7033.5"/>
</g>
<!-- ring_attn_2_9_stage_13&#45;&gt;ring_attn_2_9_stage_14 -->
<g id="edge938" class="edge">
<title>ring_attn_2_9_stage_13&#45;&gt;ring_attn_2_9_stage_14</title>
<path fill="none" stroke="black" d="M7757,-6708.87C7757,-6708.87 7757,-6602.25 7757,-6602.25"/>
<polygon fill="black" stroke="black" points="7760.5,-6602.25 7757,-6592.25 7753.5,-6602.25 7760.5,-6602.25"/>
</g>
<!-- ring_attn_2_10_stage_13 -->
<g id="node1045" class="node">
<title>ring_attn_2_10_stage_13</title>
<polygon fill="yellow" stroke="black" points="8344,-6845 8135,-6777 8344,-6709 8553,-6777 8344,-6845"/>
<text text-anchor="middle" x="8344" y="-6795.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-6780.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="8344" y="-6765.8" font-family="Times,serif" font-size="14.00">Q[10]×K[13]×V[13]</text>
<text text-anchor="middle" x="8344" y="-6750.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_9_stage_13&#45;&gt;ring_attn_2_10_stage_13 -->
<g id="edge2744" class="edge">
<title>ring_attn_2_9_stage_13&#45;&gt;ring_attn_2_10_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-6777C7966.02,-6777 8124.86,-6777 8124.86,-6777"/>
<polygon fill="red" stroke="red" points="8124.86,-6780.5 8134.86,-6777 8124.86,-6773.5 8124.86,-6780.5"/>
</g>
<!-- ring_attn_2_9_stage_14&#45;&gt;ring_attn_2_9_stage_15 -->
<g id="edge939" class="edge">
<title>ring_attn_2_9_stage_14&#45;&gt;ring_attn_2_9_stage_15</title>
<path fill="none" stroke="black" d="M7757,-6455.87C7757,-6455.87 7757,-6349.25 7757,-6349.25"/>
<polygon fill="black" stroke="black" points="7760.5,-6349.25 7757,-6339.25 7753.5,-6349.25 7760.5,-6349.25"/>
</g>
<!-- ring_attn_2_10_stage_14 -->
<g id="node1046" class="node">
<title>ring_attn_2_10_stage_14</title>
<polygon fill="yellow" stroke="black" points="8344,-6592 8135,-6524 8344,-6456 8553,-6524 8344,-6592"/>
<text text-anchor="middle" x="8344" y="-6542.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-6527.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="8344" y="-6512.8" font-family="Times,serif" font-size="14.00">Q[10]×K[12]×V[12]</text>
<text text-anchor="middle" x="8344" y="-6497.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_9_stage_14&#45;&gt;ring_attn_2_10_stage_14 -->
<g id="edge2745" class="edge">
<title>ring_attn_2_9_stage_14&#45;&gt;ring_attn_2_10_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-6524C7966.02,-6524 8124.86,-6524 8124.86,-6524"/>
<polygon fill="red" stroke="red" points="8124.86,-6527.5 8134.86,-6524 8124.86,-6520.5 8124.86,-6527.5"/>
</g>
<!-- attn_out_2_9 -->
<g id="node950" class="node">
<title>attn_out_2_9</title>
<polygon fill="none" stroke="black" points="7826.5,-6130 7687.5,-6130 7687.5,-6077 7826.5,-6077 7826.5,-6130"/>
<text text-anchor="middle" x="7757" y="-6114.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="7757" y="-6099.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="7757" y="-6084.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_2_9_stage_15&#45;&gt;attn_out_2_9 -->
<g id="edge940" class="edge">
<title>ring_attn_2_9_stage_15&#45;&gt;attn_out_2_9</title>
<path fill="none" stroke="black" d="M7757,-6202.87C7757,-6202.87 7757,-6140.18 7757,-6140.18"/>
<polygon fill="black" stroke="black" points="7760.5,-6140.18 7757,-6130.18 7753.5,-6140.18 7760.5,-6140.18"/>
</g>
<!-- ring_attn_2_10_stage_15 -->
<g id="node1047" class="node">
<title>ring_attn_2_10_stage_15</title>
<polygon fill="yellow" stroke="black" points="8344,-6339 8135,-6271 8344,-6203 8553,-6271 8344,-6339"/>
<text text-anchor="middle" x="8344" y="-6289.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-6274.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="8344" y="-6259.8" font-family="Times,serif" font-size="14.00">Q[10]×K[11]×V[11]</text>
<text text-anchor="middle" x="8344" y="-6244.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_9_stage_15&#45;&gt;ring_attn_2_10_stage_15 -->
<g id="edge2746" class="edge">
<title>ring_attn_2_9_stage_15&#45;&gt;ring_attn_2_10_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-6271C7966.02,-6271 8124.86,-6271 8124.86,-6271"/>
<polygon fill="red" stroke="red" points="8124.86,-6274.5 8134.86,-6271 8124.86,-6267.5 8124.86,-6274.5"/>
</g>
<!-- attn_residual_2_9 -->
<g id="node951" class="node">
<title>attn_residual_2_9</title>
<ellipse fill="none" stroke="black" cx="7757" cy="-5977" rx="105.5" ry="27"/>
<text text-anchor="middle" x="7757" y="-5980.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="7757" y="-5965.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_2_9&#45;&gt;attn_residual_2_9 -->
<g id="edge941" class="edge">
<title>attn_out_2_9&#45;&gt;attn_residual_2_9</title>
<path fill="none" stroke="black" d="M7757,-6076.98C7757,-6076.98 7757,-6014.36 7757,-6014.36"/>
<polygon fill="black" stroke="black" points="7760.5,-6014.36 7757,-6004.36 7753.5,-6014.36 7760.5,-6014.36"/>
</g>
<!-- gate_2_9 -->
<g id="node952" class="node">
<title>gate_2_9</title>
<ellipse fill="orange" stroke="black" cx="7757" cy="-5839.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="7757" y="-5850.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="7757" y="-5835.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="7757" y="-5820.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_2_9&#45;&gt;gate_2_9 -->
<g id="edge942" class="edge">
<title>attn_residual_2_9&#45;&gt;gate_2_9</title>
<path fill="none" stroke="black" d="M7809.75,-5953.36C7809.75,-5953.36 7809.75,-5882.08 7809.75,-5882.08"/>
<polygon fill="black" stroke="black" points="7813.25,-5882.08 7809.75,-5872.08 7806.25,-5882.08 7813.25,-5882.08"/>
</g>
<!-- gate_2_9&#45;&gt;expert_2_0_0 -->
<g id="edge2747" class="edge">
<title>gate_2_9&#45;&gt;expert_2_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7757,-5877.26C7757,-5903.21 7757,-5933 7757,-5933 7757,-5933 116.8,-5933 116.8,-5933 116.8,-5933 116.8,-5680.22 116.8,-5680.22"/>
<polygon fill="blue" stroke="blue" points="120.3,-5680.22 116.8,-5670.22 113.3,-5680.22 120.3,-5680.22"/>
<text text-anchor="middle" x="32486.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="32486.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU9→GPU0</text>
<text text-anchor="middle" x="32486.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="32486.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_9&#45;&gt;expert_2_1_0 -->
<g id="edge2748" class="edge">
<title>gate_2_9&#45;&gt;expert_2_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7704.25,-5872.2C7704.25,-5877.34 7704.25,-5881 7704.25,-5881 7704.25,-5881 3172.29,-5881 3172.29,-5881 3172.29,-5881 3172.29,-5680.28 3172.29,-5680.28"/>
<polygon fill="blue" stroke="blue" points="3175.79,-5680.28 3172.29,-5670.28 3168.79,-5680.28 3175.79,-5680.28"/>
<text text-anchor="middle" x="32660.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="32660.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU9→GPU1</text>
<text text-anchor="middle" x="32660.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="32660.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_9&#45;&gt;expert_2_2_0 -->
<g id="edge2749" class="edge">
<title>gate_2_9&#45;&gt;expert_2_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7670.68,-5817.78C7670.68,-5782.83 7670.68,-5718 7670.68,-5718 7670.68,-5718 3605.02,-5718 3605.02,-5718 3605.02,-5718 3605.02,-5680.4 3605.02,-5680.4"/>
<polygon fill="blue" stroke="blue" points="3608.52,-5680.4 3605.02,-5670.4 3601.52,-5680.4 3608.52,-5680.4"/>
<text text-anchor="middle" x="32834.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="32834.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU9→GPU2</text>
<text text-anchor="middle" x="32834.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="32834.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_9&#45;&gt;expert_2_3_0 -->
<g id="edge2750" class="edge">
<title>gate_2_9&#45;&gt;expert_2_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7689.86,-5810.5C7689.86,-5777.46 7689.86,-5728 7689.86,-5728 7689.86,-5728 4197.02,-5728 4197.02,-5728 4197.02,-5728 4197.02,-5680.24 4197.02,-5680.24"/>
<polygon fill="blue" stroke="blue" points="4200.52,-5680.24 4197.02,-5670.24 4193.52,-5680.24 4200.52,-5680.24"/>
<text text-anchor="middle" x="33008.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33008.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU9→GPU3</text>
<text text-anchor="middle" x="33008.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33008.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_9&#45;&gt;expert_2_4_0 -->
<g id="edge2751" class="edge">
<title>gate_2_9&#45;&gt;expert_2_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7709.05,-5805.9C7709.05,-5775.68 7709.05,-5736 7709.05,-5736 7709.05,-5736 4796.88,-5736 4796.88,-5736 4796.88,-5736 4796.88,-5680.25 4796.88,-5680.25"/>
<polygon fill="blue" stroke="blue" points="4800.38,-5680.25 4796.88,-5670.25 4793.38,-5680.25 4800.38,-5680.25"/>
<text text-anchor="middle" x="33182.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33182.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU9→GPU4</text>
<text text-anchor="middle" x="33182.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33182.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_9&#45;&gt;expert_2_5_0 -->
<g id="edge2752" class="edge">
<title>gate_2_9&#45;&gt;expert_2_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7728.23,-5803.12C7728.23,-5780.62 7728.23,-5756 7728.23,-5756 7728.23,-5756 5393.93,-5756 5393.93,-5756 5393.93,-5756 5393.93,-5680.16 5393.93,-5680.16"/>
<polygon fill="blue" stroke="blue" points="5397.43,-5680.16 5393.93,-5670.16 5390.43,-5680.16 5397.43,-5680.16"/>
<text text-anchor="middle" x="33356.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33356.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU9→GPU5</text>
<text text-anchor="middle" x="33356.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33356.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_9&#45;&gt;expert_2_6_0 -->
<g id="edge2753" class="edge">
<title>gate_2_9&#45;&gt;expert_2_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7747.41,-5802.15C7747.41,-5782.73 7747.41,-5763 7747.41,-5763 7747.41,-5763 5974.9,-5763 5974.9,-5763 5974.9,-5763 5974.9,-5680.02 5974.9,-5680.02"/>
<polygon fill="blue" stroke="blue" points="5978.4,-5680.02 5974.9,-5670.02 5971.4,-5680.02 5978.4,-5680.02"/>
<text text-anchor="middle" x="33530.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33530.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU9→GPU6</text>
<text text-anchor="middle" x="33530.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33530.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_9&#45;&gt;expert_2_7_0 -->
<g id="edge2754" class="edge">
<title>gate_2_9&#45;&gt;expert_2_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7757,-5801.97C7757,-5796.68 7757,-5793 7757,-5793 7757,-5793 6698.62,-5793 6698.62,-5793 6698.62,-5793 6698.62,-5680.23 6698.62,-5680.23"/>
<polygon fill="blue" stroke="blue" points="6702.13,-5680.23 6698.62,-5670.23 6695.13,-5680.23 6702.13,-5680.23"/>
<text text-anchor="middle" x="33704.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33704.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU9→GPU7</text>
<text text-anchor="middle" x="33704.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33704.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_9&#45;&gt;expert_2_8_0 -->
<g id="edge2755" class="edge">
<title>gate_2_9&#45;&gt;expert_2_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7657.3,-5852C7517.46,-5852 7280,-5852 7280,-5852 7280,-5852 7280,-5680.33 7280,-5680.33"/>
<polygon fill="blue" stroke="blue" points="7283.5,-5680.33 7280,-5670.33 7276.5,-5680.33 7283.5,-5680.33"/>
<text text-anchor="middle" x="33878.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33878.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU9→GPU8</text>
<text text-anchor="middle" x="33878.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33878.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_9&#45;&gt;expert_2_9_0 -->
<g id="edge943" class="edge">
<title>gate_2_9&#45;&gt;expert_2_9_0</title>
<path fill="none" stroke="black" d="M7766.59,-5801.71C7766.59,-5801.71 7766.59,-5680.18 7766.59,-5680.18"/>
<polygon fill="black" stroke="black" points="7770.09,-5680.18 7766.59,-5670.18 7763.09,-5680.18 7770.09,-5680.18"/>
</g>
<!-- gate_2_9&#45;&gt;expert_2_10_0 -->
<g id="edge2756" class="edge">
<title>gate_2_9&#45;&gt;expert_2_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7856.52,-5827C7996.09,-5827 8233.1,-5827 8233.1,-5827 8233.1,-5827 8233.1,-5680.18 8233.1,-5680.18"/>
<polygon fill="blue" stroke="blue" points="8236.6,-5680.18 8233.1,-5670.18 8229.6,-5680.18 8236.6,-5680.18"/>
<text text-anchor="middle" x="34052.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34052.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU9→GPU10</text>
<text text-anchor="middle" x="34052.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34052.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_9&#45;&gt;expert_2_11_0 -->
<g id="edge2757" class="edge">
<title>gate_2_9&#45;&gt;expert_2_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7814.55,-5807.8C7814.55,-5795.81 7814.55,-5785 7814.55,-5785 7814.55,-5785 8818.75,-5785 8818.75,-5785 8818.75,-5785 8818.75,-5680.12 8818.75,-5680.12"/>
<polygon fill="blue" stroke="blue" points="8822.25,-5680.12 8818.75,-5670.12 8815.25,-5680.12 8822.25,-5680.12"/>
<text text-anchor="middle" x="34226.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34226.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU9→GPU11</text>
<text text-anchor="middle" x="34226.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34226.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_9&#45;&gt;expert_2_12_0 -->
<g id="edge2758" class="edge">
<title>gate_2_9&#45;&gt;expert_2_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7824.14,-5810.52C7824.14,-5784.71 7824.14,-5751 7824.14,-5751 7824.14,-5751 9402.38,-5751 9402.38,-5751 9402.38,-5751 9402.38,-5680.07 9402.38,-5680.07"/>
<polygon fill="blue" stroke="blue" points="9405.88,-5680.07 9402.38,-5670.07 9398.88,-5680.07 9405.88,-5680.07"/>
<text text-anchor="middle" x="34400.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34400.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU9→GPU12</text>
<text text-anchor="middle" x="34400.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34400.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_9&#45;&gt;expert_2_13_0 -->
<g id="edge2759" class="edge">
<title>gate_2_9&#45;&gt;expert_2_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7833.73,-5813.64C7833.73,-5785.06 7833.73,-5743 7833.73,-5743 7833.73,-5743 10168.3,-5743 10168.3,-5743 10168.3,-5743 10168.3,-5680.16 10168.3,-5680.16"/>
<polygon fill="blue" stroke="blue" points="10171.8,-5680.16 10168.3,-5670.16 10164.8,-5680.16 10171.8,-5680.16"/>
<text text-anchor="middle" x="34574.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34574.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU9→GPU13</text>
<text text-anchor="middle" x="34574.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34574.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_9&#45;&gt;expert_2_14_0 -->
<g id="edge2760" class="edge">
<title>gate_2_9&#45;&gt;expert_2_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7843.32,-5817.76C7843.32,-5787.67 7843.32,-5737 7843.32,-5737 7843.32,-5737 10737.21,-5737 10737.21,-5737 10737.21,-5737 10737.21,-5680.04 10737.21,-5680.04"/>
<polygon fill="blue" stroke="blue" points="10740.71,-5680.04 10737.21,-5670.04 10733.71,-5680.04 10740.71,-5680.04"/>
<text text-anchor="middle" x="34748.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34748.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU9→GPU14</text>
<text text-anchor="middle" x="34748.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34748.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_9&#45;&gt;expert_2_15_0 -->
<g id="edge2761" class="edge">
<title>gate_2_9&#45;&gt;expert_2_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7852.91,-5823.49C7852.91,-5793.31 7852.91,-5731 7852.91,-5731 7852.91,-5731 11306.76,-5731 11306.76,-5731 11306.76,-5731 11306.76,-5680.23 11306.76,-5680.23"/>
<polygon fill="blue" stroke="blue" points="11310.26,-5680.23 11306.76,-5670.23 11303.26,-5680.23 11310.26,-5680.23"/>
<text text-anchor="middle" x="34922.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34922.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU9→GPU15</text>
<text text-anchor="middle" x="34922.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34922.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_9 -->
<g id="node954" class="node">
<title>expert_reduce_2_9</title>
<ellipse fill="none" stroke="black" cx="7757" cy="-5506.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="7757" y="-5517.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="7757" y="-5502.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="7757" y="-5487.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_9_0&#45;&gt;expert_reduce_2_9 -->
<g id="edge944" class="edge">
<title>expert_2_9_0&#45;&gt;expert_reduce_2_9</title>
<path fill="none" stroke="black" d="M7757,-5616.76C7757,-5616.76 7757,-5554.06 7757,-5554.06"/>
<polygon fill="black" stroke="black" points="7760.5,-5554.06 7757,-5544.06 7753.5,-5554.06 7760.5,-5554.06"/>
</g>
<!-- moe_residual_2_9 -->
<g id="node955" class="node">
<title>moe_residual_2_9</title>
<ellipse fill="none" stroke="black" cx="7757" cy="-5369" rx="105.5" ry="27"/>
<text text-anchor="middle" x="7757" y="-5372.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="7757" y="-5357.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_9&#45;&gt;moe_residual_2_9 -->
<g id="edge945" class="edge">
<title>expert_reduce_2_9&#45;&gt;moe_residual_2_9</title>
<path fill="none" stroke="black" d="M7757,-5468.93C7757,-5468.93 7757,-5406.06 7757,-5406.06"/>
<polygon fill="black" stroke="black" points="7760.5,-5406.06 7757,-5396.06 7753.5,-5406.06 7760.5,-5406.06"/>
</g>
<!-- qkv_proj_3_9 -->
<g id="node956" class="node">
<title>qkv_proj_3_9</title>
<polygon fill="none" stroke="black" points="7839.5,-5269 7674.5,-5269 7674.5,-5216 7839.5,-5216 7839.5,-5269"/>
<text text-anchor="middle" x="7757" y="-5253.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="7757" y="-5238.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="7757" y="-5223.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_2_9&#45;&gt;qkv_proj_3_9 -->
<g id="edge946" class="edge">
<title>moe_residual_2_9&#45;&gt;qkv_proj_3_9</title>
<path fill="none" stroke="black" d="M7757,-5341.86C7757,-5341.86 7757,-5279.16 7757,-5279.16"/>
<polygon fill="black" stroke="black" points="7760.5,-5279.16 7757,-5269.16 7753.5,-5279.16 7760.5,-5279.16"/>
</g>
<!-- qkv_reshape_3_9 -->
<g id="node957" class="node">
<title>qkv_reshape_3_9</title>
<ellipse fill="none" stroke="black" cx="7757" cy="-5116" rx="148" ry="27"/>
<text text-anchor="middle" x="7757" y="-5119.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="7757" y="-5104.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_3_9&#45;&gt;qkv_reshape_3_9 -->
<g id="edge947" class="edge">
<title>qkv_proj_3_9&#45;&gt;qkv_reshape_3_9</title>
<path fill="none" stroke="black" d="M7757,-5215.98C7757,-5215.98 7757,-5153.36 7757,-5153.36"/>
<polygon fill="black" stroke="black" points="7760.5,-5153.36 7757,-5143.36 7753.5,-5153.36 7760.5,-5153.36"/>
</g>
<!-- qkv_reshape_3_9&#45;&gt;ring_attn_3_9_stage_0 -->
<g id="edge948" class="edge">
<title>qkv_reshape_3_9&#45;&gt;ring_attn_3_9_stage_0</title>
<path fill="none" stroke="black" d="M7757,-5088.72C7757,-5088.72 7757,-4982.16 7757,-4982.16"/>
<polygon fill="black" stroke="black" points="7760.5,-4982.16 7757,-4972.16 7753.5,-4982.16 7760.5,-4982.16"/>
</g>
<!-- ring_attn_3_9_stage_0&#45;&gt;ring_attn_3_9_stage_1 -->
<g id="edge949" class="edge">
<title>ring_attn_3_9_stage_0&#45;&gt;ring_attn_3_9_stage_1</title>
<path fill="none" stroke="black" d="M7757,-4835.87C7757,-4835.87 7757,-4729.25 7757,-4729.25"/>
<polygon fill="black" stroke="black" points="7760.5,-4729.25 7757,-4719.25 7753.5,-4729.25 7760.5,-4729.25"/>
</g>
<!-- ring_attn_3_10_stage_0 -->
<g id="node1056" class="node">
<title>ring_attn_3_10_stage_0</title>
<polygon fill="yellow" stroke="black" points="8344,-4972 8135,-4904 8344,-4836 8553,-4904 8344,-4972"/>
<text text-anchor="middle" x="8344" y="-4922.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-4907.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="8344" y="-4892.8" font-family="Times,serif" font-size="14.00">Q[10]×K[10]×V[10]</text>
<text text-anchor="middle" x="8344" y="-4877.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_9_stage_0&#45;&gt;ring_attn_3_10_stage_0 -->
<g id="edge2762" class="edge">
<title>ring_attn_3_9_stage_0&#45;&gt;ring_attn_3_10_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-4904C7966.02,-4904 8124.86,-4904 8124.86,-4904"/>
<polygon fill="red" stroke="red" points="8124.86,-4907.5 8134.86,-4904 8124.86,-4900.5 8124.86,-4907.5"/>
</g>
<!-- ring_attn_3_9_stage_1&#45;&gt;ring_attn_3_9_stage_2 -->
<g id="edge950" class="edge">
<title>ring_attn_3_9_stage_1&#45;&gt;ring_attn_3_9_stage_2</title>
<path fill="none" stroke="black" d="M7757,-4582.87C7757,-4582.87 7757,-4476.25 7757,-4476.25"/>
<polygon fill="black" stroke="black" points="7760.5,-4476.25 7757,-4466.25 7753.5,-4476.25 7760.5,-4476.25"/>
</g>
<!-- ring_attn_3_10_stage_1 -->
<g id="node1057" class="node">
<title>ring_attn_3_10_stage_1</title>
<polygon fill="yellow" stroke="black" points="8344,-4719 8135,-4651 8344,-4583 8553,-4651 8344,-4719"/>
<text text-anchor="middle" x="8344" y="-4669.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-4654.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="8344" y="-4639.8" font-family="Times,serif" font-size="14.00">Q[10]×K[9]×V[9]</text>
<text text-anchor="middle" x="8344" y="-4624.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_9_stage_1&#45;&gt;ring_attn_3_10_stage_1 -->
<g id="edge2763" class="edge">
<title>ring_attn_3_9_stage_1&#45;&gt;ring_attn_3_10_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-4651C7966.02,-4651 8124.86,-4651 8124.86,-4651"/>
<polygon fill="red" stroke="red" points="8124.86,-4654.5 8134.86,-4651 8124.86,-4647.5 8124.86,-4654.5"/>
</g>
<!-- ring_attn_3_9_stage_2&#45;&gt;ring_attn_3_9_stage_3 -->
<g id="edge951" class="edge">
<title>ring_attn_3_9_stage_2&#45;&gt;ring_attn_3_9_stage_3</title>
<path fill="none" stroke="black" d="M7757,-4329.87C7757,-4329.87 7757,-4223.25 7757,-4223.25"/>
<polygon fill="black" stroke="black" points="7760.5,-4223.25 7757,-4213.25 7753.5,-4223.25 7760.5,-4223.25"/>
</g>
<!-- ring_attn_3_10_stage_2 -->
<g id="node1058" class="node">
<title>ring_attn_3_10_stage_2</title>
<polygon fill="yellow" stroke="black" points="8344,-4466 8135,-4398 8344,-4330 8553,-4398 8344,-4466"/>
<text text-anchor="middle" x="8344" y="-4416.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-4401.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="8344" y="-4386.8" font-family="Times,serif" font-size="14.00">Q[10]×K[8]×V[8]</text>
<text text-anchor="middle" x="8344" y="-4371.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_9_stage_2&#45;&gt;ring_attn_3_10_stage_2 -->
<g id="edge2764" class="edge">
<title>ring_attn_3_9_stage_2&#45;&gt;ring_attn_3_10_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-4398C7966.02,-4398 8124.86,-4398 8124.86,-4398"/>
<polygon fill="red" stroke="red" points="8124.86,-4401.5 8134.86,-4398 8124.86,-4394.5 8124.86,-4401.5"/>
</g>
<!-- ring_attn_3_9_stage_3&#45;&gt;ring_attn_3_9_stage_4 -->
<g id="edge952" class="edge">
<title>ring_attn_3_9_stage_3&#45;&gt;ring_attn_3_9_stage_4</title>
<path fill="none" stroke="black" d="M7757,-4076.87C7757,-4076.87 7757,-3970.25 7757,-3970.25"/>
<polygon fill="black" stroke="black" points="7760.5,-3970.25 7757,-3960.25 7753.5,-3970.25 7760.5,-3970.25"/>
</g>
<!-- ring_attn_3_10_stage_3 -->
<g id="node1059" class="node">
<title>ring_attn_3_10_stage_3</title>
<polygon fill="yellow" stroke="black" points="8344,-4213 8135,-4145 8344,-4077 8553,-4145 8344,-4213"/>
<text text-anchor="middle" x="8344" y="-4163.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-4148.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="8344" y="-4133.8" font-family="Times,serif" font-size="14.00">Q[10]×K[7]×V[7]</text>
<text text-anchor="middle" x="8344" y="-4118.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_9_stage_3&#45;&gt;ring_attn_3_10_stage_3 -->
<g id="edge2765" class="edge">
<title>ring_attn_3_9_stage_3&#45;&gt;ring_attn_3_10_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-4145C7966.02,-4145 8124.86,-4145 8124.86,-4145"/>
<polygon fill="red" stroke="red" points="8124.86,-4148.5 8134.86,-4145 8124.86,-4141.5 8124.86,-4148.5"/>
</g>
<!-- ring_attn_3_9_stage_4&#45;&gt;ring_attn_3_9_stage_5 -->
<g id="edge953" class="edge">
<title>ring_attn_3_9_stage_4&#45;&gt;ring_attn_3_9_stage_5</title>
<path fill="none" stroke="black" d="M7757,-3823.87C7757,-3823.87 7757,-3717.25 7757,-3717.25"/>
<polygon fill="black" stroke="black" points="7760.5,-3717.25 7757,-3707.25 7753.5,-3717.25 7760.5,-3717.25"/>
</g>
<!-- ring_attn_3_10_stage_4 -->
<g id="node1060" class="node">
<title>ring_attn_3_10_stage_4</title>
<polygon fill="yellow" stroke="black" points="8344,-3960 8135,-3892 8344,-3824 8553,-3892 8344,-3960"/>
<text text-anchor="middle" x="8344" y="-3910.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-3895.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="8344" y="-3880.8" font-family="Times,serif" font-size="14.00">Q[10]×K[6]×V[6]</text>
<text text-anchor="middle" x="8344" y="-3865.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_9_stage_4&#45;&gt;ring_attn_3_10_stage_4 -->
<g id="edge2766" class="edge">
<title>ring_attn_3_9_stage_4&#45;&gt;ring_attn_3_10_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-3892C7966.02,-3892 8124.86,-3892 8124.86,-3892"/>
<polygon fill="red" stroke="red" points="8124.86,-3895.5 8134.86,-3892 8124.86,-3888.5 8124.86,-3895.5"/>
</g>
<!-- ring_attn_3_9_stage_5&#45;&gt;ring_attn_3_9_stage_6 -->
<g id="edge954" class="edge">
<title>ring_attn_3_9_stage_5&#45;&gt;ring_attn_3_9_stage_6</title>
<path fill="none" stroke="black" d="M7757,-3570.87C7757,-3570.87 7757,-3464.25 7757,-3464.25"/>
<polygon fill="black" stroke="black" points="7760.5,-3464.25 7757,-3454.25 7753.5,-3464.25 7760.5,-3464.25"/>
</g>
<!-- ring_attn_3_10_stage_5 -->
<g id="node1061" class="node">
<title>ring_attn_3_10_stage_5</title>
<polygon fill="yellow" stroke="black" points="8344,-3707 8135,-3639 8344,-3571 8553,-3639 8344,-3707"/>
<text text-anchor="middle" x="8344" y="-3657.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-3642.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="8344" y="-3627.8" font-family="Times,serif" font-size="14.00">Q[10]×K[5]×V[5]</text>
<text text-anchor="middle" x="8344" y="-3612.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_9_stage_5&#45;&gt;ring_attn_3_10_stage_5 -->
<g id="edge2767" class="edge">
<title>ring_attn_3_9_stage_5&#45;&gt;ring_attn_3_10_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-3639C7966.02,-3639 8124.86,-3639 8124.86,-3639"/>
<polygon fill="red" stroke="red" points="8124.86,-3642.5 8134.86,-3639 8124.86,-3635.5 8124.86,-3642.5"/>
</g>
<!-- ring_attn_3_9_stage_6&#45;&gt;ring_attn_3_9_stage_7 -->
<g id="edge955" class="edge">
<title>ring_attn_3_9_stage_6&#45;&gt;ring_attn_3_9_stage_7</title>
<path fill="none" stroke="black" d="M7757,-3317.87C7757,-3317.87 7757,-3211.25 7757,-3211.25"/>
<polygon fill="black" stroke="black" points="7760.5,-3211.25 7757,-3201.25 7753.5,-3211.25 7760.5,-3211.25"/>
</g>
<!-- ring_attn_3_10_stage_6 -->
<g id="node1062" class="node">
<title>ring_attn_3_10_stage_6</title>
<polygon fill="yellow" stroke="black" points="8344,-3454 8135,-3386 8344,-3318 8553,-3386 8344,-3454"/>
<text text-anchor="middle" x="8344" y="-3404.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-3389.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="8344" y="-3374.8" font-family="Times,serif" font-size="14.00">Q[10]×K[4]×V[4]</text>
<text text-anchor="middle" x="8344" y="-3359.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_9_stage_6&#45;&gt;ring_attn_3_10_stage_6 -->
<g id="edge2768" class="edge">
<title>ring_attn_3_9_stage_6&#45;&gt;ring_attn_3_10_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-3386C7966.02,-3386 8124.86,-3386 8124.86,-3386"/>
<polygon fill="red" stroke="red" points="8124.86,-3389.5 8134.86,-3386 8124.86,-3382.5 8124.86,-3389.5"/>
</g>
<!-- ring_attn_3_9_stage_7&#45;&gt;ring_attn_3_9_stage_8 -->
<g id="edge956" class="edge">
<title>ring_attn_3_9_stage_7&#45;&gt;ring_attn_3_9_stage_8</title>
<path fill="none" stroke="black" d="M7757,-3064.87C7757,-3064.87 7757,-2958.25 7757,-2958.25"/>
<polygon fill="black" stroke="black" points="7760.5,-2958.25 7757,-2948.25 7753.5,-2958.25 7760.5,-2958.25"/>
</g>
<!-- ring_attn_3_10_stage_7 -->
<g id="node1063" class="node">
<title>ring_attn_3_10_stage_7</title>
<polygon fill="yellow" stroke="black" points="8344,-3201 8135,-3133 8344,-3065 8553,-3133 8344,-3201"/>
<text text-anchor="middle" x="8344" y="-3151.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-3136.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="8344" y="-3121.8" font-family="Times,serif" font-size="14.00">Q[10]×K[3]×V[3]</text>
<text text-anchor="middle" x="8344" y="-3106.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_9_stage_7&#45;&gt;ring_attn_3_10_stage_7 -->
<g id="edge2769" class="edge">
<title>ring_attn_3_9_stage_7&#45;&gt;ring_attn_3_10_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-3133C7966.02,-3133 8124.86,-3133 8124.86,-3133"/>
<polygon fill="red" stroke="red" points="8124.86,-3136.5 8134.86,-3133 8124.86,-3129.5 8124.86,-3136.5"/>
</g>
<!-- ring_attn_3_9_stage_8&#45;&gt;ring_attn_3_9_stage_9 -->
<g id="edge957" class="edge">
<title>ring_attn_3_9_stage_8&#45;&gt;ring_attn_3_9_stage_9</title>
<path fill="none" stroke="black" d="M7757,-2811.87C7757,-2811.87 7757,-2705.25 7757,-2705.25"/>
<polygon fill="black" stroke="black" points="7760.5,-2705.25 7757,-2695.25 7753.5,-2705.25 7760.5,-2705.25"/>
</g>
<!-- ring_attn_3_10_stage_8 -->
<g id="node1064" class="node">
<title>ring_attn_3_10_stage_8</title>
<polygon fill="yellow" stroke="black" points="8344,-2948 8135,-2880 8344,-2812 8553,-2880 8344,-2948"/>
<text text-anchor="middle" x="8344" y="-2898.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-2883.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="8344" y="-2868.8" font-family="Times,serif" font-size="14.00">Q[10]×K[2]×V[2]</text>
<text text-anchor="middle" x="8344" y="-2853.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_9_stage_8&#45;&gt;ring_attn_3_10_stage_8 -->
<g id="edge2770" class="edge">
<title>ring_attn_3_9_stage_8&#45;&gt;ring_attn_3_10_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-2880C7966.02,-2880 8124.86,-2880 8124.86,-2880"/>
<polygon fill="red" stroke="red" points="8124.86,-2883.5 8134.86,-2880 8124.86,-2876.5 8124.86,-2883.5"/>
</g>
<!-- ring_attn_3_9_stage_9&#45;&gt;ring_attn_3_9_stage_10 -->
<g id="edge958" class="edge">
<title>ring_attn_3_9_stage_9&#45;&gt;ring_attn_3_9_stage_10</title>
<path fill="none" stroke="black" d="M7757,-2558.87C7757,-2558.87 7757,-2452.25 7757,-2452.25"/>
<polygon fill="black" stroke="black" points="7760.5,-2452.25 7757,-2442.25 7753.5,-2452.25 7760.5,-2452.25"/>
</g>
<!-- ring_attn_3_10_stage_9 -->
<g id="node1065" class="node">
<title>ring_attn_3_10_stage_9</title>
<polygon fill="yellow" stroke="black" points="8344,-2695 8135,-2627 8344,-2559 8553,-2627 8344,-2695"/>
<text text-anchor="middle" x="8344" y="-2645.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-2630.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="8344" y="-2615.8" font-family="Times,serif" font-size="14.00">Q[10]×K[1]×V[1]</text>
<text text-anchor="middle" x="8344" y="-2600.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_9_stage_9&#45;&gt;ring_attn_3_10_stage_9 -->
<g id="edge2771" class="edge">
<title>ring_attn_3_9_stage_9&#45;&gt;ring_attn_3_10_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-2627C7966.02,-2627 8124.86,-2627 8124.86,-2627"/>
<polygon fill="red" stroke="red" points="8124.86,-2630.5 8134.86,-2627 8124.86,-2623.5 8124.86,-2630.5"/>
</g>
<!-- ring_attn_3_9_stage_10&#45;&gt;ring_attn_3_9_stage_11 -->
<g id="edge959" class="edge">
<title>ring_attn_3_9_stage_10&#45;&gt;ring_attn_3_9_stage_11</title>
<path fill="none" stroke="black" d="M7757,-2305.87C7757,-2305.87 7757,-2199.25 7757,-2199.25"/>
<polygon fill="black" stroke="black" points="7760.5,-2199.25 7757,-2189.25 7753.5,-2199.25 7760.5,-2199.25"/>
</g>
<!-- ring_attn_3_10_stage_10 -->
<g id="node1066" class="node">
<title>ring_attn_3_10_stage_10</title>
<polygon fill="yellow" stroke="black" points="8344,-2442 8135,-2374 8344,-2306 8553,-2374 8344,-2442"/>
<text text-anchor="middle" x="8344" y="-2392.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-2377.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="8344" y="-2362.8" font-family="Times,serif" font-size="14.00">Q[10]×K[0]×V[0]</text>
<text text-anchor="middle" x="8344" y="-2347.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_9_stage_10&#45;&gt;ring_attn_3_10_stage_10 -->
<g id="edge2772" class="edge">
<title>ring_attn_3_9_stage_10&#45;&gt;ring_attn_3_10_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-2374C7966.02,-2374 8124.86,-2374 8124.86,-2374"/>
<polygon fill="red" stroke="red" points="8124.86,-2377.5 8134.86,-2374 8124.86,-2370.5 8124.86,-2377.5"/>
</g>
<!-- ring_attn_3_9_stage_11&#45;&gt;ring_attn_3_9_stage_12 -->
<g id="edge960" class="edge">
<title>ring_attn_3_9_stage_11&#45;&gt;ring_attn_3_9_stage_12</title>
<path fill="none" stroke="black" d="M7757,-2052.87C7757,-2052.87 7757,-1946.25 7757,-1946.25"/>
<polygon fill="black" stroke="black" points="7760.5,-1946.25 7757,-1936.25 7753.5,-1946.25 7760.5,-1946.25"/>
</g>
<!-- ring_attn_3_10_stage_11 -->
<g id="node1067" class="node">
<title>ring_attn_3_10_stage_11</title>
<polygon fill="yellow" stroke="black" points="8344,-2189 8135,-2121 8344,-2053 8553,-2121 8344,-2189"/>
<text text-anchor="middle" x="8344" y="-2139.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-2124.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="8344" y="-2109.8" font-family="Times,serif" font-size="14.00">Q[10]×K[15]×V[15]</text>
<text text-anchor="middle" x="8344" y="-2094.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_9_stage_11&#45;&gt;ring_attn_3_10_stage_11 -->
<g id="edge2773" class="edge">
<title>ring_attn_3_9_stage_11&#45;&gt;ring_attn_3_10_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-2121C7966.02,-2121 8124.86,-2121 8124.86,-2121"/>
<polygon fill="red" stroke="red" points="8124.86,-2124.5 8134.86,-2121 8124.86,-2117.5 8124.86,-2124.5"/>
</g>
<!-- ring_attn_3_9_stage_12&#45;&gt;ring_attn_3_9_stage_13 -->
<g id="edge961" class="edge">
<title>ring_attn_3_9_stage_12&#45;&gt;ring_attn_3_9_stage_13</title>
<path fill="none" stroke="black" d="M7757,-1799.87C7757,-1799.87 7757,-1693.25 7757,-1693.25"/>
<polygon fill="black" stroke="black" points="7760.5,-1693.25 7757,-1683.25 7753.5,-1693.25 7760.5,-1693.25"/>
</g>
<!-- ring_attn_3_10_stage_12 -->
<g id="node1068" class="node">
<title>ring_attn_3_10_stage_12</title>
<polygon fill="yellow" stroke="black" points="8344,-1936 8135,-1868 8344,-1800 8553,-1868 8344,-1936"/>
<text text-anchor="middle" x="8344" y="-1886.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-1871.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="8344" y="-1856.8" font-family="Times,serif" font-size="14.00">Q[10]×K[14]×V[14]</text>
<text text-anchor="middle" x="8344" y="-1841.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_9_stage_12&#45;&gt;ring_attn_3_10_stage_12 -->
<g id="edge2774" class="edge">
<title>ring_attn_3_9_stage_12&#45;&gt;ring_attn_3_10_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-1868C7966.02,-1868 8124.86,-1868 8124.86,-1868"/>
<polygon fill="red" stroke="red" points="8124.86,-1871.5 8134.86,-1868 8124.86,-1864.5 8124.86,-1871.5"/>
</g>
<!-- ring_attn_3_9_stage_13&#45;&gt;ring_attn_3_9_stage_14 -->
<g id="edge962" class="edge">
<title>ring_attn_3_9_stage_13&#45;&gt;ring_attn_3_9_stage_14</title>
<path fill="none" stroke="black" d="M7757,-1546.87C7757,-1546.87 7757,-1440.25 7757,-1440.25"/>
<polygon fill="black" stroke="black" points="7760.5,-1440.25 7757,-1430.25 7753.5,-1440.25 7760.5,-1440.25"/>
</g>
<!-- ring_attn_3_10_stage_13 -->
<g id="node1069" class="node">
<title>ring_attn_3_10_stage_13</title>
<polygon fill="yellow" stroke="black" points="8344,-1683 8135,-1615 8344,-1547 8553,-1615 8344,-1683"/>
<text text-anchor="middle" x="8344" y="-1633.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-1618.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="8344" y="-1603.8" font-family="Times,serif" font-size="14.00">Q[10]×K[13]×V[13]</text>
<text text-anchor="middle" x="8344" y="-1588.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_9_stage_13&#45;&gt;ring_attn_3_10_stage_13 -->
<g id="edge2775" class="edge">
<title>ring_attn_3_9_stage_13&#45;&gt;ring_attn_3_10_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-1615C7966.02,-1615 8124.86,-1615 8124.86,-1615"/>
<polygon fill="red" stroke="red" points="8124.86,-1618.5 8134.86,-1615 8124.86,-1611.5 8124.86,-1618.5"/>
</g>
<!-- ring_attn_3_9_stage_14&#45;&gt;ring_attn_3_9_stage_15 -->
<g id="edge963" class="edge">
<title>ring_attn_3_9_stage_14&#45;&gt;ring_attn_3_9_stage_15</title>
<path fill="none" stroke="black" d="M7757,-1293.87C7757,-1293.87 7757,-1187.25 7757,-1187.25"/>
<polygon fill="black" stroke="black" points="7760.5,-1187.25 7757,-1177.25 7753.5,-1187.25 7760.5,-1187.25"/>
</g>
<!-- ring_attn_3_10_stage_14 -->
<g id="node1070" class="node">
<title>ring_attn_3_10_stage_14</title>
<polygon fill="yellow" stroke="black" points="8344,-1430 8135,-1362 8344,-1294 8553,-1362 8344,-1430"/>
<text text-anchor="middle" x="8344" y="-1380.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-1365.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="8344" y="-1350.8" font-family="Times,serif" font-size="14.00">Q[10]×K[12]×V[12]</text>
<text text-anchor="middle" x="8344" y="-1335.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_9_stage_14&#45;&gt;ring_attn_3_10_stage_14 -->
<g id="edge2776" class="edge">
<title>ring_attn_3_9_stage_14&#45;&gt;ring_attn_3_10_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-1362C7966.02,-1362 8124.86,-1362 8124.86,-1362"/>
<polygon fill="red" stroke="red" points="8124.86,-1365.5 8134.86,-1362 8124.86,-1358.5 8124.86,-1365.5"/>
</g>
<!-- attn_out_3_9 -->
<g id="node974" class="node">
<title>attn_out_3_9</title>
<polygon fill="none" stroke="black" points="7826.5,-968 7687.5,-968 7687.5,-915 7826.5,-915 7826.5,-968"/>
<text text-anchor="middle" x="7757" y="-952.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="7757" y="-937.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="7757" y="-922.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_3_9_stage_15&#45;&gt;attn_out_3_9 -->
<g id="edge964" class="edge">
<title>ring_attn_3_9_stage_15&#45;&gt;attn_out_3_9</title>
<path fill="none" stroke="black" d="M7757,-1040.87C7757,-1040.87 7757,-978.18 7757,-978.18"/>
<polygon fill="black" stroke="black" points="7760.5,-978.18 7757,-968.18 7753.5,-978.18 7760.5,-978.18"/>
</g>
<!-- ring_attn_3_10_stage_15 -->
<g id="node1071" class="node">
<title>ring_attn_3_10_stage_15</title>
<polygon fill="yellow" stroke="black" points="8344,-1177 8135,-1109 8344,-1041 8553,-1109 8344,-1177"/>
<text text-anchor="middle" x="8344" y="-1127.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8344" y="-1112.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="8344" y="-1097.8" font-family="Times,serif" font-size="14.00">Q[10]×K[11]×V[11]</text>
<text text-anchor="middle" x="8344" y="-1082.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_9_stage_15&#45;&gt;ring_attn_3_10_stage_15 -->
<g id="edge2777" class="edge">
<title>ring_attn_3_9_stage_15&#45;&gt;ring_attn_3_10_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7966.02,-1109C7966.02,-1109 8124.86,-1109 8124.86,-1109"/>
<polygon fill="red" stroke="red" points="8124.86,-1112.5 8134.86,-1109 8124.86,-1105.5 8124.86,-1112.5"/>
</g>
<!-- attn_residual_3_9 -->
<g id="node975" class="node">
<title>attn_residual_3_9</title>
<ellipse fill="none" stroke="black" cx="7757" cy="-815" rx="105.5" ry="27"/>
<text text-anchor="middle" x="7757" y="-818.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="7757" y="-803.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_3_9&#45;&gt;attn_residual_3_9 -->
<g id="edge965" class="edge">
<title>attn_out_3_9&#45;&gt;attn_residual_3_9</title>
<path fill="none" stroke="black" d="M7757,-914.98C7757,-914.98 7757,-852.36 7757,-852.36"/>
<polygon fill="black" stroke="black" points="7760.5,-852.36 7757,-842.36 7753.5,-852.36 7760.5,-852.36"/>
</g>
<!-- gate_3_9 -->
<g id="node976" class="node">
<title>gate_3_9</title>
<ellipse fill="orange" stroke="black" cx="7757" cy="-677.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="7757" y="-688.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="7757" y="-673.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="7757" y="-658.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_3_9&#45;&gt;gate_3_9 -->
<g id="edge966" class="edge">
<title>attn_residual_3_9&#45;&gt;gate_3_9</title>
<path fill="none" stroke="black" d="M7809.75,-791.36C7809.75,-791.36 7809.75,-720.08 7809.75,-720.08"/>
<polygon fill="black" stroke="black" points="7813.25,-720.08 7809.75,-710.08 7806.25,-720.08 7813.25,-720.08"/>
</g>
<!-- gate_3_9&#45;&gt;expert_3_0_0 -->
<g id="edge2778" class="edge">
<title>gate_3_9&#45;&gt;expert_3_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7757,-715.26C7757,-741.21 7757,-771 7757,-771 7757,-771 116.8,-771 116.8,-771 116.8,-771 116.8,-518.22 116.8,-518.22"/>
<polygon fill="blue" stroke="blue" points="120.3,-518.22 116.8,-508.22 113.3,-518.22 120.3,-518.22"/>
<text text-anchor="middle" x="32486.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="32486.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU9→GPU0</text>
<text text-anchor="middle" x="32486.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="32486.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_9&#45;&gt;expert_3_1_0 -->
<g id="edge2779" class="edge">
<title>gate_3_9&#45;&gt;expert_3_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7704.25,-710.2C7704.25,-715.34 7704.25,-719 7704.25,-719 7704.25,-719 3172.29,-719 3172.29,-719 3172.29,-719 3172.29,-518.28 3172.29,-518.28"/>
<polygon fill="blue" stroke="blue" points="3175.79,-518.28 3172.29,-508.28 3168.79,-518.28 3175.79,-518.28"/>
<text text-anchor="middle" x="32660.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="32660.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU9→GPU1</text>
<text text-anchor="middle" x="32660.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="32660.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_9&#45;&gt;expert_3_2_0 -->
<g id="edge2780" class="edge">
<title>gate_3_9&#45;&gt;expert_3_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7670.68,-655.78C7670.68,-620.83 7670.68,-556 7670.68,-556 7670.68,-556 3605.02,-556 3605.02,-556 3605.02,-556 3605.02,-518.4 3605.02,-518.4"/>
<polygon fill="blue" stroke="blue" points="3608.52,-518.4 3605.02,-508.4 3601.52,-518.4 3608.52,-518.4"/>
<text text-anchor="middle" x="32834.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="32834.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU9→GPU2</text>
<text text-anchor="middle" x="32834.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="32834.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_9&#45;&gt;expert_3_3_0 -->
<g id="edge2781" class="edge">
<title>gate_3_9&#45;&gt;expert_3_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7689.86,-648.5C7689.86,-615.46 7689.86,-566 7689.86,-566 7689.86,-566 4197.02,-566 4197.02,-566 4197.02,-566 4197.02,-518.24 4197.02,-518.24"/>
<polygon fill="blue" stroke="blue" points="4200.52,-518.24 4197.02,-508.24 4193.52,-518.24 4200.52,-518.24"/>
<text text-anchor="middle" x="33008.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33008.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU9→GPU3</text>
<text text-anchor="middle" x="33008.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33008.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_9&#45;&gt;expert_3_4_0 -->
<g id="edge2782" class="edge">
<title>gate_3_9&#45;&gt;expert_3_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7709.05,-643.9C7709.05,-613.68 7709.05,-574 7709.05,-574 7709.05,-574 4796.88,-574 4796.88,-574 4796.88,-574 4796.88,-518.25 4796.88,-518.25"/>
<polygon fill="blue" stroke="blue" points="4800.38,-518.25 4796.88,-508.25 4793.38,-518.25 4800.38,-518.25"/>
<text text-anchor="middle" x="33182.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33182.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU9→GPU4</text>
<text text-anchor="middle" x="33182.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33182.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_9&#45;&gt;expert_3_5_0 -->
<g id="edge2783" class="edge">
<title>gate_3_9&#45;&gt;expert_3_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7728.23,-641.12C7728.23,-618.62 7728.23,-594 7728.23,-594 7728.23,-594 5393.93,-594 5393.93,-594 5393.93,-594 5393.93,-518.16 5393.93,-518.16"/>
<polygon fill="blue" stroke="blue" points="5397.43,-518.16 5393.93,-508.16 5390.43,-518.16 5397.43,-518.16"/>
<text text-anchor="middle" x="33356.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33356.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU9→GPU5</text>
<text text-anchor="middle" x="33356.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33356.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_9&#45;&gt;expert_3_6_0 -->
<g id="edge2784" class="edge">
<title>gate_3_9&#45;&gt;expert_3_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7747.41,-640.15C7747.41,-620.73 7747.41,-601 7747.41,-601 7747.41,-601 5974.9,-601 5974.9,-601 5974.9,-601 5974.9,-518.02 5974.9,-518.02"/>
<polygon fill="blue" stroke="blue" points="5978.4,-518.02 5974.9,-508.02 5971.4,-518.02 5978.4,-518.02"/>
<text text-anchor="middle" x="33530.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33530.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU9→GPU6</text>
<text text-anchor="middle" x="33530.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33530.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_9&#45;&gt;expert_3_7_0 -->
<g id="edge2785" class="edge">
<title>gate_3_9&#45;&gt;expert_3_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7757,-639.97C7757,-634.68 7757,-631 7757,-631 7757,-631 6698.62,-631 6698.62,-631 6698.62,-631 6698.62,-518.23 6698.62,-518.23"/>
<polygon fill="blue" stroke="blue" points="6702.13,-518.23 6698.62,-508.23 6695.13,-518.23 6702.13,-518.23"/>
<text text-anchor="middle" x="33704.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33704.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU9→GPU7</text>
<text text-anchor="middle" x="33704.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33704.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_9&#45;&gt;expert_3_8_0 -->
<g id="edge2786" class="edge">
<title>gate_3_9&#45;&gt;expert_3_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7657.3,-690C7517.46,-690 7280,-690 7280,-690 7280,-690 7280,-518.33 7280,-518.33"/>
<polygon fill="blue" stroke="blue" points="7283.5,-518.33 7280,-508.33 7276.5,-518.33 7283.5,-518.33"/>
<text text-anchor="middle" x="33878.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="33878.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU9→GPU8</text>
<text text-anchor="middle" x="33878.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="33878.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_9&#45;&gt;expert_3_9_0 -->
<g id="edge967" class="edge">
<title>gate_3_9&#45;&gt;expert_3_9_0</title>
<path fill="none" stroke="black" d="M7766.59,-639.71C7766.59,-639.71 7766.59,-518.18 7766.59,-518.18"/>
<polygon fill="black" stroke="black" points="7770.09,-518.18 7766.59,-508.18 7763.09,-518.18 7770.09,-518.18"/>
</g>
<!-- gate_3_9&#45;&gt;expert_3_10_0 -->
<g id="edge2787" class="edge">
<title>gate_3_9&#45;&gt;expert_3_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7856.52,-665C7996.09,-665 8233.1,-665 8233.1,-665 8233.1,-665 8233.1,-518.18 8233.1,-518.18"/>
<polygon fill="blue" stroke="blue" points="8236.6,-518.18 8233.1,-508.18 8229.6,-518.18 8236.6,-518.18"/>
<text text-anchor="middle" x="34052.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34052.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU9→GPU10</text>
<text text-anchor="middle" x="34052.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34052.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_9&#45;&gt;expert_3_11_0 -->
<g id="edge2788" class="edge">
<title>gate_3_9&#45;&gt;expert_3_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7814.55,-645.8C7814.55,-633.81 7814.55,-623 7814.55,-623 7814.55,-623 8818.75,-623 8818.75,-623 8818.75,-623 8818.75,-518.12 8818.75,-518.12"/>
<polygon fill="blue" stroke="blue" points="8822.25,-518.12 8818.75,-508.12 8815.25,-518.12 8822.25,-518.12"/>
<text text-anchor="middle" x="34226.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34226.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU9→GPU11</text>
<text text-anchor="middle" x="34226.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34226.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_9&#45;&gt;expert_3_12_0 -->
<g id="edge2789" class="edge">
<title>gate_3_9&#45;&gt;expert_3_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7824.14,-648.52C7824.14,-622.71 7824.14,-589 7824.14,-589 7824.14,-589 9402.38,-589 9402.38,-589 9402.38,-589 9402.38,-518.07 9402.38,-518.07"/>
<polygon fill="blue" stroke="blue" points="9405.88,-518.07 9402.38,-508.07 9398.88,-518.07 9405.88,-518.07"/>
<text text-anchor="middle" x="34400.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34400.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU9→GPU12</text>
<text text-anchor="middle" x="34400.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34400.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_9&#45;&gt;expert_3_13_0 -->
<g id="edge2790" class="edge">
<title>gate_3_9&#45;&gt;expert_3_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7833.73,-651.64C7833.73,-623.06 7833.73,-581 7833.73,-581 7833.73,-581 10168.3,-581 10168.3,-581 10168.3,-581 10168.3,-518.16 10168.3,-518.16"/>
<polygon fill="blue" stroke="blue" points="10171.8,-518.16 10168.3,-508.16 10164.8,-518.16 10171.8,-518.16"/>
<text text-anchor="middle" x="34574.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34574.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU9→GPU13</text>
<text text-anchor="middle" x="34574.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34574.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_9&#45;&gt;expert_3_14_0 -->
<g id="edge2791" class="edge">
<title>gate_3_9&#45;&gt;expert_3_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7843.32,-655.76C7843.32,-625.67 7843.32,-575 7843.32,-575 7843.32,-575 10737.21,-575 10737.21,-575 10737.21,-575 10737.21,-518.04 10737.21,-518.04"/>
<polygon fill="blue" stroke="blue" points="10740.71,-518.04 10737.21,-508.04 10733.71,-518.04 10740.71,-518.04"/>
<text text-anchor="middle" x="34748.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34748.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU9→GPU14</text>
<text text-anchor="middle" x="34748.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34748.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_9&#45;&gt;expert_3_15_0 -->
<g id="edge2792" class="edge">
<title>gate_3_9&#45;&gt;expert_3_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7852.91,-661.49C7852.91,-631.31 7852.91,-569 7852.91,-569 7852.91,-569 11306.76,-569 11306.76,-569 11306.76,-569 11306.76,-518.23 11306.76,-518.23"/>
<polygon fill="blue" stroke="blue" points="11310.26,-518.23 11306.76,-508.23 11303.26,-518.23 11310.26,-518.23"/>
<text text-anchor="middle" x="34922.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="34922.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU9→GPU15</text>
<text text-anchor="middle" x="34922.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="34922.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_9 -->
<g id="node978" class="node">
<title>expert_reduce_3_9</title>
<ellipse fill="none" stroke="black" cx="7757" cy="-344.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="7757" y="-355.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="7757" y="-340.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="7757" y="-325.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_9_0&#45;&gt;expert_reduce_3_9 -->
<g id="edge968" class="edge">
<title>expert_3_9_0&#45;&gt;expert_reduce_3_9</title>
<path fill="none" stroke="black" d="M7757,-454.76C7757,-454.76 7757,-392.06 7757,-392.06"/>
<polygon fill="black" stroke="black" points="7760.5,-392.06 7757,-382.06 7753.5,-392.06 7760.5,-392.06"/>
</g>
<!-- moe_residual_3_9 -->
<g id="node979" class="node">
<title>moe_residual_3_9</title>
<ellipse fill="none" stroke="black" cx="7757" cy="-207" rx="105.5" ry="27"/>
<text text-anchor="middle" x="7757" y="-210.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="7757" y="-195.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_9&#45;&gt;moe_residual_3_9 -->
<g id="edge969" class="edge">
<title>expert_reduce_3_9&#45;&gt;moe_residual_3_9</title>
<path fill="none" stroke="black" d="M7757,-306.93C7757,-306.93 7757,-244.06 7757,-244.06"/>
<polygon fill="black" stroke="black" points="7760.5,-244.06 7757,-234.06 7753.5,-244.06 7760.5,-244.06"/>
</g>
<!-- output_9 -->
<g id="node980" class="node">
<title>output_9</title>
<polygon fill="lightcoral" stroke="black" points="7850,-107 7664,-107 7664,-69 7850,-69 7850,-107"/>
<text text-anchor="middle" x="7757" y="-91.8" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="7757" y="-76.8" font-family="Times,serif" font-size="14.00">Y[9]: 1024×1024×4096</text>
</g>
<!-- moe_residual_3_9&#45;&gt;output_9 -->
<g id="edge970" class="edge">
<title>moe_residual_3_9&#45;&gt;output_9</title>
<path fill="none" stroke="black" d="M7757,-180C7757,-180 7757,-117.12 7757,-117.12"/>
<polygon fill="black" stroke="black" points="7760.5,-117.12 7757,-107.12 7753.5,-117.12 7760.5,-117.12"/>
</g>
<!-- input_10 -->
<g id="node981" class="node">
<title>input_10</title>
<polygon fill="lightgreen" stroke="black" points="8442,-20866 8246,-20866 8246,-20828 8442,-20828 8442,-20866"/>
<text text-anchor="middle" x="8344" y="-20850.8" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="8344" y="-20835.8" font-family="Times,serif" font-size="14.00">X[10]: 1024×1024×4096</text>
</g>
<!-- qkv_proj_0_10 -->
<g id="node982" class="node">
<title>qkv_proj_0_10</title>
<polygon fill="none" stroke="black" points="8426.5,-20755 8261.5,-20755 8261.5,-20702 8426.5,-20702 8426.5,-20755"/>
<text text-anchor="middle" x="8344" y="-20739.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="8344" y="-20724.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="8344" y="-20709.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- input_10&#45;&gt;qkv_proj_0_10 -->
<g id="edge971" class="edge">
<title>input_10&#45;&gt;qkv_proj_0_10</title>
<path fill="none" stroke="black" d="M8344,-20827.96C8344,-20827.96 8344,-20765.44 8344,-20765.44"/>
<polygon fill="black" stroke="black" points="8347.5,-20765.44 8344,-20755.44 8340.5,-20765.44 8347.5,-20765.44"/>
</g>
<!-- qkv_reshape_0_10 -->
<g id="node983" class="node">
<title>qkv_reshape_0_10</title>
<ellipse fill="none" stroke="black" cx="8344" cy="-20602" rx="148" ry="27"/>
<text text-anchor="middle" x="8344" y="-20605.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="8344" y="-20590.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_0_10&#45;&gt;qkv_reshape_0_10 -->
<g id="edge972" class="edge">
<title>qkv_proj_0_10&#45;&gt;qkv_reshape_0_10</title>
<path fill="none" stroke="black" d="M8344,-20701.98C8344,-20701.98 8344,-20639.36 8344,-20639.36"/>
<polygon fill="black" stroke="black" points="8347.5,-20639.36 8344,-20629.36 8340.5,-20639.36 8347.5,-20639.36"/>
</g>
<!-- qkv_reshape_0_10&#45;&gt;ring_attn_0_10_stage_0 -->
<g id="edge973" class="edge">
<title>qkv_reshape_0_10&#45;&gt;ring_attn_0_10_stage_0</title>
<path fill="none" stroke="black" d="M8344,-20574.72C8344,-20574.72 8344,-20468.16 8344,-20468.16"/>
<polygon fill="black" stroke="black" points="8347.5,-20468.16 8344,-20458.16 8340.5,-20468.16 8347.5,-20468.16"/>
</g>
<!-- ring_attn_0_10_stage_0&#45;&gt;ring_attn_0_10_stage_1 -->
<g id="edge974" class="edge">
<title>ring_attn_0_10_stage_0&#45;&gt;ring_attn_0_10_stage_1</title>
<path fill="none" stroke="black" d="M8344,-20321.87C8344,-20321.87 8344,-20215.25 8344,-20215.25"/>
<polygon fill="black" stroke="black" points="8347.5,-20215.25 8344,-20205.25 8340.5,-20215.25 8347.5,-20215.25"/>
</g>
<!-- ring_attn_0_11_stage_0 -->
<g id="node1082" class="node">
<title>ring_attn_0_11_stage_0</title>
<polygon fill="yellow" stroke="black" points="8931,-20458 8722,-20390 8931,-20322 9140,-20390 8931,-20458"/>
<text text-anchor="middle" x="8931" y="-20408.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-20393.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="8931" y="-20378.8" font-family="Times,serif" font-size="14.00">Q[11]×K[11]×V[11]</text>
<text text-anchor="middle" x="8931" y="-20363.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_10_stage_0&#45;&gt;ring_attn_0_11_stage_0 -->
<g id="edge2793" class="edge">
<title>ring_attn_0_10_stage_0&#45;&gt;ring_attn_0_11_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-20390C8553.02,-20390 8711.86,-20390 8711.86,-20390"/>
<polygon fill="red" stroke="red" points="8711.86,-20393.5 8721.86,-20390 8711.86,-20386.5 8711.86,-20393.5"/>
</g>
<!-- ring_attn_0_10_stage_1&#45;&gt;ring_attn_0_10_stage_2 -->
<g id="edge975" class="edge">
<title>ring_attn_0_10_stage_1&#45;&gt;ring_attn_0_10_stage_2</title>
<path fill="none" stroke="black" d="M8344,-20068.87C8344,-20068.87 8344,-19962.25 8344,-19962.25"/>
<polygon fill="black" stroke="black" points="8347.5,-19962.25 8344,-19952.25 8340.5,-19962.25 8347.5,-19962.25"/>
</g>
<!-- ring_attn_0_11_stage_1 -->
<g id="node1083" class="node">
<title>ring_attn_0_11_stage_1</title>
<polygon fill="yellow" stroke="black" points="8931,-20205 8722,-20137 8931,-20069 9140,-20137 8931,-20205"/>
<text text-anchor="middle" x="8931" y="-20155.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-20140.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="8931" y="-20125.8" font-family="Times,serif" font-size="14.00">Q[11]×K[10]×V[10]</text>
<text text-anchor="middle" x="8931" y="-20110.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_10_stage_1&#45;&gt;ring_attn_0_11_stage_1 -->
<g id="edge2794" class="edge">
<title>ring_attn_0_10_stage_1&#45;&gt;ring_attn_0_11_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-20137C8553.02,-20137 8711.86,-20137 8711.86,-20137"/>
<polygon fill="red" stroke="red" points="8711.86,-20140.5 8721.86,-20137 8711.86,-20133.5 8711.86,-20140.5"/>
</g>
<!-- ring_attn_0_10_stage_2&#45;&gt;ring_attn_0_10_stage_3 -->
<g id="edge976" class="edge">
<title>ring_attn_0_10_stage_2&#45;&gt;ring_attn_0_10_stage_3</title>
<path fill="none" stroke="black" d="M8344,-19815.87C8344,-19815.87 8344,-19709.25 8344,-19709.25"/>
<polygon fill="black" stroke="black" points="8347.5,-19709.25 8344,-19699.25 8340.5,-19709.25 8347.5,-19709.25"/>
</g>
<!-- ring_attn_0_11_stage_2 -->
<g id="node1084" class="node">
<title>ring_attn_0_11_stage_2</title>
<polygon fill="yellow" stroke="black" points="8931,-19952 8722,-19884 8931,-19816 9140,-19884 8931,-19952"/>
<text text-anchor="middle" x="8931" y="-19902.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-19887.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="8931" y="-19872.8" font-family="Times,serif" font-size="14.00">Q[11]×K[9]×V[9]</text>
<text text-anchor="middle" x="8931" y="-19857.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_10_stage_2&#45;&gt;ring_attn_0_11_stage_2 -->
<g id="edge2795" class="edge">
<title>ring_attn_0_10_stage_2&#45;&gt;ring_attn_0_11_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-19884C8553.02,-19884 8711.86,-19884 8711.86,-19884"/>
<polygon fill="red" stroke="red" points="8711.86,-19887.5 8721.86,-19884 8711.86,-19880.5 8711.86,-19887.5"/>
</g>
<!-- ring_attn_0_10_stage_3&#45;&gt;ring_attn_0_10_stage_4 -->
<g id="edge977" class="edge">
<title>ring_attn_0_10_stage_3&#45;&gt;ring_attn_0_10_stage_4</title>
<path fill="none" stroke="black" d="M8344,-19562.87C8344,-19562.87 8344,-19456.25 8344,-19456.25"/>
<polygon fill="black" stroke="black" points="8347.5,-19456.25 8344,-19446.25 8340.5,-19456.25 8347.5,-19456.25"/>
</g>
<!-- ring_attn_0_11_stage_3 -->
<g id="node1085" class="node">
<title>ring_attn_0_11_stage_3</title>
<polygon fill="yellow" stroke="black" points="8931,-19699 8722,-19631 8931,-19563 9140,-19631 8931,-19699"/>
<text text-anchor="middle" x="8931" y="-19649.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-19634.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="8931" y="-19619.8" font-family="Times,serif" font-size="14.00">Q[11]×K[8]×V[8]</text>
<text text-anchor="middle" x="8931" y="-19604.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_10_stage_3&#45;&gt;ring_attn_0_11_stage_3 -->
<g id="edge2796" class="edge">
<title>ring_attn_0_10_stage_3&#45;&gt;ring_attn_0_11_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-19631C8553.02,-19631 8711.86,-19631 8711.86,-19631"/>
<polygon fill="red" stroke="red" points="8711.86,-19634.5 8721.86,-19631 8711.86,-19627.5 8711.86,-19634.5"/>
</g>
<!-- ring_attn_0_10_stage_4&#45;&gt;ring_attn_0_10_stage_5 -->
<g id="edge978" class="edge">
<title>ring_attn_0_10_stage_4&#45;&gt;ring_attn_0_10_stage_5</title>
<path fill="none" stroke="black" d="M8344,-19309.87C8344,-19309.87 8344,-19203.25 8344,-19203.25"/>
<polygon fill="black" stroke="black" points="8347.5,-19203.25 8344,-19193.25 8340.5,-19203.25 8347.5,-19203.25"/>
</g>
<!-- ring_attn_0_11_stage_4 -->
<g id="node1086" class="node">
<title>ring_attn_0_11_stage_4</title>
<polygon fill="yellow" stroke="black" points="8931,-19446 8722,-19378 8931,-19310 9140,-19378 8931,-19446"/>
<text text-anchor="middle" x="8931" y="-19396.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-19381.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="8931" y="-19366.8" font-family="Times,serif" font-size="14.00">Q[11]×K[7]×V[7]</text>
<text text-anchor="middle" x="8931" y="-19351.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_10_stage_4&#45;&gt;ring_attn_0_11_stage_4 -->
<g id="edge2797" class="edge">
<title>ring_attn_0_10_stage_4&#45;&gt;ring_attn_0_11_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-19378C8553.02,-19378 8711.86,-19378 8711.86,-19378"/>
<polygon fill="red" stroke="red" points="8711.86,-19381.5 8721.86,-19378 8711.86,-19374.5 8711.86,-19381.5"/>
</g>
<!-- ring_attn_0_10_stage_5&#45;&gt;ring_attn_0_10_stage_6 -->
<g id="edge979" class="edge">
<title>ring_attn_0_10_stage_5&#45;&gt;ring_attn_0_10_stage_6</title>
<path fill="none" stroke="black" d="M8344,-19056.87C8344,-19056.87 8344,-18950.25 8344,-18950.25"/>
<polygon fill="black" stroke="black" points="8347.5,-18950.25 8344,-18940.25 8340.5,-18950.25 8347.5,-18950.25"/>
</g>
<!-- ring_attn_0_11_stage_5 -->
<g id="node1087" class="node">
<title>ring_attn_0_11_stage_5</title>
<polygon fill="yellow" stroke="black" points="8931,-19193 8722,-19125 8931,-19057 9140,-19125 8931,-19193"/>
<text text-anchor="middle" x="8931" y="-19143.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-19128.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="8931" y="-19113.8" font-family="Times,serif" font-size="14.00">Q[11]×K[6]×V[6]</text>
<text text-anchor="middle" x="8931" y="-19098.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_10_stage_5&#45;&gt;ring_attn_0_11_stage_5 -->
<g id="edge2798" class="edge">
<title>ring_attn_0_10_stage_5&#45;&gt;ring_attn_0_11_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-19125C8553.02,-19125 8711.86,-19125 8711.86,-19125"/>
<polygon fill="red" stroke="red" points="8711.86,-19128.5 8721.86,-19125 8711.86,-19121.5 8711.86,-19128.5"/>
</g>
<!-- ring_attn_0_10_stage_6&#45;&gt;ring_attn_0_10_stage_7 -->
<g id="edge980" class="edge">
<title>ring_attn_0_10_stage_6&#45;&gt;ring_attn_0_10_stage_7</title>
<path fill="none" stroke="black" d="M8344,-18803.87C8344,-18803.87 8344,-18697.25 8344,-18697.25"/>
<polygon fill="black" stroke="black" points="8347.5,-18697.25 8344,-18687.25 8340.5,-18697.25 8347.5,-18697.25"/>
</g>
<!-- ring_attn_0_11_stage_6 -->
<g id="node1088" class="node">
<title>ring_attn_0_11_stage_6</title>
<polygon fill="yellow" stroke="black" points="8931,-18940 8722,-18872 8931,-18804 9140,-18872 8931,-18940"/>
<text text-anchor="middle" x="8931" y="-18890.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-18875.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="8931" y="-18860.8" font-family="Times,serif" font-size="14.00">Q[11]×K[5]×V[5]</text>
<text text-anchor="middle" x="8931" y="-18845.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_10_stage_6&#45;&gt;ring_attn_0_11_stage_6 -->
<g id="edge2799" class="edge">
<title>ring_attn_0_10_stage_6&#45;&gt;ring_attn_0_11_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-18872C8553.02,-18872 8711.86,-18872 8711.86,-18872"/>
<polygon fill="red" stroke="red" points="8711.86,-18875.5 8721.86,-18872 8711.86,-18868.5 8711.86,-18875.5"/>
</g>
<!-- ring_attn_0_10_stage_7&#45;&gt;ring_attn_0_10_stage_8 -->
<g id="edge981" class="edge">
<title>ring_attn_0_10_stage_7&#45;&gt;ring_attn_0_10_stage_8</title>
<path fill="none" stroke="black" d="M8344,-18550.87C8344,-18550.87 8344,-18444.25 8344,-18444.25"/>
<polygon fill="black" stroke="black" points="8347.5,-18444.25 8344,-18434.25 8340.5,-18444.25 8347.5,-18444.25"/>
</g>
<!-- ring_attn_0_11_stage_7 -->
<g id="node1089" class="node">
<title>ring_attn_0_11_stage_7</title>
<polygon fill="yellow" stroke="black" points="8931,-18687 8722,-18619 8931,-18551 9140,-18619 8931,-18687"/>
<text text-anchor="middle" x="8931" y="-18637.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-18622.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="8931" y="-18607.8" font-family="Times,serif" font-size="14.00">Q[11]×K[4]×V[4]</text>
<text text-anchor="middle" x="8931" y="-18592.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_10_stage_7&#45;&gt;ring_attn_0_11_stage_7 -->
<g id="edge2800" class="edge">
<title>ring_attn_0_10_stage_7&#45;&gt;ring_attn_0_11_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-18619C8553.02,-18619 8711.86,-18619 8711.86,-18619"/>
<polygon fill="red" stroke="red" points="8711.86,-18622.5 8721.86,-18619 8711.86,-18615.5 8711.86,-18622.5"/>
</g>
<!-- ring_attn_0_10_stage_8&#45;&gt;ring_attn_0_10_stage_9 -->
<g id="edge982" class="edge">
<title>ring_attn_0_10_stage_8&#45;&gt;ring_attn_0_10_stage_9</title>
<path fill="none" stroke="black" d="M8344,-18297.87C8344,-18297.87 8344,-18191.25 8344,-18191.25"/>
<polygon fill="black" stroke="black" points="8347.5,-18191.25 8344,-18181.25 8340.5,-18191.25 8347.5,-18191.25"/>
</g>
<!-- ring_attn_0_11_stage_8 -->
<g id="node1090" class="node">
<title>ring_attn_0_11_stage_8</title>
<polygon fill="yellow" stroke="black" points="8931,-18434 8722,-18366 8931,-18298 9140,-18366 8931,-18434"/>
<text text-anchor="middle" x="8931" y="-18384.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-18369.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="8931" y="-18354.8" font-family="Times,serif" font-size="14.00">Q[11]×K[3]×V[3]</text>
<text text-anchor="middle" x="8931" y="-18339.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_10_stage_8&#45;&gt;ring_attn_0_11_stage_8 -->
<g id="edge2801" class="edge">
<title>ring_attn_0_10_stage_8&#45;&gt;ring_attn_0_11_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-18366C8553.02,-18366 8711.86,-18366 8711.86,-18366"/>
<polygon fill="red" stroke="red" points="8711.86,-18369.5 8721.86,-18366 8711.86,-18362.5 8711.86,-18369.5"/>
</g>
<!-- ring_attn_0_10_stage_9&#45;&gt;ring_attn_0_10_stage_10 -->
<g id="edge983" class="edge">
<title>ring_attn_0_10_stage_9&#45;&gt;ring_attn_0_10_stage_10</title>
<path fill="none" stroke="black" d="M8344,-18044.87C8344,-18044.87 8344,-17938.25 8344,-17938.25"/>
<polygon fill="black" stroke="black" points="8347.5,-17938.25 8344,-17928.25 8340.5,-17938.25 8347.5,-17938.25"/>
</g>
<!-- ring_attn_0_11_stage_9 -->
<g id="node1091" class="node">
<title>ring_attn_0_11_stage_9</title>
<polygon fill="yellow" stroke="black" points="8931,-18181 8722,-18113 8931,-18045 9140,-18113 8931,-18181"/>
<text text-anchor="middle" x="8931" y="-18131.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-18116.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="8931" y="-18101.8" font-family="Times,serif" font-size="14.00">Q[11]×K[2]×V[2]</text>
<text text-anchor="middle" x="8931" y="-18086.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_10_stage_9&#45;&gt;ring_attn_0_11_stage_9 -->
<g id="edge2802" class="edge">
<title>ring_attn_0_10_stage_9&#45;&gt;ring_attn_0_11_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-18113C8553.02,-18113 8711.86,-18113 8711.86,-18113"/>
<polygon fill="red" stroke="red" points="8711.86,-18116.5 8721.86,-18113 8711.86,-18109.5 8711.86,-18116.5"/>
</g>
<!-- ring_attn_0_10_stage_10&#45;&gt;ring_attn_0_10_stage_11 -->
<g id="edge984" class="edge">
<title>ring_attn_0_10_stage_10&#45;&gt;ring_attn_0_10_stage_11</title>
<path fill="none" stroke="black" d="M8344,-17791.87C8344,-17791.87 8344,-17685.25 8344,-17685.25"/>
<polygon fill="black" stroke="black" points="8347.5,-17685.25 8344,-17675.25 8340.5,-17685.25 8347.5,-17685.25"/>
</g>
<!-- ring_attn_0_11_stage_10 -->
<g id="node1092" class="node">
<title>ring_attn_0_11_stage_10</title>
<polygon fill="yellow" stroke="black" points="8931,-17928 8722,-17860 8931,-17792 9140,-17860 8931,-17928"/>
<text text-anchor="middle" x="8931" y="-17878.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-17863.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="8931" y="-17848.8" font-family="Times,serif" font-size="14.00">Q[11]×K[1]×V[1]</text>
<text text-anchor="middle" x="8931" y="-17833.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_10_stage_10&#45;&gt;ring_attn_0_11_stage_10 -->
<g id="edge2803" class="edge">
<title>ring_attn_0_10_stage_10&#45;&gt;ring_attn_0_11_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-17860C8553.02,-17860 8711.86,-17860 8711.86,-17860"/>
<polygon fill="red" stroke="red" points="8711.86,-17863.5 8721.86,-17860 8711.86,-17856.5 8711.86,-17863.5"/>
</g>
<!-- ring_attn_0_10_stage_11&#45;&gt;ring_attn_0_10_stage_12 -->
<g id="edge985" class="edge">
<title>ring_attn_0_10_stage_11&#45;&gt;ring_attn_0_10_stage_12</title>
<path fill="none" stroke="black" d="M8344,-17538.87C8344,-17538.87 8344,-17432.25 8344,-17432.25"/>
<polygon fill="black" stroke="black" points="8347.5,-17432.25 8344,-17422.25 8340.5,-17432.25 8347.5,-17432.25"/>
</g>
<!-- ring_attn_0_11_stage_11 -->
<g id="node1093" class="node">
<title>ring_attn_0_11_stage_11</title>
<polygon fill="yellow" stroke="black" points="8931,-17675 8722,-17607 8931,-17539 9140,-17607 8931,-17675"/>
<text text-anchor="middle" x="8931" y="-17625.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-17610.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="8931" y="-17595.8" font-family="Times,serif" font-size="14.00">Q[11]×K[0]×V[0]</text>
<text text-anchor="middle" x="8931" y="-17580.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_10_stage_11&#45;&gt;ring_attn_0_11_stage_11 -->
<g id="edge2804" class="edge">
<title>ring_attn_0_10_stage_11&#45;&gt;ring_attn_0_11_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-17607C8553.02,-17607 8711.86,-17607 8711.86,-17607"/>
<polygon fill="red" stroke="red" points="8711.86,-17610.5 8721.86,-17607 8711.86,-17603.5 8711.86,-17610.5"/>
</g>
<!-- ring_attn_0_10_stage_12&#45;&gt;ring_attn_0_10_stage_13 -->
<g id="edge986" class="edge">
<title>ring_attn_0_10_stage_12&#45;&gt;ring_attn_0_10_stage_13</title>
<path fill="none" stroke="black" d="M8344,-17285.87C8344,-17285.87 8344,-17179.25 8344,-17179.25"/>
<polygon fill="black" stroke="black" points="8347.5,-17179.25 8344,-17169.25 8340.5,-17179.25 8347.5,-17179.25"/>
</g>
<!-- ring_attn_0_11_stage_12 -->
<g id="node1094" class="node">
<title>ring_attn_0_11_stage_12</title>
<polygon fill="yellow" stroke="black" points="8931,-17422 8722,-17354 8931,-17286 9140,-17354 8931,-17422"/>
<text text-anchor="middle" x="8931" y="-17372.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-17357.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="8931" y="-17342.8" font-family="Times,serif" font-size="14.00">Q[11]×K[15]×V[15]</text>
<text text-anchor="middle" x="8931" y="-17327.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_10_stage_12&#45;&gt;ring_attn_0_11_stage_12 -->
<g id="edge2805" class="edge">
<title>ring_attn_0_10_stage_12&#45;&gt;ring_attn_0_11_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-17354C8553.02,-17354 8711.86,-17354 8711.86,-17354"/>
<polygon fill="red" stroke="red" points="8711.86,-17357.5 8721.86,-17354 8711.86,-17350.5 8711.86,-17357.5"/>
</g>
<!-- ring_attn_0_10_stage_13&#45;&gt;ring_attn_0_10_stage_14 -->
<g id="edge987" class="edge">
<title>ring_attn_0_10_stage_13&#45;&gt;ring_attn_0_10_stage_14</title>
<path fill="none" stroke="black" d="M8344,-17032.87C8344,-17032.87 8344,-16926.25 8344,-16926.25"/>
<polygon fill="black" stroke="black" points="8347.5,-16926.25 8344,-16916.25 8340.5,-16926.25 8347.5,-16926.25"/>
</g>
<!-- ring_attn_0_11_stage_13 -->
<g id="node1095" class="node">
<title>ring_attn_0_11_stage_13</title>
<polygon fill="yellow" stroke="black" points="8931,-17169 8722,-17101 8931,-17033 9140,-17101 8931,-17169"/>
<text text-anchor="middle" x="8931" y="-17119.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-17104.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="8931" y="-17089.8" font-family="Times,serif" font-size="14.00">Q[11]×K[14]×V[14]</text>
<text text-anchor="middle" x="8931" y="-17074.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_10_stage_13&#45;&gt;ring_attn_0_11_stage_13 -->
<g id="edge2806" class="edge">
<title>ring_attn_0_10_stage_13&#45;&gt;ring_attn_0_11_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-17101C8553.02,-17101 8711.86,-17101 8711.86,-17101"/>
<polygon fill="red" stroke="red" points="8711.86,-17104.5 8721.86,-17101 8711.86,-17097.5 8711.86,-17104.5"/>
</g>
<!-- ring_attn_0_10_stage_14&#45;&gt;ring_attn_0_10_stage_15 -->
<g id="edge988" class="edge">
<title>ring_attn_0_10_stage_14&#45;&gt;ring_attn_0_10_stage_15</title>
<path fill="none" stroke="black" d="M8344,-16779.87C8344,-16779.87 8344,-16673.25 8344,-16673.25"/>
<polygon fill="black" stroke="black" points="8347.5,-16673.25 8344,-16663.25 8340.5,-16673.25 8347.5,-16673.25"/>
</g>
<!-- ring_attn_0_11_stage_14 -->
<g id="node1096" class="node">
<title>ring_attn_0_11_stage_14</title>
<polygon fill="yellow" stroke="black" points="8931,-16916 8722,-16848 8931,-16780 9140,-16848 8931,-16916"/>
<text text-anchor="middle" x="8931" y="-16866.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-16851.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="8931" y="-16836.8" font-family="Times,serif" font-size="14.00">Q[11]×K[13]×V[13]</text>
<text text-anchor="middle" x="8931" y="-16821.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_10_stage_14&#45;&gt;ring_attn_0_11_stage_14 -->
<g id="edge2807" class="edge">
<title>ring_attn_0_10_stage_14&#45;&gt;ring_attn_0_11_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-16848C8553.02,-16848 8711.86,-16848 8711.86,-16848"/>
<polygon fill="red" stroke="red" points="8711.86,-16851.5 8721.86,-16848 8711.86,-16844.5 8711.86,-16851.5"/>
</g>
<!-- attn_out_0_10 -->
<g id="node1000" class="node">
<title>attn_out_0_10</title>
<polygon fill="none" stroke="black" points="8413.5,-16454 8274.5,-16454 8274.5,-16401 8413.5,-16401 8413.5,-16454"/>
<text text-anchor="middle" x="8344" y="-16438.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="8344" y="-16423.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="8344" y="-16408.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_0_10_stage_15&#45;&gt;attn_out_0_10 -->
<g id="edge989" class="edge">
<title>ring_attn_0_10_stage_15&#45;&gt;attn_out_0_10</title>
<path fill="none" stroke="black" d="M8344,-16526.87C8344,-16526.87 8344,-16464.18 8344,-16464.18"/>
<polygon fill="black" stroke="black" points="8347.5,-16464.18 8344,-16454.18 8340.5,-16464.18 8347.5,-16464.18"/>
</g>
<!-- ring_attn_0_11_stage_15 -->
<g id="node1097" class="node">
<title>ring_attn_0_11_stage_15</title>
<polygon fill="yellow" stroke="black" points="8931,-16663 8722,-16595 8931,-16527 9140,-16595 8931,-16663"/>
<text text-anchor="middle" x="8931" y="-16613.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-16598.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="8931" y="-16583.8" font-family="Times,serif" font-size="14.00">Q[11]×K[12]×V[12]</text>
<text text-anchor="middle" x="8931" y="-16568.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_10_stage_15&#45;&gt;ring_attn_0_11_stage_15 -->
<g id="edge2808" class="edge">
<title>ring_attn_0_10_stage_15&#45;&gt;ring_attn_0_11_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-16595C8553.02,-16595 8711.86,-16595 8711.86,-16595"/>
<polygon fill="red" stroke="red" points="8711.86,-16598.5 8721.86,-16595 8711.86,-16591.5 8711.86,-16598.5"/>
</g>
<!-- attn_residual_0_10 -->
<g id="node1001" class="node">
<title>attn_residual_0_10</title>
<ellipse fill="none" stroke="black" cx="8344" cy="-16301" rx="105.5" ry="27"/>
<text text-anchor="middle" x="8344" y="-16304.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="8344" y="-16289.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_0_10&#45;&gt;attn_residual_0_10 -->
<g id="edge990" class="edge">
<title>attn_out_0_10&#45;&gt;attn_residual_0_10</title>
<path fill="none" stroke="black" d="M8344,-16400.98C8344,-16400.98 8344,-16338.36 8344,-16338.36"/>
<polygon fill="black" stroke="black" points="8347.5,-16338.36 8344,-16328.36 8340.5,-16338.36 8347.5,-16338.36"/>
</g>
<!-- gate_0_10 -->
<g id="node1002" class="node">
<title>gate_0_10</title>
<ellipse fill="orange" stroke="black" cx="8344" cy="-16163.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="8344" y="-16174.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="8344" y="-16159.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="8344" y="-16144.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_0_10&#45;&gt;gate_0_10 -->
<g id="edge991" class="edge">
<title>attn_residual_0_10&#45;&gt;gate_0_10</title>
<path fill="none" stroke="black" d="M8396.75,-16277.36C8396.75,-16277.36 8396.75,-16206.08 8396.75,-16206.08"/>
<polygon fill="black" stroke="black" points="8400.25,-16206.08 8396.75,-16196.08 8393.25,-16206.08 8400.25,-16206.08"/>
</g>
<!-- gate_0_10&#45;&gt;expert_0_0_0 -->
<g id="edge2809" class="edge">
<title>gate_0_10&#45;&gt;expert_0_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8344,-16201.02C8344,-16228.86 8344,-16262 8344,-16262 8344,-16262 114.1,-16262 114.1,-16262 114.1,-16262 114.1,-16004.15 114.1,-16004.15"/>
<polygon fill="blue" stroke="blue" points="117.6,-16004.15 114.1,-15994.15 110.6,-16004.15 117.6,-16004.15"/>
<text text-anchor="middle" x="35096.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35096.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU10→GPU0</text>
<text text-anchor="middle" x="35096.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35096.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_10&#45;&gt;expert_0_1_0 -->
<g id="edge2810" class="edge">
<title>gate_0_10&#45;&gt;expert_0_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8291.25,-16196.11C8291.25,-16208.19 8291.25,-16219 8291.25,-16219 8291.25,-16219 3170.36,-16219 3170.36,-16219 3170.36,-16219 3170.36,-16004.41 3170.36,-16004.41"/>
<polygon fill="blue" stroke="blue" points="3173.86,-16004.41 3170.36,-15994.41 3166.86,-16004.41 3173.86,-16004.41"/>
<text text-anchor="middle" x="35270.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35270.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU10→GPU1</text>
<text text-anchor="middle" x="35270.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35270.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_10&#45;&gt;expert_0_2_0 -->
<g id="edge2811" class="edge">
<title>gate_0_10&#45;&gt;expert_0_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8248.55,-16147.35C8248.55,-16113.45 8248.55,-16038 8248.55,-16038 8248.55,-16038 3612.83,-16038 3612.83,-16038 3612.83,-16038 3612.83,-16004.15 3612.83,-16004.15"/>
<polygon fill="blue" stroke="blue" points="3616.33,-16004.15 3612.83,-15994.15 3609.33,-16004.15 3616.33,-16004.15"/>
<text text-anchor="middle" x="35444.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35444.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU10→GPU2</text>
<text text-anchor="middle" x="35444.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35444.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_10&#45;&gt;expert_0_3_0 -->
<g id="edge2812" class="edge">
<title>gate_0_10&#45;&gt;expert_0_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8268.64,-16137.14C8268.64,-16101.4 8268.64,-16042 8268.64,-16042 8268.64,-16042 4205.46,-16042 4205.46,-16042 4205.46,-16042 4205.46,-16004.4 4205.46,-16004.4"/>
<polygon fill="blue" stroke="blue" points="4208.96,-16004.4 4205.46,-15994.4 4201.96,-16004.4 4208.96,-16004.4"/>
<text text-anchor="middle" x="35618.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35618.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU10→GPU3</text>
<text text-anchor="middle" x="35618.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35618.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_10&#45;&gt;expert_0_4_0 -->
<g id="edge2813" class="edge">
<title>gate_0_10&#45;&gt;expert_0_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8288.74,-16131.26C8288.74,-16098.02 8288.74,-16051 8288.74,-16051 8288.74,-16051 4806.93,-16051 4806.93,-16051 4806.93,-16051 4806.93,-16004.38 4806.93,-16004.38"/>
<polygon fill="blue" stroke="blue" points="4810.43,-16004.38 4806.93,-15994.38 4803.43,-16004.38 4810.43,-16004.38"/>
<text text-anchor="middle" x="35792.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35792.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU10→GPU4</text>
<text text-anchor="middle" x="35792.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35792.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_10&#45;&gt;expert_0_5_0 -->
<g id="edge2814" class="edge">
<title>gate_0_10&#45;&gt;expert_0_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8308.83,-16128.12C8308.83,-16097.8 8308.83,-16059 8308.83,-16059 8308.83,-16059 5403.98,-16059 5403.98,-16059 5403.98,-16059 5403.98,-16004.46 5403.98,-16004.46"/>
<polygon fill="blue" stroke="blue" points="5407.48,-16004.46 5403.98,-15994.46 5400.48,-16004.46 5407.48,-16004.46"/>
<text text-anchor="middle" x="35966.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35966.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU10→GPU5</text>
<text text-anchor="middle" x="35966.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35966.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_10&#45;&gt;expert_0_6_0 -->
<g id="edge2815" class="edge">
<title>gate_0_10&#45;&gt;expert_0_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8328.93,-16126.31C8328.93,-16102.87 8328.93,-16077 8328.93,-16077 8328.93,-16077 5985.45,-16077 5985.45,-16077 5985.45,-16077 5985.45,-16004.01 5985.45,-16004.01"/>
<polygon fill="blue" stroke="blue" points="5988.95,-16004.01 5985.45,-15994.01 5981.95,-16004.01 5988.95,-16004.01"/>
<text text-anchor="middle" x="36140.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="36140.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU10→GPU6</text>
<text text-anchor="middle" x="36140.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="36140.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_10&#45;&gt;expert_0_7_0 -->
<g id="edge2816" class="edge">
<title>gate_0_10&#45;&gt;expert_0_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8349.02,-16125.61C8349.02,-16104.73 8349.02,-16083 8349.02,-16083 8349.02,-16083 6577.98,-16083 6577.98,-16083 6577.98,-16083 6577.98,-16004.29 6577.98,-16004.29"/>
<polygon fill="blue" stroke="blue" points="6581.48,-16004.29 6577.98,-15994.29 6574.48,-16004.29 6581.48,-16004.29"/>
<text text-anchor="middle" x="36314.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="36314.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU10→GPU7</text>
<text text-anchor="middle" x="36314.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="36314.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_10&#45;&gt;expert_0_8_0 -->
<g id="edge2817" class="edge">
<title>gate_0_10&#45;&gt;expert_0_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8359.07,-16126.07C8359.07,-16120.19 8359.07,-16116 8359.07,-16116 8359.07,-16116 7284.5,-16116 7284.5,-16116 7284.5,-16116 7284.5,-16004.05 7284.5,-16004.05"/>
<polygon fill="blue" stroke="blue" points="7288,-16004.05 7284.5,-15994.05 7281,-16004.05 7288,-16004.05"/>
<text text-anchor="middle" x="36488.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="36488.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU10→GPU8</text>
<text text-anchor="middle" x="36488.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="36488.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_10&#45;&gt;expert_0_9_0 -->
<g id="edge2818" class="edge">
<title>gate_0_10&#45;&gt;expert_0_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8244.3,-16176C8104.46,-16176 7867,-16176 7867,-16176 7867,-16176 7867,-16004.33 7867,-16004.33"/>
<polygon fill="blue" stroke="blue" points="7870.5,-16004.33 7867,-15994.33 7863.5,-16004.33 7870.5,-16004.33"/>
<text text-anchor="middle" x="36662.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="36662.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU10→GPU9</text>
<text text-anchor="middle" x="36662.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="36662.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_10&#45;&gt;expert_0_10_0 -->
<g id="edge992" class="edge">
<title>gate_0_10&#45;&gt;expert_0_10_0</title>
<path fill="none" stroke="black" d="M8369.12,-16126.63C8369.12,-16126.63 8369.12,-16004.14 8369.12,-16004.14"/>
<polygon fill="black" stroke="black" points="8372.62,-16004.14 8369.12,-15994.14 8365.62,-16004.14 8372.62,-16004.14"/>
</g>
<!-- gate_0_10&#45;&gt;expert_0_11_0 -->
<g id="edge2819" class="edge">
<title>gate_0_10&#45;&gt;expert_0_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8443.65,-16151C8583.77,-16151 8822.12,-16151 8822.12,-16151 8822.12,-16151 8822.12,-16004.18 8822.12,-16004.18"/>
<polygon fill="blue" stroke="blue" points="8825.63,-16004.18 8822.12,-15994.18 8818.63,-16004.18 8825.63,-16004.18"/>
<text text-anchor="middle" x="36836.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="36836.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU10→GPU11</text>
<text text-anchor="middle" x="36836.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="36836.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_10&#45;&gt;expert_0_12_0 -->
<g id="edge2820" class="edge">
<title>gate_0_10&#45;&gt;expert_0_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8409.31,-16133.93C8409.31,-16121.56 8409.31,-16110 8409.31,-16110 8409.31,-16110 9405.75,-16110 9405.75,-16110 9405.75,-16110 9405.75,-16004.3 9405.75,-16004.3"/>
<polygon fill="blue" stroke="blue" points="9409.25,-16004.3 9405.75,-15994.3 9402.25,-16004.3 9409.25,-16004.3"/>
<text text-anchor="middle" x="37010.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37010.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU10→GPU12</text>
<text text-anchor="middle" x="37010.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37010.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_10&#45;&gt;expert_0_13_0 -->
<g id="edge2821" class="edge">
<title>gate_0_10&#45;&gt;expert_0_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8419.36,-16137.03C8419.36,-16110.01 8419.36,-16072 8419.36,-16072 8419.36,-16072 9989.38,-16072 9989.38,-16072 9989.38,-16072 9989.38,-16004.14 9989.38,-16004.14"/>
<polygon fill="blue" stroke="blue" points="9992.88,-16004.14 9989.38,-15994.14 9985.88,-16004.14 9992.88,-16004.14"/>
<text text-anchor="middle" x="37184.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37184.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU10→GPU13</text>
<text text-anchor="middle" x="37184.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37184.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_10&#45;&gt;expert_0_14_0 -->
<g id="edge2822" class="edge">
<title>gate_0_10&#45;&gt;expert_0_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8429.4,-16141.48C8429.4,-16111.62 8429.4,-16062 8429.4,-16062 8429.4,-16062 10757.31,-16062 10757.31,-16062 10757.31,-16062 10757.31,-16004.08 10757.31,-16004.08"/>
<polygon fill="blue" stroke="blue" points="10760.81,-16004.07 10757.31,-15994.08 10753.81,-16004.08 10760.81,-16004.07"/>
<text text-anchor="middle" x="37358.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37358.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU10→GPU14</text>
<text text-anchor="middle" x="37358.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37358.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_10&#45;&gt;expert_0_15_0 -->
<g id="edge2823" class="edge">
<title>gate_0_10&#45;&gt;expert_0_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8439.45,-16147.51C8439.45,-16119.39 8439.45,-16064 8439.45,-16064 8439.45,-16064 11328.97,-16064 11328.97,-16064 11328.97,-16064 11328.97,-16004.12 11328.97,-16004.12"/>
<polygon fill="blue" stroke="blue" points="11332.47,-16004.12 11328.97,-15994.12 11325.47,-16004.12 11332.47,-16004.12"/>
<text text-anchor="middle" x="37532.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37532.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU10→GPU15</text>
<text text-anchor="middle" x="37532.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37532.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_10 -->
<g id="node1004" class="node">
<title>expert_reduce_0_10</title>
<ellipse fill="none" stroke="black" cx="8344" cy="-15830.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="8344" y="-15841.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="8344" y="-15826.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="8344" y="-15811.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_10_0&#45;&gt;expert_reduce_0_10 -->
<g id="edge993" class="edge">
<title>expert_0_10_0&#45;&gt;expert_reduce_0_10</title>
<path fill="none" stroke="black" d="M8344,-15940.76C8344,-15940.76 8344,-15878.06 8344,-15878.06"/>
<polygon fill="black" stroke="black" points="8347.5,-15878.06 8344,-15868.06 8340.5,-15878.06 8347.5,-15878.06"/>
</g>
<!-- moe_residual_0_10 -->
<g id="node1005" class="node">
<title>moe_residual_0_10</title>
<ellipse fill="none" stroke="black" cx="8344" cy="-15693" rx="105.5" ry="27"/>
<text text-anchor="middle" x="8344" y="-15696.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="8344" y="-15681.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_10&#45;&gt;moe_residual_0_10 -->
<g id="edge994" class="edge">
<title>expert_reduce_0_10&#45;&gt;moe_residual_0_10</title>
<path fill="none" stroke="black" d="M8344,-15792.93C8344,-15792.93 8344,-15730.06 8344,-15730.06"/>
<polygon fill="black" stroke="black" points="8347.5,-15730.06 8344,-15720.06 8340.5,-15730.06 8347.5,-15730.06"/>
</g>
<!-- qkv_proj_1_10 -->
<g id="node1006" class="node">
<title>qkv_proj_1_10</title>
<polygon fill="none" stroke="black" points="8426.5,-15593 8261.5,-15593 8261.5,-15540 8426.5,-15540 8426.5,-15593"/>
<text text-anchor="middle" x="8344" y="-15577.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="8344" y="-15562.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="8344" y="-15547.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_0_10&#45;&gt;qkv_proj_1_10 -->
<g id="edge995" class="edge">
<title>moe_residual_0_10&#45;&gt;qkv_proj_1_10</title>
<path fill="none" stroke="black" d="M8344,-15665.86C8344,-15665.86 8344,-15603.16 8344,-15603.16"/>
<polygon fill="black" stroke="black" points="8347.5,-15603.16 8344,-15593.16 8340.5,-15603.16 8347.5,-15603.16"/>
</g>
<!-- qkv_reshape_1_10 -->
<g id="node1007" class="node">
<title>qkv_reshape_1_10</title>
<ellipse fill="none" stroke="black" cx="8344" cy="-15440" rx="148" ry="27"/>
<text text-anchor="middle" x="8344" y="-15443.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="8344" y="-15428.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_1_10&#45;&gt;qkv_reshape_1_10 -->
<g id="edge996" class="edge">
<title>qkv_proj_1_10&#45;&gt;qkv_reshape_1_10</title>
<path fill="none" stroke="black" d="M8344,-15539.98C8344,-15539.98 8344,-15477.36 8344,-15477.36"/>
<polygon fill="black" stroke="black" points="8347.5,-15477.36 8344,-15467.36 8340.5,-15477.36 8347.5,-15477.36"/>
</g>
<!-- qkv_reshape_1_10&#45;&gt;ring_attn_1_10_stage_0 -->
<g id="edge997" class="edge">
<title>qkv_reshape_1_10&#45;&gt;ring_attn_1_10_stage_0</title>
<path fill="none" stroke="black" d="M8344,-15412.72C8344,-15412.72 8344,-15306.16 8344,-15306.16"/>
<polygon fill="black" stroke="black" points="8347.5,-15306.16 8344,-15296.16 8340.5,-15306.16 8347.5,-15306.16"/>
</g>
<!-- ring_attn_1_10_stage_0&#45;&gt;ring_attn_1_10_stage_1 -->
<g id="edge998" class="edge">
<title>ring_attn_1_10_stage_0&#45;&gt;ring_attn_1_10_stage_1</title>
<path fill="none" stroke="black" d="M8344,-15159.87C8344,-15159.87 8344,-15053.25 8344,-15053.25"/>
<polygon fill="black" stroke="black" points="8347.5,-15053.25 8344,-15043.25 8340.5,-15053.25 8347.5,-15053.25"/>
</g>
<!-- ring_attn_1_11_stage_0 -->
<g id="node1106" class="node">
<title>ring_attn_1_11_stage_0</title>
<polygon fill="yellow" stroke="black" points="8931,-15296 8722,-15228 8931,-15160 9140,-15228 8931,-15296"/>
<text text-anchor="middle" x="8931" y="-15246.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-15231.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="8931" y="-15216.8" font-family="Times,serif" font-size="14.00">Q[11]×K[11]×V[11]</text>
<text text-anchor="middle" x="8931" y="-15201.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_10_stage_0&#45;&gt;ring_attn_1_11_stage_0 -->
<g id="edge2824" class="edge">
<title>ring_attn_1_10_stage_0&#45;&gt;ring_attn_1_11_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-15228C8553.02,-15228 8711.86,-15228 8711.86,-15228"/>
<polygon fill="red" stroke="red" points="8711.86,-15231.5 8721.86,-15228 8711.86,-15224.5 8711.86,-15231.5"/>
</g>
<!-- ring_attn_1_10_stage_1&#45;&gt;ring_attn_1_10_stage_2 -->
<g id="edge999" class="edge">
<title>ring_attn_1_10_stage_1&#45;&gt;ring_attn_1_10_stage_2</title>
<path fill="none" stroke="black" d="M8344,-14906.87C8344,-14906.87 8344,-14800.25 8344,-14800.25"/>
<polygon fill="black" stroke="black" points="8347.5,-14800.25 8344,-14790.25 8340.5,-14800.25 8347.5,-14800.25"/>
</g>
<!-- ring_attn_1_11_stage_1 -->
<g id="node1107" class="node">
<title>ring_attn_1_11_stage_1</title>
<polygon fill="yellow" stroke="black" points="8931,-15043 8722,-14975 8931,-14907 9140,-14975 8931,-15043"/>
<text text-anchor="middle" x="8931" y="-14993.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-14978.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="8931" y="-14963.8" font-family="Times,serif" font-size="14.00">Q[11]×K[10]×V[10]</text>
<text text-anchor="middle" x="8931" y="-14948.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_10_stage_1&#45;&gt;ring_attn_1_11_stage_1 -->
<g id="edge2825" class="edge">
<title>ring_attn_1_10_stage_1&#45;&gt;ring_attn_1_11_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-14975C8553.02,-14975 8711.86,-14975 8711.86,-14975"/>
<polygon fill="red" stroke="red" points="8711.86,-14978.5 8721.86,-14975 8711.86,-14971.5 8711.86,-14978.5"/>
</g>
<!-- ring_attn_1_10_stage_2&#45;&gt;ring_attn_1_10_stage_3 -->
<g id="edge1000" class="edge">
<title>ring_attn_1_10_stage_2&#45;&gt;ring_attn_1_10_stage_3</title>
<path fill="none" stroke="black" d="M8344,-14653.87C8344,-14653.87 8344,-14547.25 8344,-14547.25"/>
<polygon fill="black" stroke="black" points="8347.5,-14547.25 8344,-14537.25 8340.5,-14547.25 8347.5,-14547.25"/>
</g>
<!-- ring_attn_1_11_stage_2 -->
<g id="node1108" class="node">
<title>ring_attn_1_11_stage_2</title>
<polygon fill="yellow" stroke="black" points="8931,-14790 8722,-14722 8931,-14654 9140,-14722 8931,-14790"/>
<text text-anchor="middle" x="8931" y="-14740.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-14725.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="8931" y="-14710.8" font-family="Times,serif" font-size="14.00">Q[11]×K[9]×V[9]</text>
<text text-anchor="middle" x="8931" y="-14695.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_10_stage_2&#45;&gt;ring_attn_1_11_stage_2 -->
<g id="edge2826" class="edge">
<title>ring_attn_1_10_stage_2&#45;&gt;ring_attn_1_11_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-14722C8553.02,-14722 8711.86,-14722 8711.86,-14722"/>
<polygon fill="red" stroke="red" points="8711.86,-14725.5 8721.86,-14722 8711.86,-14718.5 8711.86,-14725.5"/>
</g>
<!-- ring_attn_1_10_stage_3&#45;&gt;ring_attn_1_10_stage_4 -->
<g id="edge1001" class="edge">
<title>ring_attn_1_10_stage_3&#45;&gt;ring_attn_1_10_stage_4</title>
<path fill="none" stroke="black" d="M8344,-14400.87C8344,-14400.87 8344,-14294.25 8344,-14294.25"/>
<polygon fill="black" stroke="black" points="8347.5,-14294.25 8344,-14284.25 8340.5,-14294.25 8347.5,-14294.25"/>
</g>
<!-- ring_attn_1_11_stage_3 -->
<g id="node1109" class="node">
<title>ring_attn_1_11_stage_3</title>
<polygon fill="yellow" stroke="black" points="8931,-14537 8722,-14469 8931,-14401 9140,-14469 8931,-14537"/>
<text text-anchor="middle" x="8931" y="-14487.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-14472.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="8931" y="-14457.8" font-family="Times,serif" font-size="14.00">Q[11]×K[8]×V[8]</text>
<text text-anchor="middle" x="8931" y="-14442.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_10_stage_3&#45;&gt;ring_attn_1_11_stage_3 -->
<g id="edge2827" class="edge">
<title>ring_attn_1_10_stage_3&#45;&gt;ring_attn_1_11_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-14469C8553.02,-14469 8711.86,-14469 8711.86,-14469"/>
<polygon fill="red" stroke="red" points="8711.86,-14472.5 8721.86,-14469 8711.86,-14465.5 8711.86,-14472.5"/>
</g>
<!-- ring_attn_1_10_stage_4&#45;&gt;ring_attn_1_10_stage_5 -->
<g id="edge1002" class="edge">
<title>ring_attn_1_10_stage_4&#45;&gt;ring_attn_1_10_stage_5</title>
<path fill="none" stroke="black" d="M8344,-14147.87C8344,-14147.87 8344,-14041.25 8344,-14041.25"/>
<polygon fill="black" stroke="black" points="8347.5,-14041.25 8344,-14031.25 8340.5,-14041.25 8347.5,-14041.25"/>
</g>
<!-- ring_attn_1_11_stage_4 -->
<g id="node1110" class="node">
<title>ring_attn_1_11_stage_4</title>
<polygon fill="yellow" stroke="black" points="8931,-14284 8722,-14216 8931,-14148 9140,-14216 8931,-14284"/>
<text text-anchor="middle" x="8931" y="-14234.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-14219.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="8931" y="-14204.8" font-family="Times,serif" font-size="14.00">Q[11]×K[7]×V[7]</text>
<text text-anchor="middle" x="8931" y="-14189.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_10_stage_4&#45;&gt;ring_attn_1_11_stage_4 -->
<g id="edge2828" class="edge">
<title>ring_attn_1_10_stage_4&#45;&gt;ring_attn_1_11_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-14216C8553.02,-14216 8711.86,-14216 8711.86,-14216"/>
<polygon fill="red" stroke="red" points="8711.86,-14219.5 8721.86,-14216 8711.86,-14212.5 8711.86,-14219.5"/>
</g>
<!-- ring_attn_1_10_stage_5&#45;&gt;ring_attn_1_10_stage_6 -->
<g id="edge1003" class="edge">
<title>ring_attn_1_10_stage_5&#45;&gt;ring_attn_1_10_stage_6</title>
<path fill="none" stroke="black" d="M8344,-13894.87C8344,-13894.87 8344,-13788.25 8344,-13788.25"/>
<polygon fill="black" stroke="black" points="8347.5,-13788.25 8344,-13778.25 8340.5,-13788.25 8347.5,-13788.25"/>
</g>
<!-- ring_attn_1_11_stage_5 -->
<g id="node1111" class="node">
<title>ring_attn_1_11_stage_5</title>
<polygon fill="yellow" stroke="black" points="8931,-14031 8722,-13963 8931,-13895 9140,-13963 8931,-14031"/>
<text text-anchor="middle" x="8931" y="-13981.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-13966.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="8931" y="-13951.8" font-family="Times,serif" font-size="14.00">Q[11]×K[6]×V[6]</text>
<text text-anchor="middle" x="8931" y="-13936.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_10_stage_5&#45;&gt;ring_attn_1_11_stage_5 -->
<g id="edge2829" class="edge">
<title>ring_attn_1_10_stage_5&#45;&gt;ring_attn_1_11_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-13963C8553.02,-13963 8711.86,-13963 8711.86,-13963"/>
<polygon fill="red" stroke="red" points="8711.86,-13966.5 8721.86,-13963 8711.86,-13959.5 8711.86,-13966.5"/>
</g>
<!-- ring_attn_1_10_stage_6&#45;&gt;ring_attn_1_10_stage_7 -->
<g id="edge1004" class="edge">
<title>ring_attn_1_10_stage_6&#45;&gt;ring_attn_1_10_stage_7</title>
<path fill="none" stroke="black" d="M8344,-13641.87C8344,-13641.87 8344,-13535.25 8344,-13535.25"/>
<polygon fill="black" stroke="black" points="8347.5,-13535.25 8344,-13525.25 8340.5,-13535.25 8347.5,-13535.25"/>
</g>
<!-- ring_attn_1_11_stage_6 -->
<g id="node1112" class="node">
<title>ring_attn_1_11_stage_6</title>
<polygon fill="yellow" stroke="black" points="8931,-13778 8722,-13710 8931,-13642 9140,-13710 8931,-13778"/>
<text text-anchor="middle" x="8931" y="-13728.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-13713.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="8931" y="-13698.8" font-family="Times,serif" font-size="14.00">Q[11]×K[5]×V[5]</text>
<text text-anchor="middle" x="8931" y="-13683.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_10_stage_6&#45;&gt;ring_attn_1_11_stage_6 -->
<g id="edge2830" class="edge">
<title>ring_attn_1_10_stage_6&#45;&gt;ring_attn_1_11_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-13710C8553.02,-13710 8711.86,-13710 8711.86,-13710"/>
<polygon fill="red" stroke="red" points="8711.86,-13713.5 8721.86,-13710 8711.86,-13706.5 8711.86,-13713.5"/>
</g>
<!-- ring_attn_1_10_stage_7&#45;&gt;ring_attn_1_10_stage_8 -->
<g id="edge1005" class="edge">
<title>ring_attn_1_10_stage_7&#45;&gt;ring_attn_1_10_stage_8</title>
<path fill="none" stroke="black" d="M8344,-13388.87C8344,-13388.87 8344,-13282.25 8344,-13282.25"/>
<polygon fill="black" stroke="black" points="8347.5,-13282.25 8344,-13272.25 8340.5,-13282.25 8347.5,-13282.25"/>
</g>
<!-- ring_attn_1_11_stage_7 -->
<g id="node1113" class="node">
<title>ring_attn_1_11_stage_7</title>
<polygon fill="yellow" stroke="black" points="8931,-13525 8722,-13457 8931,-13389 9140,-13457 8931,-13525"/>
<text text-anchor="middle" x="8931" y="-13475.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-13460.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="8931" y="-13445.8" font-family="Times,serif" font-size="14.00">Q[11]×K[4]×V[4]</text>
<text text-anchor="middle" x="8931" y="-13430.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_10_stage_7&#45;&gt;ring_attn_1_11_stage_7 -->
<g id="edge2831" class="edge">
<title>ring_attn_1_10_stage_7&#45;&gt;ring_attn_1_11_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-13457C8553.02,-13457 8711.86,-13457 8711.86,-13457"/>
<polygon fill="red" stroke="red" points="8711.86,-13460.5 8721.86,-13457 8711.86,-13453.5 8711.86,-13460.5"/>
</g>
<!-- ring_attn_1_10_stage_8&#45;&gt;ring_attn_1_10_stage_9 -->
<g id="edge1006" class="edge">
<title>ring_attn_1_10_stage_8&#45;&gt;ring_attn_1_10_stage_9</title>
<path fill="none" stroke="black" d="M8344,-13135.87C8344,-13135.87 8344,-13029.25 8344,-13029.25"/>
<polygon fill="black" stroke="black" points="8347.5,-13029.25 8344,-13019.25 8340.5,-13029.25 8347.5,-13029.25"/>
</g>
<!-- ring_attn_1_11_stage_8 -->
<g id="node1114" class="node">
<title>ring_attn_1_11_stage_8</title>
<polygon fill="yellow" stroke="black" points="8931,-13272 8722,-13204 8931,-13136 9140,-13204 8931,-13272"/>
<text text-anchor="middle" x="8931" y="-13222.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-13207.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="8931" y="-13192.8" font-family="Times,serif" font-size="14.00">Q[11]×K[3]×V[3]</text>
<text text-anchor="middle" x="8931" y="-13177.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_10_stage_8&#45;&gt;ring_attn_1_11_stage_8 -->
<g id="edge2832" class="edge">
<title>ring_attn_1_10_stage_8&#45;&gt;ring_attn_1_11_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-13204C8553.02,-13204 8711.86,-13204 8711.86,-13204"/>
<polygon fill="red" stroke="red" points="8711.86,-13207.5 8721.86,-13204 8711.86,-13200.5 8711.86,-13207.5"/>
</g>
<!-- ring_attn_1_10_stage_9&#45;&gt;ring_attn_1_10_stage_10 -->
<g id="edge1007" class="edge">
<title>ring_attn_1_10_stage_9&#45;&gt;ring_attn_1_10_stage_10</title>
<path fill="none" stroke="black" d="M8344,-12882.87C8344,-12882.87 8344,-12776.25 8344,-12776.25"/>
<polygon fill="black" stroke="black" points="8347.5,-12776.25 8344,-12766.25 8340.5,-12776.25 8347.5,-12776.25"/>
</g>
<!-- ring_attn_1_11_stage_9 -->
<g id="node1115" class="node">
<title>ring_attn_1_11_stage_9</title>
<polygon fill="yellow" stroke="black" points="8931,-13019 8722,-12951 8931,-12883 9140,-12951 8931,-13019"/>
<text text-anchor="middle" x="8931" y="-12969.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-12954.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="8931" y="-12939.8" font-family="Times,serif" font-size="14.00">Q[11]×K[2]×V[2]</text>
<text text-anchor="middle" x="8931" y="-12924.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_10_stage_9&#45;&gt;ring_attn_1_11_stage_9 -->
<g id="edge2833" class="edge">
<title>ring_attn_1_10_stage_9&#45;&gt;ring_attn_1_11_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-12951C8553.02,-12951 8711.86,-12951 8711.86,-12951"/>
<polygon fill="red" stroke="red" points="8711.86,-12954.5 8721.86,-12951 8711.86,-12947.5 8711.86,-12954.5"/>
</g>
<!-- ring_attn_1_10_stage_10&#45;&gt;ring_attn_1_10_stage_11 -->
<g id="edge1008" class="edge">
<title>ring_attn_1_10_stage_10&#45;&gt;ring_attn_1_10_stage_11</title>
<path fill="none" stroke="black" d="M8344,-12629.87C8344,-12629.87 8344,-12523.25 8344,-12523.25"/>
<polygon fill="black" stroke="black" points="8347.5,-12523.25 8344,-12513.25 8340.5,-12523.25 8347.5,-12523.25"/>
</g>
<!-- ring_attn_1_11_stage_10 -->
<g id="node1116" class="node">
<title>ring_attn_1_11_stage_10</title>
<polygon fill="yellow" stroke="black" points="8931,-12766 8722,-12698 8931,-12630 9140,-12698 8931,-12766"/>
<text text-anchor="middle" x="8931" y="-12716.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-12701.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="8931" y="-12686.8" font-family="Times,serif" font-size="14.00">Q[11]×K[1]×V[1]</text>
<text text-anchor="middle" x="8931" y="-12671.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_10_stage_10&#45;&gt;ring_attn_1_11_stage_10 -->
<g id="edge2834" class="edge">
<title>ring_attn_1_10_stage_10&#45;&gt;ring_attn_1_11_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-12698C8553.02,-12698 8711.86,-12698 8711.86,-12698"/>
<polygon fill="red" stroke="red" points="8711.86,-12701.5 8721.86,-12698 8711.86,-12694.5 8711.86,-12701.5"/>
</g>
<!-- ring_attn_1_10_stage_11&#45;&gt;ring_attn_1_10_stage_12 -->
<g id="edge1009" class="edge">
<title>ring_attn_1_10_stage_11&#45;&gt;ring_attn_1_10_stage_12</title>
<path fill="none" stroke="black" d="M8344,-12376.87C8344,-12376.87 8344,-12270.25 8344,-12270.25"/>
<polygon fill="black" stroke="black" points="8347.5,-12270.25 8344,-12260.25 8340.5,-12270.25 8347.5,-12270.25"/>
</g>
<!-- ring_attn_1_11_stage_11 -->
<g id="node1117" class="node">
<title>ring_attn_1_11_stage_11</title>
<polygon fill="yellow" stroke="black" points="8931,-12513 8722,-12445 8931,-12377 9140,-12445 8931,-12513"/>
<text text-anchor="middle" x="8931" y="-12463.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-12448.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="8931" y="-12433.8" font-family="Times,serif" font-size="14.00">Q[11]×K[0]×V[0]</text>
<text text-anchor="middle" x="8931" y="-12418.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_10_stage_11&#45;&gt;ring_attn_1_11_stage_11 -->
<g id="edge2835" class="edge">
<title>ring_attn_1_10_stage_11&#45;&gt;ring_attn_1_11_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-12445C8553.02,-12445 8711.86,-12445 8711.86,-12445"/>
<polygon fill="red" stroke="red" points="8711.86,-12448.5 8721.86,-12445 8711.86,-12441.5 8711.86,-12448.5"/>
</g>
<!-- ring_attn_1_10_stage_12&#45;&gt;ring_attn_1_10_stage_13 -->
<g id="edge1010" class="edge">
<title>ring_attn_1_10_stage_12&#45;&gt;ring_attn_1_10_stage_13</title>
<path fill="none" stroke="black" d="M8344,-12123.87C8344,-12123.87 8344,-12017.25 8344,-12017.25"/>
<polygon fill="black" stroke="black" points="8347.5,-12017.25 8344,-12007.25 8340.5,-12017.25 8347.5,-12017.25"/>
</g>
<!-- ring_attn_1_11_stage_12 -->
<g id="node1118" class="node">
<title>ring_attn_1_11_stage_12</title>
<polygon fill="yellow" stroke="black" points="8931,-12260 8722,-12192 8931,-12124 9140,-12192 8931,-12260"/>
<text text-anchor="middle" x="8931" y="-12210.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-12195.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="8931" y="-12180.8" font-family="Times,serif" font-size="14.00">Q[11]×K[15]×V[15]</text>
<text text-anchor="middle" x="8931" y="-12165.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_10_stage_12&#45;&gt;ring_attn_1_11_stage_12 -->
<g id="edge2836" class="edge">
<title>ring_attn_1_10_stage_12&#45;&gt;ring_attn_1_11_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-12192C8553.02,-12192 8711.86,-12192 8711.86,-12192"/>
<polygon fill="red" stroke="red" points="8711.86,-12195.5 8721.86,-12192 8711.86,-12188.5 8711.86,-12195.5"/>
</g>
<!-- ring_attn_1_10_stage_13&#45;&gt;ring_attn_1_10_stage_14 -->
<g id="edge1011" class="edge">
<title>ring_attn_1_10_stage_13&#45;&gt;ring_attn_1_10_stage_14</title>
<path fill="none" stroke="black" d="M8344,-11870.87C8344,-11870.87 8344,-11764.25 8344,-11764.25"/>
<polygon fill="black" stroke="black" points="8347.5,-11764.25 8344,-11754.25 8340.5,-11764.25 8347.5,-11764.25"/>
</g>
<!-- ring_attn_1_11_stage_13 -->
<g id="node1119" class="node">
<title>ring_attn_1_11_stage_13</title>
<polygon fill="yellow" stroke="black" points="8931,-12007 8722,-11939 8931,-11871 9140,-11939 8931,-12007"/>
<text text-anchor="middle" x="8931" y="-11957.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-11942.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="8931" y="-11927.8" font-family="Times,serif" font-size="14.00">Q[11]×K[14]×V[14]</text>
<text text-anchor="middle" x="8931" y="-11912.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_10_stage_13&#45;&gt;ring_attn_1_11_stage_13 -->
<g id="edge2837" class="edge">
<title>ring_attn_1_10_stage_13&#45;&gt;ring_attn_1_11_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-11939C8553.02,-11939 8711.86,-11939 8711.86,-11939"/>
<polygon fill="red" stroke="red" points="8711.86,-11942.5 8721.86,-11939 8711.86,-11935.5 8711.86,-11942.5"/>
</g>
<!-- ring_attn_1_10_stage_14&#45;&gt;ring_attn_1_10_stage_15 -->
<g id="edge1012" class="edge">
<title>ring_attn_1_10_stage_14&#45;&gt;ring_attn_1_10_stage_15</title>
<path fill="none" stroke="black" d="M8344,-11617.87C8344,-11617.87 8344,-11511.25 8344,-11511.25"/>
<polygon fill="black" stroke="black" points="8347.5,-11511.25 8344,-11501.25 8340.5,-11511.25 8347.5,-11511.25"/>
</g>
<!-- ring_attn_1_11_stage_14 -->
<g id="node1120" class="node">
<title>ring_attn_1_11_stage_14</title>
<polygon fill="yellow" stroke="black" points="8931,-11754 8722,-11686 8931,-11618 9140,-11686 8931,-11754"/>
<text text-anchor="middle" x="8931" y="-11704.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-11689.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="8931" y="-11674.8" font-family="Times,serif" font-size="14.00">Q[11]×K[13]×V[13]</text>
<text text-anchor="middle" x="8931" y="-11659.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_10_stage_14&#45;&gt;ring_attn_1_11_stage_14 -->
<g id="edge2838" class="edge">
<title>ring_attn_1_10_stage_14&#45;&gt;ring_attn_1_11_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-11686C8553.02,-11686 8711.86,-11686 8711.86,-11686"/>
<polygon fill="red" stroke="red" points="8711.86,-11689.5 8721.86,-11686 8711.86,-11682.5 8711.86,-11689.5"/>
</g>
<!-- attn_out_1_10 -->
<g id="node1024" class="node">
<title>attn_out_1_10</title>
<polygon fill="none" stroke="black" points="8413.5,-11292 8274.5,-11292 8274.5,-11239 8413.5,-11239 8413.5,-11292"/>
<text text-anchor="middle" x="8344" y="-11276.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="8344" y="-11261.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="8344" y="-11246.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_1_10_stage_15&#45;&gt;attn_out_1_10 -->
<g id="edge1013" class="edge">
<title>ring_attn_1_10_stage_15&#45;&gt;attn_out_1_10</title>
<path fill="none" stroke="black" d="M8344,-11364.87C8344,-11364.87 8344,-11302.18 8344,-11302.18"/>
<polygon fill="black" stroke="black" points="8347.5,-11302.18 8344,-11292.18 8340.5,-11302.18 8347.5,-11302.18"/>
</g>
<!-- ring_attn_1_11_stage_15 -->
<g id="node1121" class="node">
<title>ring_attn_1_11_stage_15</title>
<polygon fill="yellow" stroke="black" points="8931,-11501 8722,-11433 8931,-11365 9140,-11433 8931,-11501"/>
<text text-anchor="middle" x="8931" y="-11451.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-11436.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="8931" y="-11421.8" font-family="Times,serif" font-size="14.00">Q[11]×K[12]×V[12]</text>
<text text-anchor="middle" x="8931" y="-11406.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_10_stage_15&#45;&gt;ring_attn_1_11_stage_15 -->
<g id="edge2839" class="edge">
<title>ring_attn_1_10_stage_15&#45;&gt;ring_attn_1_11_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-11433C8553.02,-11433 8711.86,-11433 8711.86,-11433"/>
<polygon fill="red" stroke="red" points="8711.86,-11436.5 8721.86,-11433 8711.86,-11429.5 8711.86,-11436.5"/>
</g>
<!-- attn_residual_1_10 -->
<g id="node1025" class="node">
<title>attn_residual_1_10</title>
<ellipse fill="none" stroke="black" cx="8344" cy="-11139" rx="105.5" ry="27"/>
<text text-anchor="middle" x="8344" y="-11142.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="8344" y="-11127.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_1_10&#45;&gt;attn_residual_1_10 -->
<g id="edge1014" class="edge">
<title>attn_out_1_10&#45;&gt;attn_residual_1_10</title>
<path fill="none" stroke="black" d="M8344,-11238.98C8344,-11238.98 8344,-11176.36 8344,-11176.36"/>
<polygon fill="black" stroke="black" points="8347.5,-11176.36 8344,-11166.36 8340.5,-11176.36 8347.5,-11176.36"/>
</g>
<!-- gate_1_10 -->
<g id="node1026" class="node">
<title>gate_1_10</title>
<ellipse fill="orange" stroke="black" cx="8344" cy="-11001.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="8344" y="-11012.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="8344" y="-10997.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="8344" y="-10982.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_1_10&#45;&gt;gate_1_10 -->
<g id="edge1015" class="edge">
<title>attn_residual_1_10&#45;&gt;gate_1_10</title>
<path fill="none" stroke="black" d="M8396.75,-11115.36C8396.75,-11115.36 8396.75,-11044.08 8396.75,-11044.08"/>
<polygon fill="black" stroke="black" points="8400.25,-11044.08 8396.75,-11034.08 8393.25,-11044.08 8400.25,-11044.08"/>
</g>
<!-- gate_1_10&#45;&gt;expert_1_0_0 -->
<g id="edge2840" class="edge">
<title>gate_1_10&#45;&gt;expert_1_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8344,-11039.02C8344,-11066.86 8344,-11100 8344,-11100 8344,-11100 114.1,-11100 114.1,-11100 114.1,-11100 114.1,-10842.15 114.1,-10842.15"/>
<polygon fill="blue" stroke="blue" points="117.6,-10842.15 114.1,-10832.15 110.6,-10842.15 117.6,-10842.15"/>
<text text-anchor="middle" x="35096.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35096.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU10→GPU0</text>
<text text-anchor="middle" x="35096.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35096.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_10&#45;&gt;expert_1_1_0 -->
<g id="edge2841" class="edge">
<title>gate_1_10&#45;&gt;expert_1_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8291.25,-11034.11C8291.25,-11046.19 8291.25,-11057 8291.25,-11057 8291.25,-11057 3170.36,-11057 3170.36,-11057 3170.36,-11057 3170.36,-10842.41 3170.36,-10842.41"/>
<polygon fill="blue" stroke="blue" points="3173.86,-10842.41 3170.36,-10832.41 3166.86,-10842.41 3173.86,-10842.41"/>
<text text-anchor="middle" x="35270.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35270.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU10→GPU1</text>
<text text-anchor="middle" x="35270.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35270.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_10&#45;&gt;expert_1_2_0 -->
<g id="edge2842" class="edge">
<title>gate_1_10&#45;&gt;expert_1_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8248.55,-10985.35C8248.55,-10951.45 8248.55,-10876 8248.55,-10876 8248.55,-10876 3612.83,-10876 3612.83,-10876 3612.83,-10876 3612.83,-10842.15 3612.83,-10842.15"/>
<polygon fill="blue" stroke="blue" points="3616.33,-10842.15 3612.83,-10832.15 3609.33,-10842.15 3616.33,-10842.15"/>
<text text-anchor="middle" x="35444.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35444.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU10→GPU2</text>
<text text-anchor="middle" x="35444.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35444.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_10&#45;&gt;expert_1_3_0 -->
<g id="edge2843" class="edge">
<title>gate_1_10&#45;&gt;expert_1_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8268.64,-10975.14C8268.64,-10939.4 8268.64,-10880 8268.64,-10880 8268.64,-10880 4205.46,-10880 4205.46,-10880 4205.46,-10880 4205.46,-10842.4 4205.46,-10842.4"/>
<polygon fill="blue" stroke="blue" points="4208.96,-10842.4 4205.46,-10832.4 4201.96,-10842.4 4208.96,-10842.4"/>
<text text-anchor="middle" x="35618.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35618.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU10→GPU3</text>
<text text-anchor="middle" x="35618.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35618.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_10&#45;&gt;expert_1_4_0 -->
<g id="edge2844" class="edge">
<title>gate_1_10&#45;&gt;expert_1_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8288.74,-10969.26C8288.74,-10936.02 8288.74,-10889 8288.74,-10889 8288.74,-10889 4806.93,-10889 4806.93,-10889 4806.93,-10889 4806.93,-10842.38 4806.93,-10842.38"/>
<polygon fill="blue" stroke="blue" points="4810.43,-10842.38 4806.93,-10832.38 4803.43,-10842.38 4810.43,-10842.38"/>
<text text-anchor="middle" x="35792.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35792.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU10→GPU4</text>
<text text-anchor="middle" x="35792.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35792.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_10&#45;&gt;expert_1_5_0 -->
<g id="edge2845" class="edge">
<title>gate_1_10&#45;&gt;expert_1_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8308.83,-10966.12C8308.83,-10935.8 8308.83,-10897 8308.83,-10897 8308.83,-10897 5403.98,-10897 5403.98,-10897 5403.98,-10897 5403.98,-10842.46 5403.98,-10842.46"/>
<polygon fill="blue" stroke="blue" points="5407.48,-10842.46 5403.98,-10832.46 5400.48,-10842.46 5407.48,-10842.46"/>
<text text-anchor="middle" x="35966.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35966.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU10→GPU5</text>
<text text-anchor="middle" x="35966.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35966.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_10&#45;&gt;expert_1_6_0 -->
<g id="edge2846" class="edge">
<title>gate_1_10&#45;&gt;expert_1_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8328.93,-10964.31C8328.93,-10940.87 8328.93,-10915 8328.93,-10915 8328.93,-10915 5985.45,-10915 5985.45,-10915 5985.45,-10915 5985.45,-10842.01 5985.45,-10842.01"/>
<polygon fill="blue" stroke="blue" points="5988.95,-10842.01 5985.45,-10832.01 5981.95,-10842.01 5988.95,-10842.01"/>
<text text-anchor="middle" x="36140.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="36140.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU10→GPU6</text>
<text text-anchor="middle" x="36140.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="36140.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_10&#45;&gt;expert_1_7_0 -->
<g id="edge2847" class="edge">
<title>gate_1_10&#45;&gt;expert_1_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8349.02,-10963.61C8349.02,-10942.73 8349.02,-10921 8349.02,-10921 8349.02,-10921 6577.98,-10921 6577.98,-10921 6577.98,-10921 6577.98,-10842.29 6577.98,-10842.29"/>
<polygon fill="blue" stroke="blue" points="6581.48,-10842.29 6577.98,-10832.29 6574.48,-10842.29 6581.48,-10842.29"/>
<text text-anchor="middle" x="36314.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="36314.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU10→GPU7</text>
<text text-anchor="middle" x="36314.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="36314.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_10&#45;&gt;expert_1_8_0 -->
<g id="edge2848" class="edge">
<title>gate_1_10&#45;&gt;expert_1_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8359.07,-10964.07C8359.07,-10958.19 8359.07,-10954 8359.07,-10954 8359.07,-10954 7284.5,-10954 7284.5,-10954 7284.5,-10954 7284.5,-10842.05 7284.5,-10842.05"/>
<polygon fill="blue" stroke="blue" points="7288,-10842.05 7284.5,-10832.05 7281,-10842.05 7288,-10842.05"/>
<text text-anchor="middle" x="36488.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="36488.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU10→GPU8</text>
<text text-anchor="middle" x="36488.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="36488.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_10&#45;&gt;expert_1_9_0 -->
<g id="edge2849" class="edge">
<title>gate_1_10&#45;&gt;expert_1_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8244.3,-11014C8104.46,-11014 7867,-11014 7867,-11014 7867,-11014 7867,-10842.33 7867,-10842.33"/>
<polygon fill="blue" stroke="blue" points="7870.5,-10842.33 7867,-10832.33 7863.5,-10842.33 7870.5,-10842.33"/>
<text text-anchor="middle" x="36662.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="36662.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU10→GPU9</text>
<text text-anchor="middle" x="36662.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="36662.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_10&#45;&gt;expert_1_10_0 -->
<g id="edge1016" class="edge">
<title>gate_1_10&#45;&gt;expert_1_10_0</title>
<path fill="none" stroke="black" d="M8369.12,-10964.63C8369.12,-10964.63 8369.12,-10842.14 8369.12,-10842.14"/>
<polygon fill="black" stroke="black" points="8372.62,-10842.14 8369.12,-10832.14 8365.62,-10842.14 8372.62,-10842.14"/>
</g>
<!-- gate_1_10&#45;&gt;expert_1_11_0 -->
<g id="edge2850" class="edge">
<title>gate_1_10&#45;&gt;expert_1_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8443.65,-10989C8583.77,-10989 8822.12,-10989 8822.12,-10989 8822.12,-10989 8822.12,-10842.18 8822.12,-10842.18"/>
<polygon fill="blue" stroke="blue" points="8825.63,-10842.18 8822.12,-10832.18 8818.63,-10842.18 8825.63,-10842.18"/>
<text text-anchor="middle" x="36836.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="36836.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU10→GPU11</text>
<text text-anchor="middle" x="36836.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="36836.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_10&#45;&gt;expert_1_12_0 -->
<g id="edge2851" class="edge">
<title>gate_1_10&#45;&gt;expert_1_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8409.31,-10971.93C8409.31,-10959.56 8409.31,-10948 8409.31,-10948 8409.31,-10948 9405.75,-10948 9405.75,-10948 9405.75,-10948 9405.75,-10842.3 9405.75,-10842.3"/>
<polygon fill="blue" stroke="blue" points="9409.25,-10842.3 9405.75,-10832.3 9402.25,-10842.3 9409.25,-10842.3"/>
<text text-anchor="middle" x="37010.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37010.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU10→GPU12</text>
<text text-anchor="middle" x="37010.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37010.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_10&#45;&gt;expert_1_13_0 -->
<g id="edge2852" class="edge">
<title>gate_1_10&#45;&gt;expert_1_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8419.36,-10975.03C8419.36,-10948.01 8419.36,-10910 8419.36,-10910 8419.36,-10910 9989.38,-10910 9989.38,-10910 9989.38,-10910 9989.38,-10842.14 9989.38,-10842.14"/>
<polygon fill="blue" stroke="blue" points="9992.88,-10842.14 9989.38,-10832.14 9985.88,-10842.14 9992.88,-10842.14"/>
<text text-anchor="middle" x="37184.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37184.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU10→GPU13</text>
<text text-anchor="middle" x="37184.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37184.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_10&#45;&gt;expert_1_14_0 -->
<g id="edge2853" class="edge">
<title>gate_1_10&#45;&gt;expert_1_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8429.4,-10979.48C8429.4,-10949.62 8429.4,-10900 8429.4,-10900 8429.4,-10900 10757.31,-10900 10757.31,-10900 10757.31,-10900 10757.31,-10842.08 10757.31,-10842.08"/>
<polygon fill="blue" stroke="blue" points="10760.81,-10842.07 10757.31,-10832.08 10753.81,-10842.08 10760.81,-10842.07"/>
<text text-anchor="middle" x="37358.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37358.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU10→GPU14</text>
<text text-anchor="middle" x="37358.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37358.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_10&#45;&gt;expert_1_15_0 -->
<g id="edge2854" class="edge">
<title>gate_1_10&#45;&gt;expert_1_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8439.45,-10985.51C8439.45,-10957.39 8439.45,-10902 8439.45,-10902 8439.45,-10902 11328.97,-10902 11328.97,-10902 11328.97,-10902 11328.97,-10842.12 11328.97,-10842.12"/>
<polygon fill="blue" stroke="blue" points="11332.47,-10842.12 11328.97,-10832.12 11325.47,-10842.12 11332.47,-10842.12"/>
<text text-anchor="middle" x="37532.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37532.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU10→GPU15</text>
<text text-anchor="middle" x="37532.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37532.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_10 -->
<g id="node1028" class="node">
<title>expert_reduce_1_10</title>
<ellipse fill="none" stroke="black" cx="8344" cy="-10668.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="8344" y="-10679.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="8344" y="-10664.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="8344" y="-10649.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_10_0&#45;&gt;expert_reduce_1_10 -->
<g id="edge1017" class="edge">
<title>expert_1_10_0&#45;&gt;expert_reduce_1_10</title>
<path fill="none" stroke="black" d="M8344,-10778.76C8344,-10778.76 8344,-10716.06 8344,-10716.06"/>
<polygon fill="black" stroke="black" points="8347.5,-10716.06 8344,-10706.06 8340.5,-10716.06 8347.5,-10716.06"/>
</g>
<!-- moe_residual_1_10 -->
<g id="node1029" class="node">
<title>moe_residual_1_10</title>
<ellipse fill="none" stroke="black" cx="8344" cy="-10531" rx="105.5" ry="27"/>
<text text-anchor="middle" x="8344" y="-10534.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="8344" y="-10519.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_10&#45;&gt;moe_residual_1_10 -->
<g id="edge1018" class="edge">
<title>expert_reduce_1_10&#45;&gt;moe_residual_1_10</title>
<path fill="none" stroke="black" d="M8344,-10630.93C8344,-10630.93 8344,-10568.06 8344,-10568.06"/>
<polygon fill="black" stroke="black" points="8347.5,-10568.06 8344,-10558.06 8340.5,-10568.06 8347.5,-10568.06"/>
</g>
<!-- qkv_proj_2_10 -->
<g id="node1030" class="node">
<title>qkv_proj_2_10</title>
<polygon fill="none" stroke="black" points="8426.5,-10431 8261.5,-10431 8261.5,-10378 8426.5,-10378 8426.5,-10431"/>
<text text-anchor="middle" x="8344" y="-10415.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="8344" y="-10400.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="8344" y="-10385.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_1_10&#45;&gt;qkv_proj_2_10 -->
<g id="edge1019" class="edge">
<title>moe_residual_1_10&#45;&gt;qkv_proj_2_10</title>
<path fill="none" stroke="black" d="M8344,-10503.86C8344,-10503.86 8344,-10441.16 8344,-10441.16"/>
<polygon fill="black" stroke="black" points="8347.5,-10441.16 8344,-10431.16 8340.5,-10441.16 8347.5,-10441.16"/>
</g>
<!-- qkv_reshape_2_10 -->
<g id="node1031" class="node">
<title>qkv_reshape_2_10</title>
<ellipse fill="none" stroke="black" cx="8344" cy="-10278" rx="148" ry="27"/>
<text text-anchor="middle" x="8344" y="-10281.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="8344" y="-10266.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_2_10&#45;&gt;qkv_reshape_2_10 -->
<g id="edge1020" class="edge">
<title>qkv_proj_2_10&#45;&gt;qkv_reshape_2_10</title>
<path fill="none" stroke="black" d="M8344,-10377.98C8344,-10377.98 8344,-10315.36 8344,-10315.36"/>
<polygon fill="black" stroke="black" points="8347.5,-10315.36 8344,-10305.36 8340.5,-10315.36 8347.5,-10315.36"/>
</g>
<!-- qkv_reshape_2_10&#45;&gt;ring_attn_2_10_stage_0 -->
<g id="edge1021" class="edge">
<title>qkv_reshape_2_10&#45;&gt;ring_attn_2_10_stage_0</title>
<path fill="none" stroke="black" d="M8344,-10250.72C8344,-10250.72 8344,-10144.16 8344,-10144.16"/>
<polygon fill="black" stroke="black" points="8347.5,-10144.16 8344,-10134.16 8340.5,-10144.16 8347.5,-10144.16"/>
</g>
<!-- ring_attn_2_10_stage_0&#45;&gt;ring_attn_2_10_stage_1 -->
<g id="edge1022" class="edge">
<title>ring_attn_2_10_stage_0&#45;&gt;ring_attn_2_10_stage_1</title>
<path fill="none" stroke="black" d="M8344,-9997.87C8344,-9997.87 8344,-9891.25 8344,-9891.25"/>
<polygon fill="black" stroke="black" points="8347.5,-9891.25 8344,-9881.25 8340.5,-9891.25 8347.5,-9891.25"/>
</g>
<!-- ring_attn_2_11_stage_0 -->
<g id="node1130" class="node">
<title>ring_attn_2_11_stage_0</title>
<polygon fill="yellow" stroke="black" points="8931,-10134 8722,-10066 8931,-9998 9140,-10066 8931,-10134"/>
<text text-anchor="middle" x="8931" y="-10084.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-10069.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="8931" y="-10054.8" font-family="Times,serif" font-size="14.00">Q[11]×K[11]×V[11]</text>
<text text-anchor="middle" x="8931" y="-10039.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_10_stage_0&#45;&gt;ring_attn_2_11_stage_0 -->
<g id="edge2855" class="edge">
<title>ring_attn_2_10_stage_0&#45;&gt;ring_attn_2_11_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-10066C8553.02,-10066 8711.86,-10066 8711.86,-10066"/>
<polygon fill="red" stroke="red" points="8711.86,-10069.5 8721.86,-10066 8711.86,-10062.5 8711.86,-10069.5"/>
</g>
<!-- ring_attn_2_10_stage_1&#45;&gt;ring_attn_2_10_stage_2 -->
<g id="edge1023" class="edge">
<title>ring_attn_2_10_stage_1&#45;&gt;ring_attn_2_10_stage_2</title>
<path fill="none" stroke="black" d="M8344,-9744.87C8344,-9744.87 8344,-9638.25 8344,-9638.25"/>
<polygon fill="black" stroke="black" points="8347.5,-9638.25 8344,-9628.25 8340.5,-9638.25 8347.5,-9638.25"/>
</g>
<!-- ring_attn_2_11_stage_1 -->
<g id="node1131" class="node">
<title>ring_attn_2_11_stage_1</title>
<polygon fill="yellow" stroke="black" points="8931,-9881 8722,-9813 8931,-9745 9140,-9813 8931,-9881"/>
<text text-anchor="middle" x="8931" y="-9831.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-9816.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="8931" y="-9801.8" font-family="Times,serif" font-size="14.00">Q[11]×K[10]×V[10]</text>
<text text-anchor="middle" x="8931" y="-9786.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_10_stage_1&#45;&gt;ring_attn_2_11_stage_1 -->
<g id="edge2856" class="edge">
<title>ring_attn_2_10_stage_1&#45;&gt;ring_attn_2_11_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-9813C8553.02,-9813 8711.86,-9813 8711.86,-9813"/>
<polygon fill="red" stroke="red" points="8711.86,-9816.5 8721.86,-9813 8711.86,-9809.5 8711.86,-9816.5"/>
</g>
<!-- ring_attn_2_10_stage_2&#45;&gt;ring_attn_2_10_stage_3 -->
<g id="edge1024" class="edge">
<title>ring_attn_2_10_stage_2&#45;&gt;ring_attn_2_10_stage_3</title>
<path fill="none" stroke="black" d="M8344,-9491.87C8344,-9491.87 8344,-9385.25 8344,-9385.25"/>
<polygon fill="black" stroke="black" points="8347.5,-9385.25 8344,-9375.25 8340.5,-9385.25 8347.5,-9385.25"/>
</g>
<!-- ring_attn_2_11_stage_2 -->
<g id="node1132" class="node">
<title>ring_attn_2_11_stage_2</title>
<polygon fill="yellow" stroke="black" points="8931,-9628 8722,-9560 8931,-9492 9140,-9560 8931,-9628"/>
<text text-anchor="middle" x="8931" y="-9578.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-9563.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="8931" y="-9548.8" font-family="Times,serif" font-size="14.00">Q[11]×K[9]×V[9]</text>
<text text-anchor="middle" x="8931" y="-9533.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_10_stage_2&#45;&gt;ring_attn_2_11_stage_2 -->
<g id="edge2857" class="edge">
<title>ring_attn_2_10_stage_2&#45;&gt;ring_attn_2_11_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-9560C8553.02,-9560 8711.86,-9560 8711.86,-9560"/>
<polygon fill="red" stroke="red" points="8711.86,-9563.5 8721.86,-9560 8711.86,-9556.5 8711.86,-9563.5"/>
</g>
<!-- ring_attn_2_10_stage_3&#45;&gt;ring_attn_2_10_stage_4 -->
<g id="edge1025" class="edge">
<title>ring_attn_2_10_stage_3&#45;&gt;ring_attn_2_10_stage_4</title>
<path fill="none" stroke="black" d="M8344,-9238.87C8344,-9238.87 8344,-9132.25 8344,-9132.25"/>
<polygon fill="black" stroke="black" points="8347.5,-9132.25 8344,-9122.25 8340.5,-9132.25 8347.5,-9132.25"/>
</g>
<!-- ring_attn_2_11_stage_3 -->
<g id="node1133" class="node">
<title>ring_attn_2_11_stage_3</title>
<polygon fill="yellow" stroke="black" points="8931,-9375 8722,-9307 8931,-9239 9140,-9307 8931,-9375"/>
<text text-anchor="middle" x="8931" y="-9325.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-9310.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="8931" y="-9295.8" font-family="Times,serif" font-size="14.00">Q[11]×K[8]×V[8]</text>
<text text-anchor="middle" x="8931" y="-9280.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_10_stage_3&#45;&gt;ring_attn_2_11_stage_3 -->
<g id="edge2858" class="edge">
<title>ring_attn_2_10_stage_3&#45;&gt;ring_attn_2_11_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-9307C8553.02,-9307 8711.86,-9307 8711.86,-9307"/>
<polygon fill="red" stroke="red" points="8711.86,-9310.5 8721.86,-9307 8711.86,-9303.5 8711.86,-9310.5"/>
</g>
<!-- ring_attn_2_10_stage_4&#45;&gt;ring_attn_2_10_stage_5 -->
<g id="edge1026" class="edge">
<title>ring_attn_2_10_stage_4&#45;&gt;ring_attn_2_10_stage_5</title>
<path fill="none" stroke="black" d="M8344,-8985.87C8344,-8985.87 8344,-8879.25 8344,-8879.25"/>
<polygon fill="black" stroke="black" points="8347.5,-8879.25 8344,-8869.25 8340.5,-8879.25 8347.5,-8879.25"/>
</g>
<!-- ring_attn_2_11_stage_4 -->
<g id="node1134" class="node">
<title>ring_attn_2_11_stage_4</title>
<polygon fill="yellow" stroke="black" points="8931,-9122 8722,-9054 8931,-8986 9140,-9054 8931,-9122"/>
<text text-anchor="middle" x="8931" y="-9072.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-9057.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="8931" y="-9042.8" font-family="Times,serif" font-size="14.00">Q[11]×K[7]×V[7]</text>
<text text-anchor="middle" x="8931" y="-9027.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_10_stage_4&#45;&gt;ring_attn_2_11_stage_4 -->
<g id="edge2859" class="edge">
<title>ring_attn_2_10_stage_4&#45;&gt;ring_attn_2_11_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-9054C8553.02,-9054 8711.86,-9054 8711.86,-9054"/>
<polygon fill="red" stroke="red" points="8711.86,-9057.5 8721.86,-9054 8711.86,-9050.5 8711.86,-9057.5"/>
</g>
<!-- ring_attn_2_10_stage_5&#45;&gt;ring_attn_2_10_stage_6 -->
<g id="edge1027" class="edge">
<title>ring_attn_2_10_stage_5&#45;&gt;ring_attn_2_10_stage_6</title>
<path fill="none" stroke="black" d="M8344,-8732.87C8344,-8732.87 8344,-8626.25 8344,-8626.25"/>
<polygon fill="black" stroke="black" points="8347.5,-8626.25 8344,-8616.25 8340.5,-8626.25 8347.5,-8626.25"/>
</g>
<!-- ring_attn_2_11_stage_5 -->
<g id="node1135" class="node">
<title>ring_attn_2_11_stage_5</title>
<polygon fill="yellow" stroke="black" points="8931,-8869 8722,-8801 8931,-8733 9140,-8801 8931,-8869"/>
<text text-anchor="middle" x="8931" y="-8819.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-8804.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="8931" y="-8789.8" font-family="Times,serif" font-size="14.00">Q[11]×K[6]×V[6]</text>
<text text-anchor="middle" x="8931" y="-8774.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_10_stage_5&#45;&gt;ring_attn_2_11_stage_5 -->
<g id="edge2860" class="edge">
<title>ring_attn_2_10_stage_5&#45;&gt;ring_attn_2_11_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-8801C8553.02,-8801 8711.86,-8801 8711.86,-8801"/>
<polygon fill="red" stroke="red" points="8711.86,-8804.5 8721.86,-8801 8711.86,-8797.5 8711.86,-8804.5"/>
</g>
<!-- ring_attn_2_10_stage_6&#45;&gt;ring_attn_2_10_stage_7 -->
<g id="edge1028" class="edge">
<title>ring_attn_2_10_stage_6&#45;&gt;ring_attn_2_10_stage_7</title>
<path fill="none" stroke="black" d="M8344,-8479.87C8344,-8479.87 8344,-8373.25 8344,-8373.25"/>
<polygon fill="black" stroke="black" points="8347.5,-8373.25 8344,-8363.25 8340.5,-8373.25 8347.5,-8373.25"/>
</g>
<!-- ring_attn_2_11_stage_6 -->
<g id="node1136" class="node">
<title>ring_attn_2_11_stage_6</title>
<polygon fill="yellow" stroke="black" points="8931,-8616 8722,-8548 8931,-8480 9140,-8548 8931,-8616"/>
<text text-anchor="middle" x="8931" y="-8566.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-8551.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="8931" y="-8536.8" font-family="Times,serif" font-size="14.00">Q[11]×K[5]×V[5]</text>
<text text-anchor="middle" x="8931" y="-8521.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_10_stage_6&#45;&gt;ring_attn_2_11_stage_6 -->
<g id="edge2861" class="edge">
<title>ring_attn_2_10_stage_6&#45;&gt;ring_attn_2_11_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-8548C8553.02,-8548 8711.86,-8548 8711.86,-8548"/>
<polygon fill="red" stroke="red" points="8711.86,-8551.5 8721.86,-8548 8711.86,-8544.5 8711.86,-8551.5"/>
</g>
<!-- ring_attn_2_10_stage_7&#45;&gt;ring_attn_2_10_stage_8 -->
<g id="edge1029" class="edge">
<title>ring_attn_2_10_stage_7&#45;&gt;ring_attn_2_10_stage_8</title>
<path fill="none" stroke="black" d="M8344,-8226.87C8344,-8226.87 8344,-8120.25 8344,-8120.25"/>
<polygon fill="black" stroke="black" points="8347.5,-8120.25 8344,-8110.25 8340.5,-8120.25 8347.5,-8120.25"/>
</g>
<!-- ring_attn_2_11_stage_7 -->
<g id="node1137" class="node">
<title>ring_attn_2_11_stage_7</title>
<polygon fill="yellow" stroke="black" points="8931,-8363 8722,-8295 8931,-8227 9140,-8295 8931,-8363"/>
<text text-anchor="middle" x="8931" y="-8313.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-8298.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="8931" y="-8283.8" font-family="Times,serif" font-size="14.00">Q[11]×K[4]×V[4]</text>
<text text-anchor="middle" x="8931" y="-8268.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_10_stage_7&#45;&gt;ring_attn_2_11_stage_7 -->
<g id="edge2862" class="edge">
<title>ring_attn_2_10_stage_7&#45;&gt;ring_attn_2_11_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-8295C8553.02,-8295 8711.86,-8295 8711.86,-8295"/>
<polygon fill="red" stroke="red" points="8711.86,-8298.5 8721.86,-8295 8711.86,-8291.5 8711.86,-8298.5"/>
</g>
<!-- ring_attn_2_10_stage_8&#45;&gt;ring_attn_2_10_stage_9 -->
<g id="edge1030" class="edge">
<title>ring_attn_2_10_stage_8&#45;&gt;ring_attn_2_10_stage_9</title>
<path fill="none" stroke="black" d="M8344,-7973.87C8344,-7973.87 8344,-7867.25 8344,-7867.25"/>
<polygon fill="black" stroke="black" points="8347.5,-7867.25 8344,-7857.25 8340.5,-7867.25 8347.5,-7867.25"/>
</g>
<!-- ring_attn_2_11_stage_8 -->
<g id="node1138" class="node">
<title>ring_attn_2_11_stage_8</title>
<polygon fill="yellow" stroke="black" points="8931,-8110 8722,-8042 8931,-7974 9140,-8042 8931,-8110"/>
<text text-anchor="middle" x="8931" y="-8060.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-8045.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="8931" y="-8030.8" font-family="Times,serif" font-size="14.00">Q[11]×K[3]×V[3]</text>
<text text-anchor="middle" x="8931" y="-8015.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_10_stage_8&#45;&gt;ring_attn_2_11_stage_8 -->
<g id="edge2863" class="edge">
<title>ring_attn_2_10_stage_8&#45;&gt;ring_attn_2_11_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-8042C8553.02,-8042 8711.86,-8042 8711.86,-8042"/>
<polygon fill="red" stroke="red" points="8711.86,-8045.5 8721.86,-8042 8711.86,-8038.5 8711.86,-8045.5"/>
</g>
<!-- ring_attn_2_10_stage_9&#45;&gt;ring_attn_2_10_stage_10 -->
<g id="edge1031" class="edge">
<title>ring_attn_2_10_stage_9&#45;&gt;ring_attn_2_10_stage_10</title>
<path fill="none" stroke="black" d="M8344,-7720.87C8344,-7720.87 8344,-7614.25 8344,-7614.25"/>
<polygon fill="black" stroke="black" points="8347.5,-7614.25 8344,-7604.25 8340.5,-7614.25 8347.5,-7614.25"/>
</g>
<!-- ring_attn_2_11_stage_9 -->
<g id="node1139" class="node">
<title>ring_attn_2_11_stage_9</title>
<polygon fill="yellow" stroke="black" points="8931,-7857 8722,-7789 8931,-7721 9140,-7789 8931,-7857"/>
<text text-anchor="middle" x="8931" y="-7807.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-7792.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="8931" y="-7777.8" font-family="Times,serif" font-size="14.00">Q[11]×K[2]×V[2]</text>
<text text-anchor="middle" x="8931" y="-7762.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_10_stage_9&#45;&gt;ring_attn_2_11_stage_9 -->
<g id="edge2864" class="edge">
<title>ring_attn_2_10_stage_9&#45;&gt;ring_attn_2_11_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-7789C8553.02,-7789 8711.86,-7789 8711.86,-7789"/>
<polygon fill="red" stroke="red" points="8711.86,-7792.5 8721.86,-7789 8711.86,-7785.5 8711.86,-7792.5"/>
</g>
<!-- ring_attn_2_10_stage_10&#45;&gt;ring_attn_2_10_stage_11 -->
<g id="edge1032" class="edge">
<title>ring_attn_2_10_stage_10&#45;&gt;ring_attn_2_10_stage_11</title>
<path fill="none" stroke="black" d="M8344,-7467.87C8344,-7467.87 8344,-7361.25 8344,-7361.25"/>
<polygon fill="black" stroke="black" points="8347.5,-7361.25 8344,-7351.25 8340.5,-7361.25 8347.5,-7361.25"/>
</g>
<!-- ring_attn_2_11_stage_10 -->
<g id="node1140" class="node">
<title>ring_attn_2_11_stage_10</title>
<polygon fill="yellow" stroke="black" points="8931,-7604 8722,-7536 8931,-7468 9140,-7536 8931,-7604"/>
<text text-anchor="middle" x="8931" y="-7554.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-7539.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="8931" y="-7524.8" font-family="Times,serif" font-size="14.00">Q[11]×K[1]×V[1]</text>
<text text-anchor="middle" x="8931" y="-7509.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_10_stage_10&#45;&gt;ring_attn_2_11_stage_10 -->
<g id="edge2865" class="edge">
<title>ring_attn_2_10_stage_10&#45;&gt;ring_attn_2_11_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-7536C8553.02,-7536 8711.86,-7536 8711.86,-7536"/>
<polygon fill="red" stroke="red" points="8711.86,-7539.5 8721.86,-7536 8711.86,-7532.5 8711.86,-7539.5"/>
</g>
<!-- ring_attn_2_10_stage_11&#45;&gt;ring_attn_2_10_stage_12 -->
<g id="edge1033" class="edge">
<title>ring_attn_2_10_stage_11&#45;&gt;ring_attn_2_10_stage_12</title>
<path fill="none" stroke="black" d="M8344,-7214.87C8344,-7214.87 8344,-7108.25 8344,-7108.25"/>
<polygon fill="black" stroke="black" points="8347.5,-7108.25 8344,-7098.25 8340.5,-7108.25 8347.5,-7108.25"/>
</g>
<!-- ring_attn_2_11_stage_11 -->
<g id="node1141" class="node">
<title>ring_attn_2_11_stage_11</title>
<polygon fill="yellow" stroke="black" points="8931,-7351 8722,-7283 8931,-7215 9140,-7283 8931,-7351"/>
<text text-anchor="middle" x="8931" y="-7301.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-7286.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="8931" y="-7271.8" font-family="Times,serif" font-size="14.00">Q[11]×K[0]×V[0]</text>
<text text-anchor="middle" x="8931" y="-7256.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_10_stage_11&#45;&gt;ring_attn_2_11_stage_11 -->
<g id="edge2866" class="edge">
<title>ring_attn_2_10_stage_11&#45;&gt;ring_attn_2_11_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-7283C8553.02,-7283 8711.86,-7283 8711.86,-7283"/>
<polygon fill="red" stroke="red" points="8711.86,-7286.5 8721.86,-7283 8711.86,-7279.5 8711.86,-7286.5"/>
</g>
<!-- ring_attn_2_10_stage_12&#45;&gt;ring_attn_2_10_stage_13 -->
<g id="edge1034" class="edge">
<title>ring_attn_2_10_stage_12&#45;&gt;ring_attn_2_10_stage_13</title>
<path fill="none" stroke="black" d="M8344,-6961.87C8344,-6961.87 8344,-6855.25 8344,-6855.25"/>
<polygon fill="black" stroke="black" points="8347.5,-6855.25 8344,-6845.25 8340.5,-6855.25 8347.5,-6855.25"/>
</g>
<!-- ring_attn_2_11_stage_12 -->
<g id="node1142" class="node">
<title>ring_attn_2_11_stage_12</title>
<polygon fill="yellow" stroke="black" points="8931,-7098 8722,-7030 8931,-6962 9140,-7030 8931,-7098"/>
<text text-anchor="middle" x="8931" y="-7048.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-7033.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="8931" y="-7018.8" font-family="Times,serif" font-size="14.00">Q[11]×K[15]×V[15]</text>
<text text-anchor="middle" x="8931" y="-7003.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_10_stage_12&#45;&gt;ring_attn_2_11_stage_12 -->
<g id="edge2867" class="edge">
<title>ring_attn_2_10_stage_12&#45;&gt;ring_attn_2_11_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-7030C8553.02,-7030 8711.86,-7030 8711.86,-7030"/>
<polygon fill="red" stroke="red" points="8711.86,-7033.5 8721.86,-7030 8711.86,-7026.5 8711.86,-7033.5"/>
</g>
<!-- ring_attn_2_10_stage_13&#45;&gt;ring_attn_2_10_stage_14 -->
<g id="edge1035" class="edge">
<title>ring_attn_2_10_stage_13&#45;&gt;ring_attn_2_10_stage_14</title>
<path fill="none" stroke="black" d="M8344,-6708.87C8344,-6708.87 8344,-6602.25 8344,-6602.25"/>
<polygon fill="black" stroke="black" points="8347.5,-6602.25 8344,-6592.25 8340.5,-6602.25 8347.5,-6602.25"/>
</g>
<!-- ring_attn_2_11_stage_13 -->
<g id="node1143" class="node">
<title>ring_attn_2_11_stage_13</title>
<polygon fill="yellow" stroke="black" points="8931,-6845 8722,-6777 8931,-6709 9140,-6777 8931,-6845"/>
<text text-anchor="middle" x="8931" y="-6795.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-6780.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="8931" y="-6765.8" font-family="Times,serif" font-size="14.00">Q[11]×K[14]×V[14]</text>
<text text-anchor="middle" x="8931" y="-6750.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_10_stage_13&#45;&gt;ring_attn_2_11_stage_13 -->
<g id="edge2868" class="edge">
<title>ring_attn_2_10_stage_13&#45;&gt;ring_attn_2_11_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-6777C8553.02,-6777 8711.86,-6777 8711.86,-6777"/>
<polygon fill="red" stroke="red" points="8711.86,-6780.5 8721.86,-6777 8711.86,-6773.5 8711.86,-6780.5"/>
</g>
<!-- ring_attn_2_10_stage_14&#45;&gt;ring_attn_2_10_stage_15 -->
<g id="edge1036" class="edge">
<title>ring_attn_2_10_stage_14&#45;&gt;ring_attn_2_10_stage_15</title>
<path fill="none" stroke="black" d="M8344,-6455.87C8344,-6455.87 8344,-6349.25 8344,-6349.25"/>
<polygon fill="black" stroke="black" points="8347.5,-6349.25 8344,-6339.25 8340.5,-6349.25 8347.5,-6349.25"/>
</g>
<!-- ring_attn_2_11_stage_14 -->
<g id="node1144" class="node">
<title>ring_attn_2_11_stage_14</title>
<polygon fill="yellow" stroke="black" points="8931,-6592 8722,-6524 8931,-6456 9140,-6524 8931,-6592"/>
<text text-anchor="middle" x="8931" y="-6542.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-6527.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="8931" y="-6512.8" font-family="Times,serif" font-size="14.00">Q[11]×K[13]×V[13]</text>
<text text-anchor="middle" x="8931" y="-6497.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_10_stage_14&#45;&gt;ring_attn_2_11_stage_14 -->
<g id="edge2869" class="edge">
<title>ring_attn_2_10_stage_14&#45;&gt;ring_attn_2_11_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-6524C8553.02,-6524 8711.86,-6524 8711.86,-6524"/>
<polygon fill="red" stroke="red" points="8711.86,-6527.5 8721.86,-6524 8711.86,-6520.5 8711.86,-6527.5"/>
</g>
<!-- attn_out_2_10 -->
<g id="node1048" class="node">
<title>attn_out_2_10</title>
<polygon fill="none" stroke="black" points="8413.5,-6130 8274.5,-6130 8274.5,-6077 8413.5,-6077 8413.5,-6130"/>
<text text-anchor="middle" x="8344" y="-6114.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="8344" y="-6099.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="8344" y="-6084.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_2_10_stage_15&#45;&gt;attn_out_2_10 -->
<g id="edge1037" class="edge">
<title>ring_attn_2_10_stage_15&#45;&gt;attn_out_2_10</title>
<path fill="none" stroke="black" d="M8344,-6202.87C8344,-6202.87 8344,-6140.18 8344,-6140.18"/>
<polygon fill="black" stroke="black" points="8347.5,-6140.18 8344,-6130.18 8340.5,-6140.18 8347.5,-6140.18"/>
</g>
<!-- ring_attn_2_11_stage_15 -->
<g id="node1145" class="node">
<title>ring_attn_2_11_stage_15</title>
<polygon fill="yellow" stroke="black" points="8931,-6339 8722,-6271 8931,-6203 9140,-6271 8931,-6339"/>
<text text-anchor="middle" x="8931" y="-6289.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-6274.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="8931" y="-6259.8" font-family="Times,serif" font-size="14.00">Q[11]×K[12]×V[12]</text>
<text text-anchor="middle" x="8931" y="-6244.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_10_stage_15&#45;&gt;ring_attn_2_11_stage_15 -->
<g id="edge2870" class="edge">
<title>ring_attn_2_10_stage_15&#45;&gt;ring_attn_2_11_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-6271C8553.02,-6271 8711.86,-6271 8711.86,-6271"/>
<polygon fill="red" stroke="red" points="8711.86,-6274.5 8721.86,-6271 8711.86,-6267.5 8711.86,-6274.5"/>
</g>
<!-- attn_residual_2_10 -->
<g id="node1049" class="node">
<title>attn_residual_2_10</title>
<ellipse fill="none" stroke="black" cx="8344" cy="-5977" rx="105.5" ry="27"/>
<text text-anchor="middle" x="8344" y="-5980.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="8344" y="-5965.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_2_10&#45;&gt;attn_residual_2_10 -->
<g id="edge1038" class="edge">
<title>attn_out_2_10&#45;&gt;attn_residual_2_10</title>
<path fill="none" stroke="black" d="M8344,-6076.98C8344,-6076.98 8344,-6014.36 8344,-6014.36"/>
<polygon fill="black" stroke="black" points="8347.5,-6014.36 8344,-6004.36 8340.5,-6014.36 8347.5,-6014.36"/>
</g>
<!-- gate_2_10 -->
<g id="node1050" class="node">
<title>gate_2_10</title>
<ellipse fill="orange" stroke="black" cx="8344" cy="-5839.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="8344" y="-5850.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="8344" y="-5835.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="8344" y="-5820.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_2_10&#45;&gt;gate_2_10 -->
<g id="edge1039" class="edge">
<title>attn_residual_2_10&#45;&gt;gate_2_10</title>
<path fill="none" stroke="black" d="M8396.75,-5953.36C8396.75,-5953.36 8396.75,-5882.08 8396.75,-5882.08"/>
<polygon fill="black" stroke="black" points="8400.25,-5882.08 8396.75,-5872.08 8393.25,-5882.08 8400.25,-5882.08"/>
</g>
<!-- gate_2_10&#45;&gt;expert_2_0_0 -->
<g id="edge2871" class="edge">
<title>gate_2_10&#45;&gt;expert_2_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8344,-5877.02C8344,-5904.86 8344,-5938 8344,-5938 8344,-5938 114.1,-5938 114.1,-5938 114.1,-5938 114.1,-5680.15 114.1,-5680.15"/>
<polygon fill="blue" stroke="blue" points="117.6,-5680.15 114.1,-5670.15 110.6,-5680.15 117.6,-5680.15"/>
<text text-anchor="middle" x="35096.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35096.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU10→GPU0</text>
<text text-anchor="middle" x="35096.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35096.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_10&#45;&gt;expert_2_1_0 -->
<g id="edge2872" class="edge">
<title>gate_2_10&#45;&gt;expert_2_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8291.25,-5872.11C8291.25,-5884.19 8291.25,-5895 8291.25,-5895 8291.25,-5895 3170.36,-5895 3170.36,-5895 3170.36,-5895 3170.36,-5680.41 3170.36,-5680.41"/>
<polygon fill="blue" stroke="blue" points="3173.86,-5680.41 3170.36,-5670.41 3166.86,-5680.41 3173.86,-5680.41"/>
<text text-anchor="middle" x="35270.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35270.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU10→GPU1</text>
<text text-anchor="middle" x="35270.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35270.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_10&#45;&gt;expert_2_2_0 -->
<g id="edge2873" class="edge">
<title>gate_2_10&#45;&gt;expert_2_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8248.55,-5823.35C8248.55,-5789.45 8248.55,-5714 8248.55,-5714 8248.55,-5714 3612.83,-5714 3612.83,-5714 3612.83,-5714 3612.83,-5680.15 3612.83,-5680.15"/>
<polygon fill="blue" stroke="blue" points="3616.33,-5680.15 3612.83,-5670.15 3609.33,-5680.15 3616.33,-5680.15"/>
<text text-anchor="middle" x="35444.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35444.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU10→GPU2</text>
<text text-anchor="middle" x="35444.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35444.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_10&#45;&gt;expert_2_3_0 -->
<g id="edge2874" class="edge">
<title>gate_2_10&#45;&gt;expert_2_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8268.64,-5813.14C8268.64,-5777.4 8268.64,-5718 8268.64,-5718 8268.64,-5718 4205.46,-5718 4205.46,-5718 4205.46,-5718 4205.46,-5680.4 4205.46,-5680.4"/>
<polygon fill="blue" stroke="blue" points="4208.96,-5680.4 4205.46,-5670.4 4201.96,-5680.4 4208.96,-5680.4"/>
<text text-anchor="middle" x="35618.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35618.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU10→GPU3</text>
<text text-anchor="middle" x="35618.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35618.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_10&#45;&gt;expert_2_4_0 -->
<g id="edge2875" class="edge">
<title>gate_2_10&#45;&gt;expert_2_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8288.74,-5807.26C8288.74,-5774.02 8288.74,-5727 8288.74,-5727 8288.74,-5727 4806.93,-5727 4806.93,-5727 4806.93,-5727 4806.93,-5680.38 4806.93,-5680.38"/>
<polygon fill="blue" stroke="blue" points="4810.43,-5680.38 4806.93,-5670.38 4803.43,-5680.38 4810.43,-5680.38"/>
<text text-anchor="middle" x="35792.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35792.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU10→GPU4</text>
<text text-anchor="middle" x="35792.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35792.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_10&#45;&gt;expert_2_5_0 -->
<g id="edge2876" class="edge">
<title>gate_2_10&#45;&gt;expert_2_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8308.83,-5804.12C8308.83,-5773.8 8308.83,-5735 8308.83,-5735 8308.83,-5735 5403.98,-5735 5403.98,-5735 5403.98,-5735 5403.98,-5680.46 5403.98,-5680.46"/>
<polygon fill="blue" stroke="blue" points="5407.48,-5680.46 5403.98,-5670.46 5400.48,-5680.46 5407.48,-5680.46"/>
<text text-anchor="middle" x="35966.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35966.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU10→GPU5</text>
<text text-anchor="middle" x="35966.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35966.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_10&#45;&gt;expert_2_6_0 -->
<g id="edge2877" class="edge">
<title>gate_2_10&#45;&gt;expert_2_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8328.93,-5802.31C8328.93,-5778.87 8328.93,-5753 8328.93,-5753 8328.93,-5753 5985.45,-5753 5985.45,-5753 5985.45,-5753 5985.45,-5680.01 5985.45,-5680.01"/>
<polygon fill="blue" stroke="blue" points="5988.95,-5680.01 5985.45,-5670.01 5981.95,-5680.01 5988.95,-5680.01"/>
<text text-anchor="middle" x="36140.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="36140.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU10→GPU6</text>
<text text-anchor="middle" x="36140.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="36140.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_10&#45;&gt;expert_2_7_0 -->
<g id="edge2878" class="edge">
<title>gate_2_10&#45;&gt;expert_2_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8349.02,-5801.61C8349.02,-5780.73 8349.02,-5759 8349.02,-5759 8349.02,-5759 6577.98,-5759 6577.98,-5759 6577.98,-5759 6577.98,-5680.29 6577.98,-5680.29"/>
<polygon fill="blue" stroke="blue" points="6581.48,-5680.29 6577.98,-5670.29 6574.48,-5680.29 6581.48,-5680.29"/>
<text text-anchor="middle" x="36314.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="36314.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU10→GPU7</text>
<text text-anchor="middle" x="36314.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="36314.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_10&#45;&gt;expert_2_8_0 -->
<g id="edge2879" class="edge">
<title>gate_2_10&#45;&gt;expert_2_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8359.07,-5802.07C8359.07,-5796.19 8359.07,-5792 8359.07,-5792 8359.07,-5792 7284.5,-5792 7284.5,-5792 7284.5,-5792 7284.5,-5680.05 7284.5,-5680.05"/>
<polygon fill="blue" stroke="blue" points="7288,-5680.05 7284.5,-5670.05 7281,-5680.05 7288,-5680.05"/>
<text text-anchor="middle" x="36488.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="36488.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU10→GPU8</text>
<text text-anchor="middle" x="36488.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="36488.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_10&#45;&gt;expert_2_9_0 -->
<g id="edge2880" class="edge">
<title>gate_2_10&#45;&gt;expert_2_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8244.3,-5852C8104.46,-5852 7867,-5852 7867,-5852 7867,-5852 7867,-5680.33 7867,-5680.33"/>
<polygon fill="blue" stroke="blue" points="7870.5,-5680.33 7867,-5670.33 7863.5,-5680.33 7870.5,-5680.33"/>
<text text-anchor="middle" x="36662.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="36662.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU10→GPU9</text>
<text text-anchor="middle" x="36662.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="36662.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_10&#45;&gt;expert_2_10_0 -->
<g id="edge1040" class="edge">
<title>gate_2_10&#45;&gt;expert_2_10_0</title>
<path fill="none" stroke="black" d="M8369.12,-5802.63C8369.12,-5802.63 8369.12,-5680.14 8369.12,-5680.14"/>
<polygon fill="black" stroke="black" points="8372.62,-5680.14 8369.12,-5670.14 8365.62,-5680.14 8372.62,-5680.14"/>
</g>
<!-- gate_2_10&#45;&gt;expert_2_11_0 -->
<g id="edge2881" class="edge">
<title>gate_2_10&#45;&gt;expert_2_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8443.65,-5827C8583.77,-5827 8822.12,-5827 8822.12,-5827 8822.12,-5827 8822.12,-5680.18 8822.12,-5680.18"/>
<polygon fill="blue" stroke="blue" points="8825.63,-5680.18 8822.12,-5670.18 8818.63,-5680.18 8825.63,-5680.18"/>
<text text-anchor="middle" x="36836.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="36836.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU10→GPU11</text>
<text text-anchor="middle" x="36836.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="36836.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_10&#45;&gt;expert_2_12_0 -->
<g id="edge2882" class="edge">
<title>gate_2_10&#45;&gt;expert_2_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8409.31,-5809.93C8409.31,-5797.56 8409.31,-5786 8409.31,-5786 8409.31,-5786 9405.75,-5786 9405.75,-5786 9405.75,-5786 9405.75,-5680.3 9405.75,-5680.3"/>
<polygon fill="blue" stroke="blue" points="9409.25,-5680.3 9405.75,-5670.3 9402.25,-5680.3 9409.25,-5680.3"/>
<text text-anchor="middle" x="37010.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37010.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU10→GPU12</text>
<text text-anchor="middle" x="37010.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37010.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_10&#45;&gt;expert_2_13_0 -->
<g id="edge2883" class="edge">
<title>gate_2_10&#45;&gt;expert_2_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8419.36,-5813.03C8419.36,-5786.01 8419.36,-5748 8419.36,-5748 8419.36,-5748 9989.38,-5748 9989.38,-5748 9989.38,-5748 9989.38,-5680.14 9989.38,-5680.14"/>
<polygon fill="blue" stroke="blue" points="9992.88,-5680.14 9989.38,-5670.14 9985.88,-5680.14 9992.88,-5680.14"/>
<text text-anchor="middle" x="37184.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37184.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU10→GPU13</text>
<text text-anchor="middle" x="37184.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37184.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_10&#45;&gt;expert_2_14_0 -->
<g id="edge2884" class="edge">
<title>gate_2_10&#45;&gt;expert_2_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8429.4,-5817.48C8429.4,-5787.62 8429.4,-5738 8429.4,-5738 8429.4,-5738 10757.31,-5738 10757.31,-5738 10757.31,-5738 10757.31,-5680.08 10757.31,-5680.08"/>
<polygon fill="blue" stroke="blue" points="10760.81,-5680.07 10757.31,-5670.08 10753.81,-5680.08 10760.81,-5680.07"/>
<text text-anchor="middle" x="37358.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37358.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU10→GPU14</text>
<text text-anchor="middle" x="37358.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37358.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_10&#45;&gt;expert_2_15_0 -->
<g id="edge2885" class="edge">
<title>gate_2_10&#45;&gt;expert_2_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8439.45,-5823.51C8439.45,-5795.39 8439.45,-5740 8439.45,-5740 8439.45,-5740 11328.97,-5740 11328.97,-5740 11328.97,-5740 11328.97,-5680.12 11328.97,-5680.12"/>
<polygon fill="blue" stroke="blue" points="11332.47,-5680.12 11328.97,-5670.12 11325.47,-5680.12 11332.47,-5680.12"/>
<text text-anchor="middle" x="37532.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37532.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU10→GPU15</text>
<text text-anchor="middle" x="37532.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37532.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_10 -->
<g id="node1052" class="node">
<title>expert_reduce_2_10</title>
<ellipse fill="none" stroke="black" cx="8344" cy="-5506.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="8344" y="-5517.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="8344" y="-5502.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="8344" y="-5487.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_10_0&#45;&gt;expert_reduce_2_10 -->
<g id="edge1041" class="edge">
<title>expert_2_10_0&#45;&gt;expert_reduce_2_10</title>
<path fill="none" stroke="black" d="M8344,-5616.76C8344,-5616.76 8344,-5554.06 8344,-5554.06"/>
<polygon fill="black" stroke="black" points="8347.5,-5554.06 8344,-5544.06 8340.5,-5554.06 8347.5,-5554.06"/>
</g>
<!-- moe_residual_2_10 -->
<g id="node1053" class="node">
<title>moe_residual_2_10</title>
<ellipse fill="none" stroke="black" cx="8344" cy="-5369" rx="105.5" ry="27"/>
<text text-anchor="middle" x="8344" y="-5372.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="8344" y="-5357.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_10&#45;&gt;moe_residual_2_10 -->
<g id="edge1042" class="edge">
<title>expert_reduce_2_10&#45;&gt;moe_residual_2_10</title>
<path fill="none" stroke="black" d="M8344,-5468.93C8344,-5468.93 8344,-5406.06 8344,-5406.06"/>
<polygon fill="black" stroke="black" points="8347.5,-5406.06 8344,-5396.06 8340.5,-5406.06 8347.5,-5406.06"/>
</g>
<!-- qkv_proj_3_10 -->
<g id="node1054" class="node">
<title>qkv_proj_3_10</title>
<polygon fill="none" stroke="black" points="8426.5,-5269 8261.5,-5269 8261.5,-5216 8426.5,-5216 8426.5,-5269"/>
<text text-anchor="middle" x="8344" y="-5253.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="8344" y="-5238.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="8344" y="-5223.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_2_10&#45;&gt;qkv_proj_3_10 -->
<g id="edge1043" class="edge">
<title>moe_residual_2_10&#45;&gt;qkv_proj_3_10</title>
<path fill="none" stroke="black" d="M8344,-5341.86C8344,-5341.86 8344,-5279.16 8344,-5279.16"/>
<polygon fill="black" stroke="black" points="8347.5,-5279.16 8344,-5269.16 8340.5,-5279.16 8347.5,-5279.16"/>
</g>
<!-- qkv_reshape_3_10 -->
<g id="node1055" class="node">
<title>qkv_reshape_3_10</title>
<ellipse fill="none" stroke="black" cx="8344" cy="-5116" rx="148" ry="27"/>
<text text-anchor="middle" x="8344" y="-5119.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="8344" y="-5104.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_3_10&#45;&gt;qkv_reshape_3_10 -->
<g id="edge1044" class="edge">
<title>qkv_proj_3_10&#45;&gt;qkv_reshape_3_10</title>
<path fill="none" stroke="black" d="M8344,-5215.98C8344,-5215.98 8344,-5153.36 8344,-5153.36"/>
<polygon fill="black" stroke="black" points="8347.5,-5153.36 8344,-5143.36 8340.5,-5153.36 8347.5,-5153.36"/>
</g>
<!-- qkv_reshape_3_10&#45;&gt;ring_attn_3_10_stage_0 -->
<g id="edge1045" class="edge">
<title>qkv_reshape_3_10&#45;&gt;ring_attn_3_10_stage_0</title>
<path fill="none" stroke="black" d="M8344,-5088.72C8344,-5088.72 8344,-4982.16 8344,-4982.16"/>
<polygon fill="black" stroke="black" points="8347.5,-4982.16 8344,-4972.16 8340.5,-4982.16 8347.5,-4982.16"/>
</g>
<!-- ring_attn_3_10_stage_0&#45;&gt;ring_attn_3_10_stage_1 -->
<g id="edge1046" class="edge">
<title>ring_attn_3_10_stage_0&#45;&gt;ring_attn_3_10_stage_1</title>
<path fill="none" stroke="black" d="M8344,-4835.87C8344,-4835.87 8344,-4729.25 8344,-4729.25"/>
<polygon fill="black" stroke="black" points="8347.5,-4729.25 8344,-4719.25 8340.5,-4729.25 8347.5,-4729.25"/>
</g>
<!-- ring_attn_3_11_stage_0 -->
<g id="node1154" class="node">
<title>ring_attn_3_11_stage_0</title>
<polygon fill="yellow" stroke="black" points="8931,-4972 8722,-4904 8931,-4836 9140,-4904 8931,-4972"/>
<text text-anchor="middle" x="8931" y="-4922.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-4907.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="8931" y="-4892.8" font-family="Times,serif" font-size="14.00">Q[11]×K[11]×V[11]</text>
<text text-anchor="middle" x="8931" y="-4877.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_10_stage_0&#45;&gt;ring_attn_3_11_stage_0 -->
<g id="edge2886" class="edge">
<title>ring_attn_3_10_stage_0&#45;&gt;ring_attn_3_11_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-4904C8553.02,-4904 8711.86,-4904 8711.86,-4904"/>
<polygon fill="red" stroke="red" points="8711.86,-4907.5 8721.86,-4904 8711.86,-4900.5 8711.86,-4907.5"/>
</g>
<!-- ring_attn_3_10_stage_1&#45;&gt;ring_attn_3_10_stage_2 -->
<g id="edge1047" class="edge">
<title>ring_attn_3_10_stage_1&#45;&gt;ring_attn_3_10_stage_2</title>
<path fill="none" stroke="black" d="M8344,-4582.87C8344,-4582.87 8344,-4476.25 8344,-4476.25"/>
<polygon fill="black" stroke="black" points="8347.5,-4476.25 8344,-4466.25 8340.5,-4476.25 8347.5,-4476.25"/>
</g>
<!-- ring_attn_3_11_stage_1 -->
<g id="node1155" class="node">
<title>ring_attn_3_11_stage_1</title>
<polygon fill="yellow" stroke="black" points="8931,-4719 8722,-4651 8931,-4583 9140,-4651 8931,-4719"/>
<text text-anchor="middle" x="8931" y="-4669.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-4654.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="8931" y="-4639.8" font-family="Times,serif" font-size="14.00">Q[11]×K[10]×V[10]</text>
<text text-anchor="middle" x="8931" y="-4624.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_10_stage_1&#45;&gt;ring_attn_3_11_stage_1 -->
<g id="edge2887" class="edge">
<title>ring_attn_3_10_stage_1&#45;&gt;ring_attn_3_11_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-4651C8553.02,-4651 8711.86,-4651 8711.86,-4651"/>
<polygon fill="red" stroke="red" points="8711.86,-4654.5 8721.86,-4651 8711.86,-4647.5 8711.86,-4654.5"/>
</g>
<!-- ring_attn_3_10_stage_2&#45;&gt;ring_attn_3_10_stage_3 -->
<g id="edge1048" class="edge">
<title>ring_attn_3_10_stage_2&#45;&gt;ring_attn_3_10_stage_3</title>
<path fill="none" stroke="black" d="M8344,-4329.87C8344,-4329.87 8344,-4223.25 8344,-4223.25"/>
<polygon fill="black" stroke="black" points="8347.5,-4223.25 8344,-4213.25 8340.5,-4223.25 8347.5,-4223.25"/>
</g>
<!-- ring_attn_3_11_stage_2 -->
<g id="node1156" class="node">
<title>ring_attn_3_11_stage_2</title>
<polygon fill="yellow" stroke="black" points="8931,-4466 8722,-4398 8931,-4330 9140,-4398 8931,-4466"/>
<text text-anchor="middle" x="8931" y="-4416.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-4401.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="8931" y="-4386.8" font-family="Times,serif" font-size="14.00">Q[11]×K[9]×V[9]</text>
<text text-anchor="middle" x="8931" y="-4371.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_10_stage_2&#45;&gt;ring_attn_3_11_stage_2 -->
<g id="edge2888" class="edge">
<title>ring_attn_3_10_stage_2&#45;&gt;ring_attn_3_11_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-4398C8553.02,-4398 8711.86,-4398 8711.86,-4398"/>
<polygon fill="red" stroke="red" points="8711.86,-4401.5 8721.86,-4398 8711.86,-4394.5 8711.86,-4401.5"/>
</g>
<!-- ring_attn_3_10_stage_3&#45;&gt;ring_attn_3_10_stage_4 -->
<g id="edge1049" class="edge">
<title>ring_attn_3_10_stage_3&#45;&gt;ring_attn_3_10_stage_4</title>
<path fill="none" stroke="black" d="M8344,-4076.87C8344,-4076.87 8344,-3970.25 8344,-3970.25"/>
<polygon fill="black" stroke="black" points="8347.5,-3970.25 8344,-3960.25 8340.5,-3970.25 8347.5,-3970.25"/>
</g>
<!-- ring_attn_3_11_stage_3 -->
<g id="node1157" class="node">
<title>ring_attn_3_11_stage_3</title>
<polygon fill="yellow" stroke="black" points="8931,-4213 8722,-4145 8931,-4077 9140,-4145 8931,-4213"/>
<text text-anchor="middle" x="8931" y="-4163.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-4148.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="8931" y="-4133.8" font-family="Times,serif" font-size="14.00">Q[11]×K[8]×V[8]</text>
<text text-anchor="middle" x="8931" y="-4118.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_10_stage_3&#45;&gt;ring_attn_3_11_stage_3 -->
<g id="edge2889" class="edge">
<title>ring_attn_3_10_stage_3&#45;&gt;ring_attn_3_11_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-4145C8553.02,-4145 8711.86,-4145 8711.86,-4145"/>
<polygon fill="red" stroke="red" points="8711.86,-4148.5 8721.86,-4145 8711.86,-4141.5 8711.86,-4148.5"/>
</g>
<!-- ring_attn_3_10_stage_4&#45;&gt;ring_attn_3_10_stage_5 -->
<g id="edge1050" class="edge">
<title>ring_attn_3_10_stage_4&#45;&gt;ring_attn_3_10_stage_5</title>
<path fill="none" stroke="black" d="M8344,-3823.87C8344,-3823.87 8344,-3717.25 8344,-3717.25"/>
<polygon fill="black" stroke="black" points="8347.5,-3717.25 8344,-3707.25 8340.5,-3717.25 8347.5,-3717.25"/>
</g>
<!-- ring_attn_3_11_stage_4 -->
<g id="node1158" class="node">
<title>ring_attn_3_11_stage_4</title>
<polygon fill="yellow" stroke="black" points="8931,-3960 8722,-3892 8931,-3824 9140,-3892 8931,-3960"/>
<text text-anchor="middle" x="8931" y="-3910.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-3895.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="8931" y="-3880.8" font-family="Times,serif" font-size="14.00">Q[11]×K[7]×V[7]</text>
<text text-anchor="middle" x="8931" y="-3865.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_10_stage_4&#45;&gt;ring_attn_3_11_stage_4 -->
<g id="edge2890" class="edge">
<title>ring_attn_3_10_stage_4&#45;&gt;ring_attn_3_11_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-3892C8553.02,-3892 8711.86,-3892 8711.86,-3892"/>
<polygon fill="red" stroke="red" points="8711.86,-3895.5 8721.86,-3892 8711.86,-3888.5 8711.86,-3895.5"/>
</g>
<!-- ring_attn_3_10_stage_5&#45;&gt;ring_attn_3_10_stage_6 -->
<g id="edge1051" class="edge">
<title>ring_attn_3_10_stage_5&#45;&gt;ring_attn_3_10_stage_6</title>
<path fill="none" stroke="black" d="M8344,-3570.87C8344,-3570.87 8344,-3464.25 8344,-3464.25"/>
<polygon fill="black" stroke="black" points="8347.5,-3464.25 8344,-3454.25 8340.5,-3464.25 8347.5,-3464.25"/>
</g>
<!-- ring_attn_3_11_stage_5 -->
<g id="node1159" class="node">
<title>ring_attn_3_11_stage_5</title>
<polygon fill="yellow" stroke="black" points="8931,-3707 8722,-3639 8931,-3571 9140,-3639 8931,-3707"/>
<text text-anchor="middle" x="8931" y="-3657.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-3642.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="8931" y="-3627.8" font-family="Times,serif" font-size="14.00">Q[11]×K[6]×V[6]</text>
<text text-anchor="middle" x="8931" y="-3612.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_10_stage_5&#45;&gt;ring_attn_3_11_stage_5 -->
<g id="edge2891" class="edge">
<title>ring_attn_3_10_stage_5&#45;&gt;ring_attn_3_11_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-3639C8553.02,-3639 8711.86,-3639 8711.86,-3639"/>
<polygon fill="red" stroke="red" points="8711.86,-3642.5 8721.86,-3639 8711.86,-3635.5 8711.86,-3642.5"/>
</g>
<!-- ring_attn_3_10_stage_6&#45;&gt;ring_attn_3_10_stage_7 -->
<g id="edge1052" class="edge">
<title>ring_attn_3_10_stage_6&#45;&gt;ring_attn_3_10_stage_7</title>
<path fill="none" stroke="black" d="M8344,-3317.87C8344,-3317.87 8344,-3211.25 8344,-3211.25"/>
<polygon fill="black" stroke="black" points="8347.5,-3211.25 8344,-3201.25 8340.5,-3211.25 8347.5,-3211.25"/>
</g>
<!-- ring_attn_3_11_stage_6 -->
<g id="node1160" class="node">
<title>ring_attn_3_11_stage_6</title>
<polygon fill="yellow" stroke="black" points="8931,-3454 8722,-3386 8931,-3318 9140,-3386 8931,-3454"/>
<text text-anchor="middle" x="8931" y="-3404.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-3389.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="8931" y="-3374.8" font-family="Times,serif" font-size="14.00">Q[11]×K[5]×V[5]</text>
<text text-anchor="middle" x="8931" y="-3359.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_10_stage_6&#45;&gt;ring_attn_3_11_stage_6 -->
<g id="edge2892" class="edge">
<title>ring_attn_3_10_stage_6&#45;&gt;ring_attn_3_11_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-3386C8553.02,-3386 8711.86,-3386 8711.86,-3386"/>
<polygon fill="red" stroke="red" points="8711.86,-3389.5 8721.86,-3386 8711.86,-3382.5 8711.86,-3389.5"/>
</g>
<!-- ring_attn_3_10_stage_7&#45;&gt;ring_attn_3_10_stage_8 -->
<g id="edge1053" class="edge">
<title>ring_attn_3_10_stage_7&#45;&gt;ring_attn_3_10_stage_8</title>
<path fill="none" stroke="black" d="M8344,-3064.87C8344,-3064.87 8344,-2958.25 8344,-2958.25"/>
<polygon fill="black" stroke="black" points="8347.5,-2958.25 8344,-2948.25 8340.5,-2958.25 8347.5,-2958.25"/>
</g>
<!-- ring_attn_3_11_stage_7 -->
<g id="node1161" class="node">
<title>ring_attn_3_11_stage_7</title>
<polygon fill="yellow" stroke="black" points="8931,-3201 8722,-3133 8931,-3065 9140,-3133 8931,-3201"/>
<text text-anchor="middle" x="8931" y="-3151.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-3136.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="8931" y="-3121.8" font-family="Times,serif" font-size="14.00">Q[11]×K[4]×V[4]</text>
<text text-anchor="middle" x="8931" y="-3106.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_10_stage_7&#45;&gt;ring_attn_3_11_stage_7 -->
<g id="edge2893" class="edge">
<title>ring_attn_3_10_stage_7&#45;&gt;ring_attn_3_11_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-3133C8553.02,-3133 8711.86,-3133 8711.86,-3133"/>
<polygon fill="red" stroke="red" points="8711.86,-3136.5 8721.86,-3133 8711.86,-3129.5 8711.86,-3136.5"/>
</g>
<!-- ring_attn_3_10_stage_8&#45;&gt;ring_attn_3_10_stage_9 -->
<g id="edge1054" class="edge">
<title>ring_attn_3_10_stage_8&#45;&gt;ring_attn_3_10_stage_9</title>
<path fill="none" stroke="black" d="M8344,-2811.87C8344,-2811.87 8344,-2705.25 8344,-2705.25"/>
<polygon fill="black" stroke="black" points="8347.5,-2705.25 8344,-2695.25 8340.5,-2705.25 8347.5,-2705.25"/>
</g>
<!-- ring_attn_3_11_stage_8 -->
<g id="node1162" class="node">
<title>ring_attn_3_11_stage_8</title>
<polygon fill="yellow" stroke="black" points="8931,-2948 8722,-2880 8931,-2812 9140,-2880 8931,-2948"/>
<text text-anchor="middle" x="8931" y="-2898.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-2883.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="8931" y="-2868.8" font-family="Times,serif" font-size="14.00">Q[11]×K[3]×V[3]</text>
<text text-anchor="middle" x="8931" y="-2853.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_10_stage_8&#45;&gt;ring_attn_3_11_stage_8 -->
<g id="edge2894" class="edge">
<title>ring_attn_3_10_stage_8&#45;&gt;ring_attn_3_11_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-2880C8553.02,-2880 8711.86,-2880 8711.86,-2880"/>
<polygon fill="red" stroke="red" points="8711.86,-2883.5 8721.86,-2880 8711.86,-2876.5 8711.86,-2883.5"/>
</g>
<!-- ring_attn_3_10_stage_9&#45;&gt;ring_attn_3_10_stage_10 -->
<g id="edge1055" class="edge">
<title>ring_attn_3_10_stage_9&#45;&gt;ring_attn_3_10_stage_10</title>
<path fill="none" stroke="black" d="M8344,-2558.87C8344,-2558.87 8344,-2452.25 8344,-2452.25"/>
<polygon fill="black" stroke="black" points="8347.5,-2452.25 8344,-2442.25 8340.5,-2452.25 8347.5,-2452.25"/>
</g>
<!-- ring_attn_3_11_stage_9 -->
<g id="node1163" class="node">
<title>ring_attn_3_11_stage_9</title>
<polygon fill="yellow" stroke="black" points="8931,-2695 8722,-2627 8931,-2559 9140,-2627 8931,-2695"/>
<text text-anchor="middle" x="8931" y="-2645.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-2630.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="8931" y="-2615.8" font-family="Times,serif" font-size="14.00">Q[11]×K[2]×V[2]</text>
<text text-anchor="middle" x="8931" y="-2600.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_10_stage_9&#45;&gt;ring_attn_3_11_stage_9 -->
<g id="edge2895" class="edge">
<title>ring_attn_3_10_stage_9&#45;&gt;ring_attn_3_11_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-2627C8553.02,-2627 8711.86,-2627 8711.86,-2627"/>
<polygon fill="red" stroke="red" points="8711.86,-2630.5 8721.86,-2627 8711.86,-2623.5 8711.86,-2630.5"/>
</g>
<!-- ring_attn_3_10_stage_10&#45;&gt;ring_attn_3_10_stage_11 -->
<g id="edge1056" class="edge">
<title>ring_attn_3_10_stage_10&#45;&gt;ring_attn_3_10_stage_11</title>
<path fill="none" stroke="black" d="M8344,-2305.87C8344,-2305.87 8344,-2199.25 8344,-2199.25"/>
<polygon fill="black" stroke="black" points="8347.5,-2199.25 8344,-2189.25 8340.5,-2199.25 8347.5,-2199.25"/>
</g>
<!-- ring_attn_3_11_stage_10 -->
<g id="node1164" class="node">
<title>ring_attn_3_11_stage_10</title>
<polygon fill="yellow" stroke="black" points="8931,-2442 8722,-2374 8931,-2306 9140,-2374 8931,-2442"/>
<text text-anchor="middle" x="8931" y="-2392.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-2377.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="8931" y="-2362.8" font-family="Times,serif" font-size="14.00">Q[11]×K[1]×V[1]</text>
<text text-anchor="middle" x="8931" y="-2347.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_10_stage_10&#45;&gt;ring_attn_3_11_stage_10 -->
<g id="edge2896" class="edge">
<title>ring_attn_3_10_stage_10&#45;&gt;ring_attn_3_11_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-2374C8553.02,-2374 8711.86,-2374 8711.86,-2374"/>
<polygon fill="red" stroke="red" points="8711.86,-2377.5 8721.86,-2374 8711.86,-2370.5 8711.86,-2377.5"/>
</g>
<!-- ring_attn_3_10_stage_11&#45;&gt;ring_attn_3_10_stage_12 -->
<g id="edge1057" class="edge">
<title>ring_attn_3_10_stage_11&#45;&gt;ring_attn_3_10_stage_12</title>
<path fill="none" stroke="black" d="M8344,-2052.87C8344,-2052.87 8344,-1946.25 8344,-1946.25"/>
<polygon fill="black" stroke="black" points="8347.5,-1946.25 8344,-1936.25 8340.5,-1946.25 8347.5,-1946.25"/>
</g>
<!-- ring_attn_3_11_stage_11 -->
<g id="node1165" class="node">
<title>ring_attn_3_11_stage_11</title>
<polygon fill="yellow" stroke="black" points="8931,-2189 8722,-2121 8931,-2053 9140,-2121 8931,-2189"/>
<text text-anchor="middle" x="8931" y="-2139.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-2124.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="8931" y="-2109.8" font-family="Times,serif" font-size="14.00">Q[11]×K[0]×V[0]</text>
<text text-anchor="middle" x="8931" y="-2094.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_10_stage_11&#45;&gt;ring_attn_3_11_stage_11 -->
<g id="edge2897" class="edge">
<title>ring_attn_3_10_stage_11&#45;&gt;ring_attn_3_11_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-2121C8553.02,-2121 8711.86,-2121 8711.86,-2121"/>
<polygon fill="red" stroke="red" points="8711.86,-2124.5 8721.86,-2121 8711.86,-2117.5 8711.86,-2124.5"/>
</g>
<!-- ring_attn_3_10_stage_12&#45;&gt;ring_attn_3_10_stage_13 -->
<g id="edge1058" class="edge">
<title>ring_attn_3_10_stage_12&#45;&gt;ring_attn_3_10_stage_13</title>
<path fill="none" stroke="black" d="M8344,-1799.87C8344,-1799.87 8344,-1693.25 8344,-1693.25"/>
<polygon fill="black" stroke="black" points="8347.5,-1693.25 8344,-1683.25 8340.5,-1693.25 8347.5,-1693.25"/>
</g>
<!-- ring_attn_3_11_stage_12 -->
<g id="node1166" class="node">
<title>ring_attn_3_11_stage_12</title>
<polygon fill="yellow" stroke="black" points="8931,-1936 8722,-1868 8931,-1800 9140,-1868 8931,-1936"/>
<text text-anchor="middle" x="8931" y="-1886.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-1871.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="8931" y="-1856.8" font-family="Times,serif" font-size="14.00">Q[11]×K[15]×V[15]</text>
<text text-anchor="middle" x="8931" y="-1841.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_10_stage_12&#45;&gt;ring_attn_3_11_stage_12 -->
<g id="edge2898" class="edge">
<title>ring_attn_3_10_stage_12&#45;&gt;ring_attn_3_11_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-1868C8553.02,-1868 8711.86,-1868 8711.86,-1868"/>
<polygon fill="red" stroke="red" points="8711.86,-1871.5 8721.86,-1868 8711.86,-1864.5 8711.86,-1871.5"/>
</g>
<!-- ring_attn_3_10_stage_13&#45;&gt;ring_attn_3_10_stage_14 -->
<g id="edge1059" class="edge">
<title>ring_attn_3_10_stage_13&#45;&gt;ring_attn_3_10_stage_14</title>
<path fill="none" stroke="black" d="M8344,-1546.87C8344,-1546.87 8344,-1440.25 8344,-1440.25"/>
<polygon fill="black" stroke="black" points="8347.5,-1440.25 8344,-1430.25 8340.5,-1440.25 8347.5,-1440.25"/>
</g>
<!-- ring_attn_3_11_stage_13 -->
<g id="node1167" class="node">
<title>ring_attn_3_11_stage_13</title>
<polygon fill="yellow" stroke="black" points="8931,-1683 8722,-1615 8931,-1547 9140,-1615 8931,-1683"/>
<text text-anchor="middle" x="8931" y="-1633.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-1618.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="8931" y="-1603.8" font-family="Times,serif" font-size="14.00">Q[11]×K[14]×V[14]</text>
<text text-anchor="middle" x="8931" y="-1588.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_10_stage_13&#45;&gt;ring_attn_3_11_stage_13 -->
<g id="edge2899" class="edge">
<title>ring_attn_3_10_stage_13&#45;&gt;ring_attn_3_11_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-1615C8553.02,-1615 8711.86,-1615 8711.86,-1615"/>
<polygon fill="red" stroke="red" points="8711.86,-1618.5 8721.86,-1615 8711.86,-1611.5 8711.86,-1618.5"/>
</g>
<!-- ring_attn_3_10_stage_14&#45;&gt;ring_attn_3_10_stage_15 -->
<g id="edge1060" class="edge">
<title>ring_attn_3_10_stage_14&#45;&gt;ring_attn_3_10_stage_15</title>
<path fill="none" stroke="black" d="M8344,-1293.87C8344,-1293.87 8344,-1187.25 8344,-1187.25"/>
<polygon fill="black" stroke="black" points="8347.5,-1187.25 8344,-1177.25 8340.5,-1187.25 8347.5,-1187.25"/>
</g>
<!-- ring_attn_3_11_stage_14 -->
<g id="node1168" class="node">
<title>ring_attn_3_11_stage_14</title>
<polygon fill="yellow" stroke="black" points="8931,-1430 8722,-1362 8931,-1294 9140,-1362 8931,-1430"/>
<text text-anchor="middle" x="8931" y="-1380.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-1365.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="8931" y="-1350.8" font-family="Times,serif" font-size="14.00">Q[11]×K[13]×V[13]</text>
<text text-anchor="middle" x="8931" y="-1335.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_10_stage_14&#45;&gt;ring_attn_3_11_stage_14 -->
<g id="edge2900" class="edge">
<title>ring_attn_3_10_stage_14&#45;&gt;ring_attn_3_11_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-1362C8553.02,-1362 8711.86,-1362 8711.86,-1362"/>
<polygon fill="red" stroke="red" points="8711.86,-1365.5 8721.86,-1362 8711.86,-1358.5 8711.86,-1365.5"/>
</g>
<!-- attn_out_3_10 -->
<g id="node1072" class="node">
<title>attn_out_3_10</title>
<polygon fill="none" stroke="black" points="8413.5,-968 8274.5,-968 8274.5,-915 8413.5,-915 8413.5,-968"/>
<text text-anchor="middle" x="8344" y="-952.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="8344" y="-937.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="8344" y="-922.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_3_10_stage_15&#45;&gt;attn_out_3_10 -->
<g id="edge1061" class="edge">
<title>ring_attn_3_10_stage_15&#45;&gt;attn_out_3_10</title>
<path fill="none" stroke="black" d="M8344,-1040.87C8344,-1040.87 8344,-978.18 8344,-978.18"/>
<polygon fill="black" stroke="black" points="8347.5,-978.18 8344,-968.18 8340.5,-978.18 8347.5,-978.18"/>
</g>
<!-- ring_attn_3_11_stage_15 -->
<g id="node1169" class="node">
<title>ring_attn_3_11_stage_15</title>
<polygon fill="yellow" stroke="black" points="8931,-1177 8722,-1109 8931,-1041 9140,-1109 8931,-1177"/>
<text text-anchor="middle" x="8931" y="-1127.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="8931" y="-1112.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="8931" y="-1097.8" font-family="Times,serif" font-size="14.00">Q[11]×K[12]×V[12]</text>
<text text-anchor="middle" x="8931" y="-1082.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_10_stage_15&#45;&gt;ring_attn_3_11_stage_15 -->
<g id="edge2901" class="edge">
<title>ring_attn_3_10_stage_15&#45;&gt;ring_attn_3_11_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8553.02,-1109C8553.02,-1109 8711.86,-1109 8711.86,-1109"/>
<polygon fill="red" stroke="red" points="8711.86,-1112.5 8721.86,-1109 8711.86,-1105.5 8711.86,-1112.5"/>
</g>
<!-- attn_residual_3_10 -->
<g id="node1073" class="node">
<title>attn_residual_3_10</title>
<ellipse fill="none" stroke="black" cx="8344" cy="-815" rx="105.5" ry="27"/>
<text text-anchor="middle" x="8344" y="-818.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="8344" y="-803.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_3_10&#45;&gt;attn_residual_3_10 -->
<g id="edge1062" class="edge">
<title>attn_out_3_10&#45;&gt;attn_residual_3_10</title>
<path fill="none" stroke="black" d="M8344,-914.98C8344,-914.98 8344,-852.36 8344,-852.36"/>
<polygon fill="black" stroke="black" points="8347.5,-852.36 8344,-842.36 8340.5,-852.36 8347.5,-852.36"/>
</g>
<!-- gate_3_10 -->
<g id="node1074" class="node">
<title>gate_3_10</title>
<ellipse fill="orange" stroke="black" cx="8344" cy="-677.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="8344" y="-688.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="8344" y="-673.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="8344" y="-658.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_3_10&#45;&gt;gate_3_10 -->
<g id="edge1063" class="edge">
<title>attn_residual_3_10&#45;&gt;gate_3_10</title>
<path fill="none" stroke="black" d="M8396.75,-791.36C8396.75,-791.36 8396.75,-720.08 8396.75,-720.08"/>
<polygon fill="black" stroke="black" points="8400.25,-720.08 8396.75,-710.08 8393.25,-720.08 8400.25,-720.08"/>
</g>
<!-- gate_3_10&#45;&gt;expert_3_0_0 -->
<g id="edge2902" class="edge">
<title>gate_3_10&#45;&gt;expert_3_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8344,-715.02C8344,-742.86 8344,-776 8344,-776 8344,-776 114.1,-776 114.1,-776 114.1,-776 114.1,-518.15 114.1,-518.15"/>
<polygon fill="blue" stroke="blue" points="117.6,-518.15 114.1,-508.15 110.6,-518.15 117.6,-518.15"/>
<text text-anchor="middle" x="35096.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35096.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU10→GPU0</text>
<text text-anchor="middle" x="35096.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35096.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_10&#45;&gt;expert_3_1_0 -->
<g id="edge2903" class="edge">
<title>gate_3_10&#45;&gt;expert_3_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8291.25,-710.11C8291.25,-722.19 8291.25,-733 8291.25,-733 8291.25,-733 3170.36,-733 3170.36,-733 3170.36,-733 3170.36,-518.41 3170.36,-518.41"/>
<polygon fill="blue" stroke="blue" points="3173.86,-518.41 3170.36,-508.41 3166.86,-518.41 3173.86,-518.41"/>
<text text-anchor="middle" x="35270.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35270.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU10→GPU1</text>
<text text-anchor="middle" x="35270.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35270.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_10&#45;&gt;expert_3_2_0 -->
<g id="edge2904" class="edge">
<title>gate_3_10&#45;&gt;expert_3_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8248.55,-661.35C8248.55,-627.45 8248.55,-552 8248.55,-552 8248.55,-552 3612.83,-552 3612.83,-552 3612.83,-552 3612.83,-518.15 3612.83,-518.15"/>
<polygon fill="blue" stroke="blue" points="3616.33,-518.15 3612.83,-508.15 3609.33,-518.15 3616.33,-518.15"/>
<text text-anchor="middle" x="35444.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35444.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU10→GPU2</text>
<text text-anchor="middle" x="35444.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35444.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_10&#45;&gt;expert_3_3_0 -->
<g id="edge2905" class="edge">
<title>gate_3_10&#45;&gt;expert_3_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8268.64,-651.14C8268.64,-615.4 8268.64,-556 8268.64,-556 8268.64,-556 4205.46,-556 4205.46,-556 4205.46,-556 4205.46,-518.4 4205.46,-518.4"/>
<polygon fill="blue" stroke="blue" points="4208.96,-518.4 4205.46,-508.4 4201.96,-518.4 4208.96,-518.4"/>
<text text-anchor="middle" x="35618.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35618.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU10→GPU3</text>
<text text-anchor="middle" x="35618.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35618.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_10&#45;&gt;expert_3_4_0 -->
<g id="edge2906" class="edge">
<title>gate_3_10&#45;&gt;expert_3_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8288.74,-645.26C8288.74,-612.02 8288.74,-565 8288.74,-565 8288.74,-565 4806.93,-565 4806.93,-565 4806.93,-565 4806.93,-518.38 4806.93,-518.38"/>
<polygon fill="blue" stroke="blue" points="4810.43,-518.38 4806.93,-508.38 4803.43,-518.38 4810.43,-518.38"/>
<text text-anchor="middle" x="35792.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35792.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU10→GPU4</text>
<text text-anchor="middle" x="35792.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35792.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_10&#45;&gt;expert_3_5_0 -->
<g id="edge2907" class="edge">
<title>gate_3_10&#45;&gt;expert_3_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8308.83,-642.12C8308.83,-611.8 8308.83,-573 8308.83,-573 8308.83,-573 5403.98,-573 5403.98,-573 5403.98,-573 5403.98,-518.46 5403.98,-518.46"/>
<polygon fill="blue" stroke="blue" points="5407.48,-518.46 5403.98,-508.46 5400.48,-518.46 5407.48,-518.46"/>
<text text-anchor="middle" x="35966.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="35966.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU10→GPU5</text>
<text text-anchor="middle" x="35966.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="35966.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_10&#45;&gt;expert_3_6_0 -->
<g id="edge2908" class="edge">
<title>gate_3_10&#45;&gt;expert_3_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8328.93,-640.31C8328.93,-616.87 8328.93,-591 8328.93,-591 8328.93,-591 5985.45,-591 5985.45,-591 5985.45,-591 5985.45,-518.01 5985.45,-518.01"/>
<polygon fill="blue" stroke="blue" points="5988.95,-518.01 5985.45,-508.01 5981.95,-518.01 5988.95,-518.01"/>
<text text-anchor="middle" x="36140.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="36140.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU10→GPU6</text>
<text text-anchor="middle" x="36140.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="36140.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_10&#45;&gt;expert_3_7_0 -->
<g id="edge2909" class="edge">
<title>gate_3_10&#45;&gt;expert_3_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8349.02,-639.61C8349.02,-618.73 8349.02,-597 8349.02,-597 8349.02,-597 6577.98,-597 6577.98,-597 6577.98,-597 6577.98,-518.29 6577.98,-518.29"/>
<polygon fill="blue" stroke="blue" points="6581.48,-518.29 6577.98,-508.29 6574.48,-518.29 6581.48,-518.29"/>
<text text-anchor="middle" x="36314.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="36314.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU10→GPU7</text>
<text text-anchor="middle" x="36314.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="36314.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_10&#45;&gt;expert_3_8_0 -->
<g id="edge2910" class="edge">
<title>gate_3_10&#45;&gt;expert_3_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8359.07,-640.07C8359.07,-634.19 8359.07,-630 8359.07,-630 8359.07,-630 7284.5,-630 7284.5,-630 7284.5,-630 7284.5,-518.05 7284.5,-518.05"/>
<polygon fill="blue" stroke="blue" points="7288,-518.05 7284.5,-508.05 7281,-518.05 7288,-518.05"/>
<text text-anchor="middle" x="36488.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="36488.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU10→GPU8</text>
<text text-anchor="middle" x="36488.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="36488.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_10&#45;&gt;expert_3_9_0 -->
<g id="edge2911" class="edge">
<title>gate_3_10&#45;&gt;expert_3_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8244.3,-690C8104.46,-690 7867,-690 7867,-690 7867,-690 7867,-518.33 7867,-518.33"/>
<polygon fill="blue" stroke="blue" points="7870.5,-518.33 7867,-508.33 7863.5,-518.33 7870.5,-518.33"/>
<text text-anchor="middle" x="36662.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="36662.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU10→GPU9</text>
<text text-anchor="middle" x="36662.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="36662.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_10&#45;&gt;expert_3_10_0 -->
<g id="edge1064" class="edge">
<title>gate_3_10&#45;&gt;expert_3_10_0</title>
<path fill="none" stroke="black" d="M8369.12,-640.63C8369.12,-640.63 8369.12,-518.14 8369.12,-518.14"/>
<polygon fill="black" stroke="black" points="8372.62,-518.14 8369.12,-508.14 8365.62,-518.14 8372.62,-518.14"/>
</g>
<!-- gate_3_10&#45;&gt;expert_3_11_0 -->
<g id="edge2912" class="edge">
<title>gate_3_10&#45;&gt;expert_3_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8443.65,-665C8583.77,-665 8822.12,-665 8822.12,-665 8822.12,-665 8822.12,-518.18 8822.12,-518.18"/>
<polygon fill="blue" stroke="blue" points="8825.63,-518.18 8822.12,-508.18 8818.63,-518.18 8825.63,-518.18"/>
<text text-anchor="middle" x="36836.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="36836.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU10→GPU11</text>
<text text-anchor="middle" x="36836.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="36836.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_10&#45;&gt;expert_3_12_0 -->
<g id="edge2913" class="edge">
<title>gate_3_10&#45;&gt;expert_3_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8409.31,-647.93C8409.31,-635.56 8409.31,-624 8409.31,-624 8409.31,-624 9405.75,-624 9405.75,-624 9405.75,-624 9405.75,-518.3 9405.75,-518.3"/>
<polygon fill="blue" stroke="blue" points="9409.25,-518.3 9405.75,-508.3 9402.25,-518.3 9409.25,-518.3"/>
<text text-anchor="middle" x="37010.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37010.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU10→GPU12</text>
<text text-anchor="middle" x="37010.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37010.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_10&#45;&gt;expert_3_13_0 -->
<g id="edge2914" class="edge">
<title>gate_3_10&#45;&gt;expert_3_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8419.36,-651.03C8419.36,-624.01 8419.36,-586 8419.36,-586 8419.36,-586 9989.38,-586 9989.38,-586 9989.38,-586 9989.38,-518.14 9989.38,-518.14"/>
<polygon fill="blue" stroke="blue" points="9992.88,-518.14 9989.38,-508.14 9985.88,-518.14 9992.88,-518.14"/>
<text text-anchor="middle" x="37184.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37184.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU10→GPU13</text>
<text text-anchor="middle" x="37184.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37184.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_10&#45;&gt;expert_3_14_0 -->
<g id="edge2915" class="edge">
<title>gate_3_10&#45;&gt;expert_3_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8429.4,-655.48C8429.4,-625.62 8429.4,-576 8429.4,-576 8429.4,-576 10757.31,-576 10757.31,-576 10757.31,-576 10757.31,-518.08 10757.31,-518.08"/>
<polygon fill="blue" stroke="blue" points="10760.81,-518.07 10757.31,-508.08 10753.81,-518.08 10760.81,-518.07"/>
<text text-anchor="middle" x="37358.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37358.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU10→GPU14</text>
<text text-anchor="middle" x="37358.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37358.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_10&#45;&gt;expert_3_15_0 -->
<g id="edge2916" class="edge">
<title>gate_3_10&#45;&gt;expert_3_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8439.45,-661.51C8439.45,-633.39 8439.45,-578 8439.45,-578 8439.45,-578 11328.97,-578 11328.97,-578 11328.97,-578 11328.97,-518.12 11328.97,-518.12"/>
<polygon fill="blue" stroke="blue" points="11332.47,-518.12 11328.97,-508.12 11325.47,-518.12 11332.47,-518.12"/>
<text text-anchor="middle" x="37532.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37532.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU10→GPU15</text>
<text text-anchor="middle" x="37532.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37532.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_10 -->
<g id="node1076" class="node">
<title>expert_reduce_3_10</title>
<ellipse fill="none" stroke="black" cx="8344" cy="-344.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="8344" y="-355.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="8344" y="-340.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="8344" y="-325.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_10_0&#45;&gt;expert_reduce_3_10 -->
<g id="edge1065" class="edge">
<title>expert_3_10_0&#45;&gt;expert_reduce_3_10</title>
<path fill="none" stroke="black" d="M8344,-454.76C8344,-454.76 8344,-392.06 8344,-392.06"/>
<polygon fill="black" stroke="black" points="8347.5,-392.06 8344,-382.06 8340.5,-392.06 8347.5,-392.06"/>
</g>
<!-- moe_residual_3_10 -->
<g id="node1077" class="node">
<title>moe_residual_3_10</title>
<ellipse fill="none" stroke="black" cx="8344" cy="-207" rx="105.5" ry="27"/>
<text text-anchor="middle" x="8344" y="-210.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="8344" y="-195.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_10&#45;&gt;moe_residual_3_10 -->
<g id="edge1066" class="edge">
<title>expert_reduce_3_10&#45;&gt;moe_residual_3_10</title>
<path fill="none" stroke="black" d="M8344,-306.93C8344,-306.93 8344,-244.06 8344,-244.06"/>
<polygon fill="black" stroke="black" points="8347.5,-244.06 8344,-234.06 8340.5,-244.06 8347.5,-244.06"/>
</g>
<!-- output_10 -->
<g id="node1078" class="node">
<title>output_10</title>
<polygon fill="lightcoral" stroke="black" points="8441.5,-107 8246.5,-107 8246.5,-69 8441.5,-69 8441.5,-107"/>
<text text-anchor="middle" x="8344" y="-91.8" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="8344" y="-76.8" font-family="Times,serif" font-size="14.00">Y[10]: 1024×1024×4096</text>
</g>
<!-- moe_residual_3_10&#45;&gt;output_10 -->
<g id="edge1067" class="edge">
<title>moe_residual_3_10&#45;&gt;output_10</title>
<path fill="none" stroke="black" d="M8344,-180C8344,-180 8344,-117.12 8344,-117.12"/>
<polygon fill="black" stroke="black" points="8347.5,-117.12 8344,-107.12 8340.5,-117.12 8347.5,-117.12"/>
</g>
<!-- input_11 -->
<g id="node1079" class="node">
<title>input_11</title>
<polygon fill="lightgreen" stroke="black" points="9029,-20866 8833,-20866 8833,-20828 9029,-20828 9029,-20866"/>
<text text-anchor="middle" x="8931" y="-20850.8" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="8931" y="-20835.8" font-family="Times,serif" font-size="14.00">X[11]: 1024×1024×4096</text>
</g>
<!-- qkv_proj_0_11 -->
<g id="node1080" class="node">
<title>qkv_proj_0_11</title>
<polygon fill="none" stroke="black" points="9013.5,-20755 8848.5,-20755 8848.5,-20702 9013.5,-20702 9013.5,-20755"/>
<text text-anchor="middle" x="8931" y="-20739.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="8931" y="-20724.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="8931" y="-20709.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- input_11&#45;&gt;qkv_proj_0_11 -->
<g id="edge1068" class="edge">
<title>input_11&#45;&gt;qkv_proj_0_11</title>
<path fill="none" stroke="black" d="M8931,-20827.96C8931,-20827.96 8931,-20765.44 8931,-20765.44"/>
<polygon fill="black" stroke="black" points="8934.5,-20765.44 8931,-20755.44 8927.5,-20765.44 8934.5,-20765.44"/>
</g>
<!-- qkv_reshape_0_11 -->
<g id="node1081" class="node">
<title>qkv_reshape_0_11</title>
<ellipse fill="none" stroke="black" cx="8931" cy="-20602" rx="148" ry="27"/>
<text text-anchor="middle" x="8931" y="-20605.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="8931" y="-20590.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_0_11&#45;&gt;qkv_reshape_0_11 -->
<g id="edge1069" class="edge">
<title>qkv_proj_0_11&#45;&gt;qkv_reshape_0_11</title>
<path fill="none" stroke="black" d="M8931,-20701.98C8931,-20701.98 8931,-20639.36 8931,-20639.36"/>
<polygon fill="black" stroke="black" points="8934.5,-20639.36 8931,-20629.36 8927.5,-20639.36 8934.5,-20639.36"/>
</g>
<!-- qkv_reshape_0_11&#45;&gt;ring_attn_0_11_stage_0 -->
<g id="edge1070" class="edge">
<title>qkv_reshape_0_11&#45;&gt;ring_attn_0_11_stage_0</title>
<path fill="none" stroke="black" d="M8931,-20574.72C8931,-20574.72 8931,-20468.16 8931,-20468.16"/>
<polygon fill="black" stroke="black" points="8934.5,-20468.16 8931,-20458.16 8927.5,-20468.16 8934.5,-20468.16"/>
</g>
<!-- ring_attn_0_11_stage_0&#45;&gt;ring_attn_0_11_stage_1 -->
<g id="edge1071" class="edge">
<title>ring_attn_0_11_stage_0&#45;&gt;ring_attn_0_11_stage_1</title>
<path fill="none" stroke="black" d="M8931,-20321.87C8931,-20321.87 8931,-20215.25 8931,-20215.25"/>
<polygon fill="black" stroke="black" points="8934.5,-20215.25 8931,-20205.25 8927.5,-20215.25 8934.5,-20215.25"/>
</g>
<!-- ring_attn_0_12_stage_0 -->
<g id="node1180" class="node">
<title>ring_attn_0_12_stage_0</title>
<polygon fill="yellow" stroke="black" points="9518,-20458 9309,-20390 9518,-20322 9727,-20390 9518,-20458"/>
<text text-anchor="middle" x="9518" y="-20408.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-20393.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="9518" y="-20378.8" font-family="Times,serif" font-size="14.00">Q[12]×K[12]×V[12]</text>
<text text-anchor="middle" x="9518" y="-20363.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_11_stage_0&#45;&gt;ring_attn_0_12_stage_0 -->
<g id="edge2917" class="edge">
<title>ring_attn_0_11_stage_0&#45;&gt;ring_attn_0_12_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-20390C9140.02,-20390 9298.86,-20390 9298.86,-20390"/>
<polygon fill="red" stroke="red" points="9298.86,-20393.5 9308.86,-20390 9298.86,-20386.5 9298.86,-20393.5"/>
</g>
<!-- ring_attn_0_11_stage_1&#45;&gt;ring_attn_0_11_stage_2 -->
<g id="edge1072" class="edge">
<title>ring_attn_0_11_stage_1&#45;&gt;ring_attn_0_11_stage_2</title>
<path fill="none" stroke="black" d="M8931,-20068.87C8931,-20068.87 8931,-19962.25 8931,-19962.25"/>
<polygon fill="black" stroke="black" points="8934.5,-19962.25 8931,-19952.25 8927.5,-19962.25 8934.5,-19962.25"/>
</g>
<!-- ring_attn_0_12_stage_1 -->
<g id="node1181" class="node">
<title>ring_attn_0_12_stage_1</title>
<polygon fill="yellow" stroke="black" points="9518,-20205 9309,-20137 9518,-20069 9727,-20137 9518,-20205"/>
<text text-anchor="middle" x="9518" y="-20155.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-20140.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="9518" y="-20125.8" font-family="Times,serif" font-size="14.00">Q[12]×K[11]×V[11]</text>
<text text-anchor="middle" x="9518" y="-20110.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_11_stage_1&#45;&gt;ring_attn_0_12_stage_1 -->
<g id="edge2918" class="edge">
<title>ring_attn_0_11_stage_1&#45;&gt;ring_attn_0_12_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-20137C9140.02,-20137 9298.86,-20137 9298.86,-20137"/>
<polygon fill="red" stroke="red" points="9298.86,-20140.5 9308.86,-20137 9298.86,-20133.5 9298.86,-20140.5"/>
</g>
<!-- ring_attn_0_11_stage_2&#45;&gt;ring_attn_0_11_stage_3 -->
<g id="edge1073" class="edge">
<title>ring_attn_0_11_stage_2&#45;&gt;ring_attn_0_11_stage_3</title>
<path fill="none" stroke="black" d="M8931,-19815.87C8931,-19815.87 8931,-19709.25 8931,-19709.25"/>
<polygon fill="black" stroke="black" points="8934.5,-19709.25 8931,-19699.25 8927.5,-19709.25 8934.5,-19709.25"/>
</g>
<!-- ring_attn_0_12_stage_2 -->
<g id="node1182" class="node">
<title>ring_attn_0_12_stage_2</title>
<polygon fill="yellow" stroke="black" points="9518,-19952 9309,-19884 9518,-19816 9727,-19884 9518,-19952"/>
<text text-anchor="middle" x="9518" y="-19902.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-19887.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="9518" y="-19872.8" font-family="Times,serif" font-size="14.00">Q[12]×K[10]×V[10]</text>
<text text-anchor="middle" x="9518" y="-19857.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_11_stage_2&#45;&gt;ring_attn_0_12_stage_2 -->
<g id="edge2919" class="edge">
<title>ring_attn_0_11_stage_2&#45;&gt;ring_attn_0_12_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-19884C9140.02,-19884 9298.86,-19884 9298.86,-19884"/>
<polygon fill="red" stroke="red" points="9298.86,-19887.5 9308.86,-19884 9298.86,-19880.5 9298.86,-19887.5"/>
</g>
<!-- ring_attn_0_11_stage_3&#45;&gt;ring_attn_0_11_stage_4 -->
<g id="edge1074" class="edge">
<title>ring_attn_0_11_stage_3&#45;&gt;ring_attn_0_11_stage_4</title>
<path fill="none" stroke="black" d="M8931,-19562.87C8931,-19562.87 8931,-19456.25 8931,-19456.25"/>
<polygon fill="black" stroke="black" points="8934.5,-19456.25 8931,-19446.25 8927.5,-19456.25 8934.5,-19456.25"/>
</g>
<!-- ring_attn_0_12_stage_3 -->
<g id="node1183" class="node">
<title>ring_attn_0_12_stage_3</title>
<polygon fill="yellow" stroke="black" points="9518,-19699 9309,-19631 9518,-19563 9727,-19631 9518,-19699"/>
<text text-anchor="middle" x="9518" y="-19649.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-19634.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="9518" y="-19619.8" font-family="Times,serif" font-size="14.00">Q[12]×K[9]×V[9]</text>
<text text-anchor="middle" x="9518" y="-19604.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_11_stage_3&#45;&gt;ring_attn_0_12_stage_3 -->
<g id="edge2920" class="edge">
<title>ring_attn_0_11_stage_3&#45;&gt;ring_attn_0_12_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-19631C9140.02,-19631 9298.86,-19631 9298.86,-19631"/>
<polygon fill="red" stroke="red" points="9298.86,-19634.5 9308.86,-19631 9298.86,-19627.5 9298.86,-19634.5"/>
</g>
<!-- ring_attn_0_11_stage_4&#45;&gt;ring_attn_0_11_stage_5 -->
<g id="edge1075" class="edge">
<title>ring_attn_0_11_stage_4&#45;&gt;ring_attn_0_11_stage_5</title>
<path fill="none" stroke="black" d="M8931,-19309.87C8931,-19309.87 8931,-19203.25 8931,-19203.25"/>
<polygon fill="black" stroke="black" points="8934.5,-19203.25 8931,-19193.25 8927.5,-19203.25 8934.5,-19203.25"/>
</g>
<!-- ring_attn_0_12_stage_4 -->
<g id="node1184" class="node">
<title>ring_attn_0_12_stage_4</title>
<polygon fill="yellow" stroke="black" points="9518,-19446 9309,-19378 9518,-19310 9727,-19378 9518,-19446"/>
<text text-anchor="middle" x="9518" y="-19396.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-19381.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="9518" y="-19366.8" font-family="Times,serif" font-size="14.00">Q[12]×K[8]×V[8]</text>
<text text-anchor="middle" x="9518" y="-19351.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_11_stage_4&#45;&gt;ring_attn_0_12_stage_4 -->
<g id="edge2921" class="edge">
<title>ring_attn_0_11_stage_4&#45;&gt;ring_attn_0_12_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-19378C9140.02,-19378 9298.86,-19378 9298.86,-19378"/>
<polygon fill="red" stroke="red" points="9298.86,-19381.5 9308.86,-19378 9298.86,-19374.5 9298.86,-19381.5"/>
</g>
<!-- ring_attn_0_11_stage_5&#45;&gt;ring_attn_0_11_stage_6 -->
<g id="edge1076" class="edge">
<title>ring_attn_0_11_stage_5&#45;&gt;ring_attn_0_11_stage_6</title>
<path fill="none" stroke="black" d="M8931,-19056.87C8931,-19056.87 8931,-18950.25 8931,-18950.25"/>
<polygon fill="black" stroke="black" points="8934.5,-18950.25 8931,-18940.25 8927.5,-18950.25 8934.5,-18950.25"/>
</g>
<!-- ring_attn_0_12_stage_5 -->
<g id="node1185" class="node">
<title>ring_attn_0_12_stage_5</title>
<polygon fill="yellow" stroke="black" points="9518,-19193 9309,-19125 9518,-19057 9727,-19125 9518,-19193"/>
<text text-anchor="middle" x="9518" y="-19143.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-19128.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="9518" y="-19113.8" font-family="Times,serif" font-size="14.00">Q[12]×K[7]×V[7]</text>
<text text-anchor="middle" x="9518" y="-19098.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_11_stage_5&#45;&gt;ring_attn_0_12_stage_5 -->
<g id="edge2922" class="edge">
<title>ring_attn_0_11_stage_5&#45;&gt;ring_attn_0_12_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-19125C9140.02,-19125 9298.86,-19125 9298.86,-19125"/>
<polygon fill="red" stroke="red" points="9298.86,-19128.5 9308.86,-19125 9298.86,-19121.5 9298.86,-19128.5"/>
</g>
<!-- ring_attn_0_11_stage_6&#45;&gt;ring_attn_0_11_stage_7 -->
<g id="edge1077" class="edge">
<title>ring_attn_0_11_stage_6&#45;&gt;ring_attn_0_11_stage_7</title>
<path fill="none" stroke="black" d="M8931,-18803.87C8931,-18803.87 8931,-18697.25 8931,-18697.25"/>
<polygon fill="black" stroke="black" points="8934.5,-18697.25 8931,-18687.25 8927.5,-18697.25 8934.5,-18697.25"/>
</g>
<!-- ring_attn_0_12_stage_6 -->
<g id="node1186" class="node">
<title>ring_attn_0_12_stage_6</title>
<polygon fill="yellow" stroke="black" points="9518,-18940 9309,-18872 9518,-18804 9727,-18872 9518,-18940"/>
<text text-anchor="middle" x="9518" y="-18890.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-18875.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="9518" y="-18860.8" font-family="Times,serif" font-size="14.00">Q[12]×K[6]×V[6]</text>
<text text-anchor="middle" x="9518" y="-18845.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_11_stage_6&#45;&gt;ring_attn_0_12_stage_6 -->
<g id="edge2923" class="edge">
<title>ring_attn_0_11_stage_6&#45;&gt;ring_attn_0_12_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-18872C9140.02,-18872 9298.86,-18872 9298.86,-18872"/>
<polygon fill="red" stroke="red" points="9298.86,-18875.5 9308.86,-18872 9298.86,-18868.5 9298.86,-18875.5"/>
</g>
<!-- ring_attn_0_11_stage_7&#45;&gt;ring_attn_0_11_stage_8 -->
<g id="edge1078" class="edge">
<title>ring_attn_0_11_stage_7&#45;&gt;ring_attn_0_11_stage_8</title>
<path fill="none" stroke="black" d="M8931,-18550.87C8931,-18550.87 8931,-18444.25 8931,-18444.25"/>
<polygon fill="black" stroke="black" points="8934.5,-18444.25 8931,-18434.25 8927.5,-18444.25 8934.5,-18444.25"/>
</g>
<!-- ring_attn_0_12_stage_7 -->
<g id="node1187" class="node">
<title>ring_attn_0_12_stage_7</title>
<polygon fill="yellow" stroke="black" points="9518,-18687 9309,-18619 9518,-18551 9727,-18619 9518,-18687"/>
<text text-anchor="middle" x="9518" y="-18637.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-18622.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="9518" y="-18607.8" font-family="Times,serif" font-size="14.00">Q[12]×K[5]×V[5]</text>
<text text-anchor="middle" x="9518" y="-18592.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_11_stage_7&#45;&gt;ring_attn_0_12_stage_7 -->
<g id="edge2924" class="edge">
<title>ring_attn_0_11_stage_7&#45;&gt;ring_attn_0_12_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-18619C9140.02,-18619 9298.86,-18619 9298.86,-18619"/>
<polygon fill="red" stroke="red" points="9298.86,-18622.5 9308.86,-18619 9298.86,-18615.5 9298.86,-18622.5"/>
</g>
<!-- ring_attn_0_11_stage_8&#45;&gt;ring_attn_0_11_stage_9 -->
<g id="edge1079" class="edge">
<title>ring_attn_0_11_stage_8&#45;&gt;ring_attn_0_11_stage_9</title>
<path fill="none" stroke="black" d="M8931,-18297.87C8931,-18297.87 8931,-18191.25 8931,-18191.25"/>
<polygon fill="black" stroke="black" points="8934.5,-18191.25 8931,-18181.25 8927.5,-18191.25 8934.5,-18191.25"/>
</g>
<!-- ring_attn_0_12_stage_8 -->
<g id="node1188" class="node">
<title>ring_attn_0_12_stage_8</title>
<polygon fill="yellow" stroke="black" points="9518,-18434 9309,-18366 9518,-18298 9727,-18366 9518,-18434"/>
<text text-anchor="middle" x="9518" y="-18384.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-18369.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="9518" y="-18354.8" font-family="Times,serif" font-size="14.00">Q[12]×K[4]×V[4]</text>
<text text-anchor="middle" x="9518" y="-18339.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_11_stage_8&#45;&gt;ring_attn_0_12_stage_8 -->
<g id="edge2925" class="edge">
<title>ring_attn_0_11_stage_8&#45;&gt;ring_attn_0_12_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-18366C9140.02,-18366 9298.86,-18366 9298.86,-18366"/>
<polygon fill="red" stroke="red" points="9298.86,-18369.5 9308.86,-18366 9298.86,-18362.5 9298.86,-18369.5"/>
</g>
<!-- ring_attn_0_11_stage_9&#45;&gt;ring_attn_0_11_stage_10 -->
<g id="edge1080" class="edge">
<title>ring_attn_0_11_stage_9&#45;&gt;ring_attn_0_11_stage_10</title>
<path fill="none" stroke="black" d="M8931,-18044.87C8931,-18044.87 8931,-17938.25 8931,-17938.25"/>
<polygon fill="black" stroke="black" points="8934.5,-17938.25 8931,-17928.25 8927.5,-17938.25 8934.5,-17938.25"/>
</g>
<!-- ring_attn_0_12_stage_9 -->
<g id="node1189" class="node">
<title>ring_attn_0_12_stage_9</title>
<polygon fill="yellow" stroke="black" points="9518,-18181 9309,-18113 9518,-18045 9727,-18113 9518,-18181"/>
<text text-anchor="middle" x="9518" y="-18131.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-18116.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="9518" y="-18101.8" font-family="Times,serif" font-size="14.00">Q[12]×K[3]×V[3]</text>
<text text-anchor="middle" x="9518" y="-18086.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_11_stage_9&#45;&gt;ring_attn_0_12_stage_9 -->
<g id="edge2926" class="edge">
<title>ring_attn_0_11_stage_9&#45;&gt;ring_attn_0_12_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-18113C9140.02,-18113 9298.86,-18113 9298.86,-18113"/>
<polygon fill="red" stroke="red" points="9298.86,-18116.5 9308.86,-18113 9298.86,-18109.5 9298.86,-18116.5"/>
</g>
<!-- ring_attn_0_11_stage_10&#45;&gt;ring_attn_0_11_stage_11 -->
<g id="edge1081" class="edge">
<title>ring_attn_0_11_stage_10&#45;&gt;ring_attn_0_11_stage_11</title>
<path fill="none" stroke="black" d="M8931,-17791.87C8931,-17791.87 8931,-17685.25 8931,-17685.25"/>
<polygon fill="black" stroke="black" points="8934.5,-17685.25 8931,-17675.25 8927.5,-17685.25 8934.5,-17685.25"/>
</g>
<!-- ring_attn_0_12_stage_10 -->
<g id="node1190" class="node">
<title>ring_attn_0_12_stage_10</title>
<polygon fill="yellow" stroke="black" points="9518,-17928 9309,-17860 9518,-17792 9727,-17860 9518,-17928"/>
<text text-anchor="middle" x="9518" y="-17878.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-17863.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="9518" y="-17848.8" font-family="Times,serif" font-size="14.00">Q[12]×K[2]×V[2]</text>
<text text-anchor="middle" x="9518" y="-17833.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_11_stage_10&#45;&gt;ring_attn_0_12_stage_10 -->
<g id="edge2927" class="edge">
<title>ring_attn_0_11_stage_10&#45;&gt;ring_attn_0_12_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-17860C9140.02,-17860 9298.86,-17860 9298.86,-17860"/>
<polygon fill="red" stroke="red" points="9298.86,-17863.5 9308.86,-17860 9298.86,-17856.5 9298.86,-17863.5"/>
</g>
<!-- ring_attn_0_11_stage_11&#45;&gt;ring_attn_0_11_stage_12 -->
<g id="edge1082" class="edge">
<title>ring_attn_0_11_stage_11&#45;&gt;ring_attn_0_11_stage_12</title>
<path fill="none" stroke="black" d="M8931,-17538.87C8931,-17538.87 8931,-17432.25 8931,-17432.25"/>
<polygon fill="black" stroke="black" points="8934.5,-17432.25 8931,-17422.25 8927.5,-17432.25 8934.5,-17432.25"/>
</g>
<!-- ring_attn_0_12_stage_11 -->
<g id="node1191" class="node">
<title>ring_attn_0_12_stage_11</title>
<polygon fill="yellow" stroke="black" points="9518,-17675 9309,-17607 9518,-17539 9727,-17607 9518,-17675"/>
<text text-anchor="middle" x="9518" y="-17625.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-17610.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="9518" y="-17595.8" font-family="Times,serif" font-size="14.00">Q[12]×K[1]×V[1]</text>
<text text-anchor="middle" x="9518" y="-17580.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_11_stage_11&#45;&gt;ring_attn_0_12_stage_11 -->
<g id="edge2928" class="edge">
<title>ring_attn_0_11_stage_11&#45;&gt;ring_attn_0_12_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-17607C9140.02,-17607 9298.86,-17607 9298.86,-17607"/>
<polygon fill="red" stroke="red" points="9298.86,-17610.5 9308.86,-17607 9298.86,-17603.5 9298.86,-17610.5"/>
</g>
<!-- ring_attn_0_11_stage_12&#45;&gt;ring_attn_0_11_stage_13 -->
<g id="edge1083" class="edge">
<title>ring_attn_0_11_stage_12&#45;&gt;ring_attn_0_11_stage_13</title>
<path fill="none" stroke="black" d="M8931,-17285.87C8931,-17285.87 8931,-17179.25 8931,-17179.25"/>
<polygon fill="black" stroke="black" points="8934.5,-17179.25 8931,-17169.25 8927.5,-17179.25 8934.5,-17179.25"/>
</g>
<!-- ring_attn_0_12_stage_12 -->
<g id="node1192" class="node">
<title>ring_attn_0_12_stage_12</title>
<polygon fill="yellow" stroke="black" points="9518,-17422 9309,-17354 9518,-17286 9727,-17354 9518,-17422"/>
<text text-anchor="middle" x="9518" y="-17372.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-17357.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="9518" y="-17342.8" font-family="Times,serif" font-size="14.00">Q[12]×K[0]×V[0]</text>
<text text-anchor="middle" x="9518" y="-17327.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_11_stage_12&#45;&gt;ring_attn_0_12_stage_12 -->
<g id="edge2929" class="edge">
<title>ring_attn_0_11_stage_12&#45;&gt;ring_attn_0_12_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-17354C9140.02,-17354 9298.86,-17354 9298.86,-17354"/>
<polygon fill="red" stroke="red" points="9298.86,-17357.5 9308.86,-17354 9298.86,-17350.5 9298.86,-17357.5"/>
</g>
<!-- ring_attn_0_11_stage_13&#45;&gt;ring_attn_0_11_stage_14 -->
<g id="edge1084" class="edge">
<title>ring_attn_0_11_stage_13&#45;&gt;ring_attn_0_11_stage_14</title>
<path fill="none" stroke="black" d="M8931,-17032.87C8931,-17032.87 8931,-16926.25 8931,-16926.25"/>
<polygon fill="black" stroke="black" points="8934.5,-16926.25 8931,-16916.25 8927.5,-16926.25 8934.5,-16926.25"/>
</g>
<!-- ring_attn_0_12_stage_13 -->
<g id="node1193" class="node">
<title>ring_attn_0_12_stage_13</title>
<polygon fill="yellow" stroke="black" points="9518,-17169 9309,-17101 9518,-17033 9727,-17101 9518,-17169"/>
<text text-anchor="middle" x="9518" y="-17119.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-17104.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="9518" y="-17089.8" font-family="Times,serif" font-size="14.00">Q[12]×K[15]×V[15]</text>
<text text-anchor="middle" x="9518" y="-17074.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_11_stage_13&#45;&gt;ring_attn_0_12_stage_13 -->
<g id="edge2930" class="edge">
<title>ring_attn_0_11_stage_13&#45;&gt;ring_attn_0_12_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-17101C9140.02,-17101 9298.86,-17101 9298.86,-17101"/>
<polygon fill="red" stroke="red" points="9298.86,-17104.5 9308.86,-17101 9298.86,-17097.5 9298.86,-17104.5"/>
</g>
<!-- ring_attn_0_11_stage_14&#45;&gt;ring_attn_0_11_stage_15 -->
<g id="edge1085" class="edge">
<title>ring_attn_0_11_stage_14&#45;&gt;ring_attn_0_11_stage_15</title>
<path fill="none" stroke="black" d="M8931,-16779.87C8931,-16779.87 8931,-16673.25 8931,-16673.25"/>
<polygon fill="black" stroke="black" points="8934.5,-16673.25 8931,-16663.25 8927.5,-16673.25 8934.5,-16673.25"/>
</g>
<!-- ring_attn_0_12_stage_14 -->
<g id="node1194" class="node">
<title>ring_attn_0_12_stage_14</title>
<polygon fill="yellow" stroke="black" points="9518,-16916 9309,-16848 9518,-16780 9727,-16848 9518,-16916"/>
<text text-anchor="middle" x="9518" y="-16866.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-16851.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="9518" y="-16836.8" font-family="Times,serif" font-size="14.00">Q[12]×K[14]×V[14]</text>
<text text-anchor="middle" x="9518" y="-16821.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_11_stage_14&#45;&gt;ring_attn_0_12_stage_14 -->
<g id="edge2931" class="edge">
<title>ring_attn_0_11_stage_14&#45;&gt;ring_attn_0_12_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-16848C9140.02,-16848 9298.86,-16848 9298.86,-16848"/>
<polygon fill="red" stroke="red" points="9298.86,-16851.5 9308.86,-16848 9298.86,-16844.5 9298.86,-16851.5"/>
</g>
<!-- attn_out_0_11 -->
<g id="node1098" class="node">
<title>attn_out_0_11</title>
<polygon fill="none" stroke="black" points="9000.5,-16454 8861.5,-16454 8861.5,-16401 9000.5,-16401 9000.5,-16454"/>
<text text-anchor="middle" x="8931" y="-16438.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="8931" y="-16423.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="8931" y="-16408.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_0_11_stage_15&#45;&gt;attn_out_0_11 -->
<g id="edge1086" class="edge">
<title>ring_attn_0_11_stage_15&#45;&gt;attn_out_0_11</title>
<path fill="none" stroke="black" d="M8931,-16526.87C8931,-16526.87 8931,-16464.18 8931,-16464.18"/>
<polygon fill="black" stroke="black" points="8934.5,-16464.18 8931,-16454.18 8927.5,-16464.18 8934.5,-16464.18"/>
</g>
<!-- ring_attn_0_12_stage_15 -->
<g id="node1195" class="node">
<title>ring_attn_0_12_stage_15</title>
<polygon fill="yellow" stroke="black" points="9518,-16663 9309,-16595 9518,-16527 9727,-16595 9518,-16663"/>
<text text-anchor="middle" x="9518" y="-16613.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-16598.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="9518" y="-16583.8" font-family="Times,serif" font-size="14.00">Q[12]×K[13]×V[13]</text>
<text text-anchor="middle" x="9518" y="-16568.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_11_stage_15&#45;&gt;ring_attn_0_12_stage_15 -->
<g id="edge2932" class="edge">
<title>ring_attn_0_11_stage_15&#45;&gt;ring_attn_0_12_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-16595C9140.02,-16595 9298.86,-16595 9298.86,-16595"/>
<polygon fill="red" stroke="red" points="9298.86,-16598.5 9308.86,-16595 9298.86,-16591.5 9298.86,-16598.5"/>
</g>
<!-- attn_residual_0_11 -->
<g id="node1099" class="node">
<title>attn_residual_0_11</title>
<ellipse fill="none" stroke="black" cx="8931" cy="-16301" rx="105.5" ry="27"/>
<text text-anchor="middle" x="8931" y="-16304.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="8931" y="-16289.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_0_11&#45;&gt;attn_residual_0_11 -->
<g id="edge1087" class="edge">
<title>attn_out_0_11&#45;&gt;attn_residual_0_11</title>
<path fill="none" stroke="black" d="M8931,-16400.98C8931,-16400.98 8931,-16338.36 8931,-16338.36"/>
<polygon fill="black" stroke="black" points="8934.5,-16338.36 8931,-16328.36 8927.5,-16338.36 8934.5,-16338.36"/>
</g>
<!-- gate_0_11 -->
<g id="node1100" class="node">
<title>gate_0_11</title>
<ellipse fill="orange" stroke="black" cx="8931" cy="-16163.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="8931" y="-16174.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="8931" y="-16159.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="8931" y="-16144.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_0_11&#45;&gt;gate_0_11 -->
<g id="edge1088" class="edge">
<title>attn_residual_0_11&#45;&gt;gate_0_11</title>
<path fill="none" stroke="black" d="M8983.75,-16277.36C8983.75,-16277.36 8983.75,-16206.08 8983.75,-16206.08"/>
<polygon fill="black" stroke="black" points="8987.25,-16206.08 8983.75,-16196.08 8980.25,-16206.08 8987.25,-16206.08"/>
</g>
<!-- gate_0_11&#45;&gt;expert_0_0_0 -->
<g id="edge2933" class="edge">
<title>gate_0_11&#45;&gt;expert_0_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8931,-16201.09C8931,-16230.34 8931,-16266 8931,-16266 8931,-16266 111.4,-16266 111.4,-16266 111.4,-16266 111.4,-16004.25 111.4,-16004.25"/>
<polygon fill="blue" stroke="blue" points="114.9,-16004.25 111.4,-15994.25 107.9,-16004.25 114.9,-16004.25"/>
<text text-anchor="middle" x="37706.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37706.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU11→GPU0</text>
<text text-anchor="middle" x="37706.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37706.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_11&#45;&gt;expert_0_1_0 -->
<g id="edge2934" class="edge">
<title>gate_0_11&#45;&gt;expert_0_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8878.25,-16196.21C8878.25,-16214.24 8878.25,-16233 8878.25,-16233 8878.25,-16233 3168.43,-16233 3168.43,-16233 3168.43,-16233 3168.43,-16004.42 3168.43,-16004.42"/>
<polygon fill="blue" stroke="blue" points="3171.93,-16004.42 3168.43,-15994.42 3164.93,-16004.42 3171.93,-16004.42"/>
<text text-anchor="middle" x="37880.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37880.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU11→GPU1</text>
<text text-anchor="middle" x="37880.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37880.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_11&#45;&gt;expert_0_2_0 -->
<g id="edge2935" class="edge">
<title>gate_0_11&#45;&gt;expert_0_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8835.55,-16147.36C8835.55,-16112.65 8835.55,-16034 8835.55,-16034 8835.55,-16034 3620.65,-16034 3620.65,-16034 3620.65,-16034 3620.65,-16004.16 3620.65,-16004.16"/>
<polygon fill="blue" stroke="blue" points="3624.15,-16004.16 3620.65,-15994.16 3617.15,-16004.16 3624.15,-16004.16"/>
<text text-anchor="middle" x="38054.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38054.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU11→GPU2</text>
<text text-anchor="middle" x="38054.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38054.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_11&#45;&gt;expert_0_3_0 -->
<g id="edge2936" class="edge">
<title>gate_0_11&#45;&gt;expert_0_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8855.64,-16137.09C8855.64,-16098.96 8855.64,-16033 8855.64,-16033 8855.64,-16033 4213.9,-16033 4213.9,-16033 4213.9,-16033 4213.9,-16004.14 4213.9,-16004.14"/>
<polygon fill="blue" stroke="blue" points="4217.4,-16004.14 4213.9,-15994.14 4210.4,-16004.14 4217.4,-16004.14"/>
<text text-anchor="middle" x="38228.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38228.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU11→GPU3</text>
<text text-anchor="middle" x="38228.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38228.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_11&#45;&gt;expert_0_4_0 -->
<g id="edge2937" class="edge">
<title>gate_0_11&#45;&gt;expert_0_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8875.74,-16131.31C8875.74,-16095.02 8875.74,-16041 8875.74,-16041 8875.74,-16041 4816.98,-16041 4816.98,-16041 4816.98,-16041 4816.98,-16004.04 4816.98,-16004.04"/>
<polygon fill="blue" stroke="blue" points="4820.48,-16004.04 4816.98,-15994.04 4813.48,-16004.04 4820.48,-16004.04"/>
<text text-anchor="middle" x="38402.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38402.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU11→GPU4</text>
<text text-anchor="middle" x="38402.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38402.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_11&#45;&gt;expert_0_5_0 -->
<g id="edge2938" class="edge">
<title>gate_0_11&#45;&gt;expert_0_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8895.83,-16127.9C8895.83,-16094.61 8895.83,-16050 8895.83,-16050 8895.83,-16050 5414.02,-16050 5414.02,-16050 5414.02,-16050 5414.02,-16004.06 5414.02,-16004.06"/>
<polygon fill="blue" stroke="blue" points="5417.52,-16004.06 5414.02,-15994.06 5410.52,-16004.06 5417.52,-16004.06"/>
<text text-anchor="middle" x="38576.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38576.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU11→GPU5</text>
<text text-anchor="middle" x="38576.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38576.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_11&#45;&gt;expert_0_6_0 -->
<g id="edge2939" class="edge">
<title>gate_0_11&#45;&gt;expert_0_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8915.93,-16126.3C8915.93,-16095.93 8915.93,-16058 8915.93,-16058 8915.93,-16058 5996,-16058 5996,-16058 5996,-16058 5996,-16004.16 5996,-16004.16"/>
<polygon fill="blue" stroke="blue" points="5999.5,-16004.16 5996,-15994.16 5992.5,-16004.16 5999.5,-16004.16"/>
<text text-anchor="middle" x="38750.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38750.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU11→GPU6</text>
<text text-anchor="middle" x="38750.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38750.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_11&#45;&gt;expert_0_7_0 -->
<g id="edge2940" class="edge">
<title>gate_0_11&#45;&gt;expert_0_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8936.02,-16125.91C8936.02,-16101.04 8936.02,-16073 8936.02,-16073 8936.02,-16073 6588.02,-16073 6588.02,-16073 6588.02,-16073 6588.02,-16004.12 6588.02,-16004.12"/>
<polygon fill="blue" stroke="blue" points="6591.52,-16004.12 6588.02,-15994.12 6584.52,-16004.12 6591.52,-16004.12"/>
<text text-anchor="middle" x="38924.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38924.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU11→GPU7</text>
<text text-anchor="middle" x="38924.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38924.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_11&#45;&gt;expert_0_8_0 -->
<g id="edge2941" class="edge">
<title>gate_0_11&#45;&gt;expert_0_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8956.12,-16126.63C8956.12,-16104.26 8956.12,-16080 8956.12,-16080 8956.12,-16080 7174.59,-16080 7174.59,-16080 7174.59,-16080 7174.59,-16004.16 7174.59,-16004.16"/>
<polygon fill="blue" stroke="blue" points="7178.09,-16004.16 7174.59,-15994.16 7171.09,-16004.16 7178.09,-16004.16"/>
<text text-anchor="middle" x="39098.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39098.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU11→GPU8</text>
<text text-anchor="middle" x="39098.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39098.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_11&#45;&gt;expert_0_9_0 -->
<g id="edge2942" class="edge">
<title>gate_0_11&#45;&gt;expert_0_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8966.17,-16128C8966.17,-16120.6 8966.17,-16115 8966.17,-16115 8966.17,-16115 7871.5,-16115 7871.5,-16115 7871.5,-16115 7871.5,-16004.21 7871.5,-16004.21"/>
<polygon fill="blue" stroke="blue" points="7875,-16004.21 7871.5,-15994.21 7868,-16004.21 7875,-16004.21"/>
<text text-anchor="middle" x="39272.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39272.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU11→GPU9</text>
<text text-anchor="middle" x="39272.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39272.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_11&#45;&gt;expert_0_10_0 -->
<g id="edge2943" class="edge">
<title>gate_0_11&#45;&gt;expert_0_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8831.3,-16176C8691.46,-16176 8454,-16176 8454,-16176 8454,-16176 8454,-16004.33 8454,-16004.33"/>
<polygon fill="blue" stroke="blue" points="8457.5,-16004.33 8454,-15994.33 8450.5,-16004.33 8457.5,-16004.33"/>
<text text-anchor="middle" x="39446.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39446.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU11→GPU10</text>
<text text-anchor="middle" x="39446.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39446.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_11&#45;&gt;expert_0_11_0 -->
<g id="edge1089" class="edge">
<title>gate_0_11&#45;&gt;expert_0_11_0</title>
<path fill="none" stroke="black" d="M8976.21,-16129.36C8976.21,-16129.36 8976.21,-16004.03 8976.21,-16004.03"/>
<polygon fill="black" stroke="black" points="8979.71,-16004.03 8976.21,-15994.03 8972.71,-16004.03 8979.71,-16004.03"/>
</g>
<!-- gate_0_11&#45;&gt;expert_0_12_0 -->
<g id="edge2944" class="edge">
<title>gate_0_11&#45;&gt;expert_0_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9030.65,-16151C9170.77,-16151 9409.12,-16151 9409.12,-16151 9409.12,-16151 9409.12,-16004.18 9409.12,-16004.18"/>
<polygon fill="blue" stroke="blue" points="9412.63,-16004.18 9409.12,-15994.18 9405.63,-16004.18 9412.63,-16004.18"/>
<text text-anchor="middle" x="39620.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39620.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU11→GPU12</text>
<text text-anchor="middle" x="39620.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39620.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_11&#45;&gt;expert_0_13_0 -->
<g id="edge2945" class="edge">
<title>gate_0_11&#45;&gt;expert_0_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9006.36,-16137.25C9006.36,-16124.12 9006.36,-16111 9006.36,-16111 9006.36,-16111 9992.75,-16111 9992.75,-16111 9992.75,-16111 9992.75,-16004.15 9992.75,-16004.15"/>
<polygon fill="blue" stroke="blue" points="9996.25,-16004.15 9992.75,-15994.15 9989.25,-16004.15 9996.25,-16004.15"/>
<text text-anchor="middle" x="39794.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39794.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU11→GPU13</text>
<text text-anchor="middle" x="39794.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39794.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_11&#45;&gt;expert_0_14_0 -->
<g id="edge2946" class="edge">
<title>gate_0_11&#45;&gt;expert_0_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9016.4,-16141.35C9016.4,-16113.14 9016.4,-16068 9016.4,-16068 9016.4,-16068 10575.7,-16068 10575.7,-16068 10575.7,-16068 10575.7,-16004.17 10575.7,-16004.17"/>
<polygon fill="blue" stroke="blue" points="10579.2,-16004.17 10575.7,-15994.17 10572.2,-16004.17 10579.2,-16004.17"/>
<text text-anchor="middle" x="39968.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39968.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU11→GPU14</text>
<text text-anchor="middle" x="39968.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39968.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_11&#45;&gt;expert_0_15_0 -->
<g id="edge2947" class="edge">
<title>gate_0_11&#45;&gt;expert_0_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9026.45,-16147.35C9026.45,-16118.94 9026.45,-16063 9026.45,-16063 9026.45,-16063 11161.69,-16063 11161.69,-16063 11161.69,-16063 11161.69,-16004.1 11161.69,-16004.1"/>
<polygon fill="blue" stroke="blue" points="11165.19,-16004.1 11161.69,-15994.1 11158.19,-16004.1 11165.19,-16004.1"/>
<text text-anchor="middle" x="40142.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="40142.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU11→GPU15</text>
<text text-anchor="middle" x="40142.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="40142.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_11 -->
<g id="node1102" class="node">
<title>expert_reduce_0_11</title>
<ellipse fill="none" stroke="black" cx="8931" cy="-15830.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="8931" y="-15841.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="8931" y="-15826.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="8931" y="-15811.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_11_0&#45;&gt;expert_reduce_0_11 -->
<g id="edge1090" class="edge">
<title>expert_0_11_0&#45;&gt;expert_reduce_0_11</title>
<path fill="none" stroke="black" d="M8931,-15940.76C8931,-15940.76 8931,-15878.06 8931,-15878.06"/>
<polygon fill="black" stroke="black" points="8934.5,-15878.06 8931,-15868.06 8927.5,-15878.06 8934.5,-15878.06"/>
</g>
<!-- moe_residual_0_11 -->
<g id="node1103" class="node">
<title>moe_residual_0_11</title>
<ellipse fill="none" stroke="black" cx="8931" cy="-15693" rx="105.5" ry="27"/>
<text text-anchor="middle" x="8931" y="-15696.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="8931" y="-15681.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_11&#45;&gt;moe_residual_0_11 -->
<g id="edge1091" class="edge">
<title>expert_reduce_0_11&#45;&gt;moe_residual_0_11</title>
<path fill="none" stroke="black" d="M8931,-15792.93C8931,-15792.93 8931,-15730.06 8931,-15730.06"/>
<polygon fill="black" stroke="black" points="8934.5,-15730.06 8931,-15720.06 8927.5,-15730.06 8934.5,-15730.06"/>
</g>
<!-- qkv_proj_1_11 -->
<g id="node1104" class="node">
<title>qkv_proj_1_11</title>
<polygon fill="none" stroke="black" points="9013.5,-15593 8848.5,-15593 8848.5,-15540 9013.5,-15540 9013.5,-15593"/>
<text text-anchor="middle" x="8931" y="-15577.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="8931" y="-15562.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="8931" y="-15547.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_0_11&#45;&gt;qkv_proj_1_11 -->
<g id="edge1092" class="edge">
<title>moe_residual_0_11&#45;&gt;qkv_proj_1_11</title>
<path fill="none" stroke="black" d="M8931,-15665.86C8931,-15665.86 8931,-15603.16 8931,-15603.16"/>
<polygon fill="black" stroke="black" points="8934.5,-15603.16 8931,-15593.16 8927.5,-15603.16 8934.5,-15603.16"/>
</g>
<!-- qkv_reshape_1_11 -->
<g id="node1105" class="node">
<title>qkv_reshape_1_11</title>
<ellipse fill="none" stroke="black" cx="8931" cy="-15440" rx="148" ry="27"/>
<text text-anchor="middle" x="8931" y="-15443.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="8931" y="-15428.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_1_11&#45;&gt;qkv_reshape_1_11 -->
<g id="edge1093" class="edge">
<title>qkv_proj_1_11&#45;&gt;qkv_reshape_1_11</title>
<path fill="none" stroke="black" d="M8931,-15539.98C8931,-15539.98 8931,-15477.36 8931,-15477.36"/>
<polygon fill="black" stroke="black" points="8934.5,-15477.36 8931,-15467.36 8927.5,-15477.36 8934.5,-15477.36"/>
</g>
<!-- qkv_reshape_1_11&#45;&gt;ring_attn_1_11_stage_0 -->
<g id="edge1094" class="edge">
<title>qkv_reshape_1_11&#45;&gt;ring_attn_1_11_stage_0</title>
<path fill="none" stroke="black" d="M8931,-15412.72C8931,-15412.72 8931,-15306.16 8931,-15306.16"/>
<polygon fill="black" stroke="black" points="8934.5,-15306.16 8931,-15296.16 8927.5,-15306.16 8934.5,-15306.16"/>
</g>
<!-- ring_attn_1_11_stage_0&#45;&gt;ring_attn_1_11_stage_1 -->
<g id="edge1095" class="edge">
<title>ring_attn_1_11_stage_0&#45;&gt;ring_attn_1_11_stage_1</title>
<path fill="none" stroke="black" d="M8931,-15159.87C8931,-15159.87 8931,-15053.25 8931,-15053.25"/>
<polygon fill="black" stroke="black" points="8934.5,-15053.25 8931,-15043.25 8927.5,-15053.25 8934.5,-15053.25"/>
</g>
<!-- ring_attn_1_12_stage_0 -->
<g id="node1204" class="node">
<title>ring_attn_1_12_stage_0</title>
<polygon fill="yellow" stroke="black" points="9518,-15296 9309,-15228 9518,-15160 9727,-15228 9518,-15296"/>
<text text-anchor="middle" x="9518" y="-15246.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-15231.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="9518" y="-15216.8" font-family="Times,serif" font-size="14.00">Q[12]×K[12]×V[12]</text>
<text text-anchor="middle" x="9518" y="-15201.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_11_stage_0&#45;&gt;ring_attn_1_12_stage_0 -->
<g id="edge2948" class="edge">
<title>ring_attn_1_11_stage_0&#45;&gt;ring_attn_1_12_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-15228C9140.02,-15228 9298.86,-15228 9298.86,-15228"/>
<polygon fill="red" stroke="red" points="9298.86,-15231.5 9308.86,-15228 9298.86,-15224.5 9298.86,-15231.5"/>
</g>
<!-- ring_attn_1_11_stage_1&#45;&gt;ring_attn_1_11_stage_2 -->
<g id="edge1096" class="edge">
<title>ring_attn_1_11_stage_1&#45;&gt;ring_attn_1_11_stage_2</title>
<path fill="none" stroke="black" d="M8931,-14906.87C8931,-14906.87 8931,-14800.25 8931,-14800.25"/>
<polygon fill="black" stroke="black" points="8934.5,-14800.25 8931,-14790.25 8927.5,-14800.25 8934.5,-14800.25"/>
</g>
<!-- ring_attn_1_12_stage_1 -->
<g id="node1205" class="node">
<title>ring_attn_1_12_stage_1</title>
<polygon fill="yellow" stroke="black" points="9518,-15043 9309,-14975 9518,-14907 9727,-14975 9518,-15043"/>
<text text-anchor="middle" x="9518" y="-14993.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-14978.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="9518" y="-14963.8" font-family="Times,serif" font-size="14.00">Q[12]×K[11]×V[11]</text>
<text text-anchor="middle" x="9518" y="-14948.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_11_stage_1&#45;&gt;ring_attn_1_12_stage_1 -->
<g id="edge2949" class="edge">
<title>ring_attn_1_11_stage_1&#45;&gt;ring_attn_1_12_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-14975C9140.02,-14975 9298.86,-14975 9298.86,-14975"/>
<polygon fill="red" stroke="red" points="9298.86,-14978.5 9308.86,-14975 9298.86,-14971.5 9298.86,-14978.5"/>
</g>
<!-- ring_attn_1_11_stage_2&#45;&gt;ring_attn_1_11_stage_3 -->
<g id="edge1097" class="edge">
<title>ring_attn_1_11_stage_2&#45;&gt;ring_attn_1_11_stage_3</title>
<path fill="none" stroke="black" d="M8931,-14653.87C8931,-14653.87 8931,-14547.25 8931,-14547.25"/>
<polygon fill="black" stroke="black" points="8934.5,-14547.25 8931,-14537.25 8927.5,-14547.25 8934.5,-14547.25"/>
</g>
<!-- ring_attn_1_12_stage_2 -->
<g id="node1206" class="node">
<title>ring_attn_1_12_stage_2</title>
<polygon fill="yellow" stroke="black" points="9518,-14790 9309,-14722 9518,-14654 9727,-14722 9518,-14790"/>
<text text-anchor="middle" x="9518" y="-14740.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-14725.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="9518" y="-14710.8" font-family="Times,serif" font-size="14.00">Q[12]×K[10]×V[10]</text>
<text text-anchor="middle" x="9518" y="-14695.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_11_stage_2&#45;&gt;ring_attn_1_12_stage_2 -->
<g id="edge2950" class="edge">
<title>ring_attn_1_11_stage_2&#45;&gt;ring_attn_1_12_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-14722C9140.02,-14722 9298.86,-14722 9298.86,-14722"/>
<polygon fill="red" stroke="red" points="9298.86,-14725.5 9308.86,-14722 9298.86,-14718.5 9298.86,-14725.5"/>
</g>
<!-- ring_attn_1_11_stage_3&#45;&gt;ring_attn_1_11_stage_4 -->
<g id="edge1098" class="edge">
<title>ring_attn_1_11_stage_3&#45;&gt;ring_attn_1_11_stage_4</title>
<path fill="none" stroke="black" d="M8931,-14400.87C8931,-14400.87 8931,-14294.25 8931,-14294.25"/>
<polygon fill="black" stroke="black" points="8934.5,-14294.25 8931,-14284.25 8927.5,-14294.25 8934.5,-14294.25"/>
</g>
<!-- ring_attn_1_12_stage_3 -->
<g id="node1207" class="node">
<title>ring_attn_1_12_stage_3</title>
<polygon fill="yellow" stroke="black" points="9518,-14537 9309,-14469 9518,-14401 9727,-14469 9518,-14537"/>
<text text-anchor="middle" x="9518" y="-14487.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-14472.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="9518" y="-14457.8" font-family="Times,serif" font-size="14.00">Q[12]×K[9]×V[9]</text>
<text text-anchor="middle" x="9518" y="-14442.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_11_stage_3&#45;&gt;ring_attn_1_12_stage_3 -->
<g id="edge2951" class="edge">
<title>ring_attn_1_11_stage_3&#45;&gt;ring_attn_1_12_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-14469C9140.02,-14469 9298.86,-14469 9298.86,-14469"/>
<polygon fill="red" stroke="red" points="9298.86,-14472.5 9308.86,-14469 9298.86,-14465.5 9298.86,-14472.5"/>
</g>
<!-- ring_attn_1_11_stage_4&#45;&gt;ring_attn_1_11_stage_5 -->
<g id="edge1099" class="edge">
<title>ring_attn_1_11_stage_4&#45;&gt;ring_attn_1_11_stage_5</title>
<path fill="none" stroke="black" d="M8931,-14147.87C8931,-14147.87 8931,-14041.25 8931,-14041.25"/>
<polygon fill="black" stroke="black" points="8934.5,-14041.25 8931,-14031.25 8927.5,-14041.25 8934.5,-14041.25"/>
</g>
<!-- ring_attn_1_12_stage_4 -->
<g id="node1208" class="node">
<title>ring_attn_1_12_stage_4</title>
<polygon fill="yellow" stroke="black" points="9518,-14284 9309,-14216 9518,-14148 9727,-14216 9518,-14284"/>
<text text-anchor="middle" x="9518" y="-14234.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-14219.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="9518" y="-14204.8" font-family="Times,serif" font-size="14.00">Q[12]×K[8]×V[8]</text>
<text text-anchor="middle" x="9518" y="-14189.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_11_stage_4&#45;&gt;ring_attn_1_12_stage_4 -->
<g id="edge2952" class="edge">
<title>ring_attn_1_11_stage_4&#45;&gt;ring_attn_1_12_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-14216C9140.02,-14216 9298.86,-14216 9298.86,-14216"/>
<polygon fill="red" stroke="red" points="9298.86,-14219.5 9308.86,-14216 9298.86,-14212.5 9298.86,-14219.5"/>
</g>
<!-- ring_attn_1_11_stage_5&#45;&gt;ring_attn_1_11_stage_6 -->
<g id="edge1100" class="edge">
<title>ring_attn_1_11_stage_5&#45;&gt;ring_attn_1_11_stage_6</title>
<path fill="none" stroke="black" d="M8931,-13894.87C8931,-13894.87 8931,-13788.25 8931,-13788.25"/>
<polygon fill="black" stroke="black" points="8934.5,-13788.25 8931,-13778.25 8927.5,-13788.25 8934.5,-13788.25"/>
</g>
<!-- ring_attn_1_12_stage_5 -->
<g id="node1209" class="node">
<title>ring_attn_1_12_stage_5</title>
<polygon fill="yellow" stroke="black" points="9518,-14031 9309,-13963 9518,-13895 9727,-13963 9518,-14031"/>
<text text-anchor="middle" x="9518" y="-13981.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-13966.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="9518" y="-13951.8" font-family="Times,serif" font-size="14.00">Q[12]×K[7]×V[7]</text>
<text text-anchor="middle" x="9518" y="-13936.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_11_stage_5&#45;&gt;ring_attn_1_12_stage_5 -->
<g id="edge2953" class="edge">
<title>ring_attn_1_11_stage_5&#45;&gt;ring_attn_1_12_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-13963C9140.02,-13963 9298.86,-13963 9298.86,-13963"/>
<polygon fill="red" stroke="red" points="9298.86,-13966.5 9308.86,-13963 9298.86,-13959.5 9298.86,-13966.5"/>
</g>
<!-- ring_attn_1_11_stage_6&#45;&gt;ring_attn_1_11_stage_7 -->
<g id="edge1101" class="edge">
<title>ring_attn_1_11_stage_6&#45;&gt;ring_attn_1_11_stage_7</title>
<path fill="none" stroke="black" d="M8931,-13641.87C8931,-13641.87 8931,-13535.25 8931,-13535.25"/>
<polygon fill="black" stroke="black" points="8934.5,-13535.25 8931,-13525.25 8927.5,-13535.25 8934.5,-13535.25"/>
</g>
<!-- ring_attn_1_12_stage_6 -->
<g id="node1210" class="node">
<title>ring_attn_1_12_stage_6</title>
<polygon fill="yellow" stroke="black" points="9518,-13778 9309,-13710 9518,-13642 9727,-13710 9518,-13778"/>
<text text-anchor="middle" x="9518" y="-13728.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-13713.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="9518" y="-13698.8" font-family="Times,serif" font-size="14.00">Q[12]×K[6]×V[6]</text>
<text text-anchor="middle" x="9518" y="-13683.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_11_stage_6&#45;&gt;ring_attn_1_12_stage_6 -->
<g id="edge2954" class="edge">
<title>ring_attn_1_11_stage_6&#45;&gt;ring_attn_1_12_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-13710C9140.02,-13710 9298.86,-13710 9298.86,-13710"/>
<polygon fill="red" stroke="red" points="9298.86,-13713.5 9308.86,-13710 9298.86,-13706.5 9298.86,-13713.5"/>
</g>
<!-- ring_attn_1_11_stage_7&#45;&gt;ring_attn_1_11_stage_8 -->
<g id="edge1102" class="edge">
<title>ring_attn_1_11_stage_7&#45;&gt;ring_attn_1_11_stage_8</title>
<path fill="none" stroke="black" d="M8931,-13388.87C8931,-13388.87 8931,-13282.25 8931,-13282.25"/>
<polygon fill="black" stroke="black" points="8934.5,-13282.25 8931,-13272.25 8927.5,-13282.25 8934.5,-13282.25"/>
</g>
<!-- ring_attn_1_12_stage_7 -->
<g id="node1211" class="node">
<title>ring_attn_1_12_stage_7</title>
<polygon fill="yellow" stroke="black" points="9518,-13525 9309,-13457 9518,-13389 9727,-13457 9518,-13525"/>
<text text-anchor="middle" x="9518" y="-13475.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-13460.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="9518" y="-13445.8" font-family="Times,serif" font-size="14.00">Q[12]×K[5]×V[5]</text>
<text text-anchor="middle" x="9518" y="-13430.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_11_stage_7&#45;&gt;ring_attn_1_12_stage_7 -->
<g id="edge2955" class="edge">
<title>ring_attn_1_11_stage_7&#45;&gt;ring_attn_1_12_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-13457C9140.02,-13457 9298.86,-13457 9298.86,-13457"/>
<polygon fill="red" stroke="red" points="9298.86,-13460.5 9308.86,-13457 9298.86,-13453.5 9298.86,-13460.5"/>
</g>
<!-- ring_attn_1_11_stage_8&#45;&gt;ring_attn_1_11_stage_9 -->
<g id="edge1103" class="edge">
<title>ring_attn_1_11_stage_8&#45;&gt;ring_attn_1_11_stage_9</title>
<path fill="none" stroke="black" d="M8931,-13135.87C8931,-13135.87 8931,-13029.25 8931,-13029.25"/>
<polygon fill="black" stroke="black" points="8934.5,-13029.25 8931,-13019.25 8927.5,-13029.25 8934.5,-13029.25"/>
</g>
<!-- ring_attn_1_12_stage_8 -->
<g id="node1212" class="node">
<title>ring_attn_1_12_stage_8</title>
<polygon fill="yellow" stroke="black" points="9518,-13272 9309,-13204 9518,-13136 9727,-13204 9518,-13272"/>
<text text-anchor="middle" x="9518" y="-13222.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-13207.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="9518" y="-13192.8" font-family="Times,serif" font-size="14.00">Q[12]×K[4]×V[4]</text>
<text text-anchor="middle" x="9518" y="-13177.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_11_stage_8&#45;&gt;ring_attn_1_12_stage_8 -->
<g id="edge2956" class="edge">
<title>ring_attn_1_11_stage_8&#45;&gt;ring_attn_1_12_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-13204C9140.02,-13204 9298.86,-13204 9298.86,-13204"/>
<polygon fill="red" stroke="red" points="9298.86,-13207.5 9308.86,-13204 9298.86,-13200.5 9298.86,-13207.5"/>
</g>
<!-- ring_attn_1_11_stage_9&#45;&gt;ring_attn_1_11_stage_10 -->
<g id="edge1104" class="edge">
<title>ring_attn_1_11_stage_9&#45;&gt;ring_attn_1_11_stage_10</title>
<path fill="none" stroke="black" d="M8931,-12882.87C8931,-12882.87 8931,-12776.25 8931,-12776.25"/>
<polygon fill="black" stroke="black" points="8934.5,-12776.25 8931,-12766.25 8927.5,-12776.25 8934.5,-12776.25"/>
</g>
<!-- ring_attn_1_12_stage_9 -->
<g id="node1213" class="node">
<title>ring_attn_1_12_stage_9</title>
<polygon fill="yellow" stroke="black" points="9518,-13019 9309,-12951 9518,-12883 9727,-12951 9518,-13019"/>
<text text-anchor="middle" x="9518" y="-12969.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-12954.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="9518" y="-12939.8" font-family="Times,serif" font-size="14.00">Q[12]×K[3]×V[3]</text>
<text text-anchor="middle" x="9518" y="-12924.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_11_stage_9&#45;&gt;ring_attn_1_12_stage_9 -->
<g id="edge2957" class="edge">
<title>ring_attn_1_11_stage_9&#45;&gt;ring_attn_1_12_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-12951C9140.02,-12951 9298.86,-12951 9298.86,-12951"/>
<polygon fill="red" stroke="red" points="9298.86,-12954.5 9308.86,-12951 9298.86,-12947.5 9298.86,-12954.5"/>
</g>
<!-- ring_attn_1_11_stage_10&#45;&gt;ring_attn_1_11_stage_11 -->
<g id="edge1105" class="edge">
<title>ring_attn_1_11_stage_10&#45;&gt;ring_attn_1_11_stage_11</title>
<path fill="none" stroke="black" d="M8931,-12629.87C8931,-12629.87 8931,-12523.25 8931,-12523.25"/>
<polygon fill="black" stroke="black" points="8934.5,-12523.25 8931,-12513.25 8927.5,-12523.25 8934.5,-12523.25"/>
</g>
<!-- ring_attn_1_12_stage_10 -->
<g id="node1214" class="node">
<title>ring_attn_1_12_stage_10</title>
<polygon fill="yellow" stroke="black" points="9518,-12766 9309,-12698 9518,-12630 9727,-12698 9518,-12766"/>
<text text-anchor="middle" x="9518" y="-12716.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-12701.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="9518" y="-12686.8" font-family="Times,serif" font-size="14.00">Q[12]×K[2]×V[2]</text>
<text text-anchor="middle" x="9518" y="-12671.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_11_stage_10&#45;&gt;ring_attn_1_12_stage_10 -->
<g id="edge2958" class="edge">
<title>ring_attn_1_11_stage_10&#45;&gt;ring_attn_1_12_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-12698C9140.02,-12698 9298.86,-12698 9298.86,-12698"/>
<polygon fill="red" stroke="red" points="9298.86,-12701.5 9308.86,-12698 9298.86,-12694.5 9298.86,-12701.5"/>
</g>
<!-- ring_attn_1_11_stage_11&#45;&gt;ring_attn_1_11_stage_12 -->
<g id="edge1106" class="edge">
<title>ring_attn_1_11_stage_11&#45;&gt;ring_attn_1_11_stage_12</title>
<path fill="none" stroke="black" d="M8931,-12376.87C8931,-12376.87 8931,-12270.25 8931,-12270.25"/>
<polygon fill="black" stroke="black" points="8934.5,-12270.25 8931,-12260.25 8927.5,-12270.25 8934.5,-12270.25"/>
</g>
<!-- ring_attn_1_12_stage_11 -->
<g id="node1215" class="node">
<title>ring_attn_1_12_stage_11</title>
<polygon fill="yellow" stroke="black" points="9518,-12513 9309,-12445 9518,-12377 9727,-12445 9518,-12513"/>
<text text-anchor="middle" x="9518" y="-12463.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-12448.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="9518" y="-12433.8" font-family="Times,serif" font-size="14.00">Q[12]×K[1]×V[1]</text>
<text text-anchor="middle" x="9518" y="-12418.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_11_stage_11&#45;&gt;ring_attn_1_12_stage_11 -->
<g id="edge2959" class="edge">
<title>ring_attn_1_11_stage_11&#45;&gt;ring_attn_1_12_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-12445C9140.02,-12445 9298.86,-12445 9298.86,-12445"/>
<polygon fill="red" stroke="red" points="9298.86,-12448.5 9308.86,-12445 9298.86,-12441.5 9298.86,-12448.5"/>
</g>
<!-- ring_attn_1_11_stage_12&#45;&gt;ring_attn_1_11_stage_13 -->
<g id="edge1107" class="edge">
<title>ring_attn_1_11_stage_12&#45;&gt;ring_attn_1_11_stage_13</title>
<path fill="none" stroke="black" d="M8931,-12123.87C8931,-12123.87 8931,-12017.25 8931,-12017.25"/>
<polygon fill="black" stroke="black" points="8934.5,-12017.25 8931,-12007.25 8927.5,-12017.25 8934.5,-12017.25"/>
</g>
<!-- ring_attn_1_12_stage_12 -->
<g id="node1216" class="node">
<title>ring_attn_1_12_stage_12</title>
<polygon fill="yellow" stroke="black" points="9518,-12260 9309,-12192 9518,-12124 9727,-12192 9518,-12260"/>
<text text-anchor="middle" x="9518" y="-12210.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-12195.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="9518" y="-12180.8" font-family="Times,serif" font-size="14.00">Q[12]×K[0]×V[0]</text>
<text text-anchor="middle" x="9518" y="-12165.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_11_stage_12&#45;&gt;ring_attn_1_12_stage_12 -->
<g id="edge2960" class="edge">
<title>ring_attn_1_11_stage_12&#45;&gt;ring_attn_1_12_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-12192C9140.02,-12192 9298.86,-12192 9298.86,-12192"/>
<polygon fill="red" stroke="red" points="9298.86,-12195.5 9308.86,-12192 9298.86,-12188.5 9298.86,-12195.5"/>
</g>
<!-- ring_attn_1_11_stage_13&#45;&gt;ring_attn_1_11_stage_14 -->
<g id="edge1108" class="edge">
<title>ring_attn_1_11_stage_13&#45;&gt;ring_attn_1_11_stage_14</title>
<path fill="none" stroke="black" d="M8931,-11870.87C8931,-11870.87 8931,-11764.25 8931,-11764.25"/>
<polygon fill="black" stroke="black" points="8934.5,-11764.25 8931,-11754.25 8927.5,-11764.25 8934.5,-11764.25"/>
</g>
<!-- ring_attn_1_12_stage_13 -->
<g id="node1217" class="node">
<title>ring_attn_1_12_stage_13</title>
<polygon fill="yellow" stroke="black" points="9518,-12007 9309,-11939 9518,-11871 9727,-11939 9518,-12007"/>
<text text-anchor="middle" x="9518" y="-11957.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-11942.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="9518" y="-11927.8" font-family="Times,serif" font-size="14.00">Q[12]×K[15]×V[15]</text>
<text text-anchor="middle" x="9518" y="-11912.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_11_stage_13&#45;&gt;ring_attn_1_12_stage_13 -->
<g id="edge2961" class="edge">
<title>ring_attn_1_11_stage_13&#45;&gt;ring_attn_1_12_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-11939C9140.02,-11939 9298.86,-11939 9298.86,-11939"/>
<polygon fill="red" stroke="red" points="9298.86,-11942.5 9308.86,-11939 9298.86,-11935.5 9298.86,-11942.5"/>
</g>
<!-- ring_attn_1_11_stage_14&#45;&gt;ring_attn_1_11_stage_15 -->
<g id="edge1109" class="edge">
<title>ring_attn_1_11_stage_14&#45;&gt;ring_attn_1_11_stage_15</title>
<path fill="none" stroke="black" d="M8931,-11617.87C8931,-11617.87 8931,-11511.25 8931,-11511.25"/>
<polygon fill="black" stroke="black" points="8934.5,-11511.25 8931,-11501.25 8927.5,-11511.25 8934.5,-11511.25"/>
</g>
<!-- ring_attn_1_12_stage_14 -->
<g id="node1218" class="node">
<title>ring_attn_1_12_stage_14</title>
<polygon fill="yellow" stroke="black" points="9518,-11754 9309,-11686 9518,-11618 9727,-11686 9518,-11754"/>
<text text-anchor="middle" x="9518" y="-11704.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-11689.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="9518" y="-11674.8" font-family="Times,serif" font-size="14.00">Q[12]×K[14]×V[14]</text>
<text text-anchor="middle" x="9518" y="-11659.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_11_stage_14&#45;&gt;ring_attn_1_12_stage_14 -->
<g id="edge2962" class="edge">
<title>ring_attn_1_11_stage_14&#45;&gt;ring_attn_1_12_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-11686C9140.02,-11686 9298.86,-11686 9298.86,-11686"/>
<polygon fill="red" stroke="red" points="9298.86,-11689.5 9308.86,-11686 9298.86,-11682.5 9298.86,-11689.5"/>
</g>
<!-- attn_out_1_11 -->
<g id="node1122" class="node">
<title>attn_out_1_11</title>
<polygon fill="none" stroke="black" points="9000.5,-11292 8861.5,-11292 8861.5,-11239 9000.5,-11239 9000.5,-11292"/>
<text text-anchor="middle" x="8931" y="-11276.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="8931" y="-11261.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="8931" y="-11246.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_1_11_stage_15&#45;&gt;attn_out_1_11 -->
<g id="edge1110" class="edge">
<title>ring_attn_1_11_stage_15&#45;&gt;attn_out_1_11</title>
<path fill="none" stroke="black" d="M8931,-11364.87C8931,-11364.87 8931,-11302.18 8931,-11302.18"/>
<polygon fill="black" stroke="black" points="8934.5,-11302.18 8931,-11292.18 8927.5,-11302.18 8934.5,-11302.18"/>
</g>
<!-- ring_attn_1_12_stage_15 -->
<g id="node1219" class="node">
<title>ring_attn_1_12_stage_15</title>
<polygon fill="yellow" stroke="black" points="9518,-11501 9309,-11433 9518,-11365 9727,-11433 9518,-11501"/>
<text text-anchor="middle" x="9518" y="-11451.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-11436.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="9518" y="-11421.8" font-family="Times,serif" font-size="14.00">Q[12]×K[13]×V[13]</text>
<text text-anchor="middle" x="9518" y="-11406.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_11_stage_15&#45;&gt;ring_attn_1_12_stage_15 -->
<g id="edge2963" class="edge">
<title>ring_attn_1_11_stage_15&#45;&gt;ring_attn_1_12_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-11433C9140.02,-11433 9298.86,-11433 9298.86,-11433"/>
<polygon fill="red" stroke="red" points="9298.86,-11436.5 9308.86,-11433 9298.86,-11429.5 9298.86,-11436.5"/>
</g>
<!-- attn_residual_1_11 -->
<g id="node1123" class="node">
<title>attn_residual_1_11</title>
<ellipse fill="none" stroke="black" cx="8931" cy="-11139" rx="105.5" ry="27"/>
<text text-anchor="middle" x="8931" y="-11142.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="8931" y="-11127.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_1_11&#45;&gt;attn_residual_1_11 -->
<g id="edge1111" class="edge">
<title>attn_out_1_11&#45;&gt;attn_residual_1_11</title>
<path fill="none" stroke="black" d="M8931,-11238.98C8931,-11238.98 8931,-11176.36 8931,-11176.36"/>
<polygon fill="black" stroke="black" points="8934.5,-11176.36 8931,-11166.36 8927.5,-11176.36 8934.5,-11176.36"/>
</g>
<!-- gate_1_11 -->
<g id="node1124" class="node">
<title>gate_1_11</title>
<ellipse fill="orange" stroke="black" cx="8931" cy="-11001.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="8931" y="-11012.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="8931" y="-10997.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="8931" y="-10982.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_1_11&#45;&gt;gate_1_11 -->
<g id="edge1112" class="edge">
<title>attn_residual_1_11&#45;&gt;gate_1_11</title>
<path fill="none" stroke="black" d="M8983.75,-11115.36C8983.75,-11115.36 8983.75,-11044.08 8983.75,-11044.08"/>
<polygon fill="black" stroke="black" points="8987.25,-11044.08 8983.75,-11034.08 8980.25,-11044.08 8987.25,-11044.08"/>
</g>
<!-- gate_1_11&#45;&gt;expert_1_0_0 -->
<g id="edge2964" class="edge">
<title>gate_1_11&#45;&gt;expert_1_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8931,-11039.09C8931,-11068.34 8931,-11104 8931,-11104 8931,-11104 111.4,-11104 111.4,-11104 111.4,-11104 111.4,-10842.25 111.4,-10842.25"/>
<polygon fill="blue" stroke="blue" points="114.9,-10842.25 111.4,-10832.25 107.9,-10842.25 114.9,-10842.25"/>
<text text-anchor="middle" x="37706.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37706.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU11→GPU0</text>
<text text-anchor="middle" x="37706.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37706.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_11&#45;&gt;expert_1_1_0 -->
<g id="edge2965" class="edge">
<title>gate_1_11&#45;&gt;expert_1_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8878.25,-11034.21C8878.25,-11052.24 8878.25,-11071 8878.25,-11071 8878.25,-11071 3168.43,-11071 3168.43,-11071 3168.43,-11071 3168.43,-10842.42 3168.43,-10842.42"/>
<polygon fill="blue" stroke="blue" points="3171.93,-10842.42 3168.43,-10832.42 3164.93,-10842.42 3171.93,-10842.42"/>
<text text-anchor="middle" x="37880.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37880.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU11→GPU1</text>
<text text-anchor="middle" x="37880.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37880.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_11&#45;&gt;expert_1_2_0 -->
<g id="edge2966" class="edge">
<title>gate_1_11&#45;&gt;expert_1_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8835.55,-10985.36C8835.55,-10950.65 8835.55,-10872 8835.55,-10872 8835.55,-10872 3620.65,-10872 3620.65,-10872 3620.65,-10872 3620.65,-10842.16 3620.65,-10842.16"/>
<polygon fill="blue" stroke="blue" points="3624.15,-10842.16 3620.65,-10832.16 3617.15,-10842.16 3624.15,-10842.16"/>
<text text-anchor="middle" x="38054.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38054.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU11→GPU2</text>
<text text-anchor="middle" x="38054.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38054.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_11&#45;&gt;expert_1_3_0 -->
<g id="edge2967" class="edge">
<title>gate_1_11&#45;&gt;expert_1_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8855.64,-10975.09C8855.64,-10936.96 8855.64,-10871 8855.64,-10871 8855.64,-10871 4213.9,-10871 4213.9,-10871 4213.9,-10871 4213.9,-10842.14 4213.9,-10842.14"/>
<polygon fill="blue" stroke="blue" points="4217.4,-10842.14 4213.9,-10832.14 4210.4,-10842.14 4217.4,-10842.14"/>
<text text-anchor="middle" x="38228.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38228.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU11→GPU3</text>
<text text-anchor="middle" x="38228.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38228.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_11&#45;&gt;expert_1_4_0 -->
<g id="edge2968" class="edge">
<title>gate_1_11&#45;&gt;expert_1_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8875.74,-10969.31C8875.74,-10933.02 8875.74,-10879 8875.74,-10879 8875.74,-10879 4816.98,-10879 4816.98,-10879 4816.98,-10879 4816.98,-10842.04 4816.98,-10842.04"/>
<polygon fill="blue" stroke="blue" points="4820.48,-10842.04 4816.98,-10832.04 4813.48,-10842.04 4820.48,-10842.04"/>
<text text-anchor="middle" x="38402.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38402.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU11→GPU4</text>
<text text-anchor="middle" x="38402.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38402.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_11&#45;&gt;expert_1_5_0 -->
<g id="edge2969" class="edge">
<title>gate_1_11&#45;&gt;expert_1_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8895.83,-10965.9C8895.83,-10932.61 8895.83,-10888 8895.83,-10888 8895.83,-10888 5414.02,-10888 5414.02,-10888 5414.02,-10888 5414.02,-10842.06 5414.02,-10842.06"/>
<polygon fill="blue" stroke="blue" points="5417.52,-10842.06 5414.02,-10832.06 5410.52,-10842.06 5417.52,-10842.06"/>
<text text-anchor="middle" x="38576.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38576.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU11→GPU5</text>
<text text-anchor="middle" x="38576.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38576.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_11&#45;&gt;expert_1_6_0 -->
<g id="edge2970" class="edge">
<title>gate_1_11&#45;&gt;expert_1_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8915.93,-10964.3C8915.93,-10933.93 8915.93,-10896 8915.93,-10896 8915.93,-10896 5996,-10896 5996,-10896 5996,-10896 5996,-10842.16 5996,-10842.16"/>
<polygon fill="blue" stroke="blue" points="5999.5,-10842.16 5996,-10832.16 5992.5,-10842.16 5999.5,-10842.16"/>
<text text-anchor="middle" x="38750.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38750.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU11→GPU6</text>
<text text-anchor="middle" x="38750.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38750.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_11&#45;&gt;expert_1_7_0 -->
<g id="edge2971" class="edge">
<title>gate_1_11&#45;&gt;expert_1_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8936.02,-10963.91C8936.02,-10939.04 8936.02,-10911 8936.02,-10911 8936.02,-10911 6588.02,-10911 6588.02,-10911 6588.02,-10911 6588.02,-10842.12 6588.02,-10842.12"/>
<polygon fill="blue" stroke="blue" points="6591.52,-10842.12 6588.02,-10832.12 6584.52,-10842.12 6591.52,-10842.12"/>
<text text-anchor="middle" x="38924.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38924.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU11→GPU7</text>
<text text-anchor="middle" x="38924.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38924.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_11&#45;&gt;expert_1_8_0 -->
<g id="edge2972" class="edge">
<title>gate_1_11&#45;&gt;expert_1_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8956.12,-10964.63C8956.12,-10942.26 8956.12,-10918 8956.12,-10918 8956.12,-10918 7174.59,-10918 7174.59,-10918 7174.59,-10918 7174.59,-10842.16 7174.59,-10842.16"/>
<polygon fill="blue" stroke="blue" points="7178.09,-10842.16 7174.59,-10832.16 7171.09,-10842.16 7178.09,-10842.16"/>
<text text-anchor="middle" x="39098.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39098.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU11→GPU8</text>
<text text-anchor="middle" x="39098.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39098.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_11&#45;&gt;expert_1_9_0 -->
<g id="edge2973" class="edge">
<title>gate_1_11&#45;&gt;expert_1_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8966.17,-10966C8966.17,-10958.6 8966.17,-10953 8966.17,-10953 8966.17,-10953 7871.5,-10953 7871.5,-10953 7871.5,-10953 7871.5,-10842.21 7871.5,-10842.21"/>
<polygon fill="blue" stroke="blue" points="7875,-10842.21 7871.5,-10832.21 7868,-10842.21 7875,-10842.21"/>
<text text-anchor="middle" x="39272.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39272.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU11→GPU9</text>
<text text-anchor="middle" x="39272.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39272.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_11&#45;&gt;expert_1_10_0 -->
<g id="edge2974" class="edge">
<title>gate_1_11&#45;&gt;expert_1_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8831.3,-11014C8691.46,-11014 8454,-11014 8454,-11014 8454,-11014 8454,-10842.33 8454,-10842.33"/>
<polygon fill="blue" stroke="blue" points="8457.5,-10842.33 8454,-10832.33 8450.5,-10842.33 8457.5,-10842.33"/>
<text text-anchor="middle" x="39446.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39446.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU11→GPU10</text>
<text text-anchor="middle" x="39446.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39446.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_11&#45;&gt;expert_1_11_0 -->
<g id="edge1113" class="edge">
<title>gate_1_11&#45;&gt;expert_1_11_0</title>
<path fill="none" stroke="black" d="M8976.21,-10967.36C8976.21,-10967.36 8976.21,-10842.03 8976.21,-10842.03"/>
<polygon fill="black" stroke="black" points="8979.71,-10842.03 8976.21,-10832.03 8972.71,-10842.03 8979.71,-10842.03"/>
</g>
<!-- gate_1_11&#45;&gt;expert_1_12_0 -->
<g id="edge2975" class="edge">
<title>gate_1_11&#45;&gt;expert_1_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9030.65,-10989C9170.77,-10989 9409.12,-10989 9409.12,-10989 9409.12,-10989 9409.12,-10842.18 9409.12,-10842.18"/>
<polygon fill="blue" stroke="blue" points="9412.63,-10842.18 9409.12,-10832.18 9405.63,-10842.18 9412.63,-10842.18"/>
<text text-anchor="middle" x="39620.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39620.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU11→GPU12</text>
<text text-anchor="middle" x="39620.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39620.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_11&#45;&gt;expert_1_13_0 -->
<g id="edge2976" class="edge">
<title>gate_1_11&#45;&gt;expert_1_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9006.36,-10975.25C9006.36,-10962.12 9006.36,-10949 9006.36,-10949 9006.36,-10949 9992.75,-10949 9992.75,-10949 9992.75,-10949 9992.75,-10842.15 9992.75,-10842.15"/>
<polygon fill="blue" stroke="blue" points="9996.25,-10842.15 9992.75,-10832.15 9989.25,-10842.15 9996.25,-10842.15"/>
<text text-anchor="middle" x="39794.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39794.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU11→GPU13</text>
<text text-anchor="middle" x="39794.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39794.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_11&#45;&gt;expert_1_14_0 -->
<g id="edge2977" class="edge">
<title>gate_1_11&#45;&gt;expert_1_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9016.4,-10979.35C9016.4,-10951.14 9016.4,-10906 9016.4,-10906 9016.4,-10906 10575.7,-10906 10575.7,-10906 10575.7,-10906 10575.7,-10842.17 10575.7,-10842.17"/>
<polygon fill="blue" stroke="blue" points="10579.2,-10842.17 10575.7,-10832.17 10572.2,-10842.17 10579.2,-10842.17"/>
<text text-anchor="middle" x="39968.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39968.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU11→GPU14</text>
<text text-anchor="middle" x="39968.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39968.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_11&#45;&gt;expert_1_15_0 -->
<g id="edge2978" class="edge">
<title>gate_1_11&#45;&gt;expert_1_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9026.45,-10985.35C9026.45,-10956.94 9026.45,-10901 9026.45,-10901 9026.45,-10901 11161.69,-10901 11161.69,-10901 11161.69,-10901 11161.69,-10842.1 11161.69,-10842.1"/>
<polygon fill="blue" stroke="blue" points="11165.19,-10842.1 11161.69,-10832.1 11158.19,-10842.1 11165.19,-10842.1"/>
<text text-anchor="middle" x="40142.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="40142.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU11→GPU15</text>
<text text-anchor="middle" x="40142.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="40142.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_11 -->
<g id="node1126" class="node">
<title>expert_reduce_1_11</title>
<ellipse fill="none" stroke="black" cx="8931" cy="-10668.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="8931" y="-10679.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="8931" y="-10664.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="8931" y="-10649.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_11_0&#45;&gt;expert_reduce_1_11 -->
<g id="edge1114" class="edge">
<title>expert_1_11_0&#45;&gt;expert_reduce_1_11</title>
<path fill="none" stroke="black" d="M8931,-10778.76C8931,-10778.76 8931,-10716.06 8931,-10716.06"/>
<polygon fill="black" stroke="black" points="8934.5,-10716.06 8931,-10706.06 8927.5,-10716.06 8934.5,-10716.06"/>
</g>
<!-- moe_residual_1_11 -->
<g id="node1127" class="node">
<title>moe_residual_1_11</title>
<ellipse fill="none" stroke="black" cx="8931" cy="-10531" rx="105.5" ry="27"/>
<text text-anchor="middle" x="8931" y="-10534.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="8931" y="-10519.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_11&#45;&gt;moe_residual_1_11 -->
<g id="edge1115" class="edge">
<title>expert_reduce_1_11&#45;&gt;moe_residual_1_11</title>
<path fill="none" stroke="black" d="M8931,-10630.93C8931,-10630.93 8931,-10568.06 8931,-10568.06"/>
<polygon fill="black" stroke="black" points="8934.5,-10568.06 8931,-10558.06 8927.5,-10568.06 8934.5,-10568.06"/>
</g>
<!-- qkv_proj_2_11 -->
<g id="node1128" class="node">
<title>qkv_proj_2_11</title>
<polygon fill="none" stroke="black" points="9013.5,-10431 8848.5,-10431 8848.5,-10378 9013.5,-10378 9013.5,-10431"/>
<text text-anchor="middle" x="8931" y="-10415.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="8931" y="-10400.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="8931" y="-10385.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_1_11&#45;&gt;qkv_proj_2_11 -->
<g id="edge1116" class="edge">
<title>moe_residual_1_11&#45;&gt;qkv_proj_2_11</title>
<path fill="none" stroke="black" d="M8931,-10503.86C8931,-10503.86 8931,-10441.16 8931,-10441.16"/>
<polygon fill="black" stroke="black" points="8934.5,-10441.16 8931,-10431.16 8927.5,-10441.16 8934.5,-10441.16"/>
</g>
<!-- qkv_reshape_2_11 -->
<g id="node1129" class="node">
<title>qkv_reshape_2_11</title>
<ellipse fill="none" stroke="black" cx="8931" cy="-10278" rx="148" ry="27"/>
<text text-anchor="middle" x="8931" y="-10281.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="8931" y="-10266.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_2_11&#45;&gt;qkv_reshape_2_11 -->
<g id="edge1117" class="edge">
<title>qkv_proj_2_11&#45;&gt;qkv_reshape_2_11</title>
<path fill="none" stroke="black" d="M8931,-10377.98C8931,-10377.98 8931,-10315.36 8931,-10315.36"/>
<polygon fill="black" stroke="black" points="8934.5,-10315.36 8931,-10305.36 8927.5,-10315.36 8934.5,-10315.36"/>
</g>
<!-- qkv_reshape_2_11&#45;&gt;ring_attn_2_11_stage_0 -->
<g id="edge1118" class="edge">
<title>qkv_reshape_2_11&#45;&gt;ring_attn_2_11_stage_0</title>
<path fill="none" stroke="black" d="M8931,-10250.72C8931,-10250.72 8931,-10144.16 8931,-10144.16"/>
<polygon fill="black" stroke="black" points="8934.5,-10144.16 8931,-10134.16 8927.5,-10144.16 8934.5,-10144.16"/>
</g>
<!-- ring_attn_2_11_stage_0&#45;&gt;ring_attn_2_11_stage_1 -->
<g id="edge1119" class="edge">
<title>ring_attn_2_11_stage_0&#45;&gt;ring_attn_2_11_stage_1</title>
<path fill="none" stroke="black" d="M8931,-9997.87C8931,-9997.87 8931,-9891.25 8931,-9891.25"/>
<polygon fill="black" stroke="black" points="8934.5,-9891.25 8931,-9881.25 8927.5,-9891.25 8934.5,-9891.25"/>
</g>
<!-- ring_attn_2_12_stage_0 -->
<g id="node1228" class="node">
<title>ring_attn_2_12_stage_0</title>
<polygon fill="yellow" stroke="black" points="9518,-10134 9309,-10066 9518,-9998 9727,-10066 9518,-10134"/>
<text text-anchor="middle" x="9518" y="-10084.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-10069.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="9518" y="-10054.8" font-family="Times,serif" font-size="14.00">Q[12]×K[12]×V[12]</text>
<text text-anchor="middle" x="9518" y="-10039.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_11_stage_0&#45;&gt;ring_attn_2_12_stage_0 -->
<g id="edge2979" class="edge">
<title>ring_attn_2_11_stage_0&#45;&gt;ring_attn_2_12_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-10066C9140.02,-10066 9298.86,-10066 9298.86,-10066"/>
<polygon fill="red" stroke="red" points="9298.86,-10069.5 9308.86,-10066 9298.86,-10062.5 9298.86,-10069.5"/>
</g>
<!-- ring_attn_2_11_stage_1&#45;&gt;ring_attn_2_11_stage_2 -->
<g id="edge1120" class="edge">
<title>ring_attn_2_11_stage_1&#45;&gt;ring_attn_2_11_stage_2</title>
<path fill="none" stroke="black" d="M8931,-9744.87C8931,-9744.87 8931,-9638.25 8931,-9638.25"/>
<polygon fill="black" stroke="black" points="8934.5,-9638.25 8931,-9628.25 8927.5,-9638.25 8934.5,-9638.25"/>
</g>
<!-- ring_attn_2_12_stage_1 -->
<g id="node1229" class="node">
<title>ring_attn_2_12_stage_1</title>
<polygon fill="yellow" stroke="black" points="9518,-9881 9309,-9813 9518,-9745 9727,-9813 9518,-9881"/>
<text text-anchor="middle" x="9518" y="-9831.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-9816.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="9518" y="-9801.8" font-family="Times,serif" font-size="14.00">Q[12]×K[11]×V[11]</text>
<text text-anchor="middle" x="9518" y="-9786.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_11_stage_1&#45;&gt;ring_attn_2_12_stage_1 -->
<g id="edge2980" class="edge">
<title>ring_attn_2_11_stage_1&#45;&gt;ring_attn_2_12_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-9813C9140.02,-9813 9298.86,-9813 9298.86,-9813"/>
<polygon fill="red" stroke="red" points="9298.86,-9816.5 9308.86,-9813 9298.86,-9809.5 9298.86,-9816.5"/>
</g>
<!-- ring_attn_2_11_stage_2&#45;&gt;ring_attn_2_11_stage_3 -->
<g id="edge1121" class="edge">
<title>ring_attn_2_11_stage_2&#45;&gt;ring_attn_2_11_stage_3</title>
<path fill="none" stroke="black" d="M8931,-9491.87C8931,-9491.87 8931,-9385.25 8931,-9385.25"/>
<polygon fill="black" stroke="black" points="8934.5,-9385.25 8931,-9375.25 8927.5,-9385.25 8934.5,-9385.25"/>
</g>
<!-- ring_attn_2_12_stage_2 -->
<g id="node1230" class="node">
<title>ring_attn_2_12_stage_2</title>
<polygon fill="yellow" stroke="black" points="9518,-9628 9309,-9560 9518,-9492 9727,-9560 9518,-9628"/>
<text text-anchor="middle" x="9518" y="-9578.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-9563.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="9518" y="-9548.8" font-family="Times,serif" font-size="14.00">Q[12]×K[10]×V[10]</text>
<text text-anchor="middle" x="9518" y="-9533.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_11_stage_2&#45;&gt;ring_attn_2_12_stage_2 -->
<g id="edge2981" class="edge">
<title>ring_attn_2_11_stage_2&#45;&gt;ring_attn_2_12_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-9560C9140.02,-9560 9298.86,-9560 9298.86,-9560"/>
<polygon fill="red" stroke="red" points="9298.86,-9563.5 9308.86,-9560 9298.86,-9556.5 9298.86,-9563.5"/>
</g>
<!-- ring_attn_2_11_stage_3&#45;&gt;ring_attn_2_11_stage_4 -->
<g id="edge1122" class="edge">
<title>ring_attn_2_11_stage_3&#45;&gt;ring_attn_2_11_stage_4</title>
<path fill="none" stroke="black" d="M8931,-9238.87C8931,-9238.87 8931,-9132.25 8931,-9132.25"/>
<polygon fill="black" stroke="black" points="8934.5,-9132.25 8931,-9122.25 8927.5,-9132.25 8934.5,-9132.25"/>
</g>
<!-- ring_attn_2_12_stage_3 -->
<g id="node1231" class="node">
<title>ring_attn_2_12_stage_3</title>
<polygon fill="yellow" stroke="black" points="9518,-9375 9309,-9307 9518,-9239 9727,-9307 9518,-9375"/>
<text text-anchor="middle" x="9518" y="-9325.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-9310.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="9518" y="-9295.8" font-family="Times,serif" font-size="14.00">Q[12]×K[9]×V[9]</text>
<text text-anchor="middle" x="9518" y="-9280.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_11_stage_3&#45;&gt;ring_attn_2_12_stage_3 -->
<g id="edge2982" class="edge">
<title>ring_attn_2_11_stage_3&#45;&gt;ring_attn_2_12_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-9307C9140.02,-9307 9298.86,-9307 9298.86,-9307"/>
<polygon fill="red" stroke="red" points="9298.86,-9310.5 9308.86,-9307 9298.86,-9303.5 9298.86,-9310.5"/>
</g>
<!-- ring_attn_2_11_stage_4&#45;&gt;ring_attn_2_11_stage_5 -->
<g id="edge1123" class="edge">
<title>ring_attn_2_11_stage_4&#45;&gt;ring_attn_2_11_stage_5</title>
<path fill="none" stroke="black" d="M8931,-8985.87C8931,-8985.87 8931,-8879.25 8931,-8879.25"/>
<polygon fill="black" stroke="black" points="8934.5,-8879.25 8931,-8869.25 8927.5,-8879.25 8934.5,-8879.25"/>
</g>
<!-- ring_attn_2_12_stage_4 -->
<g id="node1232" class="node">
<title>ring_attn_2_12_stage_4</title>
<polygon fill="yellow" stroke="black" points="9518,-9122 9309,-9054 9518,-8986 9727,-9054 9518,-9122"/>
<text text-anchor="middle" x="9518" y="-9072.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-9057.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="9518" y="-9042.8" font-family="Times,serif" font-size="14.00">Q[12]×K[8]×V[8]</text>
<text text-anchor="middle" x="9518" y="-9027.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_11_stage_4&#45;&gt;ring_attn_2_12_stage_4 -->
<g id="edge2983" class="edge">
<title>ring_attn_2_11_stage_4&#45;&gt;ring_attn_2_12_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-9054C9140.02,-9054 9298.86,-9054 9298.86,-9054"/>
<polygon fill="red" stroke="red" points="9298.86,-9057.5 9308.86,-9054 9298.86,-9050.5 9298.86,-9057.5"/>
</g>
<!-- ring_attn_2_11_stage_5&#45;&gt;ring_attn_2_11_stage_6 -->
<g id="edge1124" class="edge">
<title>ring_attn_2_11_stage_5&#45;&gt;ring_attn_2_11_stage_6</title>
<path fill="none" stroke="black" d="M8931,-8732.87C8931,-8732.87 8931,-8626.25 8931,-8626.25"/>
<polygon fill="black" stroke="black" points="8934.5,-8626.25 8931,-8616.25 8927.5,-8626.25 8934.5,-8626.25"/>
</g>
<!-- ring_attn_2_12_stage_5 -->
<g id="node1233" class="node">
<title>ring_attn_2_12_stage_5</title>
<polygon fill="yellow" stroke="black" points="9518,-8869 9309,-8801 9518,-8733 9727,-8801 9518,-8869"/>
<text text-anchor="middle" x="9518" y="-8819.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-8804.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="9518" y="-8789.8" font-family="Times,serif" font-size="14.00">Q[12]×K[7]×V[7]</text>
<text text-anchor="middle" x="9518" y="-8774.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_11_stage_5&#45;&gt;ring_attn_2_12_stage_5 -->
<g id="edge2984" class="edge">
<title>ring_attn_2_11_stage_5&#45;&gt;ring_attn_2_12_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-8801C9140.02,-8801 9298.86,-8801 9298.86,-8801"/>
<polygon fill="red" stroke="red" points="9298.86,-8804.5 9308.86,-8801 9298.86,-8797.5 9298.86,-8804.5"/>
</g>
<!-- ring_attn_2_11_stage_6&#45;&gt;ring_attn_2_11_stage_7 -->
<g id="edge1125" class="edge">
<title>ring_attn_2_11_stage_6&#45;&gt;ring_attn_2_11_stage_7</title>
<path fill="none" stroke="black" d="M8931,-8479.87C8931,-8479.87 8931,-8373.25 8931,-8373.25"/>
<polygon fill="black" stroke="black" points="8934.5,-8373.25 8931,-8363.25 8927.5,-8373.25 8934.5,-8373.25"/>
</g>
<!-- ring_attn_2_12_stage_6 -->
<g id="node1234" class="node">
<title>ring_attn_2_12_stage_6</title>
<polygon fill="yellow" stroke="black" points="9518,-8616 9309,-8548 9518,-8480 9727,-8548 9518,-8616"/>
<text text-anchor="middle" x="9518" y="-8566.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-8551.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="9518" y="-8536.8" font-family="Times,serif" font-size="14.00">Q[12]×K[6]×V[6]</text>
<text text-anchor="middle" x="9518" y="-8521.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_11_stage_6&#45;&gt;ring_attn_2_12_stage_6 -->
<g id="edge2985" class="edge">
<title>ring_attn_2_11_stage_6&#45;&gt;ring_attn_2_12_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-8548C9140.02,-8548 9298.86,-8548 9298.86,-8548"/>
<polygon fill="red" stroke="red" points="9298.86,-8551.5 9308.86,-8548 9298.86,-8544.5 9298.86,-8551.5"/>
</g>
<!-- ring_attn_2_11_stage_7&#45;&gt;ring_attn_2_11_stage_8 -->
<g id="edge1126" class="edge">
<title>ring_attn_2_11_stage_7&#45;&gt;ring_attn_2_11_stage_8</title>
<path fill="none" stroke="black" d="M8931,-8226.87C8931,-8226.87 8931,-8120.25 8931,-8120.25"/>
<polygon fill="black" stroke="black" points="8934.5,-8120.25 8931,-8110.25 8927.5,-8120.25 8934.5,-8120.25"/>
</g>
<!-- ring_attn_2_12_stage_7 -->
<g id="node1235" class="node">
<title>ring_attn_2_12_stage_7</title>
<polygon fill="yellow" stroke="black" points="9518,-8363 9309,-8295 9518,-8227 9727,-8295 9518,-8363"/>
<text text-anchor="middle" x="9518" y="-8313.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-8298.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="9518" y="-8283.8" font-family="Times,serif" font-size="14.00">Q[12]×K[5]×V[5]</text>
<text text-anchor="middle" x="9518" y="-8268.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_11_stage_7&#45;&gt;ring_attn_2_12_stage_7 -->
<g id="edge2986" class="edge">
<title>ring_attn_2_11_stage_7&#45;&gt;ring_attn_2_12_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-8295C9140.02,-8295 9298.86,-8295 9298.86,-8295"/>
<polygon fill="red" stroke="red" points="9298.86,-8298.5 9308.86,-8295 9298.86,-8291.5 9298.86,-8298.5"/>
</g>
<!-- ring_attn_2_11_stage_8&#45;&gt;ring_attn_2_11_stage_9 -->
<g id="edge1127" class="edge">
<title>ring_attn_2_11_stage_8&#45;&gt;ring_attn_2_11_stage_9</title>
<path fill="none" stroke="black" d="M8931,-7973.87C8931,-7973.87 8931,-7867.25 8931,-7867.25"/>
<polygon fill="black" stroke="black" points="8934.5,-7867.25 8931,-7857.25 8927.5,-7867.25 8934.5,-7867.25"/>
</g>
<!-- ring_attn_2_12_stage_8 -->
<g id="node1236" class="node">
<title>ring_attn_2_12_stage_8</title>
<polygon fill="yellow" stroke="black" points="9518,-8110 9309,-8042 9518,-7974 9727,-8042 9518,-8110"/>
<text text-anchor="middle" x="9518" y="-8060.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-8045.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="9518" y="-8030.8" font-family="Times,serif" font-size="14.00">Q[12]×K[4]×V[4]</text>
<text text-anchor="middle" x="9518" y="-8015.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_11_stage_8&#45;&gt;ring_attn_2_12_stage_8 -->
<g id="edge2987" class="edge">
<title>ring_attn_2_11_stage_8&#45;&gt;ring_attn_2_12_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-8042C9140.02,-8042 9298.86,-8042 9298.86,-8042"/>
<polygon fill="red" stroke="red" points="9298.86,-8045.5 9308.86,-8042 9298.86,-8038.5 9298.86,-8045.5"/>
</g>
<!-- ring_attn_2_11_stage_9&#45;&gt;ring_attn_2_11_stage_10 -->
<g id="edge1128" class="edge">
<title>ring_attn_2_11_stage_9&#45;&gt;ring_attn_2_11_stage_10</title>
<path fill="none" stroke="black" d="M8931,-7720.87C8931,-7720.87 8931,-7614.25 8931,-7614.25"/>
<polygon fill="black" stroke="black" points="8934.5,-7614.25 8931,-7604.25 8927.5,-7614.25 8934.5,-7614.25"/>
</g>
<!-- ring_attn_2_12_stage_9 -->
<g id="node1237" class="node">
<title>ring_attn_2_12_stage_9</title>
<polygon fill="yellow" stroke="black" points="9518,-7857 9309,-7789 9518,-7721 9727,-7789 9518,-7857"/>
<text text-anchor="middle" x="9518" y="-7807.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-7792.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="9518" y="-7777.8" font-family="Times,serif" font-size="14.00">Q[12]×K[3]×V[3]</text>
<text text-anchor="middle" x="9518" y="-7762.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_11_stage_9&#45;&gt;ring_attn_2_12_stage_9 -->
<g id="edge2988" class="edge">
<title>ring_attn_2_11_stage_9&#45;&gt;ring_attn_2_12_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-7789C9140.02,-7789 9298.86,-7789 9298.86,-7789"/>
<polygon fill="red" stroke="red" points="9298.86,-7792.5 9308.86,-7789 9298.86,-7785.5 9298.86,-7792.5"/>
</g>
<!-- ring_attn_2_11_stage_10&#45;&gt;ring_attn_2_11_stage_11 -->
<g id="edge1129" class="edge">
<title>ring_attn_2_11_stage_10&#45;&gt;ring_attn_2_11_stage_11</title>
<path fill="none" stroke="black" d="M8931,-7467.87C8931,-7467.87 8931,-7361.25 8931,-7361.25"/>
<polygon fill="black" stroke="black" points="8934.5,-7361.25 8931,-7351.25 8927.5,-7361.25 8934.5,-7361.25"/>
</g>
<!-- ring_attn_2_12_stage_10 -->
<g id="node1238" class="node">
<title>ring_attn_2_12_stage_10</title>
<polygon fill="yellow" stroke="black" points="9518,-7604 9309,-7536 9518,-7468 9727,-7536 9518,-7604"/>
<text text-anchor="middle" x="9518" y="-7554.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-7539.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="9518" y="-7524.8" font-family="Times,serif" font-size="14.00">Q[12]×K[2]×V[2]</text>
<text text-anchor="middle" x="9518" y="-7509.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_11_stage_10&#45;&gt;ring_attn_2_12_stage_10 -->
<g id="edge2989" class="edge">
<title>ring_attn_2_11_stage_10&#45;&gt;ring_attn_2_12_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-7536C9140.02,-7536 9298.86,-7536 9298.86,-7536"/>
<polygon fill="red" stroke="red" points="9298.86,-7539.5 9308.86,-7536 9298.86,-7532.5 9298.86,-7539.5"/>
</g>
<!-- ring_attn_2_11_stage_11&#45;&gt;ring_attn_2_11_stage_12 -->
<g id="edge1130" class="edge">
<title>ring_attn_2_11_stage_11&#45;&gt;ring_attn_2_11_stage_12</title>
<path fill="none" stroke="black" d="M8931,-7214.87C8931,-7214.87 8931,-7108.25 8931,-7108.25"/>
<polygon fill="black" stroke="black" points="8934.5,-7108.25 8931,-7098.25 8927.5,-7108.25 8934.5,-7108.25"/>
</g>
<!-- ring_attn_2_12_stage_11 -->
<g id="node1239" class="node">
<title>ring_attn_2_12_stage_11</title>
<polygon fill="yellow" stroke="black" points="9518,-7351 9309,-7283 9518,-7215 9727,-7283 9518,-7351"/>
<text text-anchor="middle" x="9518" y="-7301.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-7286.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="9518" y="-7271.8" font-family="Times,serif" font-size="14.00">Q[12]×K[1]×V[1]</text>
<text text-anchor="middle" x="9518" y="-7256.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_11_stage_11&#45;&gt;ring_attn_2_12_stage_11 -->
<g id="edge2990" class="edge">
<title>ring_attn_2_11_stage_11&#45;&gt;ring_attn_2_12_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-7283C9140.02,-7283 9298.86,-7283 9298.86,-7283"/>
<polygon fill="red" stroke="red" points="9298.86,-7286.5 9308.86,-7283 9298.86,-7279.5 9298.86,-7286.5"/>
</g>
<!-- ring_attn_2_11_stage_12&#45;&gt;ring_attn_2_11_stage_13 -->
<g id="edge1131" class="edge">
<title>ring_attn_2_11_stage_12&#45;&gt;ring_attn_2_11_stage_13</title>
<path fill="none" stroke="black" d="M8931,-6961.87C8931,-6961.87 8931,-6855.25 8931,-6855.25"/>
<polygon fill="black" stroke="black" points="8934.5,-6855.25 8931,-6845.25 8927.5,-6855.25 8934.5,-6855.25"/>
</g>
<!-- ring_attn_2_12_stage_12 -->
<g id="node1240" class="node">
<title>ring_attn_2_12_stage_12</title>
<polygon fill="yellow" stroke="black" points="9518,-7098 9309,-7030 9518,-6962 9727,-7030 9518,-7098"/>
<text text-anchor="middle" x="9518" y="-7048.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-7033.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="9518" y="-7018.8" font-family="Times,serif" font-size="14.00">Q[12]×K[0]×V[0]</text>
<text text-anchor="middle" x="9518" y="-7003.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_11_stage_12&#45;&gt;ring_attn_2_12_stage_12 -->
<g id="edge2991" class="edge">
<title>ring_attn_2_11_stage_12&#45;&gt;ring_attn_2_12_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-7030C9140.02,-7030 9298.86,-7030 9298.86,-7030"/>
<polygon fill="red" stroke="red" points="9298.86,-7033.5 9308.86,-7030 9298.86,-7026.5 9298.86,-7033.5"/>
</g>
<!-- ring_attn_2_11_stage_13&#45;&gt;ring_attn_2_11_stage_14 -->
<g id="edge1132" class="edge">
<title>ring_attn_2_11_stage_13&#45;&gt;ring_attn_2_11_stage_14</title>
<path fill="none" stroke="black" d="M8931,-6708.87C8931,-6708.87 8931,-6602.25 8931,-6602.25"/>
<polygon fill="black" stroke="black" points="8934.5,-6602.25 8931,-6592.25 8927.5,-6602.25 8934.5,-6602.25"/>
</g>
<!-- ring_attn_2_12_stage_13 -->
<g id="node1241" class="node">
<title>ring_attn_2_12_stage_13</title>
<polygon fill="yellow" stroke="black" points="9518,-6845 9309,-6777 9518,-6709 9727,-6777 9518,-6845"/>
<text text-anchor="middle" x="9518" y="-6795.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-6780.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="9518" y="-6765.8" font-family="Times,serif" font-size="14.00">Q[12]×K[15]×V[15]</text>
<text text-anchor="middle" x="9518" y="-6750.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_11_stage_13&#45;&gt;ring_attn_2_12_stage_13 -->
<g id="edge2992" class="edge">
<title>ring_attn_2_11_stage_13&#45;&gt;ring_attn_2_12_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-6777C9140.02,-6777 9298.86,-6777 9298.86,-6777"/>
<polygon fill="red" stroke="red" points="9298.86,-6780.5 9308.86,-6777 9298.86,-6773.5 9298.86,-6780.5"/>
</g>
<!-- ring_attn_2_11_stage_14&#45;&gt;ring_attn_2_11_stage_15 -->
<g id="edge1133" class="edge">
<title>ring_attn_2_11_stage_14&#45;&gt;ring_attn_2_11_stage_15</title>
<path fill="none" stroke="black" d="M8931,-6455.87C8931,-6455.87 8931,-6349.25 8931,-6349.25"/>
<polygon fill="black" stroke="black" points="8934.5,-6349.25 8931,-6339.25 8927.5,-6349.25 8934.5,-6349.25"/>
</g>
<!-- ring_attn_2_12_stage_14 -->
<g id="node1242" class="node">
<title>ring_attn_2_12_stage_14</title>
<polygon fill="yellow" stroke="black" points="9518,-6592 9309,-6524 9518,-6456 9727,-6524 9518,-6592"/>
<text text-anchor="middle" x="9518" y="-6542.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-6527.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="9518" y="-6512.8" font-family="Times,serif" font-size="14.00">Q[12]×K[14]×V[14]</text>
<text text-anchor="middle" x="9518" y="-6497.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_11_stage_14&#45;&gt;ring_attn_2_12_stage_14 -->
<g id="edge2993" class="edge">
<title>ring_attn_2_11_stage_14&#45;&gt;ring_attn_2_12_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-6524C9140.02,-6524 9298.86,-6524 9298.86,-6524"/>
<polygon fill="red" stroke="red" points="9298.86,-6527.5 9308.86,-6524 9298.86,-6520.5 9298.86,-6527.5"/>
</g>
<!-- attn_out_2_11 -->
<g id="node1146" class="node">
<title>attn_out_2_11</title>
<polygon fill="none" stroke="black" points="9000.5,-6130 8861.5,-6130 8861.5,-6077 9000.5,-6077 9000.5,-6130"/>
<text text-anchor="middle" x="8931" y="-6114.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="8931" y="-6099.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="8931" y="-6084.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_2_11_stage_15&#45;&gt;attn_out_2_11 -->
<g id="edge1134" class="edge">
<title>ring_attn_2_11_stage_15&#45;&gt;attn_out_2_11</title>
<path fill="none" stroke="black" d="M8931,-6202.87C8931,-6202.87 8931,-6140.18 8931,-6140.18"/>
<polygon fill="black" stroke="black" points="8934.5,-6140.18 8931,-6130.18 8927.5,-6140.18 8934.5,-6140.18"/>
</g>
<!-- ring_attn_2_12_stage_15 -->
<g id="node1243" class="node">
<title>ring_attn_2_12_stage_15</title>
<polygon fill="yellow" stroke="black" points="9518,-6339 9309,-6271 9518,-6203 9727,-6271 9518,-6339"/>
<text text-anchor="middle" x="9518" y="-6289.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-6274.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="9518" y="-6259.8" font-family="Times,serif" font-size="14.00">Q[12]×K[13]×V[13]</text>
<text text-anchor="middle" x="9518" y="-6244.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_11_stage_15&#45;&gt;ring_attn_2_12_stage_15 -->
<g id="edge2994" class="edge">
<title>ring_attn_2_11_stage_15&#45;&gt;ring_attn_2_12_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-6271C9140.02,-6271 9298.86,-6271 9298.86,-6271"/>
<polygon fill="red" stroke="red" points="9298.86,-6274.5 9308.86,-6271 9298.86,-6267.5 9298.86,-6274.5"/>
</g>
<!-- attn_residual_2_11 -->
<g id="node1147" class="node">
<title>attn_residual_2_11</title>
<ellipse fill="none" stroke="black" cx="8931" cy="-5977" rx="105.5" ry="27"/>
<text text-anchor="middle" x="8931" y="-5980.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="8931" y="-5965.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_2_11&#45;&gt;attn_residual_2_11 -->
<g id="edge1135" class="edge">
<title>attn_out_2_11&#45;&gt;attn_residual_2_11</title>
<path fill="none" stroke="black" d="M8931,-6076.98C8931,-6076.98 8931,-6014.36 8931,-6014.36"/>
<polygon fill="black" stroke="black" points="8934.5,-6014.36 8931,-6004.36 8927.5,-6014.36 8934.5,-6014.36"/>
</g>
<!-- gate_2_11 -->
<g id="node1148" class="node">
<title>gate_2_11</title>
<ellipse fill="orange" stroke="black" cx="8931" cy="-5839.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="8931" y="-5850.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="8931" y="-5835.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="8931" y="-5820.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_2_11&#45;&gt;gate_2_11 -->
<g id="edge1136" class="edge">
<title>attn_residual_2_11&#45;&gt;gate_2_11</title>
<path fill="none" stroke="black" d="M8983.75,-5953.36C8983.75,-5953.36 8983.75,-5882.08 8983.75,-5882.08"/>
<polygon fill="black" stroke="black" points="8987.25,-5882.08 8983.75,-5872.08 8980.25,-5882.08 8987.25,-5882.08"/>
</g>
<!-- gate_2_11&#45;&gt;expert_2_0_0 -->
<g id="edge2995" class="edge">
<title>gate_2_11&#45;&gt;expert_2_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8931,-5877.09C8931,-5906.34 8931,-5942 8931,-5942 8931,-5942 111.4,-5942 111.4,-5942 111.4,-5942 111.4,-5680.25 111.4,-5680.25"/>
<polygon fill="blue" stroke="blue" points="114.9,-5680.25 111.4,-5670.25 107.9,-5680.25 114.9,-5680.25"/>
<text text-anchor="middle" x="37706.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37706.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU11→GPU0</text>
<text text-anchor="middle" x="37706.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37706.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_11&#45;&gt;expert_2_1_0 -->
<g id="edge2996" class="edge">
<title>gate_2_11&#45;&gt;expert_2_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8878.25,-5872.21C8878.25,-5890.24 8878.25,-5909 8878.25,-5909 8878.25,-5909 3168.43,-5909 3168.43,-5909 3168.43,-5909 3168.43,-5680.42 3168.43,-5680.42"/>
<polygon fill="blue" stroke="blue" points="3171.93,-5680.42 3168.43,-5670.42 3164.93,-5680.42 3171.93,-5680.42"/>
<text text-anchor="middle" x="37880.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37880.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU11→GPU1</text>
<text text-anchor="middle" x="37880.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37880.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_11&#45;&gt;expert_2_2_0 -->
<g id="edge2997" class="edge">
<title>gate_2_11&#45;&gt;expert_2_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8835.55,-5823.36C8835.55,-5788.65 8835.55,-5710 8835.55,-5710 8835.55,-5710 3620.65,-5710 3620.65,-5710 3620.65,-5710 3620.65,-5680.16 3620.65,-5680.16"/>
<polygon fill="blue" stroke="blue" points="3624.15,-5680.16 3620.65,-5670.16 3617.15,-5680.16 3624.15,-5680.16"/>
<text text-anchor="middle" x="38054.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38054.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU11→GPU2</text>
<text text-anchor="middle" x="38054.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38054.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_11&#45;&gt;expert_2_3_0 -->
<g id="edge2998" class="edge">
<title>gate_2_11&#45;&gt;expert_2_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8855.64,-5813.09C8855.64,-5774.96 8855.64,-5709 8855.64,-5709 8855.64,-5709 4213.9,-5709 4213.9,-5709 4213.9,-5709 4213.9,-5680.14 4213.9,-5680.14"/>
<polygon fill="blue" stroke="blue" points="4217.4,-5680.14 4213.9,-5670.14 4210.4,-5680.14 4217.4,-5680.14"/>
<text text-anchor="middle" x="38228.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38228.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU11→GPU3</text>
<text text-anchor="middle" x="38228.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38228.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_11&#45;&gt;expert_2_4_0 -->
<g id="edge2999" class="edge">
<title>gate_2_11&#45;&gt;expert_2_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8875.74,-5807.31C8875.74,-5771.02 8875.74,-5717 8875.74,-5717 8875.74,-5717 4816.98,-5717 4816.98,-5717 4816.98,-5717 4816.98,-5680.04 4816.98,-5680.04"/>
<polygon fill="blue" stroke="blue" points="4820.48,-5680.04 4816.98,-5670.04 4813.48,-5680.04 4820.48,-5680.04"/>
<text text-anchor="middle" x="38402.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38402.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU11→GPU4</text>
<text text-anchor="middle" x="38402.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38402.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_11&#45;&gt;expert_2_5_0 -->
<g id="edge3000" class="edge">
<title>gate_2_11&#45;&gt;expert_2_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8895.83,-5803.9C8895.83,-5770.61 8895.83,-5726 8895.83,-5726 8895.83,-5726 5414.02,-5726 5414.02,-5726 5414.02,-5726 5414.02,-5680.06 5414.02,-5680.06"/>
<polygon fill="blue" stroke="blue" points="5417.52,-5680.06 5414.02,-5670.06 5410.52,-5680.06 5417.52,-5680.06"/>
<text text-anchor="middle" x="38576.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38576.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU11→GPU5</text>
<text text-anchor="middle" x="38576.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38576.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_11&#45;&gt;expert_2_6_0 -->
<g id="edge3001" class="edge">
<title>gate_2_11&#45;&gt;expert_2_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8915.93,-5802.3C8915.93,-5771.93 8915.93,-5734 8915.93,-5734 8915.93,-5734 5996,-5734 5996,-5734 5996,-5734 5996,-5680.16 5996,-5680.16"/>
<polygon fill="blue" stroke="blue" points="5999.5,-5680.16 5996,-5670.16 5992.5,-5680.16 5999.5,-5680.16"/>
<text text-anchor="middle" x="38750.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38750.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU11→GPU6</text>
<text text-anchor="middle" x="38750.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38750.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_11&#45;&gt;expert_2_7_0 -->
<g id="edge3002" class="edge">
<title>gate_2_11&#45;&gt;expert_2_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8936.02,-5801.91C8936.02,-5777.04 8936.02,-5749 8936.02,-5749 8936.02,-5749 6588.02,-5749 6588.02,-5749 6588.02,-5749 6588.02,-5680.12 6588.02,-5680.12"/>
<polygon fill="blue" stroke="blue" points="6591.52,-5680.12 6588.02,-5670.12 6584.52,-5680.12 6591.52,-5680.12"/>
<text text-anchor="middle" x="38924.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38924.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU11→GPU7</text>
<text text-anchor="middle" x="38924.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38924.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_11&#45;&gt;expert_2_8_0 -->
<g id="edge3003" class="edge">
<title>gate_2_11&#45;&gt;expert_2_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8956.12,-5802.63C8956.12,-5780.26 8956.12,-5756 8956.12,-5756 8956.12,-5756 7174.59,-5756 7174.59,-5756 7174.59,-5756 7174.59,-5680.16 7174.59,-5680.16"/>
<polygon fill="blue" stroke="blue" points="7178.09,-5680.16 7174.59,-5670.16 7171.09,-5680.16 7178.09,-5680.16"/>
<text text-anchor="middle" x="39098.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39098.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU11→GPU8</text>
<text text-anchor="middle" x="39098.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39098.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_11&#45;&gt;expert_2_9_0 -->
<g id="edge3004" class="edge">
<title>gate_2_11&#45;&gt;expert_2_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8966.17,-5804C8966.17,-5796.6 8966.17,-5791 8966.17,-5791 8966.17,-5791 7871.5,-5791 7871.5,-5791 7871.5,-5791 7871.5,-5680.21 7871.5,-5680.21"/>
<polygon fill="blue" stroke="blue" points="7875,-5680.21 7871.5,-5670.21 7868,-5680.21 7875,-5680.21"/>
<text text-anchor="middle" x="39272.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39272.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU11→GPU9</text>
<text text-anchor="middle" x="39272.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39272.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_11&#45;&gt;expert_2_10_0 -->
<g id="edge3005" class="edge">
<title>gate_2_11&#45;&gt;expert_2_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8831.3,-5852C8691.46,-5852 8454,-5852 8454,-5852 8454,-5852 8454,-5680.33 8454,-5680.33"/>
<polygon fill="blue" stroke="blue" points="8457.5,-5680.33 8454,-5670.33 8450.5,-5680.33 8457.5,-5680.33"/>
<text text-anchor="middle" x="39446.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39446.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU11→GPU10</text>
<text text-anchor="middle" x="39446.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39446.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_11&#45;&gt;expert_2_11_0 -->
<g id="edge1137" class="edge">
<title>gate_2_11&#45;&gt;expert_2_11_0</title>
<path fill="none" stroke="black" d="M8976.21,-5805.36C8976.21,-5805.36 8976.21,-5680.03 8976.21,-5680.03"/>
<polygon fill="black" stroke="black" points="8979.71,-5680.03 8976.21,-5670.03 8972.71,-5680.03 8979.71,-5680.03"/>
</g>
<!-- gate_2_11&#45;&gt;expert_2_12_0 -->
<g id="edge3006" class="edge">
<title>gate_2_11&#45;&gt;expert_2_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9030.65,-5827C9170.77,-5827 9409.12,-5827 9409.12,-5827 9409.12,-5827 9409.12,-5680.18 9409.12,-5680.18"/>
<polygon fill="blue" stroke="blue" points="9412.63,-5680.18 9409.12,-5670.18 9405.63,-5680.18 9412.63,-5680.18"/>
<text text-anchor="middle" x="39620.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39620.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU11→GPU12</text>
<text text-anchor="middle" x="39620.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39620.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_11&#45;&gt;expert_2_13_0 -->
<g id="edge3007" class="edge">
<title>gate_2_11&#45;&gt;expert_2_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9006.36,-5813.25C9006.36,-5800.12 9006.36,-5787 9006.36,-5787 9006.36,-5787 9992.75,-5787 9992.75,-5787 9992.75,-5787 9992.75,-5680.15 9992.75,-5680.15"/>
<polygon fill="blue" stroke="blue" points="9996.25,-5680.15 9992.75,-5670.15 9989.25,-5680.15 9996.25,-5680.15"/>
<text text-anchor="middle" x="39794.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39794.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU11→GPU13</text>
<text text-anchor="middle" x="39794.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39794.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_11&#45;&gt;expert_2_14_0 -->
<g id="edge3008" class="edge">
<title>gate_2_11&#45;&gt;expert_2_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9016.4,-5817.35C9016.4,-5789.14 9016.4,-5744 9016.4,-5744 9016.4,-5744 10575.7,-5744 10575.7,-5744 10575.7,-5744 10575.7,-5680.17 10575.7,-5680.17"/>
<polygon fill="blue" stroke="blue" points="10579.2,-5680.17 10575.7,-5670.17 10572.2,-5680.17 10579.2,-5680.17"/>
<text text-anchor="middle" x="39968.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39968.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU11→GPU14</text>
<text text-anchor="middle" x="39968.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39968.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_11&#45;&gt;expert_2_15_0 -->
<g id="edge3009" class="edge">
<title>gate_2_11&#45;&gt;expert_2_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9026.45,-5823.35C9026.45,-5794.94 9026.45,-5739 9026.45,-5739 9026.45,-5739 11161.69,-5739 11161.69,-5739 11161.69,-5739 11161.69,-5680.1 11161.69,-5680.1"/>
<polygon fill="blue" stroke="blue" points="11165.19,-5680.1 11161.69,-5670.1 11158.19,-5680.1 11165.19,-5680.1"/>
<text text-anchor="middle" x="40142.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="40142.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU11→GPU15</text>
<text text-anchor="middle" x="40142.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="40142.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_11 -->
<g id="node1150" class="node">
<title>expert_reduce_2_11</title>
<ellipse fill="none" stroke="black" cx="8931" cy="-5506.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="8931" y="-5517.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="8931" y="-5502.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="8931" y="-5487.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_11_0&#45;&gt;expert_reduce_2_11 -->
<g id="edge1138" class="edge">
<title>expert_2_11_0&#45;&gt;expert_reduce_2_11</title>
<path fill="none" stroke="black" d="M8931,-5616.76C8931,-5616.76 8931,-5554.06 8931,-5554.06"/>
<polygon fill="black" stroke="black" points="8934.5,-5554.06 8931,-5544.06 8927.5,-5554.06 8934.5,-5554.06"/>
</g>
<!-- moe_residual_2_11 -->
<g id="node1151" class="node">
<title>moe_residual_2_11</title>
<ellipse fill="none" stroke="black" cx="8931" cy="-5369" rx="105.5" ry="27"/>
<text text-anchor="middle" x="8931" y="-5372.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="8931" y="-5357.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_11&#45;&gt;moe_residual_2_11 -->
<g id="edge1139" class="edge">
<title>expert_reduce_2_11&#45;&gt;moe_residual_2_11</title>
<path fill="none" stroke="black" d="M8931,-5468.93C8931,-5468.93 8931,-5406.06 8931,-5406.06"/>
<polygon fill="black" stroke="black" points="8934.5,-5406.06 8931,-5396.06 8927.5,-5406.06 8934.5,-5406.06"/>
</g>
<!-- qkv_proj_3_11 -->
<g id="node1152" class="node">
<title>qkv_proj_3_11</title>
<polygon fill="none" stroke="black" points="9013.5,-5269 8848.5,-5269 8848.5,-5216 9013.5,-5216 9013.5,-5269"/>
<text text-anchor="middle" x="8931" y="-5253.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="8931" y="-5238.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="8931" y="-5223.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_2_11&#45;&gt;qkv_proj_3_11 -->
<g id="edge1140" class="edge">
<title>moe_residual_2_11&#45;&gt;qkv_proj_3_11</title>
<path fill="none" stroke="black" d="M8931,-5341.86C8931,-5341.86 8931,-5279.16 8931,-5279.16"/>
<polygon fill="black" stroke="black" points="8934.5,-5279.16 8931,-5269.16 8927.5,-5279.16 8934.5,-5279.16"/>
</g>
<!-- qkv_reshape_3_11 -->
<g id="node1153" class="node">
<title>qkv_reshape_3_11</title>
<ellipse fill="none" stroke="black" cx="8931" cy="-5116" rx="148" ry="27"/>
<text text-anchor="middle" x="8931" y="-5119.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="8931" y="-5104.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_3_11&#45;&gt;qkv_reshape_3_11 -->
<g id="edge1141" class="edge">
<title>qkv_proj_3_11&#45;&gt;qkv_reshape_3_11</title>
<path fill="none" stroke="black" d="M8931,-5215.98C8931,-5215.98 8931,-5153.36 8931,-5153.36"/>
<polygon fill="black" stroke="black" points="8934.5,-5153.36 8931,-5143.36 8927.5,-5153.36 8934.5,-5153.36"/>
</g>
<!-- qkv_reshape_3_11&#45;&gt;ring_attn_3_11_stage_0 -->
<g id="edge1142" class="edge">
<title>qkv_reshape_3_11&#45;&gt;ring_attn_3_11_stage_0</title>
<path fill="none" stroke="black" d="M8931,-5088.72C8931,-5088.72 8931,-4982.16 8931,-4982.16"/>
<polygon fill="black" stroke="black" points="8934.5,-4982.16 8931,-4972.16 8927.5,-4982.16 8934.5,-4982.16"/>
</g>
<!-- ring_attn_3_11_stage_0&#45;&gt;ring_attn_3_11_stage_1 -->
<g id="edge1143" class="edge">
<title>ring_attn_3_11_stage_0&#45;&gt;ring_attn_3_11_stage_1</title>
<path fill="none" stroke="black" d="M8931,-4835.87C8931,-4835.87 8931,-4729.25 8931,-4729.25"/>
<polygon fill="black" stroke="black" points="8934.5,-4729.25 8931,-4719.25 8927.5,-4729.25 8934.5,-4729.25"/>
</g>
<!-- ring_attn_3_12_stage_0 -->
<g id="node1252" class="node">
<title>ring_attn_3_12_stage_0</title>
<polygon fill="yellow" stroke="black" points="9518,-4972 9309,-4904 9518,-4836 9727,-4904 9518,-4972"/>
<text text-anchor="middle" x="9518" y="-4922.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-4907.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="9518" y="-4892.8" font-family="Times,serif" font-size="14.00">Q[12]×K[12]×V[12]</text>
<text text-anchor="middle" x="9518" y="-4877.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_11_stage_0&#45;&gt;ring_attn_3_12_stage_0 -->
<g id="edge3010" class="edge">
<title>ring_attn_3_11_stage_0&#45;&gt;ring_attn_3_12_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-4904C9140.02,-4904 9298.86,-4904 9298.86,-4904"/>
<polygon fill="red" stroke="red" points="9298.86,-4907.5 9308.86,-4904 9298.86,-4900.5 9298.86,-4907.5"/>
</g>
<!-- ring_attn_3_11_stage_1&#45;&gt;ring_attn_3_11_stage_2 -->
<g id="edge1144" class="edge">
<title>ring_attn_3_11_stage_1&#45;&gt;ring_attn_3_11_stage_2</title>
<path fill="none" stroke="black" d="M8931,-4582.87C8931,-4582.87 8931,-4476.25 8931,-4476.25"/>
<polygon fill="black" stroke="black" points="8934.5,-4476.25 8931,-4466.25 8927.5,-4476.25 8934.5,-4476.25"/>
</g>
<!-- ring_attn_3_12_stage_1 -->
<g id="node1253" class="node">
<title>ring_attn_3_12_stage_1</title>
<polygon fill="yellow" stroke="black" points="9518,-4719 9309,-4651 9518,-4583 9727,-4651 9518,-4719"/>
<text text-anchor="middle" x="9518" y="-4669.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-4654.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="9518" y="-4639.8" font-family="Times,serif" font-size="14.00">Q[12]×K[11]×V[11]</text>
<text text-anchor="middle" x="9518" y="-4624.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_11_stage_1&#45;&gt;ring_attn_3_12_stage_1 -->
<g id="edge3011" class="edge">
<title>ring_attn_3_11_stage_1&#45;&gt;ring_attn_3_12_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-4651C9140.02,-4651 9298.86,-4651 9298.86,-4651"/>
<polygon fill="red" stroke="red" points="9298.86,-4654.5 9308.86,-4651 9298.86,-4647.5 9298.86,-4654.5"/>
</g>
<!-- ring_attn_3_11_stage_2&#45;&gt;ring_attn_3_11_stage_3 -->
<g id="edge1145" class="edge">
<title>ring_attn_3_11_stage_2&#45;&gt;ring_attn_3_11_stage_3</title>
<path fill="none" stroke="black" d="M8931,-4329.87C8931,-4329.87 8931,-4223.25 8931,-4223.25"/>
<polygon fill="black" stroke="black" points="8934.5,-4223.25 8931,-4213.25 8927.5,-4223.25 8934.5,-4223.25"/>
</g>
<!-- ring_attn_3_12_stage_2 -->
<g id="node1254" class="node">
<title>ring_attn_3_12_stage_2</title>
<polygon fill="yellow" stroke="black" points="9518,-4466 9309,-4398 9518,-4330 9727,-4398 9518,-4466"/>
<text text-anchor="middle" x="9518" y="-4416.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-4401.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="9518" y="-4386.8" font-family="Times,serif" font-size="14.00">Q[12]×K[10]×V[10]</text>
<text text-anchor="middle" x="9518" y="-4371.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_11_stage_2&#45;&gt;ring_attn_3_12_stage_2 -->
<g id="edge3012" class="edge">
<title>ring_attn_3_11_stage_2&#45;&gt;ring_attn_3_12_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-4398C9140.02,-4398 9298.86,-4398 9298.86,-4398"/>
<polygon fill="red" stroke="red" points="9298.86,-4401.5 9308.86,-4398 9298.86,-4394.5 9298.86,-4401.5"/>
</g>
<!-- ring_attn_3_11_stage_3&#45;&gt;ring_attn_3_11_stage_4 -->
<g id="edge1146" class="edge">
<title>ring_attn_3_11_stage_3&#45;&gt;ring_attn_3_11_stage_4</title>
<path fill="none" stroke="black" d="M8931,-4076.87C8931,-4076.87 8931,-3970.25 8931,-3970.25"/>
<polygon fill="black" stroke="black" points="8934.5,-3970.25 8931,-3960.25 8927.5,-3970.25 8934.5,-3970.25"/>
</g>
<!-- ring_attn_3_12_stage_3 -->
<g id="node1255" class="node">
<title>ring_attn_3_12_stage_3</title>
<polygon fill="yellow" stroke="black" points="9518,-4213 9309,-4145 9518,-4077 9727,-4145 9518,-4213"/>
<text text-anchor="middle" x="9518" y="-4163.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-4148.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="9518" y="-4133.8" font-family="Times,serif" font-size="14.00">Q[12]×K[9]×V[9]</text>
<text text-anchor="middle" x="9518" y="-4118.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_11_stage_3&#45;&gt;ring_attn_3_12_stage_3 -->
<g id="edge3013" class="edge">
<title>ring_attn_3_11_stage_3&#45;&gt;ring_attn_3_12_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-4145C9140.02,-4145 9298.86,-4145 9298.86,-4145"/>
<polygon fill="red" stroke="red" points="9298.86,-4148.5 9308.86,-4145 9298.86,-4141.5 9298.86,-4148.5"/>
</g>
<!-- ring_attn_3_11_stage_4&#45;&gt;ring_attn_3_11_stage_5 -->
<g id="edge1147" class="edge">
<title>ring_attn_3_11_stage_4&#45;&gt;ring_attn_3_11_stage_5</title>
<path fill="none" stroke="black" d="M8931,-3823.87C8931,-3823.87 8931,-3717.25 8931,-3717.25"/>
<polygon fill="black" stroke="black" points="8934.5,-3717.25 8931,-3707.25 8927.5,-3717.25 8934.5,-3717.25"/>
</g>
<!-- ring_attn_3_12_stage_4 -->
<g id="node1256" class="node">
<title>ring_attn_3_12_stage_4</title>
<polygon fill="yellow" stroke="black" points="9518,-3960 9309,-3892 9518,-3824 9727,-3892 9518,-3960"/>
<text text-anchor="middle" x="9518" y="-3910.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-3895.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="9518" y="-3880.8" font-family="Times,serif" font-size="14.00">Q[12]×K[8]×V[8]</text>
<text text-anchor="middle" x="9518" y="-3865.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_11_stage_4&#45;&gt;ring_attn_3_12_stage_4 -->
<g id="edge3014" class="edge">
<title>ring_attn_3_11_stage_4&#45;&gt;ring_attn_3_12_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-3892C9140.02,-3892 9298.86,-3892 9298.86,-3892"/>
<polygon fill="red" stroke="red" points="9298.86,-3895.5 9308.86,-3892 9298.86,-3888.5 9298.86,-3895.5"/>
</g>
<!-- ring_attn_3_11_stage_5&#45;&gt;ring_attn_3_11_stage_6 -->
<g id="edge1148" class="edge">
<title>ring_attn_3_11_stage_5&#45;&gt;ring_attn_3_11_stage_6</title>
<path fill="none" stroke="black" d="M8931,-3570.87C8931,-3570.87 8931,-3464.25 8931,-3464.25"/>
<polygon fill="black" stroke="black" points="8934.5,-3464.25 8931,-3454.25 8927.5,-3464.25 8934.5,-3464.25"/>
</g>
<!-- ring_attn_3_12_stage_5 -->
<g id="node1257" class="node">
<title>ring_attn_3_12_stage_5</title>
<polygon fill="yellow" stroke="black" points="9518,-3707 9309,-3639 9518,-3571 9727,-3639 9518,-3707"/>
<text text-anchor="middle" x="9518" y="-3657.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-3642.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="9518" y="-3627.8" font-family="Times,serif" font-size="14.00">Q[12]×K[7]×V[7]</text>
<text text-anchor="middle" x="9518" y="-3612.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_11_stage_5&#45;&gt;ring_attn_3_12_stage_5 -->
<g id="edge3015" class="edge">
<title>ring_attn_3_11_stage_5&#45;&gt;ring_attn_3_12_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-3639C9140.02,-3639 9298.86,-3639 9298.86,-3639"/>
<polygon fill="red" stroke="red" points="9298.86,-3642.5 9308.86,-3639 9298.86,-3635.5 9298.86,-3642.5"/>
</g>
<!-- ring_attn_3_11_stage_6&#45;&gt;ring_attn_3_11_stage_7 -->
<g id="edge1149" class="edge">
<title>ring_attn_3_11_stage_6&#45;&gt;ring_attn_3_11_stage_7</title>
<path fill="none" stroke="black" d="M8931,-3317.87C8931,-3317.87 8931,-3211.25 8931,-3211.25"/>
<polygon fill="black" stroke="black" points="8934.5,-3211.25 8931,-3201.25 8927.5,-3211.25 8934.5,-3211.25"/>
</g>
<!-- ring_attn_3_12_stage_6 -->
<g id="node1258" class="node">
<title>ring_attn_3_12_stage_6</title>
<polygon fill="yellow" stroke="black" points="9518,-3454 9309,-3386 9518,-3318 9727,-3386 9518,-3454"/>
<text text-anchor="middle" x="9518" y="-3404.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-3389.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="9518" y="-3374.8" font-family="Times,serif" font-size="14.00">Q[12]×K[6]×V[6]</text>
<text text-anchor="middle" x="9518" y="-3359.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_11_stage_6&#45;&gt;ring_attn_3_12_stage_6 -->
<g id="edge3016" class="edge">
<title>ring_attn_3_11_stage_6&#45;&gt;ring_attn_3_12_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-3386C9140.02,-3386 9298.86,-3386 9298.86,-3386"/>
<polygon fill="red" stroke="red" points="9298.86,-3389.5 9308.86,-3386 9298.86,-3382.5 9298.86,-3389.5"/>
</g>
<!-- ring_attn_3_11_stage_7&#45;&gt;ring_attn_3_11_stage_8 -->
<g id="edge1150" class="edge">
<title>ring_attn_3_11_stage_7&#45;&gt;ring_attn_3_11_stage_8</title>
<path fill="none" stroke="black" d="M8931,-3064.87C8931,-3064.87 8931,-2958.25 8931,-2958.25"/>
<polygon fill="black" stroke="black" points="8934.5,-2958.25 8931,-2948.25 8927.5,-2958.25 8934.5,-2958.25"/>
</g>
<!-- ring_attn_3_12_stage_7 -->
<g id="node1259" class="node">
<title>ring_attn_3_12_stage_7</title>
<polygon fill="yellow" stroke="black" points="9518,-3201 9309,-3133 9518,-3065 9727,-3133 9518,-3201"/>
<text text-anchor="middle" x="9518" y="-3151.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-3136.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="9518" y="-3121.8" font-family="Times,serif" font-size="14.00">Q[12]×K[5]×V[5]</text>
<text text-anchor="middle" x="9518" y="-3106.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_11_stage_7&#45;&gt;ring_attn_3_12_stage_7 -->
<g id="edge3017" class="edge">
<title>ring_attn_3_11_stage_7&#45;&gt;ring_attn_3_12_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-3133C9140.02,-3133 9298.86,-3133 9298.86,-3133"/>
<polygon fill="red" stroke="red" points="9298.86,-3136.5 9308.86,-3133 9298.86,-3129.5 9298.86,-3136.5"/>
</g>
<!-- ring_attn_3_11_stage_8&#45;&gt;ring_attn_3_11_stage_9 -->
<g id="edge1151" class="edge">
<title>ring_attn_3_11_stage_8&#45;&gt;ring_attn_3_11_stage_9</title>
<path fill="none" stroke="black" d="M8931,-2811.87C8931,-2811.87 8931,-2705.25 8931,-2705.25"/>
<polygon fill="black" stroke="black" points="8934.5,-2705.25 8931,-2695.25 8927.5,-2705.25 8934.5,-2705.25"/>
</g>
<!-- ring_attn_3_12_stage_8 -->
<g id="node1260" class="node">
<title>ring_attn_3_12_stage_8</title>
<polygon fill="yellow" stroke="black" points="9518,-2948 9309,-2880 9518,-2812 9727,-2880 9518,-2948"/>
<text text-anchor="middle" x="9518" y="-2898.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-2883.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="9518" y="-2868.8" font-family="Times,serif" font-size="14.00">Q[12]×K[4]×V[4]</text>
<text text-anchor="middle" x="9518" y="-2853.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_11_stage_8&#45;&gt;ring_attn_3_12_stage_8 -->
<g id="edge3018" class="edge">
<title>ring_attn_3_11_stage_8&#45;&gt;ring_attn_3_12_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-2880C9140.02,-2880 9298.86,-2880 9298.86,-2880"/>
<polygon fill="red" stroke="red" points="9298.86,-2883.5 9308.86,-2880 9298.86,-2876.5 9298.86,-2883.5"/>
</g>
<!-- ring_attn_3_11_stage_9&#45;&gt;ring_attn_3_11_stage_10 -->
<g id="edge1152" class="edge">
<title>ring_attn_3_11_stage_9&#45;&gt;ring_attn_3_11_stage_10</title>
<path fill="none" stroke="black" d="M8931,-2558.87C8931,-2558.87 8931,-2452.25 8931,-2452.25"/>
<polygon fill="black" stroke="black" points="8934.5,-2452.25 8931,-2442.25 8927.5,-2452.25 8934.5,-2452.25"/>
</g>
<!-- ring_attn_3_12_stage_9 -->
<g id="node1261" class="node">
<title>ring_attn_3_12_stage_9</title>
<polygon fill="yellow" stroke="black" points="9518,-2695 9309,-2627 9518,-2559 9727,-2627 9518,-2695"/>
<text text-anchor="middle" x="9518" y="-2645.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-2630.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="9518" y="-2615.8" font-family="Times,serif" font-size="14.00">Q[12]×K[3]×V[3]</text>
<text text-anchor="middle" x="9518" y="-2600.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_11_stage_9&#45;&gt;ring_attn_3_12_stage_9 -->
<g id="edge3019" class="edge">
<title>ring_attn_3_11_stage_9&#45;&gt;ring_attn_3_12_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-2627C9140.02,-2627 9298.86,-2627 9298.86,-2627"/>
<polygon fill="red" stroke="red" points="9298.86,-2630.5 9308.86,-2627 9298.86,-2623.5 9298.86,-2630.5"/>
</g>
<!-- ring_attn_3_11_stage_10&#45;&gt;ring_attn_3_11_stage_11 -->
<g id="edge1153" class="edge">
<title>ring_attn_3_11_stage_10&#45;&gt;ring_attn_3_11_stage_11</title>
<path fill="none" stroke="black" d="M8931,-2305.87C8931,-2305.87 8931,-2199.25 8931,-2199.25"/>
<polygon fill="black" stroke="black" points="8934.5,-2199.25 8931,-2189.25 8927.5,-2199.25 8934.5,-2199.25"/>
</g>
<!-- ring_attn_3_12_stage_10 -->
<g id="node1262" class="node">
<title>ring_attn_3_12_stage_10</title>
<polygon fill="yellow" stroke="black" points="9518,-2442 9309,-2374 9518,-2306 9727,-2374 9518,-2442"/>
<text text-anchor="middle" x="9518" y="-2392.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-2377.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="9518" y="-2362.8" font-family="Times,serif" font-size="14.00">Q[12]×K[2]×V[2]</text>
<text text-anchor="middle" x="9518" y="-2347.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_11_stage_10&#45;&gt;ring_attn_3_12_stage_10 -->
<g id="edge3020" class="edge">
<title>ring_attn_3_11_stage_10&#45;&gt;ring_attn_3_12_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-2374C9140.02,-2374 9298.86,-2374 9298.86,-2374"/>
<polygon fill="red" stroke="red" points="9298.86,-2377.5 9308.86,-2374 9298.86,-2370.5 9298.86,-2377.5"/>
</g>
<!-- ring_attn_3_11_stage_11&#45;&gt;ring_attn_3_11_stage_12 -->
<g id="edge1154" class="edge">
<title>ring_attn_3_11_stage_11&#45;&gt;ring_attn_3_11_stage_12</title>
<path fill="none" stroke="black" d="M8931,-2052.87C8931,-2052.87 8931,-1946.25 8931,-1946.25"/>
<polygon fill="black" stroke="black" points="8934.5,-1946.25 8931,-1936.25 8927.5,-1946.25 8934.5,-1946.25"/>
</g>
<!-- ring_attn_3_12_stage_11 -->
<g id="node1263" class="node">
<title>ring_attn_3_12_stage_11</title>
<polygon fill="yellow" stroke="black" points="9518,-2189 9309,-2121 9518,-2053 9727,-2121 9518,-2189"/>
<text text-anchor="middle" x="9518" y="-2139.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-2124.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="9518" y="-2109.8" font-family="Times,serif" font-size="14.00">Q[12]×K[1]×V[1]</text>
<text text-anchor="middle" x="9518" y="-2094.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_11_stage_11&#45;&gt;ring_attn_3_12_stage_11 -->
<g id="edge3021" class="edge">
<title>ring_attn_3_11_stage_11&#45;&gt;ring_attn_3_12_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-2121C9140.02,-2121 9298.86,-2121 9298.86,-2121"/>
<polygon fill="red" stroke="red" points="9298.86,-2124.5 9308.86,-2121 9298.86,-2117.5 9298.86,-2124.5"/>
</g>
<!-- ring_attn_3_11_stage_12&#45;&gt;ring_attn_3_11_stage_13 -->
<g id="edge1155" class="edge">
<title>ring_attn_3_11_stage_12&#45;&gt;ring_attn_3_11_stage_13</title>
<path fill="none" stroke="black" d="M8931,-1799.87C8931,-1799.87 8931,-1693.25 8931,-1693.25"/>
<polygon fill="black" stroke="black" points="8934.5,-1693.25 8931,-1683.25 8927.5,-1693.25 8934.5,-1693.25"/>
</g>
<!-- ring_attn_3_12_stage_12 -->
<g id="node1264" class="node">
<title>ring_attn_3_12_stage_12</title>
<polygon fill="yellow" stroke="black" points="9518,-1936 9309,-1868 9518,-1800 9727,-1868 9518,-1936"/>
<text text-anchor="middle" x="9518" y="-1886.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-1871.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="9518" y="-1856.8" font-family="Times,serif" font-size="14.00">Q[12]×K[0]×V[0]</text>
<text text-anchor="middle" x="9518" y="-1841.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_11_stage_12&#45;&gt;ring_attn_3_12_stage_12 -->
<g id="edge3022" class="edge">
<title>ring_attn_3_11_stage_12&#45;&gt;ring_attn_3_12_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-1868C9140.02,-1868 9298.86,-1868 9298.86,-1868"/>
<polygon fill="red" stroke="red" points="9298.86,-1871.5 9308.86,-1868 9298.86,-1864.5 9298.86,-1871.5"/>
</g>
<!-- ring_attn_3_11_stage_13&#45;&gt;ring_attn_3_11_stage_14 -->
<g id="edge1156" class="edge">
<title>ring_attn_3_11_stage_13&#45;&gt;ring_attn_3_11_stage_14</title>
<path fill="none" stroke="black" d="M8931,-1546.87C8931,-1546.87 8931,-1440.25 8931,-1440.25"/>
<polygon fill="black" stroke="black" points="8934.5,-1440.25 8931,-1430.25 8927.5,-1440.25 8934.5,-1440.25"/>
</g>
<!-- ring_attn_3_12_stage_13 -->
<g id="node1265" class="node">
<title>ring_attn_3_12_stage_13</title>
<polygon fill="yellow" stroke="black" points="9518,-1683 9309,-1615 9518,-1547 9727,-1615 9518,-1683"/>
<text text-anchor="middle" x="9518" y="-1633.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-1618.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="9518" y="-1603.8" font-family="Times,serif" font-size="14.00">Q[12]×K[15]×V[15]</text>
<text text-anchor="middle" x="9518" y="-1588.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_11_stage_13&#45;&gt;ring_attn_3_12_stage_13 -->
<g id="edge3023" class="edge">
<title>ring_attn_3_11_stage_13&#45;&gt;ring_attn_3_12_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-1615C9140.02,-1615 9298.86,-1615 9298.86,-1615"/>
<polygon fill="red" stroke="red" points="9298.86,-1618.5 9308.86,-1615 9298.86,-1611.5 9298.86,-1618.5"/>
</g>
<!-- ring_attn_3_11_stage_14&#45;&gt;ring_attn_3_11_stage_15 -->
<g id="edge1157" class="edge">
<title>ring_attn_3_11_stage_14&#45;&gt;ring_attn_3_11_stage_15</title>
<path fill="none" stroke="black" d="M8931,-1293.87C8931,-1293.87 8931,-1187.25 8931,-1187.25"/>
<polygon fill="black" stroke="black" points="8934.5,-1187.25 8931,-1177.25 8927.5,-1187.25 8934.5,-1187.25"/>
</g>
<!-- ring_attn_3_12_stage_14 -->
<g id="node1266" class="node">
<title>ring_attn_3_12_stage_14</title>
<polygon fill="yellow" stroke="black" points="9518,-1430 9309,-1362 9518,-1294 9727,-1362 9518,-1430"/>
<text text-anchor="middle" x="9518" y="-1380.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-1365.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="9518" y="-1350.8" font-family="Times,serif" font-size="14.00">Q[12]×K[14]×V[14]</text>
<text text-anchor="middle" x="9518" y="-1335.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_11_stage_14&#45;&gt;ring_attn_3_12_stage_14 -->
<g id="edge3024" class="edge">
<title>ring_attn_3_11_stage_14&#45;&gt;ring_attn_3_12_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-1362C9140.02,-1362 9298.86,-1362 9298.86,-1362"/>
<polygon fill="red" stroke="red" points="9298.86,-1365.5 9308.86,-1362 9298.86,-1358.5 9298.86,-1365.5"/>
</g>
<!-- attn_out_3_11 -->
<g id="node1170" class="node">
<title>attn_out_3_11</title>
<polygon fill="none" stroke="black" points="9000.5,-968 8861.5,-968 8861.5,-915 9000.5,-915 9000.5,-968"/>
<text text-anchor="middle" x="8931" y="-952.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="8931" y="-937.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="8931" y="-922.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_3_11_stage_15&#45;&gt;attn_out_3_11 -->
<g id="edge1158" class="edge">
<title>ring_attn_3_11_stage_15&#45;&gt;attn_out_3_11</title>
<path fill="none" stroke="black" d="M8931,-1040.87C8931,-1040.87 8931,-978.18 8931,-978.18"/>
<polygon fill="black" stroke="black" points="8934.5,-978.18 8931,-968.18 8927.5,-978.18 8934.5,-978.18"/>
</g>
<!-- ring_attn_3_12_stage_15 -->
<g id="node1267" class="node">
<title>ring_attn_3_12_stage_15</title>
<polygon fill="yellow" stroke="black" points="9518,-1177 9309,-1109 9518,-1041 9727,-1109 9518,-1177"/>
<text text-anchor="middle" x="9518" y="-1127.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="9518" y="-1112.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="9518" y="-1097.8" font-family="Times,serif" font-size="14.00">Q[12]×K[13]×V[13]</text>
<text text-anchor="middle" x="9518" y="-1082.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_11_stage_15&#45;&gt;ring_attn_3_12_stage_15 -->
<g id="edge3025" class="edge">
<title>ring_attn_3_11_stage_15&#45;&gt;ring_attn_3_12_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9140.02,-1109C9140.02,-1109 9298.86,-1109 9298.86,-1109"/>
<polygon fill="red" stroke="red" points="9298.86,-1112.5 9308.86,-1109 9298.86,-1105.5 9298.86,-1112.5"/>
</g>
<!-- attn_residual_3_11 -->
<g id="node1171" class="node">
<title>attn_residual_3_11</title>
<ellipse fill="none" stroke="black" cx="8931" cy="-815" rx="105.5" ry="27"/>
<text text-anchor="middle" x="8931" y="-818.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="8931" y="-803.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_3_11&#45;&gt;attn_residual_3_11 -->
<g id="edge1159" class="edge">
<title>attn_out_3_11&#45;&gt;attn_residual_3_11</title>
<path fill="none" stroke="black" d="M8931,-914.98C8931,-914.98 8931,-852.36 8931,-852.36"/>
<polygon fill="black" stroke="black" points="8934.5,-852.36 8931,-842.36 8927.5,-852.36 8934.5,-852.36"/>
</g>
<!-- gate_3_11 -->
<g id="node1172" class="node">
<title>gate_3_11</title>
<ellipse fill="orange" stroke="black" cx="8931" cy="-677.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="8931" y="-688.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="8931" y="-673.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="8931" y="-658.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_3_11&#45;&gt;gate_3_11 -->
<g id="edge1160" class="edge">
<title>attn_residual_3_11&#45;&gt;gate_3_11</title>
<path fill="none" stroke="black" d="M8983.75,-791.36C8983.75,-791.36 8983.75,-720.08 8983.75,-720.08"/>
<polygon fill="black" stroke="black" points="8987.25,-720.08 8983.75,-710.08 8980.25,-720.08 8987.25,-720.08"/>
</g>
<!-- gate_3_11&#45;&gt;expert_3_0_0 -->
<g id="edge3026" class="edge">
<title>gate_3_11&#45;&gt;expert_3_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8931,-715.09C8931,-744.34 8931,-780 8931,-780 8931,-780 111.4,-780 111.4,-780 111.4,-780 111.4,-518.25 111.4,-518.25"/>
<polygon fill="blue" stroke="blue" points="114.9,-518.25 111.4,-508.25 107.9,-518.25 114.9,-518.25"/>
<text text-anchor="middle" x="37706.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37706.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU11→GPU0</text>
<text text-anchor="middle" x="37706.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37706.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_11&#45;&gt;expert_3_1_0 -->
<g id="edge3027" class="edge">
<title>gate_3_11&#45;&gt;expert_3_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8878.25,-710.21C8878.25,-728.24 8878.25,-747 8878.25,-747 8878.25,-747 3168.43,-747 3168.43,-747 3168.43,-747 3168.43,-518.42 3168.43,-518.42"/>
<polygon fill="blue" stroke="blue" points="3171.93,-518.42 3168.43,-508.42 3164.93,-518.42 3171.93,-518.42"/>
<text text-anchor="middle" x="37880.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="37880.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU11→GPU1</text>
<text text-anchor="middle" x="37880.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="37880.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_11&#45;&gt;expert_3_2_0 -->
<g id="edge3028" class="edge">
<title>gate_3_11&#45;&gt;expert_3_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8835.55,-661.36C8835.55,-626.65 8835.55,-548 8835.55,-548 8835.55,-548 3620.65,-548 3620.65,-548 3620.65,-548 3620.65,-518.16 3620.65,-518.16"/>
<polygon fill="blue" stroke="blue" points="3624.15,-518.16 3620.65,-508.16 3617.15,-518.16 3624.15,-518.16"/>
<text text-anchor="middle" x="38054.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38054.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU11→GPU2</text>
<text text-anchor="middle" x="38054.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38054.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_11&#45;&gt;expert_3_3_0 -->
<g id="edge3029" class="edge">
<title>gate_3_11&#45;&gt;expert_3_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8855.64,-651.09C8855.64,-612.96 8855.64,-547 8855.64,-547 8855.64,-547 4213.9,-547 4213.9,-547 4213.9,-547 4213.9,-518.14 4213.9,-518.14"/>
<polygon fill="blue" stroke="blue" points="4217.4,-518.14 4213.9,-508.14 4210.4,-518.14 4217.4,-518.14"/>
<text text-anchor="middle" x="38228.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38228.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU11→GPU3</text>
<text text-anchor="middle" x="38228.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38228.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_11&#45;&gt;expert_3_4_0 -->
<g id="edge3030" class="edge">
<title>gate_3_11&#45;&gt;expert_3_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8875.74,-645.31C8875.74,-609.02 8875.74,-555 8875.74,-555 8875.74,-555 4816.98,-555 4816.98,-555 4816.98,-555 4816.98,-518.04 4816.98,-518.04"/>
<polygon fill="blue" stroke="blue" points="4820.48,-518.04 4816.98,-508.04 4813.48,-518.04 4820.48,-518.04"/>
<text text-anchor="middle" x="38402.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38402.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU11→GPU4</text>
<text text-anchor="middle" x="38402.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38402.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_11&#45;&gt;expert_3_5_0 -->
<g id="edge3031" class="edge">
<title>gate_3_11&#45;&gt;expert_3_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8895.83,-641.9C8895.83,-608.61 8895.83,-564 8895.83,-564 8895.83,-564 5414.02,-564 5414.02,-564 5414.02,-564 5414.02,-518.06 5414.02,-518.06"/>
<polygon fill="blue" stroke="blue" points="5417.52,-518.06 5414.02,-508.06 5410.52,-518.06 5417.52,-518.06"/>
<text text-anchor="middle" x="38576.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38576.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU11→GPU5</text>
<text text-anchor="middle" x="38576.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38576.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_11&#45;&gt;expert_3_6_0 -->
<g id="edge3032" class="edge">
<title>gate_3_11&#45;&gt;expert_3_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8915.93,-640.3C8915.93,-609.93 8915.93,-572 8915.93,-572 8915.93,-572 5996,-572 5996,-572 5996,-572 5996,-518.16 5996,-518.16"/>
<polygon fill="blue" stroke="blue" points="5999.5,-518.16 5996,-508.16 5992.5,-518.16 5999.5,-518.16"/>
<text text-anchor="middle" x="38750.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38750.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU11→GPU6</text>
<text text-anchor="middle" x="38750.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38750.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_11&#45;&gt;expert_3_7_0 -->
<g id="edge3033" class="edge">
<title>gate_3_11&#45;&gt;expert_3_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8936.02,-639.91C8936.02,-615.04 8936.02,-587 8936.02,-587 8936.02,-587 6588.02,-587 6588.02,-587 6588.02,-587 6588.02,-518.12 6588.02,-518.12"/>
<polygon fill="blue" stroke="blue" points="6591.52,-518.12 6588.02,-508.12 6584.52,-518.12 6591.52,-518.12"/>
<text text-anchor="middle" x="38924.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="38924.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU11→GPU7</text>
<text text-anchor="middle" x="38924.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="38924.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_11&#45;&gt;expert_3_8_0 -->
<g id="edge3034" class="edge">
<title>gate_3_11&#45;&gt;expert_3_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8956.12,-640.63C8956.12,-618.26 8956.12,-594 8956.12,-594 8956.12,-594 7174.59,-594 7174.59,-594 7174.59,-594 7174.59,-518.16 7174.59,-518.16"/>
<polygon fill="blue" stroke="blue" points="7178.09,-518.16 7174.59,-508.16 7171.09,-518.16 7178.09,-518.16"/>
<text text-anchor="middle" x="39098.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39098.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU11→GPU8</text>
<text text-anchor="middle" x="39098.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39098.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_11&#45;&gt;expert_3_9_0 -->
<g id="edge3035" class="edge">
<title>gate_3_11&#45;&gt;expert_3_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8966.17,-642C8966.17,-634.6 8966.17,-629 8966.17,-629 8966.17,-629 7871.5,-629 7871.5,-629 7871.5,-629 7871.5,-518.21 7871.5,-518.21"/>
<polygon fill="blue" stroke="blue" points="7875,-518.21 7871.5,-508.21 7868,-518.21 7875,-518.21"/>
<text text-anchor="middle" x="39272.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39272.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU11→GPU9</text>
<text text-anchor="middle" x="39272.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39272.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_11&#45;&gt;expert_3_10_0 -->
<g id="edge3036" class="edge">
<title>gate_3_11&#45;&gt;expert_3_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8831.3,-690C8691.46,-690 8454,-690 8454,-690 8454,-690 8454,-518.33 8454,-518.33"/>
<polygon fill="blue" stroke="blue" points="8457.5,-518.33 8454,-508.33 8450.5,-518.33 8457.5,-518.33"/>
<text text-anchor="middle" x="39446.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39446.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU11→GPU10</text>
<text text-anchor="middle" x="39446.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39446.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_11&#45;&gt;expert_3_11_0 -->
<g id="edge1161" class="edge">
<title>gate_3_11&#45;&gt;expert_3_11_0</title>
<path fill="none" stroke="black" d="M8976.21,-643.36C8976.21,-643.36 8976.21,-518.03 8976.21,-518.03"/>
<polygon fill="black" stroke="black" points="8979.71,-518.03 8976.21,-508.03 8972.71,-518.03 8979.71,-518.03"/>
</g>
<!-- gate_3_11&#45;&gt;expert_3_12_0 -->
<g id="edge3037" class="edge">
<title>gate_3_11&#45;&gt;expert_3_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9030.65,-665C9170.77,-665 9409.12,-665 9409.12,-665 9409.12,-665 9409.12,-518.18 9409.12,-518.18"/>
<polygon fill="blue" stroke="blue" points="9412.63,-518.18 9409.12,-508.18 9405.63,-518.18 9412.63,-518.18"/>
<text text-anchor="middle" x="39620.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39620.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU11→GPU12</text>
<text text-anchor="middle" x="39620.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39620.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_11&#45;&gt;expert_3_13_0 -->
<g id="edge3038" class="edge">
<title>gate_3_11&#45;&gt;expert_3_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9006.36,-651.25C9006.36,-638.12 9006.36,-625 9006.36,-625 9006.36,-625 9992.75,-625 9992.75,-625 9992.75,-625 9992.75,-518.15 9992.75,-518.15"/>
<polygon fill="blue" stroke="blue" points="9996.25,-518.15 9992.75,-508.15 9989.25,-518.15 9996.25,-518.15"/>
<text text-anchor="middle" x="39794.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39794.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU11→GPU13</text>
<text text-anchor="middle" x="39794.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39794.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_11&#45;&gt;expert_3_14_0 -->
<g id="edge3039" class="edge">
<title>gate_3_11&#45;&gt;expert_3_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9016.4,-655.35C9016.4,-627.14 9016.4,-582 9016.4,-582 9016.4,-582 10575.7,-582 10575.7,-582 10575.7,-582 10575.7,-518.17 10575.7,-518.17"/>
<polygon fill="blue" stroke="blue" points="10579.2,-518.17 10575.7,-508.17 10572.2,-518.17 10579.2,-518.17"/>
<text text-anchor="middle" x="39968.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="39968.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU11→GPU14</text>
<text text-anchor="middle" x="39968.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="39968.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_11&#45;&gt;expert_3_15_0 -->
<g id="edge3040" class="edge">
<title>gate_3_11&#45;&gt;expert_3_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9026.45,-661.35C9026.45,-632.94 9026.45,-577 9026.45,-577 9026.45,-577 11161.69,-577 11161.69,-577 11161.69,-577 11161.69,-518.1 11161.69,-518.1"/>
<polygon fill="blue" stroke="blue" points="11165.19,-518.1 11161.69,-508.1 11158.19,-518.1 11165.19,-518.1"/>
<text text-anchor="middle" x="40142.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="40142.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU11→GPU15</text>
<text text-anchor="middle" x="40142.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="40142.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_11 -->
<g id="node1174" class="node">
<title>expert_reduce_3_11</title>
<ellipse fill="none" stroke="black" cx="8931" cy="-344.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="8931" y="-355.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="8931" y="-340.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="8931" y="-325.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_11_0&#45;&gt;expert_reduce_3_11 -->
<g id="edge1162" class="edge">
<title>expert_3_11_0&#45;&gt;expert_reduce_3_11</title>
<path fill="none" stroke="black" d="M8931,-454.76C8931,-454.76 8931,-392.06 8931,-392.06"/>
<polygon fill="black" stroke="black" points="8934.5,-392.06 8931,-382.06 8927.5,-392.06 8934.5,-392.06"/>
</g>
<!-- moe_residual_3_11 -->
<g id="node1175" class="node">
<title>moe_residual_3_11</title>
<ellipse fill="none" stroke="black" cx="8931" cy="-207" rx="105.5" ry="27"/>
<text text-anchor="middle" x="8931" y="-210.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="8931" y="-195.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_11&#45;&gt;moe_residual_3_11 -->
<g id="edge1163" class="edge">
<title>expert_reduce_3_11&#45;&gt;moe_residual_3_11</title>
<path fill="none" stroke="black" d="M8931,-306.93C8931,-306.93 8931,-244.06 8931,-244.06"/>
<polygon fill="black" stroke="black" points="8934.5,-244.06 8931,-234.06 8927.5,-244.06 8934.5,-244.06"/>
</g>
<!-- output_11 -->
<g id="node1176" class="node">
<title>output_11</title>
<polygon fill="lightcoral" stroke="black" points="9028.5,-107 8833.5,-107 8833.5,-69 9028.5,-69 9028.5,-107"/>
<text text-anchor="middle" x="8931" y="-91.8" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="8931" y="-76.8" font-family="Times,serif" font-size="14.00">Y[11]: 1024×1024×4096</text>
</g>
<!-- moe_residual_3_11&#45;&gt;output_11 -->
<g id="edge1164" class="edge">
<title>moe_residual_3_11&#45;&gt;output_11</title>
<path fill="none" stroke="black" d="M8931,-180C8931,-180 8931,-117.12 8931,-117.12"/>
<polygon fill="black" stroke="black" points="8934.5,-117.12 8931,-107.12 8927.5,-117.12 8934.5,-117.12"/>
</g>
<!-- input_12 -->
<g id="node1177" class="node">
<title>input_12</title>
<polygon fill="lightgreen" stroke="black" points="9616,-20866 9420,-20866 9420,-20828 9616,-20828 9616,-20866"/>
<text text-anchor="middle" x="9518" y="-20850.8" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="9518" y="-20835.8" font-family="Times,serif" font-size="14.00">X[12]: 1024×1024×4096</text>
</g>
<!-- qkv_proj_0_12 -->
<g id="node1178" class="node">
<title>qkv_proj_0_12</title>
<polygon fill="none" stroke="black" points="9600.5,-20755 9435.5,-20755 9435.5,-20702 9600.5,-20702 9600.5,-20755"/>
<text text-anchor="middle" x="9518" y="-20739.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="9518" y="-20724.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="9518" y="-20709.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- input_12&#45;&gt;qkv_proj_0_12 -->
<g id="edge1165" class="edge">
<title>input_12&#45;&gt;qkv_proj_0_12</title>
<path fill="none" stroke="black" d="M9518,-20827.96C9518,-20827.96 9518,-20765.44 9518,-20765.44"/>
<polygon fill="black" stroke="black" points="9521.5,-20765.44 9518,-20755.44 9514.5,-20765.44 9521.5,-20765.44"/>
</g>
<!-- qkv_reshape_0_12 -->
<g id="node1179" class="node">
<title>qkv_reshape_0_12</title>
<ellipse fill="none" stroke="black" cx="9518" cy="-20602" rx="148" ry="27"/>
<text text-anchor="middle" x="9518" y="-20605.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="9518" y="-20590.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_0_12&#45;&gt;qkv_reshape_0_12 -->
<g id="edge1166" class="edge">
<title>qkv_proj_0_12&#45;&gt;qkv_reshape_0_12</title>
<path fill="none" stroke="black" d="M9518,-20701.98C9518,-20701.98 9518,-20639.36 9518,-20639.36"/>
<polygon fill="black" stroke="black" points="9521.5,-20639.36 9518,-20629.36 9514.5,-20639.36 9521.5,-20639.36"/>
</g>
<!-- qkv_reshape_0_12&#45;&gt;ring_attn_0_12_stage_0 -->
<g id="edge1167" class="edge">
<title>qkv_reshape_0_12&#45;&gt;ring_attn_0_12_stage_0</title>
<path fill="none" stroke="black" d="M9518,-20574.72C9518,-20574.72 9518,-20468.16 9518,-20468.16"/>
<polygon fill="black" stroke="black" points="9521.5,-20468.16 9518,-20458.16 9514.5,-20468.16 9521.5,-20468.16"/>
</g>
<!-- ring_attn_0_12_stage_0&#45;&gt;ring_attn_0_12_stage_1 -->
<g id="edge1168" class="edge">
<title>ring_attn_0_12_stage_0&#45;&gt;ring_attn_0_12_stage_1</title>
<path fill="none" stroke="black" d="M9518,-20321.87C9518,-20321.87 9518,-20215.25 9518,-20215.25"/>
<polygon fill="black" stroke="black" points="9521.5,-20215.25 9518,-20205.25 9514.5,-20215.25 9521.5,-20215.25"/>
</g>
<!-- ring_attn_0_13_stage_0 -->
<g id="node1278" class="node">
<title>ring_attn_0_13_stage_0</title>
<polygon fill="yellow" stroke="black" points="10105,-20458 9896,-20390 10105,-20322 10314,-20390 10105,-20458"/>
<text text-anchor="middle" x="10105" y="-20408.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-20393.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="10105" y="-20378.8" font-family="Times,serif" font-size="14.00">Q[13]×K[13]×V[13]</text>
<text text-anchor="middle" x="10105" y="-20363.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_12_stage_0&#45;&gt;ring_attn_0_13_stage_0 -->
<g id="edge3041" class="edge">
<title>ring_attn_0_12_stage_0&#45;&gt;ring_attn_0_13_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-20390C9727.02,-20390 9885.86,-20390 9885.86,-20390"/>
<polygon fill="red" stroke="red" points="9885.86,-20393.5 9895.86,-20390 9885.86,-20386.5 9885.86,-20393.5"/>
</g>
<!-- ring_attn_0_12_stage_1&#45;&gt;ring_attn_0_12_stage_2 -->
<g id="edge1169" class="edge">
<title>ring_attn_0_12_stage_1&#45;&gt;ring_attn_0_12_stage_2</title>
<path fill="none" stroke="black" d="M9518,-20068.87C9518,-20068.87 9518,-19962.25 9518,-19962.25"/>
<polygon fill="black" stroke="black" points="9521.5,-19962.25 9518,-19952.25 9514.5,-19962.25 9521.5,-19962.25"/>
</g>
<!-- ring_attn_0_13_stage_1 -->
<g id="node1279" class="node">
<title>ring_attn_0_13_stage_1</title>
<polygon fill="yellow" stroke="black" points="10105,-20205 9896,-20137 10105,-20069 10314,-20137 10105,-20205"/>
<text text-anchor="middle" x="10105" y="-20155.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-20140.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="10105" y="-20125.8" font-family="Times,serif" font-size="14.00">Q[13]×K[12]×V[12]</text>
<text text-anchor="middle" x="10105" y="-20110.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_12_stage_1&#45;&gt;ring_attn_0_13_stage_1 -->
<g id="edge3042" class="edge">
<title>ring_attn_0_12_stage_1&#45;&gt;ring_attn_0_13_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-20137C9727.02,-20137 9885.86,-20137 9885.86,-20137"/>
<polygon fill="red" stroke="red" points="9885.86,-20140.5 9895.86,-20137 9885.86,-20133.5 9885.86,-20140.5"/>
</g>
<!-- ring_attn_0_12_stage_2&#45;&gt;ring_attn_0_12_stage_3 -->
<g id="edge1170" class="edge">
<title>ring_attn_0_12_stage_2&#45;&gt;ring_attn_0_12_stage_3</title>
<path fill="none" stroke="black" d="M9518,-19815.87C9518,-19815.87 9518,-19709.25 9518,-19709.25"/>
<polygon fill="black" stroke="black" points="9521.5,-19709.25 9518,-19699.25 9514.5,-19709.25 9521.5,-19709.25"/>
</g>
<!-- ring_attn_0_13_stage_2 -->
<g id="node1280" class="node">
<title>ring_attn_0_13_stage_2</title>
<polygon fill="yellow" stroke="black" points="10105,-19952 9896,-19884 10105,-19816 10314,-19884 10105,-19952"/>
<text text-anchor="middle" x="10105" y="-19902.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-19887.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="10105" y="-19872.8" font-family="Times,serif" font-size="14.00">Q[13]×K[11]×V[11]</text>
<text text-anchor="middle" x="10105" y="-19857.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_12_stage_2&#45;&gt;ring_attn_0_13_stage_2 -->
<g id="edge3043" class="edge">
<title>ring_attn_0_12_stage_2&#45;&gt;ring_attn_0_13_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-19884C9727.02,-19884 9885.86,-19884 9885.86,-19884"/>
<polygon fill="red" stroke="red" points="9885.86,-19887.5 9895.86,-19884 9885.86,-19880.5 9885.86,-19887.5"/>
</g>
<!-- ring_attn_0_12_stage_3&#45;&gt;ring_attn_0_12_stage_4 -->
<g id="edge1171" class="edge">
<title>ring_attn_0_12_stage_3&#45;&gt;ring_attn_0_12_stage_4</title>
<path fill="none" stroke="black" d="M9518,-19562.87C9518,-19562.87 9518,-19456.25 9518,-19456.25"/>
<polygon fill="black" stroke="black" points="9521.5,-19456.25 9518,-19446.25 9514.5,-19456.25 9521.5,-19456.25"/>
</g>
<!-- ring_attn_0_13_stage_3 -->
<g id="node1281" class="node">
<title>ring_attn_0_13_stage_3</title>
<polygon fill="yellow" stroke="black" points="10105,-19699 9896,-19631 10105,-19563 10314,-19631 10105,-19699"/>
<text text-anchor="middle" x="10105" y="-19649.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-19634.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="10105" y="-19619.8" font-family="Times,serif" font-size="14.00">Q[13]×K[10]×V[10]</text>
<text text-anchor="middle" x="10105" y="-19604.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_12_stage_3&#45;&gt;ring_attn_0_13_stage_3 -->
<g id="edge3044" class="edge">
<title>ring_attn_0_12_stage_3&#45;&gt;ring_attn_0_13_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-19631C9727.02,-19631 9885.86,-19631 9885.86,-19631"/>
<polygon fill="red" stroke="red" points="9885.86,-19634.5 9895.86,-19631 9885.86,-19627.5 9885.86,-19634.5"/>
</g>
<!-- ring_attn_0_12_stage_4&#45;&gt;ring_attn_0_12_stage_5 -->
<g id="edge1172" class="edge">
<title>ring_attn_0_12_stage_4&#45;&gt;ring_attn_0_12_stage_5</title>
<path fill="none" stroke="black" d="M9518,-19309.87C9518,-19309.87 9518,-19203.25 9518,-19203.25"/>
<polygon fill="black" stroke="black" points="9521.5,-19203.25 9518,-19193.25 9514.5,-19203.25 9521.5,-19203.25"/>
</g>
<!-- ring_attn_0_13_stage_4 -->
<g id="node1282" class="node">
<title>ring_attn_0_13_stage_4</title>
<polygon fill="yellow" stroke="black" points="10105,-19446 9896,-19378 10105,-19310 10314,-19378 10105,-19446"/>
<text text-anchor="middle" x="10105" y="-19396.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-19381.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="10105" y="-19366.8" font-family="Times,serif" font-size="14.00">Q[13]×K[9]×V[9]</text>
<text text-anchor="middle" x="10105" y="-19351.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_12_stage_4&#45;&gt;ring_attn_0_13_stage_4 -->
<g id="edge3045" class="edge">
<title>ring_attn_0_12_stage_4&#45;&gt;ring_attn_0_13_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-19378C9727.02,-19378 9885.86,-19378 9885.86,-19378"/>
<polygon fill="red" stroke="red" points="9885.86,-19381.5 9895.86,-19378 9885.86,-19374.5 9885.86,-19381.5"/>
</g>
<!-- ring_attn_0_12_stage_5&#45;&gt;ring_attn_0_12_stage_6 -->
<g id="edge1173" class="edge">
<title>ring_attn_0_12_stage_5&#45;&gt;ring_attn_0_12_stage_6</title>
<path fill="none" stroke="black" d="M9518,-19056.87C9518,-19056.87 9518,-18950.25 9518,-18950.25"/>
<polygon fill="black" stroke="black" points="9521.5,-18950.25 9518,-18940.25 9514.5,-18950.25 9521.5,-18950.25"/>
</g>
<!-- ring_attn_0_13_stage_5 -->
<g id="node1283" class="node">
<title>ring_attn_0_13_stage_5</title>
<polygon fill="yellow" stroke="black" points="10105,-19193 9896,-19125 10105,-19057 10314,-19125 10105,-19193"/>
<text text-anchor="middle" x="10105" y="-19143.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-19128.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="10105" y="-19113.8" font-family="Times,serif" font-size="14.00">Q[13]×K[8]×V[8]</text>
<text text-anchor="middle" x="10105" y="-19098.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_12_stage_5&#45;&gt;ring_attn_0_13_stage_5 -->
<g id="edge3046" class="edge">
<title>ring_attn_0_12_stage_5&#45;&gt;ring_attn_0_13_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-19125C9727.02,-19125 9885.86,-19125 9885.86,-19125"/>
<polygon fill="red" stroke="red" points="9885.86,-19128.5 9895.86,-19125 9885.86,-19121.5 9885.86,-19128.5"/>
</g>
<!-- ring_attn_0_12_stage_6&#45;&gt;ring_attn_0_12_stage_7 -->
<g id="edge1174" class="edge">
<title>ring_attn_0_12_stage_6&#45;&gt;ring_attn_0_12_stage_7</title>
<path fill="none" stroke="black" d="M9518,-18803.87C9518,-18803.87 9518,-18697.25 9518,-18697.25"/>
<polygon fill="black" stroke="black" points="9521.5,-18697.25 9518,-18687.25 9514.5,-18697.25 9521.5,-18697.25"/>
</g>
<!-- ring_attn_0_13_stage_6 -->
<g id="node1284" class="node">
<title>ring_attn_0_13_stage_6</title>
<polygon fill="yellow" stroke="black" points="10105,-18940 9896,-18872 10105,-18804 10314,-18872 10105,-18940"/>
<text text-anchor="middle" x="10105" y="-18890.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-18875.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="10105" y="-18860.8" font-family="Times,serif" font-size="14.00">Q[13]×K[7]×V[7]</text>
<text text-anchor="middle" x="10105" y="-18845.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_12_stage_6&#45;&gt;ring_attn_0_13_stage_6 -->
<g id="edge3047" class="edge">
<title>ring_attn_0_12_stage_6&#45;&gt;ring_attn_0_13_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-18872C9727.02,-18872 9885.86,-18872 9885.86,-18872"/>
<polygon fill="red" stroke="red" points="9885.86,-18875.5 9895.86,-18872 9885.86,-18868.5 9885.86,-18875.5"/>
</g>
<!-- ring_attn_0_12_stage_7&#45;&gt;ring_attn_0_12_stage_8 -->
<g id="edge1175" class="edge">
<title>ring_attn_0_12_stage_7&#45;&gt;ring_attn_0_12_stage_8</title>
<path fill="none" stroke="black" d="M9518,-18550.87C9518,-18550.87 9518,-18444.25 9518,-18444.25"/>
<polygon fill="black" stroke="black" points="9521.5,-18444.25 9518,-18434.25 9514.5,-18444.25 9521.5,-18444.25"/>
</g>
<!-- ring_attn_0_13_stage_7 -->
<g id="node1285" class="node">
<title>ring_attn_0_13_stage_7</title>
<polygon fill="yellow" stroke="black" points="10105,-18687 9896,-18619 10105,-18551 10314,-18619 10105,-18687"/>
<text text-anchor="middle" x="10105" y="-18637.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-18622.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="10105" y="-18607.8" font-family="Times,serif" font-size="14.00">Q[13]×K[6]×V[6]</text>
<text text-anchor="middle" x="10105" y="-18592.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_12_stage_7&#45;&gt;ring_attn_0_13_stage_7 -->
<g id="edge3048" class="edge">
<title>ring_attn_0_12_stage_7&#45;&gt;ring_attn_0_13_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-18619C9727.02,-18619 9885.86,-18619 9885.86,-18619"/>
<polygon fill="red" stroke="red" points="9885.86,-18622.5 9895.86,-18619 9885.86,-18615.5 9885.86,-18622.5"/>
</g>
<!-- ring_attn_0_12_stage_8&#45;&gt;ring_attn_0_12_stage_9 -->
<g id="edge1176" class="edge">
<title>ring_attn_0_12_stage_8&#45;&gt;ring_attn_0_12_stage_9</title>
<path fill="none" stroke="black" d="M9518,-18297.87C9518,-18297.87 9518,-18191.25 9518,-18191.25"/>
<polygon fill="black" stroke="black" points="9521.5,-18191.25 9518,-18181.25 9514.5,-18191.25 9521.5,-18191.25"/>
</g>
<!-- ring_attn_0_13_stage_8 -->
<g id="node1286" class="node">
<title>ring_attn_0_13_stage_8</title>
<polygon fill="yellow" stroke="black" points="10105,-18434 9896,-18366 10105,-18298 10314,-18366 10105,-18434"/>
<text text-anchor="middle" x="10105" y="-18384.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-18369.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="10105" y="-18354.8" font-family="Times,serif" font-size="14.00">Q[13]×K[5]×V[5]</text>
<text text-anchor="middle" x="10105" y="-18339.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_12_stage_8&#45;&gt;ring_attn_0_13_stage_8 -->
<g id="edge3049" class="edge">
<title>ring_attn_0_12_stage_8&#45;&gt;ring_attn_0_13_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-18366C9727.02,-18366 9885.86,-18366 9885.86,-18366"/>
<polygon fill="red" stroke="red" points="9885.86,-18369.5 9895.86,-18366 9885.86,-18362.5 9885.86,-18369.5"/>
</g>
<!-- ring_attn_0_12_stage_9&#45;&gt;ring_attn_0_12_stage_10 -->
<g id="edge1177" class="edge">
<title>ring_attn_0_12_stage_9&#45;&gt;ring_attn_0_12_stage_10</title>
<path fill="none" stroke="black" d="M9518,-18044.87C9518,-18044.87 9518,-17938.25 9518,-17938.25"/>
<polygon fill="black" stroke="black" points="9521.5,-17938.25 9518,-17928.25 9514.5,-17938.25 9521.5,-17938.25"/>
</g>
<!-- ring_attn_0_13_stage_9 -->
<g id="node1287" class="node">
<title>ring_attn_0_13_stage_9</title>
<polygon fill="yellow" stroke="black" points="10105,-18181 9896,-18113 10105,-18045 10314,-18113 10105,-18181"/>
<text text-anchor="middle" x="10105" y="-18131.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-18116.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="10105" y="-18101.8" font-family="Times,serif" font-size="14.00">Q[13]×K[4]×V[4]</text>
<text text-anchor="middle" x="10105" y="-18086.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_12_stage_9&#45;&gt;ring_attn_0_13_stage_9 -->
<g id="edge3050" class="edge">
<title>ring_attn_0_12_stage_9&#45;&gt;ring_attn_0_13_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-18113C9727.02,-18113 9885.86,-18113 9885.86,-18113"/>
<polygon fill="red" stroke="red" points="9885.86,-18116.5 9895.86,-18113 9885.86,-18109.5 9885.86,-18116.5"/>
</g>
<!-- ring_attn_0_12_stage_10&#45;&gt;ring_attn_0_12_stage_11 -->
<g id="edge1178" class="edge">
<title>ring_attn_0_12_stage_10&#45;&gt;ring_attn_0_12_stage_11</title>
<path fill="none" stroke="black" d="M9518,-17791.87C9518,-17791.87 9518,-17685.25 9518,-17685.25"/>
<polygon fill="black" stroke="black" points="9521.5,-17685.25 9518,-17675.25 9514.5,-17685.25 9521.5,-17685.25"/>
</g>
<!-- ring_attn_0_13_stage_10 -->
<g id="node1288" class="node">
<title>ring_attn_0_13_stage_10</title>
<polygon fill="yellow" stroke="black" points="10105,-17928 9896,-17860 10105,-17792 10314,-17860 10105,-17928"/>
<text text-anchor="middle" x="10105" y="-17878.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-17863.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="10105" y="-17848.8" font-family="Times,serif" font-size="14.00">Q[13]×K[3]×V[3]</text>
<text text-anchor="middle" x="10105" y="-17833.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_12_stage_10&#45;&gt;ring_attn_0_13_stage_10 -->
<g id="edge3051" class="edge">
<title>ring_attn_0_12_stage_10&#45;&gt;ring_attn_0_13_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-17860C9727.02,-17860 9885.86,-17860 9885.86,-17860"/>
<polygon fill="red" stroke="red" points="9885.86,-17863.5 9895.86,-17860 9885.86,-17856.5 9885.86,-17863.5"/>
</g>
<!-- ring_attn_0_12_stage_11&#45;&gt;ring_attn_0_12_stage_12 -->
<g id="edge1179" class="edge">
<title>ring_attn_0_12_stage_11&#45;&gt;ring_attn_0_12_stage_12</title>
<path fill="none" stroke="black" d="M9518,-17538.87C9518,-17538.87 9518,-17432.25 9518,-17432.25"/>
<polygon fill="black" stroke="black" points="9521.5,-17432.25 9518,-17422.25 9514.5,-17432.25 9521.5,-17432.25"/>
</g>
<!-- ring_attn_0_13_stage_11 -->
<g id="node1289" class="node">
<title>ring_attn_0_13_stage_11</title>
<polygon fill="yellow" stroke="black" points="10105,-17675 9896,-17607 10105,-17539 10314,-17607 10105,-17675"/>
<text text-anchor="middle" x="10105" y="-17625.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-17610.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="10105" y="-17595.8" font-family="Times,serif" font-size="14.00">Q[13]×K[2]×V[2]</text>
<text text-anchor="middle" x="10105" y="-17580.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_12_stage_11&#45;&gt;ring_attn_0_13_stage_11 -->
<g id="edge3052" class="edge">
<title>ring_attn_0_12_stage_11&#45;&gt;ring_attn_0_13_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-17607C9727.02,-17607 9885.86,-17607 9885.86,-17607"/>
<polygon fill="red" stroke="red" points="9885.86,-17610.5 9895.86,-17607 9885.86,-17603.5 9885.86,-17610.5"/>
</g>
<!-- ring_attn_0_12_stage_12&#45;&gt;ring_attn_0_12_stage_13 -->
<g id="edge1180" class="edge">
<title>ring_attn_0_12_stage_12&#45;&gt;ring_attn_0_12_stage_13</title>
<path fill="none" stroke="black" d="M9518,-17285.87C9518,-17285.87 9518,-17179.25 9518,-17179.25"/>
<polygon fill="black" stroke="black" points="9521.5,-17179.25 9518,-17169.25 9514.5,-17179.25 9521.5,-17179.25"/>
</g>
<!-- ring_attn_0_13_stage_12 -->
<g id="node1290" class="node">
<title>ring_attn_0_13_stage_12</title>
<polygon fill="yellow" stroke="black" points="10105,-17422 9896,-17354 10105,-17286 10314,-17354 10105,-17422"/>
<text text-anchor="middle" x="10105" y="-17372.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-17357.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="10105" y="-17342.8" font-family="Times,serif" font-size="14.00">Q[13]×K[1]×V[1]</text>
<text text-anchor="middle" x="10105" y="-17327.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_12_stage_12&#45;&gt;ring_attn_0_13_stage_12 -->
<g id="edge3053" class="edge">
<title>ring_attn_0_12_stage_12&#45;&gt;ring_attn_0_13_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-17354C9727.02,-17354 9885.86,-17354 9885.86,-17354"/>
<polygon fill="red" stroke="red" points="9885.86,-17357.5 9895.86,-17354 9885.86,-17350.5 9885.86,-17357.5"/>
</g>
<!-- ring_attn_0_12_stage_13&#45;&gt;ring_attn_0_12_stage_14 -->
<g id="edge1181" class="edge">
<title>ring_attn_0_12_stage_13&#45;&gt;ring_attn_0_12_stage_14</title>
<path fill="none" stroke="black" d="M9518,-17032.87C9518,-17032.87 9518,-16926.25 9518,-16926.25"/>
<polygon fill="black" stroke="black" points="9521.5,-16926.25 9518,-16916.25 9514.5,-16926.25 9521.5,-16926.25"/>
</g>
<!-- ring_attn_0_13_stage_13 -->
<g id="node1291" class="node">
<title>ring_attn_0_13_stage_13</title>
<polygon fill="yellow" stroke="black" points="10105,-17169 9896,-17101 10105,-17033 10314,-17101 10105,-17169"/>
<text text-anchor="middle" x="10105" y="-17119.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-17104.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="10105" y="-17089.8" font-family="Times,serif" font-size="14.00">Q[13]×K[0]×V[0]</text>
<text text-anchor="middle" x="10105" y="-17074.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_12_stage_13&#45;&gt;ring_attn_0_13_stage_13 -->
<g id="edge3054" class="edge">
<title>ring_attn_0_12_stage_13&#45;&gt;ring_attn_0_13_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-17101C9727.02,-17101 9885.86,-17101 9885.86,-17101"/>
<polygon fill="red" stroke="red" points="9885.86,-17104.5 9895.86,-17101 9885.86,-17097.5 9885.86,-17104.5"/>
</g>
<!-- ring_attn_0_12_stage_14&#45;&gt;ring_attn_0_12_stage_15 -->
<g id="edge1182" class="edge">
<title>ring_attn_0_12_stage_14&#45;&gt;ring_attn_0_12_stage_15</title>
<path fill="none" stroke="black" d="M9518,-16779.87C9518,-16779.87 9518,-16673.25 9518,-16673.25"/>
<polygon fill="black" stroke="black" points="9521.5,-16673.25 9518,-16663.25 9514.5,-16673.25 9521.5,-16673.25"/>
</g>
<!-- ring_attn_0_13_stage_14 -->
<g id="node1292" class="node">
<title>ring_attn_0_13_stage_14</title>
<polygon fill="yellow" stroke="black" points="10105,-16916 9896,-16848 10105,-16780 10314,-16848 10105,-16916"/>
<text text-anchor="middle" x="10105" y="-16866.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-16851.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="10105" y="-16836.8" font-family="Times,serif" font-size="14.00">Q[13]×K[15]×V[15]</text>
<text text-anchor="middle" x="10105" y="-16821.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_12_stage_14&#45;&gt;ring_attn_0_13_stage_14 -->
<g id="edge3055" class="edge">
<title>ring_attn_0_12_stage_14&#45;&gt;ring_attn_0_13_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-16848C9727.02,-16848 9885.86,-16848 9885.86,-16848"/>
<polygon fill="red" stroke="red" points="9885.86,-16851.5 9895.86,-16848 9885.86,-16844.5 9885.86,-16851.5"/>
</g>
<!-- attn_out_0_12 -->
<g id="node1196" class="node">
<title>attn_out_0_12</title>
<polygon fill="none" stroke="black" points="9587.5,-16454 9448.5,-16454 9448.5,-16401 9587.5,-16401 9587.5,-16454"/>
<text text-anchor="middle" x="9518" y="-16438.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="9518" y="-16423.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="9518" y="-16408.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_0_12_stage_15&#45;&gt;attn_out_0_12 -->
<g id="edge1183" class="edge">
<title>ring_attn_0_12_stage_15&#45;&gt;attn_out_0_12</title>
<path fill="none" stroke="black" d="M9518,-16526.87C9518,-16526.87 9518,-16464.18 9518,-16464.18"/>
<polygon fill="black" stroke="black" points="9521.5,-16464.18 9518,-16454.18 9514.5,-16464.18 9521.5,-16464.18"/>
</g>
<!-- ring_attn_0_13_stage_15 -->
<g id="node1293" class="node">
<title>ring_attn_0_13_stage_15</title>
<polygon fill="yellow" stroke="black" points="10105,-16663 9896,-16595 10105,-16527 10314,-16595 10105,-16663"/>
<text text-anchor="middle" x="10105" y="-16613.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-16598.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="10105" y="-16583.8" font-family="Times,serif" font-size="14.00">Q[13]×K[14]×V[14]</text>
<text text-anchor="middle" x="10105" y="-16568.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_12_stage_15&#45;&gt;ring_attn_0_13_stage_15 -->
<g id="edge3056" class="edge">
<title>ring_attn_0_12_stage_15&#45;&gt;ring_attn_0_13_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-16595C9727.02,-16595 9885.86,-16595 9885.86,-16595"/>
<polygon fill="red" stroke="red" points="9885.86,-16598.5 9895.86,-16595 9885.86,-16591.5 9885.86,-16598.5"/>
</g>
<!-- attn_residual_0_12 -->
<g id="node1197" class="node">
<title>attn_residual_0_12</title>
<ellipse fill="none" stroke="black" cx="9518" cy="-16301" rx="105.5" ry="27"/>
<text text-anchor="middle" x="9518" y="-16304.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="9518" y="-16289.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_0_12&#45;&gt;attn_residual_0_12 -->
<g id="edge1184" class="edge">
<title>attn_out_0_12&#45;&gt;attn_residual_0_12</title>
<path fill="none" stroke="black" d="M9518,-16400.98C9518,-16400.98 9518,-16338.36 9518,-16338.36"/>
<polygon fill="black" stroke="black" points="9521.5,-16338.36 9518,-16328.36 9514.5,-16338.36 9521.5,-16338.36"/>
</g>
<!-- gate_0_12 -->
<g id="node1198" class="node">
<title>gate_0_12</title>
<ellipse fill="orange" stroke="black" cx="9518" cy="-16163.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="9518" y="-16174.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="9518" y="-16159.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="9518" y="-16144.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_0_12&#45;&gt;gate_0_12 -->
<g id="edge1185" class="edge">
<title>attn_residual_0_12&#45;&gt;gate_0_12</title>
<path fill="none" stroke="black" d="M9553.17,-16275.46C9553.17,-16275.46 9553.17,-16209.01 9553.17,-16209.01"/>
<polygon fill="black" stroke="black" points="9556.67,-16209.01 9553.17,-16199.01 9549.67,-16209.01 9556.67,-16209.01"/>
</g>
<!-- gate_0_12&#45;&gt;expert_0_0_0 -->
<g id="edge3057" class="edge">
<title>gate_0_12&#45;&gt;expert_0_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9482.83,-16199C9482.83,-16230.31 9482.83,-16271 9482.83,-16271 9482.83,-16271 108.7,-16271 108.7,-16271 108.7,-16271 108.7,-16004.17 108.7,-16004.17"/>
<polygon fill="blue" stroke="blue" points="112.2,-16004.17 108.7,-15994.17 105.2,-16004.17 112.2,-16004.17"/>
<text text-anchor="middle" x="40316.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="40316.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU12→GPU0</text>
<text text-anchor="middle" x="40316.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="40316.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_12&#45;&gt;expert_0_1_0 -->
<g id="edge3058" class="edge">
<title>gate_0_12&#45;&gt;expert_0_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9421.67,-16148.09C9421.67,-16111.41 9421.67,-16022 9421.67,-16022 9421.67,-16022 3013.05,-16022 3013.05,-16022 3013.05,-16022 3013.05,-16004.11 3013.05,-16004.11"/>
<polygon fill="blue" stroke="blue" points="3016.55,-16004.11 3013.05,-15994.11 3009.55,-16004.11 3016.55,-16004.11"/>
<text text-anchor="middle" x="40490.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="40490.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU12→GPU1</text>
<text text-anchor="middle" x="40490.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="40490.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_12&#45;&gt;expert_0_2_0 -->
<g id="edge3059" class="edge">
<title>gate_0_12&#45;&gt;expert_0_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9440.02,-16138C9440.02,-16096.52 9440.02,-16019 9440.02,-16019 9440.02,-16019 3628.46,-16019 3628.46,-16019 3628.46,-16019 3628.46,-16004.16 3628.46,-16004.16"/>
<polygon fill="blue" stroke="blue" points="3631.96,-16004.16 3628.46,-15994.16 3624.96,-16004.16 3631.96,-16004.16"/>
<text text-anchor="middle" x="40664.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="40664.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU12→GPU2</text>
<text text-anchor="middle" x="40664.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="40664.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_12&#45;&gt;expert_0_3_0 -->
<g id="edge3060" class="edge">
<title>gate_0_12&#45;&gt;expert_0_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9458.37,-16132.23C9458.37,-16090.28 9458.37,-16021 9458.37,-16021 9458.37,-16021 4222.34,-16021 4222.34,-16021 4222.34,-16021 4222.34,-16004.25 4222.34,-16004.25"/>
<polygon fill="blue" stroke="blue" points="4225.84,-16004.25 4222.34,-15994.25 4218.84,-16004.25 4225.84,-16004.25"/>
<text text-anchor="middle" x="40838.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="40838.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU12→GPU3</text>
<text text-anchor="middle" x="40838.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="40838.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_12&#45;&gt;expert_0_4_0 -->
<g id="edge3061" class="edge">
<title>gate_0_12&#45;&gt;expert_0_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9476.72,-16128.86C9476.72,-16089.01 9476.72,-16029 9476.72,-16029 9476.72,-16029 4827.02,-16029 4827.02,-16029 4827.02,-16029 4827.02,-16004.3 4827.02,-16004.3"/>
<polygon fill="blue" stroke="blue" points="4830.52,-16004.3 4827.02,-15994.3 4823.52,-16004.3 4830.52,-16004.3"/>
<text text-anchor="middle" x="41012.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41012.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU12→GPU4</text>
<text text-anchor="middle" x="41012.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41012.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_12&#45;&gt;expert_0_5_0 -->
<g id="edge3062" class="edge">
<title>gate_0_12&#45;&gt;expert_0_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9495.07,-16126.78C9495.07,-16090.38 9495.07,-16040 9495.07,-16040 9495.07,-16040 5424.07,-16040 5424.07,-16040 5424.07,-16040 5424.07,-16004.08 5424.07,-16004.08"/>
<polygon fill="blue" stroke="blue" points="5427.57,-16004.08 5424.07,-15994.08 5420.57,-16004.08 5427.57,-16004.08"/>
<text text-anchor="middle" x="41186.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41186.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU12→GPU5</text>
<text text-anchor="middle" x="41186.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41186.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_12&#45;&gt;expert_0_6_0 -->
<g id="edge3063" class="edge">
<title>gate_0_12&#45;&gt;expert_0_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9513.41,-16126.02C9513.41,-16092.96 9513.41,-16050 9513.41,-16050 9513.41,-16050 6006.55,-16050 6006.55,-16050 6006.55,-16050 6006.55,-16004.06 6006.55,-16004.06"/>
<polygon fill="blue" stroke="blue" points="6010.05,-16004.06 6006.55,-15994.06 6003.05,-16004.06 6010.05,-16004.06"/>
<text text-anchor="middle" x="41360.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41360.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU12→GPU6</text>
<text text-anchor="middle" x="41360.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41360.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_12&#45;&gt;expert_0_7_0 -->
<g id="edge3064" class="edge">
<title>gate_0_12&#45;&gt;expert_0_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9531.76,-16126.3C9531.76,-16095.93 9531.76,-16058 9531.76,-16058 9531.76,-16058 6598.07,-16058 6598.07,-16058 6598.07,-16058 6598.07,-16004.16 6598.07,-16004.16"/>
<polygon fill="blue" stroke="blue" points="6601.57,-16004.16 6598.07,-15994.16 6594.57,-16004.16 6601.57,-16004.16"/>
<text text-anchor="middle" x="41534.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41534.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU12→GPU7</text>
<text text-anchor="middle" x="41534.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41534.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_12&#45;&gt;expert_0_8_0 -->
<g id="edge3065" class="edge">
<title>gate_0_12&#45;&gt;expert_0_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9550.11,-16127.77C9550.11,-16101.01 9550.11,-16069 9550.11,-16069 9550.11,-16069 7183.76,-16069 7183.76,-16069 7183.76,-16069 7183.76,-16004.17 7183.76,-16004.17"/>
<polygon fill="blue" stroke="blue" points="7187.26,-16004.17 7183.76,-15994.17 7180.26,-16004.17 7187.26,-16004.17"/>
<text text-anchor="middle" x="41708.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41708.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU12→GPU8</text>
<text text-anchor="middle" x="41708.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41708.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_12&#45;&gt;expert_0_9_0 -->
<g id="edge3066" class="edge">
<title>gate_0_12&#45;&gt;expert_0_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9568.46,-16130.42C9568.46,-16105.64 9568.46,-16076 9568.46,-16076 9568.46,-16076 7776.18,-16076 7776.18,-16076 7776.18,-16076 7776.18,-16004.04 7776.18,-16004.04"/>
<polygon fill="blue" stroke="blue" points="7779.68,-16004.04 7776.18,-15994.04 7772.68,-16004.04 7779.68,-16004.04"/>
<text text-anchor="middle" x="41882.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41882.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU12→GPU9</text>
<text text-anchor="middle" x="41882.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41882.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_12&#45;&gt;expert_0_10_0 -->
<g id="edge3067" class="edge">
<title>gate_0_12&#45;&gt;expert_0_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9577.63,-16132.51C9577.63,-16123 9577.63,-16115 9577.63,-16115 9577.63,-16115 8458.5,-16115 8458.5,-16115 8458.5,-16115 8458.5,-16004.21 8458.5,-16004.21"/>
<polygon fill="blue" stroke="blue" points="8462,-16004.21 8458.5,-15994.21 8455,-16004.21 8462,-16004.21"/>
<text text-anchor="middle" x="42056.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42056.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU12→GPU10</text>
<text text-anchor="middle" x="42056.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42056.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_12&#45;&gt;expert_0_11_0 -->
<g id="edge3068" class="edge">
<title>gate_0_12&#45;&gt;expert_0_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9418.3,-16176C9278.46,-16176 9041,-16176 9041,-16176 9041,-16176 9041,-16004.33 9041,-16004.33"/>
<polygon fill="blue" stroke="blue" points="9044.5,-16004.33 9041,-15994.33 9037.5,-16004.33 9044.5,-16004.33"/>
<text text-anchor="middle" x="42230.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42230.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU12→GPU11</text>
<text text-anchor="middle" x="42230.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42230.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_12&#45;&gt;expert_0_12_0 -->
<g id="edge1186" class="edge">
<title>gate_0_12&#45;&gt;expert_0_12_0</title>
<path fill="none" stroke="black" d="M9586.8,-16135C9586.8,-16135 9586.8,-16004.15 9586.8,-16004.15"/>
<polygon fill="black" stroke="black" points="9590.3,-16004.15 9586.8,-15994.15 9583.3,-16004.15 9590.3,-16004.15"/>
</g>
<!-- gate_0_12&#45;&gt;expert_0_13_0 -->
<g id="edge3069" class="edge">
<title>gate_0_12&#45;&gt;expert_0_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9617.65,-16151C9757.77,-16151 9996.12,-16151 9996.12,-16151 9996.12,-16151 9996.12,-16004.18 9996.12,-16004.18"/>
<polygon fill="blue" stroke="blue" points="9999.63,-16004.18 9996.12,-15994.18 9992.63,-16004.18 9999.63,-16004.18"/>
<text text-anchor="middle" x="42404.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42404.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU12→GPU13</text>
<text text-anchor="middle" x="42404.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42404.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_12&#45;&gt;expert_0_14_0 -->
<g id="edge3070" class="edge">
<title>gate_0_12&#45;&gt;expert_0_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9605.15,-16142.26C9605.15,-16128.07 9605.15,-16112 9605.15,-16112 9605.15,-16112 10578.4,-16112 10578.4,-16112 10578.4,-16112 10578.4,-16004 10578.4,-16004"/>
<polygon fill="blue" stroke="blue" points="10581.9,-16004 10578.4,-15994 10574.9,-16004 10581.9,-16004"/>
<text text-anchor="middle" x="42578.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42578.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU12→GPU14</text>
<text text-anchor="middle" x="42578.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42578.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_12&#45;&gt;expert_0_15_0 -->
<g id="edge3071" class="edge">
<title>gate_0_12&#45;&gt;expert_0_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9614.33,-16148.05C9614.33,-16132.88 9614.33,-16112 9614.33,-16112 9614.33,-16112 11163.38,-16112 11163.38,-16112 11163.38,-16112 11163.38,-16004 11163.38,-16004"/>
<polygon fill="blue" stroke="blue" points="11166.88,-16004 11163.38,-15994 11159.88,-16004 11166.88,-16004"/>
<text text-anchor="middle" x="42752.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42752.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU12→GPU15</text>
<text text-anchor="middle" x="42752.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42752.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_12 -->
<g id="node1200" class="node">
<title>expert_reduce_0_12</title>
<ellipse fill="none" stroke="black" cx="9518" cy="-15830.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="9518" y="-15841.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="9518" y="-15826.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="9518" y="-15811.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_12_0&#45;&gt;expert_reduce_0_12 -->
<g id="edge1187" class="edge">
<title>expert_0_12_0&#45;&gt;expert_reduce_0_12</title>
<path fill="none" stroke="black" d="M9518,-15940.76C9518,-15940.76 9518,-15878.06 9518,-15878.06"/>
<polygon fill="black" stroke="black" points="9521.5,-15878.06 9518,-15868.06 9514.5,-15878.06 9521.5,-15878.06"/>
</g>
<!-- moe_residual_0_12 -->
<g id="node1201" class="node">
<title>moe_residual_0_12</title>
<ellipse fill="none" stroke="black" cx="9518" cy="-15693" rx="105.5" ry="27"/>
<text text-anchor="middle" x="9518" y="-15696.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="9518" y="-15681.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_12&#45;&gt;moe_residual_0_12 -->
<g id="edge1188" class="edge">
<title>expert_reduce_0_12&#45;&gt;moe_residual_0_12</title>
<path fill="none" stroke="black" d="M9518,-15792.93C9518,-15792.93 9518,-15730.06 9518,-15730.06"/>
<polygon fill="black" stroke="black" points="9521.5,-15730.06 9518,-15720.06 9514.5,-15730.06 9521.5,-15730.06"/>
</g>
<!-- qkv_proj_1_12 -->
<g id="node1202" class="node">
<title>qkv_proj_1_12</title>
<polygon fill="none" stroke="black" points="9600.5,-15593 9435.5,-15593 9435.5,-15540 9600.5,-15540 9600.5,-15593"/>
<text text-anchor="middle" x="9518" y="-15577.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="9518" y="-15562.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="9518" y="-15547.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_0_12&#45;&gt;qkv_proj_1_12 -->
<g id="edge1189" class="edge">
<title>moe_residual_0_12&#45;&gt;qkv_proj_1_12</title>
<path fill="none" stroke="black" d="M9518,-15665.86C9518,-15665.86 9518,-15603.16 9518,-15603.16"/>
<polygon fill="black" stroke="black" points="9521.5,-15603.16 9518,-15593.16 9514.5,-15603.16 9521.5,-15603.16"/>
</g>
<!-- qkv_reshape_1_12 -->
<g id="node1203" class="node">
<title>qkv_reshape_1_12</title>
<ellipse fill="none" stroke="black" cx="9518" cy="-15440" rx="148" ry="27"/>
<text text-anchor="middle" x="9518" y="-15443.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="9518" y="-15428.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_1_12&#45;&gt;qkv_reshape_1_12 -->
<g id="edge1190" class="edge">
<title>qkv_proj_1_12&#45;&gt;qkv_reshape_1_12</title>
<path fill="none" stroke="black" d="M9518,-15539.98C9518,-15539.98 9518,-15477.36 9518,-15477.36"/>
<polygon fill="black" stroke="black" points="9521.5,-15477.36 9518,-15467.36 9514.5,-15477.36 9521.5,-15477.36"/>
</g>
<!-- qkv_reshape_1_12&#45;&gt;ring_attn_1_12_stage_0 -->
<g id="edge1191" class="edge">
<title>qkv_reshape_1_12&#45;&gt;ring_attn_1_12_stage_0</title>
<path fill="none" stroke="black" d="M9518,-15412.72C9518,-15412.72 9518,-15306.16 9518,-15306.16"/>
<polygon fill="black" stroke="black" points="9521.5,-15306.16 9518,-15296.16 9514.5,-15306.16 9521.5,-15306.16"/>
</g>
<!-- ring_attn_1_12_stage_0&#45;&gt;ring_attn_1_12_stage_1 -->
<g id="edge1192" class="edge">
<title>ring_attn_1_12_stage_0&#45;&gt;ring_attn_1_12_stage_1</title>
<path fill="none" stroke="black" d="M9518,-15159.87C9518,-15159.87 9518,-15053.25 9518,-15053.25"/>
<polygon fill="black" stroke="black" points="9521.5,-15053.25 9518,-15043.25 9514.5,-15053.25 9521.5,-15053.25"/>
</g>
<!-- ring_attn_1_13_stage_0 -->
<g id="node1302" class="node">
<title>ring_attn_1_13_stage_0</title>
<polygon fill="yellow" stroke="black" points="10105,-15296 9896,-15228 10105,-15160 10314,-15228 10105,-15296"/>
<text text-anchor="middle" x="10105" y="-15246.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-15231.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="10105" y="-15216.8" font-family="Times,serif" font-size="14.00">Q[13]×K[13]×V[13]</text>
<text text-anchor="middle" x="10105" y="-15201.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_12_stage_0&#45;&gt;ring_attn_1_13_stage_0 -->
<g id="edge3072" class="edge">
<title>ring_attn_1_12_stage_0&#45;&gt;ring_attn_1_13_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-15228C9727.02,-15228 9885.86,-15228 9885.86,-15228"/>
<polygon fill="red" stroke="red" points="9885.86,-15231.5 9895.86,-15228 9885.86,-15224.5 9885.86,-15231.5"/>
</g>
<!-- ring_attn_1_12_stage_1&#45;&gt;ring_attn_1_12_stage_2 -->
<g id="edge1193" class="edge">
<title>ring_attn_1_12_stage_1&#45;&gt;ring_attn_1_12_stage_2</title>
<path fill="none" stroke="black" d="M9518,-14906.87C9518,-14906.87 9518,-14800.25 9518,-14800.25"/>
<polygon fill="black" stroke="black" points="9521.5,-14800.25 9518,-14790.25 9514.5,-14800.25 9521.5,-14800.25"/>
</g>
<!-- ring_attn_1_13_stage_1 -->
<g id="node1303" class="node">
<title>ring_attn_1_13_stage_1</title>
<polygon fill="yellow" stroke="black" points="10105,-15043 9896,-14975 10105,-14907 10314,-14975 10105,-15043"/>
<text text-anchor="middle" x="10105" y="-14993.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-14978.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="10105" y="-14963.8" font-family="Times,serif" font-size="14.00">Q[13]×K[12]×V[12]</text>
<text text-anchor="middle" x="10105" y="-14948.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_12_stage_1&#45;&gt;ring_attn_1_13_stage_1 -->
<g id="edge3073" class="edge">
<title>ring_attn_1_12_stage_1&#45;&gt;ring_attn_1_13_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-14975C9727.02,-14975 9885.86,-14975 9885.86,-14975"/>
<polygon fill="red" stroke="red" points="9885.86,-14978.5 9895.86,-14975 9885.86,-14971.5 9885.86,-14978.5"/>
</g>
<!-- ring_attn_1_12_stage_2&#45;&gt;ring_attn_1_12_stage_3 -->
<g id="edge1194" class="edge">
<title>ring_attn_1_12_stage_2&#45;&gt;ring_attn_1_12_stage_3</title>
<path fill="none" stroke="black" d="M9518,-14653.87C9518,-14653.87 9518,-14547.25 9518,-14547.25"/>
<polygon fill="black" stroke="black" points="9521.5,-14547.25 9518,-14537.25 9514.5,-14547.25 9521.5,-14547.25"/>
</g>
<!-- ring_attn_1_13_stage_2 -->
<g id="node1304" class="node">
<title>ring_attn_1_13_stage_2</title>
<polygon fill="yellow" stroke="black" points="10105,-14790 9896,-14722 10105,-14654 10314,-14722 10105,-14790"/>
<text text-anchor="middle" x="10105" y="-14740.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-14725.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="10105" y="-14710.8" font-family="Times,serif" font-size="14.00">Q[13]×K[11]×V[11]</text>
<text text-anchor="middle" x="10105" y="-14695.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_12_stage_2&#45;&gt;ring_attn_1_13_stage_2 -->
<g id="edge3074" class="edge">
<title>ring_attn_1_12_stage_2&#45;&gt;ring_attn_1_13_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-14722C9727.02,-14722 9885.86,-14722 9885.86,-14722"/>
<polygon fill="red" stroke="red" points="9885.86,-14725.5 9895.86,-14722 9885.86,-14718.5 9885.86,-14725.5"/>
</g>
<!-- ring_attn_1_12_stage_3&#45;&gt;ring_attn_1_12_stage_4 -->
<g id="edge1195" class="edge">
<title>ring_attn_1_12_stage_3&#45;&gt;ring_attn_1_12_stage_4</title>
<path fill="none" stroke="black" d="M9518,-14400.87C9518,-14400.87 9518,-14294.25 9518,-14294.25"/>
<polygon fill="black" stroke="black" points="9521.5,-14294.25 9518,-14284.25 9514.5,-14294.25 9521.5,-14294.25"/>
</g>
<!-- ring_attn_1_13_stage_3 -->
<g id="node1305" class="node">
<title>ring_attn_1_13_stage_3</title>
<polygon fill="yellow" stroke="black" points="10105,-14537 9896,-14469 10105,-14401 10314,-14469 10105,-14537"/>
<text text-anchor="middle" x="10105" y="-14487.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-14472.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="10105" y="-14457.8" font-family="Times,serif" font-size="14.00">Q[13]×K[10]×V[10]</text>
<text text-anchor="middle" x="10105" y="-14442.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_12_stage_3&#45;&gt;ring_attn_1_13_stage_3 -->
<g id="edge3075" class="edge">
<title>ring_attn_1_12_stage_3&#45;&gt;ring_attn_1_13_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-14469C9727.02,-14469 9885.86,-14469 9885.86,-14469"/>
<polygon fill="red" stroke="red" points="9885.86,-14472.5 9895.86,-14469 9885.86,-14465.5 9885.86,-14472.5"/>
</g>
<!-- ring_attn_1_12_stage_4&#45;&gt;ring_attn_1_12_stage_5 -->
<g id="edge1196" class="edge">
<title>ring_attn_1_12_stage_4&#45;&gt;ring_attn_1_12_stage_5</title>
<path fill="none" stroke="black" d="M9518,-14147.87C9518,-14147.87 9518,-14041.25 9518,-14041.25"/>
<polygon fill="black" stroke="black" points="9521.5,-14041.25 9518,-14031.25 9514.5,-14041.25 9521.5,-14041.25"/>
</g>
<!-- ring_attn_1_13_stage_4 -->
<g id="node1306" class="node">
<title>ring_attn_1_13_stage_4</title>
<polygon fill="yellow" stroke="black" points="10105,-14284 9896,-14216 10105,-14148 10314,-14216 10105,-14284"/>
<text text-anchor="middle" x="10105" y="-14234.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-14219.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="10105" y="-14204.8" font-family="Times,serif" font-size="14.00">Q[13]×K[9]×V[9]</text>
<text text-anchor="middle" x="10105" y="-14189.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_12_stage_4&#45;&gt;ring_attn_1_13_stage_4 -->
<g id="edge3076" class="edge">
<title>ring_attn_1_12_stage_4&#45;&gt;ring_attn_1_13_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-14216C9727.02,-14216 9885.86,-14216 9885.86,-14216"/>
<polygon fill="red" stroke="red" points="9885.86,-14219.5 9895.86,-14216 9885.86,-14212.5 9885.86,-14219.5"/>
</g>
<!-- ring_attn_1_12_stage_5&#45;&gt;ring_attn_1_12_stage_6 -->
<g id="edge1197" class="edge">
<title>ring_attn_1_12_stage_5&#45;&gt;ring_attn_1_12_stage_6</title>
<path fill="none" stroke="black" d="M9518,-13894.87C9518,-13894.87 9518,-13788.25 9518,-13788.25"/>
<polygon fill="black" stroke="black" points="9521.5,-13788.25 9518,-13778.25 9514.5,-13788.25 9521.5,-13788.25"/>
</g>
<!-- ring_attn_1_13_stage_5 -->
<g id="node1307" class="node">
<title>ring_attn_1_13_stage_5</title>
<polygon fill="yellow" stroke="black" points="10105,-14031 9896,-13963 10105,-13895 10314,-13963 10105,-14031"/>
<text text-anchor="middle" x="10105" y="-13981.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-13966.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="10105" y="-13951.8" font-family="Times,serif" font-size="14.00">Q[13]×K[8]×V[8]</text>
<text text-anchor="middle" x="10105" y="-13936.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_12_stage_5&#45;&gt;ring_attn_1_13_stage_5 -->
<g id="edge3077" class="edge">
<title>ring_attn_1_12_stage_5&#45;&gt;ring_attn_1_13_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-13963C9727.02,-13963 9885.86,-13963 9885.86,-13963"/>
<polygon fill="red" stroke="red" points="9885.86,-13966.5 9895.86,-13963 9885.86,-13959.5 9885.86,-13966.5"/>
</g>
<!-- ring_attn_1_12_stage_6&#45;&gt;ring_attn_1_12_stage_7 -->
<g id="edge1198" class="edge">
<title>ring_attn_1_12_stage_6&#45;&gt;ring_attn_1_12_stage_7</title>
<path fill="none" stroke="black" d="M9518,-13641.87C9518,-13641.87 9518,-13535.25 9518,-13535.25"/>
<polygon fill="black" stroke="black" points="9521.5,-13535.25 9518,-13525.25 9514.5,-13535.25 9521.5,-13535.25"/>
</g>
<!-- ring_attn_1_13_stage_6 -->
<g id="node1308" class="node">
<title>ring_attn_1_13_stage_6</title>
<polygon fill="yellow" stroke="black" points="10105,-13778 9896,-13710 10105,-13642 10314,-13710 10105,-13778"/>
<text text-anchor="middle" x="10105" y="-13728.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-13713.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="10105" y="-13698.8" font-family="Times,serif" font-size="14.00">Q[13]×K[7]×V[7]</text>
<text text-anchor="middle" x="10105" y="-13683.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_12_stage_6&#45;&gt;ring_attn_1_13_stage_6 -->
<g id="edge3078" class="edge">
<title>ring_attn_1_12_stage_6&#45;&gt;ring_attn_1_13_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-13710C9727.02,-13710 9885.86,-13710 9885.86,-13710"/>
<polygon fill="red" stroke="red" points="9885.86,-13713.5 9895.86,-13710 9885.86,-13706.5 9885.86,-13713.5"/>
</g>
<!-- ring_attn_1_12_stage_7&#45;&gt;ring_attn_1_12_stage_8 -->
<g id="edge1199" class="edge">
<title>ring_attn_1_12_stage_7&#45;&gt;ring_attn_1_12_stage_8</title>
<path fill="none" stroke="black" d="M9518,-13388.87C9518,-13388.87 9518,-13282.25 9518,-13282.25"/>
<polygon fill="black" stroke="black" points="9521.5,-13282.25 9518,-13272.25 9514.5,-13282.25 9521.5,-13282.25"/>
</g>
<!-- ring_attn_1_13_stage_7 -->
<g id="node1309" class="node">
<title>ring_attn_1_13_stage_7</title>
<polygon fill="yellow" stroke="black" points="10105,-13525 9896,-13457 10105,-13389 10314,-13457 10105,-13525"/>
<text text-anchor="middle" x="10105" y="-13475.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-13460.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="10105" y="-13445.8" font-family="Times,serif" font-size="14.00">Q[13]×K[6]×V[6]</text>
<text text-anchor="middle" x="10105" y="-13430.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_12_stage_7&#45;&gt;ring_attn_1_13_stage_7 -->
<g id="edge3079" class="edge">
<title>ring_attn_1_12_stage_7&#45;&gt;ring_attn_1_13_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-13457C9727.02,-13457 9885.86,-13457 9885.86,-13457"/>
<polygon fill="red" stroke="red" points="9885.86,-13460.5 9895.86,-13457 9885.86,-13453.5 9885.86,-13460.5"/>
</g>
<!-- ring_attn_1_12_stage_8&#45;&gt;ring_attn_1_12_stage_9 -->
<g id="edge1200" class="edge">
<title>ring_attn_1_12_stage_8&#45;&gt;ring_attn_1_12_stage_9</title>
<path fill="none" stroke="black" d="M9518,-13135.87C9518,-13135.87 9518,-13029.25 9518,-13029.25"/>
<polygon fill="black" stroke="black" points="9521.5,-13029.25 9518,-13019.25 9514.5,-13029.25 9521.5,-13029.25"/>
</g>
<!-- ring_attn_1_13_stage_8 -->
<g id="node1310" class="node">
<title>ring_attn_1_13_stage_8</title>
<polygon fill="yellow" stroke="black" points="10105,-13272 9896,-13204 10105,-13136 10314,-13204 10105,-13272"/>
<text text-anchor="middle" x="10105" y="-13222.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-13207.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="10105" y="-13192.8" font-family="Times,serif" font-size="14.00">Q[13]×K[5]×V[5]</text>
<text text-anchor="middle" x="10105" y="-13177.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_12_stage_8&#45;&gt;ring_attn_1_13_stage_8 -->
<g id="edge3080" class="edge">
<title>ring_attn_1_12_stage_8&#45;&gt;ring_attn_1_13_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-13204C9727.02,-13204 9885.86,-13204 9885.86,-13204"/>
<polygon fill="red" stroke="red" points="9885.86,-13207.5 9895.86,-13204 9885.86,-13200.5 9885.86,-13207.5"/>
</g>
<!-- ring_attn_1_12_stage_9&#45;&gt;ring_attn_1_12_stage_10 -->
<g id="edge1201" class="edge">
<title>ring_attn_1_12_stage_9&#45;&gt;ring_attn_1_12_stage_10</title>
<path fill="none" stroke="black" d="M9518,-12882.87C9518,-12882.87 9518,-12776.25 9518,-12776.25"/>
<polygon fill="black" stroke="black" points="9521.5,-12776.25 9518,-12766.25 9514.5,-12776.25 9521.5,-12776.25"/>
</g>
<!-- ring_attn_1_13_stage_9 -->
<g id="node1311" class="node">
<title>ring_attn_1_13_stage_9</title>
<polygon fill="yellow" stroke="black" points="10105,-13019 9896,-12951 10105,-12883 10314,-12951 10105,-13019"/>
<text text-anchor="middle" x="10105" y="-12969.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-12954.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="10105" y="-12939.8" font-family="Times,serif" font-size="14.00">Q[13]×K[4]×V[4]</text>
<text text-anchor="middle" x="10105" y="-12924.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_12_stage_9&#45;&gt;ring_attn_1_13_stage_9 -->
<g id="edge3081" class="edge">
<title>ring_attn_1_12_stage_9&#45;&gt;ring_attn_1_13_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-12951C9727.02,-12951 9885.86,-12951 9885.86,-12951"/>
<polygon fill="red" stroke="red" points="9885.86,-12954.5 9895.86,-12951 9885.86,-12947.5 9885.86,-12954.5"/>
</g>
<!-- ring_attn_1_12_stage_10&#45;&gt;ring_attn_1_12_stage_11 -->
<g id="edge1202" class="edge">
<title>ring_attn_1_12_stage_10&#45;&gt;ring_attn_1_12_stage_11</title>
<path fill="none" stroke="black" d="M9518,-12629.87C9518,-12629.87 9518,-12523.25 9518,-12523.25"/>
<polygon fill="black" stroke="black" points="9521.5,-12523.25 9518,-12513.25 9514.5,-12523.25 9521.5,-12523.25"/>
</g>
<!-- ring_attn_1_13_stage_10 -->
<g id="node1312" class="node">
<title>ring_attn_1_13_stage_10</title>
<polygon fill="yellow" stroke="black" points="10105,-12766 9896,-12698 10105,-12630 10314,-12698 10105,-12766"/>
<text text-anchor="middle" x="10105" y="-12716.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-12701.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="10105" y="-12686.8" font-family="Times,serif" font-size="14.00">Q[13]×K[3]×V[3]</text>
<text text-anchor="middle" x="10105" y="-12671.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_12_stage_10&#45;&gt;ring_attn_1_13_stage_10 -->
<g id="edge3082" class="edge">
<title>ring_attn_1_12_stage_10&#45;&gt;ring_attn_1_13_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-12698C9727.02,-12698 9885.86,-12698 9885.86,-12698"/>
<polygon fill="red" stroke="red" points="9885.86,-12701.5 9895.86,-12698 9885.86,-12694.5 9885.86,-12701.5"/>
</g>
<!-- ring_attn_1_12_stage_11&#45;&gt;ring_attn_1_12_stage_12 -->
<g id="edge1203" class="edge">
<title>ring_attn_1_12_stage_11&#45;&gt;ring_attn_1_12_stage_12</title>
<path fill="none" stroke="black" d="M9518,-12376.87C9518,-12376.87 9518,-12270.25 9518,-12270.25"/>
<polygon fill="black" stroke="black" points="9521.5,-12270.25 9518,-12260.25 9514.5,-12270.25 9521.5,-12270.25"/>
</g>
<!-- ring_attn_1_13_stage_11 -->
<g id="node1313" class="node">
<title>ring_attn_1_13_stage_11</title>
<polygon fill="yellow" stroke="black" points="10105,-12513 9896,-12445 10105,-12377 10314,-12445 10105,-12513"/>
<text text-anchor="middle" x="10105" y="-12463.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-12448.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="10105" y="-12433.8" font-family="Times,serif" font-size="14.00">Q[13]×K[2]×V[2]</text>
<text text-anchor="middle" x="10105" y="-12418.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_12_stage_11&#45;&gt;ring_attn_1_13_stage_11 -->
<g id="edge3083" class="edge">
<title>ring_attn_1_12_stage_11&#45;&gt;ring_attn_1_13_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-12445C9727.02,-12445 9885.86,-12445 9885.86,-12445"/>
<polygon fill="red" stroke="red" points="9885.86,-12448.5 9895.86,-12445 9885.86,-12441.5 9885.86,-12448.5"/>
</g>
<!-- ring_attn_1_12_stage_12&#45;&gt;ring_attn_1_12_stage_13 -->
<g id="edge1204" class="edge">
<title>ring_attn_1_12_stage_12&#45;&gt;ring_attn_1_12_stage_13</title>
<path fill="none" stroke="black" d="M9518,-12123.87C9518,-12123.87 9518,-12017.25 9518,-12017.25"/>
<polygon fill="black" stroke="black" points="9521.5,-12017.25 9518,-12007.25 9514.5,-12017.25 9521.5,-12017.25"/>
</g>
<!-- ring_attn_1_13_stage_12 -->
<g id="node1314" class="node">
<title>ring_attn_1_13_stage_12</title>
<polygon fill="yellow" stroke="black" points="10105,-12260 9896,-12192 10105,-12124 10314,-12192 10105,-12260"/>
<text text-anchor="middle" x="10105" y="-12210.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-12195.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="10105" y="-12180.8" font-family="Times,serif" font-size="14.00">Q[13]×K[1]×V[1]</text>
<text text-anchor="middle" x="10105" y="-12165.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_12_stage_12&#45;&gt;ring_attn_1_13_stage_12 -->
<g id="edge3084" class="edge">
<title>ring_attn_1_12_stage_12&#45;&gt;ring_attn_1_13_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-12192C9727.02,-12192 9885.86,-12192 9885.86,-12192"/>
<polygon fill="red" stroke="red" points="9885.86,-12195.5 9895.86,-12192 9885.86,-12188.5 9885.86,-12195.5"/>
</g>
<!-- ring_attn_1_12_stage_13&#45;&gt;ring_attn_1_12_stage_14 -->
<g id="edge1205" class="edge">
<title>ring_attn_1_12_stage_13&#45;&gt;ring_attn_1_12_stage_14</title>
<path fill="none" stroke="black" d="M9518,-11870.87C9518,-11870.87 9518,-11764.25 9518,-11764.25"/>
<polygon fill="black" stroke="black" points="9521.5,-11764.25 9518,-11754.25 9514.5,-11764.25 9521.5,-11764.25"/>
</g>
<!-- ring_attn_1_13_stage_13 -->
<g id="node1315" class="node">
<title>ring_attn_1_13_stage_13</title>
<polygon fill="yellow" stroke="black" points="10105,-12007 9896,-11939 10105,-11871 10314,-11939 10105,-12007"/>
<text text-anchor="middle" x="10105" y="-11957.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-11942.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="10105" y="-11927.8" font-family="Times,serif" font-size="14.00">Q[13]×K[0]×V[0]</text>
<text text-anchor="middle" x="10105" y="-11912.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_12_stage_13&#45;&gt;ring_attn_1_13_stage_13 -->
<g id="edge3085" class="edge">
<title>ring_attn_1_12_stage_13&#45;&gt;ring_attn_1_13_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-11939C9727.02,-11939 9885.86,-11939 9885.86,-11939"/>
<polygon fill="red" stroke="red" points="9885.86,-11942.5 9895.86,-11939 9885.86,-11935.5 9885.86,-11942.5"/>
</g>
<!-- ring_attn_1_12_stage_14&#45;&gt;ring_attn_1_12_stage_15 -->
<g id="edge1206" class="edge">
<title>ring_attn_1_12_stage_14&#45;&gt;ring_attn_1_12_stage_15</title>
<path fill="none" stroke="black" d="M9518,-11617.87C9518,-11617.87 9518,-11511.25 9518,-11511.25"/>
<polygon fill="black" stroke="black" points="9521.5,-11511.25 9518,-11501.25 9514.5,-11511.25 9521.5,-11511.25"/>
</g>
<!-- ring_attn_1_13_stage_14 -->
<g id="node1316" class="node">
<title>ring_attn_1_13_stage_14</title>
<polygon fill="yellow" stroke="black" points="10105,-11754 9896,-11686 10105,-11618 10314,-11686 10105,-11754"/>
<text text-anchor="middle" x="10105" y="-11704.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-11689.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="10105" y="-11674.8" font-family="Times,serif" font-size="14.00">Q[13]×K[15]×V[15]</text>
<text text-anchor="middle" x="10105" y="-11659.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_12_stage_14&#45;&gt;ring_attn_1_13_stage_14 -->
<g id="edge3086" class="edge">
<title>ring_attn_1_12_stage_14&#45;&gt;ring_attn_1_13_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-11686C9727.02,-11686 9885.86,-11686 9885.86,-11686"/>
<polygon fill="red" stroke="red" points="9885.86,-11689.5 9895.86,-11686 9885.86,-11682.5 9885.86,-11689.5"/>
</g>
<!-- attn_out_1_12 -->
<g id="node1220" class="node">
<title>attn_out_1_12</title>
<polygon fill="none" stroke="black" points="9587.5,-11292 9448.5,-11292 9448.5,-11239 9587.5,-11239 9587.5,-11292"/>
<text text-anchor="middle" x="9518" y="-11276.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="9518" y="-11261.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="9518" y="-11246.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_1_12_stage_15&#45;&gt;attn_out_1_12 -->
<g id="edge1207" class="edge">
<title>ring_attn_1_12_stage_15&#45;&gt;attn_out_1_12</title>
<path fill="none" stroke="black" d="M9518,-11364.87C9518,-11364.87 9518,-11302.18 9518,-11302.18"/>
<polygon fill="black" stroke="black" points="9521.5,-11302.18 9518,-11292.18 9514.5,-11302.18 9521.5,-11302.18"/>
</g>
<!-- ring_attn_1_13_stage_15 -->
<g id="node1317" class="node">
<title>ring_attn_1_13_stage_15</title>
<polygon fill="yellow" stroke="black" points="10105,-11501 9896,-11433 10105,-11365 10314,-11433 10105,-11501"/>
<text text-anchor="middle" x="10105" y="-11451.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-11436.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="10105" y="-11421.8" font-family="Times,serif" font-size="14.00">Q[13]×K[14]×V[14]</text>
<text text-anchor="middle" x="10105" y="-11406.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_12_stage_15&#45;&gt;ring_attn_1_13_stage_15 -->
<g id="edge3087" class="edge">
<title>ring_attn_1_12_stage_15&#45;&gt;ring_attn_1_13_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-11433C9727.02,-11433 9885.86,-11433 9885.86,-11433"/>
<polygon fill="red" stroke="red" points="9885.86,-11436.5 9895.86,-11433 9885.86,-11429.5 9885.86,-11436.5"/>
</g>
<!-- attn_residual_1_12 -->
<g id="node1221" class="node">
<title>attn_residual_1_12</title>
<ellipse fill="none" stroke="black" cx="9518" cy="-11139" rx="105.5" ry="27"/>
<text text-anchor="middle" x="9518" y="-11142.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="9518" y="-11127.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_1_12&#45;&gt;attn_residual_1_12 -->
<g id="edge1208" class="edge">
<title>attn_out_1_12&#45;&gt;attn_residual_1_12</title>
<path fill="none" stroke="black" d="M9518,-11238.98C9518,-11238.98 9518,-11176.36 9518,-11176.36"/>
<polygon fill="black" stroke="black" points="9521.5,-11176.36 9518,-11166.36 9514.5,-11176.36 9521.5,-11176.36"/>
</g>
<!-- gate_1_12 -->
<g id="node1222" class="node">
<title>gate_1_12</title>
<ellipse fill="orange" stroke="black" cx="9518" cy="-11001.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="9518" y="-11012.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="9518" y="-10997.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="9518" y="-10982.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_1_12&#45;&gt;gate_1_12 -->
<g id="edge1209" class="edge">
<title>attn_residual_1_12&#45;&gt;gate_1_12</title>
<path fill="none" stroke="black" d="M9553.17,-11113.46C9553.17,-11113.46 9553.17,-11047.01 9553.17,-11047.01"/>
<polygon fill="black" stroke="black" points="9556.67,-11047.01 9553.17,-11037.01 9549.67,-11047.01 9556.67,-11047.01"/>
</g>
<!-- gate_1_12&#45;&gt;expert_1_0_0 -->
<g id="edge3088" class="edge">
<title>gate_1_12&#45;&gt;expert_1_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9482.83,-11037C9482.83,-11068.31 9482.83,-11109 9482.83,-11109 9482.83,-11109 108.7,-11109 108.7,-11109 108.7,-11109 108.7,-10842.17 108.7,-10842.17"/>
<polygon fill="blue" stroke="blue" points="112.2,-10842.17 108.7,-10832.17 105.2,-10842.17 112.2,-10842.17"/>
<text text-anchor="middle" x="40316.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="40316.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU12→GPU0</text>
<text text-anchor="middle" x="40316.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="40316.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_12&#45;&gt;expert_1_1_0 -->
<g id="edge3089" class="edge">
<title>gate_1_12&#45;&gt;expert_1_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9421.67,-10986.09C9421.67,-10949.41 9421.67,-10860 9421.67,-10860 9421.67,-10860 3013.05,-10860 3013.05,-10860 3013.05,-10860 3013.05,-10842.11 3013.05,-10842.11"/>
<polygon fill="blue" stroke="blue" points="3016.55,-10842.11 3013.05,-10832.11 3009.55,-10842.11 3016.55,-10842.11"/>
<text text-anchor="middle" x="40490.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="40490.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU12→GPU1</text>
<text text-anchor="middle" x="40490.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="40490.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_12&#45;&gt;expert_1_2_0 -->
<g id="edge3090" class="edge">
<title>gate_1_12&#45;&gt;expert_1_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9440.02,-10976C9440.02,-10934.52 9440.02,-10857 9440.02,-10857 9440.02,-10857 3628.46,-10857 3628.46,-10857 3628.46,-10857 3628.46,-10842.16 3628.46,-10842.16"/>
<polygon fill="blue" stroke="blue" points="3631.96,-10842.16 3628.46,-10832.16 3624.96,-10842.16 3631.96,-10842.16"/>
<text text-anchor="middle" x="40664.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="40664.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU12→GPU2</text>
<text text-anchor="middle" x="40664.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="40664.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_12&#45;&gt;expert_1_3_0 -->
<g id="edge3091" class="edge">
<title>gate_1_12&#45;&gt;expert_1_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9458.37,-10970.23C9458.37,-10928.28 9458.37,-10859 9458.37,-10859 9458.37,-10859 4222.34,-10859 4222.34,-10859 4222.34,-10859 4222.34,-10842.25 4222.34,-10842.25"/>
<polygon fill="blue" stroke="blue" points="4225.84,-10842.25 4222.34,-10832.25 4218.84,-10842.25 4225.84,-10842.25"/>
<text text-anchor="middle" x="40838.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="40838.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU12→GPU3</text>
<text text-anchor="middle" x="40838.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="40838.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_12&#45;&gt;expert_1_4_0 -->
<g id="edge3092" class="edge">
<title>gate_1_12&#45;&gt;expert_1_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9476.72,-10966.86C9476.72,-10927.01 9476.72,-10867 9476.72,-10867 9476.72,-10867 4827.02,-10867 4827.02,-10867 4827.02,-10867 4827.02,-10842.3 4827.02,-10842.3"/>
<polygon fill="blue" stroke="blue" points="4830.52,-10842.3 4827.02,-10832.3 4823.52,-10842.3 4830.52,-10842.3"/>
<text text-anchor="middle" x="41012.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41012.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU12→GPU4</text>
<text text-anchor="middle" x="41012.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41012.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_12&#45;&gt;expert_1_5_0 -->
<g id="edge3093" class="edge">
<title>gate_1_12&#45;&gt;expert_1_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9495.07,-10964.78C9495.07,-10928.38 9495.07,-10878 9495.07,-10878 9495.07,-10878 5424.07,-10878 5424.07,-10878 5424.07,-10878 5424.07,-10842.08 5424.07,-10842.08"/>
<polygon fill="blue" stroke="blue" points="5427.57,-10842.08 5424.07,-10832.08 5420.57,-10842.08 5427.57,-10842.08"/>
<text text-anchor="middle" x="41186.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41186.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU12→GPU5</text>
<text text-anchor="middle" x="41186.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41186.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_12&#45;&gt;expert_1_6_0 -->
<g id="edge3094" class="edge">
<title>gate_1_12&#45;&gt;expert_1_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9513.41,-10964.02C9513.41,-10930.96 9513.41,-10888 9513.41,-10888 9513.41,-10888 6006.55,-10888 6006.55,-10888 6006.55,-10888 6006.55,-10842.06 6006.55,-10842.06"/>
<polygon fill="blue" stroke="blue" points="6010.05,-10842.06 6006.55,-10832.06 6003.05,-10842.06 6010.05,-10842.06"/>
<text text-anchor="middle" x="41360.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41360.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU12→GPU6</text>
<text text-anchor="middle" x="41360.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41360.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_12&#45;&gt;expert_1_7_0 -->
<g id="edge3095" class="edge">
<title>gate_1_12&#45;&gt;expert_1_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9531.76,-10964.3C9531.76,-10933.93 9531.76,-10896 9531.76,-10896 9531.76,-10896 6598.07,-10896 6598.07,-10896 6598.07,-10896 6598.07,-10842.16 6598.07,-10842.16"/>
<polygon fill="blue" stroke="blue" points="6601.57,-10842.16 6598.07,-10832.16 6594.57,-10842.16 6601.57,-10842.16"/>
<text text-anchor="middle" x="41534.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41534.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU12→GPU7</text>
<text text-anchor="middle" x="41534.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41534.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_12&#45;&gt;expert_1_8_0 -->
<g id="edge3096" class="edge">
<title>gate_1_12&#45;&gt;expert_1_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9550.11,-10965.77C9550.11,-10939.01 9550.11,-10907 9550.11,-10907 9550.11,-10907 7183.76,-10907 7183.76,-10907 7183.76,-10907 7183.76,-10842.17 7183.76,-10842.17"/>
<polygon fill="blue" stroke="blue" points="7187.26,-10842.17 7183.76,-10832.17 7180.26,-10842.17 7187.26,-10842.17"/>
<text text-anchor="middle" x="41708.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41708.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU12→GPU8</text>
<text text-anchor="middle" x="41708.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41708.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_12&#45;&gt;expert_1_9_0 -->
<g id="edge3097" class="edge">
<title>gate_1_12&#45;&gt;expert_1_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9568.46,-10968.42C9568.46,-10943.64 9568.46,-10914 9568.46,-10914 9568.46,-10914 7776.18,-10914 7776.18,-10914 7776.18,-10914 7776.18,-10842.04 7776.18,-10842.04"/>
<polygon fill="blue" stroke="blue" points="7779.68,-10842.04 7776.18,-10832.04 7772.68,-10842.04 7779.68,-10842.04"/>
<text text-anchor="middle" x="41882.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41882.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU12→GPU9</text>
<text text-anchor="middle" x="41882.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41882.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_12&#45;&gt;expert_1_10_0 -->
<g id="edge3098" class="edge">
<title>gate_1_12&#45;&gt;expert_1_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9577.63,-10970.51C9577.63,-10961 9577.63,-10953 9577.63,-10953 9577.63,-10953 8458.5,-10953 8458.5,-10953 8458.5,-10953 8458.5,-10842.21 8458.5,-10842.21"/>
<polygon fill="blue" stroke="blue" points="8462,-10842.21 8458.5,-10832.21 8455,-10842.21 8462,-10842.21"/>
<text text-anchor="middle" x="42056.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42056.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU12→GPU10</text>
<text text-anchor="middle" x="42056.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42056.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_12&#45;&gt;expert_1_11_0 -->
<g id="edge3099" class="edge">
<title>gate_1_12&#45;&gt;expert_1_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9418.3,-11014C9278.46,-11014 9041,-11014 9041,-11014 9041,-11014 9041,-10842.33 9041,-10842.33"/>
<polygon fill="blue" stroke="blue" points="9044.5,-10842.33 9041,-10832.33 9037.5,-10842.33 9044.5,-10842.33"/>
<text text-anchor="middle" x="42230.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42230.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU12→GPU11</text>
<text text-anchor="middle" x="42230.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42230.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_12&#45;&gt;expert_1_12_0 -->
<g id="edge1210" class="edge">
<title>gate_1_12&#45;&gt;expert_1_12_0</title>
<path fill="none" stroke="black" d="M9586.8,-10973C9586.8,-10973 9586.8,-10842.15 9586.8,-10842.15"/>
<polygon fill="black" stroke="black" points="9590.3,-10842.15 9586.8,-10832.15 9583.3,-10842.15 9590.3,-10842.15"/>
</g>
<!-- gate_1_12&#45;&gt;expert_1_13_0 -->
<g id="edge3100" class="edge">
<title>gate_1_12&#45;&gt;expert_1_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9617.65,-10989C9757.77,-10989 9996.12,-10989 9996.12,-10989 9996.12,-10989 9996.12,-10842.18 9996.12,-10842.18"/>
<polygon fill="blue" stroke="blue" points="9999.63,-10842.18 9996.12,-10832.18 9992.63,-10842.18 9999.63,-10842.18"/>
<text text-anchor="middle" x="42404.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42404.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU12→GPU13</text>
<text text-anchor="middle" x="42404.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42404.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_12&#45;&gt;expert_1_14_0 -->
<g id="edge3101" class="edge">
<title>gate_1_12&#45;&gt;expert_1_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9605.15,-10980.26C9605.15,-10966.07 9605.15,-10950 9605.15,-10950 9605.15,-10950 10578.4,-10950 10578.4,-10950 10578.4,-10950 10578.4,-10842 10578.4,-10842"/>
<polygon fill="blue" stroke="blue" points="10581.9,-10842 10578.4,-10832 10574.9,-10842 10581.9,-10842"/>
<text text-anchor="middle" x="42578.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42578.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU12→GPU14</text>
<text text-anchor="middle" x="42578.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42578.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_12&#45;&gt;expert_1_15_0 -->
<g id="edge3102" class="edge">
<title>gate_1_12&#45;&gt;expert_1_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9614.33,-10986.05C9614.33,-10970.88 9614.33,-10950 9614.33,-10950 9614.33,-10950 11163.38,-10950 11163.38,-10950 11163.38,-10950 11163.38,-10842 11163.38,-10842"/>
<polygon fill="blue" stroke="blue" points="11166.88,-10842 11163.38,-10832 11159.88,-10842 11166.88,-10842"/>
<text text-anchor="middle" x="42752.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42752.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU12→GPU15</text>
<text text-anchor="middle" x="42752.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42752.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_12 -->
<g id="node1224" class="node">
<title>expert_reduce_1_12</title>
<ellipse fill="none" stroke="black" cx="9518" cy="-10668.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="9518" y="-10679.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="9518" y="-10664.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="9518" y="-10649.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_12_0&#45;&gt;expert_reduce_1_12 -->
<g id="edge1211" class="edge">
<title>expert_1_12_0&#45;&gt;expert_reduce_1_12</title>
<path fill="none" stroke="black" d="M9518,-10778.76C9518,-10778.76 9518,-10716.06 9518,-10716.06"/>
<polygon fill="black" stroke="black" points="9521.5,-10716.06 9518,-10706.06 9514.5,-10716.06 9521.5,-10716.06"/>
</g>
<!-- moe_residual_1_12 -->
<g id="node1225" class="node">
<title>moe_residual_1_12</title>
<ellipse fill="none" stroke="black" cx="9518" cy="-10531" rx="105.5" ry="27"/>
<text text-anchor="middle" x="9518" y="-10534.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="9518" y="-10519.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_12&#45;&gt;moe_residual_1_12 -->
<g id="edge1212" class="edge">
<title>expert_reduce_1_12&#45;&gt;moe_residual_1_12</title>
<path fill="none" stroke="black" d="M9518,-10630.93C9518,-10630.93 9518,-10568.06 9518,-10568.06"/>
<polygon fill="black" stroke="black" points="9521.5,-10568.06 9518,-10558.06 9514.5,-10568.06 9521.5,-10568.06"/>
</g>
<!-- qkv_proj_2_12 -->
<g id="node1226" class="node">
<title>qkv_proj_2_12</title>
<polygon fill="none" stroke="black" points="9600.5,-10431 9435.5,-10431 9435.5,-10378 9600.5,-10378 9600.5,-10431"/>
<text text-anchor="middle" x="9518" y="-10415.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="9518" y="-10400.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="9518" y="-10385.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_1_12&#45;&gt;qkv_proj_2_12 -->
<g id="edge1213" class="edge">
<title>moe_residual_1_12&#45;&gt;qkv_proj_2_12</title>
<path fill="none" stroke="black" d="M9518,-10503.86C9518,-10503.86 9518,-10441.16 9518,-10441.16"/>
<polygon fill="black" stroke="black" points="9521.5,-10441.16 9518,-10431.16 9514.5,-10441.16 9521.5,-10441.16"/>
</g>
<!-- qkv_reshape_2_12 -->
<g id="node1227" class="node">
<title>qkv_reshape_2_12</title>
<ellipse fill="none" stroke="black" cx="9518" cy="-10278" rx="148" ry="27"/>
<text text-anchor="middle" x="9518" y="-10281.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="9518" y="-10266.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_2_12&#45;&gt;qkv_reshape_2_12 -->
<g id="edge1214" class="edge">
<title>qkv_proj_2_12&#45;&gt;qkv_reshape_2_12</title>
<path fill="none" stroke="black" d="M9518,-10377.98C9518,-10377.98 9518,-10315.36 9518,-10315.36"/>
<polygon fill="black" stroke="black" points="9521.5,-10315.36 9518,-10305.36 9514.5,-10315.36 9521.5,-10315.36"/>
</g>
<!-- qkv_reshape_2_12&#45;&gt;ring_attn_2_12_stage_0 -->
<g id="edge1215" class="edge">
<title>qkv_reshape_2_12&#45;&gt;ring_attn_2_12_stage_0</title>
<path fill="none" stroke="black" d="M9518,-10250.72C9518,-10250.72 9518,-10144.16 9518,-10144.16"/>
<polygon fill="black" stroke="black" points="9521.5,-10144.16 9518,-10134.16 9514.5,-10144.16 9521.5,-10144.16"/>
</g>
<!-- ring_attn_2_12_stage_0&#45;&gt;ring_attn_2_12_stage_1 -->
<g id="edge1216" class="edge">
<title>ring_attn_2_12_stage_0&#45;&gt;ring_attn_2_12_stage_1</title>
<path fill="none" stroke="black" d="M9518,-9997.87C9518,-9997.87 9518,-9891.25 9518,-9891.25"/>
<polygon fill="black" stroke="black" points="9521.5,-9891.25 9518,-9881.25 9514.5,-9891.25 9521.5,-9891.25"/>
</g>
<!-- ring_attn_2_13_stage_0 -->
<g id="node1326" class="node">
<title>ring_attn_2_13_stage_0</title>
<polygon fill="yellow" stroke="black" points="10105,-10134 9896,-10066 10105,-9998 10314,-10066 10105,-10134"/>
<text text-anchor="middle" x="10105" y="-10084.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-10069.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="10105" y="-10054.8" font-family="Times,serif" font-size="14.00">Q[13]×K[13]×V[13]</text>
<text text-anchor="middle" x="10105" y="-10039.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_12_stage_0&#45;&gt;ring_attn_2_13_stage_0 -->
<g id="edge3103" class="edge">
<title>ring_attn_2_12_stage_0&#45;&gt;ring_attn_2_13_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-10066C9727.02,-10066 9885.86,-10066 9885.86,-10066"/>
<polygon fill="red" stroke="red" points="9885.86,-10069.5 9895.86,-10066 9885.86,-10062.5 9885.86,-10069.5"/>
</g>
<!-- ring_attn_2_12_stage_1&#45;&gt;ring_attn_2_12_stage_2 -->
<g id="edge1217" class="edge">
<title>ring_attn_2_12_stage_1&#45;&gt;ring_attn_2_12_stage_2</title>
<path fill="none" stroke="black" d="M9518,-9744.87C9518,-9744.87 9518,-9638.25 9518,-9638.25"/>
<polygon fill="black" stroke="black" points="9521.5,-9638.25 9518,-9628.25 9514.5,-9638.25 9521.5,-9638.25"/>
</g>
<!-- ring_attn_2_13_stage_1 -->
<g id="node1327" class="node">
<title>ring_attn_2_13_stage_1</title>
<polygon fill="yellow" stroke="black" points="10105,-9881 9896,-9813 10105,-9745 10314,-9813 10105,-9881"/>
<text text-anchor="middle" x="10105" y="-9831.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-9816.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="10105" y="-9801.8" font-family="Times,serif" font-size="14.00">Q[13]×K[12]×V[12]</text>
<text text-anchor="middle" x="10105" y="-9786.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_12_stage_1&#45;&gt;ring_attn_2_13_stage_1 -->
<g id="edge3104" class="edge">
<title>ring_attn_2_12_stage_1&#45;&gt;ring_attn_2_13_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-9813C9727.02,-9813 9885.86,-9813 9885.86,-9813"/>
<polygon fill="red" stroke="red" points="9885.86,-9816.5 9895.86,-9813 9885.86,-9809.5 9885.86,-9816.5"/>
</g>
<!-- ring_attn_2_12_stage_2&#45;&gt;ring_attn_2_12_stage_3 -->
<g id="edge1218" class="edge">
<title>ring_attn_2_12_stage_2&#45;&gt;ring_attn_2_12_stage_3</title>
<path fill="none" stroke="black" d="M9518,-9491.87C9518,-9491.87 9518,-9385.25 9518,-9385.25"/>
<polygon fill="black" stroke="black" points="9521.5,-9385.25 9518,-9375.25 9514.5,-9385.25 9521.5,-9385.25"/>
</g>
<!-- ring_attn_2_13_stage_2 -->
<g id="node1328" class="node">
<title>ring_attn_2_13_stage_2</title>
<polygon fill="yellow" stroke="black" points="10105,-9628 9896,-9560 10105,-9492 10314,-9560 10105,-9628"/>
<text text-anchor="middle" x="10105" y="-9578.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-9563.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="10105" y="-9548.8" font-family="Times,serif" font-size="14.00">Q[13]×K[11]×V[11]</text>
<text text-anchor="middle" x="10105" y="-9533.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_12_stage_2&#45;&gt;ring_attn_2_13_stage_2 -->
<g id="edge3105" class="edge">
<title>ring_attn_2_12_stage_2&#45;&gt;ring_attn_2_13_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-9560C9727.02,-9560 9885.86,-9560 9885.86,-9560"/>
<polygon fill="red" stroke="red" points="9885.86,-9563.5 9895.86,-9560 9885.86,-9556.5 9885.86,-9563.5"/>
</g>
<!-- ring_attn_2_12_stage_3&#45;&gt;ring_attn_2_12_stage_4 -->
<g id="edge1219" class="edge">
<title>ring_attn_2_12_stage_3&#45;&gt;ring_attn_2_12_stage_4</title>
<path fill="none" stroke="black" d="M9518,-9238.87C9518,-9238.87 9518,-9132.25 9518,-9132.25"/>
<polygon fill="black" stroke="black" points="9521.5,-9132.25 9518,-9122.25 9514.5,-9132.25 9521.5,-9132.25"/>
</g>
<!-- ring_attn_2_13_stage_3 -->
<g id="node1329" class="node">
<title>ring_attn_2_13_stage_3</title>
<polygon fill="yellow" stroke="black" points="10105,-9375 9896,-9307 10105,-9239 10314,-9307 10105,-9375"/>
<text text-anchor="middle" x="10105" y="-9325.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-9310.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="10105" y="-9295.8" font-family="Times,serif" font-size="14.00">Q[13]×K[10]×V[10]</text>
<text text-anchor="middle" x="10105" y="-9280.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_12_stage_3&#45;&gt;ring_attn_2_13_stage_3 -->
<g id="edge3106" class="edge">
<title>ring_attn_2_12_stage_3&#45;&gt;ring_attn_2_13_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-9307C9727.02,-9307 9885.86,-9307 9885.86,-9307"/>
<polygon fill="red" stroke="red" points="9885.86,-9310.5 9895.86,-9307 9885.86,-9303.5 9885.86,-9310.5"/>
</g>
<!-- ring_attn_2_12_stage_4&#45;&gt;ring_attn_2_12_stage_5 -->
<g id="edge1220" class="edge">
<title>ring_attn_2_12_stage_4&#45;&gt;ring_attn_2_12_stage_5</title>
<path fill="none" stroke="black" d="M9518,-8985.87C9518,-8985.87 9518,-8879.25 9518,-8879.25"/>
<polygon fill="black" stroke="black" points="9521.5,-8879.25 9518,-8869.25 9514.5,-8879.25 9521.5,-8879.25"/>
</g>
<!-- ring_attn_2_13_stage_4 -->
<g id="node1330" class="node">
<title>ring_attn_2_13_stage_4</title>
<polygon fill="yellow" stroke="black" points="10105,-9122 9896,-9054 10105,-8986 10314,-9054 10105,-9122"/>
<text text-anchor="middle" x="10105" y="-9072.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-9057.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="10105" y="-9042.8" font-family="Times,serif" font-size="14.00">Q[13]×K[9]×V[9]</text>
<text text-anchor="middle" x="10105" y="-9027.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_12_stage_4&#45;&gt;ring_attn_2_13_stage_4 -->
<g id="edge3107" class="edge">
<title>ring_attn_2_12_stage_4&#45;&gt;ring_attn_2_13_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-9054C9727.02,-9054 9885.86,-9054 9885.86,-9054"/>
<polygon fill="red" stroke="red" points="9885.86,-9057.5 9895.86,-9054 9885.86,-9050.5 9885.86,-9057.5"/>
</g>
<!-- ring_attn_2_12_stage_5&#45;&gt;ring_attn_2_12_stage_6 -->
<g id="edge1221" class="edge">
<title>ring_attn_2_12_stage_5&#45;&gt;ring_attn_2_12_stage_6</title>
<path fill="none" stroke="black" d="M9518,-8732.87C9518,-8732.87 9518,-8626.25 9518,-8626.25"/>
<polygon fill="black" stroke="black" points="9521.5,-8626.25 9518,-8616.25 9514.5,-8626.25 9521.5,-8626.25"/>
</g>
<!-- ring_attn_2_13_stage_5 -->
<g id="node1331" class="node">
<title>ring_attn_2_13_stage_5</title>
<polygon fill="yellow" stroke="black" points="10105,-8869 9896,-8801 10105,-8733 10314,-8801 10105,-8869"/>
<text text-anchor="middle" x="10105" y="-8819.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-8804.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="10105" y="-8789.8" font-family="Times,serif" font-size="14.00">Q[13]×K[8]×V[8]</text>
<text text-anchor="middle" x="10105" y="-8774.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_12_stage_5&#45;&gt;ring_attn_2_13_stage_5 -->
<g id="edge3108" class="edge">
<title>ring_attn_2_12_stage_5&#45;&gt;ring_attn_2_13_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-8801C9727.02,-8801 9885.86,-8801 9885.86,-8801"/>
<polygon fill="red" stroke="red" points="9885.86,-8804.5 9895.86,-8801 9885.86,-8797.5 9885.86,-8804.5"/>
</g>
<!-- ring_attn_2_12_stage_6&#45;&gt;ring_attn_2_12_stage_7 -->
<g id="edge1222" class="edge">
<title>ring_attn_2_12_stage_6&#45;&gt;ring_attn_2_12_stage_7</title>
<path fill="none" stroke="black" d="M9518,-8479.87C9518,-8479.87 9518,-8373.25 9518,-8373.25"/>
<polygon fill="black" stroke="black" points="9521.5,-8373.25 9518,-8363.25 9514.5,-8373.25 9521.5,-8373.25"/>
</g>
<!-- ring_attn_2_13_stage_6 -->
<g id="node1332" class="node">
<title>ring_attn_2_13_stage_6</title>
<polygon fill="yellow" stroke="black" points="10105,-8616 9896,-8548 10105,-8480 10314,-8548 10105,-8616"/>
<text text-anchor="middle" x="10105" y="-8566.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-8551.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="10105" y="-8536.8" font-family="Times,serif" font-size="14.00">Q[13]×K[7]×V[7]</text>
<text text-anchor="middle" x="10105" y="-8521.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_12_stage_6&#45;&gt;ring_attn_2_13_stage_6 -->
<g id="edge3109" class="edge">
<title>ring_attn_2_12_stage_6&#45;&gt;ring_attn_2_13_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-8548C9727.02,-8548 9885.86,-8548 9885.86,-8548"/>
<polygon fill="red" stroke="red" points="9885.86,-8551.5 9895.86,-8548 9885.86,-8544.5 9885.86,-8551.5"/>
</g>
<!-- ring_attn_2_12_stage_7&#45;&gt;ring_attn_2_12_stage_8 -->
<g id="edge1223" class="edge">
<title>ring_attn_2_12_stage_7&#45;&gt;ring_attn_2_12_stage_8</title>
<path fill="none" stroke="black" d="M9518,-8226.87C9518,-8226.87 9518,-8120.25 9518,-8120.25"/>
<polygon fill="black" stroke="black" points="9521.5,-8120.25 9518,-8110.25 9514.5,-8120.25 9521.5,-8120.25"/>
</g>
<!-- ring_attn_2_13_stage_7 -->
<g id="node1333" class="node">
<title>ring_attn_2_13_stage_7</title>
<polygon fill="yellow" stroke="black" points="10105,-8363 9896,-8295 10105,-8227 10314,-8295 10105,-8363"/>
<text text-anchor="middle" x="10105" y="-8313.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-8298.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="10105" y="-8283.8" font-family="Times,serif" font-size="14.00">Q[13]×K[6]×V[6]</text>
<text text-anchor="middle" x="10105" y="-8268.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_12_stage_7&#45;&gt;ring_attn_2_13_stage_7 -->
<g id="edge3110" class="edge">
<title>ring_attn_2_12_stage_7&#45;&gt;ring_attn_2_13_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-8295C9727.02,-8295 9885.86,-8295 9885.86,-8295"/>
<polygon fill="red" stroke="red" points="9885.86,-8298.5 9895.86,-8295 9885.86,-8291.5 9885.86,-8298.5"/>
</g>
<!-- ring_attn_2_12_stage_8&#45;&gt;ring_attn_2_12_stage_9 -->
<g id="edge1224" class="edge">
<title>ring_attn_2_12_stage_8&#45;&gt;ring_attn_2_12_stage_9</title>
<path fill="none" stroke="black" d="M9518,-7973.87C9518,-7973.87 9518,-7867.25 9518,-7867.25"/>
<polygon fill="black" stroke="black" points="9521.5,-7867.25 9518,-7857.25 9514.5,-7867.25 9521.5,-7867.25"/>
</g>
<!-- ring_attn_2_13_stage_8 -->
<g id="node1334" class="node">
<title>ring_attn_2_13_stage_8</title>
<polygon fill="yellow" stroke="black" points="10105,-8110 9896,-8042 10105,-7974 10314,-8042 10105,-8110"/>
<text text-anchor="middle" x="10105" y="-8060.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-8045.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="10105" y="-8030.8" font-family="Times,serif" font-size="14.00">Q[13]×K[5]×V[5]</text>
<text text-anchor="middle" x="10105" y="-8015.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_12_stage_8&#45;&gt;ring_attn_2_13_stage_8 -->
<g id="edge3111" class="edge">
<title>ring_attn_2_12_stage_8&#45;&gt;ring_attn_2_13_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-8042C9727.02,-8042 9885.86,-8042 9885.86,-8042"/>
<polygon fill="red" stroke="red" points="9885.86,-8045.5 9895.86,-8042 9885.86,-8038.5 9885.86,-8045.5"/>
</g>
<!-- ring_attn_2_12_stage_9&#45;&gt;ring_attn_2_12_stage_10 -->
<g id="edge1225" class="edge">
<title>ring_attn_2_12_stage_9&#45;&gt;ring_attn_2_12_stage_10</title>
<path fill="none" stroke="black" d="M9518,-7720.87C9518,-7720.87 9518,-7614.25 9518,-7614.25"/>
<polygon fill="black" stroke="black" points="9521.5,-7614.25 9518,-7604.25 9514.5,-7614.25 9521.5,-7614.25"/>
</g>
<!-- ring_attn_2_13_stage_9 -->
<g id="node1335" class="node">
<title>ring_attn_2_13_stage_9</title>
<polygon fill="yellow" stroke="black" points="10105,-7857 9896,-7789 10105,-7721 10314,-7789 10105,-7857"/>
<text text-anchor="middle" x="10105" y="-7807.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-7792.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="10105" y="-7777.8" font-family="Times,serif" font-size="14.00">Q[13]×K[4]×V[4]</text>
<text text-anchor="middle" x="10105" y="-7762.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_12_stage_9&#45;&gt;ring_attn_2_13_stage_9 -->
<g id="edge3112" class="edge">
<title>ring_attn_2_12_stage_9&#45;&gt;ring_attn_2_13_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-7789C9727.02,-7789 9885.86,-7789 9885.86,-7789"/>
<polygon fill="red" stroke="red" points="9885.86,-7792.5 9895.86,-7789 9885.86,-7785.5 9885.86,-7792.5"/>
</g>
<!-- ring_attn_2_12_stage_10&#45;&gt;ring_attn_2_12_stage_11 -->
<g id="edge1226" class="edge">
<title>ring_attn_2_12_stage_10&#45;&gt;ring_attn_2_12_stage_11</title>
<path fill="none" stroke="black" d="M9518,-7467.87C9518,-7467.87 9518,-7361.25 9518,-7361.25"/>
<polygon fill="black" stroke="black" points="9521.5,-7361.25 9518,-7351.25 9514.5,-7361.25 9521.5,-7361.25"/>
</g>
<!-- ring_attn_2_13_stage_10 -->
<g id="node1336" class="node">
<title>ring_attn_2_13_stage_10</title>
<polygon fill="yellow" stroke="black" points="10105,-7604 9896,-7536 10105,-7468 10314,-7536 10105,-7604"/>
<text text-anchor="middle" x="10105" y="-7554.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-7539.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="10105" y="-7524.8" font-family="Times,serif" font-size="14.00">Q[13]×K[3]×V[3]</text>
<text text-anchor="middle" x="10105" y="-7509.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_12_stage_10&#45;&gt;ring_attn_2_13_stage_10 -->
<g id="edge3113" class="edge">
<title>ring_attn_2_12_stage_10&#45;&gt;ring_attn_2_13_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-7536C9727.02,-7536 9885.86,-7536 9885.86,-7536"/>
<polygon fill="red" stroke="red" points="9885.86,-7539.5 9895.86,-7536 9885.86,-7532.5 9885.86,-7539.5"/>
</g>
<!-- ring_attn_2_12_stage_11&#45;&gt;ring_attn_2_12_stage_12 -->
<g id="edge1227" class="edge">
<title>ring_attn_2_12_stage_11&#45;&gt;ring_attn_2_12_stage_12</title>
<path fill="none" stroke="black" d="M9518,-7214.87C9518,-7214.87 9518,-7108.25 9518,-7108.25"/>
<polygon fill="black" stroke="black" points="9521.5,-7108.25 9518,-7098.25 9514.5,-7108.25 9521.5,-7108.25"/>
</g>
<!-- ring_attn_2_13_stage_11 -->
<g id="node1337" class="node">
<title>ring_attn_2_13_stage_11</title>
<polygon fill="yellow" stroke="black" points="10105,-7351 9896,-7283 10105,-7215 10314,-7283 10105,-7351"/>
<text text-anchor="middle" x="10105" y="-7301.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-7286.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="10105" y="-7271.8" font-family="Times,serif" font-size="14.00">Q[13]×K[2]×V[2]</text>
<text text-anchor="middle" x="10105" y="-7256.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_12_stage_11&#45;&gt;ring_attn_2_13_stage_11 -->
<g id="edge3114" class="edge">
<title>ring_attn_2_12_stage_11&#45;&gt;ring_attn_2_13_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-7283C9727.02,-7283 9885.86,-7283 9885.86,-7283"/>
<polygon fill="red" stroke="red" points="9885.86,-7286.5 9895.86,-7283 9885.86,-7279.5 9885.86,-7286.5"/>
</g>
<!-- ring_attn_2_12_stage_12&#45;&gt;ring_attn_2_12_stage_13 -->
<g id="edge1228" class="edge">
<title>ring_attn_2_12_stage_12&#45;&gt;ring_attn_2_12_stage_13</title>
<path fill="none" stroke="black" d="M9518,-6961.87C9518,-6961.87 9518,-6855.25 9518,-6855.25"/>
<polygon fill="black" stroke="black" points="9521.5,-6855.25 9518,-6845.25 9514.5,-6855.25 9521.5,-6855.25"/>
</g>
<!-- ring_attn_2_13_stage_12 -->
<g id="node1338" class="node">
<title>ring_attn_2_13_stage_12</title>
<polygon fill="yellow" stroke="black" points="10105,-7098 9896,-7030 10105,-6962 10314,-7030 10105,-7098"/>
<text text-anchor="middle" x="10105" y="-7048.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-7033.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="10105" y="-7018.8" font-family="Times,serif" font-size="14.00">Q[13]×K[1]×V[1]</text>
<text text-anchor="middle" x="10105" y="-7003.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_12_stage_12&#45;&gt;ring_attn_2_13_stage_12 -->
<g id="edge3115" class="edge">
<title>ring_attn_2_12_stage_12&#45;&gt;ring_attn_2_13_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-7030C9727.02,-7030 9885.86,-7030 9885.86,-7030"/>
<polygon fill="red" stroke="red" points="9885.86,-7033.5 9895.86,-7030 9885.86,-7026.5 9885.86,-7033.5"/>
</g>
<!-- ring_attn_2_12_stage_13&#45;&gt;ring_attn_2_12_stage_14 -->
<g id="edge1229" class="edge">
<title>ring_attn_2_12_stage_13&#45;&gt;ring_attn_2_12_stage_14</title>
<path fill="none" stroke="black" d="M9518,-6708.87C9518,-6708.87 9518,-6602.25 9518,-6602.25"/>
<polygon fill="black" stroke="black" points="9521.5,-6602.25 9518,-6592.25 9514.5,-6602.25 9521.5,-6602.25"/>
</g>
<!-- ring_attn_2_13_stage_13 -->
<g id="node1339" class="node">
<title>ring_attn_2_13_stage_13</title>
<polygon fill="yellow" stroke="black" points="10105,-6845 9896,-6777 10105,-6709 10314,-6777 10105,-6845"/>
<text text-anchor="middle" x="10105" y="-6795.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-6780.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="10105" y="-6765.8" font-family="Times,serif" font-size="14.00">Q[13]×K[0]×V[0]</text>
<text text-anchor="middle" x="10105" y="-6750.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_12_stage_13&#45;&gt;ring_attn_2_13_stage_13 -->
<g id="edge3116" class="edge">
<title>ring_attn_2_12_stage_13&#45;&gt;ring_attn_2_13_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-6777C9727.02,-6777 9885.86,-6777 9885.86,-6777"/>
<polygon fill="red" stroke="red" points="9885.86,-6780.5 9895.86,-6777 9885.86,-6773.5 9885.86,-6780.5"/>
</g>
<!-- ring_attn_2_12_stage_14&#45;&gt;ring_attn_2_12_stage_15 -->
<g id="edge1230" class="edge">
<title>ring_attn_2_12_stage_14&#45;&gt;ring_attn_2_12_stage_15</title>
<path fill="none" stroke="black" d="M9518,-6455.87C9518,-6455.87 9518,-6349.25 9518,-6349.25"/>
<polygon fill="black" stroke="black" points="9521.5,-6349.25 9518,-6339.25 9514.5,-6349.25 9521.5,-6349.25"/>
</g>
<!-- ring_attn_2_13_stage_14 -->
<g id="node1340" class="node">
<title>ring_attn_2_13_stage_14</title>
<polygon fill="yellow" stroke="black" points="10105,-6592 9896,-6524 10105,-6456 10314,-6524 10105,-6592"/>
<text text-anchor="middle" x="10105" y="-6542.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-6527.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="10105" y="-6512.8" font-family="Times,serif" font-size="14.00">Q[13]×K[15]×V[15]</text>
<text text-anchor="middle" x="10105" y="-6497.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_12_stage_14&#45;&gt;ring_attn_2_13_stage_14 -->
<g id="edge3117" class="edge">
<title>ring_attn_2_12_stage_14&#45;&gt;ring_attn_2_13_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-6524C9727.02,-6524 9885.86,-6524 9885.86,-6524"/>
<polygon fill="red" stroke="red" points="9885.86,-6527.5 9895.86,-6524 9885.86,-6520.5 9885.86,-6527.5"/>
</g>
<!-- attn_out_2_12 -->
<g id="node1244" class="node">
<title>attn_out_2_12</title>
<polygon fill="none" stroke="black" points="9587.5,-6130 9448.5,-6130 9448.5,-6077 9587.5,-6077 9587.5,-6130"/>
<text text-anchor="middle" x="9518" y="-6114.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="9518" y="-6099.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="9518" y="-6084.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_2_12_stage_15&#45;&gt;attn_out_2_12 -->
<g id="edge1231" class="edge">
<title>ring_attn_2_12_stage_15&#45;&gt;attn_out_2_12</title>
<path fill="none" stroke="black" d="M9518,-6202.87C9518,-6202.87 9518,-6140.18 9518,-6140.18"/>
<polygon fill="black" stroke="black" points="9521.5,-6140.18 9518,-6130.18 9514.5,-6140.18 9521.5,-6140.18"/>
</g>
<!-- ring_attn_2_13_stage_15 -->
<g id="node1341" class="node">
<title>ring_attn_2_13_stage_15</title>
<polygon fill="yellow" stroke="black" points="10105,-6339 9896,-6271 10105,-6203 10314,-6271 10105,-6339"/>
<text text-anchor="middle" x="10105" y="-6289.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-6274.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="10105" y="-6259.8" font-family="Times,serif" font-size="14.00">Q[13]×K[14]×V[14]</text>
<text text-anchor="middle" x="10105" y="-6244.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_12_stage_15&#45;&gt;ring_attn_2_13_stage_15 -->
<g id="edge3118" class="edge">
<title>ring_attn_2_12_stage_15&#45;&gt;ring_attn_2_13_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-6271C9727.02,-6271 9885.86,-6271 9885.86,-6271"/>
<polygon fill="red" stroke="red" points="9885.86,-6274.5 9895.86,-6271 9885.86,-6267.5 9885.86,-6274.5"/>
</g>
<!-- attn_residual_2_12 -->
<g id="node1245" class="node">
<title>attn_residual_2_12</title>
<ellipse fill="none" stroke="black" cx="9518" cy="-5977" rx="105.5" ry="27"/>
<text text-anchor="middle" x="9518" y="-5980.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="9518" y="-5965.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_2_12&#45;&gt;attn_residual_2_12 -->
<g id="edge1232" class="edge">
<title>attn_out_2_12&#45;&gt;attn_residual_2_12</title>
<path fill="none" stroke="black" d="M9518,-6076.98C9518,-6076.98 9518,-6014.36 9518,-6014.36"/>
<polygon fill="black" stroke="black" points="9521.5,-6014.36 9518,-6004.36 9514.5,-6014.36 9521.5,-6014.36"/>
</g>
<!-- gate_2_12 -->
<g id="node1246" class="node">
<title>gate_2_12</title>
<ellipse fill="orange" stroke="black" cx="9518" cy="-5839.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="9518" y="-5850.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="9518" y="-5835.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="9518" y="-5820.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_2_12&#45;&gt;gate_2_12 -->
<g id="edge1233" class="edge">
<title>attn_residual_2_12&#45;&gt;gate_2_12</title>
<path fill="none" stroke="black" d="M9553.17,-5951.46C9553.17,-5951.46 9553.17,-5885.01 9553.17,-5885.01"/>
<polygon fill="black" stroke="black" points="9556.67,-5885.01 9553.17,-5875.01 9549.67,-5885.01 9556.67,-5885.01"/>
</g>
<!-- gate_2_12&#45;&gt;expert_2_0_0 -->
<g id="edge3119" class="edge">
<title>gate_2_12&#45;&gt;expert_2_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9482.83,-5875C9482.83,-5906.31 9482.83,-5947 9482.83,-5947 9482.83,-5947 108.7,-5947 108.7,-5947 108.7,-5947 108.7,-5680.17 108.7,-5680.17"/>
<polygon fill="blue" stroke="blue" points="112.2,-5680.17 108.7,-5670.17 105.2,-5680.17 112.2,-5680.17"/>
<text text-anchor="middle" x="40316.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="40316.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU12→GPU0</text>
<text text-anchor="middle" x="40316.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="40316.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_12&#45;&gt;expert_2_1_0 -->
<g id="edge3120" class="edge">
<title>gate_2_12&#45;&gt;expert_2_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9421.67,-5824.09C9421.67,-5787.41 9421.67,-5698 9421.67,-5698 9421.67,-5698 3013.05,-5698 3013.05,-5698 3013.05,-5698 3013.05,-5680.11 3013.05,-5680.11"/>
<polygon fill="blue" stroke="blue" points="3016.55,-5680.11 3013.05,-5670.11 3009.55,-5680.11 3016.55,-5680.11"/>
<text text-anchor="middle" x="40490.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="40490.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU12→GPU1</text>
<text text-anchor="middle" x="40490.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="40490.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_12&#45;&gt;expert_2_2_0 -->
<g id="edge3121" class="edge">
<title>gate_2_12&#45;&gt;expert_2_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9440.02,-5814C9440.02,-5772.52 9440.02,-5695 9440.02,-5695 9440.02,-5695 3628.46,-5695 3628.46,-5695 3628.46,-5695 3628.46,-5680.16 3628.46,-5680.16"/>
<polygon fill="blue" stroke="blue" points="3631.96,-5680.16 3628.46,-5670.16 3624.96,-5680.16 3631.96,-5680.16"/>
<text text-anchor="middle" x="40664.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="40664.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU12→GPU2</text>
<text text-anchor="middle" x="40664.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="40664.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_12&#45;&gt;expert_2_3_0 -->
<g id="edge3122" class="edge">
<title>gate_2_12&#45;&gt;expert_2_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9458.37,-5808.23C9458.37,-5766.28 9458.37,-5697 9458.37,-5697 9458.37,-5697 4222.34,-5697 4222.34,-5697 4222.34,-5697 4222.34,-5680.25 4222.34,-5680.25"/>
<polygon fill="blue" stroke="blue" points="4225.84,-5680.25 4222.34,-5670.25 4218.84,-5680.25 4225.84,-5680.25"/>
<text text-anchor="middle" x="40838.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="40838.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU12→GPU3</text>
<text text-anchor="middle" x="40838.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="40838.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_12&#45;&gt;expert_2_4_0 -->
<g id="edge3123" class="edge">
<title>gate_2_12&#45;&gt;expert_2_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9476.72,-5804.86C9476.72,-5765.01 9476.72,-5705 9476.72,-5705 9476.72,-5705 4827.02,-5705 4827.02,-5705 4827.02,-5705 4827.02,-5680.3 4827.02,-5680.3"/>
<polygon fill="blue" stroke="blue" points="4830.52,-5680.3 4827.02,-5670.3 4823.52,-5680.3 4830.52,-5680.3"/>
<text text-anchor="middle" x="41012.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41012.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU12→GPU4</text>
<text text-anchor="middle" x="41012.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41012.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_12&#45;&gt;expert_2_5_0 -->
<g id="edge3124" class="edge">
<title>gate_2_12&#45;&gt;expert_2_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9495.07,-5802.78C9495.07,-5766.38 9495.07,-5716 9495.07,-5716 9495.07,-5716 5424.07,-5716 5424.07,-5716 5424.07,-5716 5424.07,-5680.08 5424.07,-5680.08"/>
<polygon fill="blue" stroke="blue" points="5427.57,-5680.08 5424.07,-5670.08 5420.57,-5680.08 5427.57,-5680.08"/>
<text text-anchor="middle" x="41186.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41186.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU12→GPU5</text>
<text text-anchor="middle" x="41186.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41186.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_12&#45;&gt;expert_2_6_0 -->
<g id="edge3125" class="edge">
<title>gate_2_12&#45;&gt;expert_2_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9513.41,-5802.02C9513.41,-5768.96 9513.41,-5726 9513.41,-5726 9513.41,-5726 6006.55,-5726 6006.55,-5726 6006.55,-5726 6006.55,-5680.06 6006.55,-5680.06"/>
<polygon fill="blue" stroke="blue" points="6010.05,-5680.06 6006.55,-5670.06 6003.05,-5680.06 6010.05,-5680.06"/>
<text text-anchor="middle" x="41360.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41360.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU12→GPU6</text>
<text text-anchor="middle" x="41360.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41360.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_12&#45;&gt;expert_2_7_0 -->
<g id="edge3126" class="edge">
<title>gate_2_12&#45;&gt;expert_2_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9531.76,-5802.3C9531.76,-5771.93 9531.76,-5734 9531.76,-5734 9531.76,-5734 6598.07,-5734 6598.07,-5734 6598.07,-5734 6598.07,-5680.16 6598.07,-5680.16"/>
<polygon fill="blue" stroke="blue" points="6601.57,-5680.16 6598.07,-5670.16 6594.57,-5680.16 6601.57,-5680.16"/>
<text text-anchor="middle" x="41534.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41534.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU12→GPU7</text>
<text text-anchor="middle" x="41534.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41534.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_12&#45;&gt;expert_2_8_0 -->
<g id="edge3127" class="edge">
<title>gate_2_12&#45;&gt;expert_2_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9550.11,-5803.77C9550.11,-5777.01 9550.11,-5745 9550.11,-5745 9550.11,-5745 7183.76,-5745 7183.76,-5745 7183.76,-5745 7183.76,-5680.17 7183.76,-5680.17"/>
<polygon fill="blue" stroke="blue" points="7187.26,-5680.17 7183.76,-5670.17 7180.26,-5680.17 7187.26,-5680.17"/>
<text text-anchor="middle" x="41708.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41708.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU12→GPU8</text>
<text text-anchor="middle" x="41708.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41708.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_12&#45;&gt;expert_2_9_0 -->
<g id="edge3128" class="edge">
<title>gate_2_12&#45;&gt;expert_2_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9568.46,-5806.42C9568.46,-5781.64 9568.46,-5752 9568.46,-5752 9568.46,-5752 7776.18,-5752 7776.18,-5752 7776.18,-5752 7776.18,-5680.04 7776.18,-5680.04"/>
<polygon fill="blue" stroke="blue" points="7779.68,-5680.04 7776.18,-5670.04 7772.68,-5680.04 7779.68,-5680.04"/>
<text text-anchor="middle" x="41882.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41882.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU12→GPU9</text>
<text text-anchor="middle" x="41882.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41882.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_12&#45;&gt;expert_2_10_0 -->
<g id="edge3129" class="edge">
<title>gate_2_12&#45;&gt;expert_2_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9577.63,-5808.51C9577.63,-5799 9577.63,-5791 9577.63,-5791 9577.63,-5791 8458.5,-5791 8458.5,-5791 8458.5,-5791 8458.5,-5680.21 8458.5,-5680.21"/>
<polygon fill="blue" stroke="blue" points="8462,-5680.21 8458.5,-5670.21 8455,-5680.21 8462,-5680.21"/>
<text text-anchor="middle" x="42056.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42056.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU12→GPU10</text>
<text text-anchor="middle" x="42056.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42056.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_12&#45;&gt;expert_2_11_0 -->
<g id="edge3130" class="edge">
<title>gate_2_12&#45;&gt;expert_2_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9418.3,-5852C9278.46,-5852 9041,-5852 9041,-5852 9041,-5852 9041,-5680.33 9041,-5680.33"/>
<polygon fill="blue" stroke="blue" points="9044.5,-5680.33 9041,-5670.33 9037.5,-5680.33 9044.5,-5680.33"/>
<text text-anchor="middle" x="42230.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42230.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU12→GPU11</text>
<text text-anchor="middle" x="42230.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42230.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_12&#45;&gt;expert_2_12_0 -->
<g id="edge1234" class="edge">
<title>gate_2_12&#45;&gt;expert_2_12_0</title>
<path fill="none" stroke="black" d="M9586.8,-5811C9586.8,-5811 9586.8,-5680.15 9586.8,-5680.15"/>
<polygon fill="black" stroke="black" points="9590.3,-5680.15 9586.8,-5670.15 9583.3,-5680.15 9590.3,-5680.15"/>
</g>
<!-- gate_2_12&#45;&gt;expert_2_13_0 -->
<g id="edge3131" class="edge">
<title>gate_2_12&#45;&gt;expert_2_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9617.65,-5827C9757.77,-5827 9996.12,-5827 9996.12,-5827 9996.12,-5827 9996.12,-5680.18 9996.12,-5680.18"/>
<polygon fill="blue" stroke="blue" points="9999.63,-5680.18 9996.12,-5670.18 9992.63,-5680.18 9999.63,-5680.18"/>
<text text-anchor="middle" x="42404.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42404.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU12→GPU13</text>
<text text-anchor="middle" x="42404.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42404.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_12&#45;&gt;expert_2_14_0 -->
<g id="edge3132" class="edge">
<title>gate_2_12&#45;&gt;expert_2_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9605.15,-5818.26C9605.15,-5804.07 9605.15,-5788 9605.15,-5788 9605.15,-5788 10578.4,-5788 10578.4,-5788 10578.4,-5788 10578.4,-5680 10578.4,-5680"/>
<polygon fill="blue" stroke="blue" points="10581.9,-5680 10578.4,-5670 10574.9,-5680 10581.9,-5680"/>
<text text-anchor="middle" x="42578.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42578.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU12→GPU14</text>
<text text-anchor="middle" x="42578.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42578.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_12&#45;&gt;expert_2_15_0 -->
<g id="edge3133" class="edge">
<title>gate_2_12&#45;&gt;expert_2_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9614.33,-5824.05C9614.33,-5808.88 9614.33,-5788 9614.33,-5788 9614.33,-5788 11163.38,-5788 11163.38,-5788 11163.38,-5788 11163.38,-5680 11163.38,-5680"/>
<polygon fill="blue" stroke="blue" points="11166.88,-5680 11163.38,-5670 11159.88,-5680 11166.88,-5680"/>
<text text-anchor="middle" x="42752.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42752.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU12→GPU15</text>
<text text-anchor="middle" x="42752.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42752.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_12 -->
<g id="node1248" class="node">
<title>expert_reduce_2_12</title>
<ellipse fill="none" stroke="black" cx="9518" cy="-5506.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="9518" y="-5517.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="9518" y="-5502.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="9518" y="-5487.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_12_0&#45;&gt;expert_reduce_2_12 -->
<g id="edge1235" class="edge">
<title>expert_2_12_0&#45;&gt;expert_reduce_2_12</title>
<path fill="none" stroke="black" d="M9518,-5616.76C9518,-5616.76 9518,-5554.06 9518,-5554.06"/>
<polygon fill="black" stroke="black" points="9521.5,-5554.06 9518,-5544.06 9514.5,-5554.06 9521.5,-5554.06"/>
</g>
<!-- moe_residual_2_12 -->
<g id="node1249" class="node">
<title>moe_residual_2_12</title>
<ellipse fill="none" stroke="black" cx="9518" cy="-5369" rx="105.5" ry="27"/>
<text text-anchor="middle" x="9518" y="-5372.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="9518" y="-5357.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_12&#45;&gt;moe_residual_2_12 -->
<g id="edge1236" class="edge">
<title>expert_reduce_2_12&#45;&gt;moe_residual_2_12</title>
<path fill="none" stroke="black" d="M9518,-5468.93C9518,-5468.93 9518,-5406.06 9518,-5406.06"/>
<polygon fill="black" stroke="black" points="9521.5,-5406.06 9518,-5396.06 9514.5,-5406.06 9521.5,-5406.06"/>
</g>
<!-- qkv_proj_3_12 -->
<g id="node1250" class="node">
<title>qkv_proj_3_12</title>
<polygon fill="none" stroke="black" points="9600.5,-5269 9435.5,-5269 9435.5,-5216 9600.5,-5216 9600.5,-5269"/>
<text text-anchor="middle" x="9518" y="-5253.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="9518" y="-5238.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="9518" y="-5223.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_2_12&#45;&gt;qkv_proj_3_12 -->
<g id="edge1237" class="edge">
<title>moe_residual_2_12&#45;&gt;qkv_proj_3_12</title>
<path fill="none" stroke="black" d="M9518,-5341.86C9518,-5341.86 9518,-5279.16 9518,-5279.16"/>
<polygon fill="black" stroke="black" points="9521.5,-5279.16 9518,-5269.16 9514.5,-5279.16 9521.5,-5279.16"/>
</g>
<!-- qkv_reshape_3_12 -->
<g id="node1251" class="node">
<title>qkv_reshape_3_12</title>
<ellipse fill="none" stroke="black" cx="9518" cy="-5116" rx="148" ry="27"/>
<text text-anchor="middle" x="9518" y="-5119.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="9518" y="-5104.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_3_12&#45;&gt;qkv_reshape_3_12 -->
<g id="edge1238" class="edge">
<title>qkv_proj_3_12&#45;&gt;qkv_reshape_3_12</title>
<path fill="none" stroke="black" d="M9518,-5215.98C9518,-5215.98 9518,-5153.36 9518,-5153.36"/>
<polygon fill="black" stroke="black" points="9521.5,-5153.36 9518,-5143.36 9514.5,-5153.36 9521.5,-5153.36"/>
</g>
<!-- qkv_reshape_3_12&#45;&gt;ring_attn_3_12_stage_0 -->
<g id="edge1239" class="edge">
<title>qkv_reshape_3_12&#45;&gt;ring_attn_3_12_stage_0</title>
<path fill="none" stroke="black" d="M9518,-5088.72C9518,-5088.72 9518,-4982.16 9518,-4982.16"/>
<polygon fill="black" stroke="black" points="9521.5,-4982.16 9518,-4972.16 9514.5,-4982.16 9521.5,-4982.16"/>
</g>
<!-- ring_attn_3_12_stage_0&#45;&gt;ring_attn_3_12_stage_1 -->
<g id="edge1240" class="edge">
<title>ring_attn_3_12_stage_0&#45;&gt;ring_attn_3_12_stage_1</title>
<path fill="none" stroke="black" d="M9518,-4835.87C9518,-4835.87 9518,-4729.25 9518,-4729.25"/>
<polygon fill="black" stroke="black" points="9521.5,-4729.25 9518,-4719.25 9514.5,-4729.25 9521.5,-4729.25"/>
</g>
<!-- ring_attn_3_13_stage_0 -->
<g id="node1350" class="node">
<title>ring_attn_3_13_stage_0</title>
<polygon fill="yellow" stroke="black" points="10105,-4972 9896,-4904 10105,-4836 10314,-4904 10105,-4972"/>
<text text-anchor="middle" x="10105" y="-4922.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-4907.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="10105" y="-4892.8" font-family="Times,serif" font-size="14.00">Q[13]×K[13]×V[13]</text>
<text text-anchor="middle" x="10105" y="-4877.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_12_stage_0&#45;&gt;ring_attn_3_13_stage_0 -->
<g id="edge3134" class="edge">
<title>ring_attn_3_12_stage_0&#45;&gt;ring_attn_3_13_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-4904C9727.02,-4904 9885.86,-4904 9885.86,-4904"/>
<polygon fill="red" stroke="red" points="9885.86,-4907.5 9895.86,-4904 9885.86,-4900.5 9885.86,-4907.5"/>
</g>
<!-- ring_attn_3_12_stage_1&#45;&gt;ring_attn_3_12_stage_2 -->
<g id="edge1241" class="edge">
<title>ring_attn_3_12_stage_1&#45;&gt;ring_attn_3_12_stage_2</title>
<path fill="none" stroke="black" d="M9518,-4582.87C9518,-4582.87 9518,-4476.25 9518,-4476.25"/>
<polygon fill="black" stroke="black" points="9521.5,-4476.25 9518,-4466.25 9514.5,-4476.25 9521.5,-4476.25"/>
</g>
<!-- ring_attn_3_13_stage_1 -->
<g id="node1351" class="node">
<title>ring_attn_3_13_stage_1</title>
<polygon fill="yellow" stroke="black" points="10105,-4719 9896,-4651 10105,-4583 10314,-4651 10105,-4719"/>
<text text-anchor="middle" x="10105" y="-4669.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-4654.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="10105" y="-4639.8" font-family="Times,serif" font-size="14.00">Q[13]×K[12]×V[12]</text>
<text text-anchor="middle" x="10105" y="-4624.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_12_stage_1&#45;&gt;ring_attn_3_13_stage_1 -->
<g id="edge3135" class="edge">
<title>ring_attn_3_12_stage_1&#45;&gt;ring_attn_3_13_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-4651C9727.02,-4651 9885.86,-4651 9885.86,-4651"/>
<polygon fill="red" stroke="red" points="9885.86,-4654.5 9895.86,-4651 9885.86,-4647.5 9885.86,-4654.5"/>
</g>
<!-- ring_attn_3_12_stage_2&#45;&gt;ring_attn_3_12_stage_3 -->
<g id="edge1242" class="edge">
<title>ring_attn_3_12_stage_2&#45;&gt;ring_attn_3_12_stage_3</title>
<path fill="none" stroke="black" d="M9518,-4329.87C9518,-4329.87 9518,-4223.25 9518,-4223.25"/>
<polygon fill="black" stroke="black" points="9521.5,-4223.25 9518,-4213.25 9514.5,-4223.25 9521.5,-4223.25"/>
</g>
<!-- ring_attn_3_13_stage_2 -->
<g id="node1352" class="node">
<title>ring_attn_3_13_stage_2</title>
<polygon fill="yellow" stroke="black" points="10105,-4466 9896,-4398 10105,-4330 10314,-4398 10105,-4466"/>
<text text-anchor="middle" x="10105" y="-4416.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-4401.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="10105" y="-4386.8" font-family="Times,serif" font-size="14.00">Q[13]×K[11]×V[11]</text>
<text text-anchor="middle" x="10105" y="-4371.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_12_stage_2&#45;&gt;ring_attn_3_13_stage_2 -->
<g id="edge3136" class="edge">
<title>ring_attn_3_12_stage_2&#45;&gt;ring_attn_3_13_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-4398C9727.02,-4398 9885.86,-4398 9885.86,-4398"/>
<polygon fill="red" stroke="red" points="9885.86,-4401.5 9895.86,-4398 9885.86,-4394.5 9885.86,-4401.5"/>
</g>
<!-- ring_attn_3_12_stage_3&#45;&gt;ring_attn_3_12_stage_4 -->
<g id="edge1243" class="edge">
<title>ring_attn_3_12_stage_3&#45;&gt;ring_attn_3_12_stage_4</title>
<path fill="none" stroke="black" d="M9518,-4076.87C9518,-4076.87 9518,-3970.25 9518,-3970.25"/>
<polygon fill="black" stroke="black" points="9521.5,-3970.25 9518,-3960.25 9514.5,-3970.25 9521.5,-3970.25"/>
</g>
<!-- ring_attn_3_13_stage_3 -->
<g id="node1353" class="node">
<title>ring_attn_3_13_stage_3</title>
<polygon fill="yellow" stroke="black" points="10105,-4213 9896,-4145 10105,-4077 10314,-4145 10105,-4213"/>
<text text-anchor="middle" x="10105" y="-4163.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-4148.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="10105" y="-4133.8" font-family="Times,serif" font-size="14.00">Q[13]×K[10]×V[10]</text>
<text text-anchor="middle" x="10105" y="-4118.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_12_stage_3&#45;&gt;ring_attn_3_13_stage_3 -->
<g id="edge3137" class="edge">
<title>ring_attn_3_12_stage_3&#45;&gt;ring_attn_3_13_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-4145C9727.02,-4145 9885.86,-4145 9885.86,-4145"/>
<polygon fill="red" stroke="red" points="9885.86,-4148.5 9895.86,-4145 9885.86,-4141.5 9885.86,-4148.5"/>
</g>
<!-- ring_attn_3_12_stage_4&#45;&gt;ring_attn_3_12_stage_5 -->
<g id="edge1244" class="edge">
<title>ring_attn_3_12_stage_4&#45;&gt;ring_attn_3_12_stage_5</title>
<path fill="none" stroke="black" d="M9518,-3823.87C9518,-3823.87 9518,-3717.25 9518,-3717.25"/>
<polygon fill="black" stroke="black" points="9521.5,-3717.25 9518,-3707.25 9514.5,-3717.25 9521.5,-3717.25"/>
</g>
<!-- ring_attn_3_13_stage_4 -->
<g id="node1354" class="node">
<title>ring_attn_3_13_stage_4</title>
<polygon fill="yellow" stroke="black" points="10105,-3960 9896,-3892 10105,-3824 10314,-3892 10105,-3960"/>
<text text-anchor="middle" x="10105" y="-3910.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-3895.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="10105" y="-3880.8" font-family="Times,serif" font-size="14.00">Q[13]×K[9]×V[9]</text>
<text text-anchor="middle" x="10105" y="-3865.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_12_stage_4&#45;&gt;ring_attn_3_13_stage_4 -->
<g id="edge3138" class="edge">
<title>ring_attn_3_12_stage_4&#45;&gt;ring_attn_3_13_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-3892C9727.02,-3892 9885.86,-3892 9885.86,-3892"/>
<polygon fill="red" stroke="red" points="9885.86,-3895.5 9895.86,-3892 9885.86,-3888.5 9885.86,-3895.5"/>
</g>
<!-- ring_attn_3_12_stage_5&#45;&gt;ring_attn_3_12_stage_6 -->
<g id="edge1245" class="edge">
<title>ring_attn_3_12_stage_5&#45;&gt;ring_attn_3_12_stage_6</title>
<path fill="none" stroke="black" d="M9518,-3570.87C9518,-3570.87 9518,-3464.25 9518,-3464.25"/>
<polygon fill="black" stroke="black" points="9521.5,-3464.25 9518,-3454.25 9514.5,-3464.25 9521.5,-3464.25"/>
</g>
<!-- ring_attn_3_13_stage_5 -->
<g id="node1355" class="node">
<title>ring_attn_3_13_stage_5</title>
<polygon fill="yellow" stroke="black" points="10105,-3707 9896,-3639 10105,-3571 10314,-3639 10105,-3707"/>
<text text-anchor="middle" x="10105" y="-3657.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-3642.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="10105" y="-3627.8" font-family="Times,serif" font-size="14.00">Q[13]×K[8]×V[8]</text>
<text text-anchor="middle" x="10105" y="-3612.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_12_stage_5&#45;&gt;ring_attn_3_13_stage_5 -->
<g id="edge3139" class="edge">
<title>ring_attn_3_12_stage_5&#45;&gt;ring_attn_3_13_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-3639C9727.02,-3639 9885.86,-3639 9885.86,-3639"/>
<polygon fill="red" stroke="red" points="9885.86,-3642.5 9895.86,-3639 9885.86,-3635.5 9885.86,-3642.5"/>
</g>
<!-- ring_attn_3_12_stage_6&#45;&gt;ring_attn_3_12_stage_7 -->
<g id="edge1246" class="edge">
<title>ring_attn_3_12_stage_6&#45;&gt;ring_attn_3_12_stage_7</title>
<path fill="none" stroke="black" d="M9518,-3317.87C9518,-3317.87 9518,-3211.25 9518,-3211.25"/>
<polygon fill="black" stroke="black" points="9521.5,-3211.25 9518,-3201.25 9514.5,-3211.25 9521.5,-3211.25"/>
</g>
<!-- ring_attn_3_13_stage_6 -->
<g id="node1356" class="node">
<title>ring_attn_3_13_stage_6</title>
<polygon fill="yellow" stroke="black" points="10105,-3454 9896,-3386 10105,-3318 10314,-3386 10105,-3454"/>
<text text-anchor="middle" x="10105" y="-3404.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-3389.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="10105" y="-3374.8" font-family="Times,serif" font-size="14.00">Q[13]×K[7]×V[7]</text>
<text text-anchor="middle" x="10105" y="-3359.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_12_stage_6&#45;&gt;ring_attn_3_13_stage_6 -->
<g id="edge3140" class="edge">
<title>ring_attn_3_12_stage_6&#45;&gt;ring_attn_3_13_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-3386C9727.02,-3386 9885.86,-3386 9885.86,-3386"/>
<polygon fill="red" stroke="red" points="9885.86,-3389.5 9895.86,-3386 9885.86,-3382.5 9885.86,-3389.5"/>
</g>
<!-- ring_attn_3_12_stage_7&#45;&gt;ring_attn_3_12_stage_8 -->
<g id="edge1247" class="edge">
<title>ring_attn_3_12_stage_7&#45;&gt;ring_attn_3_12_stage_8</title>
<path fill="none" stroke="black" d="M9518,-3064.87C9518,-3064.87 9518,-2958.25 9518,-2958.25"/>
<polygon fill="black" stroke="black" points="9521.5,-2958.25 9518,-2948.25 9514.5,-2958.25 9521.5,-2958.25"/>
</g>
<!-- ring_attn_3_13_stage_7 -->
<g id="node1357" class="node">
<title>ring_attn_3_13_stage_7</title>
<polygon fill="yellow" stroke="black" points="10105,-3201 9896,-3133 10105,-3065 10314,-3133 10105,-3201"/>
<text text-anchor="middle" x="10105" y="-3151.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-3136.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="10105" y="-3121.8" font-family="Times,serif" font-size="14.00">Q[13]×K[6]×V[6]</text>
<text text-anchor="middle" x="10105" y="-3106.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_12_stage_7&#45;&gt;ring_attn_3_13_stage_7 -->
<g id="edge3141" class="edge">
<title>ring_attn_3_12_stage_7&#45;&gt;ring_attn_3_13_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-3133C9727.02,-3133 9885.86,-3133 9885.86,-3133"/>
<polygon fill="red" stroke="red" points="9885.86,-3136.5 9895.86,-3133 9885.86,-3129.5 9885.86,-3136.5"/>
</g>
<!-- ring_attn_3_12_stage_8&#45;&gt;ring_attn_3_12_stage_9 -->
<g id="edge1248" class="edge">
<title>ring_attn_3_12_stage_8&#45;&gt;ring_attn_3_12_stage_9</title>
<path fill="none" stroke="black" d="M9518,-2811.87C9518,-2811.87 9518,-2705.25 9518,-2705.25"/>
<polygon fill="black" stroke="black" points="9521.5,-2705.25 9518,-2695.25 9514.5,-2705.25 9521.5,-2705.25"/>
</g>
<!-- ring_attn_3_13_stage_8 -->
<g id="node1358" class="node">
<title>ring_attn_3_13_stage_8</title>
<polygon fill="yellow" stroke="black" points="10105,-2948 9896,-2880 10105,-2812 10314,-2880 10105,-2948"/>
<text text-anchor="middle" x="10105" y="-2898.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-2883.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="10105" y="-2868.8" font-family="Times,serif" font-size="14.00">Q[13]×K[5]×V[5]</text>
<text text-anchor="middle" x="10105" y="-2853.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_12_stage_8&#45;&gt;ring_attn_3_13_stage_8 -->
<g id="edge3142" class="edge">
<title>ring_attn_3_12_stage_8&#45;&gt;ring_attn_3_13_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-2880C9727.02,-2880 9885.86,-2880 9885.86,-2880"/>
<polygon fill="red" stroke="red" points="9885.86,-2883.5 9895.86,-2880 9885.86,-2876.5 9885.86,-2883.5"/>
</g>
<!-- ring_attn_3_12_stage_9&#45;&gt;ring_attn_3_12_stage_10 -->
<g id="edge1249" class="edge">
<title>ring_attn_3_12_stage_9&#45;&gt;ring_attn_3_12_stage_10</title>
<path fill="none" stroke="black" d="M9518,-2558.87C9518,-2558.87 9518,-2452.25 9518,-2452.25"/>
<polygon fill="black" stroke="black" points="9521.5,-2452.25 9518,-2442.25 9514.5,-2452.25 9521.5,-2452.25"/>
</g>
<!-- ring_attn_3_13_stage_9 -->
<g id="node1359" class="node">
<title>ring_attn_3_13_stage_9</title>
<polygon fill="yellow" stroke="black" points="10105,-2695 9896,-2627 10105,-2559 10314,-2627 10105,-2695"/>
<text text-anchor="middle" x="10105" y="-2645.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-2630.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="10105" y="-2615.8" font-family="Times,serif" font-size="14.00">Q[13]×K[4]×V[4]</text>
<text text-anchor="middle" x="10105" y="-2600.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_12_stage_9&#45;&gt;ring_attn_3_13_stage_9 -->
<g id="edge3143" class="edge">
<title>ring_attn_3_12_stage_9&#45;&gt;ring_attn_3_13_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-2627C9727.02,-2627 9885.86,-2627 9885.86,-2627"/>
<polygon fill="red" stroke="red" points="9885.86,-2630.5 9895.86,-2627 9885.86,-2623.5 9885.86,-2630.5"/>
</g>
<!-- ring_attn_3_12_stage_10&#45;&gt;ring_attn_3_12_stage_11 -->
<g id="edge1250" class="edge">
<title>ring_attn_3_12_stage_10&#45;&gt;ring_attn_3_12_stage_11</title>
<path fill="none" stroke="black" d="M9518,-2305.87C9518,-2305.87 9518,-2199.25 9518,-2199.25"/>
<polygon fill="black" stroke="black" points="9521.5,-2199.25 9518,-2189.25 9514.5,-2199.25 9521.5,-2199.25"/>
</g>
<!-- ring_attn_3_13_stage_10 -->
<g id="node1360" class="node">
<title>ring_attn_3_13_stage_10</title>
<polygon fill="yellow" stroke="black" points="10105,-2442 9896,-2374 10105,-2306 10314,-2374 10105,-2442"/>
<text text-anchor="middle" x="10105" y="-2392.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-2377.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="10105" y="-2362.8" font-family="Times,serif" font-size="14.00">Q[13]×K[3]×V[3]</text>
<text text-anchor="middle" x="10105" y="-2347.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_12_stage_10&#45;&gt;ring_attn_3_13_stage_10 -->
<g id="edge3144" class="edge">
<title>ring_attn_3_12_stage_10&#45;&gt;ring_attn_3_13_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-2374C9727.02,-2374 9885.86,-2374 9885.86,-2374"/>
<polygon fill="red" stroke="red" points="9885.86,-2377.5 9895.86,-2374 9885.86,-2370.5 9885.86,-2377.5"/>
</g>
<!-- ring_attn_3_12_stage_11&#45;&gt;ring_attn_3_12_stage_12 -->
<g id="edge1251" class="edge">
<title>ring_attn_3_12_stage_11&#45;&gt;ring_attn_3_12_stage_12</title>
<path fill="none" stroke="black" d="M9518,-2052.87C9518,-2052.87 9518,-1946.25 9518,-1946.25"/>
<polygon fill="black" stroke="black" points="9521.5,-1946.25 9518,-1936.25 9514.5,-1946.25 9521.5,-1946.25"/>
</g>
<!-- ring_attn_3_13_stage_11 -->
<g id="node1361" class="node">
<title>ring_attn_3_13_stage_11</title>
<polygon fill="yellow" stroke="black" points="10105,-2189 9896,-2121 10105,-2053 10314,-2121 10105,-2189"/>
<text text-anchor="middle" x="10105" y="-2139.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-2124.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="10105" y="-2109.8" font-family="Times,serif" font-size="14.00">Q[13]×K[2]×V[2]</text>
<text text-anchor="middle" x="10105" y="-2094.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_12_stage_11&#45;&gt;ring_attn_3_13_stage_11 -->
<g id="edge3145" class="edge">
<title>ring_attn_3_12_stage_11&#45;&gt;ring_attn_3_13_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-2121C9727.02,-2121 9885.86,-2121 9885.86,-2121"/>
<polygon fill="red" stroke="red" points="9885.86,-2124.5 9895.86,-2121 9885.86,-2117.5 9885.86,-2124.5"/>
</g>
<!-- ring_attn_3_12_stage_12&#45;&gt;ring_attn_3_12_stage_13 -->
<g id="edge1252" class="edge">
<title>ring_attn_3_12_stage_12&#45;&gt;ring_attn_3_12_stage_13</title>
<path fill="none" stroke="black" d="M9518,-1799.87C9518,-1799.87 9518,-1693.25 9518,-1693.25"/>
<polygon fill="black" stroke="black" points="9521.5,-1693.25 9518,-1683.25 9514.5,-1693.25 9521.5,-1693.25"/>
</g>
<!-- ring_attn_3_13_stage_12 -->
<g id="node1362" class="node">
<title>ring_attn_3_13_stage_12</title>
<polygon fill="yellow" stroke="black" points="10105,-1936 9896,-1868 10105,-1800 10314,-1868 10105,-1936"/>
<text text-anchor="middle" x="10105" y="-1886.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-1871.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="10105" y="-1856.8" font-family="Times,serif" font-size="14.00">Q[13]×K[1]×V[1]</text>
<text text-anchor="middle" x="10105" y="-1841.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_12_stage_12&#45;&gt;ring_attn_3_13_stage_12 -->
<g id="edge3146" class="edge">
<title>ring_attn_3_12_stage_12&#45;&gt;ring_attn_3_13_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-1868C9727.02,-1868 9885.86,-1868 9885.86,-1868"/>
<polygon fill="red" stroke="red" points="9885.86,-1871.5 9895.86,-1868 9885.86,-1864.5 9885.86,-1871.5"/>
</g>
<!-- ring_attn_3_12_stage_13&#45;&gt;ring_attn_3_12_stage_14 -->
<g id="edge1253" class="edge">
<title>ring_attn_3_12_stage_13&#45;&gt;ring_attn_3_12_stage_14</title>
<path fill="none" stroke="black" d="M9518,-1546.87C9518,-1546.87 9518,-1440.25 9518,-1440.25"/>
<polygon fill="black" stroke="black" points="9521.5,-1440.25 9518,-1430.25 9514.5,-1440.25 9521.5,-1440.25"/>
</g>
<!-- ring_attn_3_13_stage_13 -->
<g id="node1363" class="node">
<title>ring_attn_3_13_stage_13</title>
<polygon fill="yellow" stroke="black" points="10105,-1683 9896,-1615 10105,-1547 10314,-1615 10105,-1683"/>
<text text-anchor="middle" x="10105" y="-1633.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-1618.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="10105" y="-1603.8" font-family="Times,serif" font-size="14.00">Q[13]×K[0]×V[0]</text>
<text text-anchor="middle" x="10105" y="-1588.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_12_stage_13&#45;&gt;ring_attn_3_13_stage_13 -->
<g id="edge3147" class="edge">
<title>ring_attn_3_12_stage_13&#45;&gt;ring_attn_3_13_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-1615C9727.02,-1615 9885.86,-1615 9885.86,-1615"/>
<polygon fill="red" stroke="red" points="9885.86,-1618.5 9895.86,-1615 9885.86,-1611.5 9885.86,-1618.5"/>
</g>
<!-- ring_attn_3_12_stage_14&#45;&gt;ring_attn_3_12_stage_15 -->
<g id="edge1254" class="edge">
<title>ring_attn_3_12_stage_14&#45;&gt;ring_attn_3_12_stage_15</title>
<path fill="none" stroke="black" d="M9518,-1293.87C9518,-1293.87 9518,-1187.25 9518,-1187.25"/>
<polygon fill="black" stroke="black" points="9521.5,-1187.25 9518,-1177.25 9514.5,-1187.25 9521.5,-1187.25"/>
</g>
<!-- ring_attn_3_13_stage_14 -->
<g id="node1364" class="node">
<title>ring_attn_3_13_stage_14</title>
<polygon fill="yellow" stroke="black" points="10105,-1430 9896,-1362 10105,-1294 10314,-1362 10105,-1430"/>
<text text-anchor="middle" x="10105" y="-1380.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-1365.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="10105" y="-1350.8" font-family="Times,serif" font-size="14.00">Q[13]×K[15]×V[15]</text>
<text text-anchor="middle" x="10105" y="-1335.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_12_stage_14&#45;&gt;ring_attn_3_13_stage_14 -->
<g id="edge3148" class="edge">
<title>ring_attn_3_12_stage_14&#45;&gt;ring_attn_3_13_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-1362C9727.02,-1362 9885.86,-1362 9885.86,-1362"/>
<polygon fill="red" stroke="red" points="9885.86,-1365.5 9895.86,-1362 9885.86,-1358.5 9885.86,-1365.5"/>
</g>
<!-- attn_out_3_12 -->
<g id="node1268" class="node">
<title>attn_out_3_12</title>
<polygon fill="none" stroke="black" points="9587.5,-968 9448.5,-968 9448.5,-915 9587.5,-915 9587.5,-968"/>
<text text-anchor="middle" x="9518" y="-952.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="9518" y="-937.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="9518" y="-922.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_3_12_stage_15&#45;&gt;attn_out_3_12 -->
<g id="edge1255" class="edge">
<title>ring_attn_3_12_stage_15&#45;&gt;attn_out_3_12</title>
<path fill="none" stroke="black" d="M9518,-1040.87C9518,-1040.87 9518,-978.18 9518,-978.18"/>
<polygon fill="black" stroke="black" points="9521.5,-978.18 9518,-968.18 9514.5,-978.18 9521.5,-978.18"/>
</g>
<!-- ring_attn_3_13_stage_15 -->
<g id="node1365" class="node">
<title>ring_attn_3_13_stage_15</title>
<polygon fill="yellow" stroke="black" points="10105,-1177 9896,-1109 10105,-1041 10314,-1109 10105,-1177"/>
<text text-anchor="middle" x="10105" y="-1127.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10105" y="-1112.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="10105" y="-1097.8" font-family="Times,serif" font-size="14.00">Q[13]×K[14]×V[14]</text>
<text text-anchor="middle" x="10105" y="-1082.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_12_stage_15&#45;&gt;ring_attn_3_13_stage_15 -->
<g id="edge3149" class="edge">
<title>ring_attn_3_12_stage_15&#45;&gt;ring_attn_3_13_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9727.02,-1109C9727.02,-1109 9885.86,-1109 9885.86,-1109"/>
<polygon fill="red" stroke="red" points="9885.86,-1112.5 9895.86,-1109 9885.86,-1105.5 9885.86,-1112.5"/>
</g>
<!-- attn_residual_3_12 -->
<g id="node1269" class="node">
<title>attn_residual_3_12</title>
<ellipse fill="none" stroke="black" cx="9518" cy="-815" rx="105.5" ry="27"/>
<text text-anchor="middle" x="9518" y="-818.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="9518" y="-803.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_3_12&#45;&gt;attn_residual_3_12 -->
<g id="edge1256" class="edge">
<title>attn_out_3_12&#45;&gt;attn_residual_3_12</title>
<path fill="none" stroke="black" d="M9518,-914.98C9518,-914.98 9518,-852.36 9518,-852.36"/>
<polygon fill="black" stroke="black" points="9521.5,-852.36 9518,-842.36 9514.5,-852.36 9521.5,-852.36"/>
</g>
<!-- gate_3_12 -->
<g id="node1270" class="node">
<title>gate_3_12</title>
<ellipse fill="orange" stroke="black" cx="9518" cy="-677.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="9518" y="-688.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="9518" y="-673.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="9518" y="-658.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_3_12&#45;&gt;gate_3_12 -->
<g id="edge1257" class="edge">
<title>attn_residual_3_12&#45;&gt;gate_3_12</title>
<path fill="none" stroke="black" d="M9553.17,-789.46C9553.17,-789.46 9553.17,-723.01 9553.17,-723.01"/>
<polygon fill="black" stroke="black" points="9556.67,-723.01 9553.17,-713.01 9549.67,-723.01 9556.67,-723.01"/>
</g>
<!-- gate_3_12&#45;&gt;expert_3_0_0 -->
<g id="edge3150" class="edge">
<title>gate_3_12&#45;&gt;expert_3_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9482.83,-713C9482.83,-744.31 9482.83,-785 9482.83,-785 9482.83,-785 108.7,-785 108.7,-785 108.7,-785 108.7,-518.17 108.7,-518.17"/>
<polygon fill="blue" stroke="blue" points="112.2,-518.17 108.7,-508.17 105.2,-518.17 112.2,-518.17"/>
<text text-anchor="middle" x="40316.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="40316.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU12→GPU0</text>
<text text-anchor="middle" x="40316.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="40316.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_12&#45;&gt;expert_3_1_0 -->
<g id="edge3151" class="edge">
<title>gate_3_12&#45;&gt;expert_3_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9421.67,-662.09C9421.67,-625.41 9421.67,-536 9421.67,-536 9421.67,-536 3013.05,-536 3013.05,-536 3013.05,-536 3013.05,-518.11 3013.05,-518.11"/>
<polygon fill="blue" stroke="blue" points="3016.55,-518.11 3013.05,-508.11 3009.55,-518.11 3016.55,-518.11"/>
<text text-anchor="middle" x="40490.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="40490.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU12→GPU1</text>
<text text-anchor="middle" x="40490.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="40490.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_12&#45;&gt;expert_3_2_0 -->
<g id="edge3152" class="edge">
<title>gate_3_12&#45;&gt;expert_3_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9440.02,-652C9440.02,-610.52 9440.02,-533 9440.02,-533 9440.02,-533 3628.46,-533 3628.46,-533 3628.46,-533 3628.46,-518.16 3628.46,-518.16"/>
<polygon fill="blue" stroke="blue" points="3631.96,-518.16 3628.46,-508.16 3624.96,-518.16 3631.96,-518.16"/>
<text text-anchor="middle" x="40664.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="40664.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU12→GPU2</text>
<text text-anchor="middle" x="40664.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="40664.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_12&#45;&gt;expert_3_3_0 -->
<g id="edge3153" class="edge">
<title>gate_3_12&#45;&gt;expert_3_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9458.37,-646.23C9458.37,-604.28 9458.37,-535 9458.37,-535 9458.37,-535 4222.34,-535 4222.34,-535 4222.34,-535 4222.34,-518.25 4222.34,-518.25"/>
<polygon fill="blue" stroke="blue" points="4225.84,-518.25 4222.34,-508.25 4218.84,-518.25 4225.84,-518.25"/>
<text text-anchor="middle" x="40838.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="40838.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU12→GPU3</text>
<text text-anchor="middle" x="40838.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="40838.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_12&#45;&gt;expert_3_4_0 -->
<g id="edge3154" class="edge">
<title>gate_3_12&#45;&gt;expert_3_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9476.72,-642.86C9476.72,-603.01 9476.72,-543 9476.72,-543 9476.72,-543 4827.02,-543 4827.02,-543 4827.02,-543 4827.02,-518.3 4827.02,-518.3"/>
<polygon fill="blue" stroke="blue" points="4830.52,-518.3 4827.02,-508.3 4823.52,-518.3 4830.52,-518.3"/>
<text text-anchor="middle" x="41012.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41012.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU12→GPU4</text>
<text text-anchor="middle" x="41012.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41012.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_12&#45;&gt;expert_3_5_0 -->
<g id="edge3155" class="edge">
<title>gate_3_12&#45;&gt;expert_3_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9495.07,-640.78C9495.07,-604.38 9495.07,-554 9495.07,-554 9495.07,-554 5424.07,-554 5424.07,-554 5424.07,-554 5424.07,-518.08 5424.07,-518.08"/>
<polygon fill="blue" stroke="blue" points="5427.57,-518.08 5424.07,-508.08 5420.57,-518.08 5427.57,-518.08"/>
<text text-anchor="middle" x="41186.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41186.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU12→GPU5</text>
<text text-anchor="middle" x="41186.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41186.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_12&#45;&gt;expert_3_6_0 -->
<g id="edge3156" class="edge">
<title>gate_3_12&#45;&gt;expert_3_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9513.41,-640.02C9513.41,-606.96 9513.41,-564 9513.41,-564 9513.41,-564 6006.55,-564 6006.55,-564 6006.55,-564 6006.55,-518.06 6006.55,-518.06"/>
<polygon fill="blue" stroke="blue" points="6010.05,-518.06 6006.55,-508.06 6003.05,-518.06 6010.05,-518.06"/>
<text text-anchor="middle" x="41360.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41360.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU12→GPU6</text>
<text text-anchor="middle" x="41360.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41360.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_12&#45;&gt;expert_3_7_0 -->
<g id="edge3157" class="edge">
<title>gate_3_12&#45;&gt;expert_3_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9531.76,-640.3C9531.76,-609.93 9531.76,-572 9531.76,-572 9531.76,-572 6598.07,-572 6598.07,-572 6598.07,-572 6598.07,-518.16 6598.07,-518.16"/>
<polygon fill="blue" stroke="blue" points="6601.57,-518.16 6598.07,-508.16 6594.57,-518.16 6601.57,-518.16"/>
<text text-anchor="middle" x="41534.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41534.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU12→GPU7</text>
<text text-anchor="middle" x="41534.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41534.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_12&#45;&gt;expert_3_8_0 -->
<g id="edge3158" class="edge">
<title>gate_3_12&#45;&gt;expert_3_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9550.11,-641.77C9550.11,-615.01 9550.11,-583 9550.11,-583 9550.11,-583 7183.76,-583 7183.76,-583 7183.76,-583 7183.76,-518.17 7183.76,-518.17"/>
<polygon fill="blue" stroke="blue" points="7187.26,-518.17 7183.76,-508.17 7180.26,-518.17 7187.26,-518.17"/>
<text text-anchor="middle" x="41708.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41708.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU12→GPU8</text>
<text text-anchor="middle" x="41708.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41708.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_12&#45;&gt;expert_3_9_0 -->
<g id="edge3159" class="edge">
<title>gate_3_12&#45;&gt;expert_3_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9568.46,-644.42C9568.46,-619.64 9568.46,-590 9568.46,-590 9568.46,-590 7776.18,-590 7776.18,-590 7776.18,-590 7776.18,-518.04 7776.18,-518.04"/>
<polygon fill="blue" stroke="blue" points="7779.68,-518.04 7776.18,-508.04 7772.68,-518.04 7779.68,-518.04"/>
<text text-anchor="middle" x="41882.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="41882.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU12→GPU9</text>
<text text-anchor="middle" x="41882.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="41882.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_12&#45;&gt;expert_3_10_0 -->
<g id="edge3160" class="edge">
<title>gate_3_12&#45;&gt;expert_3_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9577.63,-646.51C9577.63,-637 9577.63,-629 9577.63,-629 9577.63,-629 8458.5,-629 8458.5,-629 8458.5,-629 8458.5,-518.21 8458.5,-518.21"/>
<polygon fill="blue" stroke="blue" points="8462,-518.21 8458.5,-508.21 8455,-518.21 8462,-518.21"/>
<text text-anchor="middle" x="42056.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42056.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU12→GPU10</text>
<text text-anchor="middle" x="42056.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42056.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_12&#45;&gt;expert_3_11_0 -->
<g id="edge3161" class="edge">
<title>gate_3_12&#45;&gt;expert_3_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9418.3,-690C9278.46,-690 9041,-690 9041,-690 9041,-690 9041,-518.33 9041,-518.33"/>
<polygon fill="blue" stroke="blue" points="9044.5,-518.33 9041,-508.33 9037.5,-518.33 9044.5,-518.33"/>
<text text-anchor="middle" x="42230.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42230.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU12→GPU11</text>
<text text-anchor="middle" x="42230.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42230.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_12&#45;&gt;expert_3_12_0 -->
<g id="edge1258" class="edge">
<title>gate_3_12&#45;&gt;expert_3_12_0</title>
<path fill="none" stroke="black" d="M9586.8,-649C9586.8,-649 9586.8,-518.15 9586.8,-518.15"/>
<polygon fill="black" stroke="black" points="9590.3,-518.15 9586.8,-508.15 9583.3,-518.15 9590.3,-518.15"/>
</g>
<!-- gate_3_12&#45;&gt;expert_3_13_0 -->
<g id="edge3162" class="edge">
<title>gate_3_12&#45;&gt;expert_3_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9617.65,-665C9757.77,-665 9996.12,-665 9996.12,-665 9996.12,-665 9996.12,-518.18 9996.12,-518.18"/>
<polygon fill="blue" stroke="blue" points="9999.63,-518.18 9996.12,-508.18 9992.63,-518.18 9999.63,-518.18"/>
<text text-anchor="middle" x="42404.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42404.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU12→GPU13</text>
<text text-anchor="middle" x="42404.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42404.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_12&#45;&gt;expert_3_14_0 -->
<g id="edge3163" class="edge">
<title>gate_3_12&#45;&gt;expert_3_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9605.15,-656.26C9605.15,-642.07 9605.15,-626 9605.15,-626 9605.15,-626 10578.4,-626 10578.4,-626 10578.4,-626 10578.4,-518 10578.4,-518"/>
<polygon fill="blue" stroke="blue" points="10581.9,-518 10578.4,-508 10574.9,-518 10581.9,-518"/>
<text text-anchor="middle" x="42578.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42578.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU12→GPU14</text>
<text text-anchor="middle" x="42578.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42578.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_12&#45;&gt;expert_3_15_0 -->
<g id="edge3164" class="edge">
<title>gate_3_12&#45;&gt;expert_3_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9614.33,-662.05C9614.33,-646.88 9614.33,-626 9614.33,-626 9614.33,-626 11163.38,-626 11163.38,-626 11163.38,-626 11163.38,-518 11163.38,-518"/>
<polygon fill="blue" stroke="blue" points="11166.88,-518 11163.38,-508 11159.88,-518 11166.88,-518"/>
<text text-anchor="middle" x="42752.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42752.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU12→GPU15</text>
<text text-anchor="middle" x="42752.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42752.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_12 -->
<g id="node1272" class="node">
<title>expert_reduce_3_12</title>
<ellipse fill="none" stroke="black" cx="9518" cy="-344.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="9518" y="-355.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="9518" y="-340.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="9518" y="-325.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_12_0&#45;&gt;expert_reduce_3_12 -->
<g id="edge1259" class="edge">
<title>expert_3_12_0&#45;&gt;expert_reduce_3_12</title>
<path fill="none" stroke="black" d="M9518,-454.76C9518,-454.76 9518,-392.06 9518,-392.06"/>
<polygon fill="black" stroke="black" points="9521.5,-392.06 9518,-382.06 9514.5,-392.06 9521.5,-392.06"/>
</g>
<!-- moe_residual_3_12 -->
<g id="node1273" class="node">
<title>moe_residual_3_12</title>
<ellipse fill="none" stroke="black" cx="9518" cy="-207" rx="105.5" ry="27"/>
<text text-anchor="middle" x="9518" y="-210.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="9518" y="-195.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_12&#45;&gt;moe_residual_3_12 -->
<g id="edge1260" class="edge">
<title>expert_reduce_3_12&#45;&gt;moe_residual_3_12</title>
<path fill="none" stroke="black" d="M9518,-306.93C9518,-306.93 9518,-244.06 9518,-244.06"/>
<polygon fill="black" stroke="black" points="9521.5,-244.06 9518,-234.06 9514.5,-244.06 9521.5,-244.06"/>
</g>
<!-- output_12 -->
<g id="node1274" class="node">
<title>output_12</title>
<polygon fill="lightcoral" stroke="black" points="9615.5,-107 9420.5,-107 9420.5,-69 9615.5,-69 9615.5,-107"/>
<text text-anchor="middle" x="9518" y="-91.8" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="9518" y="-76.8" font-family="Times,serif" font-size="14.00">Y[12]: 1024×1024×4096</text>
</g>
<!-- moe_residual_3_12&#45;&gt;output_12 -->
<g id="edge1261" class="edge">
<title>moe_residual_3_12&#45;&gt;output_12</title>
<path fill="none" stroke="black" d="M9518,-180C9518,-180 9518,-117.12 9518,-117.12"/>
<polygon fill="black" stroke="black" points="9521.5,-117.12 9518,-107.12 9514.5,-117.12 9521.5,-117.12"/>
</g>
<!-- input_13 -->
<g id="node1275" class="node">
<title>input_13</title>
<polygon fill="lightgreen" stroke="black" points="10203,-20866 10007,-20866 10007,-20828 10203,-20828 10203,-20866"/>
<text text-anchor="middle" x="10105" y="-20850.8" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="10105" y="-20835.8" font-family="Times,serif" font-size="14.00">X[13]: 1024×1024×4096</text>
</g>
<!-- qkv_proj_0_13 -->
<g id="node1276" class="node">
<title>qkv_proj_0_13</title>
<polygon fill="none" stroke="black" points="10187.5,-20755 10022.5,-20755 10022.5,-20702 10187.5,-20702 10187.5,-20755"/>
<text text-anchor="middle" x="10105" y="-20739.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="10105" y="-20724.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="10105" y="-20709.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- input_13&#45;&gt;qkv_proj_0_13 -->
<g id="edge1262" class="edge">
<title>input_13&#45;&gt;qkv_proj_0_13</title>
<path fill="none" stroke="black" d="M10105,-20827.96C10105,-20827.96 10105,-20765.44 10105,-20765.44"/>
<polygon fill="black" stroke="black" points="10108.5,-20765.44 10105,-20755.44 10101.5,-20765.44 10108.5,-20765.44"/>
</g>
<!-- qkv_reshape_0_13 -->
<g id="node1277" class="node">
<title>qkv_reshape_0_13</title>
<ellipse fill="none" stroke="black" cx="10105" cy="-20602" rx="148" ry="27"/>
<text text-anchor="middle" x="10105" y="-20605.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="10105" y="-20590.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_0_13&#45;&gt;qkv_reshape_0_13 -->
<g id="edge1263" class="edge">
<title>qkv_proj_0_13&#45;&gt;qkv_reshape_0_13</title>
<path fill="none" stroke="black" d="M10105,-20701.98C10105,-20701.98 10105,-20639.36 10105,-20639.36"/>
<polygon fill="black" stroke="black" points="10108.5,-20639.36 10105,-20629.36 10101.5,-20639.36 10108.5,-20639.36"/>
</g>
<!-- qkv_reshape_0_13&#45;&gt;ring_attn_0_13_stage_0 -->
<g id="edge1264" class="edge">
<title>qkv_reshape_0_13&#45;&gt;ring_attn_0_13_stage_0</title>
<path fill="none" stroke="black" d="M10105,-20574.72C10105,-20574.72 10105,-20468.16 10105,-20468.16"/>
<polygon fill="black" stroke="black" points="10108.5,-20468.16 10105,-20458.16 10101.5,-20468.16 10108.5,-20468.16"/>
</g>
<!-- ring_attn_0_13_stage_0&#45;&gt;ring_attn_0_13_stage_1 -->
<g id="edge1265" class="edge">
<title>ring_attn_0_13_stage_0&#45;&gt;ring_attn_0_13_stage_1</title>
<path fill="none" stroke="black" d="M10105,-20321.87C10105,-20321.87 10105,-20215.25 10105,-20215.25"/>
<polygon fill="black" stroke="black" points="10108.5,-20215.25 10105,-20205.25 10101.5,-20215.25 10108.5,-20215.25"/>
</g>
<!-- ring_attn_0_14_stage_0 -->
<g id="node1376" class="node">
<title>ring_attn_0_14_stage_0</title>
<polygon fill="yellow" stroke="black" points="10692,-20458 10483,-20390 10692,-20322 10901,-20390 10692,-20458"/>
<text text-anchor="middle" x="10692" y="-20408.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-20393.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="10692" y="-20378.8" font-family="Times,serif" font-size="14.00">Q[14]×K[14]×V[14]</text>
<text text-anchor="middle" x="10692" y="-20363.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_13_stage_0&#45;&gt;ring_attn_0_14_stage_0 -->
<g id="edge3165" class="edge">
<title>ring_attn_0_13_stage_0&#45;&gt;ring_attn_0_14_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-20390C10314.02,-20390 10472.86,-20390 10472.86,-20390"/>
<polygon fill="red" stroke="red" points="10472.86,-20393.5 10482.86,-20390 10472.86,-20386.5 10472.86,-20393.5"/>
</g>
<!-- ring_attn_0_13_stage_1&#45;&gt;ring_attn_0_13_stage_2 -->
<g id="edge1266" class="edge">
<title>ring_attn_0_13_stage_1&#45;&gt;ring_attn_0_13_stage_2</title>
<path fill="none" stroke="black" d="M10105,-20068.87C10105,-20068.87 10105,-19962.25 10105,-19962.25"/>
<polygon fill="black" stroke="black" points="10108.5,-19962.25 10105,-19952.25 10101.5,-19962.25 10108.5,-19962.25"/>
</g>
<!-- ring_attn_0_14_stage_1 -->
<g id="node1377" class="node">
<title>ring_attn_0_14_stage_1</title>
<polygon fill="yellow" stroke="black" points="10692,-20205 10483,-20137 10692,-20069 10901,-20137 10692,-20205"/>
<text text-anchor="middle" x="10692" y="-20155.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-20140.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="10692" y="-20125.8" font-family="Times,serif" font-size="14.00">Q[14]×K[13]×V[13]</text>
<text text-anchor="middle" x="10692" y="-20110.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_13_stage_1&#45;&gt;ring_attn_0_14_stage_1 -->
<g id="edge3166" class="edge">
<title>ring_attn_0_13_stage_1&#45;&gt;ring_attn_0_14_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-20137C10314.02,-20137 10472.86,-20137 10472.86,-20137"/>
<polygon fill="red" stroke="red" points="10472.86,-20140.5 10482.86,-20137 10472.86,-20133.5 10472.86,-20140.5"/>
</g>
<!-- ring_attn_0_13_stage_2&#45;&gt;ring_attn_0_13_stage_3 -->
<g id="edge1267" class="edge">
<title>ring_attn_0_13_stage_2&#45;&gt;ring_attn_0_13_stage_3</title>
<path fill="none" stroke="black" d="M10105,-19815.87C10105,-19815.87 10105,-19709.25 10105,-19709.25"/>
<polygon fill="black" stroke="black" points="10108.5,-19709.25 10105,-19699.25 10101.5,-19709.25 10108.5,-19709.25"/>
</g>
<!-- ring_attn_0_14_stage_2 -->
<g id="node1378" class="node">
<title>ring_attn_0_14_stage_2</title>
<polygon fill="yellow" stroke="black" points="10692,-19952 10483,-19884 10692,-19816 10901,-19884 10692,-19952"/>
<text text-anchor="middle" x="10692" y="-19902.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-19887.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="10692" y="-19872.8" font-family="Times,serif" font-size="14.00">Q[14]×K[12]×V[12]</text>
<text text-anchor="middle" x="10692" y="-19857.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_13_stage_2&#45;&gt;ring_attn_0_14_stage_2 -->
<g id="edge3167" class="edge">
<title>ring_attn_0_13_stage_2&#45;&gt;ring_attn_0_14_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-19884C10314.02,-19884 10472.86,-19884 10472.86,-19884"/>
<polygon fill="red" stroke="red" points="10472.86,-19887.5 10482.86,-19884 10472.86,-19880.5 10472.86,-19887.5"/>
</g>
<!-- ring_attn_0_13_stage_3&#45;&gt;ring_attn_0_13_stage_4 -->
<g id="edge1268" class="edge">
<title>ring_attn_0_13_stage_3&#45;&gt;ring_attn_0_13_stage_4</title>
<path fill="none" stroke="black" d="M10105,-19562.87C10105,-19562.87 10105,-19456.25 10105,-19456.25"/>
<polygon fill="black" stroke="black" points="10108.5,-19456.25 10105,-19446.25 10101.5,-19456.25 10108.5,-19456.25"/>
</g>
<!-- ring_attn_0_14_stage_3 -->
<g id="node1379" class="node">
<title>ring_attn_0_14_stage_3</title>
<polygon fill="yellow" stroke="black" points="10692,-19699 10483,-19631 10692,-19563 10901,-19631 10692,-19699"/>
<text text-anchor="middle" x="10692" y="-19649.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-19634.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="10692" y="-19619.8" font-family="Times,serif" font-size="14.00">Q[14]×K[11]×V[11]</text>
<text text-anchor="middle" x="10692" y="-19604.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_13_stage_3&#45;&gt;ring_attn_0_14_stage_3 -->
<g id="edge3168" class="edge">
<title>ring_attn_0_13_stage_3&#45;&gt;ring_attn_0_14_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-19631C10314.02,-19631 10472.86,-19631 10472.86,-19631"/>
<polygon fill="red" stroke="red" points="10472.86,-19634.5 10482.86,-19631 10472.86,-19627.5 10472.86,-19634.5"/>
</g>
<!-- ring_attn_0_13_stage_4&#45;&gt;ring_attn_0_13_stage_5 -->
<g id="edge1269" class="edge">
<title>ring_attn_0_13_stage_4&#45;&gt;ring_attn_0_13_stage_5</title>
<path fill="none" stroke="black" d="M10105,-19309.87C10105,-19309.87 10105,-19203.25 10105,-19203.25"/>
<polygon fill="black" stroke="black" points="10108.5,-19203.25 10105,-19193.25 10101.5,-19203.25 10108.5,-19203.25"/>
</g>
<!-- ring_attn_0_14_stage_4 -->
<g id="node1380" class="node">
<title>ring_attn_0_14_stage_4</title>
<polygon fill="yellow" stroke="black" points="10692,-19446 10483,-19378 10692,-19310 10901,-19378 10692,-19446"/>
<text text-anchor="middle" x="10692" y="-19396.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-19381.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="10692" y="-19366.8" font-family="Times,serif" font-size="14.00">Q[14]×K[10]×V[10]</text>
<text text-anchor="middle" x="10692" y="-19351.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_13_stage_4&#45;&gt;ring_attn_0_14_stage_4 -->
<g id="edge3169" class="edge">
<title>ring_attn_0_13_stage_4&#45;&gt;ring_attn_0_14_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-19378C10314.02,-19378 10472.86,-19378 10472.86,-19378"/>
<polygon fill="red" stroke="red" points="10472.86,-19381.5 10482.86,-19378 10472.86,-19374.5 10472.86,-19381.5"/>
</g>
<!-- ring_attn_0_13_stage_5&#45;&gt;ring_attn_0_13_stage_6 -->
<g id="edge1270" class="edge">
<title>ring_attn_0_13_stage_5&#45;&gt;ring_attn_0_13_stage_6</title>
<path fill="none" stroke="black" d="M10105,-19056.87C10105,-19056.87 10105,-18950.25 10105,-18950.25"/>
<polygon fill="black" stroke="black" points="10108.5,-18950.25 10105,-18940.25 10101.5,-18950.25 10108.5,-18950.25"/>
</g>
<!-- ring_attn_0_14_stage_5 -->
<g id="node1381" class="node">
<title>ring_attn_0_14_stage_5</title>
<polygon fill="yellow" stroke="black" points="10692,-19193 10483,-19125 10692,-19057 10901,-19125 10692,-19193"/>
<text text-anchor="middle" x="10692" y="-19143.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-19128.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="10692" y="-19113.8" font-family="Times,serif" font-size="14.00">Q[14]×K[9]×V[9]</text>
<text text-anchor="middle" x="10692" y="-19098.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_13_stage_5&#45;&gt;ring_attn_0_14_stage_5 -->
<g id="edge3170" class="edge">
<title>ring_attn_0_13_stage_5&#45;&gt;ring_attn_0_14_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-19125C10314.02,-19125 10472.86,-19125 10472.86,-19125"/>
<polygon fill="red" stroke="red" points="10472.86,-19128.5 10482.86,-19125 10472.86,-19121.5 10472.86,-19128.5"/>
</g>
<!-- ring_attn_0_13_stage_6&#45;&gt;ring_attn_0_13_stage_7 -->
<g id="edge1271" class="edge">
<title>ring_attn_0_13_stage_6&#45;&gt;ring_attn_0_13_stage_7</title>
<path fill="none" stroke="black" d="M10105,-18803.87C10105,-18803.87 10105,-18697.25 10105,-18697.25"/>
<polygon fill="black" stroke="black" points="10108.5,-18697.25 10105,-18687.25 10101.5,-18697.25 10108.5,-18697.25"/>
</g>
<!-- ring_attn_0_14_stage_6 -->
<g id="node1382" class="node">
<title>ring_attn_0_14_stage_6</title>
<polygon fill="yellow" stroke="black" points="10692,-18940 10483,-18872 10692,-18804 10901,-18872 10692,-18940"/>
<text text-anchor="middle" x="10692" y="-18890.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-18875.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="10692" y="-18860.8" font-family="Times,serif" font-size="14.00">Q[14]×K[8]×V[8]</text>
<text text-anchor="middle" x="10692" y="-18845.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_13_stage_6&#45;&gt;ring_attn_0_14_stage_6 -->
<g id="edge3171" class="edge">
<title>ring_attn_0_13_stage_6&#45;&gt;ring_attn_0_14_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-18872C10314.02,-18872 10472.86,-18872 10472.86,-18872"/>
<polygon fill="red" stroke="red" points="10472.86,-18875.5 10482.86,-18872 10472.86,-18868.5 10472.86,-18875.5"/>
</g>
<!-- ring_attn_0_13_stage_7&#45;&gt;ring_attn_0_13_stage_8 -->
<g id="edge1272" class="edge">
<title>ring_attn_0_13_stage_7&#45;&gt;ring_attn_0_13_stage_8</title>
<path fill="none" stroke="black" d="M10105,-18550.87C10105,-18550.87 10105,-18444.25 10105,-18444.25"/>
<polygon fill="black" stroke="black" points="10108.5,-18444.25 10105,-18434.25 10101.5,-18444.25 10108.5,-18444.25"/>
</g>
<!-- ring_attn_0_14_stage_7 -->
<g id="node1383" class="node">
<title>ring_attn_0_14_stage_7</title>
<polygon fill="yellow" stroke="black" points="10692,-18687 10483,-18619 10692,-18551 10901,-18619 10692,-18687"/>
<text text-anchor="middle" x="10692" y="-18637.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-18622.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="10692" y="-18607.8" font-family="Times,serif" font-size="14.00">Q[14]×K[7]×V[7]</text>
<text text-anchor="middle" x="10692" y="-18592.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_13_stage_7&#45;&gt;ring_attn_0_14_stage_7 -->
<g id="edge3172" class="edge">
<title>ring_attn_0_13_stage_7&#45;&gt;ring_attn_0_14_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-18619C10314.02,-18619 10472.86,-18619 10472.86,-18619"/>
<polygon fill="red" stroke="red" points="10472.86,-18622.5 10482.86,-18619 10472.86,-18615.5 10472.86,-18622.5"/>
</g>
<!-- ring_attn_0_13_stage_8&#45;&gt;ring_attn_0_13_stage_9 -->
<g id="edge1273" class="edge">
<title>ring_attn_0_13_stage_8&#45;&gt;ring_attn_0_13_stage_9</title>
<path fill="none" stroke="black" d="M10105,-18297.87C10105,-18297.87 10105,-18191.25 10105,-18191.25"/>
<polygon fill="black" stroke="black" points="10108.5,-18191.25 10105,-18181.25 10101.5,-18191.25 10108.5,-18191.25"/>
</g>
<!-- ring_attn_0_14_stage_8 -->
<g id="node1384" class="node">
<title>ring_attn_0_14_stage_8</title>
<polygon fill="yellow" stroke="black" points="10692,-18434 10483,-18366 10692,-18298 10901,-18366 10692,-18434"/>
<text text-anchor="middle" x="10692" y="-18384.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-18369.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="10692" y="-18354.8" font-family="Times,serif" font-size="14.00">Q[14]×K[6]×V[6]</text>
<text text-anchor="middle" x="10692" y="-18339.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_13_stage_8&#45;&gt;ring_attn_0_14_stage_8 -->
<g id="edge3173" class="edge">
<title>ring_attn_0_13_stage_8&#45;&gt;ring_attn_0_14_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-18366C10314.02,-18366 10472.86,-18366 10472.86,-18366"/>
<polygon fill="red" stroke="red" points="10472.86,-18369.5 10482.86,-18366 10472.86,-18362.5 10472.86,-18369.5"/>
</g>
<!-- ring_attn_0_13_stage_9&#45;&gt;ring_attn_0_13_stage_10 -->
<g id="edge1274" class="edge">
<title>ring_attn_0_13_stage_9&#45;&gt;ring_attn_0_13_stage_10</title>
<path fill="none" stroke="black" d="M10105,-18044.87C10105,-18044.87 10105,-17938.25 10105,-17938.25"/>
<polygon fill="black" stroke="black" points="10108.5,-17938.25 10105,-17928.25 10101.5,-17938.25 10108.5,-17938.25"/>
</g>
<!-- ring_attn_0_14_stage_9 -->
<g id="node1385" class="node">
<title>ring_attn_0_14_stage_9</title>
<polygon fill="yellow" stroke="black" points="10692,-18181 10483,-18113 10692,-18045 10901,-18113 10692,-18181"/>
<text text-anchor="middle" x="10692" y="-18131.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-18116.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="10692" y="-18101.8" font-family="Times,serif" font-size="14.00">Q[14]×K[5]×V[5]</text>
<text text-anchor="middle" x="10692" y="-18086.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_13_stage_9&#45;&gt;ring_attn_0_14_stage_9 -->
<g id="edge3174" class="edge">
<title>ring_attn_0_13_stage_9&#45;&gt;ring_attn_0_14_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-18113C10314.02,-18113 10472.86,-18113 10472.86,-18113"/>
<polygon fill="red" stroke="red" points="10472.86,-18116.5 10482.86,-18113 10472.86,-18109.5 10472.86,-18116.5"/>
</g>
<!-- ring_attn_0_13_stage_10&#45;&gt;ring_attn_0_13_stage_11 -->
<g id="edge1275" class="edge">
<title>ring_attn_0_13_stage_10&#45;&gt;ring_attn_0_13_stage_11</title>
<path fill="none" stroke="black" d="M10105,-17791.87C10105,-17791.87 10105,-17685.25 10105,-17685.25"/>
<polygon fill="black" stroke="black" points="10108.5,-17685.25 10105,-17675.25 10101.5,-17685.25 10108.5,-17685.25"/>
</g>
<!-- ring_attn_0_14_stage_10 -->
<g id="node1386" class="node">
<title>ring_attn_0_14_stage_10</title>
<polygon fill="yellow" stroke="black" points="10692,-17928 10483,-17860 10692,-17792 10901,-17860 10692,-17928"/>
<text text-anchor="middle" x="10692" y="-17878.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-17863.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="10692" y="-17848.8" font-family="Times,serif" font-size="14.00">Q[14]×K[4]×V[4]</text>
<text text-anchor="middle" x="10692" y="-17833.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_13_stage_10&#45;&gt;ring_attn_0_14_stage_10 -->
<g id="edge3175" class="edge">
<title>ring_attn_0_13_stage_10&#45;&gt;ring_attn_0_14_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-17860C10314.02,-17860 10472.86,-17860 10472.86,-17860"/>
<polygon fill="red" stroke="red" points="10472.86,-17863.5 10482.86,-17860 10472.86,-17856.5 10472.86,-17863.5"/>
</g>
<!-- ring_attn_0_13_stage_11&#45;&gt;ring_attn_0_13_stage_12 -->
<g id="edge1276" class="edge">
<title>ring_attn_0_13_stage_11&#45;&gt;ring_attn_0_13_stage_12</title>
<path fill="none" stroke="black" d="M10105,-17538.87C10105,-17538.87 10105,-17432.25 10105,-17432.25"/>
<polygon fill="black" stroke="black" points="10108.5,-17432.25 10105,-17422.25 10101.5,-17432.25 10108.5,-17432.25"/>
</g>
<!-- ring_attn_0_14_stage_11 -->
<g id="node1387" class="node">
<title>ring_attn_0_14_stage_11</title>
<polygon fill="yellow" stroke="black" points="10692,-17675 10483,-17607 10692,-17539 10901,-17607 10692,-17675"/>
<text text-anchor="middle" x="10692" y="-17625.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-17610.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="10692" y="-17595.8" font-family="Times,serif" font-size="14.00">Q[14]×K[3]×V[3]</text>
<text text-anchor="middle" x="10692" y="-17580.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_13_stage_11&#45;&gt;ring_attn_0_14_stage_11 -->
<g id="edge3176" class="edge">
<title>ring_attn_0_13_stage_11&#45;&gt;ring_attn_0_14_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-17607C10314.02,-17607 10472.86,-17607 10472.86,-17607"/>
<polygon fill="red" stroke="red" points="10472.86,-17610.5 10482.86,-17607 10472.86,-17603.5 10472.86,-17610.5"/>
</g>
<!-- ring_attn_0_13_stage_12&#45;&gt;ring_attn_0_13_stage_13 -->
<g id="edge1277" class="edge">
<title>ring_attn_0_13_stage_12&#45;&gt;ring_attn_0_13_stage_13</title>
<path fill="none" stroke="black" d="M10105,-17285.87C10105,-17285.87 10105,-17179.25 10105,-17179.25"/>
<polygon fill="black" stroke="black" points="10108.5,-17179.25 10105,-17169.25 10101.5,-17179.25 10108.5,-17179.25"/>
</g>
<!-- ring_attn_0_14_stage_12 -->
<g id="node1388" class="node">
<title>ring_attn_0_14_stage_12</title>
<polygon fill="yellow" stroke="black" points="10692,-17422 10483,-17354 10692,-17286 10901,-17354 10692,-17422"/>
<text text-anchor="middle" x="10692" y="-17372.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-17357.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="10692" y="-17342.8" font-family="Times,serif" font-size="14.00">Q[14]×K[2]×V[2]</text>
<text text-anchor="middle" x="10692" y="-17327.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_13_stage_12&#45;&gt;ring_attn_0_14_stage_12 -->
<g id="edge3177" class="edge">
<title>ring_attn_0_13_stage_12&#45;&gt;ring_attn_0_14_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-17354C10314.02,-17354 10472.86,-17354 10472.86,-17354"/>
<polygon fill="red" stroke="red" points="10472.86,-17357.5 10482.86,-17354 10472.86,-17350.5 10472.86,-17357.5"/>
</g>
<!-- ring_attn_0_13_stage_13&#45;&gt;ring_attn_0_13_stage_14 -->
<g id="edge1278" class="edge">
<title>ring_attn_0_13_stage_13&#45;&gt;ring_attn_0_13_stage_14</title>
<path fill="none" stroke="black" d="M10105,-17032.87C10105,-17032.87 10105,-16926.25 10105,-16926.25"/>
<polygon fill="black" stroke="black" points="10108.5,-16926.25 10105,-16916.25 10101.5,-16926.25 10108.5,-16926.25"/>
</g>
<!-- ring_attn_0_14_stage_13 -->
<g id="node1389" class="node">
<title>ring_attn_0_14_stage_13</title>
<polygon fill="yellow" stroke="black" points="10692,-17169 10483,-17101 10692,-17033 10901,-17101 10692,-17169"/>
<text text-anchor="middle" x="10692" y="-17119.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-17104.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="10692" y="-17089.8" font-family="Times,serif" font-size="14.00">Q[14]×K[1]×V[1]</text>
<text text-anchor="middle" x="10692" y="-17074.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_13_stage_13&#45;&gt;ring_attn_0_14_stage_13 -->
<g id="edge3178" class="edge">
<title>ring_attn_0_13_stage_13&#45;&gt;ring_attn_0_14_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-17101C10314.02,-17101 10472.86,-17101 10472.86,-17101"/>
<polygon fill="red" stroke="red" points="10472.86,-17104.5 10482.86,-17101 10472.86,-17097.5 10472.86,-17104.5"/>
</g>
<!-- ring_attn_0_13_stage_14&#45;&gt;ring_attn_0_13_stage_15 -->
<g id="edge1279" class="edge">
<title>ring_attn_0_13_stage_14&#45;&gt;ring_attn_0_13_stage_15</title>
<path fill="none" stroke="black" d="M10105,-16779.87C10105,-16779.87 10105,-16673.25 10105,-16673.25"/>
<polygon fill="black" stroke="black" points="10108.5,-16673.25 10105,-16663.25 10101.5,-16673.25 10108.5,-16673.25"/>
</g>
<!-- ring_attn_0_14_stage_14 -->
<g id="node1390" class="node">
<title>ring_attn_0_14_stage_14</title>
<polygon fill="yellow" stroke="black" points="10692,-16916 10483,-16848 10692,-16780 10901,-16848 10692,-16916"/>
<text text-anchor="middle" x="10692" y="-16866.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-16851.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="10692" y="-16836.8" font-family="Times,serif" font-size="14.00">Q[14]×K[0]×V[0]</text>
<text text-anchor="middle" x="10692" y="-16821.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_13_stage_14&#45;&gt;ring_attn_0_14_stage_14 -->
<g id="edge3179" class="edge">
<title>ring_attn_0_13_stage_14&#45;&gt;ring_attn_0_14_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-16848C10314.02,-16848 10472.86,-16848 10472.86,-16848"/>
<polygon fill="red" stroke="red" points="10472.86,-16851.5 10482.86,-16848 10472.86,-16844.5 10472.86,-16851.5"/>
</g>
<!-- attn_out_0_13 -->
<g id="node1294" class="node">
<title>attn_out_0_13</title>
<polygon fill="none" stroke="black" points="10174.5,-16454 10035.5,-16454 10035.5,-16401 10174.5,-16401 10174.5,-16454"/>
<text text-anchor="middle" x="10105" y="-16438.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="10105" y="-16423.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="10105" y="-16408.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_0_13_stage_15&#45;&gt;attn_out_0_13 -->
<g id="edge1280" class="edge">
<title>ring_attn_0_13_stage_15&#45;&gt;attn_out_0_13</title>
<path fill="none" stroke="black" d="M10105,-16526.87C10105,-16526.87 10105,-16464.18 10105,-16464.18"/>
<polygon fill="black" stroke="black" points="10108.5,-16464.18 10105,-16454.18 10101.5,-16464.18 10108.5,-16464.18"/>
</g>
<!-- ring_attn_0_14_stage_15 -->
<g id="node1391" class="node">
<title>ring_attn_0_14_stage_15</title>
<polygon fill="yellow" stroke="black" points="10692,-16663 10483,-16595 10692,-16527 10901,-16595 10692,-16663"/>
<text text-anchor="middle" x="10692" y="-16613.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-16598.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="10692" y="-16583.8" font-family="Times,serif" font-size="14.00">Q[14]×K[15]×V[15]</text>
<text text-anchor="middle" x="10692" y="-16568.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_13_stage_15&#45;&gt;ring_attn_0_14_stage_15 -->
<g id="edge3180" class="edge">
<title>ring_attn_0_13_stage_15&#45;&gt;ring_attn_0_14_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-16595C10314.02,-16595 10472.86,-16595 10472.86,-16595"/>
<polygon fill="red" stroke="red" points="10472.86,-16598.5 10482.86,-16595 10472.86,-16591.5 10472.86,-16598.5"/>
</g>
<!-- attn_residual_0_13 -->
<g id="node1295" class="node">
<title>attn_residual_0_13</title>
<ellipse fill="none" stroke="black" cx="10105" cy="-16301" rx="105.5" ry="27"/>
<text text-anchor="middle" x="10105" y="-16304.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="10105" y="-16289.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_0_13&#45;&gt;attn_residual_0_13 -->
<g id="edge1281" class="edge">
<title>attn_out_0_13&#45;&gt;attn_residual_0_13</title>
<path fill="none" stroke="black" d="M10105,-16400.98C10105,-16400.98 10105,-16338.36 10105,-16338.36"/>
<polygon fill="black" stroke="black" points="10108.5,-16338.36 10105,-16328.36 10101.5,-16338.36 10108.5,-16338.36"/>
</g>
<!-- gate_0_13 -->
<g id="node1296" class="node">
<title>gate_0_13</title>
<ellipse fill="orange" stroke="black" cx="10105" cy="-16163.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="10105" y="-16174.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="10105" y="-16159.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="10105" y="-16144.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_0_13&#45;&gt;gate_0_13 -->
<g id="edge1282" class="edge">
<title>attn_residual_0_13&#45;&gt;gate_0_13</title>
<path fill="none" stroke="black" d="M10105,-16273.83C10105,-16273.83 10105,-16211.02 10105,-16211.02"/>
<polygon fill="black" stroke="black" points="10108.5,-16211.02 10105,-16201.02 10101.5,-16211.02 10108.5,-16211.02"/>
</g>
<!-- gate_0_13&#45;&gt;expert_0_0_0 -->
<g id="edge3181" class="edge">
<title>gate_0_13&#45;&gt;expert_0_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10007.94,-16148.72C10007.94,-16111.16 10007.94,-16015 10007.94,-16015 10007.94,-16015 175.77,-16015 175.77,-16015 175.77,-16015 175.77,-16004.03 175.77,-16004.03"/>
<polygon fill="blue" stroke="blue" points="179.27,-16004.03 175.77,-15994.03 172.27,-16004.03 179.27,-16004.03"/>
<text text-anchor="middle" x="42926.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42926.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU13→GPU0</text>
<text text-anchor="middle" x="42926.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42926.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_13&#45;&gt;expert_0_1_0 -->
<g id="edge3182" class="edge">
<title>gate_0_13&#45;&gt;expert_0_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10024.82,-16139.08C10024.82,-16094.62 10024.82,-16005 10024.82,-16005 10024.82,-16005 3022.64,-16005 3022.64,-16005 3022.64,-16005 3022.64,-16003.94 3022.64,-16003.94"/>
<polygon fill="blue" stroke="blue" points="3026.14,-16004.35 3022.64,-15994.35 3019.14,-16004.35 3026.14,-16004.35"/>
<text text-anchor="middle" x="43100.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43100.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU13→GPU1</text>
<text text-anchor="middle" x="43100.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43100.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_13&#45;&gt;expert_0_2_0 -->
<g id="edge3183" class="edge">
<title>gate_0_13&#45;&gt;expert_0_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10041.7,-16133.45C10041.7,-16090.06 10041.7,-16015 10041.7,-16015 10041.7,-16015 3636.28,-16015 3636.28,-16015 3636.28,-16015 3636.28,-16004.03 3636.28,-16004.03"/>
<polygon fill="blue" stroke="blue" points="3639.78,-16004.03 3636.28,-15994.03 3632.78,-16004.03 3639.78,-16004.03"/>
<text text-anchor="middle" x="43274.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43274.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU13→GPU2</text>
<text text-anchor="middle" x="43274.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43274.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_13&#45;&gt;expert_0_3_0 -->
<g id="edge3184" class="edge">
<title>gate_0_13&#45;&gt;expert_0_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10058.58,-16129.75C10058.58,-16086.77 10058.58,-16018 10058.58,-16018 10058.58,-16018 4230.78,-16018 4230.78,-16018 4230.78,-16018 4230.78,-16004.23 4230.78,-16004.23"/>
<polygon fill="blue" stroke="blue" points="4234.28,-16004.23 4230.78,-15994.23 4227.28,-16004.23 4234.28,-16004.23"/>
<text text-anchor="middle" x="43448.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43448.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU13→GPU3</text>
<text text-anchor="middle" x="43448.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43448.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_13&#45;&gt;expert_0_4_0 -->
<g id="edge3185" class="edge">
<title>gate_0_13&#45;&gt;expert_0_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10075.46,-16127.26C10075.46,-16079.64 10075.46,-16002 10075.46,-16002 10075.46,-16002 4837.07,-16002 4837.07,-16002 4837.07,-16002 4837.07,-16001.23 4837.07,-16001.23"/>
<polygon fill="blue" stroke="blue" points="4840.57,-16004.34 4837.07,-15994.34 4833.57,-16004.34 4840.57,-16004.34"/>
<text text-anchor="middle" x="43622.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43622.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU13→GPU4</text>
<text text-anchor="middle" x="43622.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43622.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_13&#45;&gt;expert_0_5_0 -->
<g id="edge3186" class="edge">
<title>gate_0_13&#45;&gt;expert_0_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10092.34,-16125.99C10092.34,-16077.72 10092.34,-16000 10092.34,-16000 10092.34,-16000 5434.12,-16000 5434.12,-16000 5434.12,-16000 5434.12,-15999.4 5434.12,-15999.4"/>
<polygon fill="blue" stroke="blue" points="5437.62,-16004.04 5434.12,-15994.04 5430.62,-16004.04 5437.62,-16004.04"/>
<text text-anchor="middle" x="43796.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43796.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU13→GPU5</text>
<text text-anchor="middle" x="43796.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43796.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_13&#45;&gt;expert_0_6_0 -->
<g id="edge3187" class="edge">
<title>gate_0_13&#45;&gt;expert_0_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10109.22,-16125.89C10109.22,-16088.6 10109.22,-16037 10109.22,-16037 10109.22,-16037 6017.1,-16037 6017.1,-16037 6017.1,-16037 6017.1,-16004.17 6017.1,-16004.17"/>
<polygon fill="blue" stroke="blue" points="6020.6,-16004.17 6017.1,-15994.17 6013.6,-16004.17 6020.6,-16004.17"/>
<text text-anchor="middle" x="43970.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43970.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU13→GPU6</text>
<text text-anchor="middle" x="43970.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43970.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_13&#45;&gt;expert_0_7_0 -->
<g id="edge3188" class="edge">
<title>gate_0_13&#45;&gt;expert_0_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10126.1,-16126.64C10126.1,-16093.17 10126.1,-16049 10126.1,-16049 10126.1,-16049 6608.12,-16049 6608.12,-16049 6608.12,-16049 6608.12,-16004.19 6608.12,-16004.19"/>
<polygon fill="blue" stroke="blue" points="6611.62,-16004.19 6608.12,-15994.19 6604.62,-16004.19 6611.62,-16004.19"/>
<text text-anchor="middle" x="44144.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="44144.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU13→GPU7</text>
<text text-anchor="middle" x="44144.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="44144.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_13&#45;&gt;expert_0_8_0 -->
<g id="edge3189" class="edge">
<title>gate_0_13&#45;&gt;expert_0_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10142.98,-16128.33C10142.98,-16097.31 10142.98,-16057 10142.98,-16057 10142.98,-16057 7192.93,-16057 7192.93,-16057 7192.93,-16057 7192.93,-16004.35 7192.93,-16004.35"/>
<polygon fill="blue" stroke="blue" points="7196.43,-16004.35 7192.93,-15994.35 7189.43,-16004.35 7196.43,-16004.35"/>
<text text-anchor="middle" x="44318.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="44318.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU13→GPU8</text>
<text text-anchor="middle" x="44318.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="44318.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_13&#45;&gt;expert_0_9_0 -->
<g id="edge3190" class="edge">
<title>gate_0_13&#45;&gt;expert_0_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10159.86,-16131.3C10159.86,-16102.91 10159.86,-16066 10159.86,-16066 10159.86,-16066 7785.77,-16066 7785.77,-16066 7785.77,-16066 7785.77,-16004.16 7785.77,-16004.16"/>
<polygon fill="blue" stroke="blue" points="7789.27,-16004.16 7785.77,-15994.16 7782.27,-16004.16 7789.27,-16004.16"/>
<text text-anchor="middle" x="44492.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="44492.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU13→GPU9</text>
<text text-anchor="middle" x="44492.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="44492.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_13&#45;&gt;expert_0_10_0 -->
<g id="edge3191" class="edge">
<title>gate_0_13&#45;&gt;expert_0_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10176.74,-16135.55C10176.74,-16108.64 10176.74,-16072 10176.74,-16072 10176.74,-16072 8379.17,-16072 8379.17,-16072 8379.17,-16072 8379.17,-16004.14 8379.17,-16004.14"/>
<polygon fill="blue" stroke="blue" points="8382.67,-16004.14 8379.17,-15994.14 8375.67,-16004.14 8382.67,-16004.14"/>
<text text-anchor="middle" x="44666.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="44666.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU13→GPU10</text>
<text text-anchor="middle" x="44666.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="44666.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_13&#45;&gt;expert_0_11_0 -->
<g id="edge3192" class="edge">
<title>gate_0_13&#45;&gt;expert_0_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10185.18,-16139.04C10185.18,-16126.57 10185.18,-16114 10185.18,-16114 10185.18,-16114 9045.5,-16114 9045.5,-16114 9045.5,-16114 9045.5,-16004.03 9045.5,-16004.03"/>
<polygon fill="blue" stroke="blue" points="9049,-16004.03 9045.5,-15994.03 9042,-16004.03 9049,-16004.03"/>
<text text-anchor="middle" x="44840.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="44840.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU13→GPU11</text>
<text text-anchor="middle" x="44840.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="44840.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_13&#45;&gt;expert_0_12_0 -->
<g id="edge3193" class="edge">
<title>gate_0_13&#45;&gt;expert_0_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10005.3,-16176C9865.46,-16176 9628,-16176 9628,-16176 9628,-16176 9628,-16004.33 9628,-16004.33"/>
<polygon fill="blue" stroke="blue" points="9631.5,-16004.33 9628,-15994.33 9624.5,-16004.33 9631.5,-16004.33"/>
<text text-anchor="middle" x="45014.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45014.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU13→GPU12</text>
<text text-anchor="middle" x="45014.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45014.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_13&#45;&gt;expert_0_13_0 -->
<g id="edge1283" class="edge">
<title>gate_0_13&#45;&gt;expert_0_13_0</title>
<path fill="none" stroke="black" d="M10193.62,-16142.9C10193.62,-16142.9 10193.62,-16004.03 10193.62,-16004.03"/>
<polygon fill="black" stroke="black" points="10197.12,-16004.03 10193.62,-15994.03 10190.12,-16004.03 10197.12,-16004.03"/>
</g>
<!-- gate_0_13&#45;&gt;expert_0_14_0 -->
<g id="edge3194" class="edge">
<title>gate_0_13&#45;&gt;expert_0_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10204.52,-16151C10344.09,-16151 10581.1,-16151 10581.1,-16151 10581.1,-16151 10581.1,-16004.18 10581.1,-16004.18"/>
<polygon fill="blue" stroke="blue" points="10584.6,-16004.18 10581.1,-15994.18 10577.6,-16004.18 10584.6,-16004.18"/>
<text text-anchor="middle" x="45188.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45188.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU13→GPU14</text>
<text text-anchor="middle" x="45188.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45188.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_13&#45;&gt;expert_0_15_0 -->
<g id="edge3195" class="edge">
<title>gate_0_13&#45;&gt;expert_0_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10202.06,-16148.79C10202.06,-16137.56 10202.06,-16124 10202.06,-16124 10202.06,-16124 11165.06,-16124 11165.06,-16124 11165.06,-16124 11165.06,-16004.05 11165.06,-16004.05"/>
<polygon fill="blue" stroke="blue" points="11168.56,-16004.05 11165.06,-15994.05 11161.56,-16004.05 11168.56,-16004.05"/>
<text text-anchor="middle" x="45362.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45362.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU13→GPU15</text>
<text text-anchor="middle" x="45362.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45362.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_13 -->
<g id="node1298" class="node">
<title>expert_reduce_0_13</title>
<ellipse fill="none" stroke="black" cx="10105" cy="-15830.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="10105" y="-15841.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="10105" y="-15826.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="10105" y="-15811.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_13_0&#45;&gt;expert_reduce_0_13 -->
<g id="edge1284" class="edge">
<title>expert_0_13_0&#45;&gt;expert_reduce_0_13</title>
<path fill="none" stroke="black" d="M10105,-15940.76C10105,-15940.76 10105,-15878.06 10105,-15878.06"/>
<polygon fill="black" stroke="black" points="10108.5,-15878.06 10105,-15868.06 10101.5,-15878.06 10108.5,-15878.06"/>
</g>
<!-- moe_residual_0_13 -->
<g id="node1299" class="node">
<title>moe_residual_0_13</title>
<ellipse fill="none" stroke="black" cx="10105" cy="-15693" rx="105.5" ry="27"/>
<text text-anchor="middle" x="10105" y="-15696.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="10105" y="-15681.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_13&#45;&gt;moe_residual_0_13 -->
<g id="edge1285" class="edge">
<title>expert_reduce_0_13&#45;&gt;moe_residual_0_13</title>
<path fill="none" stroke="black" d="M10105,-15792.93C10105,-15792.93 10105,-15730.06 10105,-15730.06"/>
<polygon fill="black" stroke="black" points="10108.5,-15730.06 10105,-15720.06 10101.5,-15730.06 10108.5,-15730.06"/>
</g>
<!-- qkv_proj_1_13 -->
<g id="node1300" class="node">
<title>qkv_proj_1_13</title>
<polygon fill="none" stroke="black" points="10187.5,-15593 10022.5,-15593 10022.5,-15540 10187.5,-15540 10187.5,-15593"/>
<text text-anchor="middle" x="10105" y="-15577.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="10105" y="-15562.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="10105" y="-15547.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_0_13&#45;&gt;qkv_proj_1_13 -->
<g id="edge1286" class="edge">
<title>moe_residual_0_13&#45;&gt;qkv_proj_1_13</title>
<path fill="none" stroke="black" d="M10105,-15665.86C10105,-15665.86 10105,-15603.16 10105,-15603.16"/>
<polygon fill="black" stroke="black" points="10108.5,-15603.16 10105,-15593.16 10101.5,-15603.16 10108.5,-15603.16"/>
</g>
<!-- qkv_reshape_1_13 -->
<g id="node1301" class="node">
<title>qkv_reshape_1_13</title>
<ellipse fill="none" stroke="black" cx="10105" cy="-15440" rx="148" ry="27"/>
<text text-anchor="middle" x="10105" y="-15443.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="10105" y="-15428.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_1_13&#45;&gt;qkv_reshape_1_13 -->
<g id="edge1287" class="edge">
<title>qkv_proj_1_13&#45;&gt;qkv_reshape_1_13</title>
<path fill="none" stroke="black" d="M10105,-15539.98C10105,-15539.98 10105,-15477.36 10105,-15477.36"/>
<polygon fill="black" stroke="black" points="10108.5,-15477.36 10105,-15467.36 10101.5,-15477.36 10108.5,-15477.36"/>
</g>
<!-- qkv_reshape_1_13&#45;&gt;ring_attn_1_13_stage_0 -->
<g id="edge1288" class="edge">
<title>qkv_reshape_1_13&#45;&gt;ring_attn_1_13_stage_0</title>
<path fill="none" stroke="black" d="M10105,-15412.72C10105,-15412.72 10105,-15306.16 10105,-15306.16"/>
<polygon fill="black" stroke="black" points="10108.5,-15306.16 10105,-15296.16 10101.5,-15306.16 10108.5,-15306.16"/>
</g>
<!-- ring_attn_1_13_stage_0&#45;&gt;ring_attn_1_13_stage_1 -->
<g id="edge1289" class="edge">
<title>ring_attn_1_13_stage_0&#45;&gt;ring_attn_1_13_stage_1</title>
<path fill="none" stroke="black" d="M10105,-15159.87C10105,-15159.87 10105,-15053.25 10105,-15053.25"/>
<polygon fill="black" stroke="black" points="10108.5,-15053.25 10105,-15043.25 10101.5,-15053.25 10108.5,-15053.25"/>
</g>
<!-- ring_attn_1_14_stage_0 -->
<g id="node1400" class="node">
<title>ring_attn_1_14_stage_0</title>
<polygon fill="yellow" stroke="black" points="10692,-15296 10483,-15228 10692,-15160 10901,-15228 10692,-15296"/>
<text text-anchor="middle" x="10692" y="-15246.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-15231.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="10692" y="-15216.8" font-family="Times,serif" font-size="14.00">Q[14]×K[14]×V[14]</text>
<text text-anchor="middle" x="10692" y="-15201.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_13_stage_0&#45;&gt;ring_attn_1_14_stage_0 -->
<g id="edge3196" class="edge">
<title>ring_attn_1_13_stage_0&#45;&gt;ring_attn_1_14_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-15228C10314.02,-15228 10472.86,-15228 10472.86,-15228"/>
<polygon fill="red" stroke="red" points="10472.86,-15231.5 10482.86,-15228 10472.86,-15224.5 10472.86,-15231.5"/>
</g>
<!-- ring_attn_1_13_stage_1&#45;&gt;ring_attn_1_13_stage_2 -->
<g id="edge1290" class="edge">
<title>ring_attn_1_13_stage_1&#45;&gt;ring_attn_1_13_stage_2</title>
<path fill="none" stroke="black" d="M10105,-14906.87C10105,-14906.87 10105,-14800.25 10105,-14800.25"/>
<polygon fill="black" stroke="black" points="10108.5,-14800.25 10105,-14790.25 10101.5,-14800.25 10108.5,-14800.25"/>
</g>
<!-- ring_attn_1_14_stage_1 -->
<g id="node1401" class="node">
<title>ring_attn_1_14_stage_1</title>
<polygon fill="yellow" stroke="black" points="10692,-15043 10483,-14975 10692,-14907 10901,-14975 10692,-15043"/>
<text text-anchor="middle" x="10692" y="-14993.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-14978.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="10692" y="-14963.8" font-family="Times,serif" font-size="14.00">Q[14]×K[13]×V[13]</text>
<text text-anchor="middle" x="10692" y="-14948.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_13_stage_1&#45;&gt;ring_attn_1_14_stage_1 -->
<g id="edge3197" class="edge">
<title>ring_attn_1_13_stage_1&#45;&gt;ring_attn_1_14_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-14975C10314.02,-14975 10472.86,-14975 10472.86,-14975"/>
<polygon fill="red" stroke="red" points="10472.86,-14978.5 10482.86,-14975 10472.86,-14971.5 10472.86,-14978.5"/>
</g>
<!-- ring_attn_1_13_stage_2&#45;&gt;ring_attn_1_13_stage_3 -->
<g id="edge1291" class="edge">
<title>ring_attn_1_13_stage_2&#45;&gt;ring_attn_1_13_stage_3</title>
<path fill="none" stroke="black" d="M10105,-14653.87C10105,-14653.87 10105,-14547.25 10105,-14547.25"/>
<polygon fill="black" stroke="black" points="10108.5,-14547.25 10105,-14537.25 10101.5,-14547.25 10108.5,-14547.25"/>
</g>
<!-- ring_attn_1_14_stage_2 -->
<g id="node1402" class="node">
<title>ring_attn_1_14_stage_2</title>
<polygon fill="yellow" stroke="black" points="10692,-14790 10483,-14722 10692,-14654 10901,-14722 10692,-14790"/>
<text text-anchor="middle" x="10692" y="-14740.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-14725.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="10692" y="-14710.8" font-family="Times,serif" font-size="14.00">Q[14]×K[12]×V[12]</text>
<text text-anchor="middle" x="10692" y="-14695.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_13_stage_2&#45;&gt;ring_attn_1_14_stage_2 -->
<g id="edge3198" class="edge">
<title>ring_attn_1_13_stage_2&#45;&gt;ring_attn_1_14_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-14722C10314.02,-14722 10472.86,-14722 10472.86,-14722"/>
<polygon fill="red" stroke="red" points="10472.86,-14725.5 10482.86,-14722 10472.86,-14718.5 10472.86,-14725.5"/>
</g>
<!-- ring_attn_1_13_stage_3&#45;&gt;ring_attn_1_13_stage_4 -->
<g id="edge1292" class="edge">
<title>ring_attn_1_13_stage_3&#45;&gt;ring_attn_1_13_stage_4</title>
<path fill="none" stroke="black" d="M10105,-14400.87C10105,-14400.87 10105,-14294.25 10105,-14294.25"/>
<polygon fill="black" stroke="black" points="10108.5,-14294.25 10105,-14284.25 10101.5,-14294.25 10108.5,-14294.25"/>
</g>
<!-- ring_attn_1_14_stage_3 -->
<g id="node1403" class="node">
<title>ring_attn_1_14_stage_3</title>
<polygon fill="yellow" stroke="black" points="10692,-14537 10483,-14469 10692,-14401 10901,-14469 10692,-14537"/>
<text text-anchor="middle" x="10692" y="-14487.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-14472.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="10692" y="-14457.8" font-family="Times,serif" font-size="14.00">Q[14]×K[11]×V[11]</text>
<text text-anchor="middle" x="10692" y="-14442.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_13_stage_3&#45;&gt;ring_attn_1_14_stage_3 -->
<g id="edge3199" class="edge">
<title>ring_attn_1_13_stage_3&#45;&gt;ring_attn_1_14_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-14469C10314.02,-14469 10472.86,-14469 10472.86,-14469"/>
<polygon fill="red" stroke="red" points="10472.86,-14472.5 10482.86,-14469 10472.86,-14465.5 10472.86,-14472.5"/>
</g>
<!-- ring_attn_1_13_stage_4&#45;&gt;ring_attn_1_13_stage_5 -->
<g id="edge1293" class="edge">
<title>ring_attn_1_13_stage_4&#45;&gt;ring_attn_1_13_stage_5</title>
<path fill="none" stroke="black" d="M10105,-14147.87C10105,-14147.87 10105,-14041.25 10105,-14041.25"/>
<polygon fill="black" stroke="black" points="10108.5,-14041.25 10105,-14031.25 10101.5,-14041.25 10108.5,-14041.25"/>
</g>
<!-- ring_attn_1_14_stage_4 -->
<g id="node1404" class="node">
<title>ring_attn_1_14_stage_4</title>
<polygon fill="yellow" stroke="black" points="10692,-14284 10483,-14216 10692,-14148 10901,-14216 10692,-14284"/>
<text text-anchor="middle" x="10692" y="-14234.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-14219.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="10692" y="-14204.8" font-family="Times,serif" font-size="14.00">Q[14]×K[10]×V[10]</text>
<text text-anchor="middle" x="10692" y="-14189.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_13_stage_4&#45;&gt;ring_attn_1_14_stage_4 -->
<g id="edge3200" class="edge">
<title>ring_attn_1_13_stage_4&#45;&gt;ring_attn_1_14_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-14216C10314.02,-14216 10472.86,-14216 10472.86,-14216"/>
<polygon fill="red" stroke="red" points="10472.86,-14219.5 10482.86,-14216 10472.86,-14212.5 10472.86,-14219.5"/>
</g>
<!-- ring_attn_1_13_stage_5&#45;&gt;ring_attn_1_13_stage_6 -->
<g id="edge1294" class="edge">
<title>ring_attn_1_13_stage_5&#45;&gt;ring_attn_1_13_stage_6</title>
<path fill="none" stroke="black" d="M10105,-13894.87C10105,-13894.87 10105,-13788.25 10105,-13788.25"/>
<polygon fill="black" stroke="black" points="10108.5,-13788.25 10105,-13778.25 10101.5,-13788.25 10108.5,-13788.25"/>
</g>
<!-- ring_attn_1_14_stage_5 -->
<g id="node1405" class="node">
<title>ring_attn_1_14_stage_5</title>
<polygon fill="yellow" stroke="black" points="10692,-14031 10483,-13963 10692,-13895 10901,-13963 10692,-14031"/>
<text text-anchor="middle" x="10692" y="-13981.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-13966.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="10692" y="-13951.8" font-family="Times,serif" font-size="14.00">Q[14]×K[9]×V[9]</text>
<text text-anchor="middle" x="10692" y="-13936.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_13_stage_5&#45;&gt;ring_attn_1_14_stage_5 -->
<g id="edge3201" class="edge">
<title>ring_attn_1_13_stage_5&#45;&gt;ring_attn_1_14_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-13963C10314.02,-13963 10472.86,-13963 10472.86,-13963"/>
<polygon fill="red" stroke="red" points="10472.86,-13966.5 10482.86,-13963 10472.86,-13959.5 10472.86,-13966.5"/>
</g>
<!-- ring_attn_1_13_stage_6&#45;&gt;ring_attn_1_13_stage_7 -->
<g id="edge1295" class="edge">
<title>ring_attn_1_13_stage_6&#45;&gt;ring_attn_1_13_stage_7</title>
<path fill="none" stroke="black" d="M10105,-13641.87C10105,-13641.87 10105,-13535.25 10105,-13535.25"/>
<polygon fill="black" stroke="black" points="10108.5,-13535.25 10105,-13525.25 10101.5,-13535.25 10108.5,-13535.25"/>
</g>
<!-- ring_attn_1_14_stage_6 -->
<g id="node1406" class="node">
<title>ring_attn_1_14_stage_6</title>
<polygon fill="yellow" stroke="black" points="10692,-13778 10483,-13710 10692,-13642 10901,-13710 10692,-13778"/>
<text text-anchor="middle" x="10692" y="-13728.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-13713.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="10692" y="-13698.8" font-family="Times,serif" font-size="14.00">Q[14]×K[8]×V[8]</text>
<text text-anchor="middle" x="10692" y="-13683.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_13_stage_6&#45;&gt;ring_attn_1_14_stage_6 -->
<g id="edge3202" class="edge">
<title>ring_attn_1_13_stage_6&#45;&gt;ring_attn_1_14_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-13710C10314.02,-13710 10472.86,-13710 10472.86,-13710"/>
<polygon fill="red" stroke="red" points="10472.86,-13713.5 10482.86,-13710 10472.86,-13706.5 10472.86,-13713.5"/>
</g>
<!-- ring_attn_1_13_stage_7&#45;&gt;ring_attn_1_13_stage_8 -->
<g id="edge1296" class="edge">
<title>ring_attn_1_13_stage_7&#45;&gt;ring_attn_1_13_stage_8</title>
<path fill="none" stroke="black" d="M10105,-13388.87C10105,-13388.87 10105,-13282.25 10105,-13282.25"/>
<polygon fill="black" stroke="black" points="10108.5,-13282.25 10105,-13272.25 10101.5,-13282.25 10108.5,-13282.25"/>
</g>
<!-- ring_attn_1_14_stage_7 -->
<g id="node1407" class="node">
<title>ring_attn_1_14_stage_7</title>
<polygon fill="yellow" stroke="black" points="10692,-13525 10483,-13457 10692,-13389 10901,-13457 10692,-13525"/>
<text text-anchor="middle" x="10692" y="-13475.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-13460.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="10692" y="-13445.8" font-family="Times,serif" font-size="14.00">Q[14]×K[7]×V[7]</text>
<text text-anchor="middle" x="10692" y="-13430.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_13_stage_7&#45;&gt;ring_attn_1_14_stage_7 -->
<g id="edge3203" class="edge">
<title>ring_attn_1_13_stage_7&#45;&gt;ring_attn_1_14_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-13457C10314.02,-13457 10472.86,-13457 10472.86,-13457"/>
<polygon fill="red" stroke="red" points="10472.86,-13460.5 10482.86,-13457 10472.86,-13453.5 10472.86,-13460.5"/>
</g>
<!-- ring_attn_1_13_stage_8&#45;&gt;ring_attn_1_13_stage_9 -->
<g id="edge1297" class="edge">
<title>ring_attn_1_13_stage_8&#45;&gt;ring_attn_1_13_stage_9</title>
<path fill="none" stroke="black" d="M10105,-13135.87C10105,-13135.87 10105,-13029.25 10105,-13029.25"/>
<polygon fill="black" stroke="black" points="10108.5,-13029.25 10105,-13019.25 10101.5,-13029.25 10108.5,-13029.25"/>
</g>
<!-- ring_attn_1_14_stage_8 -->
<g id="node1408" class="node">
<title>ring_attn_1_14_stage_8</title>
<polygon fill="yellow" stroke="black" points="10692,-13272 10483,-13204 10692,-13136 10901,-13204 10692,-13272"/>
<text text-anchor="middle" x="10692" y="-13222.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-13207.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="10692" y="-13192.8" font-family="Times,serif" font-size="14.00">Q[14]×K[6]×V[6]</text>
<text text-anchor="middle" x="10692" y="-13177.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_13_stage_8&#45;&gt;ring_attn_1_14_stage_8 -->
<g id="edge3204" class="edge">
<title>ring_attn_1_13_stage_8&#45;&gt;ring_attn_1_14_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-13204C10314.02,-13204 10472.86,-13204 10472.86,-13204"/>
<polygon fill="red" stroke="red" points="10472.86,-13207.5 10482.86,-13204 10472.86,-13200.5 10472.86,-13207.5"/>
</g>
<!-- ring_attn_1_13_stage_9&#45;&gt;ring_attn_1_13_stage_10 -->
<g id="edge1298" class="edge">
<title>ring_attn_1_13_stage_9&#45;&gt;ring_attn_1_13_stage_10</title>
<path fill="none" stroke="black" d="M10105,-12882.87C10105,-12882.87 10105,-12776.25 10105,-12776.25"/>
<polygon fill="black" stroke="black" points="10108.5,-12776.25 10105,-12766.25 10101.5,-12776.25 10108.5,-12776.25"/>
</g>
<!-- ring_attn_1_14_stage_9 -->
<g id="node1409" class="node">
<title>ring_attn_1_14_stage_9</title>
<polygon fill="yellow" stroke="black" points="10692,-13019 10483,-12951 10692,-12883 10901,-12951 10692,-13019"/>
<text text-anchor="middle" x="10692" y="-12969.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-12954.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="10692" y="-12939.8" font-family="Times,serif" font-size="14.00">Q[14]×K[5]×V[5]</text>
<text text-anchor="middle" x="10692" y="-12924.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_13_stage_9&#45;&gt;ring_attn_1_14_stage_9 -->
<g id="edge3205" class="edge">
<title>ring_attn_1_13_stage_9&#45;&gt;ring_attn_1_14_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-12951C10314.02,-12951 10472.86,-12951 10472.86,-12951"/>
<polygon fill="red" stroke="red" points="10472.86,-12954.5 10482.86,-12951 10472.86,-12947.5 10472.86,-12954.5"/>
</g>
<!-- ring_attn_1_13_stage_10&#45;&gt;ring_attn_1_13_stage_11 -->
<g id="edge1299" class="edge">
<title>ring_attn_1_13_stage_10&#45;&gt;ring_attn_1_13_stage_11</title>
<path fill="none" stroke="black" d="M10105,-12629.87C10105,-12629.87 10105,-12523.25 10105,-12523.25"/>
<polygon fill="black" stroke="black" points="10108.5,-12523.25 10105,-12513.25 10101.5,-12523.25 10108.5,-12523.25"/>
</g>
<!-- ring_attn_1_14_stage_10 -->
<g id="node1410" class="node">
<title>ring_attn_1_14_stage_10</title>
<polygon fill="yellow" stroke="black" points="10692,-12766 10483,-12698 10692,-12630 10901,-12698 10692,-12766"/>
<text text-anchor="middle" x="10692" y="-12716.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-12701.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="10692" y="-12686.8" font-family="Times,serif" font-size="14.00">Q[14]×K[4]×V[4]</text>
<text text-anchor="middle" x="10692" y="-12671.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_13_stage_10&#45;&gt;ring_attn_1_14_stage_10 -->
<g id="edge3206" class="edge">
<title>ring_attn_1_13_stage_10&#45;&gt;ring_attn_1_14_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-12698C10314.02,-12698 10472.86,-12698 10472.86,-12698"/>
<polygon fill="red" stroke="red" points="10472.86,-12701.5 10482.86,-12698 10472.86,-12694.5 10472.86,-12701.5"/>
</g>
<!-- ring_attn_1_13_stage_11&#45;&gt;ring_attn_1_13_stage_12 -->
<g id="edge1300" class="edge">
<title>ring_attn_1_13_stage_11&#45;&gt;ring_attn_1_13_stage_12</title>
<path fill="none" stroke="black" d="M10105,-12376.87C10105,-12376.87 10105,-12270.25 10105,-12270.25"/>
<polygon fill="black" stroke="black" points="10108.5,-12270.25 10105,-12260.25 10101.5,-12270.25 10108.5,-12270.25"/>
</g>
<!-- ring_attn_1_14_stage_11 -->
<g id="node1411" class="node">
<title>ring_attn_1_14_stage_11</title>
<polygon fill="yellow" stroke="black" points="10692,-12513 10483,-12445 10692,-12377 10901,-12445 10692,-12513"/>
<text text-anchor="middle" x="10692" y="-12463.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-12448.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="10692" y="-12433.8" font-family="Times,serif" font-size="14.00">Q[14]×K[3]×V[3]</text>
<text text-anchor="middle" x="10692" y="-12418.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_13_stage_11&#45;&gt;ring_attn_1_14_stage_11 -->
<g id="edge3207" class="edge">
<title>ring_attn_1_13_stage_11&#45;&gt;ring_attn_1_14_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-12445C10314.02,-12445 10472.86,-12445 10472.86,-12445"/>
<polygon fill="red" stroke="red" points="10472.86,-12448.5 10482.86,-12445 10472.86,-12441.5 10472.86,-12448.5"/>
</g>
<!-- ring_attn_1_13_stage_12&#45;&gt;ring_attn_1_13_stage_13 -->
<g id="edge1301" class="edge">
<title>ring_attn_1_13_stage_12&#45;&gt;ring_attn_1_13_stage_13</title>
<path fill="none" stroke="black" d="M10105,-12123.87C10105,-12123.87 10105,-12017.25 10105,-12017.25"/>
<polygon fill="black" stroke="black" points="10108.5,-12017.25 10105,-12007.25 10101.5,-12017.25 10108.5,-12017.25"/>
</g>
<!-- ring_attn_1_14_stage_12 -->
<g id="node1412" class="node">
<title>ring_attn_1_14_stage_12</title>
<polygon fill="yellow" stroke="black" points="10692,-12260 10483,-12192 10692,-12124 10901,-12192 10692,-12260"/>
<text text-anchor="middle" x="10692" y="-12210.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-12195.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="10692" y="-12180.8" font-family="Times,serif" font-size="14.00">Q[14]×K[2]×V[2]</text>
<text text-anchor="middle" x="10692" y="-12165.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_13_stage_12&#45;&gt;ring_attn_1_14_stage_12 -->
<g id="edge3208" class="edge">
<title>ring_attn_1_13_stage_12&#45;&gt;ring_attn_1_14_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-12192C10314.02,-12192 10472.86,-12192 10472.86,-12192"/>
<polygon fill="red" stroke="red" points="10472.86,-12195.5 10482.86,-12192 10472.86,-12188.5 10472.86,-12195.5"/>
</g>
<!-- ring_attn_1_13_stage_13&#45;&gt;ring_attn_1_13_stage_14 -->
<g id="edge1302" class="edge">
<title>ring_attn_1_13_stage_13&#45;&gt;ring_attn_1_13_stage_14</title>
<path fill="none" stroke="black" d="M10105,-11870.87C10105,-11870.87 10105,-11764.25 10105,-11764.25"/>
<polygon fill="black" stroke="black" points="10108.5,-11764.25 10105,-11754.25 10101.5,-11764.25 10108.5,-11764.25"/>
</g>
<!-- ring_attn_1_14_stage_13 -->
<g id="node1413" class="node">
<title>ring_attn_1_14_stage_13</title>
<polygon fill="yellow" stroke="black" points="10692,-12007 10483,-11939 10692,-11871 10901,-11939 10692,-12007"/>
<text text-anchor="middle" x="10692" y="-11957.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-11942.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="10692" y="-11927.8" font-family="Times,serif" font-size="14.00">Q[14]×K[1]×V[1]</text>
<text text-anchor="middle" x="10692" y="-11912.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_13_stage_13&#45;&gt;ring_attn_1_14_stage_13 -->
<g id="edge3209" class="edge">
<title>ring_attn_1_13_stage_13&#45;&gt;ring_attn_1_14_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-11939C10314.02,-11939 10472.86,-11939 10472.86,-11939"/>
<polygon fill="red" stroke="red" points="10472.86,-11942.5 10482.86,-11939 10472.86,-11935.5 10472.86,-11942.5"/>
</g>
<!-- ring_attn_1_13_stage_14&#45;&gt;ring_attn_1_13_stage_15 -->
<g id="edge1303" class="edge">
<title>ring_attn_1_13_stage_14&#45;&gt;ring_attn_1_13_stage_15</title>
<path fill="none" stroke="black" d="M10105,-11617.87C10105,-11617.87 10105,-11511.25 10105,-11511.25"/>
<polygon fill="black" stroke="black" points="10108.5,-11511.25 10105,-11501.25 10101.5,-11511.25 10108.5,-11511.25"/>
</g>
<!-- ring_attn_1_14_stage_14 -->
<g id="node1414" class="node">
<title>ring_attn_1_14_stage_14</title>
<polygon fill="yellow" stroke="black" points="10692,-11754 10483,-11686 10692,-11618 10901,-11686 10692,-11754"/>
<text text-anchor="middle" x="10692" y="-11704.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-11689.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="10692" y="-11674.8" font-family="Times,serif" font-size="14.00">Q[14]×K[0]×V[0]</text>
<text text-anchor="middle" x="10692" y="-11659.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_13_stage_14&#45;&gt;ring_attn_1_14_stage_14 -->
<g id="edge3210" class="edge">
<title>ring_attn_1_13_stage_14&#45;&gt;ring_attn_1_14_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-11686C10314.02,-11686 10472.86,-11686 10472.86,-11686"/>
<polygon fill="red" stroke="red" points="10472.86,-11689.5 10482.86,-11686 10472.86,-11682.5 10472.86,-11689.5"/>
</g>
<!-- attn_out_1_13 -->
<g id="node1318" class="node">
<title>attn_out_1_13</title>
<polygon fill="none" stroke="black" points="10174.5,-11292 10035.5,-11292 10035.5,-11239 10174.5,-11239 10174.5,-11292"/>
<text text-anchor="middle" x="10105" y="-11276.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="10105" y="-11261.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="10105" y="-11246.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_1_13_stage_15&#45;&gt;attn_out_1_13 -->
<g id="edge1304" class="edge">
<title>ring_attn_1_13_stage_15&#45;&gt;attn_out_1_13</title>
<path fill="none" stroke="black" d="M10105,-11364.87C10105,-11364.87 10105,-11302.18 10105,-11302.18"/>
<polygon fill="black" stroke="black" points="10108.5,-11302.18 10105,-11292.18 10101.5,-11302.18 10108.5,-11302.18"/>
</g>
<!-- ring_attn_1_14_stage_15 -->
<g id="node1415" class="node">
<title>ring_attn_1_14_stage_15</title>
<polygon fill="yellow" stroke="black" points="10692,-11501 10483,-11433 10692,-11365 10901,-11433 10692,-11501"/>
<text text-anchor="middle" x="10692" y="-11451.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-11436.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="10692" y="-11421.8" font-family="Times,serif" font-size="14.00">Q[14]×K[15]×V[15]</text>
<text text-anchor="middle" x="10692" y="-11406.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_13_stage_15&#45;&gt;ring_attn_1_14_stage_15 -->
<g id="edge3211" class="edge">
<title>ring_attn_1_13_stage_15&#45;&gt;ring_attn_1_14_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-11433C10314.02,-11433 10472.86,-11433 10472.86,-11433"/>
<polygon fill="red" stroke="red" points="10472.86,-11436.5 10482.86,-11433 10472.86,-11429.5 10472.86,-11436.5"/>
</g>
<!-- attn_residual_1_13 -->
<g id="node1319" class="node">
<title>attn_residual_1_13</title>
<ellipse fill="none" stroke="black" cx="10105" cy="-11139" rx="105.5" ry="27"/>
<text text-anchor="middle" x="10105" y="-11142.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="10105" y="-11127.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_1_13&#45;&gt;attn_residual_1_13 -->
<g id="edge1305" class="edge">
<title>attn_out_1_13&#45;&gt;attn_residual_1_13</title>
<path fill="none" stroke="black" d="M10105,-11238.98C10105,-11238.98 10105,-11176.36 10105,-11176.36"/>
<polygon fill="black" stroke="black" points="10108.5,-11176.36 10105,-11166.36 10101.5,-11176.36 10108.5,-11176.36"/>
</g>
<!-- gate_1_13 -->
<g id="node1320" class="node">
<title>gate_1_13</title>
<ellipse fill="orange" stroke="black" cx="10105" cy="-11001.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="10105" y="-11012.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="10105" y="-10997.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="10105" y="-10982.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_1_13&#45;&gt;gate_1_13 -->
<g id="edge1306" class="edge">
<title>attn_residual_1_13&#45;&gt;gate_1_13</title>
<path fill="none" stroke="black" d="M10105,-11111.83C10105,-11111.83 10105,-11049.02 10105,-11049.02"/>
<polygon fill="black" stroke="black" points="10108.5,-11049.02 10105,-11039.02 10101.5,-11049.02 10108.5,-11049.02"/>
</g>
<!-- gate_1_13&#45;&gt;expert_1_0_0 -->
<g id="edge3212" class="edge">
<title>gate_1_13&#45;&gt;expert_1_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10007.94,-10986.72C10007.94,-10949.16 10007.94,-10853 10007.94,-10853 10007.94,-10853 175.77,-10853 175.77,-10853 175.77,-10853 175.77,-10842.03 175.77,-10842.03"/>
<polygon fill="blue" stroke="blue" points="179.27,-10842.03 175.77,-10832.03 172.27,-10842.03 179.27,-10842.03"/>
<text text-anchor="middle" x="42926.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42926.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU13→GPU0</text>
<text text-anchor="middle" x="42926.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42926.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_13&#45;&gt;expert_1_1_0 -->
<g id="edge3213" class="edge">
<title>gate_1_13&#45;&gt;expert_1_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10024.82,-10977.08C10024.82,-10932.62 10024.82,-10843 10024.82,-10843 10024.82,-10843 3022.64,-10843 3022.64,-10843 3022.64,-10843 3022.64,-10841.94 3022.64,-10841.94"/>
<polygon fill="blue" stroke="blue" points="3026.14,-10842.35 3022.64,-10832.35 3019.14,-10842.35 3026.14,-10842.35"/>
<text text-anchor="middle" x="43100.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43100.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU13→GPU1</text>
<text text-anchor="middle" x="43100.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43100.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_13&#45;&gt;expert_1_2_0 -->
<g id="edge3214" class="edge">
<title>gate_1_13&#45;&gt;expert_1_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10041.7,-10971.45C10041.7,-10928.06 10041.7,-10853 10041.7,-10853 10041.7,-10853 3636.28,-10853 3636.28,-10853 3636.28,-10853 3636.28,-10842.03 3636.28,-10842.03"/>
<polygon fill="blue" stroke="blue" points="3639.78,-10842.03 3636.28,-10832.03 3632.78,-10842.03 3639.78,-10842.03"/>
<text text-anchor="middle" x="43274.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43274.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU13→GPU2</text>
<text text-anchor="middle" x="43274.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43274.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_13&#45;&gt;expert_1_3_0 -->
<g id="edge3215" class="edge">
<title>gate_1_13&#45;&gt;expert_1_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10058.58,-10967.75C10058.58,-10924.77 10058.58,-10856 10058.58,-10856 10058.58,-10856 4230.78,-10856 4230.78,-10856 4230.78,-10856 4230.78,-10842.23 4230.78,-10842.23"/>
<polygon fill="blue" stroke="blue" points="4234.28,-10842.23 4230.78,-10832.23 4227.28,-10842.23 4234.28,-10842.23"/>
<text text-anchor="middle" x="43448.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43448.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU13→GPU3</text>
<text text-anchor="middle" x="43448.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43448.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_13&#45;&gt;expert_1_4_0 -->
<g id="edge3216" class="edge">
<title>gate_1_13&#45;&gt;expert_1_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10075.46,-10965.26C10075.46,-10917.64 10075.46,-10840 10075.46,-10840 10075.46,-10840 4837.07,-10840 4837.07,-10840 4837.07,-10840 4837.07,-10839.23 4837.07,-10839.23"/>
<polygon fill="blue" stroke="blue" points="4840.57,-10842.34 4837.07,-10832.34 4833.57,-10842.34 4840.57,-10842.34"/>
<text text-anchor="middle" x="43622.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43622.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU13→GPU4</text>
<text text-anchor="middle" x="43622.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43622.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_13&#45;&gt;expert_1_5_0 -->
<g id="edge3217" class="edge">
<title>gate_1_13&#45;&gt;expert_1_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10092.34,-10963.99C10092.34,-10915.72 10092.34,-10838 10092.34,-10838 10092.34,-10838 5434.12,-10838 5434.12,-10838 5434.12,-10838 5434.12,-10837.4 5434.12,-10837.4"/>
<polygon fill="blue" stroke="blue" points="5437.62,-10842.04 5434.12,-10832.04 5430.62,-10842.04 5437.62,-10842.04"/>
<text text-anchor="middle" x="43796.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43796.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU13→GPU5</text>
<text text-anchor="middle" x="43796.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43796.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_13&#45;&gt;expert_1_6_0 -->
<g id="edge3218" class="edge">
<title>gate_1_13&#45;&gt;expert_1_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10109.22,-10963.89C10109.22,-10926.6 10109.22,-10875 10109.22,-10875 10109.22,-10875 6017.1,-10875 6017.1,-10875 6017.1,-10875 6017.1,-10842.17 6017.1,-10842.17"/>
<polygon fill="blue" stroke="blue" points="6020.6,-10842.17 6017.1,-10832.17 6013.6,-10842.17 6020.6,-10842.17"/>
<text text-anchor="middle" x="43970.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43970.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU13→GPU6</text>
<text text-anchor="middle" x="43970.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43970.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_13&#45;&gt;expert_1_7_0 -->
<g id="edge3219" class="edge">
<title>gate_1_13&#45;&gt;expert_1_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10126.1,-10964.64C10126.1,-10931.17 10126.1,-10887 10126.1,-10887 10126.1,-10887 6608.12,-10887 6608.12,-10887 6608.12,-10887 6608.12,-10842.19 6608.12,-10842.19"/>
<polygon fill="blue" stroke="blue" points="6611.62,-10842.19 6608.12,-10832.19 6604.62,-10842.19 6611.62,-10842.19"/>
<text text-anchor="middle" x="44144.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="44144.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU13→GPU7</text>
<text text-anchor="middle" x="44144.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="44144.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_13&#45;&gt;expert_1_8_0 -->
<g id="edge3220" class="edge">
<title>gate_1_13&#45;&gt;expert_1_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10142.98,-10966.33C10142.98,-10935.31 10142.98,-10895 10142.98,-10895 10142.98,-10895 7192.93,-10895 7192.93,-10895 7192.93,-10895 7192.93,-10842.35 7192.93,-10842.35"/>
<polygon fill="blue" stroke="blue" points="7196.43,-10842.35 7192.93,-10832.35 7189.43,-10842.35 7196.43,-10842.35"/>
<text text-anchor="middle" x="44318.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="44318.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU13→GPU8</text>
<text text-anchor="middle" x="44318.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="44318.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_13&#45;&gt;expert_1_9_0 -->
<g id="edge3221" class="edge">
<title>gate_1_13&#45;&gt;expert_1_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10159.86,-10969.3C10159.86,-10940.91 10159.86,-10904 10159.86,-10904 10159.86,-10904 7785.77,-10904 7785.77,-10904 7785.77,-10904 7785.77,-10842.16 7785.77,-10842.16"/>
<polygon fill="blue" stroke="blue" points="7789.27,-10842.16 7785.77,-10832.16 7782.27,-10842.16 7789.27,-10842.16"/>
<text text-anchor="middle" x="44492.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="44492.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU13→GPU9</text>
<text text-anchor="middle" x="44492.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="44492.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_13&#45;&gt;expert_1_10_0 -->
<g id="edge3222" class="edge">
<title>gate_1_13&#45;&gt;expert_1_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10176.74,-10973.55C10176.74,-10946.64 10176.74,-10910 10176.74,-10910 10176.74,-10910 8379.17,-10910 8379.17,-10910 8379.17,-10910 8379.17,-10842.14 8379.17,-10842.14"/>
<polygon fill="blue" stroke="blue" points="8382.67,-10842.14 8379.17,-10832.14 8375.67,-10842.14 8382.67,-10842.14"/>
<text text-anchor="middle" x="44666.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="44666.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU13→GPU10</text>
<text text-anchor="middle" x="44666.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="44666.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_13&#45;&gt;expert_1_11_0 -->
<g id="edge3223" class="edge">
<title>gate_1_13&#45;&gt;expert_1_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10185.18,-10977.04C10185.18,-10964.57 10185.18,-10952 10185.18,-10952 10185.18,-10952 9045.5,-10952 9045.5,-10952 9045.5,-10952 9045.5,-10842.03 9045.5,-10842.03"/>
<polygon fill="blue" stroke="blue" points="9049,-10842.03 9045.5,-10832.03 9042,-10842.03 9049,-10842.03"/>
<text text-anchor="middle" x="44840.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="44840.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU13→GPU11</text>
<text text-anchor="middle" x="44840.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="44840.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_13&#45;&gt;expert_1_12_0 -->
<g id="edge3224" class="edge">
<title>gate_1_13&#45;&gt;expert_1_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10005.3,-11014C9865.46,-11014 9628,-11014 9628,-11014 9628,-11014 9628,-10842.33 9628,-10842.33"/>
<polygon fill="blue" stroke="blue" points="9631.5,-10842.33 9628,-10832.33 9624.5,-10842.33 9631.5,-10842.33"/>
<text text-anchor="middle" x="45014.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45014.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU13→GPU12</text>
<text text-anchor="middle" x="45014.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45014.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_13&#45;&gt;expert_1_13_0 -->
<g id="edge1307" class="edge">
<title>gate_1_13&#45;&gt;expert_1_13_0</title>
<path fill="none" stroke="black" d="M10193.62,-10980.9C10193.62,-10980.9 10193.62,-10842.03 10193.62,-10842.03"/>
<polygon fill="black" stroke="black" points="10197.12,-10842.03 10193.62,-10832.03 10190.12,-10842.03 10197.12,-10842.03"/>
</g>
<!-- gate_1_13&#45;&gt;expert_1_14_0 -->
<g id="edge3225" class="edge">
<title>gate_1_13&#45;&gt;expert_1_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10204.52,-10989C10344.09,-10989 10581.1,-10989 10581.1,-10989 10581.1,-10989 10581.1,-10842.18 10581.1,-10842.18"/>
<polygon fill="blue" stroke="blue" points="10584.6,-10842.18 10581.1,-10832.18 10577.6,-10842.18 10584.6,-10842.18"/>
<text text-anchor="middle" x="45188.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45188.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU13→GPU14</text>
<text text-anchor="middle" x="45188.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45188.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_13&#45;&gt;expert_1_15_0 -->
<g id="edge3226" class="edge">
<title>gate_1_13&#45;&gt;expert_1_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10202.06,-10986.79C10202.06,-10975.56 10202.06,-10962 10202.06,-10962 10202.06,-10962 11165.06,-10962 11165.06,-10962 11165.06,-10962 11165.06,-10842.05 11165.06,-10842.05"/>
<polygon fill="blue" stroke="blue" points="11168.56,-10842.05 11165.06,-10832.05 11161.56,-10842.05 11168.56,-10842.05"/>
<text text-anchor="middle" x="45362.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45362.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU13→GPU15</text>
<text text-anchor="middle" x="45362.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45362.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_13 -->
<g id="node1322" class="node">
<title>expert_reduce_1_13</title>
<ellipse fill="none" stroke="black" cx="10105" cy="-10668.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="10105" y="-10679.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="10105" y="-10664.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="10105" y="-10649.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_13_0&#45;&gt;expert_reduce_1_13 -->
<g id="edge1308" class="edge">
<title>expert_1_13_0&#45;&gt;expert_reduce_1_13</title>
<path fill="none" stroke="black" d="M10105,-10778.76C10105,-10778.76 10105,-10716.06 10105,-10716.06"/>
<polygon fill="black" stroke="black" points="10108.5,-10716.06 10105,-10706.06 10101.5,-10716.06 10108.5,-10716.06"/>
</g>
<!-- moe_residual_1_13 -->
<g id="node1323" class="node">
<title>moe_residual_1_13</title>
<ellipse fill="none" stroke="black" cx="10105" cy="-10531" rx="105.5" ry="27"/>
<text text-anchor="middle" x="10105" y="-10534.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="10105" y="-10519.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_13&#45;&gt;moe_residual_1_13 -->
<g id="edge1309" class="edge">
<title>expert_reduce_1_13&#45;&gt;moe_residual_1_13</title>
<path fill="none" stroke="black" d="M10105,-10630.93C10105,-10630.93 10105,-10568.06 10105,-10568.06"/>
<polygon fill="black" stroke="black" points="10108.5,-10568.06 10105,-10558.06 10101.5,-10568.06 10108.5,-10568.06"/>
</g>
<!-- qkv_proj_2_13 -->
<g id="node1324" class="node">
<title>qkv_proj_2_13</title>
<polygon fill="none" stroke="black" points="10187.5,-10431 10022.5,-10431 10022.5,-10378 10187.5,-10378 10187.5,-10431"/>
<text text-anchor="middle" x="10105" y="-10415.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="10105" y="-10400.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="10105" y="-10385.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_1_13&#45;&gt;qkv_proj_2_13 -->
<g id="edge1310" class="edge">
<title>moe_residual_1_13&#45;&gt;qkv_proj_2_13</title>
<path fill="none" stroke="black" d="M10105,-10503.86C10105,-10503.86 10105,-10441.16 10105,-10441.16"/>
<polygon fill="black" stroke="black" points="10108.5,-10441.16 10105,-10431.16 10101.5,-10441.16 10108.5,-10441.16"/>
</g>
<!-- qkv_reshape_2_13 -->
<g id="node1325" class="node">
<title>qkv_reshape_2_13</title>
<ellipse fill="none" stroke="black" cx="10105" cy="-10278" rx="148" ry="27"/>
<text text-anchor="middle" x="10105" y="-10281.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="10105" y="-10266.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_2_13&#45;&gt;qkv_reshape_2_13 -->
<g id="edge1311" class="edge">
<title>qkv_proj_2_13&#45;&gt;qkv_reshape_2_13</title>
<path fill="none" stroke="black" d="M10105,-10377.98C10105,-10377.98 10105,-10315.36 10105,-10315.36"/>
<polygon fill="black" stroke="black" points="10108.5,-10315.36 10105,-10305.36 10101.5,-10315.36 10108.5,-10315.36"/>
</g>
<!-- qkv_reshape_2_13&#45;&gt;ring_attn_2_13_stage_0 -->
<g id="edge1312" class="edge">
<title>qkv_reshape_2_13&#45;&gt;ring_attn_2_13_stage_0</title>
<path fill="none" stroke="black" d="M10105,-10250.72C10105,-10250.72 10105,-10144.16 10105,-10144.16"/>
<polygon fill="black" stroke="black" points="10108.5,-10144.16 10105,-10134.16 10101.5,-10144.16 10108.5,-10144.16"/>
</g>
<!-- ring_attn_2_13_stage_0&#45;&gt;ring_attn_2_13_stage_1 -->
<g id="edge1313" class="edge">
<title>ring_attn_2_13_stage_0&#45;&gt;ring_attn_2_13_stage_1</title>
<path fill="none" stroke="black" d="M10105,-9997.87C10105,-9997.87 10105,-9891.25 10105,-9891.25"/>
<polygon fill="black" stroke="black" points="10108.5,-9891.25 10105,-9881.25 10101.5,-9891.25 10108.5,-9891.25"/>
</g>
<!-- ring_attn_2_14_stage_0 -->
<g id="node1424" class="node">
<title>ring_attn_2_14_stage_0</title>
<polygon fill="yellow" stroke="black" points="10692,-10134 10483,-10066 10692,-9998 10901,-10066 10692,-10134"/>
<text text-anchor="middle" x="10692" y="-10084.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-10069.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="10692" y="-10054.8" font-family="Times,serif" font-size="14.00">Q[14]×K[14]×V[14]</text>
<text text-anchor="middle" x="10692" y="-10039.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_13_stage_0&#45;&gt;ring_attn_2_14_stage_0 -->
<g id="edge3227" class="edge">
<title>ring_attn_2_13_stage_0&#45;&gt;ring_attn_2_14_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-10066C10314.02,-10066 10472.86,-10066 10472.86,-10066"/>
<polygon fill="red" stroke="red" points="10472.86,-10069.5 10482.86,-10066 10472.86,-10062.5 10472.86,-10069.5"/>
</g>
<!-- ring_attn_2_13_stage_1&#45;&gt;ring_attn_2_13_stage_2 -->
<g id="edge1314" class="edge">
<title>ring_attn_2_13_stage_1&#45;&gt;ring_attn_2_13_stage_2</title>
<path fill="none" stroke="black" d="M10105,-9744.87C10105,-9744.87 10105,-9638.25 10105,-9638.25"/>
<polygon fill="black" stroke="black" points="10108.5,-9638.25 10105,-9628.25 10101.5,-9638.25 10108.5,-9638.25"/>
</g>
<!-- ring_attn_2_14_stage_1 -->
<g id="node1425" class="node">
<title>ring_attn_2_14_stage_1</title>
<polygon fill="yellow" stroke="black" points="10692,-9881 10483,-9813 10692,-9745 10901,-9813 10692,-9881"/>
<text text-anchor="middle" x="10692" y="-9831.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-9816.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="10692" y="-9801.8" font-family="Times,serif" font-size="14.00">Q[14]×K[13]×V[13]</text>
<text text-anchor="middle" x="10692" y="-9786.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_13_stage_1&#45;&gt;ring_attn_2_14_stage_1 -->
<g id="edge3228" class="edge">
<title>ring_attn_2_13_stage_1&#45;&gt;ring_attn_2_14_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-9813C10314.02,-9813 10472.86,-9813 10472.86,-9813"/>
<polygon fill="red" stroke="red" points="10472.86,-9816.5 10482.86,-9813 10472.86,-9809.5 10472.86,-9816.5"/>
</g>
<!-- ring_attn_2_13_stage_2&#45;&gt;ring_attn_2_13_stage_3 -->
<g id="edge1315" class="edge">
<title>ring_attn_2_13_stage_2&#45;&gt;ring_attn_2_13_stage_3</title>
<path fill="none" stroke="black" d="M10105,-9491.87C10105,-9491.87 10105,-9385.25 10105,-9385.25"/>
<polygon fill="black" stroke="black" points="10108.5,-9385.25 10105,-9375.25 10101.5,-9385.25 10108.5,-9385.25"/>
</g>
<!-- ring_attn_2_14_stage_2 -->
<g id="node1426" class="node">
<title>ring_attn_2_14_stage_2</title>
<polygon fill="yellow" stroke="black" points="10692,-9628 10483,-9560 10692,-9492 10901,-9560 10692,-9628"/>
<text text-anchor="middle" x="10692" y="-9578.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-9563.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="10692" y="-9548.8" font-family="Times,serif" font-size="14.00">Q[14]×K[12]×V[12]</text>
<text text-anchor="middle" x="10692" y="-9533.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_13_stage_2&#45;&gt;ring_attn_2_14_stage_2 -->
<g id="edge3229" class="edge">
<title>ring_attn_2_13_stage_2&#45;&gt;ring_attn_2_14_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-9560C10314.02,-9560 10472.86,-9560 10472.86,-9560"/>
<polygon fill="red" stroke="red" points="10472.86,-9563.5 10482.86,-9560 10472.86,-9556.5 10472.86,-9563.5"/>
</g>
<!-- ring_attn_2_13_stage_3&#45;&gt;ring_attn_2_13_stage_4 -->
<g id="edge1316" class="edge">
<title>ring_attn_2_13_stage_3&#45;&gt;ring_attn_2_13_stage_4</title>
<path fill="none" stroke="black" d="M10105,-9238.87C10105,-9238.87 10105,-9132.25 10105,-9132.25"/>
<polygon fill="black" stroke="black" points="10108.5,-9132.25 10105,-9122.25 10101.5,-9132.25 10108.5,-9132.25"/>
</g>
<!-- ring_attn_2_14_stage_3 -->
<g id="node1427" class="node">
<title>ring_attn_2_14_stage_3</title>
<polygon fill="yellow" stroke="black" points="10692,-9375 10483,-9307 10692,-9239 10901,-9307 10692,-9375"/>
<text text-anchor="middle" x="10692" y="-9325.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-9310.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="10692" y="-9295.8" font-family="Times,serif" font-size="14.00">Q[14]×K[11]×V[11]</text>
<text text-anchor="middle" x="10692" y="-9280.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_13_stage_3&#45;&gt;ring_attn_2_14_stage_3 -->
<g id="edge3230" class="edge">
<title>ring_attn_2_13_stage_3&#45;&gt;ring_attn_2_14_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-9307C10314.02,-9307 10472.86,-9307 10472.86,-9307"/>
<polygon fill="red" stroke="red" points="10472.86,-9310.5 10482.86,-9307 10472.86,-9303.5 10472.86,-9310.5"/>
</g>
<!-- ring_attn_2_13_stage_4&#45;&gt;ring_attn_2_13_stage_5 -->
<g id="edge1317" class="edge">
<title>ring_attn_2_13_stage_4&#45;&gt;ring_attn_2_13_stage_5</title>
<path fill="none" stroke="black" d="M10105,-8985.87C10105,-8985.87 10105,-8879.25 10105,-8879.25"/>
<polygon fill="black" stroke="black" points="10108.5,-8879.25 10105,-8869.25 10101.5,-8879.25 10108.5,-8879.25"/>
</g>
<!-- ring_attn_2_14_stage_4 -->
<g id="node1428" class="node">
<title>ring_attn_2_14_stage_4</title>
<polygon fill="yellow" stroke="black" points="10692,-9122 10483,-9054 10692,-8986 10901,-9054 10692,-9122"/>
<text text-anchor="middle" x="10692" y="-9072.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-9057.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="10692" y="-9042.8" font-family="Times,serif" font-size="14.00">Q[14]×K[10]×V[10]</text>
<text text-anchor="middle" x="10692" y="-9027.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_13_stage_4&#45;&gt;ring_attn_2_14_stage_4 -->
<g id="edge3231" class="edge">
<title>ring_attn_2_13_stage_4&#45;&gt;ring_attn_2_14_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-9054C10314.02,-9054 10472.86,-9054 10472.86,-9054"/>
<polygon fill="red" stroke="red" points="10472.86,-9057.5 10482.86,-9054 10472.86,-9050.5 10472.86,-9057.5"/>
</g>
<!-- ring_attn_2_13_stage_5&#45;&gt;ring_attn_2_13_stage_6 -->
<g id="edge1318" class="edge">
<title>ring_attn_2_13_stage_5&#45;&gt;ring_attn_2_13_stage_6</title>
<path fill="none" stroke="black" d="M10105,-8732.87C10105,-8732.87 10105,-8626.25 10105,-8626.25"/>
<polygon fill="black" stroke="black" points="10108.5,-8626.25 10105,-8616.25 10101.5,-8626.25 10108.5,-8626.25"/>
</g>
<!-- ring_attn_2_14_stage_5 -->
<g id="node1429" class="node">
<title>ring_attn_2_14_stage_5</title>
<polygon fill="yellow" stroke="black" points="10692,-8869 10483,-8801 10692,-8733 10901,-8801 10692,-8869"/>
<text text-anchor="middle" x="10692" y="-8819.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-8804.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="10692" y="-8789.8" font-family="Times,serif" font-size="14.00">Q[14]×K[9]×V[9]</text>
<text text-anchor="middle" x="10692" y="-8774.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_13_stage_5&#45;&gt;ring_attn_2_14_stage_5 -->
<g id="edge3232" class="edge">
<title>ring_attn_2_13_stage_5&#45;&gt;ring_attn_2_14_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-8801C10314.02,-8801 10472.86,-8801 10472.86,-8801"/>
<polygon fill="red" stroke="red" points="10472.86,-8804.5 10482.86,-8801 10472.86,-8797.5 10472.86,-8804.5"/>
</g>
<!-- ring_attn_2_13_stage_6&#45;&gt;ring_attn_2_13_stage_7 -->
<g id="edge1319" class="edge">
<title>ring_attn_2_13_stage_6&#45;&gt;ring_attn_2_13_stage_7</title>
<path fill="none" stroke="black" d="M10105,-8479.87C10105,-8479.87 10105,-8373.25 10105,-8373.25"/>
<polygon fill="black" stroke="black" points="10108.5,-8373.25 10105,-8363.25 10101.5,-8373.25 10108.5,-8373.25"/>
</g>
<!-- ring_attn_2_14_stage_6 -->
<g id="node1430" class="node">
<title>ring_attn_2_14_stage_6</title>
<polygon fill="yellow" stroke="black" points="10692,-8616 10483,-8548 10692,-8480 10901,-8548 10692,-8616"/>
<text text-anchor="middle" x="10692" y="-8566.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-8551.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="10692" y="-8536.8" font-family="Times,serif" font-size="14.00">Q[14]×K[8]×V[8]</text>
<text text-anchor="middle" x="10692" y="-8521.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_13_stage_6&#45;&gt;ring_attn_2_14_stage_6 -->
<g id="edge3233" class="edge">
<title>ring_attn_2_13_stage_6&#45;&gt;ring_attn_2_14_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-8548C10314.02,-8548 10472.86,-8548 10472.86,-8548"/>
<polygon fill="red" stroke="red" points="10472.86,-8551.5 10482.86,-8548 10472.86,-8544.5 10472.86,-8551.5"/>
</g>
<!-- ring_attn_2_13_stage_7&#45;&gt;ring_attn_2_13_stage_8 -->
<g id="edge1320" class="edge">
<title>ring_attn_2_13_stage_7&#45;&gt;ring_attn_2_13_stage_8</title>
<path fill="none" stroke="black" d="M10105,-8226.87C10105,-8226.87 10105,-8120.25 10105,-8120.25"/>
<polygon fill="black" stroke="black" points="10108.5,-8120.25 10105,-8110.25 10101.5,-8120.25 10108.5,-8120.25"/>
</g>
<!-- ring_attn_2_14_stage_7 -->
<g id="node1431" class="node">
<title>ring_attn_2_14_stage_7</title>
<polygon fill="yellow" stroke="black" points="10692,-8363 10483,-8295 10692,-8227 10901,-8295 10692,-8363"/>
<text text-anchor="middle" x="10692" y="-8313.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-8298.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="10692" y="-8283.8" font-family="Times,serif" font-size="14.00">Q[14]×K[7]×V[7]</text>
<text text-anchor="middle" x="10692" y="-8268.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_13_stage_7&#45;&gt;ring_attn_2_14_stage_7 -->
<g id="edge3234" class="edge">
<title>ring_attn_2_13_stage_7&#45;&gt;ring_attn_2_14_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-8295C10314.02,-8295 10472.86,-8295 10472.86,-8295"/>
<polygon fill="red" stroke="red" points="10472.86,-8298.5 10482.86,-8295 10472.86,-8291.5 10472.86,-8298.5"/>
</g>
<!-- ring_attn_2_13_stage_8&#45;&gt;ring_attn_2_13_stage_9 -->
<g id="edge1321" class="edge">
<title>ring_attn_2_13_stage_8&#45;&gt;ring_attn_2_13_stage_9</title>
<path fill="none" stroke="black" d="M10105,-7973.87C10105,-7973.87 10105,-7867.25 10105,-7867.25"/>
<polygon fill="black" stroke="black" points="10108.5,-7867.25 10105,-7857.25 10101.5,-7867.25 10108.5,-7867.25"/>
</g>
<!-- ring_attn_2_14_stage_8 -->
<g id="node1432" class="node">
<title>ring_attn_2_14_stage_8</title>
<polygon fill="yellow" stroke="black" points="10692,-8110 10483,-8042 10692,-7974 10901,-8042 10692,-8110"/>
<text text-anchor="middle" x="10692" y="-8060.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-8045.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="10692" y="-8030.8" font-family="Times,serif" font-size="14.00">Q[14]×K[6]×V[6]</text>
<text text-anchor="middle" x="10692" y="-8015.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_13_stage_8&#45;&gt;ring_attn_2_14_stage_8 -->
<g id="edge3235" class="edge">
<title>ring_attn_2_13_stage_8&#45;&gt;ring_attn_2_14_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-8042C10314.02,-8042 10472.86,-8042 10472.86,-8042"/>
<polygon fill="red" stroke="red" points="10472.86,-8045.5 10482.86,-8042 10472.86,-8038.5 10472.86,-8045.5"/>
</g>
<!-- ring_attn_2_13_stage_9&#45;&gt;ring_attn_2_13_stage_10 -->
<g id="edge1322" class="edge">
<title>ring_attn_2_13_stage_9&#45;&gt;ring_attn_2_13_stage_10</title>
<path fill="none" stroke="black" d="M10105,-7720.87C10105,-7720.87 10105,-7614.25 10105,-7614.25"/>
<polygon fill="black" stroke="black" points="10108.5,-7614.25 10105,-7604.25 10101.5,-7614.25 10108.5,-7614.25"/>
</g>
<!-- ring_attn_2_14_stage_9 -->
<g id="node1433" class="node">
<title>ring_attn_2_14_stage_9</title>
<polygon fill="yellow" stroke="black" points="10692,-7857 10483,-7789 10692,-7721 10901,-7789 10692,-7857"/>
<text text-anchor="middle" x="10692" y="-7807.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-7792.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="10692" y="-7777.8" font-family="Times,serif" font-size="14.00">Q[14]×K[5]×V[5]</text>
<text text-anchor="middle" x="10692" y="-7762.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_13_stage_9&#45;&gt;ring_attn_2_14_stage_9 -->
<g id="edge3236" class="edge">
<title>ring_attn_2_13_stage_9&#45;&gt;ring_attn_2_14_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-7789C10314.02,-7789 10472.86,-7789 10472.86,-7789"/>
<polygon fill="red" stroke="red" points="10472.86,-7792.5 10482.86,-7789 10472.86,-7785.5 10472.86,-7792.5"/>
</g>
<!-- ring_attn_2_13_stage_10&#45;&gt;ring_attn_2_13_stage_11 -->
<g id="edge1323" class="edge">
<title>ring_attn_2_13_stage_10&#45;&gt;ring_attn_2_13_stage_11</title>
<path fill="none" stroke="black" d="M10105,-7467.87C10105,-7467.87 10105,-7361.25 10105,-7361.25"/>
<polygon fill="black" stroke="black" points="10108.5,-7361.25 10105,-7351.25 10101.5,-7361.25 10108.5,-7361.25"/>
</g>
<!-- ring_attn_2_14_stage_10 -->
<g id="node1434" class="node">
<title>ring_attn_2_14_stage_10</title>
<polygon fill="yellow" stroke="black" points="10692,-7604 10483,-7536 10692,-7468 10901,-7536 10692,-7604"/>
<text text-anchor="middle" x="10692" y="-7554.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-7539.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="10692" y="-7524.8" font-family="Times,serif" font-size="14.00">Q[14]×K[4]×V[4]</text>
<text text-anchor="middle" x="10692" y="-7509.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_13_stage_10&#45;&gt;ring_attn_2_14_stage_10 -->
<g id="edge3237" class="edge">
<title>ring_attn_2_13_stage_10&#45;&gt;ring_attn_2_14_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-7536C10314.02,-7536 10472.86,-7536 10472.86,-7536"/>
<polygon fill="red" stroke="red" points="10472.86,-7539.5 10482.86,-7536 10472.86,-7532.5 10472.86,-7539.5"/>
</g>
<!-- ring_attn_2_13_stage_11&#45;&gt;ring_attn_2_13_stage_12 -->
<g id="edge1324" class="edge">
<title>ring_attn_2_13_stage_11&#45;&gt;ring_attn_2_13_stage_12</title>
<path fill="none" stroke="black" d="M10105,-7214.87C10105,-7214.87 10105,-7108.25 10105,-7108.25"/>
<polygon fill="black" stroke="black" points="10108.5,-7108.25 10105,-7098.25 10101.5,-7108.25 10108.5,-7108.25"/>
</g>
<!-- ring_attn_2_14_stage_11 -->
<g id="node1435" class="node">
<title>ring_attn_2_14_stage_11</title>
<polygon fill="yellow" stroke="black" points="10692,-7351 10483,-7283 10692,-7215 10901,-7283 10692,-7351"/>
<text text-anchor="middle" x="10692" y="-7301.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-7286.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="10692" y="-7271.8" font-family="Times,serif" font-size="14.00">Q[14]×K[3]×V[3]</text>
<text text-anchor="middle" x="10692" y="-7256.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_13_stage_11&#45;&gt;ring_attn_2_14_stage_11 -->
<g id="edge3238" class="edge">
<title>ring_attn_2_13_stage_11&#45;&gt;ring_attn_2_14_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-7283C10314.02,-7283 10472.86,-7283 10472.86,-7283"/>
<polygon fill="red" stroke="red" points="10472.86,-7286.5 10482.86,-7283 10472.86,-7279.5 10472.86,-7286.5"/>
</g>
<!-- ring_attn_2_13_stage_12&#45;&gt;ring_attn_2_13_stage_13 -->
<g id="edge1325" class="edge">
<title>ring_attn_2_13_stage_12&#45;&gt;ring_attn_2_13_stage_13</title>
<path fill="none" stroke="black" d="M10105,-6961.87C10105,-6961.87 10105,-6855.25 10105,-6855.25"/>
<polygon fill="black" stroke="black" points="10108.5,-6855.25 10105,-6845.25 10101.5,-6855.25 10108.5,-6855.25"/>
</g>
<!-- ring_attn_2_14_stage_12 -->
<g id="node1436" class="node">
<title>ring_attn_2_14_stage_12</title>
<polygon fill="yellow" stroke="black" points="10692,-7098 10483,-7030 10692,-6962 10901,-7030 10692,-7098"/>
<text text-anchor="middle" x="10692" y="-7048.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-7033.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="10692" y="-7018.8" font-family="Times,serif" font-size="14.00">Q[14]×K[2]×V[2]</text>
<text text-anchor="middle" x="10692" y="-7003.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_13_stage_12&#45;&gt;ring_attn_2_14_stage_12 -->
<g id="edge3239" class="edge">
<title>ring_attn_2_13_stage_12&#45;&gt;ring_attn_2_14_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-7030C10314.02,-7030 10472.86,-7030 10472.86,-7030"/>
<polygon fill="red" stroke="red" points="10472.86,-7033.5 10482.86,-7030 10472.86,-7026.5 10472.86,-7033.5"/>
</g>
<!-- ring_attn_2_13_stage_13&#45;&gt;ring_attn_2_13_stage_14 -->
<g id="edge1326" class="edge">
<title>ring_attn_2_13_stage_13&#45;&gt;ring_attn_2_13_stage_14</title>
<path fill="none" stroke="black" d="M10105,-6708.87C10105,-6708.87 10105,-6602.25 10105,-6602.25"/>
<polygon fill="black" stroke="black" points="10108.5,-6602.25 10105,-6592.25 10101.5,-6602.25 10108.5,-6602.25"/>
</g>
<!-- ring_attn_2_14_stage_13 -->
<g id="node1437" class="node">
<title>ring_attn_2_14_stage_13</title>
<polygon fill="yellow" stroke="black" points="10692,-6845 10483,-6777 10692,-6709 10901,-6777 10692,-6845"/>
<text text-anchor="middle" x="10692" y="-6795.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-6780.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="10692" y="-6765.8" font-family="Times,serif" font-size="14.00">Q[14]×K[1]×V[1]</text>
<text text-anchor="middle" x="10692" y="-6750.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_13_stage_13&#45;&gt;ring_attn_2_14_stage_13 -->
<g id="edge3240" class="edge">
<title>ring_attn_2_13_stage_13&#45;&gt;ring_attn_2_14_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-6777C10314.02,-6777 10472.86,-6777 10472.86,-6777"/>
<polygon fill="red" stroke="red" points="10472.86,-6780.5 10482.86,-6777 10472.86,-6773.5 10472.86,-6780.5"/>
</g>
<!-- ring_attn_2_13_stage_14&#45;&gt;ring_attn_2_13_stage_15 -->
<g id="edge1327" class="edge">
<title>ring_attn_2_13_stage_14&#45;&gt;ring_attn_2_13_stage_15</title>
<path fill="none" stroke="black" d="M10105,-6455.87C10105,-6455.87 10105,-6349.25 10105,-6349.25"/>
<polygon fill="black" stroke="black" points="10108.5,-6349.25 10105,-6339.25 10101.5,-6349.25 10108.5,-6349.25"/>
</g>
<!-- ring_attn_2_14_stage_14 -->
<g id="node1438" class="node">
<title>ring_attn_2_14_stage_14</title>
<polygon fill="yellow" stroke="black" points="10692,-6592 10483,-6524 10692,-6456 10901,-6524 10692,-6592"/>
<text text-anchor="middle" x="10692" y="-6542.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-6527.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="10692" y="-6512.8" font-family="Times,serif" font-size="14.00">Q[14]×K[0]×V[0]</text>
<text text-anchor="middle" x="10692" y="-6497.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_13_stage_14&#45;&gt;ring_attn_2_14_stage_14 -->
<g id="edge3241" class="edge">
<title>ring_attn_2_13_stage_14&#45;&gt;ring_attn_2_14_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-6524C10314.02,-6524 10472.86,-6524 10472.86,-6524"/>
<polygon fill="red" stroke="red" points="10472.86,-6527.5 10482.86,-6524 10472.86,-6520.5 10472.86,-6527.5"/>
</g>
<!-- attn_out_2_13 -->
<g id="node1342" class="node">
<title>attn_out_2_13</title>
<polygon fill="none" stroke="black" points="10174.5,-6130 10035.5,-6130 10035.5,-6077 10174.5,-6077 10174.5,-6130"/>
<text text-anchor="middle" x="10105" y="-6114.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="10105" y="-6099.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="10105" y="-6084.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_2_13_stage_15&#45;&gt;attn_out_2_13 -->
<g id="edge1328" class="edge">
<title>ring_attn_2_13_stage_15&#45;&gt;attn_out_2_13</title>
<path fill="none" stroke="black" d="M10105,-6202.87C10105,-6202.87 10105,-6140.18 10105,-6140.18"/>
<polygon fill="black" stroke="black" points="10108.5,-6140.18 10105,-6130.18 10101.5,-6140.18 10108.5,-6140.18"/>
</g>
<!-- ring_attn_2_14_stage_15 -->
<g id="node1439" class="node">
<title>ring_attn_2_14_stage_15</title>
<polygon fill="yellow" stroke="black" points="10692,-6339 10483,-6271 10692,-6203 10901,-6271 10692,-6339"/>
<text text-anchor="middle" x="10692" y="-6289.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-6274.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="10692" y="-6259.8" font-family="Times,serif" font-size="14.00">Q[14]×K[15]×V[15]</text>
<text text-anchor="middle" x="10692" y="-6244.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_13_stage_15&#45;&gt;ring_attn_2_14_stage_15 -->
<g id="edge3242" class="edge">
<title>ring_attn_2_13_stage_15&#45;&gt;ring_attn_2_14_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-6271C10314.02,-6271 10472.86,-6271 10472.86,-6271"/>
<polygon fill="red" stroke="red" points="10472.86,-6274.5 10482.86,-6271 10472.86,-6267.5 10472.86,-6274.5"/>
</g>
<!-- attn_residual_2_13 -->
<g id="node1343" class="node">
<title>attn_residual_2_13</title>
<ellipse fill="none" stroke="black" cx="10105" cy="-5977" rx="105.5" ry="27"/>
<text text-anchor="middle" x="10105" y="-5980.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="10105" y="-5965.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_2_13&#45;&gt;attn_residual_2_13 -->
<g id="edge1329" class="edge">
<title>attn_out_2_13&#45;&gt;attn_residual_2_13</title>
<path fill="none" stroke="black" d="M10105,-6076.98C10105,-6076.98 10105,-6014.36 10105,-6014.36"/>
<polygon fill="black" stroke="black" points="10108.5,-6014.36 10105,-6004.36 10101.5,-6014.36 10108.5,-6014.36"/>
</g>
<!-- gate_2_13 -->
<g id="node1344" class="node">
<title>gate_2_13</title>
<ellipse fill="orange" stroke="black" cx="10105" cy="-5839.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="10105" y="-5850.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="10105" y="-5835.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="10105" y="-5820.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_2_13&#45;&gt;gate_2_13 -->
<g id="edge1330" class="edge">
<title>attn_residual_2_13&#45;&gt;gate_2_13</title>
<path fill="none" stroke="black" d="M10105,-5949.83C10105,-5949.83 10105,-5887.02 10105,-5887.02"/>
<polygon fill="black" stroke="black" points="10108.5,-5887.02 10105,-5877.02 10101.5,-5887.02 10108.5,-5887.02"/>
</g>
<!-- gate_2_13&#45;&gt;expert_2_0_0 -->
<g id="edge3243" class="edge">
<title>gate_2_13&#45;&gt;expert_2_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10007.94,-5824.72C10007.94,-5787.16 10007.94,-5691 10007.94,-5691 10007.94,-5691 175.77,-5691 175.77,-5691 175.77,-5691 175.77,-5680.03 175.77,-5680.03"/>
<polygon fill="blue" stroke="blue" points="179.27,-5680.03 175.77,-5670.03 172.27,-5680.03 179.27,-5680.03"/>
<text text-anchor="middle" x="42926.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42926.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU13→GPU0</text>
<text text-anchor="middle" x="42926.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42926.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_13&#45;&gt;expert_2_1_0 -->
<g id="edge3244" class="edge">
<title>gate_2_13&#45;&gt;expert_2_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10024.82,-5815.08C10024.82,-5770.62 10024.82,-5681 10024.82,-5681 10024.82,-5681 3022.64,-5681 3022.64,-5681 3022.64,-5681 3022.64,-5679.94 3022.64,-5679.94"/>
<polygon fill="blue" stroke="blue" points="3026.14,-5680.35 3022.64,-5670.35 3019.14,-5680.35 3026.14,-5680.35"/>
<text text-anchor="middle" x="43100.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43100.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU13→GPU1</text>
<text text-anchor="middle" x="43100.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43100.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_13&#45;&gt;expert_2_2_0 -->
<g id="edge3245" class="edge">
<title>gate_2_13&#45;&gt;expert_2_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10041.7,-5809.45C10041.7,-5766.06 10041.7,-5691 10041.7,-5691 10041.7,-5691 3636.28,-5691 3636.28,-5691 3636.28,-5691 3636.28,-5680.03 3636.28,-5680.03"/>
<polygon fill="blue" stroke="blue" points="3639.78,-5680.03 3636.28,-5670.03 3632.78,-5680.03 3639.78,-5680.03"/>
<text text-anchor="middle" x="43274.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43274.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU13→GPU2</text>
<text text-anchor="middle" x="43274.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43274.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_13&#45;&gt;expert_2_3_0 -->
<g id="edge3246" class="edge">
<title>gate_2_13&#45;&gt;expert_2_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10058.58,-5805.75C10058.58,-5762.77 10058.58,-5694 10058.58,-5694 10058.58,-5694 4230.78,-5694 4230.78,-5694 4230.78,-5694 4230.78,-5680.23 4230.78,-5680.23"/>
<polygon fill="blue" stroke="blue" points="4234.28,-5680.23 4230.78,-5670.23 4227.28,-5680.23 4234.28,-5680.23"/>
<text text-anchor="middle" x="43448.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43448.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU13→GPU3</text>
<text text-anchor="middle" x="43448.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43448.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_13&#45;&gt;expert_2_4_0 -->
<g id="edge3247" class="edge">
<title>gate_2_13&#45;&gt;expert_2_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10075.46,-5803.26C10075.46,-5755.64 10075.46,-5678 10075.46,-5678 10075.46,-5678 4837.07,-5678 4837.07,-5678 4837.07,-5678 4837.07,-5677.23 4837.07,-5677.23"/>
<polygon fill="blue" stroke="blue" points="4840.57,-5680.34 4837.07,-5670.34 4833.57,-5680.34 4840.57,-5680.34"/>
<text text-anchor="middle" x="43622.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43622.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU13→GPU4</text>
<text text-anchor="middle" x="43622.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43622.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_13&#45;&gt;expert_2_5_0 -->
<g id="edge3248" class="edge">
<title>gate_2_13&#45;&gt;expert_2_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10092.34,-5801.99C10092.34,-5753.72 10092.34,-5676 10092.34,-5676 10092.34,-5676 5434.12,-5676 5434.12,-5676 5434.12,-5676 5434.12,-5675.4 5434.12,-5675.4"/>
<polygon fill="blue" stroke="blue" points="5437.62,-5680.04 5434.12,-5670.04 5430.62,-5680.04 5437.62,-5680.04"/>
<text text-anchor="middle" x="43796.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43796.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU13→GPU5</text>
<text text-anchor="middle" x="43796.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43796.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_13&#45;&gt;expert_2_6_0 -->
<g id="edge3249" class="edge">
<title>gate_2_13&#45;&gt;expert_2_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10109.22,-5801.89C10109.22,-5764.6 10109.22,-5713 10109.22,-5713 10109.22,-5713 6017.1,-5713 6017.1,-5713 6017.1,-5713 6017.1,-5680.17 6017.1,-5680.17"/>
<polygon fill="blue" stroke="blue" points="6020.6,-5680.17 6017.1,-5670.17 6013.6,-5680.17 6020.6,-5680.17"/>
<text text-anchor="middle" x="43970.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43970.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU13→GPU6</text>
<text text-anchor="middle" x="43970.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43970.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_13&#45;&gt;expert_2_7_0 -->
<g id="edge3250" class="edge">
<title>gate_2_13&#45;&gt;expert_2_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10126.1,-5802.64C10126.1,-5769.17 10126.1,-5725 10126.1,-5725 10126.1,-5725 6608.12,-5725 6608.12,-5725 6608.12,-5725 6608.12,-5680.19 6608.12,-5680.19"/>
<polygon fill="blue" stroke="blue" points="6611.62,-5680.19 6608.12,-5670.19 6604.62,-5680.19 6611.62,-5680.19"/>
<text text-anchor="middle" x="44144.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="44144.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU13→GPU7</text>
<text text-anchor="middle" x="44144.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="44144.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_13&#45;&gt;expert_2_8_0 -->
<g id="edge3251" class="edge">
<title>gate_2_13&#45;&gt;expert_2_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10142.98,-5804.33C10142.98,-5773.31 10142.98,-5733 10142.98,-5733 10142.98,-5733 7192.93,-5733 7192.93,-5733 7192.93,-5733 7192.93,-5680.35 7192.93,-5680.35"/>
<polygon fill="blue" stroke="blue" points="7196.43,-5680.35 7192.93,-5670.35 7189.43,-5680.35 7196.43,-5680.35"/>
<text text-anchor="middle" x="44318.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="44318.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU13→GPU8</text>
<text text-anchor="middle" x="44318.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="44318.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_13&#45;&gt;expert_2_9_0 -->
<g id="edge3252" class="edge">
<title>gate_2_13&#45;&gt;expert_2_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10159.86,-5807.3C10159.86,-5778.91 10159.86,-5742 10159.86,-5742 10159.86,-5742 7785.77,-5742 7785.77,-5742 7785.77,-5742 7785.77,-5680.16 7785.77,-5680.16"/>
<polygon fill="blue" stroke="blue" points="7789.27,-5680.16 7785.77,-5670.16 7782.27,-5680.16 7789.27,-5680.16"/>
<text text-anchor="middle" x="44492.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="44492.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU13→GPU9</text>
<text text-anchor="middle" x="44492.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="44492.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_13&#45;&gt;expert_2_10_0 -->
<g id="edge3253" class="edge">
<title>gate_2_13&#45;&gt;expert_2_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10176.74,-5811.55C10176.74,-5784.64 10176.74,-5748 10176.74,-5748 10176.74,-5748 8379.17,-5748 8379.17,-5748 8379.17,-5748 8379.17,-5680.14 8379.17,-5680.14"/>
<polygon fill="blue" stroke="blue" points="8382.67,-5680.14 8379.17,-5670.14 8375.67,-5680.14 8382.67,-5680.14"/>
<text text-anchor="middle" x="44666.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="44666.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU13→GPU10</text>
<text text-anchor="middle" x="44666.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="44666.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_13&#45;&gt;expert_2_11_0 -->
<g id="edge3254" class="edge">
<title>gate_2_13&#45;&gt;expert_2_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10185.18,-5815.04C10185.18,-5802.57 10185.18,-5790 10185.18,-5790 10185.18,-5790 9045.5,-5790 9045.5,-5790 9045.5,-5790 9045.5,-5680.03 9045.5,-5680.03"/>
<polygon fill="blue" stroke="blue" points="9049,-5680.03 9045.5,-5670.03 9042,-5680.03 9049,-5680.03"/>
<text text-anchor="middle" x="44840.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="44840.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU13→GPU11</text>
<text text-anchor="middle" x="44840.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="44840.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_13&#45;&gt;expert_2_12_0 -->
<g id="edge3255" class="edge">
<title>gate_2_13&#45;&gt;expert_2_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10005.3,-5852C9865.46,-5852 9628,-5852 9628,-5852 9628,-5852 9628,-5680.33 9628,-5680.33"/>
<polygon fill="blue" stroke="blue" points="9631.5,-5680.33 9628,-5670.33 9624.5,-5680.33 9631.5,-5680.33"/>
<text text-anchor="middle" x="45014.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45014.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU13→GPU12</text>
<text text-anchor="middle" x="45014.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45014.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_13&#45;&gt;expert_2_13_0 -->
<g id="edge1331" class="edge">
<title>gate_2_13&#45;&gt;expert_2_13_0</title>
<path fill="none" stroke="black" d="M10193.62,-5818.9C10193.62,-5818.9 10193.62,-5680.03 10193.62,-5680.03"/>
<polygon fill="black" stroke="black" points="10197.12,-5680.03 10193.62,-5670.03 10190.12,-5680.03 10197.12,-5680.03"/>
</g>
<!-- gate_2_13&#45;&gt;expert_2_14_0 -->
<g id="edge3256" class="edge">
<title>gate_2_13&#45;&gt;expert_2_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10204.52,-5827C10344.09,-5827 10581.1,-5827 10581.1,-5827 10581.1,-5827 10581.1,-5680.18 10581.1,-5680.18"/>
<polygon fill="blue" stroke="blue" points="10584.6,-5680.18 10581.1,-5670.18 10577.6,-5680.18 10584.6,-5680.18"/>
<text text-anchor="middle" x="45188.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45188.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU13→GPU14</text>
<text text-anchor="middle" x="45188.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45188.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_13&#45;&gt;expert_2_15_0 -->
<g id="edge3257" class="edge">
<title>gate_2_13&#45;&gt;expert_2_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10202.06,-5824.79C10202.06,-5813.56 10202.06,-5800 10202.06,-5800 10202.06,-5800 11165.06,-5800 11165.06,-5800 11165.06,-5800 11165.06,-5680.05 11165.06,-5680.05"/>
<polygon fill="blue" stroke="blue" points="11168.56,-5680.05 11165.06,-5670.05 11161.56,-5680.05 11168.56,-5680.05"/>
<text text-anchor="middle" x="45362.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45362.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU13→GPU15</text>
<text text-anchor="middle" x="45362.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45362.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_13 -->
<g id="node1346" class="node">
<title>expert_reduce_2_13</title>
<ellipse fill="none" stroke="black" cx="10105" cy="-5506.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="10105" y="-5517.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="10105" y="-5502.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="10105" y="-5487.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_13_0&#45;&gt;expert_reduce_2_13 -->
<g id="edge1332" class="edge">
<title>expert_2_13_0&#45;&gt;expert_reduce_2_13</title>
<path fill="none" stroke="black" d="M10105,-5616.76C10105,-5616.76 10105,-5554.06 10105,-5554.06"/>
<polygon fill="black" stroke="black" points="10108.5,-5554.06 10105,-5544.06 10101.5,-5554.06 10108.5,-5554.06"/>
</g>
<!-- moe_residual_2_13 -->
<g id="node1347" class="node">
<title>moe_residual_2_13</title>
<ellipse fill="none" stroke="black" cx="10105" cy="-5369" rx="105.5" ry="27"/>
<text text-anchor="middle" x="10105" y="-5372.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="10105" y="-5357.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_13&#45;&gt;moe_residual_2_13 -->
<g id="edge1333" class="edge">
<title>expert_reduce_2_13&#45;&gt;moe_residual_2_13</title>
<path fill="none" stroke="black" d="M10105,-5468.93C10105,-5468.93 10105,-5406.06 10105,-5406.06"/>
<polygon fill="black" stroke="black" points="10108.5,-5406.06 10105,-5396.06 10101.5,-5406.06 10108.5,-5406.06"/>
</g>
<!-- qkv_proj_3_13 -->
<g id="node1348" class="node">
<title>qkv_proj_3_13</title>
<polygon fill="none" stroke="black" points="10187.5,-5269 10022.5,-5269 10022.5,-5216 10187.5,-5216 10187.5,-5269"/>
<text text-anchor="middle" x="10105" y="-5253.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="10105" y="-5238.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="10105" y="-5223.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_2_13&#45;&gt;qkv_proj_3_13 -->
<g id="edge1334" class="edge">
<title>moe_residual_2_13&#45;&gt;qkv_proj_3_13</title>
<path fill="none" stroke="black" d="M10105,-5341.86C10105,-5341.86 10105,-5279.16 10105,-5279.16"/>
<polygon fill="black" stroke="black" points="10108.5,-5279.16 10105,-5269.16 10101.5,-5279.16 10108.5,-5279.16"/>
</g>
<!-- qkv_reshape_3_13 -->
<g id="node1349" class="node">
<title>qkv_reshape_3_13</title>
<ellipse fill="none" stroke="black" cx="10105" cy="-5116" rx="148" ry="27"/>
<text text-anchor="middle" x="10105" y="-5119.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="10105" y="-5104.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_3_13&#45;&gt;qkv_reshape_3_13 -->
<g id="edge1335" class="edge">
<title>qkv_proj_3_13&#45;&gt;qkv_reshape_3_13</title>
<path fill="none" stroke="black" d="M10105,-5215.98C10105,-5215.98 10105,-5153.36 10105,-5153.36"/>
<polygon fill="black" stroke="black" points="10108.5,-5153.36 10105,-5143.36 10101.5,-5153.36 10108.5,-5153.36"/>
</g>
<!-- qkv_reshape_3_13&#45;&gt;ring_attn_3_13_stage_0 -->
<g id="edge1336" class="edge">
<title>qkv_reshape_3_13&#45;&gt;ring_attn_3_13_stage_0</title>
<path fill="none" stroke="black" d="M10105,-5088.72C10105,-5088.72 10105,-4982.16 10105,-4982.16"/>
<polygon fill="black" stroke="black" points="10108.5,-4982.16 10105,-4972.16 10101.5,-4982.16 10108.5,-4982.16"/>
</g>
<!-- ring_attn_3_13_stage_0&#45;&gt;ring_attn_3_13_stage_1 -->
<g id="edge1337" class="edge">
<title>ring_attn_3_13_stage_0&#45;&gt;ring_attn_3_13_stage_1</title>
<path fill="none" stroke="black" d="M10105,-4835.87C10105,-4835.87 10105,-4729.25 10105,-4729.25"/>
<polygon fill="black" stroke="black" points="10108.5,-4729.25 10105,-4719.25 10101.5,-4729.25 10108.5,-4729.25"/>
</g>
<!-- ring_attn_3_14_stage_0 -->
<g id="node1448" class="node">
<title>ring_attn_3_14_stage_0</title>
<polygon fill="yellow" stroke="black" points="10692,-4972 10483,-4904 10692,-4836 10901,-4904 10692,-4972"/>
<text text-anchor="middle" x="10692" y="-4922.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-4907.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="10692" y="-4892.8" font-family="Times,serif" font-size="14.00">Q[14]×K[14]×V[14]</text>
<text text-anchor="middle" x="10692" y="-4877.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_13_stage_0&#45;&gt;ring_attn_3_14_stage_0 -->
<g id="edge3258" class="edge">
<title>ring_attn_3_13_stage_0&#45;&gt;ring_attn_3_14_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-4904C10314.02,-4904 10472.86,-4904 10472.86,-4904"/>
<polygon fill="red" stroke="red" points="10472.86,-4907.5 10482.86,-4904 10472.86,-4900.5 10472.86,-4907.5"/>
</g>
<!-- ring_attn_3_13_stage_1&#45;&gt;ring_attn_3_13_stage_2 -->
<g id="edge1338" class="edge">
<title>ring_attn_3_13_stage_1&#45;&gt;ring_attn_3_13_stage_2</title>
<path fill="none" stroke="black" d="M10105,-4582.87C10105,-4582.87 10105,-4476.25 10105,-4476.25"/>
<polygon fill="black" stroke="black" points="10108.5,-4476.25 10105,-4466.25 10101.5,-4476.25 10108.5,-4476.25"/>
</g>
<!-- ring_attn_3_14_stage_1 -->
<g id="node1449" class="node">
<title>ring_attn_3_14_stage_1</title>
<polygon fill="yellow" stroke="black" points="10692,-4719 10483,-4651 10692,-4583 10901,-4651 10692,-4719"/>
<text text-anchor="middle" x="10692" y="-4669.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-4654.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="10692" y="-4639.8" font-family="Times,serif" font-size="14.00">Q[14]×K[13]×V[13]</text>
<text text-anchor="middle" x="10692" y="-4624.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_13_stage_1&#45;&gt;ring_attn_3_14_stage_1 -->
<g id="edge3259" class="edge">
<title>ring_attn_3_13_stage_1&#45;&gt;ring_attn_3_14_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-4651C10314.02,-4651 10472.86,-4651 10472.86,-4651"/>
<polygon fill="red" stroke="red" points="10472.86,-4654.5 10482.86,-4651 10472.86,-4647.5 10472.86,-4654.5"/>
</g>
<!-- ring_attn_3_13_stage_2&#45;&gt;ring_attn_3_13_stage_3 -->
<g id="edge1339" class="edge">
<title>ring_attn_3_13_stage_2&#45;&gt;ring_attn_3_13_stage_3</title>
<path fill="none" stroke="black" d="M10105,-4329.87C10105,-4329.87 10105,-4223.25 10105,-4223.25"/>
<polygon fill="black" stroke="black" points="10108.5,-4223.25 10105,-4213.25 10101.5,-4223.25 10108.5,-4223.25"/>
</g>
<!-- ring_attn_3_14_stage_2 -->
<g id="node1450" class="node">
<title>ring_attn_3_14_stage_2</title>
<polygon fill="yellow" stroke="black" points="10692,-4466 10483,-4398 10692,-4330 10901,-4398 10692,-4466"/>
<text text-anchor="middle" x="10692" y="-4416.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-4401.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="10692" y="-4386.8" font-family="Times,serif" font-size="14.00">Q[14]×K[12]×V[12]</text>
<text text-anchor="middle" x="10692" y="-4371.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_13_stage_2&#45;&gt;ring_attn_3_14_stage_2 -->
<g id="edge3260" class="edge">
<title>ring_attn_3_13_stage_2&#45;&gt;ring_attn_3_14_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-4398C10314.02,-4398 10472.86,-4398 10472.86,-4398"/>
<polygon fill="red" stroke="red" points="10472.86,-4401.5 10482.86,-4398 10472.86,-4394.5 10472.86,-4401.5"/>
</g>
<!-- ring_attn_3_13_stage_3&#45;&gt;ring_attn_3_13_stage_4 -->
<g id="edge1340" class="edge">
<title>ring_attn_3_13_stage_3&#45;&gt;ring_attn_3_13_stage_4</title>
<path fill="none" stroke="black" d="M10105,-4076.87C10105,-4076.87 10105,-3970.25 10105,-3970.25"/>
<polygon fill="black" stroke="black" points="10108.5,-3970.25 10105,-3960.25 10101.5,-3970.25 10108.5,-3970.25"/>
</g>
<!-- ring_attn_3_14_stage_3 -->
<g id="node1451" class="node">
<title>ring_attn_3_14_stage_3</title>
<polygon fill="yellow" stroke="black" points="10692,-4213 10483,-4145 10692,-4077 10901,-4145 10692,-4213"/>
<text text-anchor="middle" x="10692" y="-4163.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-4148.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="10692" y="-4133.8" font-family="Times,serif" font-size="14.00">Q[14]×K[11]×V[11]</text>
<text text-anchor="middle" x="10692" y="-4118.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_13_stage_3&#45;&gt;ring_attn_3_14_stage_3 -->
<g id="edge3261" class="edge">
<title>ring_attn_3_13_stage_3&#45;&gt;ring_attn_3_14_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-4145C10314.02,-4145 10472.86,-4145 10472.86,-4145"/>
<polygon fill="red" stroke="red" points="10472.86,-4148.5 10482.86,-4145 10472.86,-4141.5 10472.86,-4148.5"/>
</g>
<!-- ring_attn_3_13_stage_4&#45;&gt;ring_attn_3_13_stage_5 -->
<g id="edge1341" class="edge">
<title>ring_attn_3_13_stage_4&#45;&gt;ring_attn_3_13_stage_5</title>
<path fill="none" stroke="black" d="M10105,-3823.87C10105,-3823.87 10105,-3717.25 10105,-3717.25"/>
<polygon fill="black" stroke="black" points="10108.5,-3717.25 10105,-3707.25 10101.5,-3717.25 10108.5,-3717.25"/>
</g>
<!-- ring_attn_3_14_stage_4 -->
<g id="node1452" class="node">
<title>ring_attn_3_14_stage_4</title>
<polygon fill="yellow" stroke="black" points="10692,-3960 10483,-3892 10692,-3824 10901,-3892 10692,-3960"/>
<text text-anchor="middle" x="10692" y="-3910.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-3895.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="10692" y="-3880.8" font-family="Times,serif" font-size="14.00">Q[14]×K[10]×V[10]</text>
<text text-anchor="middle" x="10692" y="-3865.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_13_stage_4&#45;&gt;ring_attn_3_14_stage_4 -->
<g id="edge3262" class="edge">
<title>ring_attn_3_13_stage_4&#45;&gt;ring_attn_3_14_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-3892C10314.02,-3892 10472.86,-3892 10472.86,-3892"/>
<polygon fill="red" stroke="red" points="10472.86,-3895.5 10482.86,-3892 10472.86,-3888.5 10472.86,-3895.5"/>
</g>
<!-- ring_attn_3_13_stage_5&#45;&gt;ring_attn_3_13_stage_6 -->
<g id="edge1342" class="edge">
<title>ring_attn_3_13_stage_5&#45;&gt;ring_attn_3_13_stage_6</title>
<path fill="none" stroke="black" d="M10105,-3570.87C10105,-3570.87 10105,-3464.25 10105,-3464.25"/>
<polygon fill="black" stroke="black" points="10108.5,-3464.25 10105,-3454.25 10101.5,-3464.25 10108.5,-3464.25"/>
</g>
<!-- ring_attn_3_14_stage_5 -->
<g id="node1453" class="node">
<title>ring_attn_3_14_stage_5</title>
<polygon fill="yellow" stroke="black" points="10692,-3707 10483,-3639 10692,-3571 10901,-3639 10692,-3707"/>
<text text-anchor="middle" x="10692" y="-3657.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-3642.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="10692" y="-3627.8" font-family="Times,serif" font-size="14.00">Q[14]×K[9]×V[9]</text>
<text text-anchor="middle" x="10692" y="-3612.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_13_stage_5&#45;&gt;ring_attn_3_14_stage_5 -->
<g id="edge3263" class="edge">
<title>ring_attn_3_13_stage_5&#45;&gt;ring_attn_3_14_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-3639C10314.02,-3639 10472.86,-3639 10472.86,-3639"/>
<polygon fill="red" stroke="red" points="10472.86,-3642.5 10482.86,-3639 10472.86,-3635.5 10472.86,-3642.5"/>
</g>
<!-- ring_attn_3_13_stage_6&#45;&gt;ring_attn_3_13_stage_7 -->
<g id="edge1343" class="edge">
<title>ring_attn_3_13_stage_6&#45;&gt;ring_attn_3_13_stage_7</title>
<path fill="none" stroke="black" d="M10105,-3317.87C10105,-3317.87 10105,-3211.25 10105,-3211.25"/>
<polygon fill="black" stroke="black" points="10108.5,-3211.25 10105,-3201.25 10101.5,-3211.25 10108.5,-3211.25"/>
</g>
<!-- ring_attn_3_14_stage_6 -->
<g id="node1454" class="node">
<title>ring_attn_3_14_stage_6</title>
<polygon fill="yellow" stroke="black" points="10692,-3454 10483,-3386 10692,-3318 10901,-3386 10692,-3454"/>
<text text-anchor="middle" x="10692" y="-3404.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-3389.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="10692" y="-3374.8" font-family="Times,serif" font-size="14.00">Q[14]×K[8]×V[8]</text>
<text text-anchor="middle" x="10692" y="-3359.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_13_stage_6&#45;&gt;ring_attn_3_14_stage_6 -->
<g id="edge3264" class="edge">
<title>ring_attn_3_13_stage_6&#45;&gt;ring_attn_3_14_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-3386C10314.02,-3386 10472.86,-3386 10472.86,-3386"/>
<polygon fill="red" stroke="red" points="10472.86,-3389.5 10482.86,-3386 10472.86,-3382.5 10472.86,-3389.5"/>
</g>
<!-- ring_attn_3_13_stage_7&#45;&gt;ring_attn_3_13_stage_8 -->
<g id="edge1344" class="edge">
<title>ring_attn_3_13_stage_7&#45;&gt;ring_attn_3_13_stage_8</title>
<path fill="none" stroke="black" d="M10105,-3064.87C10105,-3064.87 10105,-2958.25 10105,-2958.25"/>
<polygon fill="black" stroke="black" points="10108.5,-2958.25 10105,-2948.25 10101.5,-2958.25 10108.5,-2958.25"/>
</g>
<!-- ring_attn_3_14_stage_7 -->
<g id="node1455" class="node">
<title>ring_attn_3_14_stage_7</title>
<polygon fill="yellow" stroke="black" points="10692,-3201 10483,-3133 10692,-3065 10901,-3133 10692,-3201"/>
<text text-anchor="middle" x="10692" y="-3151.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-3136.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="10692" y="-3121.8" font-family="Times,serif" font-size="14.00">Q[14]×K[7]×V[7]</text>
<text text-anchor="middle" x="10692" y="-3106.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_13_stage_7&#45;&gt;ring_attn_3_14_stage_7 -->
<g id="edge3265" class="edge">
<title>ring_attn_3_13_stage_7&#45;&gt;ring_attn_3_14_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-3133C10314.02,-3133 10472.86,-3133 10472.86,-3133"/>
<polygon fill="red" stroke="red" points="10472.86,-3136.5 10482.86,-3133 10472.86,-3129.5 10472.86,-3136.5"/>
</g>
<!-- ring_attn_3_13_stage_8&#45;&gt;ring_attn_3_13_stage_9 -->
<g id="edge1345" class="edge">
<title>ring_attn_3_13_stage_8&#45;&gt;ring_attn_3_13_stage_9</title>
<path fill="none" stroke="black" d="M10105,-2811.87C10105,-2811.87 10105,-2705.25 10105,-2705.25"/>
<polygon fill="black" stroke="black" points="10108.5,-2705.25 10105,-2695.25 10101.5,-2705.25 10108.5,-2705.25"/>
</g>
<!-- ring_attn_3_14_stage_8 -->
<g id="node1456" class="node">
<title>ring_attn_3_14_stage_8</title>
<polygon fill="yellow" stroke="black" points="10692,-2948 10483,-2880 10692,-2812 10901,-2880 10692,-2948"/>
<text text-anchor="middle" x="10692" y="-2898.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-2883.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="10692" y="-2868.8" font-family="Times,serif" font-size="14.00">Q[14]×K[6]×V[6]</text>
<text text-anchor="middle" x="10692" y="-2853.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_13_stage_8&#45;&gt;ring_attn_3_14_stage_8 -->
<g id="edge3266" class="edge">
<title>ring_attn_3_13_stage_8&#45;&gt;ring_attn_3_14_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-2880C10314.02,-2880 10472.86,-2880 10472.86,-2880"/>
<polygon fill="red" stroke="red" points="10472.86,-2883.5 10482.86,-2880 10472.86,-2876.5 10472.86,-2883.5"/>
</g>
<!-- ring_attn_3_13_stage_9&#45;&gt;ring_attn_3_13_stage_10 -->
<g id="edge1346" class="edge">
<title>ring_attn_3_13_stage_9&#45;&gt;ring_attn_3_13_stage_10</title>
<path fill="none" stroke="black" d="M10105,-2558.87C10105,-2558.87 10105,-2452.25 10105,-2452.25"/>
<polygon fill="black" stroke="black" points="10108.5,-2452.25 10105,-2442.25 10101.5,-2452.25 10108.5,-2452.25"/>
</g>
<!-- ring_attn_3_14_stage_9 -->
<g id="node1457" class="node">
<title>ring_attn_3_14_stage_9</title>
<polygon fill="yellow" stroke="black" points="10692,-2695 10483,-2627 10692,-2559 10901,-2627 10692,-2695"/>
<text text-anchor="middle" x="10692" y="-2645.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-2630.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="10692" y="-2615.8" font-family="Times,serif" font-size="14.00">Q[14]×K[5]×V[5]</text>
<text text-anchor="middle" x="10692" y="-2600.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_13_stage_9&#45;&gt;ring_attn_3_14_stage_9 -->
<g id="edge3267" class="edge">
<title>ring_attn_3_13_stage_9&#45;&gt;ring_attn_3_14_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-2627C10314.02,-2627 10472.86,-2627 10472.86,-2627"/>
<polygon fill="red" stroke="red" points="10472.86,-2630.5 10482.86,-2627 10472.86,-2623.5 10472.86,-2630.5"/>
</g>
<!-- ring_attn_3_13_stage_10&#45;&gt;ring_attn_3_13_stage_11 -->
<g id="edge1347" class="edge">
<title>ring_attn_3_13_stage_10&#45;&gt;ring_attn_3_13_stage_11</title>
<path fill="none" stroke="black" d="M10105,-2305.87C10105,-2305.87 10105,-2199.25 10105,-2199.25"/>
<polygon fill="black" stroke="black" points="10108.5,-2199.25 10105,-2189.25 10101.5,-2199.25 10108.5,-2199.25"/>
</g>
<!-- ring_attn_3_14_stage_10 -->
<g id="node1458" class="node">
<title>ring_attn_3_14_stage_10</title>
<polygon fill="yellow" stroke="black" points="10692,-2442 10483,-2374 10692,-2306 10901,-2374 10692,-2442"/>
<text text-anchor="middle" x="10692" y="-2392.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-2377.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="10692" y="-2362.8" font-family="Times,serif" font-size="14.00">Q[14]×K[4]×V[4]</text>
<text text-anchor="middle" x="10692" y="-2347.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_13_stage_10&#45;&gt;ring_attn_3_14_stage_10 -->
<g id="edge3268" class="edge">
<title>ring_attn_3_13_stage_10&#45;&gt;ring_attn_3_14_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-2374C10314.02,-2374 10472.86,-2374 10472.86,-2374"/>
<polygon fill="red" stroke="red" points="10472.86,-2377.5 10482.86,-2374 10472.86,-2370.5 10472.86,-2377.5"/>
</g>
<!-- ring_attn_3_13_stage_11&#45;&gt;ring_attn_3_13_stage_12 -->
<g id="edge1348" class="edge">
<title>ring_attn_3_13_stage_11&#45;&gt;ring_attn_3_13_stage_12</title>
<path fill="none" stroke="black" d="M10105,-2052.87C10105,-2052.87 10105,-1946.25 10105,-1946.25"/>
<polygon fill="black" stroke="black" points="10108.5,-1946.25 10105,-1936.25 10101.5,-1946.25 10108.5,-1946.25"/>
</g>
<!-- ring_attn_3_14_stage_11 -->
<g id="node1459" class="node">
<title>ring_attn_3_14_stage_11</title>
<polygon fill="yellow" stroke="black" points="10692,-2189 10483,-2121 10692,-2053 10901,-2121 10692,-2189"/>
<text text-anchor="middle" x="10692" y="-2139.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-2124.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="10692" y="-2109.8" font-family="Times,serif" font-size="14.00">Q[14]×K[3]×V[3]</text>
<text text-anchor="middle" x="10692" y="-2094.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_13_stage_11&#45;&gt;ring_attn_3_14_stage_11 -->
<g id="edge3269" class="edge">
<title>ring_attn_3_13_stage_11&#45;&gt;ring_attn_3_14_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-2121C10314.02,-2121 10472.86,-2121 10472.86,-2121"/>
<polygon fill="red" stroke="red" points="10472.86,-2124.5 10482.86,-2121 10472.86,-2117.5 10472.86,-2124.5"/>
</g>
<!-- ring_attn_3_13_stage_12&#45;&gt;ring_attn_3_13_stage_13 -->
<g id="edge1349" class="edge">
<title>ring_attn_3_13_stage_12&#45;&gt;ring_attn_3_13_stage_13</title>
<path fill="none" stroke="black" d="M10105,-1799.87C10105,-1799.87 10105,-1693.25 10105,-1693.25"/>
<polygon fill="black" stroke="black" points="10108.5,-1693.25 10105,-1683.25 10101.5,-1693.25 10108.5,-1693.25"/>
</g>
<!-- ring_attn_3_14_stage_12 -->
<g id="node1460" class="node">
<title>ring_attn_3_14_stage_12</title>
<polygon fill="yellow" stroke="black" points="10692,-1936 10483,-1868 10692,-1800 10901,-1868 10692,-1936"/>
<text text-anchor="middle" x="10692" y="-1886.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-1871.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="10692" y="-1856.8" font-family="Times,serif" font-size="14.00">Q[14]×K[2]×V[2]</text>
<text text-anchor="middle" x="10692" y="-1841.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_13_stage_12&#45;&gt;ring_attn_3_14_stage_12 -->
<g id="edge3270" class="edge">
<title>ring_attn_3_13_stage_12&#45;&gt;ring_attn_3_14_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-1868C10314.02,-1868 10472.86,-1868 10472.86,-1868"/>
<polygon fill="red" stroke="red" points="10472.86,-1871.5 10482.86,-1868 10472.86,-1864.5 10472.86,-1871.5"/>
</g>
<!-- ring_attn_3_13_stage_13&#45;&gt;ring_attn_3_13_stage_14 -->
<g id="edge1350" class="edge">
<title>ring_attn_3_13_stage_13&#45;&gt;ring_attn_3_13_stage_14</title>
<path fill="none" stroke="black" d="M10105,-1546.87C10105,-1546.87 10105,-1440.25 10105,-1440.25"/>
<polygon fill="black" stroke="black" points="10108.5,-1440.25 10105,-1430.25 10101.5,-1440.25 10108.5,-1440.25"/>
</g>
<!-- ring_attn_3_14_stage_13 -->
<g id="node1461" class="node">
<title>ring_attn_3_14_stage_13</title>
<polygon fill="yellow" stroke="black" points="10692,-1683 10483,-1615 10692,-1547 10901,-1615 10692,-1683"/>
<text text-anchor="middle" x="10692" y="-1633.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-1618.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="10692" y="-1603.8" font-family="Times,serif" font-size="14.00">Q[14]×K[1]×V[1]</text>
<text text-anchor="middle" x="10692" y="-1588.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_13_stage_13&#45;&gt;ring_attn_3_14_stage_13 -->
<g id="edge3271" class="edge">
<title>ring_attn_3_13_stage_13&#45;&gt;ring_attn_3_14_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-1615C10314.02,-1615 10472.86,-1615 10472.86,-1615"/>
<polygon fill="red" stroke="red" points="10472.86,-1618.5 10482.86,-1615 10472.86,-1611.5 10472.86,-1618.5"/>
</g>
<!-- ring_attn_3_13_stage_14&#45;&gt;ring_attn_3_13_stage_15 -->
<g id="edge1351" class="edge">
<title>ring_attn_3_13_stage_14&#45;&gt;ring_attn_3_13_stage_15</title>
<path fill="none" stroke="black" d="M10105,-1293.87C10105,-1293.87 10105,-1187.25 10105,-1187.25"/>
<polygon fill="black" stroke="black" points="10108.5,-1187.25 10105,-1177.25 10101.5,-1187.25 10108.5,-1187.25"/>
</g>
<!-- ring_attn_3_14_stage_14 -->
<g id="node1462" class="node">
<title>ring_attn_3_14_stage_14</title>
<polygon fill="yellow" stroke="black" points="10692,-1430 10483,-1362 10692,-1294 10901,-1362 10692,-1430"/>
<text text-anchor="middle" x="10692" y="-1380.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-1365.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="10692" y="-1350.8" font-family="Times,serif" font-size="14.00">Q[14]×K[0]×V[0]</text>
<text text-anchor="middle" x="10692" y="-1335.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_13_stage_14&#45;&gt;ring_attn_3_14_stage_14 -->
<g id="edge3272" class="edge">
<title>ring_attn_3_13_stage_14&#45;&gt;ring_attn_3_14_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-1362C10314.02,-1362 10472.86,-1362 10472.86,-1362"/>
<polygon fill="red" stroke="red" points="10472.86,-1365.5 10482.86,-1362 10472.86,-1358.5 10472.86,-1365.5"/>
</g>
<!-- attn_out_3_13 -->
<g id="node1366" class="node">
<title>attn_out_3_13</title>
<polygon fill="none" stroke="black" points="10174.5,-968 10035.5,-968 10035.5,-915 10174.5,-915 10174.5,-968"/>
<text text-anchor="middle" x="10105" y="-952.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="10105" y="-937.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="10105" y="-922.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_3_13_stage_15&#45;&gt;attn_out_3_13 -->
<g id="edge1352" class="edge">
<title>ring_attn_3_13_stage_15&#45;&gt;attn_out_3_13</title>
<path fill="none" stroke="black" d="M10105,-1040.87C10105,-1040.87 10105,-978.18 10105,-978.18"/>
<polygon fill="black" stroke="black" points="10108.5,-978.18 10105,-968.18 10101.5,-978.18 10108.5,-978.18"/>
</g>
<!-- ring_attn_3_14_stage_15 -->
<g id="node1463" class="node">
<title>ring_attn_3_14_stage_15</title>
<polygon fill="yellow" stroke="black" points="10692,-1177 10483,-1109 10692,-1041 10901,-1109 10692,-1177"/>
<text text-anchor="middle" x="10692" y="-1127.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="10692" y="-1112.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="10692" y="-1097.8" font-family="Times,serif" font-size="14.00">Q[14]×K[15]×V[15]</text>
<text text-anchor="middle" x="10692" y="-1082.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_13_stage_15&#45;&gt;ring_attn_3_14_stage_15 -->
<g id="edge3273" class="edge">
<title>ring_attn_3_13_stage_15&#45;&gt;ring_attn_3_14_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10314.02,-1109C10314.02,-1109 10472.86,-1109 10472.86,-1109"/>
<polygon fill="red" stroke="red" points="10472.86,-1112.5 10482.86,-1109 10472.86,-1105.5 10472.86,-1112.5"/>
</g>
<!-- attn_residual_3_13 -->
<g id="node1367" class="node">
<title>attn_residual_3_13</title>
<ellipse fill="none" stroke="black" cx="10105" cy="-815" rx="105.5" ry="27"/>
<text text-anchor="middle" x="10105" y="-818.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="10105" y="-803.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_3_13&#45;&gt;attn_residual_3_13 -->
<g id="edge1353" class="edge">
<title>attn_out_3_13&#45;&gt;attn_residual_3_13</title>
<path fill="none" stroke="black" d="M10105,-914.98C10105,-914.98 10105,-852.36 10105,-852.36"/>
<polygon fill="black" stroke="black" points="10108.5,-852.36 10105,-842.36 10101.5,-852.36 10108.5,-852.36"/>
</g>
<!-- gate_3_13 -->
<g id="node1368" class="node">
<title>gate_3_13</title>
<ellipse fill="orange" stroke="black" cx="10105" cy="-677.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="10105" y="-688.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="10105" y="-673.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="10105" y="-658.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_3_13&#45;&gt;gate_3_13 -->
<g id="edge1354" class="edge">
<title>attn_residual_3_13&#45;&gt;gate_3_13</title>
<path fill="none" stroke="black" d="M10105,-787.83C10105,-787.83 10105,-725.02 10105,-725.02"/>
<polygon fill="black" stroke="black" points="10108.5,-725.02 10105,-715.02 10101.5,-725.02 10108.5,-725.02"/>
</g>
<!-- gate_3_13&#45;&gt;expert_3_0_0 -->
<g id="edge3274" class="edge">
<title>gate_3_13&#45;&gt;expert_3_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10007.94,-662.72C10007.94,-625.16 10007.94,-529 10007.94,-529 10007.94,-529 175.77,-529 175.77,-529 175.77,-529 175.77,-518.03 175.77,-518.03"/>
<polygon fill="blue" stroke="blue" points="179.27,-518.03 175.77,-508.03 172.27,-518.03 179.27,-518.03"/>
<text text-anchor="middle" x="42926.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="42926.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU13→GPU0</text>
<text text-anchor="middle" x="42926.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="42926.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_13&#45;&gt;expert_3_1_0 -->
<g id="edge3275" class="edge">
<title>gate_3_13&#45;&gt;expert_3_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10024.82,-653.08C10024.82,-608.62 10024.82,-519 10024.82,-519 10024.82,-519 3022.64,-519 3022.64,-519 3022.64,-519 3022.64,-517.94 3022.64,-517.94"/>
<polygon fill="blue" stroke="blue" points="3026.14,-518.35 3022.64,-508.35 3019.14,-518.35 3026.14,-518.35"/>
<text text-anchor="middle" x="43100.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43100.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU13→GPU1</text>
<text text-anchor="middle" x="43100.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43100.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_13&#45;&gt;expert_3_2_0 -->
<g id="edge3276" class="edge">
<title>gate_3_13&#45;&gt;expert_3_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10041.7,-647.45C10041.7,-604.06 10041.7,-529 10041.7,-529 10041.7,-529 3636.28,-529 3636.28,-529 3636.28,-529 3636.28,-518.03 3636.28,-518.03"/>
<polygon fill="blue" stroke="blue" points="3639.78,-518.03 3636.28,-508.03 3632.78,-518.03 3639.78,-518.03"/>
<text text-anchor="middle" x="43274.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43274.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU13→GPU2</text>
<text text-anchor="middle" x="43274.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43274.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_13&#45;&gt;expert_3_3_0 -->
<g id="edge3277" class="edge">
<title>gate_3_13&#45;&gt;expert_3_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10058.58,-643.75C10058.58,-600.77 10058.58,-532 10058.58,-532 10058.58,-532 4230.78,-532 4230.78,-532 4230.78,-532 4230.78,-518.23 4230.78,-518.23"/>
<polygon fill="blue" stroke="blue" points="4234.28,-518.23 4230.78,-508.23 4227.28,-518.23 4234.28,-518.23"/>
<text text-anchor="middle" x="43448.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43448.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU13→GPU3</text>
<text text-anchor="middle" x="43448.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43448.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_13&#45;&gt;expert_3_4_0 -->
<g id="edge3278" class="edge">
<title>gate_3_13&#45;&gt;expert_3_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10075.46,-641.26C10075.46,-593.64 10075.46,-516 10075.46,-516 10075.46,-516 4837.07,-516 4837.07,-516 4837.07,-516 4837.07,-515.23 4837.07,-515.23"/>
<polygon fill="blue" stroke="blue" points="4840.57,-518.34 4837.07,-508.34 4833.57,-518.34 4840.57,-518.34"/>
<text text-anchor="middle" x="43622.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43622.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU13→GPU4</text>
<text text-anchor="middle" x="43622.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43622.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_13&#45;&gt;expert_3_5_0 -->
<g id="edge3279" class="edge">
<title>gate_3_13&#45;&gt;expert_3_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10092.34,-639.99C10092.34,-591.72 10092.34,-514 10092.34,-514 10092.34,-514 5434.12,-514 5434.12,-514 5434.12,-514 5434.12,-513.4 5434.12,-513.4"/>
<polygon fill="blue" stroke="blue" points="5437.62,-518.04 5434.12,-508.04 5430.62,-518.04 5437.62,-518.04"/>
<text text-anchor="middle" x="43796.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43796.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU13→GPU5</text>
<text text-anchor="middle" x="43796.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43796.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_13&#45;&gt;expert_3_6_0 -->
<g id="edge3280" class="edge">
<title>gate_3_13&#45;&gt;expert_3_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10109.22,-639.89C10109.22,-602.6 10109.22,-551 10109.22,-551 10109.22,-551 6017.1,-551 6017.1,-551 6017.1,-551 6017.1,-518.17 6017.1,-518.17"/>
<polygon fill="blue" stroke="blue" points="6020.6,-518.17 6017.1,-508.17 6013.6,-518.17 6020.6,-518.17"/>
<text text-anchor="middle" x="43970.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="43970.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU13→GPU6</text>
<text text-anchor="middle" x="43970.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="43970.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_13&#45;&gt;expert_3_7_0 -->
<g id="edge3281" class="edge">
<title>gate_3_13&#45;&gt;expert_3_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10126.1,-640.64C10126.1,-607.17 10126.1,-563 10126.1,-563 10126.1,-563 6608.12,-563 6608.12,-563 6608.12,-563 6608.12,-518.19 6608.12,-518.19"/>
<polygon fill="blue" stroke="blue" points="6611.62,-518.19 6608.12,-508.19 6604.62,-518.19 6611.62,-518.19"/>
<text text-anchor="middle" x="44144.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="44144.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU13→GPU7</text>
<text text-anchor="middle" x="44144.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="44144.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_13&#45;&gt;expert_3_8_0 -->
<g id="edge3282" class="edge">
<title>gate_3_13&#45;&gt;expert_3_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10142.98,-642.33C10142.98,-611.31 10142.98,-571 10142.98,-571 10142.98,-571 7192.93,-571 7192.93,-571 7192.93,-571 7192.93,-518.35 7192.93,-518.35"/>
<polygon fill="blue" stroke="blue" points="7196.43,-518.35 7192.93,-508.35 7189.43,-518.35 7196.43,-518.35"/>
<text text-anchor="middle" x="44318.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="44318.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU13→GPU8</text>
<text text-anchor="middle" x="44318.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="44318.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_13&#45;&gt;expert_3_9_0 -->
<g id="edge3283" class="edge">
<title>gate_3_13&#45;&gt;expert_3_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10159.86,-645.3C10159.86,-616.91 10159.86,-580 10159.86,-580 10159.86,-580 7785.77,-580 7785.77,-580 7785.77,-580 7785.77,-518.16 7785.77,-518.16"/>
<polygon fill="blue" stroke="blue" points="7789.27,-518.16 7785.77,-508.16 7782.27,-518.16 7789.27,-518.16"/>
<text text-anchor="middle" x="44492.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="44492.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU13→GPU9</text>
<text text-anchor="middle" x="44492.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="44492.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_13&#45;&gt;expert_3_10_0 -->
<g id="edge3284" class="edge">
<title>gate_3_13&#45;&gt;expert_3_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10176.74,-649.55C10176.74,-622.64 10176.74,-586 10176.74,-586 10176.74,-586 8379.17,-586 8379.17,-586 8379.17,-586 8379.17,-518.14 8379.17,-518.14"/>
<polygon fill="blue" stroke="blue" points="8382.67,-518.14 8379.17,-508.14 8375.67,-518.14 8382.67,-518.14"/>
<text text-anchor="middle" x="44666.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="44666.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU13→GPU10</text>
<text text-anchor="middle" x="44666.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="44666.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_13&#45;&gt;expert_3_11_0 -->
<g id="edge3285" class="edge">
<title>gate_3_13&#45;&gt;expert_3_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10185.18,-653.04C10185.18,-640.57 10185.18,-628 10185.18,-628 10185.18,-628 9045.5,-628 9045.5,-628 9045.5,-628 9045.5,-518.03 9045.5,-518.03"/>
<polygon fill="blue" stroke="blue" points="9049,-518.03 9045.5,-508.03 9042,-518.03 9049,-518.03"/>
<text text-anchor="middle" x="44840.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="44840.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU13→GPU11</text>
<text text-anchor="middle" x="44840.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="44840.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_13&#45;&gt;expert_3_12_0 -->
<g id="edge3286" class="edge">
<title>gate_3_13&#45;&gt;expert_3_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10005.3,-690C9865.46,-690 9628,-690 9628,-690 9628,-690 9628,-518.33 9628,-518.33"/>
<polygon fill="blue" stroke="blue" points="9631.5,-518.33 9628,-508.33 9624.5,-518.33 9631.5,-518.33"/>
<text text-anchor="middle" x="45014.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45014.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU13→GPU12</text>
<text text-anchor="middle" x="45014.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45014.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_13&#45;&gt;expert_3_13_0 -->
<g id="edge1355" class="edge">
<title>gate_3_13&#45;&gt;expert_3_13_0</title>
<path fill="none" stroke="black" d="M10193.62,-656.9C10193.62,-656.9 10193.62,-518.03 10193.62,-518.03"/>
<polygon fill="black" stroke="black" points="10197.12,-518.03 10193.62,-508.03 10190.12,-518.03 10197.12,-518.03"/>
</g>
<!-- gate_3_13&#45;&gt;expert_3_14_0 -->
<g id="edge3287" class="edge">
<title>gate_3_13&#45;&gt;expert_3_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10204.52,-665C10344.09,-665 10581.1,-665 10581.1,-665 10581.1,-665 10581.1,-518.18 10581.1,-518.18"/>
<polygon fill="blue" stroke="blue" points="10584.6,-518.18 10581.1,-508.18 10577.6,-518.18 10584.6,-518.18"/>
<text text-anchor="middle" x="45188.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45188.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU13→GPU14</text>
<text text-anchor="middle" x="45188.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45188.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_13&#45;&gt;expert_3_15_0 -->
<g id="edge3288" class="edge">
<title>gate_3_13&#45;&gt;expert_3_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10202.06,-662.79C10202.06,-651.56 10202.06,-638 10202.06,-638 10202.06,-638 11165.06,-638 11165.06,-638 11165.06,-638 11165.06,-518.05 11165.06,-518.05"/>
<polygon fill="blue" stroke="blue" points="11168.56,-518.05 11165.06,-508.05 11161.56,-518.05 11168.56,-518.05"/>
<text text-anchor="middle" x="45362.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45362.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU13→GPU15</text>
<text text-anchor="middle" x="45362.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45362.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_13 -->
<g id="node1370" class="node">
<title>expert_reduce_3_13</title>
<ellipse fill="none" stroke="black" cx="10105" cy="-344.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="10105" y="-355.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="10105" y="-340.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="10105" y="-325.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_13_0&#45;&gt;expert_reduce_3_13 -->
<g id="edge1356" class="edge">
<title>expert_3_13_0&#45;&gt;expert_reduce_3_13</title>
<path fill="none" stroke="black" d="M10105,-454.76C10105,-454.76 10105,-392.06 10105,-392.06"/>
<polygon fill="black" stroke="black" points="10108.5,-392.06 10105,-382.06 10101.5,-392.06 10108.5,-392.06"/>
</g>
<!-- moe_residual_3_13 -->
<g id="node1371" class="node">
<title>moe_residual_3_13</title>
<ellipse fill="none" stroke="black" cx="10105" cy="-207" rx="105.5" ry="27"/>
<text text-anchor="middle" x="10105" y="-210.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="10105" y="-195.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_13&#45;&gt;moe_residual_3_13 -->
<g id="edge1357" class="edge">
<title>expert_reduce_3_13&#45;&gt;moe_residual_3_13</title>
<path fill="none" stroke="black" d="M10105,-306.93C10105,-306.93 10105,-244.06 10105,-244.06"/>
<polygon fill="black" stroke="black" points="10108.5,-244.06 10105,-234.06 10101.5,-244.06 10108.5,-244.06"/>
</g>
<!-- output_13 -->
<g id="node1372" class="node">
<title>output_13</title>
<polygon fill="lightcoral" stroke="black" points="10202.5,-107 10007.5,-107 10007.5,-69 10202.5,-69 10202.5,-107"/>
<text text-anchor="middle" x="10105" y="-91.8" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="10105" y="-76.8" font-family="Times,serif" font-size="14.00">Y[13]: 1024×1024×4096</text>
</g>
<!-- moe_residual_3_13&#45;&gt;output_13 -->
<g id="edge1358" class="edge">
<title>moe_residual_3_13&#45;&gt;output_13</title>
<path fill="none" stroke="black" d="M10105,-180C10105,-180 10105,-117.12 10105,-117.12"/>
<polygon fill="black" stroke="black" points="10108.5,-117.12 10105,-107.12 10101.5,-117.12 10108.5,-117.12"/>
</g>
<!-- input_14 -->
<g id="node1373" class="node">
<title>input_14</title>
<polygon fill="lightgreen" stroke="black" points="10790,-20866 10594,-20866 10594,-20828 10790,-20828 10790,-20866"/>
<text text-anchor="middle" x="10692" y="-20850.8" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="10692" y="-20835.8" font-family="Times,serif" font-size="14.00">X[14]: 1024×1024×4096</text>
</g>
<!-- qkv_proj_0_14 -->
<g id="node1374" class="node">
<title>qkv_proj_0_14</title>
<polygon fill="none" stroke="black" points="10774.5,-20755 10609.5,-20755 10609.5,-20702 10774.5,-20702 10774.5,-20755"/>
<text text-anchor="middle" x="10692" y="-20739.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="10692" y="-20724.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="10692" y="-20709.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- input_14&#45;&gt;qkv_proj_0_14 -->
<g id="edge1359" class="edge">
<title>input_14&#45;&gt;qkv_proj_0_14</title>
<path fill="none" stroke="black" d="M10692,-20827.96C10692,-20827.96 10692,-20765.44 10692,-20765.44"/>
<polygon fill="black" stroke="black" points="10695.5,-20765.44 10692,-20755.44 10688.5,-20765.44 10695.5,-20765.44"/>
</g>
<!-- qkv_reshape_0_14 -->
<g id="node1375" class="node">
<title>qkv_reshape_0_14</title>
<ellipse fill="none" stroke="black" cx="10692" cy="-20602" rx="148" ry="27"/>
<text text-anchor="middle" x="10692" y="-20605.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="10692" y="-20590.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_0_14&#45;&gt;qkv_reshape_0_14 -->
<g id="edge1360" class="edge">
<title>qkv_proj_0_14&#45;&gt;qkv_reshape_0_14</title>
<path fill="none" stroke="black" d="M10692,-20701.98C10692,-20701.98 10692,-20639.36 10692,-20639.36"/>
<polygon fill="black" stroke="black" points="10695.5,-20639.36 10692,-20629.36 10688.5,-20639.36 10695.5,-20639.36"/>
</g>
<!-- qkv_reshape_0_14&#45;&gt;ring_attn_0_14_stage_0 -->
<g id="edge1361" class="edge">
<title>qkv_reshape_0_14&#45;&gt;ring_attn_0_14_stage_0</title>
<path fill="none" stroke="black" d="M10692,-20574.72C10692,-20574.72 10692,-20468.16 10692,-20468.16"/>
<polygon fill="black" stroke="black" points="10695.5,-20468.16 10692,-20458.16 10688.5,-20468.16 10695.5,-20468.16"/>
</g>
<!-- ring_attn_0_14_stage_0&#45;&gt;ring_attn_0_14_stage_1 -->
<g id="edge1362" class="edge">
<title>ring_attn_0_14_stage_0&#45;&gt;ring_attn_0_14_stage_1</title>
<path fill="none" stroke="black" d="M10692,-20321.87C10692,-20321.87 10692,-20215.25 10692,-20215.25"/>
<polygon fill="black" stroke="black" points="10695.5,-20215.25 10692,-20205.25 10688.5,-20215.25 10695.5,-20215.25"/>
</g>
<!-- ring_attn_0_15_stage_0 -->
<g id="node1474" class="node">
<title>ring_attn_0_15_stage_0</title>
<polygon fill="yellow" stroke="black" points="11279,-20458 11070,-20390 11279,-20322 11488,-20390 11279,-20458"/>
<text text-anchor="middle" x="11279" y="-20408.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-20393.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="11279" y="-20378.8" font-family="Times,serif" font-size="14.00">Q[15]×K[15]×V[15]</text>
<text text-anchor="middle" x="11279" y="-20363.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_14_stage_0&#45;&gt;ring_attn_0_15_stage_0 -->
<g id="edge3289" class="edge">
<title>ring_attn_0_14_stage_0&#45;&gt;ring_attn_0_15_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-20390C10901.02,-20390 11059.86,-20390 11059.86,-20390"/>
<polygon fill="red" stroke="red" points="11059.86,-20393.5 11069.86,-20390 11059.86,-20386.5 11059.86,-20393.5"/>
</g>
<!-- ring_attn_0_14_stage_1&#45;&gt;ring_attn_0_14_stage_2 -->
<g id="edge1363" class="edge">
<title>ring_attn_0_14_stage_1&#45;&gt;ring_attn_0_14_stage_2</title>
<path fill="none" stroke="black" d="M10692,-20068.87C10692,-20068.87 10692,-19962.25 10692,-19962.25"/>
<polygon fill="black" stroke="black" points="10695.5,-19962.25 10692,-19952.25 10688.5,-19962.25 10695.5,-19962.25"/>
</g>
<!-- ring_attn_0_15_stage_1 -->
<g id="node1475" class="node">
<title>ring_attn_0_15_stage_1</title>
<polygon fill="yellow" stroke="black" points="11279,-20205 11070,-20137 11279,-20069 11488,-20137 11279,-20205"/>
<text text-anchor="middle" x="11279" y="-20155.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-20140.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="11279" y="-20125.8" font-family="Times,serif" font-size="14.00">Q[15]×K[14]×V[14]</text>
<text text-anchor="middle" x="11279" y="-20110.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_14_stage_1&#45;&gt;ring_attn_0_15_stage_1 -->
<g id="edge3290" class="edge">
<title>ring_attn_0_14_stage_1&#45;&gt;ring_attn_0_15_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-20137C10901.02,-20137 11059.86,-20137 11059.86,-20137"/>
<polygon fill="red" stroke="red" points="11059.86,-20140.5 11069.86,-20137 11059.86,-20133.5 11059.86,-20140.5"/>
</g>
<!-- ring_attn_0_14_stage_2&#45;&gt;ring_attn_0_14_stage_3 -->
<g id="edge1364" class="edge">
<title>ring_attn_0_14_stage_2&#45;&gt;ring_attn_0_14_stage_3</title>
<path fill="none" stroke="black" d="M10692,-19815.87C10692,-19815.87 10692,-19709.25 10692,-19709.25"/>
<polygon fill="black" stroke="black" points="10695.5,-19709.25 10692,-19699.25 10688.5,-19709.25 10695.5,-19709.25"/>
</g>
<!-- ring_attn_0_15_stage_2 -->
<g id="node1476" class="node">
<title>ring_attn_0_15_stage_2</title>
<polygon fill="yellow" stroke="black" points="11279,-19952 11070,-19884 11279,-19816 11488,-19884 11279,-19952"/>
<text text-anchor="middle" x="11279" y="-19902.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-19887.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="11279" y="-19872.8" font-family="Times,serif" font-size="14.00">Q[15]×K[13]×V[13]</text>
<text text-anchor="middle" x="11279" y="-19857.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_14_stage_2&#45;&gt;ring_attn_0_15_stage_2 -->
<g id="edge3291" class="edge">
<title>ring_attn_0_14_stage_2&#45;&gt;ring_attn_0_15_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-19884C10901.02,-19884 11059.86,-19884 11059.86,-19884"/>
<polygon fill="red" stroke="red" points="11059.86,-19887.5 11069.86,-19884 11059.86,-19880.5 11059.86,-19887.5"/>
</g>
<!-- ring_attn_0_14_stage_3&#45;&gt;ring_attn_0_14_stage_4 -->
<g id="edge1365" class="edge">
<title>ring_attn_0_14_stage_3&#45;&gt;ring_attn_0_14_stage_4</title>
<path fill="none" stroke="black" d="M10692,-19562.87C10692,-19562.87 10692,-19456.25 10692,-19456.25"/>
<polygon fill="black" stroke="black" points="10695.5,-19456.25 10692,-19446.25 10688.5,-19456.25 10695.5,-19456.25"/>
</g>
<!-- ring_attn_0_15_stage_3 -->
<g id="node1477" class="node">
<title>ring_attn_0_15_stage_3</title>
<polygon fill="yellow" stroke="black" points="11279,-19699 11070,-19631 11279,-19563 11488,-19631 11279,-19699"/>
<text text-anchor="middle" x="11279" y="-19649.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-19634.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="11279" y="-19619.8" font-family="Times,serif" font-size="14.00">Q[15]×K[12]×V[12]</text>
<text text-anchor="middle" x="11279" y="-19604.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_14_stage_3&#45;&gt;ring_attn_0_15_stage_3 -->
<g id="edge3292" class="edge">
<title>ring_attn_0_14_stage_3&#45;&gt;ring_attn_0_15_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-19631C10901.02,-19631 11059.86,-19631 11059.86,-19631"/>
<polygon fill="red" stroke="red" points="11059.86,-19634.5 11069.86,-19631 11059.86,-19627.5 11059.86,-19634.5"/>
</g>
<!-- ring_attn_0_14_stage_4&#45;&gt;ring_attn_0_14_stage_5 -->
<g id="edge1366" class="edge">
<title>ring_attn_0_14_stage_4&#45;&gt;ring_attn_0_14_stage_5</title>
<path fill="none" stroke="black" d="M10692,-19309.87C10692,-19309.87 10692,-19203.25 10692,-19203.25"/>
<polygon fill="black" stroke="black" points="10695.5,-19203.25 10692,-19193.25 10688.5,-19203.25 10695.5,-19203.25"/>
</g>
<!-- ring_attn_0_15_stage_4 -->
<g id="node1478" class="node">
<title>ring_attn_0_15_stage_4</title>
<polygon fill="yellow" stroke="black" points="11279,-19446 11070,-19378 11279,-19310 11488,-19378 11279,-19446"/>
<text text-anchor="middle" x="11279" y="-19396.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-19381.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="11279" y="-19366.8" font-family="Times,serif" font-size="14.00">Q[15]×K[11]×V[11]</text>
<text text-anchor="middle" x="11279" y="-19351.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_14_stage_4&#45;&gt;ring_attn_0_15_stage_4 -->
<g id="edge3293" class="edge">
<title>ring_attn_0_14_stage_4&#45;&gt;ring_attn_0_15_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-19378C10901.02,-19378 11059.86,-19378 11059.86,-19378"/>
<polygon fill="red" stroke="red" points="11059.86,-19381.5 11069.86,-19378 11059.86,-19374.5 11059.86,-19381.5"/>
</g>
<!-- ring_attn_0_14_stage_5&#45;&gt;ring_attn_0_14_stage_6 -->
<g id="edge1367" class="edge">
<title>ring_attn_0_14_stage_5&#45;&gt;ring_attn_0_14_stage_6</title>
<path fill="none" stroke="black" d="M10692,-19056.87C10692,-19056.87 10692,-18950.25 10692,-18950.25"/>
<polygon fill="black" stroke="black" points="10695.5,-18950.25 10692,-18940.25 10688.5,-18950.25 10695.5,-18950.25"/>
</g>
<!-- ring_attn_0_15_stage_5 -->
<g id="node1479" class="node">
<title>ring_attn_0_15_stage_5</title>
<polygon fill="yellow" stroke="black" points="11279,-19193 11070,-19125 11279,-19057 11488,-19125 11279,-19193"/>
<text text-anchor="middle" x="11279" y="-19143.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-19128.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="11279" y="-19113.8" font-family="Times,serif" font-size="14.00">Q[15]×K[10]×V[10]</text>
<text text-anchor="middle" x="11279" y="-19098.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_14_stage_5&#45;&gt;ring_attn_0_15_stage_5 -->
<g id="edge3294" class="edge">
<title>ring_attn_0_14_stage_5&#45;&gt;ring_attn_0_15_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-19125C10901.02,-19125 11059.86,-19125 11059.86,-19125"/>
<polygon fill="red" stroke="red" points="11059.86,-19128.5 11069.86,-19125 11059.86,-19121.5 11059.86,-19128.5"/>
</g>
<!-- ring_attn_0_14_stage_6&#45;&gt;ring_attn_0_14_stage_7 -->
<g id="edge1368" class="edge">
<title>ring_attn_0_14_stage_6&#45;&gt;ring_attn_0_14_stage_7</title>
<path fill="none" stroke="black" d="M10692,-18803.87C10692,-18803.87 10692,-18697.25 10692,-18697.25"/>
<polygon fill="black" stroke="black" points="10695.5,-18697.25 10692,-18687.25 10688.5,-18697.25 10695.5,-18697.25"/>
</g>
<!-- ring_attn_0_15_stage_6 -->
<g id="node1480" class="node">
<title>ring_attn_0_15_stage_6</title>
<polygon fill="yellow" stroke="black" points="11279,-18940 11070,-18872 11279,-18804 11488,-18872 11279,-18940"/>
<text text-anchor="middle" x="11279" y="-18890.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-18875.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="11279" y="-18860.8" font-family="Times,serif" font-size="14.00">Q[15]×K[9]×V[9]</text>
<text text-anchor="middle" x="11279" y="-18845.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_14_stage_6&#45;&gt;ring_attn_0_15_stage_6 -->
<g id="edge3295" class="edge">
<title>ring_attn_0_14_stage_6&#45;&gt;ring_attn_0_15_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-18872C10901.02,-18872 11059.86,-18872 11059.86,-18872"/>
<polygon fill="red" stroke="red" points="11059.86,-18875.5 11069.86,-18872 11059.86,-18868.5 11059.86,-18875.5"/>
</g>
<!-- ring_attn_0_14_stage_7&#45;&gt;ring_attn_0_14_stage_8 -->
<g id="edge1369" class="edge">
<title>ring_attn_0_14_stage_7&#45;&gt;ring_attn_0_14_stage_8</title>
<path fill="none" stroke="black" d="M10692,-18550.87C10692,-18550.87 10692,-18444.25 10692,-18444.25"/>
<polygon fill="black" stroke="black" points="10695.5,-18444.25 10692,-18434.25 10688.5,-18444.25 10695.5,-18444.25"/>
</g>
<!-- ring_attn_0_15_stage_7 -->
<g id="node1481" class="node">
<title>ring_attn_0_15_stage_7</title>
<polygon fill="yellow" stroke="black" points="11279,-18687 11070,-18619 11279,-18551 11488,-18619 11279,-18687"/>
<text text-anchor="middle" x="11279" y="-18637.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-18622.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="11279" y="-18607.8" font-family="Times,serif" font-size="14.00">Q[15]×K[8]×V[8]</text>
<text text-anchor="middle" x="11279" y="-18592.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_14_stage_7&#45;&gt;ring_attn_0_15_stage_7 -->
<g id="edge3296" class="edge">
<title>ring_attn_0_14_stage_7&#45;&gt;ring_attn_0_15_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-18619C10901.02,-18619 11059.86,-18619 11059.86,-18619"/>
<polygon fill="red" stroke="red" points="11059.86,-18622.5 11069.86,-18619 11059.86,-18615.5 11059.86,-18622.5"/>
</g>
<!-- ring_attn_0_14_stage_8&#45;&gt;ring_attn_0_14_stage_9 -->
<g id="edge1370" class="edge">
<title>ring_attn_0_14_stage_8&#45;&gt;ring_attn_0_14_stage_9</title>
<path fill="none" stroke="black" d="M10692,-18297.87C10692,-18297.87 10692,-18191.25 10692,-18191.25"/>
<polygon fill="black" stroke="black" points="10695.5,-18191.25 10692,-18181.25 10688.5,-18191.25 10695.5,-18191.25"/>
</g>
<!-- ring_attn_0_15_stage_8 -->
<g id="node1482" class="node">
<title>ring_attn_0_15_stage_8</title>
<polygon fill="yellow" stroke="black" points="11279,-18434 11070,-18366 11279,-18298 11488,-18366 11279,-18434"/>
<text text-anchor="middle" x="11279" y="-18384.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-18369.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="11279" y="-18354.8" font-family="Times,serif" font-size="14.00">Q[15]×K[7]×V[7]</text>
<text text-anchor="middle" x="11279" y="-18339.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_14_stage_8&#45;&gt;ring_attn_0_15_stage_8 -->
<g id="edge3297" class="edge">
<title>ring_attn_0_14_stage_8&#45;&gt;ring_attn_0_15_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-18366C10901.02,-18366 11059.86,-18366 11059.86,-18366"/>
<polygon fill="red" stroke="red" points="11059.86,-18369.5 11069.86,-18366 11059.86,-18362.5 11059.86,-18369.5"/>
</g>
<!-- ring_attn_0_14_stage_9&#45;&gt;ring_attn_0_14_stage_10 -->
<g id="edge1371" class="edge">
<title>ring_attn_0_14_stage_9&#45;&gt;ring_attn_0_14_stage_10</title>
<path fill="none" stroke="black" d="M10692,-18044.87C10692,-18044.87 10692,-17938.25 10692,-17938.25"/>
<polygon fill="black" stroke="black" points="10695.5,-17938.25 10692,-17928.25 10688.5,-17938.25 10695.5,-17938.25"/>
</g>
<!-- ring_attn_0_15_stage_9 -->
<g id="node1483" class="node">
<title>ring_attn_0_15_stage_9</title>
<polygon fill="yellow" stroke="black" points="11279,-18181 11070,-18113 11279,-18045 11488,-18113 11279,-18181"/>
<text text-anchor="middle" x="11279" y="-18131.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-18116.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="11279" y="-18101.8" font-family="Times,serif" font-size="14.00">Q[15]×K[6]×V[6]</text>
<text text-anchor="middle" x="11279" y="-18086.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_14_stage_9&#45;&gt;ring_attn_0_15_stage_9 -->
<g id="edge3298" class="edge">
<title>ring_attn_0_14_stage_9&#45;&gt;ring_attn_0_15_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-18113C10901.02,-18113 11059.86,-18113 11059.86,-18113"/>
<polygon fill="red" stroke="red" points="11059.86,-18116.5 11069.86,-18113 11059.86,-18109.5 11059.86,-18116.5"/>
</g>
<!-- ring_attn_0_14_stage_10&#45;&gt;ring_attn_0_14_stage_11 -->
<g id="edge1372" class="edge">
<title>ring_attn_0_14_stage_10&#45;&gt;ring_attn_0_14_stage_11</title>
<path fill="none" stroke="black" d="M10692,-17791.87C10692,-17791.87 10692,-17685.25 10692,-17685.25"/>
<polygon fill="black" stroke="black" points="10695.5,-17685.25 10692,-17675.25 10688.5,-17685.25 10695.5,-17685.25"/>
</g>
<!-- ring_attn_0_15_stage_10 -->
<g id="node1484" class="node">
<title>ring_attn_0_15_stage_10</title>
<polygon fill="yellow" stroke="black" points="11279,-17928 11070,-17860 11279,-17792 11488,-17860 11279,-17928"/>
<text text-anchor="middle" x="11279" y="-17878.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-17863.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="11279" y="-17848.8" font-family="Times,serif" font-size="14.00">Q[15]×K[5]×V[5]</text>
<text text-anchor="middle" x="11279" y="-17833.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_14_stage_10&#45;&gt;ring_attn_0_15_stage_10 -->
<g id="edge3299" class="edge">
<title>ring_attn_0_14_stage_10&#45;&gt;ring_attn_0_15_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-17860C10901.02,-17860 11059.86,-17860 11059.86,-17860"/>
<polygon fill="red" stroke="red" points="11059.86,-17863.5 11069.86,-17860 11059.86,-17856.5 11059.86,-17863.5"/>
</g>
<!-- ring_attn_0_14_stage_11&#45;&gt;ring_attn_0_14_stage_12 -->
<g id="edge1373" class="edge">
<title>ring_attn_0_14_stage_11&#45;&gt;ring_attn_0_14_stage_12</title>
<path fill="none" stroke="black" d="M10692,-17538.87C10692,-17538.87 10692,-17432.25 10692,-17432.25"/>
<polygon fill="black" stroke="black" points="10695.5,-17432.25 10692,-17422.25 10688.5,-17432.25 10695.5,-17432.25"/>
</g>
<!-- ring_attn_0_15_stage_11 -->
<g id="node1485" class="node">
<title>ring_attn_0_15_stage_11</title>
<polygon fill="yellow" stroke="black" points="11279,-17675 11070,-17607 11279,-17539 11488,-17607 11279,-17675"/>
<text text-anchor="middle" x="11279" y="-17625.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-17610.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="11279" y="-17595.8" font-family="Times,serif" font-size="14.00">Q[15]×K[4]×V[4]</text>
<text text-anchor="middle" x="11279" y="-17580.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_14_stage_11&#45;&gt;ring_attn_0_15_stage_11 -->
<g id="edge3300" class="edge">
<title>ring_attn_0_14_stage_11&#45;&gt;ring_attn_0_15_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-17607C10901.02,-17607 11059.86,-17607 11059.86,-17607"/>
<polygon fill="red" stroke="red" points="11059.86,-17610.5 11069.86,-17607 11059.86,-17603.5 11059.86,-17610.5"/>
</g>
<!-- ring_attn_0_14_stage_12&#45;&gt;ring_attn_0_14_stage_13 -->
<g id="edge1374" class="edge">
<title>ring_attn_0_14_stage_12&#45;&gt;ring_attn_0_14_stage_13</title>
<path fill="none" stroke="black" d="M10692,-17285.87C10692,-17285.87 10692,-17179.25 10692,-17179.25"/>
<polygon fill="black" stroke="black" points="10695.5,-17179.25 10692,-17169.25 10688.5,-17179.25 10695.5,-17179.25"/>
</g>
<!-- ring_attn_0_15_stage_12 -->
<g id="node1486" class="node">
<title>ring_attn_0_15_stage_12</title>
<polygon fill="yellow" stroke="black" points="11279,-17422 11070,-17354 11279,-17286 11488,-17354 11279,-17422"/>
<text text-anchor="middle" x="11279" y="-17372.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-17357.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="11279" y="-17342.8" font-family="Times,serif" font-size="14.00">Q[15]×K[3]×V[3]</text>
<text text-anchor="middle" x="11279" y="-17327.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_14_stage_12&#45;&gt;ring_attn_0_15_stage_12 -->
<g id="edge3301" class="edge">
<title>ring_attn_0_14_stage_12&#45;&gt;ring_attn_0_15_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-17354C10901.02,-17354 11059.86,-17354 11059.86,-17354"/>
<polygon fill="red" stroke="red" points="11059.86,-17357.5 11069.86,-17354 11059.86,-17350.5 11059.86,-17357.5"/>
</g>
<!-- ring_attn_0_14_stage_13&#45;&gt;ring_attn_0_14_stage_14 -->
<g id="edge1375" class="edge">
<title>ring_attn_0_14_stage_13&#45;&gt;ring_attn_0_14_stage_14</title>
<path fill="none" stroke="black" d="M10692,-17032.87C10692,-17032.87 10692,-16926.25 10692,-16926.25"/>
<polygon fill="black" stroke="black" points="10695.5,-16926.25 10692,-16916.25 10688.5,-16926.25 10695.5,-16926.25"/>
</g>
<!-- ring_attn_0_15_stage_13 -->
<g id="node1487" class="node">
<title>ring_attn_0_15_stage_13</title>
<polygon fill="yellow" stroke="black" points="11279,-17169 11070,-17101 11279,-17033 11488,-17101 11279,-17169"/>
<text text-anchor="middle" x="11279" y="-17119.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-17104.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="11279" y="-17089.8" font-family="Times,serif" font-size="14.00">Q[15]×K[2]×V[2]</text>
<text text-anchor="middle" x="11279" y="-17074.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_14_stage_13&#45;&gt;ring_attn_0_15_stage_13 -->
<g id="edge3302" class="edge">
<title>ring_attn_0_14_stage_13&#45;&gt;ring_attn_0_15_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-17101C10901.02,-17101 11059.86,-17101 11059.86,-17101"/>
<polygon fill="red" stroke="red" points="11059.86,-17104.5 11069.86,-17101 11059.86,-17097.5 11059.86,-17104.5"/>
</g>
<!-- ring_attn_0_14_stage_14&#45;&gt;ring_attn_0_14_stage_15 -->
<g id="edge1376" class="edge">
<title>ring_attn_0_14_stage_14&#45;&gt;ring_attn_0_14_stage_15</title>
<path fill="none" stroke="black" d="M10692,-16779.87C10692,-16779.87 10692,-16673.25 10692,-16673.25"/>
<polygon fill="black" stroke="black" points="10695.5,-16673.25 10692,-16663.25 10688.5,-16673.25 10695.5,-16673.25"/>
</g>
<!-- ring_attn_0_15_stage_14 -->
<g id="node1488" class="node">
<title>ring_attn_0_15_stage_14</title>
<polygon fill="yellow" stroke="black" points="11279,-16916 11070,-16848 11279,-16780 11488,-16848 11279,-16916"/>
<text text-anchor="middle" x="11279" y="-16866.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-16851.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="11279" y="-16836.8" font-family="Times,serif" font-size="14.00">Q[15]×K[1]×V[1]</text>
<text text-anchor="middle" x="11279" y="-16821.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_14_stage_14&#45;&gt;ring_attn_0_15_stage_14 -->
<g id="edge3303" class="edge">
<title>ring_attn_0_14_stage_14&#45;&gt;ring_attn_0_15_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-16848C10901.02,-16848 11059.86,-16848 11059.86,-16848"/>
<polygon fill="red" stroke="red" points="11059.86,-16851.5 11069.86,-16848 11059.86,-16844.5 11059.86,-16851.5"/>
</g>
<!-- attn_out_0_14 -->
<g id="node1392" class="node">
<title>attn_out_0_14</title>
<polygon fill="none" stroke="black" points="10761.5,-16454 10622.5,-16454 10622.5,-16401 10761.5,-16401 10761.5,-16454"/>
<text text-anchor="middle" x="10692" y="-16438.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="10692" y="-16423.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="10692" y="-16408.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_0_14_stage_15&#45;&gt;attn_out_0_14 -->
<g id="edge1377" class="edge">
<title>ring_attn_0_14_stage_15&#45;&gt;attn_out_0_14</title>
<path fill="none" stroke="black" d="M10692,-16526.87C10692,-16526.87 10692,-16464.18 10692,-16464.18"/>
<polygon fill="black" stroke="black" points="10695.5,-16464.18 10692,-16454.18 10688.5,-16464.18 10695.5,-16464.18"/>
</g>
<!-- ring_attn_0_15_stage_15 -->
<g id="node1489" class="node">
<title>ring_attn_0_15_stage_15</title>
<polygon fill="yellow" stroke="black" points="11279,-16663 11070,-16595 11279,-16527 11488,-16595 11279,-16663"/>
<text text-anchor="middle" x="11279" y="-16613.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-16598.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="11279" y="-16583.8" font-family="Times,serif" font-size="14.00">Q[15]×K[0]×V[0]</text>
<text text-anchor="middle" x="11279" y="-16568.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_0_14_stage_15&#45;&gt;ring_attn_0_15_stage_15 -->
<g id="edge3304" class="edge">
<title>ring_attn_0_14_stage_15&#45;&gt;ring_attn_0_15_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-16595C10901.02,-16595 11059.86,-16595 11059.86,-16595"/>
<polygon fill="red" stroke="red" points="11059.86,-16598.5 11069.86,-16595 11059.86,-16591.5 11059.86,-16598.5"/>
</g>
<!-- attn_residual_0_14 -->
<g id="node1393" class="node">
<title>attn_residual_0_14</title>
<ellipse fill="none" stroke="black" cx="10692" cy="-16301" rx="105.5" ry="27"/>
<text text-anchor="middle" x="10692" y="-16304.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="10692" y="-16289.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_0_14&#45;&gt;attn_residual_0_14 -->
<g id="edge1378" class="edge">
<title>attn_out_0_14&#45;&gt;attn_residual_0_14</title>
<path fill="none" stroke="black" d="M10692,-16400.98C10692,-16400.98 10692,-16338.36 10692,-16338.36"/>
<polygon fill="black" stroke="black" points="10695.5,-16338.36 10692,-16328.36 10688.5,-16338.36 10695.5,-16338.36"/>
</g>
<!-- gate_0_14 -->
<g id="node1394" class="node">
<title>gate_0_14</title>
<ellipse fill="orange" stroke="black" cx="10692" cy="-16163.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="10692" y="-16174.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="10692" y="-16159.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="10692" y="-16144.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_0_14&#45;&gt;gate_0_14 -->
<g id="edge1379" class="edge">
<title>attn_residual_0_14&#45;&gt;gate_0_14</title>
<path fill="none" stroke="black" d="M10755.3,-16279.21C10755.3,-16279.21 10755.3,-16203.62 10755.3,-16203.62"/>
<polygon fill="black" stroke="black" points="10758.8,-16203.62 10755.3,-16193.62 10751.8,-16203.62 10758.8,-16203.62"/>
</g>
<!-- gate_0_14&#45;&gt;expert_0_0_0 -->
<g id="edge3305" class="edge">
<title>gate_0_14&#45;&gt;expert_0_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10596.55,-16147.47C10596.55,-16108.31 10596.55,-16011 10596.55,-16011 10596.55,-16011 189.83,-16011 189.83,-16011 189.83,-16011 189.83,-16004.31 189.83,-16004.31"/>
<polygon fill="blue" stroke="blue" points="193.33,-16004.31 189.83,-15994.31 186.33,-16004.31 193.33,-16004.31"/>
<text text-anchor="middle" x="45536.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45536.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU14→GPU0</text>
<text text-anchor="middle" x="45536.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45536.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_14&#45;&gt;expert_0_1_0 -->
<g id="edge3306" class="edge">
<title>gate_0_14&#45;&gt;expert_0_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10616.64,-16137.16C10616.64,-16091.86 10616.64,-16004 10616.64,-16004 10616.64,-16004 3032.23,-16004 3032.23,-16004 3032.23,-16004 3032.23,-16003 3032.23,-16003"/>
<polygon fill="blue" stroke="blue" points="3035.73,-16004.03 3032.23,-15994.03 3028.73,-16004.03 3035.73,-16004.03"/>
<text text-anchor="middle" x="45710.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45710.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU14→GPU1</text>
<text text-anchor="middle" x="45710.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45710.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_14&#45;&gt;expert_0_2_0 -->
<g id="edge3307" class="edge">
<title>gate_0_14&#45;&gt;expert_0_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10636.74,-16131.32C10636.74,-16086.31 10636.74,-16010 10636.74,-16010 10636.74,-16010 3644.09,-16010 3644.09,-16010 3644.09,-16010 3644.09,-16004.17 3644.09,-16004.17"/>
<polygon fill="blue" stroke="blue" points="3647.59,-16004.17 3644.09,-15994.17 3640.59,-16004.17 3647.59,-16004.17"/>
<text text-anchor="middle" x="45884.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45884.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU14→GPU2</text>
<text text-anchor="middle" x="45884.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45884.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_14&#45;&gt;expert_0_3_0 -->
<g id="edge3308" class="edge">
<title>gate_0_14&#45;&gt;expert_0_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10656.83,-16128.07C10656.83,-16083.86 10656.83,-16014 10656.83,-16014 10656.83,-16014 4239.22,-16014 4239.22,-16014 4239.22,-16014 4239.22,-16004.01 4239.22,-16004.01"/>
<polygon fill="blue" stroke="blue" points="4242.72,-16004.01 4239.22,-15994.01 4235.72,-16004.01 4242.72,-16004.01"/>
<text text-anchor="middle" x="46058.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46058.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU14→GPU3</text>
<text text-anchor="middle" x="46058.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46058.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_14&#45;&gt;expert_0_4_0 -->
<g id="edge3309" class="edge">
<title>gate_0_14&#45;&gt;expert_0_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10713.1,-16200.6C10713.1,-16218.44 10713.1,-16236 10713.1,-16236 10713.1,-16236 4713.8,-16236 4713.8,-16236 4713.8,-16236 4713.8,-16004.23 4713.8,-16004.23"/>
<polygon fill="blue" stroke="blue" points="4717.3,-16004.23 4713.8,-15994.23 4710.3,-16004.23 4717.3,-16004.23"/>
<text text-anchor="middle" x="46232.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46232.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU14→GPU4</text>
<text text-anchor="middle" x="46232.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46232.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_14&#45;&gt;expert_0_5_0 -->
<g id="edge3310" class="edge">
<title>gate_0_14&#45;&gt;expert_0_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10670.9,-16200.55C10670.9,-16212.16 10670.9,-16222 10670.9,-16222 10670.9,-16222 5517.88,-16222 5517.88,-16222 5517.88,-16222 5517.88,-16004.25 5517.88,-16004.25"/>
<polygon fill="blue" stroke="blue" points="5521.38,-16004.25 5517.88,-15994.25 5514.38,-16004.25 5521.38,-16004.25"/>
<text text-anchor="middle" x="46406.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46406.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU14→GPU5</text>
<text text-anchor="middle" x="46406.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46406.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_14&#45;&gt;expert_0_6_0 -->
<g id="edge3311" class="edge">
<title>gate_0_14&#45;&gt;expert_0_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10628.7,-16193.92C10628.7,-16201.74 10628.7,-16208 10628.7,-16208 10628.7,-16208 6104.88,-16208 6104.88,-16208 6104.88,-16208 6104.88,-16004.16 6104.88,-16004.16"/>
<polygon fill="blue" stroke="blue" points="6108.38,-16004.16 6104.88,-15994.16 6101.38,-16004.16 6108.38,-16004.16"/>
<text text-anchor="middle" x="46580.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46580.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU14→GPU6</text>
<text text-anchor="middle" x="46580.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46580.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_14&#45;&gt;expert_0_7_0 -->
<g id="edge3312" class="edge">
<title>gate_0_14&#45;&gt;expert_0_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10686.98,-16125.82C10686.98,-16086.96 10686.98,-16032 10686.98,-16032 10686.98,-16032 6618.17,-16032 6618.17,-16032 6618.17,-16032 6618.17,-16004.11 6618.17,-16004.11"/>
<polygon fill="blue" stroke="blue" points="6621.67,-16004.11 6618.17,-15994.11 6614.67,-16004.11 6621.67,-16004.11"/>
<text text-anchor="middle" x="46754.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46754.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU14→GPU7</text>
<text text-anchor="middle" x="46754.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46754.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_14&#45;&gt;expert_0_8_0 -->
<g id="edge3313" class="edge">
<title>gate_0_14&#45;&gt;expert_0_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10707.07,-16126.32C10707.07,-16092.55 10707.07,-16048 10707.07,-16048 10707.07,-16048 7202.11,-16048 7202.11,-16048 7202.11,-16048 7202.11,-16004.31 7202.11,-16004.31"/>
<polygon fill="blue" stroke="blue" points="7205.61,-16004.31 7202.11,-15994.31 7198.61,-16004.31 7205.61,-16004.31"/>
<text text-anchor="middle" x="46928.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46928.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU14→GPU8</text>
<text text-anchor="middle" x="46928.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46928.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_14&#45;&gt;expert_0_9_0 -->
<g id="edge3314" class="edge">
<title>gate_0_14&#45;&gt;expert_0_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10727.17,-16128C10727.17,-16096.69 10727.17,-16056 10727.17,-16056 10727.17,-16056 7795.36,-16056 7795.36,-16056 7795.36,-16056 7795.36,-16004.05 7795.36,-16004.05"/>
<polygon fill="blue" stroke="blue" points="7798.86,-16004.05 7795.36,-15994.05 7791.86,-16004.05 7798.86,-16004.05"/>
<text text-anchor="middle" x="47102.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47102.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU14→GPU9</text>
<text text-anchor="middle" x="47102.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47102.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_14&#45;&gt;expert_0_10_0 -->
<g id="edge3315" class="edge">
<title>gate_0_14&#45;&gt;expert_0_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10747.26,-16131.52C10747.26,-16102.76 10747.26,-16065 10747.26,-16065 10747.26,-16065 8389.21,-16065 8389.21,-16065 8389.21,-16065 8389.21,-16004.14 8389.21,-16004.14"/>
<polygon fill="blue" stroke="blue" points="8392.71,-16004.14 8389.21,-15994.14 8385.71,-16004.14 8392.71,-16004.14"/>
<text text-anchor="middle" x="47276.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47276.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU14→GPU10</text>
<text text-anchor="middle" x="47276.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47276.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_14&#45;&gt;expert_0_11_0 -->
<g id="edge3316" class="edge">
<title>gate_0_14&#45;&gt;expert_0_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10767.36,-16137.18C10767.36,-16109.21 10767.36,-16069 10767.36,-16069 10767.36,-16069 8986.26,-16069 8986.26,-16069 8986.26,-16069 8986.26,-16004.17 8986.26,-16004.17"/>
<polygon fill="blue" stroke="blue" points="8989.76,-16004.17 8986.26,-15994.17 8982.76,-16004.17 8989.76,-16004.17"/>
<text text-anchor="middle" x="47450.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47450.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU14→GPU11</text>
<text text-anchor="middle" x="47450.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47450.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_14&#45;&gt;expert_0_12_0 -->
<g id="edge3317" class="edge">
<title>gate_0_14&#45;&gt;expert_0_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10777.4,-16141.47C10777.4,-16095.8 10777.4,-15995 10777.4,-15995 10777.4,-15995 9632.5,-15995 9632.5,-15995 9632.5,-15995 9632.5,-15994.93 9632.5,-15994.93"/>
<polygon fill="blue" stroke="blue" points="9636,-16004.32 9632.5,-15994.32 9629,-16004.32 9636,-16004.32"/>
<text text-anchor="middle" x="47624.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47624.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU14→GPU12</text>
<text text-anchor="middle" x="47624.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47624.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_14&#45;&gt;expert_0_13_0 -->
<g id="edge3318" class="edge">
<title>gate_0_14&#45;&gt;expert_0_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10592.3,-16176C10452.46,-16176 10215,-16176 10215,-16176 10215,-16176 10215,-16004.33 10215,-16004.33"/>
<polygon fill="blue" stroke="blue" points="10218.5,-16004.33 10215,-15994.33 10211.5,-16004.33 10218.5,-16004.33"/>
<text text-anchor="middle" x="47798.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47798.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU14→GPU13</text>
<text text-anchor="middle" x="47798.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47798.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_14&#45;&gt;expert_0_14_0 -->
<g id="edge1380" class="edge">
<title>gate_0_14&#45;&gt;expert_0_14_0</title>
<path fill="none" stroke="black" d="M10787.45,-16147.46C10787.45,-16147.46 10787.45,-16004.21 10787.45,-16004.21"/>
<polygon fill="black" stroke="black" points="10790.95,-16004.21 10787.45,-15994.21 10783.95,-16004.21 10790.95,-16004.21"/>
</g>
<!-- gate_0_14&#45;&gt;expert_0_15_0 -->
<g id="edge3319" class="edge">
<title>gate_0_14&#45;&gt;expert_0_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10791.52,-16151C10930.74,-16151 11166.75,-16151 11166.75,-16151 11166.75,-16151 11166.75,-16004.18 11166.75,-16004.18"/>
<polygon fill="blue" stroke="blue" points="11170.25,-16004.18 11166.75,-15994.18 11163.25,-16004.18 11170.25,-16004.18"/>
<text text-anchor="middle" x="47972.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47972.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU14→GPU15</text>
<text text-anchor="middle" x="47972.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47972.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_14 -->
<g id="node1396" class="node">
<title>expert_reduce_0_14</title>
<ellipse fill="none" stroke="black" cx="10692" cy="-15830.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="10692" y="-15841.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="10692" y="-15826.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="10692" y="-15811.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_14_0&#45;&gt;expert_reduce_0_14 -->
<g id="edge1381" class="edge">
<title>expert_0_14_0&#45;&gt;expert_reduce_0_14</title>
<path fill="none" stroke="black" d="M10692,-15940.76C10692,-15940.76 10692,-15878.06 10692,-15878.06"/>
<polygon fill="black" stroke="black" points="10695.5,-15878.06 10692,-15868.06 10688.5,-15878.06 10695.5,-15878.06"/>
</g>
<!-- moe_residual_0_14 -->
<g id="node1397" class="node">
<title>moe_residual_0_14</title>
<ellipse fill="none" stroke="black" cx="10692" cy="-15693" rx="105.5" ry="27"/>
<text text-anchor="middle" x="10692" y="-15696.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="10692" y="-15681.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_14&#45;&gt;moe_residual_0_14 -->
<g id="edge1382" class="edge">
<title>expert_reduce_0_14&#45;&gt;moe_residual_0_14</title>
<path fill="none" stroke="black" d="M10692,-15792.93C10692,-15792.93 10692,-15730.06 10692,-15730.06"/>
<polygon fill="black" stroke="black" points="10695.5,-15730.06 10692,-15720.06 10688.5,-15730.06 10695.5,-15730.06"/>
</g>
<!-- qkv_proj_1_14 -->
<g id="node1398" class="node">
<title>qkv_proj_1_14</title>
<polygon fill="none" stroke="black" points="10774.5,-15593 10609.5,-15593 10609.5,-15540 10774.5,-15540 10774.5,-15593"/>
<text text-anchor="middle" x="10692" y="-15577.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="10692" y="-15562.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="10692" y="-15547.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_0_14&#45;&gt;qkv_proj_1_14 -->
<g id="edge1383" class="edge">
<title>moe_residual_0_14&#45;&gt;qkv_proj_1_14</title>
<path fill="none" stroke="black" d="M10692,-15665.86C10692,-15665.86 10692,-15603.16 10692,-15603.16"/>
<polygon fill="black" stroke="black" points="10695.5,-15603.16 10692,-15593.16 10688.5,-15603.16 10695.5,-15603.16"/>
</g>
<!-- qkv_reshape_1_14 -->
<g id="node1399" class="node">
<title>qkv_reshape_1_14</title>
<ellipse fill="none" stroke="black" cx="10692" cy="-15440" rx="148" ry="27"/>
<text text-anchor="middle" x="10692" y="-15443.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="10692" y="-15428.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_1_14&#45;&gt;qkv_reshape_1_14 -->
<g id="edge1384" class="edge">
<title>qkv_proj_1_14&#45;&gt;qkv_reshape_1_14</title>
<path fill="none" stroke="black" d="M10692,-15539.98C10692,-15539.98 10692,-15477.36 10692,-15477.36"/>
<polygon fill="black" stroke="black" points="10695.5,-15477.36 10692,-15467.36 10688.5,-15477.36 10695.5,-15477.36"/>
</g>
<!-- qkv_reshape_1_14&#45;&gt;ring_attn_1_14_stage_0 -->
<g id="edge1385" class="edge">
<title>qkv_reshape_1_14&#45;&gt;ring_attn_1_14_stage_0</title>
<path fill="none" stroke="black" d="M10692,-15412.72C10692,-15412.72 10692,-15306.16 10692,-15306.16"/>
<polygon fill="black" stroke="black" points="10695.5,-15306.16 10692,-15296.16 10688.5,-15306.16 10695.5,-15306.16"/>
</g>
<!-- ring_attn_1_14_stage_0&#45;&gt;ring_attn_1_14_stage_1 -->
<g id="edge1386" class="edge">
<title>ring_attn_1_14_stage_0&#45;&gt;ring_attn_1_14_stage_1</title>
<path fill="none" stroke="black" d="M10692,-15159.87C10692,-15159.87 10692,-15053.25 10692,-15053.25"/>
<polygon fill="black" stroke="black" points="10695.5,-15053.25 10692,-15043.25 10688.5,-15053.25 10695.5,-15053.25"/>
</g>
<!-- ring_attn_1_15_stage_0 -->
<g id="node1498" class="node">
<title>ring_attn_1_15_stage_0</title>
<polygon fill="yellow" stroke="black" points="11279,-15296 11070,-15228 11279,-15160 11488,-15228 11279,-15296"/>
<text text-anchor="middle" x="11279" y="-15246.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-15231.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="11279" y="-15216.8" font-family="Times,serif" font-size="14.00">Q[15]×K[15]×V[15]</text>
<text text-anchor="middle" x="11279" y="-15201.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_14_stage_0&#45;&gt;ring_attn_1_15_stage_0 -->
<g id="edge3320" class="edge">
<title>ring_attn_1_14_stage_0&#45;&gt;ring_attn_1_15_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-15228C10901.02,-15228 11059.86,-15228 11059.86,-15228"/>
<polygon fill="red" stroke="red" points="11059.86,-15231.5 11069.86,-15228 11059.86,-15224.5 11059.86,-15231.5"/>
</g>
<!-- ring_attn_1_14_stage_1&#45;&gt;ring_attn_1_14_stage_2 -->
<g id="edge1387" class="edge">
<title>ring_attn_1_14_stage_1&#45;&gt;ring_attn_1_14_stage_2</title>
<path fill="none" stroke="black" d="M10692,-14906.87C10692,-14906.87 10692,-14800.25 10692,-14800.25"/>
<polygon fill="black" stroke="black" points="10695.5,-14800.25 10692,-14790.25 10688.5,-14800.25 10695.5,-14800.25"/>
</g>
<!-- ring_attn_1_15_stage_1 -->
<g id="node1499" class="node">
<title>ring_attn_1_15_stage_1</title>
<polygon fill="yellow" stroke="black" points="11279,-15043 11070,-14975 11279,-14907 11488,-14975 11279,-15043"/>
<text text-anchor="middle" x="11279" y="-14993.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-14978.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="11279" y="-14963.8" font-family="Times,serif" font-size="14.00">Q[15]×K[14]×V[14]</text>
<text text-anchor="middle" x="11279" y="-14948.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_14_stage_1&#45;&gt;ring_attn_1_15_stage_1 -->
<g id="edge3321" class="edge">
<title>ring_attn_1_14_stage_1&#45;&gt;ring_attn_1_15_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-14975C10901.02,-14975 11059.86,-14975 11059.86,-14975"/>
<polygon fill="red" stroke="red" points="11059.86,-14978.5 11069.86,-14975 11059.86,-14971.5 11059.86,-14978.5"/>
</g>
<!-- ring_attn_1_14_stage_2&#45;&gt;ring_attn_1_14_stage_3 -->
<g id="edge1388" class="edge">
<title>ring_attn_1_14_stage_2&#45;&gt;ring_attn_1_14_stage_3</title>
<path fill="none" stroke="black" d="M10692,-14653.87C10692,-14653.87 10692,-14547.25 10692,-14547.25"/>
<polygon fill="black" stroke="black" points="10695.5,-14547.25 10692,-14537.25 10688.5,-14547.25 10695.5,-14547.25"/>
</g>
<!-- ring_attn_1_15_stage_2 -->
<g id="node1500" class="node">
<title>ring_attn_1_15_stage_2</title>
<polygon fill="yellow" stroke="black" points="11279,-14790 11070,-14722 11279,-14654 11488,-14722 11279,-14790"/>
<text text-anchor="middle" x="11279" y="-14740.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-14725.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="11279" y="-14710.8" font-family="Times,serif" font-size="14.00">Q[15]×K[13]×V[13]</text>
<text text-anchor="middle" x="11279" y="-14695.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_14_stage_2&#45;&gt;ring_attn_1_15_stage_2 -->
<g id="edge3322" class="edge">
<title>ring_attn_1_14_stage_2&#45;&gt;ring_attn_1_15_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-14722C10901.02,-14722 11059.86,-14722 11059.86,-14722"/>
<polygon fill="red" stroke="red" points="11059.86,-14725.5 11069.86,-14722 11059.86,-14718.5 11059.86,-14725.5"/>
</g>
<!-- ring_attn_1_14_stage_3&#45;&gt;ring_attn_1_14_stage_4 -->
<g id="edge1389" class="edge">
<title>ring_attn_1_14_stage_3&#45;&gt;ring_attn_1_14_stage_4</title>
<path fill="none" stroke="black" d="M10692,-14400.87C10692,-14400.87 10692,-14294.25 10692,-14294.25"/>
<polygon fill="black" stroke="black" points="10695.5,-14294.25 10692,-14284.25 10688.5,-14294.25 10695.5,-14294.25"/>
</g>
<!-- ring_attn_1_15_stage_3 -->
<g id="node1501" class="node">
<title>ring_attn_1_15_stage_3</title>
<polygon fill="yellow" stroke="black" points="11279,-14537 11070,-14469 11279,-14401 11488,-14469 11279,-14537"/>
<text text-anchor="middle" x="11279" y="-14487.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-14472.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="11279" y="-14457.8" font-family="Times,serif" font-size="14.00">Q[15]×K[12]×V[12]</text>
<text text-anchor="middle" x="11279" y="-14442.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_14_stage_3&#45;&gt;ring_attn_1_15_stage_3 -->
<g id="edge3323" class="edge">
<title>ring_attn_1_14_stage_3&#45;&gt;ring_attn_1_15_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-14469C10901.02,-14469 11059.86,-14469 11059.86,-14469"/>
<polygon fill="red" stroke="red" points="11059.86,-14472.5 11069.86,-14469 11059.86,-14465.5 11059.86,-14472.5"/>
</g>
<!-- ring_attn_1_14_stage_4&#45;&gt;ring_attn_1_14_stage_5 -->
<g id="edge1390" class="edge">
<title>ring_attn_1_14_stage_4&#45;&gt;ring_attn_1_14_stage_5</title>
<path fill="none" stroke="black" d="M10692,-14147.87C10692,-14147.87 10692,-14041.25 10692,-14041.25"/>
<polygon fill="black" stroke="black" points="10695.5,-14041.25 10692,-14031.25 10688.5,-14041.25 10695.5,-14041.25"/>
</g>
<!-- ring_attn_1_15_stage_4 -->
<g id="node1502" class="node">
<title>ring_attn_1_15_stage_4</title>
<polygon fill="yellow" stroke="black" points="11279,-14284 11070,-14216 11279,-14148 11488,-14216 11279,-14284"/>
<text text-anchor="middle" x="11279" y="-14234.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-14219.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="11279" y="-14204.8" font-family="Times,serif" font-size="14.00">Q[15]×K[11]×V[11]</text>
<text text-anchor="middle" x="11279" y="-14189.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_14_stage_4&#45;&gt;ring_attn_1_15_stage_4 -->
<g id="edge3324" class="edge">
<title>ring_attn_1_14_stage_4&#45;&gt;ring_attn_1_15_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-14216C10901.02,-14216 11059.86,-14216 11059.86,-14216"/>
<polygon fill="red" stroke="red" points="11059.86,-14219.5 11069.86,-14216 11059.86,-14212.5 11059.86,-14219.5"/>
</g>
<!-- ring_attn_1_14_stage_5&#45;&gt;ring_attn_1_14_stage_6 -->
<g id="edge1391" class="edge">
<title>ring_attn_1_14_stage_5&#45;&gt;ring_attn_1_14_stage_6</title>
<path fill="none" stroke="black" d="M10692,-13894.87C10692,-13894.87 10692,-13788.25 10692,-13788.25"/>
<polygon fill="black" stroke="black" points="10695.5,-13788.25 10692,-13778.25 10688.5,-13788.25 10695.5,-13788.25"/>
</g>
<!-- ring_attn_1_15_stage_5 -->
<g id="node1503" class="node">
<title>ring_attn_1_15_stage_5</title>
<polygon fill="yellow" stroke="black" points="11279,-14031 11070,-13963 11279,-13895 11488,-13963 11279,-14031"/>
<text text-anchor="middle" x="11279" y="-13981.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-13966.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="11279" y="-13951.8" font-family="Times,serif" font-size="14.00">Q[15]×K[10]×V[10]</text>
<text text-anchor="middle" x="11279" y="-13936.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_14_stage_5&#45;&gt;ring_attn_1_15_stage_5 -->
<g id="edge3325" class="edge">
<title>ring_attn_1_14_stage_5&#45;&gt;ring_attn_1_15_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-13963C10901.02,-13963 11059.86,-13963 11059.86,-13963"/>
<polygon fill="red" stroke="red" points="11059.86,-13966.5 11069.86,-13963 11059.86,-13959.5 11059.86,-13966.5"/>
</g>
<!-- ring_attn_1_14_stage_6&#45;&gt;ring_attn_1_14_stage_7 -->
<g id="edge1392" class="edge">
<title>ring_attn_1_14_stage_6&#45;&gt;ring_attn_1_14_stage_7</title>
<path fill="none" stroke="black" d="M10692,-13641.87C10692,-13641.87 10692,-13535.25 10692,-13535.25"/>
<polygon fill="black" stroke="black" points="10695.5,-13535.25 10692,-13525.25 10688.5,-13535.25 10695.5,-13535.25"/>
</g>
<!-- ring_attn_1_15_stage_6 -->
<g id="node1504" class="node">
<title>ring_attn_1_15_stage_6</title>
<polygon fill="yellow" stroke="black" points="11279,-13778 11070,-13710 11279,-13642 11488,-13710 11279,-13778"/>
<text text-anchor="middle" x="11279" y="-13728.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-13713.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="11279" y="-13698.8" font-family="Times,serif" font-size="14.00">Q[15]×K[9]×V[9]</text>
<text text-anchor="middle" x="11279" y="-13683.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_14_stage_6&#45;&gt;ring_attn_1_15_stage_6 -->
<g id="edge3326" class="edge">
<title>ring_attn_1_14_stage_6&#45;&gt;ring_attn_1_15_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-13710C10901.02,-13710 11059.86,-13710 11059.86,-13710"/>
<polygon fill="red" stroke="red" points="11059.86,-13713.5 11069.86,-13710 11059.86,-13706.5 11059.86,-13713.5"/>
</g>
<!-- ring_attn_1_14_stage_7&#45;&gt;ring_attn_1_14_stage_8 -->
<g id="edge1393" class="edge">
<title>ring_attn_1_14_stage_7&#45;&gt;ring_attn_1_14_stage_8</title>
<path fill="none" stroke="black" d="M10692,-13388.87C10692,-13388.87 10692,-13282.25 10692,-13282.25"/>
<polygon fill="black" stroke="black" points="10695.5,-13282.25 10692,-13272.25 10688.5,-13282.25 10695.5,-13282.25"/>
</g>
<!-- ring_attn_1_15_stage_7 -->
<g id="node1505" class="node">
<title>ring_attn_1_15_stage_7</title>
<polygon fill="yellow" stroke="black" points="11279,-13525 11070,-13457 11279,-13389 11488,-13457 11279,-13525"/>
<text text-anchor="middle" x="11279" y="-13475.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-13460.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="11279" y="-13445.8" font-family="Times,serif" font-size="14.00">Q[15]×K[8]×V[8]</text>
<text text-anchor="middle" x="11279" y="-13430.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_14_stage_7&#45;&gt;ring_attn_1_15_stage_7 -->
<g id="edge3327" class="edge">
<title>ring_attn_1_14_stage_7&#45;&gt;ring_attn_1_15_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-13457C10901.02,-13457 11059.86,-13457 11059.86,-13457"/>
<polygon fill="red" stroke="red" points="11059.86,-13460.5 11069.86,-13457 11059.86,-13453.5 11059.86,-13460.5"/>
</g>
<!-- ring_attn_1_14_stage_8&#45;&gt;ring_attn_1_14_stage_9 -->
<g id="edge1394" class="edge">
<title>ring_attn_1_14_stage_8&#45;&gt;ring_attn_1_14_stage_9</title>
<path fill="none" stroke="black" d="M10692,-13135.87C10692,-13135.87 10692,-13029.25 10692,-13029.25"/>
<polygon fill="black" stroke="black" points="10695.5,-13029.25 10692,-13019.25 10688.5,-13029.25 10695.5,-13029.25"/>
</g>
<!-- ring_attn_1_15_stage_8 -->
<g id="node1506" class="node">
<title>ring_attn_1_15_stage_8</title>
<polygon fill="yellow" stroke="black" points="11279,-13272 11070,-13204 11279,-13136 11488,-13204 11279,-13272"/>
<text text-anchor="middle" x="11279" y="-13222.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-13207.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="11279" y="-13192.8" font-family="Times,serif" font-size="14.00">Q[15]×K[7]×V[7]</text>
<text text-anchor="middle" x="11279" y="-13177.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_14_stage_8&#45;&gt;ring_attn_1_15_stage_8 -->
<g id="edge3328" class="edge">
<title>ring_attn_1_14_stage_8&#45;&gt;ring_attn_1_15_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-13204C10901.02,-13204 11059.86,-13204 11059.86,-13204"/>
<polygon fill="red" stroke="red" points="11059.86,-13207.5 11069.86,-13204 11059.86,-13200.5 11059.86,-13207.5"/>
</g>
<!-- ring_attn_1_14_stage_9&#45;&gt;ring_attn_1_14_stage_10 -->
<g id="edge1395" class="edge">
<title>ring_attn_1_14_stage_9&#45;&gt;ring_attn_1_14_stage_10</title>
<path fill="none" stroke="black" d="M10692,-12882.87C10692,-12882.87 10692,-12776.25 10692,-12776.25"/>
<polygon fill="black" stroke="black" points="10695.5,-12776.25 10692,-12766.25 10688.5,-12776.25 10695.5,-12776.25"/>
</g>
<!-- ring_attn_1_15_stage_9 -->
<g id="node1507" class="node">
<title>ring_attn_1_15_stage_9</title>
<polygon fill="yellow" stroke="black" points="11279,-13019 11070,-12951 11279,-12883 11488,-12951 11279,-13019"/>
<text text-anchor="middle" x="11279" y="-12969.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-12954.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="11279" y="-12939.8" font-family="Times,serif" font-size="14.00">Q[15]×K[6]×V[6]</text>
<text text-anchor="middle" x="11279" y="-12924.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_14_stage_9&#45;&gt;ring_attn_1_15_stage_9 -->
<g id="edge3329" class="edge">
<title>ring_attn_1_14_stage_9&#45;&gt;ring_attn_1_15_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-12951C10901.02,-12951 11059.86,-12951 11059.86,-12951"/>
<polygon fill="red" stroke="red" points="11059.86,-12954.5 11069.86,-12951 11059.86,-12947.5 11059.86,-12954.5"/>
</g>
<!-- ring_attn_1_14_stage_10&#45;&gt;ring_attn_1_14_stage_11 -->
<g id="edge1396" class="edge">
<title>ring_attn_1_14_stage_10&#45;&gt;ring_attn_1_14_stage_11</title>
<path fill="none" stroke="black" d="M10692,-12629.87C10692,-12629.87 10692,-12523.25 10692,-12523.25"/>
<polygon fill="black" stroke="black" points="10695.5,-12523.25 10692,-12513.25 10688.5,-12523.25 10695.5,-12523.25"/>
</g>
<!-- ring_attn_1_15_stage_10 -->
<g id="node1508" class="node">
<title>ring_attn_1_15_stage_10</title>
<polygon fill="yellow" stroke="black" points="11279,-12766 11070,-12698 11279,-12630 11488,-12698 11279,-12766"/>
<text text-anchor="middle" x="11279" y="-12716.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-12701.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="11279" y="-12686.8" font-family="Times,serif" font-size="14.00">Q[15]×K[5]×V[5]</text>
<text text-anchor="middle" x="11279" y="-12671.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_14_stage_10&#45;&gt;ring_attn_1_15_stage_10 -->
<g id="edge3330" class="edge">
<title>ring_attn_1_14_stage_10&#45;&gt;ring_attn_1_15_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-12698C10901.02,-12698 11059.86,-12698 11059.86,-12698"/>
<polygon fill="red" stroke="red" points="11059.86,-12701.5 11069.86,-12698 11059.86,-12694.5 11059.86,-12701.5"/>
</g>
<!-- ring_attn_1_14_stage_11&#45;&gt;ring_attn_1_14_stage_12 -->
<g id="edge1397" class="edge">
<title>ring_attn_1_14_stage_11&#45;&gt;ring_attn_1_14_stage_12</title>
<path fill="none" stroke="black" d="M10692,-12376.87C10692,-12376.87 10692,-12270.25 10692,-12270.25"/>
<polygon fill="black" stroke="black" points="10695.5,-12270.25 10692,-12260.25 10688.5,-12270.25 10695.5,-12270.25"/>
</g>
<!-- ring_attn_1_15_stage_11 -->
<g id="node1509" class="node">
<title>ring_attn_1_15_stage_11</title>
<polygon fill="yellow" stroke="black" points="11279,-12513 11070,-12445 11279,-12377 11488,-12445 11279,-12513"/>
<text text-anchor="middle" x="11279" y="-12463.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-12448.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="11279" y="-12433.8" font-family="Times,serif" font-size="14.00">Q[15]×K[4]×V[4]</text>
<text text-anchor="middle" x="11279" y="-12418.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_14_stage_11&#45;&gt;ring_attn_1_15_stage_11 -->
<g id="edge3331" class="edge">
<title>ring_attn_1_14_stage_11&#45;&gt;ring_attn_1_15_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-12445C10901.02,-12445 11059.86,-12445 11059.86,-12445"/>
<polygon fill="red" stroke="red" points="11059.86,-12448.5 11069.86,-12445 11059.86,-12441.5 11059.86,-12448.5"/>
</g>
<!-- ring_attn_1_14_stage_12&#45;&gt;ring_attn_1_14_stage_13 -->
<g id="edge1398" class="edge">
<title>ring_attn_1_14_stage_12&#45;&gt;ring_attn_1_14_stage_13</title>
<path fill="none" stroke="black" d="M10692,-12123.87C10692,-12123.87 10692,-12017.25 10692,-12017.25"/>
<polygon fill="black" stroke="black" points="10695.5,-12017.25 10692,-12007.25 10688.5,-12017.25 10695.5,-12017.25"/>
</g>
<!-- ring_attn_1_15_stage_12 -->
<g id="node1510" class="node">
<title>ring_attn_1_15_stage_12</title>
<polygon fill="yellow" stroke="black" points="11279,-12260 11070,-12192 11279,-12124 11488,-12192 11279,-12260"/>
<text text-anchor="middle" x="11279" y="-12210.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-12195.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="11279" y="-12180.8" font-family="Times,serif" font-size="14.00">Q[15]×K[3]×V[3]</text>
<text text-anchor="middle" x="11279" y="-12165.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_14_stage_12&#45;&gt;ring_attn_1_15_stage_12 -->
<g id="edge3332" class="edge">
<title>ring_attn_1_14_stage_12&#45;&gt;ring_attn_1_15_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-12192C10901.02,-12192 11059.86,-12192 11059.86,-12192"/>
<polygon fill="red" stroke="red" points="11059.86,-12195.5 11069.86,-12192 11059.86,-12188.5 11059.86,-12195.5"/>
</g>
<!-- ring_attn_1_14_stage_13&#45;&gt;ring_attn_1_14_stage_14 -->
<g id="edge1399" class="edge">
<title>ring_attn_1_14_stage_13&#45;&gt;ring_attn_1_14_stage_14</title>
<path fill="none" stroke="black" d="M10692,-11870.87C10692,-11870.87 10692,-11764.25 10692,-11764.25"/>
<polygon fill="black" stroke="black" points="10695.5,-11764.25 10692,-11754.25 10688.5,-11764.25 10695.5,-11764.25"/>
</g>
<!-- ring_attn_1_15_stage_13 -->
<g id="node1511" class="node">
<title>ring_attn_1_15_stage_13</title>
<polygon fill="yellow" stroke="black" points="11279,-12007 11070,-11939 11279,-11871 11488,-11939 11279,-12007"/>
<text text-anchor="middle" x="11279" y="-11957.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-11942.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="11279" y="-11927.8" font-family="Times,serif" font-size="14.00">Q[15]×K[2]×V[2]</text>
<text text-anchor="middle" x="11279" y="-11912.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_14_stage_13&#45;&gt;ring_attn_1_15_stage_13 -->
<g id="edge3333" class="edge">
<title>ring_attn_1_14_stage_13&#45;&gt;ring_attn_1_15_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-11939C10901.02,-11939 11059.86,-11939 11059.86,-11939"/>
<polygon fill="red" stroke="red" points="11059.86,-11942.5 11069.86,-11939 11059.86,-11935.5 11059.86,-11942.5"/>
</g>
<!-- ring_attn_1_14_stage_14&#45;&gt;ring_attn_1_14_stage_15 -->
<g id="edge1400" class="edge">
<title>ring_attn_1_14_stage_14&#45;&gt;ring_attn_1_14_stage_15</title>
<path fill="none" stroke="black" d="M10692,-11617.87C10692,-11617.87 10692,-11511.25 10692,-11511.25"/>
<polygon fill="black" stroke="black" points="10695.5,-11511.25 10692,-11501.25 10688.5,-11511.25 10695.5,-11511.25"/>
</g>
<!-- ring_attn_1_15_stage_14 -->
<g id="node1512" class="node">
<title>ring_attn_1_15_stage_14</title>
<polygon fill="yellow" stroke="black" points="11279,-11754 11070,-11686 11279,-11618 11488,-11686 11279,-11754"/>
<text text-anchor="middle" x="11279" y="-11704.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-11689.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="11279" y="-11674.8" font-family="Times,serif" font-size="14.00">Q[15]×K[1]×V[1]</text>
<text text-anchor="middle" x="11279" y="-11659.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_14_stage_14&#45;&gt;ring_attn_1_15_stage_14 -->
<g id="edge3334" class="edge">
<title>ring_attn_1_14_stage_14&#45;&gt;ring_attn_1_15_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-11686C10901.02,-11686 11059.86,-11686 11059.86,-11686"/>
<polygon fill="red" stroke="red" points="11059.86,-11689.5 11069.86,-11686 11059.86,-11682.5 11059.86,-11689.5"/>
</g>
<!-- attn_out_1_14 -->
<g id="node1416" class="node">
<title>attn_out_1_14</title>
<polygon fill="none" stroke="black" points="10761.5,-11292 10622.5,-11292 10622.5,-11239 10761.5,-11239 10761.5,-11292"/>
<text text-anchor="middle" x="10692" y="-11276.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="10692" y="-11261.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="10692" y="-11246.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_1_14_stage_15&#45;&gt;attn_out_1_14 -->
<g id="edge1401" class="edge">
<title>ring_attn_1_14_stage_15&#45;&gt;attn_out_1_14</title>
<path fill="none" stroke="black" d="M10692,-11364.87C10692,-11364.87 10692,-11302.18 10692,-11302.18"/>
<polygon fill="black" stroke="black" points="10695.5,-11302.18 10692,-11292.18 10688.5,-11302.18 10695.5,-11302.18"/>
</g>
<!-- ring_attn_1_15_stage_15 -->
<g id="node1513" class="node">
<title>ring_attn_1_15_stage_15</title>
<polygon fill="yellow" stroke="black" points="11279,-11501 11070,-11433 11279,-11365 11488,-11433 11279,-11501"/>
<text text-anchor="middle" x="11279" y="-11451.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-11436.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="11279" y="-11421.8" font-family="Times,serif" font-size="14.00">Q[15]×K[0]×V[0]</text>
<text text-anchor="middle" x="11279" y="-11406.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_1_14_stage_15&#45;&gt;ring_attn_1_15_stage_15 -->
<g id="edge3335" class="edge">
<title>ring_attn_1_14_stage_15&#45;&gt;ring_attn_1_15_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-11433C10901.02,-11433 11059.86,-11433 11059.86,-11433"/>
<polygon fill="red" stroke="red" points="11059.86,-11436.5 11069.86,-11433 11059.86,-11429.5 11059.86,-11436.5"/>
</g>
<!-- attn_residual_1_14 -->
<g id="node1417" class="node">
<title>attn_residual_1_14</title>
<ellipse fill="none" stroke="black" cx="10692" cy="-11139" rx="105.5" ry="27"/>
<text text-anchor="middle" x="10692" y="-11142.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="10692" y="-11127.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_1_14&#45;&gt;attn_residual_1_14 -->
<g id="edge1402" class="edge">
<title>attn_out_1_14&#45;&gt;attn_residual_1_14</title>
<path fill="none" stroke="black" d="M10692,-11238.98C10692,-11238.98 10692,-11176.36 10692,-11176.36"/>
<polygon fill="black" stroke="black" points="10695.5,-11176.36 10692,-11166.36 10688.5,-11176.36 10695.5,-11176.36"/>
</g>
<!-- gate_1_14 -->
<g id="node1418" class="node">
<title>gate_1_14</title>
<ellipse fill="orange" stroke="black" cx="10692" cy="-11001.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="10692" y="-11012.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="10692" y="-10997.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="10692" y="-10982.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_1_14&#45;&gt;gate_1_14 -->
<g id="edge1403" class="edge">
<title>attn_residual_1_14&#45;&gt;gate_1_14</title>
<path fill="none" stroke="black" d="M10755.3,-11117.21C10755.3,-11117.21 10755.3,-11041.62 10755.3,-11041.62"/>
<polygon fill="black" stroke="black" points="10758.8,-11041.62 10755.3,-11031.62 10751.8,-11041.62 10758.8,-11041.62"/>
</g>
<!-- gate_1_14&#45;&gt;expert_1_0_0 -->
<g id="edge3336" class="edge">
<title>gate_1_14&#45;&gt;expert_1_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10596.55,-10985.47C10596.55,-10946.31 10596.55,-10849 10596.55,-10849 10596.55,-10849 189.83,-10849 189.83,-10849 189.83,-10849 189.83,-10842.31 189.83,-10842.31"/>
<polygon fill="blue" stroke="blue" points="193.33,-10842.31 189.83,-10832.31 186.33,-10842.31 193.33,-10842.31"/>
<text text-anchor="middle" x="45536.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45536.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU14→GPU0</text>
<text text-anchor="middle" x="45536.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45536.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_14&#45;&gt;expert_1_1_0 -->
<g id="edge3337" class="edge">
<title>gate_1_14&#45;&gt;expert_1_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10616.64,-10975.16C10616.64,-10929.86 10616.64,-10842 10616.64,-10842 10616.64,-10842 3032.23,-10842 3032.23,-10842 3032.23,-10842 3032.23,-10841 3032.23,-10841"/>
<polygon fill="blue" stroke="blue" points="3035.73,-10842.03 3032.23,-10832.03 3028.73,-10842.03 3035.73,-10842.03"/>
<text text-anchor="middle" x="45710.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45710.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU14→GPU1</text>
<text text-anchor="middle" x="45710.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45710.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_14&#45;&gt;expert_1_2_0 -->
<g id="edge3338" class="edge">
<title>gate_1_14&#45;&gt;expert_1_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10636.74,-10969.32C10636.74,-10924.31 10636.74,-10848 10636.74,-10848 10636.74,-10848 3644.09,-10848 3644.09,-10848 3644.09,-10848 3644.09,-10842.17 3644.09,-10842.17"/>
<polygon fill="blue" stroke="blue" points="3647.59,-10842.17 3644.09,-10832.17 3640.59,-10842.17 3647.59,-10842.17"/>
<text text-anchor="middle" x="45884.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45884.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU14→GPU2</text>
<text text-anchor="middle" x="45884.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45884.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_14&#45;&gt;expert_1_3_0 -->
<g id="edge3339" class="edge">
<title>gate_1_14&#45;&gt;expert_1_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10656.83,-10966.07C10656.83,-10921.86 10656.83,-10852 10656.83,-10852 10656.83,-10852 4239.22,-10852 4239.22,-10852 4239.22,-10852 4239.22,-10842.01 4239.22,-10842.01"/>
<polygon fill="blue" stroke="blue" points="4242.72,-10842.01 4239.22,-10832.01 4235.72,-10842.01 4242.72,-10842.01"/>
<text text-anchor="middle" x="46058.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46058.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU14→GPU3</text>
<text text-anchor="middle" x="46058.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46058.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_14&#45;&gt;expert_1_4_0 -->
<g id="edge3340" class="edge">
<title>gate_1_14&#45;&gt;expert_1_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10713.1,-11038.6C10713.1,-11056.44 10713.1,-11074 10713.1,-11074 10713.1,-11074 4713.8,-11074 4713.8,-11074 4713.8,-11074 4713.8,-10842.23 4713.8,-10842.23"/>
<polygon fill="blue" stroke="blue" points="4717.3,-10842.23 4713.8,-10832.23 4710.3,-10842.23 4717.3,-10842.23"/>
<text text-anchor="middle" x="46232.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46232.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU14→GPU4</text>
<text text-anchor="middle" x="46232.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46232.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_14&#45;&gt;expert_1_5_0 -->
<g id="edge3341" class="edge">
<title>gate_1_14&#45;&gt;expert_1_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10670.9,-11038.55C10670.9,-11050.16 10670.9,-11060 10670.9,-11060 10670.9,-11060 5517.88,-11060 5517.88,-11060 5517.88,-11060 5517.88,-10842.25 5517.88,-10842.25"/>
<polygon fill="blue" stroke="blue" points="5521.38,-10842.25 5517.88,-10832.25 5514.38,-10842.25 5521.38,-10842.25"/>
<text text-anchor="middle" x="46406.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46406.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU14→GPU5</text>
<text text-anchor="middle" x="46406.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46406.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_14&#45;&gt;expert_1_6_0 -->
<g id="edge3342" class="edge">
<title>gate_1_14&#45;&gt;expert_1_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10628.7,-11031.92C10628.7,-11039.74 10628.7,-11046 10628.7,-11046 10628.7,-11046 6104.88,-11046 6104.88,-11046 6104.88,-11046 6104.88,-10842.16 6104.88,-10842.16"/>
<polygon fill="blue" stroke="blue" points="6108.38,-10842.16 6104.88,-10832.16 6101.38,-10842.16 6108.38,-10842.16"/>
<text text-anchor="middle" x="46580.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46580.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU14→GPU6</text>
<text text-anchor="middle" x="46580.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46580.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_14&#45;&gt;expert_1_7_0 -->
<g id="edge3343" class="edge">
<title>gate_1_14&#45;&gt;expert_1_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10686.98,-10963.82C10686.98,-10924.96 10686.98,-10870 10686.98,-10870 10686.98,-10870 6618.17,-10870 6618.17,-10870 6618.17,-10870 6618.17,-10842.11 6618.17,-10842.11"/>
<polygon fill="blue" stroke="blue" points="6621.67,-10842.11 6618.17,-10832.11 6614.67,-10842.11 6621.67,-10842.11"/>
<text text-anchor="middle" x="46754.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46754.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU14→GPU7</text>
<text text-anchor="middle" x="46754.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46754.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_14&#45;&gt;expert_1_8_0 -->
<g id="edge3344" class="edge">
<title>gate_1_14&#45;&gt;expert_1_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10707.07,-10964.32C10707.07,-10930.55 10707.07,-10886 10707.07,-10886 10707.07,-10886 7202.11,-10886 7202.11,-10886 7202.11,-10886 7202.11,-10842.31 7202.11,-10842.31"/>
<polygon fill="blue" stroke="blue" points="7205.61,-10842.31 7202.11,-10832.31 7198.61,-10842.31 7205.61,-10842.31"/>
<text text-anchor="middle" x="46928.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46928.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU14→GPU8</text>
<text text-anchor="middle" x="46928.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46928.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_14&#45;&gt;expert_1_9_0 -->
<g id="edge3345" class="edge">
<title>gate_1_14&#45;&gt;expert_1_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10727.17,-10966C10727.17,-10934.69 10727.17,-10894 10727.17,-10894 10727.17,-10894 7795.36,-10894 7795.36,-10894 7795.36,-10894 7795.36,-10842.05 7795.36,-10842.05"/>
<polygon fill="blue" stroke="blue" points="7798.86,-10842.05 7795.36,-10832.05 7791.86,-10842.05 7798.86,-10842.05"/>
<text text-anchor="middle" x="47102.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47102.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU14→GPU9</text>
<text text-anchor="middle" x="47102.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47102.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_14&#45;&gt;expert_1_10_0 -->
<g id="edge3346" class="edge">
<title>gate_1_14&#45;&gt;expert_1_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10747.26,-10969.52C10747.26,-10940.76 10747.26,-10903 10747.26,-10903 10747.26,-10903 8389.21,-10903 8389.21,-10903 8389.21,-10903 8389.21,-10842.14 8389.21,-10842.14"/>
<polygon fill="blue" stroke="blue" points="8392.71,-10842.14 8389.21,-10832.14 8385.71,-10842.14 8392.71,-10842.14"/>
<text text-anchor="middle" x="47276.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47276.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU14→GPU10</text>
<text text-anchor="middle" x="47276.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47276.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_14&#45;&gt;expert_1_11_0 -->
<g id="edge3347" class="edge">
<title>gate_1_14&#45;&gt;expert_1_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10767.36,-10975.18C10767.36,-10947.21 10767.36,-10907 10767.36,-10907 10767.36,-10907 8986.26,-10907 8986.26,-10907 8986.26,-10907 8986.26,-10842.17 8986.26,-10842.17"/>
<polygon fill="blue" stroke="blue" points="8989.76,-10842.17 8986.26,-10832.17 8982.76,-10842.17 8989.76,-10842.17"/>
<text text-anchor="middle" x="47450.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47450.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU14→GPU11</text>
<text text-anchor="middle" x="47450.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47450.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_14&#45;&gt;expert_1_12_0 -->
<g id="edge3348" class="edge">
<title>gate_1_14&#45;&gt;expert_1_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10777.4,-10979.47C10777.4,-10933.8 10777.4,-10833 10777.4,-10833 10777.4,-10833 9632.5,-10833 9632.5,-10833 9632.5,-10833 9632.5,-10832.93 9632.5,-10832.93"/>
<polygon fill="blue" stroke="blue" points="9636,-10842.32 9632.5,-10832.32 9629,-10842.32 9636,-10842.32"/>
<text text-anchor="middle" x="47624.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47624.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU14→GPU12</text>
<text text-anchor="middle" x="47624.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47624.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_14&#45;&gt;expert_1_13_0 -->
<g id="edge3349" class="edge">
<title>gate_1_14&#45;&gt;expert_1_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10592.3,-11014C10452.46,-11014 10215,-11014 10215,-11014 10215,-11014 10215,-10842.33 10215,-10842.33"/>
<polygon fill="blue" stroke="blue" points="10218.5,-10842.33 10215,-10832.33 10211.5,-10842.33 10218.5,-10842.33"/>
<text text-anchor="middle" x="47798.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47798.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU14→GPU13</text>
<text text-anchor="middle" x="47798.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47798.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_14&#45;&gt;expert_1_14_0 -->
<g id="edge1404" class="edge">
<title>gate_1_14&#45;&gt;expert_1_14_0</title>
<path fill="none" stroke="black" d="M10787.45,-10985.46C10787.45,-10985.46 10787.45,-10842.21 10787.45,-10842.21"/>
<polygon fill="black" stroke="black" points="10790.95,-10842.21 10787.45,-10832.21 10783.95,-10842.21 10790.95,-10842.21"/>
</g>
<!-- gate_1_14&#45;&gt;expert_1_15_0 -->
<g id="edge3350" class="edge">
<title>gate_1_14&#45;&gt;expert_1_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10791.52,-10989C10930.74,-10989 11166.75,-10989 11166.75,-10989 11166.75,-10989 11166.75,-10842.18 11166.75,-10842.18"/>
<polygon fill="blue" stroke="blue" points="11170.25,-10842.18 11166.75,-10832.18 11163.25,-10842.18 11170.25,-10842.18"/>
<text text-anchor="middle" x="47972.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47972.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU14→GPU15</text>
<text text-anchor="middle" x="47972.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47972.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_14 -->
<g id="node1420" class="node">
<title>expert_reduce_1_14</title>
<ellipse fill="none" stroke="black" cx="10692" cy="-10668.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="10692" y="-10679.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="10692" y="-10664.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="10692" y="-10649.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_14_0&#45;&gt;expert_reduce_1_14 -->
<g id="edge1405" class="edge">
<title>expert_1_14_0&#45;&gt;expert_reduce_1_14</title>
<path fill="none" stroke="black" d="M10692,-10778.76C10692,-10778.76 10692,-10716.06 10692,-10716.06"/>
<polygon fill="black" stroke="black" points="10695.5,-10716.06 10692,-10706.06 10688.5,-10716.06 10695.5,-10716.06"/>
</g>
<!-- moe_residual_1_14 -->
<g id="node1421" class="node">
<title>moe_residual_1_14</title>
<ellipse fill="none" stroke="black" cx="10692" cy="-10531" rx="105.5" ry="27"/>
<text text-anchor="middle" x="10692" y="-10534.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="10692" y="-10519.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_14&#45;&gt;moe_residual_1_14 -->
<g id="edge1406" class="edge">
<title>expert_reduce_1_14&#45;&gt;moe_residual_1_14</title>
<path fill="none" stroke="black" d="M10692,-10630.93C10692,-10630.93 10692,-10568.06 10692,-10568.06"/>
<polygon fill="black" stroke="black" points="10695.5,-10568.06 10692,-10558.06 10688.5,-10568.06 10695.5,-10568.06"/>
</g>
<!-- qkv_proj_2_14 -->
<g id="node1422" class="node">
<title>qkv_proj_2_14</title>
<polygon fill="none" stroke="black" points="10774.5,-10431 10609.5,-10431 10609.5,-10378 10774.5,-10378 10774.5,-10431"/>
<text text-anchor="middle" x="10692" y="-10415.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="10692" y="-10400.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="10692" y="-10385.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_1_14&#45;&gt;qkv_proj_2_14 -->
<g id="edge1407" class="edge">
<title>moe_residual_1_14&#45;&gt;qkv_proj_2_14</title>
<path fill="none" stroke="black" d="M10692,-10503.86C10692,-10503.86 10692,-10441.16 10692,-10441.16"/>
<polygon fill="black" stroke="black" points="10695.5,-10441.16 10692,-10431.16 10688.5,-10441.16 10695.5,-10441.16"/>
</g>
<!-- qkv_reshape_2_14 -->
<g id="node1423" class="node">
<title>qkv_reshape_2_14</title>
<ellipse fill="none" stroke="black" cx="10692" cy="-10278" rx="148" ry="27"/>
<text text-anchor="middle" x="10692" y="-10281.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="10692" y="-10266.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_2_14&#45;&gt;qkv_reshape_2_14 -->
<g id="edge1408" class="edge">
<title>qkv_proj_2_14&#45;&gt;qkv_reshape_2_14</title>
<path fill="none" stroke="black" d="M10692,-10377.98C10692,-10377.98 10692,-10315.36 10692,-10315.36"/>
<polygon fill="black" stroke="black" points="10695.5,-10315.36 10692,-10305.36 10688.5,-10315.36 10695.5,-10315.36"/>
</g>
<!-- qkv_reshape_2_14&#45;&gt;ring_attn_2_14_stage_0 -->
<g id="edge1409" class="edge">
<title>qkv_reshape_2_14&#45;&gt;ring_attn_2_14_stage_0</title>
<path fill="none" stroke="black" d="M10692,-10250.72C10692,-10250.72 10692,-10144.16 10692,-10144.16"/>
<polygon fill="black" stroke="black" points="10695.5,-10144.16 10692,-10134.16 10688.5,-10144.16 10695.5,-10144.16"/>
</g>
<!-- ring_attn_2_14_stage_0&#45;&gt;ring_attn_2_14_stage_1 -->
<g id="edge1410" class="edge">
<title>ring_attn_2_14_stage_0&#45;&gt;ring_attn_2_14_stage_1</title>
<path fill="none" stroke="black" d="M10692,-9997.87C10692,-9997.87 10692,-9891.25 10692,-9891.25"/>
<polygon fill="black" stroke="black" points="10695.5,-9891.25 10692,-9881.25 10688.5,-9891.25 10695.5,-9891.25"/>
</g>
<!-- ring_attn_2_15_stage_0 -->
<g id="node1522" class="node">
<title>ring_attn_2_15_stage_0</title>
<polygon fill="yellow" stroke="black" points="11279,-10134 11070,-10066 11279,-9998 11488,-10066 11279,-10134"/>
<text text-anchor="middle" x="11279" y="-10084.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-10069.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="11279" y="-10054.8" font-family="Times,serif" font-size="14.00">Q[15]×K[15]×V[15]</text>
<text text-anchor="middle" x="11279" y="-10039.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_14_stage_0&#45;&gt;ring_attn_2_15_stage_0 -->
<g id="edge3351" class="edge">
<title>ring_attn_2_14_stage_0&#45;&gt;ring_attn_2_15_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-10066C10901.02,-10066 11059.86,-10066 11059.86,-10066"/>
<polygon fill="red" stroke="red" points="11059.86,-10069.5 11069.86,-10066 11059.86,-10062.5 11059.86,-10069.5"/>
</g>
<!-- ring_attn_2_14_stage_1&#45;&gt;ring_attn_2_14_stage_2 -->
<g id="edge1411" class="edge">
<title>ring_attn_2_14_stage_1&#45;&gt;ring_attn_2_14_stage_2</title>
<path fill="none" stroke="black" d="M10692,-9744.87C10692,-9744.87 10692,-9638.25 10692,-9638.25"/>
<polygon fill="black" stroke="black" points="10695.5,-9638.25 10692,-9628.25 10688.5,-9638.25 10695.5,-9638.25"/>
</g>
<!-- ring_attn_2_15_stage_1 -->
<g id="node1523" class="node">
<title>ring_attn_2_15_stage_1</title>
<polygon fill="yellow" stroke="black" points="11279,-9881 11070,-9813 11279,-9745 11488,-9813 11279,-9881"/>
<text text-anchor="middle" x="11279" y="-9831.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-9816.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="11279" y="-9801.8" font-family="Times,serif" font-size="14.00">Q[15]×K[14]×V[14]</text>
<text text-anchor="middle" x="11279" y="-9786.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_14_stage_1&#45;&gt;ring_attn_2_15_stage_1 -->
<g id="edge3352" class="edge">
<title>ring_attn_2_14_stage_1&#45;&gt;ring_attn_2_15_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-9813C10901.02,-9813 11059.86,-9813 11059.86,-9813"/>
<polygon fill="red" stroke="red" points="11059.86,-9816.5 11069.86,-9813 11059.86,-9809.5 11059.86,-9816.5"/>
</g>
<!-- ring_attn_2_14_stage_2&#45;&gt;ring_attn_2_14_stage_3 -->
<g id="edge1412" class="edge">
<title>ring_attn_2_14_stage_2&#45;&gt;ring_attn_2_14_stage_3</title>
<path fill="none" stroke="black" d="M10692,-9491.87C10692,-9491.87 10692,-9385.25 10692,-9385.25"/>
<polygon fill="black" stroke="black" points="10695.5,-9385.25 10692,-9375.25 10688.5,-9385.25 10695.5,-9385.25"/>
</g>
<!-- ring_attn_2_15_stage_2 -->
<g id="node1524" class="node">
<title>ring_attn_2_15_stage_2</title>
<polygon fill="yellow" stroke="black" points="11279,-9628 11070,-9560 11279,-9492 11488,-9560 11279,-9628"/>
<text text-anchor="middle" x="11279" y="-9578.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-9563.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="11279" y="-9548.8" font-family="Times,serif" font-size="14.00">Q[15]×K[13]×V[13]</text>
<text text-anchor="middle" x="11279" y="-9533.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_14_stage_2&#45;&gt;ring_attn_2_15_stage_2 -->
<g id="edge3353" class="edge">
<title>ring_attn_2_14_stage_2&#45;&gt;ring_attn_2_15_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-9560C10901.02,-9560 11059.86,-9560 11059.86,-9560"/>
<polygon fill="red" stroke="red" points="11059.86,-9563.5 11069.86,-9560 11059.86,-9556.5 11059.86,-9563.5"/>
</g>
<!-- ring_attn_2_14_stage_3&#45;&gt;ring_attn_2_14_stage_4 -->
<g id="edge1413" class="edge">
<title>ring_attn_2_14_stage_3&#45;&gt;ring_attn_2_14_stage_4</title>
<path fill="none" stroke="black" d="M10692,-9238.87C10692,-9238.87 10692,-9132.25 10692,-9132.25"/>
<polygon fill="black" stroke="black" points="10695.5,-9132.25 10692,-9122.25 10688.5,-9132.25 10695.5,-9132.25"/>
</g>
<!-- ring_attn_2_15_stage_3 -->
<g id="node1525" class="node">
<title>ring_attn_2_15_stage_3</title>
<polygon fill="yellow" stroke="black" points="11279,-9375 11070,-9307 11279,-9239 11488,-9307 11279,-9375"/>
<text text-anchor="middle" x="11279" y="-9325.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-9310.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="11279" y="-9295.8" font-family="Times,serif" font-size="14.00">Q[15]×K[12]×V[12]</text>
<text text-anchor="middle" x="11279" y="-9280.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_14_stage_3&#45;&gt;ring_attn_2_15_stage_3 -->
<g id="edge3354" class="edge">
<title>ring_attn_2_14_stage_3&#45;&gt;ring_attn_2_15_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-9307C10901.02,-9307 11059.86,-9307 11059.86,-9307"/>
<polygon fill="red" stroke="red" points="11059.86,-9310.5 11069.86,-9307 11059.86,-9303.5 11059.86,-9310.5"/>
</g>
<!-- ring_attn_2_14_stage_4&#45;&gt;ring_attn_2_14_stage_5 -->
<g id="edge1414" class="edge">
<title>ring_attn_2_14_stage_4&#45;&gt;ring_attn_2_14_stage_5</title>
<path fill="none" stroke="black" d="M10692,-8985.87C10692,-8985.87 10692,-8879.25 10692,-8879.25"/>
<polygon fill="black" stroke="black" points="10695.5,-8879.25 10692,-8869.25 10688.5,-8879.25 10695.5,-8879.25"/>
</g>
<!-- ring_attn_2_15_stage_4 -->
<g id="node1526" class="node">
<title>ring_attn_2_15_stage_4</title>
<polygon fill="yellow" stroke="black" points="11279,-9122 11070,-9054 11279,-8986 11488,-9054 11279,-9122"/>
<text text-anchor="middle" x="11279" y="-9072.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-9057.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="11279" y="-9042.8" font-family="Times,serif" font-size="14.00">Q[15]×K[11]×V[11]</text>
<text text-anchor="middle" x="11279" y="-9027.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_14_stage_4&#45;&gt;ring_attn_2_15_stage_4 -->
<g id="edge3355" class="edge">
<title>ring_attn_2_14_stage_4&#45;&gt;ring_attn_2_15_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-9054C10901.02,-9054 11059.86,-9054 11059.86,-9054"/>
<polygon fill="red" stroke="red" points="11059.86,-9057.5 11069.86,-9054 11059.86,-9050.5 11059.86,-9057.5"/>
</g>
<!-- ring_attn_2_14_stage_5&#45;&gt;ring_attn_2_14_stage_6 -->
<g id="edge1415" class="edge">
<title>ring_attn_2_14_stage_5&#45;&gt;ring_attn_2_14_stage_6</title>
<path fill="none" stroke="black" d="M10692,-8732.87C10692,-8732.87 10692,-8626.25 10692,-8626.25"/>
<polygon fill="black" stroke="black" points="10695.5,-8626.25 10692,-8616.25 10688.5,-8626.25 10695.5,-8626.25"/>
</g>
<!-- ring_attn_2_15_stage_5 -->
<g id="node1527" class="node">
<title>ring_attn_2_15_stage_5</title>
<polygon fill="yellow" stroke="black" points="11279,-8869 11070,-8801 11279,-8733 11488,-8801 11279,-8869"/>
<text text-anchor="middle" x="11279" y="-8819.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-8804.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="11279" y="-8789.8" font-family="Times,serif" font-size="14.00">Q[15]×K[10]×V[10]</text>
<text text-anchor="middle" x="11279" y="-8774.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_14_stage_5&#45;&gt;ring_attn_2_15_stage_5 -->
<g id="edge3356" class="edge">
<title>ring_attn_2_14_stage_5&#45;&gt;ring_attn_2_15_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-8801C10901.02,-8801 11059.86,-8801 11059.86,-8801"/>
<polygon fill="red" stroke="red" points="11059.86,-8804.5 11069.86,-8801 11059.86,-8797.5 11059.86,-8804.5"/>
</g>
<!-- ring_attn_2_14_stage_6&#45;&gt;ring_attn_2_14_stage_7 -->
<g id="edge1416" class="edge">
<title>ring_attn_2_14_stage_6&#45;&gt;ring_attn_2_14_stage_7</title>
<path fill="none" stroke="black" d="M10692,-8479.87C10692,-8479.87 10692,-8373.25 10692,-8373.25"/>
<polygon fill="black" stroke="black" points="10695.5,-8373.25 10692,-8363.25 10688.5,-8373.25 10695.5,-8373.25"/>
</g>
<!-- ring_attn_2_15_stage_6 -->
<g id="node1528" class="node">
<title>ring_attn_2_15_stage_6</title>
<polygon fill="yellow" stroke="black" points="11279,-8616 11070,-8548 11279,-8480 11488,-8548 11279,-8616"/>
<text text-anchor="middle" x="11279" y="-8566.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-8551.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="11279" y="-8536.8" font-family="Times,serif" font-size="14.00">Q[15]×K[9]×V[9]</text>
<text text-anchor="middle" x="11279" y="-8521.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_14_stage_6&#45;&gt;ring_attn_2_15_stage_6 -->
<g id="edge3357" class="edge">
<title>ring_attn_2_14_stage_6&#45;&gt;ring_attn_2_15_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-8548C10901.02,-8548 11059.86,-8548 11059.86,-8548"/>
<polygon fill="red" stroke="red" points="11059.86,-8551.5 11069.86,-8548 11059.86,-8544.5 11059.86,-8551.5"/>
</g>
<!-- ring_attn_2_14_stage_7&#45;&gt;ring_attn_2_14_stage_8 -->
<g id="edge1417" class="edge">
<title>ring_attn_2_14_stage_7&#45;&gt;ring_attn_2_14_stage_8</title>
<path fill="none" stroke="black" d="M10692,-8226.87C10692,-8226.87 10692,-8120.25 10692,-8120.25"/>
<polygon fill="black" stroke="black" points="10695.5,-8120.25 10692,-8110.25 10688.5,-8120.25 10695.5,-8120.25"/>
</g>
<!-- ring_attn_2_15_stage_7 -->
<g id="node1529" class="node">
<title>ring_attn_2_15_stage_7</title>
<polygon fill="yellow" stroke="black" points="11279,-8363 11070,-8295 11279,-8227 11488,-8295 11279,-8363"/>
<text text-anchor="middle" x="11279" y="-8313.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-8298.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="11279" y="-8283.8" font-family="Times,serif" font-size="14.00">Q[15]×K[8]×V[8]</text>
<text text-anchor="middle" x="11279" y="-8268.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_14_stage_7&#45;&gt;ring_attn_2_15_stage_7 -->
<g id="edge3358" class="edge">
<title>ring_attn_2_14_stage_7&#45;&gt;ring_attn_2_15_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-8295C10901.02,-8295 11059.86,-8295 11059.86,-8295"/>
<polygon fill="red" stroke="red" points="11059.86,-8298.5 11069.86,-8295 11059.86,-8291.5 11059.86,-8298.5"/>
</g>
<!-- ring_attn_2_14_stage_8&#45;&gt;ring_attn_2_14_stage_9 -->
<g id="edge1418" class="edge">
<title>ring_attn_2_14_stage_8&#45;&gt;ring_attn_2_14_stage_9</title>
<path fill="none" stroke="black" d="M10692,-7973.87C10692,-7973.87 10692,-7867.25 10692,-7867.25"/>
<polygon fill="black" stroke="black" points="10695.5,-7867.25 10692,-7857.25 10688.5,-7867.25 10695.5,-7867.25"/>
</g>
<!-- ring_attn_2_15_stage_8 -->
<g id="node1530" class="node">
<title>ring_attn_2_15_stage_8</title>
<polygon fill="yellow" stroke="black" points="11279,-8110 11070,-8042 11279,-7974 11488,-8042 11279,-8110"/>
<text text-anchor="middle" x="11279" y="-8060.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-8045.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="11279" y="-8030.8" font-family="Times,serif" font-size="14.00">Q[15]×K[7]×V[7]</text>
<text text-anchor="middle" x="11279" y="-8015.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_14_stage_8&#45;&gt;ring_attn_2_15_stage_8 -->
<g id="edge3359" class="edge">
<title>ring_attn_2_14_stage_8&#45;&gt;ring_attn_2_15_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-8042C10901.02,-8042 11059.86,-8042 11059.86,-8042"/>
<polygon fill="red" stroke="red" points="11059.86,-8045.5 11069.86,-8042 11059.86,-8038.5 11059.86,-8045.5"/>
</g>
<!-- ring_attn_2_14_stage_9&#45;&gt;ring_attn_2_14_stage_10 -->
<g id="edge1419" class="edge">
<title>ring_attn_2_14_stage_9&#45;&gt;ring_attn_2_14_stage_10</title>
<path fill="none" stroke="black" d="M10692,-7720.87C10692,-7720.87 10692,-7614.25 10692,-7614.25"/>
<polygon fill="black" stroke="black" points="10695.5,-7614.25 10692,-7604.25 10688.5,-7614.25 10695.5,-7614.25"/>
</g>
<!-- ring_attn_2_15_stage_9 -->
<g id="node1531" class="node">
<title>ring_attn_2_15_stage_9</title>
<polygon fill="yellow" stroke="black" points="11279,-7857 11070,-7789 11279,-7721 11488,-7789 11279,-7857"/>
<text text-anchor="middle" x="11279" y="-7807.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-7792.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="11279" y="-7777.8" font-family="Times,serif" font-size="14.00">Q[15]×K[6]×V[6]</text>
<text text-anchor="middle" x="11279" y="-7762.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_14_stage_9&#45;&gt;ring_attn_2_15_stage_9 -->
<g id="edge3360" class="edge">
<title>ring_attn_2_14_stage_9&#45;&gt;ring_attn_2_15_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-7789C10901.02,-7789 11059.86,-7789 11059.86,-7789"/>
<polygon fill="red" stroke="red" points="11059.86,-7792.5 11069.86,-7789 11059.86,-7785.5 11059.86,-7792.5"/>
</g>
<!-- ring_attn_2_14_stage_10&#45;&gt;ring_attn_2_14_stage_11 -->
<g id="edge1420" class="edge">
<title>ring_attn_2_14_stage_10&#45;&gt;ring_attn_2_14_stage_11</title>
<path fill="none" stroke="black" d="M10692,-7467.87C10692,-7467.87 10692,-7361.25 10692,-7361.25"/>
<polygon fill="black" stroke="black" points="10695.5,-7361.25 10692,-7351.25 10688.5,-7361.25 10695.5,-7361.25"/>
</g>
<!-- ring_attn_2_15_stage_10 -->
<g id="node1532" class="node">
<title>ring_attn_2_15_stage_10</title>
<polygon fill="yellow" stroke="black" points="11279,-7604 11070,-7536 11279,-7468 11488,-7536 11279,-7604"/>
<text text-anchor="middle" x="11279" y="-7554.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-7539.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="11279" y="-7524.8" font-family="Times,serif" font-size="14.00">Q[15]×K[5]×V[5]</text>
<text text-anchor="middle" x="11279" y="-7509.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_14_stage_10&#45;&gt;ring_attn_2_15_stage_10 -->
<g id="edge3361" class="edge">
<title>ring_attn_2_14_stage_10&#45;&gt;ring_attn_2_15_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-7536C10901.02,-7536 11059.86,-7536 11059.86,-7536"/>
<polygon fill="red" stroke="red" points="11059.86,-7539.5 11069.86,-7536 11059.86,-7532.5 11059.86,-7539.5"/>
</g>
<!-- ring_attn_2_14_stage_11&#45;&gt;ring_attn_2_14_stage_12 -->
<g id="edge1421" class="edge">
<title>ring_attn_2_14_stage_11&#45;&gt;ring_attn_2_14_stage_12</title>
<path fill="none" stroke="black" d="M10692,-7214.87C10692,-7214.87 10692,-7108.25 10692,-7108.25"/>
<polygon fill="black" stroke="black" points="10695.5,-7108.25 10692,-7098.25 10688.5,-7108.25 10695.5,-7108.25"/>
</g>
<!-- ring_attn_2_15_stage_11 -->
<g id="node1533" class="node">
<title>ring_attn_2_15_stage_11</title>
<polygon fill="yellow" stroke="black" points="11279,-7351 11070,-7283 11279,-7215 11488,-7283 11279,-7351"/>
<text text-anchor="middle" x="11279" y="-7301.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-7286.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="11279" y="-7271.8" font-family="Times,serif" font-size="14.00">Q[15]×K[4]×V[4]</text>
<text text-anchor="middle" x="11279" y="-7256.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_14_stage_11&#45;&gt;ring_attn_2_15_stage_11 -->
<g id="edge3362" class="edge">
<title>ring_attn_2_14_stage_11&#45;&gt;ring_attn_2_15_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-7283C10901.02,-7283 11059.86,-7283 11059.86,-7283"/>
<polygon fill="red" stroke="red" points="11059.86,-7286.5 11069.86,-7283 11059.86,-7279.5 11059.86,-7286.5"/>
</g>
<!-- ring_attn_2_14_stage_12&#45;&gt;ring_attn_2_14_stage_13 -->
<g id="edge1422" class="edge">
<title>ring_attn_2_14_stage_12&#45;&gt;ring_attn_2_14_stage_13</title>
<path fill="none" stroke="black" d="M10692,-6961.87C10692,-6961.87 10692,-6855.25 10692,-6855.25"/>
<polygon fill="black" stroke="black" points="10695.5,-6855.25 10692,-6845.25 10688.5,-6855.25 10695.5,-6855.25"/>
</g>
<!-- ring_attn_2_15_stage_12 -->
<g id="node1534" class="node">
<title>ring_attn_2_15_stage_12</title>
<polygon fill="yellow" stroke="black" points="11279,-7098 11070,-7030 11279,-6962 11488,-7030 11279,-7098"/>
<text text-anchor="middle" x="11279" y="-7048.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-7033.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="11279" y="-7018.8" font-family="Times,serif" font-size="14.00">Q[15]×K[3]×V[3]</text>
<text text-anchor="middle" x="11279" y="-7003.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_14_stage_12&#45;&gt;ring_attn_2_15_stage_12 -->
<g id="edge3363" class="edge">
<title>ring_attn_2_14_stage_12&#45;&gt;ring_attn_2_15_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-7030C10901.02,-7030 11059.86,-7030 11059.86,-7030"/>
<polygon fill="red" stroke="red" points="11059.86,-7033.5 11069.86,-7030 11059.86,-7026.5 11059.86,-7033.5"/>
</g>
<!-- ring_attn_2_14_stage_13&#45;&gt;ring_attn_2_14_stage_14 -->
<g id="edge1423" class="edge">
<title>ring_attn_2_14_stage_13&#45;&gt;ring_attn_2_14_stage_14</title>
<path fill="none" stroke="black" d="M10692,-6708.87C10692,-6708.87 10692,-6602.25 10692,-6602.25"/>
<polygon fill="black" stroke="black" points="10695.5,-6602.25 10692,-6592.25 10688.5,-6602.25 10695.5,-6602.25"/>
</g>
<!-- ring_attn_2_15_stage_13 -->
<g id="node1535" class="node">
<title>ring_attn_2_15_stage_13</title>
<polygon fill="yellow" stroke="black" points="11279,-6845 11070,-6777 11279,-6709 11488,-6777 11279,-6845"/>
<text text-anchor="middle" x="11279" y="-6795.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-6780.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="11279" y="-6765.8" font-family="Times,serif" font-size="14.00">Q[15]×K[2]×V[2]</text>
<text text-anchor="middle" x="11279" y="-6750.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_14_stage_13&#45;&gt;ring_attn_2_15_stage_13 -->
<g id="edge3364" class="edge">
<title>ring_attn_2_14_stage_13&#45;&gt;ring_attn_2_15_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-6777C10901.02,-6777 11059.86,-6777 11059.86,-6777"/>
<polygon fill="red" stroke="red" points="11059.86,-6780.5 11069.86,-6777 11059.86,-6773.5 11059.86,-6780.5"/>
</g>
<!-- ring_attn_2_14_stage_14&#45;&gt;ring_attn_2_14_stage_15 -->
<g id="edge1424" class="edge">
<title>ring_attn_2_14_stage_14&#45;&gt;ring_attn_2_14_stage_15</title>
<path fill="none" stroke="black" d="M10692,-6455.87C10692,-6455.87 10692,-6349.25 10692,-6349.25"/>
<polygon fill="black" stroke="black" points="10695.5,-6349.25 10692,-6339.25 10688.5,-6349.25 10695.5,-6349.25"/>
</g>
<!-- ring_attn_2_15_stage_14 -->
<g id="node1536" class="node">
<title>ring_attn_2_15_stage_14</title>
<polygon fill="yellow" stroke="black" points="11279,-6592 11070,-6524 11279,-6456 11488,-6524 11279,-6592"/>
<text text-anchor="middle" x="11279" y="-6542.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-6527.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="11279" y="-6512.8" font-family="Times,serif" font-size="14.00">Q[15]×K[1]×V[1]</text>
<text text-anchor="middle" x="11279" y="-6497.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_14_stage_14&#45;&gt;ring_attn_2_15_stage_14 -->
<g id="edge3365" class="edge">
<title>ring_attn_2_14_stage_14&#45;&gt;ring_attn_2_15_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-6524C10901.02,-6524 11059.86,-6524 11059.86,-6524"/>
<polygon fill="red" stroke="red" points="11059.86,-6527.5 11069.86,-6524 11059.86,-6520.5 11059.86,-6527.5"/>
</g>
<!-- attn_out_2_14 -->
<g id="node1440" class="node">
<title>attn_out_2_14</title>
<polygon fill="none" stroke="black" points="10761.5,-6130 10622.5,-6130 10622.5,-6077 10761.5,-6077 10761.5,-6130"/>
<text text-anchor="middle" x="10692" y="-6114.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="10692" y="-6099.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="10692" y="-6084.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_2_14_stage_15&#45;&gt;attn_out_2_14 -->
<g id="edge1425" class="edge">
<title>ring_attn_2_14_stage_15&#45;&gt;attn_out_2_14</title>
<path fill="none" stroke="black" d="M10692,-6202.87C10692,-6202.87 10692,-6140.18 10692,-6140.18"/>
<polygon fill="black" stroke="black" points="10695.5,-6140.18 10692,-6130.18 10688.5,-6140.18 10695.5,-6140.18"/>
</g>
<!-- ring_attn_2_15_stage_15 -->
<g id="node1537" class="node">
<title>ring_attn_2_15_stage_15</title>
<polygon fill="yellow" stroke="black" points="11279,-6339 11070,-6271 11279,-6203 11488,-6271 11279,-6339"/>
<text text-anchor="middle" x="11279" y="-6289.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-6274.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="11279" y="-6259.8" font-family="Times,serif" font-size="14.00">Q[15]×K[0]×V[0]</text>
<text text-anchor="middle" x="11279" y="-6244.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_2_14_stage_15&#45;&gt;ring_attn_2_15_stage_15 -->
<g id="edge3366" class="edge">
<title>ring_attn_2_14_stage_15&#45;&gt;ring_attn_2_15_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-6271C10901.02,-6271 11059.86,-6271 11059.86,-6271"/>
<polygon fill="red" stroke="red" points="11059.86,-6274.5 11069.86,-6271 11059.86,-6267.5 11059.86,-6274.5"/>
</g>
<!-- attn_residual_2_14 -->
<g id="node1441" class="node">
<title>attn_residual_2_14</title>
<ellipse fill="none" stroke="black" cx="10692" cy="-5977" rx="105.5" ry="27"/>
<text text-anchor="middle" x="10692" y="-5980.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="10692" y="-5965.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_2_14&#45;&gt;attn_residual_2_14 -->
<g id="edge1426" class="edge">
<title>attn_out_2_14&#45;&gt;attn_residual_2_14</title>
<path fill="none" stroke="black" d="M10692,-6076.98C10692,-6076.98 10692,-6014.36 10692,-6014.36"/>
<polygon fill="black" stroke="black" points="10695.5,-6014.36 10692,-6004.36 10688.5,-6014.36 10695.5,-6014.36"/>
</g>
<!-- gate_2_14 -->
<g id="node1442" class="node">
<title>gate_2_14</title>
<ellipse fill="orange" stroke="black" cx="10692" cy="-5839.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="10692" y="-5850.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="10692" y="-5835.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="10692" y="-5820.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_2_14&#45;&gt;gate_2_14 -->
<g id="edge1427" class="edge">
<title>attn_residual_2_14&#45;&gt;gate_2_14</title>
<path fill="none" stroke="black" d="M10755.3,-5955.21C10755.3,-5955.21 10755.3,-5879.62 10755.3,-5879.62"/>
<polygon fill="black" stroke="black" points="10758.8,-5879.62 10755.3,-5869.62 10751.8,-5879.62 10758.8,-5879.62"/>
</g>
<!-- gate_2_14&#45;&gt;expert_2_0_0 -->
<g id="edge3367" class="edge">
<title>gate_2_14&#45;&gt;expert_2_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10596.55,-5823.47C10596.55,-5784.31 10596.55,-5687 10596.55,-5687 10596.55,-5687 189.83,-5687 189.83,-5687 189.83,-5687 189.83,-5680.31 189.83,-5680.31"/>
<polygon fill="blue" stroke="blue" points="193.33,-5680.31 189.83,-5670.31 186.33,-5680.31 193.33,-5680.31"/>
<text text-anchor="middle" x="45536.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45536.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU14→GPU0</text>
<text text-anchor="middle" x="45536.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45536.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_14&#45;&gt;expert_2_1_0 -->
<g id="edge3368" class="edge">
<title>gate_2_14&#45;&gt;expert_2_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10616.64,-5813.16C10616.64,-5767.86 10616.64,-5680 10616.64,-5680 10616.64,-5680 3032.23,-5680 3032.23,-5680 3032.23,-5680 3032.23,-5679 3032.23,-5679"/>
<polygon fill="blue" stroke="blue" points="3035.73,-5680.03 3032.23,-5670.03 3028.73,-5680.03 3035.73,-5680.03"/>
<text text-anchor="middle" x="45710.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45710.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU14→GPU1</text>
<text text-anchor="middle" x="45710.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45710.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_14&#45;&gt;expert_2_2_0 -->
<g id="edge3369" class="edge">
<title>gate_2_14&#45;&gt;expert_2_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10636.74,-5807.32C10636.74,-5762.31 10636.74,-5686 10636.74,-5686 10636.74,-5686 3644.09,-5686 3644.09,-5686 3644.09,-5686 3644.09,-5680.17 3644.09,-5680.17"/>
<polygon fill="blue" stroke="blue" points="3647.59,-5680.17 3644.09,-5670.17 3640.59,-5680.17 3647.59,-5680.17"/>
<text text-anchor="middle" x="45884.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45884.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU14→GPU2</text>
<text text-anchor="middle" x="45884.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45884.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_14&#45;&gt;expert_2_3_0 -->
<g id="edge3370" class="edge">
<title>gate_2_14&#45;&gt;expert_2_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10656.83,-5804.07C10656.83,-5759.86 10656.83,-5690 10656.83,-5690 10656.83,-5690 4239.22,-5690 4239.22,-5690 4239.22,-5690 4239.22,-5680.01 4239.22,-5680.01"/>
<polygon fill="blue" stroke="blue" points="4242.72,-5680.01 4239.22,-5670.01 4235.72,-5680.01 4242.72,-5680.01"/>
<text text-anchor="middle" x="46058.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46058.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU14→GPU3</text>
<text text-anchor="middle" x="46058.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46058.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_14&#45;&gt;expert_2_4_0 -->
<g id="edge3371" class="edge">
<title>gate_2_14&#45;&gt;expert_2_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10713.1,-5876.6C10713.1,-5894.44 10713.1,-5912 10713.1,-5912 10713.1,-5912 4713.8,-5912 4713.8,-5912 4713.8,-5912 4713.8,-5680.23 4713.8,-5680.23"/>
<polygon fill="blue" stroke="blue" points="4717.3,-5680.23 4713.8,-5670.23 4710.3,-5680.23 4717.3,-5680.23"/>
<text text-anchor="middle" x="46232.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46232.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU14→GPU4</text>
<text text-anchor="middle" x="46232.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46232.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_14&#45;&gt;expert_2_5_0 -->
<g id="edge3372" class="edge">
<title>gate_2_14&#45;&gt;expert_2_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10670.9,-5876.55C10670.9,-5888.16 10670.9,-5898 10670.9,-5898 10670.9,-5898 5517.88,-5898 5517.88,-5898 5517.88,-5898 5517.88,-5680.25 5517.88,-5680.25"/>
<polygon fill="blue" stroke="blue" points="5521.38,-5680.25 5517.88,-5670.25 5514.38,-5680.25 5521.38,-5680.25"/>
<text text-anchor="middle" x="46406.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46406.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU14→GPU5</text>
<text text-anchor="middle" x="46406.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46406.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_14&#45;&gt;expert_2_6_0 -->
<g id="edge3373" class="edge">
<title>gate_2_14&#45;&gt;expert_2_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10628.7,-5869.92C10628.7,-5877.74 10628.7,-5884 10628.7,-5884 10628.7,-5884 6104.88,-5884 6104.88,-5884 6104.88,-5884 6104.88,-5680.16 6104.88,-5680.16"/>
<polygon fill="blue" stroke="blue" points="6108.38,-5680.16 6104.88,-5670.16 6101.38,-5680.16 6108.38,-5680.16"/>
<text text-anchor="middle" x="46580.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46580.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU14→GPU6</text>
<text text-anchor="middle" x="46580.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46580.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_14&#45;&gt;expert_2_7_0 -->
<g id="edge3374" class="edge">
<title>gate_2_14&#45;&gt;expert_2_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10686.98,-5801.82C10686.98,-5762.96 10686.98,-5708 10686.98,-5708 10686.98,-5708 6618.17,-5708 6618.17,-5708 6618.17,-5708 6618.17,-5680.11 6618.17,-5680.11"/>
<polygon fill="blue" stroke="blue" points="6621.67,-5680.11 6618.17,-5670.11 6614.67,-5680.11 6621.67,-5680.11"/>
<text text-anchor="middle" x="46754.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46754.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU14→GPU7</text>
<text text-anchor="middle" x="46754.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46754.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_14&#45;&gt;expert_2_8_0 -->
<g id="edge3375" class="edge">
<title>gate_2_14&#45;&gt;expert_2_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10707.07,-5802.32C10707.07,-5768.55 10707.07,-5724 10707.07,-5724 10707.07,-5724 7202.11,-5724 7202.11,-5724 7202.11,-5724 7202.11,-5680.31 7202.11,-5680.31"/>
<polygon fill="blue" stroke="blue" points="7205.61,-5680.31 7202.11,-5670.31 7198.61,-5680.31 7205.61,-5680.31"/>
<text text-anchor="middle" x="46928.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46928.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU14→GPU8</text>
<text text-anchor="middle" x="46928.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46928.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_14&#45;&gt;expert_2_9_0 -->
<g id="edge3376" class="edge">
<title>gate_2_14&#45;&gt;expert_2_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10727.17,-5804C10727.17,-5772.69 10727.17,-5732 10727.17,-5732 10727.17,-5732 7795.36,-5732 7795.36,-5732 7795.36,-5732 7795.36,-5680.05 7795.36,-5680.05"/>
<polygon fill="blue" stroke="blue" points="7798.86,-5680.05 7795.36,-5670.05 7791.86,-5680.05 7798.86,-5680.05"/>
<text text-anchor="middle" x="47102.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47102.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU14→GPU9</text>
<text text-anchor="middle" x="47102.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47102.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_14&#45;&gt;expert_2_10_0 -->
<g id="edge3377" class="edge">
<title>gate_2_14&#45;&gt;expert_2_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10747.26,-5807.52C10747.26,-5778.76 10747.26,-5741 10747.26,-5741 10747.26,-5741 8389.21,-5741 8389.21,-5741 8389.21,-5741 8389.21,-5680.14 8389.21,-5680.14"/>
<polygon fill="blue" stroke="blue" points="8392.71,-5680.14 8389.21,-5670.14 8385.71,-5680.14 8392.71,-5680.14"/>
<text text-anchor="middle" x="47276.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47276.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU14→GPU10</text>
<text text-anchor="middle" x="47276.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47276.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_14&#45;&gt;expert_2_11_0 -->
<g id="edge3378" class="edge">
<title>gate_2_14&#45;&gt;expert_2_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10767.36,-5813.18C10767.36,-5785.21 10767.36,-5745 10767.36,-5745 10767.36,-5745 8986.26,-5745 8986.26,-5745 8986.26,-5745 8986.26,-5680.17 8986.26,-5680.17"/>
<polygon fill="blue" stroke="blue" points="8989.76,-5680.17 8986.26,-5670.17 8982.76,-5680.17 8989.76,-5680.17"/>
<text text-anchor="middle" x="47450.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47450.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU14→GPU11</text>
<text text-anchor="middle" x="47450.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47450.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_14&#45;&gt;expert_2_12_0 -->
<g id="edge3379" class="edge">
<title>gate_2_14&#45;&gt;expert_2_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10777.4,-5817.47C10777.4,-5771.8 10777.4,-5671 10777.4,-5671 10777.4,-5671 9632.5,-5671 9632.5,-5671 9632.5,-5671 9632.5,-5670.93 9632.5,-5670.93"/>
<polygon fill="blue" stroke="blue" points="9636,-5680.32 9632.5,-5670.32 9629,-5680.32 9636,-5680.32"/>
<text text-anchor="middle" x="47624.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47624.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU14→GPU12</text>
<text text-anchor="middle" x="47624.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47624.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_14&#45;&gt;expert_2_13_0 -->
<g id="edge3380" class="edge">
<title>gate_2_14&#45;&gt;expert_2_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10592.3,-5852C10452.46,-5852 10215,-5852 10215,-5852 10215,-5852 10215,-5680.33 10215,-5680.33"/>
<polygon fill="blue" stroke="blue" points="10218.5,-5680.33 10215,-5670.33 10211.5,-5680.33 10218.5,-5680.33"/>
<text text-anchor="middle" x="47798.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47798.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU14→GPU13</text>
<text text-anchor="middle" x="47798.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47798.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_14&#45;&gt;expert_2_14_0 -->
<g id="edge1428" class="edge">
<title>gate_2_14&#45;&gt;expert_2_14_0</title>
<path fill="none" stroke="black" d="M10787.45,-5823.46C10787.45,-5823.46 10787.45,-5680.21 10787.45,-5680.21"/>
<polygon fill="black" stroke="black" points="10790.95,-5680.21 10787.45,-5670.21 10783.95,-5680.21 10790.95,-5680.21"/>
</g>
<!-- gate_2_14&#45;&gt;expert_2_15_0 -->
<g id="edge3381" class="edge">
<title>gate_2_14&#45;&gt;expert_2_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10791.52,-5827C10930.74,-5827 11166.75,-5827 11166.75,-5827 11166.75,-5827 11166.75,-5680.18 11166.75,-5680.18"/>
<polygon fill="blue" stroke="blue" points="11170.25,-5680.18 11166.75,-5670.18 11163.25,-5680.18 11170.25,-5680.18"/>
<text text-anchor="middle" x="47972.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47972.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU14→GPU15</text>
<text text-anchor="middle" x="47972.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47972.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_14 -->
<g id="node1444" class="node">
<title>expert_reduce_2_14</title>
<ellipse fill="none" stroke="black" cx="10692" cy="-5506.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="10692" y="-5517.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="10692" y="-5502.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="10692" y="-5487.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_14_0&#45;&gt;expert_reduce_2_14 -->
<g id="edge1429" class="edge">
<title>expert_2_14_0&#45;&gt;expert_reduce_2_14</title>
<path fill="none" stroke="black" d="M10692,-5616.76C10692,-5616.76 10692,-5554.06 10692,-5554.06"/>
<polygon fill="black" stroke="black" points="10695.5,-5554.06 10692,-5544.06 10688.5,-5554.06 10695.5,-5554.06"/>
</g>
<!-- moe_residual_2_14 -->
<g id="node1445" class="node">
<title>moe_residual_2_14</title>
<ellipse fill="none" stroke="black" cx="10692" cy="-5369" rx="105.5" ry="27"/>
<text text-anchor="middle" x="10692" y="-5372.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="10692" y="-5357.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_14&#45;&gt;moe_residual_2_14 -->
<g id="edge1430" class="edge">
<title>expert_reduce_2_14&#45;&gt;moe_residual_2_14</title>
<path fill="none" stroke="black" d="M10692,-5468.93C10692,-5468.93 10692,-5406.06 10692,-5406.06"/>
<polygon fill="black" stroke="black" points="10695.5,-5406.06 10692,-5396.06 10688.5,-5406.06 10695.5,-5406.06"/>
</g>
<!-- qkv_proj_3_14 -->
<g id="node1446" class="node">
<title>qkv_proj_3_14</title>
<polygon fill="none" stroke="black" points="10774.5,-5269 10609.5,-5269 10609.5,-5216 10774.5,-5216 10774.5,-5269"/>
<text text-anchor="middle" x="10692" y="-5253.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="10692" y="-5238.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="10692" y="-5223.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_2_14&#45;&gt;qkv_proj_3_14 -->
<g id="edge1431" class="edge">
<title>moe_residual_2_14&#45;&gt;qkv_proj_3_14</title>
<path fill="none" stroke="black" d="M10692,-5341.86C10692,-5341.86 10692,-5279.16 10692,-5279.16"/>
<polygon fill="black" stroke="black" points="10695.5,-5279.16 10692,-5269.16 10688.5,-5279.16 10695.5,-5279.16"/>
</g>
<!-- qkv_reshape_3_14 -->
<g id="node1447" class="node">
<title>qkv_reshape_3_14</title>
<ellipse fill="none" stroke="black" cx="10692" cy="-5116" rx="148" ry="27"/>
<text text-anchor="middle" x="10692" y="-5119.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="10692" y="-5104.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_3_14&#45;&gt;qkv_reshape_3_14 -->
<g id="edge1432" class="edge">
<title>qkv_proj_3_14&#45;&gt;qkv_reshape_3_14</title>
<path fill="none" stroke="black" d="M10692,-5215.98C10692,-5215.98 10692,-5153.36 10692,-5153.36"/>
<polygon fill="black" stroke="black" points="10695.5,-5153.36 10692,-5143.36 10688.5,-5153.36 10695.5,-5153.36"/>
</g>
<!-- qkv_reshape_3_14&#45;&gt;ring_attn_3_14_stage_0 -->
<g id="edge1433" class="edge">
<title>qkv_reshape_3_14&#45;&gt;ring_attn_3_14_stage_0</title>
<path fill="none" stroke="black" d="M10692,-5088.72C10692,-5088.72 10692,-4982.16 10692,-4982.16"/>
<polygon fill="black" stroke="black" points="10695.5,-4982.16 10692,-4972.16 10688.5,-4982.16 10695.5,-4982.16"/>
</g>
<!-- ring_attn_3_14_stage_0&#45;&gt;ring_attn_3_14_stage_1 -->
<g id="edge1434" class="edge">
<title>ring_attn_3_14_stage_0&#45;&gt;ring_attn_3_14_stage_1</title>
<path fill="none" stroke="black" d="M10692,-4835.87C10692,-4835.87 10692,-4729.25 10692,-4729.25"/>
<polygon fill="black" stroke="black" points="10695.5,-4729.25 10692,-4719.25 10688.5,-4729.25 10695.5,-4729.25"/>
</g>
<!-- ring_attn_3_15_stage_0 -->
<g id="node1546" class="node">
<title>ring_attn_3_15_stage_0</title>
<polygon fill="yellow" stroke="black" points="11279,-4972 11070,-4904 11279,-4836 11488,-4904 11279,-4972"/>
<text text-anchor="middle" x="11279" y="-4922.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-4907.8" font-family="Times,serif" font-size="14.00">Stage 0</text>
<text text-anchor="middle" x="11279" y="-4892.8" font-family="Times,serif" font-size="14.00">Q[15]×K[15]×V[15]</text>
<text text-anchor="middle" x="11279" y="-4877.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_14_stage_0&#45;&gt;ring_attn_3_15_stage_0 -->
<g id="edge3382" class="edge">
<title>ring_attn_3_14_stage_0&#45;&gt;ring_attn_3_15_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-4904C10901.02,-4904 11059.86,-4904 11059.86,-4904"/>
<polygon fill="red" stroke="red" points="11059.86,-4907.5 11069.86,-4904 11059.86,-4900.5 11059.86,-4907.5"/>
</g>
<!-- ring_attn_3_14_stage_1&#45;&gt;ring_attn_3_14_stage_2 -->
<g id="edge1435" class="edge">
<title>ring_attn_3_14_stage_1&#45;&gt;ring_attn_3_14_stage_2</title>
<path fill="none" stroke="black" d="M10692,-4582.87C10692,-4582.87 10692,-4476.25 10692,-4476.25"/>
<polygon fill="black" stroke="black" points="10695.5,-4476.25 10692,-4466.25 10688.5,-4476.25 10695.5,-4476.25"/>
</g>
<!-- ring_attn_3_15_stage_1 -->
<g id="node1547" class="node">
<title>ring_attn_3_15_stage_1</title>
<polygon fill="yellow" stroke="black" points="11279,-4719 11070,-4651 11279,-4583 11488,-4651 11279,-4719"/>
<text text-anchor="middle" x="11279" y="-4669.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-4654.8" font-family="Times,serif" font-size="14.00">Stage 1</text>
<text text-anchor="middle" x="11279" y="-4639.8" font-family="Times,serif" font-size="14.00">Q[15]×K[14]×V[14]</text>
<text text-anchor="middle" x="11279" y="-4624.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_14_stage_1&#45;&gt;ring_attn_3_15_stage_1 -->
<g id="edge3383" class="edge">
<title>ring_attn_3_14_stage_1&#45;&gt;ring_attn_3_15_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-4651C10901.02,-4651 11059.86,-4651 11059.86,-4651"/>
<polygon fill="red" stroke="red" points="11059.86,-4654.5 11069.86,-4651 11059.86,-4647.5 11059.86,-4654.5"/>
</g>
<!-- ring_attn_3_14_stage_2&#45;&gt;ring_attn_3_14_stage_3 -->
<g id="edge1436" class="edge">
<title>ring_attn_3_14_stage_2&#45;&gt;ring_attn_3_14_stage_3</title>
<path fill="none" stroke="black" d="M10692,-4329.87C10692,-4329.87 10692,-4223.25 10692,-4223.25"/>
<polygon fill="black" stroke="black" points="10695.5,-4223.25 10692,-4213.25 10688.5,-4223.25 10695.5,-4223.25"/>
</g>
<!-- ring_attn_3_15_stage_2 -->
<g id="node1548" class="node">
<title>ring_attn_3_15_stage_2</title>
<polygon fill="yellow" stroke="black" points="11279,-4466 11070,-4398 11279,-4330 11488,-4398 11279,-4466"/>
<text text-anchor="middle" x="11279" y="-4416.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-4401.8" font-family="Times,serif" font-size="14.00">Stage 2</text>
<text text-anchor="middle" x="11279" y="-4386.8" font-family="Times,serif" font-size="14.00">Q[15]×K[13]×V[13]</text>
<text text-anchor="middle" x="11279" y="-4371.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_14_stage_2&#45;&gt;ring_attn_3_15_stage_2 -->
<g id="edge3384" class="edge">
<title>ring_attn_3_14_stage_2&#45;&gt;ring_attn_3_15_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-4398C10901.02,-4398 11059.86,-4398 11059.86,-4398"/>
<polygon fill="red" stroke="red" points="11059.86,-4401.5 11069.86,-4398 11059.86,-4394.5 11059.86,-4401.5"/>
</g>
<!-- ring_attn_3_14_stage_3&#45;&gt;ring_attn_3_14_stage_4 -->
<g id="edge1437" class="edge">
<title>ring_attn_3_14_stage_3&#45;&gt;ring_attn_3_14_stage_4</title>
<path fill="none" stroke="black" d="M10692,-4076.87C10692,-4076.87 10692,-3970.25 10692,-3970.25"/>
<polygon fill="black" stroke="black" points="10695.5,-3970.25 10692,-3960.25 10688.5,-3970.25 10695.5,-3970.25"/>
</g>
<!-- ring_attn_3_15_stage_3 -->
<g id="node1549" class="node">
<title>ring_attn_3_15_stage_3</title>
<polygon fill="yellow" stroke="black" points="11279,-4213 11070,-4145 11279,-4077 11488,-4145 11279,-4213"/>
<text text-anchor="middle" x="11279" y="-4163.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-4148.8" font-family="Times,serif" font-size="14.00">Stage 3</text>
<text text-anchor="middle" x="11279" y="-4133.8" font-family="Times,serif" font-size="14.00">Q[15]×K[12]×V[12]</text>
<text text-anchor="middle" x="11279" y="-4118.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_14_stage_3&#45;&gt;ring_attn_3_15_stage_3 -->
<g id="edge3385" class="edge">
<title>ring_attn_3_14_stage_3&#45;&gt;ring_attn_3_15_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-4145C10901.02,-4145 11059.86,-4145 11059.86,-4145"/>
<polygon fill="red" stroke="red" points="11059.86,-4148.5 11069.86,-4145 11059.86,-4141.5 11059.86,-4148.5"/>
</g>
<!-- ring_attn_3_14_stage_4&#45;&gt;ring_attn_3_14_stage_5 -->
<g id="edge1438" class="edge">
<title>ring_attn_3_14_stage_4&#45;&gt;ring_attn_3_14_stage_5</title>
<path fill="none" stroke="black" d="M10692,-3823.87C10692,-3823.87 10692,-3717.25 10692,-3717.25"/>
<polygon fill="black" stroke="black" points="10695.5,-3717.25 10692,-3707.25 10688.5,-3717.25 10695.5,-3717.25"/>
</g>
<!-- ring_attn_3_15_stage_4 -->
<g id="node1550" class="node">
<title>ring_attn_3_15_stage_4</title>
<polygon fill="yellow" stroke="black" points="11279,-3960 11070,-3892 11279,-3824 11488,-3892 11279,-3960"/>
<text text-anchor="middle" x="11279" y="-3910.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-3895.8" font-family="Times,serif" font-size="14.00">Stage 4</text>
<text text-anchor="middle" x="11279" y="-3880.8" font-family="Times,serif" font-size="14.00">Q[15]×K[11]×V[11]</text>
<text text-anchor="middle" x="11279" y="-3865.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_14_stage_4&#45;&gt;ring_attn_3_15_stage_4 -->
<g id="edge3386" class="edge">
<title>ring_attn_3_14_stage_4&#45;&gt;ring_attn_3_15_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-3892C10901.02,-3892 11059.86,-3892 11059.86,-3892"/>
<polygon fill="red" stroke="red" points="11059.86,-3895.5 11069.86,-3892 11059.86,-3888.5 11059.86,-3895.5"/>
</g>
<!-- ring_attn_3_14_stage_5&#45;&gt;ring_attn_3_14_stage_6 -->
<g id="edge1439" class="edge">
<title>ring_attn_3_14_stage_5&#45;&gt;ring_attn_3_14_stage_6</title>
<path fill="none" stroke="black" d="M10692,-3570.87C10692,-3570.87 10692,-3464.25 10692,-3464.25"/>
<polygon fill="black" stroke="black" points="10695.5,-3464.25 10692,-3454.25 10688.5,-3464.25 10695.5,-3464.25"/>
</g>
<!-- ring_attn_3_15_stage_5 -->
<g id="node1551" class="node">
<title>ring_attn_3_15_stage_5</title>
<polygon fill="yellow" stroke="black" points="11279,-3707 11070,-3639 11279,-3571 11488,-3639 11279,-3707"/>
<text text-anchor="middle" x="11279" y="-3657.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-3642.8" font-family="Times,serif" font-size="14.00">Stage 5</text>
<text text-anchor="middle" x="11279" y="-3627.8" font-family="Times,serif" font-size="14.00">Q[15]×K[10]×V[10]</text>
<text text-anchor="middle" x="11279" y="-3612.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_14_stage_5&#45;&gt;ring_attn_3_15_stage_5 -->
<g id="edge3387" class="edge">
<title>ring_attn_3_14_stage_5&#45;&gt;ring_attn_3_15_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-3639C10901.02,-3639 11059.86,-3639 11059.86,-3639"/>
<polygon fill="red" stroke="red" points="11059.86,-3642.5 11069.86,-3639 11059.86,-3635.5 11059.86,-3642.5"/>
</g>
<!-- ring_attn_3_14_stage_6&#45;&gt;ring_attn_3_14_stage_7 -->
<g id="edge1440" class="edge">
<title>ring_attn_3_14_stage_6&#45;&gt;ring_attn_3_14_stage_7</title>
<path fill="none" stroke="black" d="M10692,-3317.87C10692,-3317.87 10692,-3211.25 10692,-3211.25"/>
<polygon fill="black" stroke="black" points="10695.5,-3211.25 10692,-3201.25 10688.5,-3211.25 10695.5,-3211.25"/>
</g>
<!-- ring_attn_3_15_stage_6 -->
<g id="node1552" class="node">
<title>ring_attn_3_15_stage_6</title>
<polygon fill="yellow" stroke="black" points="11279,-3454 11070,-3386 11279,-3318 11488,-3386 11279,-3454"/>
<text text-anchor="middle" x="11279" y="-3404.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-3389.8" font-family="Times,serif" font-size="14.00">Stage 6</text>
<text text-anchor="middle" x="11279" y="-3374.8" font-family="Times,serif" font-size="14.00">Q[15]×K[9]×V[9]</text>
<text text-anchor="middle" x="11279" y="-3359.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_14_stage_6&#45;&gt;ring_attn_3_15_stage_6 -->
<g id="edge3388" class="edge">
<title>ring_attn_3_14_stage_6&#45;&gt;ring_attn_3_15_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-3386C10901.02,-3386 11059.86,-3386 11059.86,-3386"/>
<polygon fill="red" stroke="red" points="11059.86,-3389.5 11069.86,-3386 11059.86,-3382.5 11059.86,-3389.5"/>
</g>
<!-- ring_attn_3_14_stage_7&#45;&gt;ring_attn_3_14_stage_8 -->
<g id="edge1441" class="edge">
<title>ring_attn_3_14_stage_7&#45;&gt;ring_attn_3_14_stage_8</title>
<path fill="none" stroke="black" d="M10692,-3064.87C10692,-3064.87 10692,-2958.25 10692,-2958.25"/>
<polygon fill="black" stroke="black" points="10695.5,-2958.25 10692,-2948.25 10688.5,-2958.25 10695.5,-2958.25"/>
</g>
<!-- ring_attn_3_15_stage_7 -->
<g id="node1553" class="node">
<title>ring_attn_3_15_stage_7</title>
<polygon fill="yellow" stroke="black" points="11279,-3201 11070,-3133 11279,-3065 11488,-3133 11279,-3201"/>
<text text-anchor="middle" x="11279" y="-3151.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-3136.8" font-family="Times,serif" font-size="14.00">Stage 7</text>
<text text-anchor="middle" x="11279" y="-3121.8" font-family="Times,serif" font-size="14.00">Q[15]×K[8]×V[8]</text>
<text text-anchor="middle" x="11279" y="-3106.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_14_stage_7&#45;&gt;ring_attn_3_15_stage_7 -->
<g id="edge3389" class="edge">
<title>ring_attn_3_14_stage_7&#45;&gt;ring_attn_3_15_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-3133C10901.02,-3133 11059.86,-3133 11059.86,-3133"/>
<polygon fill="red" stroke="red" points="11059.86,-3136.5 11069.86,-3133 11059.86,-3129.5 11059.86,-3136.5"/>
</g>
<!-- ring_attn_3_14_stage_8&#45;&gt;ring_attn_3_14_stage_9 -->
<g id="edge1442" class="edge">
<title>ring_attn_3_14_stage_8&#45;&gt;ring_attn_3_14_stage_9</title>
<path fill="none" stroke="black" d="M10692,-2811.87C10692,-2811.87 10692,-2705.25 10692,-2705.25"/>
<polygon fill="black" stroke="black" points="10695.5,-2705.25 10692,-2695.25 10688.5,-2705.25 10695.5,-2705.25"/>
</g>
<!-- ring_attn_3_15_stage_8 -->
<g id="node1554" class="node">
<title>ring_attn_3_15_stage_8</title>
<polygon fill="yellow" stroke="black" points="11279,-2948 11070,-2880 11279,-2812 11488,-2880 11279,-2948"/>
<text text-anchor="middle" x="11279" y="-2898.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-2883.8" font-family="Times,serif" font-size="14.00">Stage 8</text>
<text text-anchor="middle" x="11279" y="-2868.8" font-family="Times,serif" font-size="14.00">Q[15]×K[7]×V[7]</text>
<text text-anchor="middle" x="11279" y="-2853.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_14_stage_8&#45;&gt;ring_attn_3_15_stage_8 -->
<g id="edge3390" class="edge">
<title>ring_attn_3_14_stage_8&#45;&gt;ring_attn_3_15_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-2880C10901.02,-2880 11059.86,-2880 11059.86,-2880"/>
<polygon fill="red" stroke="red" points="11059.86,-2883.5 11069.86,-2880 11059.86,-2876.5 11059.86,-2883.5"/>
</g>
<!-- ring_attn_3_14_stage_9&#45;&gt;ring_attn_3_14_stage_10 -->
<g id="edge1443" class="edge">
<title>ring_attn_3_14_stage_9&#45;&gt;ring_attn_3_14_stage_10</title>
<path fill="none" stroke="black" d="M10692,-2558.87C10692,-2558.87 10692,-2452.25 10692,-2452.25"/>
<polygon fill="black" stroke="black" points="10695.5,-2452.25 10692,-2442.25 10688.5,-2452.25 10695.5,-2452.25"/>
</g>
<!-- ring_attn_3_15_stage_9 -->
<g id="node1555" class="node">
<title>ring_attn_3_15_stage_9</title>
<polygon fill="yellow" stroke="black" points="11279,-2695 11070,-2627 11279,-2559 11488,-2627 11279,-2695"/>
<text text-anchor="middle" x="11279" y="-2645.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-2630.8" font-family="Times,serif" font-size="14.00">Stage 9</text>
<text text-anchor="middle" x="11279" y="-2615.8" font-family="Times,serif" font-size="14.00">Q[15]×K[6]×V[6]</text>
<text text-anchor="middle" x="11279" y="-2600.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_14_stage_9&#45;&gt;ring_attn_3_15_stage_9 -->
<g id="edge3391" class="edge">
<title>ring_attn_3_14_stage_9&#45;&gt;ring_attn_3_15_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-2627C10901.02,-2627 11059.86,-2627 11059.86,-2627"/>
<polygon fill="red" stroke="red" points="11059.86,-2630.5 11069.86,-2627 11059.86,-2623.5 11059.86,-2630.5"/>
</g>
<!-- ring_attn_3_14_stage_10&#45;&gt;ring_attn_3_14_stage_11 -->
<g id="edge1444" class="edge">
<title>ring_attn_3_14_stage_10&#45;&gt;ring_attn_3_14_stage_11</title>
<path fill="none" stroke="black" d="M10692,-2305.87C10692,-2305.87 10692,-2199.25 10692,-2199.25"/>
<polygon fill="black" stroke="black" points="10695.5,-2199.25 10692,-2189.25 10688.5,-2199.25 10695.5,-2199.25"/>
</g>
<!-- ring_attn_3_15_stage_10 -->
<g id="node1556" class="node">
<title>ring_attn_3_15_stage_10</title>
<polygon fill="yellow" stroke="black" points="11279,-2442 11070,-2374 11279,-2306 11488,-2374 11279,-2442"/>
<text text-anchor="middle" x="11279" y="-2392.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-2377.8" font-family="Times,serif" font-size="14.00">Stage 10</text>
<text text-anchor="middle" x="11279" y="-2362.8" font-family="Times,serif" font-size="14.00">Q[15]×K[5]×V[5]</text>
<text text-anchor="middle" x="11279" y="-2347.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_14_stage_10&#45;&gt;ring_attn_3_15_stage_10 -->
<g id="edge3392" class="edge">
<title>ring_attn_3_14_stage_10&#45;&gt;ring_attn_3_15_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-2374C10901.02,-2374 11059.86,-2374 11059.86,-2374"/>
<polygon fill="red" stroke="red" points="11059.86,-2377.5 11069.86,-2374 11059.86,-2370.5 11059.86,-2377.5"/>
</g>
<!-- ring_attn_3_14_stage_11&#45;&gt;ring_attn_3_14_stage_12 -->
<g id="edge1445" class="edge">
<title>ring_attn_3_14_stage_11&#45;&gt;ring_attn_3_14_stage_12</title>
<path fill="none" stroke="black" d="M10692,-2052.87C10692,-2052.87 10692,-1946.25 10692,-1946.25"/>
<polygon fill="black" stroke="black" points="10695.5,-1946.25 10692,-1936.25 10688.5,-1946.25 10695.5,-1946.25"/>
</g>
<!-- ring_attn_3_15_stage_11 -->
<g id="node1557" class="node">
<title>ring_attn_3_15_stage_11</title>
<polygon fill="yellow" stroke="black" points="11279,-2189 11070,-2121 11279,-2053 11488,-2121 11279,-2189"/>
<text text-anchor="middle" x="11279" y="-2139.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-2124.8" font-family="Times,serif" font-size="14.00">Stage 11</text>
<text text-anchor="middle" x="11279" y="-2109.8" font-family="Times,serif" font-size="14.00">Q[15]×K[4]×V[4]</text>
<text text-anchor="middle" x="11279" y="-2094.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_14_stage_11&#45;&gt;ring_attn_3_15_stage_11 -->
<g id="edge3393" class="edge">
<title>ring_attn_3_14_stage_11&#45;&gt;ring_attn_3_15_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-2121C10901.02,-2121 11059.86,-2121 11059.86,-2121"/>
<polygon fill="red" stroke="red" points="11059.86,-2124.5 11069.86,-2121 11059.86,-2117.5 11059.86,-2124.5"/>
</g>
<!-- ring_attn_3_14_stage_12&#45;&gt;ring_attn_3_14_stage_13 -->
<g id="edge1446" class="edge">
<title>ring_attn_3_14_stage_12&#45;&gt;ring_attn_3_14_stage_13</title>
<path fill="none" stroke="black" d="M10692,-1799.87C10692,-1799.87 10692,-1693.25 10692,-1693.25"/>
<polygon fill="black" stroke="black" points="10695.5,-1693.25 10692,-1683.25 10688.5,-1693.25 10695.5,-1693.25"/>
</g>
<!-- ring_attn_3_15_stage_12 -->
<g id="node1558" class="node">
<title>ring_attn_3_15_stage_12</title>
<polygon fill="yellow" stroke="black" points="11279,-1936 11070,-1868 11279,-1800 11488,-1868 11279,-1936"/>
<text text-anchor="middle" x="11279" y="-1886.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-1871.8" font-family="Times,serif" font-size="14.00">Stage 12</text>
<text text-anchor="middle" x="11279" y="-1856.8" font-family="Times,serif" font-size="14.00">Q[15]×K[3]×V[3]</text>
<text text-anchor="middle" x="11279" y="-1841.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_14_stage_12&#45;&gt;ring_attn_3_15_stage_12 -->
<g id="edge3394" class="edge">
<title>ring_attn_3_14_stage_12&#45;&gt;ring_attn_3_15_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-1868C10901.02,-1868 11059.86,-1868 11059.86,-1868"/>
<polygon fill="red" stroke="red" points="11059.86,-1871.5 11069.86,-1868 11059.86,-1864.5 11059.86,-1871.5"/>
</g>
<!-- ring_attn_3_14_stage_13&#45;&gt;ring_attn_3_14_stage_14 -->
<g id="edge1447" class="edge">
<title>ring_attn_3_14_stage_13&#45;&gt;ring_attn_3_14_stage_14</title>
<path fill="none" stroke="black" d="M10692,-1546.87C10692,-1546.87 10692,-1440.25 10692,-1440.25"/>
<polygon fill="black" stroke="black" points="10695.5,-1440.25 10692,-1430.25 10688.5,-1440.25 10695.5,-1440.25"/>
</g>
<!-- ring_attn_3_15_stage_13 -->
<g id="node1559" class="node">
<title>ring_attn_3_15_stage_13</title>
<polygon fill="yellow" stroke="black" points="11279,-1683 11070,-1615 11279,-1547 11488,-1615 11279,-1683"/>
<text text-anchor="middle" x="11279" y="-1633.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-1618.8" font-family="Times,serif" font-size="14.00">Stage 13</text>
<text text-anchor="middle" x="11279" y="-1603.8" font-family="Times,serif" font-size="14.00">Q[15]×K[2]×V[2]</text>
<text text-anchor="middle" x="11279" y="-1588.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_14_stage_13&#45;&gt;ring_attn_3_15_stage_13 -->
<g id="edge3395" class="edge">
<title>ring_attn_3_14_stage_13&#45;&gt;ring_attn_3_15_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-1615C10901.02,-1615 11059.86,-1615 11059.86,-1615"/>
<polygon fill="red" stroke="red" points="11059.86,-1618.5 11069.86,-1615 11059.86,-1611.5 11059.86,-1618.5"/>
</g>
<!-- ring_attn_3_14_stage_14&#45;&gt;ring_attn_3_14_stage_15 -->
<g id="edge1448" class="edge">
<title>ring_attn_3_14_stage_14&#45;&gt;ring_attn_3_14_stage_15</title>
<path fill="none" stroke="black" d="M10692,-1293.87C10692,-1293.87 10692,-1187.25 10692,-1187.25"/>
<polygon fill="black" stroke="black" points="10695.5,-1187.25 10692,-1177.25 10688.5,-1187.25 10695.5,-1187.25"/>
</g>
<!-- ring_attn_3_15_stage_14 -->
<g id="node1560" class="node">
<title>ring_attn_3_15_stage_14</title>
<polygon fill="yellow" stroke="black" points="11279,-1430 11070,-1362 11279,-1294 11488,-1362 11279,-1430"/>
<text text-anchor="middle" x="11279" y="-1380.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-1365.8" font-family="Times,serif" font-size="14.00">Stage 14</text>
<text text-anchor="middle" x="11279" y="-1350.8" font-family="Times,serif" font-size="14.00">Q[15]×K[1]×V[1]</text>
<text text-anchor="middle" x="11279" y="-1335.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_14_stage_14&#45;&gt;ring_attn_3_15_stage_14 -->
<g id="edge3396" class="edge">
<title>ring_attn_3_14_stage_14&#45;&gt;ring_attn_3_15_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-1362C10901.02,-1362 11059.86,-1362 11059.86,-1362"/>
<polygon fill="red" stroke="red" points="11059.86,-1365.5 11069.86,-1362 11059.86,-1358.5 11059.86,-1365.5"/>
</g>
<!-- attn_out_3_14 -->
<g id="node1464" class="node">
<title>attn_out_3_14</title>
<polygon fill="none" stroke="black" points="10761.5,-968 10622.5,-968 10622.5,-915 10761.5,-915 10761.5,-968"/>
<text text-anchor="middle" x="10692" y="-952.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="10692" y="-937.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="10692" y="-922.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_3_14_stage_15&#45;&gt;attn_out_3_14 -->
<g id="edge1449" class="edge">
<title>ring_attn_3_14_stage_15&#45;&gt;attn_out_3_14</title>
<path fill="none" stroke="black" d="M10692,-1040.87C10692,-1040.87 10692,-978.18 10692,-978.18"/>
<polygon fill="black" stroke="black" points="10695.5,-978.18 10692,-968.18 10688.5,-978.18 10695.5,-978.18"/>
</g>
<!-- ring_attn_3_15_stage_15 -->
<g id="node1561" class="node">
<title>ring_attn_3_15_stage_15</title>
<polygon fill="yellow" stroke="black" points="11279,-1177 11070,-1109 11279,-1041 11488,-1109 11279,-1177"/>
<text text-anchor="middle" x="11279" y="-1127.8" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="11279" y="-1112.8" font-family="Times,serif" font-size="14.00">Stage 15</text>
<text text-anchor="middle" x="11279" y="-1097.8" font-family="Times,serif" font-size="14.00">Q[15]×K[0]×V[0]</text>
<text text-anchor="middle" x="11279" y="-1082.8" font-family="Times,serif" font-size="14.00">1024×1024×1024×2×128</text>
</g>
<!-- ring_attn_3_14_stage_15&#45;&gt;ring_attn_3_15_stage_15 -->
<g id="edge3397" class="edge">
<title>ring_attn_3_14_stage_15&#45;&gt;ring_attn_3_15_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10901.02,-1109C10901.02,-1109 11059.86,-1109 11059.86,-1109"/>
<polygon fill="red" stroke="red" points="11059.86,-1112.5 11069.86,-1109 11059.86,-1105.5 11059.86,-1112.5"/>
</g>
<!-- attn_residual_3_14 -->
<g id="node1465" class="node">
<title>attn_residual_3_14</title>
<ellipse fill="none" stroke="black" cx="10692" cy="-815" rx="105.5" ry="27"/>
<text text-anchor="middle" x="10692" y="-818.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="10692" y="-803.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_3_14&#45;&gt;attn_residual_3_14 -->
<g id="edge1450" class="edge">
<title>attn_out_3_14&#45;&gt;attn_residual_3_14</title>
<path fill="none" stroke="black" d="M10692,-914.98C10692,-914.98 10692,-852.36 10692,-852.36"/>
<polygon fill="black" stroke="black" points="10695.5,-852.36 10692,-842.36 10688.5,-852.36 10695.5,-852.36"/>
</g>
<!-- gate_3_14 -->
<g id="node1466" class="node">
<title>gate_3_14</title>
<ellipse fill="orange" stroke="black" cx="10692" cy="-677.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="10692" y="-688.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="10692" y="-673.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="10692" y="-658.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_3_14&#45;&gt;gate_3_14 -->
<g id="edge1451" class="edge">
<title>attn_residual_3_14&#45;&gt;gate_3_14</title>
<path fill="none" stroke="black" d="M10755.3,-793.21C10755.3,-793.21 10755.3,-717.62 10755.3,-717.62"/>
<polygon fill="black" stroke="black" points="10758.8,-717.62 10755.3,-707.62 10751.8,-717.62 10758.8,-717.62"/>
</g>
<!-- gate_3_14&#45;&gt;expert_3_0_0 -->
<g id="edge3398" class="edge">
<title>gate_3_14&#45;&gt;expert_3_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10596.55,-661.47C10596.55,-622.31 10596.55,-525 10596.55,-525 10596.55,-525 189.83,-525 189.83,-525 189.83,-525 189.83,-518.31 189.83,-518.31"/>
<polygon fill="blue" stroke="blue" points="193.33,-518.31 189.83,-508.31 186.33,-518.31 193.33,-518.31"/>
<text text-anchor="middle" x="45536.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45536.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU14→GPU0</text>
<text text-anchor="middle" x="45536.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45536.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_14&#45;&gt;expert_3_1_0 -->
<g id="edge3399" class="edge">
<title>gate_3_14&#45;&gt;expert_3_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10616.64,-651.16C10616.64,-605.86 10616.64,-518 10616.64,-518 10616.64,-518 3032.23,-518 3032.23,-518 3032.23,-518 3032.23,-517 3032.23,-517"/>
<polygon fill="blue" stroke="blue" points="3035.73,-518.03 3032.23,-508.03 3028.73,-518.03 3035.73,-518.03"/>
<text text-anchor="middle" x="45710.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45710.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU14→GPU1</text>
<text text-anchor="middle" x="45710.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45710.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_14&#45;&gt;expert_3_2_0 -->
<g id="edge3400" class="edge">
<title>gate_3_14&#45;&gt;expert_3_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10636.74,-645.32C10636.74,-600.31 10636.74,-524 10636.74,-524 10636.74,-524 3644.09,-524 3644.09,-524 3644.09,-524 3644.09,-518.17 3644.09,-518.17"/>
<polygon fill="blue" stroke="blue" points="3647.59,-518.17 3644.09,-508.17 3640.59,-518.17 3647.59,-518.17"/>
<text text-anchor="middle" x="45884.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="45884.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU14→GPU2</text>
<text text-anchor="middle" x="45884.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="45884.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_14&#45;&gt;expert_3_3_0 -->
<g id="edge3401" class="edge">
<title>gate_3_14&#45;&gt;expert_3_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10656.83,-642.07C10656.83,-597.86 10656.83,-528 10656.83,-528 10656.83,-528 4239.22,-528 4239.22,-528 4239.22,-528 4239.22,-518.01 4239.22,-518.01"/>
<polygon fill="blue" stroke="blue" points="4242.72,-518.01 4239.22,-508.01 4235.72,-518.01 4242.72,-518.01"/>
<text text-anchor="middle" x="46058.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46058.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU14→GPU3</text>
<text text-anchor="middle" x="46058.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46058.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_14&#45;&gt;expert_3_4_0 -->
<g id="edge3402" class="edge">
<title>gate_3_14&#45;&gt;expert_3_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10713.1,-714.6C10713.1,-732.44 10713.1,-750 10713.1,-750 10713.1,-750 4713.8,-750 4713.8,-750 4713.8,-750 4713.8,-518.23 4713.8,-518.23"/>
<polygon fill="blue" stroke="blue" points="4717.3,-518.23 4713.8,-508.23 4710.3,-518.23 4717.3,-518.23"/>
<text text-anchor="middle" x="46232.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46232.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU14→GPU4</text>
<text text-anchor="middle" x="46232.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46232.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_14&#45;&gt;expert_3_5_0 -->
<g id="edge3403" class="edge">
<title>gate_3_14&#45;&gt;expert_3_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10670.9,-714.55C10670.9,-726.16 10670.9,-736 10670.9,-736 10670.9,-736 5517.88,-736 5517.88,-736 5517.88,-736 5517.88,-518.25 5517.88,-518.25"/>
<polygon fill="blue" stroke="blue" points="5521.38,-518.25 5517.88,-508.25 5514.38,-518.25 5521.38,-518.25"/>
<text text-anchor="middle" x="46406.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46406.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU14→GPU5</text>
<text text-anchor="middle" x="46406.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46406.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_14&#45;&gt;expert_3_6_0 -->
<g id="edge3404" class="edge">
<title>gate_3_14&#45;&gt;expert_3_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10628.7,-707.92C10628.7,-715.74 10628.7,-722 10628.7,-722 10628.7,-722 6104.88,-722 6104.88,-722 6104.88,-722 6104.88,-518.16 6104.88,-518.16"/>
<polygon fill="blue" stroke="blue" points="6108.38,-518.16 6104.88,-508.16 6101.38,-518.16 6108.38,-518.16"/>
<text text-anchor="middle" x="46580.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46580.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU14→GPU6</text>
<text text-anchor="middle" x="46580.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46580.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_14&#45;&gt;expert_3_7_0 -->
<g id="edge3405" class="edge">
<title>gate_3_14&#45;&gt;expert_3_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10686.98,-639.82C10686.98,-600.96 10686.98,-546 10686.98,-546 10686.98,-546 6618.17,-546 6618.17,-546 6618.17,-546 6618.17,-518.11 6618.17,-518.11"/>
<polygon fill="blue" stroke="blue" points="6621.67,-518.11 6618.17,-508.11 6614.67,-518.11 6621.67,-518.11"/>
<text text-anchor="middle" x="46754.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46754.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU14→GPU7</text>
<text text-anchor="middle" x="46754.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46754.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_14&#45;&gt;expert_3_8_0 -->
<g id="edge3406" class="edge">
<title>gate_3_14&#45;&gt;expert_3_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10707.07,-640.32C10707.07,-606.55 10707.07,-562 10707.07,-562 10707.07,-562 7202.11,-562 7202.11,-562 7202.11,-562 7202.11,-518.31 7202.11,-518.31"/>
<polygon fill="blue" stroke="blue" points="7205.61,-518.31 7202.11,-508.31 7198.61,-518.31 7205.61,-518.31"/>
<text text-anchor="middle" x="46928.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="46928.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU14→GPU8</text>
<text text-anchor="middle" x="46928.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="46928.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_14&#45;&gt;expert_3_9_0 -->
<g id="edge3407" class="edge">
<title>gate_3_14&#45;&gt;expert_3_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10727.17,-642C10727.17,-610.69 10727.17,-570 10727.17,-570 10727.17,-570 7795.36,-570 7795.36,-570 7795.36,-570 7795.36,-518.05 7795.36,-518.05"/>
<polygon fill="blue" stroke="blue" points="7798.86,-518.05 7795.36,-508.05 7791.86,-518.05 7798.86,-518.05"/>
<text text-anchor="middle" x="47102.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47102.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU14→GPU9</text>
<text text-anchor="middle" x="47102.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47102.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_14&#45;&gt;expert_3_10_0 -->
<g id="edge3408" class="edge">
<title>gate_3_14&#45;&gt;expert_3_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10747.26,-645.52C10747.26,-616.76 10747.26,-579 10747.26,-579 10747.26,-579 8389.21,-579 8389.21,-579 8389.21,-579 8389.21,-518.14 8389.21,-518.14"/>
<polygon fill="blue" stroke="blue" points="8392.71,-518.14 8389.21,-508.14 8385.71,-518.14 8392.71,-518.14"/>
<text text-anchor="middle" x="47276.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47276.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU14→GPU10</text>
<text text-anchor="middle" x="47276.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47276.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_14&#45;&gt;expert_3_11_0 -->
<g id="edge3409" class="edge">
<title>gate_3_14&#45;&gt;expert_3_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10767.36,-651.18C10767.36,-623.21 10767.36,-583 10767.36,-583 10767.36,-583 8986.26,-583 8986.26,-583 8986.26,-583 8986.26,-518.17 8986.26,-518.17"/>
<polygon fill="blue" stroke="blue" points="8989.76,-518.17 8986.26,-508.17 8982.76,-518.17 8989.76,-518.17"/>
<text text-anchor="middle" x="47450.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47450.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU14→GPU11</text>
<text text-anchor="middle" x="47450.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47450.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_14&#45;&gt;expert_3_12_0 -->
<g id="edge3410" class="edge">
<title>gate_3_14&#45;&gt;expert_3_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10777.4,-655.47C10777.4,-609.8 10777.4,-509 10777.4,-509 10777.4,-509 9632.5,-509 9632.5,-509 9632.5,-509 9632.5,-508.93 9632.5,-508.93"/>
<polygon fill="blue" stroke="blue" points="9636,-518.32 9632.5,-508.32 9629,-518.32 9636,-518.32"/>
<text text-anchor="middle" x="47624.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47624.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU14→GPU12</text>
<text text-anchor="middle" x="47624.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47624.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_14&#45;&gt;expert_3_13_0 -->
<g id="edge3411" class="edge">
<title>gate_3_14&#45;&gt;expert_3_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10592.3,-690C10452.46,-690 10215,-690 10215,-690 10215,-690 10215,-518.33 10215,-518.33"/>
<polygon fill="blue" stroke="blue" points="10218.5,-518.33 10215,-508.33 10211.5,-518.33 10218.5,-518.33"/>
<text text-anchor="middle" x="47798.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47798.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU14→GPU13</text>
<text text-anchor="middle" x="47798.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47798.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_14&#45;&gt;expert_3_14_0 -->
<g id="edge1452" class="edge">
<title>gate_3_14&#45;&gt;expert_3_14_0</title>
<path fill="none" stroke="black" d="M10787.45,-661.46C10787.45,-661.46 10787.45,-518.21 10787.45,-518.21"/>
<polygon fill="black" stroke="black" points="10790.95,-518.21 10787.45,-508.21 10783.95,-518.21 10790.95,-518.21"/>
</g>
<!-- gate_3_14&#45;&gt;expert_3_15_0 -->
<g id="edge3412" class="edge">
<title>gate_3_14&#45;&gt;expert_3_15_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10791.52,-665C10930.74,-665 11166.75,-665 11166.75,-665 11166.75,-665 11166.75,-518.18 11166.75,-518.18"/>
<polygon fill="blue" stroke="blue" points="11170.25,-518.18 11166.75,-508.18 11163.25,-518.18 11170.25,-518.18"/>
<text text-anchor="middle" x="47972.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="47972.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU14→GPU15</text>
<text text-anchor="middle" x="47972.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="47972.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_14 -->
<g id="node1468" class="node">
<title>expert_reduce_3_14</title>
<ellipse fill="none" stroke="black" cx="10692" cy="-344.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="10692" y="-355.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="10692" y="-340.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="10692" y="-325.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_14_0&#45;&gt;expert_reduce_3_14 -->
<g id="edge1453" class="edge">
<title>expert_3_14_0&#45;&gt;expert_reduce_3_14</title>
<path fill="none" stroke="black" d="M10692,-454.76C10692,-454.76 10692,-392.06 10692,-392.06"/>
<polygon fill="black" stroke="black" points="10695.5,-392.06 10692,-382.06 10688.5,-392.06 10695.5,-392.06"/>
</g>
<!-- moe_residual_3_14 -->
<g id="node1469" class="node">
<title>moe_residual_3_14</title>
<ellipse fill="none" stroke="black" cx="10692" cy="-207" rx="105.5" ry="27"/>
<text text-anchor="middle" x="10692" y="-210.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="10692" y="-195.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_14&#45;&gt;moe_residual_3_14 -->
<g id="edge1454" class="edge">
<title>expert_reduce_3_14&#45;&gt;moe_residual_3_14</title>
<path fill="none" stroke="black" d="M10692,-306.93C10692,-306.93 10692,-244.06 10692,-244.06"/>
<polygon fill="black" stroke="black" points="10695.5,-244.06 10692,-234.06 10688.5,-244.06 10695.5,-244.06"/>
</g>
<!-- output_14 -->
<g id="node1470" class="node">
<title>output_14</title>
<polygon fill="lightcoral" stroke="black" points="10789.5,-107 10594.5,-107 10594.5,-69 10789.5,-69 10789.5,-107"/>
<text text-anchor="middle" x="10692" y="-91.8" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="10692" y="-76.8" font-family="Times,serif" font-size="14.00">Y[14]: 1024×1024×4096</text>
</g>
<!-- moe_residual_3_14&#45;&gt;output_14 -->
<g id="edge1455" class="edge">
<title>moe_residual_3_14&#45;&gt;output_14</title>
<path fill="none" stroke="black" d="M10692,-180C10692,-180 10692,-117.12 10692,-117.12"/>
<polygon fill="black" stroke="black" points="10695.5,-117.12 10692,-107.12 10688.5,-117.12 10695.5,-117.12"/>
</g>
<!-- input_15 -->
<g id="node1471" class="node">
<title>input_15</title>
<polygon fill="lightgreen" stroke="black" points="11377,-20866 11181,-20866 11181,-20828 11377,-20828 11377,-20866"/>
<text text-anchor="middle" x="11279" y="-20850.8" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="11279" y="-20835.8" font-family="Times,serif" font-size="14.00">X[15]: 1024×1024×4096</text>
</g>
<!-- qkv_proj_0_15 -->
<g id="node1472" class="node">
<title>qkv_proj_0_15</title>
<polygon fill="none" stroke="black" points="11361.5,-20755 11196.5,-20755 11196.5,-20702 11361.5,-20702 11361.5,-20755"/>
<text text-anchor="middle" x="11279" y="-20739.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="11279" y="-20724.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="11279" y="-20709.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- input_15&#45;&gt;qkv_proj_0_15 -->
<g id="edge1456" class="edge">
<title>input_15&#45;&gt;qkv_proj_0_15</title>
<path fill="none" stroke="black" d="M11279,-20827.96C11279,-20827.96 11279,-20765.44 11279,-20765.44"/>
<polygon fill="black" stroke="black" points="11282.5,-20765.44 11279,-20755.44 11275.5,-20765.44 11282.5,-20765.44"/>
</g>
<!-- qkv_reshape_0_15 -->
<g id="node1473" class="node">
<title>qkv_reshape_0_15</title>
<ellipse fill="none" stroke="black" cx="11279" cy="-20602" rx="148" ry="27"/>
<text text-anchor="middle" x="11279" y="-20605.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="11279" y="-20590.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_0_15&#45;&gt;qkv_reshape_0_15 -->
<g id="edge1457" class="edge">
<title>qkv_proj_0_15&#45;&gt;qkv_reshape_0_15</title>
<path fill="none" stroke="black" d="M11279,-20701.98C11279,-20701.98 11279,-20639.36 11279,-20639.36"/>
<polygon fill="black" stroke="black" points="11282.5,-20639.36 11279,-20629.36 11275.5,-20639.36 11282.5,-20639.36"/>
</g>
<!-- qkv_reshape_0_15&#45;&gt;ring_attn_0_15_stage_0 -->
<g id="edge1458" class="edge">
<title>qkv_reshape_0_15&#45;&gt;ring_attn_0_15_stage_0</title>
<path fill="none" stroke="black" d="M11279,-20574.72C11279,-20574.72 11279,-20468.16 11279,-20468.16"/>
<polygon fill="black" stroke="black" points="11282.5,-20468.16 11279,-20458.16 11275.5,-20468.16 11282.5,-20468.16"/>
</g>
<!-- ring_attn_0_15_stage_0&#45;&gt;ring_attn_0_0_stage_0 -->
<g id="edge3413" class="edge">
<title>ring_attn_0_15_stage_0&#45;&gt;ring_attn_0_0_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11100.5,-20400.31C11100.5,-20430.4 11100.5,-20516 11100.5,-20516 11100.5,-20516 403.5,-20516 403.5,-20516 403.5,-20516 403.5,-20410.31 403.5,-20410.31"/>
<polygon fill="red" stroke="red" points="407,-20410.31 403.5,-20400.31 400,-20410.31 407,-20410.31"/>
<text text-anchor="middle" x="6877" y="-20527.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-20512.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-20497.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_0_15_stage_0&#45;&gt;ring_attn_0_15_stage_1 -->
<g id="edge1459" class="edge">
<title>ring_attn_0_15_stage_0&#45;&gt;ring_attn_0_15_stage_1</title>
<path fill="none" stroke="black" d="M11279,-20321.87C11279,-20321.87 11279,-20215.25 11279,-20215.25"/>
<polygon fill="black" stroke="black" points="11282.5,-20215.25 11279,-20205.25 11275.5,-20215.25 11282.5,-20215.25"/>
</g>
<!-- ring_attn_0_15_stage_1&#45;&gt;ring_attn_0_0_stage_1 -->
<g id="edge3414" class="edge">
<title>ring_attn_0_15_stage_1&#45;&gt;ring_attn_0_0_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-20091.51C11209.33,-20055.07 11209.33,-20010 11209.33,-20010 11209.33,-20010 294.67,-20010 294.67,-20010 294.67,-20010 294.67,-20081.51 294.67,-20081.51"/>
<polygon fill="red" stroke="red" points="291.17,-20081.51 294.67,-20091.51 298.17,-20081.51 291.17,-20081.51"/>
<text text-anchor="middle" x="6877" y="-20274.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-20259.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-20244.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_0_15_stage_1&#45;&gt;ring_attn_0_15_stage_2 -->
<g id="edge1460" class="edge">
<title>ring_attn_0_15_stage_1&#45;&gt;ring_attn_0_15_stage_2</title>
<path fill="none" stroke="black" d="M11348.67,-20091.48C11348.67,-20091.48 11348.67,-19939.58 11348.67,-19939.58"/>
<polygon fill="black" stroke="black" points="11352.17,-19939.58 11348.67,-19929.58 11345.17,-19939.58 11352.17,-19939.58"/>
</g>
<!-- ring_attn_0_15_stage_2&#45;&gt;ring_attn_0_0_stage_2 -->
<g id="edge3415" class="edge">
<title>ring_attn_0_15_stage_2&#45;&gt;ring_attn_0_0_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-19838.51C11209.33,-19802.07 11209.33,-19757 11209.33,-19757 11209.33,-19757 294.67,-19757 294.67,-19757 294.67,-19757 294.67,-19828.51 294.67,-19828.51"/>
<polygon fill="red" stroke="red" points="291.17,-19828.51 294.67,-19838.51 298.17,-19828.51 291.17,-19828.51"/>
<text text-anchor="middle" x="6877" y="-20021.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-20006.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-19991.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_0_15_stage_2&#45;&gt;ring_attn_0_15_stage_3 -->
<g id="edge1461" class="edge">
<title>ring_attn_0_15_stage_2&#45;&gt;ring_attn_0_15_stage_3</title>
<path fill="none" stroke="black" d="M11348.67,-19838.48C11348.67,-19838.48 11348.67,-19686.58 11348.67,-19686.58"/>
<polygon fill="black" stroke="black" points="11352.17,-19686.58 11348.67,-19676.58 11345.17,-19686.58 11352.17,-19686.58"/>
</g>
<!-- ring_attn_0_15_stage_3&#45;&gt;ring_attn_0_0_stage_3 -->
<g id="edge3416" class="edge">
<title>ring_attn_0_15_stage_3&#45;&gt;ring_attn_0_0_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-19585.51C11209.33,-19549.07 11209.33,-19504 11209.33,-19504 11209.33,-19504 294.67,-19504 294.67,-19504 294.67,-19504 294.67,-19575.51 294.67,-19575.51"/>
<polygon fill="red" stroke="red" points="291.17,-19575.51 294.67,-19585.51 298.17,-19575.51 291.17,-19575.51"/>
<text text-anchor="middle" x="6877" y="-19768.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-19753.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-19738.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_0_15_stage_3&#45;&gt;ring_attn_0_15_stage_4 -->
<g id="edge1462" class="edge">
<title>ring_attn_0_15_stage_3&#45;&gt;ring_attn_0_15_stage_4</title>
<path fill="none" stroke="black" d="M11348.67,-19585.48C11348.67,-19585.48 11348.67,-19433.58 11348.67,-19433.58"/>
<polygon fill="black" stroke="black" points="11352.17,-19433.58 11348.67,-19423.58 11345.17,-19433.58 11352.17,-19433.58"/>
</g>
<!-- ring_attn_0_15_stage_4&#45;&gt;ring_attn_0_0_stage_4 -->
<g id="edge3417" class="edge">
<title>ring_attn_0_15_stage_4&#45;&gt;ring_attn_0_0_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-19332.51C11209.33,-19296.07 11209.33,-19251 11209.33,-19251 11209.33,-19251 294.67,-19251 294.67,-19251 294.67,-19251 294.67,-19322.51 294.67,-19322.51"/>
<polygon fill="red" stroke="red" points="291.17,-19322.51 294.67,-19332.51 298.17,-19322.51 291.17,-19322.51"/>
<text text-anchor="middle" x="6877" y="-19515.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-19500.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-19485.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_0_15_stage_4&#45;&gt;ring_attn_0_15_stage_5 -->
<g id="edge1463" class="edge">
<title>ring_attn_0_15_stage_4&#45;&gt;ring_attn_0_15_stage_5</title>
<path fill="none" stroke="black" d="M11348.67,-19332.48C11348.67,-19332.48 11348.67,-19180.58 11348.67,-19180.58"/>
<polygon fill="black" stroke="black" points="11352.17,-19180.58 11348.67,-19170.58 11345.17,-19180.58 11352.17,-19180.58"/>
</g>
<!-- ring_attn_0_15_stage_5&#45;&gt;ring_attn_0_0_stage_5 -->
<g id="edge3418" class="edge">
<title>ring_attn_0_15_stage_5&#45;&gt;ring_attn_0_0_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11174.5,-19090.85C11174.5,-19059.54 11174.5,-19018 11174.5,-19018 11174.5,-19018 329.5,-19018 329.5,-19018 329.5,-19018 329.5,-19080.85 329.5,-19080.85"/>
<polygon fill="red" stroke="red" points="326,-19080.85 329.5,-19090.85 333,-19080.85 326,-19080.85"/>
<text text-anchor="middle" x="6877" y="-19262.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-19247.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-19232.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_0_15_stage_5&#45;&gt;ring_attn_0_15_stage_6 -->
<g id="edge1464" class="edge">
<title>ring_attn_0_15_stage_5&#45;&gt;ring_attn_0_15_stage_6</title>
<path fill="none" stroke="black" d="M11383.5,-19090.88C11383.5,-19090.88 11383.5,-18916.39 11383.5,-18916.39"/>
<polygon fill="black" stroke="black" points="11387,-18916.39 11383.5,-18906.39 11380,-18916.39 11387,-18916.39"/>
</g>
<!-- ring_attn_0_15_stage_6&#45;&gt;ring_attn_0_0_stage_6 -->
<g id="edge3419" class="edge">
<title>ring_attn_0_15_stage_6&#45;&gt;ring_attn_0_0_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11279,-18940.07C11279,-18961.17 11279,-18979 11279,-18979 11279,-18979 225,-18979 225,-18979 225,-18979 225,-18950.07 225,-18950.07"/>
<polygon fill="red" stroke="red" points="228.5,-18950.07 225,-18940.07 221.5,-18950.07 228.5,-18950.07"/>
<text text-anchor="middle" x="6877" y="-19009.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-18994.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-18979.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_0_15_stage_6&#45;&gt;ring_attn_0_15_stage_7 -->
<g id="edge1465" class="edge">
<title>ring_attn_0_15_stage_6&#45;&gt;ring_attn_0_15_stage_7</title>
<path fill="none" stroke="black" d="M11279,-18803.87C11279,-18803.87 11279,-18697.25 11279,-18697.25"/>
<polygon fill="black" stroke="black" points="11282.5,-18697.25 11279,-18687.25 11275.5,-18697.25 11282.5,-18697.25"/>
</g>
<!-- ring_attn_0_15_stage_7&#45;&gt;ring_attn_0_0_stage_7 -->
<g id="edge3420" class="edge">
<title>ring_attn_0_15_stage_7&#45;&gt;ring_attn_0_0_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11174.5,-18584.85C11174.5,-18553.54 11174.5,-18512 11174.5,-18512 11174.5,-18512 329.5,-18512 329.5,-18512 329.5,-18512 329.5,-18574.85 329.5,-18574.85"/>
<polygon fill="red" stroke="red" points="326,-18574.85 329.5,-18584.85 333,-18574.85 326,-18574.85"/>
<text text-anchor="middle" x="6877" y="-18756.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-18741.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-18726.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_0_15_stage_7&#45;&gt;ring_attn_0_15_stage_8 -->
<g id="edge1466" class="edge">
<title>ring_attn_0_15_stage_7&#45;&gt;ring_attn_0_15_stage_8</title>
<path fill="none" stroke="black" d="M11383.5,-18584.88C11383.5,-18584.88 11383.5,-18410.39 11383.5,-18410.39"/>
<polygon fill="black" stroke="black" points="11387,-18410.39 11383.5,-18400.39 11380,-18410.39 11387,-18410.39"/>
</g>
<!-- ring_attn_0_15_stage_8&#45;&gt;ring_attn_0_0_stage_8 -->
<g id="edge3421" class="edge">
<title>ring_attn_0_15_stage_8&#45;&gt;ring_attn_0_0_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11279,-18434.07C11279,-18455.17 11279,-18473 11279,-18473 11279,-18473 225,-18473 225,-18473 225,-18473 225,-18444.07 225,-18444.07"/>
<polygon fill="red" stroke="red" points="228.5,-18444.07 225,-18434.07 221.5,-18444.07 228.5,-18444.07"/>
<text text-anchor="middle" x="6877" y="-18503.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-18488.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-18473.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_0_15_stage_8&#45;&gt;ring_attn_0_15_stage_9 -->
<g id="edge1467" class="edge">
<title>ring_attn_0_15_stage_8&#45;&gt;ring_attn_0_15_stage_9</title>
<path fill="none" stroke="black" d="M11279,-18297.87C11279,-18297.87 11279,-18191.25 11279,-18191.25"/>
<polygon fill="black" stroke="black" points="11282.5,-18191.25 11279,-18181.25 11275.5,-18191.25 11282.5,-18191.25"/>
</g>
<!-- ring_attn_0_15_stage_9&#45;&gt;ring_attn_0_0_stage_9 -->
<g id="edge3422" class="edge">
<title>ring_attn_0_15_stage_9&#45;&gt;ring_attn_0_0_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-18067.51C11209.33,-18031.07 11209.33,-17986 11209.33,-17986 11209.33,-17986 294.67,-17986 294.67,-17986 294.67,-17986 294.67,-18057.51 294.67,-18057.51"/>
<polygon fill="red" stroke="red" points="291.17,-18057.51 294.67,-18067.51 298.17,-18057.51 291.17,-18057.51"/>
<text text-anchor="middle" x="6877" y="-18250.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-18235.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-18220.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_0_15_stage_9&#45;&gt;ring_attn_0_15_stage_10 -->
<g id="edge1468" class="edge">
<title>ring_attn_0_15_stage_9&#45;&gt;ring_attn_0_15_stage_10</title>
<path fill="none" stroke="black" d="M11348.67,-18067.48C11348.67,-18067.48 11348.67,-17915.58 11348.67,-17915.58"/>
<polygon fill="black" stroke="black" points="11352.17,-17915.58 11348.67,-17905.58 11345.17,-17915.58 11352.17,-17915.58"/>
</g>
<!-- ring_attn_0_15_stage_10&#45;&gt;ring_attn_0_0_stage_10 -->
<g id="edge3423" class="edge">
<title>ring_attn_0_15_stage_10&#45;&gt;ring_attn_0_0_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11174.5,-17825.85C11174.5,-17794.54 11174.5,-17753 11174.5,-17753 11174.5,-17753 329.5,-17753 329.5,-17753 329.5,-17753 329.5,-17815.85 329.5,-17815.85"/>
<polygon fill="red" stroke="red" points="326,-17815.85 329.5,-17825.85 333,-17815.85 326,-17815.85"/>
<text text-anchor="middle" x="6877" y="-17997.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-17982.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-17967.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_0_15_stage_10&#45;&gt;ring_attn_0_15_stage_11 -->
<g id="edge1469" class="edge">
<title>ring_attn_0_15_stage_10&#45;&gt;ring_attn_0_15_stage_11</title>
<path fill="none" stroke="black" d="M11383.5,-17825.88C11383.5,-17825.88 11383.5,-17651.39 11383.5,-17651.39"/>
<polygon fill="black" stroke="black" points="11387,-17651.39 11383.5,-17641.39 11380,-17651.39 11387,-17651.39"/>
</g>
<!-- ring_attn_0_15_stage_11&#45;&gt;ring_attn_0_0_stage_11 -->
<g id="edge3424" class="edge">
<title>ring_attn_0_15_stage_11&#45;&gt;ring_attn_0_0_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11279,-17675.07C11279,-17696.17 11279,-17714 11279,-17714 11279,-17714 225,-17714 225,-17714 225,-17714 225,-17685.07 225,-17685.07"/>
<polygon fill="red" stroke="red" points="228.5,-17685.07 225,-17675.07 221.5,-17685.07 228.5,-17685.07"/>
<text text-anchor="middle" x="6877" y="-17744.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-17729.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-17714.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_0_15_stage_11&#45;&gt;ring_attn_0_15_stage_12 -->
<g id="edge1470" class="edge">
<title>ring_attn_0_15_stage_11&#45;&gt;ring_attn_0_15_stage_12</title>
<path fill="none" stroke="black" d="M11348.67,-17561.48C11348.67,-17561.48 11348.67,-17409.58 11348.67,-17409.58"/>
<polygon fill="black" stroke="black" points="11352.17,-17409.58 11348.67,-17399.58 11345.17,-17409.58 11352.17,-17409.58"/>
</g>
<!-- ring_attn_0_15_stage_12&#45;&gt;ring_attn_0_0_stage_12 -->
<g id="edge3425" class="edge">
<title>ring_attn_0_15_stage_12&#45;&gt;ring_attn_0_0_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-17399.49C11209.33,-17435.58 11209.33,-17480 11209.33,-17480 11209.33,-17480 294.67,-17480 294.67,-17480 294.67,-17480 294.67,-17409.49 294.67,-17409.49"/>
<polygon fill="red" stroke="red" points="298.17,-17409.49 294.67,-17399.49 291.17,-17409.49 298.17,-17409.49"/>
<text text-anchor="middle" x="6877" y="-17491.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-17476.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-17461.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_0_15_stage_12&#45;&gt;ring_attn_0_15_stage_13 -->
<g id="edge1471" class="edge">
<title>ring_attn_0_15_stage_12&#45;&gt;ring_attn_0_15_stage_13</title>
<path fill="none" stroke="black" d="M11348.67,-17308.48C11348.67,-17308.48 11348.67,-17156.58 11348.67,-17156.58"/>
<polygon fill="black" stroke="black" points="11352.17,-17156.58 11348.67,-17146.58 11345.17,-17156.58 11352.17,-17156.58"/>
</g>
<!-- ring_attn_0_15_stage_13&#45;&gt;ring_attn_0_0_stage_13 -->
<g id="edge3426" class="edge">
<title>ring_attn_0_15_stage_13&#45;&gt;ring_attn_0_0_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-17146.49C11209.33,-17182.58 11209.33,-17227 11209.33,-17227 11209.33,-17227 294.67,-17227 294.67,-17227 294.67,-17227 294.67,-17156.49 294.67,-17156.49"/>
<polygon fill="red" stroke="red" points="298.17,-17156.49 294.67,-17146.49 291.17,-17156.49 298.17,-17156.49"/>
<text text-anchor="middle" x="6877" y="-17238.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-17223.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-17208.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_0_15_stage_13&#45;&gt;ring_attn_0_15_stage_14 -->
<g id="edge1472" class="edge">
<title>ring_attn_0_15_stage_13&#45;&gt;ring_attn_0_15_stage_14</title>
<path fill="none" stroke="black" d="M11279,-17032.87C11279,-17032.87 11279,-16926.25 11279,-16926.25"/>
<polygon fill="black" stroke="black" points="11282.5,-16926.25 11279,-16916.25 11275.5,-16926.25 11282.5,-16926.25"/>
</g>
<!-- ring_attn_0_15_stage_14&#45;&gt;ring_attn_0_0_stage_14 -->
<g id="edge3427" class="edge">
<title>ring_attn_0_15_stage_14&#45;&gt;ring_attn_0_0_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-16802.51C11209.33,-16766.07 11209.33,-16721 11209.33,-16721 11209.33,-16721 294.67,-16721 294.67,-16721 294.67,-16721 294.67,-16792.51 294.67,-16792.51"/>
<polygon fill="red" stroke="red" points="291.17,-16792.51 294.67,-16802.51 298.17,-16792.51 291.17,-16792.51"/>
<text text-anchor="middle" x="6877" y="-16985.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-16970.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-16955.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_0_15_stage_14&#45;&gt;ring_attn_0_15_stage_15 -->
<g id="edge1473" class="edge">
<title>ring_attn_0_15_stage_14&#45;&gt;ring_attn_0_15_stage_15</title>
<path fill="none" stroke="black" d="M11348.67,-16802.48C11348.67,-16802.48 11348.67,-16650.58 11348.67,-16650.58"/>
<polygon fill="black" stroke="black" points="11352.17,-16650.58 11348.67,-16640.58 11345.17,-16650.58 11352.17,-16650.58"/>
</g>
<!-- ring_attn_0_15_stage_15&#45;&gt;ring_attn_0_0_stage_15 -->
<g id="edge3428" class="edge">
<title>ring_attn_0_15_stage_15&#45;&gt;ring_attn_0_0_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11110.67,-16581.7C11110.67,-16553.45 11110.67,-16490 11110.67,-16490 11110.67,-16490 413.67,-16490 413.67,-16490 413.67,-16490 413.67,-16578.11 413.67,-16578.11"/>
<polygon fill="red" stroke="red" points="410.17,-16578.11 413.67,-16588.11 417.17,-16578.11 410.17,-16578.11"/>
<text text-anchor="middle" x="6877" y="-16732.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-16717.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-16702.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_0_15 -->
<g id="node1490" class="node">
<title>attn_out_0_15</title>
<polygon fill="none" stroke="black" points="11348.5,-16454 11209.5,-16454 11209.5,-16401 11348.5,-16401 11348.5,-16454"/>
<text text-anchor="middle" x="11279" y="-16438.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="11279" y="-16423.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="11279" y="-16408.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_0_15_stage_15&#45;&gt;attn_out_0_15 -->
<g id="edge1474" class="edge">
<title>ring_attn_0_15_stage_15&#45;&gt;attn_out_0_15</title>
<path fill="none" stroke="black" d="M11279,-16526.87C11279,-16526.87 11279,-16464.18 11279,-16464.18"/>
<polygon fill="black" stroke="black" points="11282.5,-16464.18 11279,-16454.18 11275.5,-16464.18 11282.5,-16464.18"/>
</g>
<!-- attn_residual_0_15 -->
<g id="node1491" class="node">
<title>attn_residual_0_15</title>
<ellipse fill="none" stroke="black" cx="11279" cy="-16301" rx="105.5" ry="27"/>
<text text-anchor="middle" x="11279" y="-16304.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="11279" y="-16289.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_0_15&#45;&gt;attn_residual_0_15 -->
<g id="edge1475" class="edge">
<title>attn_out_0_15&#45;&gt;attn_residual_0_15</title>
<path fill="none" stroke="black" d="M11279,-16400.98C11279,-16400.98 11279,-16338.36 11279,-16338.36"/>
<polygon fill="black" stroke="black" points="11282.5,-16338.36 11279,-16328.36 11275.5,-16338.36 11282.5,-16338.36"/>
</g>
<!-- gate_0_15 -->
<g id="node1492" class="node">
<title>gate_0_15</title>
<ellipse fill="orange" stroke="black" cx="11279" cy="-16163.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="11279" y="-16174.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="11279" y="-16159.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="11279" y="-16144.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_0_15&#45;&gt;gate_0_15 -->
<g id="edge1476" class="edge">
<title>attn_residual_0_15&#45;&gt;gate_0_15</title>
<path fill="none" stroke="black" d="M11349.33,-16280.71C11349.33,-16280.71 11349.33,-16201.5 11349.33,-16201.5"/>
<polygon fill="black" stroke="black" points="11352.83,-16201.5 11349.33,-16191.5 11345.83,-16201.5 11352.83,-16201.5"/>
</g>
<!-- gate_0_15&#45;&gt;expert_0_0_0 -->
<g id="edge3429" class="edge">
<title>gate_0_15&#45;&gt;expert_0_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11184.61,-16146.56C11184.61,-16106.26 11184.61,-16008 11184.61,-16008 11184.61,-16008 203.9,-16008 203.9,-16008 203.9,-16008 203.9,-16004.29 203.9,-16004.29"/>
<polygon fill="blue" stroke="blue" points="207.4,-16004.29 203.9,-15994.29 200.4,-16004.29 207.4,-16004.29"/>
<text text-anchor="middle" x="48146.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="48146.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="48146.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="48146.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_15&#45;&gt;expert_0_1_0 -->
<g id="edge3430" class="edge">
<title>gate_0_15&#45;&gt;expert_0_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11206.82,-16136.08C11206.82,-16090.48 11206.82,-16004 11206.82,-16004 11206.82,-16004 3041.82,-16004 3041.82,-16004 3041.82,-16004 3041.82,-16003 3041.82,-16003"/>
<polygon fill="blue" stroke="blue" points="3045.32,-16004.03 3041.82,-15994.03 3038.32,-16004.03 3045.32,-16004.03"/>
<text text-anchor="middle" x="48320.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="48320.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU15→GPU1</text>
<text text-anchor="middle" x="48320.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="48320.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_15&#45;&gt;expert_0_2_0 -->
<g id="edge3431" class="edge">
<title>gate_0_15&#45;&gt;expert_0_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11229.03,-16130.24C11229.03,-16083.23 11229.03,-16003 11229.03,-16003 11229.03,-16003 3651.91,-16003 3651.91,-16003 3651.91,-16003 3651.91,-16002.1 3651.91,-16002.1"/>
<polygon fill="blue" stroke="blue" points="3655.41,-16004.04 3651.91,-15994.04 3648.41,-16004.04 3655.41,-16004.04"/>
<text text-anchor="middle" x="48494.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="48494.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU15→GPU2</text>
<text text-anchor="middle" x="48494.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="48494.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_15&#45;&gt;expert_0_3_0 -->
<g id="edge3432" class="edge">
<title>gate_0_15&#45;&gt;expert_0_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11251.24,-16127.26C11251.24,-16079.64 11251.24,-16002 11251.24,-16002 11251.24,-16002 4579.2,-16002 4579.2,-16002 4579.2,-16002 4579.2,-15967 4579.2,-15967 4579.2,-15967 4364.42,-15967 4364.42,-15967"/>
<polygon fill="blue" stroke="blue" points="4364.42,-15963.5 4354.42,-15967 4364.42,-15970.5 4364.42,-15963.5"/>
<text text-anchor="middle" x="48668.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="48668.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU15→GPU3</text>
<text text-anchor="middle" x="48668.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="48668.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_15&#45;&gt;expert_0_4_0 -->
<g id="edge3433" class="edge">
<title>gate_0_15&#45;&gt;expert_0_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11314.17,-16199.01C11314.17,-16220.97 11314.17,-16245 11314.17,-16245 11314.17,-16245 5275.5,-16245 5275.5,-16245 5275.5,-16245 5275.5,-15967 5275.5,-15967 5275.5,-15967 4951.15,-15967 4951.15,-15967"/>
<polygon fill="blue" stroke="blue" points="4951.15,-15963.5 4941.15,-15967 4951.15,-15970.5 4951.15,-15963.5"/>
<text text-anchor="middle" x="48842.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="48842.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU15→GPU4</text>
<text text-anchor="middle" x="48842.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="48842.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_15&#45;&gt;expert_0_5_0 -->
<g id="edge3434" class="edge">
<title>gate_0_15&#45;&gt;expert_0_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11279,-16201.19C11279,-16219.66 11279,-16238 11279,-16238 11279,-16238 5862.5,-16238 5862.5,-16238 5862.5,-16238 5862.5,-15958 5862.5,-15958 5862.5,-15958 5538.15,-15958 5538.15,-15958"/>
<polygon fill="blue" stroke="blue" points="5538.15,-15954.5 5528.15,-15958 5538.15,-15961.5 5538.15,-15954.5"/>
<text text-anchor="middle" x="49016.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49016.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU15→GPU5</text>
<text text-anchor="middle" x="49016.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49016.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_15&#45;&gt;expert_0_6_0 -->
<g id="edge3435" class="edge">
<title>gate_0_15&#45;&gt;expert_0_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11243.83,-16199.04C11243.83,-16212.21 11243.83,-16224 11243.83,-16224 11243.83,-16224 5887.8,-16224 5887.8,-16224 5887.8,-16224 5887.8,-16004.47 5887.8,-16004.47"/>
<polygon fill="blue" stroke="blue" points="5891.3,-16004.47 5887.8,-15994.47 5884.3,-16004.47 5891.3,-16004.47"/>
<text text-anchor="middle" x="49190.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49190.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU15→GPU6</text>
<text text-anchor="middle" x="49190.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49190.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_15&#45;&gt;expert_0_7_0 -->
<g id="edge3436" class="edge">
<title>gate_0_15&#45;&gt;expert_0_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11208.67,-16191.62C11208.67,-16201.41 11208.67,-16210 11208.67,-16210 11208.67,-16210 6691.88,-16210 6691.88,-16210 6691.88,-16210 6691.88,-16004.38 6691.88,-16004.38"/>
<polygon fill="blue" stroke="blue" points="6695.38,-16004.38 6691.88,-15994.38 6688.38,-16004.38 6695.38,-16004.38"/>
<text text-anchor="middle" x="49364.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49364.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU15→GPU7</text>
<text text-anchor="middle" x="49364.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49364.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_15&#45;&gt;expert_0_8_0 -->
<g id="edge3437" class="edge">
<title>gate_0_15&#45;&gt;expert_0_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11273.45,-16125.76C11273.45,-16085.66 11273.45,-16028 11273.45,-16028 11273.45,-16028 7211.28,-16028 7211.28,-16028 7211.28,-16028 7211.28,-16004.21 7211.28,-16004.21"/>
<polygon fill="blue" stroke="blue" points="7214.78,-16004.21 7211.28,-15994.21 7207.78,-16004.21 7214.78,-16004.21"/>
<text text-anchor="middle" x="49538.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49538.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU15→GPU8</text>
<text text-anchor="middle" x="49538.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49538.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_15&#45;&gt;expert_0_9_0 -->
<g id="edge3438" class="edge">
<title>gate_0_15&#45;&gt;expert_0_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11295.66,-16126.36C11295.66,-16077.56 11295.66,-15998 11295.66,-15998 11295.66,-15998 7804.95,-15998 7804.95,-15998 7804.95,-15998 7804.95,-15997.6 7804.95,-15997.6"/>
<polygon fill="blue" stroke="blue" points="7808.45,-16004.01 7804.95,-15994.01 7801.45,-16004.01 7808.45,-16004.01"/>
<text text-anchor="middle" x="49712.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49712.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU15→GPU9</text>
<text text-anchor="middle" x="49712.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49712.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_15&#45;&gt;expert_0_10_0 -->
<g id="edge3439" class="edge">
<title>gate_0_15&#45;&gt;expert_0_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11317.87,-16128.6C11317.87,-16079.77 11317.87,-15997 11317.87,-15997 11317.87,-15997 8399.26,-15997 8399.26,-15997 8399.26,-15997 8399.26,-15996.73 8399.26,-15996.73"/>
<polygon fill="blue" stroke="blue" points="8402.76,-16004.28 8399.26,-15994.28 8395.76,-16004.28 8402.76,-16004.28"/>
<text text-anchor="middle" x="49886.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49886.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU15→GPU10</text>
<text text-anchor="middle" x="49886.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49886.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_15&#45;&gt;expert_0_11_0 -->
<g id="edge3440" class="edge">
<title>gate_0_15&#45;&gt;expert_0_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11340.08,-16132.83C11340.08,-16103.6 11340.08,-16064 11340.08,-16064 11340.08,-16064 8996.31,-16064 8996.31,-16064 8996.31,-16064 8996.31,-16004.12 8996.31,-16004.12"/>
<polygon fill="blue" stroke="blue" points="8999.81,-16004.12 8996.31,-15994.12 8992.81,-16004.12 8999.81,-16004.12"/>
<text text-anchor="middle" x="50060.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="50060.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU15→GPU11</text>
<text text-anchor="middle" x="50060.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="50060.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_15&#45;&gt;expert_0_12_0 -->
<g id="edge3441" class="edge">
<title>gate_0_15&#45;&gt;expert_0_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11351.18,-16135.89C11351.18,-16124.1 11351.18,-16113 11351.18,-16113 11351.18,-16113 9595.98,-16113 9595.98,-16113 9595.98,-16113 9595.98,-16004.19 9595.98,-16004.19"/>
<polygon fill="blue" stroke="blue" points="9599.48,-16004.19 9595.98,-15994.19 9592.48,-16004.19 9599.48,-16004.19"/>
<text text-anchor="middle" x="50234.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="50234.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU15→GPU12</text>
<text text-anchor="middle" x="50234.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="50234.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_15&#45;&gt;expert_0_13_0 -->
<g id="edge3442" class="edge">
<title>gate_0_15&#45;&gt;expert_0_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11362.29,-16140.29C11362.29,-16093.87 11362.29,-15994 11362.29,-15994 11362.29,-15994 10219.5,-15994 10219.5,-15994 10219.5,-15994 10219.5,-15993.99 10219.5,-15993.99"/>
<polygon fill="blue" stroke="blue" points="10223.01,-16003.92 10219.5,-15993.92 10216.01,-16003.93 10223.01,-16003.92"/>
<text text-anchor="middle" x="50408.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="50408.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU15→GPU13</text>
<text text-anchor="middle" x="50408.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="50408.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_15&#45;&gt;expert_0_14_0 -->
<g id="edge3443" class="edge">
<title>gate_0_15&#45;&gt;expert_0_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11179.37,-16176C11040.75,-16176 10806.5,-16176 10806.5,-16176 10806.5,-16176 10806.5,-16004.33 10806.5,-16004.33"/>
<polygon fill="blue" stroke="blue" points="10810,-16004.33 10806.5,-15994.33 10803,-16004.33 10810,-16004.33"/>
<text text-anchor="middle" x="50582.5" y="-16078.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="50582.5" y="-16063.8" font-family="Times,serif" font-size="14.00">GPU15→GPU14</text>
<text text-anchor="middle" x="50582.5" y="-16048.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="50582.5" y="-16033.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_0_15&#45;&gt;expert_0_15_0 -->
<g id="edge1477" class="edge">
<title>gate_0_15&#45;&gt;expert_0_15_0</title>
<path fill="none" stroke="black" d="M11373.39,-16146.45C11373.39,-16146.45 11373.39,-16004.2 11373.39,-16004.2"/>
<polygon fill="black" stroke="black" points="11376.89,-16004.2 11373.39,-15994.2 11369.89,-16004.2 11376.89,-16004.2"/>
</g>
<!-- expert_reduce_0_15 -->
<g id="node1494" class="node">
<title>expert_reduce_0_15</title>
<ellipse fill="none" stroke="black" cx="11279" cy="-15830.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="11279" y="-15841.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="11279" y="-15826.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="11279" y="-15811.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_0_15_0&#45;&gt;expert_reduce_0_15 -->
<g id="edge1478" class="edge">
<title>expert_0_15_0&#45;&gt;expert_reduce_0_15</title>
<path fill="none" stroke="black" d="M11279,-15940.76C11279,-15940.76 11279,-15878.06 11279,-15878.06"/>
<polygon fill="black" stroke="black" points="11282.5,-15878.06 11279,-15868.06 11275.5,-15878.06 11282.5,-15878.06"/>
</g>
<!-- moe_residual_0_15 -->
<g id="node1495" class="node">
<title>moe_residual_0_15</title>
<ellipse fill="none" stroke="black" cx="11279" cy="-15693" rx="105.5" ry="27"/>
<text text-anchor="middle" x="11279" y="-15696.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="11279" y="-15681.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_0_15&#45;&gt;moe_residual_0_15 -->
<g id="edge1479" class="edge">
<title>expert_reduce_0_15&#45;&gt;moe_residual_0_15</title>
<path fill="none" stroke="black" d="M11279,-15792.93C11279,-15792.93 11279,-15730.06 11279,-15730.06"/>
<polygon fill="black" stroke="black" points="11282.5,-15730.06 11279,-15720.06 11275.5,-15730.06 11282.5,-15730.06"/>
</g>
<!-- qkv_proj_1_15 -->
<g id="node1496" class="node">
<title>qkv_proj_1_15</title>
<polygon fill="none" stroke="black" points="11361.5,-15593 11196.5,-15593 11196.5,-15540 11361.5,-15540 11361.5,-15593"/>
<text text-anchor="middle" x="11279" y="-15577.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="11279" y="-15562.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="11279" y="-15547.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_0_15&#45;&gt;qkv_proj_1_15 -->
<g id="edge1480" class="edge">
<title>moe_residual_0_15&#45;&gt;qkv_proj_1_15</title>
<path fill="none" stroke="black" d="M11279,-15665.86C11279,-15665.86 11279,-15603.16 11279,-15603.16"/>
<polygon fill="black" stroke="black" points="11282.5,-15603.16 11279,-15593.16 11275.5,-15603.16 11282.5,-15603.16"/>
</g>
<!-- qkv_reshape_1_15 -->
<g id="node1497" class="node">
<title>qkv_reshape_1_15</title>
<ellipse fill="none" stroke="black" cx="11279" cy="-15440" rx="148" ry="27"/>
<text text-anchor="middle" x="11279" y="-15443.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="11279" y="-15428.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_1_15&#45;&gt;qkv_reshape_1_15 -->
<g id="edge1481" class="edge">
<title>qkv_proj_1_15&#45;&gt;qkv_reshape_1_15</title>
<path fill="none" stroke="black" d="M11279,-15539.98C11279,-15539.98 11279,-15477.36 11279,-15477.36"/>
<polygon fill="black" stroke="black" points="11282.5,-15477.36 11279,-15467.36 11275.5,-15477.36 11282.5,-15477.36"/>
</g>
<!-- qkv_reshape_1_15&#45;&gt;ring_attn_1_15_stage_0 -->
<g id="edge1482" class="edge">
<title>qkv_reshape_1_15&#45;&gt;ring_attn_1_15_stage_0</title>
<path fill="none" stroke="black" d="M11279,-15412.72C11279,-15412.72 11279,-15306.16 11279,-15306.16"/>
<polygon fill="black" stroke="black" points="11282.5,-15306.16 11279,-15296.16 11275.5,-15306.16 11282.5,-15306.16"/>
</g>
<!-- ring_attn_1_15_stage_0&#45;&gt;ring_attn_1_0_stage_0 -->
<g id="edge3444" class="edge">
<title>ring_attn_1_15_stage_0&#45;&gt;ring_attn_1_0_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11090.33,-15234.77C11090.33,-15260.95 11090.33,-15354 11090.33,-15354 11090.33,-15354 393.33,-15354 393.33,-15354 393.33,-15354 393.33,-15251.48 393.33,-15251.48"/>
<polygon fill="red" stroke="red" points="396.83,-15251.48 393.33,-15241.48 389.83,-15251.48 396.83,-15251.48"/>
<text text-anchor="middle" x="6877" y="-15365.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-15350.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-15335.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_1_15_stage_0&#45;&gt;ring_attn_1_15_stage_1 -->
<g id="edge1483" class="edge">
<title>ring_attn_1_15_stage_0&#45;&gt;ring_attn_1_15_stage_1</title>
<path fill="none" stroke="black" d="M11279,-15159.87C11279,-15159.87 11279,-15053.25 11279,-15053.25"/>
<polygon fill="black" stroke="black" points="11282.5,-15053.25 11279,-15043.25 11275.5,-15053.25 11282.5,-15053.25"/>
</g>
<!-- ring_attn_1_15_stage_1&#45;&gt;ring_attn_1_0_stage_1 -->
<g id="edge3445" class="edge">
<title>ring_attn_1_15_stage_1&#45;&gt;ring_attn_1_0_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11174.5,-14940.85C11174.5,-14909.54 11174.5,-14868 11174.5,-14868 11174.5,-14868 329.5,-14868 329.5,-14868 329.5,-14868 329.5,-14930.85 329.5,-14930.85"/>
<polygon fill="red" stroke="red" points="326,-14930.85 329.5,-14940.85 333,-14930.85 326,-14930.85"/>
<text text-anchor="middle" x="6877" y="-15112.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-15097.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-15082.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_1_15_stage_1&#45;&gt;ring_attn_1_15_stage_2 -->
<g id="edge1484" class="edge">
<title>ring_attn_1_15_stage_1&#45;&gt;ring_attn_1_15_stage_2</title>
<path fill="none" stroke="black" d="M11383.5,-14940.88C11383.5,-14940.88 11383.5,-14766.39 11383.5,-14766.39"/>
<polygon fill="black" stroke="black" points="11387,-14766.39 11383.5,-14756.39 11380,-14766.39 11387,-14766.39"/>
</g>
<!-- ring_attn_1_15_stage_2&#45;&gt;ring_attn_1_0_stage_2 -->
<g id="edge3446" class="edge">
<title>ring_attn_1_15_stage_2&#45;&gt;ring_attn_1_0_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11279,-14790.07C11279,-14811.17 11279,-14829 11279,-14829 11279,-14829 225,-14829 225,-14829 225,-14829 225,-14800.07 225,-14800.07"/>
<polygon fill="red" stroke="red" points="228.5,-14800.07 225,-14790.07 221.5,-14800.07 228.5,-14800.07"/>
<text text-anchor="middle" x="6877" y="-14859.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-14844.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-14829.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_1_15_stage_2&#45;&gt;ring_attn_1_15_stage_3 -->
<g id="edge1485" class="edge">
<title>ring_attn_1_15_stage_2&#45;&gt;ring_attn_1_15_stage_3</title>
<path fill="none" stroke="black" d="M11279,-14653.87C11279,-14653.87 11279,-14547.25 11279,-14547.25"/>
<polygon fill="black" stroke="black" points="11282.5,-14547.25 11279,-14537.25 11275.5,-14547.25 11282.5,-14547.25"/>
</g>
<!-- ring_attn_1_15_stage_3&#45;&gt;ring_attn_1_0_stage_3 -->
<g id="edge3447" class="edge">
<title>ring_attn_1_15_stage_3&#45;&gt;ring_attn_1_0_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11174.5,-14434.85C11174.5,-14403.54 11174.5,-14362 11174.5,-14362 11174.5,-14362 329.5,-14362 329.5,-14362 329.5,-14362 329.5,-14424.85 329.5,-14424.85"/>
<polygon fill="red" stroke="red" points="326,-14424.85 329.5,-14434.85 333,-14424.85 326,-14424.85"/>
<text text-anchor="middle" x="6877" y="-14606.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-14591.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-14576.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_1_15_stage_3&#45;&gt;ring_attn_1_15_stage_4 -->
<g id="edge1486" class="edge">
<title>ring_attn_1_15_stage_3&#45;&gt;ring_attn_1_15_stage_4</title>
<path fill="none" stroke="black" d="M11383.5,-14434.88C11383.5,-14434.88 11383.5,-14260.39 11383.5,-14260.39"/>
<polygon fill="black" stroke="black" points="11387,-14260.39 11383.5,-14250.39 11380,-14260.39 11387,-14260.39"/>
</g>
<!-- ring_attn_1_15_stage_4&#45;&gt;ring_attn_1_0_stage_4 -->
<g id="edge3448" class="edge">
<title>ring_attn_1_15_stage_4&#45;&gt;ring_attn_1_0_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11279,-14284.07C11279,-14305.17 11279,-14323 11279,-14323 11279,-14323 225,-14323 225,-14323 225,-14323 225,-14294.07 225,-14294.07"/>
<polygon fill="red" stroke="red" points="228.5,-14294.07 225,-14284.07 221.5,-14294.07 228.5,-14294.07"/>
<text text-anchor="middle" x="6877" y="-14353.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-14338.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-14323.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_1_15_stage_4&#45;&gt;ring_attn_1_15_stage_5 -->
<g id="edge1487" class="edge">
<title>ring_attn_1_15_stage_4&#45;&gt;ring_attn_1_15_stage_5</title>
<path fill="none" stroke="black" d="M11279,-14147.87C11279,-14147.87 11279,-14041.25 11279,-14041.25"/>
<polygon fill="black" stroke="black" points="11282.5,-14041.25 11279,-14031.25 11275.5,-14041.25 11282.5,-14041.25"/>
</g>
<!-- ring_attn_1_15_stage_5&#45;&gt;ring_attn_1_0_stage_5 -->
<g id="edge3449" class="edge">
<title>ring_attn_1_15_stage_5&#45;&gt;ring_attn_1_0_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11174.5,-13928.85C11174.5,-13897.54 11174.5,-13856 11174.5,-13856 11174.5,-13856 329.5,-13856 329.5,-13856 329.5,-13856 329.5,-13918.85 329.5,-13918.85"/>
<polygon fill="red" stroke="red" points="326,-13918.85 329.5,-13928.85 333,-13918.85 326,-13918.85"/>
<text text-anchor="middle" x="6877" y="-14100.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-14085.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-14070.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_1_15_stage_5&#45;&gt;ring_attn_1_15_stage_6 -->
<g id="edge1488" class="edge">
<title>ring_attn_1_15_stage_5&#45;&gt;ring_attn_1_15_stage_6</title>
<path fill="none" stroke="black" d="M11383.5,-13928.88C11383.5,-13928.88 11383.5,-13754.39 11383.5,-13754.39"/>
<polygon fill="black" stroke="black" points="11387,-13754.39 11383.5,-13744.39 11380,-13754.39 11387,-13754.39"/>
</g>
<!-- ring_attn_1_15_stage_6&#45;&gt;ring_attn_1_0_stage_6 -->
<g id="edge3450" class="edge">
<title>ring_attn_1_15_stage_6&#45;&gt;ring_attn_1_0_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11279,-13778.07C11279,-13799.17 11279,-13817 11279,-13817 11279,-13817 225,-13817 225,-13817 225,-13817 225,-13788.07 225,-13788.07"/>
<polygon fill="red" stroke="red" points="228.5,-13788.07 225,-13778.07 221.5,-13788.07 228.5,-13788.07"/>
<text text-anchor="middle" x="6877" y="-13847.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-13832.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-13817.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_1_15_stage_6&#45;&gt;ring_attn_1_15_stage_7 -->
<g id="edge1489" class="edge">
<title>ring_attn_1_15_stage_6&#45;&gt;ring_attn_1_15_stage_7</title>
<path fill="none" stroke="black" d="M11348.67,-13664.48C11348.67,-13664.48 11348.67,-13512.58 11348.67,-13512.58"/>
<polygon fill="black" stroke="black" points="11352.17,-13512.58 11348.67,-13502.58 11345.17,-13512.58 11352.17,-13512.58"/>
</g>
<!-- ring_attn_1_15_stage_7&#45;&gt;ring_attn_1_0_stage_7 -->
<g id="edge3451" class="edge">
<title>ring_attn_1_15_stage_7&#45;&gt;ring_attn_1_0_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-13502.49C11209.33,-13538.58 11209.33,-13583 11209.33,-13583 11209.33,-13583 294.67,-13583 294.67,-13583 294.67,-13583 294.67,-13512.49 294.67,-13512.49"/>
<polygon fill="red" stroke="red" points="298.17,-13512.49 294.67,-13502.49 291.17,-13512.49 298.17,-13512.49"/>
<text text-anchor="middle" x="6877" y="-13594.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-13579.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-13564.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_1_15_stage_7&#45;&gt;ring_attn_1_15_stage_8 -->
<g id="edge1490" class="edge">
<title>ring_attn_1_15_stage_7&#45;&gt;ring_attn_1_15_stage_8</title>
<path fill="none" stroke="black" d="M11348.67,-13411.48C11348.67,-13411.48 11348.67,-13259.58 11348.67,-13259.58"/>
<polygon fill="black" stroke="black" points="11352.17,-13259.58 11348.67,-13249.58 11345.17,-13259.58 11352.17,-13259.58"/>
</g>
<!-- ring_attn_1_15_stage_8&#45;&gt;ring_attn_1_0_stage_8 -->
<g id="edge3452" class="edge">
<title>ring_attn_1_15_stage_8&#45;&gt;ring_attn_1_0_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-13249.49C11209.33,-13285.58 11209.33,-13330 11209.33,-13330 11209.33,-13330 294.67,-13330 294.67,-13330 294.67,-13330 294.67,-13259.49 294.67,-13259.49"/>
<polygon fill="red" stroke="red" points="298.17,-13259.49 294.67,-13249.49 291.17,-13259.49 298.17,-13259.49"/>
<text text-anchor="middle" x="6877" y="-13341.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-13326.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-13311.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_1_15_stage_8&#45;&gt;ring_attn_1_15_stage_9 -->
<g id="edge1491" class="edge">
<title>ring_attn_1_15_stage_8&#45;&gt;ring_attn_1_15_stage_9</title>
<path fill="none" stroke="black" d="M11348.67,-13158.48C11348.67,-13158.48 11348.67,-13006.58 11348.67,-13006.58"/>
<polygon fill="black" stroke="black" points="11352.17,-13006.58 11348.67,-12996.58 11345.17,-13006.58 11352.17,-13006.58"/>
</g>
<!-- ring_attn_1_15_stage_9&#45;&gt;ring_attn_1_0_stage_9 -->
<g id="edge3453" class="edge">
<title>ring_attn_1_15_stage_9&#45;&gt;ring_attn_1_0_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-12996.49C11209.33,-13032.58 11209.33,-13077 11209.33,-13077 11209.33,-13077 294.67,-13077 294.67,-13077 294.67,-13077 294.67,-13006.49 294.67,-13006.49"/>
<polygon fill="red" stroke="red" points="298.17,-13006.49 294.67,-12996.49 291.17,-13006.49 298.17,-13006.49"/>
<text text-anchor="middle" x="6877" y="-13088.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-13073.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-13058.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_1_15_stage_9&#45;&gt;ring_attn_1_15_stage_10 -->
<g id="edge1492" class="edge">
<title>ring_attn_1_15_stage_9&#45;&gt;ring_attn_1_15_stage_10</title>
<path fill="none" stroke="black" d="M11348.67,-12905.48C11348.67,-12905.48 11348.67,-12753.58 11348.67,-12753.58"/>
<polygon fill="black" stroke="black" points="11352.17,-12753.58 11348.67,-12743.58 11345.17,-12753.58 11352.17,-12753.58"/>
</g>
<!-- ring_attn_1_15_stage_10&#45;&gt;ring_attn_1_0_stage_10 -->
<g id="edge3454" class="edge">
<title>ring_attn_1_15_stage_10&#45;&gt;ring_attn_1_0_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-12743.49C11209.33,-12779.58 11209.33,-12824 11209.33,-12824 11209.33,-12824 294.67,-12824 294.67,-12824 294.67,-12824 294.67,-12753.49 294.67,-12753.49"/>
<polygon fill="red" stroke="red" points="298.17,-12753.49 294.67,-12743.49 291.17,-12753.49 298.17,-12753.49"/>
<text text-anchor="middle" x="6877" y="-12835.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-12820.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-12805.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_1_15_stage_10&#45;&gt;ring_attn_1_15_stage_11 -->
<g id="edge1493" class="edge">
<title>ring_attn_1_15_stage_10&#45;&gt;ring_attn_1_15_stage_11</title>
<path fill="none" stroke="black" d="M11348.67,-12652.48C11348.67,-12652.48 11348.67,-12500.58 11348.67,-12500.58"/>
<polygon fill="black" stroke="black" points="11352.17,-12500.58 11348.67,-12490.58 11345.17,-12500.58 11352.17,-12500.58"/>
</g>
<!-- ring_attn_1_15_stage_11&#45;&gt;ring_attn_1_0_stage_11 -->
<g id="edge3455" class="edge">
<title>ring_attn_1_15_stage_11&#45;&gt;ring_attn_1_0_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-12490.49C11209.33,-12526.58 11209.33,-12571 11209.33,-12571 11209.33,-12571 294.67,-12571 294.67,-12571 294.67,-12571 294.67,-12500.49 294.67,-12500.49"/>
<polygon fill="red" stroke="red" points="298.17,-12500.49 294.67,-12490.49 291.17,-12500.49 298.17,-12500.49"/>
<text text-anchor="middle" x="6877" y="-12582.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-12567.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-12552.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_1_15_stage_11&#45;&gt;ring_attn_1_15_stage_12 -->
<g id="edge1494" class="edge">
<title>ring_attn_1_15_stage_11&#45;&gt;ring_attn_1_15_stage_12</title>
<path fill="none" stroke="black" d="M11279,-12376.87C11279,-12376.87 11279,-12270.25 11279,-12270.25"/>
<polygon fill="black" stroke="black" points="11282.5,-12270.25 11279,-12260.25 11275.5,-12270.25 11282.5,-12270.25"/>
</g>
<!-- ring_attn_1_15_stage_12&#45;&gt;ring_attn_1_0_stage_12 -->
<g id="edge3456" class="edge">
<title>ring_attn_1_15_stage_12&#45;&gt;ring_attn_1_0_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-12146.51C11209.33,-12110.07 11209.33,-12065 11209.33,-12065 11209.33,-12065 294.67,-12065 294.67,-12065 294.67,-12065 294.67,-12136.51 294.67,-12136.51"/>
<polygon fill="red" stroke="red" points="291.17,-12136.51 294.67,-12146.51 298.17,-12136.51 291.17,-12136.51"/>
<text text-anchor="middle" x="6877" y="-12329.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-12314.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-12299.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_1_15_stage_12&#45;&gt;ring_attn_1_15_stage_13 -->
<g id="edge1495" class="edge">
<title>ring_attn_1_15_stage_12&#45;&gt;ring_attn_1_15_stage_13</title>
<path fill="none" stroke="black" d="M11348.67,-12146.48C11348.67,-12146.48 11348.67,-11994.58 11348.67,-11994.58"/>
<polygon fill="black" stroke="black" points="11352.17,-11994.58 11348.67,-11984.58 11345.17,-11994.58 11352.17,-11994.58"/>
</g>
<!-- ring_attn_1_15_stage_13&#45;&gt;ring_attn_1_0_stage_13 -->
<g id="edge3457" class="edge">
<title>ring_attn_1_15_stage_13&#45;&gt;ring_attn_1_0_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11174.5,-11904.85C11174.5,-11873.54 11174.5,-11832 11174.5,-11832 11174.5,-11832 329.5,-11832 329.5,-11832 329.5,-11832 329.5,-11894.85 329.5,-11894.85"/>
<polygon fill="red" stroke="red" points="326,-11894.85 329.5,-11904.85 333,-11894.85 326,-11894.85"/>
<text text-anchor="middle" x="6877" y="-12076.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-12061.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-12046.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_1_15_stage_13&#45;&gt;ring_attn_1_15_stage_14 -->
<g id="edge1496" class="edge">
<title>ring_attn_1_15_stage_13&#45;&gt;ring_attn_1_15_stage_14</title>
<path fill="none" stroke="black" d="M11383.5,-11904.88C11383.5,-11904.88 11383.5,-11730.39 11383.5,-11730.39"/>
<polygon fill="black" stroke="black" points="11387,-11730.39 11383.5,-11720.39 11380,-11730.39 11387,-11730.39"/>
</g>
<!-- ring_attn_1_15_stage_14&#45;&gt;ring_attn_1_0_stage_14 -->
<g id="edge3458" class="edge">
<title>ring_attn_1_15_stage_14&#45;&gt;ring_attn_1_0_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11279,-11754.07C11279,-11775.17 11279,-11793 11279,-11793 11279,-11793 225,-11793 225,-11793 225,-11793 225,-11764.07 225,-11764.07"/>
<polygon fill="red" stroke="red" points="228.5,-11764.07 225,-11754.07 221.5,-11764.07 228.5,-11764.07"/>
<text text-anchor="middle" x="6877" y="-11823.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-11808.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-11793.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_1_15_stage_14&#45;&gt;ring_attn_1_15_stage_15 -->
<g id="edge1497" class="edge">
<title>ring_attn_1_15_stage_14&#45;&gt;ring_attn_1_15_stage_15</title>
<path fill="none" stroke="black" d="M11279,-11617.87C11279,-11617.87 11279,-11511.25 11279,-11511.25"/>
<polygon fill="black" stroke="black" points="11282.5,-11511.25 11279,-11501.25 11275.5,-11511.25 11282.5,-11511.25"/>
</g>
<!-- ring_attn_1_15_stage_15&#45;&gt;ring_attn_1_0_stage_15 -->
<g id="edge3459" class="edge">
<title>ring_attn_1_15_stage_15&#45;&gt;ring_attn_1_0_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11110.67,-11419.7C11110.67,-11391.45 11110.67,-11328 11110.67,-11328 11110.67,-11328 413.67,-11328 413.67,-11328 413.67,-11328 413.67,-11416.11 413.67,-11416.11"/>
<polygon fill="red" stroke="red" points="410.17,-11416.11 413.67,-11426.11 417.17,-11416.11 410.17,-11416.11"/>
<text text-anchor="middle" x="6877" y="-11570.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-11555.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-11540.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_1_15 -->
<g id="node1514" class="node">
<title>attn_out_1_15</title>
<polygon fill="none" stroke="black" points="11348.5,-11292 11209.5,-11292 11209.5,-11239 11348.5,-11239 11348.5,-11292"/>
<text text-anchor="middle" x="11279" y="-11276.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="11279" y="-11261.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="11279" y="-11246.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_1_15_stage_15&#45;&gt;attn_out_1_15 -->
<g id="edge1498" class="edge">
<title>ring_attn_1_15_stage_15&#45;&gt;attn_out_1_15</title>
<path fill="none" stroke="black" d="M11279,-11364.87C11279,-11364.87 11279,-11302.18 11279,-11302.18"/>
<polygon fill="black" stroke="black" points="11282.5,-11302.18 11279,-11292.18 11275.5,-11302.18 11282.5,-11302.18"/>
</g>
<!-- attn_residual_1_15 -->
<g id="node1515" class="node">
<title>attn_residual_1_15</title>
<ellipse fill="none" stroke="black" cx="11279" cy="-11139" rx="105.5" ry="27"/>
<text text-anchor="middle" x="11279" y="-11142.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="11279" y="-11127.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_1_15&#45;&gt;attn_residual_1_15 -->
<g id="edge1499" class="edge">
<title>attn_out_1_15&#45;&gt;attn_residual_1_15</title>
<path fill="none" stroke="black" d="M11279,-11238.98C11279,-11238.98 11279,-11176.36 11279,-11176.36"/>
<polygon fill="black" stroke="black" points="11282.5,-11176.36 11279,-11166.36 11275.5,-11176.36 11282.5,-11176.36"/>
</g>
<!-- gate_1_15 -->
<g id="node1516" class="node">
<title>gate_1_15</title>
<ellipse fill="orange" stroke="black" cx="11279" cy="-11001.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="11279" y="-11012.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="11279" y="-10997.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="11279" y="-10982.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_1_15&#45;&gt;gate_1_15 -->
<g id="edge1500" class="edge">
<title>attn_residual_1_15&#45;&gt;gate_1_15</title>
<path fill="none" stroke="black" d="M11349.33,-11118.71C11349.33,-11118.71 11349.33,-11039.5 11349.33,-11039.5"/>
<polygon fill="black" stroke="black" points="11352.83,-11039.5 11349.33,-11029.5 11345.83,-11039.5 11352.83,-11039.5"/>
</g>
<!-- gate_1_15&#45;&gt;expert_1_0_0 -->
<g id="edge3460" class="edge">
<title>gate_1_15&#45;&gt;expert_1_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11184.61,-10984.56C11184.61,-10944.26 11184.61,-10846 11184.61,-10846 11184.61,-10846 203.9,-10846 203.9,-10846 203.9,-10846 203.9,-10842.29 203.9,-10842.29"/>
<polygon fill="blue" stroke="blue" points="207.4,-10842.29 203.9,-10832.29 200.4,-10842.29 207.4,-10842.29"/>
<text text-anchor="middle" x="48146.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="48146.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="48146.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="48146.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_15&#45;&gt;expert_1_1_0 -->
<g id="edge3461" class="edge">
<title>gate_1_15&#45;&gt;expert_1_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11206.82,-10974.08C11206.82,-10928.48 11206.82,-10842 11206.82,-10842 11206.82,-10842 3041.82,-10842 3041.82,-10842 3041.82,-10842 3041.82,-10841 3041.82,-10841"/>
<polygon fill="blue" stroke="blue" points="3045.32,-10842.03 3041.82,-10832.03 3038.32,-10842.03 3045.32,-10842.03"/>
<text text-anchor="middle" x="48320.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="48320.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU15→GPU1</text>
<text text-anchor="middle" x="48320.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="48320.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_15&#45;&gt;expert_1_2_0 -->
<g id="edge3462" class="edge">
<title>gate_1_15&#45;&gt;expert_1_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11229.03,-10968.24C11229.03,-10921.23 11229.03,-10841 11229.03,-10841 11229.03,-10841 3651.91,-10841 3651.91,-10841 3651.91,-10841 3651.91,-10840.1 3651.91,-10840.1"/>
<polygon fill="blue" stroke="blue" points="3655.41,-10842.04 3651.91,-10832.04 3648.41,-10842.04 3655.41,-10842.04"/>
<text text-anchor="middle" x="48494.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="48494.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU15→GPU2</text>
<text text-anchor="middle" x="48494.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="48494.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_15&#45;&gt;expert_1_3_0 -->
<g id="edge3463" class="edge">
<title>gate_1_15&#45;&gt;expert_1_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11251.24,-10965.26C11251.24,-10917.64 11251.24,-10840 11251.24,-10840 11251.24,-10840 4545.4,-10840 4545.4,-10840 4545.4,-10840 4545.4,-10805 4545.4,-10805 4545.4,-10805 4364.12,-10805 4364.12,-10805"/>
<polygon fill="blue" stroke="blue" points="4364.12,-10801.5 4354.12,-10805 4364.12,-10808.5 4364.12,-10801.5"/>
<text text-anchor="middle" x="48668.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="48668.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU15→GPU3</text>
<text text-anchor="middle" x="48668.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="48668.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_15&#45;&gt;expert_1_4_0 -->
<g id="edge3464" class="edge">
<title>gate_1_15&#45;&gt;expert_1_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11314.17,-11037.01C11314.17,-11058.97 11314.17,-11083 11314.17,-11083 11314.17,-11083 5275.5,-11083 5275.5,-11083 5275.5,-11083 5275.5,-10805 5275.5,-10805 5275.5,-10805 4951.15,-10805 4951.15,-10805"/>
<polygon fill="blue" stroke="blue" points="4951.15,-10801.5 4941.15,-10805 4951.15,-10808.5 4951.15,-10801.5"/>
<text text-anchor="middle" x="48842.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="48842.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU15→GPU4</text>
<text text-anchor="middle" x="48842.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="48842.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_15&#45;&gt;expert_1_5_0 -->
<g id="edge3465" class="edge">
<title>gate_1_15&#45;&gt;expert_1_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11279,-11039.19C11279,-11057.66 11279,-11076 11279,-11076 11279,-11076 5862.5,-11076 5862.5,-11076 5862.5,-11076 5862.5,-10796 5862.5,-10796 5862.5,-10796 5538.15,-10796 5538.15,-10796"/>
<polygon fill="blue" stroke="blue" points="5538.15,-10792.5 5528.15,-10796 5538.15,-10799.5 5538.15,-10792.5"/>
<text text-anchor="middle" x="49016.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49016.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU15→GPU5</text>
<text text-anchor="middle" x="49016.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49016.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_15&#45;&gt;expert_1_6_0 -->
<g id="edge3466" class="edge">
<title>gate_1_15&#45;&gt;expert_1_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11243.83,-11037.04C11243.83,-11050.21 11243.83,-11062 11243.83,-11062 11243.83,-11062 5887.8,-11062 5887.8,-11062 5887.8,-11062 5887.8,-10842.47 5887.8,-10842.47"/>
<polygon fill="blue" stroke="blue" points="5891.3,-10842.47 5887.8,-10832.47 5884.3,-10842.47 5891.3,-10842.47"/>
<text text-anchor="middle" x="49190.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49190.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU15→GPU6</text>
<text text-anchor="middle" x="49190.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49190.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_15&#45;&gt;expert_1_7_0 -->
<g id="edge3467" class="edge">
<title>gate_1_15&#45;&gt;expert_1_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11208.67,-11029.62C11208.67,-11039.41 11208.67,-11048 11208.67,-11048 11208.67,-11048 6691.88,-11048 6691.88,-11048 6691.88,-11048 6691.88,-10842.38 6691.88,-10842.38"/>
<polygon fill="blue" stroke="blue" points="6695.38,-10842.38 6691.88,-10832.38 6688.38,-10842.38 6695.38,-10842.38"/>
<text text-anchor="middle" x="49364.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49364.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU15→GPU7</text>
<text text-anchor="middle" x="49364.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49364.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_15&#45;&gt;expert_1_8_0 -->
<g id="edge3468" class="edge">
<title>gate_1_15&#45;&gt;expert_1_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11273.45,-10963.76C11273.45,-10923.66 11273.45,-10866 11273.45,-10866 11273.45,-10866 7211.28,-10866 7211.28,-10866 7211.28,-10866 7211.28,-10842.21 7211.28,-10842.21"/>
<polygon fill="blue" stroke="blue" points="7214.78,-10842.21 7211.28,-10832.21 7207.78,-10842.21 7214.78,-10842.21"/>
<text text-anchor="middle" x="49538.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49538.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU15→GPU8</text>
<text text-anchor="middle" x="49538.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49538.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_15&#45;&gt;expert_1_9_0 -->
<g id="edge3469" class="edge">
<title>gate_1_15&#45;&gt;expert_1_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11295.66,-10964.36C11295.66,-10915.56 11295.66,-10836 11295.66,-10836 11295.66,-10836 7804.95,-10836 7804.95,-10836 7804.95,-10836 7804.95,-10835.6 7804.95,-10835.6"/>
<polygon fill="blue" stroke="blue" points="7808.45,-10842.01 7804.95,-10832.01 7801.45,-10842.01 7808.45,-10842.01"/>
<text text-anchor="middle" x="49712.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49712.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU15→GPU9</text>
<text text-anchor="middle" x="49712.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49712.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_15&#45;&gt;expert_1_10_0 -->
<g id="edge3470" class="edge">
<title>gate_1_15&#45;&gt;expert_1_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11317.87,-10966.6C11317.87,-10917.77 11317.87,-10835 11317.87,-10835 11317.87,-10835 8399.26,-10835 8399.26,-10835 8399.26,-10835 8399.26,-10834.73 8399.26,-10834.73"/>
<polygon fill="blue" stroke="blue" points="8402.76,-10842.28 8399.26,-10832.28 8395.76,-10842.28 8402.76,-10842.28"/>
<text text-anchor="middle" x="49886.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49886.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU15→GPU10</text>
<text text-anchor="middle" x="49886.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49886.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_15&#45;&gt;expert_1_11_0 -->
<g id="edge3471" class="edge">
<title>gate_1_15&#45;&gt;expert_1_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11340.08,-10970.83C11340.08,-10941.6 11340.08,-10902 11340.08,-10902 11340.08,-10902 8996.31,-10902 8996.31,-10902 8996.31,-10902 8996.31,-10842.12 8996.31,-10842.12"/>
<polygon fill="blue" stroke="blue" points="8999.81,-10842.12 8996.31,-10832.12 8992.81,-10842.12 8999.81,-10842.12"/>
<text text-anchor="middle" x="50060.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="50060.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU15→GPU11</text>
<text text-anchor="middle" x="50060.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="50060.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_15&#45;&gt;expert_1_12_0 -->
<g id="edge3472" class="edge">
<title>gate_1_15&#45;&gt;expert_1_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11351.18,-10973.89C11351.18,-10962.1 11351.18,-10951 11351.18,-10951 11351.18,-10951 9595.98,-10951 9595.98,-10951 9595.98,-10951 9595.98,-10842.19 9595.98,-10842.19"/>
<polygon fill="blue" stroke="blue" points="9599.48,-10842.19 9595.98,-10832.19 9592.48,-10842.19 9599.48,-10842.19"/>
<text text-anchor="middle" x="50234.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="50234.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU15→GPU12</text>
<text text-anchor="middle" x="50234.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="50234.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_15&#45;&gt;expert_1_13_0 -->
<g id="edge3473" class="edge">
<title>gate_1_15&#45;&gt;expert_1_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11362.29,-10978.29C11362.29,-10931.87 11362.29,-10832 11362.29,-10832 11362.29,-10832 10219.5,-10832 10219.5,-10832 10219.5,-10832 10219.5,-10831.99 10219.5,-10831.99"/>
<polygon fill="blue" stroke="blue" points="10223.01,-10841.92 10219.5,-10831.92 10216.01,-10841.93 10223.01,-10841.92"/>
<text text-anchor="middle" x="50408.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="50408.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU15→GPU13</text>
<text text-anchor="middle" x="50408.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="50408.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_15&#45;&gt;expert_1_14_0 -->
<g id="edge3474" class="edge">
<title>gate_1_15&#45;&gt;expert_1_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11179.37,-11014C11040.75,-11014 10806.5,-11014 10806.5,-11014 10806.5,-11014 10806.5,-10842.33 10806.5,-10842.33"/>
<polygon fill="blue" stroke="blue" points="10810,-10842.33 10806.5,-10832.33 10803,-10842.33 10810,-10842.33"/>
<text text-anchor="middle" x="50582.5" y="-10916.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="50582.5" y="-10901.8" font-family="Times,serif" font-size="14.00">GPU15→GPU14</text>
<text text-anchor="middle" x="50582.5" y="-10886.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="50582.5" y="-10871.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_1_15&#45;&gt;expert_1_15_0 -->
<g id="edge1501" class="edge">
<title>gate_1_15&#45;&gt;expert_1_15_0</title>
<path fill="none" stroke="black" d="M11373.39,-10984.45C11373.39,-10984.45 11373.39,-10842.2 11373.39,-10842.2"/>
<polygon fill="black" stroke="black" points="11376.89,-10842.2 11373.39,-10832.2 11369.89,-10842.2 11376.89,-10842.2"/>
</g>
<!-- expert_reduce_1_15 -->
<g id="node1518" class="node">
<title>expert_reduce_1_15</title>
<ellipse fill="none" stroke="black" cx="11279" cy="-10668.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="11279" y="-10679.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="11279" y="-10664.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="11279" y="-10649.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_1_15_0&#45;&gt;expert_reduce_1_15 -->
<g id="edge1502" class="edge">
<title>expert_1_15_0&#45;&gt;expert_reduce_1_15</title>
<path fill="none" stroke="black" d="M11279,-10778.76C11279,-10778.76 11279,-10716.06 11279,-10716.06"/>
<polygon fill="black" stroke="black" points="11282.5,-10716.06 11279,-10706.06 11275.5,-10716.06 11282.5,-10716.06"/>
</g>
<!-- moe_residual_1_15 -->
<g id="node1519" class="node">
<title>moe_residual_1_15</title>
<ellipse fill="none" stroke="black" cx="11279" cy="-10531" rx="105.5" ry="27"/>
<text text-anchor="middle" x="11279" y="-10534.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="11279" y="-10519.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_1_15&#45;&gt;moe_residual_1_15 -->
<g id="edge1503" class="edge">
<title>expert_reduce_1_15&#45;&gt;moe_residual_1_15</title>
<path fill="none" stroke="black" d="M11279,-10630.93C11279,-10630.93 11279,-10568.06 11279,-10568.06"/>
<polygon fill="black" stroke="black" points="11282.5,-10568.06 11279,-10558.06 11275.5,-10568.06 11282.5,-10568.06"/>
</g>
<!-- qkv_proj_2_15 -->
<g id="node1520" class="node">
<title>qkv_proj_2_15</title>
<polygon fill="none" stroke="black" points="11361.5,-10431 11196.5,-10431 11196.5,-10378 11361.5,-10378 11361.5,-10431"/>
<text text-anchor="middle" x="11279" y="-10415.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="11279" y="-10400.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="11279" y="-10385.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_1_15&#45;&gt;qkv_proj_2_15 -->
<g id="edge1504" class="edge">
<title>moe_residual_1_15&#45;&gt;qkv_proj_2_15</title>
<path fill="none" stroke="black" d="M11279,-10503.86C11279,-10503.86 11279,-10441.16 11279,-10441.16"/>
<polygon fill="black" stroke="black" points="11282.5,-10441.16 11279,-10431.16 11275.5,-10441.16 11282.5,-10441.16"/>
</g>
<!-- qkv_reshape_2_15 -->
<g id="node1521" class="node">
<title>qkv_reshape_2_15</title>
<ellipse fill="none" stroke="black" cx="11279" cy="-10278" rx="148" ry="27"/>
<text text-anchor="middle" x="11279" y="-10281.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="11279" y="-10266.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_2_15&#45;&gt;qkv_reshape_2_15 -->
<g id="edge1505" class="edge">
<title>qkv_proj_2_15&#45;&gt;qkv_reshape_2_15</title>
<path fill="none" stroke="black" d="M11279,-10377.98C11279,-10377.98 11279,-10315.36 11279,-10315.36"/>
<polygon fill="black" stroke="black" points="11282.5,-10315.36 11279,-10305.36 11275.5,-10315.36 11282.5,-10315.36"/>
</g>
<!-- qkv_reshape_2_15&#45;&gt;ring_attn_2_15_stage_0 -->
<g id="edge1506" class="edge">
<title>qkv_reshape_2_15&#45;&gt;ring_attn_2_15_stage_0</title>
<path fill="none" stroke="black" d="M11279,-10250.72C11279,-10250.72 11279,-10144.16 11279,-10144.16"/>
<polygon fill="black" stroke="black" points="11282.5,-10144.16 11279,-10134.16 11275.5,-10144.16 11282.5,-10144.16"/>
</g>
<!-- ring_attn_2_15_stage_0&#45;&gt;ring_attn_2_0_stage_0 -->
<g id="edge3475" class="edge">
<title>ring_attn_2_15_stage_0&#45;&gt;ring_attn_2_0_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11090.33,-10072.77C11090.33,-10098.95 11090.33,-10192 11090.33,-10192 11090.33,-10192 393.33,-10192 393.33,-10192 393.33,-10192 393.33,-10089.48 393.33,-10089.48"/>
<polygon fill="red" stroke="red" points="396.83,-10089.48 393.33,-10079.48 389.83,-10089.48 396.83,-10089.48"/>
<text text-anchor="middle" x="6877" y="-10203.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-10188.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-10173.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_2_15_stage_0&#45;&gt;ring_attn_2_15_stage_1 -->
<g id="edge1507" class="edge">
<title>ring_attn_2_15_stage_0&#45;&gt;ring_attn_2_15_stage_1</title>
<path fill="none" stroke="black" d="M11348.67,-10020.48C11348.67,-10020.48 11348.67,-9868.58 11348.67,-9868.58"/>
<polygon fill="black" stroke="black" points="11352.17,-9868.58 11348.67,-9858.58 11345.17,-9868.58 11352.17,-9868.58"/>
</g>
<!-- ring_attn_2_15_stage_1&#45;&gt;ring_attn_2_0_stage_1 -->
<g id="edge3476" class="edge">
<title>ring_attn_2_15_stage_1&#45;&gt;ring_attn_2_0_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-9858.49C11209.33,-9894.58 11209.33,-9939 11209.33,-9939 11209.33,-9939 294.67,-9939 294.67,-9939 294.67,-9939 294.67,-9868.49 294.67,-9868.49"/>
<polygon fill="red" stroke="red" points="298.17,-9868.49 294.67,-9858.49 291.17,-9868.49 298.17,-9868.49"/>
<text text-anchor="middle" x="6877" y="-9950.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-9935.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-9920.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_2_15_stage_1&#45;&gt;ring_attn_2_15_stage_2 -->
<g id="edge1508" class="edge">
<title>ring_attn_2_15_stage_1&#45;&gt;ring_attn_2_15_stage_2</title>
<path fill="none" stroke="black" d="M11348.67,-9767.48C11348.67,-9767.48 11348.67,-9615.58 11348.67,-9615.58"/>
<polygon fill="black" stroke="black" points="11352.17,-9615.58 11348.67,-9605.58 11345.17,-9615.58 11352.17,-9615.58"/>
</g>
<!-- ring_attn_2_15_stage_2&#45;&gt;ring_attn_2_0_stage_2 -->
<g id="edge3477" class="edge">
<title>ring_attn_2_15_stage_2&#45;&gt;ring_attn_2_0_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-9605.49C11209.33,-9641.58 11209.33,-9686 11209.33,-9686 11209.33,-9686 294.67,-9686 294.67,-9686 294.67,-9686 294.67,-9615.49 294.67,-9615.49"/>
<polygon fill="red" stroke="red" points="298.17,-9615.49 294.67,-9605.49 291.17,-9615.49 298.17,-9615.49"/>
<text text-anchor="middle" x="6877" y="-9697.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-9682.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-9667.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_2_15_stage_2&#45;&gt;ring_attn_2_15_stage_3 -->
<g id="edge1509" class="edge">
<title>ring_attn_2_15_stage_2&#45;&gt;ring_attn_2_15_stage_3</title>
<path fill="none" stroke="black" d="M11348.67,-9514.48C11348.67,-9514.48 11348.67,-9362.58 11348.67,-9362.58"/>
<polygon fill="black" stroke="black" points="11352.17,-9362.58 11348.67,-9352.58 11345.17,-9362.58 11352.17,-9362.58"/>
</g>
<!-- ring_attn_2_15_stage_3&#45;&gt;ring_attn_2_0_stage_3 -->
<g id="edge3478" class="edge">
<title>ring_attn_2_15_stage_3&#45;&gt;ring_attn_2_0_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-9352.49C11209.33,-9388.58 11209.33,-9433 11209.33,-9433 11209.33,-9433 294.67,-9433 294.67,-9433 294.67,-9433 294.67,-9362.49 294.67,-9362.49"/>
<polygon fill="red" stroke="red" points="298.17,-9362.49 294.67,-9352.49 291.17,-9362.49 298.17,-9362.49"/>
<text text-anchor="middle" x="6877" y="-9444.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-9429.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-9414.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_2_15_stage_3&#45;&gt;ring_attn_2_15_stage_4 -->
<g id="edge1510" class="edge">
<title>ring_attn_2_15_stage_3&#45;&gt;ring_attn_2_15_stage_4</title>
<path fill="none" stroke="black" d="M11279,-9238.87C11279,-9238.87 11279,-9132.25 11279,-9132.25"/>
<polygon fill="black" stroke="black" points="11282.5,-9132.25 11279,-9122.25 11275.5,-9132.25 11282.5,-9132.25"/>
</g>
<!-- ring_attn_2_15_stage_4&#45;&gt;ring_attn_2_0_stage_4 -->
<g id="edge3479" class="edge">
<title>ring_attn_2_15_stage_4&#45;&gt;ring_attn_2_0_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-9008.51C11209.33,-8972.07 11209.33,-8927 11209.33,-8927 11209.33,-8927 294.67,-8927 294.67,-8927 294.67,-8927 294.67,-8998.51 294.67,-8998.51"/>
<polygon fill="red" stroke="red" points="291.17,-8998.51 294.67,-9008.51 298.17,-8998.51 291.17,-8998.51"/>
<text text-anchor="middle" x="6877" y="-9191.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-9176.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-9161.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_2_15_stage_4&#45;&gt;ring_attn_2_15_stage_5 -->
<g id="edge1511" class="edge">
<title>ring_attn_2_15_stage_4&#45;&gt;ring_attn_2_15_stage_5</title>
<path fill="none" stroke="black" d="M11348.67,-9008.48C11348.67,-9008.48 11348.67,-8856.58 11348.67,-8856.58"/>
<polygon fill="black" stroke="black" points="11352.17,-8856.58 11348.67,-8846.58 11345.17,-8856.58 11352.17,-8856.58"/>
</g>
<!-- ring_attn_2_15_stage_5&#45;&gt;ring_attn_2_0_stage_5 -->
<g id="edge3480" class="edge">
<title>ring_attn_2_15_stage_5&#45;&gt;ring_attn_2_0_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-8755.51C11209.33,-8719.07 11209.33,-8674 11209.33,-8674 11209.33,-8674 294.67,-8674 294.67,-8674 294.67,-8674 294.67,-8745.51 294.67,-8745.51"/>
<polygon fill="red" stroke="red" points="291.17,-8745.51 294.67,-8755.51 298.17,-8745.51 291.17,-8745.51"/>
<text text-anchor="middle" x="6877" y="-8938.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-8923.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-8908.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_2_15_stage_5&#45;&gt;ring_attn_2_15_stage_6 -->
<g id="edge1512" class="edge">
<title>ring_attn_2_15_stage_5&#45;&gt;ring_attn_2_15_stage_6</title>
<path fill="none" stroke="black" d="M11348.67,-8755.48C11348.67,-8755.48 11348.67,-8603.58 11348.67,-8603.58"/>
<polygon fill="black" stroke="black" points="11352.17,-8603.58 11348.67,-8593.58 11345.17,-8603.58 11352.17,-8603.58"/>
</g>
<!-- ring_attn_2_15_stage_6&#45;&gt;ring_attn_2_0_stage_6 -->
<g id="edge3481" class="edge">
<title>ring_attn_2_15_stage_6&#45;&gt;ring_attn_2_0_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11174.5,-8513.85C11174.5,-8482.54 11174.5,-8441 11174.5,-8441 11174.5,-8441 329.5,-8441 329.5,-8441 329.5,-8441 329.5,-8503.85 329.5,-8503.85"/>
<polygon fill="red" stroke="red" points="326,-8503.85 329.5,-8513.85 333,-8503.85 326,-8503.85"/>
<text text-anchor="middle" x="6877" y="-8685.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-8670.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-8655.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_2_15_stage_6&#45;&gt;ring_attn_2_15_stage_7 -->
<g id="edge1513" class="edge">
<title>ring_attn_2_15_stage_6&#45;&gt;ring_attn_2_15_stage_7</title>
<path fill="none" stroke="black" d="M11383.5,-8513.88C11383.5,-8513.88 11383.5,-8339.39 11383.5,-8339.39"/>
<polygon fill="black" stroke="black" points="11387,-8339.39 11383.5,-8329.39 11380,-8339.39 11387,-8339.39"/>
</g>
<!-- ring_attn_2_15_stage_7&#45;&gt;ring_attn_2_0_stage_7 -->
<g id="edge3482" class="edge">
<title>ring_attn_2_15_stage_7&#45;&gt;ring_attn_2_0_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11279,-8363.07C11279,-8384.17 11279,-8402 11279,-8402 11279,-8402 225,-8402 225,-8402 225,-8402 225,-8373.07 225,-8373.07"/>
<polygon fill="red" stroke="red" points="228.5,-8373.07 225,-8363.07 221.5,-8373.07 228.5,-8373.07"/>
<text text-anchor="middle" x="6877" y="-8432.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-8417.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-8402.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_2_15_stage_7&#45;&gt;ring_attn_2_15_stage_8 -->
<g id="edge1514" class="edge">
<title>ring_attn_2_15_stage_7&#45;&gt;ring_attn_2_15_stage_8</title>
<path fill="none" stroke="black" d="M11348.67,-8249.48C11348.67,-8249.48 11348.67,-8097.58 11348.67,-8097.58"/>
<polygon fill="black" stroke="black" points="11352.17,-8097.58 11348.67,-8087.58 11345.17,-8097.58 11352.17,-8097.58"/>
</g>
<!-- ring_attn_2_15_stage_8&#45;&gt;ring_attn_2_0_stage_8 -->
<g id="edge3483" class="edge">
<title>ring_attn_2_15_stage_8&#45;&gt;ring_attn_2_0_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-8087.49C11209.33,-8123.58 11209.33,-8168 11209.33,-8168 11209.33,-8168 294.67,-8168 294.67,-8168 294.67,-8168 294.67,-8097.49 294.67,-8097.49"/>
<polygon fill="red" stroke="red" points="298.17,-8097.49 294.67,-8087.49 291.17,-8097.49 298.17,-8097.49"/>
<text text-anchor="middle" x="6877" y="-8179.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-8164.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-8149.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_2_15_stage_8&#45;&gt;ring_attn_2_15_stage_9 -->
<g id="edge1515" class="edge">
<title>ring_attn_2_15_stage_8&#45;&gt;ring_attn_2_15_stage_9</title>
<path fill="none" stroke="black" d="M11279,-7973.87C11279,-7973.87 11279,-7867.25 11279,-7867.25"/>
<polygon fill="black" stroke="black" points="11282.5,-7867.25 11279,-7857.25 11275.5,-7867.25 11282.5,-7867.25"/>
</g>
<!-- ring_attn_2_15_stage_9&#45;&gt;ring_attn_2_0_stage_9 -->
<g id="edge3484" class="edge">
<title>ring_attn_2_15_stage_9&#45;&gt;ring_attn_2_0_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11174.5,-7754.85C11174.5,-7723.54 11174.5,-7682 11174.5,-7682 11174.5,-7682 329.5,-7682 329.5,-7682 329.5,-7682 329.5,-7744.85 329.5,-7744.85"/>
<polygon fill="red" stroke="red" points="326,-7744.85 329.5,-7754.85 333,-7744.85 326,-7744.85"/>
<text text-anchor="middle" x="6877" y="-7926.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-7911.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-7896.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_2_15_stage_9&#45;&gt;ring_attn_2_15_stage_10 -->
<g id="edge1516" class="edge">
<title>ring_attn_2_15_stage_9&#45;&gt;ring_attn_2_15_stage_10</title>
<path fill="none" stroke="black" d="M11383.5,-7754.88C11383.5,-7754.88 11383.5,-7580.39 11383.5,-7580.39"/>
<polygon fill="black" stroke="black" points="11387,-7580.39 11383.5,-7570.39 11380,-7580.39 11387,-7580.39"/>
</g>
<!-- ring_attn_2_15_stage_10&#45;&gt;ring_attn_2_0_stage_10 -->
<g id="edge3485" class="edge">
<title>ring_attn_2_15_stage_10&#45;&gt;ring_attn_2_0_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11279,-7604.07C11279,-7625.17 11279,-7643 11279,-7643 11279,-7643 225,-7643 225,-7643 225,-7643 225,-7614.07 225,-7614.07"/>
<polygon fill="red" stroke="red" points="228.5,-7614.07 225,-7604.07 221.5,-7614.07 228.5,-7614.07"/>
<text text-anchor="middle" x="6877" y="-7673.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-7658.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-7643.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_2_15_stage_10&#45;&gt;ring_attn_2_15_stage_11 -->
<g id="edge1517" class="edge">
<title>ring_attn_2_15_stage_10&#45;&gt;ring_attn_2_15_stage_11</title>
<path fill="none" stroke="black" d="M11348.67,-7490.48C11348.67,-7490.48 11348.67,-7338.58 11348.67,-7338.58"/>
<polygon fill="black" stroke="black" points="11352.17,-7338.58 11348.67,-7328.58 11345.17,-7338.58 11352.17,-7338.58"/>
</g>
<!-- ring_attn_2_15_stage_11&#45;&gt;ring_attn_2_0_stage_11 -->
<g id="edge3486" class="edge">
<title>ring_attn_2_15_stage_11&#45;&gt;ring_attn_2_0_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-7328.49C11209.33,-7364.58 11209.33,-7409 11209.33,-7409 11209.33,-7409 294.67,-7409 294.67,-7409 294.67,-7409 294.67,-7338.49 294.67,-7338.49"/>
<polygon fill="red" stroke="red" points="298.17,-7338.49 294.67,-7328.49 291.17,-7338.49 298.17,-7338.49"/>
<text text-anchor="middle" x="6877" y="-7420.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-7405.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-7390.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_2_15_stage_11&#45;&gt;ring_attn_2_15_stage_12 -->
<g id="edge1518" class="edge">
<title>ring_attn_2_15_stage_11&#45;&gt;ring_attn_2_15_stage_12</title>
<path fill="none" stroke="black" d="M11348.67,-7237.48C11348.67,-7237.48 11348.67,-7085.58 11348.67,-7085.58"/>
<polygon fill="black" stroke="black" points="11352.17,-7085.58 11348.67,-7075.58 11345.17,-7085.58 11352.17,-7085.58"/>
</g>
<!-- ring_attn_2_15_stage_12&#45;&gt;ring_attn_2_0_stage_12 -->
<g id="edge3487" class="edge">
<title>ring_attn_2_15_stage_12&#45;&gt;ring_attn_2_0_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-7075.49C11209.33,-7111.58 11209.33,-7156 11209.33,-7156 11209.33,-7156 294.67,-7156 294.67,-7156 294.67,-7156 294.67,-7085.49 294.67,-7085.49"/>
<polygon fill="red" stroke="red" points="298.17,-7085.49 294.67,-7075.49 291.17,-7085.49 298.17,-7085.49"/>
<text text-anchor="middle" x="6877" y="-7167.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-7152.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-7137.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_2_15_stage_12&#45;&gt;ring_attn_2_15_stage_13 -->
<g id="edge1519" class="edge">
<title>ring_attn_2_15_stage_12&#45;&gt;ring_attn_2_15_stage_13</title>
<path fill="none" stroke="black" d="M11348.67,-6984.48C11348.67,-6984.48 11348.67,-6832.58 11348.67,-6832.58"/>
<polygon fill="black" stroke="black" points="11352.17,-6832.58 11348.67,-6822.58 11345.17,-6832.58 11352.17,-6832.58"/>
</g>
<!-- ring_attn_2_15_stage_13&#45;&gt;ring_attn_2_0_stage_13 -->
<g id="edge3488" class="edge">
<title>ring_attn_2_15_stage_13&#45;&gt;ring_attn_2_0_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-6822.49C11209.33,-6858.58 11209.33,-6903 11209.33,-6903 11209.33,-6903 294.67,-6903 294.67,-6903 294.67,-6903 294.67,-6832.49 294.67,-6832.49"/>
<polygon fill="red" stroke="red" points="298.17,-6832.49 294.67,-6822.49 291.17,-6832.49 298.17,-6832.49"/>
<text text-anchor="middle" x="6877" y="-6914.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-6899.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-6884.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_2_15_stage_13&#45;&gt;ring_attn_2_15_stage_14 -->
<g id="edge1520" class="edge">
<title>ring_attn_2_15_stage_13&#45;&gt;ring_attn_2_15_stage_14</title>
<path fill="none" stroke="black" d="M11279,-6708.87C11279,-6708.87 11279,-6602.25 11279,-6602.25"/>
<polygon fill="black" stroke="black" points="11282.5,-6602.25 11279,-6592.25 11275.5,-6602.25 11282.5,-6602.25"/>
</g>
<!-- ring_attn_2_15_stage_14&#45;&gt;ring_attn_2_0_stage_14 -->
<g id="edge3489" class="edge">
<title>ring_attn_2_15_stage_14&#45;&gt;ring_attn_2_0_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-6478.51C11209.33,-6442.07 11209.33,-6397 11209.33,-6397 11209.33,-6397 294.67,-6397 294.67,-6397 294.67,-6397 294.67,-6468.51 294.67,-6468.51"/>
<polygon fill="red" stroke="red" points="291.17,-6468.51 294.67,-6478.51 298.17,-6468.51 291.17,-6468.51"/>
<text text-anchor="middle" x="6877" y="-6661.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-6646.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-6631.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_2_15_stage_14&#45;&gt;ring_attn_2_15_stage_15 -->
<g id="edge1521" class="edge">
<title>ring_attn_2_15_stage_14&#45;&gt;ring_attn_2_15_stage_15</title>
<path fill="none" stroke="black" d="M11348.67,-6478.48C11348.67,-6478.48 11348.67,-6326.58 11348.67,-6326.58"/>
<polygon fill="black" stroke="black" points="11352.17,-6326.58 11348.67,-6316.58 11345.17,-6326.58 11352.17,-6326.58"/>
</g>
<!-- ring_attn_2_15_stage_15&#45;&gt;ring_attn_2_0_stage_15 -->
<g id="edge3490" class="edge">
<title>ring_attn_2_15_stage_15&#45;&gt;ring_attn_2_0_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11110.67,-6257.7C11110.67,-6229.45 11110.67,-6166 11110.67,-6166 11110.67,-6166 413.67,-6166 413.67,-6166 413.67,-6166 413.67,-6254.11 413.67,-6254.11"/>
<polygon fill="red" stroke="red" points="410.17,-6254.11 413.67,-6264.11 417.17,-6254.11 410.17,-6254.11"/>
<text text-anchor="middle" x="6877" y="-6408.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-6393.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-6378.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_2_15 -->
<g id="node1538" class="node">
<title>attn_out_2_15</title>
<polygon fill="none" stroke="black" points="11348.5,-6130 11209.5,-6130 11209.5,-6077 11348.5,-6077 11348.5,-6130"/>
<text text-anchor="middle" x="11279" y="-6114.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="11279" y="-6099.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="11279" y="-6084.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_2_15_stage_15&#45;&gt;attn_out_2_15 -->
<g id="edge1522" class="edge">
<title>ring_attn_2_15_stage_15&#45;&gt;attn_out_2_15</title>
<path fill="none" stroke="black" d="M11279,-6202.87C11279,-6202.87 11279,-6140.18 11279,-6140.18"/>
<polygon fill="black" stroke="black" points="11282.5,-6140.18 11279,-6130.18 11275.5,-6140.18 11282.5,-6140.18"/>
</g>
<!-- attn_residual_2_15 -->
<g id="node1539" class="node">
<title>attn_residual_2_15</title>
<ellipse fill="none" stroke="black" cx="11279" cy="-5977" rx="105.5" ry="27"/>
<text text-anchor="middle" x="11279" y="-5980.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="11279" y="-5965.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_2_15&#45;&gt;attn_residual_2_15 -->
<g id="edge1523" class="edge">
<title>attn_out_2_15&#45;&gt;attn_residual_2_15</title>
<path fill="none" stroke="black" d="M11279,-6076.98C11279,-6076.98 11279,-6014.36 11279,-6014.36"/>
<polygon fill="black" stroke="black" points="11282.5,-6014.36 11279,-6004.36 11275.5,-6014.36 11282.5,-6014.36"/>
</g>
<!-- gate_2_15 -->
<g id="node1540" class="node">
<title>gate_2_15</title>
<ellipse fill="orange" stroke="black" cx="11279" cy="-5839.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="11279" y="-5850.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="11279" y="-5835.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="11279" y="-5820.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_2_15&#45;&gt;gate_2_15 -->
<g id="edge1524" class="edge">
<title>attn_residual_2_15&#45;&gt;gate_2_15</title>
<path fill="none" stroke="black" d="M11349.33,-5956.71C11349.33,-5956.71 11349.33,-5877.5 11349.33,-5877.5"/>
<polygon fill="black" stroke="black" points="11352.83,-5877.5 11349.33,-5867.5 11345.83,-5877.5 11352.83,-5877.5"/>
</g>
<!-- gate_2_15&#45;&gt;expert_2_0_0 -->
<g id="edge3491" class="edge">
<title>gate_2_15&#45;&gt;expert_2_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11184.61,-5822.56C11184.61,-5782.26 11184.61,-5684 11184.61,-5684 11184.61,-5684 203.9,-5684 203.9,-5684 203.9,-5684 203.9,-5680.29 203.9,-5680.29"/>
<polygon fill="blue" stroke="blue" points="207.4,-5680.29 203.9,-5670.29 200.4,-5680.29 207.4,-5680.29"/>
<text text-anchor="middle" x="48146.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="48146.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="48146.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="48146.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_15&#45;&gt;expert_2_1_0 -->
<g id="edge3492" class="edge">
<title>gate_2_15&#45;&gt;expert_2_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11206.82,-5812.08C11206.82,-5766.48 11206.82,-5680 11206.82,-5680 11206.82,-5680 3041.82,-5680 3041.82,-5680 3041.82,-5680 3041.82,-5679 3041.82,-5679"/>
<polygon fill="blue" stroke="blue" points="3045.32,-5680.03 3041.82,-5670.03 3038.32,-5680.03 3045.32,-5680.03"/>
<text text-anchor="middle" x="48320.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="48320.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU15→GPU1</text>
<text text-anchor="middle" x="48320.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="48320.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_15&#45;&gt;expert_2_2_0 -->
<g id="edge3493" class="edge">
<title>gate_2_15&#45;&gt;expert_2_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11229.03,-5806.24C11229.03,-5759.23 11229.03,-5679 11229.03,-5679 11229.03,-5679 3651.91,-5679 3651.91,-5679 3651.91,-5679 3651.91,-5678.1 3651.91,-5678.1"/>
<polygon fill="blue" stroke="blue" points="3655.41,-5680.04 3651.91,-5670.04 3648.41,-5680.04 3655.41,-5680.04"/>
<text text-anchor="middle" x="48494.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="48494.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU15→GPU2</text>
<text text-anchor="middle" x="48494.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="48494.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_15&#45;&gt;expert_2_3_0 -->
<g id="edge3494" class="edge">
<title>gate_2_15&#45;&gt;expert_2_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11251.24,-5803.26C11251.24,-5755.64 11251.24,-5678 11251.24,-5678 11251.24,-5678 4511.6,-5678 4511.6,-5678 4511.6,-5678 4511.6,-5643 4511.6,-5643 4511.6,-5643 4364.31,-5643 4364.31,-5643"/>
<polygon fill="blue" stroke="blue" points="4364.31,-5639.5 4354.31,-5643 4364.31,-5646.5 4364.31,-5639.5"/>
<text text-anchor="middle" x="48668.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="48668.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU15→GPU3</text>
<text text-anchor="middle" x="48668.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="48668.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_15&#45;&gt;expert_2_4_0 -->
<g id="edge3495" class="edge">
<title>gate_2_15&#45;&gt;expert_2_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11314.17,-5875.01C11314.17,-5896.97 11314.17,-5921 11314.17,-5921 11314.17,-5921 5275.5,-5921 5275.5,-5921 5275.5,-5921 5275.5,-5643 5275.5,-5643 5275.5,-5643 4951.15,-5643 4951.15,-5643"/>
<polygon fill="blue" stroke="blue" points="4951.15,-5639.5 4941.15,-5643 4951.15,-5646.5 4951.15,-5639.5"/>
<text text-anchor="middle" x="48842.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="48842.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU15→GPU4</text>
<text text-anchor="middle" x="48842.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="48842.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_15&#45;&gt;expert_2_5_0 -->
<g id="edge3496" class="edge">
<title>gate_2_15&#45;&gt;expert_2_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11279,-5877.19C11279,-5895.66 11279,-5914 11279,-5914 11279,-5914 5862.5,-5914 5862.5,-5914 5862.5,-5914 5862.5,-5634 5862.5,-5634 5862.5,-5634 5538.15,-5634 5538.15,-5634"/>
<polygon fill="blue" stroke="blue" points="5538.15,-5630.5 5528.15,-5634 5538.15,-5637.5 5538.15,-5630.5"/>
<text text-anchor="middle" x="49016.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49016.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU15→GPU5</text>
<text text-anchor="middle" x="49016.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49016.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_15&#45;&gt;expert_2_6_0 -->
<g id="edge3497" class="edge">
<title>gate_2_15&#45;&gt;expert_2_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11243.83,-5875.04C11243.83,-5888.21 11243.83,-5900 11243.83,-5900 11243.83,-5900 5887.8,-5900 5887.8,-5900 5887.8,-5900 5887.8,-5680.47 5887.8,-5680.47"/>
<polygon fill="blue" stroke="blue" points="5891.3,-5680.47 5887.8,-5670.47 5884.3,-5680.47 5891.3,-5680.47"/>
<text text-anchor="middle" x="49190.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49190.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU15→GPU6</text>
<text text-anchor="middle" x="49190.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49190.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_15&#45;&gt;expert_2_7_0 -->
<g id="edge3498" class="edge">
<title>gate_2_15&#45;&gt;expert_2_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11208.67,-5867.62C11208.67,-5877.41 11208.67,-5886 11208.67,-5886 11208.67,-5886 6691.88,-5886 6691.88,-5886 6691.88,-5886 6691.88,-5680.38 6691.88,-5680.38"/>
<polygon fill="blue" stroke="blue" points="6695.38,-5680.38 6691.88,-5670.38 6688.38,-5680.38 6695.38,-5680.38"/>
<text text-anchor="middle" x="49364.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49364.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU15→GPU7</text>
<text text-anchor="middle" x="49364.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49364.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_15&#45;&gt;expert_2_8_0 -->
<g id="edge3499" class="edge">
<title>gate_2_15&#45;&gt;expert_2_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11273.45,-5801.76C11273.45,-5761.66 11273.45,-5704 11273.45,-5704 11273.45,-5704 7211.28,-5704 7211.28,-5704 7211.28,-5704 7211.28,-5680.21 7211.28,-5680.21"/>
<polygon fill="blue" stroke="blue" points="7214.78,-5680.21 7211.28,-5670.21 7207.78,-5680.21 7214.78,-5680.21"/>
<text text-anchor="middle" x="49538.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49538.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU15→GPU8</text>
<text text-anchor="middle" x="49538.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49538.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_15&#45;&gt;expert_2_9_0 -->
<g id="edge3500" class="edge">
<title>gate_2_15&#45;&gt;expert_2_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11295.66,-5802.36C11295.66,-5753.56 11295.66,-5674 11295.66,-5674 11295.66,-5674 7804.95,-5674 7804.95,-5674 7804.95,-5674 7804.95,-5673.6 7804.95,-5673.6"/>
<polygon fill="blue" stroke="blue" points="7808.45,-5680.01 7804.95,-5670.01 7801.45,-5680.01 7808.45,-5680.01"/>
<text text-anchor="middle" x="49712.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49712.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU15→GPU9</text>
<text text-anchor="middle" x="49712.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49712.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_15&#45;&gt;expert_2_10_0 -->
<g id="edge3501" class="edge">
<title>gate_2_15&#45;&gt;expert_2_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11317.87,-5804.6C11317.87,-5755.77 11317.87,-5673 11317.87,-5673 11317.87,-5673 8399.26,-5673 8399.26,-5673 8399.26,-5673 8399.26,-5672.73 8399.26,-5672.73"/>
<polygon fill="blue" stroke="blue" points="8402.76,-5680.28 8399.26,-5670.28 8395.76,-5680.28 8402.76,-5680.28"/>
<text text-anchor="middle" x="49886.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49886.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU15→GPU10</text>
<text text-anchor="middle" x="49886.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49886.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_15&#45;&gt;expert_2_11_0 -->
<g id="edge3502" class="edge">
<title>gate_2_15&#45;&gt;expert_2_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11340.08,-5808.83C11340.08,-5779.6 11340.08,-5740 11340.08,-5740 11340.08,-5740 8996.31,-5740 8996.31,-5740 8996.31,-5740 8996.31,-5680.12 8996.31,-5680.12"/>
<polygon fill="blue" stroke="blue" points="8999.81,-5680.12 8996.31,-5670.12 8992.81,-5680.12 8999.81,-5680.12"/>
<text text-anchor="middle" x="50060.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="50060.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU15→GPU11</text>
<text text-anchor="middle" x="50060.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="50060.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_15&#45;&gt;expert_2_12_0 -->
<g id="edge3503" class="edge">
<title>gate_2_15&#45;&gt;expert_2_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11351.18,-5811.89C11351.18,-5800.1 11351.18,-5789 11351.18,-5789 11351.18,-5789 9595.98,-5789 9595.98,-5789 9595.98,-5789 9595.98,-5680.19 9595.98,-5680.19"/>
<polygon fill="blue" stroke="blue" points="9599.48,-5680.19 9595.98,-5670.19 9592.48,-5680.19 9599.48,-5680.19"/>
<text text-anchor="middle" x="50234.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="50234.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU15→GPU12</text>
<text text-anchor="middle" x="50234.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="50234.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_15&#45;&gt;expert_2_13_0 -->
<g id="edge3504" class="edge">
<title>gate_2_15&#45;&gt;expert_2_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11362.29,-5816.29C11362.29,-5769.87 11362.29,-5670 11362.29,-5670 11362.29,-5670 10219.5,-5670 10219.5,-5670 10219.5,-5670 10219.5,-5669.99 10219.5,-5669.99"/>
<polygon fill="blue" stroke="blue" points="10223.01,-5679.92 10219.5,-5669.92 10216.01,-5679.93 10223.01,-5679.92"/>
<text text-anchor="middle" x="50408.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="50408.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU15→GPU13</text>
<text text-anchor="middle" x="50408.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="50408.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_15&#45;&gt;expert_2_14_0 -->
<g id="edge3505" class="edge">
<title>gate_2_15&#45;&gt;expert_2_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11179.37,-5852C11040.75,-5852 10806.5,-5852 10806.5,-5852 10806.5,-5852 10806.5,-5680.33 10806.5,-5680.33"/>
<polygon fill="blue" stroke="blue" points="10810,-5680.33 10806.5,-5670.33 10803,-5680.33 10810,-5680.33"/>
<text text-anchor="middle" x="50582.5" y="-5754.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="50582.5" y="-5739.8" font-family="Times,serif" font-size="14.00">GPU15→GPU14</text>
<text text-anchor="middle" x="50582.5" y="-5724.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="50582.5" y="-5709.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_2_15&#45;&gt;expert_2_15_0 -->
<g id="edge1525" class="edge">
<title>gate_2_15&#45;&gt;expert_2_15_0</title>
<path fill="none" stroke="black" d="M11373.39,-5822.45C11373.39,-5822.45 11373.39,-5680.2 11373.39,-5680.2"/>
<polygon fill="black" stroke="black" points="11376.89,-5680.2 11373.39,-5670.2 11369.89,-5680.2 11376.89,-5680.2"/>
</g>
<!-- expert_reduce_2_15 -->
<g id="node1542" class="node">
<title>expert_reduce_2_15</title>
<ellipse fill="none" stroke="black" cx="11279" cy="-5506.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="11279" y="-5517.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="11279" y="-5502.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="11279" y="-5487.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_2_15_0&#45;&gt;expert_reduce_2_15 -->
<g id="edge1526" class="edge">
<title>expert_2_15_0&#45;&gt;expert_reduce_2_15</title>
<path fill="none" stroke="black" d="M11279,-5616.76C11279,-5616.76 11279,-5554.06 11279,-5554.06"/>
<polygon fill="black" stroke="black" points="11282.5,-5554.06 11279,-5544.06 11275.5,-5554.06 11282.5,-5554.06"/>
</g>
<!-- moe_residual_2_15 -->
<g id="node1543" class="node">
<title>moe_residual_2_15</title>
<ellipse fill="none" stroke="black" cx="11279" cy="-5369" rx="105.5" ry="27"/>
<text text-anchor="middle" x="11279" y="-5372.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="11279" y="-5357.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_2_15&#45;&gt;moe_residual_2_15 -->
<g id="edge1527" class="edge">
<title>expert_reduce_2_15&#45;&gt;moe_residual_2_15</title>
<path fill="none" stroke="black" d="M11279,-5468.93C11279,-5468.93 11279,-5406.06 11279,-5406.06"/>
<polygon fill="black" stroke="black" points="11282.5,-5406.06 11279,-5396.06 11275.5,-5406.06 11282.5,-5406.06"/>
</g>
<!-- qkv_proj_3_15 -->
<g id="node1544" class="node">
<title>qkv_proj_3_15</title>
<polygon fill="none" stroke="black" points="11361.5,-5269 11196.5,-5269 11196.5,-5216 11361.5,-5216 11361.5,-5269"/>
<text text-anchor="middle" x="11279" y="-5253.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="11279" y="-5238.8" font-family="Times,serif" font-size="14.00">W_qkv: 4096×12288</text>
<text text-anchor="middle" x="11279" y="-5223.8" font-family="Times,serif" font-size="14.00">Split: 4096×768</text>
</g>
<!-- moe_residual_2_15&#45;&gt;qkv_proj_3_15 -->
<g id="edge1528" class="edge">
<title>moe_residual_2_15&#45;&gt;qkv_proj_3_15</title>
<path fill="none" stroke="black" d="M11279,-5341.86C11279,-5341.86 11279,-5279.16 11279,-5279.16"/>
<polygon fill="black" stroke="black" points="11282.5,-5279.16 11279,-5269.16 11275.5,-5279.16 11282.5,-5279.16"/>
</g>
<!-- qkv_reshape_3_15 -->
<g id="node1545" class="node">
<title>qkv_reshape_3_15</title>
<ellipse fill="none" stroke="black" cx="11279" cy="-5116" rx="148" ry="27"/>
<text text-anchor="middle" x="11279" y="-5119.8" font-family="Times,serif" font-size="14.00">Reshape QKV</text>
<text text-anchor="middle" x="11279" y="-5104.8" font-family="Times,serif" font-size="14.00">Q,K,V: 1024×1024×2×128</text>
</g>
<!-- qkv_proj_3_15&#45;&gt;qkv_reshape_3_15 -->
<g id="edge1529" class="edge">
<title>qkv_proj_3_15&#45;&gt;qkv_reshape_3_15</title>
<path fill="none" stroke="black" d="M11279,-5215.98C11279,-5215.98 11279,-5153.36 11279,-5153.36"/>
<polygon fill="black" stroke="black" points="11282.5,-5153.36 11279,-5143.36 11275.5,-5153.36 11282.5,-5153.36"/>
</g>
<!-- qkv_reshape_3_15&#45;&gt;ring_attn_3_15_stage_0 -->
<g id="edge1530" class="edge">
<title>qkv_reshape_3_15&#45;&gt;ring_attn_3_15_stage_0</title>
<path fill="none" stroke="black" d="M11279,-5088.72C11279,-5088.72 11279,-4982.16 11279,-4982.16"/>
<polygon fill="black" stroke="black" points="11282.5,-4982.16 11279,-4972.16 11275.5,-4982.16 11282.5,-4982.16"/>
</g>
<!-- ring_attn_3_15_stage_0&#45;&gt;ring_attn_3_0_stage_0 -->
<g id="edge3506" class="edge">
<title>ring_attn_3_15_stage_0&#45;&gt;ring_attn_3_0_stage_0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11090.33,-4910.77C11090.33,-4936.95 11090.33,-5030 11090.33,-5030 11090.33,-5030 393.33,-5030 393.33,-5030 393.33,-5030 393.33,-4927.48 393.33,-4927.48"/>
<polygon fill="red" stroke="red" points="396.83,-4927.48 393.33,-4917.48 389.83,-4927.48 396.83,-4927.48"/>
<text text-anchor="middle" x="6877" y="-5041.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-5026.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-5011.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_3_15_stage_0&#45;&gt;ring_attn_3_15_stage_1 -->
<g id="edge1531" class="edge">
<title>ring_attn_3_15_stage_0&#45;&gt;ring_attn_3_15_stage_1</title>
<path fill="none" stroke="black" d="M11279,-4835.87C11279,-4835.87 11279,-4729.25 11279,-4729.25"/>
<polygon fill="black" stroke="black" points="11282.5,-4729.25 11279,-4719.25 11275.5,-4729.25 11282.5,-4729.25"/>
</g>
<!-- ring_attn_3_15_stage_1&#45;&gt;ring_attn_3_0_stage_1 -->
<g id="edge3507" class="edge">
<title>ring_attn_3_15_stage_1&#45;&gt;ring_attn_3_0_stage_1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-4605.51C11209.33,-4569.07 11209.33,-4524 11209.33,-4524 11209.33,-4524 294.67,-4524 294.67,-4524 294.67,-4524 294.67,-4595.51 294.67,-4595.51"/>
<polygon fill="red" stroke="red" points="291.17,-4595.51 294.67,-4605.51 298.17,-4595.51 291.17,-4595.51"/>
<text text-anchor="middle" x="6877" y="-4788.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-4773.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-4758.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_3_15_stage_1&#45;&gt;ring_attn_3_15_stage_2 -->
<g id="edge1532" class="edge">
<title>ring_attn_3_15_stage_1&#45;&gt;ring_attn_3_15_stage_2</title>
<path fill="none" stroke="black" d="M11348.67,-4605.48C11348.67,-4605.48 11348.67,-4453.58 11348.67,-4453.58"/>
<polygon fill="black" stroke="black" points="11352.17,-4453.58 11348.67,-4443.58 11345.17,-4453.58 11352.17,-4453.58"/>
</g>
<!-- ring_attn_3_15_stage_2&#45;&gt;ring_attn_3_0_stage_2 -->
<g id="edge3508" class="edge">
<title>ring_attn_3_15_stage_2&#45;&gt;ring_attn_3_0_stage_2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-4352.51C11209.33,-4316.07 11209.33,-4271 11209.33,-4271 11209.33,-4271 294.67,-4271 294.67,-4271 294.67,-4271 294.67,-4342.51 294.67,-4342.51"/>
<polygon fill="red" stroke="red" points="291.17,-4342.51 294.67,-4352.51 298.17,-4342.51 291.17,-4342.51"/>
<text text-anchor="middle" x="6877" y="-4535.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-4520.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-4505.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_3_15_stage_2&#45;&gt;ring_attn_3_15_stage_3 -->
<g id="edge1533" class="edge">
<title>ring_attn_3_15_stage_2&#45;&gt;ring_attn_3_15_stage_3</title>
<path fill="none" stroke="black" d="M11348.67,-4352.48C11348.67,-4352.48 11348.67,-4200.58 11348.67,-4200.58"/>
<polygon fill="black" stroke="black" points="11352.17,-4200.58 11348.67,-4190.58 11345.17,-4200.58 11352.17,-4200.58"/>
</g>
<!-- ring_attn_3_15_stage_3&#45;&gt;ring_attn_3_0_stage_3 -->
<g id="edge3509" class="edge">
<title>ring_attn_3_15_stage_3&#45;&gt;ring_attn_3_0_stage_3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11174.5,-4110.85C11174.5,-4079.54 11174.5,-4038 11174.5,-4038 11174.5,-4038 329.5,-4038 329.5,-4038 329.5,-4038 329.5,-4100.85 329.5,-4100.85"/>
<polygon fill="red" stroke="red" points="326,-4100.85 329.5,-4110.85 333,-4100.85 326,-4100.85"/>
<text text-anchor="middle" x="6877" y="-4282.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-4267.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-4252.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_3_15_stage_3&#45;&gt;ring_attn_3_15_stage_4 -->
<g id="edge1534" class="edge">
<title>ring_attn_3_15_stage_3&#45;&gt;ring_attn_3_15_stage_4</title>
<path fill="none" stroke="black" d="M11383.5,-4110.88C11383.5,-4110.88 11383.5,-3936.39 11383.5,-3936.39"/>
<polygon fill="black" stroke="black" points="11387,-3936.39 11383.5,-3926.39 11380,-3936.39 11387,-3936.39"/>
</g>
<!-- ring_attn_3_15_stage_4&#45;&gt;ring_attn_3_0_stage_4 -->
<g id="edge3510" class="edge">
<title>ring_attn_3_15_stage_4&#45;&gt;ring_attn_3_0_stage_4</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11279,-3960.07C11279,-3981.17 11279,-3999 11279,-3999 11279,-3999 225,-3999 225,-3999 225,-3999 225,-3970.07 225,-3970.07"/>
<polygon fill="red" stroke="red" points="228.5,-3970.07 225,-3960.07 221.5,-3970.07 228.5,-3970.07"/>
<text text-anchor="middle" x="6877" y="-4029.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-4014.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-3999.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_3_15_stage_4&#45;&gt;ring_attn_3_15_stage_5 -->
<g id="edge1535" class="edge">
<title>ring_attn_3_15_stage_4&#45;&gt;ring_attn_3_15_stage_5</title>
<path fill="none" stroke="black" d="M11348.67,-3846.48C11348.67,-3846.48 11348.67,-3694.58 11348.67,-3694.58"/>
<polygon fill="black" stroke="black" points="11352.17,-3694.58 11348.67,-3684.58 11345.17,-3694.58 11352.17,-3694.58"/>
</g>
<!-- ring_attn_3_15_stage_5&#45;&gt;ring_attn_3_0_stage_5 -->
<g id="edge3511" class="edge">
<title>ring_attn_3_15_stage_5&#45;&gt;ring_attn_3_0_stage_5</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-3684.49C11209.33,-3720.58 11209.33,-3765 11209.33,-3765 11209.33,-3765 294.67,-3765 294.67,-3765 294.67,-3765 294.67,-3694.49 294.67,-3694.49"/>
<polygon fill="red" stroke="red" points="298.17,-3694.49 294.67,-3684.49 291.17,-3694.49 298.17,-3694.49"/>
<text text-anchor="middle" x="6877" y="-3776.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-3761.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-3746.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_3_15_stage_5&#45;&gt;ring_attn_3_15_stage_6 -->
<g id="edge1536" class="edge">
<title>ring_attn_3_15_stage_5&#45;&gt;ring_attn_3_15_stage_6</title>
<path fill="none" stroke="black" d="M11279,-3570.87C11279,-3570.87 11279,-3464.25 11279,-3464.25"/>
<polygon fill="black" stroke="black" points="11282.5,-3464.25 11279,-3454.25 11275.5,-3464.25 11282.5,-3464.25"/>
</g>
<!-- ring_attn_3_15_stage_6&#45;&gt;ring_attn_3_0_stage_6 -->
<g id="edge3512" class="edge">
<title>ring_attn_3_15_stage_6&#45;&gt;ring_attn_3_0_stage_6</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11174.5,-3351.85C11174.5,-3320.54 11174.5,-3279 11174.5,-3279 11174.5,-3279 329.5,-3279 329.5,-3279 329.5,-3279 329.5,-3341.85 329.5,-3341.85"/>
<polygon fill="red" stroke="red" points="326,-3341.85 329.5,-3351.85 333,-3341.85 326,-3341.85"/>
<text text-anchor="middle" x="6877" y="-3523.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-3508.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-3493.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_3_15_stage_6&#45;&gt;ring_attn_3_15_stage_7 -->
<g id="edge1537" class="edge">
<title>ring_attn_3_15_stage_6&#45;&gt;ring_attn_3_15_stage_7</title>
<path fill="none" stroke="black" d="M11383.5,-3351.88C11383.5,-3351.88 11383.5,-3177.39 11383.5,-3177.39"/>
<polygon fill="black" stroke="black" points="11387,-3177.39 11383.5,-3167.39 11380,-3177.39 11387,-3177.39"/>
</g>
<!-- ring_attn_3_15_stage_7&#45;&gt;ring_attn_3_0_stage_7 -->
<g id="edge3513" class="edge">
<title>ring_attn_3_15_stage_7&#45;&gt;ring_attn_3_0_stage_7</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11279,-3201.07C11279,-3222.17 11279,-3240 11279,-3240 11279,-3240 225,-3240 225,-3240 225,-3240 225,-3211.07 225,-3211.07"/>
<polygon fill="red" stroke="red" points="228.5,-3211.07 225,-3201.07 221.5,-3211.07 228.5,-3211.07"/>
<text text-anchor="middle" x="6877" y="-3270.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-3255.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-3240.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_3_15_stage_7&#45;&gt;ring_attn_3_15_stage_8 -->
<g id="edge1538" class="edge">
<title>ring_attn_3_15_stage_7&#45;&gt;ring_attn_3_15_stage_8</title>
<path fill="none" stroke="black" d="M11279,-3064.87C11279,-3064.87 11279,-2958.25 11279,-2958.25"/>
<polygon fill="black" stroke="black" points="11282.5,-2958.25 11279,-2948.25 11275.5,-2958.25 11282.5,-2958.25"/>
</g>
<!-- ring_attn_3_15_stage_8&#45;&gt;ring_attn_3_0_stage_8 -->
<g id="edge3514" class="edge">
<title>ring_attn_3_15_stage_8&#45;&gt;ring_attn_3_0_stage_8</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11174.5,-2845.85C11174.5,-2814.54 11174.5,-2773 11174.5,-2773 11174.5,-2773 329.5,-2773 329.5,-2773 329.5,-2773 329.5,-2835.85 329.5,-2835.85"/>
<polygon fill="red" stroke="red" points="326,-2835.85 329.5,-2845.85 333,-2835.85 326,-2835.85"/>
<text text-anchor="middle" x="6877" y="-3017.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-3002.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-2987.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_3_15_stage_8&#45;&gt;ring_attn_3_15_stage_9 -->
<g id="edge1539" class="edge">
<title>ring_attn_3_15_stage_8&#45;&gt;ring_attn_3_15_stage_9</title>
<path fill="none" stroke="black" d="M11383.5,-2845.88C11383.5,-2845.88 11383.5,-2671.39 11383.5,-2671.39"/>
<polygon fill="black" stroke="black" points="11387,-2671.39 11383.5,-2661.39 11380,-2671.39 11387,-2671.39"/>
</g>
<!-- ring_attn_3_15_stage_9&#45;&gt;ring_attn_3_0_stage_9 -->
<g id="edge3515" class="edge">
<title>ring_attn_3_15_stage_9&#45;&gt;ring_attn_3_0_stage_9</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11279,-2695.07C11279,-2716.17 11279,-2734 11279,-2734 11279,-2734 225,-2734 225,-2734 225,-2734 225,-2705.07 225,-2705.07"/>
<polygon fill="red" stroke="red" points="228.5,-2705.07 225,-2695.07 221.5,-2705.07 228.5,-2705.07"/>
<text text-anchor="middle" x="6877" y="-2764.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-2749.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-2734.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_3_15_stage_9&#45;&gt;ring_attn_3_15_stage_10 -->
<g id="edge1540" class="edge">
<title>ring_attn_3_15_stage_9&#45;&gt;ring_attn_3_15_stage_10</title>
<path fill="none" stroke="black" d="M11348.67,-2581.48C11348.67,-2581.48 11348.67,-2429.58 11348.67,-2429.58"/>
<polygon fill="black" stroke="black" points="11352.17,-2429.58 11348.67,-2419.58 11345.17,-2429.58 11352.17,-2429.58"/>
</g>
<!-- ring_attn_3_15_stage_10&#45;&gt;ring_attn_3_0_stage_10 -->
<g id="edge3516" class="edge">
<title>ring_attn_3_15_stage_10&#45;&gt;ring_attn_3_0_stage_10</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11209.33,-2419.49C11209.33,-2455.58 11209.33,-2500 11209.33,-2500 11209.33,-2500 294.67,-2500 294.67,-2500 294.67,-2500 294.67,-2429.49 294.67,-2429.49"/>
<polygon fill="red" stroke="red" points="298.17,-2429.49 294.67,-2419.49 291.17,-2429.49 298.17,-2429.49"/>
<text text-anchor="middle" x="6877" y="-2511.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-2496.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-2481.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_3_15_stage_10&#45;&gt;ring_attn_3_15_stage_11 -->
<g id="edge1541" class="edge">
<title>ring_attn_3_15_stage_10&#45;&gt;ring_attn_3_15_stage_11</title>
<path fill="none" stroke="black" d="M11279,-2305.87C11279,-2305.87 11279,-2199.25 11279,-2199.25"/>
<polygon fill="black" stroke="black" points="11282.5,-2199.25 11279,-2189.25 11275.5,-2199.25 11282.5,-2199.25"/>
</g>
<!-- ring_attn_3_15_stage_11&#45;&gt;ring_attn_3_0_stage_11 -->
<g id="edge3517" class="edge">
<title>ring_attn_3_15_stage_11&#45;&gt;ring_attn_3_0_stage_11</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11174.5,-2086.85C11174.5,-2055.54 11174.5,-2014 11174.5,-2014 11174.5,-2014 329.5,-2014 329.5,-2014 329.5,-2014 329.5,-2076.85 329.5,-2076.85"/>
<polygon fill="red" stroke="red" points="326,-2076.85 329.5,-2086.85 333,-2076.85 326,-2076.85"/>
<text text-anchor="middle" x="6877" y="-2258.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-2243.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-2228.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_3_15_stage_11&#45;&gt;ring_attn_3_15_stage_12 -->
<g id="edge1542" class="edge">
<title>ring_attn_3_15_stage_11&#45;&gt;ring_attn_3_15_stage_12</title>
<path fill="none" stroke="black" d="M11383.5,-2086.88C11383.5,-2086.88 11383.5,-1912.39 11383.5,-1912.39"/>
<polygon fill="black" stroke="black" points="11387,-1912.39 11383.5,-1902.39 11380,-1912.39 11387,-1912.39"/>
</g>
<!-- ring_attn_3_15_stage_12&#45;&gt;ring_attn_3_0_stage_12 -->
<g id="edge3518" class="edge">
<title>ring_attn_3_15_stage_12&#45;&gt;ring_attn_3_0_stage_12</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11279,-1936.07C11279,-1957.17 11279,-1975 11279,-1975 11279,-1975 225,-1975 225,-1975 225,-1975 225,-1946.07 225,-1946.07"/>
<polygon fill="red" stroke="red" points="228.5,-1946.07 225,-1936.07 221.5,-1946.07 228.5,-1946.07"/>
<text text-anchor="middle" x="6877" y="-2005.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-1990.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-1975.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_3_15_stage_12&#45;&gt;ring_attn_3_15_stage_13 -->
<g id="edge1543" class="edge">
<title>ring_attn_3_15_stage_12&#45;&gt;ring_attn_3_15_stage_13</title>
<path fill="none" stroke="black" d="M11279,-1799.87C11279,-1799.87 11279,-1693.25 11279,-1693.25"/>
<polygon fill="black" stroke="black" points="11282.5,-1693.25 11279,-1683.25 11275.5,-1693.25 11282.5,-1693.25"/>
</g>
<!-- ring_attn_3_15_stage_13&#45;&gt;ring_attn_3_0_stage_13 -->
<g id="edge3519" class="edge">
<title>ring_attn_3_15_stage_13&#45;&gt;ring_attn_3_0_stage_13</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11174.5,-1580.85C11174.5,-1549.54 11174.5,-1508 11174.5,-1508 11174.5,-1508 329.5,-1508 329.5,-1508 329.5,-1508 329.5,-1570.85 329.5,-1570.85"/>
<polygon fill="red" stroke="red" points="326,-1570.85 329.5,-1580.85 333,-1570.85 326,-1570.85"/>
<text text-anchor="middle" x="6877" y="-1752.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-1737.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-1722.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_3_15_stage_13&#45;&gt;ring_attn_3_15_stage_14 -->
<g id="edge1544" class="edge">
<title>ring_attn_3_15_stage_13&#45;&gt;ring_attn_3_15_stage_14</title>
<path fill="none" stroke="black" d="M11383.5,-1580.88C11383.5,-1580.88 11383.5,-1406.39 11383.5,-1406.39"/>
<polygon fill="black" stroke="black" points="11387,-1406.39 11383.5,-1396.39 11380,-1406.39 11387,-1406.39"/>
</g>
<!-- ring_attn_3_15_stage_14&#45;&gt;ring_attn_3_0_stage_14 -->
<g id="edge3520" class="edge">
<title>ring_attn_3_15_stage_14&#45;&gt;ring_attn_3_0_stage_14</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11279,-1430.07C11279,-1451.17 11279,-1469 11279,-1469 11279,-1469 225,-1469 225,-1469 225,-1469 225,-1440.07 225,-1440.07"/>
<polygon fill="red" stroke="red" points="228.5,-1440.07 225,-1430.07 221.5,-1440.07 228.5,-1440.07"/>
<text text-anchor="middle" x="6877" y="-1499.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-1484.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-1469.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- ring_attn_3_15_stage_14&#45;&gt;ring_attn_3_15_stage_15 -->
<g id="edge1545" class="edge">
<title>ring_attn_3_15_stage_14&#45;&gt;ring_attn_3_15_stage_15</title>
<path fill="none" stroke="black" d="M11279,-1293.87C11279,-1293.87 11279,-1187.25 11279,-1187.25"/>
<polygon fill="black" stroke="black" points="11282.5,-1187.25 11279,-1177.25 11275.5,-1187.25 11282.5,-1187.25"/>
</g>
<!-- ring_attn_3_15_stage_15&#45;&gt;ring_attn_3_0_stage_15 -->
<g id="edge3521" class="edge">
<title>ring_attn_3_15_stage_15&#45;&gt;ring_attn_3_0_stage_15</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11115,-1093.96C11115,-1064.92 11115,-1004 11115,-1004 11115,-1004 389,-1004 389,-1004 389,-1004 389,-1083.96 389,-1083.96"/>
<polygon fill="red" stroke="red" points="385.5,-1083.96 389,-1093.96 392.5,-1083.96 385.5,-1083.96"/>
<text text-anchor="middle" x="6877" y="-1246.8" font-family="Times,serif" font-size="14.00">KV Block Transfer</text>
<text text-anchor="middle" x="6877" y="-1231.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="6877" y="-1216.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_3_15 -->
<g id="node1562" class="node">
<title>attn_out_3_15</title>
<polygon fill="none" stroke="black" points="11348.5,-968 11209.5,-968 11209.5,-915 11348.5,-915 11348.5,-968"/>
<text text-anchor="middle" x="11279" y="-952.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="11279" y="-937.8" font-family="Times,serif" font-size="14.00">W_o: 4096×4096</text>
<text text-anchor="middle" x="11279" y="-922.8" font-family="Times,serif" font-size="14.00">Split: 256×4096</text>
</g>
<!-- ring_attn_3_15_stage_15&#45;&gt;attn_out_3_15 -->
<g id="edge1546" class="edge">
<title>ring_attn_3_15_stage_15&#45;&gt;attn_out_3_15</title>
<path fill="none" stroke="black" d="M11279,-1040.87C11279,-1040.87 11279,-978.18 11279,-978.18"/>
<polygon fill="black" stroke="black" points="11282.5,-978.18 11279,-968.18 11275.5,-978.18 11282.5,-978.18"/>
</g>
<!-- attn_residual_3_15 -->
<g id="node1563" class="node">
<title>attn_residual_3_15</title>
<ellipse fill="none" stroke="black" cx="11279" cy="-815" rx="105.5" ry="27"/>
<text text-anchor="middle" x="11279" y="-818.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="11279" y="-803.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- attn_out_3_15&#45;&gt;attn_residual_3_15 -->
<g id="edge1547" class="edge">
<title>attn_out_3_15&#45;&gt;attn_residual_3_15</title>
<path fill="none" stroke="black" d="M11279,-914.98C11279,-914.98 11279,-852.36 11279,-852.36"/>
<polygon fill="black" stroke="black" points="11282.5,-852.36 11279,-842.36 11275.5,-852.36 11282.5,-852.36"/>
</g>
<!-- gate_3_15 -->
<g id="node1564" class="node">
<title>gate_3_15</title>
<ellipse fill="orange" stroke="black" cx="11279" cy="-677.5" rx="105.5" ry="37.5"/>
<text text-anchor="middle" x="11279" y="-688.8" font-family="Times,serif" font-size="14.00">Top&#45;2 Gate</text>
<text text-anchor="middle" x="11279" y="-673.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
<text text-anchor="middle" x="11279" y="-658.8" font-family="Times,serif" font-size="14.00">→ Expert routing</text>
</g>
<!-- attn_residual_3_15&#45;&gt;gate_3_15 -->
<g id="edge1548" class="edge">
<title>attn_residual_3_15&#45;&gt;gate_3_15</title>
<path fill="none" stroke="black" d="M11349.33,-794.71C11349.33,-794.71 11349.33,-715.5 11349.33,-715.5"/>
<polygon fill="black" stroke="black" points="11352.83,-715.5 11349.33,-705.5 11345.83,-715.5 11352.83,-715.5"/>
</g>
<!-- gate_3_15&#45;&gt;expert_3_0_0 -->
<g id="edge3522" class="edge">
<title>gate_3_15&#45;&gt;expert_3_0_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11184.61,-660.56C11184.61,-620.26 11184.61,-522 11184.61,-522 11184.61,-522 203.9,-522 203.9,-522 203.9,-522 203.9,-518.29 203.9,-518.29"/>
<polygon fill="blue" stroke="blue" points="207.4,-518.29 203.9,-508.29 200.4,-518.29 207.4,-518.29"/>
<text text-anchor="middle" x="48146.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="48146.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU15→GPU0</text>
<text text-anchor="middle" x="48146.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="48146.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_15&#45;&gt;expert_3_1_0 -->
<g id="edge3523" class="edge">
<title>gate_3_15&#45;&gt;expert_3_1_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11206.82,-650.08C11206.82,-604.48 11206.82,-518 11206.82,-518 11206.82,-518 3041.82,-518 3041.82,-518 3041.82,-518 3041.82,-517 3041.82,-517"/>
<polygon fill="blue" stroke="blue" points="3045.32,-518.03 3041.82,-508.03 3038.32,-518.03 3045.32,-518.03"/>
<text text-anchor="middle" x="48320.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="48320.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU15→GPU1</text>
<text text-anchor="middle" x="48320.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="48320.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_15&#45;&gt;expert_3_2_0 -->
<g id="edge3524" class="edge">
<title>gate_3_15&#45;&gt;expert_3_2_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11229.03,-644.24C11229.03,-597.23 11229.03,-517 11229.03,-517 11229.03,-517 3651.91,-517 3651.91,-517 3651.91,-517 3651.91,-516.1 3651.91,-516.1"/>
<polygon fill="blue" stroke="blue" points="3655.41,-518.04 3651.91,-508.04 3648.41,-518.04 3655.41,-518.04"/>
<text text-anchor="middle" x="48494.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="48494.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU15→GPU2</text>
<text text-anchor="middle" x="48494.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="48494.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_15&#45;&gt;expert_3_3_0 -->
<g id="edge3525" class="edge">
<title>gate_3_15&#45;&gt;expert_3_3_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11251.24,-641.26C11251.24,-593.64 11251.24,-516 11251.24,-516 11251.24,-516 4477.8,-516 4477.8,-516 4477.8,-516 4477.8,-481 4477.8,-481 4477.8,-481 4364.27,-481 4364.27,-481"/>
<polygon fill="blue" stroke="blue" points="4364.27,-477.5 4354.27,-481 4364.27,-484.5 4364.27,-477.5"/>
<text text-anchor="middle" x="48668.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="48668.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU15→GPU3</text>
<text text-anchor="middle" x="48668.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="48668.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_15&#45;&gt;expert_3_4_0 -->
<g id="edge3526" class="edge">
<title>gate_3_15&#45;&gt;expert_3_4_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11314.17,-713.01C11314.17,-734.97 11314.17,-759 11314.17,-759 11314.17,-759 5245,-759 5245,-759 5245,-759 5245,-481 5245,-481 5245,-481 4951.24,-481 4951.24,-481"/>
<polygon fill="blue" stroke="blue" points="4951.24,-477.5 4941.24,-481 4951.24,-484.5 4951.24,-477.5"/>
<text text-anchor="middle" x="48842.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="48842.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU15→GPU4</text>
<text text-anchor="middle" x="48842.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="48842.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_15&#45;&gt;expert_3_5_0 -->
<g id="edge3527" class="edge">
<title>gate_3_15&#45;&gt;expert_3_5_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11279,-715.19C11279,-733.66 11279,-752 11279,-752 11279,-752 5832,-752 5832,-752 5832,-752 5832,-472 5832,-472 5832,-472 5538.24,-472 5538.24,-472"/>
<polygon fill="blue" stroke="blue" points="5538.24,-468.5 5528.24,-472 5538.24,-475.5 5538.24,-468.5"/>
<text text-anchor="middle" x="49016.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49016.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU15→GPU5</text>
<text text-anchor="middle" x="49016.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49016.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_15&#45;&gt;expert_3_6_0 -->
<g id="edge3528" class="edge">
<title>gate_3_15&#45;&gt;expert_3_6_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11243.83,-713.04C11243.83,-726.21 11243.83,-738 11243.83,-738 11243.83,-738 5887.8,-738 5887.8,-738 5887.8,-738 5887.8,-518.47 5887.8,-518.47"/>
<polygon fill="blue" stroke="blue" points="5891.3,-518.47 5887.8,-508.47 5884.3,-518.47 5891.3,-518.47"/>
<text text-anchor="middle" x="49190.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49190.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU15→GPU6</text>
<text text-anchor="middle" x="49190.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49190.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_15&#45;&gt;expert_3_7_0 -->
<g id="edge3529" class="edge">
<title>gate_3_15&#45;&gt;expert_3_7_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11208.67,-705.62C11208.67,-715.41 11208.67,-724 11208.67,-724 11208.67,-724 6691.88,-724 6691.88,-724 6691.88,-724 6691.88,-518.38 6691.88,-518.38"/>
<polygon fill="blue" stroke="blue" points="6695.38,-518.38 6691.88,-508.38 6688.38,-518.38 6695.38,-518.38"/>
<text text-anchor="middle" x="49364.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49364.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU15→GPU7</text>
<text text-anchor="middle" x="49364.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49364.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_15&#45;&gt;expert_3_8_0 -->
<g id="edge3530" class="edge">
<title>gate_3_15&#45;&gt;expert_3_8_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11273.45,-639.76C11273.45,-599.66 11273.45,-542 11273.45,-542 11273.45,-542 7211.28,-542 7211.28,-542 7211.28,-542 7211.28,-518.21 7211.28,-518.21"/>
<polygon fill="blue" stroke="blue" points="7214.78,-518.21 7211.28,-508.21 7207.78,-518.21 7214.78,-518.21"/>
<text text-anchor="middle" x="49538.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49538.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU15→GPU8</text>
<text text-anchor="middle" x="49538.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49538.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_15&#45;&gt;expert_3_9_0 -->
<g id="edge3531" class="edge">
<title>gate_3_15&#45;&gt;expert_3_9_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11295.66,-640.36C11295.66,-591.56 11295.66,-512 11295.66,-512 11295.66,-512 7804.95,-512 7804.95,-512 7804.95,-512 7804.95,-511.6 7804.95,-511.6"/>
<polygon fill="blue" stroke="blue" points="7808.45,-518.01 7804.95,-508.01 7801.45,-518.01 7808.45,-518.01"/>
<text text-anchor="middle" x="49712.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49712.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU15→GPU9</text>
<text text-anchor="middle" x="49712.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49712.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_15&#45;&gt;expert_3_10_0 -->
<g id="edge3532" class="edge">
<title>gate_3_15&#45;&gt;expert_3_10_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11317.87,-642.6C11317.87,-593.77 11317.87,-511 11317.87,-511 11317.87,-511 8399.26,-511 8399.26,-511 8399.26,-511 8399.26,-510.73 8399.26,-510.73"/>
<polygon fill="blue" stroke="blue" points="8402.76,-518.28 8399.26,-508.28 8395.76,-518.28 8402.76,-518.28"/>
<text text-anchor="middle" x="49886.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="49886.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU15→GPU10</text>
<text text-anchor="middle" x="49886.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="49886.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_15&#45;&gt;expert_3_11_0 -->
<g id="edge3533" class="edge">
<title>gate_3_15&#45;&gt;expert_3_11_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11340.08,-646.83C11340.08,-617.6 11340.08,-578 11340.08,-578 11340.08,-578 8996.31,-578 8996.31,-578 8996.31,-578 8996.31,-518.12 8996.31,-518.12"/>
<polygon fill="blue" stroke="blue" points="8999.81,-518.12 8996.31,-508.12 8992.81,-518.12 8999.81,-518.12"/>
<text text-anchor="middle" x="50060.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="50060.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU15→GPU11</text>
<text text-anchor="middle" x="50060.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="50060.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_15&#45;&gt;expert_3_12_0 -->
<g id="edge3534" class="edge">
<title>gate_3_15&#45;&gt;expert_3_12_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11351.18,-649.89C11351.18,-638.1 11351.18,-627 11351.18,-627 11351.18,-627 9595.98,-627 9595.98,-627 9595.98,-627 9595.98,-518.19 9595.98,-518.19"/>
<polygon fill="blue" stroke="blue" points="9599.48,-518.19 9595.98,-508.19 9592.48,-518.19 9599.48,-518.19"/>
<text text-anchor="middle" x="50234.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="50234.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU15→GPU12</text>
<text text-anchor="middle" x="50234.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="50234.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_15&#45;&gt;expert_3_13_0 -->
<g id="edge3535" class="edge">
<title>gate_3_15&#45;&gt;expert_3_13_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11362.29,-654.29C11362.29,-607.87 11362.29,-508 11362.29,-508 11362.29,-508 10219.5,-508 10219.5,-508 10219.5,-508 10219.5,-507.99 10219.5,-507.99"/>
<polygon fill="blue" stroke="blue" points="10223.01,-517.92 10219.5,-507.92 10216.01,-517.93 10223.01,-517.92"/>
<text text-anchor="middle" x="50408.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="50408.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU15→GPU13</text>
<text text-anchor="middle" x="50408.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="50408.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_15&#45;&gt;expert_3_14_0 -->
<g id="edge3536" class="edge">
<title>gate_3_15&#45;&gt;expert_3_14_0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11179.37,-690C11040.75,-690 10806.5,-690 10806.5,-690 10806.5,-690 10806.5,-518.33 10806.5,-518.33"/>
<polygon fill="blue" stroke="blue" points="10810,-518.33 10806.5,-508.33 10803,-518.33 10810,-518.33"/>
<text text-anchor="middle" x="50582.5" y="-592.8" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="50582.5" y="-577.8" font-family="Times,serif" font-size="14.00">GPU15→GPU14</text>
<text text-anchor="middle" x="50582.5" y="-562.8" font-family="Times,serif" font-size="14.00">Top&#45;2 tokens</text>
<text text-anchor="middle" x="50582.5" y="-547.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- gate_3_15&#45;&gt;expert_3_15_0 -->
<g id="edge1549" class="edge">
<title>gate_3_15&#45;&gt;expert_3_15_0</title>
<path fill="none" stroke="black" d="M11373.39,-660.45C11373.39,-660.45 11373.39,-518.2 11373.39,-518.2"/>
<polygon fill="black" stroke="black" points="11376.89,-518.2 11373.39,-508.2 11369.89,-518.2 11376.89,-518.2"/>
</g>
<!-- expert_reduce_3_15 -->
<g id="node1566" class="node">
<title>expert_reduce_3_15</title>
<ellipse fill="none" stroke="black" cx="11279" cy="-344.5" rx="114" ry="37.5"/>
<text text-anchor="middle" x="11279" y="-355.8" font-family="Times,serif" font-size="14.00">Expert Reduce</text>
<text text-anchor="middle" x="11279" y="-340.8" font-family="Times,serif" font-size="14.00">Top&#45;2 weighted sum</text>
<text text-anchor="middle" x="11279" y="-325.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_3_15_0&#45;&gt;expert_reduce_3_15 -->
<g id="edge1550" class="edge">
<title>expert_3_15_0&#45;&gt;expert_reduce_3_15</title>
<path fill="none" stroke="black" d="M11279,-454.76C11279,-454.76 11279,-392.06 11279,-392.06"/>
<polygon fill="black" stroke="black" points="11282.5,-392.06 11279,-382.06 11275.5,-392.06 11282.5,-392.06"/>
</g>
<!-- moe_residual_3_15 -->
<g id="node1567" class="node">
<title>moe_residual_3_15</title>
<ellipse fill="none" stroke="black" cx="11279" cy="-207" rx="105.5" ry="27"/>
<text text-anchor="middle" x="11279" y="-210.8" font-family="Times,serif" font-size="14.00">Add &amp; Norm</text>
<text text-anchor="middle" x="11279" y="-195.8" font-family="Times,serif" font-size="14.00">1024×1024×4096</text>
</g>
<!-- expert_reduce_3_15&#45;&gt;moe_residual_3_15 -->
<g id="edge1551" class="edge">
<title>expert_reduce_3_15&#45;&gt;moe_residual_3_15</title>
<path fill="none" stroke="black" d="M11279,-306.93C11279,-306.93 11279,-244.06 11279,-244.06"/>
<polygon fill="black" stroke="black" points="11282.5,-244.06 11279,-234.06 11275.5,-244.06 11282.5,-244.06"/>
</g>
<!-- output_15 -->
<g id="node1568" class="node">
<title>output_15</title>
<polygon fill="lightcoral" stroke="black" points="11376.5,-107 11181.5,-107 11181.5,-69 11376.5,-69 11376.5,-107"/>
<text text-anchor="middle" x="11279" y="-91.8" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="11279" y="-76.8" font-family="Times,serif" font-size="14.00">Y[15]: 1024×1024×4096</text>
</g>
<!-- moe_residual_3_15&#45;&gt;output_15 -->
<g id="edge1552" class="edge">
<title>moe_residual_3_15&#45;&gt;output_15</title>
<path fill="none" stroke="black" d="M11279,-180C11279,-180 11279,-117.12 11279,-117.12"/>
<polygon fill="black" stroke="black" points="11282.5,-117.12 11279,-107.12 11275.5,-117.12 11282.5,-117.12"/>
</g>
</g>
</svg>
