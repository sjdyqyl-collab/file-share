// MoE Transformer with Ring Attention + Sequence Parallelism on 16 GPUs
digraph {
	rankdir=TB size="50,50"
	subgraph cluster_input_0 {
		color="#FF6B6B" fillcolor="#FF6B6B20" label="GPU 0" style=filled
		input_0 [label="Input Embedding
X[0] ∈ ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=box style=filled]
	}
	subgraph cluster_input_1 {
		color="#4ECDC4" fillcolor="#4ECDC420" label="GPU 1" style=filled
		input_1 [label="Input Embedding
X[1] ∈ ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=box style=filled]
	}
	subgraph cluster_input_2 {
		color="#45B7D1" fillcolor="#45B7D120" label="GPU 2" style=filled
		input_2 [label="Input Embedding
X[2] ∈ ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=box style=filled]
	}
	subgraph cluster_input_3 {
		color="#96CEB4" fillcolor="#96CEB420" label="GPU 3" style=filled
		input_3 [label="Input Embedding
X[3] ∈ ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=box style=filled]
	}
	subgraph cluster_input_4 {
		color="#FECA57" fillcolor="#FECA5720" label="GPU 4" style=filled
		input_4 [label="Input Embedding
X[4] ∈ ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=box style=filled]
	}
	subgraph cluster_input_5 {
		color="#FF9FF3" fillcolor="#FF9FF320" label="GPU 5" style=filled
		input_5 [label="Input Embedding
X[5] ∈ ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=box style=filled]
	}
	subgraph cluster_input_6 {
		color="#54A0FF" fillcolor="#54A0FF20" label="GPU 6" style=filled
		input_6 [label="Input Embedding
X[6] ∈ ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=box style=filled]
	}
	subgraph cluster_input_7 {
		color="#5F27CD" fillcolor="#5F27CD20" label="GPU 7" style=filled
		input_7 [label="Input Embedding
X[7] ∈ ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=box style=filled]
	}
	subgraph cluster_input_8 {
		color="#00D2D3" fillcolor="#00D2D320" label="GPU 8" style=filled
		input_8 [label="Input Embedding
X[8] ∈ ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=box style=filled]
	}
	subgraph cluster_input_9 {
		color="#FF9F43" fillcolor="#FF9F4320" label="GPU 9" style=filled
		input_9 [label="Input Embedding
X[9] ∈ ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=box style=filled]
	}
	subgraph cluster_input_10 {
		color="#10AC84" fillcolor="#10AC8420" label="GPU 10" style=filled
		input_10 [label="Input Embedding
X[10] ∈ ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=box style=filled]
	}
	subgraph cluster_input_11 {
		color="#EE5A24" fillcolor="#EE5A2420" label="GPU 11" style=filled
		input_11 [label="Input Embedding
X[11] ∈ ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=box style=filled]
	}
	subgraph cluster_input_12 {
		color="#0652DD" fillcolor="#0652DD20" label="GPU 12" style=filled
		input_12 [label="Input Embedding
X[12] ∈ ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=box style=filled]
	}
	subgraph cluster_input_13 {
		color="#9980FA" fillcolor="#9980FA20" label="GPU 13" style=filled
		input_13 [label="Input Embedding
X[13] ∈ ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=box style=filled]
	}
	subgraph cluster_input_14 {
		color="#D63031" fillcolor="#D6303120" label="GPU 14" style=filled
		input_14 [label="Input Embedding
X[14] ∈ ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=box style=filled]
	}
	subgraph cluster_input_15 {
		color="#74B9FF" fillcolor="#74B9FF20" label="GPU 15" style=filled
		input_15 [label="Input Embedding
X[15] ∈ ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=box style=filled]
	}
	subgraph cluster_layer1_gpu0 {
		color="#FF6B6B" fillcolor="#FF6B6B20" label="Layer 1 - GPU 0" style=filled
		ln1_1_0 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=ellipse style=filled]
		q_proj_1_0 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=box style=filled]
		k_proj_1_0 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=box style=filled]
		v_proj_1_0 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=box style=filled]
		ring_attn_1_0_stage0 [label="Ring Attention Stage 0
Q[0]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_1_0_stage1 [label="Ring Attention Stage 1
Q[0]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_1_0_stage2 [label="Ring Attention Stage 2
Q[0]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_1_0_stage3 [label="Ring Attention Stage 3
Q[0]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_1_0_stage4 [label="Ring Attention Stage 4
Q[0]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_1_0_stage5 [label="Ring Attention Stage 5
Q[0]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_1_0_stage6 [label="Ring Attention Stage 6
Q[0]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_1_0_stage7 [label="Ring Attention Stage 7
Q[0]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_1_0_stage8 [label="Ring Attention Stage 8
Q[0]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_1_0_stage9 [label="Ring Attention Stage 9
Q[0]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_1_0_stage10 [label="Ring Attention Stage 10
Q[0]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_1_0_stage11 [label="Ring Attention Stage 11
Q[0]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_1_0_stage12 [label="Ring Attention Stage 12
Q[0]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_1_0_stage13 [label="Ring Attention Stage 13
Q[0]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_1_0_stage14 [label="Ring Attention Stage 14
Q[0]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_1_0_stage15 [label="Ring Attention Stage 15
Q[0]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		o_proj_1_0 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=box style=filled]
		residual1_1_0 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=ellipse style=filled]
		ln2_1_0 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=ellipse style=filled]
		router_1_0 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#FF6B6B" shape=hexagon style=filled]
		gate_1_0 [label="Top-2 Gating
Expert Selection" fillcolor="#FF6B6B" shape=pentagon style=filled]
		expert_1_0_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_1_0_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_1_0_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_1_0_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_1_0_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_1_0_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_1_0_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_1_0_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_agg_1_0 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=ellipse style=filled]
		residual2_1_0 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=ellipse style=filled]
	}
	subgraph cluster_layer1_gpu1 {
		color="#4ECDC4" fillcolor="#4ECDC420" label="Layer 1 - GPU 1" style=filled
		ln1_1_1 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=ellipse style=filled]
		q_proj_1_1 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=box style=filled]
		k_proj_1_1 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=box style=filled]
		v_proj_1_1 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=box style=filled]
		ring_attn_1_1_stage0 [label="Ring Attention Stage 0
Q[1]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_1_1_stage1 [label="Ring Attention Stage 1
Q[1]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_1_1_stage2 [label="Ring Attention Stage 2
Q[1]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_1_1_stage3 [label="Ring Attention Stage 3
Q[1]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_1_1_stage4 [label="Ring Attention Stage 4
Q[1]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_1_1_stage5 [label="Ring Attention Stage 5
Q[1]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_1_1_stage6 [label="Ring Attention Stage 6
Q[1]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_1_1_stage7 [label="Ring Attention Stage 7
Q[1]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_1_1_stage8 [label="Ring Attention Stage 8
Q[1]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_1_1_stage9 [label="Ring Attention Stage 9
Q[1]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_1_1_stage10 [label="Ring Attention Stage 10
Q[1]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_1_1_stage11 [label="Ring Attention Stage 11
Q[1]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_1_1_stage12 [label="Ring Attention Stage 12
Q[1]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_1_1_stage13 [label="Ring Attention Stage 13
Q[1]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_1_1_stage14 [label="Ring Attention Stage 14
Q[1]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_1_1_stage15 [label="Ring Attention Stage 15
Q[1]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		o_proj_1_1 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=box style=filled]
		residual1_1_1 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=ellipse style=filled]
		ln2_1_1 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=ellipse style=filled]
		router_1_1 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#4ECDC4" shape=hexagon style=filled]
		gate_1_1 [label="Top-2 Gating
Expert Selection" fillcolor="#4ECDC4" shape=pentagon style=filled]
		expert_1_1_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_1_1_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_1_1_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_1_1_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_1_1_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_1_1_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_1_1_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_1_1_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_agg_1_1 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=ellipse style=filled]
		residual2_1_1 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=ellipse style=filled]
	}
	subgraph cluster_layer1_gpu2 {
		color="#45B7D1" fillcolor="#45B7D120" label="Layer 1 - GPU 2" style=filled
		ln1_1_2 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=ellipse style=filled]
		q_proj_1_2 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=box style=filled]
		k_proj_1_2 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=box style=filled]
		v_proj_1_2 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=box style=filled]
		ring_attn_1_2_stage0 [label="Ring Attention Stage 0
Q[2]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_1_2_stage1 [label="Ring Attention Stage 1
Q[2]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_1_2_stage2 [label="Ring Attention Stage 2
Q[2]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_1_2_stage3 [label="Ring Attention Stage 3
Q[2]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_1_2_stage4 [label="Ring Attention Stage 4
Q[2]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_1_2_stage5 [label="Ring Attention Stage 5
Q[2]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_1_2_stage6 [label="Ring Attention Stage 6
Q[2]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_1_2_stage7 [label="Ring Attention Stage 7
Q[2]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_1_2_stage8 [label="Ring Attention Stage 8
Q[2]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_1_2_stage9 [label="Ring Attention Stage 9
Q[2]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_1_2_stage10 [label="Ring Attention Stage 10
Q[2]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_1_2_stage11 [label="Ring Attention Stage 11
Q[2]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_1_2_stage12 [label="Ring Attention Stage 12
Q[2]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_1_2_stage13 [label="Ring Attention Stage 13
Q[2]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_1_2_stage14 [label="Ring Attention Stage 14
Q[2]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_1_2_stage15 [label="Ring Attention Stage 15
Q[2]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		o_proj_1_2 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=box style=filled]
		residual1_1_2 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=ellipse style=filled]
		ln2_1_2 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=ellipse style=filled]
		router_1_2 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#45B7D1" shape=hexagon style=filled]
		gate_1_2 [label="Top-2 Gating
Expert Selection" fillcolor="#45B7D1" shape=pentagon style=filled]
		expert_1_2_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_1_2_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_1_2_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_1_2_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_1_2_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_1_2_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_1_2_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_1_2_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_agg_1_2 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=ellipse style=filled]
		residual2_1_2 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=ellipse style=filled]
	}
	subgraph cluster_layer1_gpu3 {
		color="#96CEB4" fillcolor="#96CEB420" label="Layer 1 - GPU 3" style=filled
		ln1_1_3 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=ellipse style=filled]
		q_proj_1_3 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=box style=filled]
		k_proj_1_3 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=box style=filled]
		v_proj_1_3 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=box style=filled]
		ring_attn_1_3_stage0 [label="Ring Attention Stage 0
Q[3]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_1_3_stage1 [label="Ring Attention Stage 1
Q[3]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_1_3_stage2 [label="Ring Attention Stage 2
Q[3]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_1_3_stage3 [label="Ring Attention Stage 3
Q[3]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_1_3_stage4 [label="Ring Attention Stage 4
Q[3]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_1_3_stage5 [label="Ring Attention Stage 5
Q[3]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_1_3_stage6 [label="Ring Attention Stage 6
Q[3]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_1_3_stage7 [label="Ring Attention Stage 7
Q[3]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_1_3_stage8 [label="Ring Attention Stage 8
Q[3]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_1_3_stage9 [label="Ring Attention Stage 9
Q[3]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_1_3_stage10 [label="Ring Attention Stage 10
Q[3]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_1_3_stage11 [label="Ring Attention Stage 11
Q[3]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_1_3_stage12 [label="Ring Attention Stage 12
Q[3]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_1_3_stage13 [label="Ring Attention Stage 13
Q[3]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_1_3_stage14 [label="Ring Attention Stage 14
Q[3]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_1_3_stage15 [label="Ring Attention Stage 15
Q[3]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		o_proj_1_3 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=box style=filled]
		residual1_1_3 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=ellipse style=filled]
		ln2_1_3 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=ellipse style=filled]
		router_1_3 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#96CEB4" shape=hexagon style=filled]
		gate_1_3 [label="Top-2 Gating
Expert Selection" fillcolor="#96CEB4" shape=pentagon style=filled]
		expert_1_3_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_1_3_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_1_3_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_1_3_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_1_3_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_1_3_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_1_3_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_1_3_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_agg_1_3 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=ellipse style=filled]
		residual2_1_3 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=ellipse style=filled]
	}
	subgraph cluster_layer1_gpu4 {
		color="#FECA57" fillcolor="#FECA5720" label="Layer 1 - GPU 4" style=filled
		ln1_1_4 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=ellipse style=filled]
		q_proj_1_4 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=box style=filled]
		k_proj_1_4 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=box style=filled]
		v_proj_1_4 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=box style=filled]
		ring_attn_1_4_stage0 [label="Ring Attention Stage 0
Q[4]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_1_4_stage1 [label="Ring Attention Stage 1
Q[4]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_1_4_stage2 [label="Ring Attention Stage 2
Q[4]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_1_4_stage3 [label="Ring Attention Stage 3
Q[4]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_1_4_stage4 [label="Ring Attention Stage 4
Q[4]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_1_4_stage5 [label="Ring Attention Stage 5
Q[4]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_1_4_stage6 [label="Ring Attention Stage 6
Q[4]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_1_4_stage7 [label="Ring Attention Stage 7
Q[4]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_1_4_stage8 [label="Ring Attention Stage 8
Q[4]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_1_4_stage9 [label="Ring Attention Stage 9
Q[4]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_1_4_stage10 [label="Ring Attention Stage 10
Q[4]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_1_4_stage11 [label="Ring Attention Stage 11
Q[4]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_1_4_stage12 [label="Ring Attention Stage 12
Q[4]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_1_4_stage13 [label="Ring Attention Stage 13
Q[4]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_1_4_stage14 [label="Ring Attention Stage 14
Q[4]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_1_4_stage15 [label="Ring Attention Stage 15
Q[4]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		o_proj_1_4 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=box style=filled]
		residual1_1_4 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=ellipse style=filled]
		ln2_1_4 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=ellipse style=filled]
		router_1_4 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#FECA57" shape=hexagon style=filled]
		gate_1_4 [label="Top-2 Gating
Expert Selection" fillcolor="#FECA57" shape=pentagon style=filled]
		expert_1_4_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_1_4_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_1_4_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_1_4_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_1_4_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_1_4_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_1_4_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_1_4_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_agg_1_4 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=ellipse style=filled]
		residual2_1_4 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=ellipse style=filled]
	}
	subgraph cluster_layer1_gpu5 {
		color="#FF9FF3" fillcolor="#FF9FF320" label="Layer 1 - GPU 5" style=filled
		ln1_1_5 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=ellipse style=filled]
		q_proj_1_5 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=box style=filled]
		k_proj_1_5 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=box style=filled]
		v_proj_1_5 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=box style=filled]
		ring_attn_1_5_stage0 [label="Ring Attention Stage 0
Q[5]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_1_5_stage1 [label="Ring Attention Stage 1
Q[5]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_1_5_stage2 [label="Ring Attention Stage 2
Q[5]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_1_5_stage3 [label="Ring Attention Stage 3
Q[5]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_1_5_stage4 [label="Ring Attention Stage 4
Q[5]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_1_5_stage5 [label="Ring Attention Stage 5
Q[5]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_1_5_stage6 [label="Ring Attention Stage 6
Q[5]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_1_5_stage7 [label="Ring Attention Stage 7
Q[5]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_1_5_stage8 [label="Ring Attention Stage 8
Q[5]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_1_5_stage9 [label="Ring Attention Stage 9
Q[5]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_1_5_stage10 [label="Ring Attention Stage 10
Q[5]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_1_5_stage11 [label="Ring Attention Stage 11
Q[5]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_1_5_stage12 [label="Ring Attention Stage 12
Q[5]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_1_5_stage13 [label="Ring Attention Stage 13
Q[5]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_1_5_stage14 [label="Ring Attention Stage 14
Q[5]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_1_5_stage15 [label="Ring Attention Stage 15
Q[5]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		o_proj_1_5 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=box style=filled]
		residual1_1_5 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=ellipse style=filled]
		ln2_1_5 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=ellipse style=filled]
		router_1_5 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#FF9FF3" shape=hexagon style=filled]
		gate_1_5 [label="Top-2 Gating
Expert Selection" fillcolor="#FF9FF3" shape=pentagon style=filled]
		expert_1_5_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_1_5_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_1_5_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_1_5_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_1_5_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_1_5_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_1_5_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_1_5_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_agg_1_5 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=ellipse style=filled]
		residual2_1_5 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=ellipse style=filled]
	}
	subgraph cluster_layer1_gpu6 {
		color="#54A0FF" fillcolor="#54A0FF20" label="Layer 1 - GPU 6" style=filled
		ln1_1_6 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=ellipse style=filled]
		q_proj_1_6 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=box style=filled]
		k_proj_1_6 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=box style=filled]
		v_proj_1_6 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=box style=filled]
		ring_attn_1_6_stage0 [label="Ring Attention Stage 0
Q[6]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_1_6_stage1 [label="Ring Attention Stage 1
Q[6]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_1_6_stage2 [label="Ring Attention Stage 2
Q[6]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_1_6_stage3 [label="Ring Attention Stage 3
Q[6]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_1_6_stage4 [label="Ring Attention Stage 4
Q[6]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_1_6_stage5 [label="Ring Attention Stage 5
Q[6]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_1_6_stage6 [label="Ring Attention Stage 6
Q[6]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_1_6_stage7 [label="Ring Attention Stage 7
Q[6]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_1_6_stage8 [label="Ring Attention Stage 8
Q[6]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_1_6_stage9 [label="Ring Attention Stage 9
Q[6]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_1_6_stage10 [label="Ring Attention Stage 10
Q[6]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_1_6_stage11 [label="Ring Attention Stage 11
Q[6]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_1_6_stage12 [label="Ring Attention Stage 12
Q[6]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_1_6_stage13 [label="Ring Attention Stage 13
Q[6]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_1_6_stage14 [label="Ring Attention Stage 14
Q[6]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_1_6_stage15 [label="Ring Attention Stage 15
Q[6]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		o_proj_1_6 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=box style=filled]
		residual1_1_6 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=ellipse style=filled]
		ln2_1_6 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=ellipse style=filled]
		router_1_6 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#54A0FF" shape=hexagon style=filled]
		gate_1_6 [label="Top-2 Gating
Expert Selection" fillcolor="#54A0FF" shape=pentagon style=filled]
		expert_1_6_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_1_6_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_1_6_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_1_6_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_1_6_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_1_6_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_1_6_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_1_6_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_agg_1_6 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=ellipse style=filled]
		residual2_1_6 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=ellipse style=filled]
	}
	subgraph cluster_layer1_gpu7 {
		color="#5F27CD" fillcolor="#5F27CD20" label="Layer 1 - GPU 7" style=filled
		ln1_1_7 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=ellipse style=filled]
		q_proj_1_7 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=box style=filled]
		k_proj_1_7 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=box style=filled]
		v_proj_1_7 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=box style=filled]
		ring_attn_1_7_stage0 [label="Ring Attention Stage 0
Q[7]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_1_7_stage1 [label="Ring Attention Stage 1
Q[7]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_1_7_stage2 [label="Ring Attention Stage 2
Q[7]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_1_7_stage3 [label="Ring Attention Stage 3
Q[7]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_1_7_stage4 [label="Ring Attention Stage 4
Q[7]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_1_7_stage5 [label="Ring Attention Stage 5
Q[7]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_1_7_stage6 [label="Ring Attention Stage 6
Q[7]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_1_7_stage7 [label="Ring Attention Stage 7
Q[7]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_1_7_stage8 [label="Ring Attention Stage 8
Q[7]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_1_7_stage9 [label="Ring Attention Stage 9
Q[7]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_1_7_stage10 [label="Ring Attention Stage 10
Q[7]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_1_7_stage11 [label="Ring Attention Stage 11
Q[7]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_1_7_stage12 [label="Ring Attention Stage 12
Q[7]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_1_7_stage13 [label="Ring Attention Stage 13
Q[7]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_1_7_stage14 [label="Ring Attention Stage 14
Q[7]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_1_7_stage15 [label="Ring Attention Stage 15
Q[7]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		o_proj_1_7 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=box style=filled]
		residual1_1_7 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=ellipse style=filled]
		ln2_1_7 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=ellipse style=filled]
		router_1_7 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#5F27CD" shape=hexagon style=filled]
		gate_1_7 [label="Top-2 Gating
Expert Selection" fillcolor="#5F27CD" shape=pentagon style=filled]
		expert_1_7_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_1_7_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_1_7_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_1_7_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_1_7_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_1_7_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_1_7_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_1_7_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_agg_1_7 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=ellipse style=filled]
		residual2_1_7 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=ellipse style=filled]
	}
	subgraph cluster_layer1_gpu8 {
		color="#00D2D3" fillcolor="#00D2D320" label="Layer 1 - GPU 8" style=filled
		ln1_1_8 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=ellipse style=filled]
		q_proj_1_8 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=box style=filled]
		k_proj_1_8 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=box style=filled]
		v_proj_1_8 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=box style=filled]
		ring_attn_1_8_stage0 [label="Ring Attention Stage 0
Q[8]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_1_8_stage1 [label="Ring Attention Stage 1
Q[8]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_1_8_stage2 [label="Ring Attention Stage 2
Q[8]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_1_8_stage3 [label="Ring Attention Stage 3
Q[8]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_1_8_stage4 [label="Ring Attention Stage 4
Q[8]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_1_8_stage5 [label="Ring Attention Stage 5
Q[8]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_1_8_stage6 [label="Ring Attention Stage 6
Q[8]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_1_8_stage7 [label="Ring Attention Stage 7
Q[8]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_1_8_stage8 [label="Ring Attention Stage 8
Q[8]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_1_8_stage9 [label="Ring Attention Stage 9
Q[8]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_1_8_stage10 [label="Ring Attention Stage 10
Q[8]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_1_8_stage11 [label="Ring Attention Stage 11
Q[8]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_1_8_stage12 [label="Ring Attention Stage 12
Q[8]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_1_8_stage13 [label="Ring Attention Stage 13
Q[8]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_1_8_stage14 [label="Ring Attention Stage 14
Q[8]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_1_8_stage15 [label="Ring Attention Stage 15
Q[8]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		o_proj_1_8 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=box style=filled]
		residual1_1_8 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=ellipse style=filled]
		ln2_1_8 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=ellipse style=filled]
		router_1_8 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#00D2D3" shape=hexagon style=filled]
		gate_1_8 [label="Top-2 Gating
Expert Selection" fillcolor="#00D2D3" shape=pentagon style=filled]
		expert_1_8_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_1_8_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_1_8_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_1_8_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_1_8_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_1_8_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_1_8_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_1_8_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_agg_1_8 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=ellipse style=filled]
		residual2_1_8 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=ellipse style=filled]
	}
	subgraph cluster_layer1_gpu9 {
		color="#FF9F43" fillcolor="#FF9F4320" label="Layer 1 - GPU 9" style=filled
		ln1_1_9 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=ellipse style=filled]
		q_proj_1_9 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=box style=filled]
		k_proj_1_9 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=box style=filled]
		v_proj_1_9 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=box style=filled]
		ring_attn_1_9_stage0 [label="Ring Attention Stage 0
Q[9]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_1_9_stage1 [label="Ring Attention Stage 1
Q[9]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_1_9_stage2 [label="Ring Attention Stage 2
Q[9]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_1_9_stage3 [label="Ring Attention Stage 3
Q[9]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_1_9_stage4 [label="Ring Attention Stage 4
Q[9]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_1_9_stage5 [label="Ring Attention Stage 5
Q[9]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_1_9_stage6 [label="Ring Attention Stage 6
Q[9]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_1_9_stage7 [label="Ring Attention Stage 7
Q[9]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_1_9_stage8 [label="Ring Attention Stage 8
Q[9]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_1_9_stage9 [label="Ring Attention Stage 9
Q[9]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_1_9_stage10 [label="Ring Attention Stage 10
Q[9]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_1_9_stage11 [label="Ring Attention Stage 11
Q[9]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_1_9_stage12 [label="Ring Attention Stage 12
Q[9]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_1_9_stage13 [label="Ring Attention Stage 13
Q[9]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_1_9_stage14 [label="Ring Attention Stage 14
Q[9]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_1_9_stage15 [label="Ring Attention Stage 15
Q[9]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		o_proj_1_9 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=box style=filled]
		residual1_1_9 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=ellipse style=filled]
		ln2_1_9 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=ellipse style=filled]
		router_1_9 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#FF9F43" shape=hexagon style=filled]
		gate_1_9 [label="Top-2 Gating
Expert Selection" fillcolor="#FF9F43" shape=pentagon style=filled]
		expert_1_9_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_1_9_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_1_9_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_1_9_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_1_9_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_1_9_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_1_9_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_1_9_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_agg_1_9 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=ellipse style=filled]
		residual2_1_9 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=ellipse style=filled]
	}
	subgraph cluster_layer1_gpu10 {
		color="#10AC84" fillcolor="#10AC8420" label="Layer 1 - GPU 10" style=filled
		ln1_1_10 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=ellipse style=filled]
		q_proj_1_10 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=box style=filled]
		k_proj_1_10 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=box style=filled]
		v_proj_1_10 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=box style=filled]
		ring_attn_1_10_stage0 [label="Ring Attention Stage 0
Q[10]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_1_10_stage1 [label="Ring Attention Stage 1
Q[10]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_1_10_stage2 [label="Ring Attention Stage 2
Q[10]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_1_10_stage3 [label="Ring Attention Stage 3
Q[10]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_1_10_stage4 [label="Ring Attention Stage 4
Q[10]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_1_10_stage5 [label="Ring Attention Stage 5
Q[10]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_1_10_stage6 [label="Ring Attention Stage 6
Q[10]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_1_10_stage7 [label="Ring Attention Stage 7
Q[10]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_1_10_stage8 [label="Ring Attention Stage 8
Q[10]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_1_10_stage9 [label="Ring Attention Stage 9
Q[10]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_1_10_stage10 [label="Ring Attention Stage 10
Q[10]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_1_10_stage11 [label="Ring Attention Stage 11
Q[10]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_1_10_stage12 [label="Ring Attention Stage 12
Q[10]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_1_10_stage13 [label="Ring Attention Stage 13
Q[10]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_1_10_stage14 [label="Ring Attention Stage 14
Q[10]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_1_10_stage15 [label="Ring Attention Stage 15
Q[10]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		o_proj_1_10 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=box style=filled]
		residual1_1_10 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=ellipse style=filled]
		ln2_1_10 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=ellipse style=filled]
		router_1_10 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#10AC84" shape=hexagon style=filled]
		gate_1_10 [label="Top-2 Gating
Expert Selection" fillcolor="#10AC84" shape=pentagon style=filled]
		expert_1_10_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_1_10_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_1_10_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_1_10_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_1_10_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_1_10_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_1_10_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_1_10_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_agg_1_10 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=ellipse style=filled]
		residual2_1_10 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=ellipse style=filled]
	}
	subgraph cluster_layer1_gpu11 {
		color="#EE5A24" fillcolor="#EE5A2420" label="Layer 1 - GPU 11" style=filled
		ln1_1_11 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=ellipse style=filled]
		q_proj_1_11 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=box style=filled]
		k_proj_1_11 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=box style=filled]
		v_proj_1_11 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=box style=filled]
		ring_attn_1_11_stage0 [label="Ring Attention Stage 0
Q[11]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_1_11_stage1 [label="Ring Attention Stage 1
Q[11]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_1_11_stage2 [label="Ring Attention Stage 2
Q[11]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_1_11_stage3 [label="Ring Attention Stage 3
Q[11]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_1_11_stage4 [label="Ring Attention Stage 4
Q[11]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_1_11_stage5 [label="Ring Attention Stage 5
Q[11]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_1_11_stage6 [label="Ring Attention Stage 6
Q[11]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_1_11_stage7 [label="Ring Attention Stage 7
Q[11]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_1_11_stage8 [label="Ring Attention Stage 8
Q[11]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_1_11_stage9 [label="Ring Attention Stage 9
Q[11]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_1_11_stage10 [label="Ring Attention Stage 10
Q[11]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_1_11_stage11 [label="Ring Attention Stage 11
Q[11]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_1_11_stage12 [label="Ring Attention Stage 12
Q[11]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_1_11_stage13 [label="Ring Attention Stage 13
Q[11]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_1_11_stage14 [label="Ring Attention Stage 14
Q[11]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_1_11_stage15 [label="Ring Attention Stage 15
Q[11]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		o_proj_1_11 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=box style=filled]
		residual1_1_11 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=ellipse style=filled]
		ln2_1_11 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=ellipse style=filled]
		router_1_11 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#EE5A24" shape=hexagon style=filled]
		gate_1_11 [label="Top-2 Gating
Expert Selection" fillcolor="#EE5A24" shape=pentagon style=filled]
		expert_1_11_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_1_11_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_1_11_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_1_11_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_1_11_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_1_11_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_1_11_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_1_11_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_agg_1_11 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=ellipse style=filled]
		residual2_1_11 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=ellipse style=filled]
	}
	subgraph cluster_layer1_gpu12 {
		color="#0652DD" fillcolor="#0652DD20" label="Layer 1 - GPU 12" style=filled
		ln1_1_12 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=ellipse style=filled]
		q_proj_1_12 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=box style=filled]
		k_proj_1_12 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=box style=filled]
		v_proj_1_12 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=box style=filled]
		ring_attn_1_12_stage0 [label="Ring Attention Stage 0
Q[12]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_1_12_stage1 [label="Ring Attention Stage 1
Q[12]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_1_12_stage2 [label="Ring Attention Stage 2
Q[12]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_1_12_stage3 [label="Ring Attention Stage 3
Q[12]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_1_12_stage4 [label="Ring Attention Stage 4
Q[12]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_1_12_stage5 [label="Ring Attention Stage 5
Q[12]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_1_12_stage6 [label="Ring Attention Stage 6
Q[12]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_1_12_stage7 [label="Ring Attention Stage 7
Q[12]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_1_12_stage8 [label="Ring Attention Stage 8
Q[12]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_1_12_stage9 [label="Ring Attention Stage 9
Q[12]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_1_12_stage10 [label="Ring Attention Stage 10
Q[12]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_1_12_stage11 [label="Ring Attention Stage 11
Q[12]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_1_12_stage12 [label="Ring Attention Stage 12
Q[12]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_1_12_stage13 [label="Ring Attention Stage 13
Q[12]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_1_12_stage14 [label="Ring Attention Stage 14
Q[12]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_1_12_stage15 [label="Ring Attention Stage 15
Q[12]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		o_proj_1_12 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=box style=filled]
		residual1_1_12 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=ellipse style=filled]
		ln2_1_12 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=ellipse style=filled]
		router_1_12 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#0652DD" shape=hexagon style=filled]
		gate_1_12 [label="Top-2 Gating
Expert Selection" fillcolor="#0652DD" shape=pentagon style=filled]
		expert_1_12_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_1_12_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_1_12_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_1_12_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_1_12_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_1_12_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_1_12_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_1_12_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_agg_1_12 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=ellipse style=filled]
		residual2_1_12 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=ellipse style=filled]
	}
	subgraph cluster_layer1_gpu13 {
		color="#9980FA" fillcolor="#9980FA20" label="Layer 1 - GPU 13" style=filled
		ln1_1_13 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=ellipse style=filled]
		q_proj_1_13 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=box style=filled]
		k_proj_1_13 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=box style=filled]
		v_proj_1_13 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=box style=filled]
		ring_attn_1_13_stage0 [label="Ring Attention Stage 0
Q[13]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_1_13_stage1 [label="Ring Attention Stage 1
Q[13]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_1_13_stage2 [label="Ring Attention Stage 2
Q[13]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_1_13_stage3 [label="Ring Attention Stage 3
Q[13]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_1_13_stage4 [label="Ring Attention Stage 4
Q[13]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_1_13_stage5 [label="Ring Attention Stage 5
Q[13]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_1_13_stage6 [label="Ring Attention Stage 6
Q[13]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_1_13_stage7 [label="Ring Attention Stage 7
Q[13]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_1_13_stage8 [label="Ring Attention Stage 8
Q[13]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_1_13_stage9 [label="Ring Attention Stage 9
Q[13]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_1_13_stage10 [label="Ring Attention Stage 10
Q[13]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_1_13_stage11 [label="Ring Attention Stage 11
Q[13]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_1_13_stage12 [label="Ring Attention Stage 12
Q[13]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_1_13_stage13 [label="Ring Attention Stage 13
Q[13]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_1_13_stage14 [label="Ring Attention Stage 14
Q[13]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_1_13_stage15 [label="Ring Attention Stage 15
Q[13]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		o_proj_1_13 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=box style=filled]
		residual1_1_13 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=ellipse style=filled]
		ln2_1_13 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=ellipse style=filled]
		router_1_13 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#9980FA" shape=hexagon style=filled]
		gate_1_13 [label="Top-2 Gating
Expert Selection" fillcolor="#9980FA" shape=pentagon style=filled]
		expert_1_13_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_1_13_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_1_13_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_1_13_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_1_13_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_1_13_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_1_13_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_1_13_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_agg_1_13 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=ellipse style=filled]
		residual2_1_13 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=ellipse style=filled]
	}
	subgraph cluster_layer1_gpu14 {
		color="#D63031" fillcolor="#D6303120" label="Layer 1 - GPU 14" style=filled
		ln1_1_14 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=ellipse style=filled]
		q_proj_1_14 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=box style=filled]
		k_proj_1_14 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=box style=filled]
		v_proj_1_14 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=box style=filled]
		ring_attn_1_14_stage0 [label="Ring Attention Stage 0
Q[14]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_1_14_stage1 [label="Ring Attention Stage 1
Q[14]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_1_14_stage2 [label="Ring Attention Stage 2
Q[14]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_1_14_stage3 [label="Ring Attention Stage 3
Q[14]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_1_14_stage4 [label="Ring Attention Stage 4
Q[14]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_1_14_stage5 [label="Ring Attention Stage 5
Q[14]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_1_14_stage6 [label="Ring Attention Stage 6
Q[14]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_1_14_stage7 [label="Ring Attention Stage 7
Q[14]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_1_14_stage8 [label="Ring Attention Stage 8
Q[14]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_1_14_stage9 [label="Ring Attention Stage 9
Q[14]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_1_14_stage10 [label="Ring Attention Stage 10
Q[14]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_1_14_stage11 [label="Ring Attention Stage 11
Q[14]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_1_14_stage12 [label="Ring Attention Stage 12
Q[14]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_1_14_stage13 [label="Ring Attention Stage 13
Q[14]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_1_14_stage14 [label="Ring Attention Stage 14
Q[14]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_1_14_stage15 [label="Ring Attention Stage 15
Q[14]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		o_proj_1_14 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=box style=filled]
		residual1_1_14 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=ellipse style=filled]
		ln2_1_14 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=ellipse style=filled]
		router_1_14 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#D63031" shape=hexagon style=filled]
		gate_1_14 [label="Top-2 Gating
Expert Selection" fillcolor="#D63031" shape=pentagon style=filled]
		expert_1_14_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_1_14_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_1_14_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_1_14_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_1_14_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_1_14_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_1_14_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_1_14_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_agg_1_14 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=ellipse style=filled]
		residual2_1_14 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=ellipse style=filled]
	}
	subgraph cluster_layer1_gpu15 {
		color="#74B9FF" fillcolor="#74B9FF20" label="Layer 1 - GPU 15" style=filled
		ln1_1_15 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=ellipse style=filled]
		q_proj_1_15 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=box style=filled]
		k_proj_1_15 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=box style=filled]
		v_proj_1_15 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=box style=filled]
		ring_attn_1_15_stage0 [label="Ring Attention Stage 0
Q[15]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_1_15_stage1 [label="Ring Attention Stage 1
Q[15]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_1_15_stage2 [label="Ring Attention Stage 2
Q[15]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_1_15_stage3 [label="Ring Attention Stage 3
Q[15]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_1_15_stage4 [label="Ring Attention Stage 4
Q[15]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_1_15_stage5 [label="Ring Attention Stage 5
Q[15]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_1_15_stage6 [label="Ring Attention Stage 6
Q[15]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_1_15_stage7 [label="Ring Attention Stage 7
Q[15]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_1_15_stage8 [label="Ring Attention Stage 8
Q[15]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_1_15_stage9 [label="Ring Attention Stage 9
Q[15]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_1_15_stage10 [label="Ring Attention Stage 10
Q[15]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_1_15_stage11 [label="Ring Attention Stage 11
Q[15]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_1_15_stage12 [label="Ring Attention Stage 12
Q[15]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_1_15_stage13 [label="Ring Attention Stage 13
Q[15]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_1_15_stage14 [label="Ring Attention Stage 14
Q[15]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_1_15_stage15 [label="Ring Attention Stage 15
Q[15]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		o_proj_1_15 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=box style=filled]
		residual1_1_15 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=ellipse style=filled]
		ln2_1_15 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=ellipse style=filled]
		router_1_15 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#74B9FF" shape=hexagon style=filled]
		gate_1_15 [label="Top-2 Gating
Expert Selection" fillcolor="#74B9FF" shape=pentagon style=filled]
		expert_1_15_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_1_15_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_1_15_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_1_15_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_1_15_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_1_15_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_1_15_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_1_15_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_agg_1_15 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=ellipse style=filled]
		residual2_1_15 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=ellipse style=filled]
	}
	subgraph cluster_layer2_gpu0 {
		color="#FF6B6B" fillcolor="#FF6B6B20" label="Layer 2 - GPU 0" style=filled
		ln1_2_0 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=ellipse style=filled]
		q_proj_2_0 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=box style=filled]
		k_proj_2_0 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=box style=filled]
		v_proj_2_0 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=box style=filled]
		ring_attn_2_0_stage0 [label="Ring Attention Stage 0
Q[0]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_2_0_stage1 [label="Ring Attention Stage 1
Q[0]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_2_0_stage2 [label="Ring Attention Stage 2
Q[0]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_2_0_stage3 [label="Ring Attention Stage 3
Q[0]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_2_0_stage4 [label="Ring Attention Stage 4
Q[0]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_2_0_stage5 [label="Ring Attention Stage 5
Q[0]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_2_0_stage6 [label="Ring Attention Stage 6
Q[0]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_2_0_stage7 [label="Ring Attention Stage 7
Q[0]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_2_0_stage8 [label="Ring Attention Stage 8
Q[0]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_2_0_stage9 [label="Ring Attention Stage 9
Q[0]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_2_0_stage10 [label="Ring Attention Stage 10
Q[0]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_2_0_stage11 [label="Ring Attention Stage 11
Q[0]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_2_0_stage12 [label="Ring Attention Stage 12
Q[0]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_2_0_stage13 [label="Ring Attention Stage 13
Q[0]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_2_0_stage14 [label="Ring Attention Stage 14
Q[0]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_2_0_stage15 [label="Ring Attention Stage 15
Q[0]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		o_proj_2_0 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=box style=filled]
		residual1_2_0 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=ellipse style=filled]
		ln2_2_0 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=ellipse style=filled]
		router_2_0 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#FF6B6B" shape=hexagon style=filled]
		gate_2_0 [label="Top-2 Gating
Expert Selection" fillcolor="#FF6B6B" shape=pentagon style=filled]
		expert_2_0_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_2_0_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_2_0_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_2_0_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_2_0_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_2_0_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_2_0_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_2_0_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_agg_2_0 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=ellipse style=filled]
		residual2_2_0 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=ellipse style=filled]
	}
	subgraph cluster_layer2_gpu1 {
		color="#4ECDC4" fillcolor="#4ECDC420" label="Layer 2 - GPU 1" style=filled
		ln1_2_1 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=ellipse style=filled]
		q_proj_2_1 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=box style=filled]
		k_proj_2_1 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=box style=filled]
		v_proj_2_1 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=box style=filled]
		ring_attn_2_1_stage0 [label="Ring Attention Stage 0
Q[1]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_2_1_stage1 [label="Ring Attention Stage 1
Q[1]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_2_1_stage2 [label="Ring Attention Stage 2
Q[1]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_2_1_stage3 [label="Ring Attention Stage 3
Q[1]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_2_1_stage4 [label="Ring Attention Stage 4
Q[1]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_2_1_stage5 [label="Ring Attention Stage 5
Q[1]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_2_1_stage6 [label="Ring Attention Stage 6
Q[1]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_2_1_stage7 [label="Ring Attention Stage 7
Q[1]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_2_1_stage8 [label="Ring Attention Stage 8
Q[1]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_2_1_stage9 [label="Ring Attention Stage 9
Q[1]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_2_1_stage10 [label="Ring Attention Stage 10
Q[1]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_2_1_stage11 [label="Ring Attention Stage 11
Q[1]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_2_1_stage12 [label="Ring Attention Stage 12
Q[1]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_2_1_stage13 [label="Ring Attention Stage 13
Q[1]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_2_1_stage14 [label="Ring Attention Stage 14
Q[1]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_2_1_stage15 [label="Ring Attention Stage 15
Q[1]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		o_proj_2_1 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=box style=filled]
		residual1_2_1 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=ellipse style=filled]
		ln2_2_1 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=ellipse style=filled]
		router_2_1 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#4ECDC4" shape=hexagon style=filled]
		gate_2_1 [label="Top-2 Gating
Expert Selection" fillcolor="#4ECDC4" shape=pentagon style=filled]
		expert_2_1_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_2_1_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_2_1_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_2_1_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_2_1_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_2_1_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_2_1_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_2_1_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_agg_2_1 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=ellipse style=filled]
		residual2_2_1 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=ellipse style=filled]
	}
	subgraph cluster_layer2_gpu2 {
		color="#45B7D1" fillcolor="#45B7D120" label="Layer 2 - GPU 2" style=filled
		ln1_2_2 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=ellipse style=filled]
		q_proj_2_2 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=box style=filled]
		k_proj_2_2 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=box style=filled]
		v_proj_2_2 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=box style=filled]
		ring_attn_2_2_stage0 [label="Ring Attention Stage 0
Q[2]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_2_2_stage1 [label="Ring Attention Stage 1
Q[2]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_2_2_stage2 [label="Ring Attention Stage 2
Q[2]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_2_2_stage3 [label="Ring Attention Stage 3
Q[2]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_2_2_stage4 [label="Ring Attention Stage 4
Q[2]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_2_2_stage5 [label="Ring Attention Stage 5
Q[2]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_2_2_stage6 [label="Ring Attention Stage 6
Q[2]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_2_2_stage7 [label="Ring Attention Stage 7
Q[2]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_2_2_stage8 [label="Ring Attention Stage 8
Q[2]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_2_2_stage9 [label="Ring Attention Stage 9
Q[2]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_2_2_stage10 [label="Ring Attention Stage 10
Q[2]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_2_2_stage11 [label="Ring Attention Stage 11
Q[2]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_2_2_stage12 [label="Ring Attention Stage 12
Q[2]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_2_2_stage13 [label="Ring Attention Stage 13
Q[2]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_2_2_stage14 [label="Ring Attention Stage 14
Q[2]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_2_2_stage15 [label="Ring Attention Stage 15
Q[2]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		o_proj_2_2 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=box style=filled]
		residual1_2_2 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=ellipse style=filled]
		ln2_2_2 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=ellipse style=filled]
		router_2_2 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#45B7D1" shape=hexagon style=filled]
		gate_2_2 [label="Top-2 Gating
Expert Selection" fillcolor="#45B7D1" shape=pentagon style=filled]
		expert_2_2_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_2_2_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_2_2_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_2_2_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_2_2_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_2_2_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_2_2_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_2_2_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_agg_2_2 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=ellipse style=filled]
		residual2_2_2 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=ellipse style=filled]
	}
	subgraph cluster_layer2_gpu3 {
		color="#96CEB4" fillcolor="#96CEB420" label="Layer 2 - GPU 3" style=filled
		ln1_2_3 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=ellipse style=filled]
		q_proj_2_3 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=box style=filled]
		k_proj_2_3 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=box style=filled]
		v_proj_2_3 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=box style=filled]
		ring_attn_2_3_stage0 [label="Ring Attention Stage 0
Q[3]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_2_3_stage1 [label="Ring Attention Stage 1
Q[3]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_2_3_stage2 [label="Ring Attention Stage 2
Q[3]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_2_3_stage3 [label="Ring Attention Stage 3
Q[3]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_2_3_stage4 [label="Ring Attention Stage 4
Q[3]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_2_3_stage5 [label="Ring Attention Stage 5
Q[3]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_2_3_stage6 [label="Ring Attention Stage 6
Q[3]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_2_3_stage7 [label="Ring Attention Stage 7
Q[3]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_2_3_stage8 [label="Ring Attention Stage 8
Q[3]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_2_3_stage9 [label="Ring Attention Stage 9
Q[3]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_2_3_stage10 [label="Ring Attention Stage 10
Q[3]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_2_3_stage11 [label="Ring Attention Stage 11
Q[3]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_2_3_stage12 [label="Ring Attention Stage 12
Q[3]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_2_3_stage13 [label="Ring Attention Stage 13
Q[3]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_2_3_stage14 [label="Ring Attention Stage 14
Q[3]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_2_3_stage15 [label="Ring Attention Stage 15
Q[3]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		o_proj_2_3 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=box style=filled]
		residual1_2_3 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=ellipse style=filled]
		ln2_2_3 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=ellipse style=filled]
		router_2_3 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#96CEB4" shape=hexagon style=filled]
		gate_2_3 [label="Top-2 Gating
Expert Selection" fillcolor="#96CEB4" shape=pentagon style=filled]
		expert_2_3_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_2_3_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_2_3_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_2_3_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_2_3_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_2_3_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_2_3_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_2_3_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_agg_2_3 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=ellipse style=filled]
		residual2_2_3 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=ellipse style=filled]
	}
	subgraph cluster_layer2_gpu4 {
		color="#FECA57" fillcolor="#FECA5720" label="Layer 2 - GPU 4" style=filled
		ln1_2_4 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=ellipse style=filled]
		q_proj_2_4 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=box style=filled]
		k_proj_2_4 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=box style=filled]
		v_proj_2_4 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=box style=filled]
		ring_attn_2_4_stage0 [label="Ring Attention Stage 0
Q[4]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_2_4_stage1 [label="Ring Attention Stage 1
Q[4]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_2_4_stage2 [label="Ring Attention Stage 2
Q[4]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_2_4_stage3 [label="Ring Attention Stage 3
Q[4]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_2_4_stage4 [label="Ring Attention Stage 4
Q[4]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_2_4_stage5 [label="Ring Attention Stage 5
Q[4]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_2_4_stage6 [label="Ring Attention Stage 6
Q[4]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_2_4_stage7 [label="Ring Attention Stage 7
Q[4]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_2_4_stage8 [label="Ring Attention Stage 8
Q[4]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_2_4_stage9 [label="Ring Attention Stage 9
Q[4]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_2_4_stage10 [label="Ring Attention Stage 10
Q[4]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_2_4_stage11 [label="Ring Attention Stage 11
Q[4]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_2_4_stage12 [label="Ring Attention Stage 12
Q[4]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_2_4_stage13 [label="Ring Attention Stage 13
Q[4]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_2_4_stage14 [label="Ring Attention Stage 14
Q[4]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_2_4_stage15 [label="Ring Attention Stage 15
Q[4]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		o_proj_2_4 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=box style=filled]
		residual1_2_4 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=ellipse style=filled]
		ln2_2_4 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=ellipse style=filled]
		router_2_4 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#FECA57" shape=hexagon style=filled]
		gate_2_4 [label="Top-2 Gating
Expert Selection" fillcolor="#FECA57" shape=pentagon style=filled]
		expert_2_4_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_2_4_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_2_4_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_2_4_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_2_4_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_2_4_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_2_4_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_2_4_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_agg_2_4 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=ellipse style=filled]
		residual2_2_4 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=ellipse style=filled]
	}
	subgraph cluster_layer2_gpu5 {
		color="#FF9FF3" fillcolor="#FF9FF320" label="Layer 2 - GPU 5" style=filled
		ln1_2_5 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=ellipse style=filled]
		q_proj_2_5 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=box style=filled]
		k_proj_2_5 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=box style=filled]
		v_proj_2_5 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=box style=filled]
		ring_attn_2_5_stage0 [label="Ring Attention Stage 0
Q[5]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_2_5_stage1 [label="Ring Attention Stage 1
Q[5]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_2_5_stage2 [label="Ring Attention Stage 2
Q[5]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_2_5_stage3 [label="Ring Attention Stage 3
Q[5]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_2_5_stage4 [label="Ring Attention Stage 4
Q[5]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_2_5_stage5 [label="Ring Attention Stage 5
Q[5]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_2_5_stage6 [label="Ring Attention Stage 6
Q[5]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_2_5_stage7 [label="Ring Attention Stage 7
Q[5]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_2_5_stage8 [label="Ring Attention Stage 8
Q[5]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_2_5_stage9 [label="Ring Attention Stage 9
Q[5]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_2_5_stage10 [label="Ring Attention Stage 10
Q[5]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_2_5_stage11 [label="Ring Attention Stage 11
Q[5]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_2_5_stage12 [label="Ring Attention Stage 12
Q[5]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_2_5_stage13 [label="Ring Attention Stage 13
Q[5]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_2_5_stage14 [label="Ring Attention Stage 14
Q[5]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_2_5_stage15 [label="Ring Attention Stage 15
Q[5]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		o_proj_2_5 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=box style=filled]
		residual1_2_5 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=ellipse style=filled]
		ln2_2_5 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=ellipse style=filled]
		router_2_5 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#FF9FF3" shape=hexagon style=filled]
		gate_2_5 [label="Top-2 Gating
Expert Selection" fillcolor="#FF9FF3" shape=pentagon style=filled]
		expert_2_5_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_2_5_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_2_5_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_2_5_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_2_5_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_2_5_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_2_5_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_2_5_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_agg_2_5 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=ellipse style=filled]
		residual2_2_5 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=ellipse style=filled]
	}
	subgraph cluster_layer2_gpu6 {
		color="#54A0FF" fillcolor="#54A0FF20" label="Layer 2 - GPU 6" style=filled
		ln1_2_6 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=ellipse style=filled]
		q_proj_2_6 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=box style=filled]
		k_proj_2_6 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=box style=filled]
		v_proj_2_6 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=box style=filled]
		ring_attn_2_6_stage0 [label="Ring Attention Stage 0
Q[6]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_2_6_stage1 [label="Ring Attention Stage 1
Q[6]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_2_6_stage2 [label="Ring Attention Stage 2
Q[6]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_2_6_stage3 [label="Ring Attention Stage 3
Q[6]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_2_6_stage4 [label="Ring Attention Stage 4
Q[6]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_2_6_stage5 [label="Ring Attention Stage 5
Q[6]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_2_6_stage6 [label="Ring Attention Stage 6
Q[6]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_2_6_stage7 [label="Ring Attention Stage 7
Q[6]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_2_6_stage8 [label="Ring Attention Stage 8
Q[6]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_2_6_stage9 [label="Ring Attention Stage 9
Q[6]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_2_6_stage10 [label="Ring Attention Stage 10
Q[6]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_2_6_stage11 [label="Ring Attention Stage 11
Q[6]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_2_6_stage12 [label="Ring Attention Stage 12
Q[6]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_2_6_stage13 [label="Ring Attention Stage 13
Q[6]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_2_6_stage14 [label="Ring Attention Stage 14
Q[6]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_2_6_stage15 [label="Ring Attention Stage 15
Q[6]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		o_proj_2_6 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=box style=filled]
		residual1_2_6 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=ellipse style=filled]
		ln2_2_6 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=ellipse style=filled]
		router_2_6 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#54A0FF" shape=hexagon style=filled]
		gate_2_6 [label="Top-2 Gating
Expert Selection" fillcolor="#54A0FF" shape=pentagon style=filled]
		expert_2_6_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_2_6_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_2_6_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_2_6_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_2_6_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_2_6_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_2_6_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_2_6_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_agg_2_6 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=ellipse style=filled]
		residual2_2_6 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=ellipse style=filled]
	}
	subgraph cluster_layer2_gpu7 {
		color="#5F27CD" fillcolor="#5F27CD20" label="Layer 2 - GPU 7" style=filled
		ln1_2_7 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=ellipse style=filled]
		q_proj_2_7 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=box style=filled]
		k_proj_2_7 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=box style=filled]
		v_proj_2_7 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=box style=filled]
		ring_attn_2_7_stage0 [label="Ring Attention Stage 0
Q[7]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_2_7_stage1 [label="Ring Attention Stage 1
Q[7]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_2_7_stage2 [label="Ring Attention Stage 2
Q[7]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_2_7_stage3 [label="Ring Attention Stage 3
Q[7]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_2_7_stage4 [label="Ring Attention Stage 4
Q[7]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_2_7_stage5 [label="Ring Attention Stage 5
Q[7]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_2_7_stage6 [label="Ring Attention Stage 6
Q[7]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_2_7_stage7 [label="Ring Attention Stage 7
Q[7]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_2_7_stage8 [label="Ring Attention Stage 8
Q[7]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_2_7_stage9 [label="Ring Attention Stage 9
Q[7]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_2_7_stage10 [label="Ring Attention Stage 10
Q[7]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_2_7_stage11 [label="Ring Attention Stage 11
Q[7]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_2_7_stage12 [label="Ring Attention Stage 12
Q[7]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_2_7_stage13 [label="Ring Attention Stage 13
Q[7]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_2_7_stage14 [label="Ring Attention Stage 14
Q[7]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_2_7_stage15 [label="Ring Attention Stage 15
Q[7]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		o_proj_2_7 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=box style=filled]
		residual1_2_7 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=ellipse style=filled]
		ln2_2_7 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=ellipse style=filled]
		router_2_7 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#5F27CD" shape=hexagon style=filled]
		gate_2_7 [label="Top-2 Gating
Expert Selection" fillcolor="#5F27CD" shape=pentagon style=filled]
		expert_2_7_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_2_7_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_2_7_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_2_7_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_2_7_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_2_7_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_2_7_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_2_7_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_agg_2_7 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=ellipse style=filled]
		residual2_2_7 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=ellipse style=filled]
	}
	subgraph cluster_layer2_gpu8 {
		color="#00D2D3" fillcolor="#00D2D320" label="Layer 2 - GPU 8" style=filled
		ln1_2_8 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=ellipse style=filled]
		q_proj_2_8 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=box style=filled]
		k_proj_2_8 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=box style=filled]
		v_proj_2_8 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=box style=filled]
		ring_attn_2_8_stage0 [label="Ring Attention Stage 0
Q[8]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_2_8_stage1 [label="Ring Attention Stage 1
Q[8]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_2_8_stage2 [label="Ring Attention Stage 2
Q[8]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_2_8_stage3 [label="Ring Attention Stage 3
Q[8]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_2_8_stage4 [label="Ring Attention Stage 4
Q[8]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_2_8_stage5 [label="Ring Attention Stage 5
Q[8]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_2_8_stage6 [label="Ring Attention Stage 6
Q[8]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_2_8_stage7 [label="Ring Attention Stage 7
Q[8]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_2_8_stage8 [label="Ring Attention Stage 8
Q[8]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_2_8_stage9 [label="Ring Attention Stage 9
Q[8]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_2_8_stage10 [label="Ring Attention Stage 10
Q[8]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_2_8_stage11 [label="Ring Attention Stage 11
Q[8]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_2_8_stage12 [label="Ring Attention Stage 12
Q[8]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_2_8_stage13 [label="Ring Attention Stage 13
Q[8]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_2_8_stage14 [label="Ring Attention Stage 14
Q[8]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_2_8_stage15 [label="Ring Attention Stage 15
Q[8]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		o_proj_2_8 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=box style=filled]
		residual1_2_8 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=ellipse style=filled]
		ln2_2_8 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=ellipse style=filled]
		router_2_8 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#00D2D3" shape=hexagon style=filled]
		gate_2_8 [label="Top-2 Gating
Expert Selection" fillcolor="#00D2D3" shape=pentagon style=filled]
		expert_2_8_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_2_8_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_2_8_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_2_8_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_2_8_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_2_8_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_2_8_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_2_8_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_agg_2_8 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=ellipse style=filled]
		residual2_2_8 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=ellipse style=filled]
	}
	subgraph cluster_layer2_gpu9 {
		color="#FF9F43" fillcolor="#FF9F4320" label="Layer 2 - GPU 9" style=filled
		ln1_2_9 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=ellipse style=filled]
		q_proj_2_9 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=box style=filled]
		k_proj_2_9 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=box style=filled]
		v_proj_2_9 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=box style=filled]
		ring_attn_2_9_stage0 [label="Ring Attention Stage 0
Q[9]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_2_9_stage1 [label="Ring Attention Stage 1
Q[9]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_2_9_stage2 [label="Ring Attention Stage 2
Q[9]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_2_9_stage3 [label="Ring Attention Stage 3
Q[9]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_2_9_stage4 [label="Ring Attention Stage 4
Q[9]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_2_9_stage5 [label="Ring Attention Stage 5
Q[9]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_2_9_stage6 [label="Ring Attention Stage 6
Q[9]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_2_9_stage7 [label="Ring Attention Stage 7
Q[9]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_2_9_stage8 [label="Ring Attention Stage 8
Q[9]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_2_9_stage9 [label="Ring Attention Stage 9
Q[9]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_2_9_stage10 [label="Ring Attention Stage 10
Q[9]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_2_9_stage11 [label="Ring Attention Stage 11
Q[9]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_2_9_stage12 [label="Ring Attention Stage 12
Q[9]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_2_9_stage13 [label="Ring Attention Stage 13
Q[9]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_2_9_stage14 [label="Ring Attention Stage 14
Q[9]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_2_9_stage15 [label="Ring Attention Stage 15
Q[9]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		o_proj_2_9 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=box style=filled]
		residual1_2_9 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=ellipse style=filled]
		ln2_2_9 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=ellipse style=filled]
		router_2_9 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#FF9F43" shape=hexagon style=filled]
		gate_2_9 [label="Top-2 Gating
Expert Selection" fillcolor="#FF9F43" shape=pentagon style=filled]
		expert_2_9_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_2_9_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_2_9_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_2_9_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_2_9_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_2_9_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_2_9_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_2_9_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_agg_2_9 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=ellipse style=filled]
		residual2_2_9 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=ellipse style=filled]
	}
	subgraph cluster_layer2_gpu10 {
		color="#10AC84" fillcolor="#10AC8420" label="Layer 2 - GPU 10" style=filled
		ln1_2_10 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=ellipse style=filled]
		q_proj_2_10 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=box style=filled]
		k_proj_2_10 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=box style=filled]
		v_proj_2_10 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=box style=filled]
		ring_attn_2_10_stage0 [label="Ring Attention Stage 0
Q[10]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_2_10_stage1 [label="Ring Attention Stage 1
Q[10]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_2_10_stage2 [label="Ring Attention Stage 2
Q[10]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_2_10_stage3 [label="Ring Attention Stage 3
Q[10]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_2_10_stage4 [label="Ring Attention Stage 4
Q[10]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_2_10_stage5 [label="Ring Attention Stage 5
Q[10]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_2_10_stage6 [label="Ring Attention Stage 6
Q[10]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_2_10_stage7 [label="Ring Attention Stage 7
Q[10]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_2_10_stage8 [label="Ring Attention Stage 8
Q[10]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_2_10_stage9 [label="Ring Attention Stage 9
Q[10]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_2_10_stage10 [label="Ring Attention Stage 10
Q[10]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_2_10_stage11 [label="Ring Attention Stage 11
Q[10]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_2_10_stage12 [label="Ring Attention Stage 12
Q[10]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_2_10_stage13 [label="Ring Attention Stage 13
Q[10]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_2_10_stage14 [label="Ring Attention Stage 14
Q[10]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_2_10_stage15 [label="Ring Attention Stage 15
Q[10]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		o_proj_2_10 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=box style=filled]
		residual1_2_10 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=ellipse style=filled]
		ln2_2_10 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=ellipse style=filled]
		router_2_10 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#10AC84" shape=hexagon style=filled]
		gate_2_10 [label="Top-2 Gating
Expert Selection" fillcolor="#10AC84" shape=pentagon style=filled]
		expert_2_10_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_2_10_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_2_10_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_2_10_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_2_10_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_2_10_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_2_10_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_2_10_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_agg_2_10 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=ellipse style=filled]
		residual2_2_10 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=ellipse style=filled]
	}
	subgraph cluster_layer2_gpu11 {
		color="#EE5A24" fillcolor="#EE5A2420" label="Layer 2 - GPU 11" style=filled
		ln1_2_11 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=ellipse style=filled]
		q_proj_2_11 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=box style=filled]
		k_proj_2_11 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=box style=filled]
		v_proj_2_11 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=box style=filled]
		ring_attn_2_11_stage0 [label="Ring Attention Stage 0
Q[11]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_2_11_stage1 [label="Ring Attention Stage 1
Q[11]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_2_11_stage2 [label="Ring Attention Stage 2
Q[11]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_2_11_stage3 [label="Ring Attention Stage 3
Q[11]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_2_11_stage4 [label="Ring Attention Stage 4
Q[11]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_2_11_stage5 [label="Ring Attention Stage 5
Q[11]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_2_11_stage6 [label="Ring Attention Stage 6
Q[11]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_2_11_stage7 [label="Ring Attention Stage 7
Q[11]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_2_11_stage8 [label="Ring Attention Stage 8
Q[11]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_2_11_stage9 [label="Ring Attention Stage 9
Q[11]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_2_11_stage10 [label="Ring Attention Stage 10
Q[11]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_2_11_stage11 [label="Ring Attention Stage 11
Q[11]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_2_11_stage12 [label="Ring Attention Stage 12
Q[11]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_2_11_stage13 [label="Ring Attention Stage 13
Q[11]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_2_11_stage14 [label="Ring Attention Stage 14
Q[11]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_2_11_stage15 [label="Ring Attention Stage 15
Q[11]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		o_proj_2_11 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=box style=filled]
		residual1_2_11 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=ellipse style=filled]
		ln2_2_11 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=ellipse style=filled]
		router_2_11 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#EE5A24" shape=hexagon style=filled]
		gate_2_11 [label="Top-2 Gating
Expert Selection" fillcolor="#EE5A24" shape=pentagon style=filled]
		expert_2_11_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_2_11_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_2_11_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_2_11_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_2_11_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_2_11_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_2_11_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_2_11_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_agg_2_11 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=ellipse style=filled]
		residual2_2_11 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=ellipse style=filled]
	}
	subgraph cluster_layer2_gpu12 {
		color="#0652DD" fillcolor="#0652DD20" label="Layer 2 - GPU 12" style=filled
		ln1_2_12 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=ellipse style=filled]
		q_proj_2_12 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=box style=filled]
		k_proj_2_12 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=box style=filled]
		v_proj_2_12 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=box style=filled]
		ring_attn_2_12_stage0 [label="Ring Attention Stage 0
Q[12]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_2_12_stage1 [label="Ring Attention Stage 1
Q[12]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_2_12_stage2 [label="Ring Attention Stage 2
Q[12]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_2_12_stage3 [label="Ring Attention Stage 3
Q[12]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_2_12_stage4 [label="Ring Attention Stage 4
Q[12]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_2_12_stage5 [label="Ring Attention Stage 5
Q[12]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_2_12_stage6 [label="Ring Attention Stage 6
Q[12]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_2_12_stage7 [label="Ring Attention Stage 7
Q[12]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_2_12_stage8 [label="Ring Attention Stage 8
Q[12]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_2_12_stage9 [label="Ring Attention Stage 9
Q[12]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_2_12_stage10 [label="Ring Attention Stage 10
Q[12]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_2_12_stage11 [label="Ring Attention Stage 11
Q[12]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_2_12_stage12 [label="Ring Attention Stage 12
Q[12]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_2_12_stage13 [label="Ring Attention Stage 13
Q[12]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_2_12_stage14 [label="Ring Attention Stage 14
Q[12]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_2_12_stage15 [label="Ring Attention Stage 15
Q[12]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		o_proj_2_12 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=box style=filled]
		residual1_2_12 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=ellipse style=filled]
		ln2_2_12 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=ellipse style=filled]
		router_2_12 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#0652DD" shape=hexagon style=filled]
		gate_2_12 [label="Top-2 Gating
Expert Selection" fillcolor="#0652DD" shape=pentagon style=filled]
		expert_2_12_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_2_12_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_2_12_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_2_12_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_2_12_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_2_12_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_2_12_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_2_12_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_agg_2_12 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=ellipse style=filled]
		residual2_2_12 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=ellipse style=filled]
	}
	subgraph cluster_layer2_gpu13 {
		color="#9980FA" fillcolor="#9980FA20" label="Layer 2 - GPU 13" style=filled
		ln1_2_13 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=ellipse style=filled]
		q_proj_2_13 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=box style=filled]
		k_proj_2_13 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=box style=filled]
		v_proj_2_13 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=box style=filled]
		ring_attn_2_13_stage0 [label="Ring Attention Stage 0
Q[13]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_2_13_stage1 [label="Ring Attention Stage 1
Q[13]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_2_13_stage2 [label="Ring Attention Stage 2
Q[13]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_2_13_stage3 [label="Ring Attention Stage 3
Q[13]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_2_13_stage4 [label="Ring Attention Stage 4
Q[13]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_2_13_stage5 [label="Ring Attention Stage 5
Q[13]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_2_13_stage6 [label="Ring Attention Stage 6
Q[13]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_2_13_stage7 [label="Ring Attention Stage 7
Q[13]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_2_13_stage8 [label="Ring Attention Stage 8
Q[13]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_2_13_stage9 [label="Ring Attention Stage 9
Q[13]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_2_13_stage10 [label="Ring Attention Stage 10
Q[13]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_2_13_stage11 [label="Ring Attention Stage 11
Q[13]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_2_13_stage12 [label="Ring Attention Stage 12
Q[13]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_2_13_stage13 [label="Ring Attention Stage 13
Q[13]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_2_13_stage14 [label="Ring Attention Stage 14
Q[13]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_2_13_stage15 [label="Ring Attention Stage 15
Q[13]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		o_proj_2_13 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=box style=filled]
		residual1_2_13 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=ellipse style=filled]
		ln2_2_13 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=ellipse style=filled]
		router_2_13 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#9980FA" shape=hexagon style=filled]
		gate_2_13 [label="Top-2 Gating
Expert Selection" fillcolor="#9980FA" shape=pentagon style=filled]
		expert_2_13_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_2_13_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_2_13_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_2_13_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_2_13_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_2_13_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_2_13_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_2_13_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_agg_2_13 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=ellipse style=filled]
		residual2_2_13 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=ellipse style=filled]
	}
	subgraph cluster_layer2_gpu14 {
		color="#D63031" fillcolor="#D6303120" label="Layer 2 - GPU 14" style=filled
		ln1_2_14 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=ellipse style=filled]
		q_proj_2_14 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=box style=filled]
		k_proj_2_14 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=box style=filled]
		v_proj_2_14 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=box style=filled]
		ring_attn_2_14_stage0 [label="Ring Attention Stage 0
Q[14]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_2_14_stage1 [label="Ring Attention Stage 1
Q[14]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_2_14_stage2 [label="Ring Attention Stage 2
Q[14]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_2_14_stage3 [label="Ring Attention Stage 3
Q[14]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_2_14_stage4 [label="Ring Attention Stage 4
Q[14]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_2_14_stage5 [label="Ring Attention Stage 5
Q[14]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_2_14_stage6 [label="Ring Attention Stage 6
Q[14]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_2_14_stage7 [label="Ring Attention Stage 7
Q[14]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_2_14_stage8 [label="Ring Attention Stage 8
Q[14]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_2_14_stage9 [label="Ring Attention Stage 9
Q[14]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_2_14_stage10 [label="Ring Attention Stage 10
Q[14]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_2_14_stage11 [label="Ring Attention Stage 11
Q[14]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_2_14_stage12 [label="Ring Attention Stage 12
Q[14]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_2_14_stage13 [label="Ring Attention Stage 13
Q[14]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_2_14_stage14 [label="Ring Attention Stage 14
Q[14]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_2_14_stage15 [label="Ring Attention Stage 15
Q[14]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		o_proj_2_14 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=box style=filled]
		residual1_2_14 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=ellipse style=filled]
		ln2_2_14 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=ellipse style=filled]
		router_2_14 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#D63031" shape=hexagon style=filled]
		gate_2_14 [label="Top-2 Gating
Expert Selection" fillcolor="#D63031" shape=pentagon style=filled]
		expert_2_14_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_2_14_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_2_14_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_2_14_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_2_14_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_2_14_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_2_14_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_2_14_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_agg_2_14 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=ellipse style=filled]
		residual2_2_14 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=ellipse style=filled]
	}
	subgraph cluster_layer2_gpu15 {
		color="#74B9FF" fillcolor="#74B9FF20" label="Layer 2 - GPU 15" style=filled
		ln1_2_15 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=ellipse style=filled]
		q_proj_2_15 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=box style=filled]
		k_proj_2_15 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=box style=filled]
		v_proj_2_15 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=box style=filled]
		ring_attn_2_15_stage0 [label="Ring Attention Stage 0
Q[15]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_2_15_stage1 [label="Ring Attention Stage 1
Q[15]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_2_15_stage2 [label="Ring Attention Stage 2
Q[15]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_2_15_stage3 [label="Ring Attention Stage 3
Q[15]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_2_15_stage4 [label="Ring Attention Stage 4
Q[15]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_2_15_stage5 [label="Ring Attention Stage 5
Q[15]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_2_15_stage6 [label="Ring Attention Stage 6
Q[15]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_2_15_stage7 [label="Ring Attention Stage 7
Q[15]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_2_15_stage8 [label="Ring Attention Stage 8
Q[15]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_2_15_stage9 [label="Ring Attention Stage 9
Q[15]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_2_15_stage10 [label="Ring Attention Stage 10
Q[15]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_2_15_stage11 [label="Ring Attention Stage 11
Q[15]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_2_15_stage12 [label="Ring Attention Stage 12
Q[15]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_2_15_stage13 [label="Ring Attention Stage 13
Q[15]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_2_15_stage14 [label="Ring Attention Stage 14
Q[15]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_2_15_stage15 [label="Ring Attention Stage 15
Q[15]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		o_proj_2_15 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=box style=filled]
		residual1_2_15 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=ellipse style=filled]
		ln2_2_15 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=ellipse style=filled]
		router_2_15 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#74B9FF" shape=hexagon style=filled]
		gate_2_15 [label="Top-2 Gating
Expert Selection" fillcolor="#74B9FF" shape=pentagon style=filled]
		expert_2_15_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_2_15_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_2_15_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_2_15_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_2_15_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_2_15_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_2_15_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_2_15_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_agg_2_15 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=ellipse style=filled]
		residual2_2_15 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=ellipse style=filled]
	}
	subgraph cluster_layer3_gpu0 {
		color="#FF6B6B" fillcolor="#FF6B6B20" label="Layer 3 - GPU 0" style=filled
		ln1_3_0 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=ellipse style=filled]
		q_proj_3_0 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=box style=filled]
		k_proj_3_0 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=box style=filled]
		v_proj_3_0 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=box style=filled]
		ring_attn_3_0_stage0 [label="Ring Attention Stage 0
Q[0]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_3_0_stage1 [label="Ring Attention Stage 1
Q[0]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_3_0_stage2 [label="Ring Attention Stage 2
Q[0]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_3_0_stage3 [label="Ring Attention Stage 3
Q[0]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_3_0_stage4 [label="Ring Attention Stage 4
Q[0]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_3_0_stage5 [label="Ring Attention Stage 5
Q[0]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_3_0_stage6 [label="Ring Attention Stage 6
Q[0]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_3_0_stage7 [label="Ring Attention Stage 7
Q[0]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_3_0_stage8 [label="Ring Attention Stage 8
Q[0]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_3_0_stage9 [label="Ring Attention Stage 9
Q[0]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_3_0_stage10 [label="Ring Attention Stage 10
Q[0]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_3_0_stage11 [label="Ring Attention Stage 11
Q[0]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_3_0_stage12 [label="Ring Attention Stage 12
Q[0]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_3_0_stage13 [label="Ring Attention Stage 13
Q[0]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_3_0_stage14 [label="Ring Attention Stage 14
Q[0]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_3_0_stage15 [label="Ring Attention Stage 15
Q[0]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		o_proj_3_0 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=box style=filled]
		residual1_3_0 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=ellipse style=filled]
		ln2_3_0 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=ellipse style=filled]
		router_3_0 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#FF6B6B" shape=hexagon style=filled]
		gate_3_0 [label="Top-2 Gating
Expert Selection" fillcolor="#FF6B6B" shape=pentagon style=filled]
		expert_3_0_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_3_0_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_3_0_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_3_0_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_3_0_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_3_0_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_3_0_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_3_0_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_agg_3_0 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=ellipse style=filled]
		residual2_3_0 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=ellipse style=filled]
	}
	subgraph cluster_layer3_gpu1 {
		color="#4ECDC4" fillcolor="#4ECDC420" label="Layer 3 - GPU 1" style=filled
		ln1_3_1 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=ellipse style=filled]
		q_proj_3_1 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=box style=filled]
		k_proj_3_1 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=box style=filled]
		v_proj_3_1 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=box style=filled]
		ring_attn_3_1_stage0 [label="Ring Attention Stage 0
Q[1]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_3_1_stage1 [label="Ring Attention Stage 1
Q[1]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_3_1_stage2 [label="Ring Attention Stage 2
Q[1]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_3_1_stage3 [label="Ring Attention Stage 3
Q[1]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_3_1_stage4 [label="Ring Attention Stage 4
Q[1]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_3_1_stage5 [label="Ring Attention Stage 5
Q[1]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_3_1_stage6 [label="Ring Attention Stage 6
Q[1]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_3_1_stage7 [label="Ring Attention Stage 7
Q[1]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_3_1_stage8 [label="Ring Attention Stage 8
Q[1]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_3_1_stage9 [label="Ring Attention Stage 9
Q[1]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_3_1_stage10 [label="Ring Attention Stage 10
Q[1]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_3_1_stage11 [label="Ring Attention Stage 11
Q[1]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_3_1_stage12 [label="Ring Attention Stage 12
Q[1]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_3_1_stage13 [label="Ring Attention Stage 13
Q[1]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_3_1_stage14 [label="Ring Attention Stage 14
Q[1]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_3_1_stage15 [label="Ring Attention Stage 15
Q[1]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		o_proj_3_1 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=box style=filled]
		residual1_3_1 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=ellipse style=filled]
		ln2_3_1 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=ellipse style=filled]
		router_3_1 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#4ECDC4" shape=hexagon style=filled]
		gate_3_1 [label="Top-2 Gating
Expert Selection" fillcolor="#4ECDC4" shape=pentagon style=filled]
		expert_3_1_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_3_1_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_3_1_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_3_1_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_3_1_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_3_1_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_3_1_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_3_1_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_agg_3_1 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=ellipse style=filled]
		residual2_3_1 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=ellipse style=filled]
	}
	subgraph cluster_layer3_gpu2 {
		color="#45B7D1" fillcolor="#45B7D120" label="Layer 3 - GPU 2" style=filled
		ln1_3_2 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=ellipse style=filled]
		q_proj_3_2 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=box style=filled]
		k_proj_3_2 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=box style=filled]
		v_proj_3_2 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=box style=filled]
		ring_attn_3_2_stage0 [label="Ring Attention Stage 0
Q[2]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_3_2_stage1 [label="Ring Attention Stage 1
Q[2]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_3_2_stage2 [label="Ring Attention Stage 2
Q[2]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_3_2_stage3 [label="Ring Attention Stage 3
Q[2]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_3_2_stage4 [label="Ring Attention Stage 4
Q[2]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_3_2_stage5 [label="Ring Attention Stage 5
Q[2]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_3_2_stage6 [label="Ring Attention Stage 6
Q[2]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_3_2_stage7 [label="Ring Attention Stage 7
Q[2]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_3_2_stage8 [label="Ring Attention Stage 8
Q[2]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_3_2_stage9 [label="Ring Attention Stage 9
Q[2]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_3_2_stage10 [label="Ring Attention Stage 10
Q[2]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_3_2_stage11 [label="Ring Attention Stage 11
Q[2]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_3_2_stage12 [label="Ring Attention Stage 12
Q[2]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_3_2_stage13 [label="Ring Attention Stage 13
Q[2]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_3_2_stage14 [label="Ring Attention Stage 14
Q[2]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_3_2_stage15 [label="Ring Attention Stage 15
Q[2]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		o_proj_3_2 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=box style=filled]
		residual1_3_2 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=ellipse style=filled]
		ln2_3_2 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=ellipse style=filled]
		router_3_2 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#45B7D1" shape=hexagon style=filled]
		gate_3_2 [label="Top-2 Gating
Expert Selection" fillcolor="#45B7D1" shape=pentagon style=filled]
		expert_3_2_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_3_2_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_3_2_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_3_2_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_3_2_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_3_2_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_3_2_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_3_2_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_agg_3_2 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=ellipse style=filled]
		residual2_3_2 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=ellipse style=filled]
	}
	subgraph cluster_layer3_gpu3 {
		color="#96CEB4" fillcolor="#96CEB420" label="Layer 3 - GPU 3" style=filled
		ln1_3_3 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=ellipse style=filled]
		q_proj_3_3 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=box style=filled]
		k_proj_3_3 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=box style=filled]
		v_proj_3_3 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=box style=filled]
		ring_attn_3_3_stage0 [label="Ring Attention Stage 0
Q[3]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_3_3_stage1 [label="Ring Attention Stage 1
Q[3]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_3_3_stage2 [label="Ring Attention Stage 2
Q[3]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_3_3_stage3 [label="Ring Attention Stage 3
Q[3]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_3_3_stage4 [label="Ring Attention Stage 4
Q[3]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_3_3_stage5 [label="Ring Attention Stage 5
Q[3]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_3_3_stage6 [label="Ring Attention Stage 6
Q[3]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_3_3_stage7 [label="Ring Attention Stage 7
Q[3]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_3_3_stage8 [label="Ring Attention Stage 8
Q[3]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_3_3_stage9 [label="Ring Attention Stage 9
Q[3]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_3_3_stage10 [label="Ring Attention Stage 10
Q[3]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_3_3_stage11 [label="Ring Attention Stage 11
Q[3]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_3_3_stage12 [label="Ring Attention Stage 12
Q[3]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_3_3_stage13 [label="Ring Attention Stage 13
Q[3]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_3_3_stage14 [label="Ring Attention Stage 14
Q[3]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_3_3_stage15 [label="Ring Attention Stage 15
Q[3]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		o_proj_3_3 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=box style=filled]
		residual1_3_3 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=ellipse style=filled]
		ln2_3_3 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=ellipse style=filled]
		router_3_3 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#96CEB4" shape=hexagon style=filled]
		gate_3_3 [label="Top-2 Gating
Expert Selection" fillcolor="#96CEB4" shape=pentagon style=filled]
		expert_3_3_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_3_3_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_3_3_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_3_3_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_3_3_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_3_3_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_3_3_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_3_3_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_agg_3_3 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=ellipse style=filled]
		residual2_3_3 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=ellipse style=filled]
	}
	subgraph cluster_layer3_gpu4 {
		color="#FECA57" fillcolor="#FECA5720" label="Layer 3 - GPU 4" style=filled
		ln1_3_4 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=ellipse style=filled]
		q_proj_3_4 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=box style=filled]
		k_proj_3_4 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=box style=filled]
		v_proj_3_4 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=box style=filled]
		ring_attn_3_4_stage0 [label="Ring Attention Stage 0
Q[4]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_3_4_stage1 [label="Ring Attention Stage 1
Q[4]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_3_4_stage2 [label="Ring Attention Stage 2
Q[4]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_3_4_stage3 [label="Ring Attention Stage 3
Q[4]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_3_4_stage4 [label="Ring Attention Stage 4
Q[4]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_3_4_stage5 [label="Ring Attention Stage 5
Q[4]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_3_4_stage6 [label="Ring Attention Stage 6
Q[4]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_3_4_stage7 [label="Ring Attention Stage 7
Q[4]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_3_4_stage8 [label="Ring Attention Stage 8
Q[4]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_3_4_stage9 [label="Ring Attention Stage 9
Q[4]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_3_4_stage10 [label="Ring Attention Stage 10
Q[4]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_3_4_stage11 [label="Ring Attention Stage 11
Q[4]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_3_4_stage12 [label="Ring Attention Stage 12
Q[4]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_3_4_stage13 [label="Ring Attention Stage 13
Q[4]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_3_4_stage14 [label="Ring Attention Stage 14
Q[4]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_3_4_stage15 [label="Ring Attention Stage 15
Q[4]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		o_proj_3_4 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=box style=filled]
		residual1_3_4 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=ellipse style=filled]
		ln2_3_4 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=ellipse style=filled]
		router_3_4 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#FECA57" shape=hexagon style=filled]
		gate_3_4 [label="Top-2 Gating
Expert Selection" fillcolor="#FECA57" shape=pentagon style=filled]
		expert_3_4_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_3_4_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_3_4_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_3_4_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_3_4_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_3_4_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_3_4_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_3_4_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_agg_3_4 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=ellipse style=filled]
		residual2_3_4 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=ellipse style=filled]
	}
	subgraph cluster_layer3_gpu5 {
		color="#FF9FF3" fillcolor="#FF9FF320" label="Layer 3 - GPU 5" style=filled
		ln1_3_5 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=ellipse style=filled]
		q_proj_3_5 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=box style=filled]
		k_proj_3_5 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=box style=filled]
		v_proj_3_5 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=box style=filled]
		ring_attn_3_5_stage0 [label="Ring Attention Stage 0
Q[5]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_3_5_stage1 [label="Ring Attention Stage 1
Q[5]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_3_5_stage2 [label="Ring Attention Stage 2
Q[5]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_3_5_stage3 [label="Ring Attention Stage 3
Q[5]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_3_5_stage4 [label="Ring Attention Stage 4
Q[5]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_3_5_stage5 [label="Ring Attention Stage 5
Q[5]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_3_5_stage6 [label="Ring Attention Stage 6
Q[5]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_3_5_stage7 [label="Ring Attention Stage 7
Q[5]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_3_5_stage8 [label="Ring Attention Stage 8
Q[5]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_3_5_stage9 [label="Ring Attention Stage 9
Q[5]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_3_5_stage10 [label="Ring Attention Stage 10
Q[5]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_3_5_stage11 [label="Ring Attention Stage 11
Q[5]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_3_5_stage12 [label="Ring Attention Stage 12
Q[5]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_3_5_stage13 [label="Ring Attention Stage 13
Q[5]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_3_5_stage14 [label="Ring Attention Stage 14
Q[5]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_3_5_stage15 [label="Ring Attention Stage 15
Q[5]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		o_proj_3_5 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=box style=filled]
		residual1_3_5 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=ellipse style=filled]
		ln2_3_5 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=ellipse style=filled]
		router_3_5 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#FF9FF3" shape=hexagon style=filled]
		gate_3_5 [label="Top-2 Gating
Expert Selection" fillcolor="#FF9FF3" shape=pentagon style=filled]
		expert_3_5_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_3_5_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_3_5_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_3_5_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_3_5_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_3_5_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_3_5_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_3_5_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_agg_3_5 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=ellipse style=filled]
		residual2_3_5 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=ellipse style=filled]
	}
	subgraph cluster_layer3_gpu6 {
		color="#54A0FF" fillcolor="#54A0FF20" label="Layer 3 - GPU 6" style=filled
		ln1_3_6 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=ellipse style=filled]
		q_proj_3_6 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=box style=filled]
		k_proj_3_6 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=box style=filled]
		v_proj_3_6 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=box style=filled]
		ring_attn_3_6_stage0 [label="Ring Attention Stage 0
Q[6]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_3_6_stage1 [label="Ring Attention Stage 1
Q[6]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_3_6_stage2 [label="Ring Attention Stage 2
Q[6]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_3_6_stage3 [label="Ring Attention Stage 3
Q[6]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_3_6_stage4 [label="Ring Attention Stage 4
Q[6]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_3_6_stage5 [label="Ring Attention Stage 5
Q[6]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_3_6_stage6 [label="Ring Attention Stage 6
Q[6]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_3_6_stage7 [label="Ring Attention Stage 7
Q[6]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_3_6_stage8 [label="Ring Attention Stage 8
Q[6]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_3_6_stage9 [label="Ring Attention Stage 9
Q[6]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_3_6_stage10 [label="Ring Attention Stage 10
Q[6]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_3_6_stage11 [label="Ring Attention Stage 11
Q[6]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_3_6_stage12 [label="Ring Attention Stage 12
Q[6]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_3_6_stage13 [label="Ring Attention Stage 13
Q[6]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_3_6_stage14 [label="Ring Attention Stage 14
Q[6]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_3_6_stage15 [label="Ring Attention Stage 15
Q[6]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		o_proj_3_6 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=box style=filled]
		residual1_3_6 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=ellipse style=filled]
		ln2_3_6 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=ellipse style=filled]
		router_3_6 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#54A0FF" shape=hexagon style=filled]
		gate_3_6 [label="Top-2 Gating
Expert Selection" fillcolor="#54A0FF" shape=pentagon style=filled]
		expert_3_6_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_3_6_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_3_6_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_3_6_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_3_6_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_3_6_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_3_6_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_3_6_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_agg_3_6 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=ellipse style=filled]
		residual2_3_6 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=ellipse style=filled]
	}
	subgraph cluster_layer3_gpu7 {
		color="#5F27CD" fillcolor="#5F27CD20" label="Layer 3 - GPU 7" style=filled
		ln1_3_7 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=ellipse style=filled]
		q_proj_3_7 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=box style=filled]
		k_proj_3_7 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=box style=filled]
		v_proj_3_7 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=box style=filled]
		ring_attn_3_7_stage0 [label="Ring Attention Stage 0
Q[7]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_3_7_stage1 [label="Ring Attention Stage 1
Q[7]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_3_7_stage2 [label="Ring Attention Stage 2
Q[7]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_3_7_stage3 [label="Ring Attention Stage 3
Q[7]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_3_7_stage4 [label="Ring Attention Stage 4
Q[7]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_3_7_stage5 [label="Ring Attention Stage 5
Q[7]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_3_7_stage6 [label="Ring Attention Stage 6
Q[7]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_3_7_stage7 [label="Ring Attention Stage 7
Q[7]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_3_7_stage8 [label="Ring Attention Stage 8
Q[7]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_3_7_stage9 [label="Ring Attention Stage 9
Q[7]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_3_7_stage10 [label="Ring Attention Stage 10
Q[7]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_3_7_stage11 [label="Ring Attention Stage 11
Q[7]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_3_7_stage12 [label="Ring Attention Stage 12
Q[7]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_3_7_stage13 [label="Ring Attention Stage 13
Q[7]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_3_7_stage14 [label="Ring Attention Stage 14
Q[7]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_3_7_stage15 [label="Ring Attention Stage 15
Q[7]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		o_proj_3_7 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=box style=filled]
		residual1_3_7 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=ellipse style=filled]
		ln2_3_7 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=ellipse style=filled]
		router_3_7 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#5F27CD" shape=hexagon style=filled]
		gate_3_7 [label="Top-2 Gating
Expert Selection" fillcolor="#5F27CD" shape=pentagon style=filled]
		expert_3_7_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_3_7_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_3_7_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_3_7_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_3_7_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_3_7_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_3_7_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_3_7_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_agg_3_7 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=ellipse style=filled]
		residual2_3_7 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=ellipse style=filled]
	}
	subgraph cluster_layer3_gpu8 {
		color="#00D2D3" fillcolor="#00D2D320" label="Layer 3 - GPU 8" style=filled
		ln1_3_8 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=ellipse style=filled]
		q_proj_3_8 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=box style=filled]
		k_proj_3_8 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=box style=filled]
		v_proj_3_8 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=box style=filled]
		ring_attn_3_8_stage0 [label="Ring Attention Stage 0
Q[8]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_3_8_stage1 [label="Ring Attention Stage 1
Q[8]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_3_8_stage2 [label="Ring Attention Stage 2
Q[8]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_3_8_stage3 [label="Ring Attention Stage 3
Q[8]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_3_8_stage4 [label="Ring Attention Stage 4
Q[8]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_3_8_stage5 [label="Ring Attention Stage 5
Q[8]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_3_8_stage6 [label="Ring Attention Stage 6
Q[8]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_3_8_stage7 [label="Ring Attention Stage 7
Q[8]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_3_8_stage8 [label="Ring Attention Stage 8
Q[8]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_3_8_stage9 [label="Ring Attention Stage 9
Q[8]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_3_8_stage10 [label="Ring Attention Stage 10
Q[8]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_3_8_stage11 [label="Ring Attention Stage 11
Q[8]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_3_8_stage12 [label="Ring Attention Stage 12
Q[8]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_3_8_stage13 [label="Ring Attention Stage 13
Q[8]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_3_8_stage14 [label="Ring Attention Stage 14
Q[8]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_3_8_stage15 [label="Ring Attention Stage 15
Q[8]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		o_proj_3_8 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=box style=filled]
		residual1_3_8 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=ellipse style=filled]
		ln2_3_8 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=ellipse style=filled]
		router_3_8 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#00D2D3" shape=hexagon style=filled]
		gate_3_8 [label="Top-2 Gating
Expert Selection" fillcolor="#00D2D3" shape=pentagon style=filled]
		expert_3_8_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_3_8_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_3_8_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_3_8_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_3_8_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_3_8_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_3_8_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_3_8_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_agg_3_8 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=ellipse style=filled]
		residual2_3_8 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=ellipse style=filled]
	}
	subgraph cluster_layer3_gpu9 {
		color="#FF9F43" fillcolor="#FF9F4320" label="Layer 3 - GPU 9" style=filled
		ln1_3_9 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=ellipse style=filled]
		q_proj_3_9 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=box style=filled]
		k_proj_3_9 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=box style=filled]
		v_proj_3_9 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=box style=filled]
		ring_attn_3_9_stage0 [label="Ring Attention Stage 0
Q[9]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_3_9_stage1 [label="Ring Attention Stage 1
Q[9]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_3_9_stage2 [label="Ring Attention Stage 2
Q[9]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_3_9_stage3 [label="Ring Attention Stage 3
Q[9]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_3_9_stage4 [label="Ring Attention Stage 4
Q[9]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_3_9_stage5 [label="Ring Attention Stage 5
Q[9]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_3_9_stage6 [label="Ring Attention Stage 6
Q[9]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_3_9_stage7 [label="Ring Attention Stage 7
Q[9]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_3_9_stage8 [label="Ring Attention Stage 8
Q[9]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_3_9_stage9 [label="Ring Attention Stage 9
Q[9]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_3_9_stage10 [label="Ring Attention Stage 10
Q[9]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_3_9_stage11 [label="Ring Attention Stage 11
Q[9]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_3_9_stage12 [label="Ring Attention Stage 12
Q[9]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_3_9_stage13 [label="Ring Attention Stage 13
Q[9]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_3_9_stage14 [label="Ring Attention Stage 14
Q[9]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_3_9_stage15 [label="Ring Attention Stage 15
Q[9]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		o_proj_3_9 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=box style=filled]
		residual1_3_9 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=ellipse style=filled]
		ln2_3_9 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=ellipse style=filled]
		router_3_9 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#FF9F43" shape=hexagon style=filled]
		gate_3_9 [label="Top-2 Gating
Expert Selection" fillcolor="#FF9F43" shape=pentagon style=filled]
		expert_3_9_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_3_9_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_3_9_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_3_9_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_3_9_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_3_9_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_3_9_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_3_9_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_agg_3_9 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=ellipse style=filled]
		residual2_3_9 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=ellipse style=filled]
	}
	subgraph cluster_layer3_gpu10 {
		color="#10AC84" fillcolor="#10AC8420" label="Layer 3 - GPU 10" style=filled
		ln1_3_10 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=ellipse style=filled]
		q_proj_3_10 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=box style=filled]
		k_proj_3_10 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=box style=filled]
		v_proj_3_10 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=box style=filled]
		ring_attn_3_10_stage0 [label="Ring Attention Stage 0
Q[10]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_3_10_stage1 [label="Ring Attention Stage 1
Q[10]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_3_10_stage2 [label="Ring Attention Stage 2
Q[10]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_3_10_stage3 [label="Ring Attention Stage 3
Q[10]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_3_10_stage4 [label="Ring Attention Stage 4
Q[10]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_3_10_stage5 [label="Ring Attention Stage 5
Q[10]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_3_10_stage6 [label="Ring Attention Stage 6
Q[10]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_3_10_stage7 [label="Ring Attention Stage 7
Q[10]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_3_10_stage8 [label="Ring Attention Stage 8
Q[10]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_3_10_stage9 [label="Ring Attention Stage 9
Q[10]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_3_10_stage10 [label="Ring Attention Stage 10
Q[10]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_3_10_stage11 [label="Ring Attention Stage 11
Q[10]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_3_10_stage12 [label="Ring Attention Stage 12
Q[10]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_3_10_stage13 [label="Ring Attention Stage 13
Q[10]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_3_10_stage14 [label="Ring Attention Stage 14
Q[10]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_3_10_stage15 [label="Ring Attention Stage 15
Q[10]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		o_proj_3_10 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=box style=filled]
		residual1_3_10 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=ellipse style=filled]
		ln2_3_10 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=ellipse style=filled]
		router_3_10 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#10AC84" shape=hexagon style=filled]
		gate_3_10 [label="Top-2 Gating
Expert Selection" fillcolor="#10AC84" shape=pentagon style=filled]
		expert_3_10_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_3_10_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_3_10_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_3_10_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_3_10_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_3_10_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_3_10_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_3_10_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_agg_3_10 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=ellipse style=filled]
		residual2_3_10 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=ellipse style=filled]
	}
	subgraph cluster_layer3_gpu11 {
		color="#EE5A24" fillcolor="#EE5A2420" label="Layer 3 - GPU 11" style=filled
		ln1_3_11 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=ellipse style=filled]
		q_proj_3_11 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=box style=filled]
		k_proj_3_11 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=box style=filled]
		v_proj_3_11 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=box style=filled]
		ring_attn_3_11_stage0 [label="Ring Attention Stage 0
Q[11]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_3_11_stage1 [label="Ring Attention Stage 1
Q[11]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_3_11_stage2 [label="Ring Attention Stage 2
Q[11]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_3_11_stage3 [label="Ring Attention Stage 3
Q[11]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_3_11_stage4 [label="Ring Attention Stage 4
Q[11]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_3_11_stage5 [label="Ring Attention Stage 5
Q[11]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_3_11_stage6 [label="Ring Attention Stage 6
Q[11]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_3_11_stage7 [label="Ring Attention Stage 7
Q[11]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_3_11_stage8 [label="Ring Attention Stage 8
Q[11]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_3_11_stage9 [label="Ring Attention Stage 9
Q[11]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_3_11_stage10 [label="Ring Attention Stage 10
Q[11]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_3_11_stage11 [label="Ring Attention Stage 11
Q[11]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_3_11_stage12 [label="Ring Attention Stage 12
Q[11]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_3_11_stage13 [label="Ring Attention Stage 13
Q[11]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_3_11_stage14 [label="Ring Attention Stage 14
Q[11]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_3_11_stage15 [label="Ring Attention Stage 15
Q[11]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		o_proj_3_11 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=box style=filled]
		residual1_3_11 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=ellipse style=filled]
		ln2_3_11 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=ellipse style=filled]
		router_3_11 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#EE5A24" shape=hexagon style=filled]
		gate_3_11 [label="Top-2 Gating
Expert Selection" fillcolor="#EE5A24" shape=pentagon style=filled]
		expert_3_11_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_3_11_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_3_11_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_3_11_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_3_11_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_3_11_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_3_11_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_3_11_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_agg_3_11 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=ellipse style=filled]
		residual2_3_11 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=ellipse style=filled]
	}
	subgraph cluster_layer3_gpu12 {
		color="#0652DD" fillcolor="#0652DD20" label="Layer 3 - GPU 12" style=filled
		ln1_3_12 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=ellipse style=filled]
		q_proj_3_12 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=box style=filled]
		k_proj_3_12 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=box style=filled]
		v_proj_3_12 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=box style=filled]
		ring_attn_3_12_stage0 [label="Ring Attention Stage 0
Q[12]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_3_12_stage1 [label="Ring Attention Stage 1
Q[12]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_3_12_stage2 [label="Ring Attention Stage 2
Q[12]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_3_12_stage3 [label="Ring Attention Stage 3
Q[12]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_3_12_stage4 [label="Ring Attention Stage 4
Q[12]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_3_12_stage5 [label="Ring Attention Stage 5
Q[12]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_3_12_stage6 [label="Ring Attention Stage 6
Q[12]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_3_12_stage7 [label="Ring Attention Stage 7
Q[12]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_3_12_stage8 [label="Ring Attention Stage 8
Q[12]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_3_12_stage9 [label="Ring Attention Stage 9
Q[12]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_3_12_stage10 [label="Ring Attention Stage 10
Q[12]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_3_12_stage11 [label="Ring Attention Stage 11
Q[12]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_3_12_stage12 [label="Ring Attention Stage 12
Q[12]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_3_12_stage13 [label="Ring Attention Stage 13
Q[12]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_3_12_stage14 [label="Ring Attention Stage 14
Q[12]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_3_12_stage15 [label="Ring Attention Stage 15
Q[12]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		o_proj_3_12 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=box style=filled]
		residual1_3_12 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=ellipse style=filled]
		ln2_3_12 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=ellipse style=filled]
		router_3_12 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#0652DD" shape=hexagon style=filled]
		gate_3_12 [label="Top-2 Gating
Expert Selection" fillcolor="#0652DD" shape=pentagon style=filled]
		expert_3_12_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_3_12_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_3_12_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_3_12_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_3_12_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_3_12_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_3_12_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_3_12_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_agg_3_12 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=ellipse style=filled]
		residual2_3_12 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=ellipse style=filled]
	}
	subgraph cluster_layer3_gpu13 {
		color="#9980FA" fillcolor="#9980FA20" label="Layer 3 - GPU 13" style=filled
		ln1_3_13 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=ellipse style=filled]
		q_proj_3_13 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=box style=filled]
		k_proj_3_13 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=box style=filled]
		v_proj_3_13 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=box style=filled]
		ring_attn_3_13_stage0 [label="Ring Attention Stage 0
Q[13]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_3_13_stage1 [label="Ring Attention Stage 1
Q[13]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_3_13_stage2 [label="Ring Attention Stage 2
Q[13]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_3_13_stage3 [label="Ring Attention Stage 3
Q[13]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_3_13_stage4 [label="Ring Attention Stage 4
Q[13]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_3_13_stage5 [label="Ring Attention Stage 5
Q[13]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_3_13_stage6 [label="Ring Attention Stage 6
Q[13]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_3_13_stage7 [label="Ring Attention Stage 7
Q[13]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_3_13_stage8 [label="Ring Attention Stage 8
Q[13]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_3_13_stage9 [label="Ring Attention Stage 9
Q[13]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_3_13_stage10 [label="Ring Attention Stage 10
Q[13]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_3_13_stage11 [label="Ring Attention Stage 11
Q[13]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_3_13_stage12 [label="Ring Attention Stage 12
Q[13]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_3_13_stage13 [label="Ring Attention Stage 13
Q[13]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_3_13_stage14 [label="Ring Attention Stage 14
Q[13]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_3_13_stage15 [label="Ring Attention Stage 15
Q[13]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		o_proj_3_13 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=box style=filled]
		residual1_3_13 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=ellipse style=filled]
		ln2_3_13 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=ellipse style=filled]
		router_3_13 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#9980FA" shape=hexagon style=filled]
		gate_3_13 [label="Top-2 Gating
Expert Selection" fillcolor="#9980FA" shape=pentagon style=filled]
		expert_3_13_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_3_13_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_3_13_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_3_13_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_3_13_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_3_13_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_3_13_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_3_13_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_agg_3_13 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=ellipse style=filled]
		residual2_3_13 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=ellipse style=filled]
	}
	subgraph cluster_layer3_gpu14 {
		color="#D63031" fillcolor="#D6303120" label="Layer 3 - GPU 14" style=filled
		ln1_3_14 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=ellipse style=filled]
		q_proj_3_14 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=box style=filled]
		k_proj_3_14 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=box style=filled]
		v_proj_3_14 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=box style=filled]
		ring_attn_3_14_stage0 [label="Ring Attention Stage 0
Q[14]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_3_14_stage1 [label="Ring Attention Stage 1
Q[14]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_3_14_stage2 [label="Ring Attention Stage 2
Q[14]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_3_14_stage3 [label="Ring Attention Stage 3
Q[14]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_3_14_stage4 [label="Ring Attention Stage 4
Q[14]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_3_14_stage5 [label="Ring Attention Stage 5
Q[14]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_3_14_stage6 [label="Ring Attention Stage 6
Q[14]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_3_14_stage7 [label="Ring Attention Stage 7
Q[14]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_3_14_stage8 [label="Ring Attention Stage 8
Q[14]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_3_14_stage9 [label="Ring Attention Stage 9
Q[14]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_3_14_stage10 [label="Ring Attention Stage 10
Q[14]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_3_14_stage11 [label="Ring Attention Stage 11
Q[14]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_3_14_stage12 [label="Ring Attention Stage 12
Q[14]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_3_14_stage13 [label="Ring Attention Stage 13
Q[14]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_3_14_stage14 [label="Ring Attention Stage 14
Q[14]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_3_14_stage15 [label="Ring Attention Stage 15
Q[14]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		o_proj_3_14 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=box style=filled]
		residual1_3_14 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=ellipse style=filled]
		ln2_3_14 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=ellipse style=filled]
		router_3_14 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#D63031" shape=hexagon style=filled]
		gate_3_14 [label="Top-2 Gating
Expert Selection" fillcolor="#D63031" shape=pentagon style=filled]
		expert_3_14_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_3_14_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_3_14_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_3_14_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_3_14_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_3_14_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_3_14_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_3_14_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_agg_3_14 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=ellipse style=filled]
		residual2_3_14 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=ellipse style=filled]
	}
	subgraph cluster_layer3_gpu15 {
		color="#74B9FF" fillcolor="#74B9FF20" label="Layer 3 - GPU 15" style=filled
		ln1_3_15 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=ellipse style=filled]
		q_proj_3_15 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=box style=filled]
		k_proj_3_15 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=box style=filled]
		v_proj_3_15 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=box style=filled]
		ring_attn_3_15_stage0 [label="Ring Attention Stage 0
Q[15]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_3_15_stage1 [label="Ring Attention Stage 1
Q[15]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_3_15_stage2 [label="Ring Attention Stage 2
Q[15]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_3_15_stage3 [label="Ring Attention Stage 3
Q[15]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_3_15_stage4 [label="Ring Attention Stage 4
Q[15]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_3_15_stage5 [label="Ring Attention Stage 5
Q[15]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_3_15_stage6 [label="Ring Attention Stage 6
Q[15]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_3_15_stage7 [label="Ring Attention Stage 7
Q[15]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_3_15_stage8 [label="Ring Attention Stage 8
Q[15]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_3_15_stage9 [label="Ring Attention Stage 9
Q[15]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_3_15_stage10 [label="Ring Attention Stage 10
Q[15]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_3_15_stage11 [label="Ring Attention Stage 11
Q[15]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_3_15_stage12 [label="Ring Attention Stage 12
Q[15]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_3_15_stage13 [label="Ring Attention Stage 13
Q[15]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_3_15_stage14 [label="Ring Attention Stage 14
Q[15]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_3_15_stage15 [label="Ring Attention Stage 15
Q[15]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		o_proj_3_15 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=box style=filled]
		residual1_3_15 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=ellipse style=filled]
		ln2_3_15 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=ellipse style=filled]
		router_3_15 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#74B9FF" shape=hexagon style=filled]
		gate_3_15 [label="Top-2 Gating
Expert Selection" fillcolor="#74B9FF" shape=pentagon style=filled]
		expert_3_15_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_3_15_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_3_15_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_3_15_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_3_15_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_3_15_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_3_15_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_3_15_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_agg_3_15 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=ellipse style=filled]
		residual2_3_15 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=ellipse style=filled]
	}
	subgraph cluster_layer4_gpu0 {
		color="#FF6B6B" fillcolor="#FF6B6B20" label="Layer 4 - GPU 0" style=filled
		ln1_4_0 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=ellipse style=filled]
		q_proj_4_0 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=box style=filled]
		k_proj_4_0 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=box style=filled]
		v_proj_4_0 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=box style=filled]
		ring_attn_4_0_stage0 [label="Ring Attention Stage 0
Q[0]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_4_0_stage1 [label="Ring Attention Stage 1
Q[0]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_4_0_stage2 [label="Ring Attention Stage 2
Q[0]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_4_0_stage3 [label="Ring Attention Stage 3
Q[0]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_4_0_stage4 [label="Ring Attention Stage 4
Q[0]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_4_0_stage5 [label="Ring Attention Stage 5
Q[0]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_4_0_stage6 [label="Ring Attention Stage 6
Q[0]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_4_0_stage7 [label="Ring Attention Stage 7
Q[0]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_4_0_stage8 [label="Ring Attention Stage 8
Q[0]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_4_0_stage9 [label="Ring Attention Stage 9
Q[0]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_4_0_stage10 [label="Ring Attention Stage 10
Q[0]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_4_0_stage11 [label="Ring Attention Stage 11
Q[0]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_4_0_stage12 [label="Ring Attention Stage 12
Q[0]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_4_0_stage13 [label="Ring Attention Stage 13
Q[0]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_4_0_stage14 [label="Ring Attention Stage 14
Q[0]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		ring_attn_4_0_stage15 [label="Ring Attention Stage 15
Q[0]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF6B6B" shape=diamond style=filled]
		o_proj_4_0 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=box style=filled]
		residual1_4_0 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=ellipse style=filled]
		ln2_4_0 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=ellipse style=filled]
		router_4_0 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#FF6B6B" shape=hexagon style=filled]
		gate_4_0 [label="Top-2 Gating
Expert Selection" fillcolor="#FF6B6B" shape=pentagon style=filled]
		expert_4_0_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_4_0_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_4_0_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_4_0_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_4_0_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_4_0_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_4_0_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_4_0_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF6B6B" shape=box style=filled]
		expert_agg_4_0 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=ellipse style=filled]
		residual2_4_0 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=ellipse style=filled]
	}
	subgraph cluster_layer4_gpu1 {
		color="#4ECDC4" fillcolor="#4ECDC420" label="Layer 4 - GPU 1" style=filled
		ln1_4_1 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=ellipse style=filled]
		q_proj_4_1 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=box style=filled]
		k_proj_4_1 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=box style=filled]
		v_proj_4_1 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=box style=filled]
		ring_attn_4_1_stage0 [label="Ring Attention Stage 0
Q[1]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_4_1_stage1 [label="Ring Attention Stage 1
Q[1]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_4_1_stage2 [label="Ring Attention Stage 2
Q[1]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_4_1_stage3 [label="Ring Attention Stage 3
Q[1]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_4_1_stage4 [label="Ring Attention Stage 4
Q[1]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_4_1_stage5 [label="Ring Attention Stage 5
Q[1]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_4_1_stage6 [label="Ring Attention Stage 6
Q[1]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_4_1_stage7 [label="Ring Attention Stage 7
Q[1]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_4_1_stage8 [label="Ring Attention Stage 8
Q[1]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_4_1_stage9 [label="Ring Attention Stage 9
Q[1]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_4_1_stage10 [label="Ring Attention Stage 10
Q[1]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_4_1_stage11 [label="Ring Attention Stage 11
Q[1]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_4_1_stage12 [label="Ring Attention Stage 12
Q[1]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_4_1_stage13 [label="Ring Attention Stage 13
Q[1]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_4_1_stage14 [label="Ring Attention Stage 14
Q[1]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		ring_attn_4_1_stage15 [label="Ring Attention Stage 15
Q[1]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#4ECDC4" shape=diamond style=filled]
		o_proj_4_1 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=box style=filled]
		residual1_4_1 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=ellipse style=filled]
		ln2_4_1 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=ellipse style=filled]
		router_4_1 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#4ECDC4" shape=hexagon style=filled]
		gate_4_1 [label="Top-2 Gating
Expert Selection" fillcolor="#4ECDC4" shape=pentagon style=filled]
		expert_4_1_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_4_1_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_4_1_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_4_1_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_4_1_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_4_1_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_4_1_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_4_1_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#4ECDC4" shape=box style=filled]
		expert_agg_4_1 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=ellipse style=filled]
		residual2_4_1 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=ellipse style=filled]
	}
	subgraph cluster_layer4_gpu2 {
		color="#45B7D1" fillcolor="#45B7D120" label="Layer 4 - GPU 2" style=filled
		ln1_4_2 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=ellipse style=filled]
		q_proj_4_2 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=box style=filled]
		k_proj_4_2 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=box style=filled]
		v_proj_4_2 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=box style=filled]
		ring_attn_4_2_stage0 [label="Ring Attention Stage 0
Q[2]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_4_2_stage1 [label="Ring Attention Stage 1
Q[2]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_4_2_stage2 [label="Ring Attention Stage 2
Q[2]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_4_2_stage3 [label="Ring Attention Stage 3
Q[2]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_4_2_stage4 [label="Ring Attention Stage 4
Q[2]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_4_2_stage5 [label="Ring Attention Stage 5
Q[2]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_4_2_stage6 [label="Ring Attention Stage 6
Q[2]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_4_2_stage7 [label="Ring Attention Stage 7
Q[2]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_4_2_stage8 [label="Ring Attention Stage 8
Q[2]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_4_2_stage9 [label="Ring Attention Stage 9
Q[2]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_4_2_stage10 [label="Ring Attention Stage 10
Q[2]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_4_2_stage11 [label="Ring Attention Stage 11
Q[2]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_4_2_stage12 [label="Ring Attention Stage 12
Q[2]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_4_2_stage13 [label="Ring Attention Stage 13
Q[2]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_4_2_stage14 [label="Ring Attention Stage 14
Q[2]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		ring_attn_4_2_stage15 [label="Ring Attention Stage 15
Q[2]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#45B7D1" shape=diamond style=filled]
		o_proj_4_2 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=box style=filled]
		residual1_4_2 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=ellipse style=filled]
		ln2_4_2 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=ellipse style=filled]
		router_4_2 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#45B7D1" shape=hexagon style=filled]
		gate_4_2 [label="Top-2 Gating
Expert Selection" fillcolor="#45B7D1" shape=pentagon style=filled]
		expert_4_2_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_4_2_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_4_2_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_4_2_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_4_2_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_4_2_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_4_2_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_4_2_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#45B7D1" shape=box style=filled]
		expert_agg_4_2 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=ellipse style=filled]
		residual2_4_2 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=ellipse style=filled]
	}
	subgraph cluster_layer4_gpu3 {
		color="#96CEB4" fillcolor="#96CEB420" label="Layer 4 - GPU 3" style=filled
		ln1_4_3 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=ellipse style=filled]
		q_proj_4_3 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=box style=filled]
		k_proj_4_3 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=box style=filled]
		v_proj_4_3 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=box style=filled]
		ring_attn_4_3_stage0 [label="Ring Attention Stage 0
Q[3]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_4_3_stage1 [label="Ring Attention Stage 1
Q[3]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_4_3_stage2 [label="Ring Attention Stage 2
Q[3]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_4_3_stage3 [label="Ring Attention Stage 3
Q[3]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_4_3_stage4 [label="Ring Attention Stage 4
Q[3]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_4_3_stage5 [label="Ring Attention Stage 5
Q[3]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_4_3_stage6 [label="Ring Attention Stage 6
Q[3]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_4_3_stage7 [label="Ring Attention Stage 7
Q[3]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_4_3_stage8 [label="Ring Attention Stage 8
Q[3]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_4_3_stage9 [label="Ring Attention Stage 9
Q[3]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_4_3_stage10 [label="Ring Attention Stage 10
Q[3]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_4_3_stage11 [label="Ring Attention Stage 11
Q[3]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_4_3_stage12 [label="Ring Attention Stage 12
Q[3]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_4_3_stage13 [label="Ring Attention Stage 13
Q[3]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_4_3_stage14 [label="Ring Attention Stage 14
Q[3]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		ring_attn_4_3_stage15 [label="Ring Attention Stage 15
Q[3]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#96CEB4" shape=diamond style=filled]
		o_proj_4_3 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=box style=filled]
		residual1_4_3 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=ellipse style=filled]
		ln2_4_3 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=ellipse style=filled]
		router_4_3 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#96CEB4" shape=hexagon style=filled]
		gate_4_3 [label="Top-2 Gating
Expert Selection" fillcolor="#96CEB4" shape=pentagon style=filled]
		expert_4_3_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_4_3_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_4_3_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_4_3_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_4_3_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_4_3_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_4_3_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_4_3_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#96CEB4" shape=box style=filled]
		expert_agg_4_3 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=ellipse style=filled]
		residual2_4_3 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=ellipse style=filled]
	}
	subgraph cluster_layer4_gpu4 {
		color="#FECA57" fillcolor="#FECA5720" label="Layer 4 - GPU 4" style=filled
		ln1_4_4 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=ellipse style=filled]
		q_proj_4_4 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=box style=filled]
		k_proj_4_4 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=box style=filled]
		v_proj_4_4 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=box style=filled]
		ring_attn_4_4_stage0 [label="Ring Attention Stage 0
Q[4]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_4_4_stage1 [label="Ring Attention Stage 1
Q[4]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_4_4_stage2 [label="Ring Attention Stage 2
Q[4]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_4_4_stage3 [label="Ring Attention Stage 3
Q[4]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_4_4_stage4 [label="Ring Attention Stage 4
Q[4]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_4_4_stage5 [label="Ring Attention Stage 5
Q[4]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_4_4_stage6 [label="Ring Attention Stage 6
Q[4]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_4_4_stage7 [label="Ring Attention Stage 7
Q[4]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_4_4_stage8 [label="Ring Attention Stage 8
Q[4]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_4_4_stage9 [label="Ring Attention Stage 9
Q[4]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_4_4_stage10 [label="Ring Attention Stage 10
Q[4]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_4_4_stage11 [label="Ring Attention Stage 11
Q[4]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_4_4_stage12 [label="Ring Attention Stage 12
Q[4]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_4_4_stage13 [label="Ring Attention Stage 13
Q[4]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_4_4_stage14 [label="Ring Attention Stage 14
Q[4]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		ring_attn_4_4_stage15 [label="Ring Attention Stage 15
Q[4]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#FECA57" shape=diamond style=filled]
		o_proj_4_4 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=box style=filled]
		residual1_4_4 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=ellipse style=filled]
		ln2_4_4 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=ellipse style=filled]
		router_4_4 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#FECA57" shape=hexagon style=filled]
		gate_4_4 [label="Top-2 Gating
Expert Selection" fillcolor="#FECA57" shape=pentagon style=filled]
		expert_4_4_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_4_4_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_4_4_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_4_4_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_4_4_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_4_4_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_4_4_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_4_4_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FECA57" shape=box style=filled]
		expert_agg_4_4 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=ellipse style=filled]
		residual2_4_4 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=ellipse style=filled]
	}
	subgraph cluster_layer4_gpu5 {
		color="#FF9FF3" fillcolor="#FF9FF320" label="Layer 4 - GPU 5" style=filled
		ln1_4_5 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=ellipse style=filled]
		q_proj_4_5 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=box style=filled]
		k_proj_4_5 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=box style=filled]
		v_proj_4_5 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=box style=filled]
		ring_attn_4_5_stage0 [label="Ring Attention Stage 0
Q[5]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_4_5_stage1 [label="Ring Attention Stage 1
Q[5]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_4_5_stage2 [label="Ring Attention Stage 2
Q[5]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_4_5_stage3 [label="Ring Attention Stage 3
Q[5]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_4_5_stage4 [label="Ring Attention Stage 4
Q[5]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_4_5_stage5 [label="Ring Attention Stage 5
Q[5]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_4_5_stage6 [label="Ring Attention Stage 6
Q[5]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_4_5_stage7 [label="Ring Attention Stage 7
Q[5]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_4_5_stage8 [label="Ring Attention Stage 8
Q[5]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_4_5_stage9 [label="Ring Attention Stage 9
Q[5]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_4_5_stage10 [label="Ring Attention Stage 10
Q[5]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_4_5_stage11 [label="Ring Attention Stage 11
Q[5]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_4_5_stage12 [label="Ring Attention Stage 12
Q[5]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_4_5_stage13 [label="Ring Attention Stage 13
Q[5]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_4_5_stage14 [label="Ring Attention Stage 14
Q[5]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		ring_attn_4_5_stage15 [label="Ring Attention Stage 15
Q[5]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9FF3" shape=diamond style=filled]
		o_proj_4_5 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=box style=filled]
		residual1_4_5 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=ellipse style=filled]
		ln2_4_5 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=ellipse style=filled]
		router_4_5 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#FF9FF3" shape=hexagon style=filled]
		gate_4_5 [label="Top-2 Gating
Expert Selection" fillcolor="#FF9FF3" shape=pentagon style=filled]
		expert_4_5_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_4_5_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_4_5_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_4_5_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_4_5_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_4_5_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_4_5_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_4_5_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9FF3" shape=box style=filled]
		expert_agg_4_5 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=ellipse style=filled]
		residual2_4_5 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=ellipse style=filled]
	}
	subgraph cluster_layer4_gpu6 {
		color="#54A0FF" fillcolor="#54A0FF20" label="Layer 4 - GPU 6" style=filled
		ln1_4_6 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=ellipse style=filled]
		q_proj_4_6 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=box style=filled]
		k_proj_4_6 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=box style=filled]
		v_proj_4_6 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=box style=filled]
		ring_attn_4_6_stage0 [label="Ring Attention Stage 0
Q[6]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_4_6_stage1 [label="Ring Attention Stage 1
Q[6]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_4_6_stage2 [label="Ring Attention Stage 2
Q[6]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_4_6_stage3 [label="Ring Attention Stage 3
Q[6]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_4_6_stage4 [label="Ring Attention Stage 4
Q[6]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_4_6_stage5 [label="Ring Attention Stage 5
Q[6]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_4_6_stage6 [label="Ring Attention Stage 6
Q[6]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_4_6_stage7 [label="Ring Attention Stage 7
Q[6]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_4_6_stage8 [label="Ring Attention Stage 8
Q[6]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_4_6_stage9 [label="Ring Attention Stage 9
Q[6]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_4_6_stage10 [label="Ring Attention Stage 10
Q[6]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_4_6_stage11 [label="Ring Attention Stage 11
Q[6]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_4_6_stage12 [label="Ring Attention Stage 12
Q[6]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_4_6_stage13 [label="Ring Attention Stage 13
Q[6]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_4_6_stage14 [label="Ring Attention Stage 14
Q[6]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		ring_attn_4_6_stage15 [label="Ring Attention Stage 15
Q[6]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#54A0FF" shape=diamond style=filled]
		o_proj_4_6 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=box style=filled]
		residual1_4_6 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=ellipse style=filled]
		ln2_4_6 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=ellipse style=filled]
		router_4_6 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#54A0FF" shape=hexagon style=filled]
		gate_4_6 [label="Top-2 Gating
Expert Selection" fillcolor="#54A0FF" shape=pentagon style=filled]
		expert_4_6_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_4_6_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_4_6_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_4_6_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_4_6_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_4_6_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_4_6_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_4_6_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#54A0FF" shape=box style=filled]
		expert_agg_4_6 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=ellipse style=filled]
		residual2_4_6 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=ellipse style=filled]
	}
	subgraph cluster_layer4_gpu7 {
		color="#5F27CD" fillcolor="#5F27CD20" label="Layer 4 - GPU 7" style=filled
		ln1_4_7 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=ellipse style=filled]
		q_proj_4_7 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=box style=filled]
		k_proj_4_7 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=box style=filled]
		v_proj_4_7 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=box style=filled]
		ring_attn_4_7_stage0 [label="Ring Attention Stage 0
Q[7]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_4_7_stage1 [label="Ring Attention Stage 1
Q[7]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_4_7_stage2 [label="Ring Attention Stage 2
Q[7]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_4_7_stage3 [label="Ring Attention Stage 3
Q[7]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_4_7_stage4 [label="Ring Attention Stage 4
Q[7]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_4_7_stage5 [label="Ring Attention Stage 5
Q[7]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_4_7_stage6 [label="Ring Attention Stage 6
Q[7]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_4_7_stage7 [label="Ring Attention Stage 7
Q[7]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_4_7_stage8 [label="Ring Attention Stage 8
Q[7]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_4_7_stage9 [label="Ring Attention Stage 9
Q[7]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_4_7_stage10 [label="Ring Attention Stage 10
Q[7]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_4_7_stage11 [label="Ring Attention Stage 11
Q[7]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_4_7_stage12 [label="Ring Attention Stage 12
Q[7]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_4_7_stage13 [label="Ring Attention Stage 13
Q[7]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_4_7_stage14 [label="Ring Attention Stage 14
Q[7]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		ring_attn_4_7_stage15 [label="Ring Attention Stage 15
Q[7]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#5F27CD" shape=diamond style=filled]
		o_proj_4_7 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=box style=filled]
		residual1_4_7 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=ellipse style=filled]
		ln2_4_7 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=ellipse style=filled]
		router_4_7 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#5F27CD" shape=hexagon style=filled]
		gate_4_7 [label="Top-2 Gating
Expert Selection" fillcolor="#5F27CD" shape=pentagon style=filled]
		expert_4_7_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_4_7_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_4_7_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_4_7_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_4_7_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_4_7_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_4_7_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_4_7_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#5F27CD" shape=box style=filled]
		expert_agg_4_7 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=ellipse style=filled]
		residual2_4_7 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=ellipse style=filled]
	}
	subgraph cluster_layer4_gpu8 {
		color="#00D2D3" fillcolor="#00D2D320" label="Layer 4 - GPU 8" style=filled
		ln1_4_8 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=ellipse style=filled]
		q_proj_4_8 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=box style=filled]
		k_proj_4_8 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=box style=filled]
		v_proj_4_8 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=box style=filled]
		ring_attn_4_8_stage0 [label="Ring Attention Stage 0
Q[8]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_4_8_stage1 [label="Ring Attention Stage 1
Q[8]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_4_8_stage2 [label="Ring Attention Stage 2
Q[8]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_4_8_stage3 [label="Ring Attention Stage 3
Q[8]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_4_8_stage4 [label="Ring Attention Stage 4
Q[8]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_4_8_stage5 [label="Ring Attention Stage 5
Q[8]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_4_8_stage6 [label="Ring Attention Stage 6
Q[8]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_4_8_stage7 [label="Ring Attention Stage 7
Q[8]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_4_8_stage8 [label="Ring Attention Stage 8
Q[8]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_4_8_stage9 [label="Ring Attention Stage 9
Q[8]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_4_8_stage10 [label="Ring Attention Stage 10
Q[8]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_4_8_stage11 [label="Ring Attention Stage 11
Q[8]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_4_8_stage12 [label="Ring Attention Stage 12
Q[8]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_4_8_stage13 [label="Ring Attention Stage 13
Q[8]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_4_8_stage14 [label="Ring Attention Stage 14
Q[8]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		ring_attn_4_8_stage15 [label="Ring Attention Stage 15
Q[8]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#00D2D3" shape=diamond style=filled]
		o_proj_4_8 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=box style=filled]
		residual1_4_8 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=ellipse style=filled]
		ln2_4_8 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=ellipse style=filled]
		router_4_8 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#00D2D3" shape=hexagon style=filled]
		gate_4_8 [label="Top-2 Gating
Expert Selection" fillcolor="#00D2D3" shape=pentagon style=filled]
		expert_4_8_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_4_8_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_4_8_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_4_8_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_4_8_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_4_8_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_4_8_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_4_8_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#00D2D3" shape=box style=filled]
		expert_agg_4_8 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=ellipse style=filled]
		residual2_4_8 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=ellipse style=filled]
	}
	subgraph cluster_layer4_gpu9 {
		color="#FF9F43" fillcolor="#FF9F4320" label="Layer 4 - GPU 9" style=filled
		ln1_4_9 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=ellipse style=filled]
		q_proj_4_9 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=box style=filled]
		k_proj_4_9 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=box style=filled]
		v_proj_4_9 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=box style=filled]
		ring_attn_4_9_stage0 [label="Ring Attention Stage 0
Q[9]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_4_9_stage1 [label="Ring Attention Stage 1
Q[9]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_4_9_stage2 [label="Ring Attention Stage 2
Q[9]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_4_9_stage3 [label="Ring Attention Stage 3
Q[9]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_4_9_stage4 [label="Ring Attention Stage 4
Q[9]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_4_9_stage5 [label="Ring Attention Stage 5
Q[9]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_4_9_stage6 [label="Ring Attention Stage 6
Q[9]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_4_9_stage7 [label="Ring Attention Stage 7
Q[9]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_4_9_stage8 [label="Ring Attention Stage 8
Q[9]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_4_9_stage9 [label="Ring Attention Stage 9
Q[9]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_4_9_stage10 [label="Ring Attention Stage 10
Q[9]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_4_9_stage11 [label="Ring Attention Stage 11
Q[9]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_4_9_stage12 [label="Ring Attention Stage 12
Q[9]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_4_9_stage13 [label="Ring Attention Stage 13
Q[9]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_4_9_stage14 [label="Ring Attention Stage 14
Q[9]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		ring_attn_4_9_stage15 [label="Ring Attention Stage 15
Q[9]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#FF9F43" shape=diamond style=filled]
		o_proj_4_9 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=box style=filled]
		residual1_4_9 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=ellipse style=filled]
		ln2_4_9 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=ellipse style=filled]
		router_4_9 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#FF9F43" shape=hexagon style=filled]
		gate_4_9 [label="Top-2 Gating
Expert Selection" fillcolor="#FF9F43" shape=pentagon style=filled]
		expert_4_9_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_4_9_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_4_9_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_4_9_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_4_9_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_4_9_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_4_9_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_4_9_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#FF9F43" shape=box style=filled]
		expert_agg_4_9 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=ellipse style=filled]
		residual2_4_9 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=ellipse style=filled]
	}
	subgraph cluster_layer4_gpu10 {
		color="#10AC84" fillcolor="#10AC8420" label="Layer 4 - GPU 10" style=filled
		ln1_4_10 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=ellipse style=filled]
		q_proj_4_10 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=box style=filled]
		k_proj_4_10 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=box style=filled]
		v_proj_4_10 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=box style=filled]
		ring_attn_4_10_stage0 [label="Ring Attention Stage 0
Q[10]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_4_10_stage1 [label="Ring Attention Stage 1
Q[10]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_4_10_stage2 [label="Ring Attention Stage 2
Q[10]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_4_10_stage3 [label="Ring Attention Stage 3
Q[10]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_4_10_stage4 [label="Ring Attention Stage 4
Q[10]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_4_10_stage5 [label="Ring Attention Stage 5
Q[10]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_4_10_stage6 [label="Ring Attention Stage 6
Q[10]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_4_10_stage7 [label="Ring Attention Stage 7
Q[10]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_4_10_stage8 [label="Ring Attention Stage 8
Q[10]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_4_10_stage9 [label="Ring Attention Stage 9
Q[10]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_4_10_stage10 [label="Ring Attention Stage 10
Q[10]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_4_10_stage11 [label="Ring Attention Stage 11
Q[10]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_4_10_stage12 [label="Ring Attention Stage 12
Q[10]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_4_10_stage13 [label="Ring Attention Stage 13
Q[10]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_4_10_stage14 [label="Ring Attention Stage 14
Q[10]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		ring_attn_4_10_stage15 [label="Ring Attention Stage 15
Q[10]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#10AC84" shape=diamond style=filled]
		o_proj_4_10 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=box style=filled]
		residual1_4_10 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=ellipse style=filled]
		ln2_4_10 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=ellipse style=filled]
		router_4_10 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#10AC84" shape=hexagon style=filled]
		gate_4_10 [label="Top-2 Gating
Expert Selection" fillcolor="#10AC84" shape=pentagon style=filled]
		expert_4_10_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_4_10_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_4_10_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_4_10_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_4_10_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_4_10_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_4_10_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_4_10_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#10AC84" shape=box style=filled]
		expert_agg_4_10 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=ellipse style=filled]
		residual2_4_10 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=ellipse style=filled]
	}
	subgraph cluster_layer4_gpu11 {
		color="#EE5A24" fillcolor="#EE5A2420" label="Layer 4 - GPU 11" style=filled
		ln1_4_11 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=ellipse style=filled]
		q_proj_4_11 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=box style=filled]
		k_proj_4_11 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=box style=filled]
		v_proj_4_11 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=box style=filled]
		ring_attn_4_11_stage0 [label="Ring Attention Stage 0
Q[11]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_4_11_stage1 [label="Ring Attention Stage 1
Q[11]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_4_11_stage2 [label="Ring Attention Stage 2
Q[11]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_4_11_stage3 [label="Ring Attention Stage 3
Q[11]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_4_11_stage4 [label="Ring Attention Stage 4
Q[11]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_4_11_stage5 [label="Ring Attention Stage 5
Q[11]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_4_11_stage6 [label="Ring Attention Stage 6
Q[11]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_4_11_stage7 [label="Ring Attention Stage 7
Q[11]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_4_11_stage8 [label="Ring Attention Stage 8
Q[11]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_4_11_stage9 [label="Ring Attention Stage 9
Q[11]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_4_11_stage10 [label="Ring Attention Stage 10
Q[11]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_4_11_stage11 [label="Ring Attention Stage 11
Q[11]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_4_11_stage12 [label="Ring Attention Stage 12
Q[11]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_4_11_stage13 [label="Ring Attention Stage 13
Q[11]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_4_11_stage14 [label="Ring Attention Stage 14
Q[11]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		ring_attn_4_11_stage15 [label="Ring Attention Stage 15
Q[11]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#EE5A24" shape=diamond style=filled]
		o_proj_4_11 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=box style=filled]
		residual1_4_11 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=ellipse style=filled]
		ln2_4_11 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=ellipse style=filled]
		router_4_11 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#EE5A24" shape=hexagon style=filled]
		gate_4_11 [label="Top-2 Gating
Expert Selection" fillcolor="#EE5A24" shape=pentagon style=filled]
		expert_4_11_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_4_11_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_4_11_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_4_11_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_4_11_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_4_11_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_4_11_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_4_11_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#EE5A24" shape=box style=filled]
		expert_agg_4_11 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=ellipse style=filled]
		residual2_4_11 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=ellipse style=filled]
	}
	subgraph cluster_layer4_gpu12 {
		color="#0652DD" fillcolor="#0652DD20" label="Layer 4 - GPU 12" style=filled
		ln1_4_12 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=ellipse style=filled]
		q_proj_4_12 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=box style=filled]
		k_proj_4_12 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=box style=filled]
		v_proj_4_12 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=box style=filled]
		ring_attn_4_12_stage0 [label="Ring Attention Stage 0
Q[12]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_4_12_stage1 [label="Ring Attention Stage 1
Q[12]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_4_12_stage2 [label="Ring Attention Stage 2
Q[12]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_4_12_stage3 [label="Ring Attention Stage 3
Q[12]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_4_12_stage4 [label="Ring Attention Stage 4
Q[12]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_4_12_stage5 [label="Ring Attention Stage 5
Q[12]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_4_12_stage6 [label="Ring Attention Stage 6
Q[12]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_4_12_stage7 [label="Ring Attention Stage 7
Q[12]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_4_12_stage8 [label="Ring Attention Stage 8
Q[12]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_4_12_stage9 [label="Ring Attention Stage 9
Q[12]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_4_12_stage10 [label="Ring Attention Stage 10
Q[12]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_4_12_stage11 [label="Ring Attention Stage 11
Q[12]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_4_12_stage12 [label="Ring Attention Stage 12
Q[12]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_4_12_stage13 [label="Ring Attention Stage 13
Q[12]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_4_12_stage14 [label="Ring Attention Stage 14
Q[12]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		ring_attn_4_12_stage15 [label="Ring Attention Stage 15
Q[12]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#0652DD" shape=diamond style=filled]
		o_proj_4_12 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=box style=filled]
		residual1_4_12 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=ellipse style=filled]
		ln2_4_12 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=ellipse style=filled]
		router_4_12 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#0652DD" shape=hexagon style=filled]
		gate_4_12 [label="Top-2 Gating
Expert Selection" fillcolor="#0652DD" shape=pentagon style=filled]
		expert_4_12_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_4_12_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_4_12_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_4_12_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_4_12_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_4_12_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_4_12_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_4_12_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#0652DD" shape=box style=filled]
		expert_agg_4_12 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=ellipse style=filled]
		residual2_4_12 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=ellipse style=filled]
	}
	subgraph cluster_layer4_gpu13 {
		color="#9980FA" fillcolor="#9980FA20" label="Layer 4 - GPU 13" style=filled
		ln1_4_13 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=ellipse style=filled]
		q_proj_4_13 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=box style=filled]
		k_proj_4_13 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=box style=filled]
		v_proj_4_13 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=box style=filled]
		ring_attn_4_13_stage0 [label="Ring Attention Stage 0
Q[13]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_4_13_stage1 [label="Ring Attention Stage 1
Q[13]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_4_13_stage2 [label="Ring Attention Stage 2
Q[13]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_4_13_stage3 [label="Ring Attention Stage 3
Q[13]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_4_13_stage4 [label="Ring Attention Stage 4
Q[13]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_4_13_stage5 [label="Ring Attention Stage 5
Q[13]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_4_13_stage6 [label="Ring Attention Stage 6
Q[13]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_4_13_stage7 [label="Ring Attention Stage 7
Q[13]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_4_13_stage8 [label="Ring Attention Stage 8
Q[13]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_4_13_stage9 [label="Ring Attention Stage 9
Q[13]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_4_13_stage10 [label="Ring Attention Stage 10
Q[13]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_4_13_stage11 [label="Ring Attention Stage 11
Q[13]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_4_13_stage12 [label="Ring Attention Stage 12
Q[13]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_4_13_stage13 [label="Ring Attention Stage 13
Q[13]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_4_13_stage14 [label="Ring Attention Stage 14
Q[13]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		ring_attn_4_13_stage15 [label="Ring Attention Stage 15
Q[13]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#9980FA" shape=diamond style=filled]
		o_proj_4_13 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=box style=filled]
		residual1_4_13 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=ellipse style=filled]
		ln2_4_13 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=ellipse style=filled]
		router_4_13 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#9980FA" shape=hexagon style=filled]
		gate_4_13 [label="Top-2 Gating
Expert Selection" fillcolor="#9980FA" shape=pentagon style=filled]
		expert_4_13_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_4_13_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_4_13_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_4_13_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_4_13_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_4_13_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_4_13_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_4_13_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#9980FA" shape=box style=filled]
		expert_agg_4_13 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=ellipse style=filled]
		residual2_4_13 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=ellipse style=filled]
	}
	subgraph cluster_layer4_gpu14 {
		color="#D63031" fillcolor="#D6303120" label="Layer 4 - GPU 14" style=filled
		ln1_4_14 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=ellipse style=filled]
		q_proj_4_14 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=box style=filled]
		k_proj_4_14 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=box style=filled]
		v_proj_4_14 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=box style=filled]
		ring_attn_4_14_stage0 [label="Ring Attention Stage 0
Q[14]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_4_14_stage1 [label="Ring Attention Stage 1
Q[14]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_4_14_stage2 [label="Ring Attention Stage 2
Q[14]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_4_14_stage3 [label="Ring Attention Stage 3
Q[14]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_4_14_stage4 [label="Ring Attention Stage 4
Q[14]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_4_14_stage5 [label="Ring Attention Stage 5
Q[14]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_4_14_stage6 [label="Ring Attention Stage 6
Q[14]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_4_14_stage7 [label="Ring Attention Stage 7
Q[14]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_4_14_stage8 [label="Ring Attention Stage 8
Q[14]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_4_14_stage9 [label="Ring Attention Stage 9
Q[14]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_4_14_stage10 [label="Ring Attention Stage 10
Q[14]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_4_14_stage11 [label="Ring Attention Stage 11
Q[14]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_4_14_stage12 [label="Ring Attention Stage 12
Q[14]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_4_14_stage13 [label="Ring Attention Stage 13
Q[14]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_4_14_stage14 [label="Ring Attention Stage 14
Q[14]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		ring_attn_4_14_stage15 [label="Ring Attention Stage 15
Q[14]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#D63031" shape=diamond style=filled]
		o_proj_4_14 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=box style=filled]
		residual1_4_14 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=ellipse style=filled]
		ln2_4_14 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=ellipse style=filled]
		router_4_14 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#D63031" shape=hexagon style=filled]
		gate_4_14 [label="Top-2 Gating
Expert Selection" fillcolor="#D63031" shape=pentagon style=filled]
		expert_4_14_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_4_14_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_4_14_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_4_14_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_4_14_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_4_14_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_4_14_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_4_14_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#D63031" shape=box style=filled]
		expert_agg_4_14 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=ellipse style=filled]
		residual2_4_14 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=ellipse style=filled]
	}
	subgraph cluster_layer4_gpu15 {
		color="#74B9FF" fillcolor="#74B9FF20" label="Layer 4 - GPU 15" style=filled
		ln1_4_15 [label="LayerNorm 1
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=ellipse style=filled]
		q_proj_4_15 [label="Q Projection (Column)
W_Q ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=box style=filled]
		k_proj_4_15 [label="K Projection (Column)
W_K ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=box style=filled]
		v_proj_4_15 [label="V Projection (Column)
W_V ∈ ℝ^(d_model×d_h×H)
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=box style=filled]
		ring_attn_4_15_stage0 [label="Ring Attention Stage 0
Q[15]×K[15]×V[15]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_4_15_stage1 [label="Ring Attention Stage 1
Q[15]×K[14]×V[14]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_4_15_stage2 [label="Ring Attention Stage 2
Q[15]×K[13]×V[13]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_4_15_stage3 [label="Ring Attention Stage 3
Q[15]×K[12]×V[12]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_4_15_stage4 [label="Ring Attention Stage 4
Q[15]×K[11]×V[11]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_4_15_stage5 [label="Ring Attention Stage 5
Q[15]×K[10]×V[10]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_4_15_stage6 [label="Ring Attention Stage 6
Q[15]×K[9]×V[9]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_4_15_stage7 [label="Ring Attention Stage 7
Q[15]×K[8]×V[8]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_4_15_stage8 [label="Ring Attention Stage 8
Q[15]×K[7]×V[7]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_4_15_stage9 [label="Ring Attention Stage 9
Q[15]×K[6]×V[6]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_4_15_stage10 [label="Ring Attention Stage 10
Q[15]×K[5]×V[5]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_4_15_stage11 [label="Ring Attention Stage 11
Q[15]×K[4]×V[4]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_4_15_stage12 [label="Ring Attention Stage 12
Q[15]×K[3]×V[3]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_4_15_stage13 [label="Ring Attention Stage 13
Q[15]×K[2]×V[2]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_4_15_stage14 [label="Ring Attention Stage 14
Q[15]×K[1]×V[1]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		ring_attn_4_15_stage15 [label="Ring Attention Stage 15
Q[15]×K[0]×V[0]
ℝ^(B×L/16×d_h×H)" fillcolor="#74B9FF" shape=diamond style=filled]
		o_proj_4_15 [label="O Projection (Row)
W_O ∈ ℝ^(d_h×H×d_model)
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=box style=filled]
		residual1_4_15 [label="Residual 1
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=ellipse style=filled]
		ln2_4_15 [label="LayerNorm 2
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=ellipse style=filled]
		router_4_15 [label="Router
Gating Network
ℝ^(B×L/16×8)" fillcolor="#74B9FF" shape=hexagon style=filled]
		gate_4_15 [label="Top-2 Gating
Expert Selection" fillcolor="#74B9FF" shape=pentagon style=filled]
		expert_4_15_0 [label="Expert 0
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_4_15_1 [label="Expert 1
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_4_15_2 [label="Expert 2
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_4_15_3 [label="Expert 3
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_4_15_4 [label="Expert 4
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_4_15_5 [label="Expert 5
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_4_15_6 [label="Expert 6
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_4_15_7 [label="Expert 7
W_gate ∈ ℝ^(d_model×4d_model)
W_up ∈ ℝ^(d_model×4d_model)
W_down ∈ ℝ^(4d_model×d_model)
Capacity: 1.25×tokens" fillcolor="#74B9FF" shape=box style=filled]
		expert_agg_4_15 [label="Expert Aggregation
Weighted Sum
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=ellipse style=filled]
		residual2_4_15 [label="Residual 2
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=ellipse style=filled]
	}
	subgraph cluster_output_0 {
		color="#FF6B6B" fillcolor="#FF6B6B20" label="Output - GPU 0" style=filled
		final_ln_0 [label="Final LayerNorm
ℝ^(B×L/16×d_model)" fillcolor="#FF6B6B" shape=ellipse style=filled]
		output_proj_0 [label="Output Projection
ℝ^(B×L/16×vocab_size)" fillcolor="#FF6B6B" shape=box style=filled]
	}
	subgraph cluster_output_1 {
		color="#4ECDC4" fillcolor="#4ECDC420" label="Output - GPU 1" style=filled
		final_ln_1 [label="Final LayerNorm
ℝ^(B×L/16×d_model)" fillcolor="#4ECDC4" shape=ellipse style=filled]
		output_proj_1 [label="Output Projection
ℝ^(B×L/16×vocab_size)" fillcolor="#4ECDC4" shape=box style=filled]
	}
	subgraph cluster_output_2 {
		color="#45B7D1" fillcolor="#45B7D120" label="Output - GPU 2" style=filled
		final_ln_2 [label="Final LayerNorm
ℝ^(B×L/16×d_model)" fillcolor="#45B7D1" shape=ellipse style=filled]
		output_proj_2 [label="Output Projection
ℝ^(B×L/16×vocab_size)" fillcolor="#45B7D1" shape=box style=filled]
	}
	subgraph cluster_output_3 {
		color="#96CEB4" fillcolor="#96CEB420" label="Output - GPU 3" style=filled
		final_ln_3 [label="Final LayerNorm
ℝ^(B×L/16×d_model)" fillcolor="#96CEB4" shape=ellipse style=filled]
		output_proj_3 [label="Output Projection
ℝ^(B×L/16×vocab_size)" fillcolor="#96CEB4" shape=box style=filled]
	}
	subgraph cluster_output_4 {
		color="#FECA57" fillcolor="#FECA5720" label="Output - GPU 4" style=filled
		final_ln_4 [label="Final LayerNorm
ℝ^(B×L/16×d_model)" fillcolor="#FECA57" shape=ellipse style=filled]
		output_proj_4 [label="Output Projection
ℝ^(B×L/16×vocab_size)" fillcolor="#FECA57" shape=box style=filled]
	}
	subgraph cluster_output_5 {
		color="#FF9FF3" fillcolor="#FF9FF320" label="Output - GPU 5" style=filled
		final_ln_5 [label="Final LayerNorm
ℝ^(B×L/16×d_model)" fillcolor="#FF9FF3" shape=ellipse style=filled]
		output_proj_5 [label="Output Projection
ℝ^(B×L/16×vocab_size)" fillcolor="#FF9FF3" shape=box style=filled]
	}
	subgraph cluster_output_6 {
		color="#54A0FF" fillcolor="#54A0FF20" label="Output - GPU 6" style=filled
		final_ln_6 [label="Final LayerNorm
ℝ^(B×L/16×d_model)" fillcolor="#54A0FF" shape=ellipse style=filled]
		output_proj_6 [label="Output Projection
ℝ^(B×L/16×vocab_size)" fillcolor="#54A0FF" shape=box style=filled]
	}
	subgraph cluster_output_7 {
		color="#5F27CD" fillcolor="#5F27CD20" label="Output - GPU 7" style=filled
		final_ln_7 [label="Final LayerNorm
ℝ^(B×L/16×d_model)" fillcolor="#5F27CD" shape=ellipse style=filled]
		output_proj_7 [label="Output Projection
ℝ^(B×L/16×vocab_size)" fillcolor="#5F27CD" shape=box style=filled]
	}
	subgraph cluster_output_8 {
		color="#00D2D3" fillcolor="#00D2D320" label="Output - GPU 8" style=filled
		final_ln_8 [label="Final LayerNorm
ℝ^(B×L/16×d_model)" fillcolor="#00D2D3" shape=ellipse style=filled]
		output_proj_8 [label="Output Projection
ℝ^(B×L/16×vocab_size)" fillcolor="#00D2D3" shape=box style=filled]
	}
	subgraph cluster_output_9 {
		color="#FF9F43" fillcolor="#FF9F4320" label="Output - GPU 9" style=filled
		final_ln_9 [label="Final LayerNorm
ℝ^(B×L/16×d_model)" fillcolor="#FF9F43" shape=ellipse style=filled]
		output_proj_9 [label="Output Projection
ℝ^(B×L/16×vocab_size)" fillcolor="#FF9F43" shape=box style=filled]
	}
	subgraph cluster_output_10 {
		color="#10AC84" fillcolor="#10AC8420" label="Output - GPU 10" style=filled
		final_ln_10 [label="Final LayerNorm
ℝ^(B×L/16×d_model)" fillcolor="#10AC84" shape=ellipse style=filled]
		output_proj_10 [label="Output Projection
ℝ^(B×L/16×vocab_size)" fillcolor="#10AC84" shape=box style=filled]
	}
	subgraph cluster_output_11 {
		color="#EE5A24" fillcolor="#EE5A2420" label="Output - GPU 11" style=filled
		final_ln_11 [label="Final LayerNorm
ℝ^(B×L/16×d_model)" fillcolor="#EE5A24" shape=ellipse style=filled]
		output_proj_11 [label="Output Projection
ℝ^(B×L/16×vocab_size)" fillcolor="#EE5A24" shape=box style=filled]
	}
	subgraph cluster_output_12 {
		color="#0652DD" fillcolor="#0652DD20" label="Output - GPU 12" style=filled
		final_ln_12 [label="Final LayerNorm
ℝ^(B×L/16×d_model)" fillcolor="#0652DD" shape=ellipse style=filled]
		output_proj_12 [label="Output Projection
ℝ^(B×L/16×vocab_size)" fillcolor="#0652DD" shape=box style=filled]
	}
	subgraph cluster_output_13 {
		color="#9980FA" fillcolor="#9980FA20" label="Output - GPU 13" style=filled
		final_ln_13 [label="Final LayerNorm
ℝ^(B×L/16×d_model)" fillcolor="#9980FA" shape=ellipse style=filled]
		output_proj_13 [label="Output Projection
ℝ^(B×L/16×vocab_size)" fillcolor="#9980FA" shape=box style=filled]
	}
	subgraph cluster_output_14 {
		color="#D63031" fillcolor="#D6303120" label="Output - GPU 14" style=filled
		final_ln_14 [label="Final LayerNorm
ℝ^(B×L/16×d_model)" fillcolor="#D63031" shape=ellipse style=filled]
		output_proj_14 [label="Output Projection
ℝ^(B×L/16×vocab_size)" fillcolor="#D63031" shape=box style=filled]
	}
	subgraph cluster_output_15 {
		color="#74B9FF" fillcolor="#74B9FF20" label="Output - GPU 15" style=filled
		final_ln_15 [label="Final LayerNorm
ℝ^(B×L/16×d_model)" fillcolor="#74B9FF" shape=ellipse style=filled]
		output_proj_15 [label="Output Projection
ℝ^(B×L/16×vocab_size)" fillcolor="#74B9FF" shape=box style=filled]
	}
	input_0 -> ln1_1_0
	input_1 -> ln1_1_1
	input_2 -> ln1_1_2
	input_3 -> ln1_1_3
	input_4 -> ln1_1_4
	input_5 -> ln1_1_5
	input_6 -> ln1_1_6
	input_7 -> ln1_1_7
	input_8 -> ln1_1_8
	input_9 -> ln1_1_9
	input_10 -> ln1_1_10
	input_11 -> ln1_1_11
	input_12 -> ln1_1_12
	input_13 -> ln1_1_13
	input_14 -> ln1_1_14
	input_15 -> ln1_1_15
	ln1_1_0 -> q_proj_1_0
	ln1_1_0 -> k_proj_1_0
	ln1_1_0 -> v_proj_1_0
	q_proj_1_0 -> ring_attn_1_0_stage0
	k_proj_1_0 -> ring_attn_1_0_stage0
	v_proj_1_0 -> ring_attn_1_0_stage0
	ring_attn_1_0_stage0 -> ring_attn_1_0_stage1
	k_proj_1_15 -> ring_attn_1_0_stage1 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_1_15 -> ring_attn_1_0_stage1 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_1_0_stage1 -> ring_attn_1_0_stage2
	k_proj_1_14 -> ring_attn_1_15_stage2 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_1_14 -> ring_attn_1_15_stage2 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_1_0_stage2 -> ring_attn_1_0_stage3
	k_proj_1_13 -> ring_attn_1_14_stage3 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_1_13 -> ring_attn_1_14_stage3 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_1_0_stage3 -> ring_attn_1_0_stage4
	k_proj_1_12 -> ring_attn_1_13_stage4 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_1_12 -> ring_attn_1_13_stage4 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_1_0_stage4 -> ring_attn_1_0_stage5
	k_proj_1_11 -> ring_attn_1_12_stage5 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_1_11 -> ring_attn_1_12_stage5 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_1_0_stage5 -> ring_attn_1_0_stage6
	k_proj_1_10 -> ring_attn_1_11_stage6 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_1_10 -> ring_attn_1_11_stage6 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_1_0_stage6 -> ring_attn_1_0_stage7
	k_proj_1_9 -> ring_attn_1_10_stage7 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_1_9 -> ring_attn_1_10_stage7 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_1_0_stage7 -> ring_attn_1_0_stage8
	k_proj_1_8 -> ring_attn_1_9_stage8 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_1_8 -> ring_attn_1_9_stage8 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_1_0_stage8 -> ring_attn_1_0_stage9
	k_proj_1_7 -> ring_attn_1_8_stage9 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_1_7 -> ring_attn_1_8_stage9 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_1_0_stage9 -> ring_attn_1_0_stage10
	k_proj_1_6 -> ring_attn_1_7_stage10 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_1_6 -> ring_attn_1_7_stage10 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_1_0_stage10 -> ring_attn_1_0_stage11
	k_proj_1_5 -> ring_attn_1_6_stage11 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_1_5 -> ring_attn_1_6_stage11 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_1_0_stage11 -> ring_attn_1_0_stage12
	k_proj_1_4 -> ring_attn_1_5_stage12 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_1_4 -> ring_attn_1_5_stage12 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_1_0_stage12 -> ring_attn_1_0_stage13
	k_proj_1_3 -> ring_attn_1_4_stage13 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_1_3 -> ring_attn_1_4_stage13 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_1_0_stage13 -> ring_attn_1_0_stage14
	k_proj_1_2 -> ring_attn_1_3_stage14 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_1_2 -> ring_attn_1_3_stage14 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_1_0_stage14 -> ring_attn_1_0_stage15
	k_proj_1_1 -> ring_attn_1_2_stage15 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_1_1 -> ring_attn_1_2_stage15 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_1_0_stage15 -> o_proj_1_0
	o_proj_1_0 -> residual1_1_0
	ln1_1_0 -> residual1_1_0 [style=dotted]
	residual1_1_0 -> ln2_1_0
	ln2_1_0 -> router_1_0
	router_1_0 -> gate_1_0
	gate_1_0 -> expert_agg_1_0
	ln2_1_0 -> expert_1_0_0
	expert_1_0_0 -> expert_agg_1_0
	gate_1_0 -> expert_1_0_0 [label="gate weight" style=dotted]
	ln2_1_0 -> expert_1_0_1
	expert_1_0_1 -> expert_agg_1_0
	gate_1_0 -> expert_1_0_1 [label="gate weight" style=dotted]
	ln2_1_0 -> expert_1_0_2
	expert_1_0_2 -> expert_agg_1_0
	gate_1_0 -> expert_1_0_2 [label="gate weight" style=dotted]
	ln2_1_0 -> expert_1_0_3
	expert_1_0_3 -> expert_agg_1_0
	gate_1_0 -> expert_1_0_3 [label="gate weight" style=dotted]
	ln2_1_0 -> expert_1_0_4
	expert_1_0_4 -> expert_agg_1_0
	gate_1_0 -> expert_1_0_4 [label="gate weight" style=dotted]
	ln2_1_0 -> expert_1_0_5
	expert_1_0_5 -> expert_agg_1_0
	gate_1_0 -> expert_1_0_5 [label="gate weight" style=dotted]
	ln2_1_0 -> expert_1_0_6
	expert_1_0_6 -> expert_agg_1_0
	gate_1_0 -> expert_1_0_6 [label="gate weight" style=dotted]
	ln2_1_0 -> expert_1_0_7
	expert_1_0_7 -> expert_agg_1_0
	gate_1_0 -> expert_1_0_7 [label="gate weight" style=dotted]
	expert_agg_1_0 -> residual2_1_0
	ln2_1_0 -> residual2_1_0 [style=dotted]
	ln1_1_1 -> q_proj_1_1
	ln1_1_1 -> k_proj_1_1
	ln1_1_1 -> v_proj_1_1
	q_proj_1_1 -> ring_attn_1_1_stage0
	k_proj_1_1 -> ring_attn_1_1_stage0
	v_proj_1_1 -> ring_attn_1_1_stage0
	ring_attn_1_1_stage0 -> ring_attn_1_1_stage1
	k_proj_1_0 -> ring_attn_1_1_stage1 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_1_0 -> ring_attn_1_1_stage1 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_1_1_stage1 -> ring_attn_1_1_stage2
	k_proj_1_15 -> ring_attn_1_0_stage2 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_1_15 -> ring_attn_1_0_stage2 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_1_1_stage2 -> ring_attn_1_1_stage3
	k_proj_1_14 -> ring_attn_1_15_stage3 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_1_14 -> ring_attn_1_15_stage3 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_1_1_stage3 -> ring_attn_1_1_stage4
	k_proj_1_13 -> ring_attn_1_14_stage4 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_1_13 -> ring_attn_1_14_stage4 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_1_1_stage4 -> ring_attn_1_1_stage5
	k_proj_1_12 -> ring_attn_1_13_stage5 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_1_12 -> ring_attn_1_13_stage5 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_1_1_stage5 -> ring_attn_1_1_stage6
	k_proj_1_11 -> ring_attn_1_12_stage6 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_1_11 -> ring_attn_1_12_stage6 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_1_1_stage6 -> ring_attn_1_1_stage7
	k_proj_1_10 -> ring_attn_1_11_stage7 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_1_10 -> ring_attn_1_11_stage7 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_1_1_stage7 -> ring_attn_1_1_stage8
	k_proj_1_9 -> ring_attn_1_10_stage8 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_1_9 -> ring_attn_1_10_stage8 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_1_1_stage8 -> ring_attn_1_1_stage9
	k_proj_1_8 -> ring_attn_1_9_stage9 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_1_8 -> ring_attn_1_9_stage9 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_1_1_stage9 -> ring_attn_1_1_stage10
	k_proj_1_7 -> ring_attn_1_8_stage10 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_1_7 -> ring_attn_1_8_stage10 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_1_1_stage10 -> ring_attn_1_1_stage11
	k_proj_1_6 -> ring_attn_1_7_stage11 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_1_6 -> ring_attn_1_7_stage11 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_1_1_stage11 -> ring_attn_1_1_stage12
	k_proj_1_5 -> ring_attn_1_6_stage12 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_1_5 -> ring_attn_1_6_stage12 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_1_1_stage12 -> ring_attn_1_1_stage13
	k_proj_1_4 -> ring_attn_1_5_stage13 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_1_4 -> ring_attn_1_5_stage13 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_1_1_stage13 -> ring_attn_1_1_stage14
	k_proj_1_3 -> ring_attn_1_4_stage14 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_1_3 -> ring_attn_1_4_stage14 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_1_1_stage14 -> ring_attn_1_1_stage15
	k_proj_1_2 -> ring_attn_1_3_stage15 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_1_2 -> ring_attn_1_3_stage15 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_1_1_stage15 -> o_proj_1_1
	o_proj_1_1 -> residual1_1_1
	ln1_1_1 -> residual1_1_1 [style=dotted]
	residual1_1_1 -> ln2_1_1
	ln2_1_1 -> router_1_1
	router_1_1 -> gate_1_1
	gate_1_1 -> expert_agg_1_1
	ln2_1_1 -> expert_1_1_0
	expert_1_1_0 -> expert_agg_1_1
	gate_1_1 -> expert_1_1_0 [label="gate weight" style=dotted]
	ln2_1_1 -> expert_1_1_1
	expert_1_1_1 -> expert_agg_1_1
	gate_1_1 -> expert_1_1_1 [label="gate weight" style=dotted]
	ln2_1_1 -> expert_1_1_2
	expert_1_1_2 -> expert_agg_1_1
	gate_1_1 -> expert_1_1_2 [label="gate weight" style=dotted]
	ln2_1_1 -> expert_1_1_3
	expert_1_1_3 -> expert_agg_1_1
	gate_1_1 -> expert_1_1_3 [label="gate weight" style=dotted]
	ln2_1_1 -> expert_1_1_4
	expert_1_1_4 -> expert_agg_1_1
	gate_1_1 -> expert_1_1_4 [label="gate weight" style=dotted]
	ln2_1_1 -> expert_1_1_5
	expert_1_1_5 -> expert_agg_1_1
	gate_1_1 -> expert_1_1_5 [label="gate weight" style=dotted]
	ln2_1_1 -> expert_1_1_6
	expert_1_1_6 -> expert_agg_1_1
	gate_1_1 -> expert_1_1_6 [label="gate weight" style=dotted]
	ln2_1_1 -> expert_1_1_7
	expert_1_1_7 -> expert_agg_1_1
	gate_1_1 -> expert_1_1_7 [label="gate weight" style=dotted]
	expert_agg_1_1 -> residual2_1_1
	ln2_1_1 -> residual2_1_1 [style=dotted]
	ln1_1_2 -> q_proj_1_2
	ln1_1_2 -> k_proj_1_2
	ln1_1_2 -> v_proj_1_2
	q_proj_1_2 -> ring_attn_1_2_stage0
	k_proj_1_2 -> ring_attn_1_2_stage0
	v_proj_1_2 -> ring_attn_1_2_stage0
	ring_attn_1_2_stage0 -> ring_attn_1_2_stage1
	k_proj_1_1 -> ring_attn_1_2_stage1 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_1_1 -> ring_attn_1_2_stage1 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_1_2_stage1 -> ring_attn_1_2_stage2
	k_proj_1_0 -> ring_attn_1_1_stage2 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_1_0 -> ring_attn_1_1_stage2 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_1_2_stage2 -> ring_attn_1_2_stage3
	k_proj_1_15 -> ring_attn_1_0_stage3 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_1_15 -> ring_attn_1_0_stage3 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_1_2_stage3 -> ring_attn_1_2_stage4
	k_proj_1_14 -> ring_attn_1_15_stage4 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_1_14 -> ring_attn_1_15_stage4 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_1_2_stage4 -> ring_attn_1_2_stage5
	k_proj_1_13 -> ring_attn_1_14_stage5 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_1_13 -> ring_attn_1_14_stage5 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_1_2_stage5 -> ring_attn_1_2_stage6
	k_proj_1_12 -> ring_attn_1_13_stage6 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_1_12 -> ring_attn_1_13_stage6 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_1_2_stage6 -> ring_attn_1_2_stage7
	k_proj_1_11 -> ring_attn_1_12_stage7 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_1_11 -> ring_attn_1_12_stage7 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_1_2_stage7 -> ring_attn_1_2_stage8
	k_proj_1_10 -> ring_attn_1_11_stage8 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_1_10 -> ring_attn_1_11_stage8 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_1_2_stage8 -> ring_attn_1_2_stage9
	k_proj_1_9 -> ring_attn_1_10_stage9 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_1_9 -> ring_attn_1_10_stage9 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_1_2_stage9 -> ring_attn_1_2_stage10
	k_proj_1_8 -> ring_attn_1_9_stage10 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_1_8 -> ring_attn_1_9_stage10 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_1_2_stage10 -> ring_attn_1_2_stage11
	k_proj_1_7 -> ring_attn_1_8_stage11 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_1_7 -> ring_attn_1_8_stage11 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_1_2_stage11 -> ring_attn_1_2_stage12
	k_proj_1_6 -> ring_attn_1_7_stage12 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_1_6 -> ring_attn_1_7_stage12 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_1_2_stage12 -> ring_attn_1_2_stage13
	k_proj_1_5 -> ring_attn_1_6_stage13 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_1_5 -> ring_attn_1_6_stage13 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_1_2_stage13 -> ring_attn_1_2_stage14
	k_proj_1_4 -> ring_attn_1_5_stage14 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_1_4 -> ring_attn_1_5_stage14 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_1_2_stage14 -> ring_attn_1_2_stage15
	k_proj_1_3 -> ring_attn_1_4_stage15 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_1_3 -> ring_attn_1_4_stage15 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_1_2_stage15 -> o_proj_1_2
	o_proj_1_2 -> residual1_1_2
	ln1_1_2 -> residual1_1_2 [style=dotted]
	residual1_1_2 -> ln2_1_2
	ln2_1_2 -> router_1_2
	router_1_2 -> gate_1_2
	gate_1_2 -> expert_agg_1_2
	ln2_1_2 -> expert_1_2_0
	expert_1_2_0 -> expert_agg_1_2
	gate_1_2 -> expert_1_2_0 [label="gate weight" style=dotted]
	ln2_1_2 -> expert_1_2_1
	expert_1_2_1 -> expert_agg_1_2
	gate_1_2 -> expert_1_2_1 [label="gate weight" style=dotted]
	ln2_1_2 -> expert_1_2_2
	expert_1_2_2 -> expert_agg_1_2
	gate_1_2 -> expert_1_2_2 [label="gate weight" style=dotted]
	ln2_1_2 -> expert_1_2_3
	expert_1_2_3 -> expert_agg_1_2
	gate_1_2 -> expert_1_2_3 [label="gate weight" style=dotted]
	ln2_1_2 -> expert_1_2_4
	expert_1_2_4 -> expert_agg_1_2
	gate_1_2 -> expert_1_2_4 [label="gate weight" style=dotted]
	ln2_1_2 -> expert_1_2_5
	expert_1_2_5 -> expert_agg_1_2
	gate_1_2 -> expert_1_2_5 [label="gate weight" style=dotted]
	ln2_1_2 -> expert_1_2_6
	expert_1_2_6 -> expert_agg_1_2
	gate_1_2 -> expert_1_2_6 [label="gate weight" style=dotted]
	ln2_1_2 -> expert_1_2_7
	expert_1_2_7 -> expert_agg_1_2
	gate_1_2 -> expert_1_2_7 [label="gate weight" style=dotted]
	expert_agg_1_2 -> residual2_1_2
	ln2_1_2 -> residual2_1_2 [style=dotted]
	ln1_1_3 -> q_proj_1_3
	ln1_1_3 -> k_proj_1_3
	ln1_1_3 -> v_proj_1_3
	q_proj_1_3 -> ring_attn_1_3_stage0
	k_proj_1_3 -> ring_attn_1_3_stage0
	v_proj_1_3 -> ring_attn_1_3_stage0
	ring_attn_1_3_stage0 -> ring_attn_1_3_stage1
	k_proj_1_2 -> ring_attn_1_3_stage1 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_1_2 -> ring_attn_1_3_stage1 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_1_3_stage1 -> ring_attn_1_3_stage2
	k_proj_1_1 -> ring_attn_1_2_stage2 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_1_1 -> ring_attn_1_2_stage2 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_1_3_stage2 -> ring_attn_1_3_stage3
	k_proj_1_0 -> ring_attn_1_1_stage3 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_1_0 -> ring_attn_1_1_stage3 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_1_3_stage3 -> ring_attn_1_3_stage4
	k_proj_1_15 -> ring_attn_1_0_stage4 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_1_15 -> ring_attn_1_0_stage4 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_1_3_stage4 -> ring_attn_1_3_stage5
	k_proj_1_14 -> ring_attn_1_15_stage5 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_1_14 -> ring_attn_1_15_stage5 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_1_3_stage5 -> ring_attn_1_3_stage6
	k_proj_1_13 -> ring_attn_1_14_stage6 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_1_13 -> ring_attn_1_14_stage6 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_1_3_stage6 -> ring_attn_1_3_stage7
	k_proj_1_12 -> ring_attn_1_13_stage7 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_1_12 -> ring_attn_1_13_stage7 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_1_3_stage7 -> ring_attn_1_3_stage8
	k_proj_1_11 -> ring_attn_1_12_stage8 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_1_11 -> ring_attn_1_12_stage8 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_1_3_stage8 -> ring_attn_1_3_stage9
	k_proj_1_10 -> ring_attn_1_11_stage9 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_1_10 -> ring_attn_1_11_stage9 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_1_3_stage9 -> ring_attn_1_3_stage10
	k_proj_1_9 -> ring_attn_1_10_stage10 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_1_9 -> ring_attn_1_10_stage10 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_1_3_stage10 -> ring_attn_1_3_stage11
	k_proj_1_8 -> ring_attn_1_9_stage11 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_1_8 -> ring_attn_1_9_stage11 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_1_3_stage11 -> ring_attn_1_3_stage12
	k_proj_1_7 -> ring_attn_1_8_stage12 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_1_7 -> ring_attn_1_8_stage12 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_1_3_stage12 -> ring_attn_1_3_stage13
	k_proj_1_6 -> ring_attn_1_7_stage13 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_1_6 -> ring_attn_1_7_stage13 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_1_3_stage13 -> ring_attn_1_3_stage14
	k_proj_1_5 -> ring_attn_1_6_stage14 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_1_5 -> ring_attn_1_6_stage14 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_1_3_stage14 -> ring_attn_1_3_stage15
	k_proj_1_4 -> ring_attn_1_5_stage15 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_1_4 -> ring_attn_1_5_stage15 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_1_3_stage15 -> o_proj_1_3
	o_proj_1_3 -> residual1_1_3
	ln1_1_3 -> residual1_1_3 [style=dotted]
	residual1_1_3 -> ln2_1_3
	ln2_1_3 -> router_1_3
	router_1_3 -> gate_1_3
	gate_1_3 -> expert_agg_1_3
	ln2_1_3 -> expert_1_3_0
	expert_1_3_0 -> expert_agg_1_3
	gate_1_3 -> expert_1_3_0 [label="gate weight" style=dotted]
	ln2_1_3 -> expert_1_3_1
	expert_1_3_1 -> expert_agg_1_3
	gate_1_3 -> expert_1_3_1 [label="gate weight" style=dotted]
	ln2_1_3 -> expert_1_3_2
	expert_1_3_2 -> expert_agg_1_3
	gate_1_3 -> expert_1_3_2 [label="gate weight" style=dotted]
	ln2_1_3 -> expert_1_3_3
	expert_1_3_3 -> expert_agg_1_3
	gate_1_3 -> expert_1_3_3 [label="gate weight" style=dotted]
	ln2_1_3 -> expert_1_3_4
	expert_1_3_4 -> expert_agg_1_3
	gate_1_3 -> expert_1_3_4 [label="gate weight" style=dotted]
	ln2_1_3 -> expert_1_3_5
	expert_1_3_5 -> expert_agg_1_3
	gate_1_3 -> expert_1_3_5 [label="gate weight" style=dotted]
	ln2_1_3 -> expert_1_3_6
	expert_1_3_6 -> expert_agg_1_3
	gate_1_3 -> expert_1_3_6 [label="gate weight" style=dotted]
	ln2_1_3 -> expert_1_3_7
	expert_1_3_7 -> expert_agg_1_3
	gate_1_3 -> expert_1_3_7 [label="gate weight" style=dotted]
	expert_agg_1_3 -> residual2_1_3
	ln2_1_3 -> residual2_1_3 [style=dotted]
	ln1_1_4 -> q_proj_1_4
	ln1_1_4 -> k_proj_1_4
	ln1_1_4 -> v_proj_1_4
	q_proj_1_4 -> ring_attn_1_4_stage0
	k_proj_1_4 -> ring_attn_1_4_stage0
	v_proj_1_4 -> ring_attn_1_4_stage0
	ring_attn_1_4_stage0 -> ring_attn_1_4_stage1
	k_proj_1_3 -> ring_attn_1_4_stage1 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_1_3 -> ring_attn_1_4_stage1 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_1_4_stage1 -> ring_attn_1_4_stage2
	k_proj_1_2 -> ring_attn_1_3_stage2 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_1_2 -> ring_attn_1_3_stage2 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_1_4_stage2 -> ring_attn_1_4_stage3
	k_proj_1_1 -> ring_attn_1_2_stage3 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_1_1 -> ring_attn_1_2_stage3 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_1_4_stage3 -> ring_attn_1_4_stage4
	k_proj_1_0 -> ring_attn_1_1_stage4 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_1_0 -> ring_attn_1_1_stage4 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_1_4_stage4 -> ring_attn_1_4_stage5
	k_proj_1_15 -> ring_attn_1_0_stage5 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_1_15 -> ring_attn_1_0_stage5 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_1_4_stage5 -> ring_attn_1_4_stage6
	k_proj_1_14 -> ring_attn_1_15_stage6 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_1_14 -> ring_attn_1_15_stage6 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_1_4_stage6 -> ring_attn_1_4_stage7
	k_proj_1_13 -> ring_attn_1_14_stage7 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_1_13 -> ring_attn_1_14_stage7 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_1_4_stage7 -> ring_attn_1_4_stage8
	k_proj_1_12 -> ring_attn_1_13_stage8 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_1_12 -> ring_attn_1_13_stage8 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_1_4_stage8 -> ring_attn_1_4_stage9
	k_proj_1_11 -> ring_attn_1_12_stage9 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_1_11 -> ring_attn_1_12_stage9 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_1_4_stage9 -> ring_attn_1_4_stage10
	k_proj_1_10 -> ring_attn_1_11_stage10 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_1_10 -> ring_attn_1_11_stage10 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_1_4_stage10 -> ring_attn_1_4_stage11
	k_proj_1_9 -> ring_attn_1_10_stage11 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_1_9 -> ring_attn_1_10_stage11 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_1_4_stage11 -> ring_attn_1_4_stage12
	k_proj_1_8 -> ring_attn_1_9_stage12 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_1_8 -> ring_attn_1_9_stage12 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_1_4_stage12 -> ring_attn_1_4_stage13
	k_proj_1_7 -> ring_attn_1_8_stage13 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_1_7 -> ring_attn_1_8_stage13 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_1_4_stage13 -> ring_attn_1_4_stage14
	k_proj_1_6 -> ring_attn_1_7_stage14 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_1_6 -> ring_attn_1_7_stage14 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_1_4_stage14 -> ring_attn_1_4_stage15
	k_proj_1_5 -> ring_attn_1_6_stage15 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_1_5 -> ring_attn_1_6_stage15 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_1_4_stage15 -> o_proj_1_4
	o_proj_1_4 -> residual1_1_4
	ln1_1_4 -> residual1_1_4 [style=dotted]
	residual1_1_4 -> ln2_1_4
	ln2_1_4 -> router_1_4
	router_1_4 -> gate_1_4
	gate_1_4 -> expert_agg_1_4
	ln2_1_4 -> expert_1_4_0
	expert_1_4_0 -> expert_agg_1_4
	gate_1_4 -> expert_1_4_0 [label="gate weight" style=dotted]
	ln2_1_4 -> expert_1_4_1
	expert_1_4_1 -> expert_agg_1_4
	gate_1_4 -> expert_1_4_1 [label="gate weight" style=dotted]
	ln2_1_4 -> expert_1_4_2
	expert_1_4_2 -> expert_agg_1_4
	gate_1_4 -> expert_1_4_2 [label="gate weight" style=dotted]
	ln2_1_4 -> expert_1_4_3
	expert_1_4_3 -> expert_agg_1_4
	gate_1_4 -> expert_1_4_3 [label="gate weight" style=dotted]
	ln2_1_4 -> expert_1_4_4
	expert_1_4_4 -> expert_agg_1_4
	gate_1_4 -> expert_1_4_4 [label="gate weight" style=dotted]
	ln2_1_4 -> expert_1_4_5
	expert_1_4_5 -> expert_agg_1_4
	gate_1_4 -> expert_1_4_5 [label="gate weight" style=dotted]
	ln2_1_4 -> expert_1_4_6
	expert_1_4_6 -> expert_agg_1_4
	gate_1_4 -> expert_1_4_6 [label="gate weight" style=dotted]
	ln2_1_4 -> expert_1_4_7
	expert_1_4_7 -> expert_agg_1_4
	gate_1_4 -> expert_1_4_7 [label="gate weight" style=dotted]
	expert_agg_1_4 -> residual2_1_4
	ln2_1_4 -> residual2_1_4 [style=dotted]
	ln1_1_5 -> q_proj_1_5
	ln1_1_5 -> k_proj_1_5
	ln1_1_5 -> v_proj_1_5
	q_proj_1_5 -> ring_attn_1_5_stage0
	k_proj_1_5 -> ring_attn_1_5_stage0
	v_proj_1_5 -> ring_attn_1_5_stage0
	ring_attn_1_5_stage0 -> ring_attn_1_5_stage1
	k_proj_1_4 -> ring_attn_1_5_stage1 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_1_4 -> ring_attn_1_5_stage1 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_1_5_stage1 -> ring_attn_1_5_stage2
	k_proj_1_3 -> ring_attn_1_4_stage2 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_1_3 -> ring_attn_1_4_stage2 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_1_5_stage2 -> ring_attn_1_5_stage3
	k_proj_1_2 -> ring_attn_1_3_stage3 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_1_2 -> ring_attn_1_3_stage3 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_1_5_stage3 -> ring_attn_1_5_stage4
	k_proj_1_1 -> ring_attn_1_2_stage4 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_1_1 -> ring_attn_1_2_stage4 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_1_5_stage4 -> ring_attn_1_5_stage5
	k_proj_1_0 -> ring_attn_1_1_stage5 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_1_0 -> ring_attn_1_1_stage5 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_1_5_stage5 -> ring_attn_1_5_stage6
	k_proj_1_15 -> ring_attn_1_0_stage6 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_1_15 -> ring_attn_1_0_stage6 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_1_5_stage6 -> ring_attn_1_5_stage7
	k_proj_1_14 -> ring_attn_1_15_stage7 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_1_14 -> ring_attn_1_15_stage7 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_1_5_stage7 -> ring_attn_1_5_stage8
	k_proj_1_13 -> ring_attn_1_14_stage8 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_1_13 -> ring_attn_1_14_stage8 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_1_5_stage8 -> ring_attn_1_5_stage9
	k_proj_1_12 -> ring_attn_1_13_stage9 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_1_12 -> ring_attn_1_13_stage9 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_1_5_stage9 -> ring_attn_1_5_stage10
	k_proj_1_11 -> ring_attn_1_12_stage10 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_1_11 -> ring_attn_1_12_stage10 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_1_5_stage10 -> ring_attn_1_5_stage11
	k_proj_1_10 -> ring_attn_1_11_stage11 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_1_10 -> ring_attn_1_11_stage11 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_1_5_stage11 -> ring_attn_1_5_stage12
	k_proj_1_9 -> ring_attn_1_10_stage12 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_1_9 -> ring_attn_1_10_stage12 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_1_5_stage12 -> ring_attn_1_5_stage13
	k_proj_1_8 -> ring_attn_1_9_stage13 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_1_8 -> ring_attn_1_9_stage13 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_1_5_stage13 -> ring_attn_1_5_stage14
	k_proj_1_7 -> ring_attn_1_8_stage14 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_1_7 -> ring_attn_1_8_stage14 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_1_5_stage14 -> ring_attn_1_5_stage15
	k_proj_1_6 -> ring_attn_1_7_stage15 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_1_6 -> ring_attn_1_7_stage15 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_1_5_stage15 -> o_proj_1_5
	o_proj_1_5 -> residual1_1_5
	ln1_1_5 -> residual1_1_5 [style=dotted]
	residual1_1_5 -> ln2_1_5
	ln2_1_5 -> router_1_5
	router_1_5 -> gate_1_5
	gate_1_5 -> expert_agg_1_5
	ln2_1_5 -> expert_1_5_0
	expert_1_5_0 -> expert_agg_1_5
	gate_1_5 -> expert_1_5_0 [label="gate weight" style=dotted]
	ln2_1_5 -> expert_1_5_1
	expert_1_5_1 -> expert_agg_1_5
	gate_1_5 -> expert_1_5_1 [label="gate weight" style=dotted]
	ln2_1_5 -> expert_1_5_2
	expert_1_5_2 -> expert_agg_1_5
	gate_1_5 -> expert_1_5_2 [label="gate weight" style=dotted]
	ln2_1_5 -> expert_1_5_3
	expert_1_5_3 -> expert_agg_1_5
	gate_1_5 -> expert_1_5_3 [label="gate weight" style=dotted]
	ln2_1_5 -> expert_1_5_4
	expert_1_5_4 -> expert_agg_1_5
	gate_1_5 -> expert_1_5_4 [label="gate weight" style=dotted]
	ln2_1_5 -> expert_1_5_5
	expert_1_5_5 -> expert_agg_1_5
	gate_1_5 -> expert_1_5_5 [label="gate weight" style=dotted]
	ln2_1_5 -> expert_1_5_6
	expert_1_5_6 -> expert_agg_1_5
	gate_1_5 -> expert_1_5_6 [label="gate weight" style=dotted]
	ln2_1_5 -> expert_1_5_7
	expert_1_5_7 -> expert_agg_1_5
	gate_1_5 -> expert_1_5_7 [label="gate weight" style=dotted]
	expert_agg_1_5 -> residual2_1_5
	ln2_1_5 -> residual2_1_5 [style=dotted]
	ln1_1_6 -> q_proj_1_6
	ln1_1_6 -> k_proj_1_6
	ln1_1_6 -> v_proj_1_6
	q_proj_1_6 -> ring_attn_1_6_stage0
	k_proj_1_6 -> ring_attn_1_6_stage0
	v_proj_1_6 -> ring_attn_1_6_stage0
	ring_attn_1_6_stage0 -> ring_attn_1_6_stage1
	k_proj_1_5 -> ring_attn_1_6_stage1 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_1_5 -> ring_attn_1_6_stage1 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_1_6_stage1 -> ring_attn_1_6_stage2
	k_proj_1_4 -> ring_attn_1_5_stage2 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_1_4 -> ring_attn_1_5_stage2 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_1_6_stage2 -> ring_attn_1_6_stage3
	k_proj_1_3 -> ring_attn_1_4_stage3 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_1_3 -> ring_attn_1_4_stage3 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_1_6_stage3 -> ring_attn_1_6_stage4
	k_proj_1_2 -> ring_attn_1_3_stage4 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_1_2 -> ring_attn_1_3_stage4 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_1_6_stage4 -> ring_attn_1_6_stage5
	k_proj_1_1 -> ring_attn_1_2_stage5 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_1_1 -> ring_attn_1_2_stage5 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_1_6_stage5 -> ring_attn_1_6_stage6
	k_proj_1_0 -> ring_attn_1_1_stage6 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_1_0 -> ring_attn_1_1_stage6 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_1_6_stage6 -> ring_attn_1_6_stage7
	k_proj_1_15 -> ring_attn_1_0_stage7 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_1_15 -> ring_attn_1_0_stage7 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_1_6_stage7 -> ring_attn_1_6_stage8
	k_proj_1_14 -> ring_attn_1_15_stage8 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_1_14 -> ring_attn_1_15_stage8 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_1_6_stage8 -> ring_attn_1_6_stage9
	k_proj_1_13 -> ring_attn_1_14_stage9 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_1_13 -> ring_attn_1_14_stage9 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_1_6_stage9 -> ring_attn_1_6_stage10
	k_proj_1_12 -> ring_attn_1_13_stage10 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_1_12 -> ring_attn_1_13_stage10 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_1_6_stage10 -> ring_attn_1_6_stage11
	k_proj_1_11 -> ring_attn_1_12_stage11 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_1_11 -> ring_attn_1_12_stage11 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_1_6_stage11 -> ring_attn_1_6_stage12
	k_proj_1_10 -> ring_attn_1_11_stage12 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_1_10 -> ring_attn_1_11_stage12 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_1_6_stage12 -> ring_attn_1_6_stage13
	k_proj_1_9 -> ring_attn_1_10_stage13 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_1_9 -> ring_attn_1_10_stage13 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_1_6_stage13 -> ring_attn_1_6_stage14
	k_proj_1_8 -> ring_attn_1_9_stage14 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_1_8 -> ring_attn_1_9_stage14 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_1_6_stage14 -> ring_attn_1_6_stage15
	k_proj_1_7 -> ring_attn_1_8_stage15 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_1_7 -> ring_attn_1_8_stage15 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_1_6_stage15 -> o_proj_1_6
	o_proj_1_6 -> residual1_1_6
	ln1_1_6 -> residual1_1_6 [style=dotted]
	residual1_1_6 -> ln2_1_6
	ln2_1_6 -> router_1_6
	router_1_6 -> gate_1_6
	gate_1_6 -> expert_agg_1_6
	ln2_1_6 -> expert_1_6_0
	expert_1_6_0 -> expert_agg_1_6
	gate_1_6 -> expert_1_6_0 [label="gate weight" style=dotted]
	ln2_1_6 -> expert_1_6_1
	expert_1_6_1 -> expert_agg_1_6
	gate_1_6 -> expert_1_6_1 [label="gate weight" style=dotted]
	ln2_1_6 -> expert_1_6_2
	expert_1_6_2 -> expert_agg_1_6
	gate_1_6 -> expert_1_6_2 [label="gate weight" style=dotted]
	ln2_1_6 -> expert_1_6_3
	expert_1_6_3 -> expert_agg_1_6
	gate_1_6 -> expert_1_6_3 [label="gate weight" style=dotted]
	ln2_1_6 -> expert_1_6_4
	expert_1_6_4 -> expert_agg_1_6
	gate_1_6 -> expert_1_6_4 [label="gate weight" style=dotted]
	ln2_1_6 -> expert_1_6_5
	expert_1_6_5 -> expert_agg_1_6
	gate_1_6 -> expert_1_6_5 [label="gate weight" style=dotted]
	ln2_1_6 -> expert_1_6_6
	expert_1_6_6 -> expert_agg_1_6
	gate_1_6 -> expert_1_6_6 [label="gate weight" style=dotted]
	ln2_1_6 -> expert_1_6_7
	expert_1_6_7 -> expert_agg_1_6
	gate_1_6 -> expert_1_6_7 [label="gate weight" style=dotted]
	expert_agg_1_6 -> residual2_1_6
	ln2_1_6 -> residual2_1_6 [style=dotted]
	ln1_1_7 -> q_proj_1_7
	ln1_1_7 -> k_proj_1_7
	ln1_1_7 -> v_proj_1_7
	q_proj_1_7 -> ring_attn_1_7_stage0
	k_proj_1_7 -> ring_attn_1_7_stage0
	v_proj_1_7 -> ring_attn_1_7_stage0
	ring_attn_1_7_stage0 -> ring_attn_1_7_stage1
	k_proj_1_6 -> ring_attn_1_7_stage1 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_1_6 -> ring_attn_1_7_stage1 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_1_7_stage1 -> ring_attn_1_7_stage2
	k_proj_1_5 -> ring_attn_1_6_stage2 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_1_5 -> ring_attn_1_6_stage2 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_1_7_stage2 -> ring_attn_1_7_stage3
	k_proj_1_4 -> ring_attn_1_5_stage3 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_1_4 -> ring_attn_1_5_stage3 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_1_7_stage3 -> ring_attn_1_7_stage4
	k_proj_1_3 -> ring_attn_1_4_stage4 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_1_3 -> ring_attn_1_4_stage4 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_1_7_stage4 -> ring_attn_1_7_stage5
	k_proj_1_2 -> ring_attn_1_3_stage5 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_1_2 -> ring_attn_1_3_stage5 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_1_7_stage5 -> ring_attn_1_7_stage6
	k_proj_1_1 -> ring_attn_1_2_stage6 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_1_1 -> ring_attn_1_2_stage6 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_1_7_stage6 -> ring_attn_1_7_stage7
	k_proj_1_0 -> ring_attn_1_1_stage7 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_1_0 -> ring_attn_1_1_stage7 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_1_7_stage7 -> ring_attn_1_7_stage8
	k_proj_1_15 -> ring_attn_1_0_stage8 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_1_15 -> ring_attn_1_0_stage8 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_1_7_stage8 -> ring_attn_1_7_stage9
	k_proj_1_14 -> ring_attn_1_15_stage9 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_1_14 -> ring_attn_1_15_stage9 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_1_7_stage9 -> ring_attn_1_7_stage10
	k_proj_1_13 -> ring_attn_1_14_stage10 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_1_13 -> ring_attn_1_14_stage10 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_1_7_stage10 -> ring_attn_1_7_stage11
	k_proj_1_12 -> ring_attn_1_13_stage11 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_1_12 -> ring_attn_1_13_stage11 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_1_7_stage11 -> ring_attn_1_7_stage12
	k_proj_1_11 -> ring_attn_1_12_stage12 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_1_11 -> ring_attn_1_12_stage12 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_1_7_stage12 -> ring_attn_1_7_stage13
	k_proj_1_10 -> ring_attn_1_11_stage13 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_1_10 -> ring_attn_1_11_stage13 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_1_7_stage13 -> ring_attn_1_7_stage14
	k_proj_1_9 -> ring_attn_1_10_stage14 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_1_9 -> ring_attn_1_10_stage14 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_1_7_stage14 -> ring_attn_1_7_stage15
	k_proj_1_8 -> ring_attn_1_9_stage15 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_1_8 -> ring_attn_1_9_stage15 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_1_7_stage15 -> o_proj_1_7
	o_proj_1_7 -> residual1_1_7
	ln1_1_7 -> residual1_1_7 [style=dotted]
	residual1_1_7 -> ln2_1_7
	ln2_1_7 -> router_1_7
	router_1_7 -> gate_1_7
	gate_1_7 -> expert_agg_1_7
	ln2_1_7 -> expert_1_7_0
	expert_1_7_0 -> expert_agg_1_7
	gate_1_7 -> expert_1_7_0 [label="gate weight" style=dotted]
	ln2_1_7 -> expert_1_7_1
	expert_1_7_1 -> expert_agg_1_7
	gate_1_7 -> expert_1_7_1 [label="gate weight" style=dotted]
	ln2_1_7 -> expert_1_7_2
	expert_1_7_2 -> expert_agg_1_7
	gate_1_7 -> expert_1_7_2 [label="gate weight" style=dotted]
	ln2_1_7 -> expert_1_7_3
	expert_1_7_3 -> expert_agg_1_7
	gate_1_7 -> expert_1_7_3 [label="gate weight" style=dotted]
	ln2_1_7 -> expert_1_7_4
	expert_1_7_4 -> expert_agg_1_7
	gate_1_7 -> expert_1_7_4 [label="gate weight" style=dotted]
	ln2_1_7 -> expert_1_7_5
	expert_1_7_5 -> expert_agg_1_7
	gate_1_7 -> expert_1_7_5 [label="gate weight" style=dotted]
	ln2_1_7 -> expert_1_7_6
	expert_1_7_6 -> expert_agg_1_7
	gate_1_7 -> expert_1_7_6 [label="gate weight" style=dotted]
	ln2_1_7 -> expert_1_7_7
	expert_1_7_7 -> expert_agg_1_7
	gate_1_7 -> expert_1_7_7 [label="gate weight" style=dotted]
	expert_agg_1_7 -> residual2_1_7
	ln2_1_7 -> residual2_1_7 [style=dotted]
	ln1_1_8 -> q_proj_1_8
	ln1_1_8 -> k_proj_1_8
	ln1_1_8 -> v_proj_1_8
	q_proj_1_8 -> ring_attn_1_8_stage0
	k_proj_1_8 -> ring_attn_1_8_stage0
	v_proj_1_8 -> ring_attn_1_8_stage0
	ring_attn_1_8_stage0 -> ring_attn_1_8_stage1
	k_proj_1_7 -> ring_attn_1_8_stage1 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_1_7 -> ring_attn_1_8_stage1 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_1_8_stage1 -> ring_attn_1_8_stage2
	k_proj_1_6 -> ring_attn_1_7_stage2 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_1_6 -> ring_attn_1_7_stage2 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_1_8_stage2 -> ring_attn_1_8_stage3
	k_proj_1_5 -> ring_attn_1_6_stage3 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_1_5 -> ring_attn_1_6_stage3 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_1_8_stage3 -> ring_attn_1_8_stage4
	k_proj_1_4 -> ring_attn_1_5_stage4 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_1_4 -> ring_attn_1_5_stage4 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_1_8_stage4 -> ring_attn_1_8_stage5
	k_proj_1_3 -> ring_attn_1_4_stage5 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_1_3 -> ring_attn_1_4_stage5 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_1_8_stage5 -> ring_attn_1_8_stage6
	k_proj_1_2 -> ring_attn_1_3_stage6 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_1_2 -> ring_attn_1_3_stage6 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_1_8_stage6 -> ring_attn_1_8_stage7
	k_proj_1_1 -> ring_attn_1_2_stage7 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_1_1 -> ring_attn_1_2_stage7 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_1_8_stage7 -> ring_attn_1_8_stage8
	k_proj_1_0 -> ring_attn_1_1_stage8 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_1_0 -> ring_attn_1_1_stage8 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_1_8_stage8 -> ring_attn_1_8_stage9
	k_proj_1_15 -> ring_attn_1_0_stage9 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_1_15 -> ring_attn_1_0_stage9 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_1_8_stage9 -> ring_attn_1_8_stage10
	k_proj_1_14 -> ring_attn_1_15_stage10 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_1_14 -> ring_attn_1_15_stage10 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_1_8_stage10 -> ring_attn_1_8_stage11
	k_proj_1_13 -> ring_attn_1_14_stage11 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_1_13 -> ring_attn_1_14_stage11 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_1_8_stage11 -> ring_attn_1_8_stage12
	k_proj_1_12 -> ring_attn_1_13_stage12 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_1_12 -> ring_attn_1_13_stage12 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_1_8_stage12 -> ring_attn_1_8_stage13
	k_proj_1_11 -> ring_attn_1_12_stage13 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_1_11 -> ring_attn_1_12_stage13 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_1_8_stage13 -> ring_attn_1_8_stage14
	k_proj_1_10 -> ring_attn_1_11_stage14 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_1_10 -> ring_attn_1_11_stage14 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_1_8_stage14 -> ring_attn_1_8_stage15
	k_proj_1_9 -> ring_attn_1_10_stage15 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_1_9 -> ring_attn_1_10_stage15 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_1_8_stage15 -> o_proj_1_8
	o_proj_1_8 -> residual1_1_8
	ln1_1_8 -> residual1_1_8 [style=dotted]
	residual1_1_8 -> ln2_1_8
	ln2_1_8 -> router_1_8
	router_1_8 -> gate_1_8
	gate_1_8 -> expert_agg_1_8
	ln2_1_8 -> expert_1_8_0
	expert_1_8_0 -> expert_agg_1_8
	gate_1_8 -> expert_1_8_0 [label="gate weight" style=dotted]
	ln2_1_8 -> expert_1_8_1
	expert_1_8_1 -> expert_agg_1_8
	gate_1_8 -> expert_1_8_1 [label="gate weight" style=dotted]
	ln2_1_8 -> expert_1_8_2
	expert_1_8_2 -> expert_agg_1_8
	gate_1_8 -> expert_1_8_2 [label="gate weight" style=dotted]
	ln2_1_8 -> expert_1_8_3
	expert_1_8_3 -> expert_agg_1_8
	gate_1_8 -> expert_1_8_3 [label="gate weight" style=dotted]
	ln2_1_8 -> expert_1_8_4
	expert_1_8_4 -> expert_agg_1_8
	gate_1_8 -> expert_1_8_4 [label="gate weight" style=dotted]
	ln2_1_8 -> expert_1_8_5
	expert_1_8_5 -> expert_agg_1_8
	gate_1_8 -> expert_1_8_5 [label="gate weight" style=dotted]
	ln2_1_8 -> expert_1_8_6
	expert_1_8_6 -> expert_agg_1_8
	gate_1_8 -> expert_1_8_6 [label="gate weight" style=dotted]
	ln2_1_8 -> expert_1_8_7
	expert_1_8_7 -> expert_agg_1_8
	gate_1_8 -> expert_1_8_7 [label="gate weight" style=dotted]
	expert_agg_1_8 -> residual2_1_8
	ln2_1_8 -> residual2_1_8 [style=dotted]
	ln1_1_9 -> q_proj_1_9
	ln1_1_9 -> k_proj_1_9
	ln1_1_9 -> v_proj_1_9
	q_proj_1_9 -> ring_attn_1_9_stage0
	k_proj_1_9 -> ring_attn_1_9_stage0
	v_proj_1_9 -> ring_attn_1_9_stage0
	ring_attn_1_9_stage0 -> ring_attn_1_9_stage1
	k_proj_1_8 -> ring_attn_1_9_stage1 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_1_8 -> ring_attn_1_9_stage1 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_1_9_stage1 -> ring_attn_1_9_stage2
	k_proj_1_7 -> ring_attn_1_8_stage2 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_1_7 -> ring_attn_1_8_stage2 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_1_9_stage2 -> ring_attn_1_9_stage3
	k_proj_1_6 -> ring_attn_1_7_stage3 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_1_6 -> ring_attn_1_7_stage3 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_1_9_stage3 -> ring_attn_1_9_stage4
	k_proj_1_5 -> ring_attn_1_6_stage4 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_1_5 -> ring_attn_1_6_stage4 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_1_9_stage4 -> ring_attn_1_9_stage5
	k_proj_1_4 -> ring_attn_1_5_stage5 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_1_4 -> ring_attn_1_5_stage5 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_1_9_stage5 -> ring_attn_1_9_stage6
	k_proj_1_3 -> ring_attn_1_4_stage6 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_1_3 -> ring_attn_1_4_stage6 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_1_9_stage6 -> ring_attn_1_9_stage7
	k_proj_1_2 -> ring_attn_1_3_stage7 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_1_2 -> ring_attn_1_3_stage7 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_1_9_stage7 -> ring_attn_1_9_stage8
	k_proj_1_1 -> ring_attn_1_2_stage8 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_1_1 -> ring_attn_1_2_stage8 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_1_9_stage8 -> ring_attn_1_9_stage9
	k_proj_1_0 -> ring_attn_1_1_stage9 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_1_0 -> ring_attn_1_1_stage9 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_1_9_stage9 -> ring_attn_1_9_stage10
	k_proj_1_15 -> ring_attn_1_0_stage10 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_1_15 -> ring_attn_1_0_stage10 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_1_9_stage10 -> ring_attn_1_9_stage11
	k_proj_1_14 -> ring_attn_1_15_stage11 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_1_14 -> ring_attn_1_15_stage11 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_1_9_stage11 -> ring_attn_1_9_stage12
	k_proj_1_13 -> ring_attn_1_14_stage12 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_1_13 -> ring_attn_1_14_stage12 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_1_9_stage12 -> ring_attn_1_9_stage13
	k_proj_1_12 -> ring_attn_1_13_stage13 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_1_12 -> ring_attn_1_13_stage13 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_1_9_stage13 -> ring_attn_1_9_stage14
	k_proj_1_11 -> ring_attn_1_12_stage14 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_1_11 -> ring_attn_1_12_stage14 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_1_9_stage14 -> ring_attn_1_9_stage15
	k_proj_1_10 -> ring_attn_1_11_stage15 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_1_10 -> ring_attn_1_11_stage15 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_1_9_stage15 -> o_proj_1_9
	o_proj_1_9 -> residual1_1_9
	ln1_1_9 -> residual1_1_9 [style=dotted]
	residual1_1_9 -> ln2_1_9
	ln2_1_9 -> router_1_9
	router_1_9 -> gate_1_9
	gate_1_9 -> expert_agg_1_9
	ln2_1_9 -> expert_1_9_0
	expert_1_9_0 -> expert_agg_1_9
	gate_1_9 -> expert_1_9_0 [label="gate weight" style=dotted]
	ln2_1_9 -> expert_1_9_1
	expert_1_9_1 -> expert_agg_1_9
	gate_1_9 -> expert_1_9_1 [label="gate weight" style=dotted]
	ln2_1_9 -> expert_1_9_2
	expert_1_9_2 -> expert_agg_1_9
	gate_1_9 -> expert_1_9_2 [label="gate weight" style=dotted]
	ln2_1_9 -> expert_1_9_3
	expert_1_9_3 -> expert_agg_1_9
	gate_1_9 -> expert_1_9_3 [label="gate weight" style=dotted]
	ln2_1_9 -> expert_1_9_4
	expert_1_9_4 -> expert_agg_1_9
	gate_1_9 -> expert_1_9_4 [label="gate weight" style=dotted]
	ln2_1_9 -> expert_1_9_5
	expert_1_9_5 -> expert_agg_1_9
	gate_1_9 -> expert_1_9_5 [label="gate weight" style=dotted]
	ln2_1_9 -> expert_1_9_6
	expert_1_9_6 -> expert_agg_1_9
	gate_1_9 -> expert_1_9_6 [label="gate weight" style=dotted]
	ln2_1_9 -> expert_1_9_7
	expert_1_9_7 -> expert_agg_1_9
	gate_1_9 -> expert_1_9_7 [label="gate weight" style=dotted]
	expert_agg_1_9 -> residual2_1_9
	ln2_1_9 -> residual2_1_9 [style=dotted]
	ln1_1_10 -> q_proj_1_10
	ln1_1_10 -> k_proj_1_10
	ln1_1_10 -> v_proj_1_10
	q_proj_1_10 -> ring_attn_1_10_stage0
	k_proj_1_10 -> ring_attn_1_10_stage0
	v_proj_1_10 -> ring_attn_1_10_stage0
	ring_attn_1_10_stage0 -> ring_attn_1_10_stage1
	k_proj_1_9 -> ring_attn_1_10_stage1 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_1_9 -> ring_attn_1_10_stage1 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_1_10_stage1 -> ring_attn_1_10_stage2
	k_proj_1_8 -> ring_attn_1_9_stage2 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_1_8 -> ring_attn_1_9_stage2 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_1_10_stage2 -> ring_attn_1_10_stage3
	k_proj_1_7 -> ring_attn_1_8_stage3 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_1_7 -> ring_attn_1_8_stage3 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_1_10_stage3 -> ring_attn_1_10_stage4
	k_proj_1_6 -> ring_attn_1_7_stage4 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_1_6 -> ring_attn_1_7_stage4 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_1_10_stage4 -> ring_attn_1_10_stage5
	k_proj_1_5 -> ring_attn_1_6_stage5 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_1_5 -> ring_attn_1_6_stage5 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_1_10_stage5 -> ring_attn_1_10_stage6
	k_proj_1_4 -> ring_attn_1_5_stage6 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_1_4 -> ring_attn_1_5_stage6 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_1_10_stage6 -> ring_attn_1_10_stage7
	k_proj_1_3 -> ring_attn_1_4_stage7 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_1_3 -> ring_attn_1_4_stage7 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_1_10_stage7 -> ring_attn_1_10_stage8
	k_proj_1_2 -> ring_attn_1_3_stage8 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_1_2 -> ring_attn_1_3_stage8 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_1_10_stage8 -> ring_attn_1_10_stage9
	k_proj_1_1 -> ring_attn_1_2_stage9 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_1_1 -> ring_attn_1_2_stage9 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_1_10_stage9 -> ring_attn_1_10_stage10
	k_proj_1_0 -> ring_attn_1_1_stage10 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_1_0 -> ring_attn_1_1_stage10 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_1_10_stage10 -> ring_attn_1_10_stage11
	k_proj_1_15 -> ring_attn_1_0_stage11 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_1_15 -> ring_attn_1_0_stage11 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_1_10_stage11 -> ring_attn_1_10_stage12
	k_proj_1_14 -> ring_attn_1_15_stage12 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_1_14 -> ring_attn_1_15_stage12 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_1_10_stage12 -> ring_attn_1_10_stage13
	k_proj_1_13 -> ring_attn_1_14_stage13 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_1_13 -> ring_attn_1_14_stage13 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_1_10_stage13 -> ring_attn_1_10_stage14
	k_proj_1_12 -> ring_attn_1_13_stage14 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_1_12 -> ring_attn_1_13_stage14 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_1_10_stage14 -> ring_attn_1_10_stage15
	k_proj_1_11 -> ring_attn_1_12_stage15 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_1_11 -> ring_attn_1_12_stage15 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_1_10_stage15 -> o_proj_1_10
	o_proj_1_10 -> residual1_1_10
	ln1_1_10 -> residual1_1_10 [style=dotted]
	residual1_1_10 -> ln2_1_10
	ln2_1_10 -> router_1_10
	router_1_10 -> gate_1_10
	gate_1_10 -> expert_agg_1_10
	ln2_1_10 -> expert_1_10_0
	expert_1_10_0 -> expert_agg_1_10
	gate_1_10 -> expert_1_10_0 [label="gate weight" style=dotted]
	ln2_1_10 -> expert_1_10_1
	expert_1_10_1 -> expert_agg_1_10
	gate_1_10 -> expert_1_10_1 [label="gate weight" style=dotted]
	ln2_1_10 -> expert_1_10_2
	expert_1_10_2 -> expert_agg_1_10
	gate_1_10 -> expert_1_10_2 [label="gate weight" style=dotted]
	ln2_1_10 -> expert_1_10_3
	expert_1_10_3 -> expert_agg_1_10
	gate_1_10 -> expert_1_10_3 [label="gate weight" style=dotted]
	ln2_1_10 -> expert_1_10_4
	expert_1_10_4 -> expert_agg_1_10
	gate_1_10 -> expert_1_10_4 [label="gate weight" style=dotted]
	ln2_1_10 -> expert_1_10_5
	expert_1_10_5 -> expert_agg_1_10
	gate_1_10 -> expert_1_10_5 [label="gate weight" style=dotted]
	ln2_1_10 -> expert_1_10_6
	expert_1_10_6 -> expert_agg_1_10
	gate_1_10 -> expert_1_10_6 [label="gate weight" style=dotted]
	ln2_1_10 -> expert_1_10_7
	expert_1_10_7 -> expert_agg_1_10
	gate_1_10 -> expert_1_10_7 [label="gate weight" style=dotted]
	expert_agg_1_10 -> residual2_1_10
	ln2_1_10 -> residual2_1_10 [style=dotted]
	ln1_1_11 -> q_proj_1_11
	ln1_1_11 -> k_proj_1_11
	ln1_1_11 -> v_proj_1_11
	q_proj_1_11 -> ring_attn_1_11_stage0
	k_proj_1_11 -> ring_attn_1_11_stage0
	v_proj_1_11 -> ring_attn_1_11_stage0
	ring_attn_1_11_stage0 -> ring_attn_1_11_stage1
	k_proj_1_10 -> ring_attn_1_11_stage1 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_1_10 -> ring_attn_1_11_stage1 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_1_11_stage1 -> ring_attn_1_11_stage2
	k_proj_1_9 -> ring_attn_1_10_stage2 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_1_9 -> ring_attn_1_10_stage2 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_1_11_stage2 -> ring_attn_1_11_stage3
	k_proj_1_8 -> ring_attn_1_9_stage3 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_1_8 -> ring_attn_1_9_stage3 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_1_11_stage3 -> ring_attn_1_11_stage4
	k_proj_1_7 -> ring_attn_1_8_stage4 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_1_7 -> ring_attn_1_8_stage4 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_1_11_stage4 -> ring_attn_1_11_stage5
	k_proj_1_6 -> ring_attn_1_7_stage5 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_1_6 -> ring_attn_1_7_stage5 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_1_11_stage5 -> ring_attn_1_11_stage6
	k_proj_1_5 -> ring_attn_1_6_stage6 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_1_5 -> ring_attn_1_6_stage6 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_1_11_stage6 -> ring_attn_1_11_stage7
	k_proj_1_4 -> ring_attn_1_5_stage7 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_1_4 -> ring_attn_1_5_stage7 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_1_11_stage7 -> ring_attn_1_11_stage8
	k_proj_1_3 -> ring_attn_1_4_stage8 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_1_3 -> ring_attn_1_4_stage8 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_1_11_stage8 -> ring_attn_1_11_stage9
	k_proj_1_2 -> ring_attn_1_3_stage9 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_1_2 -> ring_attn_1_3_stage9 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_1_11_stage9 -> ring_attn_1_11_stage10
	k_proj_1_1 -> ring_attn_1_2_stage10 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_1_1 -> ring_attn_1_2_stage10 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_1_11_stage10 -> ring_attn_1_11_stage11
	k_proj_1_0 -> ring_attn_1_1_stage11 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_1_0 -> ring_attn_1_1_stage11 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_1_11_stage11 -> ring_attn_1_11_stage12
	k_proj_1_15 -> ring_attn_1_0_stage12 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_1_15 -> ring_attn_1_0_stage12 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_1_11_stage12 -> ring_attn_1_11_stage13
	k_proj_1_14 -> ring_attn_1_15_stage13 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_1_14 -> ring_attn_1_15_stage13 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_1_11_stage13 -> ring_attn_1_11_stage14
	k_proj_1_13 -> ring_attn_1_14_stage14 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_1_13 -> ring_attn_1_14_stage14 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_1_11_stage14 -> ring_attn_1_11_stage15
	k_proj_1_12 -> ring_attn_1_13_stage15 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_1_12 -> ring_attn_1_13_stage15 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_1_11_stage15 -> o_proj_1_11
	o_proj_1_11 -> residual1_1_11
	ln1_1_11 -> residual1_1_11 [style=dotted]
	residual1_1_11 -> ln2_1_11
	ln2_1_11 -> router_1_11
	router_1_11 -> gate_1_11
	gate_1_11 -> expert_agg_1_11
	ln2_1_11 -> expert_1_11_0
	expert_1_11_0 -> expert_agg_1_11
	gate_1_11 -> expert_1_11_0 [label="gate weight" style=dotted]
	ln2_1_11 -> expert_1_11_1
	expert_1_11_1 -> expert_agg_1_11
	gate_1_11 -> expert_1_11_1 [label="gate weight" style=dotted]
	ln2_1_11 -> expert_1_11_2
	expert_1_11_2 -> expert_agg_1_11
	gate_1_11 -> expert_1_11_2 [label="gate weight" style=dotted]
	ln2_1_11 -> expert_1_11_3
	expert_1_11_3 -> expert_agg_1_11
	gate_1_11 -> expert_1_11_3 [label="gate weight" style=dotted]
	ln2_1_11 -> expert_1_11_4
	expert_1_11_4 -> expert_agg_1_11
	gate_1_11 -> expert_1_11_4 [label="gate weight" style=dotted]
	ln2_1_11 -> expert_1_11_5
	expert_1_11_5 -> expert_agg_1_11
	gate_1_11 -> expert_1_11_5 [label="gate weight" style=dotted]
	ln2_1_11 -> expert_1_11_6
	expert_1_11_6 -> expert_agg_1_11
	gate_1_11 -> expert_1_11_6 [label="gate weight" style=dotted]
	ln2_1_11 -> expert_1_11_7
	expert_1_11_7 -> expert_agg_1_11
	gate_1_11 -> expert_1_11_7 [label="gate weight" style=dotted]
	expert_agg_1_11 -> residual2_1_11
	ln2_1_11 -> residual2_1_11 [style=dotted]
	ln1_1_12 -> q_proj_1_12
	ln1_1_12 -> k_proj_1_12
	ln1_1_12 -> v_proj_1_12
	q_proj_1_12 -> ring_attn_1_12_stage0
	k_proj_1_12 -> ring_attn_1_12_stage0
	v_proj_1_12 -> ring_attn_1_12_stage0
	ring_attn_1_12_stage0 -> ring_attn_1_12_stage1
	k_proj_1_11 -> ring_attn_1_12_stage1 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_1_11 -> ring_attn_1_12_stage1 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_1_12_stage1 -> ring_attn_1_12_stage2
	k_proj_1_10 -> ring_attn_1_11_stage2 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_1_10 -> ring_attn_1_11_stage2 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_1_12_stage2 -> ring_attn_1_12_stage3
	k_proj_1_9 -> ring_attn_1_10_stage3 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_1_9 -> ring_attn_1_10_stage3 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_1_12_stage3 -> ring_attn_1_12_stage4
	k_proj_1_8 -> ring_attn_1_9_stage4 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_1_8 -> ring_attn_1_9_stage4 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_1_12_stage4 -> ring_attn_1_12_stage5
	k_proj_1_7 -> ring_attn_1_8_stage5 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_1_7 -> ring_attn_1_8_stage5 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_1_12_stage5 -> ring_attn_1_12_stage6
	k_proj_1_6 -> ring_attn_1_7_stage6 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_1_6 -> ring_attn_1_7_stage6 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_1_12_stage6 -> ring_attn_1_12_stage7
	k_proj_1_5 -> ring_attn_1_6_stage7 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_1_5 -> ring_attn_1_6_stage7 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_1_12_stage7 -> ring_attn_1_12_stage8
	k_proj_1_4 -> ring_attn_1_5_stage8 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_1_4 -> ring_attn_1_5_stage8 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_1_12_stage8 -> ring_attn_1_12_stage9
	k_proj_1_3 -> ring_attn_1_4_stage9 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_1_3 -> ring_attn_1_4_stage9 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_1_12_stage9 -> ring_attn_1_12_stage10
	k_proj_1_2 -> ring_attn_1_3_stage10 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_1_2 -> ring_attn_1_3_stage10 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_1_12_stage10 -> ring_attn_1_12_stage11
	k_proj_1_1 -> ring_attn_1_2_stage11 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_1_1 -> ring_attn_1_2_stage11 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_1_12_stage11 -> ring_attn_1_12_stage12
	k_proj_1_0 -> ring_attn_1_1_stage12 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_1_0 -> ring_attn_1_1_stage12 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_1_12_stage12 -> ring_attn_1_12_stage13
	k_proj_1_15 -> ring_attn_1_0_stage13 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_1_15 -> ring_attn_1_0_stage13 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_1_12_stage13 -> ring_attn_1_12_stage14
	k_proj_1_14 -> ring_attn_1_15_stage14 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_1_14 -> ring_attn_1_15_stage14 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_1_12_stage14 -> ring_attn_1_12_stage15
	k_proj_1_13 -> ring_attn_1_14_stage15 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_1_13 -> ring_attn_1_14_stage15 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_1_12_stage15 -> o_proj_1_12
	o_proj_1_12 -> residual1_1_12
	ln1_1_12 -> residual1_1_12 [style=dotted]
	residual1_1_12 -> ln2_1_12
	ln2_1_12 -> router_1_12
	router_1_12 -> gate_1_12
	gate_1_12 -> expert_agg_1_12
	ln2_1_12 -> expert_1_12_0
	expert_1_12_0 -> expert_agg_1_12
	gate_1_12 -> expert_1_12_0 [label="gate weight" style=dotted]
	ln2_1_12 -> expert_1_12_1
	expert_1_12_1 -> expert_agg_1_12
	gate_1_12 -> expert_1_12_1 [label="gate weight" style=dotted]
	ln2_1_12 -> expert_1_12_2
	expert_1_12_2 -> expert_agg_1_12
	gate_1_12 -> expert_1_12_2 [label="gate weight" style=dotted]
	ln2_1_12 -> expert_1_12_3
	expert_1_12_3 -> expert_agg_1_12
	gate_1_12 -> expert_1_12_3 [label="gate weight" style=dotted]
	ln2_1_12 -> expert_1_12_4
	expert_1_12_4 -> expert_agg_1_12
	gate_1_12 -> expert_1_12_4 [label="gate weight" style=dotted]
	ln2_1_12 -> expert_1_12_5
	expert_1_12_5 -> expert_agg_1_12
	gate_1_12 -> expert_1_12_5 [label="gate weight" style=dotted]
	ln2_1_12 -> expert_1_12_6
	expert_1_12_6 -> expert_agg_1_12
	gate_1_12 -> expert_1_12_6 [label="gate weight" style=dotted]
	ln2_1_12 -> expert_1_12_7
	expert_1_12_7 -> expert_agg_1_12
	gate_1_12 -> expert_1_12_7 [label="gate weight" style=dotted]
	expert_agg_1_12 -> residual2_1_12
	ln2_1_12 -> residual2_1_12 [style=dotted]
	ln1_1_13 -> q_proj_1_13
	ln1_1_13 -> k_proj_1_13
	ln1_1_13 -> v_proj_1_13
	q_proj_1_13 -> ring_attn_1_13_stage0
	k_proj_1_13 -> ring_attn_1_13_stage0
	v_proj_1_13 -> ring_attn_1_13_stage0
	ring_attn_1_13_stage0 -> ring_attn_1_13_stage1
	k_proj_1_12 -> ring_attn_1_13_stage1 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_1_12 -> ring_attn_1_13_stage1 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_1_13_stage1 -> ring_attn_1_13_stage2
	k_proj_1_11 -> ring_attn_1_12_stage2 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_1_11 -> ring_attn_1_12_stage2 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_1_13_stage2 -> ring_attn_1_13_stage3
	k_proj_1_10 -> ring_attn_1_11_stage3 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_1_10 -> ring_attn_1_11_stage3 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_1_13_stage3 -> ring_attn_1_13_stage4
	k_proj_1_9 -> ring_attn_1_10_stage4 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_1_9 -> ring_attn_1_10_stage4 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_1_13_stage4 -> ring_attn_1_13_stage5
	k_proj_1_8 -> ring_attn_1_9_stage5 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_1_8 -> ring_attn_1_9_stage5 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_1_13_stage5 -> ring_attn_1_13_stage6
	k_proj_1_7 -> ring_attn_1_8_stage6 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_1_7 -> ring_attn_1_8_stage6 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_1_13_stage6 -> ring_attn_1_13_stage7
	k_proj_1_6 -> ring_attn_1_7_stage7 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_1_6 -> ring_attn_1_7_stage7 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_1_13_stage7 -> ring_attn_1_13_stage8
	k_proj_1_5 -> ring_attn_1_6_stage8 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_1_5 -> ring_attn_1_6_stage8 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_1_13_stage8 -> ring_attn_1_13_stage9
	k_proj_1_4 -> ring_attn_1_5_stage9 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_1_4 -> ring_attn_1_5_stage9 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_1_13_stage9 -> ring_attn_1_13_stage10
	k_proj_1_3 -> ring_attn_1_4_stage10 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_1_3 -> ring_attn_1_4_stage10 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_1_13_stage10 -> ring_attn_1_13_stage11
	k_proj_1_2 -> ring_attn_1_3_stage11 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_1_2 -> ring_attn_1_3_stage11 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_1_13_stage11 -> ring_attn_1_13_stage12
	k_proj_1_1 -> ring_attn_1_2_stage12 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_1_1 -> ring_attn_1_2_stage12 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_1_13_stage12 -> ring_attn_1_13_stage13
	k_proj_1_0 -> ring_attn_1_1_stage13 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_1_0 -> ring_attn_1_1_stage13 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_1_13_stage13 -> ring_attn_1_13_stage14
	k_proj_1_15 -> ring_attn_1_0_stage14 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_1_15 -> ring_attn_1_0_stage14 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_1_13_stage14 -> ring_attn_1_13_stage15
	k_proj_1_14 -> ring_attn_1_15_stage15 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_1_14 -> ring_attn_1_15_stage15 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_1_13_stage15 -> o_proj_1_13
	o_proj_1_13 -> residual1_1_13
	ln1_1_13 -> residual1_1_13 [style=dotted]
	residual1_1_13 -> ln2_1_13
	ln2_1_13 -> router_1_13
	router_1_13 -> gate_1_13
	gate_1_13 -> expert_agg_1_13
	ln2_1_13 -> expert_1_13_0
	expert_1_13_0 -> expert_agg_1_13
	gate_1_13 -> expert_1_13_0 [label="gate weight" style=dotted]
	ln2_1_13 -> expert_1_13_1
	expert_1_13_1 -> expert_agg_1_13
	gate_1_13 -> expert_1_13_1 [label="gate weight" style=dotted]
	ln2_1_13 -> expert_1_13_2
	expert_1_13_2 -> expert_agg_1_13
	gate_1_13 -> expert_1_13_2 [label="gate weight" style=dotted]
	ln2_1_13 -> expert_1_13_3
	expert_1_13_3 -> expert_agg_1_13
	gate_1_13 -> expert_1_13_3 [label="gate weight" style=dotted]
	ln2_1_13 -> expert_1_13_4
	expert_1_13_4 -> expert_agg_1_13
	gate_1_13 -> expert_1_13_4 [label="gate weight" style=dotted]
	ln2_1_13 -> expert_1_13_5
	expert_1_13_5 -> expert_agg_1_13
	gate_1_13 -> expert_1_13_5 [label="gate weight" style=dotted]
	ln2_1_13 -> expert_1_13_6
	expert_1_13_6 -> expert_agg_1_13
	gate_1_13 -> expert_1_13_6 [label="gate weight" style=dotted]
	ln2_1_13 -> expert_1_13_7
	expert_1_13_7 -> expert_agg_1_13
	gate_1_13 -> expert_1_13_7 [label="gate weight" style=dotted]
	expert_agg_1_13 -> residual2_1_13
	ln2_1_13 -> residual2_1_13 [style=dotted]
	ln1_1_14 -> q_proj_1_14
	ln1_1_14 -> k_proj_1_14
	ln1_1_14 -> v_proj_1_14
	q_proj_1_14 -> ring_attn_1_14_stage0
	k_proj_1_14 -> ring_attn_1_14_stage0
	v_proj_1_14 -> ring_attn_1_14_stage0
	ring_attn_1_14_stage0 -> ring_attn_1_14_stage1
	k_proj_1_13 -> ring_attn_1_14_stage1 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_1_13 -> ring_attn_1_14_stage1 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_1_14_stage1 -> ring_attn_1_14_stage2
	k_proj_1_12 -> ring_attn_1_13_stage2 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_1_12 -> ring_attn_1_13_stage2 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_1_14_stage2 -> ring_attn_1_14_stage3
	k_proj_1_11 -> ring_attn_1_12_stage3 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_1_11 -> ring_attn_1_12_stage3 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_1_14_stage3 -> ring_attn_1_14_stage4
	k_proj_1_10 -> ring_attn_1_11_stage4 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_1_10 -> ring_attn_1_11_stage4 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_1_14_stage4 -> ring_attn_1_14_stage5
	k_proj_1_9 -> ring_attn_1_10_stage5 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_1_9 -> ring_attn_1_10_stage5 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_1_14_stage5 -> ring_attn_1_14_stage6
	k_proj_1_8 -> ring_attn_1_9_stage6 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_1_8 -> ring_attn_1_9_stage6 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_1_14_stage6 -> ring_attn_1_14_stage7
	k_proj_1_7 -> ring_attn_1_8_stage7 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_1_7 -> ring_attn_1_8_stage7 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_1_14_stage7 -> ring_attn_1_14_stage8
	k_proj_1_6 -> ring_attn_1_7_stage8 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_1_6 -> ring_attn_1_7_stage8 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_1_14_stage8 -> ring_attn_1_14_stage9
	k_proj_1_5 -> ring_attn_1_6_stage9 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_1_5 -> ring_attn_1_6_stage9 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_1_14_stage9 -> ring_attn_1_14_stage10
	k_proj_1_4 -> ring_attn_1_5_stage10 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_1_4 -> ring_attn_1_5_stage10 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_1_14_stage10 -> ring_attn_1_14_stage11
	k_proj_1_3 -> ring_attn_1_4_stage11 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_1_3 -> ring_attn_1_4_stage11 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_1_14_stage11 -> ring_attn_1_14_stage12
	k_proj_1_2 -> ring_attn_1_3_stage12 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_1_2 -> ring_attn_1_3_stage12 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_1_14_stage12 -> ring_attn_1_14_stage13
	k_proj_1_1 -> ring_attn_1_2_stage13 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_1_1 -> ring_attn_1_2_stage13 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_1_14_stage13 -> ring_attn_1_14_stage14
	k_proj_1_0 -> ring_attn_1_1_stage14 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_1_0 -> ring_attn_1_1_stage14 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_1_14_stage14 -> ring_attn_1_14_stage15
	k_proj_1_15 -> ring_attn_1_0_stage15 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_1_15 -> ring_attn_1_0_stage15 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_1_14_stage15 -> o_proj_1_14
	o_proj_1_14 -> residual1_1_14
	ln1_1_14 -> residual1_1_14 [style=dotted]
	residual1_1_14 -> ln2_1_14
	ln2_1_14 -> router_1_14
	router_1_14 -> gate_1_14
	gate_1_14 -> expert_agg_1_14
	ln2_1_14 -> expert_1_14_0
	expert_1_14_0 -> expert_agg_1_14
	gate_1_14 -> expert_1_14_0 [label="gate weight" style=dotted]
	ln2_1_14 -> expert_1_14_1
	expert_1_14_1 -> expert_agg_1_14
	gate_1_14 -> expert_1_14_1 [label="gate weight" style=dotted]
	ln2_1_14 -> expert_1_14_2
	expert_1_14_2 -> expert_agg_1_14
	gate_1_14 -> expert_1_14_2 [label="gate weight" style=dotted]
	ln2_1_14 -> expert_1_14_3
	expert_1_14_3 -> expert_agg_1_14
	gate_1_14 -> expert_1_14_3 [label="gate weight" style=dotted]
	ln2_1_14 -> expert_1_14_4
	expert_1_14_4 -> expert_agg_1_14
	gate_1_14 -> expert_1_14_4 [label="gate weight" style=dotted]
	ln2_1_14 -> expert_1_14_5
	expert_1_14_5 -> expert_agg_1_14
	gate_1_14 -> expert_1_14_5 [label="gate weight" style=dotted]
	ln2_1_14 -> expert_1_14_6
	expert_1_14_6 -> expert_agg_1_14
	gate_1_14 -> expert_1_14_6 [label="gate weight" style=dotted]
	ln2_1_14 -> expert_1_14_7
	expert_1_14_7 -> expert_agg_1_14
	gate_1_14 -> expert_1_14_7 [label="gate weight" style=dotted]
	expert_agg_1_14 -> residual2_1_14
	ln2_1_14 -> residual2_1_14 [style=dotted]
	ln1_1_15 -> q_proj_1_15
	ln1_1_15 -> k_proj_1_15
	ln1_1_15 -> v_proj_1_15
	q_proj_1_15 -> ring_attn_1_15_stage0
	k_proj_1_15 -> ring_attn_1_15_stage0
	v_proj_1_15 -> ring_attn_1_15_stage0
	ring_attn_1_15_stage0 -> ring_attn_1_15_stage1
	k_proj_1_14 -> ring_attn_1_15_stage1 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_1_14 -> ring_attn_1_15_stage1 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_1_15_stage1 -> ring_attn_1_15_stage2
	k_proj_1_13 -> ring_attn_1_14_stage2 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_1_13 -> ring_attn_1_14_stage2 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_1_15_stage2 -> ring_attn_1_15_stage3
	k_proj_1_12 -> ring_attn_1_13_stage3 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_1_12 -> ring_attn_1_13_stage3 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_1_15_stage3 -> ring_attn_1_15_stage4
	k_proj_1_11 -> ring_attn_1_12_stage4 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_1_11 -> ring_attn_1_12_stage4 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_1_15_stage4 -> ring_attn_1_15_stage5
	k_proj_1_10 -> ring_attn_1_11_stage5 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_1_10 -> ring_attn_1_11_stage5 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_1_15_stage5 -> ring_attn_1_15_stage6
	k_proj_1_9 -> ring_attn_1_10_stage6 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_1_9 -> ring_attn_1_10_stage6 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_1_15_stage6 -> ring_attn_1_15_stage7
	k_proj_1_8 -> ring_attn_1_9_stage7 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_1_8 -> ring_attn_1_9_stage7 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_1_15_stage7 -> ring_attn_1_15_stage8
	k_proj_1_7 -> ring_attn_1_8_stage8 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_1_7 -> ring_attn_1_8_stage8 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_1_15_stage8 -> ring_attn_1_15_stage9
	k_proj_1_6 -> ring_attn_1_7_stage9 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_1_6 -> ring_attn_1_7_stage9 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_1_15_stage9 -> ring_attn_1_15_stage10
	k_proj_1_5 -> ring_attn_1_6_stage10 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_1_5 -> ring_attn_1_6_stage10 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_1_15_stage10 -> ring_attn_1_15_stage11
	k_proj_1_4 -> ring_attn_1_5_stage11 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_1_4 -> ring_attn_1_5_stage11 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_1_15_stage11 -> ring_attn_1_15_stage12
	k_proj_1_3 -> ring_attn_1_4_stage12 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_1_3 -> ring_attn_1_4_stage12 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_1_15_stage12 -> ring_attn_1_15_stage13
	k_proj_1_2 -> ring_attn_1_3_stage13 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_1_2 -> ring_attn_1_3_stage13 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_1_15_stage13 -> ring_attn_1_15_stage14
	k_proj_1_1 -> ring_attn_1_2_stage14 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_1_1 -> ring_attn_1_2_stage14 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_1_15_stage14 -> ring_attn_1_15_stage15
	k_proj_1_0 -> ring_attn_1_1_stage15 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_1_0 -> ring_attn_1_1_stage15 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_1_15_stage15 -> o_proj_1_15
	o_proj_1_15 -> residual1_1_15
	ln1_1_15 -> residual1_1_15 [style=dotted]
	residual1_1_15 -> ln2_1_15
	ln2_1_15 -> router_1_15
	router_1_15 -> gate_1_15
	gate_1_15 -> expert_agg_1_15
	ln2_1_15 -> expert_1_15_0
	expert_1_15_0 -> expert_agg_1_15
	gate_1_15 -> expert_1_15_0 [label="gate weight" style=dotted]
	ln2_1_15 -> expert_1_15_1
	expert_1_15_1 -> expert_agg_1_15
	gate_1_15 -> expert_1_15_1 [label="gate weight" style=dotted]
	ln2_1_15 -> expert_1_15_2
	expert_1_15_2 -> expert_agg_1_15
	gate_1_15 -> expert_1_15_2 [label="gate weight" style=dotted]
	ln2_1_15 -> expert_1_15_3
	expert_1_15_3 -> expert_agg_1_15
	gate_1_15 -> expert_1_15_3 [label="gate weight" style=dotted]
	ln2_1_15 -> expert_1_15_4
	expert_1_15_4 -> expert_agg_1_15
	gate_1_15 -> expert_1_15_4 [label="gate weight" style=dotted]
	ln2_1_15 -> expert_1_15_5
	expert_1_15_5 -> expert_agg_1_15
	gate_1_15 -> expert_1_15_5 [label="gate weight" style=dotted]
	ln2_1_15 -> expert_1_15_6
	expert_1_15_6 -> expert_agg_1_15
	gate_1_15 -> expert_1_15_6 [label="gate weight" style=dotted]
	ln2_1_15 -> expert_1_15_7
	expert_1_15_7 -> expert_agg_1_15
	gate_1_15 -> expert_1_15_7 [label="gate weight" style=dotted]
	expert_agg_1_15 -> residual2_1_15
	ln2_1_15 -> residual2_1_15 [style=dotted]
	ln1_2_0 -> q_proj_2_0
	ln1_2_0 -> k_proj_2_0
	ln1_2_0 -> v_proj_2_0
	q_proj_2_0 -> ring_attn_2_0_stage0
	k_proj_2_0 -> ring_attn_2_0_stage0
	v_proj_2_0 -> ring_attn_2_0_stage0
	ring_attn_2_0_stage0 -> ring_attn_2_0_stage1
	k_proj_2_15 -> ring_attn_2_0_stage1 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_2_15 -> ring_attn_2_0_stage1 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_2_0_stage1 -> ring_attn_2_0_stage2
	k_proj_2_14 -> ring_attn_2_15_stage2 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_2_14 -> ring_attn_2_15_stage2 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_2_0_stage2 -> ring_attn_2_0_stage3
	k_proj_2_13 -> ring_attn_2_14_stage3 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_2_13 -> ring_attn_2_14_stage3 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_2_0_stage3 -> ring_attn_2_0_stage4
	k_proj_2_12 -> ring_attn_2_13_stage4 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_2_12 -> ring_attn_2_13_stage4 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_2_0_stage4 -> ring_attn_2_0_stage5
	k_proj_2_11 -> ring_attn_2_12_stage5 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_2_11 -> ring_attn_2_12_stage5 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_2_0_stage5 -> ring_attn_2_0_stage6
	k_proj_2_10 -> ring_attn_2_11_stage6 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_2_10 -> ring_attn_2_11_stage6 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_2_0_stage6 -> ring_attn_2_0_stage7
	k_proj_2_9 -> ring_attn_2_10_stage7 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_2_9 -> ring_attn_2_10_stage7 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_2_0_stage7 -> ring_attn_2_0_stage8
	k_proj_2_8 -> ring_attn_2_9_stage8 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_2_8 -> ring_attn_2_9_stage8 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_2_0_stage8 -> ring_attn_2_0_stage9
	k_proj_2_7 -> ring_attn_2_8_stage9 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_2_7 -> ring_attn_2_8_stage9 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_2_0_stage9 -> ring_attn_2_0_stage10
	k_proj_2_6 -> ring_attn_2_7_stage10 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_2_6 -> ring_attn_2_7_stage10 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_2_0_stage10 -> ring_attn_2_0_stage11
	k_proj_2_5 -> ring_attn_2_6_stage11 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_2_5 -> ring_attn_2_6_stage11 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_2_0_stage11 -> ring_attn_2_0_stage12
	k_proj_2_4 -> ring_attn_2_5_stage12 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_2_4 -> ring_attn_2_5_stage12 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_2_0_stage12 -> ring_attn_2_0_stage13
	k_proj_2_3 -> ring_attn_2_4_stage13 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_2_3 -> ring_attn_2_4_stage13 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_2_0_stage13 -> ring_attn_2_0_stage14
	k_proj_2_2 -> ring_attn_2_3_stage14 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_2_2 -> ring_attn_2_3_stage14 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_2_0_stage14 -> ring_attn_2_0_stage15
	k_proj_2_1 -> ring_attn_2_2_stage15 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_2_1 -> ring_attn_2_2_stage15 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_2_0_stage15 -> o_proj_2_0
	o_proj_2_0 -> residual1_2_0
	ln1_2_0 -> residual1_2_0 [style=dotted]
	residual1_2_0 -> ln2_2_0
	ln2_2_0 -> router_2_0
	router_2_0 -> gate_2_0
	gate_2_0 -> expert_agg_2_0
	ln2_2_0 -> expert_2_0_0
	expert_2_0_0 -> expert_agg_2_0
	gate_2_0 -> expert_2_0_0 [label="gate weight" style=dotted]
	ln2_2_0 -> expert_2_0_1
	expert_2_0_1 -> expert_agg_2_0
	gate_2_0 -> expert_2_0_1 [label="gate weight" style=dotted]
	ln2_2_0 -> expert_2_0_2
	expert_2_0_2 -> expert_agg_2_0
	gate_2_0 -> expert_2_0_2 [label="gate weight" style=dotted]
	ln2_2_0 -> expert_2_0_3
	expert_2_0_3 -> expert_agg_2_0
	gate_2_0 -> expert_2_0_3 [label="gate weight" style=dotted]
	ln2_2_0 -> expert_2_0_4
	expert_2_0_4 -> expert_agg_2_0
	gate_2_0 -> expert_2_0_4 [label="gate weight" style=dotted]
	ln2_2_0 -> expert_2_0_5
	expert_2_0_5 -> expert_agg_2_0
	gate_2_0 -> expert_2_0_5 [label="gate weight" style=dotted]
	ln2_2_0 -> expert_2_0_6
	expert_2_0_6 -> expert_agg_2_0
	gate_2_0 -> expert_2_0_6 [label="gate weight" style=dotted]
	ln2_2_0 -> expert_2_0_7
	expert_2_0_7 -> expert_agg_2_0
	gate_2_0 -> expert_2_0_7 [label="gate weight" style=dotted]
	expert_agg_2_0 -> residual2_2_0
	ln2_2_0 -> residual2_2_0 [style=dotted]
	ln1_2_1 -> q_proj_2_1
	ln1_2_1 -> k_proj_2_1
	ln1_2_1 -> v_proj_2_1
	q_proj_2_1 -> ring_attn_2_1_stage0
	k_proj_2_1 -> ring_attn_2_1_stage0
	v_proj_2_1 -> ring_attn_2_1_stage0
	ring_attn_2_1_stage0 -> ring_attn_2_1_stage1
	k_proj_2_0 -> ring_attn_2_1_stage1 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_2_0 -> ring_attn_2_1_stage1 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_2_1_stage1 -> ring_attn_2_1_stage2
	k_proj_2_15 -> ring_attn_2_0_stage2 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_2_15 -> ring_attn_2_0_stage2 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_2_1_stage2 -> ring_attn_2_1_stage3
	k_proj_2_14 -> ring_attn_2_15_stage3 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_2_14 -> ring_attn_2_15_stage3 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_2_1_stage3 -> ring_attn_2_1_stage4
	k_proj_2_13 -> ring_attn_2_14_stage4 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_2_13 -> ring_attn_2_14_stage4 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_2_1_stage4 -> ring_attn_2_1_stage5
	k_proj_2_12 -> ring_attn_2_13_stage5 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_2_12 -> ring_attn_2_13_stage5 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_2_1_stage5 -> ring_attn_2_1_stage6
	k_proj_2_11 -> ring_attn_2_12_stage6 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_2_11 -> ring_attn_2_12_stage6 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_2_1_stage6 -> ring_attn_2_1_stage7
	k_proj_2_10 -> ring_attn_2_11_stage7 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_2_10 -> ring_attn_2_11_stage7 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_2_1_stage7 -> ring_attn_2_1_stage8
	k_proj_2_9 -> ring_attn_2_10_stage8 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_2_9 -> ring_attn_2_10_stage8 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_2_1_stage8 -> ring_attn_2_1_stage9
	k_proj_2_8 -> ring_attn_2_9_stage9 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_2_8 -> ring_attn_2_9_stage9 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_2_1_stage9 -> ring_attn_2_1_stage10
	k_proj_2_7 -> ring_attn_2_8_stage10 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_2_7 -> ring_attn_2_8_stage10 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_2_1_stage10 -> ring_attn_2_1_stage11
	k_proj_2_6 -> ring_attn_2_7_stage11 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_2_6 -> ring_attn_2_7_stage11 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_2_1_stage11 -> ring_attn_2_1_stage12
	k_proj_2_5 -> ring_attn_2_6_stage12 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_2_5 -> ring_attn_2_6_stage12 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_2_1_stage12 -> ring_attn_2_1_stage13
	k_proj_2_4 -> ring_attn_2_5_stage13 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_2_4 -> ring_attn_2_5_stage13 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_2_1_stage13 -> ring_attn_2_1_stage14
	k_proj_2_3 -> ring_attn_2_4_stage14 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_2_3 -> ring_attn_2_4_stage14 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_2_1_stage14 -> ring_attn_2_1_stage15
	k_proj_2_2 -> ring_attn_2_3_stage15 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_2_2 -> ring_attn_2_3_stage15 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_2_1_stage15 -> o_proj_2_1
	o_proj_2_1 -> residual1_2_1
	ln1_2_1 -> residual1_2_1 [style=dotted]
	residual1_2_1 -> ln2_2_1
	ln2_2_1 -> router_2_1
	router_2_1 -> gate_2_1
	gate_2_1 -> expert_agg_2_1
	ln2_2_1 -> expert_2_1_0
	expert_2_1_0 -> expert_agg_2_1
	gate_2_1 -> expert_2_1_0 [label="gate weight" style=dotted]
	ln2_2_1 -> expert_2_1_1
	expert_2_1_1 -> expert_agg_2_1
	gate_2_1 -> expert_2_1_1 [label="gate weight" style=dotted]
	ln2_2_1 -> expert_2_1_2
	expert_2_1_2 -> expert_agg_2_1
	gate_2_1 -> expert_2_1_2 [label="gate weight" style=dotted]
	ln2_2_1 -> expert_2_1_3
	expert_2_1_3 -> expert_agg_2_1
	gate_2_1 -> expert_2_1_3 [label="gate weight" style=dotted]
	ln2_2_1 -> expert_2_1_4
	expert_2_1_4 -> expert_agg_2_1
	gate_2_1 -> expert_2_1_4 [label="gate weight" style=dotted]
	ln2_2_1 -> expert_2_1_5
	expert_2_1_5 -> expert_agg_2_1
	gate_2_1 -> expert_2_1_5 [label="gate weight" style=dotted]
	ln2_2_1 -> expert_2_1_6
	expert_2_1_6 -> expert_agg_2_1
	gate_2_1 -> expert_2_1_6 [label="gate weight" style=dotted]
	ln2_2_1 -> expert_2_1_7
	expert_2_1_7 -> expert_agg_2_1
	gate_2_1 -> expert_2_1_7 [label="gate weight" style=dotted]
	expert_agg_2_1 -> residual2_2_1
	ln2_2_1 -> residual2_2_1 [style=dotted]
	ln1_2_2 -> q_proj_2_2
	ln1_2_2 -> k_proj_2_2
	ln1_2_2 -> v_proj_2_2
	q_proj_2_2 -> ring_attn_2_2_stage0
	k_proj_2_2 -> ring_attn_2_2_stage0
	v_proj_2_2 -> ring_attn_2_2_stage0
	ring_attn_2_2_stage0 -> ring_attn_2_2_stage1
	k_proj_2_1 -> ring_attn_2_2_stage1 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_2_1 -> ring_attn_2_2_stage1 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_2_2_stage1 -> ring_attn_2_2_stage2
	k_proj_2_0 -> ring_attn_2_1_stage2 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_2_0 -> ring_attn_2_1_stage2 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_2_2_stage2 -> ring_attn_2_2_stage3
	k_proj_2_15 -> ring_attn_2_0_stage3 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_2_15 -> ring_attn_2_0_stage3 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_2_2_stage3 -> ring_attn_2_2_stage4
	k_proj_2_14 -> ring_attn_2_15_stage4 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_2_14 -> ring_attn_2_15_stage4 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_2_2_stage4 -> ring_attn_2_2_stage5
	k_proj_2_13 -> ring_attn_2_14_stage5 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_2_13 -> ring_attn_2_14_stage5 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_2_2_stage5 -> ring_attn_2_2_stage6
	k_proj_2_12 -> ring_attn_2_13_stage6 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_2_12 -> ring_attn_2_13_stage6 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_2_2_stage6 -> ring_attn_2_2_stage7
	k_proj_2_11 -> ring_attn_2_12_stage7 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_2_11 -> ring_attn_2_12_stage7 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_2_2_stage7 -> ring_attn_2_2_stage8
	k_proj_2_10 -> ring_attn_2_11_stage8 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_2_10 -> ring_attn_2_11_stage8 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_2_2_stage8 -> ring_attn_2_2_stage9
	k_proj_2_9 -> ring_attn_2_10_stage9 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_2_9 -> ring_attn_2_10_stage9 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_2_2_stage9 -> ring_attn_2_2_stage10
	k_proj_2_8 -> ring_attn_2_9_stage10 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_2_8 -> ring_attn_2_9_stage10 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_2_2_stage10 -> ring_attn_2_2_stage11
	k_proj_2_7 -> ring_attn_2_8_stage11 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_2_7 -> ring_attn_2_8_stage11 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_2_2_stage11 -> ring_attn_2_2_stage12
	k_proj_2_6 -> ring_attn_2_7_stage12 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_2_6 -> ring_attn_2_7_stage12 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_2_2_stage12 -> ring_attn_2_2_stage13
	k_proj_2_5 -> ring_attn_2_6_stage13 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_2_5 -> ring_attn_2_6_stage13 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_2_2_stage13 -> ring_attn_2_2_stage14
	k_proj_2_4 -> ring_attn_2_5_stage14 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_2_4 -> ring_attn_2_5_stage14 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_2_2_stage14 -> ring_attn_2_2_stage15
	k_proj_2_3 -> ring_attn_2_4_stage15 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_2_3 -> ring_attn_2_4_stage15 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_2_2_stage15 -> o_proj_2_2
	o_proj_2_2 -> residual1_2_2
	ln1_2_2 -> residual1_2_2 [style=dotted]
	residual1_2_2 -> ln2_2_2
	ln2_2_2 -> router_2_2
	router_2_2 -> gate_2_2
	gate_2_2 -> expert_agg_2_2
	ln2_2_2 -> expert_2_2_0
	expert_2_2_0 -> expert_agg_2_2
	gate_2_2 -> expert_2_2_0 [label="gate weight" style=dotted]
	ln2_2_2 -> expert_2_2_1
	expert_2_2_1 -> expert_agg_2_2
	gate_2_2 -> expert_2_2_1 [label="gate weight" style=dotted]
	ln2_2_2 -> expert_2_2_2
	expert_2_2_2 -> expert_agg_2_2
	gate_2_2 -> expert_2_2_2 [label="gate weight" style=dotted]
	ln2_2_2 -> expert_2_2_3
	expert_2_2_3 -> expert_agg_2_2
	gate_2_2 -> expert_2_2_3 [label="gate weight" style=dotted]
	ln2_2_2 -> expert_2_2_4
	expert_2_2_4 -> expert_agg_2_2
	gate_2_2 -> expert_2_2_4 [label="gate weight" style=dotted]
	ln2_2_2 -> expert_2_2_5
	expert_2_2_5 -> expert_agg_2_2
	gate_2_2 -> expert_2_2_5 [label="gate weight" style=dotted]
	ln2_2_2 -> expert_2_2_6
	expert_2_2_6 -> expert_agg_2_2
	gate_2_2 -> expert_2_2_6 [label="gate weight" style=dotted]
	ln2_2_2 -> expert_2_2_7
	expert_2_2_7 -> expert_agg_2_2
	gate_2_2 -> expert_2_2_7 [label="gate weight" style=dotted]
	expert_agg_2_2 -> residual2_2_2
	ln2_2_2 -> residual2_2_2 [style=dotted]
	ln1_2_3 -> q_proj_2_3
	ln1_2_3 -> k_proj_2_3
	ln1_2_3 -> v_proj_2_3
	q_proj_2_3 -> ring_attn_2_3_stage0
	k_proj_2_3 -> ring_attn_2_3_stage0
	v_proj_2_3 -> ring_attn_2_3_stage0
	ring_attn_2_3_stage0 -> ring_attn_2_3_stage1
	k_proj_2_2 -> ring_attn_2_3_stage1 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_2_2 -> ring_attn_2_3_stage1 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_2_3_stage1 -> ring_attn_2_3_stage2
	k_proj_2_1 -> ring_attn_2_2_stage2 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_2_1 -> ring_attn_2_2_stage2 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_2_3_stage2 -> ring_attn_2_3_stage3
	k_proj_2_0 -> ring_attn_2_1_stage3 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_2_0 -> ring_attn_2_1_stage3 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_2_3_stage3 -> ring_attn_2_3_stage4
	k_proj_2_15 -> ring_attn_2_0_stage4 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_2_15 -> ring_attn_2_0_stage4 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_2_3_stage4 -> ring_attn_2_3_stage5
	k_proj_2_14 -> ring_attn_2_15_stage5 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_2_14 -> ring_attn_2_15_stage5 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_2_3_stage5 -> ring_attn_2_3_stage6
	k_proj_2_13 -> ring_attn_2_14_stage6 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_2_13 -> ring_attn_2_14_stage6 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_2_3_stage6 -> ring_attn_2_3_stage7
	k_proj_2_12 -> ring_attn_2_13_stage7 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_2_12 -> ring_attn_2_13_stage7 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_2_3_stage7 -> ring_attn_2_3_stage8
	k_proj_2_11 -> ring_attn_2_12_stage8 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_2_11 -> ring_attn_2_12_stage8 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_2_3_stage8 -> ring_attn_2_3_stage9
	k_proj_2_10 -> ring_attn_2_11_stage9 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_2_10 -> ring_attn_2_11_stage9 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_2_3_stage9 -> ring_attn_2_3_stage10
	k_proj_2_9 -> ring_attn_2_10_stage10 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_2_9 -> ring_attn_2_10_stage10 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_2_3_stage10 -> ring_attn_2_3_stage11
	k_proj_2_8 -> ring_attn_2_9_stage11 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_2_8 -> ring_attn_2_9_stage11 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_2_3_stage11 -> ring_attn_2_3_stage12
	k_proj_2_7 -> ring_attn_2_8_stage12 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_2_7 -> ring_attn_2_8_stage12 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_2_3_stage12 -> ring_attn_2_3_stage13
	k_proj_2_6 -> ring_attn_2_7_stage13 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_2_6 -> ring_attn_2_7_stage13 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_2_3_stage13 -> ring_attn_2_3_stage14
	k_proj_2_5 -> ring_attn_2_6_stage14 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_2_5 -> ring_attn_2_6_stage14 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_2_3_stage14 -> ring_attn_2_3_stage15
	k_proj_2_4 -> ring_attn_2_5_stage15 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_2_4 -> ring_attn_2_5_stage15 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_2_3_stage15 -> o_proj_2_3
	o_proj_2_3 -> residual1_2_3
	ln1_2_3 -> residual1_2_3 [style=dotted]
	residual1_2_3 -> ln2_2_3
	ln2_2_3 -> router_2_3
	router_2_3 -> gate_2_3
	gate_2_3 -> expert_agg_2_3
	ln2_2_3 -> expert_2_3_0
	expert_2_3_0 -> expert_agg_2_3
	gate_2_3 -> expert_2_3_0 [label="gate weight" style=dotted]
	ln2_2_3 -> expert_2_3_1
	expert_2_3_1 -> expert_agg_2_3
	gate_2_3 -> expert_2_3_1 [label="gate weight" style=dotted]
	ln2_2_3 -> expert_2_3_2
	expert_2_3_2 -> expert_agg_2_3
	gate_2_3 -> expert_2_3_2 [label="gate weight" style=dotted]
	ln2_2_3 -> expert_2_3_3
	expert_2_3_3 -> expert_agg_2_3
	gate_2_3 -> expert_2_3_3 [label="gate weight" style=dotted]
	ln2_2_3 -> expert_2_3_4
	expert_2_3_4 -> expert_agg_2_3
	gate_2_3 -> expert_2_3_4 [label="gate weight" style=dotted]
	ln2_2_3 -> expert_2_3_5
	expert_2_3_5 -> expert_agg_2_3
	gate_2_3 -> expert_2_3_5 [label="gate weight" style=dotted]
	ln2_2_3 -> expert_2_3_6
	expert_2_3_6 -> expert_agg_2_3
	gate_2_3 -> expert_2_3_6 [label="gate weight" style=dotted]
	ln2_2_3 -> expert_2_3_7
	expert_2_3_7 -> expert_agg_2_3
	gate_2_3 -> expert_2_3_7 [label="gate weight" style=dotted]
	expert_agg_2_3 -> residual2_2_3
	ln2_2_3 -> residual2_2_3 [style=dotted]
	ln1_2_4 -> q_proj_2_4
	ln1_2_4 -> k_proj_2_4
	ln1_2_4 -> v_proj_2_4
	q_proj_2_4 -> ring_attn_2_4_stage0
	k_proj_2_4 -> ring_attn_2_4_stage0
	v_proj_2_4 -> ring_attn_2_4_stage0
	ring_attn_2_4_stage0 -> ring_attn_2_4_stage1
	k_proj_2_3 -> ring_attn_2_4_stage1 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_2_3 -> ring_attn_2_4_stage1 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_2_4_stage1 -> ring_attn_2_4_stage2
	k_proj_2_2 -> ring_attn_2_3_stage2 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_2_2 -> ring_attn_2_3_stage2 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_2_4_stage2 -> ring_attn_2_4_stage3
	k_proj_2_1 -> ring_attn_2_2_stage3 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_2_1 -> ring_attn_2_2_stage3 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_2_4_stage3 -> ring_attn_2_4_stage4
	k_proj_2_0 -> ring_attn_2_1_stage4 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_2_0 -> ring_attn_2_1_stage4 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_2_4_stage4 -> ring_attn_2_4_stage5
	k_proj_2_15 -> ring_attn_2_0_stage5 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_2_15 -> ring_attn_2_0_stage5 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_2_4_stage5 -> ring_attn_2_4_stage6
	k_proj_2_14 -> ring_attn_2_15_stage6 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_2_14 -> ring_attn_2_15_stage6 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_2_4_stage6 -> ring_attn_2_4_stage7
	k_proj_2_13 -> ring_attn_2_14_stage7 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_2_13 -> ring_attn_2_14_stage7 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_2_4_stage7 -> ring_attn_2_4_stage8
	k_proj_2_12 -> ring_attn_2_13_stage8 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_2_12 -> ring_attn_2_13_stage8 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_2_4_stage8 -> ring_attn_2_4_stage9
	k_proj_2_11 -> ring_attn_2_12_stage9 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_2_11 -> ring_attn_2_12_stage9 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_2_4_stage9 -> ring_attn_2_4_stage10
	k_proj_2_10 -> ring_attn_2_11_stage10 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_2_10 -> ring_attn_2_11_stage10 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_2_4_stage10 -> ring_attn_2_4_stage11
	k_proj_2_9 -> ring_attn_2_10_stage11 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_2_9 -> ring_attn_2_10_stage11 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_2_4_stage11 -> ring_attn_2_4_stage12
	k_proj_2_8 -> ring_attn_2_9_stage12 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_2_8 -> ring_attn_2_9_stage12 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_2_4_stage12 -> ring_attn_2_4_stage13
	k_proj_2_7 -> ring_attn_2_8_stage13 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_2_7 -> ring_attn_2_8_stage13 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_2_4_stage13 -> ring_attn_2_4_stage14
	k_proj_2_6 -> ring_attn_2_7_stage14 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_2_6 -> ring_attn_2_7_stage14 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_2_4_stage14 -> ring_attn_2_4_stage15
	k_proj_2_5 -> ring_attn_2_6_stage15 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_2_5 -> ring_attn_2_6_stage15 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_2_4_stage15 -> o_proj_2_4
	o_proj_2_4 -> residual1_2_4
	ln1_2_4 -> residual1_2_4 [style=dotted]
	residual1_2_4 -> ln2_2_4
	ln2_2_4 -> router_2_4
	router_2_4 -> gate_2_4
	gate_2_4 -> expert_agg_2_4
	ln2_2_4 -> expert_2_4_0
	expert_2_4_0 -> expert_agg_2_4
	gate_2_4 -> expert_2_4_0 [label="gate weight" style=dotted]
	ln2_2_4 -> expert_2_4_1
	expert_2_4_1 -> expert_agg_2_4
	gate_2_4 -> expert_2_4_1 [label="gate weight" style=dotted]
	ln2_2_4 -> expert_2_4_2
	expert_2_4_2 -> expert_agg_2_4
	gate_2_4 -> expert_2_4_2 [label="gate weight" style=dotted]
	ln2_2_4 -> expert_2_4_3
	expert_2_4_3 -> expert_agg_2_4
	gate_2_4 -> expert_2_4_3 [label="gate weight" style=dotted]
	ln2_2_4 -> expert_2_4_4
	expert_2_4_4 -> expert_agg_2_4
	gate_2_4 -> expert_2_4_4 [label="gate weight" style=dotted]
	ln2_2_4 -> expert_2_4_5
	expert_2_4_5 -> expert_agg_2_4
	gate_2_4 -> expert_2_4_5 [label="gate weight" style=dotted]
	ln2_2_4 -> expert_2_4_6
	expert_2_4_6 -> expert_agg_2_4
	gate_2_4 -> expert_2_4_6 [label="gate weight" style=dotted]
	ln2_2_4 -> expert_2_4_7
	expert_2_4_7 -> expert_agg_2_4
	gate_2_4 -> expert_2_4_7 [label="gate weight" style=dotted]
	expert_agg_2_4 -> residual2_2_4
	ln2_2_4 -> residual2_2_4 [style=dotted]
	ln1_2_5 -> q_proj_2_5
	ln1_2_5 -> k_proj_2_5
	ln1_2_5 -> v_proj_2_5
	q_proj_2_5 -> ring_attn_2_5_stage0
	k_proj_2_5 -> ring_attn_2_5_stage0
	v_proj_2_5 -> ring_attn_2_5_stage0
	ring_attn_2_5_stage0 -> ring_attn_2_5_stage1
	k_proj_2_4 -> ring_attn_2_5_stage1 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_2_4 -> ring_attn_2_5_stage1 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_2_5_stage1 -> ring_attn_2_5_stage2
	k_proj_2_3 -> ring_attn_2_4_stage2 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_2_3 -> ring_attn_2_4_stage2 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_2_5_stage2 -> ring_attn_2_5_stage3
	k_proj_2_2 -> ring_attn_2_3_stage3 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_2_2 -> ring_attn_2_3_stage3 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_2_5_stage3 -> ring_attn_2_5_stage4
	k_proj_2_1 -> ring_attn_2_2_stage4 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_2_1 -> ring_attn_2_2_stage4 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_2_5_stage4 -> ring_attn_2_5_stage5
	k_proj_2_0 -> ring_attn_2_1_stage5 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_2_0 -> ring_attn_2_1_stage5 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_2_5_stage5 -> ring_attn_2_5_stage6
	k_proj_2_15 -> ring_attn_2_0_stage6 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_2_15 -> ring_attn_2_0_stage6 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_2_5_stage6 -> ring_attn_2_5_stage7
	k_proj_2_14 -> ring_attn_2_15_stage7 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_2_14 -> ring_attn_2_15_stage7 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_2_5_stage7 -> ring_attn_2_5_stage8
	k_proj_2_13 -> ring_attn_2_14_stage8 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_2_13 -> ring_attn_2_14_stage8 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_2_5_stage8 -> ring_attn_2_5_stage9
	k_proj_2_12 -> ring_attn_2_13_stage9 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_2_12 -> ring_attn_2_13_stage9 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_2_5_stage9 -> ring_attn_2_5_stage10
	k_proj_2_11 -> ring_attn_2_12_stage10 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_2_11 -> ring_attn_2_12_stage10 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_2_5_stage10 -> ring_attn_2_5_stage11
	k_proj_2_10 -> ring_attn_2_11_stage11 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_2_10 -> ring_attn_2_11_stage11 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_2_5_stage11 -> ring_attn_2_5_stage12
	k_proj_2_9 -> ring_attn_2_10_stage12 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_2_9 -> ring_attn_2_10_stage12 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_2_5_stage12 -> ring_attn_2_5_stage13
	k_proj_2_8 -> ring_attn_2_9_stage13 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_2_8 -> ring_attn_2_9_stage13 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_2_5_stage13 -> ring_attn_2_5_stage14
	k_proj_2_7 -> ring_attn_2_8_stage14 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_2_7 -> ring_attn_2_8_stage14 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_2_5_stage14 -> ring_attn_2_5_stage15
	k_proj_2_6 -> ring_attn_2_7_stage15 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_2_6 -> ring_attn_2_7_stage15 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_2_5_stage15 -> o_proj_2_5
	o_proj_2_5 -> residual1_2_5
	ln1_2_5 -> residual1_2_5 [style=dotted]
	residual1_2_5 -> ln2_2_5
	ln2_2_5 -> router_2_5
	router_2_5 -> gate_2_5
	gate_2_5 -> expert_agg_2_5
	ln2_2_5 -> expert_2_5_0
	expert_2_5_0 -> expert_agg_2_5
	gate_2_5 -> expert_2_5_0 [label="gate weight" style=dotted]
	ln2_2_5 -> expert_2_5_1
	expert_2_5_1 -> expert_agg_2_5
	gate_2_5 -> expert_2_5_1 [label="gate weight" style=dotted]
	ln2_2_5 -> expert_2_5_2
	expert_2_5_2 -> expert_agg_2_5
	gate_2_5 -> expert_2_5_2 [label="gate weight" style=dotted]
	ln2_2_5 -> expert_2_5_3
	expert_2_5_3 -> expert_agg_2_5
	gate_2_5 -> expert_2_5_3 [label="gate weight" style=dotted]
	ln2_2_5 -> expert_2_5_4
	expert_2_5_4 -> expert_agg_2_5
	gate_2_5 -> expert_2_5_4 [label="gate weight" style=dotted]
	ln2_2_5 -> expert_2_5_5
	expert_2_5_5 -> expert_agg_2_5
	gate_2_5 -> expert_2_5_5 [label="gate weight" style=dotted]
	ln2_2_5 -> expert_2_5_6
	expert_2_5_6 -> expert_agg_2_5
	gate_2_5 -> expert_2_5_6 [label="gate weight" style=dotted]
	ln2_2_5 -> expert_2_5_7
	expert_2_5_7 -> expert_agg_2_5
	gate_2_5 -> expert_2_5_7 [label="gate weight" style=dotted]
	expert_agg_2_5 -> residual2_2_5
	ln2_2_5 -> residual2_2_5 [style=dotted]
	ln1_2_6 -> q_proj_2_6
	ln1_2_6 -> k_proj_2_6
	ln1_2_6 -> v_proj_2_6
	q_proj_2_6 -> ring_attn_2_6_stage0
	k_proj_2_6 -> ring_attn_2_6_stage0
	v_proj_2_6 -> ring_attn_2_6_stage0
	ring_attn_2_6_stage0 -> ring_attn_2_6_stage1
	k_proj_2_5 -> ring_attn_2_6_stage1 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_2_5 -> ring_attn_2_6_stage1 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_2_6_stage1 -> ring_attn_2_6_stage2
	k_proj_2_4 -> ring_attn_2_5_stage2 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_2_4 -> ring_attn_2_5_stage2 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_2_6_stage2 -> ring_attn_2_6_stage3
	k_proj_2_3 -> ring_attn_2_4_stage3 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_2_3 -> ring_attn_2_4_stage3 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_2_6_stage3 -> ring_attn_2_6_stage4
	k_proj_2_2 -> ring_attn_2_3_stage4 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_2_2 -> ring_attn_2_3_stage4 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_2_6_stage4 -> ring_attn_2_6_stage5
	k_proj_2_1 -> ring_attn_2_2_stage5 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_2_1 -> ring_attn_2_2_stage5 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_2_6_stage5 -> ring_attn_2_6_stage6
	k_proj_2_0 -> ring_attn_2_1_stage6 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_2_0 -> ring_attn_2_1_stage6 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_2_6_stage6 -> ring_attn_2_6_stage7
	k_proj_2_15 -> ring_attn_2_0_stage7 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_2_15 -> ring_attn_2_0_stage7 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_2_6_stage7 -> ring_attn_2_6_stage8
	k_proj_2_14 -> ring_attn_2_15_stage8 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_2_14 -> ring_attn_2_15_stage8 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_2_6_stage8 -> ring_attn_2_6_stage9
	k_proj_2_13 -> ring_attn_2_14_stage9 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_2_13 -> ring_attn_2_14_stage9 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_2_6_stage9 -> ring_attn_2_6_stage10
	k_proj_2_12 -> ring_attn_2_13_stage10 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_2_12 -> ring_attn_2_13_stage10 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_2_6_stage10 -> ring_attn_2_6_stage11
	k_proj_2_11 -> ring_attn_2_12_stage11 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_2_11 -> ring_attn_2_12_stage11 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_2_6_stage11 -> ring_attn_2_6_stage12
	k_proj_2_10 -> ring_attn_2_11_stage12 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_2_10 -> ring_attn_2_11_stage12 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_2_6_stage12 -> ring_attn_2_6_stage13
	k_proj_2_9 -> ring_attn_2_10_stage13 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_2_9 -> ring_attn_2_10_stage13 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_2_6_stage13 -> ring_attn_2_6_stage14
	k_proj_2_8 -> ring_attn_2_9_stage14 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_2_8 -> ring_attn_2_9_stage14 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_2_6_stage14 -> ring_attn_2_6_stage15
	k_proj_2_7 -> ring_attn_2_8_stage15 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_2_7 -> ring_attn_2_8_stage15 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_2_6_stage15 -> o_proj_2_6
	o_proj_2_6 -> residual1_2_6
	ln1_2_6 -> residual1_2_6 [style=dotted]
	residual1_2_6 -> ln2_2_6
	ln2_2_6 -> router_2_6
	router_2_6 -> gate_2_6
	gate_2_6 -> expert_agg_2_6
	ln2_2_6 -> expert_2_6_0
	expert_2_6_0 -> expert_agg_2_6
	gate_2_6 -> expert_2_6_0 [label="gate weight" style=dotted]
	ln2_2_6 -> expert_2_6_1
	expert_2_6_1 -> expert_agg_2_6
	gate_2_6 -> expert_2_6_1 [label="gate weight" style=dotted]
	ln2_2_6 -> expert_2_6_2
	expert_2_6_2 -> expert_agg_2_6
	gate_2_6 -> expert_2_6_2 [label="gate weight" style=dotted]
	ln2_2_6 -> expert_2_6_3
	expert_2_6_3 -> expert_agg_2_6
	gate_2_6 -> expert_2_6_3 [label="gate weight" style=dotted]
	ln2_2_6 -> expert_2_6_4
	expert_2_6_4 -> expert_agg_2_6
	gate_2_6 -> expert_2_6_4 [label="gate weight" style=dotted]
	ln2_2_6 -> expert_2_6_5
	expert_2_6_5 -> expert_agg_2_6
	gate_2_6 -> expert_2_6_5 [label="gate weight" style=dotted]
	ln2_2_6 -> expert_2_6_6
	expert_2_6_6 -> expert_agg_2_6
	gate_2_6 -> expert_2_6_6 [label="gate weight" style=dotted]
	ln2_2_6 -> expert_2_6_7
	expert_2_6_7 -> expert_agg_2_6
	gate_2_6 -> expert_2_6_7 [label="gate weight" style=dotted]
	expert_agg_2_6 -> residual2_2_6
	ln2_2_6 -> residual2_2_6 [style=dotted]
	ln1_2_7 -> q_proj_2_7
	ln1_2_7 -> k_proj_2_7
	ln1_2_7 -> v_proj_2_7
	q_proj_2_7 -> ring_attn_2_7_stage0
	k_proj_2_7 -> ring_attn_2_7_stage0
	v_proj_2_7 -> ring_attn_2_7_stage0
	ring_attn_2_7_stage0 -> ring_attn_2_7_stage1
	k_proj_2_6 -> ring_attn_2_7_stage1 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_2_6 -> ring_attn_2_7_stage1 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_2_7_stage1 -> ring_attn_2_7_stage2
	k_proj_2_5 -> ring_attn_2_6_stage2 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_2_5 -> ring_attn_2_6_stage2 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_2_7_stage2 -> ring_attn_2_7_stage3
	k_proj_2_4 -> ring_attn_2_5_stage3 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_2_4 -> ring_attn_2_5_stage3 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_2_7_stage3 -> ring_attn_2_7_stage4
	k_proj_2_3 -> ring_attn_2_4_stage4 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_2_3 -> ring_attn_2_4_stage4 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_2_7_stage4 -> ring_attn_2_7_stage5
	k_proj_2_2 -> ring_attn_2_3_stage5 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_2_2 -> ring_attn_2_3_stage5 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_2_7_stage5 -> ring_attn_2_7_stage6
	k_proj_2_1 -> ring_attn_2_2_stage6 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_2_1 -> ring_attn_2_2_stage6 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_2_7_stage6 -> ring_attn_2_7_stage7
	k_proj_2_0 -> ring_attn_2_1_stage7 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_2_0 -> ring_attn_2_1_stage7 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_2_7_stage7 -> ring_attn_2_7_stage8
	k_proj_2_15 -> ring_attn_2_0_stage8 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_2_15 -> ring_attn_2_0_stage8 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_2_7_stage8 -> ring_attn_2_7_stage9
	k_proj_2_14 -> ring_attn_2_15_stage9 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_2_14 -> ring_attn_2_15_stage9 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_2_7_stage9 -> ring_attn_2_7_stage10
	k_proj_2_13 -> ring_attn_2_14_stage10 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_2_13 -> ring_attn_2_14_stage10 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_2_7_stage10 -> ring_attn_2_7_stage11
	k_proj_2_12 -> ring_attn_2_13_stage11 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_2_12 -> ring_attn_2_13_stage11 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_2_7_stage11 -> ring_attn_2_7_stage12
	k_proj_2_11 -> ring_attn_2_12_stage12 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_2_11 -> ring_attn_2_12_stage12 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_2_7_stage12 -> ring_attn_2_7_stage13
	k_proj_2_10 -> ring_attn_2_11_stage13 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_2_10 -> ring_attn_2_11_stage13 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_2_7_stage13 -> ring_attn_2_7_stage14
	k_proj_2_9 -> ring_attn_2_10_stage14 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_2_9 -> ring_attn_2_10_stage14 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_2_7_stage14 -> ring_attn_2_7_stage15
	k_proj_2_8 -> ring_attn_2_9_stage15 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_2_8 -> ring_attn_2_9_stage15 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_2_7_stage15 -> o_proj_2_7
	o_proj_2_7 -> residual1_2_7
	ln1_2_7 -> residual1_2_7 [style=dotted]
	residual1_2_7 -> ln2_2_7
	ln2_2_7 -> router_2_7
	router_2_7 -> gate_2_7
	gate_2_7 -> expert_agg_2_7
	ln2_2_7 -> expert_2_7_0
	expert_2_7_0 -> expert_agg_2_7
	gate_2_7 -> expert_2_7_0 [label="gate weight" style=dotted]
	ln2_2_7 -> expert_2_7_1
	expert_2_7_1 -> expert_agg_2_7
	gate_2_7 -> expert_2_7_1 [label="gate weight" style=dotted]
	ln2_2_7 -> expert_2_7_2
	expert_2_7_2 -> expert_agg_2_7
	gate_2_7 -> expert_2_7_2 [label="gate weight" style=dotted]
	ln2_2_7 -> expert_2_7_3
	expert_2_7_3 -> expert_agg_2_7
	gate_2_7 -> expert_2_7_3 [label="gate weight" style=dotted]
	ln2_2_7 -> expert_2_7_4
	expert_2_7_4 -> expert_agg_2_7
	gate_2_7 -> expert_2_7_4 [label="gate weight" style=dotted]
	ln2_2_7 -> expert_2_7_5
	expert_2_7_5 -> expert_agg_2_7
	gate_2_7 -> expert_2_7_5 [label="gate weight" style=dotted]
	ln2_2_7 -> expert_2_7_6
	expert_2_7_6 -> expert_agg_2_7
	gate_2_7 -> expert_2_7_6 [label="gate weight" style=dotted]
	ln2_2_7 -> expert_2_7_7
	expert_2_7_7 -> expert_agg_2_7
	gate_2_7 -> expert_2_7_7 [label="gate weight" style=dotted]
	expert_agg_2_7 -> residual2_2_7
	ln2_2_7 -> residual2_2_7 [style=dotted]
	ln1_2_8 -> q_proj_2_8
	ln1_2_8 -> k_proj_2_8
	ln1_2_8 -> v_proj_2_8
	q_proj_2_8 -> ring_attn_2_8_stage0
	k_proj_2_8 -> ring_attn_2_8_stage0
	v_proj_2_8 -> ring_attn_2_8_stage0
	ring_attn_2_8_stage0 -> ring_attn_2_8_stage1
	k_proj_2_7 -> ring_attn_2_8_stage1 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_2_7 -> ring_attn_2_8_stage1 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_2_8_stage1 -> ring_attn_2_8_stage2
	k_proj_2_6 -> ring_attn_2_7_stage2 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_2_6 -> ring_attn_2_7_stage2 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_2_8_stage2 -> ring_attn_2_8_stage3
	k_proj_2_5 -> ring_attn_2_6_stage3 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_2_5 -> ring_attn_2_6_stage3 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_2_8_stage3 -> ring_attn_2_8_stage4
	k_proj_2_4 -> ring_attn_2_5_stage4 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_2_4 -> ring_attn_2_5_stage4 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_2_8_stage4 -> ring_attn_2_8_stage5
	k_proj_2_3 -> ring_attn_2_4_stage5 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_2_3 -> ring_attn_2_4_stage5 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_2_8_stage5 -> ring_attn_2_8_stage6
	k_proj_2_2 -> ring_attn_2_3_stage6 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_2_2 -> ring_attn_2_3_stage6 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_2_8_stage6 -> ring_attn_2_8_stage7
	k_proj_2_1 -> ring_attn_2_2_stage7 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_2_1 -> ring_attn_2_2_stage7 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_2_8_stage7 -> ring_attn_2_8_stage8
	k_proj_2_0 -> ring_attn_2_1_stage8 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_2_0 -> ring_attn_2_1_stage8 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_2_8_stage8 -> ring_attn_2_8_stage9
	k_proj_2_15 -> ring_attn_2_0_stage9 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_2_15 -> ring_attn_2_0_stage9 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_2_8_stage9 -> ring_attn_2_8_stage10
	k_proj_2_14 -> ring_attn_2_15_stage10 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_2_14 -> ring_attn_2_15_stage10 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_2_8_stage10 -> ring_attn_2_8_stage11
	k_proj_2_13 -> ring_attn_2_14_stage11 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_2_13 -> ring_attn_2_14_stage11 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_2_8_stage11 -> ring_attn_2_8_stage12
	k_proj_2_12 -> ring_attn_2_13_stage12 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_2_12 -> ring_attn_2_13_stage12 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_2_8_stage12 -> ring_attn_2_8_stage13
	k_proj_2_11 -> ring_attn_2_12_stage13 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_2_11 -> ring_attn_2_12_stage13 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_2_8_stage13 -> ring_attn_2_8_stage14
	k_proj_2_10 -> ring_attn_2_11_stage14 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_2_10 -> ring_attn_2_11_stage14 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_2_8_stage14 -> ring_attn_2_8_stage15
	k_proj_2_9 -> ring_attn_2_10_stage15 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_2_9 -> ring_attn_2_10_stage15 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_2_8_stage15 -> o_proj_2_8
	o_proj_2_8 -> residual1_2_8
	ln1_2_8 -> residual1_2_8 [style=dotted]
	residual1_2_8 -> ln2_2_8
	ln2_2_8 -> router_2_8
	router_2_8 -> gate_2_8
	gate_2_8 -> expert_agg_2_8
	ln2_2_8 -> expert_2_8_0
	expert_2_8_0 -> expert_agg_2_8
	gate_2_8 -> expert_2_8_0 [label="gate weight" style=dotted]
	ln2_2_8 -> expert_2_8_1
	expert_2_8_1 -> expert_agg_2_8
	gate_2_8 -> expert_2_8_1 [label="gate weight" style=dotted]
	ln2_2_8 -> expert_2_8_2
	expert_2_8_2 -> expert_agg_2_8
	gate_2_8 -> expert_2_8_2 [label="gate weight" style=dotted]
	ln2_2_8 -> expert_2_8_3
	expert_2_8_3 -> expert_agg_2_8
	gate_2_8 -> expert_2_8_3 [label="gate weight" style=dotted]
	ln2_2_8 -> expert_2_8_4
	expert_2_8_4 -> expert_agg_2_8
	gate_2_8 -> expert_2_8_4 [label="gate weight" style=dotted]
	ln2_2_8 -> expert_2_8_5
	expert_2_8_5 -> expert_agg_2_8
	gate_2_8 -> expert_2_8_5 [label="gate weight" style=dotted]
	ln2_2_8 -> expert_2_8_6
	expert_2_8_6 -> expert_agg_2_8
	gate_2_8 -> expert_2_8_6 [label="gate weight" style=dotted]
	ln2_2_8 -> expert_2_8_7
	expert_2_8_7 -> expert_agg_2_8
	gate_2_8 -> expert_2_8_7 [label="gate weight" style=dotted]
	expert_agg_2_8 -> residual2_2_8
	ln2_2_8 -> residual2_2_8 [style=dotted]
	ln1_2_9 -> q_proj_2_9
	ln1_2_9 -> k_proj_2_9
	ln1_2_9 -> v_proj_2_9
	q_proj_2_9 -> ring_attn_2_9_stage0
	k_proj_2_9 -> ring_attn_2_9_stage0
	v_proj_2_9 -> ring_attn_2_9_stage0
	ring_attn_2_9_stage0 -> ring_attn_2_9_stage1
	k_proj_2_8 -> ring_attn_2_9_stage1 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_2_8 -> ring_attn_2_9_stage1 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_2_9_stage1 -> ring_attn_2_9_stage2
	k_proj_2_7 -> ring_attn_2_8_stage2 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_2_7 -> ring_attn_2_8_stage2 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_2_9_stage2 -> ring_attn_2_9_stage3
	k_proj_2_6 -> ring_attn_2_7_stage3 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_2_6 -> ring_attn_2_7_stage3 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_2_9_stage3 -> ring_attn_2_9_stage4
	k_proj_2_5 -> ring_attn_2_6_stage4 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_2_5 -> ring_attn_2_6_stage4 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_2_9_stage4 -> ring_attn_2_9_stage5
	k_proj_2_4 -> ring_attn_2_5_stage5 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_2_4 -> ring_attn_2_5_stage5 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_2_9_stage5 -> ring_attn_2_9_stage6
	k_proj_2_3 -> ring_attn_2_4_stage6 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_2_3 -> ring_attn_2_4_stage6 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_2_9_stage6 -> ring_attn_2_9_stage7
	k_proj_2_2 -> ring_attn_2_3_stage7 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_2_2 -> ring_attn_2_3_stage7 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_2_9_stage7 -> ring_attn_2_9_stage8
	k_proj_2_1 -> ring_attn_2_2_stage8 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_2_1 -> ring_attn_2_2_stage8 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_2_9_stage8 -> ring_attn_2_9_stage9
	k_proj_2_0 -> ring_attn_2_1_stage9 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_2_0 -> ring_attn_2_1_stage9 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_2_9_stage9 -> ring_attn_2_9_stage10
	k_proj_2_15 -> ring_attn_2_0_stage10 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_2_15 -> ring_attn_2_0_stage10 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_2_9_stage10 -> ring_attn_2_9_stage11
	k_proj_2_14 -> ring_attn_2_15_stage11 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_2_14 -> ring_attn_2_15_stage11 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_2_9_stage11 -> ring_attn_2_9_stage12
	k_proj_2_13 -> ring_attn_2_14_stage12 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_2_13 -> ring_attn_2_14_stage12 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_2_9_stage12 -> ring_attn_2_9_stage13
	k_proj_2_12 -> ring_attn_2_13_stage13 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_2_12 -> ring_attn_2_13_stage13 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_2_9_stage13 -> ring_attn_2_9_stage14
	k_proj_2_11 -> ring_attn_2_12_stage14 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_2_11 -> ring_attn_2_12_stage14 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_2_9_stage14 -> ring_attn_2_9_stage15
	k_proj_2_10 -> ring_attn_2_11_stage15 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_2_10 -> ring_attn_2_11_stage15 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_2_9_stage15 -> o_proj_2_9
	o_proj_2_9 -> residual1_2_9
	ln1_2_9 -> residual1_2_9 [style=dotted]
	residual1_2_9 -> ln2_2_9
	ln2_2_9 -> router_2_9
	router_2_9 -> gate_2_9
	gate_2_9 -> expert_agg_2_9
	ln2_2_9 -> expert_2_9_0
	expert_2_9_0 -> expert_agg_2_9
	gate_2_9 -> expert_2_9_0 [label="gate weight" style=dotted]
	ln2_2_9 -> expert_2_9_1
	expert_2_9_1 -> expert_agg_2_9
	gate_2_9 -> expert_2_9_1 [label="gate weight" style=dotted]
	ln2_2_9 -> expert_2_9_2
	expert_2_9_2 -> expert_agg_2_9
	gate_2_9 -> expert_2_9_2 [label="gate weight" style=dotted]
	ln2_2_9 -> expert_2_9_3
	expert_2_9_3 -> expert_agg_2_9
	gate_2_9 -> expert_2_9_3 [label="gate weight" style=dotted]
	ln2_2_9 -> expert_2_9_4
	expert_2_9_4 -> expert_agg_2_9
	gate_2_9 -> expert_2_9_4 [label="gate weight" style=dotted]
	ln2_2_9 -> expert_2_9_5
	expert_2_9_5 -> expert_agg_2_9
	gate_2_9 -> expert_2_9_5 [label="gate weight" style=dotted]
	ln2_2_9 -> expert_2_9_6
	expert_2_9_6 -> expert_agg_2_9
	gate_2_9 -> expert_2_9_6 [label="gate weight" style=dotted]
	ln2_2_9 -> expert_2_9_7
	expert_2_9_7 -> expert_agg_2_9
	gate_2_9 -> expert_2_9_7 [label="gate weight" style=dotted]
	expert_agg_2_9 -> residual2_2_9
	ln2_2_9 -> residual2_2_9 [style=dotted]
	ln1_2_10 -> q_proj_2_10
	ln1_2_10 -> k_proj_2_10
	ln1_2_10 -> v_proj_2_10
	q_proj_2_10 -> ring_attn_2_10_stage0
	k_proj_2_10 -> ring_attn_2_10_stage0
	v_proj_2_10 -> ring_attn_2_10_stage0
	ring_attn_2_10_stage0 -> ring_attn_2_10_stage1
	k_proj_2_9 -> ring_attn_2_10_stage1 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_2_9 -> ring_attn_2_10_stage1 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_2_10_stage1 -> ring_attn_2_10_stage2
	k_proj_2_8 -> ring_attn_2_9_stage2 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_2_8 -> ring_attn_2_9_stage2 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_2_10_stage2 -> ring_attn_2_10_stage3
	k_proj_2_7 -> ring_attn_2_8_stage3 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_2_7 -> ring_attn_2_8_stage3 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_2_10_stage3 -> ring_attn_2_10_stage4
	k_proj_2_6 -> ring_attn_2_7_stage4 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_2_6 -> ring_attn_2_7_stage4 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_2_10_stage4 -> ring_attn_2_10_stage5
	k_proj_2_5 -> ring_attn_2_6_stage5 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_2_5 -> ring_attn_2_6_stage5 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_2_10_stage5 -> ring_attn_2_10_stage6
	k_proj_2_4 -> ring_attn_2_5_stage6 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_2_4 -> ring_attn_2_5_stage6 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_2_10_stage6 -> ring_attn_2_10_stage7
	k_proj_2_3 -> ring_attn_2_4_stage7 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_2_3 -> ring_attn_2_4_stage7 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_2_10_stage7 -> ring_attn_2_10_stage8
	k_proj_2_2 -> ring_attn_2_3_stage8 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_2_2 -> ring_attn_2_3_stage8 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_2_10_stage8 -> ring_attn_2_10_stage9
	k_proj_2_1 -> ring_attn_2_2_stage9 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_2_1 -> ring_attn_2_2_stage9 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_2_10_stage9 -> ring_attn_2_10_stage10
	k_proj_2_0 -> ring_attn_2_1_stage10 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_2_0 -> ring_attn_2_1_stage10 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_2_10_stage10 -> ring_attn_2_10_stage11
	k_proj_2_15 -> ring_attn_2_0_stage11 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_2_15 -> ring_attn_2_0_stage11 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_2_10_stage11 -> ring_attn_2_10_stage12
	k_proj_2_14 -> ring_attn_2_15_stage12 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_2_14 -> ring_attn_2_15_stage12 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_2_10_stage12 -> ring_attn_2_10_stage13
	k_proj_2_13 -> ring_attn_2_14_stage13 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_2_13 -> ring_attn_2_14_stage13 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_2_10_stage13 -> ring_attn_2_10_stage14
	k_proj_2_12 -> ring_attn_2_13_stage14 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_2_12 -> ring_attn_2_13_stage14 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_2_10_stage14 -> ring_attn_2_10_stage15
	k_proj_2_11 -> ring_attn_2_12_stage15 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_2_11 -> ring_attn_2_12_stage15 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_2_10_stage15 -> o_proj_2_10
	o_proj_2_10 -> residual1_2_10
	ln1_2_10 -> residual1_2_10 [style=dotted]
	residual1_2_10 -> ln2_2_10
	ln2_2_10 -> router_2_10
	router_2_10 -> gate_2_10
	gate_2_10 -> expert_agg_2_10
	ln2_2_10 -> expert_2_10_0
	expert_2_10_0 -> expert_agg_2_10
	gate_2_10 -> expert_2_10_0 [label="gate weight" style=dotted]
	ln2_2_10 -> expert_2_10_1
	expert_2_10_1 -> expert_agg_2_10
	gate_2_10 -> expert_2_10_1 [label="gate weight" style=dotted]
	ln2_2_10 -> expert_2_10_2
	expert_2_10_2 -> expert_agg_2_10
	gate_2_10 -> expert_2_10_2 [label="gate weight" style=dotted]
	ln2_2_10 -> expert_2_10_3
	expert_2_10_3 -> expert_agg_2_10
	gate_2_10 -> expert_2_10_3 [label="gate weight" style=dotted]
	ln2_2_10 -> expert_2_10_4
	expert_2_10_4 -> expert_agg_2_10
	gate_2_10 -> expert_2_10_4 [label="gate weight" style=dotted]
	ln2_2_10 -> expert_2_10_5
	expert_2_10_5 -> expert_agg_2_10
	gate_2_10 -> expert_2_10_5 [label="gate weight" style=dotted]
	ln2_2_10 -> expert_2_10_6
	expert_2_10_6 -> expert_agg_2_10
	gate_2_10 -> expert_2_10_6 [label="gate weight" style=dotted]
	ln2_2_10 -> expert_2_10_7
	expert_2_10_7 -> expert_agg_2_10
	gate_2_10 -> expert_2_10_7 [label="gate weight" style=dotted]
	expert_agg_2_10 -> residual2_2_10
	ln2_2_10 -> residual2_2_10 [style=dotted]
	ln1_2_11 -> q_proj_2_11
	ln1_2_11 -> k_proj_2_11
	ln1_2_11 -> v_proj_2_11
	q_proj_2_11 -> ring_attn_2_11_stage0
	k_proj_2_11 -> ring_attn_2_11_stage0
	v_proj_2_11 -> ring_attn_2_11_stage0
	ring_attn_2_11_stage0 -> ring_attn_2_11_stage1
	k_proj_2_10 -> ring_attn_2_11_stage1 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_2_10 -> ring_attn_2_11_stage1 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_2_11_stage1 -> ring_attn_2_11_stage2
	k_proj_2_9 -> ring_attn_2_10_stage2 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_2_9 -> ring_attn_2_10_stage2 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_2_11_stage2 -> ring_attn_2_11_stage3
	k_proj_2_8 -> ring_attn_2_9_stage3 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_2_8 -> ring_attn_2_9_stage3 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_2_11_stage3 -> ring_attn_2_11_stage4
	k_proj_2_7 -> ring_attn_2_8_stage4 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_2_7 -> ring_attn_2_8_stage4 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_2_11_stage4 -> ring_attn_2_11_stage5
	k_proj_2_6 -> ring_attn_2_7_stage5 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_2_6 -> ring_attn_2_7_stage5 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_2_11_stage5 -> ring_attn_2_11_stage6
	k_proj_2_5 -> ring_attn_2_6_stage6 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_2_5 -> ring_attn_2_6_stage6 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_2_11_stage6 -> ring_attn_2_11_stage7
	k_proj_2_4 -> ring_attn_2_5_stage7 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_2_4 -> ring_attn_2_5_stage7 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_2_11_stage7 -> ring_attn_2_11_stage8
	k_proj_2_3 -> ring_attn_2_4_stage8 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_2_3 -> ring_attn_2_4_stage8 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_2_11_stage8 -> ring_attn_2_11_stage9
	k_proj_2_2 -> ring_attn_2_3_stage9 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_2_2 -> ring_attn_2_3_stage9 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_2_11_stage9 -> ring_attn_2_11_stage10
	k_proj_2_1 -> ring_attn_2_2_stage10 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_2_1 -> ring_attn_2_2_stage10 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_2_11_stage10 -> ring_attn_2_11_stage11
	k_proj_2_0 -> ring_attn_2_1_stage11 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_2_0 -> ring_attn_2_1_stage11 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_2_11_stage11 -> ring_attn_2_11_stage12
	k_proj_2_15 -> ring_attn_2_0_stage12 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_2_15 -> ring_attn_2_0_stage12 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_2_11_stage12 -> ring_attn_2_11_stage13
	k_proj_2_14 -> ring_attn_2_15_stage13 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_2_14 -> ring_attn_2_15_stage13 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_2_11_stage13 -> ring_attn_2_11_stage14
	k_proj_2_13 -> ring_attn_2_14_stage14 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_2_13 -> ring_attn_2_14_stage14 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_2_11_stage14 -> ring_attn_2_11_stage15
	k_proj_2_12 -> ring_attn_2_13_stage15 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_2_12 -> ring_attn_2_13_stage15 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_2_11_stage15 -> o_proj_2_11
	o_proj_2_11 -> residual1_2_11
	ln1_2_11 -> residual1_2_11 [style=dotted]
	residual1_2_11 -> ln2_2_11
	ln2_2_11 -> router_2_11
	router_2_11 -> gate_2_11
	gate_2_11 -> expert_agg_2_11
	ln2_2_11 -> expert_2_11_0
	expert_2_11_0 -> expert_agg_2_11
	gate_2_11 -> expert_2_11_0 [label="gate weight" style=dotted]
	ln2_2_11 -> expert_2_11_1
	expert_2_11_1 -> expert_agg_2_11
	gate_2_11 -> expert_2_11_1 [label="gate weight" style=dotted]
	ln2_2_11 -> expert_2_11_2
	expert_2_11_2 -> expert_agg_2_11
	gate_2_11 -> expert_2_11_2 [label="gate weight" style=dotted]
	ln2_2_11 -> expert_2_11_3
	expert_2_11_3 -> expert_agg_2_11
	gate_2_11 -> expert_2_11_3 [label="gate weight" style=dotted]
	ln2_2_11 -> expert_2_11_4
	expert_2_11_4 -> expert_agg_2_11
	gate_2_11 -> expert_2_11_4 [label="gate weight" style=dotted]
	ln2_2_11 -> expert_2_11_5
	expert_2_11_5 -> expert_agg_2_11
	gate_2_11 -> expert_2_11_5 [label="gate weight" style=dotted]
	ln2_2_11 -> expert_2_11_6
	expert_2_11_6 -> expert_agg_2_11
	gate_2_11 -> expert_2_11_6 [label="gate weight" style=dotted]
	ln2_2_11 -> expert_2_11_7
	expert_2_11_7 -> expert_agg_2_11
	gate_2_11 -> expert_2_11_7 [label="gate weight" style=dotted]
	expert_agg_2_11 -> residual2_2_11
	ln2_2_11 -> residual2_2_11 [style=dotted]
	ln1_2_12 -> q_proj_2_12
	ln1_2_12 -> k_proj_2_12
	ln1_2_12 -> v_proj_2_12
	q_proj_2_12 -> ring_attn_2_12_stage0
	k_proj_2_12 -> ring_attn_2_12_stage0
	v_proj_2_12 -> ring_attn_2_12_stage0
	ring_attn_2_12_stage0 -> ring_attn_2_12_stage1
	k_proj_2_11 -> ring_attn_2_12_stage1 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_2_11 -> ring_attn_2_12_stage1 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_2_12_stage1 -> ring_attn_2_12_stage2
	k_proj_2_10 -> ring_attn_2_11_stage2 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_2_10 -> ring_attn_2_11_stage2 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_2_12_stage2 -> ring_attn_2_12_stage3
	k_proj_2_9 -> ring_attn_2_10_stage3 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_2_9 -> ring_attn_2_10_stage3 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_2_12_stage3 -> ring_attn_2_12_stage4
	k_proj_2_8 -> ring_attn_2_9_stage4 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_2_8 -> ring_attn_2_9_stage4 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_2_12_stage4 -> ring_attn_2_12_stage5
	k_proj_2_7 -> ring_attn_2_8_stage5 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_2_7 -> ring_attn_2_8_stage5 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_2_12_stage5 -> ring_attn_2_12_stage6
	k_proj_2_6 -> ring_attn_2_7_stage6 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_2_6 -> ring_attn_2_7_stage6 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_2_12_stage6 -> ring_attn_2_12_stage7
	k_proj_2_5 -> ring_attn_2_6_stage7 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_2_5 -> ring_attn_2_6_stage7 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_2_12_stage7 -> ring_attn_2_12_stage8
	k_proj_2_4 -> ring_attn_2_5_stage8 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_2_4 -> ring_attn_2_5_stage8 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_2_12_stage8 -> ring_attn_2_12_stage9
	k_proj_2_3 -> ring_attn_2_4_stage9 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_2_3 -> ring_attn_2_4_stage9 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_2_12_stage9 -> ring_attn_2_12_stage10
	k_proj_2_2 -> ring_attn_2_3_stage10 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_2_2 -> ring_attn_2_3_stage10 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_2_12_stage10 -> ring_attn_2_12_stage11
	k_proj_2_1 -> ring_attn_2_2_stage11 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_2_1 -> ring_attn_2_2_stage11 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_2_12_stage11 -> ring_attn_2_12_stage12
	k_proj_2_0 -> ring_attn_2_1_stage12 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_2_0 -> ring_attn_2_1_stage12 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_2_12_stage12 -> ring_attn_2_12_stage13
	k_proj_2_15 -> ring_attn_2_0_stage13 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_2_15 -> ring_attn_2_0_stage13 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_2_12_stage13 -> ring_attn_2_12_stage14
	k_proj_2_14 -> ring_attn_2_15_stage14 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_2_14 -> ring_attn_2_15_stage14 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_2_12_stage14 -> ring_attn_2_12_stage15
	k_proj_2_13 -> ring_attn_2_14_stage15 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_2_13 -> ring_attn_2_14_stage15 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_2_12_stage15 -> o_proj_2_12
	o_proj_2_12 -> residual1_2_12
	ln1_2_12 -> residual1_2_12 [style=dotted]
	residual1_2_12 -> ln2_2_12
	ln2_2_12 -> router_2_12
	router_2_12 -> gate_2_12
	gate_2_12 -> expert_agg_2_12
	ln2_2_12 -> expert_2_12_0
	expert_2_12_0 -> expert_agg_2_12
	gate_2_12 -> expert_2_12_0 [label="gate weight" style=dotted]
	ln2_2_12 -> expert_2_12_1
	expert_2_12_1 -> expert_agg_2_12
	gate_2_12 -> expert_2_12_1 [label="gate weight" style=dotted]
	ln2_2_12 -> expert_2_12_2
	expert_2_12_2 -> expert_agg_2_12
	gate_2_12 -> expert_2_12_2 [label="gate weight" style=dotted]
	ln2_2_12 -> expert_2_12_3
	expert_2_12_3 -> expert_agg_2_12
	gate_2_12 -> expert_2_12_3 [label="gate weight" style=dotted]
	ln2_2_12 -> expert_2_12_4
	expert_2_12_4 -> expert_agg_2_12
	gate_2_12 -> expert_2_12_4 [label="gate weight" style=dotted]
	ln2_2_12 -> expert_2_12_5
	expert_2_12_5 -> expert_agg_2_12
	gate_2_12 -> expert_2_12_5 [label="gate weight" style=dotted]
	ln2_2_12 -> expert_2_12_6
	expert_2_12_6 -> expert_agg_2_12
	gate_2_12 -> expert_2_12_6 [label="gate weight" style=dotted]
	ln2_2_12 -> expert_2_12_7
	expert_2_12_7 -> expert_agg_2_12
	gate_2_12 -> expert_2_12_7 [label="gate weight" style=dotted]
	expert_agg_2_12 -> residual2_2_12
	ln2_2_12 -> residual2_2_12 [style=dotted]
	ln1_2_13 -> q_proj_2_13
	ln1_2_13 -> k_proj_2_13
	ln1_2_13 -> v_proj_2_13
	q_proj_2_13 -> ring_attn_2_13_stage0
	k_proj_2_13 -> ring_attn_2_13_stage0
	v_proj_2_13 -> ring_attn_2_13_stage0
	ring_attn_2_13_stage0 -> ring_attn_2_13_stage1
	k_proj_2_12 -> ring_attn_2_13_stage1 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_2_12 -> ring_attn_2_13_stage1 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_2_13_stage1 -> ring_attn_2_13_stage2
	k_proj_2_11 -> ring_attn_2_12_stage2 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_2_11 -> ring_attn_2_12_stage2 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_2_13_stage2 -> ring_attn_2_13_stage3
	k_proj_2_10 -> ring_attn_2_11_stage3 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_2_10 -> ring_attn_2_11_stage3 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_2_13_stage3 -> ring_attn_2_13_stage4
	k_proj_2_9 -> ring_attn_2_10_stage4 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_2_9 -> ring_attn_2_10_stage4 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_2_13_stage4 -> ring_attn_2_13_stage5
	k_proj_2_8 -> ring_attn_2_9_stage5 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_2_8 -> ring_attn_2_9_stage5 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_2_13_stage5 -> ring_attn_2_13_stage6
	k_proj_2_7 -> ring_attn_2_8_stage6 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_2_7 -> ring_attn_2_8_stage6 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_2_13_stage6 -> ring_attn_2_13_stage7
	k_proj_2_6 -> ring_attn_2_7_stage7 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_2_6 -> ring_attn_2_7_stage7 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_2_13_stage7 -> ring_attn_2_13_stage8
	k_proj_2_5 -> ring_attn_2_6_stage8 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_2_5 -> ring_attn_2_6_stage8 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_2_13_stage8 -> ring_attn_2_13_stage9
	k_proj_2_4 -> ring_attn_2_5_stage9 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_2_4 -> ring_attn_2_5_stage9 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_2_13_stage9 -> ring_attn_2_13_stage10
	k_proj_2_3 -> ring_attn_2_4_stage10 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_2_3 -> ring_attn_2_4_stage10 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_2_13_stage10 -> ring_attn_2_13_stage11
	k_proj_2_2 -> ring_attn_2_3_stage11 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_2_2 -> ring_attn_2_3_stage11 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_2_13_stage11 -> ring_attn_2_13_stage12
	k_proj_2_1 -> ring_attn_2_2_stage12 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_2_1 -> ring_attn_2_2_stage12 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_2_13_stage12 -> ring_attn_2_13_stage13
	k_proj_2_0 -> ring_attn_2_1_stage13 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_2_0 -> ring_attn_2_1_stage13 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_2_13_stage13 -> ring_attn_2_13_stage14
	k_proj_2_15 -> ring_attn_2_0_stage14 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_2_15 -> ring_attn_2_0_stage14 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_2_13_stage14 -> ring_attn_2_13_stage15
	k_proj_2_14 -> ring_attn_2_15_stage15 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_2_14 -> ring_attn_2_15_stage15 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_2_13_stage15 -> o_proj_2_13
	o_proj_2_13 -> residual1_2_13
	ln1_2_13 -> residual1_2_13 [style=dotted]
	residual1_2_13 -> ln2_2_13
	ln2_2_13 -> router_2_13
	router_2_13 -> gate_2_13
	gate_2_13 -> expert_agg_2_13
	ln2_2_13 -> expert_2_13_0
	expert_2_13_0 -> expert_agg_2_13
	gate_2_13 -> expert_2_13_0 [label="gate weight" style=dotted]
	ln2_2_13 -> expert_2_13_1
	expert_2_13_1 -> expert_agg_2_13
	gate_2_13 -> expert_2_13_1 [label="gate weight" style=dotted]
	ln2_2_13 -> expert_2_13_2
	expert_2_13_2 -> expert_agg_2_13
	gate_2_13 -> expert_2_13_2 [label="gate weight" style=dotted]
	ln2_2_13 -> expert_2_13_3
	expert_2_13_3 -> expert_agg_2_13
	gate_2_13 -> expert_2_13_3 [label="gate weight" style=dotted]
	ln2_2_13 -> expert_2_13_4
	expert_2_13_4 -> expert_agg_2_13
	gate_2_13 -> expert_2_13_4 [label="gate weight" style=dotted]
	ln2_2_13 -> expert_2_13_5
	expert_2_13_5 -> expert_agg_2_13
	gate_2_13 -> expert_2_13_5 [label="gate weight" style=dotted]
	ln2_2_13 -> expert_2_13_6
	expert_2_13_6 -> expert_agg_2_13
	gate_2_13 -> expert_2_13_6 [label="gate weight" style=dotted]
	ln2_2_13 -> expert_2_13_7
	expert_2_13_7 -> expert_agg_2_13
	gate_2_13 -> expert_2_13_7 [label="gate weight" style=dotted]
	expert_agg_2_13 -> residual2_2_13
	ln2_2_13 -> residual2_2_13 [style=dotted]
	ln1_2_14 -> q_proj_2_14
	ln1_2_14 -> k_proj_2_14
	ln1_2_14 -> v_proj_2_14
	q_proj_2_14 -> ring_attn_2_14_stage0
	k_proj_2_14 -> ring_attn_2_14_stage0
	v_proj_2_14 -> ring_attn_2_14_stage0
	ring_attn_2_14_stage0 -> ring_attn_2_14_stage1
	k_proj_2_13 -> ring_attn_2_14_stage1 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_2_13 -> ring_attn_2_14_stage1 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_2_14_stage1 -> ring_attn_2_14_stage2
	k_proj_2_12 -> ring_attn_2_13_stage2 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_2_12 -> ring_attn_2_13_stage2 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_2_14_stage2 -> ring_attn_2_14_stage3
	k_proj_2_11 -> ring_attn_2_12_stage3 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_2_11 -> ring_attn_2_12_stage3 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_2_14_stage3 -> ring_attn_2_14_stage4
	k_proj_2_10 -> ring_attn_2_11_stage4 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_2_10 -> ring_attn_2_11_stage4 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_2_14_stage4 -> ring_attn_2_14_stage5
	k_proj_2_9 -> ring_attn_2_10_stage5 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_2_9 -> ring_attn_2_10_stage5 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_2_14_stage5 -> ring_attn_2_14_stage6
	k_proj_2_8 -> ring_attn_2_9_stage6 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_2_8 -> ring_attn_2_9_stage6 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_2_14_stage6 -> ring_attn_2_14_stage7
	k_proj_2_7 -> ring_attn_2_8_stage7 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_2_7 -> ring_attn_2_8_stage7 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_2_14_stage7 -> ring_attn_2_14_stage8
	k_proj_2_6 -> ring_attn_2_7_stage8 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_2_6 -> ring_attn_2_7_stage8 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_2_14_stage8 -> ring_attn_2_14_stage9
	k_proj_2_5 -> ring_attn_2_6_stage9 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_2_5 -> ring_attn_2_6_stage9 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_2_14_stage9 -> ring_attn_2_14_stage10
	k_proj_2_4 -> ring_attn_2_5_stage10 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_2_4 -> ring_attn_2_5_stage10 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_2_14_stage10 -> ring_attn_2_14_stage11
	k_proj_2_3 -> ring_attn_2_4_stage11 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_2_3 -> ring_attn_2_4_stage11 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_2_14_stage11 -> ring_attn_2_14_stage12
	k_proj_2_2 -> ring_attn_2_3_stage12 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_2_2 -> ring_attn_2_3_stage12 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_2_14_stage12 -> ring_attn_2_14_stage13
	k_proj_2_1 -> ring_attn_2_2_stage13 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_2_1 -> ring_attn_2_2_stage13 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_2_14_stage13 -> ring_attn_2_14_stage14
	k_proj_2_0 -> ring_attn_2_1_stage14 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_2_0 -> ring_attn_2_1_stage14 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_2_14_stage14 -> ring_attn_2_14_stage15
	k_proj_2_15 -> ring_attn_2_0_stage15 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_2_15 -> ring_attn_2_0_stage15 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_2_14_stage15 -> o_proj_2_14
	o_proj_2_14 -> residual1_2_14
	ln1_2_14 -> residual1_2_14 [style=dotted]
	residual1_2_14 -> ln2_2_14
	ln2_2_14 -> router_2_14
	router_2_14 -> gate_2_14
	gate_2_14 -> expert_agg_2_14
	ln2_2_14 -> expert_2_14_0
	expert_2_14_0 -> expert_agg_2_14
	gate_2_14 -> expert_2_14_0 [label="gate weight" style=dotted]
	ln2_2_14 -> expert_2_14_1
	expert_2_14_1 -> expert_agg_2_14
	gate_2_14 -> expert_2_14_1 [label="gate weight" style=dotted]
	ln2_2_14 -> expert_2_14_2
	expert_2_14_2 -> expert_agg_2_14
	gate_2_14 -> expert_2_14_2 [label="gate weight" style=dotted]
	ln2_2_14 -> expert_2_14_3
	expert_2_14_3 -> expert_agg_2_14
	gate_2_14 -> expert_2_14_3 [label="gate weight" style=dotted]
	ln2_2_14 -> expert_2_14_4
	expert_2_14_4 -> expert_agg_2_14
	gate_2_14 -> expert_2_14_4 [label="gate weight" style=dotted]
	ln2_2_14 -> expert_2_14_5
	expert_2_14_5 -> expert_agg_2_14
	gate_2_14 -> expert_2_14_5 [label="gate weight" style=dotted]
	ln2_2_14 -> expert_2_14_6
	expert_2_14_6 -> expert_agg_2_14
	gate_2_14 -> expert_2_14_6 [label="gate weight" style=dotted]
	ln2_2_14 -> expert_2_14_7
	expert_2_14_7 -> expert_agg_2_14
	gate_2_14 -> expert_2_14_7 [label="gate weight" style=dotted]
	expert_agg_2_14 -> residual2_2_14
	ln2_2_14 -> residual2_2_14 [style=dotted]
	ln1_2_15 -> q_proj_2_15
	ln1_2_15 -> k_proj_2_15
	ln1_2_15 -> v_proj_2_15
	q_proj_2_15 -> ring_attn_2_15_stage0
	k_proj_2_15 -> ring_attn_2_15_stage0
	v_proj_2_15 -> ring_attn_2_15_stage0
	ring_attn_2_15_stage0 -> ring_attn_2_15_stage1
	k_proj_2_14 -> ring_attn_2_15_stage1 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_2_14 -> ring_attn_2_15_stage1 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_2_15_stage1 -> ring_attn_2_15_stage2
	k_proj_2_13 -> ring_attn_2_14_stage2 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_2_13 -> ring_attn_2_14_stage2 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_2_15_stage2 -> ring_attn_2_15_stage3
	k_proj_2_12 -> ring_attn_2_13_stage3 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_2_12 -> ring_attn_2_13_stage3 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_2_15_stage3 -> ring_attn_2_15_stage4
	k_proj_2_11 -> ring_attn_2_12_stage4 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_2_11 -> ring_attn_2_12_stage4 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_2_15_stage4 -> ring_attn_2_15_stage5
	k_proj_2_10 -> ring_attn_2_11_stage5 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_2_10 -> ring_attn_2_11_stage5 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_2_15_stage5 -> ring_attn_2_15_stage6
	k_proj_2_9 -> ring_attn_2_10_stage6 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_2_9 -> ring_attn_2_10_stage6 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_2_15_stage6 -> ring_attn_2_15_stage7
	k_proj_2_8 -> ring_attn_2_9_stage7 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_2_8 -> ring_attn_2_9_stage7 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_2_15_stage7 -> ring_attn_2_15_stage8
	k_proj_2_7 -> ring_attn_2_8_stage8 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_2_7 -> ring_attn_2_8_stage8 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_2_15_stage8 -> ring_attn_2_15_stage9
	k_proj_2_6 -> ring_attn_2_7_stage9 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_2_6 -> ring_attn_2_7_stage9 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_2_15_stage9 -> ring_attn_2_15_stage10
	k_proj_2_5 -> ring_attn_2_6_stage10 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_2_5 -> ring_attn_2_6_stage10 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_2_15_stage10 -> ring_attn_2_15_stage11
	k_proj_2_4 -> ring_attn_2_5_stage11 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_2_4 -> ring_attn_2_5_stage11 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_2_15_stage11 -> ring_attn_2_15_stage12
	k_proj_2_3 -> ring_attn_2_4_stage12 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_2_3 -> ring_attn_2_4_stage12 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_2_15_stage12 -> ring_attn_2_15_stage13
	k_proj_2_2 -> ring_attn_2_3_stage13 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_2_2 -> ring_attn_2_3_stage13 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_2_15_stage13 -> ring_attn_2_15_stage14
	k_proj_2_1 -> ring_attn_2_2_stage14 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_2_1 -> ring_attn_2_2_stage14 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_2_15_stage14 -> ring_attn_2_15_stage15
	k_proj_2_0 -> ring_attn_2_1_stage15 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_2_0 -> ring_attn_2_1_stage15 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_2_15_stage15 -> o_proj_2_15
	o_proj_2_15 -> residual1_2_15
	ln1_2_15 -> residual1_2_15 [style=dotted]
	residual1_2_15 -> ln2_2_15
	ln2_2_15 -> router_2_15
	router_2_15 -> gate_2_15
	gate_2_15 -> expert_agg_2_15
	ln2_2_15 -> expert_2_15_0
	expert_2_15_0 -> expert_agg_2_15
	gate_2_15 -> expert_2_15_0 [label="gate weight" style=dotted]
	ln2_2_15 -> expert_2_15_1
	expert_2_15_1 -> expert_agg_2_15
	gate_2_15 -> expert_2_15_1 [label="gate weight" style=dotted]
	ln2_2_15 -> expert_2_15_2
	expert_2_15_2 -> expert_agg_2_15
	gate_2_15 -> expert_2_15_2 [label="gate weight" style=dotted]
	ln2_2_15 -> expert_2_15_3
	expert_2_15_3 -> expert_agg_2_15
	gate_2_15 -> expert_2_15_3 [label="gate weight" style=dotted]
	ln2_2_15 -> expert_2_15_4
	expert_2_15_4 -> expert_agg_2_15
	gate_2_15 -> expert_2_15_4 [label="gate weight" style=dotted]
	ln2_2_15 -> expert_2_15_5
	expert_2_15_5 -> expert_agg_2_15
	gate_2_15 -> expert_2_15_5 [label="gate weight" style=dotted]
	ln2_2_15 -> expert_2_15_6
	expert_2_15_6 -> expert_agg_2_15
	gate_2_15 -> expert_2_15_6 [label="gate weight" style=dotted]
	ln2_2_15 -> expert_2_15_7
	expert_2_15_7 -> expert_agg_2_15
	gate_2_15 -> expert_2_15_7 [label="gate weight" style=dotted]
	expert_agg_2_15 -> residual2_2_15
	ln2_2_15 -> residual2_2_15 [style=dotted]
	ln1_3_0 -> q_proj_3_0
	ln1_3_0 -> k_proj_3_0
	ln1_3_0 -> v_proj_3_0
	q_proj_3_0 -> ring_attn_3_0_stage0
	k_proj_3_0 -> ring_attn_3_0_stage0
	v_proj_3_0 -> ring_attn_3_0_stage0
	ring_attn_3_0_stage0 -> ring_attn_3_0_stage1
	k_proj_3_15 -> ring_attn_3_0_stage1 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_3_15 -> ring_attn_3_0_stage1 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_3_0_stage1 -> ring_attn_3_0_stage2
	k_proj_3_14 -> ring_attn_3_15_stage2 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_3_14 -> ring_attn_3_15_stage2 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_3_0_stage2 -> ring_attn_3_0_stage3
	k_proj_3_13 -> ring_attn_3_14_stage3 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_3_13 -> ring_attn_3_14_stage3 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_3_0_stage3 -> ring_attn_3_0_stage4
	k_proj_3_12 -> ring_attn_3_13_stage4 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_3_12 -> ring_attn_3_13_stage4 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_3_0_stage4 -> ring_attn_3_0_stage5
	k_proj_3_11 -> ring_attn_3_12_stage5 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_3_11 -> ring_attn_3_12_stage5 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_3_0_stage5 -> ring_attn_3_0_stage6
	k_proj_3_10 -> ring_attn_3_11_stage6 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_3_10 -> ring_attn_3_11_stage6 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_3_0_stage6 -> ring_attn_3_0_stage7
	k_proj_3_9 -> ring_attn_3_10_stage7 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_3_9 -> ring_attn_3_10_stage7 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_3_0_stage7 -> ring_attn_3_0_stage8
	k_proj_3_8 -> ring_attn_3_9_stage8 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_3_8 -> ring_attn_3_9_stage8 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_3_0_stage8 -> ring_attn_3_0_stage9
	k_proj_3_7 -> ring_attn_3_8_stage9 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_3_7 -> ring_attn_3_8_stage9 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_3_0_stage9 -> ring_attn_3_0_stage10
	k_proj_3_6 -> ring_attn_3_7_stage10 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_3_6 -> ring_attn_3_7_stage10 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_3_0_stage10 -> ring_attn_3_0_stage11
	k_proj_3_5 -> ring_attn_3_6_stage11 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_3_5 -> ring_attn_3_6_stage11 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_3_0_stage11 -> ring_attn_3_0_stage12
	k_proj_3_4 -> ring_attn_3_5_stage12 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_3_4 -> ring_attn_3_5_stage12 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_3_0_stage12 -> ring_attn_3_0_stage13
	k_proj_3_3 -> ring_attn_3_4_stage13 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_3_3 -> ring_attn_3_4_stage13 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_3_0_stage13 -> ring_attn_3_0_stage14
	k_proj_3_2 -> ring_attn_3_3_stage14 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_3_2 -> ring_attn_3_3_stage14 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_3_0_stage14 -> ring_attn_3_0_stage15
	k_proj_3_1 -> ring_attn_3_2_stage15 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_3_1 -> ring_attn_3_2_stage15 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_3_0_stage15 -> o_proj_3_0
	o_proj_3_0 -> residual1_3_0
	ln1_3_0 -> residual1_3_0 [style=dotted]
	residual1_3_0 -> ln2_3_0
	ln2_3_0 -> router_3_0
	router_3_0 -> gate_3_0
	gate_3_0 -> expert_agg_3_0
	ln2_3_0 -> expert_3_0_0
	expert_3_0_0 -> expert_agg_3_0
	gate_3_0 -> expert_3_0_0 [label="gate weight" style=dotted]
	ln2_3_0 -> expert_3_0_1
	expert_3_0_1 -> expert_agg_3_0
	gate_3_0 -> expert_3_0_1 [label="gate weight" style=dotted]
	ln2_3_0 -> expert_3_0_2
	expert_3_0_2 -> expert_agg_3_0
	gate_3_0 -> expert_3_0_2 [label="gate weight" style=dotted]
	ln2_3_0 -> expert_3_0_3
	expert_3_0_3 -> expert_agg_3_0
	gate_3_0 -> expert_3_0_3 [label="gate weight" style=dotted]
	ln2_3_0 -> expert_3_0_4
	expert_3_0_4 -> expert_agg_3_0
	gate_3_0 -> expert_3_0_4 [label="gate weight" style=dotted]
	ln2_3_0 -> expert_3_0_5
	expert_3_0_5 -> expert_agg_3_0
	gate_3_0 -> expert_3_0_5 [label="gate weight" style=dotted]
	ln2_3_0 -> expert_3_0_6
	expert_3_0_6 -> expert_agg_3_0
	gate_3_0 -> expert_3_0_6 [label="gate weight" style=dotted]
	ln2_3_0 -> expert_3_0_7
	expert_3_0_7 -> expert_agg_3_0
	gate_3_0 -> expert_3_0_7 [label="gate weight" style=dotted]
	expert_agg_3_0 -> residual2_3_0
	ln2_3_0 -> residual2_3_0 [style=dotted]
	ln1_3_1 -> q_proj_3_1
	ln1_3_1 -> k_proj_3_1
	ln1_3_1 -> v_proj_3_1
	q_proj_3_1 -> ring_attn_3_1_stage0
	k_proj_3_1 -> ring_attn_3_1_stage0
	v_proj_3_1 -> ring_attn_3_1_stage0
	ring_attn_3_1_stage0 -> ring_attn_3_1_stage1
	k_proj_3_0 -> ring_attn_3_1_stage1 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_3_0 -> ring_attn_3_1_stage1 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_3_1_stage1 -> ring_attn_3_1_stage2
	k_proj_3_15 -> ring_attn_3_0_stage2 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_3_15 -> ring_attn_3_0_stage2 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_3_1_stage2 -> ring_attn_3_1_stage3
	k_proj_3_14 -> ring_attn_3_15_stage3 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_3_14 -> ring_attn_3_15_stage3 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_3_1_stage3 -> ring_attn_3_1_stage4
	k_proj_3_13 -> ring_attn_3_14_stage4 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_3_13 -> ring_attn_3_14_stage4 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_3_1_stage4 -> ring_attn_3_1_stage5
	k_proj_3_12 -> ring_attn_3_13_stage5 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_3_12 -> ring_attn_3_13_stage5 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_3_1_stage5 -> ring_attn_3_1_stage6
	k_proj_3_11 -> ring_attn_3_12_stage6 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_3_11 -> ring_attn_3_12_stage6 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_3_1_stage6 -> ring_attn_3_1_stage7
	k_proj_3_10 -> ring_attn_3_11_stage7 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_3_10 -> ring_attn_3_11_stage7 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_3_1_stage7 -> ring_attn_3_1_stage8
	k_proj_3_9 -> ring_attn_3_10_stage8 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_3_9 -> ring_attn_3_10_stage8 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_3_1_stage8 -> ring_attn_3_1_stage9
	k_proj_3_8 -> ring_attn_3_9_stage9 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_3_8 -> ring_attn_3_9_stage9 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_3_1_stage9 -> ring_attn_3_1_stage10
	k_proj_3_7 -> ring_attn_3_8_stage10 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_3_7 -> ring_attn_3_8_stage10 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_3_1_stage10 -> ring_attn_3_1_stage11
	k_proj_3_6 -> ring_attn_3_7_stage11 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_3_6 -> ring_attn_3_7_stage11 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_3_1_stage11 -> ring_attn_3_1_stage12
	k_proj_3_5 -> ring_attn_3_6_stage12 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_3_5 -> ring_attn_3_6_stage12 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_3_1_stage12 -> ring_attn_3_1_stage13
	k_proj_3_4 -> ring_attn_3_5_stage13 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_3_4 -> ring_attn_3_5_stage13 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_3_1_stage13 -> ring_attn_3_1_stage14
	k_proj_3_3 -> ring_attn_3_4_stage14 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_3_3 -> ring_attn_3_4_stage14 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_3_1_stage14 -> ring_attn_3_1_stage15
	k_proj_3_2 -> ring_attn_3_3_stage15 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_3_2 -> ring_attn_3_3_stage15 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_3_1_stage15 -> o_proj_3_1
	o_proj_3_1 -> residual1_3_1
	ln1_3_1 -> residual1_3_1 [style=dotted]
	residual1_3_1 -> ln2_3_1
	ln2_3_1 -> router_3_1
	router_3_1 -> gate_3_1
	gate_3_1 -> expert_agg_3_1
	ln2_3_1 -> expert_3_1_0
	expert_3_1_0 -> expert_agg_3_1
	gate_3_1 -> expert_3_1_0 [label="gate weight" style=dotted]
	ln2_3_1 -> expert_3_1_1
	expert_3_1_1 -> expert_agg_3_1
	gate_3_1 -> expert_3_1_1 [label="gate weight" style=dotted]
	ln2_3_1 -> expert_3_1_2
	expert_3_1_2 -> expert_agg_3_1
	gate_3_1 -> expert_3_1_2 [label="gate weight" style=dotted]
	ln2_3_1 -> expert_3_1_3
	expert_3_1_3 -> expert_agg_3_1
	gate_3_1 -> expert_3_1_3 [label="gate weight" style=dotted]
	ln2_3_1 -> expert_3_1_4
	expert_3_1_4 -> expert_agg_3_1
	gate_3_1 -> expert_3_1_4 [label="gate weight" style=dotted]
	ln2_3_1 -> expert_3_1_5
	expert_3_1_5 -> expert_agg_3_1
	gate_3_1 -> expert_3_1_5 [label="gate weight" style=dotted]
	ln2_3_1 -> expert_3_1_6
	expert_3_1_6 -> expert_agg_3_1
	gate_3_1 -> expert_3_1_6 [label="gate weight" style=dotted]
	ln2_3_1 -> expert_3_1_7
	expert_3_1_7 -> expert_agg_3_1
	gate_3_1 -> expert_3_1_7 [label="gate weight" style=dotted]
	expert_agg_3_1 -> residual2_3_1
	ln2_3_1 -> residual2_3_1 [style=dotted]
	ln1_3_2 -> q_proj_3_2
	ln1_3_2 -> k_proj_3_2
	ln1_3_2 -> v_proj_3_2
	q_proj_3_2 -> ring_attn_3_2_stage0
	k_proj_3_2 -> ring_attn_3_2_stage0
	v_proj_3_2 -> ring_attn_3_2_stage0
	ring_attn_3_2_stage0 -> ring_attn_3_2_stage1
	k_proj_3_1 -> ring_attn_3_2_stage1 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_3_1 -> ring_attn_3_2_stage1 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_3_2_stage1 -> ring_attn_3_2_stage2
	k_proj_3_0 -> ring_attn_3_1_stage2 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_3_0 -> ring_attn_3_1_stage2 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_3_2_stage2 -> ring_attn_3_2_stage3
	k_proj_3_15 -> ring_attn_3_0_stage3 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_3_15 -> ring_attn_3_0_stage3 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_3_2_stage3 -> ring_attn_3_2_stage4
	k_proj_3_14 -> ring_attn_3_15_stage4 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_3_14 -> ring_attn_3_15_stage4 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_3_2_stage4 -> ring_attn_3_2_stage5
	k_proj_3_13 -> ring_attn_3_14_stage5 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_3_13 -> ring_attn_3_14_stage5 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_3_2_stage5 -> ring_attn_3_2_stage6
	k_proj_3_12 -> ring_attn_3_13_stage6 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_3_12 -> ring_attn_3_13_stage6 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_3_2_stage6 -> ring_attn_3_2_stage7
	k_proj_3_11 -> ring_attn_3_12_stage7 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_3_11 -> ring_attn_3_12_stage7 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_3_2_stage7 -> ring_attn_3_2_stage8
	k_proj_3_10 -> ring_attn_3_11_stage8 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_3_10 -> ring_attn_3_11_stage8 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_3_2_stage8 -> ring_attn_3_2_stage9
	k_proj_3_9 -> ring_attn_3_10_stage9 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_3_9 -> ring_attn_3_10_stage9 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_3_2_stage9 -> ring_attn_3_2_stage10
	k_proj_3_8 -> ring_attn_3_9_stage10 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_3_8 -> ring_attn_3_9_stage10 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_3_2_stage10 -> ring_attn_3_2_stage11
	k_proj_3_7 -> ring_attn_3_8_stage11 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_3_7 -> ring_attn_3_8_stage11 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_3_2_stage11 -> ring_attn_3_2_stage12
	k_proj_3_6 -> ring_attn_3_7_stage12 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_3_6 -> ring_attn_3_7_stage12 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_3_2_stage12 -> ring_attn_3_2_stage13
	k_proj_3_5 -> ring_attn_3_6_stage13 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_3_5 -> ring_attn_3_6_stage13 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_3_2_stage13 -> ring_attn_3_2_stage14
	k_proj_3_4 -> ring_attn_3_5_stage14 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_3_4 -> ring_attn_3_5_stage14 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_3_2_stage14 -> ring_attn_3_2_stage15
	k_proj_3_3 -> ring_attn_3_4_stage15 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_3_3 -> ring_attn_3_4_stage15 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_3_2_stage15 -> o_proj_3_2
	o_proj_3_2 -> residual1_3_2
	ln1_3_2 -> residual1_3_2 [style=dotted]
	residual1_3_2 -> ln2_3_2
	ln2_3_2 -> router_3_2
	router_3_2 -> gate_3_2
	gate_3_2 -> expert_agg_3_2
	ln2_3_2 -> expert_3_2_0
	expert_3_2_0 -> expert_agg_3_2
	gate_3_2 -> expert_3_2_0 [label="gate weight" style=dotted]
	ln2_3_2 -> expert_3_2_1
	expert_3_2_1 -> expert_agg_3_2
	gate_3_2 -> expert_3_2_1 [label="gate weight" style=dotted]
	ln2_3_2 -> expert_3_2_2
	expert_3_2_2 -> expert_agg_3_2
	gate_3_2 -> expert_3_2_2 [label="gate weight" style=dotted]
	ln2_3_2 -> expert_3_2_3
	expert_3_2_3 -> expert_agg_3_2
	gate_3_2 -> expert_3_2_3 [label="gate weight" style=dotted]
	ln2_3_2 -> expert_3_2_4
	expert_3_2_4 -> expert_agg_3_2
	gate_3_2 -> expert_3_2_4 [label="gate weight" style=dotted]
	ln2_3_2 -> expert_3_2_5
	expert_3_2_5 -> expert_agg_3_2
	gate_3_2 -> expert_3_2_5 [label="gate weight" style=dotted]
	ln2_3_2 -> expert_3_2_6
	expert_3_2_6 -> expert_agg_3_2
	gate_3_2 -> expert_3_2_6 [label="gate weight" style=dotted]
	ln2_3_2 -> expert_3_2_7
	expert_3_2_7 -> expert_agg_3_2
	gate_3_2 -> expert_3_2_7 [label="gate weight" style=dotted]
	expert_agg_3_2 -> residual2_3_2
	ln2_3_2 -> residual2_3_2 [style=dotted]
	ln1_3_3 -> q_proj_3_3
	ln1_3_3 -> k_proj_3_3
	ln1_3_3 -> v_proj_3_3
	q_proj_3_3 -> ring_attn_3_3_stage0
	k_proj_3_3 -> ring_attn_3_3_stage0
	v_proj_3_3 -> ring_attn_3_3_stage0
	ring_attn_3_3_stage0 -> ring_attn_3_3_stage1
	k_proj_3_2 -> ring_attn_3_3_stage1 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_3_2 -> ring_attn_3_3_stage1 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_3_3_stage1 -> ring_attn_3_3_stage2
	k_proj_3_1 -> ring_attn_3_2_stage2 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_3_1 -> ring_attn_3_2_stage2 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_3_3_stage2 -> ring_attn_3_3_stage3
	k_proj_3_0 -> ring_attn_3_1_stage3 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_3_0 -> ring_attn_3_1_stage3 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_3_3_stage3 -> ring_attn_3_3_stage4
	k_proj_3_15 -> ring_attn_3_0_stage4 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_3_15 -> ring_attn_3_0_stage4 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_3_3_stage4 -> ring_attn_3_3_stage5
	k_proj_3_14 -> ring_attn_3_15_stage5 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_3_14 -> ring_attn_3_15_stage5 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_3_3_stage5 -> ring_attn_3_3_stage6
	k_proj_3_13 -> ring_attn_3_14_stage6 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_3_13 -> ring_attn_3_14_stage6 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_3_3_stage6 -> ring_attn_3_3_stage7
	k_proj_3_12 -> ring_attn_3_13_stage7 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_3_12 -> ring_attn_3_13_stage7 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_3_3_stage7 -> ring_attn_3_3_stage8
	k_proj_3_11 -> ring_attn_3_12_stage8 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_3_11 -> ring_attn_3_12_stage8 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_3_3_stage8 -> ring_attn_3_3_stage9
	k_proj_3_10 -> ring_attn_3_11_stage9 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_3_10 -> ring_attn_3_11_stage9 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_3_3_stage9 -> ring_attn_3_3_stage10
	k_proj_3_9 -> ring_attn_3_10_stage10 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_3_9 -> ring_attn_3_10_stage10 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_3_3_stage10 -> ring_attn_3_3_stage11
	k_proj_3_8 -> ring_attn_3_9_stage11 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_3_8 -> ring_attn_3_9_stage11 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_3_3_stage11 -> ring_attn_3_3_stage12
	k_proj_3_7 -> ring_attn_3_8_stage12 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_3_7 -> ring_attn_3_8_stage12 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_3_3_stage12 -> ring_attn_3_3_stage13
	k_proj_3_6 -> ring_attn_3_7_stage13 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_3_6 -> ring_attn_3_7_stage13 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_3_3_stage13 -> ring_attn_3_3_stage14
	k_proj_3_5 -> ring_attn_3_6_stage14 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_3_5 -> ring_attn_3_6_stage14 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_3_3_stage14 -> ring_attn_3_3_stage15
	k_proj_3_4 -> ring_attn_3_5_stage15 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_3_4 -> ring_attn_3_5_stage15 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_3_3_stage15 -> o_proj_3_3
	o_proj_3_3 -> residual1_3_3
	ln1_3_3 -> residual1_3_3 [style=dotted]
	residual1_3_3 -> ln2_3_3
	ln2_3_3 -> router_3_3
	router_3_3 -> gate_3_3
	gate_3_3 -> expert_agg_3_3
	ln2_3_3 -> expert_3_3_0
	expert_3_3_0 -> expert_agg_3_3
	gate_3_3 -> expert_3_3_0 [label="gate weight" style=dotted]
	ln2_3_3 -> expert_3_3_1
	expert_3_3_1 -> expert_agg_3_3
	gate_3_3 -> expert_3_3_1 [label="gate weight" style=dotted]
	ln2_3_3 -> expert_3_3_2
	expert_3_3_2 -> expert_agg_3_3
	gate_3_3 -> expert_3_3_2 [label="gate weight" style=dotted]
	ln2_3_3 -> expert_3_3_3
	expert_3_3_3 -> expert_agg_3_3
	gate_3_3 -> expert_3_3_3 [label="gate weight" style=dotted]
	ln2_3_3 -> expert_3_3_4
	expert_3_3_4 -> expert_agg_3_3
	gate_3_3 -> expert_3_3_4 [label="gate weight" style=dotted]
	ln2_3_3 -> expert_3_3_5
	expert_3_3_5 -> expert_agg_3_3
	gate_3_3 -> expert_3_3_5 [label="gate weight" style=dotted]
	ln2_3_3 -> expert_3_3_6
	expert_3_3_6 -> expert_agg_3_3
	gate_3_3 -> expert_3_3_6 [label="gate weight" style=dotted]
	ln2_3_3 -> expert_3_3_7
	expert_3_3_7 -> expert_agg_3_3
	gate_3_3 -> expert_3_3_7 [label="gate weight" style=dotted]
	expert_agg_3_3 -> residual2_3_3
	ln2_3_3 -> residual2_3_3 [style=dotted]
	ln1_3_4 -> q_proj_3_4
	ln1_3_4 -> k_proj_3_4
	ln1_3_4 -> v_proj_3_4
	q_proj_3_4 -> ring_attn_3_4_stage0
	k_proj_3_4 -> ring_attn_3_4_stage0
	v_proj_3_4 -> ring_attn_3_4_stage0
	ring_attn_3_4_stage0 -> ring_attn_3_4_stage1
	k_proj_3_3 -> ring_attn_3_4_stage1 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_3_3 -> ring_attn_3_4_stage1 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_3_4_stage1 -> ring_attn_3_4_stage2
	k_proj_3_2 -> ring_attn_3_3_stage2 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_3_2 -> ring_attn_3_3_stage2 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_3_4_stage2 -> ring_attn_3_4_stage3
	k_proj_3_1 -> ring_attn_3_2_stage3 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_3_1 -> ring_attn_3_2_stage3 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_3_4_stage3 -> ring_attn_3_4_stage4
	k_proj_3_0 -> ring_attn_3_1_stage4 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_3_0 -> ring_attn_3_1_stage4 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_3_4_stage4 -> ring_attn_3_4_stage5
	k_proj_3_15 -> ring_attn_3_0_stage5 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_3_15 -> ring_attn_3_0_stage5 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_3_4_stage5 -> ring_attn_3_4_stage6
	k_proj_3_14 -> ring_attn_3_15_stage6 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_3_14 -> ring_attn_3_15_stage6 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_3_4_stage6 -> ring_attn_3_4_stage7
	k_proj_3_13 -> ring_attn_3_14_stage7 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_3_13 -> ring_attn_3_14_stage7 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_3_4_stage7 -> ring_attn_3_4_stage8
	k_proj_3_12 -> ring_attn_3_13_stage8 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_3_12 -> ring_attn_3_13_stage8 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_3_4_stage8 -> ring_attn_3_4_stage9
	k_proj_3_11 -> ring_attn_3_12_stage9 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_3_11 -> ring_attn_3_12_stage9 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_3_4_stage9 -> ring_attn_3_4_stage10
	k_proj_3_10 -> ring_attn_3_11_stage10 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_3_10 -> ring_attn_3_11_stage10 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_3_4_stage10 -> ring_attn_3_4_stage11
	k_proj_3_9 -> ring_attn_3_10_stage11 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_3_9 -> ring_attn_3_10_stage11 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_3_4_stage11 -> ring_attn_3_4_stage12
	k_proj_3_8 -> ring_attn_3_9_stage12 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_3_8 -> ring_attn_3_9_stage12 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_3_4_stage12 -> ring_attn_3_4_stage13
	k_proj_3_7 -> ring_attn_3_8_stage13 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_3_7 -> ring_attn_3_8_stage13 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_3_4_stage13 -> ring_attn_3_4_stage14
	k_proj_3_6 -> ring_attn_3_7_stage14 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_3_6 -> ring_attn_3_7_stage14 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_3_4_stage14 -> ring_attn_3_4_stage15
	k_proj_3_5 -> ring_attn_3_6_stage15 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_3_5 -> ring_attn_3_6_stage15 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_3_4_stage15 -> o_proj_3_4
	o_proj_3_4 -> residual1_3_4
	ln1_3_4 -> residual1_3_4 [style=dotted]
	residual1_3_4 -> ln2_3_4
	ln2_3_4 -> router_3_4
	router_3_4 -> gate_3_4
	gate_3_4 -> expert_agg_3_4
	ln2_3_4 -> expert_3_4_0
	expert_3_4_0 -> expert_agg_3_4
	gate_3_4 -> expert_3_4_0 [label="gate weight" style=dotted]
	ln2_3_4 -> expert_3_4_1
	expert_3_4_1 -> expert_agg_3_4
	gate_3_4 -> expert_3_4_1 [label="gate weight" style=dotted]
	ln2_3_4 -> expert_3_4_2
	expert_3_4_2 -> expert_agg_3_4
	gate_3_4 -> expert_3_4_2 [label="gate weight" style=dotted]
	ln2_3_4 -> expert_3_4_3
	expert_3_4_3 -> expert_agg_3_4
	gate_3_4 -> expert_3_4_3 [label="gate weight" style=dotted]
	ln2_3_4 -> expert_3_4_4
	expert_3_4_4 -> expert_agg_3_4
	gate_3_4 -> expert_3_4_4 [label="gate weight" style=dotted]
	ln2_3_4 -> expert_3_4_5
	expert_3_4_5 -> expert_agg_3_4
	gate_3_4 -> expert_3_4_5 [label="gate weight" style=dotted]
	ln2_3_4 -> expert_3_4_6
	expert_3_4_6 -> expert_agg_3_4
	gate_3_4 -> expert_3_4_6 [label="gate weight" style=dotted]
	ln2_3_4 -> expert_3_4_7
	expert_3_4_7 -> expert_agg_3_4
	gate_3_4 -> expert_3_4_7 [label="gate weight" style=dotted]
	expert_agg_3_4 -> residual2_3_4
	ln2_3_4 -> residual2_3_4 [style=dotted]
	ln1_3_5 -> q_proj_3_5
	ln1_3_5 -> k_proj_3_5
	ln1_3_5 -> v_proj_3_5
	q_proj_3_5 -> ring_attn_3_5_stage0
	k_proj_3_5 -> ring_attn_3_5_stage0
	v_proj_3_5 -> ring_attn_3_5_stage0
	ring_attn_3_5_stage0 -> ring_attn_3_5_stage1
	k_proj_3_4 -> ring_attn_3_5_stage1 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_3_4 -> ring_attn_3_5_stage1 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_3_5_stage1 -> ring_attn_3_5_stage2
	k_proj_3_3 -> ring_attn_3_4_stage2 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_3_3 -> ring_attn_3_4_stage2 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_3_5_stage2 -> ring_attn_3_5_stage3
	k_proj_3_2 -> ring_attn_3_3_stage3 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_3_2 -> ring_attn_3_3_stage3 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_3_5_stage3 -> ring_attn_3_5_stage4
	k_proj_3_1 -> ring_attn_3_2_stage4 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_3_1 -> ring_attn_3_2_stage4 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_3_5_stage4 -> ring_attn_3_5_stage5
	k_proj_3_0 -> ring_attn_3_1_stage5 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_3_0 -> ring_attn_3_1_stage5 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_3_5_stage5 -> ring_attn_3_5_stage6
	k_proj_3_15 -> ring_attn_3_0_stage6 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_3_15 -> ring_attn_3_0_stage6 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_3_5_stage6 -> ring_attn_3_5_stage7
	k_proj_3_14 -> ring_attn_3_15_stage7 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_3_14 -> ring_attn_3_15_stage7 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_3_5_stage7 -> ring_attn_3_5_stage8
	k_proj_3_13 -> ring_attn_3_14_stage8 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_3_13 -> ring_attn_3_14_stage8 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_3_5_stage8 -> ring_attn_3_5_stage9
	k_proj_3_12 -> ring_attn_3_13_stage9 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_3_12 -> ring_attn_3_13_stage9 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_3_5_stage9 -> ring_attn_3_5_stage10
	k_proj_3_11 -> ring_attn_3_12_stage10 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_3_11 -> ring_attn_3_12_stage10 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_3_5_stage10 -> ring_attn_3_5_stage11
	k_proj_3_10 -> ring_attn_3_11_stage11 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_3_10 -> ring_attn_3_11_stage11 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_3_5_stage11 -> ring_attn_3_5_stage12
	k_proj_3_9 -> ring_attn_3_10_stage12 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_3_9 -> ring_attn_3_10_stage12 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_3_5_stage12 -> ring_attn_3_5_stage13
	k_proj_3_8 -> ring_attn_3_9_stage13 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_3_8 -> ring_attn_3_9_stage13 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_3_5_stage13 -> ring_attn_3_5_stage14
	k_proj_3_7 -> ring_attn_3_8_stage14 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_3_7 -> ring_attn_3_8_stage14 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_3_5_stage14 -> ring_attn_3_5_stage15
	k_proj_3_6 -> ring_attn_3_7_stage15 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_3_6 -> ring_attn_3_7_stage15 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_3_5_stage15 -> o_proj_3_5
	o_proj_3_5 -> residual1_3_5
	ln1_3_5 -> residual1_3_5 [style=dotted]
	residual1_3_5 -> ln2_3_5
	ln2_3_5 -> router_3_5
	router_3_5 -> gate_3_5
	gate_3_5 -> expert_agg_3_5
	ln2_3_5 -> expert_3_5_0
	expert_3_5_0 -> expert_agg_3_5
	gate_3_5 -> expert_3_5_0 [label="gate weight" style=dotted]
	ln2_3_5 -> expert_3_5_1
	expert_3_5_1 -> expert_agg_3_5
	gate_3_5 -> expert_3_5_1 [label="gate weight" style=dotted]
	ln2_3_5 -> expert_3_5_2
	expert_3_5_2 -> expert_agg_3_5
	gate_3_5 -> expert_3_5_2 [label="gate weight" style=dotted]
	ln2_3_5 -> expert_3_5_3
	expert_3_5_3 -> expert_agg_3_5
	gate_3_5 -> expert_3_5_3 [label="gate weight" style=dotted]
	ln2_3_5 -> expert_3_5_4
	expert_3_5_4 -> expert_agg_3_5
	gate_3_5 -> expert_3_5_4 [label="gate weight" style=dotted]
	ln2_3_5 -> expert_3_5_5
	expert_3_5_5 -> expert_agg_3_5
	gate_3_5 -> expert_3_5_5 [label="gate weight" style=dotted]
	ln2_3_5 -> expert_3_5_6
	expert_3_5_6 -> expert_agg_3_5
	gate_3_5 -> expert_3_5_6 [label="gate weight" style=dotted]
	ln2_3_5 -> expert_3_5_7
	expert_3_5_7 -> expert_agg_3_5
	gate_3_5 -> expert_3_5_7 [label="gate weight" style=dotted]
	expert_agg_3_5 -> residual2_3_5
	ln2_3_5 -> residual2_3_5 [style=dotted]
	ln1_3_6 -> q_proj_3_6
	ln1_3_6 -> k_proj_3_6
	ln1_3_6 -> v_proj_3_6
	q_proj_3_6 -> ring_attn_3_6_stage0
	k_proj_3_6 -> ring_attn_3_6_stage0
	v_proj_3_6 -> ring_attn_3_6_stage0
	ring_attn_3_6_stage0 -> ring_attn_3_6_stage1
	k_proj_3_5 -> ring_attn_3_6_stage1 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_3_5 -> ring_attn_3_6_stage1 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_3_6_stage1 -> ring_attn_3_6_stage2
	k_proj_3_4 -> ring_attn_3_5_stage2 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_3_4 -> ring_attn_3_5_stage2 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_3_6_stage2 -> ring_attn_3_6_stage3
	k_proj_3_3 -> ring_attn_3_4_stage3 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_3_3 -> ring_attn_3_4_stage3 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_3_6_stage3 -> ring_attn_3_6_stage4
	k_proj_3_2 -> ring_attn_3_3_stage4 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_3_2 -> ring_attn_3_3_stage4 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_3_6_stage4 -> ring_attn_3_6_stage5
	k_proj_3_1 -> ring_attn_3_2_stage5 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_3_1 -> ring_attn_3_2_stage5 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_3_6_stage5 -> ring_attn_3_6_stage6
	k_proj_3_0 -> ring_attn_3_1_stage6 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_3_0 -> ring_attn_3_1_stage6 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_3_6_stage6 -> ring_attn_3_6_stage7
	k_proj_3_15 -> ring_attn_3_0_stage7 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_3_15 -> ring_attn_3_0_stage7 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_3_6_stage7 -> ring_attn_3_6_stage8
	k_proj_3_14 -> ring_attn_3_15_stage8 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_3_14 -> ring_attn_3_15_stage8 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_3_6_stage8 -> ring_attn_3_6_stage9
	k_proj_3_13 -> ring_attn_3_14_stage9 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_3_13 -> ring_attn_3_14_stage9 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_3_6_stage9 -> ring_attn_3_6_stage10
	k_proj_3_12 -> ring_attn_3_13_stage10 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_3_12 -> ring_attn_3_13_stage10 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_3_6_stage10 -> ring_attn_3_6_stage11
	k_proj_3_11 -> ring_attn_3_12_stage11 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_3_11 -> ring_attn_3_12_stage11 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_3_6_stage11 -> ring_attn_3_6_stage12
	k_proj_3_10 -> ring_attn_3_11_stage12 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_3_10 -> ring_attn_3_11_stage12 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_3_6_stage12 -> ring_attn_3_6_stage13
	k_proj_3_9 -> ring_attn_3_10_stage13 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_3_9 -> ring_attn_3_10_stage13 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_3_6_stage13 -> ring_attn_3_6_stage14
	k_proj_3_8 -> ring_attn_3_9_stage14 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_3_8 -> ring_attn_3_9_stage14 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_3_6_stage14 -> ring_attn_3_6_stage15
	k_proj_3_7 -> ring_attn_3_8_stage15 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_3_7 -> ring_attn_3_8_stage15 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_3_6_stage15 -> o_proj_3_6
	o_proj_3_6 -> residual1_3_6
	ln1_3_6 -> residual1_3_6 [style=dotted]
	residual1_3_6 -> ln2_3_6
	ln2_3_6 -> router_3_6
	router_3_6 -> gate_3_6
	gate_3_6 -> expert_agg_3_6
	ln2_3_6 -> expert_3_6_0
	expert_3_6_0 -> expert_agg_3_6
	gate_3_6 -> expert_3_6_0 [label="gate weight" style=dotted]
	ln2_3_6 -> expert_3_6_1
	expert_3_6_1 -> expert_agg_3_6
	gate_3_6 -> expert_3_6_1 [label="gate weight" style=dotted]
	ln2_3_6 -> expert_3_6_2
	expert_3_6_2 -> expert_agg_3_6
	gate_3_6 -> expert_3_6_2 [label="gate weight" style=dotted]
	ln2_3_6 -> expert_3_6_3
	expert_3_6_3 -> expert_agg_3_6
	gate_3_6 -> expert_3_6_3 [label="gate weight" style=dotted]
	ln2_3_6 -> expert_3_6_4
	expert_3_6_4 -> expert_agg_3_6
	gate_3_6 -> expert_3_6_4 [label="gate weight" style=dotted]
	ln2_3_6 -> expert_3_6_5
	expert_3_6_5 -> expert_agg_3_6
	gate_3_6 -> expert_3_6_5 [label="gate weight" style=dotted]
	ln2_3_6 -> expert_3_6_6
	expert_3_6_6 -> expert_agg_3_6
	gate_3_6 -> expert_3_6_6 [label="gate weight" style=dotted]
	ln2_3_6 -> expert_3_6_7
	expert_3_6_7 -> expert_agg_3_6
	gate_3_6 -> expert_3_6_7 [label="gate weight" style=dotted]
	expert_agg_3_6 -> residual2_3_6
	ln2_3_6 -> residual2_3_6 [style=dotted]
	ln1_3_7 -> q_proj_3_7
	ln1_3_7 -> k_proj_3_7
	ln1_3_7 -> v_proj_3_7
	q_proj_3_7 -> ring_attn_3_7_stage0
	k_proj_3_7 -> ring_attn_3_7_stage0
	v_proj_3_7 -> ring_attn_3_7_stage0
	ring_attn_3_7_stage0 -> ring_attn_3_7_stage1
	k_proj_3_6 -> ring_attn_3_7_stage1 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_3_6 -> ring_attn_3_7_stage1 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_3_7_stage1 -> ring_attn_3_7_stage2
	k_proj_3_5 -> ring_attn_3_6_stage2 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_3_5 -> ring_attn_3_6_stage2 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_3_7_stage2 -> ring_attn_3_7_stage3
	k_proj_3_4 -> ring_attn_3_5_stage3 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_3_4 -> ring_attn_3_5_stage3 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_3_7_stage3 -> ring_attn_3_7_stage4
	k_proj_3_3 -> ring_attn_3_4_stage4 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_3_3 -> ring_attn_3_4_stage4 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_3_7_stage4 -> ring_attn_3_7_stage5
	k_proj_3_2 -> ring_attn_3_3_stage5 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_3_2 -> ring_attn_3_3_stage5 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_3_7_stage5 -> ring_attn_3_7_stage6
	k_proj_3_1 -> ring_attn_3_2_stage6 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_3_1 -> ring_attn_3_2_stage6 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_3_7_stage6 -> ring_attn_3_7_stage7
	k_proj_3_0 -> ring_attn_3_1_stage7 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_3_0 -> ring_attn_3_1_stage7 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_3_7_stage7 -> ring_attn_3_7_stage8
	k_proj_3_15 -> ring_attn_3_0_stage8 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_3_15 -> ring_attn_3_0_stage8 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_3_7_stage8 -> ring_attn_3_7_stage9
	k_proj_3_14 -> ring_attn_3_15_stage9 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_3_14 -> ring_attn_3_15_stage9 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_3_7_stage9 -> ring_attn_3_7_stage10
	k_proj_3_13 -> ring_attn_3_14_stage10 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_3_13 -> ring_attn_3_14_stage10 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_3_7_stage10 -> ring_attn_3_7_stage11
	k_proj_3_12 -> ring_attn_3_13_stage11 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_3_12 -> ring_attn_3_13_stage11 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_3_7_stage11 -> ring_attn_3_7_stage12
	k_proj_3_11 -> ring_attn_3_12_stage12 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_3_11 -> ring_attn_3_12_stage12 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_3_7_stage12 -> ring_attn_3_7_stage13
	k_proj_3_10 -> ring_attn_3_11_stage13 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_3_10 -> ring_attn_3_11_stage13 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_3_7_stage13 -> ring_attn_3_7_stage14
	k_proj_3_9 -> ring_attn_3_10_stage14 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_3_9 -> ring_attn_3_10_stage14 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_3_7_stage14 -> ring_attn_3_7_stage15
	k_proj_3_8 -> ring_attn_3_9_stage15 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_3_8 -> ring_attn_3_9_stage15 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_3_7_stage15 -> o_proj_3_7
	o_proj_3_7 -> residual1_3_7
	ln1_3_7 -> residual1_3_7 [style=dotted]
	residual1_3_7 -> ln2_3_7
	ln2_3_7 -> router_3_7
	router_3_7 -> gate_3_7
	gate_3_7 -> expert_agg_3_7
	ln2_3_7 -> expert_3_7_0
	expert_3_7_0 -> expert_agg_3_7
	gate_3_7 -> expert_3_7_0 [label="gate weight" style=dotted]
	ln2_3_7 -> expert_3_7_1
	expert_3_7_1 -> expert_agg_3_7
	gate_3_7 -> expert_3_7_1 [label="gate weight" style=dotted]
	ln2_3_7 -> expert_3_7_2
	expert_3_7_2 -> expert_agg_3_7
	gate_3_7 -> expert_3_7_2 [label="gate weight" style=dotted]
	ln2_3_7 -> expert_3_7_3
	expert_3_7_3 -> expert_agg_3_7
	gate_3_7 -> expert_3_7_3 [label="gate weight" style=dotted]
	ln2_3_7 -> expert_3_7_4
	expert_3_7_4 -> expert_agg_3_7
	gate_3_7 -> expert_3_7_4 [label="gate weight" style=dotted]
	ln2_3_7 -> expert_3_7_5
	expert_3_7_5 -> expert_agg_3_7
	gate_3_7 -> expert_3_7_5 [label="gate weight" style=dotted]
	ln2_3_7 -> expert_3_7_6
	expert_3_7_6 -> expert_agg_3_7
	gate_3_7 -> expert_3_7_6 [label="gate weight" style=dotted]
	ln2_3_7 -> expert_3_7_7
	expert_3_7_7 -> expert_agg_3_7
	gate_3_7 -> expert_3_7_7 [label="gate weight" style=dotted]
	expert_agg_3_7 -> residual2_3_7
	ln2_3_7 -> residual2_3_7 [style=dotted]
	ln1_3_8 -> q_proj_3_8
	ln1_3_8 -> k_proj_3_8
	ln1_3_8 -> v_proj_3_8
	q_proj_3_8 -> ring_attn_3_8_stage0
	k_proj_3_8 -> ring_attn_3_8_stage0
	v_proj_3_8 -> ring_attn_3_8_stage0
	ring_attn_3_8_stage0 -> ring_attn_3_8_stage1
	k_proj_3_7 -> ring_attn_3_8_stage1 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_3_7 -> ring_attn_3_8_stage1 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_3_8_stage1 -> ring_attn_3_8_stage2
	k_proj_3_6 -> ring_attn_3_7_stage2 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_3_6 -> ring_attn_3_7_stage2 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_3_8_stage2 -> ring_attn_3_8_stage3
	k_proj_3_5 -> ring_attn_3_6_stage3 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_3_5 -> ring_attn_3_6_stage3 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_3_8_stage3 -> ring_attn_3_8_stage4
	k_proj_3_4 -> ring_attn_3_5_stage4 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_3_4 -> ring_attn_3_5_stage4 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_3_8_stage4 -> ring_attn_3_8_stage5
	k_proj_3_3 -> ring_attn_3_4_stage5 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_3_3 -> ring_attn_3_4_stage5 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_3_8_stage5 -> ring_attn_3_8_stage6
	k_proj_3_2 -> ring_attn_3_3_stage6 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_3_2 -> ring_attn_3_3_stage6 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_3_8_stage6 -> ring_attn_3_8_stage7
	k_proj_3_1 -> ring_attn_3_2_stage7 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_3_1 -> ring_attn_3_2_stage7 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_3_8_stage7 -> ring_attn_3_8_stage8
	k_proj_3_0 -> ring_attn_3_1_stage8 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_3_0 -> ring_attn_3_1_stage8 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_3_8_stage8 -> ring_attn_3_8_stage9
	k_proj_3_15 -> ring_attn_3_0_stage9 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_3_15 -> ring_attn_3_0_stage9 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_3_8_stage9 -> ring_attn_3_8_stage10
	k_proj_3_14 -> ring_attn_3_15_stage10 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_3_14 -> ring_attn_3_15_stage10 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_3_8_stage10 -> ring_attn_3_8_stage11
	k_proj_3_13 -> ring_attn_3_14_stage11 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_3_13 -> ring_attn_3_14_stage11 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_3_8_stage11 -> ring_attn_3_8_stage12
	k_proj_3_12 -> ring_attn_3_13_stage12 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_3_12 -> ring_attn_3_13_stage12 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_3_8_stage12 -> ring_attn_3_8_stage13
	k_proj_3_11 -> ring_attn_3_12_stage13 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_3_11 -> ring_attn_3_12_stage13 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_3_8_stage13 -> ring_attn_3_8_stage14
	k_proj_3_10 -> ring_attn_3_11_stage14 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_3_10 -> ring_attn_3_11_stage14 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_3_8_stage14 -> ring_attn_3_8_stage15
	k_proj_3_9 -> ring_attn_3_10_stage15 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_3_9 -> ring_attn_3_10_stage15 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_3_8_stage15 -> o_proj_3_8
	o_proj_3_8 -> residual1_3_8
	ln1_3_8 -> residual1_3_8 [style=dotted]
	residual1_3_8 -> ln2_3_8
	ln2_3_8 -> router_3_8
	router_3_8 -> gate_3_8
	gate_3_8 -> expert_agg_3_8
	ln2_3_8 -> expert_3_8_0
	expert_3_8_0 -> expert_agg_3_8
	gate_3_8 -> expert_3_8_0 [label="gate weight" style=dotted]
	ln2_3_8 -> expert_3_8_1
	expert_3_8_1 -> expert_agg_3_8
	gate_3_8 -> expert_3_8_1 [label="gate weight" style=dotted]
	ln2_3_8 -> expert_3_8_2
	expert_3_8_2 -> expert_agg_3_8
	gate_3_8 -> expert_3_8_2 [label="gate weight" style=dotted]
	ln2_3_8 -> expert_3_8_3
	expert_3_8_3 -> expert_agg_3_8
	gate_3_8 -> expert_3_8_3 [label="gate weight" style=dotted]
	ln2_3_8 -> expert_3_8_4
	expert_3_8_4 -> expert_agg_3_8
	gate_3_8 -> expert_3_8_4 [label="gate weight" style=dotted]
	ln2_3_8 -> expert_3_8_5
	expert_3_8_5 -> expert_agg_3_8
	gate_3_8 -> expert_3_8_5 [label="gate weight" style=dotted]
	ln2_3_8 -> expert_3_8_6
	expert_3_8_6 -> expert_agg_3_8
	gate_3_8 -> expert_3_8_6 [label="gate weight" style=dotted]
	ln2_3_8 -> expert_3_8_7
	expert_3_8_7 -> expert_agg_3_8
	gate_3_8 -> expert_3_8_7 [label="gate weight" style=dotted]
	expert_agg_3_8 -> residual2_3_8
	ln2_3_8 -> residual2_3_8 [style=dotted]
	ln1_3_9 -> q_proj_3_9
	ln1_3_9 -> k_proj_3_9
	ln1_3_9 -> v_proj_3_9
	q_proj_3_9 -> ring_attn_3_9_stage0
	k_proj_3_9 -> ring_attn_3_9_stage0
	v_proj_3_9 -> ring_attn_3_9_stage0
	ring_attn_3_9_stage0 -> ring_attn_3_9_stage1
	k_proj_3_8 -> ring_attn_3_9_stage1 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_3_8 -> ring_attn_3_9_stage1 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_3_9_stage1 -> ring_attn_3_9_stage2
	k_proj_3_7 -> ring_attn_3_8_stage2 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_3_7 -> ring_attn_3_8_stage2 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_3_9_stage2 -> ring_attn_3_9_stage3
	k_proj_3_6 -> ring_attn_3_7_stage3 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_3_6 -> ring_attn_3_7_stage3 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_3_9_stage3 -> ring_attn_3_9_stage4
	k_proj_3_5 -> ring_attn_3_6_stage4 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_3_5 -> ring_attn_3_6_stage4 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_3_9_stage4 -> ring_attn_3_9_stage5
	k_proj_3_4 -> ring_attn_3_5_stage5 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_3_4 -> ring_attn_3_5_stage5 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_3_9_stage5 -> ring_attn_3_9_stage6
	k_proj_3_3 -> ring_attn_3_4_stage6 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_3_3 -> ring_attn_3_4_stage6 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_3_9_stage6 -> ring_attn_3_9_stage7
	k_proj_3_2 -> ring_attn_3_3_stage7 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_3_2 -> ring_attn_3_3_stage7 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_3_9_stage7 -> ring_attn_3_9_stage8
	k_proj_3_1 -> ring_attn_3_2_stage8 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_3_1 -> ring_attn_3_2_stage8 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_3_9_stage8 -> ring_attn_3_9_stage9
	k_proj_3_0 -> ring_attn_3_1_stage9 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_3_0 -> ring_attn_3_1_stage9 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_3_9_stage9 -> ring_attn_3_9_stage10
	k_proj_3_15 -> ring_attn_3_0_stage10 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_3_15 -> ring_attn_3_0_stage10 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_3_9_stage10 -> ring_attn_3_9_stage11
	k_proj_3_14 -> ring_attn_3_15_stage11 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_3_14 -> ring_attn_3_15_stage11 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_3_9_stage11 -> ring_attn_3_9_stage12
	k_proj_3_13 -> ring_attn_3_14_stage12 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_3_13 -> ring_attn_3_14_stage12 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_3_9_stage12 -> ring_attn_3_9_stage13
	k_proj_3_12 -> ring_attn_3_13_stage13 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_3_12 -> ring_attn_3_13_stage13 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_3_9_stage13 -> ring_attn_3_9_stage14
	k_proj_3_11 -> ring_attn_3_12_stage14 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_3_11 -> ring_attn_3_12_stage14 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_3_9_stage14 -> ring_attn_3_9_stage15
	k_proj_3_10 -> ring_attn_3_11_stage15 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_3_10 -> ring_attn_3_11_stage15 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_3_9_stage15 -> o_proj_3_9
	o_proj_3_9 -> residual1_3_9
	ln1_3_9 -> residual1_3_9 [style=dotted]
	residual1_3_9 -> ln2_3_9
	ln2_3_9 -> router_3_9
	router_3_9 -> gate_3_9
	gate_3_9 -> expert_agg_3_9
	ln2_3_9 -> expert_3_9_0
	expert_3_9_0 -> expert_agg_3_9
	gate_3_9 -> expert_3_9_0 [label="gate weight" style=dotted]
	ln2_3_9 -> expert_3_9_1
	expert_3_9_1 -> expert_agg_3_9
	gate_3_9 -> expert_3_9_1 [label="gate weight" style=dotted]
	ln2_3_9 -> expert_3_9_2
	expert_3_9_2 -> expert_agg_3_9
	gate_3_9 -> expert_3_9_2 [label="gate weight" style=dotted]
	ln2_3_9 -> expert_3_9_3
	expert_3_9_3 -> expert_agg_3_9
	gate_3_9 -> expert_3_9_3 [label="gate weight" style=dotted]
	ln2_3_9 -> expert_3_9_4
	expert_3_9_4 -> expert_agg_3_9
	gate_3_9 -> expert_3_9_4 [label="gate weight" style=dotted]
	ln2_3_9 -> expert_3_9_5
	expert_3_9_5 -> expert_agg_3_9
	gate_3_9 -> expert_3_9_5 [label="gate weight" style=dotted]
	ln2_3_9 -> expert_3_9_6
	expert_3_9_6 -> expert_agg_3_9
	gate_3_9 -> expert_3_9_6 [label="gate weight" style=dotted]
	ln2_3_9 -> expert_3_9_7
	expert_3_9_7 -> expert_agg_3_9
	gate_3_9 -> expert_3_9_7 [label="gate weight" style=dotted]
	expert_agg_3_9 -> residual2_3_9
	ln2_3_9 -> residual2_3_9 [style=dotted]
	ln1_3_10 -> q_proj_3_10
	ln1_3_10 -> k_proj_3_10
	ln1_3_10 -> v_proj_3_10
	q_proj_3_10 -> ring_attn_3_10_stage0
	k_proj_3_10 -> ring_attn_3_10_stage0
	v_proj_3_10 -> ring_attn_3_10_stage0
	ring_attn_3_10_stage0 -> ring_attn_3_10_stage1
	k_proj_3_9 -> ring_attn_3_10_stage1 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_3_9 -> ring_attn_3_10_stage1 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_3_10_stage1 -> ring_attn_3_10_stage2
	k_proj_3_8 -> ring_attn_3_9_stage2 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_3_8 -> ring_attn_3_9_stage2 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_3_10_stage2 -> ring_attn_3_10_stage3
	k_proj_3_7 -> ring_attn_3_8_stage3 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_3_7 -> ring_attn_3_8_stage3 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_3_10_stage3 -> ring_attn_3_10_stage4
	k_proj_3_6 -> ring_attn_3_7_stage4 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_3_6 -> ring_attn_3_7_stage4 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_3_10_stage4 -> ring_attn_3_10_stage5
	k_proj_3_5 -> ring_attn_3_6_stage5 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_3_5 -> ring_attn_3_6_stage5 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_3_10_stage5 -> ring_attn_3_10_stage6
	k_proj_3_4 -> ring_attn_3_5_stage6 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_3_4 -> ring_attn_3_5_stage6 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_3_10_stage6 -> ring_attn_3_10_stage7
	k_proj_3_3 -> ring_attn_3_4_stage7 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_3_3 -> ring_attn_3_4_stage7 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_3_10_stage7 -> ring_attn_3_10_stage8
	k_proj_3_2 -> ring_attn_3_3_stage8 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_3_2 -> ring_attn_3_3_stage8 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_3_10_stage8 -> ring_attn_3_10_stage9
	k_proj_3_1 -> ring_attn_3_2_stage9 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_3_1 -> ring_attn_3_2_stage9 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_3_10_stage9 -> ring_attn_3_10_stage10
	k_proj_3_0 -> ring_attn_3_1_stage10 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_3_0 -> ring_attn_3_1_stage10 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_3_10_stage10 -> ring_attn_3_10_stage11
	k_proj_3_15 -> ring_attn_3_0_stage11 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_3_15 -> ring_attn_3_0_stage11 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_3_10_stage11 -> ring_attn_3_10_stage12
	k_proj_3_14 -> ring_attn_3_15_stage12 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_3_14 -> ring_attn_3_15_stage12 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_3_10_stage12 -> ring_attn_3_10_stage13
	k_proj_3_13 -> ring_attn_3_14_stage13 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_3_13 -> ring_attn_3_14_stage13 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_3_10_stage13 -> ring_attn_3_10_stage14
	k_proj_3_12 -> ring_attn_3_13_stage14 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_3_12 -> ring_attn_3_13_stage14 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_3_10_stage14 -> ring_attn_3_10_stage15
	k_proj_3_11 -> ring_attn_3_12_stage15 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_3_11 -> ring_attn_3_12_stage15 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_3_10_stage15 -> o_proj_3_10
	o_proj_3_10 -> residual1_3_10
	ln1_3_10 -> residual1_3_10 [style=dotted]
	residual1_3_10 -> ln2_3_10
	ln2_3_10 -> router_3_10
	router_3_10 -> gate_3_10
	gate_3_10 -> expert_agg_3_10
	ln2_3_10 -> expert_3_10_0
	expert_3_10_0 -> expert_agg_3_10
	gate_3_10 -> expert_3_10_0 [label="gate weight" style=dotted]
	ln2_3_10 -> expert_3_10_1
	expert_3_10_1 -> expert_agg_3_10
	gate_3_10 -> expert_3_10_1 [label="gate weight" style=dotted]
	ln2_3_10 -> expert_3_10_2
	expert_3_10_2 -> expert_agg_3_10
	gate_3_10 -> expert_3_10_2 [label="gate weight" style=dotted]
	ln2_3_10 -> expert_3_10_3
	expert_3_10_3 -> expert_agg_3_10
	gate_3_10 -> expert_3_10_3 [label="gate weight" style=dotted]
	ln2_3_10 -> expert_3_10_4
	expert_3_10_4 -> expert_agg_3_10
	gate_3_10 -> expert_3_10_4 [label="gate weight" style=dotted]
	ln2_3_10 -> expert_3_10_5
	expert_3_10_5 -> expert_agg_3_10
	gate_3_10 -> expert_3_10_5 [label="gate weight" style=dotted]
	ln2_3_10 -> expert_3_10_6
	expert_3_10_6 -> expert_agg_3_10
	gate_3_10 -> expert_3_10_6 [label="gate weight" style=dotted]
	ln2_3_10 -> expert_3_10_7
	expert_3_10_7 -> expert_agg_3_10
	gate_3_10 -> expert_3_10_7 [label="gate weight" style=dotted]
	expert_agg_3_10 -> residual2_3_10
	ln2_3_10 -> residual2_3_10 [style=dotted]
	ln1_3_11 -> q_proj_3_11
	ln1_3_11 -> k_proj_3_11
	ln1_3_11 -> v_proj_3_11
	q_proj_3_11 -> ring_attn_3_11_stage0
	k_proj_3_11 -> ring_attn_3_11_stage0
	v_proj_3_11 -> ring_attn_3_11_stage0
	ring_attn_3_11_stage0 -> ring_attn_3_11_stage1
	k_proj_3_10 -> ring_attn_3_11_stage1 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_3_10 -> ring_attn_3_11_stage1 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_3_11_stage1 -> ring_attn_3_11_stage2
	k_proj_3_9 -> ring_attn_3_10_stage2 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_3_9 -> ring_attn_3_10_stage2 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_3_11_stage2 -> ring_attn_3_11_stage3
	k_proj_3_8 -> ring_attn_3_9_stage3 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_3_8 -> ring_attn_3_9_stage3 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_3_11_stage3 -> ring_attn_3_11_stage4
	k_proj_3_7 -> ring_attn_3_8_stage4 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_3_7 -> ring_attn_3_8_stage4 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_3_11_stage4 -> ring_attn_3_11_stage5
	k_proj_3_6 -> ring_attn_3_7_stage5 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_3_6 -> ring_attn_3_7_stage5 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_3_11_stage5 -> ring_attn_3_11_stage6
	k_proj_3_5 -> ring_attn_3_6_stage6 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_3_5 -> ring_attn_3_6_stage6 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_3_11_stage6 -> ring_attn_3_11_stage7
	k_proj_3_4 -> ring_attn_3_5_stage7 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_3_4 -> ring_attn_3_5_stage7 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_3_11_stage7 -> ring_attn_3_11_stage8
	k_proj_3_3 -> ring_attn_3_4_stage8 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_3_3 -> ring_attn_3_4_stage8 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_3_11_stage8 -> ring_attn_3_11_stage9
	k_proj_3_2 -> ring_attn_3_3_stage9 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_3_2 -> ring_attn_3_3_stage9 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_3_11_stage9 -> ring_attn_3_11_stage10
	k_proj_3_1 -> ring_attn_3_2_stage10 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_3_1 -> ring_attn_3_2_stage10 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_3_11_stage10 -> ring_attn_3_11_stage11
	k_proj_3_0 -> ring_attn_3_1_stage11 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_3_0 -> ring_attn_3_1_stage11 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_3_11_stage11 -> ring_attn_3_11_stage12
	k_proj_3_15 -> ring_attn_3_0_stage12 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_3_15 -> ring_attn_3_0_stage12 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_3_11_stage12 -> ring_attn_3_11_stage13
	k_proj_3_14 -> ring_attn_3_15_stage13 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_3_14 -> ring_attn_3_15_stage13 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_3_11_stage13 -> ring_attn_3_11_stage14
	k_proj_3_13 -> ring_attn_3_14_stage14 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_3_13 -> ring_attn_3_14_stage14 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_3_11_stage14 -> ring_attn_3_11_stage15
	k_proj_3_12 -> ring_attn_3_13_stage15 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_3_12 -> ring_attn_3_13_stage15 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_3_11_stage15 -> o_proj_3_11
	o_proj_3_11 -> residual1_3_11
	ln1_3_11 -> residual1_3_11 [style=dotted]
	residual1_3_11 -> ln2_3_11
	ln2_3_11 -> router_3_11
	router_3_11 -> gate_3_11
	gate_3_11 -> expert_agg_3_11
	ln2_3_11 -> expert_3_11_0
	expert_3_11_0 -> expert_agg_3_11
	gate_3_11 -> expert_3_11_0 [label="gate weight" style=dotted]
	ln2_3_11 -> expert_3_11_1
	expert_3_11_1 -> expert_agg_3_11
	gate_3_11 -> expert_3_11_1 [label="gate weight" style=dotted]
	ln2_3_11 -> expert_3_11_2
	expert_3_11_2 -> expert_agg_3_11
	gate_3_11 -> expert_3_11_2 [label="gate weight" style=dotted]
	ln2_3_11 -> expert_3_11_3
	expert_3_11_3 -> expert_agg_3_11
	gate_3_11 -> expert_3_11_3 [label="gate weight" style=dotted]
	ln2_3_11 -> expert_3_11_4
	expert_3_11_4 -> expert_agg_3_11
	gate_3_11 -> expert_3_11_4 [label="gate weight" style=dotted]
	ln2_3_11 -> expert_3_11_5
	expert_3_11_5 -> expert_agg_3_11
	gate_3_11 -> expert_3_11_5 [label="gate weight" style=dotted]
	ln2_3_11 -> expert_3_11_6
	expert_3_11_6 -> expert_agg_3_11
	gate_3_11 -> expert_3_11_6 [label="gate weight" style=dotted]
	ln2_3_11 -> expert_3_11_7
	expert_3_11_7 -> expert_agg_3_11
	gate_3_11 -> expert_3_11_7 [label="gate weight" style=dotted]
	expert_agg_3_11 -> residual2_3_11
	ln2_3_11 -> residual2_3_11 [style=dotted]
	ln1_3_12 -> q_proj_3_12
	ln1_3_12 -> k_proj_3_12
	ln1_3_12 -> v_proj_3_12
	q_proj_3_12 -> ring_attn_3_12_stage0
	k_proj_3_12 -> ring_attn_3_12_stage0
	v_proj_3_12 -> ring_attn_3_12_stage0
	ring_attn_3_12_stage0 -> ring_attn_3_12_stage1
	k_proj_3_11 -> ring_attn_3_12_stage1 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_3_11 -> ring_attn_3_12_stage1 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_3_12_stage1 -> ring_attn_3_12_stage2
	k_proj_3_10 -> ring_attn_3_11_stage2 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_3_10 -> ring_attn_3_11_stage2 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_3_12_stage2 -> ring_attn_3_12_stage3
	k_proj_3_9 -> ring_attn_3_10_stage3 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_3_9 -> ring_attn_3_10_stage3 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_3_12_stage3 -> ring_attn_3_12_stage4
	k_proj_3_8 -> ring_attn_3_9_stage4 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_3_8 -> ring_attn_3_9_stage4 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_3_12_stage4 -> ring_attn_3_12_stage5
	k_proj_3_7 -> ring_attn_3_8_stage5 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_3_7 -> ring_attn_3_8_stage5 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_3_12_stage5 -> ring_attn_3_12_stage6
	k_proj_3_6 -> ring_attn_3_7_stage6 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_3_6 -> ring_attn_3_7_stage6 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_3_12_stage6 -> ring_attn_3_12_stage7
	k_proj_3_5 -> ring_attn_3_6_stage7 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_3_5 -> ring_attn_3_6_stage7 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_3_12_stage7 -> ring_attn_3_12_stage8
	k_proj_3_4 -> ring_attn_3_5_stage8 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_3_4 -> ring_attn_3_5_stage8 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_3_12_stage8 -> ring_attn_3_12_stage9
	k_proj_3_3 -> ring_attn_3_4_stage9 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_3_3 -> ring_attn_3_4_stage9 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_3_12_stage9 -> ring_attn_3_12_stage10
	k_proj_3_2 -> ring_attn_3_3_stage10 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_3_2 -> ring_attn_3_3_stage10 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_3_12_stage10 -> ring_attn_3_12_stage11
	k_proj_3_1 -> ring_attn_3_2_stage11 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_3_1 -> ring_attn_3_2_stage11 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_3_12_stage11 -> ring_attn_3_12_stage12
	k_proj_3_0 -> ring_attn_3_1_stage12 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_3_0 -> ring_attn_3_1_stage12 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_3_12_stage12 -> ring_attn_3_12_stage13
	k_proj_3_15 -> ring_attn_3_0_stage13 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_3_15 -> ring_attn_3_0_stage13 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_3_12_stage13 -> ring_attn_3_12_stage14
	k_proj_3_14 -> ring_attn_3_15_stage14 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_3_14 -> ring_attn_3_15_stage14 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_3_12_stage14 -> ring_attn_3_12_stage15
	k_proj_3_13 -> ring_attn_3_14_stage15 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_3_13 -> ring_attn_3_14_stage15 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_3_12_stage15 -> o_proj_3_12
	o_proj_3_12 -> residual1_3_12
	ln1_3_12 -> residual1_3_12 [style=dotted]
	residual1_3_12 -> ln2_3_12
	ln2_3_12 -> router_3_12
	router_3_12 -> gate_3_12
	gate_3_12 -> expert_agg_3_12
	ln2_3_12 -> expert_3_12_0
	expert_3_12_0 -> expert_agg_3_12
	gate_3_12 -> expert_3_12_0 [label="gate weight" style=dotted]
	ln2_3_12 -> expert_3_12_1
	expert_3_12_1 -> expert_agg_3_12
	gate_3_12 -> expert_3_12_1 [label="gate weight" style=dotted]
	ln2_3_12 -> expert_3_12_2
	expert_3_12_2 -> expert_agg_3_12
	gate_3_12 -> expert_3_12_2 [label="gate weight" style=dotted]
	ln2_3_12 -> expert_3_12_3
	expert_3_12_3 -> expert_agg_3_12
	gate_3_12 -> expert_3_12_3 [label="gate weight" style=dotted]
	ln2_3_12 -> expert_3_12_4
	expert_3_12_4 -> expert_agg_3_12
	gate_3_12 -> expert_3_12_4 [label="gate weight" style=dotted]
	ln2_3_12 -> expert_3_12_5
	expert_3_12_5 -> expert_agg_3_12
	gate_3_12 -> expert_3_12_5 [label="gate weight" style=dotted]
	ln2_3_12 -> expert_3_12_6
	expert_3_12_6 -> expert_agg_3_12
	gate_3_12 -> expert_3_12_6 [label="gate weight" style=dotted]
	ln2_3_12 -> expert_3_12_7
	expert_3_12_7 -> expert_agg_3_12
	gate_3_12 -> expert_3_12_7 [label="gate weight" style=dotted]
	expert_agg_3_12 -> residual2_3_12
	ln2_3_12 -> residual2_3_12 [style=dotted]
	ln1_3_13 -> q_proj_3_13
	ln1_3_13 -> k_proj_3_13
	ln1_3_13 -> v_proj_3_13
	q_proj_3_13 -> ring_attn_3_13_stage0
	k_proj_3_13 -> ring_attn_3_13_stage0
	v_proj_3_13 -> ring_attn_3_13_stage0
	ring_attn_3_13_stage0 -> ring_attn_3_13_stage1
	k_proj_3_12 -> ring_attn_3_13_stage1 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_3_12 -> ring_attn_3_13_stage1 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_3_13_stage1 -> ring_attn_3_13_stage2
	k_proj_3_11 -> ring_attn_3_12_stage2 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_3_11 -> ring_attn_3_12_stage2 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_3_13_stage2 -> ring_attn_3_13_stage3
	k_proj_3_10 -> ring_attn_3_11_stage3 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_3_10 -> ring_attn_3_11_stage3 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_3_13_stage3 -> ring_attn_3_13_stage4
	k_proj_3_9 -> ring_attn_3_10_stage4 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_3_9 -> ring_attn_3_10_stage4 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_3_13_stage4 -> ring_attn_3_13_stage5
	k_proj_3_8 -> ring_attn_3_9_stage5 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_3_8 -> ring_attn_3_9_stage5 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_3_13_stage5 -> ring_attn_3_13_stage6
	k_proj_3_7 -> ring_attn_3_8_stage6 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_3_7 -> ring_attn_3_8_stage6 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_3_13_stage6 -> ring_attn_3_13_stage7
	k_proj_3_6 -> ring_attn_3_7_stage7 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_3_6 -> ring_attn_3_7_stage7 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_3_13_stage7 -> ring_attn_3_13_stage8
	k_proj_3_5 -> ring_attn_3_6_stage8 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_3_5 -> ring_attn_3_6_stage8 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_3_13_stage8 -> ring_attn_3_13_stage9
	k_proj_3_4 -> ring_attn_3_5_stage9 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_3_4 -> ring_attn_3_5_stage9 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_3_13_stage9 -> ring_attn_3_13_stage10
	k_proj_3_3 -> ring_attn_3_4_stage10 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_3_3 -> ring_attn_3_4_stage10 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_3_13_stage10 -> ring_attn_3_13_stage11
	k_proj_3_2 -> ring_attn_3_3_stage11 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_3_2 -> ring_attn_3_3_stage11 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_3_13_stage11 -> ring_attn_3_13_stage12
	k_proj_3_1 -> ring_attn_3_2_stage12 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_3_1 -> ring_attn_3_2_stage12 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_3_13_stage12 -> ring_attn_3_13_stage13
	k_proj_3_0 -> ring_attn_3_1_stage13 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_3_0 -> ring_attn_3_1_stage13 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_3_13_stage13 -> ring_attn_3_13_stage14
	k_proj_3_15 -> ring_attn_3_0_stage14 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_3_15 -> ring_attn_3_0_stage14 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_3_13_stage14 -> ring_attn_3_13_stage15
	k_proj_3_14 -> ring_attn_3_15_stage15 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_3_14 -> ring_attn_3_15_stage15 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_3_13_stage15 -> o_proj_3_13
	o_proj_3_13 -> residual1_3_13
	ln1_3_13 -> residual1_3_13 [style=dotted]
	residual1_3_13 -> ln2_3_13
	ln2_3_13 -> router_3_13
	router_3_13 -> gate_3_13
	gate_3_13 -> expert_agg_3_13
	ln2_3_13 -> expert_3_13_0
	expert_3_13_0 -> expert_agg_3_13
	gate_3_13 -> expert_3_13_0 [label="gate weight" style=dotted]
	ln2_3_13 -> expert_3_13_1
	expert_3_13_1 -> expert_agg_3_13
	gate_3_13 -> expert_3_13_1 [label="gate weight" style=dotted]
	ln2_3_13 -> expert_3_13_2
	expert_3_13_2 -> expert_agg_3_13
	gate_3_13 -> expert_3_13_2 [label="gate weight" style=dotted]
	ln2_3_13 -> expert_3_13_3
	expert_3_13_3 -> expert_agg_3_13
	gate_3_13 -> expert_3_13_3 [label="gate weight" style=dotted]
	ln2_3_13 -> expert_3_13_4
	expert_3_13_4 -> expert_agg_3_13
	gate_3_13 -> expert_3_13_4 [label="gate weight" style=dotted]
	ln2_3_13 -> expert_3_13_5
	expert_3_13_5 -> expert_agg_3_13
	gate_3_13 -> expert_3_13_5 [label="gate weight" style=dotted]
	ln2_3_13 -> expert_3_13_6
	expert_3_13_6 -> expert_agg_3_13
	gate_3_13 -> expert_3_13_6 [label="gate weight" style=dotted]
	ln2_3_13 -> expert_3_13_7
	expert_3_13_7 -> expert_agg_3_13
	gate_3_13 -> expert_3_13_7 [label="gate weight" style=dotted]
	expert_agg_3_13 -> residual2_3_13
	ln2_3_13 -> residual2_3_13 [style=dotted]
	ln1_3_14 -> q_proj_3_14
	ln1_3_14 -> k_proj_3_14
	ln1_3_14 -> v_proj_3_14
	q_proj_3_14 -> ring_attn_3_14_stage0
	k_proj_3_14 -> ring_attn_3_14_stage0
	v_proj_3_14 -> ring_attn_3_14_stage0
	ring_attn_3_14_stage0 -> ring_attn_3_14_stage1
	k_proj_3_13 -> ring_attn_3_14_stage1 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_3_13 -> ring_attn_3_14_stage1 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_3_14_stage1 -> ring_attn_3_14_stage2
	k_proj_3_12 -> ring_attn_3_13_stage2 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_3_12 -> ring_attn_3_13_stage2 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_3_14_stage2 -> ring_attn_3_14_stage3
	k_proj_3_11 -> ring_attn_3_12_stage3 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_3_11 -> ring_attn_3_12_stage3 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_3_14_stage3 -> ring_attn_3_14_stage4
	k_proj_3_10 -> ring_attn_3_11_stage4 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_3_10 -> ring_attn_3_11_stage4 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_3_14_stage4 -> ring_attn_3_14_stage5
	k_proj_3_9 -> ring_attn_3_10_stage5 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_3_9 -> ring_attn_3_10_stage5 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_3_14_stage5 -> ring_attn_3_14_stage6
	k_proj_3_8 -> ring_attn_3_9_stage6 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_3_8 -> ring_attn_3_9_stage6 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_3_14_stage6 -> ring_attn_3_14_stage7
	k_proj_3_7 -> ring_attn_3_8_stage7 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_3_7 -> ring_attn_3_8_stage7 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_3_14_stage7 -> ring_attn_3_14_stage8
	k_proj_3_6 -> ring_attn_3_7_stage8 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_3_6 -> ring_attn_3_7_stage8 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_3_14_stage8 -> ring_attn_3_14_stage9
	k_proj_3_5 -> ring_attn_3_6_stage9 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_3_5 -> ring_attn_3_6_stage9 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_3_14_stage9 -> ring_attn_3_14_stage10
	k_proj_3_4 -> ring_attn_3_5_stage10 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_3_4 -> ring_attn_3_5_stage10 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_3_14_stage10 -> ring_attn_3_14_stage11
	k_proj_3_3 -> ring_attn_3_4_stage11 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_3_3 -> ring_attn_3_4_stage11 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_3_14_stage11 -> ring_attn_3_14_stage12
	k_proj_3_2 -> ring_attn_3_3_stage12 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_3_2 -> ring_attn_3_3_stage12 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_3_14_stage12 -> ring_attn_3_14_stage13
	k_proj_3_1 -> ring_attn_3_2_stage13 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_3_1 -> ring_attn_3_2_stage13 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_3_14_stage13 -> ring_attn_3_14_stage14
	k_proj_3_0 -> ring_attn_3_1_stage14 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_3_0 -> ring_attn_3_1_stage14 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_3_14_stage14 -> ring_attn_3_14_stage15
	k_proj_3_15 -> ring_attn_3_0_stage15 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_3_15 -> ring_attn_3_0_stage15 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_3_14_stage15 -> o_proj_3_14
	o_proj_3_14 -> residual1_3_14
	ln1_3_14 -> residual1_3_14 [style=dotted]
	residual1_3_14 -> ln2_3_14
	ln2_3_14 -> router_3_14
	router_3_14 -> gate_3_14
	gate_3_14 -> expert_agg_3_14
	ln2_3_14 -> expert_3_14_0
	expert_3_14_0 -> expert_agg_3_14
	gate_3_14 -> expert_3_14_0 [label="gate weight" style=dotted]
	ln2_3_14 -> expert_3_14_1
	expert_3_14_1 -> expert_agg_3_14
	gate_3_14 -> expert_3_14_1 [label="gate weight" style=dotted]
	ln2_3_14 -> expert_3_14_2
	expert_3_14_2 -> expert_agg_3_14
	gate_3_14 -> expert_3_14_2 [label="gate weight" style=dotted]
	ln2_3_14 -> expert_3_14_3
	expert_3_14_3 -> expert_agg_3_14
	gate_3_14 -> expert_3_14_3 [label="gate weight" style=dotted]
	ln2_3_14 -> expert_3_14_4
	expert_3_14_4 -> expert_agg_3_14
	gate_3_14 -> expert_3_14_4 [label="gate weight" style=dotted]
	ln2_3_14 -> expert_3_14_5
	expert_3_14_5 -> expert_agg_3_14
	gate_3_14 -> expert_3_14_5 [label="gate weight" style=dotted]
	ln2_3_14 -> expert_3_14_6
	expert_3_14_6 -> expert_agg_3_14
	gate_3_14 -> expert_3_14_6 [label="gate weight" style=dotted]
	ln2_3_14 -> expert_3_14_7
	expert_3_14_7 -> expert_agg_3_14
	gate_3_14 -> expert_3_14_7 [label="gate weight" style=dotted]
	expert_agg_3_14 -> residual2_3_14
	ln2_3_14 -> residual2_3_14 [style=dotted]
	ln1_3_15 -> q_proj_3_15
	ln1_3_15 -> k_proj_3_15
	ln1_3_15 -> v_proj_3_15
	q_proj_3_15 -> ring_attn_3_15_stage0
	k_proj_3_15 -> ring_attn_3_15_stage0
	v_proj_3_15 -> ring_attn_3_15_stage0
	ring_attn_3_15_stage0 -> ring_attn_3_15_stage1
	k_proj_3_14 -> ring_attn_3_15_stage1 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_3_14 -> ring_attn_3_15_stage1 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_3_15_stage1 -> ring_attn_3_15_stage2
	k_proj_3_13 -> ring_attn_3_14_stage2 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_3_13 -> ring_attn_3_14_stage2 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_3_15_stage2 -> ring_attn_3_15_stage3
	k_proj_3_12 -> ring_attn_3_13_stage3 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_3_12 -> ring_attn_3_13_stage3 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_3_15_stage3 -> ring_attn_3_15_stage4
	k_proj_3_11 -> ring_attn_3_12_stage4 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_3_11 -> ring_attn_3_12_stage4 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_3_15_stage4 -> ring_attn_3_15_stage5
	k_proj_3_10 -> ring_attn_3_11_stage5 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_3_10 -> ring_attn_3_11_stage5 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_3_15_stage5 -> ring_attn_3_15_stage6
	k_proj_3_9 -> ring_attn_3_10_stage6 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_3_9 -> ring_attn_3_10_stage6 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_3_15_stage6 -> ring_attn_3_15_stage7
	k_proj_3_8 -> ring_attn_3_9_stage7 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_3_8 -> ring_attn_3_9_stage7 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_3_15_stage7 -> ring_attn_3_15_stage8
	k_proj_3_7 -> ring_attn_3_8_stage8 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_3_7 -> ring_attn_3_8_stage8 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_3_15_stage8 -> ring_attn_3_15_stage9
	k_proj_3_6 -> ring_attn_3_7_stage9 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_3_6 -> ring_attn_3_7_stage9 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_3_15_stage9 -> ring_attn_3_15_stage10
	k_proj_3_5 -> ring_attn_3_6_stage10 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_3_5 -> ring_attn_3_6_stage10 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_3_15_stage10 -> ring_attn_3_15_stage11
	k_proj_3_4 -> ring_attn_3_5_stage11 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_3_4 -> ring_attn_3_5_stage11 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_3_15_stage11 -> ring_attn_3_15_stage12
	k_proj_3_3 -> ring_attn_3_4_stage12 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_3_3 -> ring_attn_3_4_stage12 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_3_15_stage12 -> ring_attn_3_15_stage13
	k_proj_3_2 -> ring_attn_3_3_stage13 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_3_2 -> ring_attn_3_3_stage13 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_3_15_stage13 -> ring_attn_3_15_stage14
	k_proj_3_1 -> ring_attn_3_2_stage14 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_3_1 -> ring_attn_3_2_stage14 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_3_15_stage14 -> ring_attn_3_15_stage15
	k_proj_3_0 -> ring_attn_3_1_stage15 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_3_0 -> ring_attn_3_1_stage15 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_3_15_stage15 -> o_proj_3_15
	o_proj_3_15 -> residual1_3_15
	ln1_3_15 -> residual1_3_15 [style=dotted]
	residual1_3_15 -> ln2_3_15
	ln2_3_15 -> router_3_15
	router_3_15 -> gate_3_15
	gate_3_15 -> expert_agg_3_15
	ln2_3_15 -> expert_3_15_0
	expert_3_15_0 -> expert_agg_3_15
	gate_3_15 -> expert_3_15_0 [label="gate weight" style=dotted]
	ln2_3_15 -> expert_3_15_1
	expert_3_15_1 -> expert_agg_3_15
	gate_3_15 -> expert_3_15_1 [label="gate weight" style=dotted]
	ln2_3_15 -> expert_3_15_2
	expert_3_15_2 -> expert_agg_3_15
	gate_3_15 -> expert_3_15_2 [label="gate weight" style=dotted]
	ln2_3_15 -> expert_3_15_3
	expert_3_15_3 -> expert_agg_3_15
	gate_3_15 -> expert_3_15_3 [label="gate weight" style=dotted]
	ln2_3_15 -> expert_3_15_4
	expert_3_15_4 -> expert_agg_3_15
	gate_3_15 -> expert_3_15_4 [label="gate weight" style=dotted]
	ln2_3_15 -> expert_3_15_5
	expert_3_15_5 -> expert_agg_3_15
	gate_3_15 -> expert_3_15_5 [label="gate weight" style=dotted]
	ln2_3_15 -> expert_3_15_6
	expert_3_15_6 -> expert_agg_3_15
	gate_3_15 -> expert_3_15_6 [label="gate weight" style=dotted]
	ln2_3_15 -> expert_3_15_7
	expert_3_15_7 -> expert_agg_3_15
	gate_3_15 -> expert_3_15_7 [label="gate weight" style=dotted]
	expert_agg_3_15 -> residual2_3_15
	ln2_3_15 -> residual2_3_15 [style=dotted]
	ln1_4_0 -> q_proj_4_0
	ln1_4_0 -> k_proj_4_0
	ln1_4_0 -> v_proj_4_0
	q_proj_4_0 -> ring_attn_4_0_stage0
	k_proj_4_0 -> ring_attn_4_0_stage0
	v_proj_4_0 -> ring_attn_4_0_stage0
	ring_attn_4_0_stage0 -> ring_attn_4_0_stage1
	k_proj_4_15 -> ring_attn_4_0_stage1 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_4_15 -> ring_attn_4_0_stage1 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_4_0_stage1 -> ring_attn_4_0_stage2
	k_proj_4_14 -> ring_attn_4_15_stage2 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_4_14 -> ring_attn_4_15_stage2 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_4_0_stage2 -> ring_attn_4_0_stage3
	k_proj_4_13 -> ring_attn_4_14_stage3 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_4_13 -> ring_attn_4_14_stage3 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_4_0_stage3 -> ring_attn_4_0_stage4
	k_proj_4_12 -> ring_attn_4_13_stage4 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_4_12 -> ring_attn_4_13_stage4 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_4_0_stage4 -> ring_attn_4_0_stage5
	k_proj_4_11 -> ring_attn_4_12_stage5 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_4_11 -> ring_attn_4_12_stage5 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_4_0_stage5 -> ring_attn_4_0_stage6
	k_proj_4_10 -> ring_attn_4_11_stage6 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_4_10 -> ring_attn_4_11_stage6 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_4_0_stage6 -> ring_attn_4_0_stage7
	k_proj_4_9 -> ring_attn_4_10_stage7 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_4_9 -> ring_attn_4_10_stage7 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_4_0_stage7 -> ring_attn_4_0_stage8
	k_proj_4_8 -> ring_attn_4_9_stage8 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_4_8 -> ring_attn_4_9_stage8 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_4_0_stage8 -> ring_attn_4_0_stage9
	k_proj_4_7 -> ring_attn_4_8_stage9 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_4_7 -> ring_attn_4_8_stage9 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_4_0_stage9 -> ring_attn_4_0_stage10
	k_proj_4_6 -> ring_attn_4_7_stage10 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_4_6 -> ring_attn_4_7_stage10 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_4_0_stage10 -> ring_attn_4_0_stage11
	k_proj_4_5 -> ring_attn_4_6_stage11 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_4_5 -> ring_attn_4_6_stage11 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_4_0_stage11 -> ring_attn_4_0_stage12
	k_proj_4_4 -> ring_attn_4_5_stage12 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_4_4 -> ring_attn_4_5_stage12 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_4_0_stage12 -> ring_attn_4_0_stage13
	k_proj_4_3 -> ring_attn_4_4_stage13 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_4_3 -> ring_attn_4_4_stage13 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_4_0_stage13 -> ring_attn_4_0_stage14
	k_proj_4_2 -> ring_attn_4_3_stage14 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_4_2 -> ring_attn_4_3_stage14 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_4_0_stage14 -> ring_attn_4_0_stage15
	k_proj_4_1 -> ring_attn_4_2_stage15 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_4_1 -> ring_attn_4_2_stage15 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_4_0_stage15 -> o_proj_4_0
	o_proj_4_0 -> residual1_4_0
	ln1_4_0 -> residual1_4_0 [style=dotted]
	residual1_4_0 -> ln2_4_0
	ln2_4_0 -> router_4_0
	router_4_0 -> gate_4_0
	gate_4_0 -> expert_agg_4_0
	ln2_4_0 -> expert_4_0_0
	expert_4_0_0 -> expert_agg_4_0
	gate_4_0 -> expert_4_0_0 [label="gate weight" style=dotted]
	ln2_4_0 -> expert_4_0_1
	expert_4_0_1 -> expert_agg_4_0
	gate_4_0 -> expert_4_0_1 [label="gate weight" style=dotted]
	ln2_4_0 -> expert_4_0_2
	expert_4_0_2 -> expert_agg_4_0
	gate_4_0 -> expert_4_0_2 [label="gate weight" style=dotted]
	ln2_4_0 -> expert_4_0_3
	expert_4_0_3 -> expert_agg_4_0
	gate_4_0 -> expert_4_0_3 [label="gate weight" style=dotted]
	ln2_4_0 -> expert_4_0_4
	expert_4_0_4 -> expert_agg_4_0
	gate_4_0 -> expert_4_0_4 [label="gate weight" style=dotted]
	ln2_4_0 -> expert_4_0_5
	expert_4_0_5 -> expert_agg_4_0
	gate_4_0 -> expert_4_0_5 [label="gate weight" style=dotted]
	ln2_4_0 -> expert_4_0_6
	expert_4_0_6 -> expert_agg_4_0
	gate_4_0 -> expert_4_0_6 [label="gate weight" style=dotted]
	ln2_4_0 -> expert_4_0_7
	expert_4_0_7 -> expert_agg_4_0
	gate_4_0 -> expert_4_0_7 [label="gate weight" style=dotted]
	expert_agg_4_0 -> residual2_4_0
	ln2_4_0 -> residual2_4_0 [style=dotted]
	ln1_4_1 -> q_proj_4_1
	ln1_4_1 -> k_proj_4_1
	ln1_4_1 -> v_proj_4_1
	q_proj_4_1 -> ring_attn_4_1_stage0
	k_proj_4_1 -> ring_attn_4_1_stage0
	v_proj_4_1 -> ring_attn_4_1_stage0
	ring_attn_4_1_stage0 -> ring_attn_4_1_stage1
	k_proj_4_0 -> ring_attn_4_1_stage1 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_4_0 -> ring_attn_4_1_stage1 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_4_1_stage1 -> ring_attn_4_1_stage2
	k_proj_4_15 -> ring_attn_4_0_stage2 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_4_15 -> ring_attn_4_0_stage2 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_4_1_stage2 -> ring_attn_4_1_stage3
	k_proj_4_14 -> ring_attn_4_15_stage3 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_4_14 -> ring_attn_4_15_stage3 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_4_1_stage3 -> ring_attn_4_1_stage4
	k_proj_4_13 -> ring_attn_4_14_stage4 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_4_13 -> ring_attn_4_14_stage4 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_4_1_stage4 -> ring_attn_4_1_stage5
	k_proj_4_12 -> ring_attn_4_13_stage5 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_4_12 -> ring_attn_4_13_stage5 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_4_1_stage5 -> ring_attn_4_1_stage6
	k_proj_4_11 -> ring_attn_4_12_stage6 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_4_11 -> ring_attn_4_12_stage6 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_4_1_stage6 -> ring_attn_4_1_stage7
	k_proj_4_10 -> ring_attn_4_11_stage7 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_4_10 -> ring_attn_4_11_stage7 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_4_1_stage7 -> ring_attn_4_1_stage8
	k_proj_4_9 -> ring_attn_4_10_stage8 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_4_9 -> ring_attn_4_10_stage8 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_4_1_stage8 -> ring_attn_4_1_stage9
	k_proj_4_8 -> ring_attn_4_9_stage9 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_4_8 -> ring_attn_4_9_stage9 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_4_1_stage9 -> ring_attn_4_1_stage10
	k_proj_4_7 -> ring_attn_4_8_stage10 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_4_7 -> ring_attn_4_8_stage10 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_4_1_stage10 -> ring_attn_4_1_stage11
	k_proj_4_6 -> ring_attn_4_7_stage11 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_4_6 -> ring_attn_4_7_stage11 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_4_1_stage11 -> ring_attn_4_1_stage12
	k_proj_4_5 -> ring_attn_4_6_stage12 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_4_5 -> ring_attn_4_6_stage12 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_4_1_stage12 -> ring_attn_4_1_stage13
	k_proj_4_4 -> ring_attn_4_5_stage13 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_4_4 -> ring_attn_4_5_stage13 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_4_1_stage13 -> ring_attn_4_1_stage14
	k_proj_4_3 -> ring_attn_4_4_stage14 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_4_3 -> ring_attn_4_4_stage14 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_4_1_stage14 -> ring_attn_4_1_stage15
	k_proj_4_2 -> ring_attn_4_3_stage15 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_4_2 -> ring_attn_4_3_stage15 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_4_1_stage15 -> o_proj_4_1
	o_proj_4_1 -> residual1_4_1
	ln1_4_1 -> residual1_4_1 [style=dotted]
	residual1_4_1 -> ln2_4_1
	ln2_4_1 -> router_4_1
	router_4_1 -> gate_4_1
	gate_4_1 -> expert_agg_4_1
	ln2_4_1 -> expert_4_1_0
	expert_4_1_0 -> expert_agg_4_1
	gate_4_1 -> expert_4_1_0 [label="gate weight" style=dotted]
	ln2_4_1 -> expert_4_1_1
	expert_4_1_1 -> expert_agg_4_1
	gate_4_1 -> expert_4_1_1 [label="gate weight" style=dotted]
	ln2_4_1 -> expert_4_1_2
	expert_4_1_2 -> expert_agg_4_1
	gate_4_1 -> expert_4_1_2 [label="gate weight" style=dotted]
	ln2_4_1 -> expert_4_1_3
	expert_4_1_3 -> expert_agg_4_1
	gate_4_1 -> expert_4_1_3 [label="gate weight" style=dotted]
	ln2_4_1 -> expert_4_1_4
	expert_4_1_4 -> expert_agg_4_1
	gate_4_1 -> expert_4_1_4 [label="gate weight" style=dotted]
	ln2_4_1 -> expert_4_1_5
	expert_4_1_5 -> expert_agg_4_1
	gate_4_1 -> expert_4_1_5 [label="gate weight" style=dotted]
	ln2_4_1 -> expert_4_1_6
	expert_4_1_6 -> expert_agg_4_1
	gate_4_1 -> expert_4_1_6 [label="gate weight" style=dotted]
	ln2_4_1 -> expert_4_1_7
	expert_4_1_7 -> expert_agg_4_1
	gate_4_1 -> expert_4_1_7 [label="gate weight" style=dotted]
	expert_agg_4_1 -> residual2_4_1
	ln2_4_1 -> residual2_4_1 [style=dotted]
	ln1_4_2 -> q_proj_4_2
	ln1_4_2 -> k_proj_4_2
	ln1_4_2 -> v_proj_4_2
	q_proj_4_2 -> ring_attn_4_2_stage0
	k_proj_4_2 -> ring_attn_4_2_stage0
	v_proj_4_2 -> ring_attn_4_2_stage0
	ring_attn_4_2_stage0 -> ring_attn_4_2_stage1
	k_proj_4_1 -> ring_attn_4_2_stage1 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_4_1 -> ring_attn_4_2_stage1 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_4_2_stage1 -> ring_attn_4_2_stage2
	k_proj_4_0 -> ring_attn_4_1_stage2 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_4_0 -> ring_attn_4_1_stage2 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_4_2_stage2 -> ring_attn_4_2_stage3
	k_proj_4_15 -> ring_attn_4_0_stage3 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_4_15 -> ring_attn_4_0_stage3 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_4_2_stage3 -> ring_attn_4_2_stage4
	k_proj_4_14 -> ring_attn_4_15_stage4 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_4_14 -> ring_attn_4_15_stage4 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_4_2_stage4 -> ring_attn_4_2_stage5
	k_proj_4_13 -> ring_attn_4_14_stage5 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_4_13 -> ring_attn_4_14_stage5 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_4_2_stage5 -> ring_attn_4_2_stage6
	k_proj_4_12 -> ring_attn_4_13_stage6 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_4_12 -> ring_attn_4_13_stage6 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_4_2_stage6 -> ring_attn_4_2_stage7
	k_proj_4_11 -> ring_attn_4_12_stage7 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_4_11 -> ring_attn_4_12_stage7 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_4_2_stage7 -> ring_attn_4_2_stage8
	k_proj_4_10 -> ring_attn_4_11_stage8 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_4_10 -> ring_attn_4_11_stage8 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_4_2_stage8 -> ring_attn_4_2_stage9
	k_proj_4_9 -> ring_attn_4_10_stage9 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_4_9 -> ring_attn_4_10_stage9 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_4_2_stage9 -> ring_attn_4_2_stage10
	k_proj_4_8 -> ring_attn_4_9_stage10 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_4_8 -> ring_attn_4_9_stage10 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_4_2_stage10 -> ring_attn_4_2_stage11
	k_proj_4_7 -> ring_attn_4_8_stage11 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_4_7 -> ring_attn_4_8_stage11 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_4_2_stage11 -> ring_attn_4_2_stage12
	k_proj_4_6 -> ring_attn_4_7_stage12 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_4_6 -> ring_attn_4_7_stage12 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_4_2_stage12 -> ring_attn_4_2_stage13
	k_proj_4_5 -> ring_attn_4_6_stage13 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_4_5 -> ring_attn_4_6_stage13 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_4_2_stage13 -> ring_attn_4_2_stage14
	k_proj_4_4 -> ring_attn_4_5_stage14 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_4_4 -> ring_attn_4_5_stage14 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_4_2_stage14 -> ring_attn_4_2_stage15
	k_proj_4_3 -> ring_attn_4_4_stage15 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_4_3 -> ring_attn_4_4_stage15 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_4_2_stage15 -> o_proj_4_2
	o_proj_4_2 -> residual1_4_2
	ln1_4_2 -> residual1_4_2 [style=dotted]
	residual1_4_2 -> ln2_4_2
	ln2_4_2 -> router_4_2
	router_4_2 -> gate_4_2
	gate_4_2 -> expert_agg_4_2
	ln2_4_2 -> expert_4_2_0
	expert_4_2_0 -> expert_agg_4_2
	gate_4_2 -> expert_4_2_0 [label="gate weight" style=dotted]
	ln2_4_2 -> expert_4_2_1
	expert_4_2_1 -> expert_agg_4_2
	gate_4_2 -> expert_4_2_1 [label="gate weight" style=dotted]
	ln2_4_2 -> expert_4_2_2
	expert_4_2_2 -> expert_agg_4_2
	gate_4_2 -> expert_4_2_2 [label="gate weight" style=dotted]
	ln2_4_2 -> expert_4_2_3
	expert_4_2_3 -> expert_agg_4_2
	gate_4_2 -> expert_4_2_3 [label="gate weight" style=dotted]
	ln2_4_2 -> expert_4_2_4
	expert_4_2_4 -> expert_agg_4_2
	gate_4_2 -> expert_4_2_4 [label="gate weight" style=dotted]
	ln2_4_2 -> expert_4_2_5
	expert_4_2_5 -> expert_agg_4_2
	gate_4_2 -> expert_4_2_5 [label="gate weight" style=dotted]
	ln2_4_2 -> expert_4_2_6
	expert_4_2_6 -> expert_agg_4_2
	gate_4_2 -> expert_4_2_6 [label="gate weight" style=dotted]
	ln2_4_2 -> expert_4_2_7
	expert_4_2_7 -> expert_agg_4_2
	gate_4_2 -> expert_4_2_7 [label="gate weight" style=dotted]
	expert_agg_4_2 -> residual2_4_2
	ln2_4_2 -> residual2_4_2 [style=dotted]
	ln1_4_3 -> q_proj_4_3
	ln1_4_3 -> k_proj_4_3
	ln1_4_3 -> v_proj_4_3
	q_proj_4_3 -> ring_attn_4_3_stage0
	k_proj_4_3 -> ring_attn_4_3_stage0
	v_proj_4_3 -> ring_attn_4_3_stage0
	ring_attn_4_3_stage0 -> ring_attn_4_3_stage1
	k_proj_4_2 -> ring_attn_4_3_stage1 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_4_2 -> ring_attn_4_3_stage1 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_4_3_stage1 -> ring_attn_4_3_stage2
	k_proj_4_1 -> ring_attn_4_2_stage2 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_4_1 -> ring_attn_4_2_stage2 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_4_3_stage2 -> ring_attn_4_3_stage3
	k_proj_4_0 -> ring_attn_4_1_stage3 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_4_0 -> ring_attn_4_1_stage3 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_4_3_stage3 -> ring_attn_4_3_stage4
	k_proj_4_15 -> ring_attn_4_0_stage4 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_4_15 -> ring_attn_4_0_stage4 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_4_3_stage4 -> ring_attn_4_3_stage5
	k_proj_4_14 -> ring_attn_4_15_stage5 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_4_14 -> ring_attn_4_15_stage5 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_4_3_stage5 -> ring_attn_4_3_stage6
	k_proj_4_13 -> ring_attn_4_14_stage6 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_4_13 -> ring_attn_4_14_stage6 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_4_3_stage6 -> ring_attn_4_3_stage7
	k_proj_4_12 -> ring_attn_4_13_stage7 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_4_12 -> ring_attn_4_13_stage7 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_4_3_stage7 -> ring_attn_4_3_stage8
	k_proj_4_11 -> ring_attn_4_12_stage8 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_4_11 -> ring_attn_4_12_stage8 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_4_3_stage8 -> ring_attn_4_3_stage9
	k_proj_4_10 -> ring_attn_4_11_stage9 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_4_10 -> ring_attn_4_11_stage9 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_4_3_stage9 -> ring_attn_4_3_stage10
	k_proj_4_9 -> ring_attn_4_10_stage10 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_4_9 -> ring_attn_4_10_stage10 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_4_3_stage10 -> ring_attn_4_3_stage11
	k_proj_4_8 -> ring_attn_4_9_stage11 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_4_8 -> ring_attn_4_9_stage11 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_4_3_stage11 -> ring_attn_4_3_stage12
	k_proj_4_7 -> ring_attn_4_8_stage12 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_4_7 -> ring_attn_4_8_stage12 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_4_3_stage12 -> ring_attn_4_3_stage13
	k_proj_4_6 -> ring_attn_4_7_stage13 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_4_6 -> ring_attn_4_7_stage13 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_4_3_stage13 -> ring_attn_4_3_stage14
	k_proj_4_5 -> ring_attn_4_6_stage14 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_4_5 -> ring_attn_4_6_stage14 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_4_3_stage14 -> ring_attn_4_3_stage15
	k_proj_4_4 -> ring_attn_4_5_stage15 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_4_4 -> ring_attn_4_5_stage15 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_4_3_stage15 -> o_proj_4_3
	o_proj_4_3 -> residual1_4_3
	ln1_4_3 -> residual1_4_3 [style=dotted]
	residual1_4_3 -> ln2_4_3
	ln2_4_3 -> router_4_3
	router_4_3 -> gate_4_3
	gate_4_3 -> expert_agg_4_3
	ln2_4_3 -> expert_4_3_0
	expert_4_3_0 -> expert_agg_4_3
	gate_4_3 -> expert_4_3_0 [label="gate weight" style=dotted]
	ln2_4_3 -> expert_4_3_1
	expert_4_3_1 -> expert_agg_4_3
	gate_4_3 -> expert_4_3_1 [label="gate weight" style=dotted]
	ln2_4_3 -> expert_4_3_2
	expert_4_3_2 -> expert_agg_4_3
	gate_4_3 -> expert_4_3_2 [label="gate weight" style=dotted]
	ln2_4_3 -> expert_4_3_3
	expert_4_3_3 -> expert_agg_4_3
	gate_4_3 -> expert_4_3_3 [label="gate weight" style=dotted]
	ln2_4_3 -> expert_4_3_4
	expert_4_3_4 -> expert_agg_4_3
	gate_4_3 -> expert_4_3_4 [label="gate weight" style=dotted]
	ln2_4_3 -> expert_4_3_5
	expert_4_3_5 -> expert_agg_4_3
	gate_4_3 -> expert_4_3_5 [label="gate weight" style=dotted]
	ln2_4_3 -> expert_4_3_6
	expert_4_3_6 -> expert_agg_4_3
	gate_4_3 -> expert_4_3_6 [label="gate weight" style=dotted]
	ln2_4_3 -> expert_4_3_7
	expert_4_3_7 -> expert_agg_4_3
	gate_4_3 -> expert_4_3_7 [label="gate weight" style=dotted]
	expert_agg_4_3 -> residual2_4_3
	ln2_4_3 -> residual2_4_3 [style=dotted]
	ln1_4_4 -> q_proj_4_4
	ln1_4_4 -> k_proj_4_4
	ln1_4_4 -> v_proj_4_4
	q_proj_4_4 -> ring_attn_4_4_stage0
	k_proj_4_4 -> ring_attn_4_4_stage0
	v_proj_4_4 -> ring_attn_4_4_stage0
	ring_attn_4_4_stage0 -> ring_attn_4_4_stage1
	k_proj_4_3 -> ring_attn_4_4_stage1 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_4_3 -> ring_attn_4_4_stage1 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_4_4_stage1 -> ring_attn_4_4_stage2
	k_proj_4_2 -> ring_attn_4_3_stage2 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_4_2 -> ring_attn_4_3_stage2 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_4_4_stage2 -> ring_attn_4_4_stage3
	k_proj_4_1 -> ring_attn_4_2_stage3 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_4_1 -> ring_attn_4_2_stage3 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_4_4_stage3 -> ring_attn_4_4_stage4
	k_proj_4_0 -> ring_attn_4_1_stage4 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_4_0 -> ring_attn_4_1_stage4 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_4_4_stage4 -> ring_attn_4_4_stage5
	k_proj_4_15 -> ring_attn_4_0_stage5 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_4_15 -> ring_attn_4_0_stage5 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_4_4_stage5 -> ring_attn_4_4_stage6
	k_proj_4_14 -> ring_attn_4_15_stage6 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_4_14 -> ring_attn_4_15_stage6 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_4_4_stage6 -> ring_attn_4_4_stage7
	k_proj_4_13 -> ring_attn_4_14_stage7 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_4_13 -> ring_attn_4_14_stage7 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_4_4_stage7 -> ring_attn_4_4_stage8
	k_proj_4_12 -> ring_attn_4_13_stage8 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_4_12 -> ring_attn_4_13_stage8 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_4_4_stage8 -> ring_attn_4_4_stage9
	k_proj_4_11 -> ring_attn_4_12_stage9 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_4_11 -> ring_attn_4_12_stage9 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_4_4_stage9 -> ring_attn_4_4_stage10
	k_proj_4_10 -> ring_attn_4_11_stage10 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_4_10 -> ring_attn_4_11_stage10 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_4_4_stage10 -> ring_attn_4_4_stage11
	k_proj_4_9 -> ring_attn_4_10_stage11 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_4_9 -> ring_attn_4_10_stage11 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_4_4_stage11 -> ring_attn_4_4_stage12
	k_proj_4_8 -> ring_attn_4_9_stage12 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_4_8 -> ring_attn_4_9_stage12 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_4_4_stage12 -> ring_attn_4_4_stage13
	k_proj_4_7 -> ring_attn_4_8_stage13 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_4_7 -> ring_attn_4_8_stage13 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_4_4_stage13 -> ring_attn_4_4_stage14
	k_proj_4_6 -> ring_attn_4_7_stage14 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_4_6 -> ring_attn_4_7_stage14 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_4_4_stage14 -> ring_attn_4_4_stage15
	k_proj_4_5 -> ring_attn_4_6_stage15 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_4_5 -> ring_attn_4_6_stage15 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_4_4_stage15 -> o_proj_4_4
	o_proj_4_4 -> residual1_4_4
	ln1_4_4 -> residual1_4_4 [style=dotted]
	residual1_4_4 -> ln2_4_4
	ln2_4_4 -> router_4_4
	router_4_4 -> gate_4_4
	gate_4_4 -> expert_agg_4_4
	ln2_4_4 -> expert_4_4_0
	expert_4_4_0 -> expert_agg_4_4
	gate_4_4 -> expert_4_4_0 [label="gate weight" style=dotted]
	ln2_4_4 -> expert_4_4_1
	expert_4_4_1 -> expert_agg_4_4
	gate_4_4 -> expert_4_4_1 [label="gate weight" style=dotted]
	ln2_4_4 -> expert_4_4_2
	expert_4_4_2 -> expert_agg_4_4
	gate_4_4 -> expert_4_4_2 [label="gate weight" style=dotted]
	ln2_4_4 -> expert_4_4_3
	expert_4_4_3 -> expert_agg_4_4
	gate_4_4 -> expert_4_4_3 [label="gate weight" style=dotted]
	ln2_4_4 -> expert_4_4_4
	expert_4_4_4 -> expert_agg_4_4
	gate_4_4 -> expert_4_4_4 [label="gate weight" style=dotted]
	ln2_4_4 -> expert_4_4_5
	expert_4_4_5 -> expert_agg_4_4
	gate_4_4 -> expert_4_4_5 [label="gate weight" style=dotted]
	ln2_4_4 -> expert_4_4_6
	expert_4_4_6 -> expert_agg_4_4
	gate_4_4 -> expert_4_4_6 [label="gate weight" style=dotted]
	ln2_4_4 -> expert_4_4_7
	expert_4_4_7 -> expert_agg_4_4
	gate_4_4 -> expert_4_4_7 [label="gate weight" style=dotted]
	expert_agg_4_4 -> residual2_4_4
	ln2_4_4 -> residual2_4_4 [style=dotted]
	ln1_4_5 -> q_proj_4_5
	ln1_4_5 -> k_proj_4_5
	ln1_4_5 -> v_proj_4_5
	q_proj_4_5 -> ring_attn_4_5_stage0
	k_proj_4_5 -> ring_attn_4_5_stage0
	v_proj_4_5 -> ring_attn_4_5_stage0
	ring_attn_4_5_stage0 -> ring_attn_4_5_stage1
	k_proj_4_4 -> ring_attn_4_5_stage1 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_4_4 -> ring_attn_4_5_stage1 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_4_5_stage1 -> ring_attn_4_5_stage2
	k_proj_4_3 -> ring_attn_4_4_stage2 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_4_3 -> ring_attn_4_4_stage2 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_4_5_stage2 -> ring_attn_4_5_stage3
	k_proj_4_2 -> ring_attn_4_3_stage3 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_4_2 -> ring_attn_4_3_stage3 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_4_5_stage3 -> ring_attn_4_5_stage4
	k_proj_4_1 -> ring_attn_4_2_stage4 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_4_1 -> ring_attn_4_2_stage4 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_4_5_stage4 -> ring_attn_4_5_stage5
	k_proj_4_0 -> ring_attn_4_1_stage5 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_4_0 -> ring_attn_4_1_stage5 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_4_5_stage5 -> ring_attn_4_5_stage6
	k_proj_4_15 -> ring_attn_4_0_stage6 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_4_15 -> ring_attn_4_0_stage6 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_4_5_stage6 -> ring_attn_4_5_stage7
	k_proj_4_14 -> ring_attn_4_15_stage7 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_4_14 -> ring_attn_4_15_stage7 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_4_5_stage7 -> ring_attn_4_5_stage8
	k_proj_4_13 -> ring_attn_4_14_stage8 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_4_13 -> ring_attn_4_14_stage8 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_4_5_stage8 -> ring_attn_4_5_stage9
	k_proj_4_12 -> ring_attn_4_13_stage9 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_4_12 -> ring_attn_4_13_stage9 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_4_5_stage9 -> ring_attn_4_5_stage10
	k_proj_4_11 -> ring_attn_4_12_stage10 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_4_11 -> ring_attn_4_12_stage10 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_4_5_stage10 -> ring_attn_4_5_stage11
	k_proj_4_10 -> ring_attn_4_11_stage11 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_4_10 -> ring_attn_4_11_stage11 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_4_5_stage11 -> ring_attn_4_5_stage12
	k_proj_4_9 -> ring_attn_4_10_stage12 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_4_9 -> ring_attn_4_10_stage12 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_4_5_stage12 -> ring_attn_4_5_stage13
	k_proj_4_8 -> ring_attn_4_9_stage13 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_4_8 -> ring_attn_4_9_stage13 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_4_5_stage13 -> ring_attn_4_5_stage14
	k_proj_4_7 -> ring_attn_4_8_stage14 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_4_7 -> ring_attn_4_8_stage14 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_4_5_stage14 -> ring_attn_4_5_stage15
	k_proj_4_6 -> ring_attn_4_7_stage15 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_4_6 -> ring_attn_4_7_stage15 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_4_5_stage15 -> o_proj_4_5
	o_proj_4_5 -> residual1_4_5
	ln1_4_5 -> residual1_4_5 [style=dotted]
	residual1_4_5 -> ln2_4_5
	ln2_4_5 -> router_4_5
	router_4_5 -> gate_4_5
	gate_4_5 -> expert_agg_4_5
	ln2_4_5 -> expert_4_5_0
	expert_4_5_0 -> expert_agg_4_5
	gate_4_5 -> expert_4_5_0 [label="gate weight" style=dotted]
	ln2_4_5 -> expert_4_5_1
	expert_4_5_1 -> expert_agg_4_5
	gate_4_5 -> expert_4_5_1 [label="gate weight" style=dotted]
	ln2_4_5 -> expert_4_5_2
	expert_4_5_2 -> expert_agg_4_5
	gate_4_5 -> expert_4_5_2 [label="gate weight" style=dotted]
	ln2_4_5 -> expert_4_5_3
	expert_4_5_3 -> expert_agg_4_5
	gate_4_5 -> expert_4_5_3 [label="gate weight" style=dotted]
	ln2_4_5 -> expert_4_5_4
	expert_4_5_4 -> expert_agg_4_5
	gate_4_5 -> expert_4_5_4 [label="gate weight" style=dotted]
	ln2_4_5 -> expert_4_5_5
	expert_4_5_5 -> expert_agg_4_5
	gate_4_5 -> expert_4_5_5 [label="gate weight" style=dotted]
	ln2_4_5 -> expert_4_5_6
	expert_4_5_6 -> expert_agg_4_5
	gate_4_5 -> expert_4_5_6 [label="gate weight" style=dotted]
	ln2_4_5 -> expert_4_5_7
	expert_4_5_7 -> expert_agg_4_5
	gate_4_5 -> expert_4_5_7 [label="gate weight" style=dotted]
	expert_agg_4_5 -> residual2_4_5
	ln2_4_5 -> residual2_4_5 [style=dotted]
	ln1_4_6 -> q_proj_4_6
	ln1_4_6 -> k_proj_4_6
	ln1_4_6 -> v_proj_4_6
	q_proj_4_6 -> ring_attn_4_6_stage0
	k_proj_4_6 -> ring_attn_4_6_stage0
	v_proj_4_6 -> ring_attn_4_6_stage0
	ring_attn_4_6_stage0 -> ring_attn_4_6_stage1
	k_proj_4_5 -> ring_attn_4_6_stage1 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_4_5 -> ring_attn_4_6_stage1 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_4_6_stage1 -> ring_attn_4_6_stage2
	k_proj_4_4 -> ring_attn_4_5_stage2 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_4_4 -> ring_attn_4_5_stage2 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_4_6_stage2 -> ring_attn_4_6_stage3
	k_proj_4_3 -> ring_attn_4_4_stage3 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_4_3 -> ring_attn_4_4_stage3 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_4_6_stage3 -> ring_attn_4_6_stage4
	k_proj_4_2 -> ring_attn_4_3_stage4 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_4_2 -> ring_attn_4_3_stage4 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_4_6_stage4 -> ring_attn_4_6_stage5
	k_proj_4_1 -> ring_attn_4_2_stage5 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_4_1 -> ring_attn_4_2_stage5 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_4_6_stage5 -> ring_attn_4_6_stage6
	k_proj_4_0 -> ring_attn_4_1_stage6 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_4_0 -> ring_attn_4_1_stage6 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_4_6_stage6 -> ring_attn_4_6_stage7
	k_proj_4_15 -> ring_attn_4_0_stage7 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_4_15 -> ring_attn_4_0_stage7 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_4_6_stage7 -> ring_attn_4_6_stage8
	k_proj_4_14 -> ring_attn_4_15_stage8 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_4_14 -> ring_attn_4_15_stage8 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_4_6_stage8 -> ring_attn_4_6_stage9
	k_proj_4_13 -> ring_attn_4_14_stage9 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_4_13 -> ring_attn_4_14_stage9 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_4_6_stage9 -> ring_attn_4_6_stage10
	k_proj_4_12 -> ring_attn_4_13_stage10 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_4_12 -> ring_attn_4_13_stage10 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_4_6_stage10 -> ring_attn_4_6_stage11
	k_proj_4_11 -> ring_attn_4_12_stage11 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_4_11 -> ring_attn_4_12_stage11 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_4_6_stage11 -> ring_attn_4_6_stage12
	k_proj_4_10 -> ring_attn_4_11_stage12 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_4_10 -> ring_attn_4_11_stage12 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_4_6_stage12 -> ring_attn_4_6_stage13
	k_proj_4_9 -> ring_attn_4_10_stage13 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_4_9 -> ring_attn_4_10_stage13 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_4_6_stage13 -> ring_attn_4_6_stage14
	k_proj_4_8 -> ring_attn_4_9_stage14 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_4_8 -> ring_attn_4_9_stage14 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_4_6_stage14 -> ring_attn_4_6_stage15
	k_proj_4_7 -> ring_attn_4_8_stage15 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_4_7 -> ring_attn_4_8_stage15 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_4_6_stage15 -> o_proj_4_6
	o_proj_4_6 -> residual1_4_6
	ln1_4_6 -> residual1_4_6 [style=dotted]
	residual1_4_6 -> ln2_4_6
	ln2_4_6 -> router_4_6
	router_4_6 -> gate_4_6
	gate_4_6 -> expert_agg_4_6
	ln2_4_6 -> expert_4_6_0
	expert_4_6_0 -> expert_agg_4_6
	gate_4_6 -> expert_4_6_0 [label="gate weight" style=dotted]
	ln2_4_6 -> expert_4_6_1
	expert_4_6_1 -> expert_agg_4_6
	gate_4_6 -> expert_4_6_1 [label="gate weight" style=dotted]
	ln2_4_6 -> expert_4_6_2
	expert_4_6_2 -> expert_agg_4_6
	gate_4_6 -> expert_4_6_2 [label="gate weight" style=dotted]
	ln2_4_6 -> expert_4_6_3
	expert_4_6_3 -> expert_agg_4_6
	gate_4_6 -> expert_4_6_3 [label="gate weight" style=dotted]
	ln2_4_6 -> expert_4_6_4
	expert_4_6_4 -> expert_agg_4_6
	gate_4_6 -> expert_4_6_4 [label="gate weight" style=dotted]
	ln2_4_6 -> expert_4_6_5
	expert_4_6_5 -> expert_agg_4_6
	gate_4_6 -> expert_4_6_5 [label="gate weight" style=dotted]
	ln2_4_6 -> expert_4_6_6
	expert_4_6_6 -> expert_agg_4_6
	gate_4_6 -> expert_4_6_6 [label="gate weight" style=dotted]
	ln2_4_6 -> expert_4_6_7
	expert_4_6_7 -> expert_agg_4_6
	gate_4_6 -> expert_4_6_7 [label="gate weight" style=dotted]
	expert_agg_4_6 -> residual2_4_6
	ln2_4_6 -> residual2_4_6 [style=dotted]
	ln1_4_7 -> q_proj_4_7
	ln1_4_7 -> k_proj_4_7
	ln1_4_7 -> v_proj_4_7
	q_proj_4_7 -> ring_attn_4_7_stage0
	k_proj_4_7 -> ring_attn_4_7_stage0
	v_proj_4_7 -> ring_attn_4_7_stage0
	ring_attn_4_7_stage0 -> ring_attn_4_7_stage1
	k_proj_4_6 -> ring_attn_4_7_stage1 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_4_6 -> ring_attn_4_7_stage1 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_4_7_stage1 -> ring_attn_4_7_stage2
	k_proj_4_5 -> ring_attn_4_6_stage2 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_4_5 -> ring_attn_4_6_stage2 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_4_7_stage2 -> ring_attn_4_7_stage3
	k_proj_4_4 -> ring_attn_4_5_stage3 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_4_4 -> ring_attn_4_5_stage3 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_4_7_stage3 -> ring_attn_4_7_stage4
	k_proj_4_3 -> ring_attn_4_4_stage4 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_4_3 -> ring_attn_4_4_stage4 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_4_7_stage4 -> ring_attn_4_7_stage5
	k_proj_4_2 -> ring_attn_4_3_stage5 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_4_2 -> ring_attn_4_3_stage5 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_4_7_stage5 -> ring_attn_4_7_stage6
	k_proj_4_1 -> ring_attn_4_2_stage6 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_4_1 -> ring_attn_4_2_stage6 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_4_7_stage6 -> ring_attn_4_7_stage7
	k_proj_4_0 -> ring_attn_4_1_stage7 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_4_0 -> ring_attn_4_1_stage7 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_4_7_stage7 -> ring_attn_4_7_stage8
	k_proj_4_15 -> ring_attn_4_0_stage8 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_4_15 -> ring_attn_4_0_stage8 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_4_7_stage8 -> ring_attn_4_7_stage9
	k_proj_4_14 -> ring_attn_4_15_stage9 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_4_14 -> ring_attn_4_15_stage9 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_4_7_stage9 -> ring_attn_4_7_stage10
	k_proj_4_13 -> ring_attn_4_14_stage10 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_4_13 -> ring_attn_4_14_stage10 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_4_7_stage10 -> ring_attn_4_7_stage11
	k_proj_4_12 -> ring_attn_4_13_stage11 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_4_12 -> ring_attn_4_13_stage11 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_4_7_stage11 -> ring_attn_4_7_stage12
	k_proj_4_11 -> ring_attn_4_12_stage12 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_4_11 -> ring_attn_4_12_stage12 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_4_7_stage12 -> ring_attn_4_7_stage13
	k_proj_4_10 -> ring_attn_4_11_stage13 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_4_10 -> ring_attn_4_11_stage13 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_4_7_stage13 -> ring_attn_4_7_stage14
	k_proj_4_9 -> ring_attn_4_10_stage14 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_4_9 -> ring_attn_4_10_stage14 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_4_7_stage14 -> ring_attn_4_7_stage15
	k_proj_4_8 -> ring_attn_4_9_stage15 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_4_8 -> ring_attn_4_9_stage15 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_4_7_stage15 -> o_proj_4_7
	o_proj_4_7 -> residual1_4_7
	ln1_4_7 -> residual1_4_7 [style=dotted]
	residual1_4_7 -> ln2_4_7
	ln2_4_7 -> router_4_7
	router_4_7 -> gate_4_7
	gate_4_7 -> expert_agg_4_7
	ln2_4_7 -> expert_4_7_0
	expert_4_7_0 -> expert_agg_4_7
	gate_4_7 -> expert_4_7_0 [label="gate weight" style=dotted]
	ln2_4_7 -> expert_4_7_1
	expert_4_7_1 -> expert_agg_4_7
	gate_4_7 -> expert_4_7_1 [label="gate weight" style=dotted]
	ln2_4_7 -> expert_4_7_2
	expert_4_7_2 -> expert_agg_4_7
	gate_4_7 -> expert_4_7_2 [label="gate weight" style=dotted]
	ln2_4_7 -> expert_4_7_3
	expert_4_7_3 -> expert_agg_4_7
	gate_4_7 -> expert_4_7_3 [label="gate weight" style=dotted]
	ln2_4_7 -> expert_4_7_4
	expert_4_7_4 -> expert_agg_4_7
	gate_4_7 -> expert_4_7_4 [label="gate weight" style=dotted]
	ln2_4_7 -> expert_4_7_5
	expert_4_7_5 -> expert_agg_4_7
	gate_4_7 -> expert_4_7_5 [label="gate weight" style=dotted]
	ln2_4_7 -> expert_4_7_6
	expert_4_7_6 -> expert_agg_4_7
	gate_4_7 -> expert_4_7_6 [label="gate weight" style=dotted]
	ln2_4_7 -> expert_4_7_7
	expert_4_7_7 -> expert_agg_4_7
	gate_4_7 -> expert_4_7_7 [label="gate weight" style=dotted]
	expert_agg_4_7 -> residual2_4_7
	ln2_4_7 -> residual2_4_7 [style=dotted]
	ln1_4_8 -> q_proj_4_8
	ln1_4_8 -> k_proj_4_8
	ln1_4_8 -> v_proj_4_8
	q_proj_4_8 -> ring_attn_4_8_stage0
	k_proj_4_8 -> ring_attn_4_8_stage0
	v_proj_4_8 -> ring_attn_4_8_stage0
	ring_attn_4_8_stage0 -> ring_attn_4_8_stage1
	k_proj_4_7 -> ring_attn_4_8_stage1 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_4_7 -> ring_attn_4_8_stage1 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_4_8_stage1 -> ring_attn_4_8_stage2
	k_proj_4_6 -> ring_attn_4_7_stage2 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_4_6 -> ring_attn_4_7_stage2 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_4_8_stage2 -> ring_attn_4_8_stage3
	k_proj_4_5 -> ring_attn_4_6_stage3 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_4_5 -> ring_attn_4_6_stage3 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_4_8_stage3 -> ring_attn_4_8_stage4
	k_proj_4_4 -> ring_attn_4_5_stage4 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_4_4 -> ring_attn_4_5_stage4 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_4_8_stage4 -> ring_attn_4_8_stage5
	k_proj_4_3 -> ring_attn_4_4_stage5 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_4_3 -> ring_attn_4_4_stage5 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_4_8_stage5 -> ring_attn_4_8_stage6
	k_proj_4_2 -> ring_attn_4_3_stage6 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_4_2 -> ring_attn_4_3_stage6 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_4_8_stage6 -> ring_attn_4_8_stage7
	k_proj_4_1 -> ring_attn_4_2_stage7 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_4_1 -> ring_attn_4_2_stage7 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_4_8_stage7 -> ring_attn_4_8_stage8
	k_proj_4_0 -> ring_attn_4_1_stage8 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_4_0 -> ring_attn_4_1_stage8 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_4_8_stage8 -> ring_attn_4_8_stage9
	k_proj_4_15 -> ring_attn_4_0_stage9 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_4_15 -> ring_attn_4_0_stage9 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_4_8_stage9 -> ring_attn_4_8_stage10
	k_proj_4_14 -> ring_attn_4_15_stage10 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_4_14 -> ring_attn_4_15_stage10 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_4_8_stage10 -> ring_attn_4_8_stage11
	k_proj_4_13 -> ring_attn_4_14_stage11 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_4_13 -> ring_attn_4_14_stage11 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_4_8_stage11 -> ring_attn_4_8_stage12
	k_proj_4_12 -> ring_attn_4_13_stage12 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_4_12 -> ring_attn_4_13_stage12 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_4_8_stage12 -> ring_attn_4_8_stage13
	k_proj_4_11 -> ring_attn_4_12_stage13 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_4_11 -> ring_attn_4_12_stage13 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_4_8_stage13 -> ring_attn_4_8_stage14
	k_proj_4_10 -> ring_attn_4_11_stage14 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_4_10 -> ring_attn_4_11_stage14 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_4_8_stage14 -> ring_attn_4_8_stage15
	k_proj_4_9 -> ring_attn_4_10_stage15 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_4_9 -> ring_attn_4_10_stage15 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_4_8_stage15 -> o_proj_4_8
	o_proj_4_8 -> residual1_4_8
	ln1_4_8 -> residual1_4_8 [style=dotted]
	residual1_4_8 -> ln2_4_8
	ln2_4_8 -> router_4_8
	router_4_8 -> gate_4_8
	gate_4_8 -> expert_agg_4_8
	ln2_4_8 -> expert_4_8_0
	expert_4_8_0 -> expert_agg_4_8
	gate_4_8 -> expert_4_8_0 [label="gate weight" style=dotted]
	ln2_4_8 -> expert_4_8_1
	expert_4_8_1 -> expert_agg_4_8
	gate_4_8 -> expert_4_8_1 [label="gate weight" style=dotted]
	ln2_4_8 -> expert_4_8_2
	expert_4_8_2 -> expert_agg_4_8
	gate_4_8 -> expert_4_8_2 [label="gate weight" style=dotted]
	ln2_4_8 -> expert_4_8_3
	expert_4_8_3 -> expert_agg_4_8
	gate_4_8 -> expert_4_8_3 [label="gate weight" style=dotted]
	ln2_4_8 -> expert_4_8_4
	expert_4_8_4 -> expert_agg_4_8
	gate_4_8 -> expert_4_8_4 [label="gate weight" style=dotted]
	ln2_4_8 -> expert_4_8_5
	expert_4_8_5 -> expert_agg_4_8
	gate_4_8 -> expert_4_8_5 [label="gate weight" style=dotted]
	ln2_4_8 -> expert_4_8_6
	expert_4_8_6 -> expert_agg_4_8
	gate_4_8 -> expert_4_8_6 [label="gate weight" style=dotted]
	ln2_4_8 -> expert_4_8_7
	expert_4_8_7 -> expert_agg_4_8
	gate_4_8 -> expert_4_8_7 [label="gate weight" style=dotted]
	expert_agg_4_8 -> residual2_4_8
	ln2_4_8 -> residual2_4_8 [style=dotted]
	ln1_4_9 -> q_proj_4_9
	ln1_4_9 -> k_proj_4_9
	ln1_4_9 -> v_proj_4_9
	q_proj_4_9 -> ring_attn_4_9_stage0
	k_proj_4_9 -> ring_attn_4_9_stage0
	v_proj_4_9 -> ring_attn_4_9_stage0
	ring_attn_4_9_stage0 -> ring_attn_4_9_stage1
	k_proj_4_8 -> ring_attn_4_9_stage1 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_4_8 -> ring_attn_4_9_stage1 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_4_9_stage1 -> ring_attn_4_9_stage2
	k_proj_4_7 -> ring_attn_4_8_stage2 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_4_7 -> ring_attn_4_8_stage2 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_4_9_stage2 -> ring_attn_4_9_stage3
	k_proj_4_6 -> ring_attn_4_7_stage3 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_4_6 -> ring_attn_4_7_stage3 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_4_9_stage3 -> ring_attn_4_9_stage4
	k_proj_4_5 -> ring_attn_4_6_stage4 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_4_5 -> ring_attn_4_6_stage4 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_4_9_stage4 -> ring_attn_4_9_stage5
	k_proj_4_4 -> ring_attn_4_5_stage5 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_4_4 -> ring_attn_4_5_stage5 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_4_9_stage5 -> ring_attn_4_9_stage6
	k_proj_4_3 -> ring_attn_4_4_stage6 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_4_3 -> ring_attn_4_4_stage6 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_4_9_stage6 -> ring_attn_4_9_stage7
	k_proj_4_2 -> ring_attn_4_3_stage7 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_4_2 -> ring_attn_4_3_stage7 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_4_9_stage7 -> ring_attn_4_9_stage8
	k_proj_4_1 -> ring_attn_4_2_stage8 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_4_1 -> ring_attn_4_2_stage8 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_4_9_stage8 -> ring_attn_4_9_stage9
	k_proj_4_0 -> ring_attn_4_1_stage9 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_4_0 -> ring_attn_4_1_stage9 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_4_9_stage9 -> ring_attn_4_9_stage10
	k_proj_4_15 -> ring_attn_4_0_stage10 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_4_15 -> ring_attn_4_0_stage10 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_4_9_stage10 -> ring_attn_4_9_stage11
	k_proj_4_14 -> ring_attn_4_15_stage11 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_4_14 -> ring_attn_4_15_stage11 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_4_9_stage11 -> ring_attn_4_9_stage12
	k_proj_4_13 -> ring_attn_4_14_stage12 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_4_13 -> ring_attn_4_14_stage12 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_4_9_stage12 -> ring_attn_4_9_stage13
	k_proj_4_12 -> ring_attn_4_13_stage13 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_4_12 -> ring_attn_4_13_stage13 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_4_9_stage13 -> ring_attn_4_9_stage14
	k_proj_4_11 -> ring_attn_4_12_stage14 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_4_11 -> ring_attn_4_12_stage14 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_4_9_stage14 -> ring_attn_4_9_stage15
	k_proj_4_10 -> ring_attn_4_11_stage15 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_4_10 -> ring_attn_4_11_stage15 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_4_9_stage15 -> o_proj_4_9
	o_proj_4_9 -> residual1_4_9
	ln1_4_9 -> residual1_4_9 [style=dotted]
	residual1_4_9 -> ln2_4_9
	ln2_4_9 -> router_4_9
	router_4_9 -> gate_4_9
	gate_4_9 -> expert_agg_4_9
	ln2_4_9 -> expert_4_9_0
	expert_4_9_0 -> expert_agg_4_9
	gate_4_9 -> expert_4_9_0 [label="gate weight" style=dotted]
	ln2_4_9 -> expert_4_9_1
	expert_4_9_1 -> expert_agg_4_9
	gate_4_9 -> expert_4_9_1 [label="gate weight" style=dotted]
	ln2_4_9 -> expert_4_9_2
	expert_4_9_2 -> expert_agg_4_9
	gate_4_9 -> expert_4_9_2 [label="gate weight" style=dotted]
	ln2_4_9 -> expert_4_9_3
	expert_4_9_3 -> expert_agg_4_9
	gate_4_9 -> expert_4_9_3 [label="gate weight" style=dotted]
	ln2_4_9 -> expert_4_9_4
	expert_4_9_4 -> expert_agg_4_9
	gate_4_9 -> expert_4_9_4 [label="gate weight" style=dotted]
	ln2_4_9 -> expert_4_9_5
	expert_4_9_5 -> expert_agg_4_9
	gate_4_9 -> expert_4_9_5 [label="gate weight" style=dotted]
	ln2_4_9 -> expert_4_9_6
	expert_4_9_6 -> expert_agg_4_9
	gate_4_9 -> expert_4_9_6 [label="gate weight" style=dotted]
	ln2_4_9 -> expert_4_9_7
	expert_4_9_7 -> expert_agg_4_9
	gate_4_9 -> expert_4_9_7 [label="gate weight" style=dotted]
	expert_agg_4_9 -> residual2_4_9
	ln2_4_9 -> residual2_4_9 [style=dotted]
	ln1_4_10 -> q_proj_4_10
	ln1_4_10 -> k_proj_4_10
	ln1_4_10 -> v_proj_4_10
	q_proj_4_10 -> ring_attn_4_10_stage0
	k_proj_4_10 -> ring_attn_4_10_stage0
	v_proj_4_10 -> ring_attn_4_10_stage0
	ring_attn_4_10_stage0 -> ring_attn_4_10_stage1
	k_proj_4_9 -> ring_attn_4_10_stage1 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_4_9 -> ring_attn_4_10_stage1 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_4_10_stage1 -> ring_attn_4_10_stage2
	k_proj_4_8 -> ring_attn_4_9_stage2 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_4_8 -> ring_attn_4_9_stage2 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_4_10_stage2 -> ring_attn_4_10_stage3
	k_proj_4_7 -> ring_attn_4_8_stage3 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_4_7 -> ring_attn_4_8_stage3 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_4_10_stage3 -> ring_attn_4_10_stage4
	k_proj_4_6 -> ring_attn_4_7_stage4 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_4_6 -> ring_attn_4_7_stage4 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_4_10_stage4 -> ring_attn_4_10_stage5
	k_proj_4_5 -> ring_attn_4_6_stage5 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_4_5 -> ring_attn_4_6_stage5 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_4_10_stage5 -> ring_attn_4_10_stage6
	k_proj_4_4 -> ring_attn_4_5_stage6 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_4_4 -> ring_attn_4_5_stage6 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_4_10_stage6 -> ring_attn_4_10_stage7
	k_proj_4_3 -> ring_attn_4_4_stage7 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_4_3 -> ring_attn_4_4_stage7 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_4_10_stage7 -> ring_attn_4_10_stage8
	k_proj_4_2 -> ring_attn_4_3_stage8 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_4_2 -> ring_attn_4_3_stage8 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_4_10_stage8 -> ring_attn_4_10_stage9
	k_proj_4_1 -> ring_attn_4_2_stage9 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_4_1 -> ring_attn_4_2_stage9 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_4_10_stage9 -> ring_attn_4_10_stage10
	k_proj_4_0 -> ring_attn_4_1_stage10 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_4_0 -> ring_attn_4_1_stage10 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_4_10_stage10 -> ring_attn_4_10_stage11
	k_proj_4_15 -> ring_attn_4_0_stage11 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_4_15 -> ring_attn_4_0_stage11 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_4_10_stage11 -> ring_attn_4_10_stage12
	k_proj_4_14 -> ring_attn_4_15_stage12 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_4_14 -> ring_attn_4_15_stage12 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_4_10_stage12 -> ring_attn_4_10_stage13
	k_proj_4_13 -> ring_attn_4_14_stage13 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_4_13 -> ring_attn_4_14_stage13 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_4_10_stage13 -> ring_attn_4_10_stage14
	k_proj_4_12 -> ring_attn_4_13_stage14 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_4_12 -> ring_attn_4_13_stage14 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_4_10_stage14 -> ring_attn_4_10_stage15
	k_proj_4_11 -> ring_attn_4_12_stage15 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_4_11 -> ring_attn_4_12_stage15 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_4_10_stage15 -> o_proj_4_10
	o_proj_4_10 -> residual1_4_10
	ln1_4_10 -> residual1_4_10 [style=dotted]
	residual1_4_10 -> ln2_4_10
	ln2_4_10 -> router_4_10
	router_4_10 -> gate_4_10
	gate_4_10 -> expert_agg_4_10
	ln2_4_10 -> expert_4_10_0
	expert_4_10_0 -> expert_agg_4_10
	gate_4_10 -> expert_4_10_0 [label="gate weight" style=dotted]
	ln2_4_10 -> expert_4_10_1
	expert_4_10_1 -> expert_agg_4_10
	gate_4_10 -> expert_4_10_1 [label="gate weight" style=dotted]
	ln2_4_10 -> expert_4_10_2
	expert_4_10_2 -> expert_agg_4_10
	gate_4_10 -> expert_4_10_2 [label="gate weight" style=dotted]
	ln2_4_10 -> expert_4_10_3
	expert_4_10_3 -> expert_agg_4_10
	gate_4_10 -> expert_4_10_3 [label="gate weight" style=dotted]
	ln2_4_10 -> expert_4_10_4
	expert_4_10_4 -> expert_agg_4_10
	gate_4_10 -> expert_4_10_4 [label="gate weight" style=dotted]
	ln2_4_10 -> expert_4_10_5
	expert_4_10_5 -> expert_agg_4_10
	gate_4_10 -> expert_4_10_5 [label="gate weight" style=dotted]
	ln2_4_10 -> expert_4_10_6
	expert_4_10_6 -> expert_agg_4_10
	gate_4_10 -> expert_4_10_6 [label="gate weight" style=dotted]
	ln2_4_10 -> expert_4_10_7
	expert_4_10_7 -> expert_agg_4_10
	gate_4_10 -> expert_4_10_7 [label="gate weight" style=dotted]
	expert_agg_4_10 -> residual2_4_10
	ln2_4_10 -> residual2_4_10 [style=dotted]
	ln1_4_11 -> q_proj_4_11
	ln1_4_11 -> k_proj_4_11
	ln1_4_11 -> v_proj_4_11
	q_proj_4_11 -> ring_attn_4_11_stage0
	k_proj_4_11 -> ring_attn_4_11_stage0
	v_proj_4_11 -> ring_attn_4_11_stage0
	ring_attn_4_11_stage0 -> ring_attn_4_11_stage1
	k_proj_4_10 -> ring_attn_4_11_stage1 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_4_10 -> ring_attn_4_11_stage1 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_4_11_stage1 -> ring_attn_4_11_stage2
	k_proj_4_9 -> ring_attn_4_10_stage2 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_4_9 -> ring_attn_4_10_stage2 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_4_11_stage2 -> ring_attn_4_11_stage3
	k_proj_4_8 -> ring_attn_4_9_stage3 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_4_8 -> ring_attn_4_9_stage3 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_4_11_stage3 -> ring_attn_4_11_stage4
	k_proj_4_7 -> ring_attn_4_8_stage4 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_4_7 -> ring_attn_4_8_stage4 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_4_11_stage4 -> ring_attn_4_11_stage5
	k_proj_4_6 -> ring_attn_4_7_stage5 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_4_6 -> ring_attn_4_7_stage5 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_4_11_stage5 -> ring_attn_4_11_stage6
	k_proj_4_5 -> ring_attn_4_6_stage6 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_4_5 -> ring_attn_4_6_stage6 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_4_11_stage6 -> ring_attn_4_11_stage7
	k_proj_4_4 -> ring_attn_4_5_stage7 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_4_4 -> ring_attn_4_5_stage7 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_4_11_stage7 -> ring_attn_4_11_stage8
	k_proj_4_3 -> ring_attn_4_4_stage8 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_4_3 -> ring_attn_4_4_stage8 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_4_11_stage8 -> ring_attn_4_11_stage9
	k_proj_4_2 -> ring_attn_4_3_stage9 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_4_2 -> ring_attn_4_3_stage9 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_4_11_stage9 -> ring_attn_4_11_stage10
	k_proj_4_1 -> ring_attn_4_2_stage10 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_4_1 -> ring_attn_4_2_stage10 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_4_11_stage10 -> ring_attn_4_11_stage11
	k_proj_4_0 -> ring_attn_4_1_stage11 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_4_0 -> ring_attn_4_1_stage11 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_4_11_stage11 -> ring_attn_4_11_stage12
	k_proj_4_15 -> ring_attn_4_0_stage12 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_4_15 -> ring_attn_4_0_stage12 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_4_11_stage12 -> ring_attn_4_11_stage13
	k_proj_4_14 -> ring_attn_4_15_stage13 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_4_14 -> ring_attn_4_15_stage13 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_4_11_stage13 -> ring_attn_4_11_stage14
	k_proj_4_13 -> ring_attn_4_14_stage14 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_4_13 -> ring_attn_4_14_stage14 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_4_11_stage14 -> ring_attn_4_11_stage15
	k_proj_4_12 -> ring_attn_4_13_stage15 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_4_12 -> ring_attn_4_13_stage15 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_4_11_stage15 -> o_proj_4_11
	o_proj_4_11 -> residual1_4_11
	ln1_4_11 -> residual1_4_11 [style=dotted]
	residual1_4_11 -> ln2_4_11
	ln2_4_11 -> router_4_11
	router_4_11 -> gate_4_11
	gate_4_11 -> expert_agg_4_11
	ln2_4_11 -> expert_4_11_0
	expert_4_11_0 -> expert_agg_4_11
	gate_4_11 -> expert_4_11_0 [label="gate weight" style=dotted]
	ln2_4_11 -> expert_4_11_1
	expert_4_11_1 -> expert_agg_4_11
	gate_4_11 -> expert_4_11_1 [label="gate weight" style=dotted]
	ln2_4_11 -> expert_4_11_2
	expert_4_11_2 -> expert_agg_4_11
	gate_4_11 -> expert_4_11_2 [label="gate weight" style=dotted]
	ln2_4_11 -> expert_4_11_3
	expert_4_11_3 -> expert_agg_4_11
	gate_4_11 -> expert_4_11_3 [label="gate weight" style=dotted]
	ln2_4_11 -> expert_4_11_4
	expert_4_11_4 -> expert_agg_4_11
	gate_4_11 -> expert_4_11_4 [label="gate weight" style=dotted]
	ln2_4_11 -> expert_4_11_5
	expert_4_11_5 -> expert_agg_4_11
	gate_4_11 -> expert_4_11_5 [label="gate weight" style=dotted]
	ln2_4_11 -> expert_4_11_6
	expert_4_11_6 -> expert_agg_4_11
	gate_4_11 -> expert_4_11_6 [label="gate weight" style=dotted]
	ln2_4_11 -> expert_4_11_7
	expert_4_11_7 -> expert_agg_4_11
	gate_4_11 -> expert_4_11_7 [label="gate weight" style=dotted]
	expert_agg_4_11 -> residual2_4_11
	ln2_4_11 -> residual2_4_11 [style=dotted]
	ln1_4_12 -> q_proj_4_12
	ln1_4_12 -> k_proj_4_12
	ln1_4_12 -> v_proj_4_12
	q_proj_4_12 -> ring_attn_4_12_stage0
	k_proj_4_12 -> ring_attn_4_12_stage0
	v_proj_4_12 -> ring_attn_4_12_stage0
	ring_attn_4_12_stage0 -> ring_attn_4_12_stage1
	k_proj_4_11 -> ring_attn_4_12_stage1 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_4_11 -> ring_attn_4_12_stage1 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_4_12_stage1 -> ring_attn_4_12_stage2
	k_proj_4_10 -> ring_attn_4_11_stage2 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_4_10 -> ring_attn_4_11_stage2 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_4_12_stage2 -> ring_attn_4_12_stage3
	k_proj_4_9 -> ring_attn_4_10_stage3 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_4_9 -> ring_attn_4_10_stage3 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_4_12_stage3 -> ring_attn_4_12_stage4
	k_proj_4_8 -> ring_attn_4_9_stage4 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_4_8 -> ring_attn_4_9_stage4 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_4_12_stage4 -> ring_attn_4_12_stage5
	k_proj_4_7 -> ring_attn_4_8_stage5 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_4_7 -> ring_attn_4_8_stage5 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_4_12_stage5 -> ring_attn_4_12_stage6
	k_proj_4_6 -> ring_attn_4_7_stage6 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_4_6 -> ring_attn_4_7_stage6 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_4_12_stage6 -> ring_attn_4_12_stage7
	k_proj_4_5 -> ring_attn_4_6_stage7 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_4_5 -> ring_attn_4_6_stage7 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_4_12_stage7 -> ring_attn_4_12_stage8
	k_proj_4_4 -> ring_attn_4_5_stage8 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_4_4 -> ring_attn_4_5_stage8 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_4_12_stage8 -> ring_attn_4_12_stage9
	k_proj_4_3 -> ring_attn_4_4_stage9 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_4_3 -> ring_attn_4_4_stage9 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_4_12_stage9 -> ring_attn_4_12_stage10
	k_proj_4_2 -> ring_attn_4_3_stage10 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_4_2 -> ring_attn_4_3_stage10 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_4_12_stage10 -> ring_attn_4_12_stage11
	k_proj_4_1 -> ring_attn_4_2_stage11 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_4_1 -> ring_attn_4_2_stage11 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_4_12_stage11 -> ring_attn_4_12_stage12
	k_proj_4_0 -> ring_attn_4_1_stage12 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_4_0 -> ring_attn_4_1_stage12 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_4_12_stage12 -> ring_attn_4_12_stage13
	k_proj_4_15 -> ring_attn_4_0_stage13 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_4_15 -> ring_attn_4_0_stage13 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_4_12_stage13 -> ring_attn_4_12_stage14
	k_proj_4_14 -> ring_attn_4_15_stage14 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_4_14 -> ring_attn_4_15_stage14 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_4_12_stage14 -> ring_attn_4_12_stage15
	k_proj_4_13 -> ring_attn_4_14_stage15 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_4_13 -> ring_attn_4_14_stage15 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_4_12_stage15 -> o_proj_4_12
	o_proj_4_12 -> residual1_4_12
	ln1_4_12 -> residual1_4_12 [style=dotted]
	residual1_4_12 -> ln2_4_12
	ln2_4_12 -> router_4_12
	router_4_12 -> gate_4_12
	gate_4_12 -> expert_agg_4_12
	ln2_4_12 -> expert_4_12_0
	expert_4_12_0 -> expert_agg_4_12
	gate_4_12 -> expert_4_12_0 [label="gate weight" style=dotted]
	ln2_4_12 -> expert_4_12_1
	expert_4_12_1 -> expert_agg_4_12
	gate_4_12 -> expert_4_12_1 [label="gate weight" style=dotted]
	ln2_4_12 -> expert_4_12_2
	expert_4_12_2 -> expert_agg_4_12
	gate_4_12 -> expert_4_12_2 [label="gate weight" style=dotted]
	ln2_4_12 -> expert_4_12_3
	expert_4_12_3 -> expert_agg_4_12
	gate_4_12 -> expert_4_12_3 [label="gate weight" style=dotted]
	ln2_4_12 -> expert_4_12_4
	expert_4_12_4 -> expert_agg_4_12
	gate_4_12 -> expert_4_12_4 [label="gate weight" style=dotted]
	ln2_4_12 -> expert_4_12_5
	expert_4_12_5 -> expert_agg_4_12
	gate_4_12 -> expert_4_12_5 [label="gate weight" style=dotted]
	ln2_4_12 -> expert_4_12_6
	expert_4_12_6 -> expert_agg_4_12
	gate_4_12 -> expert_4_12_6 [label="gate weight" style=dotted]
	ln2_4_12 -> expert_4_12_7
	expert_4_12_7 -> expert_agg_4_12
	gate_4_12 -> expert_4_12_7 [label="gate weight" style=dotted]
	expert_agg_4_12 -> residual2_4_12
	ln2_4_12 -> residual2_4_12 [style=dotted]
	ln1_4_13 -> q_proj_4_13
	ln1_4_13 -> k_proj_4_13
	ln1_4_13 -> v_proj_4_13
	q_proj_4_13 -> ring_attn_4_13_stage0
	k_proj_4_13 -> ring_attn_4_13_stage0
	v_proj_4_13 -> ring_attn_4_13_stage0
	ring_attn_4_13_stage0 -> ring_attn_4_13_stage1
	k_proj_4_12 -> ring_attn_4_13_stage1 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_4_12 -> ring_attn_4_13_stage1 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_4_13_stage1 -> ring_attn_4_13_stage2
	k_proj_4_11 -> ring_attn_4_12_stage2 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_4_11 -> ring_attn_4_12_stage2 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_4_13_stage2 -> ring_attn_4_13_stage3
	k_proj_4_10 -> ring_attn_4_11_stage3 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_4_10 -> ring_attn_4_11_stage3 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_4_13_stage3 -> ring_attn_4_13_stage4
	k_proj_4_9 -> ring_attn_4_10_stage4 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_4_9 -> ring_attn_4_10_stage4 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_4_13_stage4 -> ring_attn_4_13_stage5
	k_proj_4_8 -> ring_attn_4_9_stage5 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_4_8 -> ring_attn_4_9_stage5 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_4_13_stage5 -> ring_attn_4_13_stage6
	k_proj_4_7 -> ring_attn_4_8_stage6 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_4_7 -> ring_attn_4_8_stage6 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_4_13_stage6 -> ring_attn_4_13_stage7
	k_proj_4_6 -> ring_attn_4_7_stage7 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_4_6 -> ring_attn_4_7_stage7 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_4_13_stage7 -> ring_attn_4_13_stage8
	k_proj_4_5 -> ring_attn_4_6_stage8 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_4_5 -> ring_attn_4_6_stage8 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_4_13_stage8 -> ring_attn_4_13_stage9
	k_proj_4_4 -> ring_attn_4_5_stage9 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_4_4 -> ring_attn_4_5_stage9 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_4_13_stage9 -> ring_attn_4_13_stage10
	k_proj_4_3 -> ring_attn_4_4_stage10 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_4_3 -> ring_attn_4_4_stage10 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_4_13_stage10 -> ring_attn_4_13_stage11
	k_proj_4_2 -> ring_attn_4_3_stage11 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_4_2 -> ring_attn_4_3_stage11 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_4_13_stage11 -> ring_attn_4_13_stage12
	k_proj_4_1 -> ring_attn_4_2_stage12 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_4_1 -> ring_attn_4_2_stage12 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_4_13_stage12 -> ring_attn_4_13_stage13
	k_proj_4_0 -> ring_attn_4_1_stage13 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_4_0 -> ring_attn_4_1_stage13 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_4_13_stage13 -> ring_attn_4_13_stage14
	k_proj_4_15 -> ring_attn_4_0_stage14 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_4_15 -> ring_attn_4_0_stage14 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_4_13_stage14 -> ring_attn_4_13_stage15
	k_proj_4_14 -> ring_attn_4_15_stage15 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_4_14 -> ring_attn_4_15_stage15 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_4_13_stage15 -> o_proj_4_13
	o_proj_4_13 -> residual1_4_13
	ln1_4_13 -> residual1_4_13 [style=dotted]
	residual1_4_13 -> ln2_4_13
	ln2_4_13 -> router_4_13
	router_4_13 -> gate_4_13
	gate_4_13 -> expert_agg_4_13
	ln2_4_13 -> expert_4_13_0
	expert_4_13_0 -> expert_agg_4_13
	gate_4_13 -> expert_4_13_0 [label="gate weight" style=dotted]
	ln2_4_13 -> expert_4_13_1
	expert_4_13_1 -> expert_agg_4_13
	gate_4_13 -> expert_4_13_1 [label="gate weight" style=dotted]
	ln2_4_13 -> expert_4_13_2
	expert_4_13_2 -> expert_agg_4_13
	gate_4_13 -> expert_4_13_2 [label="gate weight" style=dotted]
	ln2_4_13 -> expert_4_13_3
	expert_4_13_3 -> expert_agg_4_13
	gate_4_13 -> expert_4_13_3 [label="gate weight" style=dotted]
	ln2_4_13 -> expert_4_13_4
	expert_4_13_4 -> expert_agg_4_13
	gate_4_13 -> expert_4_13_4 [label="gate weight" style=dotted]
	ln2_4_13 -> expert_4_13_5
	expert_4_13_5 -> expert_agg_4_13
	gate_4_13 -> expert_4_13_5 [label="gate weight" style=dotted]
	ln2_4_13 -> expert_4_13_6
	expert_4_13_6 -> expert_agg_4_13
	gate_4_13 -> expert_4_13_6 [label="gate weight" style=dotted]
	ln2_4_13 -> expert_4_13_7
	expert_4_13_7 -> expert_agg_4_13
	gate_4_13 -> expert_4_13_7 [label="gate weight" style=dotted]
	expert_agg_4_13 -> residual2_4_13
	ln2_4_13 -> residual2_4_13 [style=dotted]
	ln1_4_14 -> q_proj_4_14
	ln1_4_14 -> k_proj_4_14
	ln1_4_14 -> v_proj_4_14
	q_proj_4_14 -> ring_attn_4_14_stage0
	k_proj_4_14 -> ring_attn_4_14_stage0
	v_proj_4_14 -> ring_attn_4_14_stage0
	ring_attn_4_14_stage0 -> ring_attn_4_14_stage1
	k_proj_4_13 -> ring_attn_4_14_stage1 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_4_13 -> ring_attn_4_14_stage1 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_4_14_stage1 -> ring_attn_4_14_stage2
	k_proj_4_12 -> ring_attn_4_13_stage2 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_4_12 -> ring_attn_4_13_stage2 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_4_14_stage2 -> ring_attn_4_14_stage3
	k_proj_4_11 -> ring_attn_4_12_stage3 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_4_11 -> ring_attn_4_12_stage3 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_4_14_stage3 -> ring_attn_4_14_stage4
	k_proj_4_10 -> ring_attn_4_11_stage4 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_4_10 -> ring_attn_4_11_stage4 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_4_14_stage4 -> ring_attn_4_14_stage5
	k_proj_4_9 -> ring_attn_4_10_stage5 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_4_9 -> ring_attn_4_10_stage5 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_4_14_stage5 -> ring_attn_4_14_stage6
	k_proj_4_8 -> ring_attn_4_9_stage6 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_4_8 -> ring_attn_4_9_stage6 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_4_14_stage6 -> ring_attn_4_14_stage7
	k_proj_4_7 -> ring_attn_4_8_stage7 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_4_7 -> ring_attn_4_8_stage7 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_4_14_stage7 -> ring_attn_4_14_stage8
	k_proj_4_6 -> ring_attn_4_7_stage8 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_4_6 -> ring_attn_4_7_stage8 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_4_14_stage8 -> ring_attn_4_14_stage9
	k_proj_4_5 -> ring_attn_4_6_stage9 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_4_5 -> ring_attn_4_6_stage9 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_4_14_stage9 -> ring_attn_4_14_stage10
	k_proj_4_4 -> ring_attn_4_5_stage10 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_4_4 -> ring_attn_4_5_stage10 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_4_14_stage10 -> ring_attn_4_14_stage11
	k_proj_4_3 -> ring_attn_4_4_stage11 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_4_3 -> ring_attn_4_4_stage11 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_4_14_stage11 -> ring_attn_4_14_stage12
	k_proj_4_2 -> ring_attn_4_3_stage12 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_4_2 -> ring_attn_4_3_stage12 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_4_14_stage12 -> ring_attn_4_14_stage13
	k_proj_4_1 -> ring_attn_4_2_stage13 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_4_1 -> ring_attn_4_2_stage13 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_4_14_stage13 -> ring_attn_4_14_stage14
	k_proj_4_0 -> ring_attn_4_1_stage14 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_4_0 -> ring_attn_4_1_stage14 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_4_14_stage14 -> ring_attn_4_14_stage15
	k_proj_4_15 -> ring_attn_4_0_stage15 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	v_proj_4_15 -> ring_attn_4_0_stage15 [label="KV Block
K/V[15]→GPU0" color=blue constraint=false style=dashed]
	ring_attn_4_14_stage15 -> o_proj_4_14
	o_proj_4_14 -> residual1_4_14
	ln1_4_14 -> residual1_4_14 [style=dotted]
	residual1_4_14 -> ln2_4_14
	ln2_4_14 -> router_4_14
	router_4_14 -> gate_4_14
	gate_4_14 -> expert_agg_4_14
	ln2_4_14 -> expert_4_14_0
	expert_4_14_0 -> expert_agg_4_14
	gate_4_14 -> expert_4_14_0 [label="gate weight" style=dotted]
	ln2_4_14 -> expert_4_14_1
	expert_4_14_1 -> expert_agg_4_14
	gate_4_14 -> expert_4_14_1 [label="gate weight" style=dotted]
	ln2_4_14 -> expert_4_14_2
	expert_4_14_2 -> expert_agg_4_14
	gate_4_14 -> expert_4_14_2 [label="gate weight" style=dotted]
	ln2_4_14 -> expert_4_14_3
	expert_4_14_3 -> expert_agg_4_14
	gate_4_14 -> expert_4_14_3 [label="gate weight" style=dotted]
	ln2_4_14 -> expert_4_14_4
	expert_4_14_4 -> expert_agg_4_14
	gate_4_14 -> expert_4_14_4 [label="gate weight" style=dotted]
	ln2_4_14 -> expert_4_14_5
	expert_4_14_5 -> expert_agg_4_14
	gate_4_14 -> expert_4_14_5 [label="gate weight" style=dotted]
	ln2_4_14 -> expert_4_14_6
	expert_4_14_6 -> expert_agg_4_14
	gate_4_14 -> expert_4_14_6 [label="gate weight" style=dotted]
	ln2_4_14 -> expert_4_14_7
	expert_4_14_7 -> expert_agg_4_14
	gate_4_14 -> expert_4_14_7 [label="gate weight" style=dotted]
	expert_agg_4_14 -> residual2_4_14
	ln2_4_14 -> residual2_4_14 [style=dotted]
	ln1_4_15 -> q_proj_4_15
	ln1_4_15 -> k_proj_4_15
	ln1_4_15 -> v_proj_4_15
	q_proj_4_15 -> ring_attn_4_15_stage0
	k_proj_4_15 -> ring_attn_4_15_stage0
	v_proj_4_15 -> ring_attn_4_15_stage0
	ring_attn_4_15_stage0 -> ring_attn_4_15_stage1
	k_proj_4_14 -> ring_attn_4_15_stage1 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	v_proj_4_14 -> ring_attn_4_15_stage1 [label="KV Block
K/V[14]→GPU15" color=blue constraint=false style=dashed]
	ring_attn_4_15_stage1 -> ring_attn_4_15_stage2
	k_proj_4_13 -> ring_attn_4_14_stage2 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	v_proj_4_13 -> ring_attn_4_14_stage2 [label="KV Block
K/V[13]→GPU14" color=blue constraint=false style=dashed]
	ring_attn_4_15_stage2 -> ring_attn_4_15_stage3
	k_proj_4_12 -> ring_attn_4_13_stage3 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	v_proj_4_12 -> ring_attn_4_13_stage3 [label="KV Block
K/V[12]→GPU13" color=blue constraint=false style=dashed]
	ring_attn_4_15_stage3 -> ring_attn_4_15_stage4
	k_proj_4_11 -> ring_attn_4_12_stage4 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	v_proj_4_11 -> ring_attn_4_12_stage4 [label="KV Block
K/V[11]→GPU12" color=blue constraint=false style=dashed]
	ring_attn_4_15_stage4 -> ring_attn_4_15_stage5
	k_proj_4_10 -> ring_attn_4_11_stage5 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	v_proj_4_10 -> ring_attn_4_11_stage5 [label="KV Block
K/V[10]→GPU11" color=blue constraint=false style=dashed]
	ring_attn_4_15_stage5 -> ring_attn_4_15_stage6
	k_proj_4_9 -> ring_attn_4_10_stage6 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	v_proj_4_9 -> ring_attn_4_10_stage6 [label="KV Block
K/V[9]→GPU10" color=blue constraint=false style=dashed]
	ring_attn_4_15_stage6 -> ring_attn_4_15_stage7
	k_proj_4_8 -> ring_attn_4_9_stage7 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	v_proj_4_8 -> ring_attn_4_9_stage7 [label="KV Block
K/V[8]→GPU9" color=blue constraint=false style=dashed]
	ring_attn_4_15_stage7 -> ring_attn_4_15_stage8
	k_proj_4_7 -> ring_attn_4_8_stage8 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	v_proj_4_7 -> ring_attn_4_8_stage8 [label="KV Block
K/V[7]→GPU8" color=blue constraint=false style=dashed]
	ring_attn_4_15_stage8 -> ring_attn_4_15_stage9
	k_proj_4_6 -> ring_attn_4_7_stage9 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	v_proj_4_6 -> ring_attn_4_7_stage9 [label="KV Block
K/V[6]→GPU7" color=blue constraint=false style=dashed]
	ring_attn_4_15_stage9 -> ring_attn_4_15_stage10
	k_proj_4_5 -> ring_attn_4_6_stage10 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	v_proj_4_5 -> ring_attn_4_6_stage10 [label="KV Block
K/V[5]→GPU6" color=blue constraint=false style=dashed]
	ring_attn_4_15_stage10 -> ring_attn_4_15_stage11
	k_proj_4_4 -> ring_attn_4_5_stage11 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	v_proj_4_4 -> ring_attn_4_5_stage11 [label="KV Block
K/V[4]→GPU5" color=blue constraint=false style=dashed]
	ring_attn_4_15_stage11 -> ring_attn_4_15_stage12
	k_proj_4_3 -> ring_attn_4_4_stage12 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	v_proj_4_3 -> ring_attn_4_4_stage12 [label="KV Block
K/V[3]→GPU4" color=blue constraint=false style=dashed]
	ring_attn_4_15_stage12 -> ring_attn_4_15_stage13
	k_proj_4_2 -> ring_attn_4_3_stage13 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	v_proj_4_2 -> ring_attn_4_3_stage13 [label="KV Block
K/V[2]→GPU3" color=blue constraint=false style=dashed]
	ring_attn_4_15_stage13 -> ring_attn_4_15_stage14
	k_proj_4_1 -> ring_attn_4_2_stage14 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	v_proj_4_1 -> ring_attn_4_2_stage14 [label="KV Block
K/V[1]→GPU2" color=blue constraint=false style=dashed]
	ring_attn_4_15_stage14 -> ring_attn_4_15_stage15
	k_proj_4_0 -> ring_attn_4_1_stage15 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	v_proj_4_0 -> ring_attn_4_1_stage15 [label="KV Block
K/V[0]→GPU1" color=blue constraint=false style=dashed]
	ring_attn_4_15_stage15 -> o_proj_4_15
	o_proj_4_15 -> residual1_4_15
	ln1_4_15 -> residual1_4_15 [style=dotted]
	residual1_4_15 -> ln2_4_15
	ln2_4_15 -> router_4_15
	router_4_15 -> gate_4_15
	gate_4_15 -> expert_agg_4_15
	ln2_4_15 -> expert_4_15_0
	expert_4_15_0 -> expert_agg_4_15
	gate_4_15 -> expert_4_15_0 [label="gate weight" style=dotted]
	ln2_4_15 -> expert_4_15_1
	expert_4_15_1 -> expert_agg_4_15
	gate_4_15 -> expert_4_15_1 [label="gate weight" style=dotted]
	ln2_4_15 -> expert_4_15_2
	expert_4_15_2 -> expert_agg_4_15
	gate_4_15 -> expert_4_15_2 [label="gate weight" style=dotted]
	ln2_4_15 -> expert_4_15_3
	expert_4_15_3 -> expert_agg_4_15
	gate_4_15 -> expert_4_15_3 [label="gate weight" style=dotted]
	ln2_4_15 -> expert_4_15_4
	expert_4_15_4 -> expert_agg_4_15
	gate_4_15 -> expert_4_15_4 [label="gate weight" style=dotted]
	ln2_4_15 -> expert_4_15_5
	expert_4_15_5 -> expert_agg_4_15
	gate_4_15 -> expert_4_15_5 [label="gate weight" style=dotted]
	ln2_4_15 -> expert_4_15_6
	expert_4_15_6 -> expert_agg_4_15
	gate_4_15 -> expert_4_15_6 [label="gate weight" style=dotted]
	ln2_4_15 -> expert_4_15_7
	expert_4_15_7 -> expert_agg_4_15
	gate_4_15 -> expert_4_15_7 [label="gate weight" style=dotted]
	expert_agg_4_15 -> residual2_4_15
	ln2_4_15 -> residual2_4_15 [style=dotted]
	residual2_1_0 -> ln1_2_0
	residual2_1_1 -> ln1_2_1
	residual2_1_2 -> ln1_2_2
	residual2_1_3 -> ln1_2_3
	residual2_1_4 -> ln1_2_4
	residual2_1_5 -> ln1_2_5
	residual2_1_6 -> ln1_2_6
	residual2_1_7 -> ln1_2_7
	residual2_1_8 -> ln1_2_8
	residual2_1_9 -> ln1_2_9
	residual2_1_10 -> ln1_2_10
	residual2_1_11 -> ln1_2_11
	residual2_1_12 -> ln1_2_12
	residual2_1_13 -> ln1_2_13
	residual2_1_14 -> ln1_2_14
	residual2_1_15 -> ln1_2_15
	residual2_2_0 -> ln1_3_0
	residual2_2_1 -> ln1_3_1
	residual2_2_2 -> ln1_3_2
	residual2_2_3 -> ln1_3_3
	residual2_2_4 -> ln1_3_4
	residual2_2_5 -> ln1_3_5
	residual2_2_6 -> ln1_3_6
	residual2_2_7 -> ln1_3_7
	residual2_2_8 -> ln1_3_8
	residual2_2_9 -> ln1_3_9
	residual2_2_10 -> ln1_3_10
	residual2_2_11 -> ln1_3_11
	residual2_2_12 -> ln1_3_12
	residual2_2_13 -> ln1_3_13
	residual2_2_14 -> ln1_3_14
	residual2_2_15 -> ln1_3_15
	residual2_3_0 -> ln1_4_0
	residual2_3_1 -> ln1_4_1
	residual2_3_2 -> ln1_4_2
	residual2_3_3 -> ln1_4_3
	residual2_3_4 -> ln1_4_4
	residual2_3_5 -> ln1_4_5
	residual2_3_6 -> ln1_4_6
	residual2_3_7 -> ln1_4_7
	residual2_3_8 -> ln1_4_8
	residual2_3_9 -> ln1_4_9
	residual2_3_10 -> ln1_4_10
	residual2_3_11 -> ln1_4_11
	residual2_3_12 -> ln1_4_12
	residual2_3_13 -> ln1_4_13
	residual2_3_14 -> ln1_4_14
	residual2_3_15 -> ln1_4_15
	residual2_4_0 -> final_ln_0
	final_ln_0 -> output_proj_0
	residual2_4_1 -> final_ln_1
	final_ln_1 -> output_proj_1
	residual2_4_2 -> final_ln_2
	final_ln_2 -> output_proj_2
	residual2_4_3 -> final_ln_3
	final_ln_3 -> output_proj_3
	residual2_4_4 -> final_ln_4
	final_ln_4 -> output_proj_4
	residual2_4_5 -> final_ln_5
	final_ln_5 -> output_proj_5
	residual2_4_6 -> final_ln_6
	final_ln_6 -> output_proj_6
	residual2_4_7 -> final_ln_7
	final_ln_7 -> output_proj_7
	residual2_4_8 -> final_ln_8
	final_ln_8 -> output_proj_8
	residual2_4_9 -> final_ln_9
	final_ln_9 -> output_proj_9
	residual2_4_10 -> final_ln_10
	final_ln_10 -> output_proj_10
	residual2_4_11 -> final_ln_11
	final_ln_11 -> output_proj_11
	residual2_4_12 -> final_ln_12
	final_ln_12 -> output_proj_12
	residual2_4_13 -> final_ln_13
	final_ln_13 -> output_proj_13
	residual2_4_14 -> final_ln_14
	final_ln_14 -> output_proj_14
	residual2_4_15 -> final_ln_15
	final_ln_15 -> output_proj_15
	subgraph cluster_communication {
		color=lightgray fillcolor=lightgray label="Communication Patterns" style=filled
		comm_legend [label="Ring Attention Communication:
• KV blocks passed in ring topology
• Each GPU sends L/16 × d_model per stage
• 16 stages total per attention

Expert Communication:
• Expert selection happens locally
• No cross-GPU expert communication
• Capacity factor 1.25 for load balancing" fillcolor=white shape=note style=filled]
	}
}
