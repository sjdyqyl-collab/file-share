<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: moe_model_layerwise Pages: 1 -->
<svg width="6598pt" height="14946pt"
 viewBox="0.00 0.00 6598.00 14946.10" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 14942.1)">
<title>moe_model_layerwise</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-14942.1 6594,-14942.1 6594,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<polygon fill="#e8f4fd" stroke="black" points="3775,-14938.1 3509,-14938.1 3509,-14885.1 3775,-14885.1 3775,-14938.1"/>
<text text-anchor="middle" x="3642" y="-14922.9" font-family="Helvetica,sans-Serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="3642" y="-14907.9" font-family="Helvetica,sans-Serif" font-size="14.00">[batch=1024, seq_len, hidden_dim]</text>
<text text-anchor="middle" x="3642" y="-14892.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: Host</text>
</g>
<!-- ln1_1 -->
<g id="node2" class="node">
<title>ln1_1</title>
<polygon fill="#f8f9f9" stroke="black" points="3668.5,-14827.1 3453.5,-14827.1 3453.5,-14774.1 3668.5,-14774.1 3668.5,-14827.1"/>
<text text-anchor="middle" x="3561" y="-14811.9" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="3561" y="-14796.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="3561" y="-14781.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- input&#45;&gt;ln1_1 -->
<g id="edge1" class="edge">
<title>input&#45;&gt;ln1_1</title>
<path fill="none" stroke="black" d="M3588.75,-14885.01C3588.75,-14885.01 3588.75,-14837.36 3588.75,-14837.36"/>
<polygon fill="black" stroke="black" points="3592.25,-14837.36 3588.75,-14827.36 3585.25,-14837.36 3592.25,-14837.36"/>
</g>
<!-- residual1_1 -->
<g id="node8" class="node">
<title>residual1_1</title>
<polygon fill="#fadbd8" stroke="black" points="3734.5,-14161.1 3519.5,-14161.1 3519.5,-14108.1 3734.5,-14108.1 3734.5,-14161.1"/>
<text text-anchor="middle" x="3627" y="-14145.9" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="3627" y="-14130.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="3627" y="-14115.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- input&#45;&gt;residual1_1 -->
<g id="edge7" class="edge">
<title>input&#45;&gt;residual1_1</title>
<path fill="none" stroke="black" d="M3703.25,-14884.86C3703.25,-14884.86 3703.25,-14171.24 3703.25,-14171.24"/>
<polygon fill="black" stroke="black" points="3706.75,-14171.24 3703.25,-14161.24 3699.75,-14171.24 3706.75,-14171.24"/>
</g>
<!-- attn_qkv_1 -->
<g id="node3" class="node">
<title>attn_qkv_1</title>
<polygon fill="#ffe6cc" stroke="black" points="3661,-14716.1 3431,-14716.1 3431,-14663.1 3661,-14663.1 3661,-14716.1"/>
<text text-anchor="middle" x="3546" y="-14700.9" font-family="Helvetica,sans-Serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="3546" y="-14685.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="3546" y="-14670.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 3*hidden_dim]</text>
</g>
<!-- ln1_1&#45;&gt;attn_qkv_1 -->
<g id="edge2" class="edge">
<title>ln1_1&#45;&gt;attn_qkv_1</title>
<path fill="none" stroke="black" d="M3557.25,-14774.01C3557.25,-14774.01 3557.25,-14726.36 3557.25,-14726.36"/>
<polygon fill="black" stroke="black" points="3560.75,-14726.36 3557.25,-14716.36 3553.75,-14726.36 3560.75,-14726.36"/>
</g>
<!-- attn_score_1 -->
<g id="node4" class="node">
<title>attn_score_1</title>
<polygon fill="#ffe6cc" stroke="black" points="3671.5,-14605.1 3396.5,-14605.1 3396.5,-14552.1 3671.5,-14552.1 3671.5,-14605.1"/>
<text text-anchor="middle" x="3534" y="-14589.9" font-family="Helvetica,sans-Serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="3534" y="-14574.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="3534" y="-14559.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_qkv_1&#45;&gt;attn_score_1 -->
<g id="edge3" class="edge">
<title>attn_qkv_1&#45;&gt;attn_score_1</title>
<path fill="none" stroke="black" d="M3546,-14663.01C3546,-14663.01 3546,-14615.36 3546,-14615.36"/>
<polygon fill="black" stroke="black" points="3549.5,-14615.36 3546,-14605.36 3542.5,-14615.36 3549.5,-14615.36"/>
</g>
<!-- attn_weight_1 -->
<g id="node5" class="node">
<title>attn_weight_1</title>
<polygon fill="#ffe6cc" stroke="black" points="3668.5,-14494.1 3393.5,-14494.1 3393.5,-14441.1 3668.5,-14441.1 3668.5,-14494.1"/>
<text text-anchor="middle" x="3531" y="-14478.9" font-family="Helvetica,sans-Serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="3531" y="-14463.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="3531" y="-14448.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_score_1&#45;&gt;attn_weight_1 -->
<g id="edge4" class="edge">
<title>attn_score_1&#45;&gt;attn_weight_1</title>
<path fill="none" stroke="black" d="M3532.5,-14552.01C3532.5,-14552.01 3532.5,-14504.36 3532.5,-14504.36"/>
<polygon fill="black" stroke="black" points="3536,-14504.36 3532.5,-14494.36 3529,-14504.36 3536,-14504.36"/>
</g>
<!-- attn_context_1 -->
<g id="node6" class="node">
<title>attn_context_1</title>
<polygon fill="#ffe6cc" stroke="black" points="3672,-14383.1 3382,-14383.1 3382,-14330.1 3672,-14330.1 3672,-14383.1"/>
<text text-anchor="middle" x="3527" y="-14367.9" font-family="Helvetica,sans-Serif" font-size="14.00">Context</text>
<text text-anchor="middle" x="3527" y="-14352.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="3527" y="-14337.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, head_dim]</text>
</g>
<!-- attn_weight_1&#45;&gt;attn_context_1 -->
<g id="edge5" class="edge">
<title>attn_weight_1&#45;&gt;attn_context_1</title>
<path fill="none" stroke="black" d="M3531,-14441.01C3531,-14441.01 3531,-14393.36 3531,-14393.36"/>
<polygon fill="black" stroke="black" points="3534.5,-14393.36 3531,-14383.36 3527.5,-14393.36 3534.5,-14393.36"/>
</g>
<!-- attn_out_1 -->
<g id="node7" class="node">
<title>attn_out_1</title>
<polygon fill="#ffe6cc" stroke="black" points="3653.5,-14272.1 3438.5,-14272.1 3438.5,-14219.1 3653.5,-14219.1 3653.5,-14272.1"/>
<text text-anchor="middle" x="3546" y="-14256.9" font-family="Helvetica,sans-Serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="3546" y="-14241.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="3546" y="-14226.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_context_1&#45;&gt;attn_out_1 -->
<g id="edge6" class="edge">
<title>attn_context_1&#45;&gt;attn_out_1</title>
<path fill="none" stroke="black" d="M3546,-14330.01C3546,-14330.01 3546,-14282.36 3546,-14282.36"/>
<polygon fill="black" stroke="black" points="3549.5,-14282.36 3546,-14272.36 3542.5,-14282.36 3549.5,-14282.36"/>
</g>
<!-- attn_out_1&#45;&gt;residual1_1 -->
<g id="edge8" class="edge">
<title>attn_out_1&#45;&gt;residual1_1</title>
<path fill="none" stroke="black" d="M3586.5,-14219.01C3586.5,-14219.01 3586.5,-14171.36 3586.5,-14171.36"/>
<polygon fill="black" stroke="black" points="3590,-14171.36 3586.5,-14161.36 3583,-14171.36 3590,-14171.36"/>
</g>
<!-- ln2_1 -->
<g id="node9" class="node">
<title>ln2_1</title>
<polygon fill="#f8f9f9" stroke="black" points="3653.5,-14050.1 3438.5,-14050.1 3438.5,-13997.1 3653.5,-13997.1 3653.5,-14050.1"/>
<text text-anchor="middle" x="3546" y="-14034.9" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;MoE)</text>
<text text-anchor="middle" x="3546" y="-14019.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="3546" y="-14004.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_1&#45;&gt;ln2_1 -->
<g id="edge9" class="edge">
<title>residual1_1&#45;&gt;ln2_1</title>
<path fill="none" stroke="black" d="M3586.5,-14108.01C3586.5,-14108.01 3586.5,-14060.36 3586.5,-14060.36"/>
<polygon fill="black" stroke="black" points="3590,-14060.36 3586.5,-14050.36 3583,-14060.36 3590,-14060.36"/>
</g>
<!-- residual2_1 -->
<g id="node21" class="node">
<title>residual2_1</title>
<polygon fill="#fadbd8" stroke="black" points="3764.5,-13495.1 3549.5,-13495.1 3549.5,-13442.1 3764.5,-13442.1 3764.5,-13495.1"/>
<text text-anchor="middle" x="3657" y="-13479.9" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="3657" y="-13464.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="3657" y="-13449.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_1&#45;&gt;residual2_1 -->
<g id="edge29" class="edge">
<title>residual1_1&#45;&gt;residual2_1</title>
<path fill="none" stroke="black" d="M3694,-14108.08C3694,-14108.08 3694,-13505.2 3694,-13505.2"/>
<polygon fill="black" stroke="black" points="3697.5,-13505.2 3694,-13495.2 3690.5,-13505.2 3697.5,-13505.2"/>
</g>
<!-- router_1 -->
<g id="node10" class="node">
<title>router_1</title>
<polygon fill="#f5b7b1" stroke="black" points="2848,-13939.1 2648,-13939.1 2648,-13886.1 2848,-13886.1 2848,-13939.1"/>
<text text-anchor="middle" x="2748" y="-13923.9" font-family="Helvetica,sans-Serif" font-size="14.00">Router Network</text>
<text text-anchor="middle" x="2748" y="-13908.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="2748" y="-13893.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 8 experts]</text>
</g>
<!-- ln2_1&#45;&gt;router_1 -->
<g id="edge10" class="edge">
<title>ln2_1&#45;&gt;router_1</title>
<path fill="none" stroke="black" d="M3509.25,-13996.87C3509.25,-13963.85 3509.25,-13912 3509.25,-13912 3509.25,-13912 2858.3,-13912 2858.3,-13912"/>
<polygon fill="black" stroke="black" points="2858.3,-13908.5 2848.3,-13912 2858.3,-13915.5 2858.3,-13908.5"/>
</g>
<!-- expert_agg_1 -->
<g id="node20" class="node">
<title>expert_agg_1</title>
<polygon fill="#d4e6f1" stroke="black" points="2349.5,-13606.1 2134.5,-13606.1 2134.5,-13553.1 2349.5,-13553.1 2349.5,-13606.1"/>
<text text-anchor="middle" x="2242" y="-13590.9" font-family="Helvetica,sans-Serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="2242" y="-13575.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="2242" y="-13560.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- ln2_1&#45;&gt;expert_agg_1 -->
<g id="edge28" class="edge">
<title>ln2_1&#45;&gt;expert_agg_1</title>
<path fill="none" stroke="black" d="M3438.46,-14023C3126.28,-14023 2242,-14023 2242,-14023 2242,-14023 2242,-13616.34 2242,-13616.34"/>
<polygon fill="black" stroke="black" points="2245.5,-13616.34 2242,-13606.34 2238.5,-13616.34 2245.5,-13616.34"/>
</g>
<!-- gate_1 -->
<g id="node11" class="node">
<title>gate_1</title>
<polygon fill="#f5b7b1" stroke="black" points="2087.5,-13828.1 1944.5,-13828.1 1944.5,-13775.1 2087.5,-13775.1 2087.5,-13828.1"/>
<text text-anchor="middle" x="2016" y="-13812.9" font-family="Helvetica,sans-Serif" font-size="14.00">Top&#45;2 Gating</text>
<text text-anchor="middle" x="2016" y="-13797.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="2016" y="-13782.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 2]</text>
</g>
<!-- router_1&#45;&gt;gate_1 -->
<g id="edge11" class="edge">
<title>router_1&#45;&gt;gate_1</title>
<path fill="none" stroke="black" d="M2662,-13885.97C2662,-13857.68 2662,-13817 2662,-13817 2662,-13817 2097.6,-13817 2097.6,-13817"/>
<polygon fill="black" stroke="black" points="2097.6,-13813.5 2087.6,-13817 2097.6,-13820.5 2097.6,-13813.5"/>
</g>
<!-- expert_1_0 -->
<g id="node12" class="node">
<title>expert_1_0</title>
<polygon fill="#e8daef" stroke="black" points="416,-13717.1 0,-13717.1 0,-13664.1 416,-13664.1 416,-13717.1"/>
<text text-anchor="middle" x="208" y="-13701.9" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="208" y="-13686.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="208" y="-13671.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_1&#45;&gt;expert_1_0 -->
<g id="edge12" class="edge">
<title>gate_1&#45;&gt;expert_1_0</title>
<path fill="none" stroke="black" d="M1944.29,-13817C1608.52,-13817 208,-13817 208,-13817 208,-13817 208,-13727.41 208,-13727.41"/>
<polygon fill="black" stroke="black" points="211.5,-13727.41 208,-13717.41 204.5,-13727.41 211.5,-13727.41"/>
</g>
<!-- expert_1_1 -->
<g id="node13" class="node">
<title>expert_1_1</title>
<polygon fill="#e8daef" stroke="black" points="868,-13717.1 452,-13717.1 452,-13664.1 868,-13664.1 868,-13717.1"/>
<text text-anchor="middle" x="660" y="-13701.9" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="660" y="-13686.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="660" y="-13671.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_1&#45;&gt;expert_1_1 -->
<g id="edge14" class="edge">
<title>gate_1&#45;&gt;expert_1_1</title>
<path fill="none" stroke="black" d="M1944.05,-13806C1663.72,-13806 660,-13806 660,-13806 660,-13806 660,-13727.37 660,-13727.37"/>
<polygon fill="black" stroke="black" points="663.5,-13727.37 660,-13717.37 656.5,-13727.37 663.5,-13727.37"/>
</g>
<!-- expert_1_2 -->
<g id="node14" class="node">
<title>expert_1_2</title>
<polygon fill="#e8daef" stroke="black" points="1320,-13717.1 904,-13717.1 904,-13664.1 1320,-13664.1 1320,-13717.1"/>
<text text-anchor="middle" x="1112" y="-13701.9" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="1112" y="-13686.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="1112" y="-13671.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_1&#45;&gt;expert_1_2 -->
<g id="edge16" class="edge">
<title>gate_1&#45;&gt;expert_1_2</title>
<path fill="none" stroke="black" d="M1944.31,-13796C1730.49,-13796 1112,-13796 1112,-13796 1112,-13796 1112,-13727.2 1112,-13727.2"/>
<polygon fill="black" stroke="black" points="1115.5,-13727.2 1112,-13717.2 1108.5,-13727.2 1115.5,-13727.2"/>
</g>
<!-- expert_1_3 -->
<g id="node15" class="node">
<title>expert_1_3</title>
<polygon fill="#e8daef" stroke="black" points="1772,-13717.1 1356,-13717.1 1356,-13664.1 1772,-13664.1 1772,-13717.1"/>
<text text-anchor="middle" x="1564" y="-13701.9" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1564" y="-13686.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="1564" y="-13671.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_1&#45;&gt;expert_1_3 -->
<g id="edge18" class="edge">
<title>gate_1&#45;&gt;expert_1_3</title>
<path fill="none" stroke="black" d="M1944.38,-13785C1816.93,-13785 1564,-13785 1564,-13785 1564,-13785 1564,-13727.15 1564,-13727.15"/>
<polygon fill="black" stroke="black" points="1567.5,-13727.15 1564,-13717.15 1560.5,-13727.15 1567.5,-13727.15"/>
</g>
<!-- expert_1_4 -->
<g id="node16" class="node">
<title>expert_1_4</title>
<polygon fill="#e8daef" stroke="black" points="2224,-13717.1 1808,-13717.1 1808,-13664.1 2224,-13664.1 2224,-13717.1"/>
<text text-anchor="middle" x="2016" y="-13701.9" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="2016" y="-13686.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="2016" y="-13671.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_1&#45;&gt;expert_1_4 -->
<g id="edge20" class="edge">
<title>gate_1&#45;&gt;expert_1_4</title>
<path fill="none" stroke="black" d="M2016,-13775.01C2016,-13775.01 2016,-13727.36 2016,-13727.36"/>
<polygon fill="black" stroke="black" points="2019.5,-13727.36 2016,-13717.36 2012.5,-13727.36 2019.5,-13727.36"/>
</g>
<!-- expert_1_5 -->
<g id="node17" class="node">
<title>expert_1_5</title>
<polygon fill="#e8daef" stroke="black" points="2676,-13717.1 2260,-13717.1 2260,-13664.1 2676,-13664.1 2676,-13717.1"/>
<text text-anchor="middle" x="2468" y="-13701.9" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="2468" y="-13686.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="2468" y="-13671.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_1&#45;&gt;expert_1_5 -->
<g id="edge22" class="edge">
<title>gate_1&#45;&gt;expert_1_5</title>
<path fill="none" stroke="black" d="M2087.84,-13785C2212.1,-13785 2454,-13785 2454,-13785 2454,-13785 2454,-13727.15 2454,-13727.15"/>
<polygon fill="black" stroke="black" points="2457.5,-13727.15 2454,-13717.15 2450.5,-13727.15 2457.5,-13727.15"/>
</g>
<!-- expert_1_6 -->
<g id="node18" class="node">
<title>expert_1_6</title>
<polygon fill="#e8daef" stroke="black" points="3128,-13717.1 2712,-13717.1 2712,-13664.1 3128,-13664.1 3128,-13717.1"/>
<text text-anchor="middle" x="2920" y="-13701.9" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="2920" y="-13686.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="2920" y="-13671.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_1&#45;&gt;expert_1_6 -->
<g id="edge24" class="edge">
<title>gate_1&#45;&gt;expert_1_6</title>
<path fill="none" stroke="black" d="M2087.53,-13796C2277.46,-13796 2780,-13796 2780,-13796 2780,-13796 2780,-13727.2 2780,-13727.2"/>
<polygon fill="black" stroke="black" points="2783.5,-13727.2 2780,-13717.2 2776.5,-13727.2 2783.5,-13727.2"/>
</g>
<!-- expert_1_7 -->
<g id="node19" class="node">
<title>expert_1_7</title>
<polygon fill="#e8daef" stroke="black" points="3580,-13717.1 3164,-13717.1 3164,-13664.1 3580,-13664.1 3580,-13717.1"/>
<text text-anchor="middle" x="3372" y="-13701.9" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="3372" y="-13686.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="3372" y="-13671.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_1&#45;&gt;expert_1_7 -->
<g id="edge26" class="edge">
<title>gate_1&#45;&gt;expert_1_7</title>
<path fill="none" stroke="black" d="M2087.64,-13806C2354.14,-13806 3273,-13806 3273,-13806 3273,-13806 3273,-13727.37 3273,-13727.37"/>
<polygon fill="black" stroke="black" points="3276.5,-13727.37 3273,-13717.37 3269.5,-13727.37 3276.5,-13727.37"/>
</g>
<!-- expert_1_0&#45;&gt;expert_agg_1 -->
<g id="edge13" class="edge">
<title>expert_1_0&#45;&gt;expert_agg_1</title>
<path fill="none" stroke="black" d="M297,-13663.85C297,-13626.44 297,-13563 297,-13563 297,-13563 2124.31,-13563 2124.31,-13563"/>
<polygon fill="black" stroke="black" points="2124.31,-13566.5 2134.31,-13563 2124.31,-13559.5 2124.31,-13566.5"/>
</g>
<!-- expert_1_1&#45;&gt;expert_agg_1 -->
<g id="edge15" class="edge">
<title>expert_1_1&#45;&gt;expert_agg_1</title>
<path fill="none" stroke="black" d="M749,-13663.85C749,-13629.43 749,-13574 749,-13574 749,-13574 2124.33,-13574 2124.33,-13574"/>
<polygon fill="black" stroke="black" points="2124.33,-13577.5 2134.33,-13574 2124.33,-13570.5 2124.33,-13577.5"/>
</g>
<!-- expert_1_2&#45;&gt;expert_agg_1 -->
<g id="edge17" class="edge">
<title>expert_1_2&#45;&gt;expert_agg_1</title>
<path fill="none" stroke="black" d="M1201,-13663.98C1201,-13632.4 1201,-13584 1201,-13584 1201,-13584 2124.03,-13584 2124.03,-13584"/>
<polygon fill="black" stroke="black" points="2124.03,-13587.5 2134.03,-13584 2124.03,-13580.5 2124.03,-13587.5"/>
</g>
<!-- expert_1_3&#45;&gt;expert_agg_1 -->
<g id="edge19" class="edge">
<title>expert_1_3&#45;&gt;expert_agg_1</title>
<path fill="none" stroke="black" d="M1653,-13663.97C1653,-13635.68 1653,-13595 1653,-13595 1653,-13595 2124.31,-13595 2124.31,-13595"/>
<polygon fill="black" stroke="black" points="2124.31,-13598.5 2134.31,-13595 2124.31,-13591.5 2124.31,-13598.5"/>
</g>
<!-- expert_1_4&#45;&gt;expert_agg_1 -->
<g id="edge21" class="edge">
<title>expert_1_4&#45;&gt;expert_agg_1</title>
<path fill="none" stroke="black" d="M2179.25,-13664.01C2179.25,-13664.01 2179.25,-13616.36 2179.25,-13616.36"/>
<polygon fill="black" stroke="black" points="2182.75,-13616.36 2179.25,-13606.36 2175.75,-13616.36 2182.75,-13616.36"/>
</g>
<!-- expert_1_5&#45;&gt;expert_agg_1 -->
<g id="edge23" class="edge">
<title>expert_1_5&#45;&gt;expert_agg_1</title>
<path fill="none" stroke="black" d="M2304.75,-13664.01C2304.75,-13664.01 2304.75,-13616.36 2304.75,-13616.36"/>
<polygon fill="black" stroke="black" points="2308.25,-13616.36 2304.75,-13606.36 2301.25,-13616.36 2308.25,-13616.36"/>
</g>
<!-- expert_1_6&#45;&gt;expert_agg_1 -->
<g id="edge25" class="edge">
<title>expert_1_6&#45;&gt;expert_agg_1</title>
<path fill="none" stroke="black" d="M2769,-13663.92C2769,-13634.72 2769,-13592 2769,-13592 2769,-13592 2359.6,-13592 2359.6,-13592"/>
<polygon fill="black" stroke="black" points="2359.6,-13588.5 2349.6,-13592 2359.6,-13595.5 2359.6,-13588.5"/>
</g>
<!-- expert_1_7&#45;&gt;expert_agg_1 -->
<g id="edge27" class="edge">
<title>expert_1_7&#45;&gt;expert_agg_1</title>
<path fill="none" stroke="black" d="M3235,-13663.87C3235,-13630.85 3235,-13579 3235,-13579 3235,-13579 2359.68,-13579 2359.68,-13579"/>
<polygon fill="black" stroke="black" points="2359.68,-13575.5 2349.68,-13579 2359.68,-13582.5 2359.68,-13575.5"/>
</g>
<!-- expert_agg_1&#45;&gt;residual2_1 -->
<g id="edge30" class="edge">
<title>expert_agg_1&#45;&gt;residual2_1</title>
<path fill="none" stroke="black" d="M2349.69,-13566C2665.09,-13566 3564.75,-13566 3564.75,-13566 3564.75,-13566 3564.75,-13505.22 3564.75,-13505.22"/>
<polygon fill="black" stroke="black" points="3568.25,-13505.22 3564.75,-13495.22 3561.25,-13505.22 3568.25,-13505.22"/>
</g>
<!-- transfer_1 -->
<g id="node22" class="node">
<title>transfer_1</title>
<ellipse fill="#fadbd8" stroke="black" cx="3657" cy="-13357.23" rx="152.06" ry="26.74"/>
<text text-anchor="middle" x="3657" y="-13361.03" font-family="Helvetica,sans-Serif" font-size="14.00">Transfer to GPU 1</text>
<text text-anchor="middle" x="3657" y="-13346.03" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual2_1&#45;&gt;transfer_1 -->
<g id="edge31" class="edge">
<title>residual2_1&#45;&gt;transfer_1</title>
<path fill="none" stroke="black" d="M3657,-13441.93C3657,-13441.93 3657,-13394.46 3657,-13394.46"/>
<polygon fill="black" stroke="black" points="3660.5,-13394.46 3657,-13384.46 3653.5,-13394.46 3660.5,-13394.46"/>
</g>
<!-- residual1_2 -->
<g id="node29" class="node">
<title>residual1_2</title>
<polygon fill="#fadbd8" stroke="black" points="3912.5,-13272.36 3697.5,-13272.36 3697.5,-13219.36 3912.5,-13219.36 3912.5,-13272.36"/>
<text text-anchor="middle" x="3805" y="-13257.16" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="3805" y="-13242.16" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="3805" y="-13227.16" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- transfer_1&#45;&gt;residual1_2 -->
<g id="edge37" class="edge">
<title>transfer_1&#45;&gt;residual1_2</title>
<path fill="none" stroke="black" d="M3753.26,-13336.28C3753.26,-13336.28 3753.26,-13282.63 3753.26,-13282.63"/>
<polygon fill="black" stroke="black" points="3756.76,-13282.63 3753.26,-13272.63 3749.76,-13282.63 3756.76,-13282.63"/>
</g>
<!-- ln1_2 -->
<g id="node23" class="node">
<title>ln1_2</title>
<polygon fill="#f8f9f9" stroke="black" points="4060.5,-13939.1 3845.5,-13939.1 3845.5,-13886.1 4060.5,-13886.1 4060.5,-13939.1"/>
<text text-anchor="middle" x="3953" y="-13923.9" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="3953" y="-13908.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="3953" y="-13893.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_qkv_2 -->
<g id="node24" class="node">
<title>attn_qkv_2</title>
<polygon fill="#ffe6cc" stroke="black" points="4068,-13828.1 3838,-13828.1 3838,-13775.1 4068,-13775.1 4068,-13828.1"/>
<text text-anchor="middle" x="3953" y="-13812.9" font-family="Helvetica,sans-Serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="3953" y="-13797.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="3953" y="-13782.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 3*hidden_dim]</text>
</g>
<!-- ln1_2&#45;&gt;attn_qkv_2 -->
<g id="edge32" class="edge">
<title>ln1_2&#45;&gt;attn_qkv_2</title>
<path fill="none" stroke="black" d="M3953,-13886.01C3953,-13886.01 3953,-13838.36 3953,-13838.36"/>
<polygon fill="black" stroke="black" points="3956.5,-13838.36 3953,-13828.36 3949.5,-13838.36 3956.5,-13838.36"/>
</g>
<!-- attn_score_2 -->
<g id="node25" class="node">
<title>attn_score_2</title>
<polygon fill="#ffe6cc" stroke="black" points="4090.5,-13717.1 3815.5,-13717.1 3815.5,-13664.1 4090.5,-13664.1 4090.5,-13717.1"/>
<text text-anchor="middle" x="3953" y="-13701.9" font-family="Helvetica,sans-Serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="3953" y="-13686.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="3953" y="-13671.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_qkv_2&#45;&gt;attn_score_2 -->
<g id="edge33" class="edge">
<title>attn_qkv_2&#45;&gt;attn_score_2</title>
<path fill="none" stroke="black" d="M3953,-13775.01C3953,-13775.01 3953,-13727.36 3953,-13727.36"/>
<polygon fill="black" stroke="black" points="3956.5,-13727.36 3953,-13717.36 3949.5,-13727.36 3956.5,-13727.36"/>
</g>
<!-- attn_weight_2 -->
<g id="node26" class="node">
<title>attn_weight_2</title>
<polygon fill="#ffe6cc" stroke="black" points="4090.5,-13606.1 3815.5,-13606.1 3815.5,-13553.1 4090.5,-13553.1 4090.5,-13606.1"/>
<text text-anchor="middle" x="3953" y="-13590.9" font-family="Helvetica,sans-Serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="3953" y="-13575.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="3953" y="-13560.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_score_2&#45;&gt;attn_weight_2 -->
<g id="edge34" class="edge">
<title>attn_score_2&#45;&gt;attn_weight_2</title>
<path fill="none" stroke="black" d="M3953,-13664.01C3953,-13664.01 3953,-13616.36 3953,-13616.36"/>
<polygon fill="black" stroke="black" points="3956.5,-13616.36 3953,-13606.36 3949.5,-13616.36 3956.5,-13616.36"/>
</g>
<!-- attn_context_2 -->
<g id="node27" class="node">
<title>attn_context_2</title>
<polygon fill="#ffe6cc" stroke="black" points="4098,-13495.1 3808,-13495.1 3808,-13442.1 4098,-13442.1 4098,-13495.1"/>
<text text-anchor="middle" x="3953" y="-13479.9" font-family="Helvetica,sans-Serif" font-size="14.00">Context</text>
<text text-anchor="middle" x="3953" y="-13464.9" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="3953" y="-13449.9" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, head_dim]</text>
</g>
<!-- attn_weight_2&#45;&gt;attn_context_2 -->
<g id="edge35" class="edge">
<title>attn_weight_2&#45;&gt;attn_context_2</title>
<path fill="none" stroke="black" d="M3953,-13553.01C3953,-13553.01 3953,-13505.36 3953,-13505.36"/>
<polygon fill="black" stroke="black" points="3956.5,-13505.36 3953,-13495.36 3949.5,-13505.36 3956.5,-13505.36"/>
</g>
<!-- attn_out_2 -->
<g id="node28" class="node">
<title>attn_out_2</title>
<polygon fill="#ffe6cc" stroke="black" points="4060.5,-13383.73 3845.5,-13383.73 3845.5,-13330.73 4060.5,-13330.73 4060.5,-13383.73"/>
<text text-anchor="middle" x="3953" y="-13368.53" font-family="Helvetica,sans-Serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="3953" y="-13353.53" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="3953" y="-13338.53" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_context_2&#45;&gt;attn_out_2 -->
<g id="edge36" class="edge">
<title>attn_context_2&#45;&gt;attn_out_2</title>
<path fill="none" stroke="black" d="M3953,-13441.93C3953,-13441.93 3953,-13394.08 3953,-13394.08"/>
<polygon fill="black" stroke="black" points="3956.5,-13394.08 3953,-13384.08 3949.5,-13394.08 3956.5,-13394.08"/>
</g>
<!-- attn_out_2&#45;&gt;residual1_2 -->
<g id="edge38" class="edge">
<title>attn_out_2&#45;&gt;residual1_2</title>
<path fill="none" stroke="black" d="M3879,-13330.56C3879,-13330.56 3879,-13282.71 3879,-13282.71"/>
<polygon fill="black" stroke="black" points="3882.5,-13282.71 3879,-13272.71 3875.5,-13282.71 3882.5,-13282.71"/>
</g>
<!-- ln2_2 -->
<g id="node30" class="node">
<title>ln2_2</title>
<polygon fill="#f8f9f9" stroke="black" points="3831.5,-13161.36 3616.5,-13161.36 3616.5,-13108.36 3831.5,-13108.36 3831.5,-13161.36"/>
<text text-anchor="middle" x="3724" y="-13146.16" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;MoE)</text>
<text text-anchor="middle" x="3724" y="-13131.16" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="3724" y="-13116.16" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_2&#45;&gt;ln2_2 -->
<g id="edge39" class="edge">
<title>residual1_2&#45;&gt;ln2_2</title>
<path fill="none" stroke="black" d="M3764.5,-13219.27C3764.5,-13219.27 3764.5,-13171.62 3764.5,-13171.62"/>
<polygon fill="black" stroke="black" points="3768,-13171.62 3764.5,-13161.62 3761,-13171.62 3768,-13171.62"/>
</g>
<!-- residual2_2 -->
<g id="node42" class="node">
<title>residual2_2</title>
<polygon fill="#fadbd8" stroke="black" points="3942.5,-12606.36 3727.5,-12606.36 3727.5,-12553.36 3942.5,-12553.36 3942.5,-12606.36"/>
<text text-anchor="middle" x="3835" y="-12591.16" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="3835" y="-12576.16" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="3835" y="-12561.16" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_2&#45;&gt;residual2_2 -->
<g id="edge59" class="edge">
<title>residual1_2&#45;&gt;residual2_2</title>
<path fill="none" stroke="black" d="M3872,-13219.34C3872,-13219.34 3872,-12616.46 3872,-12616.46"/>
<polygon fill="black" stroke="black" points="3875.5,-12616.46 3872,-12606.46 3868.5,-12616.46 3875.5,-12616.46"/>
</g>
<!-- router_2 -->
<g id="node31" class="node">
<title>router_2</title>
<polygon fill="#f5b7b1" stroke="black" points="3026,-13050.36 2826,-13050.36 2826,-12997.36 3026,-12997.36 3026,-13050.36"/>
<text text-anchor="middle" x="2926" y="-13035.16" font-family="Helvetica,sans-Serif" font-size="14.00">Router Network</text>
<text text-anchor="middle" x="2926" y="-13020.16" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="2926" y="-13005.16" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 8 experts]</text>
</g>
<!-- ln2_2&#45;&gt;router_2 -->
<g id="edge40" class="edge">
<title>ln2_2&#45;&gt;router_2</title>
<path fill="none" stroke="black" d="M3687.25,-13108.35C3687.25,-13075.27 3687.25,-13023 3687.25,-13023 3687.25,-13023 3036.3,-13023 3036.3,-13023"/>
<polygon fill="black" stroke="black" points="3036.3,-13019.5 3026.3,-13023 3036.3,-13026.5 3036.3,-13019.5"/>
</g>
<!-- expert_agg_2 -->
<g id="node41" class="node">
<title>expert_agg_2</title>
<polygon fill="#d4e6f1" stroke="black" points="2527.5,-12717.36 2312.5,-12717.36 2312.5,-12664.36 2527.5,-12664.36 2527.5,-12717.36"/>
<text text-anchor="middle" x="2420" y="-12702.16" font-family="Helvetica,sans-Serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="2420" y="-12687.16" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="2420" y="-12672.16" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- ln2_2&#45;&gt;expert_agg_2 -->
<g id="edge58" class="edge">
<title>ln2_2&#45;&gt;expert_agg_2</title>
<path fill="none" stroke="black" d="M3616.46,-13134C3304.28,-13134 2420,-13134 2420,-13134 2420,-13134 2420,-12727.58 2420,-12727.58"/>
<polygon fill="black" stroke="black" points="2423.5,-12727.58 2420,-12717.58 2416.5,-12727.58 2423.5,-12727.58"/>
</g>
<!-- gate_2 -->
<g id="node32" class="node">
<title>gate_2</title>
<polygon fill="#f5b7b1" stroke="black" points="2265.5,-12939.36 2122.5,-12939.36 2122.5,-12886.36 2265.5,-12886.36 2265.5,-12939.36"/>
<text text-anchor="middle" x="2194" y="-12924.16" font-family="Helvetica,sans-Serif" font-size="14.00">Top&#45;2 Gating</text>
<text text-anchor="middle" x="2194" y="-12909.16" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="2194" y="-12894.16" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 2]</text>
</g>
<!-- router_2&#45;&gt;gate_2 -->
<g id="edge41" class="edge">
<title>router_2&#45;&gt;gate_2</title>
<path fill="none" stroke="black" d="M2840,-12997.16C2840,-12968.79 2840,-12928 2840,-12928 2840,-12928 2275.6,-12928 2275.6,-12928"/>
<polygon fill="black" stroke="black" points="2275.6,-12924.5 2265.6,-12928 2275.6,-12931.5 2275.6,-12924.5"/>
</g>
<!-- expert_2_0 -->
<g id="node33" class="node">
<title>expert_2_0</title>
<polygon fill="#e8daef" stroke="black" points="594,-12828.36 178,-12828.36 178,-12775.36 594,-12775.36 594,-12828.36"/>
<text text-anchor="middle" x="386" y="-12813.16" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="386" y="-12798.16" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="386" y="-12783.16" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_2&#45;&gt;expert_2_0 -->
<g id="edge42" class="edge">
<title>gate_2&#45;&gt;expert_2_0</title>
<path fill="none" stroke="black" d="M2122.47,-12928C1803.07,-12928 523,-12928 523,-12928 523,-12928 523,-12838.61 523,-12838.61"/>
<polygon fill="black" stroke="black" points="526.5,-12838.61 523,-12828.61 519.5,-12838.61 526.5,-12838.61"/>
</g>
<!-- expert_2_1 -->
<g id="node34" class="node">
<title>expert_2_1</title>
<polygon fill="#e8daef" stroke="black" points="1046,-12828.36 630,-12828.36 630,-12775.36 1046,-12775.36 1046,-12828.36"/>
<text text-anchor="middle" x="838" y="-12813.16" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="838" y="-12798.16" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="838" y="-12783.16" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_2&#45;&gt;expert_2_1 -->
<g id="edge44" class="edge">
<title>gate_2&#45;&gt;expert_2_1</title>
<path fill="none" stroke="black" d="M2122.3,-12918C1861,-12918 975,-12918 975,-12918 975,-12918 975,-12838.51 975,-12838.51"/>
<polygon fill="black" stroke="black" points="978.5,-12838.51 975,-12828.51 971.5,-12838.51 978.5,-12838.51"/>
</g>
<!-- expert_2_2 -->
<g id="node35" class="node">
<title>expert_2_2</title>
<polygon fill="#e8daef" stroke="black" points="1498,-12828.36 1082,-12828.36 1082,-12775.36 1498,-12775.36 1498,-12828.36"/>
<text text-anchor="middle" x="1290" y="-12813.16" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="1290" y="-12798.16" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="1290" y="-12783.16" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_2&#45;&gt;expert_2_2 -->
<g id="edge46" class="edge">
<title>gate_2&#45;&gt;expert_2_2</title>
<path fill="none" stroke="black" d="M2122.19,-12907C1931.52,-12907 1427,-12907 1427,-12907 1427,-12907 1427,-12838.39 1427,-12838.39"/>
<polygon fill="black" stroke="black" points="1430.5,-12838.39 1427,-12828.39 1423.5,-12838.39 1430.5,-12838.39"/>
</g>
<!-- expert_2_3 -->
<g id="node36" class="node">
<title>expert_2_3</title>
<polygon fill="#e8daef" stroke="black" points="1950,-12828.36 1534,-12828.36 1534,-12775.36 1950,-12775.36 1950,-12828.36"/>
<text text-anchor="middle" x="1742" y="-12813.16" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1742" y="-12798.16" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="1742" y="-12783.16" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_2&#45;&gt;expert_2_3 -->
<g id="edge48" class="edge">
<title>gate_2&#45;&gt;expert_2_3</title>
<path fill="none" stroke="black" d="M2122.13,-12896C2029.16,-12896 1879,-12896 1879,-12896 1879,-12896 1879,-12838.59 1879,-12838.59"/>
<polygon fill="black" stroke="black" points="1882.5,-12838.59 1879,-12828.59 1875.5,-12838.59 1882.5,-12838.59"/>
</g>
<!-- expert_2_4 -->
<g id="node37" class="node">
<title>expert_2_4</title>
<polygon fill="#e8daef" stroke="black" points="2402,-12828.36 1986,-12828.36 1986,-12775.36 2402,-12775.36 2402,-12828.36"/>
<text text-anchor="middle" x="2194" y="-12813.16" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="2194" y="-12798.16" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="2194" y="-12783.16" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_2&#45;&gt;expert_2_4 -->
<g id="edge50" class="edge">
<title>gate_2&#45;&gt;expert_2_4</title>
<path fill="none" stroke="black" d="M2194,-12886.27C2194,-12886.27 2194,-12838.62 2194,-12838.62"/>
<polygon fill="black" stroke="black" points="2197.5,-12838.62 2194,-12828.62 2190.5,-12838.62 2197.5,-12838.62"/>
</g>
<!-- expert_2_5 -->
<g id="node38" class="node">
<title>expert_2_5</title>
<polygon fill="#e8daef" stroke="black" points="2854,-12828.36 2438,-12828.36 2438,-12775.36 2854,-12775.36 2854,-12828.36"/>
<text text-anchor="middle" x="2646" y="-12813.16" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="2646" y="-12798.16" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="2646" y="-12783.16" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_2&#45;&gt;expert_2_5 -->
<g id="edge52" class="edge">
<title>gate_2&#45;&gt;expert_2_5</title>
<path fill="none" stroke="black" d="M2265.72,-12896C2371.51,-12896 2557,-12896 2557,-12896 2557,-12896 2557,-12838.59 2557,-12838.59"/>
<polygon fill="black" stroke="black" points="2560.5,-12838.59 2557,-12828.59 2553.5,-12838.59 2560.5,-12838.59"/>
</g>
<!-- expert_2_6 -->
<g id="node39" class="node">
<title>expert_2_6</title>
<polygon fill="#e8daef" stroke="black" points="3306,-12828.36 2890,-12828.36 2890,-12775.36 3306,-12775.36 3306,-12828.36"/>
<text text-anchor="middle" x="3098" y="-12813.16" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="3098" y="-12798.16" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="3098" y="-12783.16" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_2&#45;&gt;expert_2_6 -->
<g id="edge54" class="edge">
<title>gate_2&#45;&gt;expert_2_6</title>
<path fill="none" stroke="black" d="M2265.53,-12907C2455.46,-12907 2958,-12907 2958,-12907 2958,-12907 2958,-12838.39 2958,-12838.39"/>
<polygon fill="black" stroke="black" points="2961.5,-12838.39 2958,-12828.39 2954.5,-12838.39 2961.5,-12838.39"/>
</g>
<!-- expert_2_7 -->
<g id="node40" class="node">
<title>expert_2_7</title>
<polygon fill="#e8daef" stroke="black" points="3758,-12828.36 3342,-12828.36 3342,-12775.36 3758,-12775.36 3758,-12828.36"/>
<text text-anchor="middle" x="3550" y="-12813.16" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="3550" y="-12798.16" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="3550" y="-12783.16" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_2&#45;&gt;expert_2_7 -->
<g id="edge56" class="edge">
<title>gate_2&#45;&gt;expert_2_7</title>
<path fill="none" stroke="black" d="M2265.87,-12918C2528.84,-12918 3423.49,-12918 3423.49,-12918 3423.49,-12918 3423.49,-12838.51 3423.49,-12838.51"/>
<polygon fill="black" stroke="black" points="3426.99,-12838.51 3423.49,-12828.51 3419.99,-12838.51 3426.99,-12838.51"/>
</g>
<!-- expert_2_0&#45;&gt;expert_agg_2 -->
<g id="edge43" class="edge">
<title>expert_2_0&#45;&gt;expert_agg_2</title>
<path fill="none" stroke="black" d="M475,-12775.06C475,-12737.56 475,-12674 475,-12674 475,-12674 2302.31,-12674 2302.31,-12674"/>
<polygon fill="black" stroke="black" points="2302.31,-12677.5 2312.31,-12674 2302.31,-12670.5 2302.31,-12677.5"/>
</g>
<!-- expert_2_1&#45;&gt;expert_agg_2 -->
<g id="edge45" class="edge">
<title>expert_2_1&#45;&gt;expert_agg_2</title>
<path fill="none" stroke="black" d="M927,-12775.34C927,-12740.86 927,-12685 927,-12685 927,-12685 2302.33,-12685 2302.33,-12685"/>
<polygon fill="black" stroke="black" points="2302.33,-12688.5 2312.33,-12685 2302.33,-12681.5 2302.33,-12688.5"/>
</g>
<!-- expert_2_2&#45;&gt;expert_agg_2 -->
<g id="edge47" class="edge">
<title>expert_2_2&#45;&gt;expert_agg_2</title>
<path fill="none" stroke="black" d="M1379,-12775.15C1379,-12743.79 1379,-12696 1379,-12696 1379,-12696 2302.03,-12696 2302.03,-12696"/>
<polygon fill="black" stroke="black" points="2302.03,-12699.5 2312.03,-12696 2302.03,-12692.5 2302.03,-12699.5"/>
</g>
<!-- expert_2_3&#45;&gt;expert_agg_2 -->
<g id="edge49" class="edge">
<title>expert_2_3&#45;&gt;expert_agg_2</title>
<path fill="none" stroke="black" d="M1831,-12775.16C1831,-12746.79 1831,-12706 1831,-12706 1831,-12706 2302.31,-12706 2302.31,-12706"/>
<polygon fill="black" stroke="black" points="2302.31,-12709.5 2312.31,-12706 2302.31,-12702.5 2302.31,-12709.5"/>
</g>
<!-- expert_2_4&#45;&gt;expert_agg_2 -->
<g id="edge51" class="edge">
<title>expert_2_4&#45;&gt;expert_agg_2</title>
<path fill="none" stroke="black" d="M2357.25,-12775.27C2357.25,-12775.27 2357.25,-12727.62 2357.25,-12727.62"/>
<polygon fill="black" stroke="black" points="2360.75,-12727.62 2357.25,-12717.62 2353.75,-12727.62 2360.75,-12727.62"/>
</g>
<!-- expert_2_5&#45;&gt;expert_agg_2 -->
<g id="edge53" class="edge">
<title>expert_2_5&#45;&gt;expert_agg_2</title>
<path fill="none" stroke="black" d="M2482.75,-12775.27C2482.75,-12775.27 2482.75,-12727.62 2482.75,-12727.62"/>
<polygon fill="black" stroke="black" points="2486.25,-12727.62 2482.75,-12717.62 2479.25,-12727.62 2486.25,-12727.62"/>
</g>
<!-- expert_2_6&#45;&gt;expert_agg_2 -->
<g id="edge55" class="edge">
<title>expert_2_6&#45;&gt;expert_agg_2</title>
<path fill="none" stroke="black" d="M2947,-12775.12C2947,-12746.15 2947,-12704 2947,-12704 2947,-12704 2537.6,-12704 2537.6,-12704"/>
<polygon fill="black" stroke="black" points="2537.6,-12700.5 2527.6,-12704 2537.6,-12707.5 2537.6,-12700.5"/>
</g>
<!-- expert_2_7&#45;&gt;expert_agg_2 -->
<g id="edge57" class="edge">
<title>expert_2_7&#45;&gt;expert_agg_2</title>
<path fill="none" stroke="black" d="M3413,-12775.35C3413,-12742.27 3413,-12690 3413,-12690 3413,-12690 2537.68,-12690 2537.68,-12690"/>
<polygon fill="black" stroke="black" points="2537.68,-12686.5 2527.68,-12690 2537.68,-12693.5 2537.68,-12686.5"/>
</g>
<!-- expert_agg_2&#45;&gt;residual2_2 -->
<g id="edge60" class="edge">
<title>expert_agg_2&#45;&gt;residual2_2</title>
<path fill="none" stroke="black" d="M2527.69,-12677C2843.09,-12677 3742.75,-12677 3742.75,-12677 3742.75,-12677 3742.75,-12616.41 3742.75,-12616.41"/>
<polygon fill="black" stroke="black" points="3746.25,-12616.41 3742.75,-12606.41 3739.25,-12616.41 3746.25,-12616.41"/>
</g>
<!-- transfer_2 -->
<g id="node43" class="node">
<title>transfer_2</title>
<ellipse fill="#fadbd8" stroke="black" cx="3835" cy="-12468.49" rx="152.06" ry="26.74"/>
<text text-anchor="middle" x="3835" y="-12472.29" font-family="Helvetica,sans-Serif" font-size="14.00">Transfer to GPU 2</text>
<text text-anchor="middle" x="3835" y="-12457.29" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual2_2&#45;&gt;transfer_2 -->
<g id="edge61" class="edge">
<title>residual2_2&#45;&gt;transfer_2</title>
<path fill="none" stroke="black" d="M3835,-12553.19C3835,-12553.19 3835,-12505.72 3835,-12505.72"/>
<polygon fill="black" stroke="black" points="3838.5,-12505.72 3835,-12495.72 3831.5,-12505.72 3838.5,-12505.72"/>
</g>
<!-- residual1_3 -->
<g id="node50" class="node">
<title>residual1_3</title>
<polygon fill="#fadbd8" stroke="black" points="4090.5,-12383.62 3875.5,-12383.62 3875.5,-12330.62 4090.5,-12330.62 4090.5,-12383.62"/>
<text text-anchor="middle" x="3983" y="-12368.42" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="3983" y="-12353.42" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="3983" y="-12338.42" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- transfer_2&#45;&gt;residual1_3 -->
<g id="edge67" class="edge">
<title>transfer_2&#45;&gt;residual1_3</title>
<path fill="none" stroke="black" d="M3931.26,-12447.54C3931.26,-12447.54 3931.26,-12393.89 3931.26,-12393.89"/>
<polygon fill="black" stroke="black" points="3934.76,-12393.89 3931.26,-12383.89 3927.76,-12393.89 3934.76,-12393.89"/>
</g>
<!-- ln1_3 -->
<g id="node44" class="node">
<title>ln1_3</title>
<polygon fill="#f8f9f9" stroke="black" points="4238.5,-13050.36 4023.5,-13050.36 4023.5,-12997.36 4238.5,-12997.36 4238.5,-13050.36"/>
<text text-anchor="middle" x="4131" y="-13035.16" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="4131" y="-13020.16" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="4131" y="-13005.16" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_qkv_3 -->
<g id="node45" class="node">
<title>attn_qkv_3</title>
<polygon fill="#ffe6cc" stroke="black" points="4246,-12939.36 4016,-12939.36 4016,-12886.36 4246,-12886.36 4246,-12939.36"/>
<text text-anchor="middle" x="4131" y="-12924.16" font-family="Helvetica,sans-Serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="4131" y="-12909.16" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="4131" y="-12894.16" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 3*hidden_dim]</text>
</g>
<!-- ln1_3&#45;&gt;attn_qkv_3 -->
<g id="edge62" class="edge">
<title>ln1_3&#45;&gt;attn_qkv_3</title>
<path fill="none" stroke="black" d="M4131,-12997.27C4131,-12997.27 4131,-12949.62 4131,-12949.62"/>
<polygon fill="black" stroke="black" points="4134.5,-12949.62 4131,-12939.62 4127.5,-12949.62 4134.5,-12949.62"/>
</g>
<!-- attn_score_3 -->
<g id="node46" class="node">
<title>attn_score_3</title>
<polygon fill="#ffe6cc" stroke="black" points="4268.5,-12828.36 3993.5,-12828.36 3993.5,-12775.36 4268.5,-12775.36 4268.5,-12828.36"/>
<text text-anchor="middle" x="4131" y="-12813.16" font-family="Helvetica,sans-Serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="4131" y="-12798.16" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="4131" y="-12783.16" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_qkv_3&#45;&gt;attn_score_3 -->
<g id="edge63" class="edge">
<title>attn_qkv_3&#45;&gt;attn_score_3</title>
<path fill="none" stroke="black" d="M4131,-12886.27C4131,-12886.27 4131,-12838.62 4131,-12838.62"/>
<polygon fill="black" stroke="black" points="4134.5,-12838.62 4131,-12828.62 4127.5,-12838.62 4134.5,-12838.62"/>
</g>
<!-- attn_weight_3 -->
<g id="node47" class="node">
<title>attn_weight_3</title>
<polygon fill="#ffe6cc" stroke="black" points="4268.5,-12717.36 3993.5,-12717.36 3993.5,-12664.36 4268.5,-12664.36 4268.5,-12717.36"/>
<text text-anchor="middle" x="4131" y="-12702.16" font-family="Helvetica,sans-Serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="4131" y="-12687.16" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="4131" y="-12672.16" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_score_3&#45;&gt;attn_weight_3 -->
<g id="edge64" class="edge">
<title>attn_score_3&#45;&gt;attn_weight_3</title>
<path fill="none" stroke="black" d="M4131,-12775.27C4131,-12775.27 4131,-12727.62 4131,-12727.62"/>
<polygon fill="black" stroke="black" points="4134.5,-12727.62 4131,-12717.62 4127.5,-12727.62 4134.5,-12727.62"/>
</g>
<!-- attn_context_3 -->
<g id="node48" class="node">
<title>attn_context_3</title>
<polygon fill="#ffe6cc" stroke="black" points="4276,-12606.36 3986,-12606.36 3986,-12553.36 4276,-12553.36 4276,-12606.36"/>
<text text-anchor="middle" x="4131" y="-12591.16" font-family="Helvetica,sans-Serif" font-size="14.00">Context</text>
<text text-anchor="middle" x="4131" y="-12576.16" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="4131" y="-12561.16" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, head_dim]</text>
</g>
<!-- attn_weight_3&#45;&gt;attn_context_3 -->
<g id="edge65" class="edge">
<title>attn_weight_3&#45;&gt;attn_context_3</title>
<path fill="none" stroke="black" d="M4131,-12664.27C4131,-12664.27 4131,-12616.62 4131,-12616.62"/>
<polygon fill="black" stroke="black" points="4134.5,-12616.62 4131,-12606.62 4127.5,-12616.62 4134.5,-12616.62"/>
</g>
<!-- attn_out_3 -->
<g id="node49" class="node">
<title>attn_out_3</title>
<polygon fill="#ffe6cc" stroke="black" points="4238.5,-12494.99 4023.5,-12494.99 4023.5,-12441.99 4238.5,-12441.99 4238.5,-12494.99"/>
<text text-anchor="middle" x="4131" y="-12479.79" font-family="Helvetica,sans-Serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="4131" y="-12464.79" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="4131" y="-12449.79" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_context_3&#45;&gt;attn_out_3 -->
<g id="edge66" class="edge">
<title>attn_context_3&#45;&gt;attn_out_3</title>
<path fill="none" stroke="black" d="M4131,-12553.19C4131,-12553.19 4131,-12505.34 4131,-12505.34"/>
<polygon fill="black" stroke="black" points="4134.5,-12505.34 4131,-12495.34 4127.5,-12505.34 4134.5,-12505.34"/>
</g>
<!-- attn_out_3&#45;&gt;residual1_3 -->
<g id="edge68" class="edge">
<title>attn_out_3&#45;&gt;residual1_3</title>
<path fill="none" stroke="black" d="M4057,-12441.82C4057,-12441.82 4057,-12393.97 4057,-12393.97"/>
<polygon fill="black" stroke="black" points="4060.5,-12393.97 4057,-12383.97 4053.5,-12393.97 4060.5,-12393.97"/>
</g>
<!-- ln2_3 -->
<g id="node51" class="node">
<title>ln2_3</title>
<polygon fill="#f8f9f9" stroke="black" points="4009.5,-12272.62 3794.5,-12272.62 3794.5,-12219.62 4009.5,-12219.62 4009.5,-12272.62"/>
<text text-anchor="middle" x="3902" y="-12257.42" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;MoE)</text>
<text text-anchor="middle" x="3902" y="-12242.42" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="3902" y="-12227.42" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_3&#45;&gt;ln2_3 -->
<g id="edge69" class="edge">
<title>residual1_3&#45;&gt;ln2_3</title>
<path fill="none" stroke="black" d="M3942.5,-12330.53C3942.5,-12330.53 3942.5,-12282.88 3942.5,-12282.88"/>
<polygon fill="black" stroke="black" points="3946,-12282.88 3942.5,-12272.88 3939,-12282.88 3946,-12282.88"/>
</g>
<!-- residual2_3 -->
<g id="node63" class="node">
<title>residual2_3</title>
<polygon fill="#fadbd8" stroke="black" points="4120.5,-11717.62 3905.5,-11717.62 3905.5,-11664.62 4120.5,-11664.62 4120.5,-11717.62"/>
<text text-anchor="middle" x="4013" y="-11702.42" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="4013" y="-11687.42" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="4013" y="-11672.42" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_3&#45;&gt;residual2_3 -->
<g id="edge89" class="edge">
<title>residual1_3&#45;&gt;residual2_3</title>
<path fill="none" stroke="black" d="M4050,-12330.6C4050,-12330.6 4050,-11727.72 4050,-11727.72"/>
<polygon fill="black" stroke="black" points="4053.5,-11727.72 4050,-11717.72 4046.5,-11727.72 4053.5,-11727.72"/>
</g>
<!-- router_3 -->
<g id="node52" class="node">
<title>router_3</title>
<polygon fill="#f5b7b1" stroke="black" points="3204,-12161.62 3004,-12161.62 3004,-12108.62 3204,-12108.62 3204,-12161.62"/>
<text text-anchor="middle" x="3104" y="-12146.42" font-family="Helvetica,sans-Serif" font-size="14.00">Router Network</text>
<text text-anchor="middle" x="3104" y="-12131.42" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="3104" y="-12116.42" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 8 experts]</text>
</g>
<!-- ln2_3&#45;&gt;router_3 -->
<g id="edge70" class="edge">
<title>ln2_3&#45;&gt;router_3</title>
<path fill="none" stroke="black" d="M3865.25,-12219.51C3865.25,-12186.63 3865.25,-12135 3865.25,-12135 3865.25,-12135 3214.3,-12135 3214.3,-12135"/>
<polygon fill="black" stroke="black" points="3214.3,-12131.5 3204.3,-12135 3214.3,-12138.5 3214.3,-12131.5"/>
</g>
<!-- expert_agg_3 -->
<g id="node62" class="node">
<title>expert_agg_3</title>
<polygon fill="#d4e6f1" stroke="black" points="2705.5,-11828.62 2490.5,-11828.62 2490.5,-11775.62 2705.5,-11775.62 2705.5,-11828.62"/>
<text text-anchor="middle" x="2598" y="-11813.42" font-family="Helvetica,sans-Serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="2598" y="-11798.42" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="2598" y="-11783.42" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- ln2_3&#45;&gt;expert_agg_3 -->
<g id="edge88" class="edge">
<title>ln2_3&#45;&gt;expert_agg_3</title>
<path fill="none" stroke="black" d="M3794.46,-12246C3482.28,-12246 2598,-12246 2598,-12246 2598,-12246 2598,-11838.89 2598,-11838.89"/>
<polygon fill="black" stroke="black" points="2601.5,-11838.89 2598,-11828.89 2594.5,-11838.89 2601.5,-11838.89"/>
</g>
<!-- gate_3 -->
<g id="node53" class="node">
<title>gate_3</title>
<polygon fill="#f5b7b1" stroke="black" points="2443.5,-12050.62 2300.5,-12050.62 2300.5,-11997.62 2443.5,-11997.62 2443.5,-12050.62"/>
<text text-anchor="middle" x="2372" y="-12035.42" font-family="Helvetica,sans-Serif" font-size="14.00">Top&#45;2 Gating</text>
<text text-anchor="middle" x="2372" y="-12020.42" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="2372" y="-12005.42" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 2]</text>
</g>
<!-- router_3&#45;&gt;gate_3 -->
<g id="edge71" class="edge">
<title>router_3&#45;&gt;gate_3</title>
<path fill="none" stroke="black" d="M3018,-12108.37C3018,-12080.24 3018,-12040 3018,-12040 3018,-12040 2453.6,-12040 2453.6,-12040"/>
<polygon fill="black" stroke="black" points="2453.6,-12036.5 2443.6,-12040 2453.6,-12043.5 2453.6,-12036.5"/>
</g>
<!-- expert_3_0 -->
<g id="node54" class="node">
<title>expert_3_0</title>
<polygon fill="#e8daef" stroke="black" points="772,-11939.62 356,-11939.62 356,-11886.62 772,-11886.62 772,-11939.62"/>
<text text-anchor="middle" x="564" y="-11924.42" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="564" y="-11909.42" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="564" y="-11894.42" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_3&#45;&gt;expert_3_0 -->
<g id="edge72" class="edge">
<title>gate_3&#45;&gt;expert_3_0</title>
<path fill="none" stroke="black" d="M2300.47,-12040C1981.07,-12040 701,-12040 701,-12040 701,-12040 701,-11949.72 701,-11949.72"/>
<polygon fill="black" stroke="black" points="704.5,-11949.72 701,-11939.72 697.5,-11949.72 704.5,-11949.72"/>
</g>
<!-- expert_3_1 -->
<g id="node55" class="node">
<title>expert_3_1</title>
<polygon fill="#e8daef" stroke="black" points="1224,-11939.62 808,-11939.62 808,-11886.62 1224,-11886.62 1224,-11939.62"/>
<text text-anchor="middle" x="1016" y="-11924.42" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1016" y="-11909.42" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="1016" y="-11894.42" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_3&#45;&gt;expert_3_1 -->
<g id="edge74" class="edge">
<title>gate_3&#45;&gt;expert_3_1</title>
<path fill="none" stroke="black" d="M2300.3,-12029C2039,-12029 1153,-12029 1153,-12029 1153,-12029 1153,-11949.71 1153,-11949.71"/>
<polygon fill="black" stroke="black" points="1156.5,-11949.71 1153,-11939.71 1149.5,-11949.71 1156.5,-11949.71"/>
</g>
<!-- expert_3_2 -->
<g id="node56" class="node">
<title>expert_3_2</title>
<polygon fill="#e8daef" stroke="black" points="1676,-11939.62 1260,-11939.62 1260,-11886.62 1676,-11886.62 1676,-11939.62"/>
<text text-anchor="middle" x="1468" y="-11924.42" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="1468" y="-11909.42" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="1468" y="-11894.42" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_3&#45;&gt;expert_3_2 -->
<g id="edge76" class="edge">
<title>gate_3&#45;&gt;expert_3_2</title>
<path fill="none" stroke="black" d="M2300.19,-12018C2109.52,-12018 1605,-12018 1605,-12018 1605,-12018 1605,-11949.86 1605,-11949.86"/>
<polygon fill="black" stroke="black" points="1608.5,-11949.86 1605,-11939.86 1601.5,-11949.86 1608.5,-11949.86"/>
</g>
<!-- expert_3_3 -->
<g id="node57" class="node">
<title>expert_3_3</title>
<polygon fill="#e8daef" stroke="black" points="2128,-11939.62 1712,-11939.62 1712,-11886.62 2128,-11886.62 2128,-11939.62"/>
<text text-anchor="middle" x="1920" y="-11924.42" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1920" y="-11909.42" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="1920" y="-11894.42" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_3&#45;&gt;expert_3_3 -->
<g id="edge78" class="edge">
<title>gate_3&#45;&gt;expert_3_3</title>
<path fill="none" stroke="black" d="M2300.13,-12008C2207.16,-12008 2057,-12008 2057,-12008 2057,-12008 2057,-11949.8 2057,-11949.8"/>
<polygon fill="black" stroke="black" points="2060.5,-11949.8 2057,-11939.8 2053.5,-11949.8 2060.5,-11949.8"/>
</g>
<!-- expert_3_4 -->
<g id="node58" class="node">
<title>expert_3_4</title>
<polygon fill="#e8daef" stroke="black" points="2580,-11939.62 2164,-11939.62 2164,-11886.62 2580,-11886.62 2580,-11939.62"/>
<text text-anchor="middle" x="2372" y="-11924.42" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="2372" y="-11909.42" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="2372" y="-11894.42" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_3&#45;&gt;expert_3_4 -->
<g id="edge80" class="edge">
<title>gate_3&#45;&gt;expert_3_4</title>
<path fill="none" stroke="black" d="M2372,-11997.53C2372,-11997.53 2372,-11949.88 2372,-11949.88"/>
<polygon fill="black" stroke="black" points="2375.5,-11949.88 2372,-11939.88 2368.5,-11949.88 2375.5,-11949.88"/>
</g>
<!-- expert_3_5 -->
<g id="node59" class="node">
<title>expert_3_5</title>
<polygon fill="#e8daef" stroke="black" points="3032,-11939.62 2616,-11939.62 2616,-11886.62 3032,-11886.62 3032,-11939.62"/>
<text text-anchor="middle" x="2824" y="-11924.42" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="2824" y="-11909.42" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="2824" y="-11894.42" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_3&#45;&gt;expert_3_5 -->
<g id="edge82" class="edge">
<title>gate_3&#45;&gt;expert_3_5</title>
<path fill="none" stroke="black" d="M2443.72,-12008C2549.51,-12008 2735,-12008 2735,-12008 2735,-12008 2735,-11949.8 2735,-11949.8"/>
<polygon fill="black" stroke="black" points="2738.5,-11949.8 2735,-11939.8 2731.5,-11949.8 2738.5,-11949.8"/>
</g>
<!-- expert_3_6 -->
<g id="node60" class="node">
<title>expert_3_6</title>
<polygon fill="#e8daef" stroke="black" points="3484,-11939.62 3068,-11939.62 3068,-11886.62 3484,-11886.62 3484,-11939.62"/>
<text text-anchor="middle" x="3276" y="-11924.42" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="3276" y="-11909.42" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="3276" y="-11894.42" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_3&#45;&gt;expert_3_6 -->
<g id="edge84" class="edge">
<title>gate_3&#45;&gt;expert_3_6</title>
<path fill="none" stroke="black" d="M2443.53,-12018C2633.46,-12018 3136,-12018 3136,-12018 3136,-12018 3136,-11949.86 3136,-11949.86"/>
<polygon fill="black" stroke="black" points="3139.5,-11949.86 3136,-11939.86 3132.5,-11949.86 3139.5,-11949.86"/>
</g>
<!-- expert_3_7 -->
<g id="node61" class="node">
<title>expert_3_7</title>
<polygon fill="#e8daef" stroke="black" points="3936,-11939.62 3520,-11939.62 3520,-11886.62 3936,-11886.62 3936,-11939.62"/>
<text text-anchor="middle" x="3728" y="-11924.42" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="3728" y="-11909.42" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="3728" y="-11894.42" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_3&#45;&gt;expert_3_7 -->
<g id="edge86" class="edge">
<title>gate_3&#45;&gt;expert_3_7</title>
<path fill="none" stroke="black" d="M2443.87,-12029C2706.84,-12029 3601.49,-12029 3601.49,-12029 3601.49,-12029 3601.49,-11949.71 3601.49,-11949.71"/>
<polygon fill="black" stroke="black" points="3604.99,-11949.71 3601.49,-11939.71 3597.99,-11949.71 3604.99,-11949.71"/>
</g>
<!-- expert_3_0&#45;&gt;expert_agg_3 -->
<g id="edge73" class="edge">
<title>expert_3_0&#45;&gt;expert_agg_3</title>
<path fill="none" stroke="black" d="M653,-11886.47C653,-11849.2 653,-11786 653,-11786 653,-11786 2480.31,-11786 2480.31,-11786"/>
<polygon fill="black" stroke="black" points="2480.31,-11789.5 2490.31,-11786 2480.31,-11782.5 2480.31,-11789.5"/>
</g>
<!-- expert_3_1&#45;&gt;expert_agg_3 -->
<g id="edge75" class="edge">
<title>expert_3_1&#45;&gt;expert_agg_3</title>
<path fill="none" stroke="black" d="M1105,-11886.54C1105,-11851.99 1105,-11796 1105,-11796 1105,-11796 2480.33,-11796 2480.33,-11796"/>
<polygon fill="black" stroke="black" points="2480.33,-11799.5 2490.33,-11796 2480.33,-11792.5 2480.33,-11799.5"/>
</g>
<!-- expert_3_2&#45;&gt;expert_agg_3 -->
<g id="edge77" class="edge">
<title>expert_3_2&#45;&gt;expert_agg_3</title>
<path fill="none" stroke="black" d="M1557,-11886.62C1557,-11855.18 1557,-11807 1557,-11807 1557,-11807 2480.03,-11807 2480.03,-11807"/>
<polygon fill="black" stroke="black" points="2480.03,-11810.5 2490.03,-11807 2480.03,-11803.5 2480.03,-11810.5"/>
</g>
<!-- expert_3_3&#45;&gt;expert_agg_3 -->
<g id="edge79" class="edge">
<title>expert_3_3&#45;&gt;expert_agg_3</title>
<path fill="none" stroke="black" d="M2009,-11886.37C2009,-11858.24 2009,-11818 2009,-11818 2009,-11818 2480.31,-11818 2480.31,-11818"/>
<polygon fill="black" stroke="black" points="2480.31,-11821.5 2490.31,-11818 2480.31,-11814.5 2480.31,-11821.5"/>
</g>
<!-- expert_3_4&#45;&gt;expert_agg_3 -->
<g id="edge81" class="edge">
<title>expert_3_4&#45;&gt;expert_agg_3</title>
<path fill="none" stroke="black" d="M2535.25,-11886.53C2535.25,-11886.53 2535.25,-11838.88 2535.25,-11838.88"/>
<polygon fill="black" stroke="black" points="2538.75,-11838.88 2535.25,-11828.88 2531.75,-11838.88 2538.75,-11838.88"/>
</g>
<!-- expert_3_5&#45;&gt;expert_agg_3 -->
<g id="edge83" class="edge">
<title>expert_3_5&#45;&gt;expert_agg_3</title>
<path fill="none" stroke="black" d="M2660.75,-11886.53C2660.75,-11886.53 2660.75,-11838.88 2660.75,-11838.88"/>
<polygon fill="black" stroke="black" points="2664.25,-11838.88 2660.75,-11828.88 2657.25,-11838.88 2664.25,-11838.88"/>
</g>
<!-- expert_3_6&#45;&gt;expert_agg_3 -->
<g id="edge85" class="edge">
<title>expert_3_6&#45;&gt;expert_agg_3</title>
<path fill="none" stroke="black" d="M3125,-11886.57C3125,-11857.51 3125,-11815 3125,-11815 3125,-11815 2715.6,-11815 2715.6,-11815"/>
<polygon fill="black" stroke="black" points="2715.6,-11811.5 2705.6,-11815 2715.6,-11818.5 2715.6,-11811.5"/>
</g>
<!-- expert_3_7&#45;&gt;expert_agg_3 -->
<g id="edge87" class="edge">
<title>expert_3_7&#45;&gt;expert_agg_3</title>
<path fill="none" stroke="black" d="M3591,-11886.51C3591,-11853.63 3591,-11802 3591,-11802 3591,-11802 2715.68,-11802 2715.68,-11802"/>
<polygon fill="black" stroke="black" points="2715.68,-11798.5 2705.68,-11802 2715.68,-11805.5 2715.68,-11798.5"/>
</g>
<!-- expert_agg_3&#45;&gt;residual2_3 -->
<g id="edge90" class="edge">
<title>expert_agg_3&#45;&gt;residual2_3</title>
<path fill="none" stroke="black" d="M2705.69,-11788C3021.09,-11788 3920.75,-11788 3920.75,-11788 3920.75,-11788 3920.75,-11727.85 3920.75,-11727.85"/>
<polygon fill="black" stroke="black" points="3924.25,-11727.85 3920.75,-11717.85 3917.25,-11727.85 3924.25,-11727.85"/>
</g>
<!-- transfer_3 -->
<g id="node64" class="node">
<title>transfer_3</title>
<ellipse fill="#fadbd8" stroke="black" cx="4013" cy="-11579.75" rx="152.06" ry="26.74"/>
<text text-anchor="middle" x="4013" y="-11583.55" font-family="Helvetica,sans-Serif" font-size="14.00">Transfer to GPU 3</text>
<text text-anchor="middle" x="4013" y="-11568.55" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual2_3&#45;&gt;transfer_3 -->
<g id="edge91" class="edge">
<title>residual2_3&#45;&gt;transfer_3</title>
<path fill="none" stroke="black" d="M4013,-11664.45C4013,-11664.45 4013,-11616.98 4013,-11616.98"/>
<polygon fill="black" stroke="black" points="4016.5,-11616.98 4013,-11606.98 4009.5,-11616.98 4016.5,-11616.98"/>
</g>
<!-- residual1_4 -->
<g id="node71" class="node">
<title>residual1_4</title>
<polygon fill="#fadbd8" stroke="black" points="4268.5,-11494.88 4053.5,-11494.88 4053.5,-11441.88 4268.5,-11441.88 4268.5,-11494.88"/>
<text text-anchor="middle" x="4161" y="-11479.68" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="4161" y="-11464.68" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="4161" y="-11449.68" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- transfer_3&#45;&gt;residual1_4 -->
<g id="edge97" class="edge">
<title>transfer_3&#45;&gt;residual1_4</title>
<path fill="none" stroke="black" d="M4109.26,-11558.8C4109.26,-11558.8 4109.26,-11505.15 4109.26,-11505.15"/>
<polygon fill="black" stroke="black" points="4112.76,-11505.15 4109.26,-11495.15 4105.76,-11505.15 4112.76,-11505.15"/>
</g>
<!-- ln1_4 -->
<g id="node65" class="node">
<title>ln1_4</title>
<polygon fill="#f8f9f9" stroke="black" points="4416.5,-12161.62 4201.5,-12161.62 4201.5,-12108.62 4416.5,-12108.62 4416.5,-12161.62"/>
<text text-anchor="middle" x="4309" y="-12146.42" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="4309" y="-12131.42" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="4309" y="-12116.42" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_qkv_4 -->
<g id="node66" class="node">
<title>attn_qkv_4</title>
<polygon fill="#ffe6cc" stroke="black" points="4424,-12050.62 4194,-12050.62 4194,-11997.62 4424,-11997.62 4424,-12050.62"/>
<text text-anchor="middle" x="4309" y="-12035.42" font-family="Helvetica,sans-Serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="4309" y="-12020.42" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="4309" y="-12005.42" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 3*hidden_dim]</text>
</g>
<!-- ln1_4&#45;&gt;attn_qkv_4 -->
<g id="edge92" class="edge">
<title>ln1_4&#45;&gt;attn_qkv_4</title>
<path fill="none" stroke="black" d="M4309,-12108.53C4309,-12108.53 4309,-12060.88 4309,-12060.88"/>
<polygon fill="black" stroke="black" points="4312.5,-12060.88 4309,-12050.88 4305.5,-12060.88 4312.5,-12060.88"/>
</g>
<!-- attn_score_4 -->
<g id="node67" class="node">
<title>attn_score_4</title>
<polygon fill="#ffe6cc" stroke="black" points="4446.5,-11939.62 4171.5,-11939.62 4171.5,-11886.62 4446.5,-11886.62 4446.5,-11939.62"/>
<text text-anchor="middle" x="4309" y="-11924.42" font-family="Helvetica,sans-Serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="4309" y="-11909.42" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="4309" y="-11894.42" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_qkv_4&#45;&gt;attn_score_4 -->
<g id="edge93" class="edge">
<title>attn_qkv_4&#45;&gt;attn_score_4</title>
<path fill="none" stroke="black" d="M4309,-11997.53C4309,-11997.53 4309,-11949.88 4309,-11949.88"/>
<polygon fill="black" stroke="black" points="4312.5,-11949.88 4309,-11939.88 4305.5,-11949.88 4312.5,-11949.88"/>
</g>
<!-- attn_weight_4 -->
<g id="node68" class="node">
<title>attn_weight_4</title>
<polygon fill="#ffe6cc" stroke="black" points="4446.5,-11828.62 4171.5,-11828.62 4171.5,-11775.62 4446.5,-11775.62 4446.5,-11828.62"/>
<text text-anchor="middle" x="4309" y="-11813.42" font-family="Helvetica,sans-Serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="4309" y="-11798.42" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="4309" y="-11783.42" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_score_4&#45;&gt;attn_weight_4 -->
<g id="edge94" class="edge">
<title>attn_score_4&#45;&gt;attn_weight_4</title>
<path fill="none" stroke="black" d="M4309,-11886.53C4309,-11886.53 4309,-11838.88 4309,-11838.88"/>
<polygon fill="black" stroke="black" points="4312.5,-11838.88 4309,-11828.88 4305.5,-11838.88 4312.5,-11838.88"/>
</g>
<!-- attn_context_4 -->
<g id="node69" class="node">
<title>attn_context_4</title>
<polygon fill="#ffe6cc" stroke="black" points="4454,-11717.62 4164,-11717.62 4164,-11664.62 4454,-11664.62 4454,-11717.62"/>
<text text-anchor="middle" x="4309" y="-11702.42" font-family="Helvetica,sans-Serif" font-size="14.00">Context</text>
<text text-anchor="middle" x="4309" y="-11687.42" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="4309" y="-11672.42" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, head_dim]</text>
</g>
<!-- attn_weight_4&#45;&gt;attn_context_4 -->
<g id="edge95" class="edge">
<title>attn_weight_4&#45;&gt;attn_context_4</title>
<path fill="none" stroke="black" d="M4309,-11775.53C4309,-11775.53 4309,-11727.88 4309,-11727.88"/>
<polygon fill="black" stroke="black" points="4312.5,-11727.88 4309,-11717.88 4305.5,-11727.88 4312.5,-11727.88"/>
</g>
<!-- attn_out_4 -->
<g id="node70" class="node">
<title>attn_out_4</title>
<polygon fill="#ffe6cc" stroke="black" points="4416.5,-11606.25 4201.5,-11606.25 4201.5,-11553.25 4416.5,-11553.25 4416.5,-11606.25"/>
<text text-anchor="middle" x="4309" y="-11591.05" font-family="Helvetica,sans-Serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="4309" y="-11576.05" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="4309" y="-11561.05" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_context_4&#45;&gt;attn_out_4 -->
<g id="edge96" class="edge">
<title>attn_context_4&#45;&gt;attn_out_4</title>
<path fill="none" stroke="black" d="M4309,-11664.45C4309,-11664.45 4309,-11616.6 4309,-11616.6"/>
<polygon fill="black" stroke="black" points="4312.5,-11616.6 4309,-11606.6 4305.5,-11616.6 4312.5,-11616.6"/>
</g>
<!-- attn_out_4&#45;&gt;residual1_4 -->
<g id="edge98" class="edge">
<title>attn_out_4&#45;&gt;residual1_4</title>
<path fill="none" stroke="black" d="M4235,-11553.08C4235,-11553.08 4235,-11505.23 4235,-11505.23"/>
<polygon fill="black" stroke="black" points="4238.5,-11505.23 4235,-11495.23 4231.5,-11505.23 4238.5,-11505.23"/>
</g>
<!-- ln2_4 -->
<g id="node72" class="node">
<title>ln2_4</title>
<polygon fill="#f8f9f9" stroke="black" points="4187.5,-11383.88 3972.5,-11383.88 3972.5,-11330.88 4187.5,-11330.88 4187.5,-11383.88"/>
<text text-anchor="middle" x="4080" y="-11368.68" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;MoE)</text>
<text text-anchor="middle" x="4080" y="-11353.68" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="4080" y="-11338.68" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_4&#45;&gt;ln2_4 -->
<g id="edge99" class="edge">
<title>residual1_4&#45;&gt;ln2_4</title>
<path fill="none" stroke="black" d="M4120.5,-11441.79C4120.5,-11441.79 4120.5,-11394.14 4120.5,-11394.14"/>
<polygon fill="black" stroke="black" points="4124,-11394.14 4120.5,-11384.14 4117,-11394.14 4124,-11394.14"/>
</g>
<!-- residual2_4 -->
<g id="node84" class="node">
<title>residual2_4</title>
<polygon fill="#fadbd8" stroke="black" points="4298.5,-10828.88 4083.5,-10828.88 4083.5,-10775.88 4298.5,-10775.88 4298.5,-10828.88"/>
<text text-anchor="middle" x="4191" y="-10813.68" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="4191" y="-10798.68" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="4191" y="-10783.68" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_4&#45;&gt;residual2_4 -->
<g id="edge119" class="edge">
<title>residual1_4&#45;&gt;residual2_4</title>
<path fill="none" stroke="black" d="M4228,-11441.86C4228,-11441.86 4228,-10838.98 4228,-10838.98"/>
<polygon fill="black" stroke="black" points="4231.5,-10838.98 4228,-10828.98 4224.5,-10838.98 4231.5,-10838.98"/>
</g>
<!-- router_4 -->
<g id="node73" class="node">
<title>router_4</title>
<polygon fill="#f5b7b1" stroke="black" points="3382,-11272.88 3182,-11272.88 3182,-11219.88 3382,-11219.88 3382,-11272.88"/>
<text text-anchor="middle" x="3282" y="-11257.68" font-family="Helvetica,sans-Serif" font-size="14.00">Router Network</text>
<text text-anchor="middle" x="3282" y="-11242.68" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="3282" y="-11227.68" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 8 experts]</text>
</g>
<!-- ln2_4&#45;&gt;router_4 -->
<g id="edge100" class="edge">
<title>ln2_4&#45;&gt;router_4</title>
<path fill="none" stroke="black" d="M4043.25,-11330.7C4043.25,-11297.75 4043.25,-11246 4043.25,-11246 4043.25,-11246 3392.3,-11246 3392.3,-11246"/>
<polygon fill="black" stroke="black" points="3392.3,-11242.5 3382.3,-11246 3392.3,-11249.5 3392.3,-11242.5"/>
</g>
<!-- expert_agg_4 -->
<g id="node83" class="node">
<title>expert_agg_4</title>
<polygon fill="#d4e6f1" stroke="black" points="2883.5,-10939.88 2668.5,-10939.88 2668.5,-10886.88 2883.5,-10886.88 2883.5,-10939.88"/>
<text text-anchor="middle" x="2776" y="-10924.68" font-family="Helvetica,sans-Serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="2776" y="-10909.68" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="2776" y="-10894.68" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- ln2_4&#45;&gt;expert_agg_4 -->
<g id="edge118" class="edge">
<title>ln2_4&#45;&gt;expert_agg_4</title>
<path fill="none" stroke="black" d="M3972.46,-11357C3660.28,-11357 2776,-11357 2776,-11357 2776,-11357 2776,-10950.13 2776,-10950.13"/>
<polygon fill="black" stroke="black" points="2779.5,-10950.13 2776,-10940.13 2772.5,-10950.13 2779.5,-10950.13"/>
</g>
<!-- gate_4 -->
<g id="node74" class="node">
<title>gate_4</title>
<polygon fill="#f5b7b1" stroke="black" points="2621.5,-11161.88 2478.5,-11161.88 2478.5,-11108.88 2621.5,-11108.88 2621.5,-11161.88"/>
<text text-anchor="middle" x="2550" y="-11146.68" font-family="Helvetica,sans-Serif" font-size="14.00">Top&#45;2 Gating</text>
<text text-anchor="middle" x="2550" y="-11131.68" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="2550" y="-11116.68" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 2]</text>
</g>
<!-- router_4&#45;&gt;gate_4 -->
<g id="edge101" class="edge">
<title>router_4&#45;&gt;gate_4</title>
<path fill="none" stroke="black" d="M3196,-11219.81C3196,-11191.59 3196,-11151 3196,-11151 3196,-11151 2631.6,-11151 2631.6,-11151"/>
<polygon fill="black" stroke="black" points="2631.6,-11147.5 2621.6,-11151 2631.6,-11154.5 2631.6,-11147.5"/>
</g>
<!-- expert_4_0 -->
<g id="node75" class="node">
<title>expert_4_0</title>
<polygon fill="#e8daef" stroke="black" points="950,-11050.88 534,-11050.88 534,-10997.88 950,-10997.88 950,-11050.88"/>
<text text-anchor="middle" x="742" y="-11035.68" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="742" y="-11020.68" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="742" y="-11005.68" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_4&#45;&gt;expert_4_0 -->
<g id="edge102" class="edge">
<title>gate_4&#45;&gt;expert_4_0</title>
<path fill="none" stroke="black" d="M2478.47,-11151C2159.07,-11151 879,-11151 879,-11151 879,-11151 879,-11060.92 879,-11060.92"/>
<polygon fill="black" stroke="black" points="882.5,-11060.92 879,-11050.92 875.5,-11060.92 882.5,-11060.92"/>
</g>
<!-- expert_4_1 -->
<g id="node76" class="node">
<title>expert_4_1</title>
<polygon fill="#e8daef" stroke="black" points="1402,-11050.88 986,-11050.88 986,-10997.88 1402,-10997.88 1402,-11050.88"/>
<text text-anchor="middle" x="1194" y="-11035.68" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1194" y="-11020.68" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="1194" y="-11005.68" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_4&#45;&gt;expert_4_1 -->
<g id="edge104" class="edge">
<title>gate_4&#45;&gt;expert_4_1</title>
<path fill="none" stroke="black" d="M2478.3,-11140C2217,-11140 1331,-11140 1331,-11140 1331,-11140 1331,-11060.91 1331,-11060.91"/>
<polygon fill="black" stroke="black" points="1334.5,-11060.91 1331,-11050.91 1327.5,-11060.91 1334.5,-11060.91"/>
</g>
<!-- expert_4_2 -->
<g id="node77" class="node">
<title>expert_4_2</title>
<polygon fill="#e8daef" stroke="black" points="1854,-11050.88 1438,-11050.88 1438,-10997.88 1854,-10997.88 1854,-11050.88"/>
<text text-anchor="middle" x="1646" y="-11035.68" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="1646" y="-11020.68" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="1646" y="-11005.68" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_4&#45;&gt;expert_4_2 -->
<g id="edge106" class="edge">
<title>gate_4&#45;&gt;expert_4_2</title>
<path fill="none" stroke="black" d="M2478.19,-11130C2287.52,-11130 1783,-11130 1783,-11130 1783,-11130 1783,-11061.03 1783,-11061.03"/>
<polygon fill="black" stroke="black" points="1786.5,-11061.03 1783,-11051.03 1779.5,-11061.03 1786.5,-11061.03"/>
</g>
<!-- expert_4_3 -->
<g id="node78" class="node">
<title>expert_4_3</title>
<polygon fill="#e8daef" stroke="black" points="2306,-11050.88 1890,-11050.88 1890,-10997.88 2306,-10997.88 2306,-11050.88"/>
<text text-anchor="middle" x="2098" y="-11035.68" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2098" y="-11020.68" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="2098" y="-11005.68" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_4&#45;&gt;expert_4_3 -->
<g id="edge108" class="edge">
<title>gate_4&#45;&gt;expert_4_3</title>
<path fill="none" stroke="black" d="M2478.13,-11119C2385.16,-11119 2235,-11119 2235,-11119 2235,-11119 2235,-11060.99 2235,-11060.99"/>
<polygon fill="black" stroke="black" points="2238.5,-11060.99 2235,-11050.99 2231.5,-11060.99 2238.5,-11060.99"/>
</g>
<!-- expert_4_4 -->
<g id="node79" class="node">
<title>expert_4_4</title>
<polygon fill="#e8daef" stroke="black" points="2758,-11050.88 2342,-11050.88 2342,-10997.88 2758,-10997.88 2758,-11050.88"/>
<text text-anchor="middle" x="2550" y="-11035.68" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="2550" y="-11020.68" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="2550" y="-11005.68" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_4&#45;&gt;expert_4_4 -->
<g id="edge110" class="edge">
<title>gate_4&#45;&gt;expert_4_4</title>
<path fill="none" stroke="black" d="M2550,-11108.79C2550,-11108.79 2550,-11061.14 2550,-11061.14"/>
<polygon fill="black" stroke="black" points="2553.5,-11061.14 2550,-11051.14 2546.5,-11061.14 2553.5,-11061.14"/>
</g>
<!-- expert_4_5 -->
<g id="node80" class="node">
<title>expert_4_5</title>
<polygon fill="#e8daef" stroke="black" points="3210,-11050.88 2794,-11050.88 2794,-10997.88 3210,-10997.88 3210,-11050.88"/>
<text text-anchor="middle" x="3002" y="-11035.68" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="3002" y="-11020.68" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="3002" y="-11005.68" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_4&#45;&gt;expert_4_5 -->
<g id="edge112" class="edge">
<title>gate_4&#45;&gt;expert_4_5</title>
<path fill="none" stroke="black" d="M2621.72,-11119C2727.51,-11119 2913,-11119 2913,-11119 2913,-11119 2913,-11060.99 2913,-11060.99"/>
<polygon fill="black" stroke="black" points="2916.5,-11060.99 2913,-11050.99 2909.5,-11060.99 2916.5,-11060.99"/>
</g>
<!-- expert_4_6 -->
<g id="node81" class="node">
<title>expert_4_6</title>
<polygon fill="#e8daef" stroke="black" points="3662,-11050.88 3246,-11050.88 3246,-10997.88 3662,-10997.88 3662,-11050.88"/>
<text text-anchor="middle" x="3454" y="-11035.68" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="3454" y="-11020.68" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="3454" y="-11005.68" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_4&#45;&gt;expert_4_6 -->
<g id="edge114" class="edge">
<title>gate_4&#45;&gt;expert_4_6</title>
<path fill="none" stroke="black" d="M2621.53,-11130C2811.46,-11130 3314,-11130 3314,-11130 3314,-11130 3314,-11061.03 3314,-11061.03"/>
<polygon fill="black" stroke="black" points="3317.5,-11061.03 3314,-11051.03 3310.5,-11061.03 3317.5,-11061.03"/>
</g>
<!-- expert_4_7 -->
<g id="node82" class="node">
<title>expert_4_7</title>
<polygon fill="#e8daef" stroke="black" points="4114,-11050.88 3698,-11050.88 3698,-10997.88 4114,-10997.88 4114,-11050.88"/>
<text text-anchor="middle" x="3906" y="-11035.68" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="3906" y="-11020.68" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="3906" y="-11005.68" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_4&#45;&gt;expert_4_7 -->
<g id="edge116" class="edge">
<title>gate_4&#45;&gt;expert_4_7</title>
<path fill="none" stroke="black" d="M2621.87,-11140C2884.84,-11140 3779.49,-11140 3779.49,-11140 3779.49,-11140 3779.49,-11060.91 3779.49,-11060.91"/>
<polygon fill="black" stroke="black" points="3782.99,-11060.91 3779.49,-11050.91 3775.99,-11060.91 3782.99,-11060.91"/>
</g>
<!-- expert_4_0&#45;&gt;expert_agg_4 -->
<g id="edge103" class="edge">
<title>expert_4_0&#45;&gt;expert_agg_4</title>
<path fill="none" stroke="black" d="M831,-10997.68C831,-10960.33 831,-10897 831,-10897 831,-10897 2658.31,-10897 2658.31,-10897"/>
<polygon fill="black" stroke="black" points="2658.31,-10900.5 2668.31,-10897 2658.31,-10893.5 2658.31,-10900.5"/>
</g>
<!-- expert_4_1&#45;&gt;expert_agg_4 -->
<g id="edge105" class="edge">
<title>expert_4_1&#45;&gt;expert_agg_4</title>
<path fill="none" stroke="black" d="M1283,-10997.68C1283,-10963.32 1283,-10908 1283,-10908 1283,-10908 2658.33,-10908 2658.33,-10908"/>
<polygon fill="black" stroke="black" points="2658.33,-10911.5 2668.33,-10908 2658.33,-10904.5 2658.33,-10911.5"/>
</g>
<!-- expert_4_2&#45;&gt;expert_agg_4 -->
<g id="edge107" class="edge">
<title>expert_4_2&#45;&gt;expert_agg_4</title>
<path fill="none" stroke="black" d="M1735,-10997.81C1735,-10966.3 1735,-10918 1735,-10918 1735,-10918 2658.03,-10918 2658.03,-10918"/>
<polygon fill="black" stroke="black" points="2658.03,-10921.5 2668.03,-10918 2658.03,-10914.5 2658.03,-10921.5"/>
</g>
<!-- expert_4_3&#45;&gt;expert_agg_4 -->
<g id="edge109" class="edge">
<title>expert_4_3&#45;&gt;expert_agg_4</title>
<path fill="none" stroke="black" d="M2187,-10997.81C2187,-10969.59 2187,-10929 2187,-10929 2187,-10929 2658.31,-10929 2658.31,-10929"/>
<polygon fill="black" stroke="black" points="2658.31,-10932.5 2668.31,-10929 2658.31,-10925.5 2658.31,-10932.5"/>
</g>
<!-- expert_4_4&#45;&gt;expert_agg_4 -->
<g id="edge111" class="edge">
<title>expert_4_4&#45;&gt;expert_agg_4</title>
<path fill="none" stroke="black" d="M2713.25,-10997.79C2713.25,-10997.79 2713.25,-10950.14 2713.25,-10950.14"/>
<polygon fill="black" stroke="black" points="2716.75,-10950.14 2713.25,-10940.14 2709.75,-10950.14 2716.75,-10950.14"/>
</g>
<!-- expert_4_5&#45;&gt;expert_agg_4 -->
<g id="edge113" class="edge">
<title>expert_4_5&#45;&gt;expert_agg_4</title>
<path fill="none" stroke="black" d="M2838.75,-10997.79C2838.75,-10997.79 2838.75,-10950.14 2838.75,-10950.14"/>
<polygon fill="black" stroke="black" points="2842.25,-10950.14 2838.75,-10940.14 2835.25,-10950.14 2842.25,-10950.14"/>
</g>
<!-- expert_4_6&#45;&gt;expert_agg_4 -->
<g id="edge115" class="edge">
<title>expert_4_6&#45;&gt;expert_agg_4</title>
<path fill="none" stroke="black" d="M3303,-10997.76C3303,-10968.62 3303,-10926 3303,-10926 3303,-10926 2893.6,-10926 2893.6,-10926"/>
<polygon fill="black" stroke="black" points="2893.6,-10922.5 2883.6,-10926 2893.6,-10929.5 2893.6,-10922.5"/>
</g>
<!-- expert_4_7&#45;&gt;expert_agg_4 -->
<g id="edge117" class="edge">
<title>expert_4_7&#45;&gt;expert_agg_4</title>
<path fill="none" stroke="black" d="M3769,-10997.7C3769,-10964.75 3769,-10913 3769,-10913 3769,-10913 2893.68,-10913 2893.68,-10913"/>
<polygon fill="black" stroke="black" points="2893.68,-10909.5 2883.68,-10913 2893.68,-10916.5 2893.68,-10909.5"/>
</g>
<!-- expert_agg_4&#45;&gt;residual2_4 -->
<g id="edge120" class="edge">
<title>expert_agg_4&#45;&gt;residual2_4</title>
<path fill="none" stroke="black" d="M2883.69,-10900C3199.09,-10900 4098.75,-10900 4098.75,-10900 4098.75,-10900 4098.75,-10839.06 4098.75,-10839.06"/>
<polygon fill="black" stroke="black" points="4102.25,-10839.06 4098.75,-10829.06 4095.25,-10839.06 4102.25,-10839.06"/>
</g>
<!-- transfer_4 -->
<g id="node85" class="node">
<title>transfer_4</title>
<ellipse fill="#fadbd8" stroke="black" cx="4191" cy="-10691.01" rx="152.06" ry="26.74"/>
<text text-anchor="middle" x="4191" y="-10694.81" font-family="Helvetica,sans-Serif" font-size="14.00">Transfer to GPU 4</text>
<text text-anchor="middle" x="4191" y="-10679.81" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual2_4&#45;&gt;transfer_4 -->
<g id="edge121" class="edge">
<title>residual2_4&#45;&gt;transfer_4</title>
<path fill="none" stroke="black" d="M4191,-10775.71C4191,-10775.71 4191,-10728.24 4191,-10728.24"/>
<polygon fill="black" stroke="black" points="4194.5,-10728.24 4191,-10718.24 4187.5,-10728.24 4194.5,-10728.24"/>
</g>
<!-- residual1_5 -->
<g id="node92" class="node">
<title>residual1_5</title>
<polygon fill="#fadbd8" stroke="black" points="4446.5,-10606.14 4231.5,-10606.14 4231.5,-10553.14 4446.5,-10553.14 4446.5,-10606.14"/>
<text text-anchor="middle" x="4339" y="-10590.94" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="4339" y="-10575.94" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="4339" y="-10560.94" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- transfer_4&#45;&gt;residual1_5 -->
<g id="edge127" class="edge">
<title>transfer_4&#45;&gt;residual1_5</title>
<path fill="none" stroke="black" d="M4287.26,-10670.06C4287.26,-10670.06 4287.26,-10616.41 4287.26,-10616.41"/>
<polygon fill="black" stroke="black" points="4290.76,-10616.41 4287.26,-10606.41 4283.76,-10616.41 4290.76,-10616.41"/>
</g>
<!-- ln1_5 -->
<g id="node86" class="node">
<title>ln1_5</title>
<polygon fill="#f8f9f9" stroke="black" points="4594.5,-11272.88 4379.5,-11272.88 4379.5,-11219.88 4594.5,-11219.88 4594.5,-11272.88"/>
<text text-anchor="middle" x="4487" y="-11257.68" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="4487" y="-11242.68" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="4487" y="-11227.68" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_qkv_5 -->
<g id="node87" class="node">
<title>attn_qkv_5</title>
<polygon fill="#ffe6cc" stroke="black" points="4602,-11161.88 4372,-11161.88 4372,-11108.88 4602,-11108.88 4602,-11161.88"/>
<text text-anchor="middle" x="4487" y="-11146.68" font-family="Helvetica,sans-Serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="4487" y="-11131.68" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="4487" y="-11116.68" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 3*hidden_dim]</text>
</g>
<!-- ln1_5&#45;&gt;attn_qkv_5 -->
<g id="edge122" class="edge">
<title>ln1_5&#45;&gt;attn_qkv_5</title>
<path fill="none" stroke="black" d="M4487,-11219.79C4487,-11219.79 4487,-11172.14 4487,-11172.14"/>
<polygon fill="black" stroke="black" points="4490.5,-11172.14 4487,-11162.14 4483.5,-11172.14 4490.5,-11172.14"/>
</g>
<!-- attn_score_5 -->
<g id="node88" class="node">
<title>attn_score_5</title>
<polygon fill="#ffe6cc" stroke="black" points="4624.5,-11050.88 4349.5,-11050.88 4349.5,-10997.88 4624.5,-10997.88 4624.5,-11050.88"/>
<text text-anchor="middle" x="4487" y="-11035.68" font-family="Helvetica,sans-Serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="4487" y="-11020.68" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="4487" y="-11005.68" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_qkv_5&#45;&gt;attn_score_5 -->
<g id="edge123" class="edge">
<title>attn_qkv_5&#45;&gt;attn_score_5</title>
<path fill="none" stroke="black" d="M4487,-11108.79C4487,-11108.79 4487,-11061.14 4487,-11061.14"/>
<polygon fill="black" stroke="black" points="4490.5,-11061.14 4487,-11051.14 4483.5,-11061.14 4490.5,-11061.14"/>
</g>
<!-- attn_weight_5 -->
<g id="node89" class="node">
<title>attn_weight_5</title>
<polygon fill="#ffe6cc" stroke="black" points="4624.5,-10939.88 4349.5,-10939.88 4349.5,-10886.88 4624.5,-10886.88 4624.5,-10939.88"/>
<text text-anchor="middle" x="4487" y="-10924.68" font-family="Helvetica,sans-Serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="4487" y="-10909.68" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="4487" y="-10894.68" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_score_5&#45;&gt;attn_weight_5 -->
<g id="edge124" class="edge">
<title>attn_score_5&#45;&gt;attn_weight_5</title>
<path fill="none" stroke="black" d="M4487,-10997.79C4487,-10997.79 4487,-10950.14 4487,-10950.14"/>
<polygon fill="black" stroke="black" points="4490.5,-10950.14 4487,-10940.14 4483.5,-10950.14 4490.5,-10950.14"/>
</g>
<!-- attn_context_5 -->
<g id="node90" class="node">
<title>attn_context_5</title>
<polygon fill="#ffe6cc" stroke="black" points="4632,-10828.88 4342,-10828.88 4342,-10775.88 4632,-10775.88 4632,-10828.88"/>
<text text-anchor="middle" x="4487" y="-10813.68" font-family="Helvetica,sans-Serif" font-size="14.00">Context</text>
<text text-anchor="middle" x="4487" y="-10798.68" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="4487" y="-10783.68" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, head_dim]</text>
</g>
<!-- attn_weight_5&#45;&gt;attn_context_5 -->
<g id="edge125" class="edge">
<title>attn_weight_5&#45;&gt;attn_context_5</title>
<path fill="none" stroke="black" d="M4487,-10886.79C4487,-10886.79 4487,-10839.14 4487,-10839.14"/>
<polygon fill="black" stroke="black" points="4490.5,-10839.14 4487,-10829.14 4483.5,-10839.14 4490.5,-10839.14"/>
</g>
<!-- attn_out_5 -->
<g id="node91" class="node">
<title>attn_out_5</title>
<polygon fill="#ffe6cc" stroke="black" points="4594.5,-10717.51 4379.5,-10717.51 4379.5,-10664.51 4594.5,-10664.51 4594.5,-10717.51"/>
<text text-anchor="middle" x="4487" y="-10702.31" font-family="Helvetica,sans-Serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="4487" y="-10687.31" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="4487" y="-10672.31" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_context_5&#45;&gt;attn_out_5 -->
<g id="edge126" class="edge">
<title>attn_context_5&#45;&gt;attn_out_5</title>
<path fill="none" stroke="black" d="M4487,-10775.71C4487,-10775.71 4487,-10727.86 4487,-10727.86"/>
<polygon fill="black" stroke="black" points="4490.5,-10727.86 4487,-10717.86 4483.5,-10727.86 4490.5,-10727.86"/>
</g>
<!-- attn_out_5&#45;&gt;residual1_5 -->
<g id="edge128" class="edge">
<title>attn_out_5&#45;&gt;residual1_5</title>
<path fill="none" stroke="black" d="M4413,-10664.34C4413,-10664.34 4413,-10616.49 4413,-10616.49"/>
<polygon fill="black" stroke="black" points="4416.5,-10616.49 4413,-10606.49 4409.5,-10616.49 4416.5,-10616.49"/>
</g>
<!-- ln2_5 -->
<g id="node93" class="node">
<title>ln2_5</title>
<polygon fill="#f8f9f9" stroke="black" points="4365.5,-10495.14 4150.5,-10495.14 4150.5,-10442.14 4365.5,-10442.14 4365.5,-10495.14"/>
<text text-anchor="middle" x="4258" y="-10479.94" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;MoE)</text>
<text text-anchor="middle" x="4258" y="-10464.94" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="4258" y="-10449.94" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_5&#45;&gt;ln2_5 -->
<g id="edge129" class="edge">
<title>residual1_5&#45;&gt;ln2_5</title>
<path fill="none" stroke="black" d="M4298.5,-10553.05C4298.5,-10553.05 4298.5,-10505.4 4298.5,-10505.4"/>
<polygon fill="black" stroke="black" points="4302,-10505.4 4298.5,-10495.4 4295,-10505.4 4302,-10505.4"/>
</g>
<!-- residual2_5 -->
<g id="node105" class="node">
<title>residual2_5</title>
<polygon fill="#fadbd8" stroke="black" points="4476.5,-9940.14 4261.5,-9940.14 4261.5,-9887.14 4476.5,-9887.14 4476.5,-9940.14"/>
<text text-anchor="middle" x="4369" y="-9924.94" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="4369" y="-9909.94" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="4369" y="-9894.94" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_5&#45;&gt;residual2_5 -->
<g id="edge149" class="edge">
<title>residual1_5&#45;&gt;residual2_5</title>
<path fill="none" stroke="black" d="M4406,-10553.12C4406,-10553.12 4406,-9950.24 4406,-9950.24"/>
<polygon fill="black" stroke="black" points="4409.5,-9950.24 4406,-9940.24 4402.5,-9950.24 4409.5,-9950.24"/>
</g>
<!-- router_5 -->
<g id="node94" class="node">
<title>router_5</title>
<polygon fill="#f5b7b1" stroke="black" points="3560,-10384.14 3360,-10384.14 3360,-10331.14 3560,-10331.14 3560,-10384.14"/>
<text text-anchor="middle" x="3460" y="-10368.94" font-family="Helvetica,sans-Serif" font-size="14.00">Router Network</text>
<text text-anchor="middle" x="3460" y="-10353.94" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="3460" y="-10338.94" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 8 experts]</text>
</g>
<!-- ln2_5&#45;&gt;router_5 -->
<g id="edge130" class="edge">
<title>ln2_5&#45;&gt;router_5</title>
<path fill="none" stroke="black" d="M4221.25,-10441.9C4221.25,-10408.87 4221.25,-10357 4221.25,-10357 4221.25,-10357 3570.3,-10357 3570.3,-10357"/>
<polygon fill="black" stroke="black" points="3570.3,-10353.5 3560.3,-10357 3570.3,-10360.5 3570.3,-10353.5"/>
</g>
<!-- expert_agg_5 -->
<g id="node104" class="node">
<title>expert_agg_5</title>
<polygon fill="#d4e6f1" stroke="black" points="3061.5,-10051.14 2846.5,-10051.14 2846.5,-9998.14 3061.5,-9998.14 3061.5,-10051.14"/>
<text text-anchor="middle" x="2954" y="-10035.94" font-family="Helvetica,sans-Serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="2954" y="-10020.94" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="2954" y="-10005.94" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- ln2_5&#45;&gt;expert_agg_5 -->
<g id="edge148" class="edge">
<title>ln2_5&#45;&gt;expert_agg_5</title>
<path fill="none" stroke="black" d="M4150.46,-10468C3838.28,-10468 2954,-10468 2954,-10468 2954,-10468 2954,-10061.38 2954,-10061.38"/>
<polygon fill="black" stroke="black" points="2957.5,-10061.38 2954,-10051.38 2950.5,-10061.38 2957.5,-10061.38"/>
</g>
<!-- gate_5 -->
<g id="node95" class="node">
<title>gate_5</title>
<polygon fill="#f5b7b1" stroke="black" points="2799.5,-10273.14 2656.5,-10273.14 2656.5,-10220.14 2799.5,-10220.14 2799.5,-10273.14"/>
<text text-anchor="middle" x="2728" y="-10257.94" font-family="Helvetica,sans-Serif" font-size="14.00">Top&#45;2 Gating</text>
<text text-anchor="middle" x="2728" y="-10242.94" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="2728" y="-10227.94" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 2]</text>
</g>
<!-- router_5&#45;&gt;gate_5 -->
<g id="edge131" class="edge">
<title>router_5&#45;&gt;gate_5</title>
<path fill="none" stroke="black" d="M3374,-10331C3374,-10302.7 3374,-10262 3374,-10262 3374,-10262 2809.6,-10262 2809.6,-10262"/>
<polygon fill="black" stroke="black" points="2809.6,-10258.5 2799.6,-10262 2809.6,-10265.5 2809.6,-10258.5"/>
</g>
<!-- expert_5_0 -->
<g id="node96" class="node">
<title>expert_5_0</title>
<polygon fill="#e8daef" stroke="black" points="1128,-10162.14 712,-10162.14 712,-10109.14 1128,-10109.14 1128,-10162.14"/>
<text text-anchor="middle" x="920" y="-10146.94" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="920" y="-10131.94" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="920" y="-10116.94" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_5&#45;&gt;expert_5_0 -->
<g id="edge132" class="edge">
<title>gate_5&#45;&gt;expert_5_0</title>
<path fill="none" stroke="black" d="M2656.47,-10262C2337.07,-10262 1057,-10262 1057,-10262 1057,-10262 1057,-10172.44 1057,-10172.44"/>
<polygon fill="black" stroke="black" points="1060.5,-10172.44 1057,-10162.44 1053.5,-10172.44 1060.5,-10172.44"/>
</g>
<!-- expert_5_1 -->
<g id="node97" class="node">
<title>expert_5_1</title>
<polygon fill="#e8daef" stroke="black" points="1580,-10162.14 1164,-10162.14 1164,-10109.14 1580,-10109.14 1580,-10162.14"/>
<text text-anchor="middle" x="1372" y="-10146.94" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1372" y="-10131.94" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="1372" y="-10116.94" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_5&#45;&gt;expert_5_1 -->
<g id="edge134" class="edge">
<title>gate_5&#45;&gt;expert_5_1</title>
<path fill="none" stroke="black" d="M2656.3,-10251C2395,-10251 1509,-10251 1509,-10251 1509,-10251 1509,-10172.4 1509,-10172.4"/>
<polygon fill="black" stroke="black" points="1512.5,-10172.4 1509,-10162.4 1505.5,-10172.4 1512.5,-10172.4"/>
</g>
<!-- expert_5_2 -->
<g id="node98" class="node">
<title>expert_5_2</title>
<polygon fill="#e8daef" stroke="black" points="2032,-10162.14 1616,-10162.14 1616,-10109.14 2032,-10109.14 2032,-10162.14"/>
<text text-anchor="middle" x="1824" y="-10146.94" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="1824" y="-10131.94" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="1824" y="-10116.94" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_5&#45;&gt;expert_5_2 -->
<g id="edge136" class="edge">
<title>gate_5&#45;&gt;expert_5_2</title>
<path fill="none" stroke="black" d="M2656.19,-10241C2465.52,-10241 1961,-10241 1961,-10241 1961,-10241 1961,-10172.23 1961,-10172.23"/>
<polygon fill="black" stroke="black" points="1964.5,-10172.23 1961,-10162.23 1957.5,-10172.23 1964.5,-10172.23"/>
</g>
<!-- expert_5_3 -->
<g id="node99" class="node">
<title>expert_5_3</title>
<polygon fill="#e8daef" stroke="black" points="2484,-10162.14 2068,-10162.14 2068,-10109.14 2484,-10109.14 2484,-10162.14"/>
<text text-anchor="middle" x="2276" y="-10146.94" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2276" y="-10131.94" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="2276" y="-10116.94" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_5&#45;&gt;expert_5_3 -->
<g id="edge138" class="edge">
<title>gate_5&#45;&gt;expert_5_3</title>
<path fill="none" stroke="black" d="M2656.13,-10230C2563.16,-10230 2413,-10230 2413,-10230 2413,-10230 2413,-10172.18 2413,-10172.18"/>
<polygon fill="black" stroke="black" points="2416.5,-10172.18 2413,-10162.18 2409.5,-10172.18 2416.5,-10172.18"/>
</g>
<!-- expert_5_4 -->
<g id="node100" class="node">
<title>expert_5_4</title>
<polygon fill="#e8daef" stroke="black" points="2936,-10162.14 2520,-10162.14 2520,-10109.14 2936,-10109.14 2936,-10162.14"/>
<text text-anchor="middle" x="2728" y="-10146.94" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="2728" y="-10131.94" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="2728" y="-10116.94" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_5&#45;&gt;expert_5_4 -->
<g id="edge140" class="edge">
<title>gate_5&#45;&gt;expert_5_4</title>
<path fill="none" stroke="black" d="M2728,-10220.05C2728,-10220.05 2728,-10172.4 2728,-10172.4"/>
<polygon fill="black" stroke="black" points="2731.5,-10172.4 2728,-10162.4 2724.5,-10172.4 2731.5,-10172.4"/>
</g>
<!-- expert_5_5 -->
<g id="node101" class="node">
<title>expert_5_5</title>
<polygon fill="#e8daef" stroke="black" points="3388,-10162.14 2972,-10162.14 2972,-10109.14 3388,-10109.14 3388,-10162.14"/>
<text text-anchor="middle" x="3180" y="-10146.94" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="3180" y="-10131.94" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="3180" y="-10116.94" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_5&#45;&gt;expert_5_5 -->
<g id="edge142" class="edge">
<title>gate_5&#45;&gt;expert_5_5</title>
<path fill="none" stroke="black" d="M2799.72,-10230C2905.51,-10230 3091,-10230 3091,-10230 3091,-10230 3091,-10172.18 3091,-10172.18"/>
<polygon fill="black" stroke="black" points="3094.5,-10172.18 3091,-10162.18 3087.5,-10172.18 3094.5,-10172.18"/>
</g>
<!-- expert_5_6 -->
<g id="node102" class="node">
<title>expert_5_6</title>
<polygon fill="#e8daef" stroke="black" points="3840,-10162.14 3424,-10162.14 3424,-10109.14 3840,-10109.14 3840,-10162.14"/>
<text text-anchor="middle" x="3632" y="-10146.94" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="3632" y="-10131.94" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="3632" y="-10116.94" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_5&#45;&gt;expert_5_6 -->
<g id="edge144" class="edge">
<title>gate_5&#45;&gt;expert_5_6</title>
<path fill="none" stroke="black" d="M2799.53,-10241C2989.46,-10241 3492,-10241 3492,-10241 3492,-10241 3492,-10172.23 3492,-10172.23"/>
<polygon fill="black" stroke="black" points="3495.5,-10172.23 3492,-10162.23 3488.5,-10172.23 3495.5,-10172.23"/>
</g>
<!-- expert_5_7 -->
<g id="node103" class="node">
<title>expert_5_7</title>
<polygon fill="#e8daef" stroke="black" points="4292,-10162.14 3876,-10162.14 3876,-10109.14 4292,-10109.14 4292,-10162.14"/>
<text text-anchor="middle" x="4084" y="-10146.94" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="4084" y="-10131.94" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="4084" y="-10116.94" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_5&#45;&gt;expert_5_7 -->
<g id="edge146" class="edge">
<title>gate_5&#45;&gt;expert_5_7</title>
<path fill="none" stroke="black" d="M2799.87,-10251C3062.84,-10251 3957.49,-10251 3957.49,-10251 3957.49,-10251 3957.49,-10172.4 3957.49,-10172.4"/>
<polygon fill="black" stroke="black" points="3960.99,-10172.4 3957.49,-10162.4 3953.99,-10172.4 3960.99,-10172.4"/>
</g>
<!-- expert_5_0&#45;&gt;expert_agg_5 -->
<g id="edge133" class="edge">
<title>expert_5_0&#45;&gt;expert_agg_5</title>
<path fill="none" stroke="black" d="M1009,-10108.88C1009,-10071.45 1009,-10008 1009,-10008 1009,-10008 2836.31,-10008 2836.31,-10008"/>
<polygon fill="black" stroke="black" points="2836.31,-10011.5 2846.31,-10008 2836.31,-10004.5 2836.31,-10011.5"/>
</g>
<!-- expert_5_1&#45;&gt;expert_agg_5 -->
<g id="edge135" class="edge">
<title>expert_5_1&#45;&gt;expert_agg_5</title>
<path fill="none" stroke="black" d="M1461,-10108.88C1461,-10074.44 1461,-10019 1461,-10019 1461,-10019 2836.33,-10019 2836.33,-10019"/>
<polygon fill="black" stroke="black" points="2836.33,-10022.5 2846.33,-10019 2836.33,-10015.5 2836.33,-10022.5"/>
</g>
<!-- expert_5_2&#45;&gt;expert_agg_5 -->
<g id="edge137" class="edge">
<title>expert_5_2&#45;&gt;expert_agg_5</title>
<path fill="none" stroke="black" d="M1913,-10109.01C1913,-10077.42 1913,-10029 1913,-10029 1913,-10029 2836.03,-10029 2836.03,-10029"/>
<polygon fill="black" stroke="black" points="2836.03,-10032.5 2846.03,-10029 2836.03,-10025.5 2836.03,-10032.5"/>
</g>
<!-- expert_5_3&#45;&gt;expert_agg_5 -->
<g id="edge139" class="edge">
<title>expert_5_3&#45;&gt;expert_agg_5</title>
<path fill="none" stroke="black" d="M2365,-10109C2365,-10080.7 2365,-10040 2365,-10040 2365,-10040 2836.31,-10040 2836.31,-10040"/>
<polygon fill="black" stroke="black" points="2836.31,-10043.5 2846.31,-10040 2836.31,-10036.5 2836.31,-10043.5"/>
</g>
<!-- expert_5_4&#45;&gt;expert_agg_5 -->
<g id="edge141" class="edge">
<title>expert_5_4&#45;&gt;expert_agg_5</title>
<path fill="none" stroke="black" d="M2891.25,-10109.05C2891.25,-10109.05 2891.25,-10061.4 2891.25,-10061.4"/>
<polygon fill="black" stroke="black" points="2894.75,-10061.4 2891.25,-10051.4 2887.75,-10061.4 2894.75,-10061.4"/>
</g>
<!-- expert_5_5&#45;&gt;expert_agg_5 -->
<g id="edge143" class="edge">
<title>expert_5_5&#45;&gt;expert_agg_5</title>
<path fill="none" stroke="black" d="M3016.75,-10109.05C3016.75,-10109.05 3016.75,-10061.4 3016.75,-10061.4"/>
<polygon fill="black" stroke="black" points="3020.25,-10061.4 3016.75,-10051.4 3013.25,-10061.4 3020.25,-10061.4"/>
</g>
<!-- expert_5_6&#45;&gt;expert_agg_5 -->
<g id="edge145" class="edge">
<title>expert_5_6&#45;&gt;expert_agg_5</title>
<path fill="none" stroke="black" d="M3481,-10108.95C3481,-10079.73 3481,-10037 3481,-10037 3481,-10037 3071.6,-10037 3071.6,-10037"/>
<polygon fill="black" stroke="black" points="3071.6,-10033.5 3061.6,-10037 3071.6,-10040.5 3071.6,-10033.5"/>
</g>
<!-- expert_5_7&#45;&gt;expert_agg_5 -->
<g id="edge147" class="edge">
<title>expert_5_7&#45;&gt;expert_agg_5</title>
<path fill="none" stroke="black" d="M3947,-10108.9C3947,-10075.87 3947,-10024 3947,-10024 3947,-10024 3071.68,-10024 3071.68,-10024"/>
<polygon fill="black" stroke="black" points="3071.68,-10020.5 3061.68,-10024 3071.68,-10027.5 3071.68,-10020.5"/>
</g>
<!-- expert_agg_5&#45;&gt;residual2_5 -->
<g id="edge150" class="edge">
<title>expert_agg_5&#45;&gt;residual2_5</title>
<path fill="none" stroke="black" d="M3061.69,-10011C3377.09,-10011 4276.75,-10011 4276.75,-10011 4276.75,-10011 4276.75,-9950.24 4276.75,-9950.24"/>
<polygon fill="black" stroke="black" points="4280.25,-9950.24 4276.75,-9940.24 4273.25,-9950.25 4280.25,-9950.24"/>
</g>
<!-- transfer_5 -->
<g id="node106" class="node">
<title>transfer_5</title>
<ellipse fill="#fadbd8" stroke="black" cx="4369" cy="-9802.27" rx="152.06" ry="26.74"/>
<text text-anchor="middle" x="4369" y="-9806.07" font-family="Helvetica,sans-Serif" font-size="14.00">Transfer to GPU 5</text>
<text text-anchor="middle" x="4369" y="-9791.07" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual2_5&#45;&gt;transfer_5 -->
<g id="edge151" class="edge">
<title>residual2_5&#45;&gt;transfer_5</title>
<path fill="none" stroke="black" d="M4369,-9886.97C4369,-9886.97 4369,-9839.5 4369,-9839.5"/>
<polygon fill="black" stroke="black" points="4372.5,-9839.5 4369,-9829.5 4365.5,-9839.5 4372.5,-9839.5"/>
</g>
<!-- residual1_6 -->
<g id="node113" class="node">
<title>residual1_6</title>
<polygon fill="#fadbd8" stroke="black" points="4624.5,-9717.4 4409.5,-9717.4 4409.5,-9664.4 4624.5,-9664.4 4624.5,-9717.4"/>
<text text-anchor="middle" x="4517" y="-9702.2" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="4517" y="-9687.2" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="4517" y="-9672.2" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- transfer_5&#45;&gt;residual1_6 -->
<g id="edge157" class="edge">
<title>transfer_5&#45;&gt;residual1_6</title>
<path fill="none" stroke="black" d="M4465.26,-9781.32C4465.26,-9781.32 4465.26,-9727.67 4465.26,-9727.67"/>
<polygon fill="black" stroke="black" points="4468.76,-9727.67 4465.26,-9717.67 4461.76,-9727.67 4468.76,-9727.67"/>
</g>
<!-- ln1_6 -->
<g id="node107" class="node">
<title>ln1_6</title>
<polygon fill="#f8f9f9" stroke="black" points="4772.5,-10384.14 4557.5,-10384.14 4557.5,-10331.14 4772.5,-10331.14 4772.5,-10384.14"/>
<text text-anchor="middle" x="4665" y="-10368.94" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="4665" y="-10353.94" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="4665" y="-10338.94" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_qkv_6 -->
<g id="node108" class="node">
<title>attn_qkv_6</title>
<polygon fill="#ffe6cc" stroke="black" points="4780,-10273.14 4550,-10273.14 4550,-10220.14 4780,-10220.14 4780,-10273.14"/>
<text text-anchor="middle" x="4665" y="-10257.94" font-family="Helvetica,sans-Serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="4665" y="-10242.94" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="4665" y="-10227.94" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 3*hidden_dim]</text>
</g>
<!-- ln1_6&#45;&gt;attn_qkv_6 -->
<g id="edge152" class="edge">
<title>ln1_6&#45;&gt;attn_qkv_6</title>
<path fill="none" stroke="black" d="M4665,-10331.05C4665,-10331.05 4665,-10283.4 4665,-10283.4"/>
<polygon fill="black" stroke="black" points="4668.5,-10283.4 4665,-10273.4 4661.5,-10283.4 4668.5,-10283.4"/>
</g>
<!-- attn_score_6 -->
<g id="node109" class="node">
<title>attn_score_6</title>
<polygon fill="#ffe6cc" stroke="black" points="4802.5,-10162.14 4527.5,-10162.14 4527.5,-10109.14 4802.5,-10109.14 4802.5,-10162.14"/>
<text text-anchor="middle" x="4665" y="-10146.94" font-family="Helvetica,sans-Serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="4665" y="-10131.94" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="4665" y="-10116.94" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_qkv_6&#45;&gt;attn_score_6 -->
<g id="edge153" class="edge">
<title>attn_qkv_6&#45;&gt;attn_score_6</title>
<path fill="none" stroke="black" d="M4665,-10220.05C4665,-10220.05 4665,-10172.4 4665,-10172.4"/>
<polygon fill="black" stroke="black" points="4668.5,-10172.4 4665,-10162.4 4661.5,-10172.4 4668.5,-10172.4"/>
</g>
<!-- attn_weight_6 -->
<g id="node110" class="node">
<title>attn_weight_6</title>
<polygon fill="#ffe6cc" stroke="black" points="4802.5,-10051.14 4527.5,-10051.14 4527.5,-9998.14 4802.5,-9998.14 4802.5,-10051.14"/>
<text text-anchor="middle" x="4665" y="-10035.94" font-family="Helvetica,sans-Serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="4665" y="-10020.94" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="4665" y="-10005.94" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_score_6&#45;&gt;attn_weight_6 -->
<g id="edge154" class="edge">
<title>attn_score_6&#45;&gt;attn_weight_6</title>
<path fill="none" stroke="black" d="M4665,-10109.05C4665,-10109.05 4665,-10061.4 4665,-10061.4"/>
<polygon fill="black" stroke="black" points="4668.5,-10061.4 4665,-10051.4 4661.5,-10061.4 4668.5,-10061.4"/>
</g>
<!-- attn_context_6 -->
<g id="node111" class="node">
<title>attn_context_6</title>
<polygon fill="#ffe6cc" stroke="black" points="4810,-9940.14 4520,-9940.14 4520,-9887.14 4810,-9887.14 4810,-9940.14"/>
<text text-anchor="middle" x="4665" y="-9924.94" font-family="Helvetica,sans-Serif" font-size="14.00">Context</text>
<text text-anchor="middle" x="4665" y="-9909.94" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="4665" y="-9894.94" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, head_dim]</text>
</g>
<!-- attn_weight_6&#45;&gt;attn_context_6 -->
<g id="edge155" class="edge">
<title>attn_weight_6&#45;&gt;attn_context_6</title>
<path fill="none" stroke="black" d="M4665,-9998.05C4665,-9998.05 4665,-9950.4 4665,-9950.4"/>
<polygon fill="black" stroke="black" points="4668.5,-9950.4 4665,-9940.4 4661.5,-9950.4 4668.5,-9950.4"/>
</g>
<!-- attn_out_6 -->
<g id="node112" class="node">
<title>attn_out_6</title>
<polygon fill="#ffe6cc" stroke="black" points="4772.5,-9828.77 4557.5,-9828.77 4557.5,-9775.77 4772.5,-9775.77 4772.5,-9828.77"/>
<text text-anchor="middle" x="4665" y="-9813.57" font-family="Helvetica,sans-Serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="4665" y="-9798.57" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="4665" y="-9783.57" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_context_6&#45;&gt;attn_out_6 -->
<g id="edge156" class="edge">
<title>attn_context_6&#45;&gt;attn_out_6</title>
<path fill="none" stroke="black" d="M4665,-9886.97C4665,-9886.97 4665,-9839.12 4665,-9839.12"/>
<polygon fill="black" stroke="black" points="4668.5,-9839.12 4665,-9829.12 4661.5,-9839.12 4668.5,-9839.12"/>
</g>
<!-- attn_out_6&#45;&gt;residual1_6 -->
<g id="edge158" class="edge">
<title>attn_out_6&#45;&gt;residual1_6</title>
<path fill="none" stroke="black" d="M4591,-9775.6C4591,-9775.6 4591,-9727.75 4591,-9727.75"/>
<polygon fill="black" stroke="black" points="4594.5,-9727.75 4591,-9717.75 4587.5,-9727.75 4594.5,-9727.75"/>
</g>
<!-- ln2_6 -->
<g id="node114" class="node">
<title>ln2_6</title>
<polygon fill="#f8f9f9" stroke="black" points="4543.5,-9606.4 4328.5,-9606.4 4328.5,-9553.4 4543.5,-9553.4 4543.5,-9606.4"/>
<text text-anchor="middle" x="4436" y="-9591.2" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;MoE)</text>
<text text-anchor="middle" x="4436" y="-9576.2" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="4436" y="-9561.2" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_6&#45;&gt;ln2_6 -->
<g id="edge159" class="edge">
<title>residual1_6&#45;&gt;ln2_6</title>
<path fill="none" stroke="black" d="M4476.5,-9664.31C4476.5,-9664.31 4476.5,-9616.66 4476.5,-9616.66"/>
<polygon fill="black" stroke="black" points="4480,-9616.66 4476.5,-9606.66 4473,-9616.66 4480,-9616.66"/>
</g>
<!-- residual2_6 -->
<g id="node126" class="node">
<title>residual2_6</title>
<polygon fill="#fadbd8" stroke="black" points="4654.5,-9051.4 4439.5,-9051.4 4439.5,-8998.4 4654.5,-8998.4 4654.5,-9051.4"/>
<text text-anchor="middle" x="4547" y="-9036.2" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="4547" y="-9021.2" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="4547" y="-9006.2" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_6&#45;&gt;residual2_6 -->
<g id="edge179" class="edge">
<title>residual1_6&#45;&gt;residual2_6</title>
<path fill="none" stroke="black" d="M4584,-9664.38C4584,-9664.38 4584,-9061.5 4584,-9061.5"/>
<polygon fill="black" stroke="black" points="4587.5,-9061.5 4584,-9051.5 4580.5,-9061.5 4587.5,-9061.5"/>
</g>
<!-- router_6 -->
<g id="node115" class="node">
<title>router_6</title>
<polygon fill="#f5b7b1" stroke="black" points="3738,-9495.4 3538,-9495.4 3538,-9442.4 3738,-9442.4 3738,-9495.4"/>
<text text-anchor="middle" x="3638" y="-9480.2" font-family="Helvetica,sans-Serif" font-size="14.00">Router Network</text>
<text text-anchor="middle" x="3638" y="-9465.2" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="3638" y="-9450.2" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 8 experts]</text>
</g>
<!-- ln2_6&#45;&gt;router_6 -->
<g id="edge160" class="edge">
<title>ln2_6&#45;&gt;router_6</title>
<path fill="none" stroke="black" d="M4399.25,-9553.38C4399.25,-9520.29 4399.25,-9468 4399.25,-9468 4399.25,-9468 3748.3,-9468 3748.3,-9468"/>
<polygon fill="black" stroke="black" points="3748.3,-9464.5 3738.3,-9468 3748.3,-9471.5 3748.3,-9464.5"/>
</g>
<!-- expert_agg_6 -->
<g id="node125" class="node">
<title>expert_agg_6</title>
<polygon fill="#d4e6f1" stroke="black" points="3239.5,-9162.4 3024.5,-9162.4 3024.5,-9109.4 3239.5,-9109.4 3239.5,-9162.4"/>
<text text-anchor="middle" x="3132" y="-9147.2" font-family="Helvetica,sans-Serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="3132" y="-9132.2" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="3132" y="-9117.2" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- ln2_6&#45;&gt;expert_agg_6 -->
<g id="edge178" class="edge">
<title>ln2_6&#45;&gt;expert_agg_6</title>
<path fill="none" stroke="black" d="M4328.46,-9579C4016.28,-9579 3132,-9579 3132,-9579 3132,-9579 3132,-9172.62 3132,-9172.62"/>
<polygon fill="black" stroke="black" points="3135.5,-9172.62 3132,-9162.62 3128.5,-9172.62 3135.5,-9172.62"/>
</g>
<!-- gate_6 -->
<g id="node116" class="node">
<title>gate_6</title>
<polygon fill="#f5b7b1" stroke="black" points="2977.5,-9384.4 2834.5,-9384.4 2834.5,-9331.4 2977.5,-9331.4 2977.5,-9384.4"/>
<text text-anchor="middle" x="2906" y="-9369.2" font-family="Helvetica,sans-Serif" font-size="14.00">Top&#45;2 Gating</text>
<text text-anchor="middle" x="2906" y="-9354.2" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="2906" y="-9339.2" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 2]</text>
</g>
<!-- router_6&#45;&gt;gate_6 -->
<g id="edge161" class="edge">
<title>router_6&#45;&gt;gate_6</title>
<path fill="none" stroke="black" d="M3552,-9442.19C3552,-9413.81 3552,-9373 3552,-9373 3552,-9373 2987.6,-9373 2987.6,-9373"/>
<polygon fill="black" stroke="black" points="2987.6,-9369.5 2977.6,-9373 2987.6,-9376.5 2987.6,-9369.5"/>
</g>
<!-- expert_6_0 -->
<g id="node117" class="node">
<title>expert_6_0</title>
<polygon fill="#e8daef" stroke="black" points="1306,-9273.4 890,-9273.4 890,-9220.4 1306,-9220.4 1306,-9273.4"/>
<text text-anchor="middle" x="1098" y="-9258.2" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="1098" y="-9243.2" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="1098" y="-9228.2" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_6&#45;&gt;expert_6_0 -->
<g id="edge162" class="edge">
<title>gate_6&#45;&gt;expert_6_0</title>
<path fill="none" stroke="black" d="M2834.47,-9373C2515.07,-9373 1235,-9373 1235,-9373 1235,-9373 1235,-9283.64 1235,-9283.64"/>
<polygon fill="black" stroke="black" points="1238.5,-9283.64 1235,-9273.64 1231.5,-9283.64 1238.5,-9283.64"/>
</g>
<!-- expert_6_1 -->
<g id="node118" class="node">
<title>expert_6_1</title>
<polygon fill="#e8daef" stroke="black" points="1758,-9273.4 1342,-9273.4 1342,-9220.4 1758,-9220.4 1758,-9273.4"/>
<text text-anchor="middle" x="1550" y="-9258.2" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1550" y="-9243.2" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="1550" y="-9228.2" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_6&#45;&gt;expert_6_1 -->
<g id="edge164" class="edge">
<title>gate_6&#45;&gt;expert_6_1</title>
<path fill="none" stroke="black" d="M2834.3,-9363C2573,-9363 1687,-9363 1687,-9363 1687,-9363 1687,-9283.54 1687,-9283.54"/>
<polygon fill="black" stroke="black" points="1690.5,-9283.54 1687,-9273.54 1683.5,-9283.54 1690.5,-9283.54"/>
</g>
<!-- expert_6_2 -->
<g id="node119" class="node">
<title>expert_6_2</title>
<polygon fill="#e8daef" stroke="black" points="2210,-9273.4 1794,-9273.4 1794,-9220.4 2210,-9220.4 2210,-9273.4"/>
<text text-anchor="middle" x="2002" y="-9258.2" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2002" y="-9243.2" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="2002" y="-9228.2" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_6&#45;&gt;expert_6_2 -->
<g id="edge166" class="edge">
<title>gate_6&#45;&gt;expert_6_2</title>
<path fill="none" stroke="black" d="M2834.19,-9352C2643.52,-9352 2139,-9352 2139,-9352 2139,-9352 2139,-9283.42 2139,-9283.42"/>
<polygon fill="black" stroke="black" points="2142.5,-9283.42 2139,-9273.42 2135.5,-9283.42 2142.5,-9283.42"/>
</g>
<!-- expert_6_3 -->
<g id="node120" class="node">
<title>expert_6_3</title>
<polygon fill="#e8daef" stroke="black" points="2662,-9273.4 2246,-9273.4 2246,-9220.4 2662,-9220.4 2662,-9273.4"/>
<text text-anchor="middle" x="2454" y="-9258.2" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2454" y="-9243.2" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="2454" y="-9228.2" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_6&#45;&gt;expert_6_3 -->
<g id="edge168" class="edge">
<title>gate_6&#45;&gt;expert_6_3</title>
<path fill="none" stroke="black" d="M2834.13,-9342C2741.16,-9342 2591,-9342 2591,-9342 2591,-9342 2591,-9283.64 2591,-9283.64"/>
<polygon fill="black" stroke="black" points="2594.5,-9283.64 2591,-9273.64 2587.5,-9283.64 2594.5,-9283.64"/>
</g>
<!-- expert_6_4 -->
<g id="node121" class="node">
<title>expert_6_4</title>
<polygon fill="#e8daef" stroke="black" points="3114,-9273.4 2698,-9273.4 2698,-9220.4 3114,-9220.4 3114,-9273.4"/>
<text text-anchor="middle" x="2906" y="-9258.2" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="2906" y="-9243.2" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="2906" y="-9228.2" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_6&#45;&gt;expert_6_4 -->
<g id="edge170" class="edge">
<title>gate_6&#45;&gt;expert_6_4</title>
<path fill="none" stroke="black" d="M2906,-9331.31C2906,-9331.31 2906,-9283.66 2906,-9283.66"/>
<polygon fill="black" stroke="black" points="2909.5,-9283.66 2906,-9273.66 2902.5,-9283.66 2909.5,-9283.66"/>
</g>
<!-- expert_6_5 -->
<g id="node122" class="node">
<title>expert_6_5</title>
<polygon fill="#e8daef" stroke="black" points="3566,-9273.4 3150,-9273.4 3150,-9220.4 3566,-9220.4 3566,-9273.4"/>
<text text-anchor="middle" x="3358" y="-9258.2" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="3358" y="-9243.2" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="3358" y="-9228.2" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_6&#45;&gt;expert_6_5 -->
<g id="edge172" class="edge">
<title>gate_6&#45;&gt;expert_6_5</title>
<path fill="none" stroke="black" d="M2977.72,-9342C3083.51,-9342 3269,-9342 3269,-9342 3269,-9342 3269,-9283.64 3269,-9283.64"/>
<polygon fill="black" stroke="black" points="3272.5,-9283.64 3269,-9273.64 3265.5,-9283.64 3272.5,-9283.64"/>
</g>
<!-- expert_6_6 -->
<g id="node123" class="node">
<title>expert_6_6</title>
<polygon fill="#e8daef" stroke="black" points="4018,-9273.4 3602,-9273.4 3602,-9220.4 4018,-9220.4 4018,-9273.4"/>
<text text-anchor="middle" x="3810" y="-9258.2" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="3810" y="-9243.2" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="3810" y="-9228.2" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_6&#45;&gt;expert_6_6 -->
<g id="edge174" class="edge">
<title>gate_6&#45;&gt;expert_6_6</title>
<path fill="none" stroke="black" d="M2977.53,-9352C3167.46,-9352 3670,-9352 3670,-9352 3670,-9352 3670,-9283.42 3670,-9283.42"/>
<polygon fill="black" stroke="black" points="3673.5,-9283.42 3670,-9273.42 3666.5,-9283.42 3673.5,-9283.42"/>
</g>
<!-- expert_6_7 -->
<g id="node124" class="node">
<title>expert_6_7</title>
<polygon fill="#e8daef" stroke="black" points="4470,-9273.4 4054,-9273.4 4054,-9220.4 4470,-9220.4 4470,-9273.4"/>
<text text-anchor="middle" x="4262" y="-9258.2" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="4262" y="-9243.2" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="4262" y="-9228.2" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_6&#45;&gt;expert_6_7 -->
<g id="edge176" class="edge">
<title>gate_6&#45;&gt;expert_6_7</title>
<path fill="none" stroke="black" d="M2977.87,-9363C3240.84,-9363 4135.49,-9363 4135.49,-9363 4135.49,-9363 4135.49,-9283.54 4135.49,-9283.54"/>
<polygon fill="black" stroke="black" points="4138.99,-9283.54 4135.49,-9273.54 4131.99,-9283.54 4138.99,-9283.54"/>
</g>
<!-- expert_6_0&#45;&gt;expert_agg_6 -->
<g id="edge163" class="edge">
<title>expert_6_0&#45;&gt;expert_agg_6</title>
<path fill="none" stroke="black" d="M1187,-9220.3C1187,-9183.09 1187,-9120 1187,-9120 1187,-9120 3014.31,-9120 3014.31,-9120"/>
<polygon fill="black" stroke="black" points="3014.31,-9123.5 3024.31,-9120 3014.31,-9116.5 3014.31,-9123.5"/>
</g>
<!-- expert_6_1&#45;&gt;expert_agg_6 -->
<g id="edge165" class="edge">
<title>expert_6_1&#45;&gt;expert_agg_6</title>
<path fill="none" stroke="black" d="M1639,-9220.37C1639,-9185.88 1639,-9130 1639,-9130 1639,-9130 3014.33,-9130 3014.33,-9130"/>
<polygon fill="black" stroke="black" points="3014.33,-9133.5 3024.33,-9130 3014.33,-9126.5 3014.33,-9133.5"/>
</g>
<!-- expert_6_2&#45;&gt;expert_agg_6 -->
<g id="edge167" class="edge">
<title>expert_6_2&#45;&gt;expert_agg_6</title>
<path fill="none" stroke="black" d="M2091,-9220.18C2091,-9188.81 2091,-9141 2091,-9141 2091,-9141 3014.03,-9141 3014.03,-9141"/>
<polygon fill="black" stroke="black" points="3014.03,-9144.5 3024.03,-9141 3014.03,-9137.5 3014.03,-9144.5"/>
</g>
<!-- expert_6_3&#45;&gt;expert_agg_6 -->
<g id="edge169" class="edge">
<title>expert_6_3&#45;&gt;expert_agg_6</title>
<path fill="none" stroke="black" d="M2543,-9220.19C2543,-9191.81 2543,-9151 2543,-9151 2543,-9151 3014.31,-9151 3014.31,-9151"/>
<polygon fill="black" stroke="black" points="3014.31,-9154.5 3024.31,-9151 3014.31,-9147.5 3014.31,-9154.5"/>
</g>
<!-- expert_6_4&#45;&gt;expert_agg_6 -->
<g id="edge171" class="edge">
<title>expert_6_4&#45;&gt;expert_agg_6</title>
<path fill="none" stroke="black" d="M3069.25,-9220.31C3069.25,-9220.31 3069.25,-9172.66 3069.25,-9172.66"/>
<polygon fill="black" stroke="black" points="3072.75,-9172.66 3069.25,-9162.66 3065.75,-9172.66 3072.75,-9172.66"/>
</g>
<!-- expert_6_5&#45;&gt;expert_agg_6 -->
<g id="edge173" class="edge">
<title>expert_6_5&#45;&gt;expert_agg_6</title>
<path fill="none" stroke="black" d="M3194.75,-9220.31C3194.75,-9220.31 3194.75,-9172.66 3194.75,-9172.66"/>
<polygon fill="black" stroke="black" points="3198.25,-9172.66 3194.75,-9162.66 3191.25,-9172.66 3198.25,-9172.66"/>
</g>
<!-- expert_6_6&#45;&gt;expert_agg_6 -->
<g id="edge175" class="edge">
<title>expert_6_6&#45;&gt;expert_agg_6</title>
<path fill="none" stroke="black" d="M3659,-9220.15C3659,-9191.16 3659,-9149 3659,-9149 3659,-9149 3249.6,-9149 3249.6,-9149"/>
<polygon fill="black" stroke="black" points="3249.6,-9145.5 3239.6,-9149 3249.6,-9152.5 3249.6,-9145.5"/>
</g>
<!-- expert_6_7&#45;&gt;expert_agg_6 -->
<g id="edge177" class="edge">
<title>expert_6_7&#45;&gt;expert_agg_6</title>
<path fill="none" stroke="black" d="M4125,-9220.38C4125,-9187.29 4125,-9135 4125,-9135 4125,-9135 3249.68,-9135 3249.68,-9135"/>
<polygon fill="black" stroke="black" points="3249.68,-9131.5 3239.68,-9135 3249.68,-9138.5 3249.68,-9131.5"/>
</g>
<!-- expert_agg_6&#45;&gt;residual2_6 -->
<g id="edge180" class="edge">
<title>expert_agg_6&#45;&gt;residual2_6</title>
<path fill="none" stroke="black" d="M3239.69,-9122C3555.09,-9122 4454.75,-9122 4454.75,-9122 4454.75,-9122 4454.75,-9061.43 4454.75,-9061.43"/>
<polygon fill="black" stroke="black" points="4458.25,-9061.43 4454.75,-9051.43 4451.25,-9061.43 4458.25,-9061.43"/>
</g>
<!-- transfer_6 -->
<g id="node127" class="node">
<title>transfer_6</title>
<ellipse fill="#fadbd8" stroke="black" cx="4547" cy="-8913.53" rx="152.06" ry="26.74"/>
<text text-anchor="middle" x="4547" y="-8917.33" font-family="Helvetica,sans-Serif" font-size="14.00">Transfer to GPU 6</text>
<text text-anchor="middle" x="4547" y="-8902.33" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual2_6&#45;&gt;transfer_6 -->
<g id="edge181" class="edge">
<title>residual2_6&#45;&gt;transfer_6</title>
<path fill="none" stroke="black" d="M4547,-8998.23C4547,-8998.23 4547,-8950.76 4547,-8950.76"/>
<polygon fill="black" stroke="black" points="4550.5,-8950.76 4547,-8940.76 4543.5,-8950.76 4550.5,-8950.76"/>
</g>
<!-- residual1_7 -->
<g id="node134" class="node">
<title>residual1_7</title>
<polygon fill="#fadbd8" stroke="black" points="4802.5,-8828.66 4587.5,-8828.66 4587.5,-8775.66 4802.5,-8775.66 4802.5,-8828.66"/>
<text text-anchor="middle" x="4695" y="-8813.46" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="4695" y="-8798.46" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="4695" y="-8783.46" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- transfer_6&#45;&gt;residual1_7 -->
<g id="edge187" class="edge">
<title>transfer_6&#45;&gt;residual1_7</title>
<path fill="none" stroke="black" d="M4643.26,-8892.58C4643.26,-8892.58 4643.26,-8838.93 4643.26,-8838.93"/>
<polygon fill="black" stroke="black" points="4646.76,-8838.93 4643.26,-8828.93 4639.76,-8838.93 4646.76,-8838.93"/>
</g>
<!-- ln1_7 -->
<g id="node128" class="node">
<title>ln1_7</title>
<polygon fill="#f8f9f9" stroke="black" points="4950.5,-9495.4 4735.5,-9495.4 4735.5,-9442.4 4950.5,-9442.4 4950.5,-9495.4"/>
<text text-anchor="middle" x="4843" y="-9480.2" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="4843" y="-9465.2" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="4843" y="-9450.2" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_qkv_7 -->
<g id="node129" class="node">
<title>attn_qkv_7</title>
<polygon fill="#ffe6cc" stroke="black" points="4958,-9384.4 4728,-9384.4 4728,-9331.4 4958,-9331.4 4958,-9384.4"/>
<text text-anchor="middle" x="4843" y="-9369.2" font-family="Helvetica,sans-Serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="4843" y="-9354.2" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="4843" y="-9339.2" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 3*hidden_dim]</text>
</g>
<!-- ln1_7&#45;&gt;attn_qkv_7 -->
<g id="edge182" class="edge">
<title>ln1_7&#45;&gt;attn_qkv_7</title>
<path fill="none" stroke="black" d="M4843,-9442.31C4843,-9442.31 4843,-9394.66 4843,-9394.66"/>
<polygon fill="black" stroke="black" points="4846.5,-9394.66 4843,-9384.66 4839.5,-9394.66 4846.5,-9394.66"/>
</g>
<!-- attn_score_7 -->
<g id="node130" class="node">
<title>attn_score_7</title>
<polygon fill="#ffe6cc" stroke="black" points="4980.5,-9273.4 4705.5,-9273.4 4705.5,-9220.4 4980.5,-9220.4 4980.5,-9273.4"/>
<text text-anchor="middle" x="4843" y="-9258.2" font-family="Helvetica,sans-Serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="4843" y="-9243.2" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="4843" y="-9228.2" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_qkv_7&#45;&gt;attn_score_7 -->
<g id="edge183" class="edge">
<title>attn_qkv_7&#45;&gt;attn_score_7</title>
<path fill="none" stroke="black" d="M4843,-9331.31C4843,-9331.31 4843,-9283.66 4843,-9283.66"/>
<polygon fill="black" stroke="black" points="4846.5,-9283.66 4843,-9273.66 4839.5,-9283.66 4846.5,-9283.66"/>
</g>
<!-- attn_weight_7 -->
<g id="node131" class="node">
<title>attn_weight_7</title>
<polygon fill="#ffe6cc" stroke="black" points="4980.5,-9162.4 4705.5,-9162.4 4705.5,-9109.4 4980.5,-9109.4 4980.5,-9162.4"/>
<text text-anchor="middle" x="4843" y="-9147.2" font-family="Helvetica,sans-Serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="4843" y="-9132.2" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="4843" y="-9117.2" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_score_7&#45;&gt;attn_weight_7 -->
<g id="edge184" class="edge">
<title>attn_score_7&#45;&gt;attn_weight_7</title>
<path fill="none" stroke="black" d="M4843,-9220.31C4843,-9220.31 4843,-9172.66 4843,-9172.66"/>
<polygon fill="black" stroke="black" points="4846.5,-9172.66 4843,-9162.66 4839.5,-9172.66 4846.5,-9172.66"/>
</g>
<!-- attn_context_7 -->
<g id="node132" class="node">
<title>attn_context_7</title>
<polygon fill="#ffe6cc" stroke="black" points="4988,-9051.4 4698,-9051.4 4698,-8998.4 4988,-8998.4 4988,-9051.4"/>
<text text-anchor="middle" x="4843" y="-9036.2" font-family="Helvetica,sans-Serif" font-size="14.00">Context</text>
<text text-anchor="middle" x="4843" y="-9021.2" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="4843" y="-9006.2" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, head_dim]</text>
</g>
<!-- attn_weight_7&#45;&gt;attn_context_7 -->
<g id="edge185" class="edge">
<title>attn_weight_7&#45;&gt;attn_context_7</title>
<path fill="none" stroke="black" d="M4843,-9109.31C4843,-9109.31 4843,-9061.66 4843,-9061.66"/>
<polygon fill="black" stroke="black" points="4846.5,-9061.66 4843,-9051.66 4839.5,-9061.66 4846.5,-9061.66"/>
</g>
<!-- attn_out_7 -->
<g id="node133" class="node">
<title>attn_out_7</title>
<polygon fill="#ffe6cc" stroke="black" points="4950.5,-8940.03 4735.5,-8940.03 4735.5,-8887.03 4950.5,-8887.03 4950.5,-8940.03"/>
<text text-anchor="middle" x="4843" y="-8924.83" font-family="Helvetica,sans-Serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="4843" y="-8909.83" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="4843" y="-8894.83" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_context_7&#45;&gt;attn_out_7 -->
<g id="edge186" class="edge">
<title>attn_context_7&#45;&gt;attn_out_7</title>
<path fill="none" stroke="black" d="M4843,-8998.23C4843,-8998.23 4843,-8950.38 4843,-8950.38"/>
<polygon fill="black" stroke="black" points="4846.5,-8950.38 4843,-8940.38 4839.5,-8950.38 4846.5,-8950.38"/>
</g>
<!-- attn_out_7&#45;&gt;residual1_7 -->
<g id="edge188" class="edge">
<title>attn_out_7&#45;&gt;residual1_7</title>
<path fill="none" stroke="black" d="M4769,-8886.86C4769,-8886.86 4769,-8839.01 4769,-8839.01"/>
<polygon fill="black" stroke="black" points="4772.5,-8839.01 4769,-8829.01 4765.5,-8839.01 4772.5,-8839.01"/>
</g>
<!-- ln2_7 -->
<g id="node135" class="node">
<title>ln2_7</title>
<polygon fill="#f8f9f9" stroke="black" points="4721.5,-8717.66 4506.5,-8717.66 4506.5,-8664.66 4721.5,-8664.66 4721.5,-8717.66"/>
<text text-anchor="middle" x="4614" y="-8702.46" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;MoE)</text>
<text text-anchor="middle" x="4614" y="-8687.46" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="4614" y="-8672.46" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_7&#45;&gt;ln2_7 -->
<g id="edge189" class="edge">
<title>residual1_7&#45;&gt;ln2_7</title>
<path fill="none" stroke="black" d="M4654.5,-8775.57C4654.5,-8775.57 4654.5,-8727.92 4654.5,-8727.92"/>
<polygon fill="black" stroke="black" points="4658,-8727.92 4654.5,-8717.92 4651,-8727.92 4658,-8727.92"/>
</g>
<!-- residual2_7 -->
<g id="node147" class="node">
<title>residual2_7</title>
<polygon fill="#fadbd8" stroke="black" points="4832.5,-8162.66 4617.5,-8162.66 4617.5,-8109.66 4832.5,-8109.66 4832.5,-8162.66"/>
<text text-anchor="middle" x="4725" y="-8147.46" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="4725" y="-8132.46" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="4725" y="-8117.46" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_7&#45;&gt;residual2_7 -->
<g id="edge209" class="edge">
<title>residual1_7&#45;&gt;residual2_7</title>
<path fill="none" stroke="black" d="M4762,-8775.64C4762,-8775.64 4762,-8172.76 4762,-8172.76"/>
<polygon fill="black" stroke="black" points="4765.5,-8172.76 4762,-8162.76 4758.5,-8172.76 4765.5,-8172.76"/>
</g>
<!-- router_7 -->
<g id="node136" class="node">
<title>router_7</title>
<polygon fill="#f5b7b1" stroke="black" points="3916,-8606.66 3716,-8606.66 3716,-8553.66 3916,-8553.66 3916,-8606.66"/>
<text text-anchor="middle" x="3816" y="-8591.46" font-family="Helvetica,sans-Serif" font-size="14.00">Router Network</text>
<text text-anchor="middle" x="3816" y="-8576.46" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="3816" y="-8561.46" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 8 experts]</text>
</g>
<!-- ln2_7&#45;&gt;router_7 -->
<g id="edge190" class="edge">
<title>ln2_7&#45;&gt;router_7</title>
<path fill="none" stroke="black" d="M4577.25,-8664.54C4577.25,-8631.65 4577.25,-8580 4577.25,-8580 4577.25,-8580 3926.3,-8580 3926.3,-8580"/>
<polygon fill="black" stroke="black" points="3926.3,-8576.5 3916.3,-8580 3926.3,-8583.5 3926.3,-8576.5"/>
</g>
<!-- expert_agg_7 -->
<g id="node146" class="node">
<title>expert_agg_7</title>
<polygon fill="#d4e6f1" stroke="black" points="3417.5,-8273.66 3202.5,-8273.66 3202.5,-8220.66 3417.5,-8220.66 3417.5,-8273.66"/>
<text text-anchor="middle" x="3310" y="-8258.46" font-family="Helvetica,sans-Serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="3310" y="-8243.46" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="3310" y="-8228.46" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- ln2_7&#45;&gt;expert_agg_7 -->
<g id="edge208" class="edge">
<title>ln2_7&#45;&gt;expert_agg_7</title>
<path fill="none" stroke="black" d="M4506.46,-8691C4194.28,-8691 3310,-8691 3310,-8691 3310,-8691 3310,-8283.93 3310,-8283.93"/>
<polygon fill="black" stroke="black" points="3313.5,-8283.93 3310,-8273.93 3306.5,-8283.93 3313.5,-8283.93"/>
</g>
<!-- gate_7 -->
<g id="node137" class="node">
<title>gate_7</title>
<polygon fill="#f5b7b1" stroke="black" points="3155.5,-8495.66 3012.5,-8495.66 3012.5,-8442.66 3155.5,-8442.66 3155.5,-8495.66"/>
<text text-anchor="middle" x="3084" y="-8480.46" font-family="Helvetica,sans-Serif" font-size="14.00">Top&#45;2 Gating</text>
<text text-anchor="middle" x="3084" y="-8465.46" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="3084" y="-8450.46" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 2]</text>
</g>
<!-- router_7&#45;&gt;gate_7 -->
<g id="edge191" class="edge">
<title>router_7&#45;&gt;gate_7</title>
<path fill="none" stroke="black" d="M3730,-8553.65C3730,-8525.5 3730,-8485 3730,-8485 3730,-8485 3165.6,-8485 3165.6,-8485"/>
<polygon fill="black" stroke="black" points="3165.6,-8481.5 3155.6,-8485 3165.6,-8488.5 3165.6,-8481.5"/>
</g>
<!-- expert_7_0 -->
<g id="node138" class="node">
<title>expert_7_0</title>
<polygon fill="#e8daef" stroke="black" points="1484,-8384.66 1068,-8384.66 1068,-8331.66 1484,-8331.66 1484,-8384.66"/>
<text text-anchor="middle" x="1276" y="-8369.46" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="1276" y="-8354.46" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="1276" y="-8339.46" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_7&#45;&gt;expert_7_0 -->
<g id="edge192" class="edge">
<title>gate_7&#45;&gt;expert_7_0</title>
<path fill="none" stroke="black" d="M3012.47,-8485C2693.07,-8485 1413,-8485 1413,-8485 1413,-8485 1413,-8394.75 1413,-8394.75"/>
<polygon fill="black" stroke="black" points="1416.5,-8394.75 1413,-8384.75 1409.5,-8394.75 1416.5,-8394.75"/>
</g>
<!-- expert_7_1 -->
<g id="node139" class="node">
<title>expert_7_1</title>
<polygon fill="#e8daef" stroke="black" points="1936,-8384.66 1520,-8384.66 1520,-8331.66 1936,-8331.66 1936,-8384.66"/>
<text text-anchor="middle" x="1728" y="-8369.46" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1728" y="-8354.46" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="1728" y="-8339.46" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_7&#45;&gt;expert_7_1 -->
<g id="edge194" class="edge">
<title>gate_7&#45;&gt;expert_7_1</title>
<path fill="none" stroke="black" d="M3012.3,-8474C2751,-8474 1865,-8474 1865,-8474 1865,-8474 1865,-8394.74 1865,-8394.74"/>
<polygon fill="black" stroke="black" points="1868.5,-8394.74 1865,-8384.74 1861.5,-8394.74 1868.5,-8394.74"/>
</g>
<!-- expert_7_2 -->
<g id="node140" class="node">
<title>expert_7_2</title>
<polygon fill="#e8daef" stroke="black" points="2388,-8384.66 1972,-8384.66 1972,-8331.66 2388,-8331.66 2388,-8384.66"/>
<text text-anchor="middle" x="2180" y="-8369.46" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2180" y="-8354.46" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="2180" y="-8339.46" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_7&#45;&gt;expert_7_2 -->
<g id="edge196" class="edge">
<title>gate_7&#45;&gt;expert_7_2</title>
<path fill="none" stroke="black" d="M3012.19,-8463C2821.52,-8463 2317,-8463 2317,-8463 2317,-8463 2317,-8394.89 2317,-8394.89"/>
<polygon fill="black" stroke="black" points="2320.5,-8394.89 2317,-8384.89 2313.5,-8394.89 2320.5,-8394.89"/>
</g>
<!-- expert_7_3 -->
<g id="node141" class="node">
<title>expert_7_3</title>
<polygon fill="#e8daef" stroke="black" points="2840,-8384.66 2424,-8384.66 2424,-8331.66 2840,-8331.66 2840,-8384.66"/>
<text text-anchor="middle" x="2632" y="-8369.46" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2632" y="-8354.46" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="2632" y="-8339.46" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_7&#45;&gt;expert_7_3 -->
<g id="edge198" class="edge">
<title>gate_7&#45;&gt;expert_7_3</title>
<path fill="none" stroke="black" d="M3012.13,-8453C2919.16,-8453 2769,-8453 2769,-8453 2769,-8453 2769,-8394.83 2769,-8394.83"/>
<polygon fill="black" stroke="black" points="2772.5,-8394.83 2769,-8384.83 2765.5,-8394.83 2772.5,-8394.83"/>
</g>
<!-- expert_7_4 -->
<g id="node142" class="node">
<title>expert_7_4</title>
<polygon fill="#e8daef" stroke="black" points="3292,-8384.66 2876,-8384.66 2876,-8331.66 3292,-8331.66 3292,-8384.66"/>
<text text-anchor="middle" x="3084" y="-8369.46" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="3084" y="-8354.46" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="3084" y="-8339.46" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_7&#45;&gt;expert_7_4 -->
<g id="edge200" class="edge">
<title>gate_7&#45;&gt;expert_7_4</title>
<path fill="none" stroke="black" d="M3084,-8442.57C3084,-8442.57 3084,-8394.92 3084,-8394.92"/>
<polygon fill="black" stroke="black" points="3087.5,-8394.92 3084,-8384.92 3080.5,-8394.92 3087.5,-8394.92"/>
</g>
<!-- expert_7_5 -->
<g id="node143" class="node">
<title>expert_7_5</title>
<polygon fill="#e8daef" stroke="black" points="3744,-8384.66 3328,-8384.66 3328,-8331.66 3744,-8331.66 3744,-8384.66"/>
<text text-anchor="middle" x="3536" y="-8369.46" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="3536" y="-8354.46" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="3536" y="-8339.46" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_7&#45;&gt;expert_7_5 -->
<g id="edge202" class="edge">
<title>gate_7&#45;&gt;expert_7_5</title>
<path fill="none" stroke="black" d="M3155.72,-8453C3261.51,-8453 3447,-8453 3447,-8453 3447,-8453 3447,-8394.83 3447,-8394.83"/>
<polygon fill="black" stroke="black" points="3450.5,-8394.83 3447,-8384.83 3443.5,-8394.83 3450.5,-8394.83"/>
</g>
<!-- expert_7_6 -->
<g id="node144" class="node">
<title>expert_7_6</title>
<polygon fill="#e8daef" stroke="black" points="4196,-8384.66 3780,-8384.66 3780,-8331.66 4196,-8331.66 4196,-8384.66"/>
<text text-anchor="middle" x="3988" y="-8369.46" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="3988" y="-8354.46" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="3988" y="-8339.46" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_7&#45;&gt;expert_7_6 -->
<g id="edge204" class="edge">
<title>gate_7&#45;&gt;expert_7_6</title>
<path fill="none" stroke="black" d="M3155.53,-8463C3345.46,-8463 3848,-8463 3848,-8463 3848,-8463 3848,-8394.89 3848,-8394.89"/>
<polygon fill="black" stroke="black" points="3851.5,-8394.89 3848,-8384.89 3844.5,-8394.89 3851.5,-8394.89"/>
</g>
<!-- expert_7_7 -->
<g id="node145" class="node">
<title>expert_7_7</title>
<polygon fill="#e8daef" stroke="black" points="4648,-8384.66 4232,-8384.66 4232,-8331.66 4648,-8331.66 4648,-8384.66"/>
<text text-anchor="middle" x="4440" y="-8369.46" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="4440" y="-8354.46" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="4440" y="-8339.46" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_7&#45;&gt;expert_7_7 -->
<g id="edge206" class="edge">
<title>gate_7&#45;&gt;expert_7_7</title>
<path fill="none" stroke="black" d="M3155.87,-8474C3418.84,-8474 4313.49,-8474 4313.49,-8474 4313.49,-8474 4313.49,-8394.74 4313.49,-8394.74"/>
<polygon fill="black" stroke="black" points="4316.99,-8394.74 4313.49,-8384.74 4309.99,-8394.74 4316.99,-8394.74"/>
</g>
<!-- expert_7_0&#45;&gt;expert_agg_7 -->
<g id="edge193" class="edge">
<title>expert_7_0&#45;&gt;expert_agg_7</title>
<path fill="none" stroke="black" d="M1365,-8331.5C1365,-8294.22 1365,-8231 1365,-8231 1365,-8231 3192.31,-8231 3192.31,-8231"/>
<polygon fill="black" stroke="black" points="3192.31,-8234.5 3202.31,-8231 3192.31,-8227.5 3192.31,-8234.5"/>
</g>
<!-- expert_7_1&#45;&gt;expert_agg_7 -->
<g id="edge195" class="edge">
<title>expert_7_1&#45;&gt;expert_agg_7</title>
<path fill="none" stroke="black" d="M1817,-8331.58C1817,-8297.01 1817,-8241 1817,-8241 1817,-8241 3192.33,-8241 3192.33,-8241"/>
<polygon fill="black" stroke="black" points="3192.33,-8244.5 3202.33,-8241 3192.33,-8237.5 3192.33,-8244.5"/>
</g>
<!-- expert_7_2&#45;&gt;expert_agg_7 -->
<g id="edge197" class="edge">
<title>expert_7_2&#45;&gt;expert_agg_7</title>
<path fill="none" stroke="black" d="M2269,-8331.65C2269,-8300.2 2269,-8252 2269,-8252 2269,-8252 3192.03,-8252 3192.03,-8252"/>
<polygon fill="black" stroke="black" points="3192.03,-8255.5 3202.03,-8252 3192.03,-8248.5 3192.03,-8255.5"/>
</g>
<!-- expert_7_3&#45;&gt;expert_agg_7 -->
<g id="edge199" class="edge">
<title>expert_7_3&#45;&gt;expert_agg_7</title>
<path fill="none" stroke="black" d="M2721,-8331.65C2721,-8303.5 2721,-8263 2721,-8263 2721,-8263 3192.31,-8263 3192.31,-8263"/>
<polygon fill="black" stroke="black" points="3192.31,-8266.5 3202.31,-8263 3192.31,-8259.5 3192.31,-8266.5"/>
</g>
<!-- expert_7_4&#45;&gt;expert_agg_7 -->
<g id="edge201" class="edge">
<title>expert_7_4&#45;&gt;expert_agg_7</title>
<path fill="none" stroke="black" d="M3247.25,-8331.57C3247.25,-8331.57 3247.25,-8283.92 3247.25,-8283.92"/>
<polygon fill="black" stroke="black" points="3250.75,-8283.92 3247.25,-8273.92 3243.75,-8283.92 3250.75,-8283.92"/>
</g>
<!-- expert_7_5&#45;&gt;expert_agg_7 -->
<g id="edge203" class="edge">
<title>expert_7_5&#45;&gt;expert_agg_7</title>
<path fill="none" stroke="black" d="M3372.75,-8331.57C3372.75,-8331.57 3372.75,-8283.92 3372.75,-8283.92"/>
<polygon fill="black" stroke="black" points="3376.25,-8283.92 3372.75,-8273.92 3369.25,-8283.92 3376.25,-8283.92"/>
</g>
<!-- expert_7_6&#45;&gt;expert_agg_7 -->
<g id="edge205" class="edge">
<title>expert_7_6&#45;&gt;expert_agg_7</title>
<path fill="none" stroke="black" d="M3837,-8331.6C3837,-8302.53 3837,-8260 3837,-8260 3837,-8260 3427.6,-8260 3427.6,-8260"/>
<polygon fill="black" stroke="black" points="3427.6,-8256.5 3417.6,-8260 3427.6,-8263.5 3427.6,-8256.5"/>
</g>
<!-- expert_7_7&#45;&gt;expert_agg_7 -->
<g id="edge207" class="edge">
<title>expert_7_7&#45;&gt;expert_agg_7</title>
<path fill="none" stroke="black" d="M4303,-8331.54C4303,-8298.65 4303,-8247 4303,-8247 4303,-8247 3427.68,-8247 3427.68,-8247"/>
<polygon fill="black" stroke="black" points="3427.68,-8243.5 3417.68,-8247 3427.68,-8250.5 3427.68,-8243.5"/>
</g>
<!-- expert_agg_7&#45;&gt;residual2_7 -->
<g id="edge210" class="edge">
<title>expert_agg_7&#45;&gt;residual2_7</title>
<path fill="none" stroke="black" d="M3417.69,-8233C3733.09,-8233 4632.75,-8233 4632.75,-8233 4632.75,-8233 4632.75,-8172.88 4632.75,-8172.88"/>
<polygon fill="black" stroke="black" points="4636.25,-8172.88 4632.75,-8162.88 4629.25,-8172.88 4636.25,-8172.88"/>
</g>
<!-- transfer_7 -->
<g id="node148" class="node">
<title>transfer_7</title>
<ellipse fill="#fadbd8" stroke="black" cx="4725" cy="-8024.79" rx="152.06" ry="26.74"/>
<text text-anchor="middle" x="4725" y="-8028.59" font-family="Helvetica,sans-Serif" font-size="14.00">Transfer to GPU 7</text>
<text text-anchor="middle" x="4725" y="-8013.59" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual2_7&#45;&gt;transfer_7 -->
<g id="edge211" class="edge">
<title>residual2_7&#45;&gt;transfer_7</title>
<path fill="none" stroke="black" d="M4725,-8109.49C4725,-8109.49 4725,-8062.02 4725,-8062.02"/>
<polygon fill="black" stroke="black" points="4728.5,-8062.02 4725,-8052.02 4721.5,-8062.02 4728.5,-8062.02"/>
</g>
<!-- residual1_8 -->
<g id="node155" class="node">
<title>residual1_8</title>
<polygon fill="#fadbd8" stroke="black" points="4980.5,-7939.92 4765.5,-7939.92 4765.5,-7886.92 4980.5,-7886.92 4980.5,-7939.92"/>
<text text-anchor="middle" x="4873" y="-7924.72" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="4873" y="-7909.72" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="4873" y="-7894.72" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- transfer_7&#45;&gt;residual1_8 -->
<g id="edge217" class="edge">
<title>transfer_7&#45;&gt;residual1_8</title>
<path fill="none" stroke="black" d="M4821.26,-8003.84C4821.26,-8003.84 4821.26,-7950.19 4821.26,-7950.19"/>
<polygon fill="black" stroke="black" points="4824.76,-7950.19 4821.26,-7940.19 4817.76,-7950.19 4824.76,-7950.19"/>
</g>
<!-- ln1_8 -->
<g id="node149" class="node">
<title>ln1_8</title>
<polygon fill="#f8f9f9" stroke="black" points="5128.5,-8606.66 4913.5,-8606.66 4913.5,-8553.66 5128.5,-8553.66 5128.5,-8606.66"/>
<text text-anchor="middle" x="5021" y="-8591.46" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="5021" y="-8576.46" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="5021" y="-8561.46" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_qkv_8 -->
<g id="node150" class="node">
<title>attn_qkv_8</title>
<polygon fill="#ffe6cc" stroke="black" points="5136,-8495.66 4906,-8495.66 4906,-8442.66 5136,-8442.66 5136,-8495.66"/>
<text text-anchor="middle" x="5021" y="-8480.46" font-family="Helvetica,sans-Serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5021" y="-8465.46" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="5021" y="-8450.46" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 3*hidden_dim]</text>
</g>
<!-- ln1_8&#45;&gt;attn_qkv_8 -->
<g id="edge212" class="edge">
<title>ln1_8&#45;&gt;attn_qkv_8</title>
<path fill="none" stroke="black" d="M5021,-8553.57C5021,-8553.57 5021,-8505.92 5021,-8505.92"/>
<polygon fill="black" stroke="black" points="5024.5,-8505.92 5021,-8495.92 5017.5,-8505.92 5024.5,-8505.92"/>
</g>
<!-- attn_score_8 -->
<g id="node151" class="node">
<title>attn_score_8</title>
<polygon fill="#ffe6cc" stroke="black" points="5158.5,-8384.66 4883.5,-8384.66 4883.5,-8331.66 5158.5,-8331.66 5158.5,-8384.66"/>
<text text-anchor="middle" x="5021" y="-8369.46" font-family="Helvetica,sans-Serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="5021" y="-8354.46" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="5021" y="-8339.46" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_qkv_8&#45;&gt;attn_score_8 -->
<g id="edge213" class="edge">
<title>attn_qkv_8&#45;&gt;attn_score_8</title>
<path fill="none" stroke="black" d="M5021,-8442.57C5021,-8442.57 5021,-8394.92 5021,-8394.92"/>
<polygon fill="black" stroke="black" points="5024.5,-8394.92 5021,-8384.92 5017.5,-8394.92 5024.5,-8394.92"/>
</g>
<!-- attn_weight_8 -->
<g id="node152" class="node">
<title>attn_weight_8</title>
<polygon fill="#ffe6cc" stroke="black" points="5158.5,-8273.66 4883.5,-8273.66 4883.5,-8220.66 5158.5,-8220.66 5158.5,-8273.66"/>
<text text-anchor="middle" x="5021" y="-8258.46" font-family="Helvetica,sans-Serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="5021" y="-8243.46" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="5021" y="-8228.46" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_score_8&#45;&gt;attn_weight_8 -->
<g id="edge214" class="edge">
<title>attn_score_8&#45;&gt;attn_weight_8</title>
<path fill="none" stroke="black" d="M5021,-8331.57C5021,-8331.57 5021,-8283.92 5021,-8283.92"/>
<polygon fill="black" stroke="black" points="5024.5,-8283.92 5021,-8273.92 5017.5,-8283.92 5024.5,-8283.92"/>
</g>
<!-- attn_context_8 -->
<g id="node153" class="node">
<title>attn_context_8</title>
<polygon fill="#ffe6cc" stroke="black" points="5166,-8162.66 4876,-8162.66 4876,-8109.66 5166,-8109.66 5166,-8162.66"/>
<text text-anchor="middle" x="5021" y="-8147.46" font-family="Helvetica,sans-Serif" font-size="14.00">Context</text>
<text text-anchor="middle" x="5021" y="-8132.46" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="5021" y="-8117.46" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, head_dim]</text>
</g>
<!-- attn_weight_8&#45;&gt;attn_context_8 -->
<g id="edge215" class="edge">
<title>attn_weight_8&#45;&gt;attn_context_8</title>
<path fill="none" stroke="black" d="M5021,-8220.57C5021,-8220.57 5021,-8172.92 5021,-8172.92"/>
<polygon fill="black" stroke="black" points="5024.5,-8172.92 5021,-8162.92 5017.5,-8172.92 5024.5,-8172.92"/>
</g>
<!-- attn_out_8 -->
<g id="node154" class="node">
<title>attn_out_8</title>
<polygon fill="#ffe6cc" stroke="black" points="5128.5,-8051.29 4913.5,-8051.29 4913.5,-7998.29 5128.5,-7998.29 5128.5,-8051.29"/>
<text text-anchor="middle" x="5021" y="-8036.09" font-family="Helvetica,sans-Serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="5021" y="-8021.09" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="5021" y="-8006.09" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_context_8&#45;&gt;attn_out_8 -->
<g id="edge216" class="edge">
<title>attn_context_8&#45;&gt;attn_out_8</title>
<path fill="none" stroke="black" d="M5021,-8109.49C5021,-8109.49 5021,-8061.64 5021,-8061.64"/>
<polygon fill="black" stroke="black" points="5024.5,-8061.64 5021,-8051.64 5017.5,-8061.64 5024.5,-8061.64"/>
</g>
<!-- attn_out_8&#45;&gt;residual1_8 -->
<g id="edge218" class="edge">
<title>attn_out_8&#45;&gt;residual1_8</title>
<path fill="none" stroke="black" d="M4947,-7998.12C4947,-7998.12 4947,-7950.27 4947,-7950.27"/>
<polygon fill="black" stroke="black" points="4950.5,-7950.27 4947,-7940.27 4943.5,-7950.27 4950.5,-7950.27"/>
</g>
<!-- ln2_8 -->
<g id="node156" class="node">
<title>ln2_8</title>
<polygon fill="#f8f9f9" stroke="black" points="4899.5,-7828.92 4684.5,-7828.92 4684.5,-7775.92 4899.5,-7775.92 4899.5,-7828.92"/>
<text text-anchor="middle" x="4792" y="-7813.72" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;MoE)</text>
<text text-anchor="middle" x="4792" y="-7798.72" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="4792" y="-7783.72" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_8&#45;&gt;ln2_8 -->
<g id="edge219" class="edge">
<title>residual1_8&#45;&gt;ln2_8</title>
<path fill="none" stroke="black" d="M4832.5,-7886.83C4832.5,-7886.83 4832.5,-7839.18 4832.5,-7839.18"/>
<polygon fill="black" stroke="black" points="4836,-7839.18 4832.5,-7829.18 4829,-7839.18 4836,-7839.18"/>
</g>
<!-- residual2_8 -->
<g id="node168" class="node">
<title>residual2_8</title>
<polygon fill="#fadbd8" stroke="black" points="5010.5,-7273.92 4795.5,-7273.92 4795.5,-7220.92 5010.5,-7220.92 5010.5,-7273.92"/>
<text text-anchor="middle" x="4903" y="-7258.72" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="4903" y="-7243.72" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="4903" y="-7228.72" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_8&#45;&gt;residual2_8 -->
<g id="edge239" class="edge">
<title>residual1_8&#45;&gt;residual2_8</title>
<path fill="none" stroke="black" d="M4940,-7886.9C4940,-7886.9 4940,-7284.02 4940,-7284.02"/>
<polygon fill="black" stroke="black" points="4943.5,-7284.02 4940,-7274.02 4936.5,-7284.02 4943.5,-7284.02"/>
</g>
<!-- router_8 -->
<g id="node157" class="node">
<title>router_8</title>
<polygon fill="#f5b7b1" stroke="black" points="4094,-7717.92 3894,-7717.92 3894,-7664.92 4094,-7664.92 4094,-7717.92"/>
<text text-anchor="middle" x="3994" y="-7702.72" font-family="Helvetica,sans-Serif" font-size="14.00">Router Network</text>
<text text-anchor="middle" x="3994" y="-7687.72" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="3994" y="-7672.72" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 8 experts]</text>
</g>
<!-- ln2_8&#45;&gt;router_8 -->
<g id="edge220" class="edge">
<title>ln2_8&#45;&gt;router_8</title>
<path fill="none" stroke="black" d="M4755.25,-7775.73C4755.25,-7742.77 4755.25,-7691 4755.25,-7691 4755.25,-7691 4104.3,-7691 4104.3,-7691"/>
<polygon fill="black" stroke="black" points="4104.3,-7687.5 4094.3,-7691 4104.3,-7694.5 4104.3,-7687.5"/>
</g>
<!-- expert_agg_8 -->
<g id="node167" class="node">
<title>expert_agg_8</title>
<polygon fill="#d4e6f1" stroke="black" points="3595.5,-7384.92 3380.5,-7384.92 3380.5,-7331.92 3595.5,-7331.92 3595.5,-7384.92"/>
<text text-anchor="middle" x="3488" y="-7369.72" font-family="Helvetica,sans-Serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="3488" y="-7354.72" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="3488" y="-7339.72" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- ln2_8&#45;&gt;expert_agg_8 -->
<g id="edge238" class="edge">
<title>ln2_8&#45;&gt;expert_agg_8</title>
<path fill="none" stroke="black" d="M4684.46,-7802C4372.28,-7802 3488,-7802 3488,-7802 3488,-7802 3488,-7395.17 3488,-7395.17"/>
<polygon fill="black" stroke="black" points="3491.5,-7395.17 3488,-7385.17 3484.5,-7395.17 3491.5,-7395.17"/>
</g>
<!-- gate_8 -->
<g id="node158" class="node">
<title>gate_8</title>
<polygon fill="#f5b7b1" stroke="black" points="3333.5,-7606.92 3190.5,-7606.92 3190.5,-7553.92 3333.5,-7553.92 3333.5,-7606.92"/>
<text text-anchor="middle" x="3262" y="-7591.72" font-family="Helvetica,sans-Serif" font-size="14.00">Top&#45;2 Gating</text>
<text text-anchor="middle" x="3262" y="-7576.72" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="3262" y="-7561.72" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 2]</text>
</g>
<!-- router_8&#45;&gt;gate_8 -->
<g id="edge221" class="edge">
<title>router_8&#45;&gt;gate_8</title>
<path fill="none" stroke="black" d="M3908,-7664.84C3908,-7636.61 3908,-7596 3908,-7596 3908,-7596 3343.6,-7596 3343.6,-7596"/>
<polygon fill="black" stroke="black" points="3343.6,-7592.5 3333.6,-7596 3343.6,-7599.5 3343.6,-7592.5"/>
</g>
<!-- expert_8_0 -->
<g id="node159" class="node">
<title>expert_8_0</title>
<polygon fill="#e8daef" stroke="black" points="1662,-7495.92 1246,-7495.92 1246,-7442.92 1662,-7442.92 1662,-7495.92"/>
<text text-anchor="middle" x="1454" y="-7480.72" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="1454" y="-7465.72" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="1454" y="-7450.72" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_8&#45;&gt;expert_8_0 -->
<g id="edge222" class="edge">
<title>gate_8&#45;&gt;expert_8_0</title>
<path fill="none" stroke="black" d="M3190.47,-7596C2871.07,-7596 1591,-7596 1591,-7596 1591,-7596 1591,-7505.96 1591,-7505.96"/>
<polygon fill="black" stroke="black" points="1594.5,-7505.96 1591,-7495.96 1587.5,-7505.96 1594.5,-7505.96"/>
</g>
<!-- expert_8_1 -->
<g id="node160" class="node">
<title>expert_8_1</title>
<polygon fill="#e8daef" stroke="black" points="2114,-7495.92 1698,-7495.92 1698,-7442.92 2114,-7442.92 2114,-7495.92"/>
<text text-anchor="middle" x="1906" y="-7480.72" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1906" y="-7465.72" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="1906" y="-7450.72" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_8&#45;&gt;expert_8_1 -->
<g id="edge224" class="edge">
<title>gate_8&#45;&gt;expert_8_1</title>
<path fill="none" stroke="black" d="M3190.3,-7585C2929,-7585 2043,-7585 2043,-7585 2043,-7585 2043,-7505.94 2043,-7505.94"/>
<polygon fill="black" stroke="black" points="2046.5,-7505.94 2043,-7495.94 2039.5,-7505.94 2046.5,-7505.94"/>
</g>
<!-- expert_8_2 -->
<g id="node161" class="node">
<title>expert_8_2</title>
<polygon fill="#e8daef" stroke="black" points="2566,-7495.92 2150,-7495.92 2150,-7442.92 2566,-7442.92 2566,-7495.92"/>
<text text-anchor="middle" x="2358" y="-7480.72" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2358" y="-7465.72" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="2358" y="-7450.72" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_8&#45;&gt;expert_8_2 -->
<g id="edge226" class="edge">
<title>gate_8&#45;&gt;expert_8_2</title>
<path fill="none" stroke="black" d="M3190.19,-7575C2999.52,-7575 2495,-7575 2495,-7575 2495,-7575 2495,-7506.06 2495,-7506.06"/>
<polygon fill="black" stroke="black" points="2498.5,-7506.06 2495,-7496.06 2491.5,-7506.06 2498.5,-7506.06"/>
</g>
<!-- expert_8_3 -->
<g id="node162" class="node">
<title>expert_8_3</title>
<polygon fill="#e8daef" stroke="black" points="3018,-7495.92 2602,-7495.92 2602,-7442.92 3018,-7442.92 3018,-7495.92"/>
<text text-anchor="middle" x="2810" y="-7480.72" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2810" y="-7465.72" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="2810" y="-7450.72" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_8&#45;&gt;expert_8_3 -->
<g id="edge228" class="edge">
<title>gate_8&#45;&gt;expert_8_3</title>
<path fill="none" stroke="black" d="M3190.13,-7564C3097.16,-7564 2947,-7564 2947,-7564 2947,-7564 2947,-7506.02 2947,-7506.02"/>
<polygon fill="black" stroke="black" points="2950.5,-7506.02 2947,-7496.02 2943.5,-7506.02 2950.5,-7506.02"/>
</g>
<!-- expert_8_4 -->
<g id="node163" class="node">
<title>expert_8_4</title>
<polygon fill="#e8daef" stroke="black" points="3470,-7495.92 3054,-7495.92 3054,-7442.92 3470,-7442.92 3470,-7495.92"/>
<text text-anchor="middle" x="3262" y="-7480.72" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="3262" y="-7465.72" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="3262" y="-7450.72" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_8&#45;&gt;expert_8_4 -->
<g id="edge230" class="edge">
<title>gate_8&#45;&gt;expert_8_4</title>
<path fill="none" stroke="black" d="M3262,-7553.83C3262,-7553.83 3262,-7506.18 3262,-7506.18"/>
<polygon fill="black" stroke="black" points="3265.5,-7506.18 3262,-7496.18 3258.5,-7506.18 3265.5,-7506.18"/>
</g>
<!-- expert_8_5 -->
<g id="node164" class="node">
<title>expert_8_5</title>
<polygon fill="#e8daef" stroke="black" points="3922,-7495.92 3506,-7495.92 3506,-7442.92 3922,-7442.92 3922,-7495.92"/>
<text text-anchor="middle" x="3714" y="-7480.72" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="3714" y="-7465.72" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="3714" y="-7450.72" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_8&#45;&gt;expert_8_5 -->
<g id="edge232" class="edge">
<title>gate_8&#45;&gt;expert_8_5</title>
<path fill="none" stroke="black" d="M3333.72,-7564C3439.51,-7564 3625,-7564 3625,-7564 3625,-7564 3625,-7506.02 3625,-7506.02"/>
<polygon fill="black" stroke="black" points="3628.5,-7506.02 3625,-7496.02 3621.5,-7506.02 3628.5,-7506.02"/>
</g>
<!-- expert_8_6 -->
<g id="node165" class="node">
<title>expert_8_6</title>
<polygon fill="#e8daef" stroke="black" points="4374,-7495.92 3958,-7495.92 3958,-7442.92 4374,-7442.92 4374,-7495.92"/>
<text text-anchor="middle" x="4166" y="-7480.72" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="4166" y="-7465.72" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="4166" y="-7450.72" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_8&#45;&gt;expert_8_6 -->
<g id="edge234" class="edge">
<title>gate_8&#45;&gt;expert_8_6</title>
<path fill="none" stroke="black" d="M3333.53,-7575C3523.46,-7575 4026,-7575 4026,-7575 4026,-7575 4026,-7506.06 4026,-7506.06"/>
<polygon fill="black" stroke="black" points="4029.5,-7506.06 4026,-7496.06 4022.5,-7506.06 4029.5,-7506.06"/>
</g>
<!-- expert_8_7 -->
<g id="node166" class="node">
<title>expert_8_7</title>
<polygon fill="#e8daef" stroke="black" points="4826,-7495.92 4410,-7495.92 4410,-7442.92 4826,-7442.92 4826,-7495.92"/>
<text text-anchor="middle" x="4618" y="-7480.72" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="4618" y="-7465.72" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="4618" y="-7450.72" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_8&#45;&gt;expert_8_7 -->
<g id="edge236" class="edge">
<title>gate_8&#45;&gt;expert_8_7</title>
<path fill="none" stroke="black" d="M3333.87,-7585C3596.84,-7585 4491.49,-7585 4491.49,-7585 4491.49,-7585 4491.49,-7505.94 4491.49,-7505.94"/>
<polygon fill="black" stroke="black" points="4494.99,-7505.94 4491.49,-7495.94 4487.99,-7505.94 4494.99,-7505.94"/>
</g>
<!-- expert_8_0&#45;&gt;expert_agg_8 -->
<g id="edge223" class="edge">
<title>expert_8_0&#45;&gt;expert_agg_8</title>
<path fill="none" stroke="black" d="M1543,-7442.71C1543,-7405.35 1543,-7342 1543,-7342 1543,-7342 3370.31,-7342 3370.31,-7342"/>
<polygon fill="black" stroke="black" points="3370.31,-7345.5 3380.31,-7342 3370.31,-7338.5 3370.31,-7345.5"/>
</g>
<!-- expert_8_1&#45;&gt;expert_agg_8 -->
<g id="edge225" class="edge">
<title>expert_8_1&#45;&gt;expert_agg_8</title>
<path fill="none" stroke="black" d="M1995,-7442.71C1995,-7408.34 1995,-7353 1995,-7353 1995,-7353 3370.33,-7353 3370.33,-7353"/>
<polygon fill="black" stroke="black" points="3370.33,-7356.5 3380.33,-7353 3370.33,-7349.5 3370.33,-7356.5"/>
</g>
<!-- expert_8_2&#45;&gt;expert_agg_8 -->
<g id="edge227" class="edge">
<title>expert_8_2&#45;&gt;expert_agg_8</title>
<path fill="none" stroke="black" d="M2447,-7442.84C2447,-7411.32 2447,-7363 2447,-7363 2447,-7363 3370.03,-7363 3370.03,-7363"/>
<polygon fill="black" stroke="black" points="3370.03,-7366.5 3380.03,-7363 3370.03,-7359.5 3370.03,-7366.5"/>
</g>
<!-- expert_8_3&#45;&gt;expert_agg_8 -->
<g id="edge229" class="edge">
<title>expert_8_3&#45;&gt;expert_agg_8</title>
<path fill="none" stroke="black" d="M2899,-7442.84C2899,-7414.61 2899,-7374 2899,-7374 2899,-7374 3370.31,-7374 3370.31,-7374"/>
<polygon fill="black" stroke="black" points="3370.31,-7377.5 3380.31,-7374 3370.31,-7370.5 3370.31,-7377.5"/>
</g>
<!-- expert_8_4&#45;&gt;expert_agg_8 -->
<g id="edge231" class="edge">
<title>expert_8_4&#45;&gt;expert_agg_8</title>
<path fill="none" stroke="black" d="M3425.25,-7442.83C3425.25,-7442.83 3425.25,-7395.18 3425.25,-7395.18"/>
<polygon fill="black" stroke="black" points="3428.75,-7395.18 3425.25,-7385.18 3421.75,-7395.18 3428.75,-7395.18"/>
</g>
<!-- expert_8_5&#45;&gt;expert_agg_8 -->
<g id="edge233" class="edge">
<title>expert_8_5&#45;&gt;expert_agg_8</title>
<path fill="none" stroke="black" d="M3550.75,-7442.83C3550.75,-7442.83 3550.75,-7395.18 3550.75,-7395.18"/>
<polygon fill="black" stroke="black" points="3554.25,-7395.18 3550.75,-7385.18 3547.25,-7395.18 3554.25,-7395.18"/>
</g>
<!-- expert_8_6&#45;&gt;expert_agg_8 -->
<g id="edge235" class="edge">
<title>expert_8_6&#45;&gt;expert_agg_8</title>
<path fill="none" stroke="black" d="M4015,-7442.79C4015,-7413.64 4015,-7371 4015,-7371 4015,-7371 3605.6,-7371 3605.6,-7371"/>
<polygon fill="black" stroke="black" points="3605.6,-7367.5 3595.6,-7371 3605.6,-7374.5 3605.6,-7367.5"/>
</g>
<!-- expert_8_7&#45;&gt;expert_agg_8 -->
<g id="edge237" class="edge">
<title>expert_8_7&#45;&gt;expert_agg_8</title>
<path fill="none" stroke="black" d="M4481,-7442.73C4481,-7409.77 4481,-7358 4481,-7358 4481,-7358 3605.68,-7358 3605.68,-7358"/>
<polygon fill="black" stroke="black" points="3605.68,-7354.5 3595.68,-7358 3605.68,-7361.5 3605.68,-7354.5"/>
</g>
<!-- expert_agg_8&#45;&gt;residual2_8 -->
<g id="edge240" class="edge">
<title>expert_agg_8&#45;&gt;residual2_8</title>
<path fill="none" stroke="black" d="M3595.69,-7345C3911.09,-7345 4810.75,-7345 4810.75,-7345 4810.75,-7345 4810.75,-7284.08 4810.75,-7284.08"/>
<polygon fill="black" stroke="black" points="4814.25,-7284.08 4810.75,-7274.08 4807.25,-7284.08 4814.25,-7284.08"/>
</g>
<!-- transfer_8 -->
<g id="node169" class="node">
<title>transfer_8</title>
<ellipse fill="#fadbd8" stroke="black" cx="4903" cy="-7136.05" rx="152.06" ry="26.74"/>
<text text-anchor="middle" x="4903" y="-7139.85" font-family="Helvetica,sans-Serif" font-size="14.00">Transfer to GPU 8</text>
<text text-anchor="middle" x="4903" y="-7124.85" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual2_8&#45;&gt;transfer_8 -->
<g id="edge241" class="edge">
<title>residual2_8&#45;&gt;transfer_8</title>
<path fill="none" stroke="black" d="M4903,-7220.75C4903,-7220.75 4903,-7173.28 4903,-7173.28"/>
<polygon fill="black" stroke="black" points="4906.5,-7173.28 4903,-7163.28 4899.5,-7173.28 4906.5,-7173.28"/>
</g>
<!-- residual1_9 -->
<g id="node176" class="node">
<title>residual1_9</title>
<polygon fill="#fadbd8" stroke="black" points="5158.5,-7051.18 4943.5,-7051.18 4943.5,-6998.18 5158.5,-6998.18 5158.5,-7051.18"/>
<text text-anchor="middle" x="5051" y="-7035.98" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="5051" y="-7020.98" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 8</text>
<text text-anchor="middle" x="5051" y="-7005.98" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- transfer_8&#45;&gt;residual1_9 -->
<g id="edge247" class="edge">
<title>transfer_8&#45;&gt;residual1_9</title>
<path fill="none" stroke="black" d="M4999.26,-7115.1C4999.26,-7115.1 4999.26,-7061.45 4999.26,-7061.45"/>
<polygon fill="black" stroke="black" points="5002.76,-7061.45 4999.26,-7051.45 4995.76,-7061.45 5002.76,-7061.45"/>
</g>
<!-- ln1_9 -->
<g id="node170" class="node">
<title>ln1_9</title>
<polygon fill="#f8f9f9" stroke="black" points="5306.5,-7717.92 5091.5,-7717.92 5091.5,-7664.92 5306.5,-7664.92 5306.5,-7717.92"/>
<text text-anchor="middle" x="5199" y="-7702.72" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="5199" y="-7687.72" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 8</text>
<text text-anchor="middle" x="5199" y="-7672.72" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_qkv_9 -->
<g id="node171" class="node">
<title>attn_qkv_9</title>
<polygon fill="#ffe6cc" stroke="black" points="5314,-7606.92 5084,-7606.92 5084,-7553.92 5314,-7553.92 5314,-7606.92"/>
<text text-anchor="middle" x="5199" y="-7591.72" font-family="Helvetica,sans-Serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5199" y="-7576.72" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 8</text>
<text text-anchor="middle" x="5199" y="-7561.72" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 3*hidden_dim]</text>
</g>
<!-- ln1_9&#45;&gt;attn_qkv_9 -->
<g id="edge242" class="edge">
<title>ln1_9&#45;&gt;attn_qkv_9</title>
<path fill="none" stroke="black" d="M5199,-7664.83C5199,-7664.83 5199,-7617.18 5199,-7617.18"/>
<polygon fill="black" stroke="black" points="5202.5,-7617.18 5199,-7607.18 5195.5,-7617.18 5202.5,-7617.18"/>
</g>
<!-- attn_score_9 -->
<g id="node172" class="node">
<title>attn_score_9</title>
<polygon fill="#ffe6cc" stroke="black" points="5336.5,-7495.92 5061.5,-7495.92 5061.5,-7442.92 5336.5,-7442.92 5336.5,-7495.92"/>
<text text-anchor="middle" x="5199" y="-7480.72" font-family="Helvetica,sans-Serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="5199" y="-7465.72" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 8</text>
<text text-anchor="middle" x="5199" y="-7450.72" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_qkv_9&#45;&gt;attn_score_9 -->
<g id="edge243" class="edge">
<title>attn_qkv_9&#45;&gt;attn_score_9</title>
<path fill="none" stroke="black" d="M5199,-7553.83C5199,-7553.83 5199,-7506.18 5199,-7506.18"/>
<polygon fill="black" stroke="black" points="5202.5,-7506.18 5199,-7496.18 5195.5,-7506.18 5202.5,-7506.18"/>
</g>
<!-- attn_weight_9 -->
<g id="node173" class="node">
<title>attn_weight_9</title>
<polygon fill="#ffe6cc" stroke="black" points="5336.5,-7384.92 5061.5,-7384.92 5061.5,-7331.92 5336.5,-7331.92 5336.5,-7384.92"/>
<text text-anchor="middle" x="5199" y="-7369.72" font-family="Helvetica,sans-Serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="5199" y="-7354.72" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 8</text>
<text text-anchor="middle" x="5199" y="-7339.72" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_score_9&#45;&gt;attn_weight_9 -->
<g id="edge244" class="edge">
<title>attn_score_9&#45;&gt;attn_weight_9</title>
<path fill="none" stroke="black" d="M5199,-7442.83C5199,-7442.83 5199,-7395.18 5199,-7395.18"/>
<polygon fill="black" stroke="black" points="5202.5,-7395.18 5199,-7385.18 5195.5,-7395.18 5202.5,-7395.18"/>
</g>
<!-- attn_context_9 -->
<g id="node174" class="node">
<title>attn_context_9</title>
<polygon fill="#ffe6cc" stroke="black" points="5344,-7273.92 5054,-7273.92 5054,-7220.92 5344,-7220.92 5344,-7273.92"/>
<text text-anchor="middle" x="5199" y="-7258.72" font-family="Helvetica,sans-Serif" font-size="14.00">Context</text>
<text text-anchor="middle" x="5199" y="-7243.72" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 8</text>
<text text-anchor="middle" x="5199" y="-7228.72" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, head_dim]</text>
</g>
<!-- attn_weight_9&#45;&gt;attn_context_9 -->
<g id="edge245" class="edge">
<title>attn_weight_9&#45;&gt;attn_context_9</title>
<path fill="none" stroke="black" d="M5199,-7331.83C5199,-7331.83 5199,-7284.18 5199,-7284.18"/>
<polygon fill="black" stroke="black" points="5202.5,-7284.18 5199,-7274.18 5195.5,-7284.18 5202.5,-7284.18"/>
</g>
<!-- attn_out_9 -->
<g id="node175" class="node">
<title>attn_out_9</title>
<polygon fill="#ffe6cc" stroke="black" points="5306.5,-7162.55 5091.5,-7162.55 5091.5,-7109.55 5306.5,-7109.55 5306.5,-7162.55"/>
<text text-anchor="middle" x="5199" y="-7147.35" font-family="Helvetica,sans-Serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="5199" y="-7132.35" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 8</text>
<text text-anchor="middle" x="5199" y="-7117.35" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_context_9&#45;&gt;attn_out_9 -->
<g id="edge246" class="edge">
<title>attn_context_9&#45;&gt;attn_out_9</title>
<path fill="none" stroke="black" d="M5199,-7220.75C5199,-7220.75 5199,-7172.9 5199,-7172.9"/>
<polygon fill="black" stroke="black" points="5202.5,-7172.9 5199,-7162.9 5195.5,-7172.9 5202.5,-7172.9"/>
</g>
<!-- attn_out_9&#45;&gt;residual1_9 -->
<g id="edge248" class="edge">
<title>attn_out_9&#45;&gt;residual1_9</title>
<path fill="none" stroke="black" d="M5125,-7109.37C5125,-7109.37 5125,-7061.53 5125,-7061.53"/>
<polygon fill="black" stroke="black" points="5128.5,-7061.53 5125,-7051.53 5121.5,-7061.53 5128.5,-7061.53"/>
</g>
<!-- ln2_9 -->
<g id="node177" class="node">
<title>ln2_9</title>
<polygon fill="#f8f9f9" stroke="black" points="5077.5,-6940.18 4862.5,-6940.18 4862.5,-6887.18 5077.5,-6887.18 5077.5,-6940.18"/>
<text text-anchor="middle" x="4970" y="-6924.98" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;MoE)</text>
<text text-anchor="middle" x="4970" y="-6909.98" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 8</text>
<text text-anchor="middle" x="4970" y="-6894.98" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_9&#45;&gt;ln2_9 -->
<g id="edge249" class="edge">
<title>residual1_9&#45;&gt;ln2_9</title>
<path fill="none" stroke="black" d="M5010.5,-6998.09C5010.5,-6998.09 5010.5,-6950.44 5010.5,-6950.44"/>
<polygon fill="black" stroke="black" points="5014,-6950.44 5010.5,-6940.44 5007,-6950.44 5014,-6950.44"/>
</g>
<!-- residual2_9 -->
<g id="node189" class="node">
<title>residual2_9</title>
<polygon fill="#fadbd8" stroke="black" points="5188.5,-6385.18 4973.5,-6385.18 4973.5,-6332.18 5188.5,-6332.18 5188.5,-6385.18"/>
<text text-anchor="middle" x="5081" y="-6369.98" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="5081" y="-6354.98" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 8</text>
<text text-anchor="middle" x="5081" y="-6339.98" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_9&#45;&gt;residual2_9 -->
<g id="edge269" class="edge">
<title>residual1_9&#45;&gt;residual2_9</title>
<path fill="none" stroke="black" d="M5118,-6998.16C5118,-6998.16 5118,-6395.28 5118,-6395.28"/>
<polygon fill="black" stroke="black" points="5121.5,-6395.28 5118,-6385.28 5114.5,-6395.28 5121.5,-6395.28"/>
</g>
<!-- router_9 -->
<g id="node178" class="node">
<title>router_9</title>
<polygon fill="#f5b7b1" stroke="black" points="4272,-6829.18 4072,-6829.18 4072,-6776.18 4272,-6776.18 4272,-6829.18"/>
<text text-anchor="middle" x="4172" y="-6813.98" font-family="Helvetica,sans-Serif" font-size="14.00">Router Network</text>
<text text-anchor="middle" x="4172" y="-6798.98" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 8</text>
<text text-anchor="middle" x="4172" y="-6783.98" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 8 experts]</text>
</g>
<!-- ln2_9&#45;&gt;router_9 -->
<g id="edge250" class="edge">
<title>ln2_9&#45;&gt;router_9</title>
<path fill="none" stroke="black" d="M4933.25,-6886.93C4933.25,-6853.89 4933.25,-6802 4933.25,-6802 4933.25,-6802 4282.3,-6802 4282.3,-6802"/>
<polygon fill="black" stroke="black" points="4282.3,-6798.5 4272.3,-6802 4282.3,-6805.5 4282.3,-6798.5"/>
</g>
<!-- expert_agg_9 -->
<g id="node188" class="node">
<title>expert_agg_9</title>
<polygon fill="#d4e6f1" stroke="black" points="3773.5,-6496.18 3558.5,-6496.18 3558.5,-6443.18 3773.5,-6443.18 3773.5,-6496.18"/>
<text text-anchor="middle" x="3666" y="-6480.98" font-family="Helvetica,sans-Serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="3666" y="-6465.98" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 8</text>
<text text-anchor="middle" x="3666" y="-6450.98" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- ln2_9&#45;&gt;expert_agg_9 -->
<g id="edge268" class="edge">
<title>ln2_9&#45;&gt;expert_agg_9</title>
<path fill="none" stroke="black" d="M4862.46,-6913C4550.28,-6913 3666,-6913 3666,-6913 3666,-6913 3666,-6506.41 3666,-6506.41"/>
<polygon fill="black" stroke="black" points="3669.5,-6506.41 3666,-6496.41 3662.5,-6506.41 3669.5,-6506.41"/>
</g>
<!-- gate_9 -->
<g id="node179" class="node">
<title>gate_9</title>
<polygon fill="#f5b7b1" stroke="black" points="3511.5,-6718.18 3368.5,-6718.18 3368.5,-6665.18 3511.5,-6665.18 3511.5,-6718.18"/>
<text text-anchor="middle" x="3440" y="-6702.98" font-family="Helvetica,sans-Serif" font-size="14.00">Top&#45;2 Gating</text>
<text text-anchor="middle" x="3440" y="-6687.98" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 8</text>
<text text-anchor="middle" x="3440" y="-6672.98" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 2]</text>
</g>
<!-- router_9&#45;&gt;gate_9 -->
<g id="edge251" class="edge">
<title>router_9&#45;&gt;gate_9</title>
<path fill="none" stroke="black" d="M4086,-6776.03C4086,-6747.72 4086,-6707 4086,-6707 4086,-6707 3521.6,-6707 3521.6,-6707"/>
<polygon fill="black" stroke="black" points="3521.6,-6703.5 3511.6,-6707 3521.6,-6710.5 3521.6,-6703.5"/>
</g>
<!-- expert_9_0 -->
<g id="node180" class="node">
<title>expert_9_0</title>
<polygon fill="#e8daef" stroke="black" points="1840,-6607.18 1424,-6607.18 1424,-6554.18 1840,-6554.18 1840,-6607.18"/>
<text text-anchor="middle" x="1632" y="-6591.98" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="1632" y="-6576.98" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 8</text>
<text text-anchor="middle" x="1632" y="-6561.98" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_9&#45;&gt;expert_9_0 -->
<g id="edge252" class="edge">
<title>gate_9&#45;&gt;expert_9_0</title>
<path fill="none" stroke="black" d="M3368.47,-6707C3049.07,-6707 1769,-6707 1769,-6707 1769,-6707 1769,-6617.47 1769,-6617.47"/>
<polygon fill="black" stroke="black" points="1772.5,-6617.47 1769,-6607.47 1765.5,-6617.47 1772.5,-6617.47"/>
</g>
<!-- expert_9_1 -->
<g id="node181" class="node">
<title>expert_9_1</title>
<polygon fill="#e8daef" stroke="black" points="2292,-6607.18 1876,-6607.18 1876,-6554.18 2292,-6554.18 2292,-6607.18"/>
<text text-anchor="middle" x="2084" y="-6591.98" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="2084" y="-6576.98" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 8</text>
<text text-anchor="middle" x="2084" y="-6561.98" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_9&#45;&gt;expert_9_1 -->
<g id="edge254" class="edge">
<title>gate_9&#45;&gt;expert_9_1</title>
<path fill="none" stroke="black" d="M3368.3,-6696C3107,-6696 2221,-6696 2221,-6696 2221,-6696 2221,-6617.43 2221,-6617.43"/>
<polygon fill="black" stroke="black" points="2224.5,-6617.43 2221,-6607.43 2217.5,-6617.43 2224.5,-6617.43"/>
</g>
<!-- expert_9_2 -->
<g id="node182" class="node">
<title>expert_9_2</title>
<polygon fill="#e8daef" stroke="black" points="2744,-6607.18 2328,-6607.18 2328,-6554.18 2744,-6554.18 2744,-6607.18"/>
<text text-anchor="middle" x="2536" y="-6591.98" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2536" y="-6576.98" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 8</text>
<text text-anchor="middle" x="2536" y="-6561.98" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_9&#45;&gt;expert_9_2 -->
<g id="edge256" class="edge">
<title>gate_9&#45;&gt;expert_9_2</title>
<path fill="none" stroke="black" d="M3368.19,-6686C3177.52,-6686 2673,-6686 2673,-6686 2673,-6686 2673,-6617.26 2673,-6617.26"/>
<polygon fill="black" stroke="black" points="2676.5,-6617.26 2673,-6607.26 2669.5,-6617.26 2676.5,-6617.26"/>
</g>
<!-- expert_9_3 -->
<g id="node183" class="node">
<title>expert_9_3</title>
<polygon fill="#e8daef" stroke="black" points="3196,-6607.18 2780,-6607.18 2780,-6554.18 3196,-6554.18 3196,-6607.18"/>
<text text-anchor="middle" x="2988" y="-6591.98" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2988" y="-6576.98" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 8</text>
<text text-anchor="middle" x="2988" y="-6561.98" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_9&#45;&gt;expert_9_3 -->
<g id="edge258" class="edge">
<title>gate_9&#45;&gt;expert_9_3</title>
<path fill="none" stroke="black" d="M3368.13,-6675C3275.16,-6675 3125,-6675 3125,-6675 3125,-6675 3125,-6617.2 3125,-6617.2"/>
<polygon fill="black" stroke="black" points="3128.5,-6617.2 3125,-6607.2 3121.5,-6617.2 3128.5,-6617.2"/>
</g>
<!-- expert_9_4 -->
<g id="node184" class="node">
<title>expert_9_4</title>
<polygon fill="#e8daef" stroke="black" points="3648,-6607.18 3232,-6607.18 3232,-6554.18 3648,-6554.18 3648,-6607.18"/>
<text text-anchor="middle" x="3440" y="-6591.98" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="3440" y="-6576.98" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 8</text>
<text text-anchor="middle" x="3440" y="-6561.98" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_9&#45;&gt;expert_9_4 -->
<g id="edge260" class="edge">
<title>gate_9&#45;&gt;expert_9_4</title>
<path fill="none" stroke="black" d="M3440,-6665.09C3440,-6665.09 3440,-6617.44 3440,-6617.44"/>
<polygon fill="black" stroke="black" points="3443.5,-6617.44 3440,-6607.44 3436.5,-6617.44 3443.5,-6617.44"/>
</g>
<!-- expert_9_5 -->
<g id="node185" class="node">
<title>expert_9_5</title>
<polygon fill="#e8daef" stroke="black" points="4100,-6607.18 3684,-6607.18 3684,-6554.18 4100,-6554.18 4100,-6607.18"/>
<text text-anchor="middle" x="3892" y="-6591.98" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="3892" y="-6576.98" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 8</text>
<text text-anchor="middle" x="3892" y="-6561.98" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_9&#45;&gt;expert_9_5 -->
<g id="edge262" class="edge">
<title>gate_9&#45;&gt;expert_9_5</title>
<path fill="none" stroke="black" d="M3511.72,-6675C3617.51,-6675 3803,-6675 3803,-6675 3803,-6675 3803,-6617.2 3803,-6617.2"/>
<polygon fill="black" stroke="black" points="3806.5,-6617.2 3803,-6607.2 3799.5,-6617.2 3806.5,-6617.2"/>
</g>
<!-- expert_9_6 -->
<g id="node186" class="node">
<title>expert_9_6</title>
<polygon fill="#e8daef" stroke="black" points="4552,-6607.18 4136,-6607.18 4136,-6554.18 4552,-6554.18 4552,-6607.18"/>
<text text-anchor="middle" x="4344" y="-6591.98" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="4344" y="-6576.98" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 8</text>
<text text-anchor="middle" x="4344" y="-6561.98" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_9&#45;&gt;expert_9_6 -->
<g id="edge264" class="edge">
<title>gate_9&#45;&gt;expert_9_6</title>
<path fill="none" stroke="black" d="M3511.53,-6686C3701.46,-6686 4204,-6686 4204,-6686 4204,-6686 4204,-6617.26 4204,-6617.26"/>
<polygon fill="black" stroke="black" points="4207.5,-6617.26 4204,-6607.26 4200.5,-6617.26 4207.5,-6617.26"/>
</g>
<!-- expert_9_7 -->
<g id="node187" class="node">
<title>expert_9_7</title>
<polygon fill="#e8daef" stroke="black" points="5004,-6607.18 4588,-6607.18 4588,-6554.18 5004,-6554.18 5004,-6607.18"/>
<text text-anchor="middle" x="4796" y="-6591.98" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="4796" y="-6576.98" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 8</text>
<text text-anchor="middle" x="4796" y="-6561.98" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_9&#45;&gt;expert_9_7 -->
<g id="edge266" class="edge">
<title>gate_9&#45;&gt;expert_9_7</title>
<path fill="none" stroke="black" d="M3511.87,-6696C3774.84,-6696 4669.49,-6696 4669.49,-6696 4669.49,-6696 4669.49,-6617.43 4669.49,-6617.43"/>
<polygon fill="black" stroke="black" points="4672.99,-6617.43 4669.49,-6607.43 4665.99,-6617.43 4672.99,-6617.43"/>
</g>
<!-- expert_9_0&#45;&gt;expert_agg_9 -->
<g id="edge253" class="edge">
<title>expert_9_0&#45;&gt;expert_agg_9</title>
<path fill="none" stroke="black" d="M1721,-6553.91C1721,-6516.47 1721,-6453 1721,-6453 1721,-6453 3548.31,-6453 3548.31,-6453"/>
<polygon fill="black" stroke="black" points="3548.31,-6456.5 3558.31,-6453 3548.31,-6449.5 3548.31,-6456.5"/>
</g>
<!-- expert_9_1&#45;&gt;expert_agg_9 -->
<g id="edge255" class="edge">
<title>expert_9_1&#45;&gt;expert_agg_9</title>
<path fill="none" stroke="black" d="M2173,-6553.91C2173,-6519.46 2173,-6464 2173,-6464 2173,-6464 3548.33,-6464 3548.33,-6464"/>
<polygon fill="black" stroke="black" points="3548.33,-6467.5 3558.33,-6464 3548.33,-6460.5 3548.33,-6467.5"/>
</g>
<!-- expert_9_2&#45;&gt;expert_agg_9 -->
<g id="edge257" class="edge">
<title>expert_9_2&#45;&gt;expert_agg_9</title>
<path fill="none" stroke="black" d="M2625,-6554.04C2625,-6522.44 2625,-6474 2625,-6474 2625,-6474 3548.03,-6474 3548.03,-6474"/>
<polygon fill="black" stroke="black" points="3548.03,-6477.5 3558.03,-6474 3548.03,-6470.5 3548.03,-6477.5"/>
</g>
<!-- expert_9_3&#45;&gt;expert_agg_9 -->
<g id="edge259" class="edge">
<title>expert_9_3&#45;&gt;expert_agg_9</title>
<path fill="none" stroke="black" d="M3077,-6554.03C3077,-6525.72 3077,-6485 3077,-6485 3077,-6485 3548.31,-6485 3548.31,-6485"/>
<polygon fill="black" stroke="black" points="3548.31,-6488.5 3558.31,-6485 3548.31,-6481.5 3548.31,-6488.5"/>
</g>
<!-- expert_9_4&#45;&gt;expert_agg_9 -->
<g id="edge261" class="edge">
<title>expert_9_4&#45;&gt;expert_agg_9</title>
<path fill="none" stroke="black" d="M3603.25,-6554.09C3603.25,-6554.09 3603.25,-6506.44 3603.25,-6506.44"/>
<polygon fill="black" stroke="black" points="3606.75,-6506.44 3603.25,-6496.44 3599.75,-6506.44 3606.75,-6506.44"/>
</g>
<!-- expert_9_5&#45;&gt;expert_agg_9 -->
<g id="edge263" class="edge">
<title>expert_9_5&#45;&gt;expert_agg_9</title>
<path fill="none" stroke="black" d="M3728.75,-6554.09C3728.75,-6554.09 3728.75,-6506.44 3728.75,-6506.44"/>
<polygon fill="black" stroke="black" points="3732.25,-6506.44 3728.75,-6496.44 3725.25,-6506.44 3732.25,-6506.44"/>
</g>
<!-- expert_9_6&#45;&gt;expert_agg_9 -->
<g id="edge265" class="edge">
<title>expert_9_6&#45;&gt;expert_agg_9</title>
<path fill="none" stroke="black" d="M4193,-6553.98C4193,-6524.75 4193,-6482 4193,-6482 4193,-6482 3783.6,-6482 3783.6,-6482"/>
<polygon fill="black" stroke="black" points="3783.6,-6478.5 3773.6,-6482 3783.6,-6485.5 3783.6,-6478.5"/>
</g>
<!-- expert_9_7&#45;&gt;expert_agg_9 -->
<g id="edge267" class="edge">
<title>expert_9_7&#45;&gt;expert_agg_9</title>
<path fill="none" stroke="black" d="M4659,-6553.93C4659,-6520.89 4659,-6469 4659,-6469 4659,-6469 3783.68,-6469 3783.68,-6469"/>
<polygon fill="black" stroke="black" points="3783.68,-6465.5 3773.68,-6469 3783.68,-6472.5 3783.68,-6465.5"/>
</g>
<!-- expert_agg_9&#45;&gt;residual2_9 -->
<g id="edge270" class="edge">
<title>expert_agg_9&#45;&gt;residual2_9</title>
<path fill="none" stroke="black" d="M3773.69,-6456C4089.09,-6456 4988.75,-6456 4988.75,-6456 4988.75,-6456 4988.75,-6395.27 4988.75,-6395.27"/>
<polygon fill="black" stroke="black" points="4992.25,-6395.27 4988.75,-6385.27 4985.25,-6395.27 4992.25,-6395.27"/>
</g>
<!-- transfer_9 -->
<g id="node190" class="node">
<title>transfer_9</title>
<ellipse fill="#fadbd8" stroke="black" cx="5081" cy="-6247.31" rx="152.06" ry="26.74"/>
<text text-anchor="middle" x="5081" y="-6251.11" font-family="Helvetica,sans-Serif" font-size="14.00">Transfer to GPU 9</text>
<text text-anchor="middle" x="5081" y="-6236.11" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual2_9&#45;&gt;transfer_9 -->
<g id="edge271" class="edge">
<title>residual2_9&#45;&gt;transfer_9</title>
<path fill="none" stroke="black" d="M5081,-6332C5081,-6332 5081,-6284.54 5081,-6284.54"/>
<polygon fill="black" stroke="black" points="5084.5,-6284.54 5081,-6274.54 5077.5,-6284.54 5084.5,-6284.54"/>
</g>
<!-- residual1_10 -->
<g id="node197" class="node">
<title>residual1_10</title>
<polygon fill="#fadbd8" stroke="black" points="5336.5,-6162.44 5121.5,-6162.44 5121.5,-6109.44 5336.5,-6109.44 5336.5,-6162.44"/>
<text text-anchor="middle" x="5229" y="-6147.24" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="5229" y="-6132.24" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 9</text>
<text text-anchor="middle" x="5229" y="-6117.24" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- transfer_9&#45;&gt;residual1_10 -->
<g id="edge277" class="edge">
<title>transfer_9&#45;&gt;residual1_10</title>
<path fill="none" stroke="black" d="M5177.26,-6226.36C5177.26,-6226.36 5177.26,-6172.71 5177.26,-6172.71"/>
<polygon fill="black" stroke="black" points="5180.76,-6172.71 5177.26,-6162.71 5173.76,-6172.71 5180.76,-6172.71"/>
</g>
<!-- ln1_10 -->
<g id="node191" class="node">
<title>ln1_10</title>
<polygon fill="#f8f9f9" stroke="black" points="5484.5,-6829.18 5269.5,-6829.18 5269.5,-6776.18 5484.5,-6776.18 5484.5,-6829.18"/>
<text text-anchor="middle" x="5377" y="-6813.98" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="5377" y="-6798.98" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 9</text>
<text text-anchor="middle" x="5377" y="-6783.98" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_qkv_10 -->
<g id="node192" class="node">
<title>attn_qkv_10</title>
<polygon fill="#ffe6cc" stroke="black" points="5492,-6718.18 5262,-6718.18 5262,-6665.18 5492,-6665.18 5492,-6718.18"/>
<text text-anchor="middle" x="5377" y="-6702.98" font-family="Helvetica,sans-Serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5377" y="-6687.98" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 9</text>
<text text-anchor="middle" x="5377" y="-6672.98" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 3*hidden_dim]</text>
</g>
<!-- ln1_10&#45;&gt;attn_qkv_10 -->
<g id="edge272" class="edge">
<title>ln1_10&#45;&gt;attn_qkv_10</title>
<path fill="none" stroke="black" d="M5377,-6776.09C5377,-6776.09 5377,-6728.44 5377,-6728.44"/>
<polygon fill="black" stroke="black" points="5380.5,-6728.44 5377,-6718.44 5373.5,-6728.44 5380.5,-6728.44"/>
</g>
<!-- attn_score_10 -->
<g id="node193" class="node">
<title>attn_score_10</title>
<polygon fill="#ffe6cc" stroke="black" points="5514.5,-6607.18 5239.5,-6607.18 5239.5,-6554.18 5514.5,-6554.18 5514.5,-6607.18"/>
<text text-anchor="middle" x="5377" y="-6591.98" font-family="Helvetica,sans-Serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="5377" y="-6576.98" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 9</text>
<text text-anchor="middle" x="5377" y="-6561.98" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_qkv_10&#45;&gt;attn_score_10 -->
<g id="edge273" class="edge">
<title>attn_qkv_10&#45;&gt;attn_score_10</title>
<path fill="none" stroke="black" d="M5377,-6665.09C5377,-6665.09 5377,-6617.44 5377,-6617.44"/>
<polygon fill="black" stroke="black" points="5380.5,-6617.44 5377,-6607.44 5373.5,-6617.44 5380.5,-6617.44"/>
</g>
<!-- attn_weight_10 -->
<g id="node194" class="node">
<title>attn_weight_10</title>
<polygon fill="#ffe6cc" stroke="black" points="5514.5,-6496.18 5239.5,-6496.18 5239.5,-6443.18 5514.5,-6443.18 5514.5,-6496.18"/>
<text text-anchor="middle" x="5377" y="-6480.98" font-family="Helvetica,sans-Serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="5377" y="-6465.98" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 9</text>
<text text-anchor="middle" x="5377" y="-6450.98" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_score_10&#45;&gt;attn_weight_10 -->
<g id="edge274" class="edge">
<title>attn_score_10&#45;&gt;attn_weight_10</title>
<path fill="none" stroke="black" d="M5377,-6554.09C5377,-6554.09 5377,-6506.44 5377,-6506.44"/>
<polygon fill="black" stroke="black" points="5380.5,-6506.44 5377,-6496.44 5373.5,-6506.44 5380.5,-6506.44"/>
</g>
<!-- attn_context_10 -->
<g id="node195" class="node">
<title>attn_context_10</title>
<polygon fill="#ffe6cc" stroke="black" points="5522,-6385.18 5232,-6385.18 5232,-6332.18 5522,-6332.18 5522,-6385.18"/>
<text text-anchor="middle" x="5377" y="-6369.98" font-family="Helvetica,sans-Serif" font-size="14.00">Context</text>
<text text-anchor="middle" x="5377" y="-6354.98" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 9</text>
<text text-anchor="middle" x="5377" y="-6339.98" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, head_dim]</text>
</g>
<!-- attn_weight_10&#45;&gt;attn_context_10 -->
<g id="edge275" class="edge">
<title>attn_weight_10&#45;&gt;attn_context_10</title>
<path fill="none" stroke="black" d="M5377,-6443.09C5377,-6443.09 5377,-6395.44 5377,-6395.44"/>
<polygon fill="black" stroke="black" points="5380.5,-6395.44 5377,-6385.44 5373.5,-6395.44 5380.5,-6395.44"/>
</g>
<!-- attn_out_10 -->
<g id="node196" class="node">
<title>attn_out_10</title>
<polygon fill="#ffe6cc" stroke="black" points="5484.5,-6273.81 5269.5,-6273.81 5269.5,-6220.81 5484.5,-6220.81 5484.5,-6273.81"/>
<text text-anchor="middle" x="5377" y="-6258.61" font-family="Helvetica,sans-Serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="5377" y="-6243.61" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 9</text>
<text text-anchor="middle" x="5377" y="-6228.61" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_context_10&#45;&gt;attn_out_10 -->
<g id="edge276" class="edge">
<title>attn_context_10&#45;&gt;attn_out_10</title>
<path fill="none" stroke="black" d="M5377,-6332C5377,-6332 5377,-6284.15 5377,-6284.15"/>
<polygon fill="black" stroke="black" points="5380.5,-6284.15 5377,-6274.15 5373.5,-6284.16 5380.5,-6284.15"/>
</g>
<!-- attn_out_10&#45;&gt;residual1_10 -->
<g id="edge278" class="edge">
<title>attn_out_10&#45;&gt;residual1_10</title>
<path fill="none" stroke="black" d="M5303,-6220.63C5303,-6220.63 5303,-6172.78 5303,-6172.78"/>
<polygon fill="black" stroke="black" points="5306.5,-6172.78 5303,-6162.78 5299.5,-6172.78 5306.5,-6172.78"/>
</g>
<!-- ln2_10 -->
<g id="node198" class="node">
<title>ln2_10</title>
<polygon fill="#f8f9f9" stroke="black" points="5255.5,-6051.44 5040.5,-6051.44 5040.5,-5998.44 5255.5,-5998.44 5255.5,-6051.44"/>
<text text-anchor="middle" x="5148" y="-6036.24" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;MoE)</text>
<text text-anchor="middle" x="5148" y="-6021.24" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 9</text>
<text text-anchor="middle" x="5148" y="-6006.24" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_10&#45;&gt;ln2_10 -->
<g id="edge279" class="edge">
<title>residual1_10&#45;&gt;ln2_10</title>
<path fill="none" stroke="black" d="M5188.5,-6109.35C5188.5,-6109.35 5188.5,-6061.7 5188.5,-6061.7"/>
<polygon fill="black" stroke="black" points="5192,-6061.7 5188.5,-6051.7 5185,-6061.7 5192,-6061.7"/>
</g>
<!-- residual2_10 -->
<g id="node210" class="node">
<title>residual2_10</title>
<polygon fill="#fadbd8" stroke="black" points="5366.5,-5496.44 5151.5,-5496.44 5151.5,-5443.44 5366.5,-5443.44 5366.5,-5496.44"/>
<text text-anchor="middle" x="5259" y="-5481.24" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="5259" y="-5466.24" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 9</text>
<text text-anchor="middle" x="5259" y="-5451.24" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_10&#45;&gt;residual2_10 -->
<g id="edge299" class="edge">
<title>residual1_10&#45;&gt;residual2_10</title>
<path fill="none" stroke="black" d="M5296,-6109.42C5296,-6109.42 5296,-5506.54 5296,-5506.54"/>
<polygon fill="black" stroke="black" points="5299.5,-5506.54 5296,-5496.54 5292.5,-5506.54 5299.5,-5506.54"/>
</g>
<!-- router_10 -->
<g id="node199" class="node">
<title>router_10</title>
<polygon fill="#f5b7b1" stroke="black" points="4450,-5940.44 4250,-5940.44 4250,-5887.44 4450,-5887.44 4450,-5940.44"/>
<text text-anchor="middle" x="4350" y="-5925.24" font-family="Helvetica,sans-Serif" font-size="14.00">Router Network</text>
<text text-anchor="middle" x="4350" y="-5910.24" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 9</text>
<text text-anchor="middle" x="4350" y="-5895.24" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 8 experts]</text>
</g>
<!-- ln2_10&#45;&gt;router_10 -->
<g id="edge280" class="edge">
<title>ln2_10&#45;&gt;router_10</title>
<path fill="none" stroke="black" d="M5111.25,-5998.41C5111.25,-5965.31 5111.25,-5913 5111.25,-5913 5111.25,-5913 4460.3,-5913 4460.3,-5913"/>
<polygon fill="black" stroke="black" points="4460.3,-5909.5 4450.3,-5913 4460.3,-5916.5 4460.3,-5909.5"/>
</g>
<!-- expert_agg_10 -->
<g id="node209" class="node">
<title>expert_agg_10</title>
<polygon fill="#d4e6f1" stroke="black" points="3951.5,-5607.44 3736.5,-5607.44 3736.5,-5554.44 3951.5,-5554.44 3951.5,-5607.44"/>
<text text-anchor="middle" x="3844" y="-5592.24" font-family="Helvetica,sans-Serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="3844" y="-5577.24" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 9</text>
<text text-anchor="middle" x="3844" y="-5562.24" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- ln2_10&#45;&gt;expert_agg_10 -->
<g id="edge298" class="edge">
<title>ln2_10&#45;&gt;expert_agg_10</title>
<path fill="none" stroke="black" d="M5040.46,-6024C4728.28,-6024 3844,-6024 3844,-6024 3844,-6024 3844,-5617.66 3844,-5617.66"/>
<polygon fill="black" stroke="black" points="3847.5,-5617.66 3844,-5607.66 3840.5,-5617.66 3847.5,-5617.66"/>
</g>
<!-- gate_10 -->
<g id="node200" class="node">
<title>gate_10</title>
<polygon fill="#f5b7b1" stroke="black" points="3689.5,-5829.44 3546.5,-5829.44 3546.5,-5776.44 3689.5,-5776.44 3689.5,-5829.44"/>
<text text-anchor="middle" x="3618" y="-5814.24" font-family="Helvetica,sans-Serif" font-size="14.00">Top&#45;2 Gating</text>
<text text-anchor="middle" x="3618" y="-5799.24" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 9</text>
<text text-anchor="middle" x="3618" y="-5784.24" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 2]</text>
</g>
<!-- router_10&#45;&gt;gate_10 -->
<g id="edge281" class="edge">
<title>router_10&#45;&gt;gate_10</title>
<path fill="none" stroke="black" d="M4264,-5887.22C4264,-5858.83 4264,-5818 4264,-5818 4264,-5818 3699.6,-5818 3699.6,-5818"/>
<polygon fill="black" stroke="black" points="3699.6,-5814.5 3689.6,-5818 3699.6,-5821.5 3699.6,-5814.5"/>
</g>
<!-- expert_10_0 -->
<g id="node201" class="node">
<title>expert_10_0</title>
<polygon fill="#e8daef" stroke="black" points="2018,-5718.44 1602,-5718.44 1602,-5665.44 2018,-5665.44 2018,-5718.44"/>
<text text-anchor="middle" x="1810" y="-5703.24" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="1810" y="-5688.24" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 9</text>
<text text-anchor="middle" x="1810" y="-5673.24" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_10&#45;&gt;expert_10_0 -->
<g id="edge282" class="edge">
<title>gate_10&#45;&gt;expert_10_0</title>
<path fill="none" stroke="black" d="M3546.47,-5818C3227.07,-5818 1947,-5818 1947,-5818 1947,-5818 1947,-5728.67 1947,-5728.67"/>
<polygon fill="black" stroke="black" points="1950.5,-5728.67 1947,-5718.67 1943.5,-5728.67 1950.5,-5728.67"/>
</g>
<!-- expert_10_1 -->
<g id="node202" class="node">
<title>expert_10_1</title>
<polygon fill="#e8daef" stroke="black" points="2470,-5718.44 2054,-5718.44 2054,-5665.44 2470,-5665.44 2470,-5718.44"/>
<text text-anchor="middle" x="2262" y="-5703.24" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="2262" y="-5688.24" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 9</text>
<text text-anchor="middle" x="2262" y="-5673.24" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_10&#45;&gt;expert_10_1 -->
<g id="edge284" class="edge">
<title>gate_10&#45;&gt;expert_10_1</title>
<path fill="none" stroke="black" d="M3546.3,-5808C3285,-5808 2399,-5808 2399,-5808 2399,-5808 2399,-5728.57 2399,-5728.57"/>
<polygon fill="black" stroke="black" points="2402.5,-5728.57 2399,-5718.57 2395.5,-5728.57 2402.5,-5728.57"/>
</g>
<!-- expert_10_2 -->
<g id="node203" class="node">
<title>expert_10_2</title>
<polygon fill="#e8daef" stroke="black" points="2922,-5718.44 2506,-5718.44 2506,-5665.44 2922,-5665.44 2922,-5718.44"/>
<text text-anchor="middle" x="2714" y="-5703.24" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2714" y="-5688.24" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 9</text>
<text text-anchor="middle" x="2714" y="-5673.24" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_10&#45;&gt;expert_10_2 -->
<g id="edge286" class="edge">
<title>gate_10&#45;&gt;expert_10_2</title>
<path fill="none" stroke="black" d="M3546.19,-5797C3355.52,-5797 2851,-5797 2851,-5797 2851,-5797 2851,-5728.45 2851,-5728.45"/>
<polygon fill="black" stroke="black" points="2854.5,-5728.45 2851,-5718.45 2847.5,-5728.45 2854.5,-5728.45"/>
</g>
<!-- expert_10_3 -->
<g id="node204" class="node">
<title>expert_10_3</title>
<polygon fill="#e8daef" stroke="black" points="3374,-5718.44 2958,-5718.44 2958,-5665.44 3374,-5665.44 3374,-5718.44"/>
<text text-anchor="middle" x="3166" y="-5703.24" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="3166" y="-5688.24" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 9</text>
<text text-anchor="middle" x="3166" y="-5673.24" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_10&#45;&gt;expert_10_3 -->
<g id="edge288" class="edge">
<title>gate_10&#45;&gt;expert_10_3</title>
<path fill="none" stroke="black" d="M3546.13,-5787C3453.16,-5787 3303,-5787 3303,-5787 3303,-5787 3303,-5728.67 3303,-5728.67"/>
<polygon fill="black" stroke="black" points="3306.5,-5728.67 3303,-5718.67 3299.5,-5728.67 3306.5,-5728.67"/>
</g>
<!-- expert_10_4 -->
<g id="node205" class="node">
<title>expert_10_4</title>
<polygon fill="#e8daef" stroke="black" points="3826,-5718.44 3410,-5718.44 3410,-5665.44 3826,-5665.44 3826,-5718.44"/>
<text text-anchor="middle" x="3618" y="-5703.24" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="3618" y="-5688.24" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 9</text>
<text text-anchor="middle" x="3618" y="-5673.24" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_10&#45;&gt;expert_10_4 -->
<g id="edge290" class="edge">
<title>gate_10&#45;&gt;expert_10_4</title>
<path fill="none" stroke="black" d="M3618,-5776.35C3618,-5776.35 3618,-5728.7 3618,-5728.7"/>
<polygon fill="black" stroke="black" points="3621.5,-5728.7 3618,-5718.7 3614.5,-5728.7 3621.5,-5728.7"/>
</g>
<!-- expert_10_5 -->
<g id="node206" class="node">
<title>expert_10_5</title>
<polygon fill="#e8daef" stroke="black" points="4278,-5718.44 3862,-5718.44 3862,-5665.44 4278,-5665.44 4278,-5718.44"/>
<text text-anchor="middle" x="4070" y="-5703.24" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="4070" y="-5688.24" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 9</text>
<text text-anchor="middle" x="4070" y="-5673.24" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_10&#45;&gt;expert_10_5 -->
<g id="edge292" class="edge">
<title>gate_10&#45;&gt;expert_10_5</title>
<path fill="none" stroke="black" d="M3689.72,-5787C3795.51,-5787 3981,-5787 3981,-5787 3981,-5787 3981,-5728.67 3981,-5728.67"/>
<polygon fill="black" stroke="black" points="3984.5,-5728.67 3981,-5718.67 3977.5,-5728.67 3984.5,-5728.67"/>
</g>
<!-- expert_10_6 -->
<g id="node207" class="node">
<title>expert_10_6</title>
<polygon fill="#e8daef" stroke="black" points="4730,-5718.44 4314,-5718.44 4314,-5665.44 4730,-5665.44 4730,-5718.44"/>
<text text-anchor="middle" x="4522" y="-5703.24" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="4522" y="-5688.24" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 9</text>
<text text-anchor="middle" x="4522" y="-5673.24" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_10&#45;&gt;expert_10_6 -->
<g id="edge294" class="edge">
<title>gate_10&#45;&gt;expert_10_6</title>
<path fill="none" stroke="black" d="M3689.53,-5797C3879.46,-5797 4382,-5797 4382,-5797 4382,-5797 4382,-5728.45 4382,-5728.45"/>
<polygon fill="black" stroke="black" points="4385.5,-5728.45 4382,-5718.45 4378.5,-5728.45 4385.5,-5728.45"/>
</g>
<!-- expert_10_7 -->
<g id="node208" class="node">
<title>expert_10_7</title>
<polygon fill="#e8daef" stroke="black" points="5182,-5718.44 4766,-5718.44 4766,-5665.44 5182,-5665.44 5182,-5718.44"/>
<text text-anchor="middle" x="4974" y="-5703.24" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="4974" y="-5688.24" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 9</text>
<text text-anchor="middle" x="4974" y="-5673.24" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_10&#45;&gt;expert_10_7 -->
<g id="edge296" class="edge">
<title>gate_10&#45;&gt;expert_10_7</title>
<path fill="none" stroke="black" d="M3689.87,-5808C3952.84,-5808 4847.49,-5808 4847.49,-5808 4847.49,-5808 4847.49,-5728.57 4847.49,-5728.57"/>
<polygon fill="black" stroke="black" points="4850.99,-5728.57 4847.49,-5718.57 4843.99,-5728.57 4850.99,-5728.57"/>
</g>
<!-- expert_10_0&#45;&gt;expert_agg_10 -->
<g id="edge283" class="edge">
<title>expert_10_0&#45;&gt;expert_agg_10</title>
<path fill="none" stroke="black" d="M1899,-5665.33C1899,-5628.11 1899,-5565 1899,-5565 1899,-5565 3726.31,-5565 3726.31,-5565"/>
<polygon fill="black" stroke="black" points="3726.31,-5568.5 3736.31,-5565 3726.31,-5561.5 3726.31,-5568.5"/>
</g>
<!-- expert_10_1&#45;&gt;expert_agg_10 -->
<g id="edge285" class="edge">
<title>expert_10_1&#45;&gt;expert_agg_10</title>
<path fill="none" stroke="black" d="M2351,-5665.41C2351,-5630.9 2351,-5575 2351,-5575 2351,-5575 3726.33,-5575 3726.33,-5575"/>
<polygon fill="black" stroke="black" points="3726.33,-5578.5 3736.33,-5575 3726.33,-5571.5 3726.33,-5578.5"/>
</g>
<!-- expert_10_2&#45;&gt;expert_agg_10 -->
<g id="edge287" class="edge">
<title>expert_10_2&#45;&gt;expert_agg_10</title>
<path fill="none" stroke="black" d="M2803,-5665.21C2803,-5633.82 2803,-5586 2803,-5586 2803,-5586 3726.03,-5586 3726.03,-5586"/>
<polygon fill="black" stroke="black" points="3726.03,-5589.5 3736.03,-5586 3726.03,-5582.5 3726.03,-5589.5"/>
</g>
<!-- expert_10_3&#45;&gt;expert_agg_10 -->
<g id="edge289" class="edge">
<title>expert_10_3&#45;&gt;expert_agg_10</title>
<path fill="none" stroke="black" d="M3255,-5665.22C3255,-5636.83 3255,-5596 3255,-5596 3255,-5596 3726.31,-5596 3726.31,-5596"/>
<polygon fill="black" stroke="black" points="3726.31,-5599.5 3736.31,-5596 3726.31,-5592.5 3726.31,-5599.5"/>
</g>
<!-- expert_10_4&#45;&gt;expert_agg_10 -->
<g id="edge291" class="edge">
<title>expert_10_4&#45;&gt;expert_agg_10</title>
<path fill="none" stroke="black" d="M3781.25,-5665.35C3781.25,-5665.35 3781.25,-5617.7 3781.25,-5617.7"/>
<polygon fill="black" stroke="black" points="3784.75,-5617.7 3781.25,-5607.7 3777.75,-5617.7 3784.75,-5617.7"/>
</g>
<!-- expert_10_5&#45;&gt;expert_agg_10 -->
<g id="edge293" class="edge">
<title>expert_10_5&#45;&gt;expert_agg_10</title>
<path fill="none" stroke="black" d="M3906.75,-5665.35C3906.75,-5665.35 3906.75,-5617.7 3906.75,-5617.7"/>
<polygon fill="black" stroke="black" points="3910.25,-5617.7 3906.75,-5607.7 3903.25,-5617.7 3910.25,-5617.7"/>
</g>
<!-- expert_10_6&#45;&gt;expert_agg_10 -->
<g id="edge295" class="edge">
<title>expert_10_6&#45;&gt;expert_agg_10</title>
<path fill="none" stroke="black" d="M4371,-5665.44C4371,-5636.43 4371,-5594 4371,-5594 4371,-5594 3961.6,-5594 3961.6,-5594"/>
<polygon fill="black" stroke="black" points="3961.6,-5590.5 3951.6,-5594 3961.6,-5597.5 3961.6,-5590.5"/>
</g>
<!-- expert_10_7&#45;&gt;expert_agg_10 -->
<g id="edge297" class="edge">
<title>expert_10_7&#45;&gt;expert_agg_10</title>
<path fill="none" stroke="black" d="M4837,-5665.41C4837,-5632.31 4837,-5580 4837,-5580 4837,-5580 3961.68,-5580 3961.68,-5580"/>
<polygon fill="black" stroke="black" points="3961.68,-5576.5 3951.68,-5580 3961.68,-5583.5 3961.68,-5576.5"/>
</g>
<!-- expert_agg_10&#45;&gt;residual2_10 -->
<g id="edge300" class="edge">
<title>expert_agg_10&#45;&gt;residual2_10</title>
<path fill="none" stroke="black" d="M3951.69,-5567C4267.09,-5567 5166.75,-5567 5166.75,-5567 5166.75,-5567 5166.75,-5506.46 5166.75,-5506.46"/>
<polygon fill="black" stroke="black" points="5170.25,-5506.46 5166.75,-5496.46 5163.25,-5506.46 5170.25,-5506.46"/>
</g>
<!-- transfer_10 -->
<g id="node211" class="node">
<title>transfer_10</title>
<ellipse fill="#fadbd8" stroke="black" cx="5259" cy="-5358.57" rx="152.06" ry="26.74"/>
<text text-anchor="middle" x="5259" y="-5362.37" font-family="Helvetica,sans-Serif" font-size="14.00">Transfer to GPU 10</text>
<text text-anchor="middle" x="5259" y="-5347.37" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual2_10&#45;&gt;transfer_10 -->
<g id="edge301" class="edge">
<title>residual2_10&#45;&gt;transfer_10</title>
<path fill="none" stroke="black" d="M5259,-5443.26C5259,-5443.26 5259,-5395.8 5259,-5395.8"/>
<polygon fill="black" stroke="black" points="5262.5,-5395.8 5259,-5385.8 5255.5,-5395.8 5262.5,-5395.8"/>
</g>
<!-- residual1_11 -->
<g id="node218" class="node">
<title>residual1_11</title>
<polygon fill="#fadbd8" stroke="black" points="5514.5,-5273.7 5299.5,-5273.7 5299.5,-5220.7 5514.5,-5220.7 5514.5,-5273.7"/>
<text text-anchor="middle" x="5407" y="-5258.5" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="5407" y="-5243.5" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 10</text>
<text text-anchor="middle" x="5407" y="-5228.5" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- transfer_10&#45;&gt;residual1_11 -->
<g id="edge307" class="edge">
<title>transfer_10&#45;&gt;residual1_11</title>
<path fill="none" stroke="black" d="M5355.26,-5337.62C5355.26,-5337.62 5355.26,-5283.97 5355.26,-5283.97"/>
<polygon fill="black" stroke="black" points="5358.76,-5283.97 5355.26,-5273.97 5351.76,-5283.97 5358.76,-5283.97"/>
</g>
<!-- ln1_11 -->
<g id="node212" class="node">
<title>ln1_11</title>
<polygon fill="#f8f9f9" stroke="black" points="5662.5,-5940.44 5447.5,-5940.44 5447.5,-5887.44 5662.5,-5887.44 5662.5,-5940.44"/>
<text text-anchor="middle" x="5555" y="-5925.24" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="5555" y="-5910.24" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 10</text>
<text text-anchor="middle" x="5555" y="-5895.24" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_qkv_11 -->
<g id="node213" class="node">
<title>attn_qkv_11</title>
<polygon fill="#ffe6cc" stroke="black" points="5670,-5829.44 5440,-5829.44 5440,-5776.44 5670,-5776.44 5670,-5829.44"/>
<text text-anchor="middle" x="5555" y="-5814.24" font-family="Helvetica,sans-Serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5555" y="-5799.24" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 10</text>
<text text-anchor="middle" x="5555" y="-5784.24" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 3*hidden_dim]</text>
</g>
<!-- ln1_11&#45;&gt;attn_qkv_11 -->
<g id="edge302" class="edge">
<title>ln1_11&#45;&gt;attn_qkv_11</title>
<path fill="none" stroke="black" d="M5555,-5887.35C5555,-5887.35 5555,-5839.7 5555,-5839.7"/>
<polygon fill="black" stroke="black" points="5558.5,-5839.7 5555,-5829.7 5551.5,-5839.7 5558.5,-5839.7"/>
</g>
<!-- attn_score_11 -->
<g id="node214" class="node">
<title>attn_score_11</title>
<polygon fill="#ffe6cc" stroke="black" points="5692.5,-5718.44 5417.5,-5718.44 5417.5,-5665.44 5692.5,-5665.44 5692.5,-5718.44"/>
<text text-anchor="middle" x="5555" y="-5703.24" font-family="Helvetica,sans-Serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="5555" y="-5688.24" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 10</text>
<text text-anchor="middle" x="5555" y="-5673.24" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_qkv_11&#45;&gt;attn_score_11 -->
<g id="edge303" class="edge">
<title>attn_qkv_11&#45;&gt;attn_score_11</title>
<path fill="none" stroke="black" d="M5555,-5776.35C5555,-5776.35 5555,-5728.7 5555,-5728.7"/>
<polygon fill="black" stroke="black" points="5558.5,-5728.7 5555,-5718.7 5551.5,-5728.7 5558.5,-5728.7"/>
</g>
<!-- attn_weight_11 -->
<g id="node215" class="node">
<title>attn_weight_11</title>
<polygon fill="#ffe6cc" stroke="black" points="5692.5,-5607.44 5417.5,-5607.44 5417.5,-5554.44 5692.5,-5554.44 5692.5,-5607.44"/>
<text text-anchor="middle" x="5555" y="-5592.24" font-family="Helvetica,sans-Serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="5555" y="-5577.24" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 10</text>
<text text-anchor="middle" x="5555" y="-5562.24" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_score_11&#45;&gt;attn_weight_11 -->
<g id="edge304" class="edge">
<title>attn_score_11&#45;&gt;attn_weight_11</title>
<path fill="none" stroke="black" d="M5555,-5665.35C5555,-5665.35 5555,-5617.7 5555,-5617.7"/>
<polygon fill="black" stroke="black" points="5558.5,-5617.7 5555,-5607.7 5551.5,-5617.7 5558.5,-5617.7"/>
</g>
<!-- attn_context_11 -->
<g id="node216" class="node">
<title>attn_context_11</title>
<polygon fill="#ffe6cc" stroke="black" points="5700,-5496.44 5410,-5496.44 5410,-5443.44 5700,-5443.44 5700,-5496.44"/>
<text text-anchor="middle" x="5555" y="-5481.24" font-family="Helvetica,sans-Serif" font-size="14.00">Context</text>
<text text-anchor="middle" x="5555" y="-5466.24" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 10</text>
<text text-anchor="middle" x="5555" y="-5451.24" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, head_dim]</text>
</g>
<!-- attn_weight_11&#45;&gt;attn_context_11 -->
<g id="edge305" class="edge">
<title>attn_weight_11&#45;&gt;attn_context_11</title>
<path fill="none" stroke="black" d="M5555,-5554.35C5555,-5554.35 5555,-5506.7 5555,-5506.7"/>
<polygon fill="black" stroke="black" points="5558.5,-5506.7 5555,-5496.7 5551.5,-5506.7 5558.5,-5506.7"/>
</g>
<!-- attn_out_11 -->
<g id="node217" class="node">
<title>attn_out_11</title>
<polygon fill="#ffe6cc" stroke="black" points="5662.5,-5385.07 5447.5,-5385.07 5447.5,-5332.07 5662.5,-5332.07 5662.5,-5385.07"/>
<text text-anchor="middle" x="5555" y="-5369.87" font-family="Helvetica,sans-Serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="5555" y="-5354.87" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 10</text>
<text text-anchor="middle" x="5555" y="-5339.87" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_context_11&#45;&gt;attn_out_11 -->
<g id="edge306" class="edge">
<title>attn_context_11&#45;&gt;attn_out_11</title>
<path fill="none" stroke="black" d="M5555,-5443.26C5555,-5443.26 5555,-5395.41 5555,-5395.41"/>
<polygon fill="black" stroke="black" points="5558.5,-5395.41 5555,-5385.41 5551.5,-5395.41 5558.5,-5395.41"/>
</g>
<!-- attn_out_11&#45;&gt;residual1_11 -->
<g id="edge308" class="edge">
<title>attn_out_11&#45;&gt;residual1_11</title>
<path fill="none" stroke="black" d="M5481,-5331.89C5481,-5331.89 5481,-5284.04 5481,-5284.04"/>
<polygon fill="black" stroke="black" points="5484.5,-5284.04 5481,-5274.04 5477.5,-5284.04 5484.5,-5284.04"/>
</g>
<!-- ln2_11 -->
<g id="node219" class="node">
<title>ln2_11</title>
<polygon fill="#f8f9f9" stroke="black" points="5433.5,-5162.7 5218.5,-5162.7 5218.5,-5109.7 5433.5,-5109.7 5433.5,-5162.7"/>
<text text-anchor="middle" x="5326" y="-5147.5" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;MoE)</text>
<text text-anchor="middle" x="5326" y="-5132.5" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 10</text>
<text text-anchor="middle" x="5326" y="-5117.5" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_11&#45;&gt;ln2_11 -->
<g id="edge309" class="edge">
<title>residual1_11&#45;&gt;ln2_11</title>
<path fill="none" stroke="black" d="M5366.5,-5220.61C5366.5,-5220.61 5366.5,-5172.96 5366.5,-5172.96"/>
<polygon fill="black" stroke="black" points="5370,-5172.96 5366.5,-5162.96 5363,-5172.96 5370,-5172.96"/>
</g>
<!-- residual2_11 -->
<g id="node231" class="node">
<title>residual2_11</title>
<polygon fill="#fadbd8" stroke="black" points="5544.5,-4607.7 5329.5,-4607.7 5329.5,-4554.7 5544.5,-4554.7 5544.5,-4607.7"/>
<text text-anchor="middle" x="5437" y="-4592.5" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="5437" y="-4577.5" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 10</text>
<text text-anchor="middle" x="5437" y="-4562.5" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_11&#45;&gt;residual2_11 -->
<g id="edge329" class="edge">
<title>residual1_11&#45;&gt;residual2_11</title>
<path fill="none" stroke="black" d="M5474,-5220.68C5474,-5220.68 5474,-4617.8 5474,-4617.8"/>
<polygon fill="black" stroke="black" points="5477.5,-4617.8 5474,-4607.8 5470.5,-4617.8 5477.5,-4617.8"/>
</g>
<!-- router_11 -->
<g id="node220" class="node">
<title>router_11</title>
<polygon fill="#f5b7b1" stroke="black" points="4628,-5051.7 4428,-5051.7 4428,-4998.7 4628,-4998.7 4628,-5051.7"/>
<text text-anchor="middle" x="4528" y="-5036.5" font-family="Helvetica,sans-Serif" font-size="14.00">Router Network</text>
<text text-anchor="middle" x="4528" y="-5021.5" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 10</text>
<text text-anchor="middle" x="4528" y="-5006.5" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 8 experts]</text>
</g>
<!-- ln2_11&#45;&gt;router_11 -->
<g id="edge310" class="edge">
<title>ln2_11&#45;&gt;router_11</title>
<path fill="none" stroke="black" d="M5289.25,-5109.57C5289.25,-5076.67 5289.25,-5025 5289.25,-5025 5289.25,-5025 4638.3,-5025 4638.3,-5025"/>
<polygon fill="black" stroke="black" points="4638.3,-5021.5 4628.3,-5025 4638.3,-5028.5 4638.3,-5021.5"/>
</g>
<!-- expert_agg_11 -->
<g id="node230" class="node">
<title>expert_agg_11</title>
<polygon fill="#d4e6f1" stroke="black" points="4129.5,-4718.7 3914.5,-4718.7 3914.5,-4665.7 4129.5,-4665.7 4129.5,-4718.7"/>
<text text-anchor="middle" x="4022" y="-4703.5" font-family="Helvetica,sans-Serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="4022" y="-4688.5" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 10</text>
<text text-anchor="middle" x="4022" y="-4673.5" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- ln2_11&#45;&gt;expert_agg_11 -->
<g id="edge328" class="edge">
<title>ln2_11&#45;&gt;expert_agg_11</title>
<path fill="none" stroke="black" d="M5218.46,-5136C4906.28,-5136 4022,-5136 4022,-5136 4022,-5136 4022,-4728.96 4022,-4728.96"/>
<polygon fill="black" stroke="black" points="4025.5,-4728.96 4022,-4718.96 4018.5,-4728.96 4025.5,-4728.96"/>
</g>
<!-- gate_11 -->
<g id="node221" class="node">
<title>gate_11</title>
<polygon fill="#f5b7b1" stroke="black" points="3867.5,-4940.7 3724.5,-4940.7 3724.5,-4887.7 3867.5,-4887.7 3867.5,-4940.7"/>
<text text-anchor="middle" x="3796" y="-4925.5" font-family="Helvetica,sans-Serif" font-size="14.00">Top&#45;2 Gating</text>
<text text-anchor="middle" x="3796" y="-4910.5" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 10</text>
<text text-anchor="middle" x="3796" y="-4895.5" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 2]</text>
</g>
<!-- router_11&#45;&gt;gate_11 -->
<g id="edge311" class="edge">
<title>router_11&#45;&gt;gate_11</title>
<path fill="none" stroke="black" d="M4442,-4998.68C4442,-4970.51 4442,-4930 4442,-4930 4442,-4930 3877.6,-4930 3877.6,-4930"/>
<polygon fill="black" stroke="black" points="3877.6,-4926.5 3867.6,-4930 3877.6,-4933.5 3877.6,-4926.5"/>
</g>
<!-- expert_11_0 -->
<g id="node222" class="node">
<title>expert_11_0</title>
<polygon fill="#e8daef" stroke="black" points="2196,-4829.7 1780,-4829.7 1780,-4776.7 2196,-4776.7 2196,-4829.7"/>
<text text-anchor="middle" x="1988" y="-4814.5" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="1988" y="-4799.5" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 10</text>
<text text-anchor="middle" x="1988" y="-4784.5" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_11&#45;&gt;expert_11_0 -->
<g id="edge312" class="edge">
<title>gate_11&#45;&gt;expert_11_0</title>
<path fill="none" stroke="black" d="M3724.47,-4930C3405.07,-4930 2125,-4930 2125,-4930 2125,-4930 2125,-4839.78 2125,-4839.78"/>
<polygon fill="black" stroke="black" points="2128.5,-4839.78 2125,-4829.78 2121.5,-4839.78 2128.5,-4839.78"/>
</g>
<!-- expert_11_1 -->
<g id="node223" class="node">
<title>expert_11_1</title>
<polygon fill="#e8daef" stroke="black" points="2648,-4829.7 2232,-4829.7 2232,-4776.7 2648,-4776.7 2648,-4829.7"/>
<text text-anchor="middle" x="2440" y="-4814.5" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="2440" y="-4799.5" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 10</text>
<text text-anchor="middle" x="2440" y="-4784.5" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_11&#45;&gt;expert_11_1 -->
<g id="edge314" class="edge">
<title>gate_11&#45;&gt;expert_11_1</title>
<path fill="none" stroke="black" d="M3724.3,-4919C3463,-4919 2577,-4919 2577,-4919 2577,-4919 2577,-4839.77 2577,-4839.77"/>
<polygon fill="black" stroke="black" points="2580.5,-4839.77 2577,-4829.77 2573.5,-4839.77 2580.5,-4839.77"/>
</g>
<!-- expert_11_2 -->
<g id="node224" class="node">
<title>expert_11_2</title>
<polygon fill="#e8daef" stroke="black" points="3100,-4829.7 2684,-4829.7 2684,-4776.7 3100,-4776.7 3100,-4829.7"/>
<text text-anchor="middle" x="2892" y="-4814.5" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2892" y="-4799.5" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 10</text>
<text text-anchor="middle" x="2892" y="-4784.5" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_11&#45;&gt;expert_11_2 -->
<g id="edge316" class="edge">
<title>gate_11&#45;&gt;expert_11_2</title>
<path fill="none" stroke="black" d="M3724.19,-4908C3533.52,-4908 3029,-4908 3029,-4908 3029,-4908 3029,-4839.92 3029,-4839.92"/>
<polygon fill="black" stroke="black" points="3032.5,-4839.92 3029,-4829.92 3025.5,-4839.92 3032.5,-4839.92"/>
</g>
<!-- expert_11_3 -->
<g id="node225" class="node">
<title>expert_11_3</title>
<polygon fill="#e8daef" stroke="black" points="3552,-4829.7 3136,-4829.7 3136,-4776.7 3552,-4776.7 3552,-4829.7"/>
<text text-anchor="middle" x="3344" y="-4814.5" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="3344" y="-4799.5" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 10</text>
<text text-anchor="middle" x="3344" y="-4784.5" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_11&#45;&gt;expert_11_3 -->
<g id="edge318" class="edge">
<title>gate_11&#45;&gt;expert_11_3</title>
<path fill="none" stroke="black" d="M3724.13,-4898C3631.16,-4898 3481,-4898 3481,-4898 3481,-4898 3481,-4839.86 3481,-4839.86"/>
<polygon fill="black" stroke="black" points="3484.5,-4839.86 3481,-4829.86 3477.5,-4839.86 3484.5,-4839.86"/>
</g>
<!-- expert_11_4 -->
<g id="node226" class="node">
<title>expert_11_4</title>
<polygon fill="#e8daef" stroke="black" points="4004,-4829.7 3588,-4829.7 3588,-4776.7 4004,-4776.7 4004,-4829.7"/>
<text text-anchor="middle" x="3796" y="-4814.5" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="3796" y="-4799.5" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 10</text>
<text text-anchor="middle" x="3796" y="-4784.5" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_11&#45;&gt;expert_11_4 -->
<g id="edge320" class="edge">
<title>gate_11&#45;&gt;expert_11_4</title>
<path fill="none" stroke="black" d="M3796,-4887.61C3796,-4887.61 3796,-4839.96 3796,-4839.96"/>
<polygon fill="black" stroke="black" points="3799.5,-4839.96 3796,-4829.96 3792.5,-4839.96 3799.5,-4839.96"/>
</g>
<!-- expert_11_5 -->
<g id="node227" class="node">
<title>expert_11_5</title>
<polygon fill="#e8daef" stroke="black" points="4456,-4829.7 4040,-4829.7 4040,-4776.7 4456,-4776.7 4456,-4829.7"/>
<text text-anchor="middle" x="4248" y="-4814.5" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="4248" y="-4799.5" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 10</text>
<text text-anchor="middle" x="4248" y="-4784.5" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_11&#45;&gt;expert_11_5 -->
<g id="edge322" class="edge">
<title>gate_11&#45;&gt;expert_11_5</title>
<path fill="none" stroke="black" d="M3867.72,-4898C3973.51,-4898 4159,-4898 4159,-4898 4159,-4898 4159,-4839.86 4159,-4839.86"/>
<polygon fill="black" stroke="black" points="4162.5,-4839.86 4159,-4829.86 4155.5,-4839.86 4162.5,-4839.86"/>
</g>
<!-- expert_11_6 -->
<g id="node228" class="node">
<title>expert_11_6</title>
<polygon fill="#e8daef" stroke="black" points="4908,-4829.7 4492,-4829.7 4492,-4776.7 4908,-4776.7 4908,-4829.7"/>
<text text-anchor="middle" x="4700" y="-4814.5" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="4700" y="-4799.5" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 10</text>
<text text-anchor="middle" x="4700" y="-4784.5" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_11&#45;&gt;expert_11_6 -->
<g id="edge324" class="edge">
<title>gate_11&#45;&gt;expert_11_6</title>
<path fill="none" stroke="black" d="M3867.53,-4908C4057.46,-4908 4560,-4908 4560,-4908 4560,-4908 4560,-4839.92 4560,-4839.92"/>
<polygon fill="black" stroke="black" points="4563.5,-4839.92 4560,-4829.92 4556.5,-4839.92 4563.5,-4839.92"/>
</g>
<!-- expert_11_7 -->
<g id="node229" class="node">
<title>expert_11_7</title>
<polygon fill="#e8daef" stroke="black" points="5360,-4829.7 4944,-4829.7 4944,-4776.7 5360,-4776.7 5360,-4829.7"/>
<text text-anchor="middle" x="5152" y="-4814.5" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="5152" y="-4799.5" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 10</text>
<text text-anchor="middle" x="5152" y="-4784.5" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_11&#45;&gt;expert_11_7 -->
<g id="edge326" class="edge">
<title>gate_11&#45;&gt;expert_11_7</title>
<path fill="none" stroke="black" d="M3867.87,-4919C4130.84,-4919 5025.49,-4919 5025.49,-4919 5025.49,-4919 5025.49,-4839.77 5025.49,-4839.77"/>
<polygon fill="black" stroke="black" points="5028.99,-4839.77 5025.49,-4829.77 5021.99,-4839.77 5028.99,-4839.77"/>
</g>
<!-- expert_11_0&#45;&gt;expert_agg_11 -->
<g id="edge313" class="edge">
<title>expert_11_0&#45;&gt;expert_agg_11</title>
<path fill="none" stroke="black" d="M2077,-4776.54C2077,-4739.24 2077,-4676 2077,-4676 2077,-4676 3904.31,-4676 3904.31,-4676"/>
<polygon fill="black" stroke="black" points="3904.31,-4679.5 3914.31,-4676 3904.31,-4672.5 3904.31,-4679.5"/>
</g>
<!-- expert_11_1&#45;&gt;expert_agg_11 -->
<g id="edge315" class="edge">
<title>expert_11_1&#45;&gt;expert_agg_11</title>
<path fill="none" stroke="black" d="M2529,-4776.61C2529,-4742.03 2529,-4686 2529,-4686 2529,-4686 3904.33,-4686 3904.33,-4686"/>
<polygon fill="black" stroke="black" points="3904.33,-4689.5 3914.33,-4686 3904.33,-4682.5 3904.33,-4689.5"/>
</g>
<!-- expert_11_2&#45;&gt;expert_agg_11 -->
<g id="edge317" class="edge">
<title>expert_11_2&#45;&gt;expert_agg_11</title>
<path fill="none" stroke="black" d="M2981,-4776.68C2981,-4745.22 2981,-4697 2981,-4697 2981,-4697 3904.03,-4697 3904.03,-4697"/>
<polygon fill="black" stroke="black" points="3904.03,-4700.5 3914.03,-4697 3904.03,-4693.5 3904.03,-4700.5"/>
</g>
<!-- expert_11_3&#45;&gt;expert_agg_11 -->
<g id="edge319" class="edge">
<title>expert_11_3&#45;&gt;expert_agg_11</title>
<path fill="none" stroke="black" d="M3433,-4776.68C3433,-4748.51 3433,-4708 3433,-4708 3433,-4708 3904.31,-4708 3904.31,-4708"/>
<polygon fill="black" stroke="black" points="3904.31,-4711.5 3914.31,-4708 3904.31,-4704.5 3904.31,-4711.5"/>
</g>
<!-- expert_11_4&#45;&gt;expert_agg_11 -->
<g id="edge321" class="edge">
<title>expert_11_4&#45;&gt;expert_agg_11</title>
<path fill="none" stroke="black" d="M3959.25,-4776.61C3959.25,-4776.61 3959.25,-4728.96 3959.25,-4728.96"/>
<polygon fill="black" stroke="black" points="3962.75,-4728.96 3959.25,-4718.96 3955.75,-4728.96 3962.75,-4728.96"/>
</g>
<!-- expert_11_5&#45;&gt;expert_agg_11 -->
<g id="edge323" class="edge">
<title>expert_11_5&#45;&gt;expert_agg_11</title>
<path fill="none" stroke="black" d="M4084.75,-4776.61C4084.75,-4776.61 4084.75,-4728.96 4084.75,-4728.96"/>
<polygon fill="black" stroke="black" points="4088.25,-4728.96 4084.75,-4718.96 4081.25,-4728.96 4088.25,-4728.96"/>
</g>
<!-- expert_11_6&#45;&gt;expert_agg_11 -->
<g id="edge325" class="edge">
<title>expert_11_6&#45;&gt;expert_agg_11</title>
<path fill="none" stroke="black" d="M4549,-4776.63C4549,-4747.54 4549,-4705 4549,-4705 4549,-4705 4139.6,-4705 4139.6,-4705"/>
<polygon fill="black" stroke="black" points="4139.6,-4701.5 4129.6,-4705 4139.6,-4708.5 4139.6,-4701.5"/>
</g>
<!-- expert_11_7&#45;&gt;expert_agg_11 -->
<g id="edge327" class="edge">
<title>expert_11_7&#45;&gt;expert_agg_11</title>
<path fill="none" stroke="black" d="M5015,-4776.57C5015,-4743.67 5015,-4692 5015,-4692 5015,-4692 4139.68,-4692 4139.68,-4692"/>
<polygon fill="black" stroke="black" points="4139.68,-4688.5 4129.68,-4692 4139.68,-4695.5 4139.68,-4688.5"/>
</g>
<!-- expert_agg_11&#45;&gt;residual2_11 -->
<g id="edge330" class="edge">
<title>expert_agg_11&#45;&gt;residual2_11</title>
<path fill="none" stroke="black" d="M4129.69,-4678C4445.09,-4678 5344.75,-4678 5344.75,-4678 5344.75,-4678 5344.75,-4617.91 5344.75,-4617.91"/>
<polygon fill="black" stroke="black" points="5348.25,-4617.91 5344.75,-4607.91 5341.25,-4617.91 5348.25,-4617.91"/>
</g>
<!-- transfer_11 -->
<g id="node232" class="node">
<title>transfer_11</title>
<ellipse fill="#fadbd8" stroke="black" cx="5437" cy="-4469.83" rx="152.06" ry="26.74"/>
<text text-anchor="middle" x="5437" y="-4473.63" font-family="Helvetica,sans-Serif" font-size="14.00">Transfer to GPU 11</text>
<text text-anchor="middle" x="5437" y="-4458.63" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual2_11&#45;&gt;transfer_11 -->
<g id="edge331" class="edge">
<title>residual2_11&#45;&gt;transfer_11</title>
<path fill="none" stroke="black" d="M5437,-4554.52C5437,-4554.52 5437,-4507.06 5437,-4507.06"/>
<polygon fill="black" stroke="black" points="5440.5,-4507.06 5437,-4497.06 5433.5,-4507.06 5440.5,-4507.06"/>
</g>
<!-- residual1_12 -->
<g id="node239" class="node">
<title>residual1_12</title>
<polygon fill="#fadbd8" stroke="black" points="5692.5,-4384.96 5477.5,-4384.96 5477.5,-4331.96 5692.5,-4331.96 5692.5,-4384.96"/>
<text text-anchor="middle" x="5585" y="-4369.76" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="5585" y="-4354.76" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 11</text>
<text text-anchor="middle" x="5585" y="-4339.76" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- transfer_11&#45;&gt;residual1_12 -->
<g id="edge337" class="edge">
<title>transfer_11&#45;&gt;residual1_12</title>
<path fill="none" stroke="black" d="M5533.26,-4448.88C5533.26,-4448.88 5533.26,-4395.23 5533.26,-4395.23"/>
<polygon fill="black" stroke="black" points="5536.76,-4395.23 5533.26,-4385.23 5529.76,-4395.23 5536.76,-4395.23"/>
</g>
<!-- ln1_12 -->
<g id="node233" class="node">
<title>ln1_12</title>
<polygon fill="#f8f9f9" stroke="black" points="5840.5,-5051.7 5625.5,-5051.7 5625.5,-4998.7 5840.5,-4998.7 5840.5,-5051.7"/>
<text text-anchor="middle" x="5733" y="-5036.5" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="5733" y="-5021.5" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 11</text>
<text text-anchor="middle" x="5733" y="-5006.5" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_qkv_12 -->
<g id="node234" class="node">
<title>attn_qkv_12</title>
<polygon fill="#ffe6cc" stroke="black" points="5848,-4940.7 5618,-4940.7 5618,-4887.7 5848,-4887.7 5848,-4940.7"/>
<text text-anchor="middle" x="5733" y="-4925.5" font-family="Helvetica,sans-Serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5733" y="-4910.5" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 11</text>
<text text-anchor="middle" x="5733" y="-4895.5" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 3*hidden_dim]</text>
</g>
<!-- ln1_12&#45;&gt;attn_qkv_12 -->
<g id="edge332" class="edge">
<title>ln1_12&#45;&gt;attn_qkv_12</title>
<path fill="none" stroke="black" d="M5733,-4998.61C5733,-4998.61 5733,-4950.96 5733,-4950.96"/>
<polygon fill="black" stroke="black" points="5736.5,-4950.96 5733,-4940.96 5729.5,-4950.96 5736.5,-4950.96"/>
</g>
<!-- attn_score_12 -->
<g id="node235" class="node">
<title>attn_score_12</title>
<polygon fill="#ffe6cc" stroke="black" points="5870.5,-4829.7 5595.5,-4829.7 5595.5,-4776.7 5870.5,-4776.7 5870.5,-4829.7"/>
<text text-anchor="middle" x="5733" y="-4814.5" font-family="Helvetica,sans-Serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="5733" y="-4799.5" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 11</text>
<text text-anchor="middle" x="5733" y="-4784.5" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_qkv_12&#45;&gt;attn_score_12 -->
<g id="edge333" class="edge">
<title>attn_qkv_12&#45;&gt;attn_score_12</title>
<path fill="none" stroke="black" d="M5733,-4887.61C5733,-4887.61 5733,-4839.96 5733,-4839.96"/>
<polygon fill="black" stroke="black" points="5736.5,-4839.96 5733,-4829.96 5729.5,-4839.96 5736.5,-4839.96"/>
</g>
<!-- attn_weight_12 -->
<g id="node236" class="node">
<title>attn_weight_12</title>
<polygon fill="#ffe6cc" stroke="black" points="5870.5,-4718.7 5595.5,-4718.7 5595.5,-4665.7 5870.5,-4665.7 5870.5,-4718.7"/>
<text text-anchor="middle" x="5733" y="-4703.5" font-family="Helvetica,sans-Serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="5733" y="-4688.5" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 11</text>
<text text-anchor="middle" x="5733" y="-4673.5" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_score_12&#45;&gt;attn_weight_12 -->
<g id="edge334" class="edge">
<title>attn_score_12&#45;&gt;attn_weight_12</title>
<path fill="none" stroke="black" d="M5733,-4776.61C5733,-4776.61 5733,-4728.96 5733,-4728.96"/>
<polygon fill="black" stroke="black" points="5736.5,-4728.96 5733,-4718.96 5729.5,-4728.96 5736.5,-4728.96"/>
</g>
<!-- attn_context_12 -->
<g id="node237" class="node">
<title>attn_context_12</title>
<polygon fill="#ffe6cc" stroke="black" points="5878,-4607.7 5588,-4607.7 5588,-4554.7 5878,-4554.7 5878,-4607.7"/>
<text text-anchor="middle" x="5733" y="-4592.5" font-family="Helvetica,sans-Serif" font-size="14.00">Context</text>
<text text-anchor="middle" x="5733" y="-4577.5" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 11</text>
<text text-anchor="middle" x="5733" y="-4562.5" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, head_dim]</text>
</g>
<!-- attn_weight_12&#45;&gt;attn_context_12 -->
<g id="edge335" class="edge">
<title>attn_weight_12&#45;&gt;attn_context_12</title>
<path fill="none" stroke="black" d="M5733,-4665.61C5733,-4665.61 5733,-4617.96 5733,-4617.96"/>
<polygon fill="black" stroke="black" points="5736.5,-4617.96 5733,-4607.96 5729.5,-4617.96 5736.5,-4617.96"/>
</g>
<!-- attn_out_12 -->
<g id="node238" class="node">
<title>attn_out_12</title>
<polygon fill="#ffe6cc" stroke="black" points="5840.5,-4496.33 5625.5,-4496.33 5625.5,-4443.33 5840.5,-4443.33 5840.5,-4496.33"/>
<text text-anchor="middle" x="5733" y="-4481.13" font-family="Helvetica,sans-Serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="5733" y="-4466.13" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 11</text>
<text text-anchor="middle" x="5733" y="-4451.13" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_context_12&#45;&gt;attn_out_12 -->
<g id="edge336" class="edge">
<title>attn_context_12&#45;&gt;attn_out_12</title>
<path fill="none" stroke="black" d="M5733,-4554.52C5733,-4554.52 5733,-4506.67 5733,-4506.67"/>
<polygon fill="black" stroke="black" points="5736.5,-4506.67 5733,-4496.67 5729.5,-4506.67 5736.5,-4506.67"/>
</g>
<!-- attn_out_12&#45;&gt;residual1_12 -->
<g id="edge338" class="edge">
<title>attn_out_12&#45;&gt;residual1_12</title>
<path fill="none" stroke="black" d="M5659,-4443.15C5659,-4443.15 5659,-4395.3 5659,-4395.3"/>
<polygon fill="black" stroke="black" points="5662.5,-4395.3 5659,-4385.3 5655.5,-4395.3 5662.5,-4395.3"/>
</g>
<!-- ln2_12 -->
<g id="node240" class="node">
<title>ln2_12</title>
<polygon fill="#f8f9f9" stroke="black" points="5611.5,-4273.96 5396.5,-4273.96 5396.5,-4220.96 5611.5,-4220.96 5611.5,-4273.96"/>
<text text-anchor="middle" x="5504" y="-4258.76" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;MoE)</text>
<text text-anchor="middle" x="5504" y="-4243.76" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 11</text>
<text text-anchor="middle" x="5504" y="-4228.76" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_12&#45;&gt;ln2_12 -->
<g id="edge339" class="edge">
<title>residual1_12&#45;&gt;ln2_12</title>
<path fill="none" stroke="black" d="M5544.5,-4331.87C5544.5,-4331.87 5544.5,-4284.22 5544.5,-4284.22"/>
<polygon fill="black" stroke="black" points="5548,-4284.22 5544.5,-4274.22 5541,-4284.22 5548,-4284.22"/>
</g>
<!-- residual2_12 -->
<g id="node252" class="node">
<title>residual2_12</title>
<polygon fill="#fadbd8" stroke="black" points="5722.5,-3718.96 5507.5,-3718.96 5507.5,-3665.96 5722.5,-3665.96 5722.5,-3718.96"/>
<text text-anchor="middle" x="5615" y="-3703.76" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="5615" y="-3688.76" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 11</text>
<text text-anchor="middle" x="5615" y="-3673.76" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_12&#45;&gt;residual2_12 -->
<g id="edge359" class="edge">
<title>residual1_12&#45;&gt;residual2_12</title>
<path fill="none" stroke="black" d="M5652,-4331.94C5652,-4331.94 5652,-3729.06 5652,-3729.06"/>
<polygon fill="black" stroke="black" points="5655.5,-3729.06 5652,-3719.06 5648.5,-3729.06 5655.5,-3729.06"/>
</g>
<!-- router_12 -->
<g id="node241" class="node">
<title>router_12</title>
<polygon fill="#f5b7b1" stroke="black" points="4806,-4162.96 4606,-4162.96 4606,-4109.96 4806,-4109.96 4806,-4162.96"/>
<text text-anchor="middle" x="4706" y="-4147.76" font-family="Helvetica,sans-Serif" font-size="14.00">Router Network</text>
<text text-anchor="middle" x="4706" y="-4132.76" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 11</text>
<text text-anchor="middle" x="4706" y="-4117.76" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 8 experts]</text>
</g>
<!-- ln2_12&#45;&gt;router_12 -->
<g id="edge340" class="edge">
<title>ln2_12&#45;&gt;router_12</title>
<path fill="none" stroke="black" d="M5467.25,-4220.76C5467.25,-4187.79 5467.25,-4136 5467.25,-4136 5467.25,-4136 4816.3,-4136 4816.3,-4136"/>
<polygon fill="black" stroke="black" points="4816.3,-4132.5 4806.3,-4136 4816.3,-4139.5 4816.3,-4132.5"/>
</g>
<!-- expert_agg_12 -->
<g id="node251" class="node">
<title>expert_agg_12</title>
<polygon fill="#d4e6f1" stroke="black" points="4307.5,-3829.96 4092.5,-3829.96 4092.5,-3776.96 4307.5,-3776.96 4307.5,-3829.96"/>
<text text-anchor="middle" x="4200" y="-3814.76" font-family="Helvetica,sans-Serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="4200" y="-3799.76" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 11</text>
<text text-anchor="middle" x="4200" y="-3784.76" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- ln2_12&#45;&gt;expert_agg_12 -->
<g id="edge358" class="edge">
<title>ln2_12&#45;&gt;expert_agg_12</title>
<path fill="none" stroke="black" d="M5396.46,-4247C5084.28,-4247 4200,-4247 4200,-4247 4200,-4247 4200,-3840.21 4200,-3840.21"/>
<polygon fill="black" stroke="black" points="4203.5,-3840.21 4200,-3830.21 4196.5,-3840.21 4203.5,-3840.21"/>
</g>
<!-- gate_12 -->
<g id="node242" class="node">
<title>gate_12</title>
<polygon fill="#f5b7b1" stroke="black" points="4045.5,-4051.96 3902.5,-4051.96 3902.5,-3998.96 4045.5,-3998.96 4045.5,-4051.96"/>
<text text-anchor="middle" x="3974" y="-4036.76" font-family="Helvetica,sans-Serif" font-size="14.00">Top&#45;2 Gating</text>
<text text-anchor="middle" x="3974" y="-4021.76" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 11</text>
<text text-anchor="middle" x="3974" y="-4006.76" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 2]</text>
</g>
<!-- router_12&#45;&gt;gate_12 -->
<g id="edge341" class="edge">
<title>router_12&#45;&gt;gate_12</title>
<path fill="none" stroke="black" d="M4620,-4109.87C4620,-4081.62 4620,-4041 4620,-4041 4620,-4041 4055.6,-4041 4055.6,-4041"/>
<polygon fill="black" stroke="black" points="4055.6,-4037.5 4045.6,-4041 4055.6,-4044.5 4055.6,-4037.5"/>
</g>
<!-- expert_12_0 -->
<g id="node243" class="node">
<title>expert_12_0</title>
<polygon fill="#e8daef" stroke="black" points="2374,-3940.96 1958,-3940.96 1958,-3887.96 2374,-3887.96 2374,-3940.96"/>
<text text-anchor="middle" x="2166" y="-3925.76" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="2166" y="-3910.76" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 11</text>
<text text-anchor="middle" x="2166" y="-3895.76" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_12&#45;&gt;expert_12_0 -->
<g id="edge342" class="edge">
<title>gate_12&#45;&gt;expert_12_0</title>
<path fill="none" stroke="black" d="M3902.47,-4041C3583.07,-4041 2303,-4041 2303,-4041 2303,-4041 2303,-3950.99 2303,-3950.99"/>
<polygon fill="black" stroke="black" points="2306.5,-3950.99 2303,-3940.99 2299.5,-3950.99 2306.5,-3950.99"/>
</g>
<!-- expert_12_1 -->
<g id="node244" class="node">
<title>expert_12_1</title>
<polygon fill="#e8daef" stroke="black" points="2826,-3940.96 2410,-3940.96 2410,-3887.96 2826,-3887.96 2826,-3940.96"/>
<text text-anchor="middle" x="2618" y="-3925.76" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="2618" y="-3910.76" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 11</text>
<text text-anchor="middle" x="2618" y="-3895.76" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_12&#45;&gt;expert_12_1 -->
<g id="edge344" class="edge">
<title>gate_12&#45;&gt;expert_12_1</title>
<path fill="none" stroke="black" d="M3902.3,-4030C3641,-4030 2755,-4030 2755,-4030 2755,-4030 2755,-3950.97 2755,-3950.97"/>
<polygon fill="black" stroke="black" points="2758.5,-3950.97 2755,-3940.97 2751.5,-3950.97 2758.5,-3950.97"/>
</g>
<!-- expert_12_2 -->
<g id="node245" class="node">
<title>expert_12_2</title>
<polygon fill="#e8daef" stroke="black" points="3278,-3940.96 2862,-3940.96 2862,-3887.96 3278,-3887.96 3278,-3940.96"/>
<text text-anchor="middle" x="3070" y="-3925.76" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="3070" y="-3910.76" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 11</text>
<text text-anchor="middle" x="3070" y="-3895.76" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_12&#45;&gt;expert_12_2 -->
<g id="edge346" class="edge">
<title>gate_12&#45;&gt;expert_12_2</title>
<path fill="none" stroke="black" d="M3902.19,-4020C3711.52,-4020 3207,-4020 3207,-4020 3207,-4020 3207,-3951.09 3207,-3951.09"/>
<polygon fill="black" stroke="black" points="3210.5,-3951.09 3207,-3941.09 3203.5,-3951.09 3210.5,-3951.09"/>
</g>
<!-- expert_12_3 -->
<g id="node246" class="node">
<title>expert_12_3</title>
<polygon fill="#e8daef" stroke="black" points="3730,-3940.96 3314,-3940.96 3314,-3887.96 3730,-3887.96 3730,-3940.96"/>
<text text-anchor="middle" x="3522" y="-3925.76" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="3522" y="-3910.76" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 11</text>
<text text-anchor="middle" x="3522" y="-3895.76" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_12&#45;&gt;expert_12_3 -->
<g id="edge348" class="edge">
<title>gate_12&#45;&gt;expert_12_3</title>
<path fill="none" stroke="black" d="M3902.13,-4009C3809.16,-4009 3659,-4009 3659,-4009 3659,-4009 3659,-3951.05 3659,-3951.05"/>
<polygon fill="black" stroke="black" points="3662.5,-3951.05 3659,-3941.05 3655.5,-3951.05 3662.5,-3951.05"/>
</g>
<!-- expert_12_4 -->
<g id="node247" class="node">
<title>expert_12_4</title>
<polygon fill="#e8daef" stroke="black" points="4182,-3940.96 3766,-3940.96 3766,-3887.96 4182,-3887.96 4182,-3940.96"/>
<text text-anchor="middle" x="3974" y="-3925.76" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="3974" y="-3910.76" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 11</text>
<text text-anchor="middle" x="3974" y="-3895.76" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_12&#45;&gt;expert_12_4 -->
<g id="edge350" class="edge">
<title>gate_12&#45;&gt;expert_12_4</title>
<path fill="none" stroke="black" d="M3974,-3998.87C3974,-3998.87 3974,-3951.22 3974,-3951.22"/>
<polygon fill="black" stroke="black" points="3977.5,-3951.22 3974,-3941.22 3970.5,-3951.22 3977.5,-3951.22"/>
</g>
<!-- expert_12_5 -->
<g id="node248" class="node">
<title>expert_12_5</title>
<polygon fill="#e8daef" stroke="black" points="4634,-3940.96 4218,-3940.96 4218,-3887.96 4634,-3887.96 4634,-3940.96"/>
<text text-anchor="middle" x="4426" y="-3925.76" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="4426" y="-3910.76" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 11</text>
<text text-anchor="middle" x="4426" y="-3895.76" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_12&#45;&gt;expert_12_5 -->
<g id="edge352" class="edge">
<title>gate_12&#45;&gt;expert_12_5</title>
<path fill="none" stroke="black" d="M4045.72,-4009C4151.51,-4009 4337,-4009 4337,-4009 4337,-4009 4337,-3951.05 4337,-3951.05"/>
<polygon fill="black" stroke="black" points="4340.5,-3951.05 4337,-3941.05 4333.5,-3951.05 4340.5,-3951.05"/>
</g>
<!-- expert_12_6 -->
<g id="node249" class="node">
<title>expert_12_6</title>
<polygon fill="#e8daef" stroke="black" points="5086,-3940.96 4670,-3940.96 4670,-3887.96 5086,-3887.96 5086,-3940.96"/>
<text text-anchor="middle" x="4878" y="-3925.76" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="4878" y="-3910.76" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 11</text>
<text text-anchor="middle" x="4878" y="-3895.76" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_12&#45;&gt;expert_12_6 -->
<g id="edge354" class="edge">
<title>gate_12&#45;&gt;expert_12_6</title>
<path fill="none" stroke="black" d="M4045.53,-4020C4235.46,-4020 4738,-4020 4738,-4020 4738,-4020 4738,-3951.09 4738,-3951.09"/>
<polygon fill="black" stroke="black" points="4741.5,-3951.09 4738,-3941.09 4734.5,-3951.09 4741.5,-3951.09"/>
</g>
<!-- expert_12_7 -->
<g id="node250" class="node">
<title>expert_12_7</title>
<polygon fill="#e8daef" stroke="black" points="5538,-3940.96 5122,-3940.96 5122,-3887.96 5538,-3887.96 5538,-3940.96"/>
<text text-anchor="middle" x="5330" y="-3925.76" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="5330" y="-3910.76" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 11</text>
<text text-anchor="middle" x="5330" y="-3895.76" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_12&#45;&gt;expert_12_7 -->
<g id="edge356" class="edge">
<title>gate_12&#45;&gt;expert_12_7</title>
<path fill="none" stroke="black" d="M4045.87,-4030C4308.84,-4030 5203.49,-4030 5203.49,-4030 5203.49,-4030 5203.49,-3950.97 5203.49,-3950.97"/>
<polygon fill="black" stroke="black" points="5206.99,-3950.97 5203.49,-3940.97 5199.99,-3950.97 5206.99,-3950.97"/>
</g>
<!-- expert_12_0&#45;&gt;expert_agg_12 -->
<g id="edge343" class="edge">
<title>expert_12_0&#45;&gt;expert_agg_12</title>
<path fill="none" stroke="black" d="M2255,-3887.74C2255,-3850.37 2255,-3787 2255,-3787 2255,-3787 4082.31,-3787 4082.31,-3787"/>
<polygon fill="black" stroke="black" points="4082.31,-3790.5 4092.31,-3787 4082.31,-3783.5 4082.31,-3790.5"/>
</g>
<!-- expert_12_1&#45;&gt;expert_agg_12 -->
<g id="edge345" class="edge">
<title>expert_12_1&#45;&gt;expert_agg_12</title>
<path fill="none" stroke="black" d="M2707,-3887.74C2707,-3853.36 2707,-3798 2707,-3798 2707,-3798 4082.33,-3798 4082.33,-3798"/>
<polygon fill="black" stroke="black" points="4082.33,-3801.5 4092.33,-3798 4082.33,-3794.5 4082.33,-3801.5"/>
</g>
<!-- expert_12_2&#45;&gt;expert_agg_12 -->
<g id="edge347" class="edge">
<title>expert_12_2&#45;&gt;expert_agg_12</title>
<path fill="none" stroke="black" d="M3159,-3887.87C3159,-3856.34 3159,-3808 3159,-3808 3159,-3808 4082.03,-3808 4082.03,-3808"/>
<polygon fill="black" stroke="black" points="4082.03,-3811.5 4092.03,-3808 4082.03,-3804.5 4082.03,-3811.5"/>
</g>
<!-- expert_12_3&#45;&gt;expert_agg_12 -->
<g id="edge349" class="edge">
<title>expert_12_3&#45;&gt;expert_agg_12</title>
<path fill="none" stroke="black" d="M3611,-3887.87C3611,-3859.62 3611,-3819 3611,-3819 3611,-3819 4082.31,-3819 4082.31,-3819"/>
<polygon fill="black" stroke="black" points="4082.31,-3822.5 4092.31,-3819 4082.31,-3815.5 4082.31,-3822.5"/>
</g>
<!-- expert_12_4&#45;&gt;expert_agg_12 -->
<g id="edge351" class="edge">
<title>expert_12_4&#45;&gt;expert_agg_12</title>
<path fill="none" stroke="black" d="M4137.25,-3887.87C4137.25,-3887.87 4137.25,-3840.22 4137.25,-3840.22"/>
<polygon fill="black" stroke="black" points="4140.75,-3840.22 4137.25,-3830.22 4133.75,-3840.22 4140.75,-3840.22"/>
</g>
<!-- expert_12_5&#45;&gt;expert_agg_12 -->
<g id="edge353" class="edge">
<title>expert_12_5&#45;&gt;expert_agg_12</title>
<path fill="none" stroke="black" d="M4262.75,-3887.87C4262.75,-3887.87 4262.75,-3840.22 4262.75,-3840.22"/>
<polygon fill="black" stroke="black" points="4266.25,-3840.22 4262.75,-3830.22 4259.25,-3840.22 4266.25,-3840.22"/>
</g>
<!-- expert_12_6&#45;&gt;expert_agg_12 -->
<g id="edge355" class="edge">
<title>expert_12_6&#45;&gt;expert_agg_12</title>
<path fill="none" stroke="black" d="M4727,-3887.82C4727,-3858.66 4727,-3816 4727,-3816 4727,-3816 4317.6,-3816 4317.6,-3816"/>
<polygon fill="black" stroke="black" points="4317.6,-3812.5 4307.6,-3816 4317.6,-3819.5 4317.6,-3812.5"/>
</g>
<!-- expert_12_7&#45;&gt;expert_agg_12 -->
<g id="edge357" class="edge">
<title>expert_12_7&#45;&gt;expert_agg_12</title>
<path fill="none" stroke="black" d="M5193,-3887.76C5193,-3854.79 5193,-3803 5193,-3803 5193,-3803 4317.68,-3803 4317.68,-3803"/>
<polygon fill="black" stroke="black" points="4317.68,-3799.5 4307.68,-3803 4317.68,-3806.5 4317.68,-3799.5"/>
</g>
<!-- expert_agg_12&#45;&gt;residual2_12 -->
<g id="edge360" class="edge">
<title>expert_agg_12&#45;&gt;residual2_12</title>
<path fill="none" stroke="black" d="M4307.69,-3790C4623.09,-3790 5522.75,-3790 5522.75,-3790 5522.75,-3790 5522.75,-3729.11 5522.75,-3729.11"/>
<polygon fill="black" stroke="black" points="5526.25,-3729.11 5522.75,-3719.11 5519.25,-3729.11 5526.25,-3729.11"/>
</g>
<!-- transfer_12 -->
<g id="node253" class="node">
<title>transfer_12</title>
<ellipse fill="#fadbd8" stroke="black" cx="5615" cy="-3581.09" rx="152.06" ry="26.74"/>
<text text-anchor="middle" x="5615" y="-3584.89" font-family="Helvetica,sans-Serif" font-size="14.00">Transfer to GPU 12</text>
<text text-anchor="middle" x="5615" y="-3569.89" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual2_12&#45;&gt;transfer_12 -->
<g id="edge361" class="edge">
<title>residual2_12&#45;&gt;transfer_12</title>
<path fill="none" stroke="black" d="M5615,-3665.78C5615,-3665.78 5615,-3618.32 5615,-3618.32"/>
<polygon fill="black" stroke="black" points="5618.5,-3618.32 5615,-3608.32 5611.5,-3618.32 5618.5,-3618.32"/>
</g>
<!-- residual1_13 -->
<g id="node260" class="node">
<title>residual1_13</title>
<polygon fill="#fadbd8" stroke="black" points="5870.5,-3496.22 5655.5,-3496.22 5655.5,-3443.22 5870.5,-3443.22 5870.5,-3496.22"/>
<text text-anchor="middle" x="5763" y="-3481.02" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="5763" y="-3466.02" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 12</text>
<text text-anchor="middle" x="5763" y="-3451.02" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- transfer_12&#45;&gt;residual1_13 -->
<g id="edge367" class="edge">
<title>transfer_12&#45;&gt;residual1_13</title>
<path fill="none" stroke="black" d="M5711.26,-3560.14C5711.26,-3560.14 5711.26,-3506.49 5711.26,-3506.49"/>
<polygon fill="black" stroke="black" points="5714.76,-3506.49 5711.26,-3496.49 5707.76,-3506.49 5714.76,-3506.49"/>
</g>
<!-- ln1_13 -->
<g id="node254" class="node">
<title>ln1_13</title>
<polygon fill="#f8f9f9" stroke="black" points="6018.5,-4162.96 5803.5,-4162.96 5803.5,-4109.96 6018.5,-4109.96 6018.5,-4162.96"/>
<text text-anchor="middle" x="5911" y="-4147.76" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="5911" y="-4132.76" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 12</text>
<text text-anchor="middle" x="5911" y="-4117.76" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_qkv_13 -->
<g id="node255" class="node">
<title>attn_qkv_13</title>
<polygon fill="#ffe6cc" stroke="black" points="6026,-4051.96 5796,-4051.96 5796,-3998.96 6026,-3998.96 6026,-4051.96"/>
<text text-anchor="middle" x="5911" y="-4036.76" font-family="Helvetica,sans-Serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5911" y="-4021.76" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 12</text>
<text text-anchor="middle" x="5911" y="-4006.76" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 3*hidden_dim]</text>
</g>
<!-- ln1_13&#45;&gt;attn_qkv_13 -->
<g id="edge362" class="edge">
<title>ln1_13&#45;&gt;attn_qkv_13</title>
<path fill="none" stroke="black" d="M5911,-4109.87C5911,-4109.87 5911,-4062.22 5911,-4062.22"/>
<polygon fill="black" stroke="black" points="5914.5,-4062.22 5911,-4052.22 5907.5,-4062.22 5914.5,-4062.22"/>
</g>
<!-- attn_score_13 -->
<g id="node256" class="node">
<title>attn_score_13</title>
<polygon fill="#ffe6cc" stroke="black" points="6048.5,-3940.96 5773.5,-3940.96 5773.5,-3887.96 6048.5,-3887.96 6048.5,-3940.96"/>
<text text-anchor="middle" x="5911" y="-3925.76" font-family="Helvetica,sans-Serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="5911" y="-3910.76" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 12</text>
<text text-anchor="middle" x="5911" y="-3895.76" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_qkv_13&#45;&gt;attn_score_13 -->
<g id="edge363" class="edge">
<title>attn_qkv_13&#45;&gt;attn_score_13</title>
<path fill="none" stroke="black" d="M5911,-3998.87C5911,-3998.87 5911,-3951.22 5911,-3951.22"/>
<polygon fill="black" stroke="black" points="5914.5,-3951.22 5911,-3941.22 5907.5,-3951.22 5914.5,-3951.22"/>
</g>
<!-- attn_weight_13 -->
<g id="node257" class="node">
<title>attn_weight_13</title>
<polygon fill="#ffe6cc" stroke="black" points="6048.5,-3829.96 5773.5,-3829.96 5773.5,-3776.96 6048.5,-3776.96 6048.5,-3829.96"/>
<text text-anchor="middle" x="5911" y="-3814.76" font-family="Helvetica,sans-Serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="5911" y="-3799.76" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 12</text>
<text text-anchor="middle" x="5911" y="-3784.76" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_score_13&#45;&gt;attn_weight_13 -->
<g id="edge364" class="edge">
<title>attn_score_13&#45;&gt;attn_weight_13</title>
<path fill="none" stroke="black" d="M5911,-3887.87C5911,-3887.87 5911,-3840.22 5911,-3840.22"/>
<polygon fill="black" stroke="black" points="5914.5,-3840.22 5911,-3830.22 5907.5,-3840.22 5914.5,-3840.22"/>
</g>
<!-- attn_context_13 -->
<g id="node258" class="node">
<title>attn_context_13</title>
<polygon fill="#ffe6cc" stroke="black" points="6056,-3718.96 5766,-3718.96 5766,-3665.96 6056,-3665.96 6056,-3718.96"/>
<text text-anchor="middle" x="5911" y="-3703.76" font-family="Helvetica,sans-Serif" font-size="14.00">Context</text>
<text text-anchor="middle" x="5911" y="-3688.76" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 12</text>
<text text-anchor="middle" x="5911" y="-3673.76" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, head_dim]</text>
</g>
<!-- attn_weight_13&#45;&gt;attn_context_13 -->
<g id="edge365" class="edge">
<title>attn_weight_13&#45;&gt;attn_context_13</title>
<path fill="none" stroke="black" d="M5911,-3776.87C5911,-3776.87 5911,-3729.22 5911,-3729.22"/>
<polygon fill="black" stroke="black" points="5914.5,-3729.22 5911,-3719.22 5907.5,-3729.22 5914.5,-3729.22"/>
</g>
<!-- attn_out_13 -->
<g id="node259" class="node">
<title>attn_out_13</title>
<polygon fill="#ffe6cc" stroke="black" points="6018.5,-3607.59 5803.5,-3607.59 5803.5,-3554.59 6018.5,-3554.59 6018.5,-3607.59"/>
<text text-anchor="middle" x="5911" y="-3592.39" font-family="Helvetica,sans-Serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="5911" y="-3577.39" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 12</text>
<text text-anchor="middle" x="5911" y="-3562.39" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_context_13&#45;&gt;attn_out_13 -->
<g id="edge366" class="edge">
<title>attn_context_13&#45;&gt;attn_out_13</title>
<path fill="none" stroke="black" d="M5911,-3665.78C5911,-3665.78 5911,-3617.93 5911,-3617.93"/>
<polygon fill="black" stroke="black" points="5914.5,-3617.93 5911,-3607.93 5907.5,-3617.93 5914.5,-3617.93"/>
</g>
<!-- attn_out_13&#45;&gt;residual1_13 -->
<g id="edge368" class="edge">
<title>attn_out_13&#45;&gt;residual1_13</title>
<path fill="none" stroke="black" d="M5837,-3554.41C5837,-3554.41 5837,-3506.56 5837,-3506.56"/>
<polygon fill="black" stroke="black" points="5840.5,-3506.56 5837,-3496.56 5833.5,-3506.56 5840.5,-3506.56"/>
</g>
<!-- ln2_13 -->
<g id="node261" class="node">
<title>ln2_13</title>
<polygon fill="#f8f9f9" stroke="black" points="5789.5,-3385.22 5574.5,-3385.22 5574.5,-3332.22 5789.5,-3332.22 5789.5,-3385.22"/>
<text text-anchor="middle" x="5682" y="-3370.02" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;MoE)</text>
<text text-anchor="middle" x="5682" y="-3355.02" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 12</text>
<text text-anchor="middle" x="5682" y="-3340.02" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_13&#45;&gt;ln2_13 -->
<g id="edge369" class="edge">
<title>residual1_13&#45;&gt;ln2_13</title>
<path fill="none" stroke="black" d="M5722.5,-3443.13C5722.5,-3443.13 5722.5,-3395.48 5722.5,-3395.48"/>
<polygon fill="black" stroke="black" points="5726,-3395.48 5722.5,-3385.48 5719,-3395.48 5726,-3395.48"/>
</g>
<!-- residual2_13 -->
<g id="node273" class="node">
<title>residual2_13</title>
<polygon fill="#fadbd8" stroke="black" points="5900.5,-2830.22 5685.5,-2830.22 5685.5,-2777.22 5900.5,-2777.22 5900.5,-2830.22"/>
<text text-anchor="middle" x="5793" y="-2815.02" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="5793" y="-2800.02" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 12</text>
<text text-anchor="middle" x="5793" y="-2785.02" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_13&#45;&gt;residual2_13 -->
<g id="edge389" class="edge">
<title>residual1_13&#45;&gt;residual2_13</title>
<path fill="none" stroke="black" d="M5830,-3443.2C5830,-3443.2 5830,-2840.32 5830,-2840.32"/>
<polygon fill="black" stroke="black" points="5833.5,-2840.32 5830,-2830.32 5826.5,-2840.32 5833.5,-2840.32"/>
</g>
<!-- router_13 -->
<g id="node262" class="node">
<title>router_13</title>
<polygon fill="#f5b7b1" stroke="black" points="4984,-3274.22 4784,-3274.22 4784,-3221.22 4984,-3221.22 4984,-3274.22"/>
<text text-anchor="middle" x="4884" y="-3259.02" font-family="Helvetica,sans-Serif" font-size="14.00">Router Network</text>
<text text-anchor="middle" x="4884" y="-3244.02" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 12</text>
<text text-anchor="middle" x="4884" y="-3229.02" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 8 experts]</text>
</g>
<!-- ln2_13&#45;&gt;router_13 -->
<g id="edge370" class="edge">
<title>ln2_13&#45;&gt;router_13</title>
<path fill="none" stroke="black" d="M5645.25,-3331.96C5645.25,-3298.91 5645.25,-3247 5645.25,-3247 5645.25,-3247 4994.3,-3247 4994.3,-3247"/>
<polygon fill="black" stroke="black" points="4994.3,-3243.5 4984.3,-3247 4994.3,-3250.5 4994.3,-3243.5"/>
</g>
<!-- expert_agg_13 -->
<g id="node272" class="node">
<title>expert_agg_13</title>
<polygon fill="#d4e6f1" stroke="black" points="4485.5,-2941.22 4270.5,-2941.22 4270.5,-2888.22 4485.5,-2888.22 4485.5,-2941.22"/>
<text text-anchor="middle" x="4378" y="-2926.02" font-family="Helvetica,sans-Serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="4378" y="-2911.02" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 12</text>
<text text-anchor="middle" x="4378" y="-2896.02" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- ln2_13&#45;&gt;expert_agg_13 -->
<g id="edge388" class="edge">
<title>ln2_13&#45;&gt;expert_agg_13</title>
<path fill="none" stroke="black" d="M5574.46,-3358C5262.28,-3358 4378,-3358 4378,-3358 4378,-3358 4378,-2951.45 4378,-2951.45"/>
<polygon fill="black" stroke="black" points="4381.5,-2951.45 4378,-2941.45 4374.5,-2951.45 4381.5,-2951.45"/>
</g>
<!-- gate_13 -->
<g id="node263" class="node">
<title>gate_13</title>
<polygon fill="#f5b7b1" stroke="black" points="4223.5,-3163.22 4080.5,-3163.22 4080.5,-3110.22 4223.5,-3110.22 4223.5,-3163.22"/>
<text text-anchor="middle" x="4152" y="-3148.02" font-family="Helvetica,sans-Serif" font-size="14.00">Top&#45;2 Gating</text>
<text text-anchor="middle" x="4152" y="-3133.02" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 12</text>
<text text-anchor="middle" x="4152" y="-3118.02" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 2]</text>
</g>
<!-- router_13&#45;&gt;gate_13 -->
<g id="edge371" class="edge">
<title>router_13&#45;&gt;gate_13</title>
<path fill="none" stroke="black" d="M4798,-3221.06C4798,-3192.73 4798,-3152 4798,-3152 4798,-3152 4233.6,-3152 4233.6,-3152"/>
<polygon fill="black" stroke="black" points="4233.6,-3148.5 4223.6,-3152 4233.6,-3155.5 4233.6,-3148.5"/>
</g>
<!-- expert_13_0 -->
<g id="node264" class="node">
<title>expert_13_0</title>
<polygon fill="#e8daef" stroke="black" points="2552,-3052.22 2136,-3052.22 2136,-2999.22 2552,-2999.22 2552,-3052.22"/>
<text text-anchor="middle" x="2344" y="-3037.02" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="2344" y="-3022.02" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 12</text>
<text text-anchor="middle" x="2344" y="-3007.02" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_13&#45;&gt;expert_13_0 -->
<g id="edge372" class="edge">
<title>gate_13&#45;&gt;expert_13_0</title>
<path fill="none" stroke="black" d="M4080.47,-3152C3761.07,-3152 2481,-3152 2481,-3152 2481,-3152 2481,-3062.5 2481,-3062.5"/>
<polygon fill="black" stroke="black" points="2484.5,-3062.5 2481,-3052.5 2477.5,-3062.5 2484.5,-3062.5"/>
</g>
<!-- expert_13_1 -->
<g id="node265" class="node">
<title>expert_13_1</title>
<polygon fill="#e8daef" stroke="black" points="3004,-3052.22 2588,-3052.22 2588,-2999.22 3004,-2999.22 3004,-3052.22"/>
<text text-anchor="middle" x="2796" y="-3037.02" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="2796" y="-3022.02" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 12</text>
<text text-anchor="middle" x="2796" y="-3007.02" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_13&#45;&gt;expert_13_1 -->
<g id="edge374" class="edge">
<title>gate_13&#45;&gt;expert_13_1</title>
<path fill="none" stroke="black" d="M4080.3,-3142C3819,-3142 2933,-3142 2933,-3142 2933,-3142 2933,-3062.4 2933,-3062.4"/>
<polygon fill="black" stroke="black" points="2936.5,-3062.4 2933,-3052.4 2929.5,-3062.4 2936.5,-3062.4"/>
</g>
<!-- expert_13_2 -->
<g id="node266" class="node">
<title>expert_13_2</title>
<polygon fill="#e8daef" stroke="black" points="3456,-3052.22 3040,-3052.22 3040,-2999.22 3456,-2999.22 3456,-3052.22"/>
<text text-anchor="middle" x="3248" y="-3037.02" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="3248" y="-3022.02" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 12</text>
<text text-anchor="middle" x="3248" y="-3007.02" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_13&#45;&gt;expert_13_2 -->
<g id="edge376" class="edge">
<title>gate_13&#45;&gt;expert_13_2</title>
<path fill="none" stroke="black" d="M4080.19,-3131C3889.52,-3131 3385,-3131 3385,-3131 3385,-3131 3385,-3062.29 3385,-3062.29"/>
<polygon fill="black" stroke="black" points="3388.5,-3062.29 3385,-3052.29 3381.5,-3062.29 3388.5,-3062.29"/>
</g>
<!-- expert_13_3 -->
<g id="node267" class="node">
<title>expert_13_3</title>
<polygon fill="#e8daef" stroke="black" points="3908,-3052.22 3492,-3052.22 3492,-2999.22 3908,-2999.22 3908,-3052.22"/>
<text text-anchor="middle" x="3700" y="-3037.02" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="3700" y="-3022.02" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 12</text>
<text text-anchor="middle" x="3700" y="-3007.02" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_13&#45;&gt;expert_13_3 -->
<g id="edge378" class="edge">
<title>gate_13&#45;&gt;expert_13_3</title>
<path fill="none" stroke="black" d="M4080.13,-3120C3987.16,-3120 3837,-3120 3837,-3120 3837,-3120 3837,-3062.23 3837,-3062.23"/>
<polygon fill="black" stroke="black" points="3840.5,-3062.23 3837,-3052.23 3833.5,-3062.23 3840.5,-3062.23"/>
</g>
<!-- expert_13_4 -->
<g id="node268" class="node">
<title>expert_13_4</title>
<polygon fill="#e8daef" stroke="black" points="4360,-3052.22 3944,-3052.22 3944,-2999.22 4360,-2999.22 4360,-3052.22"/>
<text text-anchor="middle" x="4152" y="-3037.02" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="4152" y="-3022.02" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 12</text>
<text text-anchor="middle" x="4152" y="-3007.02" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_13&#45;&gt;expert_13_4 -->
<g id="edge380" class="edge">
<title>gate_13&#45;&gt;expert_13_4</title>
<path fill="none" stroke="black" d="M4152,-3110.13C4152,-3110.13 4152,-3062.48 4152,-3062.48"/>
<polygon fill="black" stroke="black" points="4155.5,-3062.48 4152,-3052.48 4148.5,-3062.48 4155.5,-3062.48"/>
</g>
<!-- expert_13_5 -->
<g id="node269" class="node">
<title>expert_13_5</title>
<polygon fill="#e8daef" stroke="black" points="4812,-3052.22 4396,-3052.22 4396,-2999.22 4812,-2999.22 4812,-3052.22"/>
<text text-anchor="middle" x="4604" y="-3037.02" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="4604" y="-3022.02" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 12</text>
<text text-anchor="middle" x="4604" y="-3007.02" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_13&#45;&gt;expert_13_5 -->
<g id="edge382" class="edge">
<title>gate_13&#45;&gt;expert_13_5</title>
<path fill="none" stroke="black" d="M4223.72,-3120C4329.51,-3120 4515,-3120 4515,-3120 4515,-3120 4515,-3062.23 4515,-3062.23"/>
<polygon fill="black" stroke="black" points="4518.5,-3062.23 4515,-3052.23 4511.5,-3062.23 4518.5,-3062.23"/>
</g>
<!-- expert_13_6 -->
<g id="node270" class="node">
<title>expert_13_6</title>
<polygon fill="#e8daef" stroke="black" points="5264,-3052.22 4848,-3052.22 4848,-2999.22 5264,-2999.22 5264,-3052.22"/>
<text text-anchor="middle" x="5056" y="-3037.02" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="5056" y="-3022.02" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 12</text>
<text text-anchor="middle" x="5056" y="-3007.02" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_13&#45;&gt;expert_13_6 -->
<g id="edge384" class="edge">
<title>gate_13&#45;&gt;expert_13_6</title>
<path fill="none" stroke="black" d="M4223.53,-3131C4413.46,-3131 4916,-3131 4916,-3131 4916,-3131 4916,-3062.29 4916,-3062.29"/>
<polygon fill="black" stroke="black" points="4919.5,-3062.29 4916,-3052.29 4912.5,-3062.29 4919.5,-3062.29"/>
</g>
<!-- expert_13_7 -->
<g id="node271" class="node">
<title>expert_13_7</title>
<polygon fill="#e8daef" stroke="black" points="5716,-3052.22 5300,-3052.22 5300,-2999.22 5716,-2999.22 5716,-3052.22"/>
<text text-anchor="middle" x="5508" y="-3037.02" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="5508" y="-3022.02" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 12</text>
<text text-anchor="middle" x="5508" y="-3007.02" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_13&#45;&gt;expert_13_7 -->
<g id="edge386" class="edge">
<title>gate_13&#45;&gt;expert_13_7</title>
<path fill="none" stroke="black" d="M4223.87,-3142C4486.84,-3142 5381.49,-3142 5381.49,-3142 5381.49,-3142 5381.49,-3062.4 5381.49,-3062.4"/>
<polygon fill="black" stroke="black" points="5384.99,-3062.4 5381.49,-3052.4 5377.99,-3062.4 5384.99,-3062.4"/>
</g>
<!-- expert_13_0&#45;&gt;expert_agg_13 -->
<g id="edge373" class="edge">
<title>expert_13_0&#45;&gt;expert_agg_13</title>
<path fill="none" stroke="black" d="M2433,-2998.95C2433,-2961.49 2433,-2898 2433,-2898 2433,-2898 4260.31,-2898 4260.31,-2898"/>
<polygon fill="black" stroke="black" points="4260.31,-2901.5 4270.31,-2898 4260.31,-2894.5 4260.31,-2901.5"/>
</g>
<!-- expert_13_1&#45;&gt;expert_agg_13 -->
<g id="edge375" class="edge">
<title>expert_13_1&#45;&gt;expert_agg_13</title>
<path fill="none" stroke="black" d="M2885,-2998.94C2885,-2964.48 2885,-2909 2885,-2909 2885,-2909 4260.33,-2909 4260.33,-2909"/>
<polygon fill="black" stroke="black" points="4260.33,-2912.5 4270.33,-2909 4260.33,-2905.5 4260.33,-2912.5"/>
</g>
<!-- expert_13_2&#45;&gt;expert_agg_13 -->
<g id="edge377" class="edge">
<title>expert_13_2&#45;&gt;expert_agg_13</title>
<path fill="none" stroke="black" d="M3337,-2999.04C3337,-2967.72 3337,-2920 3337,-2920 3337,-2920 4260.03,-2920 4260.03,-2920"/>
<polygon fill="black" stroke="black" points="4260.03,-2923.5 4270.03,-2920 4260.03,-2916.5 4260.03,-2923.5"/>
</g>
<!-- expert_13_3&#45;&gt;expert_agg_13 -->
<g id="edge379" class="edge">
<title>expert_13_3&#45;&gt;expert_agg_13</title>
<path fill="none" stroke="black" d="M3789,-2999.06C3789,-2970.73 3789,-2930 3789,-2930 3789,-2930 4260.31,-2930 4260.31,-2930"/>
<polygon fill="black" stroke="black" points="4260.31,-2933.5 4270.31,-2930 4260.31,-2926.5 4260.31,-2933.5"/>
</g>
<!-- expert_13_4&#45;&gt;expert_agg_13 -->
<g id="edge381" class="edge">
<title>expert_13_4&#45;&gt;expert_agg_13</title>
<path fill="none" stroke="black" d="M4315.25,-2999.13C4315.25,-2999.13 4315.25,-2951.48 4315.25,-2951.48"/>
<polygon fill="black" stroke="black" points="4318.75,-2951.48 4315.25,-2941.48 4311.75,-2951.48 4318.75,-2951.48"/>
</g>
<!-- expert_13_5&#45;&gt;expert_agg_13 -->
<g id="edge383" class="edge">
<title>expert_13_5&#45;&gt;expert_agg_13</title>
<path fill="none" stroke="black" d="M4440.75,-2999.13C4440.75,-2999.13 4440.75,-2951.48 4440.75,-2951.48"/>
<polygon fill="black" stroke="black" points="4444.25,-2951.48 4440.75,-2941.48 4437.25,-2951.48 4444.25,-2951.48"/>
</g>
<!-- expert_13_6&#45;&gt;expert_agg_13 -->
<g id="edge385" class="edge">
<title>expert_13_6&#45;&gt;expert_agg_13</title>
<path fill="none" stroke="black" d="M4905,-2999.01C4905,-2969.77 4905,-2927 4905,-2927 4905,-2927 4495.6,-2927 4495.6,-2927"/>
<polygon fill="black" stroke="black" points="4495.6,-2923.5 4485.6,-2927 4495.6,-2930.5 4495.6,-2923.5"/>
</g>
<!-- expert_13_7&#45;&gt;expert_agg_13 -->
<g id="edge387" class="edge">
<title>expert_13_7&#45;&gt;expert_agg_13</title>
<path fill="none" stroke="black" d="M5371,-2998.96C5371,-2965.91 5371,-2914 5371,-2914 5371,-2914 4495.68,-2914 4495.68,-2914"/>
<polygon fill="black" stroke="black" points="4495.68,-2910.5 4485.68,-2914 4495.68,-2917.5 4495.68,-2910.5"/>
</g>
<!-- expert_agg_13&#45;&gt;residual2_13 -->
<g id="edge390" class="edge">
<title>expert_agg_13&#45;&gt;residual2_13</title>
<path fill="none" stroke="black" d="M4485.69,-2901C4801.09,-2901 5700.75,-2901 5700.75,-2901 5700.75,-2901 5700.75,-2840.3 5700.75,-2840.3"/>
<polygon fill="black" stroke="black" points="5704.25,-2840.3 5700.75,-2830.3 5697.25,-2840.3 5704.25,-2840.3"/>
</g>
<!-- transfer_13 -->
<g id="node274" class="node">
<title>transfer_13</title>
<ellipse fill="#fadbd8" stroke="black" cx="5793" cy="-2692.35" rx="152.06" ry="26.74"/>
<text text-anchor="middle" x="5793" y="-2696.15" font-family="Helvetica,sans-Serif" font-size="14.00">Transfer to GPU 13</text>
<text text-anchor="middle" x="5793" y="-2681.15" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual2_13&#45;&gt;transfer_13 -->
<g id="edge391" class="edge">
<title>residual2_13&#45;&gt;transfer_13</title>
<path fill="none" stroke="black" d="M5793,-2777.04C5793,-2777.04 5793,-2729.58 5793,-2729.58"/>
<polygon fill="black" stroke="black" points="5796.5,-2729.58 5793,-2719.58 5789.5,-2729.58 5796.5,-2729.58"/>
</g>
<!-- residual1_14 -->
<g id="node281" class="node">
<title>residual1_14</title>
<polygon fill="#fadbd8" stroke="black" points="6048.5,-2607.48 5833.5,-2607.48 5833.5,-2554.48 6048.5,-2554.48 6048.5,-2607.48"/>
<text text-anchor="middle" x="5941" y="-2592.28" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="5941" y="-2577.28" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 13</text>
<text text-anchor="middle" x="5941" y="-2562.28" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- transfer_13&#45;&gt;residual1_14 -->
<g id="edge397" class="edge">
<title>transfer_13&#45;&gt;residual1_14</title>
<path fill="none" stroke="black" d="M5889.26,-2671.4C5889.26,-2671.4 5889.26,-2617.75 5889.26,-2617.75"/>
<polygon fill="black" stroke="black" points="5892.76,-2617.75 5889.26,-2607.75 5885.76,-2617.75 5892.76,-2617.75"/>
</g>
<!-- ln1_14 -->
<g id="node275" class="node">
<title>ln1_14</title>
<polygon fill="#f8f9f9" stroke="black" points="6196.5,-3274.22 5981.5,-3274.22 5981.5,-3221.22 6196.5,-3221.22 6196.5,-3274.22"/>
<text text-anchor="middle" x="6089" y="-3259.02" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="6089" y="-3244.02" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 13</text>
<text text-anchor="middle" x="6089" y="-3229.02" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_qkv_14 -->
<g id="node276" class="node">
<title>attn_qkv_14</title>
<polygon fill="#ffe6cc" stroke="black" points="6204,-3163.22 5974,-3163.22 5974,-3110.22 6204,-3110.22 6204,-3163.22"/>
<text text-anchor="middle" x="6089" y="-3148.02" font-family="Helvetica,sans-Serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="6089" y="-3133.02" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 13</text>
<text text-anchor="middle" x="6089" y="-3118.02" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 3*hidden_dim]</text>
</g>
<!-- ln1_14&#45;&gt;attn_qkv_14 -->
<g id="edge392" class="edge">
<title>ln1_14&#45;&gt;attn_qkv_14</title>
<path fill="none" stroke="black" d="M6089,-3221.13C6089,-3221.13 6089,-3173.48 6089,-3173.48"/>
<polygon fill="black" stroke="black" points="6092.5,-3173.48 6089,-3163.48 6085.5,-3173.48 6092.5,-3173.48"/>
</g>
<!-- attn_score_14 -->
<g id="node277" class="node">
<title>attn_score_14</title>
<polygon fill="#ffe6cc" stroke="black" points="6226.5,-3052.22 5951.5,-3052.22 5951.5,-2999.22 6226.5,-2999.22 6226.5,-3052.22"/>
<text text-anchor="middle" x="6089" y="-3037.02" font-family="Helvetica,sans-Serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="6089" y="-3022.02" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 13</text>
<text text-anchor="middle" x="6089" y="-3007.02" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_qkv_14&#45;&gt;attn_score_14 -->
<g id="edge393" class="edge">
<title>attn_qkv_14&#45;&gt;attn_score_14</title>
<path fill="none" stroke="black" d="M6089,-3110.13C6089,-3110.13 6089,-3062.48 6089,-3062.48"/>
<polygon fill="black" stroke="black" points="6092.5,-3062.48 6089,-3052.48 6085.5,-3062.48 6092.5,-3062.48"/>
</g>
<!-- attn_weight_14 -->
<g id="node278" class="node">
<title>attn_weight_14</title>
<polygon fill="#ffe6cc" stroke="black" points="6226.5,-2941.22 5951.5,-2941.22 5951.5,-2888.22 6226.5,-2888.22 6226.5,-2941.22"/>
<text text-anchor="middle" x="6089" y="-2926.02" font-family="Helvetica,sans-Serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="6089" y="-2911.02" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 13</text>
<text text-anchor="middle" x="6089" y="-2896.02" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_score_14&#45;&gt;attn_weight_14 -->
<g id="edge394" class="edge">
<title>attn_score_14&#45;&gt;attn_weight_14</title>
<path fill="none" stroke="black" d="M6089,-2999.13C6089,-2999.13 6089,-2951.48 6089,-2951.48"/>
<polygon fill="black" stroke="black" points="6092.5,-2951.48 6089,-2941.48 6085.5,-2951.48 6092.5,-2951.48"/>
</g>
<!-- attn_context_14 -->
<g id="node279" class="node">
<title>attn_context_14</title>
<polygon fill="#ffe6cc" stroke="black" points="6234,-2830.22 5944,-2830.22 5944,-2777.22 6234,-2777.22 6234,-2830.22"/>
<text text-anchor="middle" x="6089" y="-2815.02" font-family="Helvetica,sans-Serif" font-size="14.00">Context</text>
<text text-anchor="middle" x="6089" y="-2800.02" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 13</text>
<text text-anchor="middle" x="6089" y="-2785.02" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, head_dim]</text>
</g>
<!-- attn_weight_14&#45;&gt;attn_context_14 -->
<g id="edge395" class="edge">
<title>attn_weight_14&#45;&gt;attn_context_14</title>
<path fill="none" stroke="black" d="M6089,-2888.13C6089,-2888.13 6089,-2840.48 6089,-2840.48"/>
<polygon fill="black" stroke="black" points="6092.5,-2840.48 6089,-2830.48 6085.5,-2840.48 6092.5,-2840.48"/>
</g>
<!-- attn_out_14 -->
<g id="node280" class="node">
<title>attn_out_14</title>
<polygon fill="#ffe6cc" stroke="black" points="6196.5,-2718.85 5981.5,-2718.85 5981.5,-2665.85 6196.5,-2665.85 6196.5,-2718.85"/>
<text text-anchor="middle" x="6089" y="-2703.65" font-family="Helvetica,sans-Serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="6089" y="-2688.65" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 13</text>
<text text-anchor="middle" x="6089" y="-2673.65" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_context_14&#45;&gt;attn_out_14 -->
<g id="edge396" class="edge">
<title>attn_context_14&#45;&gt;attn_out_14</title>
<path fill="none" stroke="black" d="M6089,-2777.04C6089,-2777.04 6089,-2729.19 6089,-2729.19"/>
<polygon fill="black" stroke="black" points="6092.5,-2729.19 6089,-2719.19 6085.5,-2729.19 6092.5,-2729.19"/>
</g>
<!-- attn_out_14&#45;&gt;residual1_14 -->
<g id="edge398" class="edge">
<title>attn_out_14&#45;&gt;residual1_14</title>
<path fill="none" stroke="black" d="M6015,-2665.67C6015,-2665.67 6015,-2617.82 6015,-2617.82"/>
<polygon fill="black" stroke="black" points="6018.5,-2617.82 6015,-2607.82 6011.5,-2617.82 6018.5,-2617.82"/>
</g>
<!-- ln2_14 -->
<g id="node282" class="node">
<title>ln2_14</title>
<polygon fill="#f8f9f9" stroke="black" points="5967.5,-2496.48 5752.5,-2496.48 5752.5,-2443.48 5967.5,-2443.48 5967.5,-2496.48"/>
<text text-anchor="middle" x="5860" y="-2481.28" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;MoE)</text>
<text text-anchor="middle" x="5860" y="-2466.28" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 13</text>
<text text-anchor="middle" x="5860" y="-2451.28" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_14&#45;&gt;ln2_14 -->
<g id="edge399" class="edge">
<title>residual1_14&#45;&gt;ln2_14</title>
<path fill="none" stroke="black" d="M5900.5,-2554.39C5900.5,-2554.39 5900.5,-2506.74 5900.5,-2506.74"/>
<polygon fill="black" stroke="black" points="5904,-2506.74 5900.5,-2496.74 5897,-2506.74 5904,-2506.74"/>
</g>
<!-- residual2_14 -->
<g id="node294" class="node">
<title>residual2_14</title>
<polygon fill="#fadbd8" stroke="black" points="6078.5,-1941.48 5863.5,-1941.48 5863.5,-1888.48 6078.5,-1888.48 6078.5,-1941.48"/>
<text text-anchor="middle" x="5971" y="-1926.28" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="5971" y="-1911.28" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 13</text>
<text text-anchor="middle" x="5971" y="-1896.28" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_14&#45;&gt;residual2_14 -->
<g id="edge419" class="edge">
<title>residual1_14&#45;&gt;residual2_14</title>
<path fill="none" stroke="black" d="M6008,-2554.46C6008,-2554.46 6008,-1951.57 6008,-1951.57"/>
<polygon fill="black" stroke="black" points="6011.5,-1951.57 6008,-1941.57 6004.5,-1951.58 6011.5,-1951.57"/>
</g>
<!-- router_14 -->
<g id="node283" class="node">
<title>router_14</title>
<polygon fill="#f5b7b1" stroke="black" points="5162,-2385.48 4962,-2385.48 4962,-2332.48 5162,-2332.48 5162,-2385.48"/>
<text text-anchor="middle" x="5062" y="-2370.28" font-family="Helvetica,sans-Serif" font-size="14.00">Router Network</text>
<text text-anchor="middle" x="5062" y="-2355.28" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 13</text>
<text text-anchor="middle" x="5062" y="-2340.28" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 8 experts]</text>
</g>
<!-- ln2_14&#45;&gt;router_14 -->
<g id="edge400" class="edge">
<title>ln2_14&#45;&gt;router_14</title>
<path fill="none" stroke="black" d="M5823.25,-2443.44C5823.25,-2410.33 5823.25,-2358 5823.25,-2358 5823.25,-2358 5172.3,-2358 5172.3,-2358"/>
<polygon fill="black" stroke="black" points="5172.3,-2354.5 5162.3,-2358 5172.3,-2361.5 5172.3,-2354.5"/>
</g>
<!-- expert_agg_14 -->
<g id="node293" class="node">
<title>expert_agg_14</title>
<polygon fill="#d4e6f1" stroke="black" points="4663.5,-2052.48 4448.5,-2052.48 4448.5,-1999.48 4663.5,-1999.48 4663.5,-2052.48"/>
<text text-anchor="middle" x="4556" y="-2037.28" font-family="Helvetica,sans-Serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="4556" y="-2022.28" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 13</text>
<text text-anchor="middle" x="4556" y="-2007.28" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- ln2_14&#45;&gt;expert_agg_14 -->
<g id="edge418" class="edge">
<title>ln2_14&#45;&gt;expert_agg_14</title>
<path fill="none" stroke="black" d="M5752.46,-2469C5440.28,-2469 4556,-2469 4556,-2469 4556,-2469 4556,-2062.7 4556,-2062.7"/>
<polygon fill="black" stroke="black" points="4559.5,-2062.7 4556,-2052.7 4552.5,-2062.7 4559.5,-2062.7"/>
</g>
<!-- gate_14 -->
<g id="node284" class="node">
<title>gate_14</title>
<polygon fill="#f5b7b1" stroke="black" points="4401.5,-2274.48 4258.5,-2274.48 4258.5,-2221.48 4401.5,-2221.48 4401.5,-2274.48"/>
<text text-anchor="middle" x="4330" y="-2259.28" font-family="Helvetica,sans-Serif" font-size="14.00">Top&#45;2 Gating</text>
<text text-anchor="middle" x="4330" y="-2244.28" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 13</text>
<text text-anchor="middle" x="4330" y="-2229.28" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 2]</text>
</g>
<!-- router_14&#45;&gt;gate_14 -->
<g id="edge401" class="edge">
<title>router_14&#45;&gt;gate_14</title>
<path fill="none" stroke="black" d="M4976,-2332.24C4976,-2303.84 4976,-2263 4976,-2263 4976,-2263 4411.6,-2263 4411.6,-2263"/>
<polygon fill="black" stroke="black" points="4411.6,-2259.5 4401.6,-2263 4411.6,-2266.5 4411.6,-2259.5"/>
</g>
<!-- expert_14_0 -->
<g id="node285" class="node">
<title>expert_14_0</title>
<polygon fill="#e8daef" stroke="black" points="2730,-2163.48 2314,-2163.48 2314,-2110.48 2730,-2110.48 2730,-2163.48"/>
<text text-anchor="middle" x="2522" y="-2148.28" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="2522" y="-2133.28" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 13</text>
<text text-anchor="middle" x="2522" y="-2118.28" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_14&#45;&gt;expert_14_0 -->
<g id="edge402" class="edge">
<title>gate_14&#45;&gt;expert_14_0</title>
<path fill="none" stroke="black" d="M4258.47,-2263C3939.07,-2263 2659,-2263 2659,-2263 2659,-2263 2659,-2173.71 2659,-2173.71"/>
<polygon fill="black" stroke="black" points="2662.5,-2173.71 2659,-2163.71 2655.5,-2173.71 2662.5,-2173.71"/>
</g>
<!-- expert_14_1 -->
<g id="node286" class="node">
<title>expert_14_1</title>
<polygon fill="#e8daef" stroke="black" points="3182,-2163.48 2766,-2163.48 2766,-2110.48 3182,-2110.48 3182,-2163.48"/>
<text text-anchor="middle" x="2974" y="-2148.28" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="2974" y="-2133.28" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 13</text>
<text text-anchor="middle" x="2974" y="-2118.28" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_14&#45;&gt;expert_14_1 -->
<g id="edge404" class="edge">
<title>gate_14&#45;&gt;expert_14_1</title>
<path fill="none" stroke="black" d="M4258.3,-2253C3997,-2253 3111,-2253 3111,-2253 3111,-2253 3111,-2173.6 3111,-2173.6"/>
<polygon fill="black" stroke="black" points="3114.5,-2173.6 3111,-2163.6 3107.5,-2173.6 3114.5,-2173.6"/>
</g>
<!-- expert_14_2 -->
<g id="node287" class="node">
<title>expert_14_2</title>
<polygon fill="#e8daef" stroke="black" points="3634,-2163.48 3218,-2163.48 3218,-2110.48 3634,-2110.48 3634,-2163.48"/>
<text text-anchor="middle" x="3426" y="-2148.28" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="3426" y="-2133.28" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 13</text>
<text text-anchor="middle" x="3426" y="-2118.28" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_14&#45;&gt;expert_14_2 -->
<g id="edge406" class="edge">
<title>gate_14&#45;&gt;expert_14_2</title>
<path fill="none" stroke="black" d="M4258.19,-2242C4067.52,-2242 3563,-2242 3563,-2242 3563,-2242 3563,-2173.48 3563,-2173.48"/>
<polygon fill="black" stroke="black" points="3566.5,-2173.48 3563,-2163.48 3559.5,-2173.48 3566.5,-2173.48"/>
</g>
<!-- expert_14_3 -->
<g id="node288" class="node">
<title>expert_14_3</title>
<polygon fill="#e8daef" stroke="black" points="4086,-2163.48 3670,-2163.48 3670,-2110.48 4086,-2110.48 4086,-2163.48"/>
<text text-anchor="middle" x="3878" y="-2148.28" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="3878" y="-2133.28" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 13</text>
<text text-anchor="middle" x="3878" y="-2118.28" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_14&#45;&gt;expert_14_3 -->
<g id="edge408" class="edge">
<title>gate_14&#45;&gt;expert_14_3</title>
<path fill="none" stroke="black" d="M4258.13,-2232C4165.16,-2232 4015,-2232 4015,-2232 4015,-2232 4015,-2173.7 4015,-2173.7"/>
<polygon fill="black" stroke="black" points="4018.5,-2173.7 4015,-2163.7 4011.5,-2173.7 4018.5,-2173.7"/>
</g>
<!-- expert_14_4 -->
<g id="node289" class="node">
<title>expert_14_4</title>
<polygon fill="#e8daef" stroke="black" points="4538,-2163.48 4122,-2163.48 4122,-2110.48 4538,-2110.48 4538,-2163.48"/>
<text text-anchor="middle" x="4330" y="-2148.28" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="4330" y="-2133.28" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 13</text>
<text text-anchor="middle" x="4330" y="-2118.28" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_14&#45;&gt;expert_14_4 -->
<g id="edge410" class="edge">
<title>gate_14&#45;&gt;expert_14_4</title>
<path fill="none" stroke="black" d="M4330,-2221.39C4330,-2221.39 4330,-2173.74 4330,-2173.74"/>
<polygon fill="black" stroke="black" points="4333.5,-2173.74 4330,-2163.74 4326.5,-2173.74 4333.5,-2173.74"/>
</g>
<!-- expert_14_5 -->
<g id="node290" class="node">
<title>expert_14_5</title>
<polygon fill="#e8daef" stroke="black" points="4990,-2163.48 4574,-2163.48 4574,-2110.48 4990,-2110.48 4990,-2163.48"/>
<text text-anchor="middle" x="4782" y="-2148.28" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="4782" y="-2133.28" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 13</text>
<text text-anchor="middle" x="4782" y="-2118.28" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_14&#45;&gt;expert_14_5 -->
<g id="edge412" class="edge">
<title>gate_14&#45;&gt;expert_14_5</title>
<path fill="none" stroke="black" d="M4401.72,-2232C4507.51,-2232 4693,-2232 4693,-2232 4693,-2232 4693,-2173.7 4693,-2173.7"/>
<polygon fill="black" stroke="black" points="4696.5,-2173.7 4693,-2163.7 4689.5,-2173.7 4696.5,-2173.7"/>
</g>
<!-- expert_14_6 -->
<g id="node291" class="node">
<title>expert_14_6</title>
<polygon fill="#e8daef" stroke="black" points="5442,-2163.48 5026,-2163.48 5026,-2110.48 5442,-2110.48 5442,-2163.48"/>
<text text-anchor="middle" x="5234" y="-2148.28" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="5234" y="-2133.28" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 13</text>
<text text-anchor="middle" x="5234" y="-2118.28" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_14&#45;&gt;expert_14_6 -->
<g id="edge414" class="edge">
<title>gate_14&#45;&gt;expert_14_6</title>
<path fill="none" stroke="black" d="M4401.53,-2242C4591.46,-2242 5094,-2242 5094,-2242 5094,-2242 5094,-2173.48 5094,-2173.48"/>
<polygon fill="black" stroke="black" points="5097.5,-2173.48 5094,-2163.48 5090.5,-2173.48 5097.5,-2173.48"/>
</g>
<!-- expert_14_7 -->
<g id="node292" class="node">
<title>expert_14_7</title>
<polygon fill="#e8daef" stroke="black" points="5894,-2163.48 5478,-2163.48 5478,-2110.48 5894,-2110.48 5894,-2163.48"/>
<text text-anchor="middle" x="5686" y="-2148.28" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="5686" y="-2133.28" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 13</text>
<text text-anchor="middle" x="5686" y="-2118.28" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_14&#45;&gt;expert_14_7 -->
<g id="edge416" class="edge">
<title>gate_14&#45;&gt;expert_14_7</title>
<path fill="none" stroke="black" d="M4401.87,-2253C4664.84,-2253 5559.49,-2253 5559.49,-2253 5559.49,-2253 5559.49,-2173.6 5559.49,-2173.6"/>
<polygon fill="black" stroke="black" points="5562.99,-2173.6 5559.49,-2163.6 5555.99,-2173.6 5562.99,-2173.6"/>
</g>
<!-- expert_14_0&#45;&gt;expert_agg_14 -->
<g id="edge403" class="edge">
<title>expert_14_0&#45;&gt;expert_agg_14</title>
<path fill="none" stroke="black" d="M2611,-2110.36C2611,-2073.13 2611,-2010 2611,-2010 2611,-2010 4438.31,-2010 4438.31,-2010"/>
<polygon fill="black" stroke="black" points="4438.31,-2013.5 4448.31,-2010 4438.31,-2006.5 4438.31,-2013.5"/>
</g>
<!-- expert_14_1&#45;&gt;expert_agg_14 -->
<g id="edge405" class="edge">
<title>expert_14_1&#45;&gt;expert_agg_14</title>
<path fill="none" stroke="black" d="M3063,-2110.44C3063,-2075.92 3063,-2020 3063,-2020 3063,-2020 4438.33,-2020 4438.33,-2020"/>
<polygon fill="black" stroke="black" points="4438.33,-2023.5 4448.33,-2020 4438.33,-2016.5 4438.33,-2023.5"/>
</g>
<!-- expert_14_2&#45;&gt;expert_agg_14 -->
<g id="edge407" class="edge">
<title>expert_14_2&#45;&gt;expert_agg_14</title>
<path fill="none" stroke="black" d="M3515,-2110.24C3515,-2078.84 3515,-2031 3515,-2031 3515,-2031 4438.03,-2031 4438.03,-2031"/>
<polygon fill="black" stroke="black" points="4438.03,-2034.5 4448.03,-2031 4438.03,-2027.5 4438.03,-2034.5"/>
</g>
<!-- expert_14_3&#45;&gt;expert_agg_14 -->
<g id="edge409" class="edge">
<title>expert_14_3&#45;&gt;expert_agg_14</title>
<path fill="none" stroke="black" d="M3967,-2110.24C3967,-2081.84 3967,-2041 3967,-2041 3967,-2041 4438.31,-2041 4438.31,-2041"/>
<polygon fill="black" stroke="black" points="4438.31,-2044.5 4448.31,-2041 4438.31,-2037.5 4438.31,-2044.5"/>
</g>
<!-- expert_14_4&#45;&gt;expert_agg_14 -->
<g id="edge411" class="edge">
<title>expert_14_4&#45;&gt;expert_agg_14</title>
<path fill="none" stroke="black" d="M4493.25,-2110.39C4493.25,-2110.39 4493.25,-2062.74 4493.25,-2062.74"/>
<polygon fill="black" stroke="black" points="4496.75,-2062.74 4493.25,-2052.74 4489.75,-2062.74 4496.75,-2062.74"/>
</g>
<!-- expert_14_5&#45;&gt;expert_agg_14 -->
<g id="edge413" class="edge">
<title>expert_14_5&#45;&gt;expert_agg_14</title>
<path fill="none" stroke="black" d="M4618.75,-2110.39C4618.75,-2110.39 4618.75,-2062.74 4618.75,-2062.74"/>
<polygon fill="black" stroke="black" points="4622.25,-2062.74 4618.75,-2052.74 4615.25,-2062.74 4622.25,-2062.74"/>
</g>
<!-- expert_14_6&#45;&gt;expert_agg_14 -->
<g id="edge415" class="edge">
<title>expert_14_6&#45;&gt;expert_agg_14</title>
<path fill="none" stroke="black" d="M5083,-2110.47C5083,-2081.45 5083,-2039 5083,-2039 5083,-2039 4673.6,-2039 4673.6,-2039"/>
<polygon fill="black" stroke="black" points="4673.6,-2035.5 4663.6,-2039 4673.6,-2042.5 4673.6,-2035.5"/>
</g>
<!-- expert_14_7&#45;&gt;expert_agg_14 -->
<g id="edge417" class="edge">
<title>expert_14_7&#45;&gt;expert_agg_14</title>
<path fill="none" stroke="black" d="M5549,-2110.44C5549,-2077.33 5549,-2025 5549,-2025 5549,-2025 4673.68,-2025 4673.68,-2025"/>
<polygon fill="black" stroke="black" points="4673.68,-2021.5 4663.68,-2025 4673.68,-2028.5 4673.68,-2021.5"/>
</g>
<!-- expert_agg_14&#45;&gt;residual2_14 -->
<g id="edge420" class="edge">
<title>expert_agg_14&#45;&gt;residual2_14</title>
<path fill="none" stroke="black" d="M4663.69,-2012C4979.09,-2012 5878.75,-2012 5878.75,-2012 5878.75,-2012 5878.75,-1951.49 5878.75,-1951.49"/>
<polygon fill="black" stroke="black" points="5882.25,-1951.49 5878.75,-1941.49 5875.25,-1951.49 5882.25,-1951.49"/>
</g>
<!-- transfer_14 -->
<g id="node295" class="node">
<title>transfer_14</title>
<ellipse fill="#fadbd8" stroke="black" cx="5971" cy="-1803.61" rx="152.06" ry="26.74"/>
<text text-anchor="middle" x="5971" y="-1807.41" font-family="Helvetica,sans-Serif" font-size="14.00">Transfer to GPU 14</text>
<text text-anchor="middle" x="5971" y="-1792.41" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual2_14&#45;&gt;transfer_14 -->
<g id="edge421" class="edge">
<title>residual2_14&#45;&gt;transfer_14</title>
<path fill="none" stroke="black" d="M5971,-1888.3C5971,-1888.3 5971,-1840.84 5971,-1840.84"/>
<polygon fill="black" stroke="black" points="5974.5,-1840.84 5971,-1830.84 5967.5,-1840.84 5974.5,-1840.84"/>
</g>
<!-- residual1_15 -->
<g id="node302" class="node">
<title>residual1_15</title>
<polygon fill="#fadbd8" stroke="black" points="6226.5,-1718.74 6011.5,-1718.74 6011.5,-1665.74 6226.5,-1665.74 6226.5,-1718.74"/>
<text text-anchor="middle" x="6119" y="-1703.54" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="6119" y="-1688.54" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 14</text>
<text text-anchor="middle" x="6119" y="-1673.54" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- transfer_14&#45;&gt;residual1_15 -->
<g id="edge427" class="edge">
<title>transfer_14&#45;&gt;residual1_15</title>
<path fill="none" stroke="black" d="M6067.26,-1782.66C6067.26,-1782.66 6067.26,-1729.01 6067.26,-1729.01"/>
<polygon fill="black" stroke="black" points="6070.76,-1729.01 6067.26,-1719.01 6063.76,-1729.01 6070.76,-1729.01"/>
</g>
<!-- ln1_15 -->
<g id="node296" class="node">
<title>ln1_15</title>
<polygon fill="#f8f9f9" stroke="black" points="6374.5,-2385.48 6159.5,-2385.48 6159.5,-2332.48 6374.5,-2332.48 6374.5,-2385.48"/>
<text text-anchor="middle" x="6267" y="-2370.28" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="6267" y="-2355.28" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 14</text>
<text text-anchor="middle" x="6267" y="-2340.28" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_qkv_15 -->
<g id="node297" class="node">
<title>attn_qkv_15</title>
<polygon fill="#ffe6cc" stroke="black" points="6382,-2274.48 6152,-2274.48 6152,-2221.48 6382,-2221.48 6382,-2274.48"/>
<text text-anchor="middle" x="6267" y="-2259.28" font-family="Helvetica,sans-Serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="6267" y="-2244.28" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 14</text>
<text text-anchor="middle" x="6267" y="-2229.28" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 3*hidden_dim]</text>
</g>
<!-- ln1_15&#45;&gt;attn_qkv_15 -->
<g id="edge422" class="edge">
<title>ln1_15&#45;&gt;attn_qkv_15</title>
<path fill="none" stroke="black" d="M6267,-2332.39C6267,-2332.39 6267,-2284.74 6267,-2284.74"/>
<polygon fill="black" stroke="black" points="6270.5,-2284.74 6267,-2274.74 6263.5,-2284.74 6270.5,-2284.74"/>
</g>
<!-- attn_score_15 -->
<g id="node298" class="node">
<title>attn_score_15</title>
<polygon fill="#ffe6cc" stroke="black" points="6404.5,-2163.48 6129.5,-2163.48 6129.5,-2110.48 6404.5,-2110.48 6404.5,-2163.48"/>
<text text-anchor="middle" x="6267" y="-2148.28" font-family="Helvetica,sans-Serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="6267" y="-2133.28" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 14</text>
<text text-anchor="middle" x="6267" y="-2118.28" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_qkv_15&#45;&gt;attn_score_15 -->
<g id="edge423" class="edge">
<title>attn_qkv_15&#45;&gt;attn_score_15</title>
<path fill="none" stroke="black" d="M6267,-2221.39C6267,-2221.39 6267,-2173.74 6267,-2173.74"/>
<polygon fill="black" stroke="black" points="6270.5,-2173.74 6267,-2163.74 6263.5,-2173.74 6270.5,-2173.74"/>
</g>
<!-- attn_weight_15 -->
<g id="node299" class="node">
<title>attn_weight_15</title>
<polygon fill="#ffe6cc" stroke="black" points="6404.5,-2052.48 6129.5,-2052.48 6129.5,-1999.48 6404.5,-1999.48 6404.5,-2052.48"/>
<text text-anchor="middle" x="6267" y="-2037.28" font-family="Helvetica,sans-Serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="6267" y="-2022.28" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 14</text>
<text text-anchor="middle" x="6267" y="-2007.28" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_score_15&#45;&gt;attn_weight_15 -->
<g id="edge424" class="edge">
<title>attn_score_15&#45;&gt;attn_weight_15</title>
<path fill="none" stroke="black" d="M6267,-2110.39C6267,-2110.39 6267,-2062.74 6267,-2062.74"/>
<polygon fill="black" stroke="black" points="6270.5,-2062.74 6267,-2052.74 6263.5,-2062.74 6270.5,-2062.74"/>
</g>
<!-- attn_context_15 -->
<g id="node300" class="node">
<title>attn_context_15</title>
<polygon fill="#ffe6cc" stroke="black" points="6412,-1941.48 6122,-1941.48 6122,-1888.48 6412,-1888.48 6412,-1941.48"/>
<text text-anchor="middle" x="6267" y="-1926.28" font-family="Helvetica,sans-Serif" font-size="14.00">Context</text>
<text text-anchor="middle" x="6267" y="-1911.28" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 14</text>
<text text-anchor="middle" x="6267" y="-1896.28" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, head_dim]</text>
</g>
<!-- attn_weight_15&#45;&gt;attn_context_15 -->
<g id="edge425" class="edge">
<title>attn_weight_15&#45;&gt;attn_context_15</title>
<path fill="none" stroke="black" d="M6267,-1999.39C6267,-1999.39 6267,-1951.74 6267,-1951.74"/>
<polygon fill="black" stroke="black" points="6270.5,-1951.74 6267,-1941.74 6263.5,-1951.74 6270.5,-1951.74"/>
</g>
<!-- attn_out_15 -->
<g id="node301" class="node">
<title>attn_out_15</title>
<polygon fill="#ffe6cc" stroke="black" points="6374.5,-1830.11 6159.5,-1830.11 6159.5,-1777.11 6374.5,-1777.11 6374.5,-1830.11"/>
<text text-anchor="middle" x="6267" y="-1814.91" font-family="Helvetica,sans-Serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="6267" y="-1799.91" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 14</text>
<text text-anchor="middle" x="6267" y="-1784.91" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_context_15&#45;&gt;attn_out_15 -->
<g id="edge426" class="edge">
<title>attn_context_15&#45;&gt;attn_out_15</title>
<path fill="none" stroke="black" d="M6267,-1888.3C6267,-1888.3 6267,-1840.45 6267,-1840.45"/>
<polygon fill="black" stroke="black" points="6270.5,-1840.45 6267,-1830.45 6263.5,-1840.45 6270.5,-1840.45"/>
</g>
<!-- attn_out_15&#45;&gt;residual1_15 -->
<g id="edge428" class="edge">
<title>attn_out_15&#45;&gt;residual1_15</title>
<path fill="none" stroke="black" d="M6193,-1776.93C6193,-1776.93 6193,-1729.08 6193,-1729.08"/>
<polygon fill="black" stroke="black" points="6196.5,-1729.08 6193,-1719.08 6189.5,-1729.08 6196.5,-1729.08"/>
</g>
<!-- ln2_15 -->
<g id="node303" class="node">
<title>ln2_15</title>
<polygon fill="#f8f9f9" stroke="black" points="6145.5,-1607.74 5930.5,-1607.74 5930.5,-1554.74 6145.5,-1554.74 6145.5,-1607.74"/>
<text text-anchor="middle" x="6038" y="-1592.54" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;MoE)</text>
<text text-anchor="middle" x="6038" y="-1577.54" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 14</text>
<text text-anchor="middle" x="6038" y="-1562.54" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_15&#45;&gt;ln2_15 -->
<g id="edge429" class="edge">
<title>residual1_15&#45;&gt;ln2_15</title>
<path fill="none" stroke="black" d="M6078.5,-1665.65C6078.5,-1665.65 6078.5,-1618 6078.5,-1618"/>
<polygon fill="black" stroke="black" points="6082,-1618 6078.5,-1608 6075,-1618 6082,-1618"/>
</g>
<!-- residual2_15 -->
<g id="node315" class="node">
<title>residual2_15</title>
<polygon fill="#fadbd8" stroke="black" points="6256.5,-1052.74 6041.5,-1052.74 6041.5,-999.74 6256.5,-999.74 6256.5,-1052.74"/>
<text text-anchor="middle" x="6149" y="-1037.54" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="6149" y="-1022.54" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 14</text>
<text text-anchor="middle" x="6149" y="-1007.54" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_15&#45;&gt;residual2_15 -->
<g id="edge449" class="edge">
<title>residual1_15&#45;&gt;residual2_15</title>
<path fill="none" stroke="black" d="M6186,-1665.72C6186,-1665.72 6186,-1062.83 6186,-1062.83"/>
<polygon fill="black" stroke="black" points="6189.5,-1062.83 6186,-1052.83 6182.5,-1062.83 6189.5,-1062.83"/>
</g>
<!-- router_15 -->
<g id="node304" class="node">
<title>router_15</title>
<polygon fill="#f5b7b1" stroke="black" points="5340,-1496.74 5140,-1496.74 5140,-1443.74 5340,-1443.74 5340,-1496.74"/>
<text text-anchor="middle" x="5240" y="-1481.54" font-family="Helvetica,sans-Serif" font-size="14.00">Router Network</text>
<text text-anchor="middle" x="5240" y="-1466.54" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 14</text>
<text text-anchor="middle" x="5240" y="-1451.54" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 8 experts]</text>
</g>
<!-- ln2_15&#45;&gt;router_15 -->
<g id="edge430" class="edge">
<title>ln2_15&#45;&gt;router_15</title>
<path fill="none" stroke="black" d="M6001.25,-1554.6C6001.25,-1521.69 6001.25,-1470 6001.25,-1470 6001.25,-1470 5350.3,-1470 5350.3,-1470"/>
<polygon fill="black" stroke="black" points="5350.3,-1466.5 5340.3,-1470 5350.3,-1473.5 5350.3,-1466.5"/>
</g>
<!-- expert_agg_15 -->
<g id="node314" class="node">
<title>expert_agg_15</title>
<polygon fill="#d4e6f1" stroke="black" points="4841.5,-1163.74 4626.5,-1163.74 4626.5,-1110.74 4841.5,-1110.74 4841.5,-1163.74"/>
<text text-anchor="middle" x="4734" y="-1148.54" font-family="Helvetica,sans-Serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="4734" y="-1133.54" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 14</text>
<text text-anchor="middle" x="4734" y="-1118.54" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- ln2_15&#45;&gt;expert_agg_15 -->
<g id="edge448" class="edge">
<title>ln2_15&#45;&gt;expert_agg_15</title>
<path fill="none" stroke="black" d="M5930.46,-1581C5618.28,-1581 4734,-1581 4734,-1581 4734,-1581 4734,-1174 4734,-1174"/>
<polygon fill="black" stroke="black" points="4737.5,-1174 4734,-1164 4730.5,-1174 4737.5,-1174"/>
</g>
<!-- gate_15 -->
<g id="node305" class="node">
<title>gate_15</title>
<polygon fill="#f5b7b1" stroke="black" points="4579.5,-1385.74 4436.5,-1385.74 4436.5,-1332.74 4579.5,-1332.74 4579.5,-1385.74"/>
<text text-anchor="middle" x="4508" y="-1370.54" font-family="Helvetica,sans-Serif" font-size="14.00">Top&#45;2 Gating</text>
<text text-anchor="middle" x="4508" y="-1355.54" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 14</text>
<text text-anchor="middle" x="4508" y="-1340.54" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 2]</text>
</g>
<!-- router_15&#45;&gt;gate_15 -->
<g id="edge431" class="edge">
<title>router_15&#45;&gt;gate_15</title>
<path fill="none" stroke="black" d="M5154,-1443.71C5154,-1415.53 5154,-1375 5154,-1375 5154,-1375 4589.6,-1375 4589.6,-1375"/>
<polygon fill="black" stroke="black" points="4589.6,-1371.5 4579.6,-1375 4589.6,-1378.5 4589.6,-1371.5"/>
</g>
<!-- expert_15_0 -->
<g id="node306" class="node">
<title>expert_15_0</title>
<polygon fill="#e8daef" stroke="black" points="2908,-1274.74 2492,-1274.74 2492,-1221.74 2908,-1221.74 2908,-1274.74"/>
<text text-anchor="middle" x="2700" y="-1259.54" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="2700" y="-1244.54" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 14</text>
<text text-anchor="middle" x="2700" y="-1229.54" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_15&#45;&gt;expert_15_0 -->
<g id="edge432" class="edge">
<title>gate_15&#45;&gt;expert_15_0</title>
<path fill="none" stroke="black" d="M4436.47,-1375C4117.07,-1375 2837,-1375 2837,-1375 2837,-1375 2837,-1284.81 2837,-1284.81"/>
<polygon fill="black" stroke="black" points="2840.5,-1284.81 2837,-1274.81 2833.5,-1284.81 2840.5,-1284.81"/>
</g>
<!-- expert_15_1 -->
<g id="node307" class="node">
<title>expert_15_1</title>
<polygon fill="#e8daef" stroke="black" points="3360,-1274.74 2944,-1274.74 2944,-1221.74 3360,-1221.74 3360,-1274.74"/>
<text text-anchor="middle" x="3152" y="-1259.54" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="3152" y="-1244.54" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 14</text>
<text text-anchor="middle" x="3152" y="-1229.54" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_15&#45;&gt;expert_15_1 -->
<g id="edge434" class="edge">
<title>gate_15&#45;&gt;expert_15_1</title>
<path fill="none" stroke="black" d="M4436.3,-1364C4175,-1364 3289,-1364 3289,-1364 3289,-1364 3289,-1284.8 3289,-1284.8"/>
<polygon fill="black" stroke="black" points="3292.5,-1284.8 3289,-1274.8 3285.5,-1284.8 3292.5,-1284.8"/>
</g>
<!-- expert_15_2 -->
<g id="node308" class="node">
<title>expert_15_2</title>
<polygon fill="#e8daef" stroke="black" points="3812,-1274.74 3396,-1274.74 3396,-1221.74 3812,-1221.74 3812,-1274.74"/>
<text text-anchor="middle" x="3604" y="-1259.54" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="3604" y="-1244.54" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 14</text>
<text text-anchor="middle" x="3604" y="-1229.54" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_15&#45;&gt;expert_15_2 -->
<g id="edge436" class="edge">
<title>gate_15&#45;&gt;expert_15_2</title>
<path fill="none" stroke="black" d="M4436.19,-1353C4245.52,-1353 3741,-1353 3741,-1353 3741,-1353 3741,-1284.95 3741,-1284.95"/>
<polygon fill="black" stroke="black" points="3744.5,-1284.95 3741,-1274.95 3737.5,-1284.95 3744.5,-1284.95"/>
</g>
<!-- expert_15_3 -->
<g id="node309" class="node">
<title>expert_15_3</title>
<polygon fill="#e8daef" stroke="black" points="4264,-1274.74 3848,-1274.74 3848,-1221.74 4264,-1221.74 4264,-1274.74"/>
<text text-anchor="middle" x="4056" y="-1259.54" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="4056" y="-1244.54" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 14</text>
<text text-anchor="middle" x="4056" y="-1229.54" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_15&#45;&gt;expert_15_3 -->
<g id="edge438" class="edge">
<title>gate_15&#45;&gt;expert_15_3</title>
<path fill="none" stroke="black" d="M4436.13,-1343C4343.16,-1343 4193,-1343 4193,-1343 4193,-1343 4193,-1284.89 4193,-1284.89"/>
<polygon fill="black" stroke="black" points="4196.5,-1284.89 4193,-1274.89 4189.5,-1284.89 4196.5,-1284.89"/>
</g>
<!-- expert_15_4 -->
<g id="node310" class="node">
<title>expert_15_4</title>
<polygon fill="#e8daef" stroke="black" points="4716,-1274.74 4300,-1274.74 4300,-1221.74 4716,-1221.74 4716,-1274.74"/>
<text text-anchor="middle" x="4508" y="-1259.54" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="4508" y="-1244.54" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 14</text>
<text text-anchor="middle" x="4508" y="-1229.54" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_15&#45;&gt;expert_15_4 -->
<g id="edge440" class="edge">
<title>gate_15&#45;&gt;expert_15_4</title>
<path fill="none" stroke="black" d="M4508,-1332.65C4508,-1332.65 4508,-1285 4508,-1285"/>
<polygon fill="black" stroke="black" points="4511.5,-1285 4508,-1275 4504.5,-1285 4511.5,-1285"/>
</g>
<!-- expert_15_5 -->
<g id="node311" class="node">
<title>expert_15_5</title>
<polygon fill="#e8daef" stroke="black" points="5168,-1274.74 4752,-1274.74 4752,-1221.74 5168,-1221.74 5168,-1274.74"/>
<text text-anchor="middle" x="4960" y="-1259.54" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="4960" y="-1244.54" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 14</text>
<text text-anchor="middle" x="4960" y="-1229.54" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_15&#45;&gt;expert_15_5 -->
<g id="edge442" class="edge">
<title>gate_15&#45;&gt;expert_15_5</title>
<path fill="none" stroke="black" d="M4579.72,-1343C4685.51,-1343 4871,-1343 4871,-1343 4871,-1343 4871,-1284.89 4871,-1284.89"/>
<polygon fill="black" stroke="black" points="4874.5,-1284.89 4871,-1274.89 4867.5,-1284.89 4874.5,-1284.89"/>
</g>
<!-- expert_15_6 -->
<g id="node312" class="node">
<title>expert_15_6</title>
<polygon fill="#e8daef" stroke="black" points="5620,-1274.74 5204,-1274.74 5204,-1221.74 5620,-1221.74 5620,-1274.74"/>
<text text-anchor="middle" x="5412" y="-1259.54" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="5412" y="-1244.54" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 14</text>
<text text-anchor="middle" x="5412" y="-1229.54" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_15&#45;&gt;expert_15_6 -->
<g id="edge444" class="edge">
<title>gate_15&#45;&gt;expert_15_6</title>
<path fill="none" stroke="black" d="M4579.53,-1353C4769.46,-1353 5272,-1353 5272,-1353 5272,-1353 5272,-1284.95 5272,-1284.95"/>
<polygon fill="black" stroke="black" points="5275.5,-1284.95 5272,-1274.95 5268.5,-1284.95 5275.5,-1284.95"/>
</g>
<!-- expert_15_7 -->
<g id="node313" class="node">
<title>expert_15_7</title>
<polygon fill="#e8daef" stroke="black" points="6072,-1274.74 5656,-1274.74 5656,-1221.74 6072,-1221.74 6072,-1274.74"/>
<text text-anchor="middle" x="5864" y="-1259.54" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="5864" y="-1244.54" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 14</text>
<text text-anchor="middle" x="5864" y="-1229.54" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_15&#45;&gt;expert_15_7 -->
<g id="edge446" class="edge">
<title>gate_15&#45;&gt;expert_15_7</title>
<path fill="none" stroke="black" d="M4579.87,-1364C4842.84,-1364 5737.49,-1364 5737.49,-1364 5737.49,-1364 5737.49,-1284.8 5737.49,-1284.8"/>
<polygon fill="black" stroke="black" points="5740.99,-1284.8 5737.49,-1274.8 5733.99,-1284.8 5740.99,-1284.8"/>
</g>
<!-- expert_15_0&#45;&gt;expert_agg_15 -->
<g id="edge433" class="edge">
<title>expert_15_0&#45;&gt;expert_agg_15</title>
<path fill="none" stroke="black" d="M2789,-1221.57C2789,-1184.26 2789,-1121 2789,-1121 2789,-1121 4616.31,-1121 4616.31,-1121"/>
<polygon fill="black" stroke="black" points="4616.31,-1124.5 4626.31,-1121 4616.31,-1117.5 4616.31,-1124.5"/>
</g>
<!-- expert_15_1&#45;&gt;expert_agg_15 -->
<g id="edge435" class="edge">
<title>expert_15_1&#45;&gt;expert_agg_15</title>
<path fill="none" stroke="black" d="M3241,-1221.64C3241,-1187.05 3241,-1131 3241,-1131 3241,-1131 4616.33,-1131 4616.33,-1131"/>
<polygon fill="black" stroke="black" points="4616.33,-1134.5 4626.33,-1131 4616.33,-1127.5 4616.33,-1134.5"/>
</g>
<!-- expert_15_2&#45;&gt;expert_agg_15 -->
<g id="edge437" class="edge">
<title>expert_15_2&#45;&gt;expert_agg_15</title>
<path fill="none" stroke="black" d="M3693,-1221.71C3693,-1190.24 3693,-1142 3693,-1142 3693,-1142 4616.03,-1142 4616.03,-1142"/>
<polygon fill="black" stroke="black" points="4616.03,-1145.5 4626.03,-1142 4616.03,-1138.5 4616.03,-1145.5"/>
</g>
<!-- expert_15_3&#45;&gt;expert_agg_15 -->
<g id="edge439" class="edge">
<title>expert_15_3&#45;&gt;expert_agg_15</title>
<path fill="none" stroke="black" d="M4145,-1221.71C4145,-1193.53 4145,-1153 4145,-1153 4145,-1153 4616.31,-1153 4616.31,-1153"/>
<polygon fill="black" stroke="black" points="4616.31,-1156.5 4626.31,-1153 4616.31,-1149.5 4616.31,-1156.5"/>
</g>
<!-- expert_15_4&#45;&gt;expert_agg_15 -->
<g id="edge441" class="edge">
<title>expert_15_4&#45;&gt;expert_agg_15</title>
<path fill="none" stroke="black" d="M4671.25,-1221.65C4671.25,-1221.65 4671.25,-1174 4671.25,-1174"/>
<polygon fill="black" stroke="black" points="4674.75,-1174 4671.25,-1164 4667.75,-1174 4674.75,-1174"/>
</g>
<!-- expert_15_5&#45;&gt;expert_agg_15 -->
<g id="edge443" class="edge">
<title>expert_15_5&#45;&gt;expert_agg_15</title>
<path fill="none" stroke="black" d="M4796.75,-1221.65C4796.75,-1221.65 4796.75,-1174 4796.75,-1174"/>
<polygon fill="black" stroke="black" points="4800.25,-1174 4796.75,-1164 4793.25,-1174 4800.25,-1174"/>
</g>
<!-- expert_15_6&#45;&gt;expert_agg_15 -->
<g id="edge445" class="edge">
<title>expert_15_6&#45;&gt;expert_agg_15</title>
<path fill="none" stroke="black" d="M5261,-1221.65C5261,-1192.56 5261,-1150 5261,-1150 5261,-1150 4851.6,-1150 4851.6,-1150"/>
<polygon fill="black" stroke="black" points="4851.6,-1146.5 4841.6,-1150 4851.6,-1153.5 4851.6,-1146.5"/>
</g>
<!-- expert_15_7&#45;&gt;expert_agg_15 -->
<g id="edge447" class="edge">
<title>expert_15_7&#45;&gt;expert_agg_15</title>
<path fill="none" stroke="black" d="M5727,-1221.6C5727,-1188.69 5727,-1137 5727,-1137 5727,-1137 4851.68,-1137 4851.68,-1137"/>
<polygon fill="black" stroke="black" points="4851.68,-1133.5 4841.68,-1137 4851.68,-1140.5 4851.68,-1133.5"/>
</g>
<!-- expert_agg_15&#45;&gt;residual2_15 -->
<g id="edge450" class="edge">
<title>expert_agg_15&#45;&gt;residual2_15</title>
<path fill="none" stroke="black" d="M4841.69,-1123C5157.09,-1123 6056.75,-1123 6056.75,-1123 6056.75,-1123 6056.75,-1062.94 6056.75,-1062.94"/>
<polygon fill="black" stroke="black" points="6060.25,-1062.94 6056.75,-1052.94 6053.25,-1062.94 6060.25,-1062.94"/>
</g>
<!-- transfer_15 -->
<g id="node316" class="node">
<title>transfer_15</title>
<ellipse fill="#fadbd8" stroke="black" cx="6149" cy="-914.87" rx="152.06" ry="26.74"/>
<text text-anchor="middle" x="6149" y="-918.67" font-family="Helvetica,sans-Serif" font-size="14.00">Transfer to GPU 15</text>
<text text-anchor="middle" x="6149" y="-903.67" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual2_15&#45;&gt;transfer_15 -->
<g id="edge451" class="edge">
<title>residual2_15&#45;&gt;transfer_15</title>
<path fill="none" stroke="black" d="M6149,-999.56C6149,-999.56 6149,-952.1 6149,-952.1"/>
<polygon fill="black" stroke="black" points="6152.5,-952.1 6149,-942.1 6145.5,-952.1 6152.5,-952.1"/>
</g>
<!-- residual1_16 -->
<g id="node323" class="node">
<title>residual1_16</title>
<polygon fill="#fadbd8" stroke="black" points="6404.5,-830 6189.5,-830 6189.5,-777 6404.5,-777 6404.5,-830"/>
<text text-anchor="middle" x="6297" y="-814.8" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="6297" y="-799.8" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 15</text>
<text text-anchor="middle" x="6297" y="-784.8" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- transfer_15&#45;&gt;residual1_16 -->
<g id="edge457" class="edge">
<title>transfer_15&#45;&gt;residual1_16</title>
<path fill="none" stroke="black" d="M6245.26,-893.92C6245.26,-893.92 6245.26,-840.27 6245.26,-840.27"/>
<polygon fill="black" stroke="black" points="6248.76,-840.27 6245.26,-830.27 6241.76,-840.27 6248.76,-840.27"/>
</g>
<!-- ln1_16 -->
<g id="node317" class="node">
<title>ln1_16</title>
<polygon fill="#f8f9f9" stroke="black" points="6552.5,-1496.74 6337.5,-1496.74 6337.5,-1443.74 6552.5,-1443.74 6552.5,-1496.74"/>
<text text-anchor="middle" x="6445" y="-1481.54" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;Attn)</text>
<text text-anchor="middle" x="6445" y="-1466.54" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 15</text>
<text text-anchor="middle" x="6445" y="-1451.54" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_qkv_16 -->
<g id="node318" class="node">
<title>attn_qkv_16</title>
<polygon fill="#ffe6cc" stroke="black" points="6560,-1385.74 6330,-1385.74 6330,-1332.74 6560,-1332.74 6560,-1385.74"/>
<text text-anchor="middle" x="6445" y="-1370.54" font-family="Helvetica,sans-Serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="6445" y="-1355.54" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 15</text>
<text text-anchor="middle" x="6445" y="-1340.54" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 3*hidden_dim]</text>
</g>
<!-- ln1_16&#45;&gt;attn_qkv_16 -->
<g id="edge452" class="edge">
<title>ln1_16&#45;&gt;attn_qkv_16</title>
<path fill="none" stroke="black" d="M6445,-1443.65C6445,-1443.65 6445,-1396 6445,-1396"/>
<polygon fill="black" stroke="black" points="6448.5,-1396 6445,-1386 6441.5,-1396 6448.5,-1396"/>
</g>
<!-- attn_score_16 -->
<g id="node319" class="node">
<title>attn_score_16</title>
<polygon fill="#ffe6cc" stroke="black" points="6582.5,-1274.74 6307.5,-1274.74 6307.5,-1221.74 6582.5,-1221.74 6582.5,-1274.74"/>
<text text-anchor="middle" x="6445" y="-1259.54" font-family="Helvetica,sans-Serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="6445" y="-1244.54" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 15</text>
<text text-anchor="middle" x="6445" y="-1229.54" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_qkv_16&#45;&gt;attn_score_16 -->
<g id="edge453" class="edge">
<title>attn_qkv_16&#45;&gt;attn_score_16</title>
<path fill="none" stroke="black" d="M6445,-1332.65C6445,-1332.65 6445,-1285 6445,-1285"/>
<polygon fill="black" stroke="black" points="6448.5,-1285 6445,-1275 6441.5,-1285 6448.5,-1285"/>
</g>
<!-- attn_weight_16 -->
<g id="node320" class="node">
<title>attn_weight_16</title>
<polygon fill="#ffe6cc" stroke="black" points="6582.5,-1163.74 6307.5,-1163.74 6307.5,-1110.74 6582.5,-1110.74 6582.5,-1163.74"/>
<text text-anchor="middle" x="6445" y="-1148.54" font-family="Helvetica,sans-Serif" font-size="14.00">Softmax</text>
<text text-anchor="middle" x="6445" y="-1133.54" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 15</text>
<text text-anchor="middle" x="6445" y="-1118.54" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, seq_len]</text>
</g>
<!-- attn_score_16&#45;&gt;attn_weight_16 -->
<g id="edge454" class="edge">
<title>attn_score_16&#45;&gt;attn_weight_16</title>
<path fill="none" stroke="black" d="M6445,-1221.65C6445,-1221.65 6445,-1174 6445,-1174"/>
<polygon fill="black" stroke="black" points="6448.5,-1174 6445,-1164 6441.5,-1174 6448.5,-1174"/>
</g>
<!-- attn_context_16 -->
<g id="node321" class="node">
<title>attn_context_16</title>
<polygon fill="#ffe6cc" stroke="black" points="6590,-1052.74 6300,-1052.74 6300,-999.74 6590,-999.74 6590,-1052.74"/>
<text text-anchor="middle" x="6445" y="-1037.54" font-family="Helvetica,sans-Serif" font-size="14.00">Context</text>
<text text-anchor="middle" x="6445" y="-1022.54" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 15</text>
<text text-anchor="middle" x="6445" y="-1007.54" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, num_heads, seq_len, head_dim]</text>
</g>
<!-- attn_weight_16&#45;&gt;attn_context_16 -->
<g id="edge455" class="edge">
<title>attn_weight_16&#45;&gt;attn_context_16</title>
<path fill="none" stroke="black" d="M6445,-1110.65C6445,-1110.65 6445,-1063 6445,-1063"/>
<polygon fill="black" stroke="black" points="6448.5,-1063 6445,-1053 6441.5,-1063 6448.5,-1063"/>
</g>
<!-- attn_out_16 -->
<g id="node322" class="node">
<title>attn_out_16</title>
<polygon fill="#ffe6cc" stroke="black" points="6552.5,-941.37 6337.5,-941.37 6337.5,-888.37 6552.5,-888.37 6552.5,-941.37"/>
<text text-anchor="middle" x="6445" y="-926.17" font-family="Helvetica,sans-Serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="6445" y="-911.17" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 15</text>
<text text-anchor="middle" x="6445" y="-896.17" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- attn_context_16&#45;&gt;attn_out_16 -->
<g id="edge456" class="edge">
<title>attn_context_16&#45;&gt;attn_out_16</title>
<path fill="none" stroke="black" d="M6445,-999.56C6445,-999.56 6445,-951.71 6445,-951.71"/>
<polygon fill="black" stroke="black" points="6448.5,-951.71 6445,-941.71 6441.5,-951.71 6448.5,-951.71"/>
</g>
<!-- attn_out_16&#45;&gt;residual1_16 -->
<g id="edge458" class="edge">
<title>attn_out_16&#45;&gt;residual1_16</title>
<path fill="none" stroke="black" d="M6371,-888.19C6371,-888.19 6371,-840.34 6371,-840.34"/>
<polygon fill="black" stroke="black" points="6374.5,-840.34 6371,-830.34 6367.5,-840.34 6374.5,-840.34"/>
</g>
<!-- ln2_16 -->
<g id="node324" class="node">
<title>ln2_16</title>
<polygon fill="#f8f9f9" stroke="black" points="6323.5,-719 6108.5,-719 6108.5,-666 6323.5,-666 6323.5,-719"/>
<text text-anchor="middle" x="6216" y="-703.8" font-family="Helvetica,sans-Serif" font-size="14.00">LayerNorm (Pre&#45;MoE)</text>
<text text-anchor="middle" x="6216" y="-688.8" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 15</text>
<text text-anchor="middle" x="6216" y="-673.8" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_16&#45;&gt;ln2_16 -->
<g id="edge459" class="edge">
<title>residual1_16&#45;&gt;ln2_16</title>
<path fill="none" stroke="black" d="M6256.5,-776.91C6256.5,-776.91 6256.5,-729.26 6256.5,-729.26"/>
<polygon fill="black" stroke="black" points="6260,-729.25 6256.5,-719.26 6253,-729.26 6260,-729.25"/>
</g>
<!-- residual2_16 -->
<g id="node336" class="node">
<title>residual2_16</title>
<polygon fill="#fadbd8" stroke="black" points="5639.5,-164 5424.5,-164 5424.5,-111 5639.5,-111 5639.5,-164"/>
<text text-anchor="middle" x="5532" y="-148.8" font-family="Helvetica,sans-Serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="5532" y="-133.8" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 15</text>
<text text-anchor="middle" x="5532" y="-118.8" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- residual1_16&#45;&gt;residual2_16 -->
<g id="edge479" class="edge">
<title>residual1_16&#45;&gt;residual2_16</title>
<path fill="none" stroke="black" d="M6364,-776.96C6364,-653 6364,-137 6364,-137 6364,-137 5649.92,-137 5649.92,-137"/>
<polygon fill="black" stroke="black" points="5649.92,-133.5 5639.92,-137 5649.92,-140.5 5649.92,-133.5"/>
</g>
<!-- router_16 -->
<g id="node325" class="node">
<title>router_16</title>
<polygon fill="#f5b7b1" stroke="black" points="5518,-608 5318,-608 5318,-555 5518,-555 5518,-608"/>
<text text-anchor="middle" x="5418" y="-592.8" font-family="Helvetica,sans-Serif" font-size="14.00">Router Network</text>
<text text-anchor="middle" x="5418" y="-577.8" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 15</text>
<text text-anchor="middle" x="5418" y="-562.8" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 8 experts]</text>
</g>
<!-- ln2_16&#45;&gt;router_16 -->
<g id="edge460" class="edge">
<title>ln2_16&#45;&gt;router_16</title>
<path fill="none" stroke="black" d="M6179.25,-665.79C6179.25,-632.81 6179.25,-581 6179.25,-581 6179.25,-581 5528.3,-581 5528.3,-581"/>
<polygon fill="black" stroke="black" points="5528.3,-577.5 5518.3,-581 5528.3,-584.5 5528.3,-577.5"/>
</g>
<!-- expert_agg_16 -->
<g id="node335" class="node">
<title>expert_agg_16</title>
<polygon fill="#d4e6f1" stroke="black" points="5019.5,-275 4804.5,-275 4804.5,-222 5019.5,-222 5019.5,-275"/>
<text text-anchor="middle" x="4912" y="-259.8" font-family="Helvetica,sans-Serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="4912" y="-244.8" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 15</text>
<text text-anchor="middle" x="4912" y="-229.8" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim]</text>
</g>
<!-- ln2_16&#45;&gt;expert_agg_16 -->
<g id="edge478" class="edge">
<title>ln2_16&#45;&gt;expert_agg_16</title>
<path fill="none" stroke="black" d="M6108.46,-692C5796.28,-692 4912,-692 4912,-692 4912,-692 4912,-285.24 4912,-285.24"/>
<polygon fill="black" stroke="black" points="4915.5,-285.24 4912,-275.24 4908.5,-285.24 4915.5,-285.24"/>
</g>
<!-- gate_16 -->
<g id="node326" class="node">
<title>gate_16</title>
<polygon fill="#f5b7b1" stroke="black" points="4757.5,-497 4614.5,-497 4614.5,-444 4757.5,-444 4757.5,-497"/>
<text text-anchor="middle" x="4686" y="-481.8" font-family="Helvetica,sans-Serif" font-size="14.00">Top&#45;2 Gating</text>
<text text-anchor="middle" x="4686" y="-466.8" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 15</text>
<text text-anchor="middle" x="4686" y="-451.8" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, 2]</text>
</g>
<!-- router_16&#45;&gt;gate_16 -->
<g id="edge461" class="edge">
<title>router_16&#45;&gt;gate_16</title>
<path fill="none" stroke="black" d="M5332,-554.9C5332,-526.64 5332,-486 5332,-486 5332,-486 4767.6,-486 4767.6,-486"/>
<polygon fill="black" stroke="black" points="4767.6,-482.5 4757.6,-486 4767.6,-489.5 4767.6,-482.5"/>
</g>
<!-- expert_16_0 -->
<g id="node327" class="node">
<title>expert_16_0</title>
<polygon fill="#e8daef" stroke="black" points="3086,-386 2670,-386 2670,-333 3086,-333 3086,-386"/>
<text text-anchor="middle" x="2878" y="-370.8" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="2878" y="-355.8" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 15</text>
<text text-anchor="middle" x="2878" y="-340.8" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_16&#45;&gt;expert_16_0 -->
<g id="edge462" class="edge">
<title>gate_16&#45;&gt;expert_16_0</title>
<path fill="none" stroke="black" d="M4614.47,-486C4295.07,-486 3015,-486 3015,-486 3015,-486 3015,-396.02 3015,-396.02"/>
<polygon fill="black" stroke="black" points="3018.5,-396.02 3015,-386.02 3011.5,-396.02 3018.5,-396.02"/>
</g>
<!-- expert_16_1 -->
<g id="node328" class="node">
<title>expert_16_1</title>
<polygon fill="#e8daef" stroke="black" points="3538,-386 3122,-386 3122,-333 3538,-333 3538,-386"/>
<text text-anchor="middle" x="3330" y="-370.8" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="3330" y="-355.8" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 15</text>
<text text-anchor="middle" x="3330" y="-340.8" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_16&#45;&gt;expert_16_1 -->
<g id="edge464" class="edge">
<title>gate_16&#45;&gt;expert_16_1</title>
<path fill="none" stroke="black" d="M4614.3,-475C4353,-475 3467,-475 3467,-475 3467,-475 3467,-396.29 3467,-396.29"/>
<polygon fill="black" stroke="black" points="3470.5,-396.29 3467,-386.29 3463.5,-396.29 3470.5,-396.29"/>
</g>
<!-- expert_16_2 -->
<g id="node329" class="node">
<title>expert_16_2</title>
<polygon fill="#e8daef" stroke="black" points="3990,-386 3574,-386 3574,-333 3990,-333 3990,-386"/>
<text text-anchor="middle" x="3782" y="-370.8" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="3782" y="-355.8" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 15</text>
<text text-anchor="middle" x="3782" y="-340.8" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_16&#45;&gt;expert_16_2 -->
<g id="edge466" class="edge">
<title>gate_16&#45;&gt;expert_16_2</title>
<path fill="none" stroke="black" d="M4614.19,-465C4423.52,-465 3919,-465 3919,-465 3919,-465 3919,-396.12 3919,-396.12"/>
<polygon fill="black" stroke="black" points="3922.5,-396.12 3919,-386.12 3915.5,-396.12 3922.5,-396.12"/>
</g>
<!-- expert_16_3 -->
<g id="node330" class="node">
<title>expert_16_3</title>
<polygon fill="#e8daef" stroke="black" points="4442,-386 4026,-386 4026,-333 4442,-333 4442,-386"/>
<text text-anchor="middle" x="4234" y="-370.8" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="4234" y="-355.8" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 15</text>
<text text-anchor="middle" x="4234" y="-340.8" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_16&#45;&gt;expert_16_3 -->
<g id="edge468" class="edge">
<title>gate_16&#45;&gt;expert_16_3</title>
<path fill="none" stroke="black" d="M4614.13,-454C4521.16,-454 4371,-454 4371,-454 4371,-454 4371,-396.08 4371,-396.08"/>
<polygon fill="black" stroke="black" points="4374.5,-396.07 4371,-386.08 4367.5,-396.08 4374.5,-396.07"/>
</g>
<!-- expert_16_4 -->
<g id="node331" class="node">
<title>expert_16_4</title>
<polygon fill="#e8daef" stroke="black" points="4894,-386 4478,-386 4478,-333 4894,-333 4894,-386"/>
<text text-anchor="middle" x="4686" y="-370.8" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="4686" y="-355.8" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 15</text>
<text text-anchor="middle" x="4686" y="-340.8" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_16&#45;&gt;expert_16_4 -->
<g id="edge470" class="edge">
<title>gate_16&#45;&gt;expert_16_4</title>
<path fill="none" stroke="black" d="M4686,-443.91C4686,-443.91 4686,-396.26 4686,-396.26"/>
<polygon fill="black" stroke="black" points="4689.5,-396.25 4686,-386.26 4682.5,-396.26 4689.5,-396.25"/>
</g>
<!-- expert_16_5 -->
<g id="node332" class="node">
<title>expert_16_5</title>
<polygon fill="#e8daef" stroke="black" points="5346,-386 4930,-386 4930,-333 5346,-333 5346,-386"/>
<text text-anchor="middle" x="5138" y="-370.8" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="5138" y="-355.8" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 15</text>
<text text-anchor="middle" x="5138" y="-340.8" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_16&#45;&gt;expert_16_5 -->
<g id="edge472" class="edge">
<title>gate_16&#45;&gt;expert_16_5</title>
<path fill="none" stroke="black" d="M4757.72,-454C4863.51,-454 5049,-454 5049,-454 5049,-454 5049,-396.08 5049,-396.08"/>
<polygon fill="black" stroke="black" points="5052.5,-396.07 5049,-386.08 5045.5,-396.08 5052.5,-396.07"/>
</g>
<!-- expert_16_6 -->
<g id="node333" class="node">
<title>expert_16_6</title>
<polygon fill="#e8daef" stroke="black" points="5798,-386 5382,-386 5382,-333 5798,-333 5798,-386"/>
<text text-anchor="middle" x="5590" y="-370.8" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="5590" y="-355.8" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 15</text>
<text text-anchor="middle" x="5590" y="-340.8" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_16&#45;&gt;expert_16_6 -->
<g id="edge474" class="edge">
<title>gate_16&#45;&gt;expert_16_6</title>
<path fill="none" stroke="black" d="M4757.53,-465C4947.46,-465 5450,-465 5450,-465 5450,-465 5450,-396.12 5450,-396.12"/>
<polygon fill="black" stroke="black" points="5453.5,-396.12 5450,-386.12 5446.5,-396.12 5453.5,-396.12"/>
</g>
<!-- expert_16_7 -->
<g id="node334" class="node">
<title>expert_16_7</title>
<polygon fill="#e8daef" stroke="black" points="6250,-386 5834,-386 5834,-333 6250,-333 6250,-386"/>
<text text-anchor="middle" x="6042" y="-370.8" font-family="Helvetica,sans-Serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="6042" y="-355.8" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 15</text>
<text text-anchor="middle" x="6042" y="-340.8" font-family="Helvetica,sans-Serif" font-size="14.00">[1024, seq_len, hidden_dim→4*hidden_dim→hidden_dim]</text>
</g>
<!-- gate_16&#45;&gt;expert_16_7 -->
<g id="edge476" class="edge">
<title>gate_16&#45;&gt;expert_16_7</title>
<path fill="none" stroke="black" d="M4757.87,-475C5020.84,-475 5915.49,-475 5915.49,-475 5915.49,-475 5915.49,-396.29 5915.49,-396.29"/>
<polygon fill="black" stroke="black" points="5918.99,-396.29 5915.49,-386.29 5911.99,-396.29 5918.99,-396.29"/>
</g>
<!-- expert_16_0&#45;&gt;expert_agg_16 -->
<g id="edge463" class="edge">
<title>expert_16_0&#45;&gt;expert_agg_16</title>
<path fill="none" stroke="black" d="M2878,-332.77C2878,-295.38 2878,-232 2878,-232 2878,-232 4794.44,-232 4794.44,-232"/>
<polygon fill="black" stroke="black" points="4794.44,-235.5 4804.44,-232 4794.44,-228.5 4794.44,-235.5"/>
</g>
<!-- expert_16_1&#45;&gt;expert_agg_16 -->
<g id="edge465" class="edge">
<title>expert_16_1&#45;&gt;expert_agg_16</title>
<path fill="none" stroke="black" d="M3330,-332.77C3330,-298.38 3330,-243 3330,-243 3330,-243 4794.2,-243 4794.2,-243"/>
<polygon fill="black" stroke="black" points="4794.2,-246.5 4804.2,-243 4794.2,-239.5 4794.2,-246.5"/>
</g>
<!-- expert_16_2&#45;&gt;expert_agg_16 -->
<g id="edge467" class="edge">
<title>expert_16_2&#45;&gt;expert_agg_16</title>
<path fill="none" stroke="black" d="M3782,-332.9C3782,-301.36 3782,-253 3782,-253 3782,-253 4794.42,-253 4794.42,-253"/>
<polygon fill="black" stroke="black" points="4794.42,-256.5 4804.42,-253 4794.42,-249.5 4794.42,-256.5"/>
</g>
<!-- expert_16_3&#45;&gt;expert_agg_16 -->
<g id="edge469" class="edge">
<title>expert_16_3&#45;&gt;expert_agg_16</title>
<path fill="none" stroke="black" d="M4234,-332.9C4234,-304.64 4234,-264 4234,-264 4234,-264 4794.19,-264 4794.19,-264"/>
<polygon fill="black" stroke="black" points="4794.19,-267.5 4804.19,-264 4794.19,-260.5 4794.19,-267.5"/>
</g>
<!-- expert_16_4&#45;&gt;expert_agg_16 -->
<g id="edge471" class="edge">
<title>expert_16_4&#45;&gt;expert_agg_16</title>
<path fill="none" stroke="black" d="M4849.25,-332.91C4849.25,-332.91 4849.25,-285.26 4849.25,-285.26"/>
<polygon fill="black" stroke="black" points="4852.75,-285.25 4849.25,-275.26 4845.75,-285.26 4852.75,-285.25"/>
</g>
<!-- expert_16_5&#45;&gt;expert_agg_16 -->
<g id="edge473" class="edge">
<title>expert_16_5&#45;&gt;expert_agg_16</title>
<path fill="none" stroke="black" d="M4974.75,-332.91C4974.75,-332.91 4974.75,-285.26 4974.75,-285.26"/>
<polygon fill="black" stroke="black" points="4978.25,-285.25 4974.75,-275.26 4971.25,-285.26 4978.25,-285.25"/>
</g>
<!-- expert_16_6&#45;&gt;expert_agg_16 -->
<g id="edge475" class="edge">
<title>expert_16_6&#45;&gt;expert_agg_16</title>
<path fill="none" stroke="black" d="M5390.5,-332.84C5390.5,-302.47 5390.5,-257 5390.5,-257 5390.5,-257 5029.68,-257 5029.68,-257"/>
<polygon fill="black" stroke="black" points="5029.68,-253.5 5019.68,-257 5029.68,-260.5 5029.68,-253.5"/>
</g>
<!-- expert_16_7&#45;&gt;expert_agg_16 -->
<g id="edge477" class="edge">
<title>expert_16_7&#45;&gt;expert_agg_16</title>
<path fill="none" stroke="black" d="M6042,-332.76C6042,-297.26 6042,-239 6042,-239 6042,-239 5029.58,-239 5029.58,-239"/>
<polygon fill="black" stroke="black" points="5029.58,-235.5 5019.58,-239 5029.58,-242.5 5029.58,-235.5"/>
</g>
<!-- expert_agg_16&#45;&gt;residual2_16 -->
<g id="edge480" class="edge">
<title>expert_agg_16&#45;&gt;residual2_16</title>
<path fill="none" stroke="black" d="M4912,-221.79C4912,-188.81 4912,-137 4912,-137 4912,-137 5414.36,-137 5414.36,-137"/>
<polygon fill="black" stroke="black" points="5414.36,-140.5 5424.36,-137 5414.36,-133.5 5414.36,-140.5"/>
</g>
<!-- output -->
<g id="node337" class="node">
<title>output</title>
<polygon fill="#d5f4e6" stroke="black" points="5665,-53 5399,-53 5399,0 5665,0 5665,-53"/>
<text text-anchor="middle" x="5532" y="-37.8" font-family="Helvetica,sans-Serif" font-size="14.00">Final Output</text>
<text text-anchor="middle" x="5532" y="-22.8" font-family="Helvetica,sans-Serif" font-size="14.00">[batch=1024, seq_len, hidden_dim]</text>
<text text-anchor="middle" x="5532" y="-7.8" font-family="Helvetica,sans-Serif" font-size="14.00">GPU: 15</text>
</g>
<!-- residual2_16&#45;&gt;output -->
<g id="edge481" class="edge">
<title>residual2_16&#45;&gt;output</title>
<path fill="none" stroke="black" d="M5532,-110.91C5532,-110.91 5532,-63.26 5532,-63.26"/>
<polygon fill="black" stroke="black" points="5535.5,-63.25 5532,-53.26 5528.5,-63.26 5535.5,-63.25"/>
</g>
</g>
</svg>
