<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="2187pt" height="31673pt"
 viewBox="0.00 0.00 2187.00 31673.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 31669)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-31669 2183,-31669 2183,4 -4,4"/>
<text text-anchor="middle" x="1089.5" y="-31629.2" font-family="Times,serif" font-size="16.00">Layer&#45;wise Model Deployment with 16 GPUs</text>
<text text-anchor="middle" x="1089.5" y="-31611.2" font-family="Times,serif" font-size="16.00">Each GPU hosts 1 layer with Tensor Parallelism (TP=8)</text>
<text text-anchor="middle" x="1089.5" y="-31593.2" font-family="Times,serif" font-size="16.00">Red dashed lines indicate GPU&#45;to&#45;GPU communication</text>
<g id="clust1" class="cluster">
<title>cluster_gpu_0</title>
<path fill="#ff9999" stroke="black" d="M343,-29390C343,-29390 2153,-29390 2153,-29390 2159,-29390 2165,-29396 2165,-29402 2165,-29402 2165,-31473 2165,-31473 2165,-31479 2159,-31485 2153,-31485 2153,-31485 343,-31485 343,-31485 337,-31485 331,-31479 331,-31473 331,-31473 331,-29402 331,-29402 331,-29396 337,-29390 343,-29390"/>
<text text-anchor="middle" x="1248" y="-31468.2" font-family="Times,serif" font-size="16.00">GPU 0</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_attention_0</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="1792,-30753 1792,-31241 2010,-31241 2010,-30753 1792,-30753"/>
<text text-anchor="middle" x="1901" y="-31224.2" font-family="Times,serif" font-size="16.00">Multi&#45;Head Attention</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_mlp_0</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="339,-29628 339,-30494 2127,-30494 2127,-29628 339,-29628"/>
<text text-anchor="middle" x="1233" y="-30477.2" font-family="Times,serif" font-size="16.00">MLP/MoE Layer</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_gpu_1</title>
<path fill="#ffcc99" stroke="black" d="M1756,-27622C1756,-27622 1997,-27622 1997,-27622 2003,-27622 2009,-27628 2009,-27634 2009,-27634 2009,-29312 2009,-29312 2009,-29318 2003,-29324 1997,-29324 1997,-29324 1756,-29324 1756,-29324 1750,-29324 1744,-29318 1744,-29312 1744,-29312 1744,-27634 1744,-27634 1744,-27628 1750,-27622 1756,-27622"/>
<text text-anchor="middle" x="1876.5" y="-29307.2" font-family="Times,serif" font-size="16.00">GPU 1</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_attention_1</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="1752,-28592 1752,-29080 1970,-29080 1970,-28592 1752,-28592"/>
<text text-anchor="middle" x="1861" y="-29063.2" font-family="Times,serif" font-size="16.00">Multi&#45;Head Attention</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_mlp_1</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="1752,-27860 1752,-28333 1970,-28333 1970,-27860 1752,-27860"/>
<text text-anchor="middle" x="1861" y="-28316.2" font-family="Times,serif" font-size="16.00">MLP/MoE Layer</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_gpu_2</title>
<path fill="#ffff99" stroke="black" d="M177,-25461C177,-25461 1987,-25461 1987,-25461 1993,-25461 1999,-25467 1999,-25473 1999,-25473 1999,-27544 1999,-27544 1999,-27550 1993,-27556 1987,-27556 1987,-27556 177,-27556 177,-27556 171,-27556 165,-27550 165,-27544 165,-27544 165,-25473 165,-25473 165,-25467 171,-25461 177,-25461"/>
<text text-anchor="middle" x="1082" y="-27539.2" font-family="Times,serif" font-size="16.00">GPU 2</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_attention_2</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="1659,-26824 1659,-27312 1877,-27312 1877,-26824 1659,-26824"/>
<text text-anchor="middle" x="1768" y="-27295.2" font-family="Times,serif" font-size="16.00">Multi&#45;Head Attention</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_mlp_2</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="173,-25699 173,-26565 1961,-26565 1961,-25699 173,-25699"/>
<text text-anchor="middle" x="1067" y="-26548.2" font-family="Times,serif" font-size="16.00">MLP/MoE Layer</text>
</g>
<g id="clust10" class="cluster">
<title>cluster_gpu_3</title>
<path fill="#99ff99" stroke="black" d="M1746,-23693C1746,-23693 1987,-23693 1987,-23693 1993,-23693 1999,-23699 1999,-23705 1999,-23705 1999,-25383 1999,-25383 1999,-25389 1993,-25395 1987,-25395 1987,-25395 1746,-25395 1746,-25395 1740,-25395 1734,-25389 1734,-25383 1734,-25383 1734,-23705 1734,-23705 1734,-23699 1740,-23693 1746,-23693"/>
<text text-anchor="middle" x="1866.5" y="-25378.2" font-family="Times,serif" font-size="16.00">GPU 3</text>
</g>
<g id="clust11" class="cluster">
<title>cluster_attention_3</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="1742,-24663 1742,-25151 1960,-25151 1960,-24663 1742,-24663"/>
<text text-anchor="middle" x="1851" y="-25134.2" font-family="Times,serif" font-size="16.00">Multi&#45;Head Attention</text>
</g>
<g id="clust12" class="cluster">
<title>cluster_mlp_3</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="1742,-23931 1742,-24404 1960,-24404 1960,-23931 1742,-23931"/>
<text text-anchor="middle" x="1851" y="-24387.2" font-family="Times,serif" font-size="16.00">MLP/MoE Layer</text>
</g>
<g id="clust13" class="cluster">
<title>cluster_gpu_4</title>
<path fill="#99ffff" stroke="black" d="M326,-21532C326,-21532 2136,-21532 2136,-21532 2142,-21532 2148,-21538 2148,-21544 2148,-21544 2148,-23615 2148,-23615 2148,-23621 2142,-23627 2136,-23627 2136,-23627 326,-23627 326,-23627 320,-23627 314,-23621 314,-23615 314,-23615 314,-21544 314,-21544 314,-21538 320,-21532 326,-21532"/>
<text text-anchor="middle" x="1231" y="-23610.2" font-family="Times,serif" font-size="16.00">GPU 4</text>
</g>
<g id="clust14" class="cluster">
<title>cluster_attention_4</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="1662,-22895 1662,-23383 1880,-23383 1880,-22895 1662,-22895"/>
<text text-anchor="middle" x="1771" y="-23366.2" font-family="Times,serif" font-size="16.00">Multi&#45;Head Attention</text>
</g>
<g id="clust15" class="cluster">
<title>cluster_mlp_4</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="322,-21770 322,-22636 2110,-22636 2110,-21770 322,-21770"/>
<text text-anchor="middle" x="1216" y="-22619.2" font-family="Times,serif" font-size="16.00">MLP/MoE Layer</text>
</g>
<g id="clust16" class="cluster">
<title>cluster_gpu_5</title>
<path fill="#9999ff" stroke="black" d="M1841,-19764C1841,-19764 2082,-19764 2082,-19764 2088,-19764 2094,-19770 2094,-19776 2094,-19776 2094,-21454 2094,-21454 2094,-21460 2088,-21466 2082,-21466 2082,-21466 1841,-21466 1841,-21466 1835,-21466 1829,-21460 1829,-21454 1829,-21454 1829,-19776 1829,-19776 1829,-19770 1835,-19764 1841,-19764"/>
<text text-anchor="middle" x="1961.5" y="-21449.2" font-family="Times,serif" font-size="16.00">GPU 5</text>
</g>
<g id="clust17" class="cluster">
<title>cluster_attention_5</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="1837,-20734 1837,-21222 2055,-21222 2055,-20734 1837,-20734"/>
<text text-anchor="middle" x="1946" y="-21205.2" font-family="Times,serif" font-size="16.00">Multi&#45;Head Attention</text>
</g>
<g id="clust18" class="cluster">
<title>cluster_mlp_5</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="1837,-20002 1837,-20475 2055,-20475 2055,-20002 1837,-20002"/>
<text text-anchor="middle" x="1946" y="-20458.2" font-family="Times,serif" font-size="16.00">MLP/MoE Layer</text>
</g>
<g id="clust19" class="cluster">
<title>cluster_gpu_6</title>
<path fill="#cc99ff" stroke="black" d="M349,-17603C349,-17603 2159,-17603 2159,-17603 2165,-17603 2171,-17609 2171,-17615 2171,-17615 2171,-19686 2171,-19686 2171,-19692 2165,-19698 2159,-19698 2159,-19698 349,-19698 349,-19698 343,-19698 337,-19692 337,-19686 337,-19686 337,-17615 337,-17615 337,-17609 343,-17603 349,-17603"/>
<text text-anchor="middle" x="1254" y="-19681.2" font-family="Times,serif" font-size="16.00">GPU 6</text>
</g>
<g id="clust20" class="cluster">
<title>cluster_attention_6</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="1743,-18966 1743,-19454 1961,-19454 1961,-18966 1743,-18966"/>
<text text-anchor="middle" x="1852" y="-19437.2" font-family="Times,serif" font-size="16.00">Multi&#45;Head Attention</text>
</g>
<g id="clust21" class="cluster">
<title>cluster_mlp_6</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="345,-17841 345,-18707 2133,-18707 2133,-17841 345,-17841"/>
<text text-anchor="middle" x="1239" y="-18690.2" font-family="Times,serif" font-size="16.00">MLP/MoE Layer</text>
</g>
<g id="clust22" class="cluster">
<title>cluster_gpu_7</title>
<path fill="#ff99cc" stroke="black" d="M1745,-15835C1745,-15835 1986,-15835 1986,-15835 1992,-15835 1998,-15841 1998,-15847 1998,-15847 1998,-17525 1998,-17525 1998,-17531 1992,-17537 1986,-17537 1986,-17537 1745,-17537 1745,-17537 1739,-17537 1733,-17531 1733,-17525 1733,-17525 1733,-15847 1733,-15847 1733,-15841 1739,-15835 1745,-15835"/>
<text text-anchor="middle" x="1865.5" y="-17520.2" font-family="Times,serif" font-size="16.00">GPU 7</text>
</g>
<g id="clust23" class="cluster">
<title>cluster_attention_7</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="1741,-16805 1741,-17293 1959,-17293 1959,-16805 1741,-16805"/>
<text text-anchor="middle" x="1850" y="-17276.2" font-family="Times,serif" font-size="16.00">Multi&#45;Head Attention</text>
</g>
<g id="clust24" class="cluster">
<title>cluster_mlp_7</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="1741,-16073 1741,-16546 1959,-16546 1959,-16073 1741,-16073"/>
<text text-anchor="middle" x="1850" y="-16529.2" font-family="Times,serif" font-size="16.00">MLP/MoE Layer</text>
</g>
<g id="clust25" class="cluster">
<title>cluster_gpu_8</title>
<path fill="#ffb366" stroke="black" d="M190,-13674C190,-13674 2000,-13674 2000,-13674 2006,-13674 2012,-13680 2012,-13686 2012,-13686 2012,-15757 2012,-15757 2012,-15763 2006,-15769 2000,-15769 2000,-15769 190,-15769 190,-15769 184,-15769 178,-15763 178,-15757 178,-15757 178,-13686 178,-13686 178,-13680 184,-13674 190,-13674"/>
<text text-anchor="middle" x="1095" y="-15752.2" font-family="Times,serif" font-size="16.00">GPU 8</text>
</g>
<g id="clust26" class="cluster">
<title>cluster_attention_8</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="1637,-15037 1637,-15525 1855,-15525 1855,-15037 1637,-15037"/>
<text text-anchor="middle" x="1746" y="-15508.2" font-family="Times,serif" font-size="16.00">Multi&#45;Head Attention</text>
</g>
<g id="clust27" class="cluster">
<title>cluster_mlp_8</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="186,-13912 186,-14778 1974,-14778 1974,-13912 186,-13912"/>
<text text-anchor="middle" x="1080" y="-14761.2" font-family="Times,serif" font-size="16.00">MLP/MoE Layer</text>
</g>
<g id="clust28" class="cluster">
<title>cluster_gpu_9</title>
<path fill="#b3ff66" stroke="black" d="M1601,-11906C1601,-11906 1842,-11906 1842,-11906 1848,-11906 1854,-11912 1854,-11918 1854,-11918 1854,-13596 1854,-13596 1854,-13602 1848,-13608 1842,-13608 1842,-13608 1601,-13608 1601,-13608 1595,-13608 1589,-13602 1589,-13596 1589,-13596 1589,-11918 1589,-11918 1589,-11912 1595,-11906 1601,-11906"/>
<text text-anchor="middle" x="1721.5" y="-13591.2" font-family="Times,serif" font-size="16.00">GPU 9</text>
</g>
<g id="clust29" class="cluster">
<title>cluster_attention_9</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="1597,-12876 1597,-13364 1815,-13364 1815,-12876 1597,-12876"/>
<text text-anchor="middle" x="1706" y="-13347.2" font-family="Times,serif" font-size="16.00">Multi&#45;Head Attention</text>
</g>
<g id="clust30" class="cluster">
<title>cluster_mlp_9</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="1597,-12144 1597,-12617 1815,-12617 1815,-12144 1597,-12144"/>
<text text-anchor="middle" x="1706" y="-12600.2" font-family="Times,serif" font-size="16.00">MLP/MoE Layer</text>
</g>
<g id="clust31" class="cluster">
<title>cluster_gpu_10</title>
<path fill="#66ffb3" stroke="black" d="M24,-9745C24,-9745 1834,-9745 1834,-9745 1840,-9745 1846,-9751 1846,-9757 1846,-9757 1846,-11828 1846,-11828 1846,-11834 1840,-11840 1834,-11840 1834,-11840 24,-11840 24,-11840 18,-11840 12,-11834 12,-11828 12,-11828 12,-9757 12,-9757 12,-9751 18,-9745 24,-9745"/>
<text text-anchor="middle" x="929" y="-11823.2" font-family="Times,serif" font-size="16.00">GPU 10</text>
</g>
<g id="clust32" class="cluster">
<title>cluster_attention_10</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="1515,-11108 1515,-11596 1733,-11596 1733,-11108 1515,-11108"/>
<text text-anchor="middle" x="1624" y="-11579.2" font-family="Times,serif" font-size="16.00">Multi&#45;Head Attention</text>
</g>
<g id="clust33" class="cluster">
<title>cluster_mlp_10</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="20,-9983 20,-10849 1808,-10849 1808,-9983 20,-9983"/>
<text text-anchor="middle" x="914" y="-10832.2" font-family="Times,serif" font-size="16.00">MLP/MoE Layer</text>
</g>
<g id="clust34" class="cluster">
<title>cluster_gpu_11</title>
<path fill="#66b3ff" stroke="black" d="M1024,-7977C1024,-7977 1265,-7977 1265,-7977 1271,-7977 1277,-7983 1277,-7989 1277,-7989 1277,-9667 1277,-9667 1277,-9673 1271,-9679 1265,-9679 1265,-9679 1024,-9679 1024,-9679 1018,-9679 1012,-9673 1012,-9667 1012,-9667 1012,-7989 1012,-7989 1012,-7983 1018,-7977 1024,-7977"/>
<text text-anchor="middle" x="1144.5" y="-9662.2" font-family="Times,serif" font-size="16.00">GPU 11</text>
</g>
<g id="clust35" class="cluster">
<title>cluster_attention_11</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="1020,-8947 1020,-9435 1238,-9435 1238,-8947 1020,-8947"/>
<text text-anchor="middle" x="1129" y="-9418.2" font-family="Times,serif" font-size="16.00">Multi&#45;Head Attention</text>
</g>
<g id="clust36" class="cluster">
<title>cluster_mlp_11</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="1020,-8215 1020,-8688 1238,-8688 1238,-8215 1020,-8215"/>
<text text-anchor="middle" x="1129" y="-8671.2" font-family="Times,serif" font-size="16.00">MLP/MoE Layer</text>
</g>
<g id="clust37" class="cluster">
<title>cluster_gpu_12</title>
<path fill="#b366ff" stroke="black" d="M20,-5816C20,-5816 1830,-5816 1830,-5816 1836,-5816 1842,-5822 1842,-5828 1842,-5828 1842,-7899 1842,-7899 1842,-7905 1836,-7911 1830,-7911 1830,-7911 20,-7911 20,-7911 14,-7911 8,-7905 8,-7899 8,-7899 8,-5828 8,-5828 8,-5822 14,-5816 20,-5816"/>
<text text-anchor="middle" x="925" y="-7894.2" font-family="Times,serif" font-size="16.00">GPU 12</text>
</g>
<g id="clust38" class="cluster">
<title>cluster_attention_12</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="891,-7179 891,-7667 1109,-7667 1109,-7179 891,-7179"/>
<text text-anchor="middle" x="1000" y="-7650.2" font-family="Times,serif" font-size="16.00">Multi&#45;Head Attention</text>
</g>
<g id="clust39" class="cluster">
<title>cluster_mlp_12</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="16,-6054 16,-6920 1804,-6920 1804,-6054 16,-6054"/>
<text text-anchor="middle" x="910" y="-6903.2" font-family="Times,serif" font-size="16.00">MLP/MoE Layer</text>
</g>
<g id="clust40" class="cluster">
<title>cluster_gpu_13</title>
<path fill="#ff66b3" stroke="black" d="M1543,-4048C1543,-4048 1784,-4048 1784,-4048 1790,-4048 1796,-4054 1796,-4060 1796,-4060 1796,-5738 1796,-5738 1796,-5744 1790,-5750 1784,-5750 1784,-5750 1543,-5750 1543,-5750 1537,-5750 1531,-5744 1531,-5738 1531,-5738 1531,-4060 1531,-4060 1531,-4054 1537,-4048 1543,-4048"/>
<text text-anchor="middle" x="1663.5" y="-5733.2" font-family="Times,serif" font-size="16.00">GPU 13</text>
</g>
<g id="clust41" class="cluster">
<title>cluster_attention_13</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="1539,-5018 1539,-5506 1757,-5506 1757,-5018 1539,-5018"/>
<text text-anchor="middle" x="1648" y="-5489.2" font-family="Times,serif" font-size="16.00">Multi&#45;Head Attention</text>
</g>
<g id="clust42" class="cluster">
<title>cluster_mlp_13</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="1539,-4286 1539,-4759 1757,-4759 1757,-4286 1539,-4286"/>
<text text-anchor="middle" x="1648" y="-4742.2" font-family="Times,serif" font-size="16.00">MLP/MoE Layer</text>
</g>
<g id="clust43" class="cluster">
<title>cluster_gpu_14</title>
<path fill="#ffb3b3" stroke="black" d="M179,-1887C179,-1887 1989,-1887 1989,-1887 1995,-1887 2001,-1893 2001,-1899 2001,-1899 2001,-3970 2001,-3970 2001,-3976 1995,-3982 1989,-3982 1989,-3982 179,-3982 179,-3982 173,-3982 167,-3976 167,-3970 167,-3970 167,-1899 167,-1899 167,-1893 173,-1887 179,-1887"/>
<text text-anchor="middle" x="1084" y="-3965.2" font-family="Times,serif" font-size="16.00">GPU 14</text>
</g>
<g id="clust44" class="cluster">
<title>cluster_attention_14</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="1434,-3250 1434,-3738 1652,-3738 1652,-3250 1434,-3250"/>
<text text-anchor="middle" x="1543" y="-3721.2" font-family="Times,serif" font-size="16.00">Multi&#45;Head Attention</text>
</g>
<g id="clust45" class="cluster">
<title>cluster_mlp_14</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="175,-2125 175,-2991 1963,-2991 1963,-2125 175,-2125"/>
<text text-anchor="middle" x="1069" y="-2974.2" font-family="Times,serif" font-size="16.00">MLP/MoE Layer</text>
</g>
<g id="clust46" class="cluster">
<title>cluster_gpu_15</title>
<path fill="#b3b3ff" stroke="black" d="M1752,-119C1752,-119 1993,-119 1993,-119 1999,-119 2005,-125 2005,-131 2005,-131 2005,-1809 2005,-1809 2005,-1815 1999,-1821 1993,-1821 1993,-1821 1752,-1821 1752,-1821 1746,-1821 1740,-1815 1740,-1809 1740,-1809 1740,-131 1740,-131 1740,-125 1746,-119 1752,-119"/>
<text text-anchor="middle" x="1872.5" y="-1804.2" font-family="Times,serif" font-size="16.00">GPU 15</text>
</g>
<g id="clust47" class="cluster">
<title>cluster_attention_15</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="1748,-1089 1748,-1577 1966,-1577 1966,-1089 1748,-1089"/>
<text text-anchor="middle" x="1857" y="-1560.2" font-family="Times,serif" font-size="16.00">Multi&#45;Head Attention</text>
</g>
<g id="clust48" class="cluster">
<title>cluster_mlp_15</title>
<polygon fill="white" stroke="black" stroke-dasharray="5,2" points="1748,-357 1748,-830 1966,-830 1966,-357 1748,-357"/>
<text text-anchor="middle" x="1857" y="-813.2" font-family="Times,serif" font-size="16.00">MLP/MoE Layer</text>
</g>
<!-- qkv_proj_0 -->
<g id="node1" class="node">
<title>qkv_proj_0</title>
<path fill="lightgreen" stroke="black" d="M1990.5,-31207C1990.5,-31207 1811.5,-31207 1811.5,-31207 1805.5,-31207 1799.5,-31201 1799.5,-31195 1799.5,-31195 1799.5,-31151 1799.5,-31151 1799.5,-31145 1805.5,-31139 1811.5,-31139 1811.5,-31139 1990.5,-31139 1990.5,-31139 1996.5,-31139 2002.5,-31145 2002.5,-31151 2002.5,-31151 2002.5,-31195 2002.5,-31195 2002.5,-31201 1996.5,-31207 1990.5,-31207"/>
<text text-anchor="middle" x="1901" y="-31191.8" font-family="Arial" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1901" y="-31176.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1901" y="-31161.8" font-family="Arial" font-size="14.00">[1024, seq_len, 3*hidden]</text>
<text text-anchor="middle" x="1901" y="-31146.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 3*hidden/tp]</text>
</g>
<!-- attn_comp_0 -->
<g id="node2" class="node">
<title>attn_comp_0</title>
<path fill="lightyellow" stroke="black" d="M1982,-31066C1982,-31066 1834,-31066 1834,-31066 1828,-31066 1822,-31060 1822,-31054 1822,-31054 1822,-31025 1822,-31025 1822,-31019 1828,-31013 1834,-31013 1834,-31013 1982,-31013 1982,-31013 1988,-31013 1994,-31019 1994,-31025 1994,-31025 1994,-31054 1994,-31054 1994,-31060 1988,-31066 1982,-31066"/>
<text text-anchor="middle" x="1908" y="-31050.8" font-family="Arial" font-size="14.00">Attention</text>
<text text-anchor="middle" x="1908" y="-31035.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1908" y="-31020.8" font-family="Arial" font-size="14.00">Heads: 2 per GPU</text>
</g>
<!-- qkv_proj_0&#45;&gt;attn_comp_0 -->
<g id="edge1" class="edge">
<title>qkv_proj_0&#45;&gt;attn_comp_0</title>
<path fill="none" stroke="black" d="M1908,-31138.97C1908,-31138.97 1908,-31076.32 1908,-31076.32"/>
<polygon fill="black" stroke="black" points="1911.5,-31076.32 1908,-31066.32 1904.5,-31076.32 1911.5,-31076.32"/>
</g>
<!-- out_proj_0 -->
<g id="node3" class="node">
<title>out_proj_0</title>
<path fill="lightgreen" stroke="black" d="M1988.5,-30940C1988.5,-30940 1837.5,-30940 1837.5,-30940 1831.5,-30940 1825.5,-30934 1825.5,-30928 1825.5,-30928 1825.5,-30884 1825.5,-30884 1825.5,-30878 1831.5,-30872 1837.5,-30872 1837.5,-30872 1988.5,-30872 1988.5,-30872 1994.5,-30872 2000.5,-30878 2000.5,-30884 2000.5,-30884 2000.5,-30928 2000.5,-30928 2000.5,-30934 1994.5,-30940 1988.5,-30940"/>
<text text-anchor="middle" x="1913" y="-30924.8" font-family="Arial" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="1913" y="-30909.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1913" y="-30894.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1913" y="-30879.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- attn_comp_0&#45;&gt;out_proj_0 -->
<g id="edge2" class="edge">
<title>attn_comp_0&#45;&gt;out_proj_0</title>
<path fill="none" stroke="black" d="M1909.75,-31012.81C1909.75,-31012.81 1909.75,-30950.26 1909.75,-30950.26"/>
<polygon fill="black" stroke="black" points="1913.25,-30950.26 1909.75,-30940.26 1906.25,-30950.26 1913.25,-30950.26"/>
</g>
<!-- allreduce_attn_0 -->
<g id="node4" class="node">
<title>allreduce_attn_0</title>
<path fill="lightcoral" stroke="black" d="M1988.5,-30799C1988.5,-30799 1855.5,-30799 1855.5,-30799 1849.5,-30799 1843.5,-30793 1843.5,-30787 1843.5,-30787 1843.5,-30773 1843.5,-30773 1843.5,-30767 1849.5,-30761 1855.5,-30761 1855.5,-30761 1988.5,-30761 1988.5,-30761 1994.5,-30761 2000.5,-30767 2000.5,-30773 2000.5,-30773 2000.5,-30787 2000.5,-30787 2000.5,-30793 1994.5,-30799 1988.5,-30799"/>
<text text-anchor="middle" x="1922" y="-30783.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1922" y="-30768.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- out_proj_0&#45;&gt;allreduce_attn_0 -->
<g id="edge3" class="edge">
<title>out_proj_0&#45;&gt;allreduce_attn_0</title>
<path fill="none" stroke="black" d="M1922,-30871.9C1922,-30871.9 1922,-30809.24 1922,-30809.24"/>
<polygon fill="black" stroke="black" points="1925.5,-30809.24 1922,-30799.24 1918.5,-30809.24 1925.5,-30809.24"/>
</g>
<!-- residual1_0 -->
<g id="node21" class="node">
<title>residual1_0</title>
<path fill="lightgray" stroke="black" d="M2101.5,-30688C2101.5,-30688 1968.5,-30688 1968.5,-30688 1962.5,-30688 1956.5,-30682 1956.5,-30676 1956.5,-30676 1956.5,-30662 1956.5,-30662 1956.5,-30656 1962.5,-30650 1968.5,-30650 1968.5,-30650 2101.5,-30650 2101.5,-30650 2107.5,-30650 2113.5,-30656 2113.5,-30662 2113.5,-30662 2113.5,-30676 2113.5,-30676 2113.5,-30682 2107.5,-30688 2101.5,-30688"/>
<text text-anchor="middle" x="2035" y="-30672.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="2035" y="-30657.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_attn_0&#45;&gt;residual1_0 -->
<g id="edge27" class="edge">
<title>allreduce_attn_0&#45;&gt;residual1_0</title>
<path fill="none" stroke="black" d="M1978.5,-30760.92C1978.5,-30760.92 1978.5,-30698.2 1978.5,-30698.2"/>
<polygon fill="black" stroke="black" points="1982,-30698.2 1978.5,-30688.2 1975,-30698.2 1982,-30698.2"/>
</g>
<!-- dense_h_4h_0 -->
<g id="node5" class="node">
<title>dense_h_4h_0</title>
<path fill="lightblue" stroke="black" d="M1501.5,-30460C1501.5,-30460 1322.5,-30460 1322.5,-30460 1316.5,-30460 1310.5,-30454 1310.5,-30448 1310.5,-30448 1310.5,-30404 1310.5,-30404 1310.5,-30398 1316.5,-30392 1322.5,-30392 1322.5,-30392 1501.5,-30392 1501.5,-30392 1507.5,-30392 1513.5,-30398 1513.5,-30404 1513.5,-30404 1513.5,-30448 1513.5,-30448 1513.5,-30454 1507.5,-30460 1501.5,-30460"/>
<text text-anchor="middle" x="1412" y="-30444.8" font-family="Arial" font-size="14.00">Dense H→4H</text>
<text text-anchor="middle" x="1412" y="-30429.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1412" y="-30414.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
<text text-anchor="middle" x="1412" y="-30399.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- expert_gate_0 -->
<g id="node6" class="node">
<title>expert_gate_0</title>
<path fill="lightpink" stroke="black" d="M1420,-30319C1420,-30319 1272,-30319 1272,-30319 1266,-30319 1260,-30313 1260,-30307 1260,-30307 1260,-30278 1260,-30278 1260,-30272 1266,-30266 1272,-30266 1272,-30266 1420,-30266 1420,-30266 1426,-30266 1432,-30272 1432,-30278 1432,-30278 1432,-30307 1432,-30307 1432,-30313 1426,-30319 1420,-30319"/>
<text text-anchor="middle" x="1346" y="-30303.8" font-family="Arial" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1346" y="-30288.8" font-family="Arial" font-size="14.00">[1024, seq_len, 8 experts]</text>
<text text-anchor="middle" x="1346" y="-30273.8" font-family="Arial" font-size="14.00">Top&#45;2 routing</text>
</g>
<!-- dense_h_4h_0&#45;&gt;expert_gate_0 -->
<g id="edge4" class="edge">
<title>dense_h_4h_0&#45;&gt;expert_gate_0</title>
<path fill="none" stroke="black" d="M1371.25,-30391.97C1371.25,-30391.97 1371.25,-30329.32 1371.25,-30329.32"/>
<polygon fill="black" stroke="black" points="1374.75,-30329.32 1371.25,-30319.32 1367.75,-30329.32 1374.75,-30329.32"/>
</g>
<!-- expert_0_0 -->
<g id="node7" class="node">
<title>expert_0_0</title>
<path fill="lightsteelblue" stroke="black" d="M525,-30193C525,-30193 359,-30193 359,-30193 353,-30193 347,-30187 347,-30181 347,-30181 347,-30137 347,-30137 347,-30131 353,-30125 359,-30125 359,-30125 525,-30125 525,-30125 531,-30125 537,-30131 537,-30137 537,-30137 537,-30181 537,-30181 537,-30187 531,-30193 525,-30193"/>
<text text-anchor="middle" x="442" y="-30177.8" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="442" y="-30162.8" font-family="Arial" font-size="14.00">GPU 0</text>
<text text-anchor="middle" x="442" y="-30147.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="442" y="-30132.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_0&#45;&gt;expert_0_0 -->
<g id="edge5" class="edge">
<title>expert_gate_0&#45;&gt;expert_0_0</title>
<path fill="none" stroke="black" d="M1259.73,-30308C1033.77,-30308 442,-30308 442,-30308 442,-30308 442,-30203.18 442,-30203.18"/>
<polygon fill="black" stroke="black" points="445.5,-30203.18 442,-30193.18 438.5,-30203.18 445.5,-30203.18"/>
</g>
<!-- expert_0_1 -->
<g id="node8" class="node">
<title>expert_0_1</title>
<path fill="lightsteelblue" stroke="black" d="M751,-30193C751,-30193 585,-30193 585,-30193 579,-30193 573,-30187 573,-30181 573,-30181 573,-30137 573,-30137 573,-30131 579,-30125 585,-30125 585,-30125 751,-30125 751,-30125 757,-30125 763,-30131 763,-30137 763,-30137 763,-30181 763,-30181 763,-30187 757,-30193 751,-30193"/>
<text text-anchor="middle" x="668" y="-30177.8" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="668" y="-30162.8" font-family="Arial" font-size="14.00">GPU 1</text>
<text text-anchor="middle" x="668" y="-30147.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="668" y="-30132.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_0&#45;&gt;expert_0_1 -->
<g id="edge6" class="edge">
<title>expert_gate_0&#45;&gt;expert_0_1</title>
<path fill="none" stroke="black" d="M1259.79,-30297C1077.18,-30297 668,-30297 668,-30297 668,-30297 668,-30203.11 668,-30203.11"/>
<polygon fill="black" stroke="black" points="671.5,-30203.11 668,-30193.11 664.5,-30203.11 671.5,-30203.11"/>
</g>
<!-- expert_0_2 -->
<g id="node9" class="node">
<title>expert_0_2</title>
<path fill="lightsteelblue" stroke="black" d="M977,-30193C977,-30193 811,-30193 811,-30193 805,-30193 799,-30187 799,-30181 799,-30181 799,-30137 799,-30137 799,-30131 805,-30125 811,-30125 811,-30125 977,-30125 977,-30125 983,-30125 989,-30131 989,-30137 989,-30137 989,-30181 989,-30181 989,-30187 983,-30193 977,-30193"/>
<text text-anchor="middle" x="894" y="-30177.8" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="894" y="-30162.8" font-family="Arial" font-size="14.00">GPU 2</text>
<text text-anchor="middle" x="894" y="-30147.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="894" y="-30132.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_0&#45;&gt;expert_0_2 -->
<g id="edge7" class="edge">
<title>expert_gate_0&#45;&gt;expert_0_2</title>
<path fill="none" stroke="black" d="M1259.92,-30287C1128.77,-30287 894,-30287 894,-30287 894,-30287 894,-30203.3 894,-30203.3"/>
<polygon fill="black" stroke="black" points="897.5,-30203.3 894,-30193.3 890.5,-30203.3 897.5,-30203.3"/>
</g>
<!-- expert_0_3 -->
<g id="node10" class="node">
<title>expert_0_3</title>
<path fill="lightsteelblue" stroke="black" d="M1203,-30193C1203,-30193 1037,-30193 1037,-30193 1031,-30193 1025,-30187 1025,-30181 1025,-30181 1025,-30137 1025,-30137 1025,-30131 1031,-30125 1037,-30125 1037,-30125 1203,-30125 1203,-30125 1209,-30125 1215,-30131 1215,-30137 1215,-30137 1215,-30181 1215,-30181 1215,-30187 1209,-30193 1203,-30193"/>
<text text-anchor="middle" x="1120" y="-30177.8" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1120" y="-30162.8" font-family="Arial" font-size="14.00">GPU 3</text>
<text text-anchor="middle" x="1120" y="-30147.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1120" y="-30132.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_0&#45;&gt;expert_0_3 -->
<g id="edge8" class="edge">
<title>expert_gate_0&#45;&gt;expert_0_3</title>
<path fill="none" stroke="black" d="M1259.91,-30276C1196.05,-30276 1120,-30276 1120,-30276 1120,-30276 1120,-30203.16 1120,-30203.16"/>
<polygon fill="black" stroke="black" points="1123.5,-30203.16 1120,-30193.16 1116.5,-30203.16 1123.5,-30203.16"/>
</g>
<!-- expert_0_4 -->
<g id="node11" class="node">
<title>expert_0_4</title>
<path fill="lightsteelblue" stroke="black" d="M1429,-30193C1429,-30193 1263,-30193 1263,-30193 1257,-30193 1251,-30187 1251,-30181 1251,-30181 1251,-30137 1251,-30137 1251,-30131 1257,-30125 1263,-30125 1263,-30125 1429,-30125 1429,-30125 1435,-30125 1441,-30131 1441,-30137 1441,-30137 1441,-30181 1441,-30181 1441,-30187 1435,-30193 1429,-30193"/>
<text text-anchor="middle" x="1346" y="-30177.8" font-family="Arial" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1346" y="-30162.8" font-family="Arial" font-size="14.00">GPU 4</text>
<text text-anchor="middle" x="1346" y="-30147.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1346" y="-30132.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_0&#45;&gt;expert_0_4 -->
<g id="edge9" class="edge">
<title>expert_gate_0&#45;&gt;expert_0_4</title>
<path fill="none" stroke="black" d="M1346,-30265.81C1346,-30265.81 1346,-30203.26 1346,-30203.26"/>
<polygon fill="black" stroke="black" points="1349.5,-30203.26 1346,-30193.26 1342.5,-30203.26 1349.5,-30203.26"/>
</g>
<!-- expert_0_5 -->
<g id="node12" class="node">
<title>expert_0_5</title>
<path fill="lightsteelblue" stroke="black" d="M1655,-30193C1655,-30193 1489,-30193 1489,-30193 1483,-30193 1477,-30187 1477,-30181 1477,-30181 1477,-30137 1477,-30137 1477,-30131 1483,-30125 1489,-30125 1489,-30125 1655,-30125 1655,-30125 1661,-30125 1667,-30131 1667,-30137 1667,-30137 1667,-30181 1667,-30181 1667,-30187 1661,-30193 1655,-30193"/>
<text text-anchor="middle" x="1572" y="-30177.8" font-family="Arial" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1572" y="-30162.8" font-family="Arial" font-size="14.00">GPU 5</text>
<text text-anchor="middle" x="1572" y="-30147.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1572" y="-30132.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_0&#45;&gt;expert_0_5 -->
<g id="edge10" class="edge">
<title>expert_gate_0&#45;&gt;expert_0_5</title>
<path fill="none" stroke="black" d="M1432.39,-30279C1465.39,-30279 1495.25,-30279 1495.25,-30279 1495.25,-30279 1495.25,-30203.07 1495.25,-30203.07"/>
<polygon fill="black" stroke="black" points="1498.75,-30203.07 1495.25,-30193.07 1491.75,-30203.07 1498.75,-30203.07"/>
</g>
<!-- expert_0_6 -->
<g id="node13" class="node">
<title>expert_0_6</title>
<path fill="lightsteelblue" stroke="black" d="M1881,-30193C1881,-30193 1715,-30193 1715,-30193 1709,-30193 1703,-30187 1703,-30181 1703,-30181 1703,-30137 1703,-30137 1703,-30131 1709,-30125 1715,-30125 1715,-30125 1881,-30125 1881,-30125 1887,-30125 1893,-30131 1893,-30137 1893,-30137 1893,-30181 1893,-30181 1893,-30187 1887,-30193 1881,-30193"/>
<text text-anchor="middle" x="1798" y="-30177.8" font-family="Arial" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="1798" y="-30162.8" font-family="Arial" font-size="14.00">GPU 6</text>
<text text-anchor="middle" x="1798" y="-30147.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1798" y="-30132.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_0&#45;&gt;expert_0_6 -->
<g id="edge11" class="edge">
<title>expert_gate_0&#45;&gt;expert_0_6</title>
<path fill="none" stroke="black" d="M1432.15,-30292C1544.74,-30292 1727.75,-30292 1727.75,-30292 1727.75,-30292 1727.75,-30203.25 1727.75,-30203.25"/>
<polygon fill="black" stroke="black" points="1731.25,-30203.25 1727.75,-30193.25 1724.25,-30203.25 1731.25,-30203.25"/>
</g>
<!-- expert_0_7 -->
<g id="node14" class="node">
<title>expert_0_7</title>
<path fill="lightsteelblue" stroke="black" d="M2107,-30193C2107,-30193 1941,-30193 1941,-30193 1935,-30193 1929,-30187 1929,-30181 1929,-30181 1929,-30137 1929,-30137 1929,-30131 1935,-30125 1941,-30125 1941,-30125 2107,-30125 2107,-30125 2113,-30125 2119,-30131 2119,-30137 2119,-30137 2119,-30181 2119,-30181 2119,-30187 2113,-30193 2107,-30193"/>
<text text-anchor="middle" x="2024" y="-30177.8" font-family="Arial" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2024" y="-30162.8" font-family="Arial" font-size="14.00">GPU 7</text>
<text text-anchor="middle" x="2024" y="-30147.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="2024" y="-30132.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_0&#45;&gt;expert_0_7 -->
<g id="edge12" class="edge">
<title>expert_gate_0&#45;&gt;expert_0_7</title>
<path fill="none" stroke="black" d="M1432.14,-30305C1597.39,-30305 1942.75,-30305 1942.75,-30305 1942.75,-30305 1942.75,-30203.23 1942.75,-30203.23"/>
<polygon fill="black" stroke="black" points="1946.25,-30203.23 1942.75,-30193.23 1939.25,-30203.23 1946.25,-30203.23"/>
</g>
<!-- expert_agg_0 -->
<g id="node15" class="node">
<title>expert_agg_0</title>
<path fill="lightsalmon" stroke="black" d="M1421.5,-30052C1421.5,-30052 1270.5,-30052 1270.5,-30052 1264.5,-30052 1258.5,-30046 1258.5,-30040 1258.5,-30040 1258.5,-30011 1258.5,-30011 1258.5,-30005 1264.5,-29999 1270.5,-29999 1270.5,-29999 1421.5,-29999 1421.5,-29999 1427.5,-29999 1433.5,-30005 1433.5,-30011 1433.5,-30011 1433.5,-30040 1433.5,-30040 1433.5,-30046 1427.5,-30052 1421.5,-30052"/>
<text text-anchor="middle" x="1346" y="-30036.8" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1346" y="-30021.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1346" y="-30006.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- expert_0_0&#45;&gt;expert_agg_0 -->
<g id="edge13" class="edge">
<title>expert_0_0&#45;&gt;expert_agg_0</title>
<path fill="none" stroke="black" d="M472,-30124.96C472,-30080.71 472,-30009 472,-30009 472,-30009 1248.2,-30009 1248.2,-30009"/>
<polygon fill="black" stroke="black" points="1248.2,-30012.5 1258.2,-30009 1248.2,-30005.5 1248.2,-30012.5"/>
</g>
<!-- expert_0_1&#45;&gt;expert_agg_0 -->
<g id="edge14" class="edge">
<title>expert_0_1&#45;&gt;expert_agg_0</title>
<path fill="none" stroke="black" d="M698,-30125C698,-30083.85 698,-30020 698,-30020 698,-30020 1248.27,-30020 1248.27,-30020"/>
<polygon fill="black" stroke="black" points="1248.27,-30023.5 1258.27,-30020 1248.27,-30016.5 1248.27,-30023.5"/>
</g>
<!-- expert_0_2&#45;&gt;expert_agg_0 -->
<g id="edge15" class="edge">
<title>expert_0_2&#45;&gt;expert_agg_0</title>
<path fill="none" stroke="black" d="M924,-30124.77C924,-30086.55 924,-30030 924,-30030 924,-30030 1248.31,-30030 1248.31,-30030"/>
<polygon fill="black" stroke="black" points="1248.31,-30033.5 1258.31,-30030 1248.31,-30026.5 1248.31,-30033.5"/>
</g>
<!-- expert_0_3&#45;&gt;expert_agg_0 -->
<g id="edge16" class="edge">
<title>expert_0_3&#45;&gt;expert_agg_0</title>
<path fill="none" stroke="black" d="M1154.5,-30124.87C1154.5,-30090.02 1154.5,-30041 1154.5,-30041 1154.5,-30041 1248.38,-30041 1248.38,-30041"/>
<polygon fill="black" stroke="black" points="1248.38,-30044.5 1258.38,-30041 1248.38,-30037.5 1248.38,-30044.5"/>
</g>
<!-- expert_0_4&#45;&gt;expert_agg_0 -->
<g id="edge17" class="edge">
<title>expert_0_4&#45;&gt;expert_agg_0</title>
<path fill="none" stroke="black" d="M1346,-30124.97C1346,-30124.97 1346,-30062.32 1346,-30062.32"/>
<polygon fill="black" stroke="black" points="1349.5,-30062.32 1346,-30052.32 1342.5,-30062.32 1349.5,-30062.32"/>
</g>
<!-- expert_0_5&#45;&gt;expert_agg_0 -->
<g id="edge18" class="edge">
<title>expert_0_5&#45;&gt;expert_agg_0</title>
<path fill="none" stroke="black" d="M1483.75,-30124.97C1483.75,-30089.18 1483.75,-30038 1483.75,-30038 1483.75,-30038 1443.63,-30038 1443.63,-30038"/>
<polygon fill="black" stroke="black" points="1443.63,-30034.5 1433.63,-30038 1443.63,-30041.5 1443.63,-30034.5"/>
</g>
<!-- expert_0_6&#45;&gt;expert_agg_0 -->
<g id="edge19" class="edge">
<title>expert_0_6&#45;&gt;expert_agg_0</title>
<path fill="none" stroke="black" d="M1779,-30124.84C1779,-30085.14 1779,-30025 1779,-30025 1779,-30025 1443.62,-30025 1443.62,-30025"/>
<polygon fill="black" stroke="black" points="1443.62,-30021.5 1433.62,-30025 1443.62,-30028.5 1443.62,-30021.5"/>
</g>
<!-- expert_0_7&#45;&gt;expert_agg_0 -->
<g id="edge20" class="edge">
<title>expert_0_7&#45;&gt;expert_agg_0</title>
<path fill="none" stroke="black" d="M1941.75,-30124.91C1941.75,-30081.48 1941.75,-30012 1941.75,-30012 1941.75,-30012 1443.58,-30012 1443.58,-30012"/>
<polygon fill="black" stroke="black" points="1443.58,-30008.5 1433.58,-30012 1443.58,-30015.5 1443.58,-30008.5"/>
</g>
<!-- activation_0 -->
<g id="node16" class="node">
<title>activation_0</title>
<path fill="lightyellow" stroke="black" d="M1696.5,-29926C1696.5,-29926 1535.5,-29926 1535.5,-29926 1529.5,-29926 1523.5,-29920 1523.5,-29914 1523.5,-29914 1523.5,-29900 1523.5,-29900 1523.5,-29894 1529.5,-29888 1535.5,-29888 1535.5,-29888 1696.5,-29888 1696.5,-29888 1702.5,-29888 1708.5,-29894 1708.5,-29900 1708.5,-29900 1708.5,-29914 1708.5,-29914 1708.5,-29920 1702.5,-29926 1696.5,-29926"/>
<text text-anchor="middle" x="1616" y="-29910.8" font-family="Arial" font-size="14.00">GELU</text>
<text text-anchor="middle" x="1616" y="-29895.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- expert_agg_0&#45;&gt;activation_0 -->
<g id="edge21" class="edge">
<title>expert_agg_0&#45;&gt;activation_0</title>
<path fill="none" stroke="black" d="M1388,-29998.91C1388,-29963.97 1388,-29907 1388,-29907 1388,-29907 1513.26,-29907 1513.26,-29907"/>
<polygon fill="black" stroke="black" points="1513.26,-29910.5 1523.26,-29907 1513.26,-29903.5 1513.26,-29910.5"/>
</g>
<!-- dense_4h_h_0 -->
<g id="node17" class="node">
<title>dense_4h_h_0</title>
<path fill="lightblue" stroke="black" d="M1837.5,-29815C1837.5,-29815 1676.5,-29815 1676.5,-29815 1670.5,-29815 1664.5,-29809 1664.5,-29803 1664.5,-29803 1664.5,-29759 1664.5,-29759 1664.5,-29753 1670.5,-29747 1676.5,-29747 1676.5,-29747 1837.5,-29747 1837.5,-29747 1843.5,-29747 1849.5,-29753 1849.5,-29759 1849.5,-29759 1849.5,-29803 1849.5,-29803 1849.5,-29809 1843.5,-29815 1837.5,-29815"/>
<text text-anchor="middle" x="1757" y="-29799.8" font-family="Arial" font-size="14.00">Dense 4H→H</text>
<text text-anchor="middle" x="1757" y="-29784.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1757" y="-29769.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1757" y="-29754.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- activation_0&#45;&gt;dense_4h_h_0 -->
<g id="edge22" class="edge">
<title>activation_0&#45;&gt;dense_4h_h_0</title>
<path fill="none" stroke="black" d="M1686.5,-29887.86C1686.5,-29887.86 1686.5,-29825.07 1686.5,-29825.07"/>
<polygon fill="black" stroke="black" points="1690,-29825.07 1686.5,-29815.07 1683,-29825.07 1690,-29825.07"/>
</g>
<!-- allreduce_mlp_0 -->
<g id="node18" class="node">
<title>allreduce_mlp_0</title>
<path fill="lightcoral" stroke="black" d="M1907.5,-29674C1907.5,-29674 1774.5,-29674 1774.5,-29674 1768.5,-29674 1762.5,-29668 1762.5,-29662 1762.5,-29662 1762.5,-29648 1762.5,-29648 1762.5,-29642 1768.5,-29636 1774.5,-29636 1774.5,-29636 1907.5,-29636 1907.5,-29636 1913.5,-29636 1919.5,-29642 1919.5,-29648 1919.5,-29648 1919.5,-29662 1919.5,-29662 1919.5,-29668 1913.5,-29674 1907.5,-29674"/>
<text text-anchor="middle" x="1841" y="-29658.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1841" y="-29643.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- dense_4h_h_0&#45;&gt;allreduce_mlp_0 -->
<g id="edge23" class="edge">
<title>dense_4h_h_0&#45;&gt;allreduce_mlp_0</title>
<path fill="none" stroke="black" d="M1806,-29746.9C1806,-29746.9 1806,-29684.24 1806,-29684.24"/>
<polygon fill="black" stroke="black" points="1809.5,-29684.24 1806,-29674.24 1802.5,-29684.24 1809.5,-29684.24"/>
</g>
<!-- residual2_0 -->
<g id="node23" class="node">
<title>residual2_0</title>
<path fill="lightgray" stroke="black" d="M1942.5,-29563C1942.5,-29563 1809.5,-29563 1809.5,-29563 1803.5,-29563 1797.5,-29557 1797.5,-29551 1797.5,-29551 1797.5,-29537 1797.5,-29537 1797.5,-29531 1803.5,-29525 1809.5,-29525 1809.5,-29525 1942.5,-29525 1942.5,-29525 1948.5,-29525 1954.5,-29531 1954.5,-29537 1954.5,-29537 1954.5,-29551 1954.5,-29551 1954.5,-29557 1948.5,-29563 1942.5,-29563"/>
<text text-anchor="middle" x="1876" y="-29547.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1876" y="-29532.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_mlp_0&#45;&gt;residual2_0 -->
<g id="edge31" class="edge">
<title>allreduce_mlp_0&#45;&gt;residual2_0</title>
<path fill="none" stroke="black" d="M1858.5,-29635.92C1858.5,-29635.92 1858.5,-29573.2 1858.5,-29573.2"/>
<polygon fill="black" stroke="black" points="1862,-29573.2 1858.5,-29563.2 1855,-29573.2 1862,-29573.2"/>
</g>
<!-- input_0 -->
<g id="node19" class="node">
<title>input_0</title>
<ellipse fill="white" stroke="black" cx="2007" cy="-31424" rx="111" ry="27"/>
<text text-anchor="middle" x="2007" y="-31427.8" font-family="Arial" font-size="14.00">Layer 1 Input</text>
<text text-anchor="middle" x="2007" y="-31412.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- norm1_0 -->
<g id="node20" class="node">
<title>norm1_0</title>
<path fill="lightcyan" stroke="black" d="M1979.5,-31324C1979.5,-31324 1846.5,-31324 1846.5,-31324 1840.5,-31324 1834.5,-31318 1834.5,-31312 1834.5,-31312 1834.5,-31298 1834.5,-31298 1834.5,-31292 1840.5,-31286 1846.5,-31286 1846.5,-31286 1979.5,-31286 1979.5,-31286 1985.5,-31286 1991.5,-31292 1991.5,-31298 1991.5,-31298 1991.5,-31312 1991.5,-31312 1991.5,-31318 1985.5,-31324 1979.5,-31324"/>
<text text-anchor="middle" x="1913" y="-31308.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1913" y="-31293.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- input_0&#45;&gt;norm1_0 -->
<g id="edge24" class="edge">
<title>input_0&#45;&gt;norm1_0</title>
<path fill="none" stroke="black" d="M1943.75,-31401.62C1943.75,-31401.62 1943.75,-31334.14 1943.75,-31334.14"/>
<polygon fill="black" stroke="black" points="1947.25,-31334.14 1943.75,-31324.14 1940.25,-31334.14 1947.25,-31334.14"/>
</g>
<!-- input_0&#45;&gt;residual1_0 -->
<g id="edge25" class="edge">
<title>input_0&#45;&gt;residual1_0</title>
<path fill="none" stroke="black" d="M2058,-31399.73C2058,-31399.73 2058,-30698.15 2058,-30698.15"/>
<polygon fill="black" stroke="black" points="2061.5,-30698.15 2058,-30688.15 2054.5,-30698.15 2061.5,-30698.15"/>
</g>
<!-- norm1_0&#45;&gt;qkv_proj_0 -->
<g id="edge26" class="edge">
<title>norm1_0&#45;&gt;qkv_proj_0</title>
<path fill="none" stroke="black" d="M1913,-31285.81C1913,-31285.81 1913,-31217.06 1913,-31217.06"/>
<polygon fill="black" stroke="black" points="1916.5,-31217.06 1913,-31207.06 1909.5,-31217.06 1916.5,-31217.06"/>
</g>
<!-- norm2_0 -->
<g id="node22" class="node">
<title>norm2_0</title>
<path fill="lightcyan" stroke="black" d="M1740.5,-30577C1740.5,-30577 1607.5,-30577 1607.5,-30577 1601.5,-30577 1595.5,-30571 1595.5,-30565 1595.5,-30565 1595.5,-30551 1595.5,-30551 1595.5,-30545 1601.5,-30539 1607.5,-30539 1607.5,-30539 1740.5,-30539 1740.5,-30539 1746.5,-30539 1752.5,-30545 1752.5,-30551 1752.5,-30551 1752.5,-30565 1752.5,-30565 1752.5,-30571 1746.5,-30577 1740.5,-30577"/>
<text text-anchor="middle" x="1674" y="-30561.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1674" y="-30546.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual1_0&#45;&gt;norm2_0 -->
<g id="edge28" class="edge">
<title>residual1_0&#45;&gt;norm2_0</title>
<path fill="none" stroke="black" d="M1956.22,-30675C1850,-30675 1674,-30675 1674,-30675 1674,-30675 1674,-30587.06 1674,-30587.06"/>
<polygon fill="black" stroke="black" points="1677.5,-30587.06 1674,-30577.06 1670.5,-30587.06 1677.5,-30587.06"/>
</g>
<!-- residual1_0&#45;&gt;residual2_0 -->
<g id="edge29" class="edge">
<title>residual1_0&#45;&gt;residual2_0</title>
<path fill="none" stroke="black" d="M1956.28,-30662C1938.24,-30662 1924.25,-30662 1924.25,-30662 1924.25,-30662 1924.25,-29573.4 1924.25,-29573.4"/>
<polygon fill="black" stroke="black" points="1927.75,-29573.4 1924.25,-29563.4 1920.75,-29573.41 1927.75,-29573.4"/>
</g>
<!-- norm2_0&#45;&gt;dense_h_4h_0 -->
<g id="edge30" class="edge">
<title>norm2_0&#45;&gt;dense_h_4h_0</title>
<path fill="none" stroke="black" d="M1631.25,-30538.81C1631.25,-30502.2 1631.25,-30426 1631.25,-30426 1631.25,-30426 1523.6,-30426 1523.6,-30426"/>
<polygon fill="black" stroke="black" points="1523.6,-30422.5 1513.6,-30426 1523.6,-30429.5 1523.6,-30422.5"/>
</g>
<!-- output_0 -->
<g id="node24" class="node">
<title>output_0</title>
<ellipse fill="white" stroke="black" cx="1876" cy="-29425" rx="111" ry="27"/>
<text text-anchor="middle" x="1876" y="-29428.8" font-family="Arial" font-size="14.00">Layer 1 Output</text>
<text text-anchor="middle" x="1876" y="-29413.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual2_0&#45;&gt;output_0 -->
<g id="edge32" class="edge">
<title>residual2_0&#45;&gt;output_0</title>
<path fill="none" stroke="black" d="M1876,-29524.88C1876,-29524.88 1876,-29462.05 1876,-29462.05"/>
<polygon fill="black" stroke="black" points="1879.5,-29462.05 1876,-29452.05 1872.5,-29462.05 1879.5,-29462.05"/>
</g>
<!-- input_1 -->
<g id="node33" class="node">
<title>input_1</title>
<ellipse fill="white" stroke="black" cx="1876" cy="-29263" rx="111" ry="27"/>
<text text-anchor="middle" x="1876" y="-29266.8" font-family="Arial" font-size="14.00">Layer 2 Input</text>
<text text-anchor="middle" x="1876" y="-29251.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- output_0&#45;&gt;input_1 -->
<g id="edge378" class="edge">
<title>output_0&#45;&gt;input_1</title>
<path fill="none" stroke="red" stroke-width="2" stroke-dasharray="5,2" d="M1876,-29397.88C1876,-29397.88 1876,-29300.2 1876,-29300.2"/>
<polygon fill="red" stroke="red" stroke-width="2" points="1879.5,-29300.2 1876,-29290.2 1872.5,-29300.2 1879.5,-29300.2"/>
<text text-anchor="middle" x="1932" y="-29350.8" font-family="Times,serif" font-size="14.00">GPU&#45;to&#45;GPU</text>
<text text-anchor="middle" x="1932" y="-29335.8" font-family="Times,serif" font-size="14.00">Communication</text>
</g>
<!-- qkv_proj_1 -->
<g id="node25" class="node">
<title>qkv_proj_1</title>
<path fill="lightgreen" stroke="black" d="M1950.5,-29046C1950.5,-29046 1771.5,-29046 1771.5,-29046 1765.5,-29046 1759.5,-29040 1759.5,-29034 1759.5,-29034 1759.5,-28990 1759.5,-28990 1759.5,-28984 1765.5,-28978 1771.5,-28978 1771.5,-28978 1950.5,-28978 1950.5,-28978 1956.5,-28978 1962.5,-28984 1962.5,-28990 1962.5,-28990 1962.5,-29034 1962.5,-29034 1962.5,-29040 1956.5,-29046 1950.5,-29046"/>
<text text-anchor="middle" x="1861" y="-29030.8" font-family="Arial" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1861" y="-29015.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1861" y="-29000.8" font-family="Arial" font-size="14.00">[1024, seq_len, 3*hidden]</text>
<text text-anchor="middle" x="1861" y="-28985.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 3*hidden/tp]</text>
</g>
<!-- attn_comp_1 -->
<g id="node26" class="node">
<title>attn_comp_1</title>
<path fill="lightyellow" stroke="black" d="M1940,-28905C1940,-28905 1792,-28905 1792,-28905 1786,-28905 1780,-28899 1780,-28893 1780,-28893 1780,-28864 1780,-28864 1780,-28858 1786,-28852 1792,-28852 1792,-28852 1940,-28852 1940,-28852 1946,-28852 1952,-28858 1952,-28864 1952,-28864 1952,-28893 1952,-28893 1952,-28899 1946,-28905 1940,-28905"/>
<text text-anchor="middle" x="1866" y="-28889.8" font-family="Arial" font-size="14.00">Attention</text>
<text text-anchor="middle" x="1866" y="-28874.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1866" y="-28859.8" font-family="Arial" font-size="14.00">Heads: 2 per GPU</text>
</g>
<!-- qkv_proj_1&#45;&gt;attn_comp_1 -->
<g id="edge33" class="edge">
<title>qkv_proj_1&#45;&gt;attn_comp_1</title>
<path fill="none" stroke="black" d="M1866,-28977.97C1866,-28977.97 1866,-28915.32 1866,-28915.32"/>
<polygon fill="black" stroke="black" points="1869.5,-28915.32 1866,-28905.32 1862.5,-28915.32 1869.5,-28915.32"/>
</g>
<!-- out_proj_1 -->
<g id="node27" class="node">
<title>out_proj_1</title>
<path fill="lightgreen" stroke="black" d="M1945.5,-28779C1945.5,-28779 1794.5,-28779 1794.5,-28779 1788.5,-28779 1782.5,-28773 1782.5,-28767 1782.5,-28767 1782.5,-28723 1782.5,-28723 1782.5,-28717 1788.5,-28711 1794.5,-28711 1794.5,-28711 1945.5,-28711 1945.5,-28711 1951.5,-28711 1957.5,-28717 1957.5,-28723 1957.5,-28723 1957.5,-28767 1957.5,-28767 1957.5,-28773 1951.5,-28779 1945.5,-28779"/>
<text text-anchor="middle" x="1870" y="-28763.8" font-family="Arial" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="1870" y="-28748.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1870" y="-28733.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1870" y="-28718.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- attn_comp_1&#45;&gt;out_proj_1 -->
<g id="edge34" class="edge">
<title>attn_comp_1&#45;&gt;out_proj_1</title>
<path fill="none" stroke="black" d="M1867.25,-28851.81C1867.25,-28851.81 1867.25,-28789.26 1867.25,-28789.26"/>
<polygon fill="black" stroke="black" points="1870.75,-28789.26 1867.25,-28779.26 1863.75,-28789.26 1870.75,-28789.26"/>
</g>
<!-- allreduce_attn_1 -->
<g id="node28" class="node">
<title>allreduce_attn_1</title>
<path fill="lightcoral" stroke="black" d="M1938.5,-28638C1938.5,-28638 1805.5,-28638 1805.5,-28638 1799.5,-28638 1793.5,-28632 1793.5,-28626 1793.5,-28626 1793.5,-28612 1793.5,-28612 1793.5,-28606 1799.5,-28600 1805.5,-28600 1805.5,-28600 1938.5,-28600 1938.5,-28600 1944.5,-28600 1950.5,-28606 1950.5,-28612 1950.5,-28612 1950.5,-28626 1950.5,-28626 1950.5,-28632 1944.5,-28638 1938.5,-28638"/>
<text text-anchor="middle" x="1872" y="-28622.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1872" y="-28607.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- out_proj_1&#45;&gt;allreduce_attn_1 -->
<g id="edge35" class="edge">
<title>out_proj_1&#45;&gt;allreduce_attn_1</title>
<path fill="none" stroke="black" d="M1872,-28710.9C1872,-28710.9 1872,-28648.24 1872,-28648.24"/>
<polygon fill="black" stroke="black" points="1875.5,-28648.24 1872,-28638.24 1868.5,-28648.24 1875.5,-28648.24"/>
</g>
<!-- residual1_1 -->
<g id="node35" class="node">
<title>residual1_1</title>
<path fill="lightgray" stroke="black" d="M1969.5,-28527C1969.5,-28527 1836.5,-28527 1836.5,-28527 1830.5,-28527 1824.5,-28521 1824.5,-28515 1824.5,-28515 1824.5,-28501 1824.5,-28501 1824.5,-28495 1830.5,-28489 1836.5,-28489 1836.5,-28489 1969.5,-28489 1969.5,-28489 1975.5,-28489 1981.5,-28495 1981.5,-28501 1981.5,-28501 1981.5,-28515 1981.5,-28515 1981.5,-28521 1975.5,-28527 1969.5,-28527"/>
<text text-anchor="middle" x="1903" y="-28511.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1903" y="-28496.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_attn_1&#45;&gt;residual1_1 -->
<g id="edge42" class="edge">
<title>allreduce_attn_1&#45;&gt;residual1_1</title>
<path fill="none" stroke="black" d="M1887.5,-28599.92C1887.5,-28599.92 1887.5,-28537.2 1887.5,-28537.2"/>
<polygon fill="black" stroke="black" points="1891,-28537.2 1887.5,-28527.2 1884,-28537.2 1891,-28537.2"/>
</g>
<!-- dense_h_4h_1 -->
<g id="node29" class="node">
<title>dense_h_4h_1</title>
<path fill="lightblue" stroke="black" d="M1950.5,-28299C1950.5,-28299 1771.5,-28299 1771.5,-28299 1765.5,-28299 1759.5,-28293 1759.5,-28287 1759.5,-28287 1759.5,-28243 1759.5,-28243 1759.5,-28237 1765.5,-28231 1771.5,-28231 1771.5,-28231 1950.5,-28231 1950.5,-28231 1956.5,-28231 1962.5,-28237 1962.5,-28243 1962.5,-28243 1962.5,-28287 1962.5,-28287 1962.5,-28293 1956.5,-28299 1950.5,-28299"/>
<text text-anchor="middle" x="1861" y="-28283.8" font-family="Arial" font-size="14.00">Dense H→4H</text>
<text text-anchor="middle" x="1861" y="-28268.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1861" y="-28253.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
<text text-anchor="middle" x="1861" y="-28238.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- activation_1 -->
<g id="node30" class="node">
<title>activation_1</title>
<path fill="lightyellow" stroke="black" d="M1946.5,-28158C1946.5,-28158 1785.5,-28158 1785.5,-28158 1779.5,-28158 1773.5,-28152 1773.5,-28146 1773.5,-28146 1773.5,-28132 1773.5,-28132 1773.5,-28126 1779.5,-28120 1785.5,-28120 1785.5,-28120 1946.5,-28120 1946.5,-28120 1952.5,-28120 1958.5,-28126 1958.5,-28132 1958.5,-28132 1958.5,-28146 1958.5,-28146 1958.5,-28152 1952.5,-28158 1946.5,-28158"/>
<text text-anchor="middle" x="1866" y="-28142.8" font-family="Arial" font-size="14.00">GELU</text>
<text text-anchor="middle" x="1866" y="-28127.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- dense_h_4h_1&#45;&gt;activation_1 -->
<g id="edge36" class="edge">
<title>dense_h_4h_1&#45;&gt;activation_1</title>
<path fill="none" stroke="black" d="M1866,-28230.9C1866,-28230.9 1866,-28168.24 1866,-28168.24"/>
<polygon fill="black" stroke="black" points="1869.5,-28168.24 1866,-28158.24 1862.5,-28168.24 1869.5,-28168.24"/>
</g>
<!-- dense_4h_h_1 -->
<g id="node31" class="node">
<title>dense_4h_h_1</title>
<path fill="lightblue" stroke="black" d="M1949.5,-28047C1949.5,-28047 1788.5,-28047 1788.5,-28047 1782.5,-28047 1776.5,-28041 1776.5,-28035 1776.5,-28035 1776.5,-27991 1776.5,-27991 1776.5,-27985 1782.5,-27979 1788.5,-27979 1788.5,-27979 1949.5,-27979 1949.5,-27979 1955.5,-27979 1961.5,-27985 1961.5,-27991 1961.5,-27991 1961.5,-28035 1961.5,-28035 1961.5,-28041 1955.5,-28047 1949.5,-28047"/>
<text text-anchor="middle" x="1869" y="-28031.8" font-family="Arial" font-size="14.00">Dense 4H→H</text>
<text text-anchor="middle" x="1869" y="-28016.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1869" y="-28001.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1869" y="-27986.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- activation_1&#45;&gt;dense_4h_h_1 -->
<g id="edge37" class="edge">
<title>activation_1&#45;&gt;dense_4h_h_1</title>
<path fill="none" stroke="black" d="M1867.5,-28119.86C1867.5,-28119.86 1867.5,-28057.07 1867.5,-28057.07"/>
<polygon fill="black" stroke="black" points="1871,-28057.07 1867.5,-28047.07 1864,-28057.07 1871,-28057.07"/>
</g>
<!-- allreduce_mlp_1 -->
<g id="node32" class="node">
<title>allreduce_mlp_1</title>
<path fill="lightcoral" stroke="black" d="M1942.5,-27906C1942.5,-27906 1809.5,-27906 1809.5,-27906 1803.5,-27906 1797.5,-27900 1797.5,-27894 1797.5,-27894 1797.5,-27880 1797.5,-27880 1797.5,-27874 1803.5,-27868 1809.5,-27868 1809.5,-27868 1942.5,-27868 1942.5,-27868 1948.5,-27868 1954.5,-27874 1954.5,-27880 1954.5,-27880 1954.5,-27894 1954.5,-27894 1954.5,-27900 1948.5,-27906 1942.5,-27906"/>
<text text-anchor="middle" x="1876" y="-27890.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1876" y="-27875.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- dense_4h_h_1&#45;&gt;allreduce_mlp_1 -->
<g id="edge38" class="edge">
<title>dense_4h_h_1&#45;&gt;allreduce_mlp_1</title>
<path fill="none" stroke="black" d="M1876,-27978.9C1876,-27978.9 1876,-27916.24 1876,-27916.24"/>
<polygon fill="black" stroke="black" points="1879.5,-27916.24 1876,-27906.24 1872.5,-27916.24 1879.5,-27916.24"/>
</g>
<!-- residual2_1 -->
<g id="node37" class="node">
<title>residual2_1</title>
<path fill="lightgray" stroke="black" d="M1943.5,-27795C1943.5,-27795 1810.5,-27795 1810.5,-27795 1804.5,-27795 1798.5,-27789 1798.5,-27783 1798.5,-27783 1798.5,-27769 1798.5,-27769 1798.5,-27763 1804.5,-27757 1810.5,-27757 1810.5,-27757 1943.5,-27757 1943.5,-27757 1949.5,-27757 1955.5,-27763 1955.5,-27769 1955.5,-27769 1955.5,-27783 1955.5,-27783 1955.5,-27789 1949.5,-27795 1943.5,-27795"/>
<text text-anchor="middle" x="1877" y="-27779.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1877" y="-27764.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_mlp_1&#45;&gt;residual2_1 -->
<g id="edge46" class="edge">
<title>allreduce_mlp_1&#45;&gt;residual2_1</title>
<path fill="none" stroke="black" d="M1876.5,-27867.92C1876.5,-27867.92 1876.5,-27805.2 1876.5,-27805.2"/>
<polygon fill="black" stroke="black" points="1880,-27805.2 1876.5,-27795.2 1873,-27805.2 1880,-27805.2"/>
</g>
<!-- norm1_1 -->
<g id="node34" class="node">
<title>norm1_1</title>
<path fill="lightcyan" stroke="black" d="M1938.5,-29163C1938.5,-29163 1805.5,-29163 1805.5,-29163 1799.5,-29163 1793.5,-29157 1793.5,-29151 1793.5,-29151 1793.5,-29137 1793.5,-29137 1793.5,-29131 1799.5,-29125 1805.5,-29125 1805.5,-29125 1938.5,-29125 1938.5,-29125 1944.5,-29125 1950.5,-29131 1950.5,-29137 1950.5,-29137 1950.5,-29151 1950.5,-29151 1950.5,-29157 1944.5,-29163 1938.5,-29163"/>
<text text-anchor="middle" x="1872" y="-29147.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1872" y="-29132.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- input_1&#45;&gt;norm1_1 -->
<g id="edge39" class="edge">
<title>input_1&#45;&gt;norm1_1</title>
<path fill="none" stroke="black" d="M1872,-29236C1872,-29236 1872,-29173.12 1872,-29173.12"/>
<polygon fill="black" stroke="black" points="1875.5,-29173.12 1872,-29163.12 1868.5,-29173.12 1875.5,-29173.12"/>
</g>
<!-- input_1&#45;&gt;residual1_1 -->
<g id="edge40" class="edge">
<title>input_1&#45;&gt;residual1_1</title>
<path fill="none" stroke="black" d="M1972,-29249.25C1972,-29249.25 1972,-28537.24 1972,-28537.24"/>
<polygon fill="black" stroke="black" points="1975.5,-28537.24 1972,-28527.24 1968.5,-28537.24 1975.5,-28537.24"/>
</g>
<!-- norm1_1&#45;&gt;qkv_proj_1 -->
<g id="edge41" class="edge">
<title>norm1_1&#45;&gt;qkv_proj_1</title>
<path fill="none" stroke="black" d="M1872,-29124.81C1872,-29124.81 1872,-29056.06 1872,-29056.06"/>
<polygon fill="black" stroke="black" points="1875.5,-29056.06 1872,-29046.06 1868.5,-29056.06 1875.5,-29056.06"/>
</g>
<!-- norm2_1 -->
<g id="node36" class="node">
<title>norm2_1</title>
<path fill="lightcyan" stroke="black" d="M1939.5,-28416C1939.5,-28416 1806.5,-28416 1806.5,-28416 1800.5,-28416 1794.5,-28410 1794.5,-28404 1794.5,-28404 1794.5,-28390 1794.5,-28390 1794.5,-28384 1800.5,-28378 1806.5,-28378 1806.5,-28378 1939.5,-28378 1939.5,-28378 1945.5,-28378 1951.5,-28384 1951.5,-28390 1951.5,-28390 1951.5,-28404 1951.5,-28404 1951.5,-28410 1945.5,-28416 1939.5,-28416"/>
<text text-anchor="middle" x="1873" y="-28400.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1873" y="-28385.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual1_1&#45;&gt;norm2_1 -->
<g id="edge43" class="edge">
<title>residual1_1&#45;&gt;norm2_1</title>
<path fill="none" stroke="black" d="M1888,-28488.92C1888,-28488.92 1888,-28426.2 1888,-28426.2"/>
<polygon fill="black" stroke="black" points="1891.5,-28426.2 1888,-28416.2 1884.5,-28426.2 1891.5,-28426.2"/>
</g>
<!-- residual1_1&#45;&gt;residual2_1 -->
<g id="edge44" class="edge">
<title>residual1_1&#45;&gt;residual2_1</title>
<path fill="none" stroke="black" d="M1972,-28488.8C1972,-28373.3 1972,-27776 1972,-27776 1972,-27776 1965.88,-27776 1965.88,-27776"/>
<polygon fill="black" stroke="black" points="1965.88,-27772.5 1955.88,-27776 1965.88,-27779.5 1965.88,-27772.5"/>
</g>
<!-- norm2_1&#45;&gt;dense_h_4h_1 -->
<g id="edge45" class="edge">
<title>norm2_1&#45;&gt;dense_h_4h_1</title>
<path fill="none" stroke="black" d="M1873,-28377.81C1873,-28377.81 1873,-28309.06 1873,-28309.06"/>
<polygon fill="black" stroke="black" points="1876.5,-28309.06 1873,-28299.06 1869.5,-28309.06 1876.5,-28309.06"/>
</g>
<!-- output_1 -->
<g id="node38" class="node">
<title>output_1</title>
<ellipse fill="white" stroke="black" cx="1877" cy="-27657" rx="111" ry="27"/>
<text text-anchor="middle" x="1877" y="-27660.8" font-family="Arial" font-size="14.00">Layer 2 Output</text>
<text text-anchor="middle" x="1877" y="-27645.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual2_1&#45;&gt;output_1 -->
<g id="edge47" class="edge">
<title>residual2_1&#45;&gt;output_1</title>
<path fill="none" stroke="black" d="M1877,-27756.88C1877,-27756.88 1877,-27694.05 1877,-27694.05"/>
<polygon fill="black" stroke="black" points="1880.5,-27694.05 1877,-27684.05 1873.5,-27694.05 1880.5,-27694.05"/>
</g>
<!-- input_2 -->
<g id="node57" class="node">
<title>input_2</title>
<ellipse fill="white" stroke="black" cx="1877" cy="-27495" rx="111" ry="27"/>
<text text-anchor="middle" x="1877" y="-27498.8" font-family="Arial" font-size="14.00">Layer 3 Input</text>
<text text-anchor="middle" x="1877" y="-27483.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- output_1&#45;&gt;input_2 -->
<g id="edge379" class="edge">
<title>output_1&#45;&gt;input_2</title>
<path fill="none" stroke="red" stroke-width="2" stroke-dasharray="5,2" d="M1877,-27629.88C1877,-27629.88 1877,-27532.2 1877,-27532.2"/>
<polygon fill="red" stroke="red" stroke-width="2" points="1880.5,-27532.2 1877,-27522.2 1873.5,-27532.2 1880.5,-27532.2"/>
<text text-anchor="middle" x="1933" y="-27582.8" font-family="Times,serif" font-size="14.00">GPU&#45;to&#45;GPU</text>
<text text-anchor="middle" x="1933" y="-27567.8" font-family="Times,serif" font-size="14.00">Communication</text>
</g>
<!-- qkv_proj_2 -->
<g id="node39" class="node">
<title>qkv_proj_2</title>
<path fill="lightgreen" stroke="black" d="M1857.5,-27278C1857.5,-27278 1678.5,-27278 1678.5,-27278 1672.5,-27278 1666.5,-27272 1666.5,-27266 1666.5,-27266 1666.5,-27222 1666.5,-27222 1666.5,-27216 1672.5,-27210 1678.5,-27210 1678.5,-27210 1857.5,-27210 1857.5,-27210 1863.5,-27210 1869.5,-27216 1869.5,-27222 1869.5,-27222 1869.5,-27266 1869.5,-27266 1869.5,-27272 1863.5,-27278 1857.5,-27278"/>
<text text-anchor="middle" x="1768" y="-27262.8" font-family="Arial" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1768" y="-27247.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1768" y="-27232.8" font-family="Arial" font-size="14.00">[1024, seq_len, 3*hidden]</text>
<text text-anchor="middle" x="1768" y="-27217.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 3*hidden/tp]</text>
</g>
<!-- attn_comp_2 -->
<g id="node40" class="node">
<title>attn_comp_2</title>
<path fill="lightyellow" stroke="black" d="M1849,-27137C1849,-27137 1701,-27137 1701,-27137 1695,-27137 1689,-27131 1689,-27125 1689,-27125 1689,-27096 1689,-27096 1689,-27090 1695,-27084 1701,-27084 1701,-27084 1849,-27084 1849,-27084 1855,-27084 1861,-27090 1861,-27096 1861,-27096 1861,-27125 1861,-27125 1861,-27131 1855,-27137 1849,-27137"/>
<text text-anchor="middle" x="1775" y="-27121.8" font-family="Arial" font-size="14.00">Attention</text>
<text text-anchor="middle" x="1775" y="-27106.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1775" y="-27091.8" font-family="Arial" font-size="14.00">Heads: 2 per GPU</text>
</g>
<!-- qkv_proj_2&#45;&gt;attn_comp_2 -->
<g id="edge48" class="edge">
<title>qkv_proj_2&#45;&gt;attn_comp_2</title>
<path fill="none" stroke="black" d="M1775,-27209.97C1775,-27209.97 1775,-27147.32 1775,-27147.32"/>
<polygon fill="black" stroke="black" points="1778.5,-27147.32 1775,-27137.32 1771.5,-27147.32 1778.5,-27147.32"/>
</g>
<!-- out_proj_2 -->
<g id="node41" class="node">
<title>out_proj_2</title>
<path fill="lightgreen" stroke="black" d="M1855.5,-27011C1855.5,-27011 1704.5,-27011 1704.5,-27011 1698.5,-27011 1692.5,-27005 1692.5,-26999 1692.5,-26999 1692.5,-26955 1692.5,-26955 1692.5,-26949 1698.5,-26943 1704.5,-26943 1704.5,-26943 1855.5,-26943 1855.5,-26943 1861.5,-26943 1867.5,-26949 1867.5,-26955 1867.5,-26955 1867.5,-26999 1867.5,-26999 1867.5,-27005 1861.5,-27011 1855.5,-27011"/>
<text text-anchor="middle" x="1780" y="-26995.8" font-family="Arial" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="1780" y="-26980.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1780" y="-26965.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1780" y="-26950.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- attn_comp_2&#45;&gt;out_proj_2 -->
<g id="edge49" class="edge">
<title>attn_comp_2&#45;&gt;out_proj_2</title>
<path fill="none" stroke="black" d="M1776.75,-27083.81C1776.75,-27083.81 1776.75,-27021.26 1776.75,-27021.26"/>
<polygon fill="black" stroke="black" points="1780.25,-27021.26 1776.75,-27011.26 1773.25,-27021.26 1780.25,-27021.26"/>
</g>
<!-- allreduce_attn_2 -->
<g id="node42" class="node">
<title>allreduce_attn_2</title>
<path fill="lightcoral" stroke="black" d="M1855.5,-26870C1855.5,-26870 1722.5,-26870 1722.5,-26870 1716.5,-26870 1710.5,-26864 1710.5,-26858 1710.5,-26858 1710.5,-26844 1710.5,-26844 1710.5,-26838 1716.5,-26832 1722.5,-26832 1722.5,-26832 1855.5,-26832 1855.5,-26832 1861.5,-26832 1867.5,-26838 1867.5,-26844 1867.5,-26844 1867.5,-26858 1867.5,-26858 1867.5,-26864 1861.5,-26870 1855.5,-26870"/>
<text text-anchor="middle" x="1789" y="-26854.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1789" y="-26839.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- out_proj_2&#45;&gt;allreduce_attn_2 -->
<g id="edge50" class="edge">
<title>out_proj_2&#45;&gt;allreduce_attn_2</title>
<path fill="none" stroke="black" d="M1789,-26942.9C1789,-26942.9 1789,-26880.24 1789,-26880.24"/>
<polygon fill="black" stroke="black" points="1792.5,-26880.24 1789,-26870.24 1785.5,-26880.24 1792.5,-26880.24"/>
</g>
<!-- residual1_2 -->
<g id="node59" class="node">
<title>residual1_2</title>
<path fill="lightgray" stroke="black" d="M1937.5,-26759C1937.5,-26759 1804.5,-26759 1804.5,-26759 1798.5,-26759 1792.5,-26753 1792.5,-26747 1792.5,-26747 1792.5,-26733 1792.5,-26733 1792.5,-26727 1798.5,-26721 1804.5,-26721 1804.5,-26721 1937.5,-26721 1937.5,-26721 1943.5,-26721 1949.5,-26727 1949.5,-26733 1949.5,-26733 1949.5,-26747 1949.5,-26747 1949.5,-26753 1943.5,-26759 1937.5,-26759"/>
<text text-anchor="middle" x="1871" y="-26743.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1871" y="-26728.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_attn_2&#45;&gt;residual1_2 -->
<g id="edge74" class="edge">
<title>allreduce_attn_2&#45;&gt;residual1_2</title>
<path fill="none" stroke="black" d="M1830,-26831.92C1830,-26831.92 1830,-26769.2 1830,-26769.2"/>
<polygon fill="black" stroke="black" points="1833.5,-26769.2 1830,-26759.2 1826.5,-26769.2 1833.5,-26769.2"/>
</g>
<!-- dense_h_4h_2 -->
<g id="node43" class="node">
<title>dense_h_4h_2</title>
<path fill="lightblue" stroke="black" d="M1533.5,-26531C1533.5,-26531 1354.5,-26531 1354.5,-26531 1348.5,-26531 1342.5,-26525 1342.5,-26519 1342.5,-26519 1342.5,-26475 1342.5,-26475 1342.5,-26469 1348.5,-26463 1354.5,-26463 1354.5,-26463 1533.5,-26463 1533.5,-26463 1539.5,-26463 1545.5,-26469 1545.5,-26475 1545.5,-26475 1545.5,-26519 1545.5,-26519 1545.5,-26525 1539.5,-26531 1533.5,-26531"/>
<text text-anchor="middle" x="1444" y="-26515.8" font-family="Arial" font-size="14.00">Dense H→4H</text>
<text text-anchor="middle" x="1444" y="-26500.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1444" y="-26485.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
<text text-anchor="middle" x="1444" y="-26470.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- expert_gate_2 -->
<g id="node44" class="node">
<title>expert_gate_2</title>
<path fill="lightpink" stroke="black" d="M1254,-26390C1254,-26390 1106,-26390 1106,-26390 1100,-26390 1094,-26384 1094,-26378 1094,-26378 1094,-26349 1094,-26349 1094,-26343 1100,-26337 1106,-26337 1106,-26337 1254,-26337 1254,-26337 1260,-26337 1266,-26343 1266,-26349 1266,-26349 1266,-26378 1266,-26378 1266,-26384 1260,-26390 1254,-26390"/>
<text text-anchor="middle" x="1180" y="-26374.8" font-family="Arial" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1180" y="-26359.8" font-family="Arial" font-size="14.00">[1024, seq_len, 8 experts]</text>
<text text-anchor="middle" x="1180" y="-26344.8" font-family="Arial" font-size="14.00">Top&#45;2 routing</text>
</g>
<!-- dense_h_4h_2&#45;&gt;expert_gate_2 -->
<g id="edge51" class="edge">
<title>dense_h_4h_2&#45;&gt;expert_gate_2</title>
<path fill="none" stroke="black" d="M1342.5,-26497C1300.87,-26497 1262.25,-26497 1262.25,-26497 1262.25,-26497 1262.25,-26400.19 1262.25,-26400.19"/>
<polygon fill="black" stroke="black" points="1265.75,-26400.19 1262.25,-26390.19 1258.75,-26400.19 1265.75,-26400.19"/>
</g>
<!-- expert_2_0 -->
<g id="node45" class="node">
<title>expert_2_0</title>
<path fill="lightsteelblue" stroke="black" d="M359,-26264C359,-26264 193,-26264 193,-26264 187,-26264 181,-26258 181,-26252 181,-26252 181,-26208 181,-26208 181,-26202 187,-26196 193,-26196 193,-26196 359,-26196 359,-26196 365,-26196 371,-26202 371,-26208 371,-26208 371,-26252 371,-26252 371,-26258 365,-26264 359,-26264"/>
<text text-anchor="middle" x="276" y="-26248.8" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="276" y="-26233.8" font-family="Arial" font-size="14.00">GPU 2</text>
<text text-anchor="middle" x="276" y="-26218.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="276" y="-26203.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_2&#45;&gt;expert_2_0 -->
<g id="edge52" class="edge">
<title>expert_gate_2&#45;&gt;expert_2_0</title>
<path fill="none" stroke="black" d="M1093.69,-26379C882.9,-26379 359,-26379 359,-26379 359,-26379 359,-26274.18 359,-26274.18"/>
<polygon fill="black" stroke="black" points="362.5,-26274.18 359,-26264.18 355.5,-26274.18 362.5,-26274.18"/>
</g>
<!-- expert_2_1 -->
<g id="node46" class="node">
<title>expert_2_1</title>
<path fill="lightsteelblue" stroke="black" d="M585,-26264C585,-26264 419,-26264 419,-26264 413,-26264 407,-26258 407,-26252 407,-26252 407,-26208 407,-26208 407,-26202 413,-26196 419,-26196 419,-26196 585,-26196 585,-26196 591,-26196 597,-26202 597,-26208 597,-26208 597,-26252 597,-26252 597,-26258 591,-26264 585,-26264"/>
<text text-anchor="middle" x="502" y="-26248.8" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="502" y="-26233.8" font-family="Arial" font-size="14.00">GPU 3</text>
<text text-anchor="middle" x="502" y="-26218.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="502" y="-26203.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_2&#45;&gt;expert_2_1 -->
<g id="edge53" class="edge">
<title>expert_gate_2&#45;&gt;expert_2_1</title>
<path fill="none" stroke="black" d="M1093.8,-26368C928.9,-26368 585,-26368 585,-26368 585,-26368 585,-26274.11 585,-26274.11"/>
<polygon fill="black" stroke="black" points="588.5,-26274.11 585,-26264.11 581.5,-26274.11 588.5,-26274.11"/>
</g>
<!-- expert_2_2 -->
<g id="node47" class="node">
<title>expert_2_2</title>
<path fill="lightsteelblue" stroke="black" d="M811,-26264C811,-26264 645,-26264 645,-26264 639,-26264 633,-26258 633,-26252 633,-26252 633,-26208 633,-26208 633,-26202 639,-26196 645,-26196 645,-26196 811,-26196 811,-26196 817,-26196 823,-26202 823,-26208 823,-26208 823,-26252 823,-26252 823,-26258 817,-26264 811,-26264"/>
<text text-anchor="middle" x="728" y="-26248.8" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="728" y="-26233.8" font-family="Arial" font-size="14.00">GPU 4</text>
<text text-anchor="middle" x="728" y="-26218.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="728" y="-26203.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_2&#45;&gt;expert_2_2 -->
<g id="edge54" class="edge">
<title>expert_gate_2&#45;&gt;expert_2_2</title>
<path fill="none" stroke="black" d="M1093.95,-26358C984.92,-26358 811,-26358 811,-26358 811,-26358 811,-26274.3 811,-26274.3"/>
<polygon fill="black" stroke="black" points="814.5,-26274.3 811,-26264.3 807.5,-26274.3 814.5,-26274.3"/>
</g>
<!-- expert_2_3 -->
<g id="node48" class="node">
<title>expert_2_3</title>
<path fill="lightsteelblue" stroke="black" d="M1037,-26264C1037,-26264 871,-26264 871,-26264 865,-26264 859,-26258 859,-26252 859,-26252 859,-26208 859,-26208 859,-26202 865,-26196 871,-26196 871,-26196 1037,-26196 1037,-26196 1043,-26196 1049,-26202 1049,-26208 1049,-26208 1049,-26252 1049,-26252 1049,-26258 1043,-26264 1037,-26264"/>
<text text-anchor="middle" x="954" y="-26248.8" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="954" y="-26233.8" font-family="Arial" font-size="14.00">GPU 5</text>
<text text-anchor="middle" x="954" y="-26218.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="954" y="-26203.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_2&#45;&gt;expert_2_3 -->
<g id="edge55" class="edge">
<title>expert_gate_2&#45;&gt;expert_2_3</title>
<path fill="none" stroke="black" d="M1093.93,-26347C1063.64,-26347 1037,-26347 1037,-26347 1037,-26347 1037,-26274.16 1037,-26274.16"/>
<polygon fill="black" stroke="black" points="1040.5,-26274.16 1037,-26264.16 1033.5,-26274.16 1040.5,-26274.16"/>
</g>
<!-- expert_2_4 -->
<g id="node49" class="node">
<title>expert_2_4</title>
<path fill="lightsteelblue" stroke="black" d="M1263,-26264C1263,-26264 1097,-26264 1097,-26264 1091,-26264 1085,-26258 1085,-26252 1085,-26252 1085,-26208 1085,-26208 1085,-26202 1091,-26196 1097,-26196 1097,-26196 1263,-26196 1263,-26196 1269,-26196 1275,-26202 1275,-26208 1275,-26208 1275,-26252 1275,-26252 1275,-26258 1269,-26264 1263,-26264"/>
<text text-anchor="middle" x="1180" y="-26248.8" font-family="Arial" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1180" y="-26233.8" font-family="Arial" font-size="14.00">GPU 6</text>
<text text-anchor="middle" x="1180" y="-26218.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1180" y="-26203.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_2&#45;&gt;expert_2_4 -->
<g id="edge56" class="edge">
<title>expert_gate_2&#45;&gt;expert_2_4</title>
<path fill="none" stroke="black" d="M1180,-26336.81C1180,-26336.81 1180,-26274.26 1180,-26274.26"/>
<polygon fill="black" stroke="black" points="1183.5,-26274.26 1180,-26264.26 1176.5,-26274.26 1183.5,-26274.26"/>
</g>
<!-- expert_2_5 -->
<g id="node50" class="node">
<title>expert_2_5</title>
<path fill="lightsteelblue" stroke="black" d="M1489,-26264C1489,-26264 1323,-26264 1323,-26264 1317,-26264 1311,-26258 1311,-26252 1311,-26252 1311,-26208 1311,-26208 1311,-26202 1317,-26196 1323,-26196 1323,-26196 1489,-26196 1489,-26196 1495,-26196 1501,-26202 1501,-26208 1501,-26208 1501,-26252 1501,-26252 1501,-26258 1495,-26264 1489,-26264"/>
<text text-anchor="middle" x="1406" y="-26248.8" font-family="Arial" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1406" y="-26233.8" font-family="Arial" font-size="14.00">GPU 7</text>
<text text-anchor="middle" x="1406" y="-26218.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1406" y="-26203.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_2&#45;&gt;expert_2_5 -->
<g id="edge57" class="edge">
<title>expert_gate_2&#45;&gt;expert_2_5</title>
<path fill="none" stroke="black" d="M1266.21,-26350C1298.16,-26350 1326.75,-26350 1326.75,-26350 1326.75,-26350 1326.75,-26274.07 1326.75,-26274.07"/>
<polygon fill="black" stroke="black" points="1330.25,-26274.07 1326.75,-26264.07 1323.25,-26274.07 1330.25,-26274.07"/>
</g>
<!-- expert_2_6 -->
<g id="node51" class="node">
<title>expert_2_6</title>
<path fill="lightsteelblue" stroke="black" d="M1715,-26264C1715,-26264 1549,-26264 1549,-26264 1543,-26264 1537,-26258 1537,-26252 1537,-26252 1537,-26208 1537,-26208 1537,-26202 1543,-26196 1549,-26196 1549,-26196 1715,-26196 1715,-26196 1721,-26196 1727,-26202 1727,-26208 1727,-26208 1727,-26252 1727,-26252 1727,-26258 1721,-26264 1715,-26264"/>
<text text-anchor="middle" x="1632" y="-26248.8" font-family="Arial" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="1632" y="-26233.8" font-family="Arial" font-size="14.00">GPU 8</text>
<text text-anchor="middle" x="1632" y="-26218.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1632" y="-26203.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_2&#45;&gt;expert_2_6 -->
<g id="edge58" class="edge">
<title>expert_gate_2&#45;&gt;expert_2_6</title>
<path fill="none" stroke="black" d="M1266.07,-26363C1372.92,-26363 1541.25,-26363 1541.25,-26363 1541.25,-26363 1541.25,-26274.25 1541.25,-26274.25"/>
<polygon fill="black" stroke="black" points="1544.75,-26274.25 1541.25,-26264.25 1537.75,-26274.25 1544.75,-26274.25"/>
</g>
<!-- expert_2_7 -->
<g id="node52" class="node">
<title>expert_2_7</title>
<path fill="lightsteelblue" stroke="black" d="M1941,-26264C1941,-26264 1775,-26264 1775,-26264 1769,-26264 1763,-26258 1763,-26252 1763,-26252 1763,-26208 1763,-26208 1763,-26202 1769,-26196 1775,-26196 1775,-26196 1941,-26196 1941,-26196 1947,-26196 1953,-26202 1953,-26208 1953,-26208 1953,-26252 1953,-26252 1953,-26258 1947,-26264 1941,-26264"/>
<text text-anchor="middle" x="1858" y="-26248.8" font-family="Arial" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="1858" y="-26233.8" font-family="Arial" font-size="14.00">GPU 9</text>
<text text-anchor="middle" x="1858" y="-26218.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1858" y="-26203.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_2&#45;&gt;expert_2_7 -->
<g id="edge59" class="edge">
<title>expert_gate_2&#45;&gt;expert_2_7</title>
<path fill="none" stroke="black" d="M1266.28,-26376C1431.81,-26376 1777.75,-26376 1777.75,-26376 1777.75,-26376 1777.75,-26274.23 1777.75,-26274.23"/>
<polygon fill="black" stroke="black" points="1781.25,-26274.23 1777.75,-26264.23 1774.25,-26274.23 1781.25,-26274.23"/>
</g>
<!-- expert_agg_2 -->
<g id="node53" class="node">
<title>expert_agg_2</title>
<path fill="lightsalmon" stroke="black" d="M1255.5,-26123C1255.5,-26123 1104.5,-26123 1104.5,-26123 1098.5,-26123 1092.5,-26117 1092.5,-26111 1092.5,-26111 1092.5,-26082 1092.5,-26082 1092.5,-26076 1098.5,-26070 1104.5,-26070 1104.5,-26070 1255.5,-26070 1255.5,-26070 1261.5,-26070 1267.5,-26076 1267.5,-26082 1267.5,-26082 1267.5,-26111 1267.5,-26111 1267.5,-26117 1261.5,-26123 1255.5,-26123"/>
<text text-anchor="middle" x="1180" y="-26107.8" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1180" y="-26092.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1180" y="-26077.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- expert_2_0&#45;&gt;expert_agg_2 -->
<g id="edge60" class="edge">
<title>expert_2_0&#45;&gt;expert_agg_2</title>
<path fill="none" stroke="black" d="M350.5,-26195.96C350.5,-26151.71 350.5,-26080 350.5,-26080 350.5,-26080 1082.41,-26080 1082.41,-26080"/>
<polygon fill="black" stroke="black" points="1082.41,-26083.5 1092.41,-26080 1082.41,-26076.5 1082.41,-26083.5"/>
</g>
<!-- expert_2_1&#45;&gt;expert_agg_2 -->
<g id="edge61" class="edge">
<title>expert_2_1&#45;&gt;expert_agg_2</title>
<path fill="none" stroke="black" d="M576.5,-26196C576.5,-26154.85 576.5,-26091 576.5,-26091 576.5,-26091 1082.25,-26091 1082.25,-26091"/>
<polygon fill="black" stroke="black" points="1082.25,-26094.5 1092.25,-26091 1082.25,-26087.5 1082.25,-26094.5"/>
</g>
<!-- expert_2_2&#45;&gt;expert_agg_2 -->
<g id="edge62" class="edge">
<title>expert_2_2&#45;&gt;expert_agg_2</title>
<path fill="none" stroke="black" d="M802.5,-26195.77C802.5,-26157.55 802.5,-26101 802.5,-26101 802.5,-26101 1082.45,-26101 1082.45,-26101"/>
<polygon fill="black" stroke="black" points="1082.45,-26104.5 1092.45,-26101 1082.45,-26097.5 1082.45,-26104.5"/>
</g>
<!-- expert_2_3&#45;&gt;expert_agg_2 -->
<g id="edge63" class="edge">
<title>expert_2_3&#45;&gt;expert_agg_2</title>
<path fill="none" stroke="black" d="M1028.5,-26195.87C1028.5,-26161.02 1028.5,-26112 1028.5,-26112 1028.5,-26112 1082.31,-26112 1082.31,-26112"/>
<polygon fill="black" stroke="black" points="1082.31,-26115.5 1092.31,-26112 1082.31,-26108.5 1082.31,-26115.5"/>
</g>
<!-- expert_2_4&#45;&gt;expert_agg_2 -->
<g id="edge64" class="edge">
<title>expert_2_4&#45;&gt;expert_agg_2</title>
<path fill="none" stroke="black" d="M1180,-26195.97C1180,-26195.97 1180,-26133.32 1180,-26133.32"/>
<polygon fill="black" stroke="black" points="1183.5,-26133.32 1180,-26123.32 1176.5,-26133.32 1183.5,-26133.32"/>
</g>
<!-- expert_2_5&#45;&gt;expert_agg_2 -->
<g id="edge65" class="edge">
<title>expert_2_5&#45;&gt;expert_agg_2</title>
<path fill="none" stroke="black" d="M1340.25,-26195.97C1340.25,-26160.18 1340.25,-26109 1340.25,-26109 1340.25,-26109 1277.63,-26109 1277.63,-26109"/>
<polygon fill="black" stroke="black" points="1277.63,-26105.5 1267.63,-26109 1277.63,-26112.5 1277.63,-26105.5"/>
</g>
<!-- expert_2_6&#45;&gt;expert_agg_2 -->
<g id="edge66" class="edge">
<title>expert_2_6&#45;&gt;expert_agg_2</title>
<path fill="none" stroke="black" d="M1545.75,-26195.84C1545.75,-26156.14 1545.75,-26096 1545.75,-26096 1545.75,-26096 1277.61,-26096 1277.61,-26096"/>
<polygon fill="black" stroke="black" points="1277.61,-26092.5 1267.61,-26096 1277.61,-26099.5 1277.61,-26092.5"/>
</g>
<!-- expert_2_7&#45;&gt;expert_agg_2 -->
<g id="edge67" class="edge">
<title>expert_2_7&#45;&gt;expert_agg_2</title>
<path fill="none" stroke="black" d="M1795.25,-26195.91C1795.25,-26152.48 1795.25,-26083 1795.25,-26083 1795.25,-26083 1277.82,-26083 1277.82,-26083"/>
<polygon fill="black" stroke="black" points="1277.82,-26079.5 1267.82,-26083 1277.82,-26086.5 1277.82,-26079.5"/>
</g>
<!-- activation_2 -->
<g id="node54" class="node">
<title>activation_2</title>
<path fill="lightyellow" stroke="black" d="M1542.5,-25997C1542.5,-25997 1381.5,-25997 1381.5,-25997 1375.5,-25997 1369.5,-25991 1369.5,-25985 1369.5,-25985 1369.5,-25971 1369.5,-25971 1369.5,-25965 1375.5,-25959 1381.5,-25959 1381.5,-25959 1542.5,-25959 1542.5,-25959 1548.5,-25959 1554.5,-25965 1554.5,-25971 1554.5,-25971 1554.5,-25985 1554.5,-25985 1554.5,-25991 1548.5,-25997 1542.5,-25997"/>
<text text-anchor="middle" x="1462" y="-25981.8" font-family="Arial" font-size="14.00">GELU</text>
<text text-anchor="middle" x="1462" y="-25966.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- expert_agg_2&#45;&gt;activation_2 -->
<g id="edge68" class="edge">
<title>expert_agg_2&#45;&gt;activation_2</title>
<path fill="none" stroke="black" d="M1255.25,-26069.91C1255.25,-26034.97 1255.25,-25978 1255.25,-25978 1255.25,-25978 1359.21,-25978 1359.21,-25978"/>
<polygon fill="black" stroke="black" points="1359.21,-25981.5 1369.21,-25978 1359.21,-25974.5 1359.21,-25981.5"/>
</g>
<!-- dense_4h_h_2 -->
<g id="node55" class="node">
<title>dense_4h_h_2</title>
<path fill="lightblue" stroke="black" d="M1704.5,-25886C1704.5,-25886 1543.5,-25886 1543.5,-25886 1537.5,-25886 1531.5,-25880 1531.5,-25874 1531.5,-25874 1531.5,-25830 1531.5,-25830 1531.5,-25824 1537.5,-25818 1543.5,-25818 1543.5,-25818 1704.5,-25818 1704.5,-25818 1710.5,-25818 1716.5,-25824 1716.5,-25830 1716.5,-25830 1716.5,-25874 1716.5,-25874 1716.5,-25880 1710.5,-25886 1704.5,-25886"/>
<text text-anchor="middle" x="1624" y="-25870.8" font-family="Arial" font-size="14.00">Dense 4H→H</text>
<text text-anchor="middle" x="1624" y="-25855.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1624" y="-25840.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1624" y="-25825.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- activation_2&#45;&gt;dense_4h_h_2 -->
<g id="edge69" class="edge">
<title>activation_2&#45;&gt;dense_4h_h_2</title>
<path fill="none" stroke="black" d="M1543,-25958.86C1543,-25958.86 1543,-25896.07 1543,-25896.07"/>
<polygon fill="black" stroke="black" points="1546.5,-25896.07 1543,-25886.07 1539.5,-25896.07 1546.5,-25896.07"/>
</g>
<!-- allreduce_mlp_2 -->
<g id="node56" class="node">
<title>allreduce_mlp_2</title>
<path fill="lightcoral" stroke="black" d="M1815.5,-25745C1815.5,-25745 1682.5,-25745 1682.5,-25745 1676.5,-25745 1670.5,-25739 1670.5,-25733 1670.5,-25733 1670.5,-25719 1670.5,-25719 1670.5,-25713 1676.5,-25707 1682.5,-25707 1682.5,-25707 1815.5,-25707 1815.5,-25707 1821.5,-25707 1827.5,-25713 1827.5,-25719 1827.5,-25719 1827.5,-25733 1827.5,-25733 1827.5,-25739 1821.5,-25745 1815.5,-25745"/>
<text text-anchor="middle" x="1749" y="-25729.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1749" y="-25714.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- dense_4h_h_2&#45;&gt;allreduce_mlp_2 -->
<g id="edge70" class="edge">
<title>dense_4h_h_2&#45;&gt;allreduce_mlp_2</title>
<path fill="none" stroke="black" d="M1693.5,-25817.9C1693.5,-25817.9 1693.5,-25755.24 1693.5,-25755.24"/>
<polygon fill="black" stroke="black" points="1697,-25755.24 1693.5,-25745.24 1690,-25755.24 1697,-25755.24"/>
</g>
<!-- residual2_2 -->
<g id="node61" class="node">
<title>residual2_2</title>
<path fill="lightgray" stroke="black" d="M1938.5,-25634C1938.5,-25634 1805.5,-25634 1805.5,-25634 1799.5,-25634 1793.5,-25628 1793.5,-25622 1793.5,-25622 1793.5,-25608 1793.5,-25608 1793.5,-25602 1799.5,-25596 1805.5,-25596 1805.5,-25596 1938.5,-25596 1938.5,-25596 1944.5,-25596 1950.5,-25602 1950.5,-25608 1950.5,-25608 1950.5,-25622 1950.5,-25622 1950.5,-25628 1944.5,-25634 1938.5,-25634"/>
<text text-anchor="middle" x="1872" y="-25618.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1872" y="-25603.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_mlp_2&#45;&gt;residual2_2 -->
<g id="edge78" class="edge">
<title>allreduce_mlp_2&#45;&gt;residual2_2</title>
<path fill="none" stroke="black" d="M1810.5,-25706.92C1810.5,-25706.92 1810.5,-25644.2 1810.5,-25644.2"/>
<polygon fill="black" stroke="black" points="1814,-25644.2 1810.5,-25634.2 1807,-25644.2 1814,-25644.2"/>
</g>
<!-- norm1_2 -->
<g id="node58" class="node">
<title>norm1_2</title>
<path fill="lightcyan" stroke="black" d="M1846.5,-27395C1846.5,-27395 1713.5,-27395 1713.5,-27395 1707.5,-27395 1701.5,-27389 1701.5,-27383 1701.5,-27383 1701.5,-27369 1701.5,-27369 1701.5,-27363 1707.5,-27357 1713.5,-27357 1713.5,-27357 1846.5,-27357 1846.5,-27357 1852.5,-27357 1858.5,-27363 1858.5,-27369 1858.5,-27369 1858.5,-27383 1858.5,-27383 1858.5,-27389 1852.5,-27395 1846.5,-27395"/>
<text text-anchor="middle" x="1780" y="-27379.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1780" y="-27364.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- input_2&#45;&gt;norm1_2 -->
<g id="edge71" class="edge">
<title>input_2&#45;&gt;norm1_2</title>
<path fill="none" stroke="black" d="M1812.25,-27472.9C1812.25,-27472.9 1812.25,-27405.23 1812.25,-27405.23"/>
<polygon fill="black" stroke="black" points="1815.75,-27405.23 1812.25,-27395.23 1808.75,-27405.23 1815.75,-27405.23"/>
</g>
<!-- input_2&#45;&gt;residual1_2 -->
<g id="edge72" class="edge">
<title>input_2&#45;&gt;residual1_2</title>
<path fill="none" stroke="black" d="M1909.5,-27469.01C1909.5,-27469.01 1909.5,-26769.33 1909.5,-26769.33"/>
<polygon fill="black" stroke="black" points="1913,-26769.33 1909.5,-26759.33 1906,-26769.33 1913,-26769.33"/>
</g>
<!-- norm1_2&#45;&gt;qkv_proj_2 -->
<g id="edge73" class="edge">
<title>norm1_2&#45;&gt;qkv_proj_2</title>
<path fill="none" stroke="black" d="M1780,-27356.81C1780,-27356.81 1780,-27288.06 1780,-27288.06"/>
<polygon fill="black" stroke="black" points="1783.5,-27288.06 1780,-27278.06 1776.5,-27288.06 1783.5,-27288.06"/>
</g>
<!-- norm2_2 -->
<g id="node60" class="node">
<title>norm2_2</title>
<path fill="lightcyan" stroke="black" d="M1635.5,-26648C1635.5,-26648 1502.5,-26648 1502.5,-26648 1496.5,-26648 1490.5,-26642 1490.5,-26636 1490.5,-26636 1490.5,-26622 1490.5,-26622 1490.5,-26616 1496.5,-26610 1502.5,-26610 1502.5,-26610 1635.5,-26610 1635.5,-26610 1641.5,-26610 1647.5,-26616 1647.5,-26622 1647.5,-26622 1647.5,-26636 1647.5,-26636 1647.5,-26642 1641.5,-26648 1635.5,-26648"/>
<text text-anchor="middle" x="1569" y="-26632.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1569" y="-26617.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual1_2&#45;&gt;norm2_2 -->
<g id="edge75" class="edge">
<title>residual1_2&#45;&gt;norm2_2</title>
<path fill="none" stroke="black" d="M1792.23,-26740C1707.72,-26740 1585.5,-26740 1585.5,-26740 1585.5,-26740 1585.5,-26658.08 1585.5,-26658.08"/>
<polygon fill="black" stroke="black" points="1589,-26658.08 1585.5,-26648.08 1582,-26658.08 1589,-26658.08"/>
</g>
<!-- residual1_2&#45;&gt;residual2_2 -->
<g id="edge76" class="edge">
<title>residual1_2&#45;&gt;residual2_2</title>
<path fill="none" stroke="black" d="M1949.76,-26740C1960.54,-26740 1968,-26740 1968,-26740 1968,-26740 1968,-25615 1968,-25615 1968,-25615 1960.84,-25615 1960.84,-25615"/>
<polygon fill="black" stroke="black" points="1960.84,-25611.5 1950.84,-25615 1960.84,-25618.5 1960.84,-25611.5"/>
</g>
<!-- norm2_2&#45;&gt;dense_h_4h_2 -->
<g id="edge77" class="edge">
<title>norm2_2&#45;&gt;dense_h_4h_2</title>
<path fill="none" stroke="black" d="M1518,-26609.81C1518,-26609.81 1518,-26541.06 1518,-26541.06"/>
<polygon fill="black" stroke="black" points="1521.5,-26541.06 1518,-26531.06 1514.5,-26541.06 1521.5,-26541.06"/>
</g>
<!-- output_2 -->
<g id="node62" class="node">
<title>output_2</title>
<ellipse fill="white" stroke="black" cx="1872" cy="-25496" rx="111" ry="27"/>
<text text-anchor="middle" x="1872" y="-25499.8" font-family="Arial" font-size="14.00">Layer 3 Output</text>
<text text-anchor="middle" x="1872" y="-25484.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual2_2&#45;&gt;output_2 -->
<g id="edge79" class="edge">
<title>residual2_2&#45;&gt;output_2</title>
<path fill="none" stroke="black" d="M1872,-25595.88C1872,-25595.88 1872,-25533.05 1872,-25533.05"/>
<polygon fill="black" stroke="black" points="1875.5,-25533.05 1872,-25523.05 1868.5,-25533.05 1875.5,-25533.05"/>
</g>
<!-- input_3 -->
<g id="node71" class="node">
<title>input_3</title>
<ellipse fill="white" stroke="black" cx="1872" cy="-25334" rx="111" ry="27"/>
<text text-anchor="middle" x="1872" y="-25337.8" font-family="Arial" font-size="14.00">Layer 4 Input</text>
<text text-anchor="middle" x="1872" y="-25322.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- output_2&#45;&gt;input_3 -->
<g id="edge380" class="edge">
<title>output_2&#45;&gt;input_3</title>
<path fill="none" stroke="red" stroke-width="2" stroke-dasharray="5,2" d="M1872,-25468.88C1872,-25468.88 1872,-25371.2 1872,-25371.2"/>
<polygon fill="red" stroke="red" stroke-width="2" points="1875.5,-25371.2 1872,-25361.2 1868.5,-25371.2 1875.5,-25371.2"/>
<text text-anchor="middle" x="1928" y="-25421.8" font-family="Times,serif" font-size="14.00">GPU&#45;to&#45;GPU</text>
<text text-anchor="middle" x="1928" y="-25406.8" font-family="Times,serif" font-size="14.00">Communication</text>
</g>
<!-- qkv_proj_3 -->
<g id="node63" class="node">
<title>qkv_proj_3</title>
<path fill="lightgreen" stroke="black" d="M1940.5,-25117C1940.5,-25117 1761.5,-25117 1761.5,-25117 1755.5,-25117 1749.5,-25111 1749.5,-25105 1749.5,-25105 1749.5,-25061 1749.5,-25061 1749.5,-25055 1755.5,-25049 1761.5,-25049 1761.5,-25049 1940.5,-25049 1940.5,-25049 1946.5,-25049 1952.5,-25055 1952.5,-25061 1952.5,-25061 1952.5,-25105 1952.5,-25105 1952.5,-25111 1946.5,-25117 1940.5,-25117"/>
<text text-anchor="middle" x="1851" y="-25101.8" font-family="Arial" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1851" y="-25086.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1851" y="-25071.8" font-family="Arial" font-size="14.00">[1024, seq_len, 3*hidden]</text>
<text text-anchor="middle" x="1851" y="-25056.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 3*hidden/tp]</text>
</g>
<!-- attn_comp_3 -->
<g id="node64" class="node">
<title>attn_comp_3</title>
<path fill="lightyellow" stroke="black" d="M1932,-24976C1932,-24976 1784,-24976 1784,-24976 1778,-24976 1772,-24970 1772,-24964 1772,-24964 1772,-24935 1772,-24935 1772,-24929 1778,-24923 1784,-24923 1784,-24923 1932,-24923 1932,-24923 1938,-24923 1944,-24929 1944,-24935 1944,-24935 1944,-24964 1944,-24964 1944,-24970 1938,-24976 1932,-24976"/>
<text text-anchor="middle" x="1858" y="-24960.8" font-family="Arial" font-size="14.00">Attention</text>
<text text-anchor="middle" x="1858" y="-24945.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1858" y="-24930.8" font-family="Arial" font-size="14.00">Heads: 2 per GPU</text>
</g>
<!-- qkv_proj_3&#45;&gt;attn_comp_3 -->
<g id="edge80" class="edge">
<title>qkv_proj_3&#45;&gt;attn_comp_3</title>
<path fill="none" stroke="black" d="M1858,-25048.97C1858,-25048.97 1858,-24986.32 1858,-24986.32"/>
<polygon fill="black" stroke="black" points="1861.5,-24986.32 1858,-24976.32 1854.5,-24986.32 1861.5,-24986.32"/>
</g>
<!-- out_proj_3 -->
<g id="node65" class="node">
<title>out_proj_3</title>
<path fill="lightgreen" stroke="black" d="M1938.5,-24850C1938.5,-24850 1787.5,-24850 1787.5,-24850 1781.5,-24850 1775.5,-24844 1775.5,-24838 1775.5,-24838 1775.5,-24794 1775.5,-24794 1775.5,-24788 1781.5,-24782 1787.5,-24782 1787.5,-24782 1938.5,-24782 1938.5,-24782 1944.5,-24782 1950.5,-24788 1950.5,-24794 1950.5,-24794 1950.5,-24838 1950.5,-24838 1950.5,-24844 1944.5,-24850 1938.5,-24850"/>
<text text-anchor="middle" x="1863" y="-24834.8" font-family="Arial" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="1863" y="-24819.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1863" y="-24804.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1863" y="-24789.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- attn_comp_3&#45;&gt;out_proj_3 -->
<g id="edge81" class="edge">
<title>attn_comp_3&#45;&gt;out_proj_3</title>
<path fill="none" stroke="black" d="M1859.75,-24922.81C1859.75,-24922.81 1859.75,-24860.26 1859.75,-24860.26"/>
<polygon fill="black" stroke="black" points="1863.25,-24860.26 1859.75,-24850.26 1856.25,-24860.26 1863.25,-24860.26"/>
</g>
<!-- allreduce_attn_3 -->
<g id="node66" class="node">
<title>allreduce_attn_3</title>
<path fill="lightcoral" stroke="black" d="M1938.5,-24709C1938.5,-24709 1805.5,-24709 1805.5,-24709 1799.5,-24709 1793.5,-24703 1793.5,-24697 1793.5,-24697 1793.5,-24683 1793.5,-24683 1793.5,-24677 1799.5,-24671 1805.5,-24671 1805.5,-24671 1938.5,-24671 1938.5,-24671 1944.5,-24671 1950.5,-24677 1950.5,-24683 1950.5,-24683 1950.5,-24697 1950.5,-24697 1950.5,-24703 1944.5,-24709 1938.5,-24709"/>
<text text-anchor="middle" x="1872" y="-24693.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1872" y="-24678.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- out_proj_3&#45;&gt;allreduce_attn_3 -->
<g id="edge82" class="edge">
<title>out_proj_3&#45;&gt;allreduce_attn_3</title>
<path fill="none" stroke="black" d="M1872,-24781.9C1872,-24781.9 1872,-24719.24 1872,-24719.24"/>
<polygon fill="black" stroke="black" points="1875.5,-24719.24 1872,-24709.24 1868.5,-24719.24 1875.5,-24719.24"/>
</g>
<!-- residual1_3 -->
<g id="node73" class="node">
<title>residual1_3</title>
<path fill="lightgray" stroke="black" d="M1959.5,-24598C1959.5,-24598 1826.5,-24598 1826.5,-24598 1820.5,-24598 1814.5,-24592 1814.5,-24586 1814.5,-24586 1814.5,-24572 1814.5,-24572 1814.5,-24566 1820.5,-24560 1826.5,-24560 1826.5,-24560 1959.5,-24560 1959.5,-24560 1965.5,-24560 1971.5,-24566 1971.5,-24572 1971.5,-24572 1971.5,-24586 1971.5,-24586 1971.5,-24592 1965.5,-24598 1959.5,-24598"/>
<text text-anchor="middle" x="1893" y="-24582.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1893" y="-24567.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_attn_3&#45;&gt;residual1_3 -->
<g id="edge89" class="edge">
<title>allreduce_attn_3&#45;&gt;residual1_3</title>
<path fill="none" stroke="black" d="M1882.5,-24670.92C1882.5,-24670.92 1882.5,-24608.2 1882.5,-24608.2"/>
<polygon fill="black" stroke="black" points="1886,-24608.2 1882.5,-24598.2 1879,-24608.2 1886,-24608.2"/>
</g>
<!-- dense_h_4h_3 -->
<g id="node67" class="node">
<title>dense_h_4h_3</title>
<path fill="lightblue" stroke="black" d="M1940.5,-24370C1940.5,-24370 1761.5,-24370 1761.5,-24370 1755.5,-24370 1749.5,-24364 1749.5,-24358 1749.5,-24358 1749.5,-24314 1749.5,-24314 1749.5,-24308 1755.5,-24302 1761.5,-24302 1761.5,-24302 1940.5,-24302 1940.5,-24302 1946.5,-24302 1952.5,-24308 1952.5,-24314 1952.5,-24314 1952.5,-24358 1952.5,-24358 1952.5,-24364 1946.5,-24370 1940.5,-24370"/>
<text text-anchor="middle" x="1851" y="-24354.8" font-family="Arial" font-size="14.00">Dense H→4H</text>
<text text-anchor="middle" x="1851" y="-24339.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1851" y="-24324.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
<text text-anchor="middle" x="1851" y="-24309.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- activation_3 -->
<g id="node68" class="node">
<title>activation_3</title>
<path fill="lightyellow" stroke="black" d="M1936.5,-24229C1936.5,-24229 1775.5,-24229 1775.5,-24229 1769.5,-24229 1763.5,-24223 1763.5,-24217 1763.5,-24217 1763.5,-24203 1763.5,-24203 1763.5,-24197 1769.5,-24191 1775.5,-24191 1775.5,-24191 1936.5,-24191 1936.5,-24191 1942.5,-24191 1948.5,-24197 1948.5,-24203 1948.5,-24203 1948.5,-24217 1948.5,-24217 1948.5,-24223 1942.5,-24229 1936.5,-24229"/>
<text text-anchor="middle" x="1856" y="-24213.8" font-family="Arial" font-size="14.00">GELU</text>
<text text-anchor="middle" x="1856" y="-24198.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- dense_h_4h_3&#45;&gt;activation_3 -->
<g id="edge83" class="edge">
<title>dense_h_4h_3&#45;&gt;activation_3</title>
<path fill="none" stroke="black" d="M1856,-24301.9C1856,-24301.9 1856,-24239.24 1856,-24239.24"/>
<polygon fill="black" stroke="black" points="1859.5,-24239.24 1856,-24229.24 1852.5,-24239.24 1859.5,-24239.24"/>
</g>
<!-- dense_4h_h_3 -->
<g id="node69" class="node">
<title>dense_4h_h_3</title>
<path fill="lightblue" stroke="black" d="M1939.5,-24118C1939.5,-24118 1778.5,-24118 1778.5,-24118 1772.5,-24118 1766.5,-24112 1766.5,-24106 1766.5,-24106 1766.5,-24062 1766.5,-24062 1766.5,-24056 1772.5,-24050 1778.5,-24050 1778.5,-24050 1939.5,-24050 1939.5,-24050 1945.5,-24050 1951.5,-24056 1951.5,-24062 1951.5,-24062 1951.5,-24106 1951.5,-24106 1951.5,-24112 1945.5,-24118 1939.5,-24118"/>
<text text-anchor="middle" x="1859" y="-24102.8" font-family="Arial" font-size="14.00">Dense 4H→H</text>
<text text-anchor="middle" x="1859" y="-24087.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1859" y="-24072.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1859" y="-24057.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- activation_3&#45;&gt;dense_4h_h_3 -->
<g id="edge84" class="edge">
<title>activation_3&#45;&gt;dense_4h_h_3</title>
<path fill="none" stroke="black" d="M1857.5,-24190.86C1857.5,-24190.86 1857.5,-24128.07 1857.5,-24128.07"/>
<polygon fill="black" stroke="black" points="1861,-24128.07 1857.5,-24118.07 1854,-24128.07 1861,-24128.07"/>
</g>
<!-- allreduce_mlp_3 -->
<g id="node70" class="node">
<title>allreduce_mlp_3</title>
<path fill="lightcoral" stroke="black" d="M1930.5,-23977C1930.5,-23977 1797.5,-23977 1797.5,-23977 1791.5,-23977 1785.5,-23971 1785.5,-23965 1785.5,-23965 1785.5,-23951 1785.5,-23951 1785.5,-23945 1791.5,-23939 1797.5,-23939 1797.5,-23939 1930.5,-23939 1930.5,-23939 1936.5,-23939 1942.5,-23945 1942.5,-23951 1942.5,-23951 1942.5,-23965 1942.5,-23965 1942.5,-23971 1936.5,-23977 1930.5,-23977"/>
<text text-anchor="middle" x="1864" y="-23961.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1864" y="-23946.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- dense_4h_h_3&#45;&gt;allreduce_mlp_3 -->
<g id="edge85" class="edge">
<title>dense_4h_h_3&#45;&gt;allreduce_mlp_3</title>
<path fill="none" stroke="black" d="M1864,-24049.9C1864,-24049.9 1864,-23987.24 1864,-23987.24"/>
<polygon fill="black" stroke="black" points="1867.5,-23987.24 1864,-23977.24 1860.5,-23987.24 1867.5,-23987.24"/>
</g>
<!-- residual2_3 -->
<g id="node75" class="node">
<title>residual2_3</title>
<path fill="lightgray" stroke="black" d="M1943.5,-23866C1943.5,-23866 1810.5,-23866 1810.5,-23866 1804.5,-23866 1798.5,-23860 1798.5,-23854 1798.5,-23854 1798.5,-23840 1798.5,-23840 1798.5,-23834 1804.5,-23828 1810.5,-23828 1810.5,-23828 1943.5,-23828 1943.5,-23828 1949.5,-23828 1955.5,-23834 1955.5,-23840 1955.5,-23840 1955.5,-23854 1955.5,-23854 1955.5,-23860 1949.5,-23866 1943.5,-23866"/>
<text text-anchor="middle" x="1877" y="-23850.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1877" y="-23835.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_mlp_3&#45;&gt;residual2_3 -->
<g id="edge93" class="edge">
<title>allreduce_mlp_3&#45;&gt;residual2_3</title>
<path fill="none" stroke="black" d="M1870.5,-23938.92C1870.5,-23938.92 1870.5,-23876.2 1870.5,-23876.2"/>
<polygon fill="black" stroke="black" points="1874,-23876.2 1870.5,-23866.2 1867,-23876.2 1874,-23876.2"/>
</g>
<!-- norm1_3 -->
<g id="node72" class="node">
<title>norm1_3</title>
<path fill="lightcyan" stroke="black" d="M1929.5,-25234C1929.5,-25234 1796.5,-25234 1796.5,-25234 1790.5,-25234 1784.5,-25228 1784.5,-25222 1784.5,-25222 1784.5,-25208 1784.5,-25208 1784.5,-25202 1790.5,-25196 1796.5,-25196 1796.5,-25196 1929.5,-25196 1929.5,-25196 1935.5,-25196 1941.5,-25202 1941.5,-25208 1941.5,-25208 1941.5,-25222 1941.5,-25222 1941.5,-25228 1935.5,-25234 1929.5,-25234"/>
<text text-anchor="middle" x="1863" y="-25218.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1863" y="-25203.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- input_3&#45;&gt;norm1_3 -->
<g id="edge86" class="edge">
<title>input_3&#45;&gt;norm1_3</title>
<path fill="none" stroke="black" d="M1863,-25307C1863,-25307 1863,-25244.12 1863,-25244.12"/>
<polygon fill="black" stroke="black" points="1866.5,-25244.12 1863,-25234.12 1859.5,-25244.12 1866.5,-25244.12"/>
</g>
<!-- input_3&#45;&gt;residual1_3 -->
<g id="edge87" class="edge">
<title>input_3&#45;&gt;residual1_3</title>
<path fill="none" stroke="black" d="M1962,-25317.88C1962,-25317.88 1962,-24608.31 1962,-24608.31"/>
<polygon fill="black" stroke="black" points="1965.5,-24608.31 1962,-24598.31 1958.5,-24608.31 1965.5,-24608.31"/>
</g>
<!-- norm1_3&#45;&gt;qkv_proj_3 -->
<g id="edge88" class="edge">
<title>norm1_3&#45;&gt;qkv_proj_3</title>
<path fill="none" stroke="black" d="M1863,-25195.81C1863,-25195.81 1863,-25127.06 1863,-25127.06"/>
<polygon fill="black" stroke="black" points="1866.5,-25127.06 1863,-25117.06 1859.5,-25127.06 1866.5,-25127.06"/>
</g>
<!-- norm2_3 -->
<g id="node74" class="node">
<title>norm2_3</title>
<path fill="lightcyan" stroke="black" d="M1929.5,-24487C1929.5,-24487 1796.5,-24487 1796.5,-24487 1790.5,-24487 1784.5,-24481 1784.5,-24475 1784.5,-24475 1784.5,-24461 1784.5,-24461 1784.5,-24455 1790.5,-24449 1796.5,-24449 1796.5,-24449 1929.5,-24449 1929.5,-24449 1935.5,-24449 1941.5,-24455 1941.5,-24461 1941.5,-24461 1941.5,-24475 1941.5,-24475 1941.5,-24481 1935.5,-24487 1929.5,-24487"/>
<text text-anchor="middle" x="1863" y="-24471.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1863" y="-24456.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual1_3&#45;&gt;norm2_3 -->
<g id="edge90" class="edge">
<title>residual1_3&#45;&gt;norm2_3</title>
<path fill="none" stroke="black" d="M1878,-24559.92C1878,-24559.92 1878,-24497.2 1878,-24497.2"/>
<polygon fill="black" stroke="black" points="1881.5,-24497.2 1878,-24487.2 1874.5,-24497.2 1881.5,-24497.2"/>
</g>
<!-- residual1_3&#45;&gt;residual2_3 -->
<g id="edge91" class="edge">
<title>residual1_3&#45;&gt;residual2_3</title>
<path fill="none" stroke="black" d="M1963.5,-24559.8C1963.5,-24444.3 1963.5,-23847 1963.5,-23847 1963.5,-23847 1962.7,-23847 1962.7,-23847"/>
<polygon fill="black" stroke="black" points="1965.52,-23843.5 1955.52,-23847 1965.52,-23850.5 1965.52,-23843.5"/>
</g>
<!-- norm2_3&#45;&gt;dense_h_4h_3 -->
<g id="edge92" class="edge">
<title>norm2_3&#45;&gt;dense_h_4h_3</title>
<path fill="none" stroke="black" d="M1863,-24448.81C1863,-24448.81 1863,-24380.06 1863,-24380.06"/>
<polygon fill="black" stroke="black" points="1866.5,-24380.06 1863,-24370.06 1859.5,-24380.06 1866.5,-24380.06"/>
</g>
<!-- output_3 -->
<g id="node76" class="node">
<title>output_3</title>
<ellipse fill="white" stroke="black" cx="1877" cy="-23728" rx="111" ry="27"/>
<text text-anchor="middle" x="1877" y="-23731.8" font-family="Arial" font-size="14.00">Layer 4 Output</text>
<text text-anchor="middle" x="1877" y="-23716.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual2_3&#45;&gt;output_3 -->
<g id="edge94" class="edge">
<title>residual2_3&#45;&gt;output_3</title>
<path fill="none" stroke="black" d="M1877,-23827.88C1877,-23827.88 1877,-23765.05 1877,-23765.05"/>
<polygon fill="black" stroke="black" points="1880.5,-23765.05 1877,-23755.05 1873.5,-23765.05 1880.5,-23765.05"/>
</g>
<!-- input_4 -->
<g id="node95" class="node">
<title>input_4</title>
<ellipse fill="white" stroke="black" cx="1877" cy="-23566" rx="111" ry="27"/>
<text text-anchor="middle" x="1877" y="-23569.8" font-family="Arial" font-size="14.00">Layer 5 Input</text>
<text text-anchor="middle" x="1877" y="-23554.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- output_3&#45;&gt;input_4 -->
<g id="edge381" class="edge">
<title>output_3&#45;&gt;input_4</title>
<path fill="none" stroke="red" stroke-width="2" stroke-dasharray="5,2" d="M1877,-23700.88C1877,-23700.88 1877,-23603.2 1877,-23603.2"/>
<polygon fill="red" stroke="red" stroke-width="2" points="1880.5,-23603.2 1877,-23593.2 1873.5,-23603.2 1880.5,-23603.2"/>
<text text-anchor="middle" x="1933" y="-23653.8" font-family="Times,serif" font-size="14.00">GPU&#45;to&#45;GPU</text>
<text text-anchor="middle" x="1933" y="-23638.8" font-family="Times,serif" font-size="14.00">Communication</text>
</g>
<!-- qkv_proj_4 -->
<g id="node77" class="node">
<title>qkv_proj_4</title>
<path fill="lightgreen" stroke="black" d="M1860.5,-23349C1860.5,-23349 1681.5,-23349 1681.5,-23349 1675.5,-23349 1669.5,-23343 1669.5,-23337 1669.5,-23337 1669.5,-23293 1669.5,-23293 1669.5,-23287 1675.5,-23281 1681.5,-23281 1681.5,-23281 1860.5,-23281 1860.5,-23281 1866.5,-23281 1872.5,-23287 1872.5,-23293 1872.5,-23293 1872.5,-23337 1872.5,-23337 1872.5,-23343 1866.5,-23349 1860.5,-23349"/>
<text text-anchor="middle" x="1771" y="-23333.8" font-family="Arial" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1771" y="-23318.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1771" y="-23303.8" font-family="Arial" font-size="14.00">[1024, seq_len, 3*hidden]</text>
<text text-anchor="middle" x="1771" y="-23288.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 3*hidden/tp]</text>
</g>
<!-- attn_comp_4 -->
<g id="node78" class="node">
<title>attn_comp_4</title>
<path fill="lightyellow" stroke="black" d="M1852,-23208C1852,-23208 1704,-23208 1704,-23208 1698,-23208 1692,-23202 1692,-23196 1692,-23196 1692,-23167 1692,-23167 1692,-23161 1698,-23155 1704,-23155 1704,-23155 1852,-23155 1852,-23155 1858,-23155 1864,-23161 1864,-23167 1864,-23167 1864,-23196 1864,-23196 1864,-23202 1858,-23208 1852,-23208"/>
<text text-anchor="middle" x="1778" y="-23192.8" font-family="Arial" font-size="14.00">Attention</text>
<text text-anchor="middle" x="1778" y="-23177.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1778" y="-23162.8" font-family="Arial" font-size="14.00">Heads: 2 per GPU</text>
</g>
<!-- qkv_proj_4&#45;&gt;attn_comp_4 -->
<g id="edge95" class="edge">
<title>qkv_proj_4&#45;&gt;attn_comp_4</title>
<path fill="none" stroke="black" d="M1778,-23280.97C1778,-23280.97 1778,-23218.32 1778,-23218.32"/>
<polygon fill="black" stroke="black" points="1781.5,-23218.32 1778,-23208.32 1774.5,-23218.32 1781.5,-23218.32"/>
</g>
<!-- out_proj_4 -->
<g id="node79" class="node">
<title>out_proj_4</title>
<path fill="lightgreen" stroke="black" d="M1858.5,-23082C1858.5,-23082 1707.5,-23082 1707.5,-23082 1701.5,-23082 1695.5,-23076 1695.5,-23070 1695.5,-23070 1695.5,-23026 1695.5,-23026 1695.5,-23020 1701.5,-23014 1707.5,-23014 1707.5,-23014 1858.5,-23014 1858.5,-23014 1864.5,-23014 1870.5,-23020 1870.5,-23026 1870.5,-23026 1870.5,-23070 1870.5,-23070 1870.5,-23076 1864.5,-23082 1858.5,-23082"/>
<text text-anchor="middle" x="1783" y="-23066.8" font-family="Arial" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="1783" y="-23051.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1783" y="-23036.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1783" y="-23021.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- attn_comp_4&#45;&gt;out_proj_4 -->
<g id="edge96" class="edge">
<title>attn_comp_4&#45;&gt;out_proj_4</title>
<path fill="none" stroke="black" d="M1779.75,-23154.81C1779.75,-23154.81 1779.75,-23092.26 1779.75,-23092.26"/>
<polygon fill="black" stroke="black" points="1783.25,-23092.26 1779.75,-23082.26 1776.25,-23092.26 1783.25,-23092.26"/>
</g>
<!-- allreduce_attn_4 -->
<g id="node80" class="node">
<title>allreduce_attn_4</title>
<path fill="lightcoral" stroke="black" d="M1858.5,-22941C1858.5,-22941 1725.5,-22941 1725.5,-22941 1719.5,-22941 1713.5,-22935 1713.5,-22929 1713.5,-22929 1713.5,-22915 1713.5,-22915 1713.5,-22909 1719.5,-22903 1725.5,-22903 1725.5,-22903 1858.5,-22903 1858.5,-22903 1864.5,-22903 1870.5,-22909 1870.5,-22915 1870.5,-22915 1870.5,-22929 1870.5,-22929 1870.5,-22935 1864.5,-22941 1858.5,-22941"/>
<text text-anchor="middle" x="1792" y="-22925.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1792" y="-22910.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- out_proj_4&#45;&gt;allreduce_attn_4 -->
<g id="edge97" class="edge">
<title>out_proj_4&#45;&gt;allreduce_attn_4</title>
<path fill="none" stroke="black" d="M1792,-23013.9C1792,-23013.9 1792,-22951.24 1792,-22951.24"/>
<polygon fill="black" stroke="black" points="1795.5,-22951.24 1792,-22941.24 1788.5,-22951.24 1795.5,-22951.24"/>
</g>
<!-- residual1_4 -->
<g id="node97" class="node">
<title>residual1_4</title>
<path fill="lightgray" stroke="black" d="M1971.5,-22830C1971.5,-22830 1838.5,-22830 1838.5,-22830 1832.5,-22830 1826.5,-22824 1826.5,-22818 1826.5,-22818 1826.5,-22804 1826.5,-22804 1826.5,-22798 1832.5,-22792 1838.5,-22792 1838.5,-22792 1971.5,-22792 1971.5,-22792 1977.5,-22792 1983.5,-22798 1983.5,-22804 1983.5,-22804 1983.5,-22818 1983.5,-22818 1983.5,-22824 1977.5,-22830 1971.5,-22830"/>
<text text-anchor="middle" x="1905" y="-22814.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1905" y="-22799.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_attn_4&#45;&gt;residual1_4 -->
<g id="edge121" class="edge">
<title>allreduce_attn_4&#45;&gt;residual1_4</title>
<path fill="none" stroke="black" d="M1848.5,-22902.92C1848.5,-22902.92 1848.5,-22840.2 1848.5,-22840.2"/>
<polygon fill="black" stroke="black" points="1852,-22840.2 1848.5,-22830.2 1845,-22840.2 1852,-22840.2"/>
</g>
<!-- dense_h_4h_4 -->
<g id="node81" class="node">
<title>dense_h_4h_4</title>
<path fill="lightblue" stroke="black" d="M1477.5,-22602C1477.5,-22602 1298.5,-22602 1298.5,-22602 1292.5,-22602 1286.5,-22596 1286.5,-22590 1286.5,-22590 1286.5,-22546 1286.5,-22546 1286.5,-22540 1292.5,-22534 1298.5,-22534 1298.5,-22534 1477.5,-22534 1477.5,-22534 1483.5,-22534 1489.5,-22540 1489.5,-22546 1489.5,-22546 1489.5,-22590 1489.5,-22590 1489.5,-22596 1483.5,-22602 1477.5,-22602"/>
<text text-anchor="middle" x="1388" y="-22586.8" font-family="Arial" font-size="14.00">Dense H→4H</text>
<text text-anchor="middle" x="1388" y="-22571.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1388" y="-22556.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
<text text-anchor="middle" x="1388" y="-22541.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- expert_gate_4 -->
<g id="node82" class="node">
<title>expert_gate_4</title>
<path fill="lightpink" stroke="black" d="M1403,-22461C1403,-22461 1255,-22461 1255,-22461 1249,-22461 1243,-22455 1243,-22449 1243,-22449 1243,-22420 1243,-22420 1243,-22414 1249,-22408 1255,-22408 1255,-22408 1403,-22408 1403,-22408 1409,-22408 1415,-22414 1415,-22420 1415,-22420 1415,-22449 1415,-22449 1415,-22455 1409,-22461 1403,-22461"/>
<text text-anchor="middle" x="1329" y="-22445.8" font-family="Arial" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1329" y="-22430.8" font-family="Arial" font-size="14.00">[1024, seq_len, 8 experts]</text>
<text text-anchor="middle" x="1329" y="-22415.8" font-family="Arial" font-size="14.00">Top&#45;2 routing</text>
</g>
<!-- dense_h_4h_4&#45;&gt;expert_gate_4 -->
<g id="edge98" class="edge">
<title>dense_h_4h_4&#45;&gt;expert_gate_4</title>
<path fill="none" stroke="black" d="M1350.75,-22533.97C1350.75,-22533.97 1350.75,-22471.32 1350.75,-22471.32"/>
<polygon fill="black" stroke="black" points="1354.25,-22471.32 1350.75,-22461.32 1347.25,-22471.32 1354.25,-22471.32"/>
</g>
<!-- expert_4_0 -->
<g id="node83" class="node">
<title>expert_4_0</title>
<path fill="lightsteelblue" stroke="black" d="M508,-22335C508,-22335 342,-22335 342,-22335 336,-22335 330,-22329 330,-22323 330,-22323 330,-22279 330,-22279 330,-22273 336,-22267 342,-22267 342,-22267 508,-22267 508,-22267 514,-22267 520,-22273 520,-22279 520,-22279 520,-22323 520,-22323 520,-22329 514,-22335 508,-22335"/>
<text text-anchor="middle" x="425" y="-22319.8" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="425" y="-22304.8" font-family="Arial" font-size="14.00">GPU 4</text>
<text text-anchor="middle" x="425" y="-22289.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="425" y="-22274.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_4&#45;&gt;expert_4_0 -->
<g id="edge99" class="edge">
<title>expert_gate_4&#45;&gt;expert_4_0</title>
<path fill="none" stroke="black" d="M1242.85,-22450C1023.93,-22450 463.5,-22450 463.5,-22450 463.5,-22450 463.5,-22345.18 463.5,-22345.18"/>
<polygon fill="black" stroke="black" points="467,-22345.18 463.5,-22335.18 460,-22345.18 467,-22345.18"/>
</g>
<!-- expert_4_1 -->
<g id="node84" class="node">
<title>expert_4_1</title>
<path fill="lightsteelblue" stroke="black" d="M734,-22335C734,-22335 568,-22335 568,-22335 562,-22335 556,-22329 556,-22323 556,-22323 556,-22279 556,-22279 556,-22273 562,-22267 568,-22267 568,-22267 734,-22267 734,-22267 740,-22267 746,-22273 746,-22279 746,-22279 746,-22323 746,-22323 746,-22329 740,-22335 734,-22335"/>
<text text-anchor="middle" x="651" y="-22319.8" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="651" y="-22304.8" font-family="Arial" font-size="14.00">GPU 5</text>
<text text-anchor="middle" x="651" y="-22289.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="651" y="-22274.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_4&#45;&gt;expert_4_1 -->
<g id="edge100" class="edge">
<title>expert_gate_4&#45;&gt;expert_4_1</title>
<path fill="none" stroke="black" d="M1242.75,-22439C1068.2,-22439 689.5,-22439 689.5,-22439 689.5,-22439 689.5,-22345.11 689.5,-22345.11"/>
<polygon fill="black" stroke="black" points="693,-22345.11 689.5,-22335.11 686,-22345.11 693,-22345.11"/>
</g>
<!-- expert_4_2 -->
<g id="node85" class="node">
<title>expert_4_2</title>
<path fill="lightsteelblue" stroke="black" d="M960,-22335C960,-22335 794,-22335 794,-22335 788,-22335 782,-22329 782,-22323 782,-22323 782,-22279 782,-22279 782,-22273 788,-22267 794,-22267 794,-22267 960,-22267 960,-22267 966,-22267 972,-22273 972,-22279 972,-22279 972,-22323 972,-22323 972,-22329 966,-22335 960,-22335"/>
<text text-anchor="middle" x="877" y="-22319.8" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="877" y="-22304.8" font-family="Arial" font-size="14.00">GPU 6</text>
<text text-anchor="middle" x="877" y="-22289.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="877" y="-22274.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_4&#45;&gt;expert_4_2 -->
<g id="edge101" class="edge">
<title>expert_gate_4&#45;&gt;expert_4_2</title>
<path fill="none" stroke="black" d="M1242.82,-22429C1121.64,-22429 915.5,-22429 915.5,-22429 915.5,-22429 915.5,-22345.3 915.5,-22345.3"/>
<polygon fill="black" stroke="black" points="919,-22345.3 915.5,-22335.3 912,-22345.3 919,-22345.3"/>
</g>
<!-- expert_4_3 -->
<g id="node86" class="node">
<title>expert_4_3</title>
<path fill="lightsteelblue" stroke="black" d="M1186,-22335C1186,-22335 1020,-22335 1020,-22335 1014,-22335 1008,-22329 1008,-22323 1008,-22323 1008,-22279 1008,-22279 1008,-22273 1014,-22267 1020,-22267 1020,-22267 1186,-22267 1186,-22267 1192,-22267 1198,-22273 1198,-22279 1198,-22279 1198,-22323 1198,-22323 1198,-22329 1192,-22335 1186,-22335"/>
<text text-anchor="middle" x="1103" y="-22319.8" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1103" y="-22304.8" font-family="Arial" font-size="14.00">GPU 7</text>
<text text-anchor="middle" x="1103" y="-22289.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1103" y="-22274.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_4&#45;&gt;expert_4_3 -->
<g id="edge102" class="edge">
<title>expert_gate_4&#45;&gt;expert_4_3</title>
<path fill="none" stroke="black" d="M1242.77,-22418C1195.03,-22418 1145.25,-22418 1145.25,-22418 1145.25,-22418 1145.25,-22345.16 1145.25,-22345.16"/>
<polygon fill="black" stroke="black" points="1148.75,-22345.16 1145.25,-22335.16 1141.75,-22345.16 1148.75,-22345.16"/>
</g>
<!-- expert_4_4 -->
<g id="node87" class="node">
<title>expert_4_4</title>
<path fill="lightsteelblue" stroke="black" d="M1412,-22335C1412,-22335 1246,-22335 1246,-22335 1240,-22335 1234,-22329 1234,-22323 1234,-22323 1234,-22279 1234,-22279 1234,-22273 1240,-22267 1246,-22267 1246,-22267 1412,-22267 1412,-22267 1418,-22267 1424,-22273 1424,-22279 1424,-22279 1424,-22323 1424,-22323 1424,-22329 1418,-22335 1412,-22335"/>
<text text-anchor="middle" x="1329" y="-22319.8" font-family="Arial" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1329" y="-22304.8" font-family="Arial" font-size="14.00">GPU 8</text>
<text text-anchor="middle" x="1329" y="-22289.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1329" y="-22274.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_4&#45;&gt;expert_4_4 -->
<g id="edge103" class="edge">
<title>expert_gate_4&#45;&gt;expert_4_4</title>
<path fill="none" stroke="black" d="M1329,-22407.81C1329,-22407.81 1329,-22345.26 1329,-22345.26"/>
<polygon fill="black" stroke="black" points="1332.5,-22345.26 1329,-22335.26 1325.5,-22345.26 1332.5,-22345.26"/>
</g>
<!-- expert_4_5 -->
<g id="node88" class="node">
<title>expert_4_5</title>
<path fill="lightsteelblue" stroke="black" d="M1638,-22335C1638,-22335 1472,-22335 1472,-22335 1466,-22335 1460,-22329 1460,-22323 1460,-22323 1460,-22279 1460,-22279 1460,-22273 1466,-22267 1472,-22267 1472,-22267 1638,-22267 1638,-22267 1644,-22267 1650,-22273 1650,-22279 1650,-22279 1650,-22323 1650,-22323 1650,-22329 1644,-22335 1638,-22335"/>
<text text-anchor="middle" x="1555" y="-22319.8" font-family="Arial" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1555" y="-22304.8" font-family="Arial" font-size="14.00">GPU 9</text>
<text text-anchor="middle" x="1555" y="-22289.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1555" y="-22274.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_4&#45;&gt;expert_4_5 -->
<g id="edge104" class="edge">
<title>expert_gate_4&#45;&gt;expert_4_5</title>
<path fill="none" stroke="black" d="M1415.05,-22421C1446.6,-22421 1474.75,-22421 1474.75,-22421 1474.75,-22421 1474.75,-22345.07 1474.75,-22345.07"/>
<polygon fill="black" stroke="black" points="1478.25,-22345.07 1474.75,-22335.07 1471.25,-22345.07 1478.25,-22345.07"/>
</g>
<!-- expert_4_6 -->
<g id="node89" class="node">
<title>expert_4_6</title>
<path fill="lightsteelblue" stroke="black" d="M1864,-22335C1864,-22335 1698,-22335 1698,-22335 1692,-22335 1686,-22329 1686,-22323 1686,-22323 1686,-22279 1686,-22279 1686,-22273 1692,-22267 1698,-22267 1698,-22267 1864,-22267 1864,-22267 1870,-22267 1876,-22273 1876,-22279 1876,-22279 1876,-22323 1876,-22323 1876,-22329 1870,-22335 1864,-22335"/>
<text text-anchor="middle" x="1781" y="-22319.8" font-family="Arial" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="1781" y="-22304.8" font-family="Arial" font-size="14.00">GPU 10</text>
<text text-anchor="middle" x="1781" y="-22289.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1781" y="-22274.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_4&#45;&gt;expert_4_6 -->
<g id="edge105" class="edge">
<title>expert_gate_4&#45;&gt;expert_4_6</title>
<path fill="none" stroke="black" d="M1415.15,-22434C1526.01,-22434 1704.5,-22434 1704.5,-22434 1704.5,-22434 1704.5,-22345.25 1704.5,-22345.25"/>
<polygon fill="black" stroke="black" points="1708,-22345.25 1704.5,-22335.25 1701,-22345.25 1708,-22345.25"/>
</g>
<!-- expert_4_7 -->
<g id="node90" class="node">
<title>expert_4_7</title>
<path fill="lightsteelblue" stroke="black" d="M2090,-22335C2090,-22335 1924,-22335 1924,-22335 1918,-22335 1912,-22329 1912,-22323 1912,-22323 1912,-22279 1912,-22279 1912,-22273 1918,-22267 1924,-22267 1924,-22267 2090,-22267 2090,-22267 2096,-22267 2102,-22273 2102,-22279 2102,-22279 2102,-22323 2102,-22323 2102,-22329 2096,-22335 2090,-22335"/>
<text text-anchor="middle" x="2007" y="-22319.8" font-family="Arial" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2007" y="-22304.8" font-family="Arial" font-size="14.00">GPU 11</text>
<text text-anchor="middle" x="2007" y="-22289.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="2007" y="-22274.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_4&#45;&gt;expert_4_7 -->
<g id="edge106" class="edge">
<title>expert_gate_4&#45;&gt;expert_4_7</title>
<path fill="none" stroke="black" d="M1415.03,-22447C1585.05,-22447 1947.75,-22447 1947.75,-22447 1947.75,-22447 1947.75,-22345.23 1947.75,-22345.23"/>
<polygon fill="black" stroke="black" points="1951.25,-22345.23 1947.75,-22335.23 1944.25,-22345.23 1951.25,-22345.23"/>
</g>
<!-- expert_agg_4 -->
<g id="node91" class="node">
<title>expert_agg_4</title>
<path fill="lightsalmon" stroke="black" d="M1404.5,-22194C1404.5,-22194 1253.5,-22194 1253.5,-22194 1247.5,-22194 1241.5,-22188 1241.5,-22182 1241.5,-22182 1241.5,-22153 1241.5,-22153 1241.5,-22147 1247.5,-22141 1253.5,-22141 1253.5,-22141 1404.5,-22141 1404.5,-22141 1410.5,-22141 1416.5,-22147 1416.5,-22153 1416.5,-22153 1416.5,-22182 1416.5,-22182 1416.5,-22188 1410.5,-22194 1404.5,-22194"/>
<text text-anchor="middle" x="1329" y="-22178.8" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1329" y="-22163.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1329" y="-22148.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- expert_4_0&#45;&gt;expert_agg_4 -->
<g id="edge107" class="edge">
<title>expert_4_0&#45;&gt;expert_agg_4</title>
<path fill="none" stroke="black" d="M436.5,-22266.96C436.5,-22222.71 436.5,-22151 436.5,-22151 436.5,-22151 1231.39,-22151 1231.39,-22151"/>
<polygon fill="black" stroke="black" points="1231.39,-22154.5 1241.39,-22151 1231.39,-22147.5 1231.39,-22154.5"/>
</g>
<!-- expert_4_1&#45;&gt;expert_agg_4 -->
<g id="edge108" class="edge">
<title>expert_4_1&#45;&gt;expert_agg_4</title>
<path fill="none" stroke="black" d="M662.5,-22267C662.5,-22225.85 662.5,-22162 662.5,-22162 662.5,-22162 1231.18,-22162 1231.18,-22162"/>
<polygon fill="black" stroke="black" points="1231.18,-22165.5 1241.18,-22162 1231.18,-22158.5 1231.18,-22165.5"/>
</g>
<!-- expert_4_2&#45;&gt;expert_agg_4 -->
<g id="edge109" class="edge">
<title>expert_4_2&#45;&gt;expert_agg_4</title>
<path fill="none" stroke="black" d="M888.5,-22266.77C888.5,-22228.55 888.5,-22172 888.5,-22172 888.5,-22172 1231.44,-22172 1231.44,-22172"/>
<polygon fill="black" stroke="black" points="1231.44,-22175.5 1241.44,-22172 1231.44,-22168.5 1231.44,-22175.5"/>
</g>
<!-- expert_4_3&#45;&gt;expert_agg_4 -->
<g id="edge110" class="edge">
<title>expert_4_3&#45;&gt;expert_agg_4</title>
<path fill="none" stroke="black" d="M1114.5,-22266.87C1114.5,-22232.02 1114.5,-22183 1114.5,-22183 1114.5,-22183 1231.45,-22183 1231.45,-22183"/>
<polygon fill="black" stroke="black" points="1231.45,-22186.5 1241.45,-22183 1231.45,-22179.5 1231.45,-22186.5"/>
</g>
<!-- expert_4_4&#45;&gt;expert_agg_4 -->
<g id="edge111" class="edge">
<title>expert_4_4&#45;&gt;expert_agg_4</title>
<path fill="none" stroke="black" d="M1329,-22266.97C1329,-22266.97 1329,-22204.32 1329,-22204.32"/>
<polygon fill="black" stroke="black" points="1332.5,-22204.32 1329,-22194.32 1325.5,-22204.32 1332.5,-22204.32"/>
</g>
<!-- expert_4_5&#45;&gt;expert_agg_4 -->
<g id="edge112" class="edge">
<title>expert_4_5&#45;&gt;expert_agg_4</title>
<path fill="none" stroke="black" d="M1556,-22266.97C1556,-22231.18 1556,-22180 1556,-22180 1556,-22180 1426.76,-22180 1426.76,-22180"/>
<polygon fill="black" stroke="black" points="1426.76,-22176.5 1416.76,-22180 1426.76,-22183.5 1426.76,-22176.5"/>
</g>
<!-- expert_4_6&#45;&gt;expert_agg_4 -->
<g id="edge113" class="edge">
<title>expert_4_6&#45;&gt;expert_agg_4</title>
<path fill="none" stroke="black" d="M1752.75,-22266.84C1752.75,-22227.14 1752.75,-22167 1752.75,-22167 1752.75,-22167 1426.54,-22167 1426.54,-22167"/>
<polygon fill="black" stroke="black" points="1426.54,-22163.5 1416.54,-22167 1426.54,-22170.5 1426.54,-22163.5"/>
</g>
<!-- expert_4_7&#45;&gt;expert_agg_4 -->
<g id="edge114" class="edge">
<title>expert_4_7&#45;&gt;expert_agg_4</title>
<path fill="none" stroke="black" d="M1959.25,-22266.91C1959.25,-22223.48 1959.25,-22154 1959.25,-22154 1959.25,-22154 1426.63,-22154 1426.63,-22154"/>
<polygon fill="black" stroke="black" points="1426.63,-22150.5 1416.63,-22154 1426.63,-22157.5 1426.63,-22150.5"/>
</g>
<!-- activation_4 -->
<g id="node92" class="node">
<title>activation_4</title>
<path fill="lightyellow" stroke="black" d="M1636.5,-22068C1636.5,-22068 1475.5,-22068 1475.5,-22068 1469.5,-22068 1463.5,-22062 1463.5,-22056 1463.5,-22056 1463.5,-22042 1463.5,-22042 1463.5,-22036 1469.5,-22030 1475.5,-22030 1475.5,-22030 1636.5,-22030 1636.5,-22030 1642.5,-22030 1648.5,-22036 1648.5,-22042 1648.5,-22042 1648.5,-22056 1648.5,-22056 1648.5,-22062 1642.5,-22068 1636.5,-22068"/>
<text text-anchor="middle" x="1556" y="-22052.8" font-family="Arial" font-size="14.00">GELU</text>
<text text-anchor="middle" x="1556" y="-22037.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- expert_agg_4&#45;&gt;activation_4 -->
<g id="edge115" class="edge">
<title>expert_agg_4&#45;&gt;activation_4</title>
<path fill="none" stroke="black" d="M1341.25,-22140.91C1341.25,-22105.97 1341.25,-22049 1341.25,-22049 1341.25,-22049 1453.37,-22049 1453.37,-22049"/>
<polygon fill="black" stroke="black" points="1453.37,-22052.5 1463.37,-22049 1453.37,-22045.5 1453.37,-22052.5"/>
</g>
<!-- dense_4h_h_4 -->
<g id="node93" class="node">
<title>dense_4h_h_4</title>
<path fill="lightblue" stroke="black" d="M1807.5,-21957C1807.5,-21957 1646.5,-21957 1646.5,-21957 1640.5,-21957 1634.5,-21951 1634.5,-21945 1634.5,-21945 1634.5,-21901 1634.5,-21901 1634.5,-21895 1640.5,-21889 1646.5,-21889 1646.5,-21889 1807.5,-21889 1807.5,-21889 1813.5,-21889 1819.5,-21895 1819.5,-21901 1819.5,-21901 1819.5,-21945 1819.5,-21945 1819.5,-21951 1813.5,-21957 1807.5,-21957"/>
<text text-anchor="middle" x="1727" y="-21941.8" font-family="Arial" font-size="14.00">Dense 4H→H</text>
<text text-anchor="middle" x="1727" y="-21926.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1727" y="-21911.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1727" y="-21896.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- activation_4&#45;&gt;dense_4h_h_4 -->
<g id="edge116" class="edge">
<title>activation_4&#45;&gt;dense_4h_h_4</title>
<path fill="none" stroke="black" d="M1641.5,-22029.86C1641.5,-22029.86 1641.5,-21967.07 1641.5,-21967.07"/>
<polygon fill="black" stroke="black" points="1645,-21967.07 1641.5,-21957.07 1638,-21967.07 1645,-21967.07"/>
</g>
<!-- allreduce_mlp_4 -->
<g id="node94" class="node">
<title>allreduce_mlp_4</title>
<path fill="lightcoral" stroke="black" d="M1994.5,-21816C1994.5,-21816 1861.5,-21816 1861.5,-21816 1855.5,-21816 1849.5,-21810 1849.5,-21804 1849.5,-21804 1849.5,-21790 1849.5,-21790 1849.5,-21784 1855.5,-21778 1861.5,-21778 1861.5,-21778 1994.5,-21778 1994.5,-21778 2000.5,-21778 2006.5,-21784 2006.5,-21790 2006.5,-21790 2006.5,-21804 2006.5,-21804 2006.5,-21810 2000.5,-21816 1994.5,-21816"/>
<text text-anchor="middle" x="1928" y="-21800.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1928" y="-21785.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- dense_4h_h_4&#45;&gt;allreduce_mlp_4 -->
<g id="edge117" class="edge">
<title>dense_4h_h_4&#45;&gt;allreduce_mlp_4</title>
<path fill="none" stroke="black" d="M1802.5,-21888.9C1802.5,-21851.59 1802.5,-21797 1802.5,-21797 1802.5,-21797 1839.23,-21797 1839.23,-21797"/>
<polygon fill="black" stroke="black" points="1839.23,-21800.5 1849.23,-21797 1839.23,-21793.5 1839.23,-21800.5"/>
</g>
<!-- residual2_4 -->
<g id="node99" class="node">
<title>residual2_4</title>
<path fill="lightgray" stroke="black" d="M2033.5,-21705C2033.5,-21705 1900.5,-21705 1900.5,-21705 1894.5,-21705 1888.5,-21699 1888.5,-21693 1888.5,-21693 1888.5,-21679 1888.5,-21679 1888.5,-21673 1894.5,-21667 1900.5,-21667 1900.5,-21667 2033.5,-21667 2033.5,-21667 2039.5,-21667 2045.5,-21673 2045.5,-21679 2045.5,-21679 2045.5,-21693 2045.5,-21693 2045.5,-21699 2039.5,-21705 2033.5,-21705"/>
<text text-anchor="middle" x="1967" y="-21689.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1967" y="-21674.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_mlp_4&#45;&gt;residual2_4 -->
<g id="edge125" class="edge">
<title>allreduce_mlp_4&#45;&gt;residual2_4</title>
<path fill="none" stroke="black" d="M1947.5,-21777.92C1947.5,-21777.92 1947.5,-21715.2 1947.5,-21715.2"/>
<polygon fill="black" stroke="black" points="1951,-21715.2 1947.5,-21705.2 1944,-21715.2 1951,-21715.2"/>
</g>
<!-- norm1_4 -->
<g id="node96" class="node">
<title>norm1_4</title>
<path fill="lightcyan" stroke="black" d="M1849.5,-23466C1849.5,-23466 1716.5,-23466 1716.5,-23466 1710.5,-23466 1704.5,-23460 1704.5,-23454 1704.5,-23454 1704.5,-23440 1704.5,-23440 1704.5,-23434 1710.5,-23428 1716.5,-23428 1716.5,-23428 1849.5,-23428 1849.5,-23428 1855.5,-23428 1861.5,-23434 1861.5,-23440 1861.5,-23440 1861.5,-23454 1861.5,-23454 1861.5,-23460 1855.5,-23466 1849.5,-23466"/>
<text text-anchor="middle" x="1783" y="-23450.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1783" y="-23435.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- input_4&#45;&gt;norm1_4 -->
<g id="edge118" class="edge">
<title>input_4&#45;&gt;norm1_4</title>
<path fill="none" stroke="black" d="M1813.75,-23543.62C1813.75,-23543.62 1813.75,-23476.14 1813.75,-23476.14"/>
<polygon fill="black" stroke="black" points="1817.25,-23476.14 1813.75,-23466.14 1810.25,-23476.14 1817.25,-23476.14"/>
</g>
<!-- input_4&#45;&gt;residual1_4 -->
<g id="edge119" class="edge">
<title>input_4&#45;&gt;residual1_4</title>
<path fill="none" stroke="black" d="M1928,-23541.73C1928,-23541.73 1928,-22840.15 1928,-22840.15"/>
<polygon fill="black" stroke="black" points="1931.5,-22840.15 1928,-22830.15 1924.5,-22840.15 1931.5,-22840.15"/>
</g>
<!-- norm1_4&#45;&gt;qkv_proj_4 -->
<g id="edge120" class="edge">
<title>norm1_4&#45;&gt;qkv_proj_4</title>
<path fill="none" stroke="black" d="M1783,-23427.81C1783,-23427.81 1783,-23359.06 1783,-23359.06"/>
<polygon fill="black" stroke="black" points="1786.5,-23359.06 1783,-23349.06 1779.5,-23359.06 1786.5,-23359.06"/>
</g>
<!-- norm2_4 -->
<g id="node98" class="node">
<title>norm2_4</title>
<path fill="lightcyan" stroke="black" d="M1621.5,-22719C1621.5,-22719 1488.5,-22719 1488.5,-22719 1482.5,-22719 1476.5,-22713 1476.5,-22707 1476.5,-22707 1476.5,-22693 1476.5,-22693 1476.5,-22687 1482.5,-22681 1488.5,-22681 1488.5,-22681 1621.5,-22681 1621.5,-22681 1627.5,-22681 1633.5,-22687 1633.5,-22693 1633.5,-22693 1633.5,-22707 1633.5,-22707 1633.5,-22713 1627.5,-22719 1621.5,-22719"/>
<text text-anchor="middle" x="1555" y="-22703.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1555" y="-22688.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual1_4&#45;&gt;norm2_4 -->
<g id="edge122" class="edge">
<title>residual1_4&#45;&gt;norm2_4</title>
<path fill="none" stroke="black" d="M1851.25,-22791.92C1851.25,-22760.18 1851.25,-22700 1851.25,-22700 1851.25,-22700 1643.61,-22700 1643.61,-22700"/>
<polygon fill="black" stroke="black" points="1643.61,-22696.5 1633.61,-22700 1643.61,-22703.5 1643.61,-22696.5"/>
</g>
<!-- residual1_4&#45;&gt;residual2_4 -->
<g id="edge123" class="edge">
<title>residual1_4&#45;&gt;residual2_4</title>
<path fill="none" stroke="black" d="M1894,-22792C1894,-22691.87 1894,-22230 1894,-22230 1894,-22230 2026,-22230 2026,-22230 2026,-22230 2026,-21715.04 2026,-21715.04"/>
<polygon fill="black" stroke="black" points="2029.5,-21715.04 2026,-21705.04 2022.5,-21715.04 2029.5,-21715.04"/>
</g>
<!-- norm2_4&#45;&gt;dense_h_4h_4 -->
<g id="edge124" class="edge">
<title>norm2_4&#45;&gt;dense_h_4h_4</title>
<path fill="none" stroke="black" d="M1483,-22680.81C1483,-22680.81 1483,-22612.06 1483,-22612.06"/>
<polygon fill="black" stroke="black" points="1486.5,-22612.06 1483,-22602.06 1479.5,-22612.06 1486.5,-22612.06"/>
</g>
<!-- output_4 -->
<g id="node100" class="node">
<title>output_4</title>
<ellipse fill="white" stroke="black" cx="1967" cy="-21567" rx="111" ry="27"/>
<text text-anchor="middle" x="1967" y="-21570.8" font-family="Arial" font-size="14.00">Layer 5 Output</text>
<text text-anchor="middle" x="1967" y="-21555.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual2_4&#45;&gt;output_4 -->
<g id="edge126" class="edge">
<title>residual2_4&#45;&gt;output_4</title>
<path fill="none" stroke="black" d="M1967,-21666.88C1967,-21666.88 1967,-21604.05 1967,-21604.05"/>
<polygon fill="black" stroke="black" points="1970.5,-21604.05 1967,-21594.05 1963.5,-21604.05 1970.5,-21604.05"/>
</g>
<!-- input_5 -->
<g id="node109" class="node">
<title>input_5</title>
<ellipse fill="white" stroke="black" cx="1967" cy="-21405" rx="111" ry="27"/>
<text text-anchor="middle" x="1967" y="-21408.8" font-family="Arial" font-size="14.00">Layer 6 Input</text>
<text text-anchor="middle" x="1967" y="-21393.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- output_4&#45;&gt;input_5 -->
<g id="edge382" class="edge">
<title>output_4&#45;&gt;input_5</title>
<path fill="none" stroke="red" stroke-width="2" stroke-dasharray="5,2" d="M1967,-21539.88C1967,-21539.88 1967,-21442.2 1967,-21442.2"/>
<polygon fill="red" stroke="red" stroke-width="2" points="1970.5,-21442.2 1967,-21432.2 1963.5,-21442.2 1970.5,-21442.2"/>
<text text-anchor="middle" x="2023" y="-21492.8" font-family="Times,serif" font-size="14.00">GPU&#45;to&#45;GPU</text>
<text text-anchor="middle" x="2023" y="-21477.8" font-family="Times,serif" font-size="14.00">Communication</text>
</g>
<!-- qkv_proj_5 -->
<g id="node101" class="node">
<title>qkv_proj_5</title>
<path fill="lightgreen" stroke="black" d="M2035.5,-21188C2035.5,-21188 1856.5,-21188 1856.5,-21188 1850.5,-21188 1844.5,-21182 1844.5,-21176 1844.5,-21176 1844.5,-21132 1844.5,-21132 1844.5,-21126 1850.5,-21120 1856.5,-21120 1856.5,-21120 2035.5,-21120 2035.5,-21120 2041.5,-21120 2047.5,-21126 2047.5,-21132 2047.5,-21132 2047.5,-21176 2047.5,-21176 2047.5,-21182 2041.5,-21188 2035.5,-21188"/>
<text text-anchor="middle" x="1946" y="-21172.8" font-family="Arial" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1946" y="-21157.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1946" y="-21142.8" font-family="Arial" font-size="14.00">[1024, seq_len, 3*hidden]</text>
<text text-anchor="middle" x="1946" y="-21127.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 3*hidden/tp]</text>
</g>
<!-- attn_comp_5 -->
<g id="node102" class="node">
<title>attn_comp_5</title>
<path fill="lightyellow" stroke="black" d="M2027,-21047C2027,-21047 1879,-21047 1879,-21047 1873,-21047 1867,-21041 1867,-21035 1867,-21035 1867,-21006 1867,-21006 1867,-21000 1873,-20994 1879,-20994 1879,-20994 2027,-20994 2027,-20994 2033,-20994 2039,-21000 2039,-21006 2039,-21006 2039,-21035 2039,-21035 2039,-21041 2033,-21047 2027,-21047"/>
<text text-anchor="middle" x="1953" y="-21031.8" font-family="Arial" font-size="14.00">Attention</text>
<text text-anchor="middle" x="1953" y="-21016.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1953" y="-21001.8" font-family="Arial" font-size="14.00">Heads: 2 per GPU</text>
</g>
<!-- qkv_proj_5&#45;&gt;attn_comp_5 -->
<g id="edge127" class="edge">
<title>qkv_proj_5&#45;&gt;attn_comp_5</title>
<path fill="none" stroke="black" d="M1953,-21119.97C1953,-21119.97 1953,-21057.32 1953,-21057.32"/>
<polygon fill="black" stroke="black" points="1956.5,-21057.32 1953,-21047.32 1949.5,-21057.32 1956.5,-21057.32"/>
</g>
<!-- out_proj_5 -->
<g id="node103" class="node">
<title>out_proj_5</title>
<path fill="lightgreen" stroke="black" d="M2033.5,-20921C2033.5,-20921 1882.5,-20921 1882.5,-20921 1876.5,-20921 1870.5,-20915 1870.5,-20909 1870.5,-20909 1870.5,-20865 1870.5,-20865 1870.5,-20859 1876.5,-20853 1882.5,-20853 1882.5,-20853 2033.5,-20853 2033.5,-20853 2039.5,-20853 2045.5,-20859 2045.5,-20865 2045.5,-20865 2045.5,-20909 2045.5,-20909 2045.5,-20915 2039.5,-20921 2033.5,-20921"/>
<text text-anchor="middle" x="1958" y="-20905.8" font-family="Arial" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="1958" y="-20890.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1958" y="-20875.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1958" y="-20860.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- attn_comp_5&#45;&gt;out_proj_5 -->
<g id="edge128" class="edge">
<title>attn_comp_5&#45;&gt;out_proj_5</title>
<path fill="none" stroke="black" d="M1954.75,-20993.81C1954.75,-20993.81 1954.75,-20931.26 1954.75,-20931.26"/>
<polygon fill="black" stroke="black" points="1958.25,-20931.26 1954.75,-20921.26 1951.25,-20931.26 1958.25,-20931.26"/>
</g>
<!-- allreduce_attn_5 -->
<g id="node104" class="node">
<title>allreduce_attn_5</title>
<path fill="lightcoral" stroke="black" d="M2033.5,-20780C2033.5,-20780 1900.5,-20780 1900.5,-20780 1894.5,-20780 1888.5,-20774 1888.5,-20768 1888.5,-20768 1888.5,-20754 1888.5,-20754 1888.5,-20748 1894.5,-20742 1900.5,-20742 1900.5,-20742 2033.5,-20742 2033.5,-20742 2039.5,-20742 2045.5,-20748 2045.5,-20754 2045.5,-20754 2045.5,-20768 2045.5,-20768 2045.5,-20774 2039.5,-20780 2033.5,-20780"/>
<text text-anchor="middle" x="1967" y="-20764.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1967" y="-20749.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- out_proj_5&#45;&gt;allreduce_attn_5 -->
<g id="edge129" class="edge">
<title>out_proj_5&#45;&gt;allreduce_attn_5</title>
<path fill="none" stroke="black" d="M1967,-20852.9C1967,-20852.9 1967,-20790.24 1967,-20790.24"/>
<polygon fill="black" stroke="black" points="1970.5,-20790.24 1967,-20780.24 1963.5,-20790.24 1970.5,-20790.24"/>
</g>
<!-- residual1_5 -->
<g id="node111" class="node">
<title>residual1_5</title>
<path fill="lightgray" stroke="black" d="M2050.5,-20669C2050.5,-20669 1917.5,-20669 1917.5,-20669 1911.5,-20669 1905.5,-20663 1905.5,-20657 1905.5,-20657 1905.5,-20643 1905.5,-20643 1905.5,-20637 1911.5,-20631 1917.5,-20631 1917.5,-20631 2050.5,-20631 2050.5,-20631 2056.5,-20631 2062.5,-20637 2062.5,-20643 2062.5,-20643 2062.5,-20657 2062.5,-20657 2062.5,-20663 2056.5,-20669 2050.5,-20669"/>
<text text-anchor="middle" x="1984" y="-20653.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1984" y="-20638.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_attn_5&#45;&gt;residual1_5 -->
<g id="edge136" class="edge">
<title>allreduce_attn_5&#45;&gt;residual1_5</title>
<path fill="none" stroke="black" d="M1975.5,-20741.92C1975.5,-20741.92 1975.5,-20679.2 1975.5,-20679.2"/>
<polygon fill="black" stroke="black" points="1979,-20679.2 1975.5,-20669.2 1972,-20679.2 1979,-20679.2"/>
</g>
<!-- dense_h_4h_5 -->
<g id="node105" class="node">
<title>dense_h_4h_5</title>
<path fill="lightblue" stroke="black" d="M2035.5,-20441C2035.5,-20441 1856.5,-20441 1856.5,-20441 1850.5,-20441 1844.5,-20435 1844.5,-20429 1844.5,-20429 1844.5,-20385 1844.5,-20385 1844.5,-20379 1850.5,-20373 1856.5,-20373 1856.5,-20373 2035.5,-20373 2035.5,-20373 2041.5,-20373 2047.5,-20379 2047.5,-20385 2047.5,-20385 2047.5,-20429 2047.5,-20429 2047.5,-20435 2041.5,-20441 2035.5,-20441"/>
<text text-anchor="middle" x="1946" y="-20425.8" font-family="Arial" font-size="14.00">Dense H→4H</text>
<text text-anchor="middle" x="1946" y="-20410.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1946" y="-20395.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
<text text-anchor="middle" x="1946" y="-20380.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- activation_5 -->
<g id="node106" class="node">
<title>activation_5</title>
<path fill="lightyellow" stroke="black" d="M2031.5,-20300C2031.5,-20300 1870.5,-20300 1870.5,-20300 1864.5,-20300 1858.5,-20294 1858.5,-20288 1858.5,-20288 1858.5,-20274 1858.5,-20274 1858.5,-20268 1864.5,-20262 1870.5,-20262 1870.5,-20262 2031.5,-20262 2031.5,-20262 2037.5,-20262 2043.5,-20268 2043.5,-20274 2043.5,-20274 2043.5,-20288 2043.5,-20288 2043.5,-20294 2037.5,-20300 2031.5,-20300"/>
<text text-anchor="middle" x="1951" y="-20284.8" font-family="Arial" font-size="14.00">GELU</text>
<text text-anchor="middle" x="1951" y="-20269.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- dense_h_4h_5&#45;&gt;activation_5 -->
<g id="edge130" class="edge">
<title>dense_h_4h_5&#45;&gt;activation_5</title>
<path fill="none" stroke="black" d="M1951,-20372.9C1951,-20372.9 1951,-20310.24 1951,-20310.24"/>
<polygon fill="black" stroke="black" points="1954.5,-20310.24 1951,-20300.24 1947.5,-20310.24 1954.5,-20310.24"/>
</g>
<!-- dense_4h_h_5 -->
<g id="node107" class="node">
<title>dense_4h_h_5</title>
<path fill="lightblue" stroke="black" d="M2034.5,-20189C2034.5,-20189 1873.5,-20189 1873.5,-20189 1867.5,-20189 1861.5,-20183 1861.5,-20177 1861.5,-20177 1861.5,-20133 1861.5,-20133 1861.5,-20127 1867.5,-20121 1873.5,-20121 1873.5,-20121 2034.5,-20121 2034.5,-20121 2040.5,-20121 2046.5,-20127 2046.5,-20133 2046.5,-20133 2046.5,-20177 2046.5,-20177 2046.5,-20183 2040.5,-20189 2034.5,-20189"/>
<text text-anchor="middle" x="1954" y="-20173.8" font-family="Arial" font-size="14.00">Dense 4H→H</text>
<text text-anchor="middle" x="1954" y="-20158.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1954" y="-20143.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1954" y="-20128.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- activation_5&#45;&gt;dense_4h_h_5 -->
<g id="edge131" class="edge">
<title>activation_5&#45;&gt;dense_4h_h_5</title>
<path fill="none" stroke="black" d="M1952.5,-20261.86C1952.5,-20261.86 1952.5,-20199.07 1952.5,-20199.07"/>
<polygon fill="black" stroke="black" points="1956,-20199.07 1952.5,-20189.07 1949,-20199.07 1956,-20199.07"/>
</g>
<!-- allreduce_mlp_5 -->
<g id="node108" class="node">
<title>allreduce_mlp_5</title>
<path fill="lightcoral" stroke="black" d="M2026.5,-20048C2026.5,-20048 1893.5,-20048 1893.5,-20048 1887.5,-20048 1881.5,-20042 1881.5,-20036 1881.5,-20036 1881.5,-20022 1881.5,-20022 1881.5,-20016 1887.5,-20010 1893.5,-20010 1893.5,-20010 2026.5,-20010 2026.5,-20010 2032.5,-20010 2038.5,-20016 2038.5,-20022 2038.5,-20022 2038.5,-20036 2038.5,-20036 2038.5,-20042 2032.5,-20048 2026.5,-20048"/>
<text text-anchor="middle" x="1960" y="-20032.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1960" y="-20017.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- dense_4h_h_5&#45;&gt;allreduce_mlp_5 -->
<g id="edge132" class="edge">
<title>dense_4h_h_5&#45;&gt;allreduce_mlp_5</title>
<path fill="none" stroke="black" d="M1960,-20120.9C1960,-20120.9 1960,-20058.24 1960,-20058.24"/>
<polygon fill="black" stroke="black" points="1963.5,-20058.24 1960,-20048.24 1956.5,-20058.24 1963.5,-20058.24"/>
</g>
<!-- residual2_5 -->
<g id="node113" class="node">
<title>residual2_5</title>
<path fill="lightgray" stroke="black" d="M2027.5,-19937C2027.5,-19937 1894.5,-19937 1894.5,-19937 1888.5,-19937 1882.5,-19931 1882.5,-19925 1882.5,-19925 1882.5,-19911 1882.5,-19911 1882.5,-19905 1888.5,-19899 1894.5,-19899 1894.5,-19899 2027.5,-19899 2027.5,-19899 2033.5,-19899 2039.5,-19905 2039.5,-19911 2039.5,-19911 2039.5,-19925 2039.5,-19925 2039.5,-19931 2033.5,-19937 2027.5,-19937"/>
<text text-anchor="middle" x="1961" y="-19921.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1961" y="-19906.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_mlp_5&#45;&gt;residual2_5 -->
<g id="edge140" class="edge">
<title>allreduce_mlp_5&#45;&gt;residual2_5</title>
<path fill="none" stroke="black" d="M1960.5,-20009.92C1960.5,-20009.92 1960.5,-19947.2 1960.5,-19947.2"/>
<polygon fill="black" stroke="black" points="1964,-19947.2 1960.5,-19937.2 1957,-19947.2 1964,-19947.2"/>
</g>
<!-- norm1_5 -->
<g id="node110" class="node">
<title>norm1_5</title>
<path fill="lightcyan" stroke="black" d="M2024.5,-21305C2024.5,-21305 1891.5,-21305 1891.5,-21305 1885.5,-21305 1879.5,-21299 1879.5,-21293 1879.5,-21293 1879.5,-21279 1879.5,-21279 1879.5,-21273 1885.5,-21267 1891.5,-21267 1891.5,-21267 2024.5,-21267 2024.5,-21267 2030.5,-21267 2036.5,-21273 2036.5,-21279 2036.5,-21279 2036.5,-21293 2036.5,-21293 2036.5,-21299 2030.5,-21305 2024.5,-21305"/>
<text text-anchor="middle" x="1958" y="-21289.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1958" y="-21274.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- input_5&#45;&gt;norm1_5 -->
<g id="edge133" class="edge">
<title>input_5&#45;&gt;norm1_5</title>
<path fill="none" stroke="black" d="M1958,-21378C1958,-21378 1958,-21315.12 1958,-21315.12"/>
<polygon fill="black" stroke="black" points="1961.5,-21315.12 1958,-21305.12 1954.5,-21315.12 1961.5,-21315.12"/>
</g>
<!-- input_5&#45;&gt;residual1_5 -->
<g id="edge134" class="edge">
<title>input_5&#45;&gt;residual1_5</title>
<path fill="none" stroke="black" d="M2055,-21388.53C2055,-21388.53 2055,-20679.27 2055,-20679.27"/>
<polygon fill="black" stroke="black" points="2058.5,-20679.27 2055,-20669.27 2051.5,-20679.27 2058.5,-20679.27"/>
</g>
<!-- norm1_5&#45;&gt;qkv_proj_5 -->
<g id="edge135" class="edge">
<title>norm1_5&#45;&gt;qkv_proj_5</title>
<path fill="none" stroke="black" d="M1958,-21266.81C1958,-21266.81 1958,-21198.06 1958,-21198.06"/>
<polygon fill="black" stroke="black" points="1961.5,-21198.06 1958,-21188.06 1954.5,-21198.06 1961.5,-21198.06"/>
</g>
<!-- norm2_5 -->
<g id="node112" class="node">
<title>norm2_5</title>
<path fill="lightcyan" stroke="black" d="M2029.5,-20558C2029.5,-20558 1896.5,-20558 1896.5,-20558 1890.5,-20558 1884.5,-20552 1884.5,-20546 1884.5,-20546 1884.5,-20532 1884.5,-20532 1884.5,-20526 1890.5,-20520 1896.5,-20520 1896.5,-20520 2029.5,-20520 2029.5,-20520 2035.5,-20520 2041.5,-20526 2041.5,-20532 2041.5,-20532 2041.5,-20546 2041.5,-20546 2041.5,-20552 2035.5,-20558 2029.5,-20558"/>
<text text-anchor="middle" x="1963" y="-20542.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1963" y="-20527.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual1_5&#45;&gt;norm2_5 -->
<g id="edge137" class="edge">
<title>residual1_5&#45;&gt;norm2_5</title>
<path fill="none" stroke="black" d="M1973.5,-20630.92C1973.5,-20630.92 1973.5,-20568.2 1973.5,-20568.2"/>
<polygon fill="black" stroke="black" points="1977,-20568.2 1973.5,-20558.2 1970,-20568.2 1977,-20568.2"/>
</g>
<!-- residual1_5&#45;&gt;residual2_5 -->
<g id="edge138" class="edge">
<title>residual1_5&#45;&gt;residual2_5</title>
<path fill="none" stroke="black" d="M2055,-20630.8C2055,-20515.3 2055,-19918 2055,-19918 2055,-19918 2049.9,-19918 2049.9,-19918"/>
<polygon fill="black" stroke="black" points="2049.9,-19914.5 2039.9,-19918 2049.9,-19921.5 2049.9,-19914.5"/>
</g>
<!-- norm2_5&#45;&gt;dense_h_4h_5 -->
<g id="edge139" class="edge">
<title>norm2_5&#45;&gt;dense_h_4h_5</title>
<path fill="none" stroke="black" d="M1963,-20519.81C1963,-20519.81 1963,-20451.06 1963,-20451.06"/>
<polygon fill="black" stroke="black" points="1966.5,-20451.06 1963,-20441.06 1959.5,-20451.06 1966.5,-20451.06"/>
</g>
<!-- output_5 -->
<g id="node114" class="node">
<title>output_5</title>
<ellipse fill="white" stroke="black" cx="1961" cy="-19799" rx="111" ry="27"/>
<text text-anchor="middle" x="1961" y="-19802.8" font-family="Arial" font-size="14.00">Layer 6 Output</text>
<text text-anchor="middle" x="1961" y="-19787.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual2_5&#45;&gt;output_5 -->
<g id="edge141" class="edge">
<title>residual2_5&#45;&gt;output_5</title>
<path fill="none" stroke="black" d="M1961,-19898.88C1961,-19898.88 1961,-19836.05 1961,-19836.05"/>
<polygon fill="black" stroke="black" points="1964.5,-19836.05 1961,-19826.05 1957.5,-19836.05 1964.5,-19836.05"/>
</g>
<!-- input_6 -->
<g id="node133" class="node">
<title>input_6</title>
<ellipse fill="white" stroke="black" cx="1961" cy="-19637" rx="111" ry="27"/>
<text text-anchor="middle" x="1961" y="-19640.8" font-family="Arial" font-size="14.00">Layer 7 Input</text>
<text text-anchor="middle" x="1961" y="-19625.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- output_5&#45;&gt;input_6 -->
<g id="edge383" class="edge">
<title>output_5&#45;&gt;input_6</title>
<path fill="none" stroke="red" stroke-width="2" stroke-dasharray="5,2" d="M1961,-19771.88C1961,-19771.88 1961,-19674.2 1961,-19674.2"/>
<polygon fill="red" stroke="red" stroke-width="2" points="1964.5,-19674.2 1961,-19664.2 1957.5,-19674.2 1964.5,-19674.2"/>
<text text-anchor="middle" x="2017" y="-19724.8" font-family="Times,serif" font-size="14.00">GPU&#45;to&#45;GPU</text>
<text text-anchor="middle" x="2017" y="-19709.8" font-family="Times,serif" font-size="14.00">Communication</text>
</g>
<!-- qkv_proj_6 -->
<g id="node115" class="node">
<title>qkv_proj_6</title>
<path fill="lightgreen" stroke="black" d="M1941.5,-19420C1941.5,-19420 1762.5,-19420 1762.5,-19420 1756.5,-19420 1750.5,-19414 1750.5,-19408 1750.5,-19408 1750.5,-19364 1750.5,-19364 1750.5,-19358 1756.5,-19352 1762.5,-19352 1762.5,-19352 1941.5,-19352 1941.5,-19352 1947.5,-19352 1953.5,-19358 1953.5,-19364 1953.5,-19364 1953.5,-19408 1953.5,-19408 1953.5,-19414 1947.5,-19420 1941.5,-19420"/>
<text text-anchor="middle" x="1852" y="-19404.8" font-family="Arial" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1852" y="-19389.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1852" y="-19374.8" font-family="Arial" font-size="14.00">[1024, seq_len, 3*hidden]</text>
<text text-anchor="middle" x="1852" y="-19359.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 3*hidden/tp]</text>
</g>
<!-- attn_comp_6 -->
<g id="node116" class="node">
<title>attn_comp_6</title>
<path fill="lightyellow" stroke="black" d="M1933,-19279C1933,-19279 1785,-19279 1785,-19279 1779,-19279 1773,-19273 1773,-19267 1773,-19267 1773,-19238 1773,-19238 1773,-19232 1779,-19226 1785,-19226 1785,-19226 1933,-19226 1933,-19226 1939,-19226 1945,-19232 1945,-19238 1945,-19238 1945,-19267 1945,-19267 1945,-19273 1939,-19279 1933,-19279"/>
<text text-anchor="middle" x="1859" y="-19263.8" font-family="Arial" font-size="14.00">Attention</text>
<text text-anchor="middle" x="1859" y="-19248.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1859" y="-19233.8" font-family="Arial" font-size="14.00">Heads: 2 per GPU</text>
</g>
<!-- qkv_proj_6&#45;&gt;attn_comp_6 -->
<g id="edge142" class="edge">
<title>qkv_proj_6&#45;&gt;attn_comp_6</title>
<path fill="none" stroke="black" d="M1859,-19351.97C1859,-19351.97 1859,-19289.32 1859,-19289.32"/>
<polygon fill="black" stroke="black" points="1862.5,-19289.32 1859,-19279.32 1855.5,-19289.32 1862.5,-19289.32"/>
</g>
<!-- out_proj_6 -->
<g id="node117" class="node">
<title>out_proj_6</title>
<path fill="lightgreen" stroke="black" d="M1939.5,-19153C1939.5,-19153 1788.5,-19153 1788.5,-19153 1782.5,-19153 1776.5,-19147 1776.5,-19141 1776.5,-19141 1776.5,-19097 1776.5,-19097 1776.5,-19091 1782.5,-19085 1788.5,-19085 1788.5,-19085 1939.5,-19085 1939.5,-19085 1945.5,-19085 1951.5,-19091 1951.5,-19097 1951.5,-19097 1951.5,-19141 1951.5,-19141 1951.5,-19147 1945.5,-19153 1939.5,-19153"/>
<text text-anchor="middle" x="1864" y="-19137.8" font-family="Arial" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="1864" y="-19122.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1864" y="-19107.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1864" y="-19092.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- attn_comp_6&#45;&gt;out_proj_6 -->
<g id="edge143" class="edge">
<title>attn_comp_6&#45;&gt;out_proj_6</title>
<path fill="none" stroke="black" d="M1860.75,-19225.81C1860.75,-19225.81 1860.75,-19163.26 1860.75,-19163.26"/>
<polygon fill="black" stroke="black" points="1864.25,-19163.26 1860.75,-19153.26 1857.25,-19163.26 1864.25,-19163.26"/>
</g>
<!-- allreduce_attn_6 -->
<g id="node118" class="node">
<title>allreduce_attn_6</title>
<path fill="lightcoral" stroke="black" d="M1939.5,-19012C1939.5,-19012 1806.5,-19012 1806.5,-19012 1800.5,-19012 1794.5,-19006 1794.5,-19000 1794.5,-19000 1794.5,-18986 1794.5,-18986 1794.5,-18980 1800.5,-18974 1806.5,-18974 1806.5,-18974 1939.5,-18974 1939.5,-18974 1945.5,-18974 1951.5,-18980 1951.5,-18986 1951.5,-18986 1951.5,-19000 1951.5,-19000 1951.5,-19006 1945.5,-19012 1939.5,-19012"/>
<text text-anchor="middle" x="1873" y="-18996.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1873" y="-18981.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- out_proj_6&#45;&gt;allreduce_attn_6 -->
<g id="edge144" class="edge">
<title>out_proj_6&#45;&gt;allreduce_attn_6</title>
<path fill="none" stroke="black" d="M1873,-19084.9C1873,-19084.9 1873,-19022.24 1873,-19022.24"/>
<polygon fill="black" stroke="black" points="1876.5,-19022.24 1873,-19012.24 1869.5,-19022.24 1876.5,-19022.24"/>
</g>
<!-- residual1_6 -->
<g id="node135" class="node">
<title>residual1_6</title>
<path fill="lightgray" stroke="black" d="M2034.5,-18901C2034.5,-18901 1901.5,-18901 1901.5,-18901 1895.5,-18901 1889.5,-18895 1889.5,-18889 1889.5,-18889 1889.5,-18875 1889.5,-18875 1889.5,-18869 1895.5,-18863 1901.5,-18863 1901.5,-18863 2034.5,-18863 2034.5,-18863 2040.5,-18863 2046.5,-18869 2046.5,-18875 2046.5,-18875 2046.5,-18889 2046.5,-18889 2046.5,-18895 2040.5,-18901 2034.5,-18901"/>
<text text-anchor="middle" x="1968" y="-18885.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1968" y="-18870.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_attn_6&#45;&gt;residual1_6 -->
<g id="edge168" class="edge">
<title>allreduce_attn_6&#45;&gt;residual1_6</title>
<path fill="none" stroke="black" d="M1920.5,-18973.92C1920.5,-18973.92 1920.5,-18911.2 1920.5,-18911.2"/>
<polygon fill="black" stroke="black" points="1924,-18911.2 1920.5,-18901.2 1917,-18911.2 1924,-18911.2"/>
</g>
<!-- dense_h_4h_6 -->
<g id="node119" class="node">
<title>dense_h_4h_6</title>
<path fill="lightblue" stroke="black" d="M1667.5,-18673C1667.5,-18673 1488.5,-18673 1488.5,-18673 1482.5,-18673 1476.5,-18667 1476.5,-18661 1476.5,-18661 1476.5,-18617 1476.5,-18617 1476.5,-18611 1482.5,-18605 1488.5,-18605 1488.5,-18605 1667.5,-18605 1667.5,-18605 1673.5,-18605 1679.5,-18611 1679.5,-18617 1679.5,-18617 1679.5,-18661 1679.5,-18661 1679.5,-18667 1673.5,-18673 1667.5,-18673"/>
<text text-anchor="middle" x="1578" y="-18657.8" font-family="Arial" font-size="14.00">Dense H→4H</text>
<text text-anchor="middle" x="1578" y="-18642.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1578" y="-18627.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
<text text-anchor="middle" x="1578" y="-18612.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- expert_gate_6 -->
<g id="node120" class="node">
<title>expert_gate_6</title>
<path fill="lightpink" stroke="black" d="M1426,-18532C1426,-18532 1278,-18532 1278,-18532 1272,-18532 1266,-18526 1266,-18520 1266,-18520 1266,-18491 1266,-18491 1266,-18485 1272,-18479 1278,-18479 1278,-18479 1426,-18479 1426,-18479 1432,-18479 1438,-18485 1438,-18491 1438,-18491 1438,-18520 1438,-18520 1438,-18526 1432,-18532 1426,-18532"/>
<text text-anchor="middle" x="1352" y="-18516.8" font-family="Arial" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1352" y="-18501.8" font-family="Arial" font-size="14.00">[1024, seq_len, 8 experts]</text>
<text text-anchor="middle" x="1352" y="-18486.8" font-family="Arial" font-size="14.00">Top&#45;2 routing</text>
</g>
<!-- dense_h_4h_6&#45;&gt;expert_gate_6 -->
<g id="edge145" class="edge">
<title>dense_h_4h_6&#45;&gt;expert_gate_6</title>
<path fill="none" stroke="black" d="M1476.3,-18639C1451.03,-18639 1431,-18639 1431,-18639 1431,-18639 1431,-18542.19 1431,-18542.19"/>
<polygon fill="black" stroke="black" points="1434.5,-18542.19 1431,-18532.19 1427.5,-18542.19 1434.5,-18542.19"/>
</g>
<!-- expert_6_0 -->
<g id="node121" class="node">
<title>expert_6_0</title>
<path fill="lightsteelblue" stroke="black" d="M531,-18406C531,-18406 365,-18406 365,-18406 359,-18406 353,-18400 353,-18394 353,-18394 353,-18350 353,-18350 353,-18344 359,-18338 365,-18338 365,-18338 531,-18338 531,-18338 537,-18338 543,-18344 543,-18350 543,-18350 543,-18394 543,-18394 543,-18400 537,-18406 531,-18406"/>
<text text-anchor="middle" x="448" y="-18390.8" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="448" y="-18375.8" font-family="Arial" font-size="14.00">GPU 6</text>
<text text-anchor="middle" x="448" y="-18360.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="448" y="-18345.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_6&#45;&gt;expert_6_0 -->
<g id="edge146" class="edge">
<title>expert_gate_6&#45;&gt;expert_6_0</title>
<path fill="none" stroke="black" d="M1265.74,-18521C1055.08,-18521 531.5,-18521 531.5,-18521 531.5,-18521 531.5,-18416.18 531.5,-18416.18"/>
<polygon fill="black" stroke="black" points="535,-18416.18 531.5,-18406.18 528,-18416.18 535,-18416.18"/>
</g>
<!-- expert_6_1 -->
<g id="node122" class="node">
<title>expert_6_1</title>
<path fill="lightsteelblue" stroke="black" d="M757,-18406C757,-18406 591,-18406 591,-18406 585,-18406 579,-18400 579,-18394 579,-18394 579,-18350 579,-18350 579,-18344 585,-18338 591,-18338 591,-18338 757,-18338 757,-18338 763,-18338 769,-18344 769,-18350 769,-18350 769,-18394 769,-18394 769,-18400 763,-18406 757,-18406"/>
<text text-anchor="middle" x="674" y="-18390.8" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="674" y="-18375.8" font-family="Arial" font-size="14.00">GPU 7</text>
<text text-anchor="middle" x="674" y="-18360.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="674" y="-18345.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_6&#45;&gt;expert_6_1 -->
<g id="edge147" class="edge">
<title>expert_gate_6&#45;&gt;expert_6_1</title>
<path fill="none" stroke="black" d="M1265.87,-18510C1101.11,-18510 757.5,-18510 757.5,-18510 757.5,-18510 757.5,-18416.11 757.5,-18416.11"/>
<polygon fill="black" stroke="black" points="761,-18416.11 757.5,-18406.11 754,-18416.11 761,-18416.11"/>
</g>
<!-- expert_6_2 -->
<g id="node123" class="node">
<title>expert_6_2</title>
<path fill="lightsteelblue" stroke="black" d="M983,-18406C983,-18406 817,-18406 817,-18406 811,-18406 805,-18400 805,-18394 805,-18394 805,-18350 805,-18350 805,-18344 811,-18338 817,-18338 817,-18338 983,-18338 983,-18338 989,-18338 995,-18344 995,-18350 995,-18350 995,-18394 995,-18394 995,-18400 989,-18406 983,-18406"/>
<text text-anchor="middle" x="900" y="-18390.8" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="900" y="-18375.8" font-family="Arial" font-size="14.00">GPU 8</text>
<text text-anchor="middle" x="900" y="-18360.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="900" y="-18345.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_6&#45;&gt;expert_6_2 -->
<g id="edge148" class="edge">
<title>expert_gate_6&#45;&gt;expert_6_2</title>
<path fill="none" stroke="black" d="M1265.6,-18500C1156.69,-18500 983.5,-18500 983.5,-18500 983.5,-18500 983.5,-18416.3 983.5,-18416.3"/>
<polygon fill="black" stroke="black" points="987,-18416.3 983.5,-18406.3 980,-18416.3 987,-18416.3"/>
</g>
<!-- expert_6_3 -->
<g id="node124" class="node">
<title>expert_6_3</title>
<path fill="lightsteelblue" stroke="black" d="M1209,-18406C1209,-18406 1043,-18406 1043,-18406 1037,-18406 1031,-18400 1031,-18394 1031,-18394 1031,-18350 1031,-18350 1031,-18344 1037,-18338 1043,-18338 1043,-18338 1209,-18338 1209,-18338 1215,-18338 1221,-18344 1221,-18350 1221,-18350 1221,-18394 1221,-18394 1221,-18400 1215,-18406 1209,-18406"/>
<text text-anchor="middle" x="1126" y="-18390.8" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1126" y="-18375.8" font-family="Arial" font-size="14.00">GPU 9</text>
<text text-anchor="middle" x="1126" y="-18360.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1126" y="-18345.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_6&#45;&gt;expert_6_3 -->
<g id="edge149" class="edge">
<title>expert_gate_6&#45;&gt;expert_6_3</title>
<path fill="none" stroke="black" d="M1265.82,-18489C1235.81,-18489 1209.5,-18489 1209.5,-18489 1209.5,-18489 1209.5,-18416.16 1209.5,-18416.16"/>
<polygon fill="black" stroke="black" points="1213,-18416.16 1209.5,-18406.16 1206,-18416.16 1213,-18416.16"/>
</g>
<!-- expert_6_4 -->
<g id="node125" class="node">
<title>expert_6_4</title>
<path fill="lightsteelblue" stroke="black" d="M1435,-18406C1435,-18406 1269,-18406 1269,-18406 1263,-18406 1257,-18400 1257,-18394 1257,-18394 1257,-18350 1257,-18350 1257,-18344 1263,-18338 1269,-18338 1269,-18338 1435,-18338 1435,-18338 1441,-18338 1447,-18344 1447,-18350 1447,-18350 1447,-18394 1447,-18394 1447,-18400 1441,-18406 1435,-18406"/>
<text text-anchor="middle" x="1352" y="-18390.8" font-family="Arial" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1352" y="-18375.8" font-family="Arial" font-size="14.00">GPU 10</text>
<text text-anchor="middle" x="1352" y="-18360.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1352" y="-18345.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_6&#45;&gt;expert_6_4 -->
<g id="edge150" class="edge">
<title>expert_gate_6&#45;&gt;expert_6_4</title>
<path fill="none" stroke="black" d="M1352,-18478.81C1352,-18478.81 1352,-18416.26 1352,-18416.26"/>
<polygon fill="black" stroke="black" points="1355.5,-18416.26 1352,-18406.26 1348.5,-18416.26 1355.5,-18416.26"/>
</g>
<!-- expert_6_5 -->
<g id="node126" class="node">
<title>expert_6_5</title>
<path fill="lightsteelblue" stroke="black" d="M1661,-18406C1661,-18406 1495,-18406 1495,-18406 1489,-18406 1483,-18400 1483,-18394 1483,-18394 1483,-18350 1483,-18350 1483,-18344 1489,-18338 1495,-18338 1495,-18338 1661,-18338 1661,-18338 1667,-18338 1673,-18344 1673,-18350 1673,-18350 1673,-18394 1673,-18394 1673,-18400 1667,-18406 1661,-18406"/>
<text text-anchor="middle" x="1578" y="-18390.8" font-family="Arial" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1578" y="-18375.8" font-family="Arial" font-size="14.00">GPU 11</text>
<text text-anchor="middle" x="1578" y="-18360.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1578" y="-18345.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_6&#45;&gt;expert_6_5 -->
<g id="edge151" class="edge">
<title>expert_gate_6&#45;&gt;expert_6_5</title>
<path fill="none" stroke="black" d="M1438.09,-18492C1501.95,-18492 1578,-18492 1578,-18492 1578,-18492 1578,-18416.07 1578,-18416.07"/>
<polygon fill="black" stroke="black" points="1581.5,-18416.07 1578,-18406.07 1574.5,-18416.07 1581.5,-18416.07"/>
</g>
<!-- expert_6_6 -->
<g id="node127" class="node">
<title>expert_6_6</title>
<path fill="lightsteelblue" stroke="black" d="M1887,-18406C1887,-18406 1721,-18406 1721,-18406 1715,-18406 1709,-18400 1709,-18394 1709,-18394 1709,-18350 1709,-18350 1709,-18344 1715,-18338 1721,-18338 1721,-18338 1887,-18338 1887,-18338 1893,-18338 1899,-18344 1899,-18350 1899,-18350 1899,-18394 1899,-18394 1899,-18400 1893,-18406 1887,-18406"/>
<text text-anchor="middle" x="1804" y="-18390.8" font-family="Arial" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="1804" y="-18375.8" font-family="Arial" font-size="14.00">GPU 12</text>
<text text-anchor="middle" x="1804" y="-18360.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1804" y="-18345.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_6&#45;&gt;expert_6_6 -->
<g id="edge152" class="edge">
<title>expert_gate_6&#45;&gt;expert_6_6</title>
<path fill="none" stroke="black" d="M1438.19,-18505C1549.68,-18505 1729.75,-18505 1729.75,-18505 1729.75,-18505 1729.75,-18416.25 1729.75,-18416.25"/>
<polygon fill="black" stroke="black" points="1733.25,-18416.25 1729.75,-18406.25 1726.25,-18416.25 1733.25,-18416.25"/>
</g>
<!-- expert_6_7 -->
<g id="node128" class="node">
<title>expert_6_7</title>
<path fill="lightsteelblue" stroke="black" d="M2113,-18406C2113,-18406 1947,-18406 1947,-18406 1941,-18406 1935,-18400 1935,-18394 1935,-18394 1935,-18350 1935,-18350 1935,-18344 1941,-18338 1947,-18338 1947,-18338 2113,-18338 2113,-18338 2119,-18338 2125,-18344 2125,-18350 2125,-18350 2125,-18394 2125,-18394 2125,-18400 2119,-18406 2113,-18406"/>
<text text-anchor="middle" x="2030" y="-18390.8" font-family="Arial" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2030" y="-18375.8" font-family="Arial" font-size="14.00">GPU 13</text>
<text text-anchor="middle" x="2030" y="-18360.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="2030" y="-18345.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_6&#45;&gt;expert_6_7 -->
<g id="edge153" class="edge">
<title>expert_gate_6&#45;&gt;expert_6_7</title>
<path fill="none" stroke="black" d="M1438.14,-18518C1612.5,-18518 1990.75,-18518 1990.75,-18518 1990.75,-18518 1990.75,-18416.23 1990.75,-18416.23"/>
<polygon fill="black" stroke="black" points="1994.25,-18416.23 1990.75,-18406.23 1987.25,-18416.23 1994.25,-18416.23"/>
</g>
<!-- expert_agg_6 -->
<g id="node129" class="node">
<title>expert_agg_6</title>
<path fill="lightsalmon" stroke="black" d="M1427.5,-18265C1427.5,-18265 1276.5,-18265 1276.5,-18265 1270.5,-18265 1264.5,-18259 1264.5,-18253 1264.5,-18253 1264.5,-18224 1264.5,-18224 1264.5,-18218 1270.5,-18212 1276.5,-18212 1276.5,-18212 1427.5,-18212 1427.5,-18212 1433.5,-18212 1439.5,-18218 1439.5,-18224 1439.5,-18224 1439.5,-18253 1439.5,-18253 1439.5,-18259 1433.5,-18265 1427.5,-18265"/>
<text text-anchor="middle" x="1352" y="-18249.8" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1352" y="-18234.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1352" y="-18219.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- expert_6_0&#45;&gt;expert_agg_6 -->
<g id="edge154" class="edge">
<title>expert_6_0&#45;&gt;expert_agg_6</title>
<path fill="none" stroke="black" d="M481.5,-18337.96C481.5,-18293.71 481.5,-18222 481.5,-18222 481.5,-18222 1254.14,-18222 1254.14,-18222"/>
<polygon fill="black" stroke="black" points="1254.14,-18225.5 1264.14,-18222 1254.14,-18218.5 1254.14,-18225.5"/>
</g>
<!-- expert_6_1&#45;&gt;expert_agg_6 -->
<g id="edge155" class="edge">
<title>expert_6_1&#45;&gt;expert_agg_6</title>
<path fill="none" stroke="black" d="M707.5,-18338C707.5,-18296.85 707.5,-18233 707.5,-18233 707.5,-18233 1254.41,-18233 1254.41,-18233"/>
<polygon fill="black" stroke="black" points="1254.41,-18236.5 1264.41,-18233 1254.41,-18229.5 1254.41,-18236.5"/>
</g>
<!-- expert_6_2&#45;&gt;expert_agg_6 -->
<g id="edge156" class="edge">
<title>expert_6_2&#45;&gt;expert_agg_6</title>
<path fill="none" stroke="black" d="M933.5,-18337.77C933.5,-18299.55 933.5,-18243 933.5,-18243 933.5,-18243 1254.27,-18243 1254.27,-18243"/>
<polygon fill="black" stroke="black" points="1254.27,-18246.5 1264.27,-18243 1254.27,-18239.5 1254.27,-18246.5"/>
</g>
<!-- expert_6_3&#45;&gt;expert_agg_6 -->
<g id="edge157" class="edge">
<title>expert_6_3&#45;&gt;expert_agg_6</title>
<path fill="none" stroke="black" d="M1164,-18337.87C1164,-18303.02 1164,-18254 1164,-18254 1164,-18254 1254.33,-18254 1254.33,-18254"/>
<polygon fill="black" stroke="black" points="1254.33,-18257.5 1264.33,-18254 1254.33,-18250.5 1254.33,-18257.5"/>
</g>
<!-- expert_6_4&#45;&gt;expert_agg_6 -->
<g id="edge158" class="edge">
<title>expert_6_4&#45;&gt;expert_agg_6</title>
<path fill="none" stroke="black" d="M1352,-18337.97C1352,-18337.97 1352,-18275.32 1352,-18275.32"/>
<polygon fill="black" stroke="black" points="1355.5,-18275.32 1352,-18265.32 1348.5,-18275.32 1355.5,-18275.32"/>
</g>
<!-- expert_6_5&#45;&gt;expert_agg_6 -->
<g id="edge159" class="edge">
<title>expert_6_5&#45;&gt;expert_agg_6</title>
<path fill="none" stroke="black" d="M1487.25,-18337.97C1487.25,-18302.18 1487.25,-18251 1487.25,-18251 1487.25,-18251 1449.57,-18251 1449.57,-18251"/>
<polygon fill="black" stroke="black" points="1449.57,-18247.5 1439.57,-18251 1449.57,-18254.5 1449.57,-18247.5"/>
</g>
<!-- expert_6_6&#45;&gt;expert_agg_6 -->
<g id="edge160" class="edge">
<title>expert_6_6&#45;&gt;expert_agg_6</title>
<path fill="none" stroke="black" d="M1726.5,-18337.84C1726.5,-18298.14 1726.5,-18238 1726.5,-18238 1726.5,-18238 1449.8,-18238 1449.8,-18238"/>
<polygon fill="black" stroke="black" points="1449.8,-18234.5 1439.8,-18238 1449.8,-18241.5 1449.8,-18234.5"/>
</g>
<!-- expert_6_7&#45;&gt;expert_agg_6 -->
<g id="edge161" class="edge">
<title>expert_6_7&#45;&gt;expert_agg_6</title>
<path fill="none" stroke="black" d="M1942.25,-18337.91C1942.25,-18294.48 1942.25,-18225 1942.25,-18225 1942.25,-18225 1449.73,-18225 1449.73,-18225"/>
<polygon fill="black" stroke="black" points="1449.73,-18221.5 1439.73,-18225 1449.73,-18228.5 1449.73,-18221.5"/>
</g>
<!-- activation_6 -->
<g id="node130" class="node">
<title>activation_6</title>
<path fill="lightyellow" stroke="black" d="M1479.5,-18139C1479.5,-18139 1318.5,-18139 1318.5,-18139 1312.5,-18139 1306.5,-18133 1306.5,-18127 1306.5,-18127 1306.5,-18113 1306.5,-18113 1306.5,-18107 1312.5,-18101 1318.5,-18101 1318.5,-18101 1479.5,-18101 1479.5,-18101 1485.5,-18101 1491.5,-18107 1491.5,-18113 1491.5,-18113 1491.5,-18127 1491.5,-18127 1491.5,-18133 1485.5,-18139 1479.5,-18139"/>
<text text-anchor="middle" x="1399" y="-18123.8" font-family="Arial" font-size="14.00">GELU</text>
<text text-anchor="middle" x="1399" y="-18108.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- expert_agg_6&#45;&gt;activation_6 -->
<g id="edge162" class="edge">
<title>expert_agg_6&#45;&gt;activation_6</title>
<path fill="none" stroke="black" d="M1373,-18211.91C1373,-18211.91 1373,-18149.13 1373,-18149.13"/>
<polygon fill="black" stroke="black" points="1376.5,-18149.13 1373,-18139.13 1369.5,-18149.13 1376.5,-18149.13"/>
</g>
<!-- dense_4h_h_6 -->
<g id="node131" class="node">
<title>dense_4h_h_6</title>
<path fill="lightblue" stroke="black" d="M1554.5,-18028C1554.5,-18028 1393.5,-18028 1393.5,-18028 1387.5,-18028 1381.5,-18022 1381.5,-18016 1381.5,-18016 1381.5,-17972 1381.5,-17972 1381.5,-17966 1387.5,-17960 1393.5,-17960 1393.5,-17960 1554.5,-17960 1554.5,-17960 1560.5,-17960 1566.5,-17966 1566.5,-17972 1566.5,-17972 1566.5,-18016 1566.5,-18016 1566.5,-18022 1560.5,-18028 1554.5,-18028"/>
<text text-anchor="middle" x="1474" y="-18012.8" font-family="Arial" font-size="14.00">Dense 4H→H</text>
<text text-anchor="middle" x="1474" y="-17997.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1474" y="-17982.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1474" y="-17967.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- activation_6&#45;&gt;dense_4h_h_6 -->
<g id="edge163" class="edge">
<title>activation_6&#45;&gt;dense_4h_h_6</title>
<path fill="none" stroke="black" d="M1436.5,-18100.86C1436.5,-18100.86 1436.5,-18038.07 1436.5,-18038.07"/>
<polygon fill="black" stroke="black" points="1440,-18038.07 1436.5,-18028.07 1433,-18038.07 1440,-18038.07"/>
</g>
<!-- allreduce_mlp_6 -->
<g id="node132" class="node">
<title>allreduce_mlp_6</title>
<path fill="lightcoral" stroke="black" d="M1672.5,-17887C1672.5,-17887 1539.5,-17887 1539.5,-17887 1533.5,-17887 1527.5,-17881 1527.5,-17875 1527.5,-17875 1527.5,-17861 1527.5,-17861 1527.5,-17855 1533.5,-17849 1539.5,-17849 1539.5,-17849 1672.5,-17849 1672.5,-17849 1678.5,-17849 1684.5,-17855 1684.5,-17861 1684.5,-17861 1684.5,-17875 1684.5,-17875 1684.5,-17881 1678.5,-17887 1672.5,-17887"/>
<text text-anchor="middle" x="1606" y="-17871.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1606" y="-17856.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- dense_4h_h_6&#45;&gt;allreduce_mlp_6 -->
<g id="edge164" class="edge">
<title>dense_4h_h_6&#45;&gt;allreduce_mlp_6</title>
<path fill="none" stroke="black" d="M1547,-17959.9C1547,-17959.9 1547,-17897.24 1547,-17897.24"/>
<polygon fill="black" stroke="black" points="1550.5,-17897.24 1547,-17887.24 1543.5,-17897.24 1550.5,-17897.24"/>
</g>
<!-- residual2_6 -->
<g id="node137" class="node">
<title>residual2_6</title>
<path fill="lightgray" stroke="black" d="M1937.5,-17776C1937.5,-17776 1804.5,-17776 1804.5,-17776 1798.5,-17776 1792.5,-17770 1792.5,-17764 1792.5,-17764 1792.5,-17750 1792.5,-17750 1792.5,-17744 1798.5,-17738 1804.5,-17738 1804.5,-17738 1937.5,-17738 1937.5,-17738 1943.5,-17738 1949.5,-17744 1949.5,-17750 1949.5,-17750 1949.5,-17764 1949.5,-17764 1949.5,-17770 1943.5,-17776 1937.5,-17776"/>
<text text-anchor="middle" x="1871" y="-17760.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1871" y="-17745.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_mlp_6&#45;&gt;residual2_6 -->
<g id="edge172" class="edge">
<title>allreduce_mlp_6&#45;&gt;residual2_6</title>
<path fill="none" stroke="black" d="M1662,-17848.92C1662,-17817.18 1662,-17757 1662,-17757 1662,-17757 1782.28,-17757 1782.28,-17757"/>
<polygon fill="black" stroke="black" points="1782.28,-17760.5 1792.28,-17757 1782.28,-17753.5 1782.28,-17760.5"/>
</g>
<!-- norm1_6 -->
<g id="node134" class="node">
<title>norm1_6</title>
<path fill="lightcyan" stroke="black" d="M1930.5,-19537C1930.5,-19537 1797.5,-19537 1797.5,-19537 1791.5,-19537 1785.5,-19531 1785.5,-19525 1785.5,-19525 1785.5,-19511 1785.5,-19511 1785.5,-19505 1791.5,-19499 1797.5,-19499 1797.5,-19499 1930.5,-19499 1930.5,-19499 1936.5,-19499 1942.5,-19505 1942.5,-19511 1942.5,-19511 1942.5,-19525 1942.5,-19525 1942.5,-19531 1936.5,-19537 1930.5,-19537"/>
<text text-anchor="middle" x="1864" y="-19521.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1864" y="-19506.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- input_6&#45;&gt;norm1_6 -->
<g id="edge165" class="edge">
<title>input_6&#45;&gt;norm1_6</title>
<path fill="none" stroke="black" d="M1896.25,-19614.9C1896.25,-19614.9 1896.25,-19547.23 1896.25,-19547.23"/>
<polygon fill="black" stroke="black" points="1899.75,-19547.23 1896.25,-19537.23 1892.75,-19547.23 1899.75,-19547.23"/>
</g>
<!-- input_6&#45;&gt;residual1_6 -->
<g id="edge166" class="edge">
<title>input_6&#45;&gt;residual1_6</title>
<path fill="none" stroke="black" d="M2000,-19611.45C2000,-19611.45 2000,-18911.03 2000,-18911.03"/>
<polygon fill="black" stroke="black" points="2003.5,-18911.03 2000,-18901.03 1996.5,-18911.03 2003.5,-18911.03"/>
</g>
<!-- norm1_6&#45;&gt;qkv_proj_6 -->
<g id="edge167" class="edge">
<title>norm1_6&#45;&gt;qkv_proj_6</title>
<path fill="none" stroke="black" d="M1864,-19498.81C1864,-19498.81 1864,-19430.06 1864,-19430.06"/>
<polygon fill="black" stroke="black" points="1867.5,-19430.06 1864,-19420.06 1860.5,-19430.06 1867.5,-19430.06"/>
</g>
<!-- norm2_6 -->
<g id="node136" class="node">
<title>norm2_6</title>
<path fill="lightcyan" stroke="black" d="M1904.5,-18790C1904.5,-18790 1771.5,-18790 1771.5,-18790 1765.5,-18790 1759.5,-18784 1759.5,-18778 1759.5,-18778 1759.5,-18764 1759.5,-18764 1759.5,-18758 1765.5,-18752 1771.5,-18752 1771.5,-18752 1904.5,-18752 1904.5,-18752 1910.5,-18752 1916.5,-18758 1916.5,-18764 1916.5,-18764 1916.5,-18778 1916.5,-18778 1916.5,-18784 1910.5,-18790 1904.5,-18790"/>
<text text-anchor="middle" x="1838" y="-18774.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1838" y="-18759.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual1_6&#45;&gt;norm2_6 -->
<g id="edge169" class="edge">
<title>residual1_6&#45;&gt;norm2_6</title>
<path fill="none" stroke="black" d="M1903,-18862.92C1903,-18862.92 1903,-18800.2 1903,-18800.2"/>
<polygon fill="black" stroke="black" points="1906.5,-18800.2 1903,-18790.2 1899.5,-18800.2 1906.5,-18800.2"/>
</g>
<!-- residual1_6&#45;&gt;residual2_6 -->
<g id="edge170" class="edge">
<title>residual1_6&#45;&gt;residual2_6</title>
<path fill="none" stroke="black" d="M1925.75,-18862.95C1925.75,-18862.95 1925.75,-17786.23 1925.75,-17786.23"/>
<polygon fill="black" stroke="black" points="1929.25,-17786.23 1925.75,-17776.23 1922.25,-17786.23 1929.25,-17786.23"/>
</g>
<!-- norm2_6&#45;&gt;dense_h_4h_6 -->
<g id="edge171" class="edge">
<title>norm2_6&#45;&gt;dense_h_4h_6</title>
<path fill="none" stroke="black" d="M1759.4,-18771C1710.55,-18771 1657,-18771 1657,-18771 1657,-18771 1657,-18683.34 1657,-18683.34"/>
<polygon fill="black" stroke="black" points="1660.5,-18683.34 1657,-18673.34 1653.5,-18683.34 1660.5,-18683.34"/>
</g>
<!-- output_6 -->
<g id="node138" class="node">
<title>output_6</title>
<ellipse fill="white" stroke="black" cx="1871" cy="-17638" rx="111" ry="27"/>
<text text-anchor="middle" x="1871" y="-17641.8" font-family="Arial" font-size="14.00">Layer 7 Output</text>
<text text-anchor="middle" x="1871" y="-17626.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual2_6&#45;&gt;output_6 -->
<g id="edge173" class="edge">
<title>residual2_6&#45;&gt;output_6</title>
<path fill="none" stroke="black" d="M1871,-17737.88C1871,-17737.88 1871,-17675.05 1871,-17675.05"/>
<polygon fill="black" stroke="black" points="1874.5,-17675.05 1871,-17665.05 1867.5,-17675.05 1874.5,-17675.05"/>
</g>
<!-- input_7 -->
<g id="node147" class="node">
<title>input_7</title>
<ellipse fill="white" stroke="black" cx="1871" cy="-17476" rx="111" ry="27"/>
<text text-anchor="middle" x="1871" y="-17479.8" font-family="Arial" font-size="14.00">Layer 8 Input</text>
<text text-anchor="middle" x="1871" y="-17464.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- output_6&#45;&gt;input_7 -->
<g id="edge384" class="edge">
<title>output_6&#45;&gt;input_7</title>
<path fill="none" stroke="red" stroke-width="2" stroke-dasharray="5,2" d="M1871,-17610.88C1871,-17610.88 1871,-17513.2 1871,-17513.2"/>
<polygon fill="red" stroke="red" stroke-width="2" points="1874.5,-17513.2 1871,-17503.2 1867.5,-17513.2 1874.5,-17513.2"/>
<text text-anchor="middle" x="1927" y="-17563.8" font-family="Times,serif" font-size="14.00">GPU&#45;to&#45;GPU</text>
<text text-anchor="middle" x="1927" y="-17548.8" font-family="Times,serif" font-size="14.00">Communication</text>
</g>
<!-- qkv_proj_7 -->
<g id="node139" class="node">
<title>qkv_proj_7</title>
<path fill="lightgreen" stroke="black" d="M1939.5,-17259C1939.5,-17259 1760.5,-17259 1760.5,-17259 1754.5,-17259 1748.5,-17253 1748.5,-17247 1748.5,-17247 1748.5,-17203 1748.5,-17203 1748.5,-17197 1754.5,-17191 1760.5,-17191 1760.5,-17191 1939.5,-17191 1939.5,-17191 1945.5,-17191 1951.5,-17197 1951.5,-17203 1951.5,-17203 1951.5,-17247 1951.5,-17247 1951.5,-17253 1945.5,-17259 1939.5,-17259"/>
<text text-anchor="middle" x="1850" y="-17243.8" font-family="Arial" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1850" y="-17228.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1850" y="-17213.8" font-family="Arial" font-size="14.00">[1024, seq_len, 3*hidden]</text>
<text text-anchor="middle" x="1850" y="-17198.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 3*hidden/tp]</text>
</g>
<!-- attn_comp_7 -->
<g id="node140" class="node">
<title>attn_comp_7</title>
<path fill="lightyellow" stroke="black" d="M1929,-17118C1929,-17118 1781,-17118 1781,-17118 1775,-17118 1769,-17112 1769,-17106 1769,-17106 1769,-17077 1769,-17077 1769,-17071 1775,-17065 1781,-17065 1781,-17065 1929,-17065 1929,-17065 1935,-17065 1941,-17071 1941,-17077 1941,-17077 1941,-17106 1941,-17106 1941,-17112 1935,-17118 1929,-17118"/>
<text text-anchor="middle" x="1855" y="-17102.8" font-family="Arial" font-size="14.00">Attention</text>
<text text-anchor="middle" x="1855" y="-17087.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1855" y="-17072.8" font-family="Arial" font-size="14.00">Heads: 2 per GPU</text>
</g>
<!-- qkv_proj_7&#45;&gt;attn_comp_7 -->
<g id="edge174" class="edge">
<title>qkv_proj_7&#45;&gt;attn_comp_7</title>
<path fill="none" stroke="black" d="M1855,-17190.97C1855,-17190.97 1855,-17128.32 1855,-17128.32"/>
<polygon fill="black" stroke="black" points="1858.5,-17128.32 1855,-17118.32 1851.5,-17128.32 1858.5,-17128.32"/>
</g>
<!-- out_proj_7 -->
<g id="node141" class="node">
<title>out_proj_7</title>
<path fill="lightgreen" stroke="black" d="M1934.5,-16992C1934.5,-16992 1783.5,-16992 1783.5,-16992 1777.5,-16992 1771.5,-16986 1771.5,-16980 1771.5,-16980 1771.5,-16936 1771.5,-16936 1771.5,-16930 1777.5,-16924 1783.5,-16924 1783.5,-16924 1934.5,-16924 1934.5,-16924 1940.5,-16924 1946.5,-16930 1946.5,-16936 1946.5,-16936 1946.5,-16980 1946.5,-16980 1946.5,-16986 1940.5,-16992 1934.5,-16992"/>
<text text-anchor="middle" x="1859" y="-16976.8" font-family="Arial" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="1859" y="-16961.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1859" y="-16946.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1859" y="-16931.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- attn_comp_7&#45;&gt;out_proj_7 -->
<g id="edge175" class="edge">
<title>attn_comp_7&#45;&gt;out_proj_7</title>
<path fill="none" stroke="black" d="M1856.25,-17064.81C1856.25,-17064.81 1856.25,-17002.26 1856.25,-17002.26"/>
<polygon fill="black" stroke="black" points="1859.75,-17002.26 1856.25,-16992.26 1852.75,-17002.26 1859.75,-17002.26"/>
</g>
<!-- allreduce_attn_7 -->
<g id="node142" class="node">
<title>allreduce_attn_7</title>
<path fill="lightcoral" stroke="black" d="M1927.5,-16851C1927.5,-16851 1794.5,-16851 1794.5,-16851 1788.5,-16851 1782.5,-16845 1782.5,-16839 1782.5,-16839 1782.5,-16825 1782.5,-16825 1782.5,-16819 1788.5,-16813 1794.5,-16813 1794.5,-16813 1927.5,-16813 1927.5,-16813 1933.5,-16813 1939.5,-16819 1939.5,-16825 1939.5,-16825 1939.5,-16839 1939.5,-16839 1939.5,-16845 1933.5,-16851 1927.5,-16851"/>
<text text-anchor="middle" x="1861" y="-16835.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1861" y="-16820.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- out_proj_7&#45;&gt;allreduce_attn_7 -->
<g id="edge176" class="edge">
<title>out_proj_7&#45;&gt;allreduce_attn_7</title>
<path fill="none" stroke="black" d="M1861,-16923.9C1861,-16923.9 1861,-16861.24 1861,-16861.24"/>
<polygon fill="black" stroke="black" points="1864.5,-16861.24 1861,-16851.24 1857.5,-16861.24 1864.5,-16861.24"/>
</g>
<!-- residual1_7 -->
<g id="node149" class="node">
<title>residual1_7</title>
<path fill="lightgray" stroke="black" d="M1953.5,-16740C1953.5,-16740 1820.5,-16740 1820.5,-16740 1814.5,-16740 1808.5,-16734 1808.5,-16728 1808.5,-16728 1808.5,-16714 1808.5,-16714 1808.5,-16708 1814.5,-16702 1820.5,-16702 1820.5,-16702 1953.5,-16702 1953.5,-16702 1959.5,-16702 1965.5,-16708 1965.5,-16714 1965.5,-16714 1965.5,-16728 1965.5,-16728 1965.5,-16734 1959.5,-16740 1953.5,-16740"/>
<text text-anchor="middle" x="1887" y="-16724.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1887" y="-16709.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_attn_7&#45;&gt;residual1_7 -->
<g id="edge183" class="edge">
<title>allreduce_attn_7&#45;&gt;residual1_7</title>
<path fill="none" stroke="black" d="M1874,-16812.92C1874,-16812.92 1874,-16750.2 1874,-16750.2"/>
<polygon fill="black" stroke="black" points="1877.5,-16750.2 1874,-16740.2 1870.5,-16750.2 1877.5,-16750.2"/>
</g>
<!-- dense_h_4h_7 -->
<g id="node143" class="node">
<title>dense_h_4h_7</title>
<path fill="lightblue" stroke="black" d="M1939.5,-16512C1939.5,-16512 1760.5,-16512 1760.5,-16512 1754.5,-16512 1748.5,-16506 1748.5,-16500 1748.5,-16500 1748.5,-16456 1748.5,-16456 1748.5,-16450 1754.5,-16444 1760.5,-16444 1760.5,-16444 1939.5,-16444 1939.5,-16444 1945.5,-16444 1951.5,-16450 1951.5,-16456 1951.5,-16456 1951.5,-16500 1951.5,-16500 1951.5,-16506 1945.5,-16512 1939.5,-16512"/>
<text text-anchor="middle" x="1850" y="-16496.8" font-family="Arial" font-size="14.00">Dense H→4H</text>
<text text-anchor="middle" x="1850" y="-16481.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1850" y="-16466.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
<text text-anchor="middle" x="1850" y="-16451.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- activation_7 -->
<g id="node144" class="node">
<title>activation_7</title>
<path fill="lightyellow" stroke="black" d="M1932.5,-16371C1932.5,-16371 1771.5,-16371 1771.5,-16371 1765.5,-16371 1759.5,-16365 1759.5,-16359 1759.5,-16359 1759.5,-16345 1759.5,-16345 1759.5,-16339 1765.5,-16333 1771.5,-16333 1771.5,-16333 1932.5,-16333 1932.5,-16333 1938.5,-16333 1944.5,-16339 1944.5,-16345 1944.5,-16345 1944.5,-16359 1944.5,-16359 1944.5,-16365 1938.5,-16371 1932.5,-16371"/>
<text text-anchor="middle" x="1852" y="-16355.8" font-family="Arial" font-size="14.00">GELU</text>
<text text-anchor="middle" x="1852" y="-16340.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- dense_h_4h_7&#45;&gt;activation_7 -->
<g id="edge177" class="edge">
<title>dense_h_4h_7&#45;&gt;activation_7</title>
<path fill="none" stroke="black" d="M1852,-16443.9C1852,-16443.9 1852,-16381.24 1852,-16381.24"/>
<polygon fill="black" stroke="black" points="1855.5,-16381.24 1852,-16371.24 1848.5,-16381.24 1855.5,-16381.24"/>
</g>
<!-- dense_4h_h_7 -->
<g id="node145" class="node">
<title>dense_4h_h_7</title>
<path fill="lightblue" stroke="black" d="M1934.5,-16260C1934.5,-16260 1773.5,-16260 1773.5,-16260 1767.5,-16260 1761.5,-16254 1761.5,-16248 1761.5,-16248 1761.5,-16204 1761.5,-16204 1761.5,-16198 1767.5,-16192 1773.5,-16192 1773.5,-16192 1934.5,-16192 1934.5,-16192 1940.5,-16192 1946.5,-16198 1946.5,-16204 1946.5,-16204 1946.5,-16248 1946.5,-16248 1946.5,-16254 1940.5,-16260 1934.5,-16260"/>
<text text-anchor="middle" x="1854" y="-16244.8" font-family="Arial" font-size="14.00">Dense 4H→H</text>
<text text-anchor="middle" x="1854" y="-16229.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1854" y="-16214.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1854" y="-16199.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- activation_7&#45;&gt;dense_4h_h_7 -->
<g id="edge178" class="edge">
<title>activation_7&#45;&gt;dense_4h_h_7</title>
<path fill="none" stroke="black" d="M1853,-16332.86C1853,-16332.86 1853,-16270.07 1853,-16270.07"/>
<polygon fill="black" stroke="black" points="1856.5,-16270.07 1853,-16260.07 1849.5,-16270.07 1856.5,-16270.07"/>
</g>
<!-- allreduce_mlp_7 -->
<g id="node146" class="node">
<title>allreduce_mlp_7</title>
<path fill="lightcoral" stroke="black" d="M1921.5,-16119C1921.5,-16119 1788.5,-16119 1788.5,-16119 1782.5,-16119 1776.5,-16113 1776.5,-16107 1776.5,-16107 1776.5,-16093 1776.5,-16093 1776.5,-16087 1782.5,-16081 1788.5,-16081 1788.5,-16081 1921.5,-16081 1921.5,-16081 1927.5,-16081 1933.5,-16087 1933.5,-16093 1933.5,-16093 1933.5,-16107 1933.5,-16107 1933.5,-16113 1927.5,-16119 1921.5,-16119"/>
<text text-anchor="middle" x="1855" y="-16103.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1855" y="-16088.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- dense_4h_h_7&#45;&gt;allreduce_mlp_7 -->
<g id="edge179" class="edge">
<title>dense_4h_h_7&#45;&gt;allreduce_mlp_7</title>
<path fill="none" stroke="black" d="M1855,-16191.9C1855,-16191.9 1855,-16129.24 1855,-16129.24"/>
<polygon fill="black" stroke="black" points="1858.5,-16129.24 1855,-16119.24 1851.5,-16129.24 1858.5,-16129.24"/>
</g>
<!-- residual2_7 -->
<g id="node151" class="node">
<title>residual2_7</title>
<path fill="lightgray" stroke="black" d="M1921.5,-16008C1921.5,-16008 1788.5,-16008 1788.5,-16008 1782.5,-16008 1776.5,-16002 1776.5,-15996 1776.5,-15996 1776.5,-15982 1776.5,-15982 1776.5,-15976 1782.5,-15970 1788.5,-15970 1788.5,-15970 1921.5,-15970 1921.5,-15970 1927.5,-15970 1933.5,-15976 1933.5,-15982 1933.5,-15982 1933.5,-15996 1933.5,-15996 1933.5,-16002 1927.5,-16008 1921.5,-16008"/>
<text text-anchor="middle" x="1855" y="-15992.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1855" y="-15977.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_mlp_7&#45;&gt;residual2_7 -->
<g id="edge187" class="edge">
<title>allreduce_mlp_7&#45;&gt;residual2_7</title>
<path fill="none" stroke="black" d="M1855,-16080.92C1855,-16080.92 1855,-16018.2 1855,-16018.2"/>
<polygon fill="black" stroke="black" points="1858.5,-16018.2 1855,-16008.2 1851.5,-16018.2 1858.5,-16018.2"/>
</g>
<!-- norm1_7 -->
<g id="node148" class="node">
<title>norm1_7</title>
<path fill="lightcyan" stroke="black" d="M1928.5,-17376C1928.5,-17376 1795.5,-17376 1795.5,-17376 1789.5,-17376 1783.5,-17370 1783.5,-17364 1783.5,-17364 1783.5,-17350 1783.5,-17350 1783.5,-17344 1789.5,-17338 1795.5,-17338 1795.5,-17338 1928.5,-17338 1928.5,-17338 1934.5,-17338 1940.5,-17344 1940.5,-17350 1940.5,-17350 1940.5,-17364 1940.5,-17364 1940.5,-17370 1934.5,-17376 1928.5,-17376"/>
<text text-anchor="middle" x="1862" y="-17360.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1862" y="-17345.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- input_7&#45;&gt;norm1_7 -->
<g id="edge180" class="edge">
<title>input_7&#45;&gt;norm1_7</title>
<path fill="none" stroke="black" d="M1862,-17449C1862,-17449 1862,-17386.12 1862,-17386.12"/>
<polygon fill="black" stroke="black" points="1865.5,-17386.12 1862,-17376.12 1858.5,-17386.12 1865.5,-17386.12"/>
</g>
<!-- input_7&#45;&gt;residual1_7 -->
<g id="edge181" class="edge">
<title>input_7&#45;&gt;residual1_7</title>
<path fill="none" stroke="black" d="M1958.5,-17459.17C1958.5,-17459.17 1958.5,-16750.23 1958.5,-16750.23"/>
<polygon fill="black" stroke="black" points="1962,-16750.23 1958.5,-16740.23 1955,-16750.23 1962,-16750.23"/>
</g>
<!-- norm1_7&#45;&gt;qkv_proj_7 -->
<g id="edge182" class="edge">
<title>norm1_7&#45;&gt;qkv_proj_7</title>
<path fill="none" stroke="black" d="M1862,-17337.81C1862,-17337.81 1862,-17269.06 1862,-17269.06"/>
<polygon fill="black" stroke="black" points="1865.5,-17269.06 1862,-17259.06 1858.5,-17269.06 1865.5,-17269.06"/>
</g>
<!-- norm2_7 -->
<g id="node150" class="node">
<title>norm2_7</title>
<path fill="lightcyan" stroke="black" d="M1928.5,-16629C1928.5,-16629 1795.5,-16629 1795.5,-16629 1789.5,-16629 1783.5,-16623 1783.5,-16617 1783.5,-16617 1783.5,-16603 1783.5,-16603 1783.5,-16597 1789.5,-16591 1795.5,-16591 1795.5,-16591 1928.5,-16591 1928.5,-16591 1934.5,-16591 1940.5,-16597 1940.5,-16603 1940.5,-16603 1940.5,-16617 1940.5,-16617 1940.5,-16623 1934.5,-16629 1928.5,-16629"/>
<text text-anchor="middle" x="1862" y="-16613.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1862" y="-16598.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual1_7&#45;&gt;norm2_7 -->
<g id="edge184" class="edge">
<title>residual1_7&#45;&gt;norm2_7</title>
<path fill="none" stroke="black" d="M1874.5,-16701.92C1874.5,-16701.92 1874.5,-16639.2 1874.5,-16639.2"/>
<polygon fill="black" stroke="black" points="1878,-16639.2 1874.5,-16629.2 1871,-16639.2 1878,-16639.2"/>
</g>
<!-- residual1_7&#45;&gt;residual2_7 -->
<g id="edge185" class="edge">
<title>residual1_7&#45;&gt;residual2_7</title>
<path fill="none" stroke="black" d="M1958.5,-16701.8C1958.5,-16586.3 1958.5,-15989 1958.5,-15989 1958.5,-15989 1943.71,-15989 1943.71,-15989"/>
<polygon fill="black" stroke="black" points="1943.71,-15985.5 1933.71,-15989 1943.71,-15992.5 1943.71,-15985.5"/>
</g>
<!-- norm2_7&#45;&gt;dense_h_4h_7 -->
<g id="edge186" class="edge">
<title>norm2_7&#45;&gt;dense_h_4h_7</title>
<path fill="none" stroke="black" d="M1862,-16590.81C1862,-16590.81 1862,-16522.06 1862,-16522.06"/>
<polygon fill="black" stroke="black" points="1865.5,-16522.06 1862,-16512.06 1858.5,-16522.06 1865.5,-16522.06"/>
</g>
<!-- output_7 -->
<g id="node152" class="node">
<title>output_7</title>
<ellipse fill="white" stroke="black" cx="1855" cy="-15870" rx="111" ry="27"/>
<text text-anchor="middle" x="1855" y="-15873.8" font-family="Arial" font-size="14.00">Layer 8 Output</text>
<text text-anchor="middle" x="1855" y="-15858.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual2_7&#45;&gt;output_7 -->
<g id="edge188" class="edge">
<title>residual2_7&#45;&gt;output_7</title>
<path fill="none" stroke="black" d="M1855,-15969.88C1855,-15969.88 1855,-15907.05 1855,-15907.05"/>
<polygon fill="black" stroke="black" points="1858.5,-15907.05 1855,-15897.05 1851.5,-15907.05 1858.5,-15907.05"/>
</g>
<!-- input_8 -->
<g id="node171" class="node">
<title>input_8</title>
<ellipse fill="white" stroke="black" cx="1855" cy="-15708" rx="111" ry="27"/>
<text text-anchor="middle" x="1855" y="-15711.8" font-family="Arial" font-size="14.00">Layer 9 Input</text>
<text text-anchor="middle" x="1855" y="-15696.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- output_7&#45;&gt;input_8 -->
<g id="edge385" class="edge">
<title>output_7&#45;&gt;input_8</title>
<path fill="none" stroke="red" stroke-width="2" stroke-dasharray="5,2" d="M1855,-15842.88C1855,-15842.88 1855,-15745.2 1855,-15745.2"/>
<polygon fill="red" stroke="red" stroke-width="2" points="1858.5,-15745.2 1855,-15735.2 1851.5,-15745.2 1858.5,-15745.2"/>
<text text-anchor="middle" x="1911" y="-15795.8" font-family="Times,serif" font-size="14.00">GPU&#45;to&#45;GPU</text>
<text text-anchor="middle" x="1911" y="-15780.8" font-family="Times,serif" font-size="14.00">Communication</text>
</g>
<!-- qkv_proj_8 -->
<g id="node153" class="node">
<title>qkv_proj_8</title>
<path fill="lightgreen" stroke="black" d="M1835.5,-15491C1835.5,-15491 1656.5,-15491 1656.5,-15491 1650.5,-15491 1644.5,-15485 1644.5,-15479 1644.5,-15479 1644.5,-15435 1644.5,-15435 1644.5,-15429 1650.5,-15423 1656.5,-15423 1656.5,-15423 1835.5,-15423 1835.5,-15423 1841.5,-15423 1847.5,-15429 1847.5,-15435 1847.5,-15435 1847.5,-15479 1847.5,-15479 1847.5,-15485 1841.5,-15491 1835.5,-15491"/>
<text text-anchor="middle" x="1746" y="-15475.8" font-family="Arial" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1746" y="-15460.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1746" y="-15445.8" font-family="Arial" font-size="14.00">[1024, seq_len, 3*hidden]</text>
<text text-anchor="middle" x="1746" y="-15430.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 3*hidden/tp]</text>
</g>
<!-- attn_comp_8 -->
<g id="node154" class="node">
<title>attn_comp_8</title>
<path fill="lightyellow" stroke="black" d="M1827,-15350C1827,-15350 1679,-15350 1679,-15350 1673,-15350 1667,-15344 1667,-15338 1667,-15338 1667,-15309 1667,-15309 1667,-15303 1673,-15297 1679,-15297 1679,-15297 1827,-15297 1827,-15297 1833,-15297 1839,-15303 1839,-15309 1839,-15309 1839,-15338 1839,-15338 1839,-15344 1833,-15350 1827,-15350"/>
<text text-anchor="middle" x="1753" y="-15334.8" font-family="Arial" font-size="14.00">Attention</text>
<text text-anchor="middle" x="1753" y="-15319.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1753" y="-15304.8" font-family="Arial" font-size="14.00">Heads: 2 per GPU</text>
</g>
<!-- qkv_proj_8&#45;&gt;attn_comp_8 -->
<g id="edge189" class="edge">
<title>qkv_proj_8&#45;&gt;attn_comp_8</title>
<path fill="none" stroke="black" d="M1753,-15422.97C1753,-15422.97 1753,-15360.32 1753,-15360.32"/>
<polygon fill="black" stroke="black" points="1756.5,-15360.32 1753,-15350.32 1749.5,-15360.32 1756.5,-15360.32"/>
</g>
<!-- out_proj_8 -->
<g id="node155" class="node">
<title>out_proj_8</title>
<path fill="lightgreen" stroke="black" d="M1833.5,-15224C1833.5,-15224 1682.5,-15224 1682.5,-15224 1676.5,-15224 1670.5,-15218 1670.5,-15212 1670.5,-15212 1670.5,-15168 1670.5,-15168 1670.5,-15162 1676.5,-15156 1682.5,-15156 1682.5,-15156 1833.5,-15156 1833.5,-15156 1839.5,-15156 1845.5,-15162 1845.5,-15168 1845.5,-15168 1845.5,-15212 1845.5,-15212 1845.5,-15218 1839.5,-15224 1833.5,-15224"/>
<text text-anchor="middle" x="1758" y="-15208.8" font-family="Arial" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="1758" y="-15193.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1758" y="-15178.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1758" y="-15163.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- attn_comp_8&#45;&gt;out_proj_8 -->
<g id="edge190" class="edge">
<title>attn_comp_8&#45;&gt;out_proj_8</title>
<path fill="none" stroke="black" d="M1754.75,-15296.81C1754.75,-15296.81 1754.75,-15234.26 1754.75,-15234.26"/>
<polygon fill="black" stroke="black" points="1758.25,-15234.26 1754.75,-15224.26 1751.25,-15234.26 1758.25,-15234.26"/>
</g>
<!-- allreduce_attn_8 -->
<g id="node156" class="node">
<title>allreduce_attn_8</title>
<path fill="lightcoral" stroke="black" d="M1833.5,-15083C1833.5,-15083 1700.5,-15083 1700.5,-15083 1694.5,-15083 1688.5,-15077 1688.5,-15071 1688.5,-15071 1688.5,-15057 1688.5,-15057 1688.5,-15051 1694.5,-15045 1700.5,-15045 1700.5,-15045 1833.5,-15045 1833.5,-15045 1839.5,-15045 1845.5,-15051 1845.5,-15057 1845.5,-15057 1845.5,-15071 1845.5,-15071 1845.5,-15077 1839.5,-15083 1833.5,-15083"/>
<text text-anchor="middle" x="1767" y="-15067.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1767" y="-15052.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- out_proj_8&#45;&gt;allreduce_attn_8 -->
<g id="edge191" class="edge">
<title>out_proj_8&#45;&gt;allreduce_attn_8</title>
<path fill="none" stroke="black" d="M1767,-15155.9C1767,-15155.9 1767,-15093.24 1767,-15093.24"/>
<polygon fill="black" stroke="black" points="1770.5,-15093.24 1767,-15083.24 1763.5,-15093.24 1770.5,-15093.24"/>
</g>
<!-- residual1_8 -->
<g id="node173" class="node">
<title>residual1_8</title>
<path fill="lightgray" stroke="black" d="M1943.5,-14972C1943.5,-14972 1810.5,-14972 1810.5,-14972 1804.5,-14972 1798.5,-14966 1798.5,-14960 1798.5,-14960 1798.5,-14946 1798.5,-14946 1798.5,-14940 1804.5,-14934 1810.5,-14934 1810.5,-14934 1943.5,-14934 1943.5,-14934 1949.5,-14934 1955.5,-14940 1955.5,-14946 1955.5,-14946 1955.5,-14960 1955.5,-14960 1955.5,-14966 1949.5,-14972 1943.5,-14972"/>
<text text-anchor="middle" x="1877" y="-14956.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1877" y="-14941.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_attn_8&#45;&gt;residual1_8 -->
<g id="edge215" class="edge">
<title>allreduce_attn_8&#45;&gt;residual1_8</title>
<path fill="none" stroke="black" d="M1822,-15044.92C1822,-15044.92 1822,-14982.2 1822,-14982.2"/>
<polygon fill="black" stroke="black" points="1825.5,-14982.2 1822,-14972.2 1818.5,-14982.2 1825.5,-14982.2"/>
</g>
<!-- dense_h_4h_8 -->
<g id="node157" class="node">
<title>dense_h_4h_8</title>
<path fill="lightblue" stroke="black" d="M1422.5,-14744C1422.5,-14744 1243.5,-14744 1243.5,-14744 1237.5,-14744 1231.5,-14738 1231.5,-14732 1231.5,-14732 1231.5,-14688 1231.5,-14688 1231.5,-14682 1237.5,-14676 1243.5,-14676 1243.5,-14676 1422.5,-14676 1422.5,-14676 1428.5,-14676 1434.5,-14682 1434.5,-14688 1434.5,-14688 1434.5,-14732 1434.5,-14732 1434.5,-14738 1428.5,-14744 1422.5,-14744"/>
<text text-anchor="middle" x="1333" y="-14728.8" font-family="Arial" font-size="14.00">Dense H→4H</text>
<text text-anchor="middle" x="1333" y="-14713.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1333" y="-14698.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
<text text-anchor="middle" x="1333" y="-14683.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- expert_gate_8 -->
<g id="node158" class="node">
<title>expert_gate_8</title>
<path fill="lightpink" stroke="black" d="M1267,-14603C1267,-14603 1119,-14603 1119,-14603 1113,-14603 1107,-14597 1107,-14591 1107,-14591 1107,-14562 1107,-14562 1107,-14556 1113,-14550 1119,-14550 1119,-14550 1267,-14550 1267,-14550 1273,-14550 1279,-14556 1279,-14562 1279,-14562 1279,-14591 1279,-14591 1279,-14597 1273,-14603 1267,-14603"/>
<text text-anchor="middle" x="1193" y="-14587.8" font-family="Arial" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1193" y="-14572.8" font-family="Arial" font-size="14.00">[1024, seq_len, 8 experts]</text>
<text text-anchor="middle" x="1193" y="-14557.8" font-family="Arial" font-size="14.00">Top&#45;2 routing</text>
</g>
<!-- dense_h_4h_8&#45;&gt;expert_gate_8 -->
<g id="edge192" class="edge">
<title>dense_h_4h_8&#45;&gt;expert_gate_8</title>
<path fill="none" stroke="black" d="M1255.25,-14675.97C1255.25,-14675.97 1255.25,-14613.32 1255.25,-14613.32"/>
<polygon fill="black" stroke="black" points="1258.75,-14613.32 1255.25,-14603.32 1251.75,-14613.32 1258.75,-14613.32"/>
</g>
<!-- expert_8_0 -->
<g id="node159" class="node">
<title>expert_8_0</title>
<path fill="lightsteelblue" stroke="black" d="M372,-14477C372,-14477 206,-14477 206,-14477 200,-14477 194,-14471 194,-14465 194,-14465 194,-14421 194,-14421 194,-14415 200,-14409 206,-14409 206,-14409 372,-14409 372,-14409 378,-14409 384,-14415 384,-14421 384,-14421 384,-14465 384,-14465 384,-14471 378,-14477 372,-14477"/>
<text text-anchor="middle" x="289" y="-14461.8" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="289" y="-14446.8" font-family="Arial" font-size="14.00">GPU 8</text>
<text text-anchor="middle" x="289" y="-14431.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="289" y="-14416.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_8&#45;&gt;expert_8_0 -->
<g id="edge193" class="edge">
<title>expert_gate_8&#45;&gt;expert_8_0</title>
<path fill="none" stroke="black" d="M1106.71,-14592C895.28,-14592 368.5,-14592 368.5,-14592 368.5,-14592 368.5,-14487.18 368.5,-14487.18"/>
<polygon fill="black" stroke="black" points="372,-14487.18 368.5,-14477.18 365,-14487.18 372,-14487.18"/>
</g>
<!-- expert_8_1 -->
<g id="node160" class="node">
<title>expert_8_1</title>
<path fill="lightsteelblue" stroke="black" d="M598,-14477C598,-14477 432,-14477 432,-14477 426,-14477 420,-14471 420,-14465 420,-14465 420,-14421 420,-14421 420,-14415 426,-14409 432,-14409 432,-14409 598,-14409 598,-14409 604,-14409 610,-14415 610,-14421 610,-14421 610,-14465 610,-14465 610,-14471 604,-14477 598,-14477"/>
<text text-anchor="middle" x="515" y="-14461.8" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="515" y="-14446.8" font-family="Arial" font-size="14.00">GPU 9</text>
<text text-anchor="middle" x="515" y="-14431.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="515" y="-14416.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_8&#45;&gt;expert_8_1 -->
<g id="edge194" class="edge">
<title>expert_gate_8&#45;&gt;expert_8_1</title>
<path fill="none" stroke="black" d="M1106.93,-14581C941.31,-14581 594.5,-14581 594.5,-14581 594.5,-14581 594.5,-14487.11 594.5,-14487.11"/>
<polygon fill="black" stroke="black" points="598,-14487.11 594.5,-14477.11 591,-14487.11 598,-14487.11"/>
</g>
<!-- expert_8_2 -->
<g id="node161" class="node">
<title>expert_8_2</title>
<path fill="lightsteelblue" stroke="black" d="M824,-14477C824,-14477 658,-14477 658,-14477 652,-14477 646,-14471 646,-14465 646,-14465 646,-14421 646,-14421 646,-14415 652,-14409 658,-14409 658,-14409 824,-14409 824,-14409 830,-14409 836,-14415 836,-14421 836,-14421 836,-14465 836,-14465 836,-14471 830,-14477 824,-14477"/>
<text text-anchor="middle" x="741" y="-14461.8" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="741" y="-14446.8" font-family="Arial" font-size="14.00">GPU 10</text>
<text text-anchor="middle" x="741" y="-14431.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="741" y="-14416.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_8&#45;&gt;expert_8_2 -->
<g id="edge195" class="edge">
<title>expert_gate_8&#45;&gt;expert_8_2</title>
<path fill="none" stroke="black" d="M1106.6,-14571C996.56,-14571 820.5,-14571 820.5,-14571 820.5,-14571 820.5,-14487.3 820.5,-14487.3"/>
<polygon fill="black" stroke="black" points="824,-14487.3 820.5,-14477.3 817,-14487.3 824,-14487.3"/>
</g>
<!-- expert_8_3 -->
<g id="node162" class="node">
<title>expert_8_3</title>
<path fill="lightsteelblue" stroke="black" d="M1050,-14477C1050,-14477 884,-14477 884,-14477 878,-14477 872,-14471 872,-14465 872,-14465 872,-14421 872,-14421 872,-14415 878,-14409 884,-14409 884,-14409 1050,-14409 1050,-14409 1056,-14409 1062,-14415 1062,-14421 1062,-14421 1062,-14465 1062,-14465 1062,-14471 1056,-14477 1050,-14477"/>
<text text-anchor="middle" x="967" y="-14461.8" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="967" y="-14446.8" font-family="Arial" font-size="14.00">GPU 11</text>
<text text-anchor="middle" x="967" y="-14431.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="967" y="-14416.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_8&#45;&gt;expert_8_3 -->
<g id="edge196" class="edge">
<title>expert_gate_8&#45;&gt;expert_8_3</title>
<path fill="none" stroke="black" d="M1106.93,-14560C1075.04,-14560 1046.5,-14560 1046.5,-14560 1046.5,-14560 1046.5,-14487.16 1046.5,-14487.16"/>
<polygon fill="black" stroke="black" points="1050,-14487.16 1046.5,-14477.16 1043,-14487.16 1050,-14487.16"/>
</g>
<!-- expert_8_4 -->
<g id="node163" class="node">
<title>expert_8_4</title>
<path fill="lightsteelblue" stroke="black" d="M1276,-14477C1276,-14477 1110,-14477 1110,-14477 1104,-14477 1098,-14471 1098,-14465 1098,-14465 1098,-14421 1098,-14421 1098,-14415 1104,-14409 1110,-14409 1110,-14409 1276,-14409 1276,-14409 1282,-14409 1288,-14415 1288,-14421 1288,-14421 1288,-14465 1288,-14465 1288,-14471 1282,-14477 1276,-14477"/>
<text text-anchor="middle" x="1193" y="-14461.8" font-family="Arial" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1193" y="-14446.8" font-family="Arial" font-size="14.00">GPU 12</text>
<text text-anchor="middle" x="1193" y="-14431.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1193" y="-14416.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_8&#45;&gt;expert_8_4 -->
<g id="edge197" class="edge">
<title>expert_gate_8&#45;&gt;expert_8_4</title>
<path fill="none" stroke="black" d="M1193,-14549.81C1193,-14549.81 1193,-14487.26 1193,-14487.26"/>
<polygon fill="black" stroke="black" points="1196.5,-14487.26 1193,-14477.26 1189.5,-14487.26 1196.5,-14487.26"/>
</g>
<!-- expert_8_5 -->
<g id="node164" class="node">
<title>expert_8_5</title>
<path fill="lightsteelblue" stroke="black" d="M1502,-14477C1502,-14477 1336,-14477 1336,-14477 1330,-14477 1324,-14471 1324,-14465 1324,-14465 1324,-14421 1324,-14421 1324,-14415 1330,-14409 1336,-14409 1336,-14409 1502,-14409 1502,-14409 1508,-14409 1514,-14415 1514,-14421 1514,-14421 1514,-14465 1514,-14465 1514,-14471 1508,-14477 1502,-14477"/>
<text text-anchor="middle" x="1419" y="-14461.8" font-family="Arial" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1419" y="-14446.8" font-family="Arial" font-size="14.00">GPU 13</text>
<text text-anchor="middle" x="1419" y="-14431.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1419" y="-14416.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_8&#45;&gt;expert_8_5 -->
<g id="edge198" class="edge">
<title>expert_gate_8&#45;&gt;expert_8_5</title>
<path fill="none" stroke="black" d="M1279.04,-14563C1327.84,-14563 1379.25,-14563 1379.25,-14563 1379.25,-14563 1379.25,-14487.07 1379.25,-14487.07"/>
<polygon fill="black" stroke="black" points="1382.75,-14487.07 1379.25,-14477.07 1375.75,-14487.07 1382.75,-14487.07"/>
</g>
<!-- expert_8_6 -->
<g id="node165" class="node">
<title>expert_8_6</title>
<path fill="lightsteelblue" stroke="black" d="M1728,-14477C1728,-14477 1562,-14477 1562,-14477 1556,-14477 1550,-14471 1550,-14465 1550,-14465 1550,-14421 1550,-14421 1550,-14415 1556,-14409 1562,-14409 1562,-14409 1728,-14409 1728,-14409 1734,-14409 1740,-14415 1740,-14421 1740,-14421 1740,-14465 1740,-14465 1740,-14471 1734,-14477 1728,-14477"/>
<text text-anchor="middle" x="1645" y="-14461.8" font-family="Arial" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="1645" y="-14446.8" font-family="Arial" font-size="14.00">GPU 14</text>
<text text-anchor="middle" x="1645" y="-14431.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1645" y="-14416.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_8&#45;&gt;expert_8_6 -->
<g id="edge199" class="edge">
<title>expert_gate_8&#45;&gt;expert_8_6</title>
<path fill="none" stroke="black" d="M1279.23,-14576C1397.95,-14576 1597.25,-14576 1597.25,-14576 1597.25,-14576 1597.25,-14487.25 1597.25,-14487.25"/>
<polygon fill="black" stroke="black" points="1600.75,-14487.25 1597.25,-14477.25 1593.75,-14487.25 1600.75,-14487.25"/>
</g>
<!-- expert_8_7 -->
<g id="node166" class="node">
<title>expert_8_7</title>
<path fill="lightsteelblue" stroke="black" d="M1954,-14477C1954,-14477 1788,-14477 1788,-14477 1782,-14477 1776,-14471 1776,-14465 1776,-14465 1776,-14421 1776,-14421 1776,-14415 1782,-14409 1788,-14409 1788,-14409 1954,-14409 1954,-14409 1960,-14409 1966,-14415 1966,-14421 1966,-14421 1966,-14465 1966,-14465 1966,-14471 1960,-14477 1954,-14477"/>
<text text-anchor="middle" x="1871" y="-14461.8" font-family="Arial" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="1871" y="-14446.8" font-family="Arial" font-size="14.00">GPU 15</text>
<text text-anchor="middle" x="1871" y="-14431.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1871" y="-14416.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_8&#45;&gt;expert_8_7 -->
<g id="edge200" class="edge">
<title>expert_gate_8&#45;&gt;expert_8_7</title>
<path fill="none" stroke="black" d="M1279.22,-14589C1455.82,-14589 1842.25,-14589 1842.25,-14589 1842.25,-14589 1842.25,-14487.23 1842.25,-14487.23"/>
<polygon fill="black" stroke="black" points="1845.75,-14487.23 1842.25,-14477.23 1838.75,-14487.23 1845.75,-14487.23"/>
</g>
<!-- expert_agg_8 -->
<g id="node167" class="node">
<title>expert_agg_8</title>
<path fill="lightsalmon" stroke="black" d="M1268.5,-14336C1268.5,-14336 1117.5,-14336 1117.5,-14336 1111.5,-14336 1105.5,-14330 1105.5,-14324 1105.5,-14324 1105.5,-14295 1105.5,-14295 1105.5,-14289 1111.5,-14283 1117.5,-14283 1117.5,-14283 1268.5,-14283 1268.5,-14283 1274.5,-14283 1280.5,-14289 1280.5,-14295 1280.5,-14295 1280.5,-14324 1280.5,-14324 1280.5,-14330 1274.5,-14336 1268.5,-14336"/>
<text text-anchor="middle" x="1193" y="-14320.8" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1193" y="-14305.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1193" y="-14290.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- expert_8_0&#45;&gt;expert_agg_8 -->
<g id="edge201" class="edge">
<title>expert_8_0&#45;&gt;expert_agg_8</title>
<path fill="none" stroke="black" d="M319,-14408.96C319,-14364.71 319,-14293 319,-14293 319,-14293 1095.2,-14293 1095.2,-14293"/>
<polygon fill="black" stroke="black" points="1095.2,-14296.5 1105.2,-14293 1095.2,-14289.5 1095.2,-14296.5"/>
</g>
<!-- expert_8_1&#45;&gt;expert_agg_8 -->
<g id="edge202" class="edge">
<title>expert_8_1&#45;&gt;expert_agg_8</title>
<path fill="none" stroke="black" d="M545,-14409C545,-14367.85 545,-14304 545,-14304 545,-14304 1095.27,-14304 1095.27,-14304"/>
<polygon fill="black" stroke="black" points="1095.27,-14307.5 1105.27,-14304 1095.27,-14300.5 1095.27,-14307.5"/>
</g>
<!-- expert_8_2&#45;&gt;expert_agg_8 -->
<g id="edge203" class="edge">
<title>expert_8_2&#45;&gt;expert_agg_8</title>
<path fill="none" stroke="black" d="M771,-14408.77C771,-14370.55 771,-14314 771,-14314 771,-14314 1095.31,-14314 1095.31,-14314"/>
<polygon fill="black" stroke="black" points="1095.31,-14317.5 1105.31,-14314 1095.31,-14310.5 1095.31,-14317.5"/>
</g>
<!-- expert_8_3&#45;&gt;expert_agg_8 -->
<g id="edge204" class="edge">
<title>expert_8_3&#45;&gt;expert_agg_8</title>
<path fill="none" stroke="black" d="M1001.5,-14408.87C1001.5,-14374.02 1001.5,-14325 1001.5,-14325 1001.5,-14325 1095.38,-14325 1095.38,-14325"/>
<polygon fill="black" stroke="black" points="1095.38,-14328.5 1105.38,-14325 1095.38,-14321.5 1095.38,-14328.5"/>
</g>
<!-- expert_8_4&#45;&gt;expert_agg_8 -->
<g id="edge205" class="edge">
<title>expert_8_4&#45;&gt;expert_agg_8</title>
<path fill="none" stroke="black" d="M1193,-14408.97C1193,-14408.97 1193,-14346.32 1193,-14346.32"/>
<polygon fill="black" stroke="black" points="1196.5,-14346.32 1193,-14336.32 1189.5,-14346.32 1196.5,-14346.32"/>
</g>
<!-- expert_8_5&#45;&gt;expert_agg_8 -->
<g id="edge206" class="edge">
<title>expert_8_5&#45;&gt;expert_agg_8</title>
<path fill="none" stroke="black" d="M1398.75,-14408.87C1398.75,-14374.02 1398.75,-14325 1398.75,-14325 1398.75,-14325 1290.55,-14325 1290.55,-14325"/>
<polygon fill="black" stroke="black" points="1290.55,-14321.5 1280.55,-14325 1290.55,-14328.5 1290.55,-14321.5"/>
</g>
<!-- expert_8_6&#45;&gt;expert_agg_8 -->
<g id="edge207" class="edge">
<title>expert_8_6&#45;&gt;expert_agg_8</title>
<path fill="none" stroke="black" d="M1569.25,-14408.77C1569.25,-14370.55 1569.25,-14314 1569.25,-14314 1569.25,-14314 1290.74,-14314 1290.74,-14314"/>
<polygon fill="black" stroke="black" points="1290.74,-14310.5 1280.74,-14314 1290.74,-14317.5 1290.74,-14310.5"/>
</g>
<!-- expert_8_7&#45;&gt;expert_agg_8 -->
<g id="edge208" class="edge">
<title>expert_8_7&#45;&gt;expert_agg_8</title>
<path fill="none" stroke="black" d="M1786.25,-14409C1786.25,-14367.85 1786.25,-14304 1786.25,-14304 1786.25,-14304 1290.54,-14304 1290.54,-14304"/>
<polygon fill="black" stroke="black" points="1290.54,-14300.5 1280.54,-14304 1290.54,-14307.5 1290.54,-14300.5"/>
</g>
<!-- activation_8 -->
<g id="node168" class="node">
<title>activation_8</title>
<path fill="lightyellow" stroke="black" d="M1461.5,-14210C1461.5,-14210 1300.5,-14210 1300.5,-14210 1294.5,-14210 1288.5,-14204 1288.5,-14198 1288.5,-14198 1288.5,-14184 1288.5,-14184 1288.5,-14178 1294.5,-14172 1300.5,-14172 1300.5,-14172 1461.5,-14172 1461.5,-14172 1467.5,-14172 1473.5,-14178 1473.5,-14184 1473.5,-14184 1473.5,-14198 1473.5,-14198 1473.5,-14204 1467.5,-14210 1461.5,-14210"/>
<text text-anchor="middle" x="1381" y="-14194.8" font-family="Arial" font-size="14.00">GELU</text>
<text text-anchor="middle" x="1381" y="-14179.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- expert_agg_8&#45;&gt;activation_8 -->
<g id="edge209" class="edge">
<title>expert_agg_8&#45;&gt;activation_8</title>
<path fill="none" stroke="black" d="M1280.55,-14293C1295.47,-14293 1306.25,-14293 1306.25,-14293 1306.25,-14293 1306.25,-14220.19 1306.25,-14220.19"/>
<polygon fill="black" stroke="black" points="1309.75,-14220.19 1306.25,-14210.19 1302.75,-14220.19 1309.75,-14220.19"/>
</g>
<!-- dense_4h_h_8 -->
<g id="node169" class="node">
<title>dense_4h_h_8</title>
<path fill="lightblue" stroke="black" d="M1576.5,-14099C1576.5,-14099 1415.5,-14099 1415.5,-14099 1409.5,-14099 1403.5,-14093 1403.5,-14087 1403.5,-14087 1403.5,-14043 1403.5,-14043 1403.5,-14037 1409.5,-14031 1415.5,-14031 1415.5,-14031 1576.5,-14031 1576.5,-14031 1582.5,-14031 1588.5,-14037 1588.5,-14043 1588.5,-14043 1588.5,-14087 1588.5,-14087 1588.5,-14093 1582.5,-14099 1576.5,-14099"/>
<text text-anchor="middle" x="1496" y="-14083.8" font-family="Arial" font-size="14.00">Dense 4H→H</text>
<text text-anchor="middle" x="1496" y="-14068.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1496" y="-14053.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1496" y="-14038.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- activation_8&#45;&gt;dense_4h_h_8 -->
<g id="edge210" class="edge">
<title>activation_8&#45;&gt;dense_4h_h_8</title>
<path fill="none" stroke="black" d="M1438.5,-14171.86C1438.5,-14171.86 1438.5,-14109.07 1438.5,-14109.07"/>
<polygon fill="black" stroke="black" points="1442,-14109.07 1438.5,-14099.07 1435,-14109.07 1442,-14109.07"/>
</g>
<!-- allreduce_mlp_8 -->
<g id="node170" class="node">
<title>allreduce_mlp_8</title>
<path fill="lightcoral" stroke="black" d="M1664.5,-13958C1664.5,-13958 1531.5,-13958 1531.5,-13958 1525.5,-13958 1519.5,-13952 1519.5,-13946 1519.5,-13946 1519.5,-13932 1519.5,-13932 1519.5,-13926 1525.5,-13920 1531.5,-13920 1531.5,-13920 1664.5,-13920 1664.5,-13920 1670.5,-13920 1676.5,-13926 1676.5,-13932 1676.5,-13932 1676.5,-13946 1676.5,-13946 1676.5,-13952 1670.5,-13958 1664.5,-13958"/>
<text text-anchor="middle" x="1598" y="-13942.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1598" y="-13927.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- dense_4h_h_8&#45;&gt;allreduce_mlp_8 -->
<g id="edge211" class="edge">
<title>dense_4h_h_8&#45;&gt;allreduce_mlp_8</title>
<path fill="none" stroke="black" d="M1554,-14030.9C1554,-14030.9 1554,-13968.24 1554,-13968.24"/>
<polygon fill="black" stroke="black" points="1557.5,-13968.24 1554,-13958.24 1550.5,-13968.24 1557.5,-13968.24"/>
</g>
<!-- residual2_8 -->
<g id="node175" class="node">
<title>residual2_8</title>
<path fill="lightgray" stroke="black" d="M1784.5,-13847C1784.5,-13847 1651.5,-13847 1651.5,-13847 1645.5,-13847 1639.5,-13841 1639.5,-13835 1639.5,-13835 1639.5,-13821 1639.5,-13821 1639.5,-13815 1645.5,-13809 1651.5,-13809 1651.5,-13809 1784.5,-13809 1784.5,-13809 1790.5,-13809 1796.5,-13815 1796.5,-13821 1796.5,-13821 1796.5,-13835 1796.5,-13835 1796.5,-13841 1790.5,-13847 1784.5,-13847"/>
<text text-anchor="middle" x="1718" y="-13831.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1718" y="-13816.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_mlp_8&#45;&gt;residual2_8 -->
<g id="edge219" class="edge">
<title>allreduce_mlp_8&#45;&gt;residual2_8</title>
<path fill="none" stroke="black" d="M1658,-13919.92C1658,-13919.92 1658,-13857.2 1658,-13857.2"/>
<polygon fill="black" stroke="black" points="1661.5,-13857.2 1658,-13847.2 1654.5,-13857.2 1661.5,-13857.2"/>
</g>
<!-- norm1_8 -->
<g id="node172" class="node">
<title>norm1_8</title>
<path fill="lightcyan" stroke="black" d="M1824.5,-15608C1824.5,-15608 1691.5,-15608 1691.5,-15608 1685.5,-15608 1679.5,-15602 1679.5,-15596 1679.5,-15596 1679.5,-15582 1679.5,-15582 1679.5,-15576 1685.5,-15570 1691.5,-15570 1691.5,-15570 1824.5,-15570 1824.5,-15570 1830.5,-15570 1836.5,-15576 1836.5,-15582 1836.5,-15582 1836.5,-15596 1836.5,-15596 1836.5,-15602 1830.5,-15608 1824.5,-15608"/>
<text text-anchor="middle" x="1758" y="-15592.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1758" y="-15577.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- input_8&#45;&gt;norm1_8 -->
<g id="edge212" class="edge">
<title>input_8&#45;&gt;norm1_8</title>
<path fill="none" stroke="black" d="M1790.25,-15685.9C1790.25,-15685.9 1790.25,-15618.23 1790.25,-15618.23"/>
<polygon fill="black" stroke="black" points="1793.75,-15618.23 1790.25,-15608.23 1786.75,-15618.23 1793.75,-15618.23"/>
</g>
<!-- input_8&#45;&gt;residual1_8 -->
<g id="edge213" class="edge">
<title>input_8&#45;&gt;residual1_8</title>
<path fill="none" stroke="black" d="M1901.5,-15683.31C1901.5,-15683.31 1901.5,-14982.11 1901.5,-14982.11"/>
<polygon fill="black" stroke="black" points="1905,-14982.11 1901.5,-14972.11 1898,-14982.11 1905,-14982.11"/>
</g>
<!-- norm1_8&#45;&gt;qkv_proj_8 -->
<g id="edge214" class="edge">
<title>norm1_8&#45;&gt;qkv_proj_8</title>
<path fill="none" stroke="black" d="M1758,-15569.81C1758,-15569.81 1758,-15501.06 1758,-15501.06"/>
<polygon fill="black" stroke="black" points="1761.5,-15501.06 1758,-15491.06 1754.5,-15501.06 1761.5,-15501.06"/>
</g>
<!-- norm2_8 -->
<g id="node174" class="node">
<title>norm2_8</title>
<path fill="lightcyan" stroke="black" d="M1896.5,-14861C1896.5,-14861 1763.5,-14861 1763.5,-14861 1757.5,-14861 1751.5,-14855 1751.5,-14849 1751.5,-14849 1751.5,-14835 1751.5,-14835 1751.5,-14829 1757.5,-14823 1763.5,-14823 1763.5,-14823 1896.5,-14823 1896.5,-14823 1902.5,-14823 1908.5,-14829 1908.5,-14835 1908.5,-14835 1908.5,-14849 1908.5,-14849 1908.5,-14855 1902.5,-14861 1896.5,-14861"/>
<text text-anchor="middle" x="1830" y="-14845.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1830" y="-14830.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual1_8&#45;&gt;norm2_8 -->
<g id="edge216" class="edge">
<title>residual1_8&#45;&gt;norm2_8</title>
<path fill="none" stroke="black" d="M1853.5,-14933.92C1853.5,-14933.92 1853.5,-14871.2 1853.5,-14871.2"/>
<polygon fill="black" stroke="black" points="1857,-14871.2 1853.5,-14861.2 1850,-14871.2 1857,-14871.2"/>
</g>
<!-- residual1_8&#45;&gt;residual2_8 -->
<g id="edge217" class="edge">
<title>residual1_8&#45;&gt;residual2_8</title>
<path fill="none" stroke="black" d="M1798.38,-14953C1770.43,-14953 1745.75,-14953 1745.75,-14953 1745.75,-14953 1745.75,-13857.05 1745.75,-13857.05"/>
<polygon fill="black" stroke="black" points="1749.25,-13857.05 1745.75,-13847.05 1742.25,-13857.05 1749.25,-13857.05"/>
</g>
<!-- norm2_8&#45;&gt;dense_h_4h_8 -->
<g id="edge218" class="edge">
<title>norm2_8&#45;&gt;dense_h_4h_8</title>
<path fill="none" stroke="black" d="M1751.12,-14842C1628.98,-14842 1408,-14842 1408,-14842 1408,-14842 1408,-14754.34 1408,-14754.34"/>
<polygon fill="black" stroke="black" points="1411.5,-14754.34 1408,-14744.34 1404.5,-14754.34 1411.5,-14754.34"/>
</g>
<!-- output_8 -->
<g id="node176" class="node">
<title>output_8</title>
<ellipse fill="white" stroke="black" cx="1718" cy="-13709" rx="111" ry="27"/>
<text text-anchor="middle" x="1718" y="-13712.8" font-family="Arial" font-size="14.00">Layer 9 Output</text>
<text text-anchor="middle" x="1718" y="-13697.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual2_8&#45;&gt;output_8 -->
<g id="edge220" class="edge">
<title>residual2_8&#45;&gt;output_8</title>
<path fill="none" stroke="black" d="M1718,-13808.88C1718,-13808.88 1718,-13746.05 1718,-13746.05"/>
<polygon fill="black" stroke="black" points="1721.5,-13746.05 1718,-13736.05 1714.5,-13746.05 1721.5,-13746.05"/>
</g>
<!-- input_9 -->
<g id="node185" class="node">
<title>input_9</title>
<ellipse fill="white" stroke="black" cx="1718" cy="-13547" rx="111" ry="27"/>
<text text-anchor="middle" x="1718" y="-13550.8" font-family="Arial" font-size="14.00">Layer 10 Input</text>
<text text-anchor="middle" x="1718" y="-13535.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- output_8&#45;&gt;input_9 -->
<g id="edge386" class="edge">
<title>output_8&#45;&gt;input_9</title>
<path fill="none" stroke="red" stroke-width="2" stroke-dasharray="5,2" d="M1718,-13681.88C1718,-13681.88 1718,-13584.2 1718,-13584.2"/>
<polygon fill="red" stroke="red" stroke-width="2" points="1721.5,-13584.2 1718,-13574.2 1714.5,-13584.2 1721.5,-13584.2"/>
<text text-anchor="middle" x="1774" y="-13634.8" font-family="Times,serif" font-size="14.00">GPU&#45;to&#45;GPU</text>
<text text-anchor="middle" x="1774" y="-13619.8" font-family="Times,serif" font-size="14.00">Communication</text>
</g>
<!-- qkv_proj_9 -->
<g id="node177" class="node">
<title>qkv_proj_9</title>
<path fill="lightgreen" stroke="black" d="M1795.5,-13330C1795.5,-13330 1616.5,-13330 1616.5,-13330 1610.5,-13330 1604.5,-13324 1604.5,-13318 1604.5,-13318 1604.5,-13274 1604.5,-13274 1604.5,-13268 1610.5,-13262 1616.5,-13262 1616.5,-13262 1795.5,-13262 1795.5,-13262 1801.5,-13262 1807.5,-13268 1807.5,-13274 1807.5,-13274 1807.5,-13318 1807.5,-13318 1807.5,-13324 1801.5,-13330 1795.5,-13330"/>
<text text-anchor="middle" x="1706" y="-13314.8" font-family="Arial" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1706" y="-13299.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1706" y="-13284.8" font-family="Arial" font-size="14.00">[1024, seq_len, 3*hidden]</text>
<text text-anchor="middle" x="1706" y="-13269.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 3*hidden/tp]</text>
</g>
<!-- attn_comp_9 -->
<g id="node178" class="node">
<title>attn_comp_9</title>
<path fill="lightyellow" stroke="black" d="M1787,-13189C1787,-13189 1639,-13189 1639,-13189 1633,-13189 1627,-13183 1627,-13177 1627,-13177 1627,-13148 1627,-13148 1627,-13142 1633,-13136 1639,-13136 1639,-13136 1787,-13136 1787,-13136 1793,-13136 1799,-13142 1799,-13148 1799,-13148 1799,-13177 1799,-13177 1799,-13183 1793,-13189 1787,-13189"/>
<text text-anchor="middle" x="1713" y="-13173.8" font-family="Arial" font-size="14.00">Attention</text>
<text text-anchor="middle" x="1713" y="-13158.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1713" y="-13143.8" font-family="Arial" font-size="14.00">Heads: 2 per GPU</text>
</g>
<!-- qkv_proj_9&#45;&gt;attn_comp_9 -->
<g id="edge221" class="edge">
<title>qkv_proj_9&#45;&gt;attn_comp_9</title>
<path fill="none" stroke="black" d="M1713,-13261.97C1713,-13261.97 1713,-13199.32 1713,-13199.32"/>
<polygon fill="black" stroke="black" points="1716.5,-13199.32 1713,-13189.32 1709.5,-13199.32 1716.5,-13199.32"/>
</g>
<!-- out_proj_9 -->
<g id="node179" class="node">
<title>out_proj_9</title>
<path fill="lightgreen" stroke="black" d="M1793.5,-13063C1793.5,-13063 1642.5,-13063 1642.5,-13063 1636.5,-13063 1630.5,-13057 1630.5,-13051 1630.5,-13051 1630.5,-13007 1630.5,-13007 1630.5,-13001 1636.5,-12995 1642.5,-12995 1642.5,-12995 1793.5,-12995 1793.5,-12995 1799.5,-12995 1805.5,-13001 1805.5,-13007 1805.5,-13007 1805.5,-13051 1805.5,-13051 1805.5,-13057 1799.5,-13063 1793.5,-13063"/>
<text text-anchor="middle" x="1718" y="-13047.8" font-family="Arial" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="1718" y="-13032.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1718" y="-13017.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1718" y="-13002.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- attn_comp_9&#45;&gt;out_proj_9 -->
<g id="edge222" class="edge">
<title>attn_comp_9&#45;&gt;out_proj_9</title>
<path fill="none" stroke="black" d="M1714.75,-13135.81C1714.75,-13135.81 1714.75,-13073.26 1714.75,-13073.26"/>
<polygon fill="black" stroke="black" points="1718.25,-13073.26 1714.75,-13063.26 1711.25,-13073.26 1718.25,-13073.26"/>
</g>
<!-- allreduce_attn_9 -->
<g id="node180" class="node">
<title>allreduce_attn_9</title>
<path fill="lightcoral" stroke="black" d="M1793.5,-12922C1793.5,-12922 1660.5,-12922 1660.5,-12922 1654.5,-12922 1648.5,-12916 1648.5,-12910 1648.5,-12910 1648.5,-12896 1648.5,-12896 1648.5,-12890 1654.5,-12884 1660.5,-12884 1660.5,-12884 1793.5,-12884 1793.5,-12884 1799.5,-12884 1805.5,-12890 1805.5,-12896 1805.5,-12896 1805.5,-12910 1805.5,-12910 1805.5,-12916 1799.5,-12922 1793.5,-12922"/>
<text text-anchor="middle" x="1727" y="-12906.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1727" y="-12891.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- out_proj_9&#45;&gt;allreduce_attn_9 -->
<g id="edge223" class="edge">
<title>out_proj_9&#45;&gt;allreduce_attn_9</title>
<path fill="none" stroke="black" d="M1727,-12994.9C1727,-12994.9 1727,-12932.24 1727,-12932.24"/>
<polygon fill="black" stroke="black" points="1730.5,-12932.24 1727,-12922.24 1723.5,-12932.24 1730.5,-12932.24"/>
</g>
<!-- residual1_9 -->
<g id="node187" class="node">
<title>residual1_9</title>
<path fill="lightgray" stroke="black" d="M1814.5,-12811C1814.5,-12811 1681.5,-12811 1681.5,-12811 1675.5,-12811 1669.5,-12805 1669.5,-12799 1669.5,-12799 1669.5,-12785 1669.5,-12785 1669.5,-12779 1675.5,-12773 1681.5,-12773 1681.5,-12773 1814.5,-12773 1814.5,-12773 1820.5,-12773 1826.5,-12779 1826.5,-12785 1826.5,-12785 1826.5,-12799 1826.5,-12799 1826.5,-12805 1820.5,-12811 1814.5,-12811"/>
<text text-anchor="middle" x="1748" y="-12795.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1748" y="-12780.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_attn_9&#45;&gt;residual1_9 -->
<g id="edge230" class="edge">
<title>allreduce_attn_9&#45;&gt;residual1_9</title>
<path fill="none" stroke="black" d="M1737.5,-12883.92C1737.5,-12883.92 1737.5,-12821.2 1737.5,-12821.2"/>
<polygon fill="black" stroke="black" points="1741,-12821.2 1737.5,-12811.2 1734,-12821.2 1741,-12821.2"/>
</g>
<!-- dense_h_4h_9 -->
<g id="node181" class="node">
<title>dense_h_4h_9</title>
<path fill="lightblue" stroke="black" d="M1795.5,-12583C1795.5,-12583 1616.5,-12583 1616.5,-12583 1610.5,-12583 1604.5,-12577 1604.5,-12571 1604.5,-12571 1604.5,-12527 1604.5,-12527 1604.5,-12521 1610.5,-12515 1616.5,-12515 1616.5,-12515 1795.5,-12515 1795.5,-12515 1801.5,-12515 1807.5,-12521 1807.5,-12527 1807.5,-12527 1807.5,-12571 1807.5,-12571 1807.5,-12577 1801.5,-12583 1795.5,-12583"/>
<text text-anchor="middle" x="1706" y="-12567.8" font-family="Arial" font-size="14.00">Dense H→4H</text>
<text text-anchor="middle" x="1706" y="-12552.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1706" y="-12537.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
<text text-anchor="middle" x="1706" y="-12522.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- activation_9 -->
<g id="node182" class="node">
<title>activation_9</title>
<path fill="lightyellow" stroke="black" d="M1788.5,-12442C1788.5,-12442 1627.5,-12442 1627.5,-12442 1621.5,-12442 1615.5,-12436 1615.5,-12430 1615.5,-12430 1615.5,-12416 1615.5,-12416 1615.5,-12410 1621.5,-12404 1627.5,-12404 1627.5,-12404 1788.5,-12404 1788.5,-12404 1794.5,-12404 1800.5,-12410 1800.5,-12416 1800.5,-12416 1800.5,-12430 1800.5,-12430 1800.5,-12436 1794.5,-12442 1788.5,-12442"/>
<text text-anchor="middle" x="1708" y="-12426.8" font-family="Arial" font-size="14.00">GELU</text>
<text text-anchor="middle" x="1708" y="-12411.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- dense_h_4h_9&#45;&gt;activation_9 -->
<g id="edge224" class="edge">
<title>dense_h_4h_9&#45;&gt;activation_9</title>
<path fill="none" stroke="black" d="M1708,-12514.9C1708,-12514.9 1708,-12452.24 1708,-12452.24"/>
<polygon fill="black" stroke="black" points="1711.5,-12452.24 1708,-12442.24 1704.5,-12452.24 1711.5,-12452.24"/>
</g>
<!-- dense_4h_h_9 -->
<g id="node183" class="node">
<title>dense_4h_h_9</title>
<path fill="lightblue" stroke="black" d="M1790.5,-12331C1790.5,-12331 1629.5,-12331 1629.5,-12331 1623.5,-12331 1617.5,-12325 1617.5,-12319 1617.5,-12319 1617.5,-12275 1617.5,-12275 1617.5,-12269 1623.5,-12263 1629.5,-12263 1629.5,-12263 1790.5,-12263 1790.5,-12263 1796.5,-12263 1802.5,-12269 1802.5,-12275 1802.5,-12275 1802.5,-12319 1802.5,-12319 1802.5,-12325 1796.5,-12331 1790.5,-12331"/>
<text text-anchor="middle" x="1710" y="-12315.8" font-family="Arial" font-size="14.00">Dense 4H→H</text>
<text text-anchor="middle" x="1710" y="-12300.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1710" y="-12285.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1710" y="-12270.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- activation_9&#45;&gt;dense_4h_h_9 -->
<g id="edge225" class="edge">
<title>activation_9&#45;&gt;dense_4h_h_9</title>
<path fill="none" stroke="black" d="M1709,-12403.86C1709,-12403.86 1709,-12341.07 1709,-12341.07"/>
<polygon fill="black" stroke="black" points="1712.5,-12341.07 1709,-12331.07 1705.5,-12341.07 1712.5,-12341.07"/>
</g>
<!-- allreduce_mlp_9 -->
<g id="node184" class="node">
<title>allreduce_mlp_9</title>
<path fill="lightcoral" stroke="black" d="M1777.5,-12190C1777.5,-12190 1644.5,-12190 1644.5,-12190 1638.5,-12190 1632.5,-12184 1632.5,-12178 1632.5,-12178 1632.5,-12164 1632.5,-12164 1632.5,-12158 1638.5,-12152 1644.5,-12152 1644.5,-12152 1777.5,-12152 1777.5,-12152 1783.5,-12152 1789.5,-12158 1789.5,-12164 1789.5,-12164 1789.5,-12178 1789.5,-12178 1789.5,-12184 1783.5,-12190 1777.5,-12190"/>
<text text-anchor="middle" x="1711" y="-12174.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1711" y="-12159.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- dense_4h_h_9&#45;&gt;allreduce_mlp_9 -->
<g id="edge226" class="edge">
<title>dense_4h_h_9&#45;&gt;allreduce_mlp_9</title>
<path fill="none" stroke="black" d="M1711,-12262.9C1711,-12262.9 1711,-12200.24 1711,-12200.24"/>
<polygon fill="black" stroke="black" points="1714.5,-12200.24 1711,-12190.24 1707.5,-12200.24 1714.5,-12200.24"/>
</g>
<!-- residual2_9 -->
<g id="node189" class="node">
<title>residual2_9</title>
<path fill="lightgray" stroke="black" d="M1777.5,-12079C1777.5,-12079 1644.5,-12079 1644.5,-12079 1638.5,-12079 1632.5,-12073 1632.5,-12067 1632.5,-12067 1632.5,-12053 1632.5,-12053 1632.5,-12047 1638.5,-12041 1644.5,-12041 1644.5,-12041 1777.5,-12041 1777.5,-12041 1783.5,-12041 1789.5,-12047 1789.5,-12053 1789.5,-12053 1789.5,-12067 1789.5,-12067 1789.5,-12073 1783.5,-12079 1777.5,-12079"/>
<text text-anchor="middle" x="1711" y="-12063.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1711" y="-12048.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_mlp_9&#45;&gt;residual2_9 -->
<g id="edge234" class="edge">
<title>allreduce_mlp_9&#45;&gt;residual2_9</title>
<path fill="none" stroke="black" d="M1711,-12151.92C1711,-12151.92 1711,-12089.2 1711,-12089.2"/>
<polygon fill="black" stroke="black" points="1714.5,-12089.2 1711,-12079.2 1707.5,-12089.2 1714.5,-12089.2"/>
</g>
<!-- norm1_9 -->
<g id="node186" class="node">
<title>norm1_9</title>
<path fill="lightcyan" stroke="black" d="M1780.5,-13447C1780.5,-13447 1647.5,-13447 1647.5,-13447 1641.5,-13447 1635.5,-13441 1635.5,-13435 1635.5,-13435 1635.5,-13421 1635.5,-13421 1635.5,-13415 1641.5,-13409 1647.5,-13409 1647.5,-13409 1780.5,-13409 1780.5,-13409 1786.5,-13409 1792.5,-13415 1792.5,-13421 1792.5,-13421 1792.5,-13435 1792.5,-13435 1792.5,-13441 1786.5,-13447 1780.5,-13447"/>
<text text-anchor="middle" x="1714" y="-13431.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1714" y="-13416.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- input_9&#45;&gt;norm1_9 -->
<g id="edge227" class="edge">
<title>input_9&#45;&gt;norm1_9</title>
<path fill="none" stroke="black" d="M1714,-13520C1714,-13520 1714,-13457.12 1714,-13457.12"/>
<polygon fill="black" stroke="black" points="1717.5,-13457.12 1714,-13447.12 1710.5,-13457.12 1717.5,-13457.12"/>
</g>
<!-- input_9&#45;&gt;residual1_9 -->
<g id="edge228" class="edge">
<title>input_9&#45;&gt;residual1_9</title>
<path fill="none" stroke="black" d="M1817,-13534.53C1817,-13534.53 1817,-12821.04 1817,-12821.04"/>
<polygon fill="black" stroke="black" points="1820.5,-12821.04 1817,-12811.04 1813.5,-12821.04 1820.5,-12821.04"/>
</g>
<!-- norm1_9&#45;&gt;qkv_proj_9 -->
<g id="edge229" class="edge">
<title>norm1_9&#45;&gt;qkv_proj_9</title>
<path fill="none" stroke="black" d="M1714,-13408.81C1714,-13408.81 1714,-13340.06 1714,-13340.06"/>
<polygon fill="black" stroke="black" points="1717.5,-13340.06 1714,-13330.06 1710.5,-13340.06 1717.5,-13340.06"/>
</g>
<!-- norm2_9 -->
<g id="node188" class="node">
<title>norm2_9</title>
<path fill="lightcyan" stroke="black" d="M1784.5,-12700C1784.5,-12700 1651.5,-12700 1651.5,-12700 1645.5,-12700 1639.5,-12694 1639.5,-12688 1639.5,-12688 1639.5,-12674 1639.5,-12674 1639.5,-12668 1645.5,-12662 1651.5,-12662 1651.5,-12662 1784.5,-12662 1784.5,-12662 1790.5,-12662 1796.5,-12668 1796.5,-12674 1796.5,-12674 1796.5,-12688 1796.5,-12688 1796.5,-12694 1790.5,-12700 1784.5,-12700"/>
<text text-anchor="middle" x="1718" y="-12684.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1718" y="-12669.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual1_9&#45;&gt;norm2_9 -->
<g id="edge231" class="edge">
<title>residual1_9&#45;&gt;norm2_9</title>
<path fill="none" stroke="black" d="M1733,-12772.92C1733,-12772.92 1733,-12710.2 1733,-12710.2"/>
<polygon fill="black" stroke="black" points="1736.5,-12710.2 1733,-12700.2 1729.5,-12710.2 1736.5,-12710.2"/>
</g>
<!-- residual1_9&#45;&gt;residual2_9 -->
<g id="edge232" class="edge">
<title>residual1_9&#45;&gt;residual2_9</title>
<path fill="none" stroke="black" d="M1814.75,-12772.8C1814.75,-12657.3 1814.75,-12060 1814.75,-12060 1814.75,-12060 1799.64,-12060 1799.64,-12060"/>
<polygon fill="black" stroke="black" points="1799.64,-12056.5 1789.64,-12060 1799.63,-12063.5 1799.64,-12056.5"/>
</g>
<!-- norm2_9&#45;&gt;dense_h_4h_9 -->
<g id="edge233" class="edge">
<title>norm2_9&#45;&gt;dense_h_4h_9</title>
<path fill="none" stroke="black" d="M1718,-12661.81C1718,-12661.81 1718,-12593.06 1718,-12593.06"/>
<polygon fill="black" stroke="black" points="1721.5,-12593.06 1718,-12583.06 1714.5,-12593.06 1721.5,-12593.06"/>
</g>
<!-- output_9 -->
<g id="node190" class="node">
<title>output_9</title>
<ellipse fill="white" stroke="black" cx="1711" cy="-11941" rx="111" ry="27"/>
<text text-anchor="middle" x="1711" y="-11944.8" font-family="Arial" font-size="14.00">Layer 10 Output</text>
<text text-anchor="middle" x="1711" y="-11929.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual2_9&#45;&gt;output_9 -->
<g id="edge235" class="edge">
<title>residual2_9&#45;&gt;output_9</title>
<path fill="none" stroke="black" d="M1711,-12040.88C1711,-12040.88 1711,-11978.05 1711,-11978.05"/>
<polygon fill="black" stroke="black" points="1714.5,-11978.05 1711,-11968.05 1707.5,-11978.05 1714.5,-11978.05"/>
</g>
<!-- input_10 -->
<g id="node209" class="node">
<title>input_10</title>
<ellipse fill="white" stroke="black" cx="1711" cy="-11779" rx="111" ry="27"/>
<text text-anchor="middle" x="1711" y="-11782.8" font-family="Arial" font-size="14.00">Layer 11 Input</text>
<text text-anchor="middle" x="1711" y="-11767.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- output_9&#45;&gt;input_10 -->
<g id="edge387" class="edge">
<title>output_9&#45;&gt;input_10</title>
<path fill="none" stroke="red" stroke-width="2" stroke-dasharray="5,2" d="M1711,-11913.88C1711,-11913.88 1711,-11816.2 1711,-11816.2"/>
<polygon fill="red" stroke="red" stroke-width="2" points="1714.5,-11816.2 1711,-11806.2 1707.5,-11816.2 1714.5,-11816.2"/>
<text text-anchor="middle" x="1767" y="-11866.8" font-family="Times,serif" font-size="14.00">GPU&#45;to&#45;GPU</text>
<text text-anchor="middle" x="1767" y="-11851.8" font-family="Times,serif" font-size="14.00">Communication</text>
</g>
<!-- qkv_proj_10 -->
<g id="node191" class="node">
<title>qkv_proj_10</title>
<path fill="lightgreen" stroke="black" d="M1713.5,-11562C1713.5,-11562 1534.5,-11562 1534.5,-11562 1528.5,-11562 1522.5,-11556 1522.5,-11550 1522.5,-11550 1522.5,-11506 1522.5,-11506 1522.5,-11500 1528.5,-11494 1534.5,-11494 1534.5,-11494 1713.5,-11494 1713.5,-11494 1719.5,-11494 1725.5,-11500 1725.5,-11506 1725.5,-11506 1725.5,-11550 1725.5,-11550 1725.5,-11556 1719.5,-11562 1713.5,-11562"/>
<text text-anchor="middle" x="1624" y="-11546.8" font-family="Arial" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1624" y="-11531.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1624" y="-11516.8" font-family="Arial" font-size="14.00">[1024, seq_len, 3*hidden]</text>
<text text-anchor="middle" x="1624" y="-11501.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 3*hidden/tp]</text>
</g>
<!-- attn_comp_10 -->
<g id="node192" class="node">
<title>attn_comp_10</title>
<path fill="lightyellow" stroke="black" d="M1705,-11421C1705,-11421 1557,-11421 1557,-11421 1551,-11421 1545,-11415 1545,-11409 1545,-11409 1545,-11380 1545,-11380 1545,-11374 1551,-11368 1557,-11368 1557,-11368 1705,-11368 1705,-11368 1711,-11368 1717,-11374 1717,-11380 1717,-11380 1717,-11409 1717,-11409 1717,-11415 1711,-11421 1705,-11421"/>
<text text-anchor="middle" x="1631" y="-11405.8" font-family="Arial" font-size="14.00">Attention</text>
<text text-anchor="middle" x="1631" y="-11390.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1631" y="-11375.8" font-family="Arial" font-size="14.00">Heads: 2 per GPU</text>
</g>
<!-- qkv_proj_10&#45;&gt;attn_comp_10 -->
<g id="edge236" class="edge">
<title>qkv_proj_10&#45;&gt;attn_comp_10</title>
<path fill="none" stroke="black" d="M1631,-11493.97C1631,-11493.97 1631,-11431.32 1631,-11431.32"/>
<polygon fill="black" stroke="black" points="1634.5,-11431.32 1631,-11421.32 1627.5,-11431.32 1634.5,-11431.32"/>
</g>
<!-- out_proj_10 -->
<g id="node193" class="node">
<title>out_proj_10</title>
<path fill="lightgreen" stroke="black" d="M1711.5,-11295C1711.5,-11295 1560.5,-11295 1560.5,-11295 1554.5,-11295 1548.5,-11289 1548.5,-11283 1548.5,-11283 1548.5,-11239 1548.5,-11239 1548.5,-11233 1554.5,-11227 1560.5,-11227 1560.5,-11227 1711.5,-11227 1711.5,-11227 1717.5,-11227 1723.5,-11233 1723.5,-11239 1723.5,-11239 1723.5,-11283 1723.5,-11283 1723.5,-11289 1717.5,-11295 1711.5,-11295"/>
<text text-anchor="middle" x="1636" y="-11279.8" font-family="Arial" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="1636" y="-11264.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1636" y="-11249.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1636" y="-11234.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- attn_comp_10&#45;&gt;out_proj_10 -->
<g id="edge237" class="edge">
<title>attn_comp_10&#45;&gt;out_proj_10</title>
<path fill="none" stroke="black" d="M1632.75,-11367.81C1632.75,-11367.81 1632.75,-11305.26 1632.75,-11305.26"/>
<polygon fill="black" stroke="black" points="1636.25,-11305.26 1632.75,-11295.26 1629.25,-11305.26 1636.25,-11305.26"/>
</g>
<!-- allreduce_attn_10 -->
<g id="node194" class="node">
<title>allreduce_attn_10</title>
<path fill="lightcoral" stroke="black" d="M1711.5,-11154C1711.5,-11154 1578.5,-11154 1578.5,-11154 1572.5,-11154 1566.5,-11148 1566.5,-11142 1566.5,-11142 1566.5,-11128 1566.5,-11128 1566.5,-11122 1572.5,-11116 1578.5,-11116 1578.5,-11116 1711.5,-11116 1711.5,-11116 1717.5,-11116 1723.5,-11122 1723.5,-11128 1723.5,-11128 1723.5,-11142 1723.5,-11142 1723.5,-11148 1717.5,-11154 1711.5,-11154"/>
<text text-anchor="middle" x="1645" y="-11138.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1645" y="-11123.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- out_proj_10&#45;&gt;allreduce_attn_10 -->
<g id="edge238" class="edge">
<title>out_proj_10&#45;&gt;allreduce_attn_10</title>
<path fill="none" stroke="black" d="M1645,-11226.9C1645,-11226.9 1645,-11164.24 1645,-11164.24"/>
<polygon fill="black" stroke="black" points="1648.5,-11164.24 1645,-11154.24 1641.5,-11164.24 1648.5,-11164.24"/>
</g>
<!-- residual1_10 -->
<g id="node211" class="node">
<title>residual1_10</title>
<path fill="lightgray" stroke="black" d="M1812.5,-11043C1812.5,-11043 1679.5,-11043 1679.5,-11043 1673.5,-11043 1667.5,-11037 1667.5,-11031 1667.5,-11031 1667.5,-11017 1667.5,-11017 1667.5,-11011 1673.5,-11005 1679.5,-11005 1679.5,-11005 1812.5,-11005 1812.5,-11005 1818.5,-11005 1824.5,-11011 1824.5,-11017 1824.5,-11017 1824.5,-11031 1824.5,-11031 1824.5,-11037 1818.5,-11043 1812.5,-11043"/>
<text text-anchor="middle" x="1746" y="-11027.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1746" y="-11012.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_attn_10&#45;&gt;residual1_10 -->
<g id="edge262" class="edge">
<title>allreduce_attn_10&#45;&gt;residual1_10</title>
<path fill="none" stroke="black" d="M1695.5,-11115.92C1695.5,-11115.92 1695.5,-11053.2 1695.5,-11053.2"/>
<polygon fill="black" stroke="black" points="1699,-11053.2 1695.5,-11043.2 1692,-11053.2 1699,-11053.2"/>
</g>
<!-- dense_h_4h_10 -->
<g id="node195" class="node">
<title>dense_h_4h_10</title>
<path fill="lightblue" stroke="black" d="M1780.5,-10815C1780.5,-10815 1601.5,-10815 1601.5,-10815 1595.5,-10815 1589.5,-10809 1589.5,-10803 1589.5,-10803 1589.5,-10759 1589.5,-10759 1589.5,-10753 1595.5,-10747 1601.5,-10747 1601.5,-10747 1780.5,-10747 1780.5,-10747 1786.5,-10747 1792.5,-10753 1792.5,-10759 1792.5,-10759 1792.5,-10803 1792.5,-10803 1792.5,-10809 1786.5,-10815 1780.5,-10815"/>
<text text-anchor="middle" x="1691" y="-10799.8" font-family="Arial" font-size="14.00">Dense H→4H</text>
<text text-anchor="middle" x="1691" y="-10784.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1691" y="-10769.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
<text text-anchor="middle" x="1691" y="-10754.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- expert_gate_10 -->
<g id="node196" class="node">
<title>expert_gate_10</title>
<path fill="lightpink" stroke="black" d="M1101,-10674C1101,-10674 953,-10674 953,-10674 947,-10674 941,-10668 941,-10662 941,-10662 941,-10633 941,-10633 941,-10627 947,-10621 953,-10621 953,-10621 1101,-10621 1101,-10621 1107,-10621 1113,-10627 1113,-10633 1113,-10633 1113,-10662 1113,-10662 1113,-10668 1107,-10674 1101,-10674"/>
<text text-anchor="middle" x="1027" y="-10658.8" font-family="Arial" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1027" y="-10643.8" font-family="Arial" font-size="14.00">[1024, seq_len, 8 experts]</text>
<text text-anchor="middle" x="1027" y="-10628.8" font-family="Arial" font-size="14.00">Top&#45;2 routing</text>
</g>
<!-- dense_h_4h_10&#45;&gt;expert_gate_10 -->
<g id="edge239" class="edge">
<title>dense_h_4h_10&#45;&gt;expert_gate_10</title>
<path fill="none" stroke="black" d="M1597.75,-10746.87C1597.75,-10712.02 1597.75,-10663 1597.75,-10663 1597.75,-10663 1123.07,-10663 1123.07,-10663"/>
<polygon fill="black" stroke="black" points="1123.07,-10659.5 1113.07,-10663 1123.06,-10666.5 1123.07,-10659.5"/>
</g>
<!-- expert_10_0 -->
<g id="node197" class="node">
<title>expert_10_0</title>
<path fill="lightsteelblue" stroke="black" d="M206,-10548C206,-10548 40,-10548 40,-10548 34,-10548 28,-10542 28,-10536 28,-10536 28,-10492 28,-10492 28,-10486 34,-10480 40,-10480 40,-10480 206,-10480 206,-10480 212,-10480 218,-10486 218,-10492 218,-10492 218,-10536 218,-10536 218,-10542 212,-10548 206,-10548"/>
<text text-anchor="middle" x="123" y="-10532.8" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="123" y="-10517.8" font-family="Arial" font-size="14.00">GPU 10</text>
<text text-anchor="middle" x="123" y="-10502.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="123" y="-10487.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_10&#45;&gt;expert_10_0 -->
<g id="edge240" class="edge">
<title>expert_gate_10&#45;&gt;expert_10_0</title>
<path fill="none" stroke="black" d="M940.69,-10663C729.9,-10663 206,-10663 206,-10663 206,-10663 206,-10558.18 206,-10558.18"/>
<polygon fill="black" stroke="black" points="209.5,-10558.18 206,-10548.18 202.5,-10558.18 209.5,-10558.18"/>
</g>
<!-- expert_10_1 -->
<g id="node198" class="node">
<title>expert_10_1</title>
<path fill="lightsteelblue" stroke="black" d="M432,-10548C432,-10548 266,-10548 266,-10548 260,-10548 254,-10542 254,-10536 254,-10536 254,-10492 254,-10492 254,-10486 260,-10480 266,-10480 266,-10480 432,-10480 432,-10480 438,-10480 444,-10486 444,-10492 444,-10492 444,-10536 444,-10536 444,-10542 438,-10548 432,-10548"/>
<text text-anchor="middle" x="349" y="-10532.8" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="349" y="-10517.8" font-family="Arial" font-size="14.00">GPU 11</text>
<text text-anchor="middle" x="349" y="-10502.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="349" y="-10487.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_10&#45;&gt;expert_10_1 -->
<g id="edge241" class="edge">
<title>expert_gate_10&#45;&gt;expert_10_1</title>
<path fill="none" stroke="black" d="M940.8,-10652C775.9,-10652 432,-10652 432,-10652 432,-10652 432,-10558.11 432,-10558.11"/>
<polygon fill="black" stroke="black" points="435.5,-10558.11 432,-10548.11 428.5,-10558.11 435.5,-10558.11"/>
</g>
<!-- expert_10_2 -->
<g id="node199" class="node">
<title>expert_10_2</title>
<path fill="lightsteelblue" stroke="black" d="M658,-10548C658,-10548 492,-10548 492,-10548 486,-10548 480,-10542 480,-10536 480,-10536 480,-10492 480,-10492 480,-10486 486,-10480 492,-10480 492,-10480 658,-10480 658,-10480 664,-10480 670,-10486 670,-10492 670,-10492 670,-10536 670,-10536 670,-10542 664,-10548 658,-10548"/>
<text text-anchor="middle" x="575" y="-10532.8" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="575" y="-10517.8" font-family="Arial" font-size="14.00">GPU 12</text>
<text text-anchor="middle" x="575" y="-10502.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="575" y="-10487.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_10&#45;&gt;expert_10_2 -->
<g id="edge242" class="edge">
<title>expert_gate_10&#45;&gt;expert_10_2</title>
<path fill="none" stroke="black" d="M940.95,-10642C831.92,-10642 658,-10642 658,-10642 658,-10642 658,-10558.3 658,-10558.3"/>
<polygon fill="black" stroke="black" points="661.5,-10558.3 658,-10548.3 654.5,-10558.3 661.5,-10558.3"/>
</g>
<!-- expert_10_3 -->
<g id="node200" class="node">
<title>expert_10_3</title>
<path fill="lightsteelblue" stroke="black" d="M884,-10548C884,-10548 718,-10548 718,-10548 712,-10548 706,-10542 706,-10536 706,-10536 706,-10492 706,-10492 706,-10486 712,-10480 718,-10480 718,-10480 884,-10480 884,-10480 890,-10480 896,-10486 896,-10492 896,-10492 896,-10536 896,-10536 896,-10542 890,-10548 884,-10548"/>
<text text-anchor="middle" x="801" y="-10532.8" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="801" y="-10517.8" font-family="Arial" font-size="14.00">GPU 13</text>
<text text-anchor="middle" x="801" y="-10502.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="801" y="-10487.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_10&#45;&gt;expert_10_3 -->
<g id="edge243" class="edge">
<title>expert_gate_10&#45;&gt;expert_10_3</title>
<path fill="none" stroke="black" d="M940.93,-10631C910.64,-10631 884,-10631 884,-10631 884,-10631 884,-10558.16 884,-10558.16"/>
<polygon fill="black" stroke="black" points="887.5,-10558.16 884,-10548.16 880.5,-10558.16 887.5,-10558.16"/>
</g>
<!-- expert_10_4 -->
<g id="node201" class="node">
<title>expert_10_4</title>
<path fill="lightsteelblue" stroke="black" d="M1110,-10548C1110,-10548 944,-10548 944,-10548 938,-10548 932,-10542 932,-10536 932,-10536 932,-10492 932,-10492 932,-10486 938,-10480 944,-10480 944,-10480 1110,-10480 1110,-10480 1116,-10480 1122,-10486 1122,-10492 1122,-10492 1122,-10536 1122,-10536 1122,-10542 1116,-10548 1110,-10548"/>
<text text-anchor="middle" x="1027" y="-10532.8" font-family="Arial" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1027" y="-10517.8" font-family="Arial" font-size="14.00">GPU 14</text>
<text text-anchor="middle" x="1027" y="-10502.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1027" y="-10487.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_10&#45;&gt;expert_10_4 -->
<g id="edge244" class="edge">
<title>expert_gate_10&#45;&gt;expert_10_4</title>
<path fill="none" stroke="black" d="M1027,-10620.81C1027,-10620.81 1027,-10558.26 1027,-10558.26"/>
<polygon fill="black" stroke="black" points="1030.5,-10558.26 1027,-10548.26 1023.5,-10558.26 1030.5,-10558.26"/>
</g>
<!-- expert_10_5 -->
<g id="node202" class="node">
<title>expert_10_5</title>
<path fill="lightsteelblue" stroke="black" d="M1336,-10548C1336,-10548 1170,-10548 1170,-10548 1164,-10548 1158,-10542 1158,-10536 1158,-10536 1158,-10492 1158,-10492 1158,-10486 1164,-10480 1170,-10480 1170,-10480 1336,-10480 1336,-10480 1342,-10480 1348,-10486 1348,-10492 1348,-10492 1348,-10536 1348,-10536 1348,-10542 1342,-10548 1336,-10548"/>
<text text-anchor="middle" x="1253" y="-10532.8" font-family="Arial" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1253" y="-10517.8" font-family="Arial" font-size="14.00">GPU 15</text>
<text text-anchor="middle" x="1253" y="-10502.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1253" y="-10487.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_10&#45;&gt;expert_10_5 -->
<g id="edge245" class="edge">
<title>expert_gate_10&#45;&gt;expert_10_5</title>
<path fill="none" stroke="black" d="M1113,-10631C1164.19,-10631 1219.25,-10631 1219.25,-10631 1219.25,-10631 1219.25,-10558.16 1219.25,-10558.16"/>
<polygon fill="black" stroke="black" points="1222.75,-10558.16 1219.25,-10548.16 1215.75,-10558.16 1222.75,-10558.16"/>
</g>
<!-- expert_10_6 -->
<g id="node203" class="node">
<title>expert_10_6</title>
<path fill="lightsteelblue" stroke="black" d="M1562,-10548C1562,-10548 1396,-10548 1396,-10548 1390,-10548 1384,-10542 1384,-10536 1384,-10536 1384,-10492 1384,-10492 1384,-10486 1390,-10480 1396,-10480 1396,-10480 1562,-10480 1562,-10480 1568,-10480 1574,-10486 1574,-10492 1574,-10492 1574,-10536 1574,-10536 1574,-10542 1568,-10548 1562,-10548"/>
<text text-anchor="middle" x="1479" y="-10532.8" font-family="Arial" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="1479" y="-10517.8" font-family="Arial" font-size="14.00">GPU 0</text>
<text text-anchor="middle" x="1479" y="-10502.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1479" y="-10487.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_10&#45;&gt;expert_10_6 -->
<g id="edge246" class="edge">
<title>expert_gate_10&#45;&gt;expert_10_6</title>
<path fill="none" stroke="black" d="M1113.45,-10642C1221.88,-10642 1393.75,-10642 1393.75,-10642 1393.75,-10642 1393.75,-10558.3 1393.75,-10558.3"/>
<polygon fill="black" stroke="black" points="1397.25,-10558.3 1393.75,-10548.3 1390.25,-10558.3 1397.25,-10558.3"/>
</g>
<!-- expert_10_7 -->
<g id="node204" class="node">
<title>expert_10_7</title>
<path fill="lightsteelblue" stroke="black" d="M1788,-10548C1788,-10548 1622,-10548 1622,-10548 1616,-10548 1610,-10542 1610,-10536 1610,-10536 1610,-10492 1610,-10492 1610,-10486 1616,-10480 1622,-10480 1622,-10480 1788,-10480 1788,-10480 1794,-10480 1800,-10486 1800,-10492 1800,-10492 1800,-10536 1800,-10536 1800,-10542 1794,-10548 1788,-10548"/>
<text text-anchor="middle" x="1705" y="-10532.8" font-family="Arial" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="1705" y="-10517.8" font-family="Arial" font-size="14.00">GPU 1</text>
<text text-anchor="middle" x="1705" y="-10502.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1705" y="-10487.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_10&#45;&gt;expert_10_7 -->
<g id="edge247" class="edge">
<title>expert_gate_10&#45;&gt;expert_10_7</title>
<path fill="none" stroke="black" d="M1113.08,-10652C1294.85,-10652 1701.25,-10652 1701.25,-10652 1701.25,-10652 1701.25,-10558.11 1701.25,-10558.11"/>
<polygon fill="black" stroke="black" points="1704.75,-10558.11 1701.25,-10548.11 1697.75,-10558.11 1704.75,-10558.11"/>
</g>
<!-- expert_agg_10 -->
<g id="node205" class="node">
<title>expert_agg_10</title>
<path fill="lightsalmon" stroke="black" d="M1102.5,-10407C1102.5,-10407 951.5,-10407 951.5,-10407 945.5,-10407 939.5,-10401 939.5,-10395 939.5,-10395 939.5,-10366 939.5,-10366 939.5,-10360 945.5,-10354 951.5,-10354 951.5,-10354 1102.5,-10354 1102.5,-10354 1108.5,-10354 1114.5,-10360 1114.5,-10366 1114.5,-10366 1114.5,-10395 1114.5,-10395 1114.5,-10401 1108.5,-10407 1102.5,-10407"/>
<text text-anchor="middle" x="1027" y="-10391.8" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1027" y="-10376.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1027" y="-10361.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- expert_10_0&#45;&gt;expert_agg_10 -->
<g id="edge248" class="edge">
<title>expert_10_0&#45;&gt;expert_agg_10</title>
<path fill="none" stroke="black" d="M152,-10479.96C152,-10435.71 152,-10364 152,-10364 152,-10364 929.5,-10364 929.5,-10364"/>
<polygon fill="black" stroke="black" points="929.5,-10367.5 939.5,-10364 929.5,-10360.5 929.5,-10367.5"/>
</g>
<!-- expert_10_1&#45;&gt;expert_agg_10 -->
<g id="edge249" class="edge">
<title>expert_10_1&#45;&gt;expert_agg_10</title>
<path fill="none" stroke="black" d="M378,-10480C378,-10438.85 378,-10375 378,-10375 378,-10375 929.47,-10375 929.47,-10375"/>
<polygon fill="black" stroke="black" points="929.47,-10378.5 939.47,-10375 929.47,-10371.5 929.47,-10378.5"/>
</g>
<!-- expert_10_2&#45;&gt;expert_agg_10 -->
<g id="edge250" class="edge">
<title>expert_10_2&#45;&gt;expert_agg_10</title>
<path fill="none" stroke="black" d="M604,-10479.77C604,-10441.55 604,-10385 604,-10385 604,-10385 929.35,-10385 929.35,-10385"/>
<polygon fill="black" stroke="black" points="929.35,-10388.5 939.35,-10385 929.35,-10381.5 929.35,-10388.5"/>
</g>
<!-- expert_10_3&#45;&gt;expert_agg_10 -->
<g id="edge251" class="edge">
<title>expert_10_3&#45;&gt;expert_agg_10</title>
<path fill="none" stroke="black" d="M830,-10479.87C830,-10445.02 830,-10396 830,-10396 830,-10396 929.45,-10396 929.45,-10396"/>
<polygon fill="black" stroke="black" points="929.45,-10399.5 939.45,-10396 929.45,-10392.5 929.45,-10399.5"/>
</g>
<!-- expert_10_4&#45;&gt;expert_agg_10 -->
<g id="edge252" class="edge">
<title>expert_10_4&#45;&gt;expert_agg_10</title>
<path fill="none" stroke="black" d="M1027,-10479.97C1027,-10479.97 1027,-10417.32 1027,-10417.32"/>
<polygon fill="black" stroke="black" points="1030.5,-10417.32 1027,-10407.32 1023.5,-10417.32 1030.5,-10417.32"/>
</g>
<!-- expert_10_5&#45;&gt;expert_agg_10 -->
<g id="edge253" class="edge">
<title>expert_10_5&#45;&gt;expert_agg_10</title>
<path fill="none" stroke="black" d="M1165.25,-10479.97C1165.25,-10444.18 1165.25,-10393 1165.25,-10393 1165.25,-10393 1124.56,-10393 1124.56,-10393"/>
<polygon fill="black" stroke="black" points="1124.56,-10389.5 1114.56,-10393 1124.56,-10396.5 1124.56,-10389.5"/>
</g>
<!-- expert_10_6&#45;&gt;expert_agg_10 -->
<g id="edge254" class="edge">
<title>expert_10_6&#45;&gt;expert_agg_10</title>
<path fill="none" stroke="black" d="M1508,-10479.84C1508,-10440.14 1508,-10380 1508,-10380 1508,-10380 1124.66,-10380 1124.66,-10380"/>
<polygon fill="black" stroke="black" points="1124.66,-10376.5 1114.66,-10380 1124.66,-10383.5 1124.66,-10376.5"/>
</g>
<!-- expert_10_7&#45;&gt;expert_agg_10 -->
<g id="edge255" class="edge">
<title>expert_10_7&#45;&gt;expert_agg_10</title>
<path fill="none" stroke="black" d="M1734,-10479.91C1734,-10436.48 1734,-10367 1734,-10367 1734,-10367 1124.76,-10367 1124.76,-10367"/>
<polygon fill="black" stroke="black" points="1124.76,-10363.5 1114.76,-10367 1124.76,-10370.5 1124.76,-10363.5"/>
</g>
<!-- activation_10 -->
<g id="node206" class="node">
<title>activation_10</title>
<path fill="lightyellow" stroke="black" d="M1129.5,-10281C1129.5,-10281 968.5,-10281 968.5,-10281 962.5,-10281 956.5,-10275 956.5,-10269 956.5,-10269 956.5,-10255 956.5,-10255 956.5,-10249 962.5,-10243 968.5,-10243 968.5,-10243 1129.5,-10243 1129.5,-10243 1135.5,-10243 1141.5,-10249 1141.5,-10255 1141.5,-10255 1141.5,-10269 1141.5,-10269 1141.5,-10275 1135.5,-10281 1129.5,-10281"/>
<text text-anchor="middle" x="1049" y="-10265.8" font-family="Arial" font-size="14.00">GELU</text>
<text text-anchor="middle" x="1049" y="-10250.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- expert_agg_10&#45;&gt;activation_10 -->
<g id="edge256" class="edge">
<title>expert_agg_10&#45;&gt;activation_10</title>
<path fill="none" stroke="black" d="M1035.5,-10353.91C1035.5,-10353.91 1035.5,-10291.13 1035.5,-10291.13"/>
<polygon fill="black" stroke="black" points="1039,-10291.13 1035.5,-10281.13 1032,-10291.13 1039,-10291.13"/>
</g>
<!-- dense_4h_h_10 -->
<g id="node207" class="node">
<title>dense_4h_h_10</title>
<path fill="lightblue" stroke="black" d="M1160.5,-10170C1160.5,-10170 999.5,-10170 999.5,-10170 993.5,-10170 987.5,-10164 987.5,-10158 987.5,-10158 987.5,-10114 987.5,-10114 987.5,-10108 993.5,-10102 999.5,-10102 999.5,-10102 1160.5,-10102 1160.5,-10102 1166.5,-10102 1172.5,-10108 1172.5,-10114 1172.5,-10114 1172.5,-10158 1172.5,-10158 1172.5,-10164 1166.5,-10170 1160.5,-10170"/>
<text text-anchor="middle" x="1080" y="-10154.8" font-family="Arial" font-size="14.00">Dense 4H→H</text>
<text text-anchor="middle" x="1080" y="-10139.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1080" y="-10124.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1080" y="-10109.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- activation_10&#45;&gt;dense_4h_h_10 -->
<g id="edge257" class="edge">
<title>activation_10&#45;&gt;dense_4h_h_10</title>
<path fill="none" stroke="black" d="M1064.5,-10242.86C1064.5,-10242.86 1064.5,-10180.07 1064.5,-10180.07"/>
<polygon fill="black" stroke="black" points="1068,-10180.07 1064.5,-10170.07 1061,-10180.07 1068,-10180.07"/>
</g>
<!-- allreduce_mlp_10 -->
<g id="node208" class="node">
<title>allreduce_mlp_10</title>
<path fill="lightcoral" stroke="black" d="M1150.5,-10029C1150.5,-10029 1017.5,-10029 1017.5,-10029 1011.5,-10029 1005.5,-10023 1005.5,-10017 1005.5,-10017 1005.5,-10003 1005.5,-10003 1005.5,-9997 1011.5,-9991 1017.5,-9991 1017.5,-9991 1150.5,-9991 1150.5,-9991 1156.5,-9991 1162.5,-9997 1162.5,-10003 1162.5,-10003 1162.5,-10017 1162.5,-10017 1162.5,-10023 1156.5,-10029 1150.5,-10029"/>
<text text-anchor="middle" x="1084" y="-10013.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1084" y="-9998.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- dense_4h_h_10&#45;&gt;allreduce_mlp_10 -->
<g id="edge258" class="edge">
<title>dense_4h_h_10&#45;&gt;allreduce_mlp_10</title>
<path fill="none" stroke="black" d="M1084,-10101.9C1084,-10101.9 1084,-10039.24 1084,-10039.24"/>
<polygon fill="black" stroke="black" points="1087.5,-10039.24 1084,-10029.24 1080.5,-10039.24 1087.5,-10039.24"/>
</g>
<!-- residual2_10 -->
<g id="node213" class="node">
<title>residual2_10</title>
<path fill="lightgray" stroke="black" d="M1216.5,-9918C1216.5,-9918 1083.5,-9918 1083.5,-9918 1077.5,-9918 1071.5,-9912 1071.5,-9906 1071.5,-9906 1071.5,-9892 1071.5,-9892 1071.5,-9886 1077.5,-9880 1083.5,-9880 1083.5,-9880 1216.5,-9880 1216.5,-9880 1222.5,-9880 1228.5,-9886 1228.5,-9892 1228.5,-9892 1228.5,-9906 1228.5,-9906 1228.5,-9912 1222.5,-9918 1216.5,-9918"/>
<text text-anchor="middle" x="1150" y="-9902.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1150" y="-9887.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_mlp_10&#45;&gt;residual2_10 -->
<g id="edge266" class="edge">
<title>allreduce_mlp_10&#45;&gt;residual2_10</title>
<path fill="none" stroke="black" d="M1117,-9990.92C1117,-9990.92 1117,-9928.2 1117,-9928.2"/>
<polygon fill="black" stroke="black" points="1120.5,-9928.2 1117,-9918.2 1113.5,-9928.2 1120.5,-9928.2"/>
</g>
<!-- norm1_10 -->
<g id="node210" class="node">
<title>norm1_10</title>
<path fill="lightcyan" stroke="black" d="M1702.5,-11679C1702.5,-11679 1569.5,-11679 1569.5,-11679 1563.5,-11679 1557.5,-11673 1557.5,-11667 1557.5,-11667 1557.5,-11653 1557.5,-11653 1557.5,-11647 1563.5,-11641 1569.5,-11641 1569.5,-11641 1702.5,-11641 1702.5,-11641 1708.5,-11641 1714.5,-11647 1714.5,-11653 1714.5,-11653 1714.5,-11667 1714.5,-11667 1714.5,-11673 1708.5,-11679 1702.5,-11679"/>
<text text-anchor="middle" x="1636" y="-11663.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1636" y="-11648.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- input_10&#45;&gt;norm1_10 -->
<g id="edge259" class="edge">
<title>input_10&#45;&gt;norm1_10</title>
<path fill="none" stroke="black" d="M1657.25,-11755.2C1657.25,-11755.2 1657.25,-11689.05 1657.25,-11689.05"/>
<polygon fill="black" stroke="black" points="1660.75,-11689.05 1657.25,-11679.05 1653.75,-11689.05 1660.75,-11689.05"/>
</g>
<!-- input_10&#45;&gt;residual1_10 -->
<g id="edge260" class="edge">
<title>input_10&#45;&gt;residual1_10</title>
<path fill="none" stroke="black" d="M1773.75,-11756.4C1773.75,-11756.4 1773.75,-11053.31 1773.75,-11053.31"/>
<polygon fill="black" stroke="black" points="1777.25,-11053.31 1773.75,-11043.31 1770.25,-11053.31 1777.25,-11053.31"/>
</g>
<!-- norm1_10&#45;&gt;qkv_proj_10 -->
<g id="edge261" class="edge">
<title>norm1_10&#45;&gt;qkv_proj_10</title>
<path fill="none" stroke="black" d="M1636,-11640.81C1636,-11640.81 1636,-11572.06 1636,-11572.06"/>
<polygon fill="black" stroke="black" points="1639.5,-11572.06 1636,-11562.06 1632.5,-11572.06 1639.5,-11572.06"/>
</g>
<!-- norm2_10 -->
<g id="node212" class="node">
<title>norm2_10</title>
<path fill="lightcyan" stroke="black" d="M1773.5,-10932C1773.5,-10932 1640.5,-10932 1640.5,-10932 1634.5,-10932 1628.5,-10926 1628.5,-10920 1628.5,-10920 1628.5,-10906 1628.5,-10906 1628.5,-10900 1634.5,-10894 1640.5,-10894 1640.5,-10894 1773.5,-10894 1773.5,-10894 1779.5,-10894 1785.5,-10900 1785.5,-10906 1785.5,-10906 1785.5,-10920 1785.5,-10920 1785.5,-10926 1779.5,-10932 1773.5,-10932"/>
<text text-anchor="middle" x="1707" y="-10916.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1707" y="-10901.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual1_10&#45;&gt;norm2_10 -->
<g id="edge263" class="edge">
<title>residual1_10&#45;&gt;norm2_10</title>
<path fill="none" stroke="black" d="M1726.5,-11004.92C1726.5,-11004.92 1726.5,-10942.2 1726.5,-10942.2"/>
<polygon fill="black" stroke="black" points="1730,-10942.2 1726.5,-10932.2 1723,-10942.2 1730,-10942.2"/>
</g>
<!-- residual1_10&#45;&gt;residual2_10 -->
<g id="edge264" class="edge">
<title>residual1_10&#45;&gt;residual2_10</title>
<path fill="none" stroke="black" d="M1808.17,-11004.95C1808.17,-10857.11 1808.17,-9899 1808.17,-9899 1808.17,-9899 1238.74,-9899 1238.74,-9899"/>
<polygon fill="black" stroke="black" points="1238.74,-9895.5 1228.74,-9899 1238.74,-9902.5 1238.74,-9895.5"/>
</g>
<!-- norm2_10&#45;&gt;dense_h_4h_10 -->
<g id="edge265" class="edge">
<title>norm2_10&#45;&gt;dense_h_4h_10</title>
<path fill="none" stroke="black" d="M1707,-10893.81C1707,-10893.81 1707,-10825.06 1707,-10825.06"/>
<polygon fill="black" stroke="black" points="1710.5,-10825.06 1707,-10815.06 1703.5,-10825.06 1710.5,-10825.06"/>
</g>
<!-- output_10 -->
<g id="node214" class="node">
<title>output_10</title>
<ellipse fill="white" stroke="black" cx="1150" cy="-9780" rx="111" ry="27"/>
<text text-anchor="middle" x="1150" y="-9783.8" font-family="Arial" font-size="14.00">Layer 11 Output</text>
<text text-anchor="middle" x="1150" y="-9768.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual2_10&#45;&gt;output_10 -->
<g id="edge267" class="edge">
<title>residual2_10&#45;&gt;output_10</title>
<path fill="none" stroke="black" d="M1150,-9879.88C1150,-9879.88 1150,-9817.05 1150,-9817.05"/>
<polygon fill="black" stroke="black" points="1153.5,-9817.05 1150,-9807.05 1146.5,-9817.05 1153.5,-9817.05"/>
</g>
<!-- input_11 -->
<g id="node223" class="node">
<title>input_11</title>
<ellipse fill="white" stroke="black" cx="1150" cy="-9618" rx="111" ry="27"/>
<text text-anchor="middle" x="1150" y="-9621.8" font-family="Arial" font-size="14.00">Layer 12 Input</text>
<text text-anchor="middle" x="1150" y="-9606.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- output_10&#45;&gt;input_11 -->
<g id="edge388" class="edge">
<title>output_10&#45;&gt;input_11</title>
<path fill="none" stroke="red" stroke-width="2" stroke-dasharray="5,2" d="M1150,-9752.88C1150,-9752.88 1150,-9655.2 1150,-9655.2"/>
<polygon fill="red" stroke="red" stroke-width="2" points="1153.5,-9655.2 1150,-9645.2 1146.5,-9655.2 1153.5,-9655.2"/>
<text text-anchor="middle" x="1206" y="-9705.8" font-family="Times,serif" font-size="14.00">GPU&#45;to&#45;GPU</text>
<text text-anchor="middle" x="1206" y="-9690.8" font-family="Times,serif" font-size="14.00">Communication</text>
</g>
<!-- qkv_proj_11 -->
<g id="node215" class="node">
<title>qkv_proj_11</title>
<path fill="lightgreen" stroke="black" d="M1218.5,-9401C1218.5,-9401 1039.5,-9401 1039.5,-9401 1033.5,-9401 1027.5,-9395 1027.5,-9389 1027.5,-9389 1027.5,-9345 1027.5,-9345 1027.5,-9339 1033.5,-9333 1039.5,-9333 1039.5,-9333 1218.5,-9333 1218.5,-9333 1224.5,-9333 1230.5,-9339 1230.5,-9345 1230.5,-9345 1230.5,-9389 1230.5,-9389 1230.5,-9395 1224.5,-9401 1218.5,-9401"/>
<text text-anchor="middle" x="1129" y="-9385.8" font-family="Arial" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1129" y="-9370.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1129" y="-9355.8" font-family="Arial" font-size="14.00">[1024, seq_len, 3*hidden]</text>
<text text-anchor="middle" x="1129" y="-9340.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 3*hidden/tp]</text>
</g>
<!-- attn_comp_11 -->
<g id="node216" class="node">
<title>attn_comp_11</title>
<path fill="lightyellow" stroke="black" d="M1210,-9260C1210,-9260 1062,-9260 1062,-9260 1056,-9260 1050,-9254 1050,-9248 1050,-9248 1050,-9219 1050,-9219 1050,-9213 1056,-9207 1062,-9207 1062,-9207 1210,-9207 1210,-9207 1216,-9207 1222,-9213 1222,-9219 1222,-9219 1222,-9248 1222,-9248 1222,-9254 1216,-9260 1210,-9260"/>
<text text-anchor="middle" x="1136" y="-9244.8" font-family="Arial" font-size="14.00">Attention</text>
<text text-anchor="middle" x="1136" y="-9229.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1136" y="-9214.8" font-family="Arial" font-size="14.00">Heads: 2 per GPU</text>
</g>
<!-- qkv_proj_11&#45;&gt;attn_comp_11 -->
<g id="edge268" class="edge">
<title>qkv_proj_11&#45;&gt;attn_comp_11</title>
<path fill="none" stroke="black" d="M1136,-9332.97C1136,-9332.97 1136,-9270.32 1136,-9270.32"/>
<polygon fill="black" stroke="black" points="1139.5,-9270.32 1136,-9260.32 1132.5,-9270.32 1139.5,-9270.32"/>
</g>
<!-- out_proj_11 -->
<g id="node217" class="node">
<title>out_proj_11</title>
<path fill="lightgreen" stroke="black" d="M1216.5,-9134C1216.5,-9134 1065.5,-9134 1065.5,-9134 1059.5,-9134 1053.5,-9128 1053.5,-9122 1053.5,-9122 1053.5,-9078 1053.5,-9078 1053.5,-9072 1059.5,-9066 1065.5,-9066 1065.5,-9066 1216.5,-9066 1216.5,-9066 1222.5,-9066 1228.5,-9072 1228.5,-9078 1228.5,-9078 1228.5,-9122 1228.5,-9122 1228.5,-9128 1222.5,-9134 1216.5,-9134"/>
<text text-anchor="middle" x="1141" y="-9118.8" font-family="Arial" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="1141" y="-9103.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1141" y="-9088.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1141" y="-9073.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- attn_comp_11&#45;&gt;out_proj_11 -->
<g id="edge269" class="edge">
<title>attn_comp_11&#45;&gt;out_proj_11</title>
<path fill="none" stroke="black" d="M1137.75,-9206.81C1137.75,-9206.81 1137.75,-9144.26 1137.75,-9144.26"/>
<polygon fill="black" stroke="black" points="1141.25,-9144.26 1137.75,-9134.26 1134.25,-9144.26 1141.25,-9144.26"/>
</g>
<!-- allreduce_attn_11 -->
<g id="node218" class="node">
<title>allreduce_attn_11</title>
<path fill="lightcoral" stroke="black" d="M1216.5,-8993C1216.5,-8993 1083.5,-8993 1083.5,-8993 1077.5,-8993 1071.5,-8987 1071.5,-8981 1071.5,-8981 1071.5,-8967 1071.5,-8967 1071.5,-8961 1077.5,-8955 1083.5,-8955 1083.5,-8955 1216.5,-8955 1216.5,-8955 1222.5,-8955 1228.5,-8961 1228.5,-8967 1228.5,-8967 1228.5,-8981 1228.5,-8981 1228.5,-8987 1222.5,-8993 1216.5,-8993"/>
<text text-anchor="middle" x="1150" y="-8977.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1150" y="-8962.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- out_proj_11&#45;&gt;allreduce_attn_11 -->
<g id="edge270" class="edge">
<title>out_proj_11&#45;&gt;allreduce_attn_11</title>
<path fill="none" stroke="black" d="M1150,-9065.9C1150,-9065.9 1150,-9003.24 1150,-9003.24"/>
<polygon fill="black" stroke="black" points="1153.5,-9003.24 1150,-8993.24 1146.5,-9003.24 1153.5,-9003.24"/>
</g>
<!-- residual1_11 -->
<g id="node225" class="node">
<title>residual1_11</title>
<path fill="lightgray" stroke="black" d="M1237.5,-8882C1237.5,-8882 1104.5,-8882 1104.5,-8882 1098.5,-8882 1092.5,-8876 1092.5,-8870 1092.5,-8870 1092.5,-8856 1092.5,-8856 1092.5,-8850 1098.5,-8844 1104.5,-8844 1104.5,-8844 1237.5,-8844 1237.5,-8844 1243.5,-8844 1249.5,-8850 1249.5,-8856 1249.5,-8856 1249.5,-8870 1249.5,-8870 1249.5,-8876 1243.5,-8882 1237.5,-8882"/>
<text text-anchor="middle" x="1171" y="-8866.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1171" y="-8851.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_attn_11&#45;&gt;residual1_11 -->
<g id="edge277" class="edge">
<title>allreduce_attn_11&#45;&gt;residual1_11</title>
<path fill="none" stroke="black" d="M1160.5,-8954.92C1160.5,-8954.92 1160.5,-8892.2 1160.5,-8892.2"/>
<polygon fill="black" stroke="black" points="1164,-8892.2 1160.5,-8882.2 1157,-8892.2 1164,-8892.2"/>
</g>
<!-- dense_h_4h_11 -->
<g id="node219" class="node">
<title>dense_h_4h_11</title>
<path fill="lightblue" stroke="black" d="M1218.5,-8654C1218.5,-8654 1039.5,-8654 1039.5,-8654 1033.5,-8654 1027.5,-8648 1027.5,-8642 1027.5,-8642 1027.5,-8598 1027.5,-8598 1027.5,-8592 1033.5,-8586 1039.5,-8586 1039.5,-8586 1218.5,-8586 1218.5,-8586 1224.5,-8586 1230.5,-8592 1230.5,-8598 1230.5,-8598 1230.5,-8642 1230.5,-8642 1230.5,-8648 1224.5,-8654 1218.5,-8654"/>
<text text-anchor="middle" x="1129" y="-8638.8" font-family="Arial" font-size="14.00">Dense H→4H</text>
<text text-anchor="middle" x="1129" y="-8623.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1129" y="-8608.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
<text text-anchor="middle" x="1129" y="-8593.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- activation_11 -->
<g id="node220" class="node">
<title>activation_11</title>
<path fill="lightyellow" stroke="black" d="M1210.5,-8513C1210.5,-8513 1049.5,-8513 1049.5,-8513 1043.5,-8513 1037.5,-8507 1037.5,-8501 1037.5,-8501 1037.5,-8487 1037.5,-8487 1037.5,-8481 1043.5,-8475 1049.5,-8475 1049.5,-8475 1210.5,-8475 1210.5,-8475 1216.5,-8475 1222.5,-8481 1222.5,-8487 1222.5,-8487 1222.5,-8501 1222.5,-8501 1222.5,-8507 1216.5,-8513 1210.5,-8513"/>
<text text-anchor="middle" x="1130" y="-8497.8" font-family="Arial" font-size="14.00">GELU</text>
<text text-anchor="middle" x="1130" y="-8482.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- dense_h_4h_11&#45;&gt;activation_11 -->
<g id="edge271" class="edge">
<title>dense_h_4h_11&#45;&gt;activation_11</title>
<path fill="none" stroke="black" d="M1130,-8585.9C1130,-8585.9 1130,-8523.24 1130,-8523.24"/>
<polygon fill="black" stroke="black" points="1133.5,-8523.24 1130,-8513.24 1126.5,-8523.24 1133.5,-8523.24"/>
</g>
<!-- dense_4h_h_11 -->
<g id="node221" class="node">
<title>dense_4h_h_11</title>
<path fill="lightblue" stroke="black" d="M1210.5,-8402C1210.5,-8402 1049.5,-8402 1049.5,-8402 1043.5,-8402 1037.5,-8396 1037.5,-8390 1037.5,-8390 1037.5,-8346 1037.5,-8346 1037.5,-8340 1043.5,-8334 1049.5,-8334 1049.5,-8334 1210.5,-8334 1210.5,-8334 1216.5,-8334 1222.5,-8340 1222.5,-8346 1222.5,-8346 1222.5,-8390 1222.5,-8390 1222.5,-8396 1216.5,-8402 1210.5,-8402"/>
<text text-anchor="middle" x="1130" y="-8386.8" font-family="Arial" font-size="14.00">Dense 4H→H</text>
<text text-anchor="middle" x="1130" y="-8371.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1130" y="-8356.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1130" y="-8341.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- activation_11&#45;&gt;dense_4h_h_11 -->
<g id="edge272" class="edge">
<title>activation_11&#45;&gt;dense_4h_h_11</title>
<path fill="none" stroke="black" d="M1130,-8474.86C1130,-8474.86 1130,-8412.07 1130,-8412.07"/>
<polygon fill="black" stroke="black" points="1133.5,-8412.07 1130,-8402.07 1126.5,-8412.07 1133.5,-8412.07"/>
</g>
<!-- allreduce_mlp_11 -->
<g id="node222" class="node">
<title>allreduce_mlp_11</title>
<path fill="lightcoral" stroke="black" d="M1196.5,-8261C1196.5,-8261 1063.5,-8261 1063.5,-8261 1057.5,-8261 1051.5,-8255 1051.5,-8249 1051.5,-8249 1051.5,-8235 1051.5,-8235 1051.5,-8229 1057.5,-8223 1063.5,-8223 1063.5,-8223 1196.5,-8223 1196.5,-8223 1202.5,-8223 1208.5,-8229 1208.5,-8235 1208.5,-8235 1208.5,-8249 1208.5,-8249 1208.5,-8255 1202.5,-8261 1196.5,-8261"/>
<text text-anchor="middle" x="1130" y="-8245.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1130" y="-8230.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- dense_4h_h_11&#45;&gt;allreduce_mlp_11 -->
<g id="edge273" class="edge">
<title>dense_4h_h_11&#45;&gt;allreduce_mlp_11</title>
<path fill="none" stroke="black" d="M1130,-8333.9C1130,-8333.9 1130,-8271.24 1130,-8271.24"/>
<polygon fill="black" stroke="black" points="1133.5,-8271.24 1130,-8261.24 1126.5,-8271.24 1133.5,-8271.24"/>
</g>
<!-- residual2_11 -->
<g id="node227" class="node">
<title>residual2_11</title>
<path fill="lightgray" stroke="black" d="M1197.5,-8150C1197.5,-8150 1064.5,-8150 1064.5,-8150 1058.5,-8150 1052.5,-8144 1052.5,-8138 1052.5,-8138 1052.5,-8124 1052.5,-8124 1052.5,-8118 1058.5,-8112 1064.5,-8112 1064.5,-8112 1197.5,-8112 1197.5,-8112 1203.5,-8112 1209.5,-8118 1209.5,-8124 1209.5,-8124 1209.5,-8138 1209.5,-8138 1209.5,-8144 1203.5,-8150 1197.5,-8150"/>
<text text-anchor="middle" x="1131" y="-8134.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1131" y="-8119.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_mlp_11&#45;&gt;residual2_11 -->
<g id="edge281" class="edge">
<title>allreduce_mlp_11&#45;&gt;residual2_11</title>
<path fill="none" stroke="black" d="M1130.5,-8222.92C1130.5,-8222.92 1130.5,-8160.2 1130.5,-8160.2"/>
<polygon fill="black" stroke="black" points="1134,-8160.2 1130.5,-8150.2 1127,-8160.2 1134,-8160.2"/>
</g>
<!-- norm1_11 -->
<g id="node224" class="node">
<title>norm1_11</title>
<path fill="lightcyan" stroke="black" d="M1207.5,-9518C1207.5,-9518 1074.5,-9518 1074.5,-9518 1068.5,-9518 1062.5,-9512 1062.5,-9506 1062.5,-9506 1062.5,-9492 1062.5,-9492 1062.5,-9486 1068.5,-9480 1074.5,-9480 1074.5,-9480 1207.5,-9480 1207.5,-9480 1213.5,-9480 1219.5,-9486 1219.5,-9492 1219.5,-9492 1219.5,-9506 1219.5,-9506 1219.5,-9512 1213.5,-9518 1207.5,-9518"/>
<text text-anchor="middle" x="1141" y="-9502.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1141" y="-9487.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- input_11&#45;&gt;norm1_11 -->
<g id="edge274" class="edge">
<title>input_11&#45;&gt;norm1_11</title>
<path fill="none" stroke="black" d="M1141,-9591C1141,-9591 1141,-9528.12 1141,-9528.12"/>
<polygon fill="black" stroke="black" points="1144.5,-9528.12 1141,-9518.12 1137.5,-9528.12 1144.5,-9528.12"/>
</g>
<!-- input_11&#45;&gt;residual1_11 -->
<g id="edge275" class="edge">
<title>input_11&#45;&gt;residual1_11</title>
<path fill="none" stroke="black" d="M1240,-9601.88C1240,-9601.88 1240,-8892.31 1240,-8892.31"/>
<polygon fill="black" stroke="black" points="1243.5,-8892.31 1240,-8882.31 1236.5,-8892.31 1243.5,-8892.31"/>
</g>
<!-- norm1_11&#45;&gt;qkv_proj_11 -->
<g id="edge276" class="edge">
<title>norm1_11&#45;&gt;qkv_proj_11</title>
<path fill="none" stroke="black" d="M1141,-9479.81C1141,-9479.81 1141,-9411.06 1141,-9411.06"/>
<polygon fill="black" stroke="black" points="1144.5,-9411.06 1141,-9401.06 1137.5,-9411.06 1144.5,-9411.06"/>
</g>
<!-- norm2_11 -->
<g id="node226" class="node">
<title>norm2_11</title>
<path fill="lightcyan" stroke="black" d="M1207.5,-8771C1207.5,-8771 1074.5,-8771 1074.5,-8771 1068.5,-8771 1062.5,-8765 1062.5,-8759 1062.5,-8759 1062.5,-8745 1062.5,-8745 1062.5,-8739 1068.5,-8733 1074.5,-8733 1074.5,-8733 1207.5,-8733 1207.5,-8733 1213.5,-8733 1219.5,-8739 1219.5,-8745 1219.5,-8745 1219.5,-8759 1219.5,-8759 1219.5,-8765 1213.5,-8771 1207.5,-8771"/>
<text text-anchor="middle" x="1141" y="-8755.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1141" y="-8740.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual1_11&#45;&gt;norm2_11 -->
<g id="edge278" class="edge">
<title>residual1_11&#45;&gt;norm2_11</title>
<path fill="none" stroke="black" d="M1156,-8843.92C1156,-8843.92 1156,-8781.2 1156,-8781.2"/>
<polygon fill="black" stroke="black" points="1159.5,-8781.2 1156,-8771.2 1152.5,-8781.2 1159.5,-8781.2"/>
</g>
<!-- residual1_11&#45;&gt;residual2_11 -->
<g id="edge279" class="edge">
<title>residual1_11&#45;&gt;residual2_11</title>
<path fill="none" stroke="black" d="M1236.25,-8843.8C1236.25,-8728.3 1236.25,-8131 1236.25,-8131 1236.25,-8131 1219.69,-8131 1219.69,-8131"/>
<polygon fill="black" stroke="black" points="1219.69,-8127.5 1209.69,-8131 1219.69,-8134.5 1219.69,-8127.5"/>
</g>
<!-- norm2_11&#45;&gt;dense_h_4h_11 -->
<g id="edge280" class="edge">
<title>norm2_11&#45;&gt;dense_h_4h_11</title>
<path fill="none" stroke="black" d="M1141,-8732.81C1141,-8732.81 1141,-8664.06 1141,-8664.06"/>
<polygon fill="black" stroke="black" points="1144.5,-8664.06 1141,-8654.06 1137.5,-8664.06 1144.5,-8664.06"/>
</g>
<!-- output_11 -->
<g id="node228" class="node">
<title>output_11</title>
<ellipse fill="white" stroke="black" cx="1131" cy="-8012" rx="111" ry="27"/>
<text text-anchor="middle" x="1131" y="-8015.8" font-family="Arial" font-size="14.00">Layer 12 Output</text>
<text text-anchor="middle" x="1131" y="-8000.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual2_11&#45;&gt;output_11 -->
<g id="edge282" class="edge">
<title>residual2_11&#45;&gt;output_11</title>
<path fill="none" stroke="black" d="M1131,-8111.88C1131,-8111.88 1131,-8049.05 1131,-8049.05"/>
<polygon fill="black" stroke="black" points="1134.5,-8049.05 1131,-8039.05 1127.5,-8049.05 1134.5,-8049.05"/>
</g>
<!-- input_12 -->
<g id="node247" class="node">
<title>input_12</title>
<ellipse fill="white" stroke="black" cx="1131" cy="-7850" rx="111" ry="27"/>
<text text-anchor="middle" x="1131" y="-7853.8" font-family="Arial" font-size="14.00">Layer 13 Input</text>
<text text-anchor="middle" x="1131" y="-7838.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- output_11&#45;&gt;input_12 -->
<g id="edge389" class="edge">
<title>output_11&#45;&gt;input_12</title>
<path fill="none" stroke="red" stroke-width="2" stroke-dasharray="5,2" d="M1131,-7984.88C1131,-7984.88 1131,-7887.2 1131,-7887.2"/>
<polygon fill="red" stroke="red" stroke-width="2" points="1134.5,-7887.2 1131,-7877.2 1127.5,-7887.2 1134.5,-7887.2"/>
<text text-anchor="middle" x="1187" y="-7937.8" font-family="Times,serif" font-size="14.00">GPU&#45;to&#45;GPU</text>
<text text-anchor="middle" x="1187" y="-7922.8" font-family="Times,serif" font-size="14.00">Communication</text>
</g>
<!-- qkv_proj_12 -->
<g id="node229" class="node">
<title>qkv_proj_12</title>
<path fill="lightgreen" stroke="black" d="M1089.5,-7633C1089.5,-7633 910.5,-7633 910.5,-7633 904.5,-7633 898.5,-7627 898.5,-7621 898.5,-7621 898.5,-7577 898.5,-7577 898.5,-7571 904.5,-7565 910.5,-7565 910.5,-7565 1089.5,-7565 1089.5,-7565 1095.5,-7565 1101.5,-7571 1101.5,-7577 1101.5,-7577 1101.5,-7621 1101.5,-7621 1101.5,-7627 1095.5,-7633 1089.5,-7633"/>
<text text-anchor="middle" x="1000" y="-7617.8" font-family="Arial" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1000" y="-7602.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1000" y="-7587.8" font-family="Arial" font-size="14.00">[1024, seq_len, 3*hidden]</text>
<text text-anchor="middle" x="1000" y="-7572.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 3*hidden/tp]</text>
</g>
<!-- attn_comp_12 -->
<g id="node230" class="node">
<title>attn_comp_12</title>
<path fill="lightyellow" stroke="black" d="M1081,-7492C1081,-7492 933,-7492 933,-7492 927,-7492 921,-7486 921,-7480 921,-7480 921,-7451 921,-7451 921,-7445 927,-7439 933,-7439 933,-7439 1081,-7439 1081,-7439 1087,-7439 1093,-7445 1093,-7451 1093,-7451 1093,-7480 1093,-7480 1093,-7486 1087,-7492 1081,-7492"/>
<text text-anchor="middle" x="1007" y="-7476.8" font-family="Arial" font-size="14.00">Attention</text>
<text text-anchor="middle" x="1007" y="-7461.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1007" y="-7446.8" font-family="Arial" font-size="14.00">Heads: 2 per GPU</text>
</g>
<!-- qkv_proj_12&#45;&gt;attn_comp_12 -->
<g id="edge283" class="edge">
<title>qkv_proj_12&#45;&gt;attn_comp_12</title>
<path fill="none" stroke="black" d="M1007,-7564.97C1007,-7564.97 1007,-7502.32 1007,-7502.32"/>
<polygon fill="black" stroke="black" points="1010.5,-7502.32 1007,-7492.32 1003.5,-7502.32 1010.5,-7502.32"/>
</g>
<!-- out_proj_12 -->
<g id="node231" class="node">
<title>out_proj_12</title>
<path fill="lightgreen" stroke="black" d="M1087.5,-7366C1087.5,-7366 936.5,-7366 936.5,-7366 930.5,-7366 924.5,-7360 924.5,-7354 924.5,-7354 924.5,-7310 924.5,-7310 924.5,-7304 930.5,-7298 936.5,-7298 936.5,-7298 1087.5,-7298 1087.5,-7298 1093.5,-7298 1099.5,-7304 1099.5,-7310 1099.5,-7310 1099.5,-7354 1099.5,-7354 1099.5,-7360 1093.5,-7366 1087.5,-7366"/>
<text text-anchor="middle" x="1012" y="-7350.8" font-family="Arial" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="1012" y="-7335.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1012" y="-7320.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1012" y="-7305.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- attn_comp_12&#45;&gt;out_proj_12 -->
<g id="edge284" class="edge">
<title>attn_comp_12&#45;&gt;out_proj_12</title>
<path fill="none" stroke="black" d="M1008.75,-7438.81C1008.75,-7438.81 1008.75,-7376.26 1008.75,-7376.26"/>
<polygon fill="black" stroke="black" points="1012.25,-7376.26 1008.75,-7366.26 1005.25,-7376.26 1012.25,-7376.26"/>
</g>
<!-- allreduce_attn_12 -->
<g id="node232" class="node">
<title>allreduce_attn_12</title>
<path fill="lightcoral" stroke="black" d="M1087.5,-7225C1087.5,-7225 954.5,-7225 954.5,-7225 948.5,-7225 942.5,-7219 942.5,-7213 942.5,-7213 942.5,-7199 942.5,-7199 942.5,-7193 948.5,-7187 954.5,-7187 954.5,-7187 1087.5,-7187 1087.5,-7187 1093.5,-7187 1099.5,-7193 1099.5,-7199 1099.5,-7199 1099.5,-7213 1099.5,-7213 1099.5,-7219 1093.5,-7225 1087.5,-7225"/>
<text text-anchor="middle" x="1021" y="-7209.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1021" y="-7194.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- out_proj_12&#45;&gt;allreduce_attn_12 -->
<g id="edge285" class="edge">
<title>out_proj_12&#45;&gt;allreduce_attn_12</title>
<path fill="none" stroke="black" d="M1021,-7297.9C1021,-7297.9 1021,-7235.24 1021,-7235.24"/>
<polygon fill="black" stroke="black" points="1024.5,-7235.24 1021,-7225.24 1017.5,-7235.24 1024.5,-7235.24"/>
</g>
<!-- residual1_12 -->
<g id="node249" class="node">
<title>residual1_12</title>
<path fill="lightgray" stroke="black" d="M1204.5,-7114C1204.5,-7114 1071.5,-7114 1071.5,-7114 1065.5,-7114 1059.5,-7108 1059.5,-7102 1059.5,-7102 1059.5,-7088 1059.5,-7088 1059.5,-7082 1065.5,-7076 1071.5,-7076 1071.5,-7076 1204.5,-7076 1204.5,-7076 1210.5,-7076 1216.5,-7082 1216.5,-7088 1216.5,-7088 1216.5,-7102 1216.5,-7102 1216.5,-7108 1210.5,-7114 1204.5,-7114"/>
<text text-anchor="middle" x="1138" y="-7098.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1138" y="-7083.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_attn_12&#45;&gt;residual1_12 -->
<g id="edge309" class="edge">
<title>allreduce_attn_12&#45;&gt;residual1_12</title>
<path fill="none" stroke="black" d="M1079.5,-7186.92C1079.5,-7186.92 1079.5,-7124.2 1079.5,-7124.2"/>
<polygon fill="black" stroke="black" points="1083,-7124.2 1079.5,-7114.2 1076,-7124.2 1083,-7124.2"/>
</g>
<!-- dense_h_4h_12 -->
<g id="node233" class="node">
<title>dense_h_4h_12</title>
<path fill="lightblue" stroke="black" d="M1133.5,-6886C1133.5,-6886 954.5,-6886 954.5,-6886 948.5,-6886 942.5,-6880 942.5,-6874 942.5,-6874 942.5,-6830 942.5,-6830 942.5,-6824 948.5,-6818 954.5,-6818 954.5,-6818 1133.5,-6818 1133.5,-6818 1139.5,-6818 1145.5,-6824 1145.5,-6830 1145.5,-6830 1145.5,-6874 1145.5,-6874 1145.5,-6880 1139.5,-6886 1133.5,-6886"/>
<text text-anchor="middle" x="1044" y="-6870.8" font-family="Arial" font-size="14.00">Dense H→4H</text>
<text text-anchor="middle" x="1044" y="-6855.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1044" y="-6840.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
<text text-anchor="middle" x="1044" y="-6825.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- expert_gate_12 -->
<g id="node234" class="node">
<title>expert_gate_12</title>
<path fill="lightpink" stroke="black" d="M1097,-6745C1097,-6745 949,-6745 949,-6745 943,-6745 937,-6739 937,-6733 937,-6733 937,-6704 937,-6704 937,-6698 943,-6692 949,-6692 949,-6692 1097,-6692 1097,-6692 1103,-6692 1109,-6698 1109,-6704 1109,-6704 1109,-6733 1109,-6733 1109,-6739 1103,-6745 1097,-6745"/>
<text text-anchor="middle" x="1023" y="-6729.8" font-family="Arial" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1023" y="-6714.8" font-family="Arial" font-size="14.00">[1024, seq_len, 8 experts]</text>
<text text-anchor="middle" x="1023" y="-6699.8" font-family="Arial" font-size="14.00">Top&#45;2 routing</text>
</g>
<!-- dense_h_4h_12&#45;&gt;expert_gate_12 -->
<g id="edge286" class="edge">
<title>dense_h_4h_12&#45;&gt;expert_gate_12</title>
<path fill="none" stroke="black" d="M1025.75,-6817.97C1025.75,-6817.97 1025.75,-6755.32 1025.75,-6755.32"/>
<polygon fill="black" stroke="black" points="1029.25,-6755.32 1025.75,-6745.32 1022.25,-6755.32 1029.25,-6755.32"/>
</g>
<!-- expert_12_0 -->
<g id="node235" class="node">
<title>expert_12_0</title>
<path fill="lightsteelblue" stroke="black" d="M202,-6619C202,-6619 36,-6619 36,-6619 30,-6619 24,-6613 24,-6607 24,-6607 24,-6563 24,-6563 24,-6557 30,-6551 36,-6551 36,-6551 202,-6551 202,-6551 208,-6551 214,-6557 214,-6563 214,-6563 214,-6607 214,-6607 214,-6613 208,-6619 202,-6619"/>
<text text-anchor="middle" x="119" y="-6603.8" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="119" y="-6588.8" font-family="Arial" font-size="14.00">GPU 12</text>
<text text-anchor="middle" x="119" y="-6573.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="119" y="-6558.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_12&#45;&gt;expert_12_0 -->
<g id="edge287" class="edge">
<title>expert_gate_12&#45;&gt;expert_12_0</title>
<path fill="none" stroke="black" d="M936.9,-6734C705.93,-6734 90,-6734 90,-6734 90,-6734 90,-6629.18 90,-6629.18"/>
<polygon fill="black" stroke="black" points="93.5,-6629.18 90,-6619.18 86.5,-6629.18 93.5,-6629.18"/>
</g>
<!-- expert_12_1 -->
<g id="node236" class="node">
<title>expert_12_1</title>
<path fill="lightsteelblue" stroke="black" d="M428,-6619C428,-6619 262,-6619 262,-6619 256,-6619 250,-6613 250,-6607 250,-6607 250,-6563 250,-6563 250,-6557 256,-6551 262,-6551 262,-6551 428,-6551 428,-6551 434,-6551 440,-6557 440,-6563 440,-6563 440,-6607 440,-6607 440,-6613 434,-6619 428,-6619"/>
<text text-anchor="middle" x="345" y="-6603.8" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="345" y="-6588.8" font-family="Arial" font-size="14.00">GPU 13</text>
<text text-anchor="middle" x="345" y="-6573.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="345" y="-6558.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_12&#45;&gt;expert_12_1 -->
<g id="edge288" class="edge">
<title>expert_gate_12&#45;&gt;expert_12_1</title>
<path fill="none" stroke="black" d="M936.66,-6723C748.06,-6723 316,-6723 316,-6723 316,-6723 316,-6629.11 316,-6629.11"/>
<polygon fill="black" stroke="black" points="319.5,-6629.11 316,-6619.11 312.5,-6629.11 319.5,-6629.11"/>
</g>
<!-- expert_12_2 -->
<g id="node237" class="node">
<title>expert_12_2</title>
<path fill="lightsteelblue" stroke="black" d="M654,-6619C654,-6619 488,-6619 488,-6619 482,-6619 476,-6613 476,-6607 476,-6607 476,-6563 476,-6563 476,-6557 482,-6551 488,-6551 488,-6551 654,-6551 654,-6551 660,-6551 666,-6557 666,-6563 666,-6563 666,-6607 666,-6607 666,-6613 660,-6619 654,-6619"/>
<text text-anchor="middle" x="571" y="-6603.8" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="571" y="-6588.8" font-family="Arial" font-size="14.00">GPU 14</text>
<text text-anchor="middle" x="571" y="-6573.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="571" y="-6558.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_12&#45;&gt;expert_12_2 -->
<g id="edge289" class="edge">
<title>expert_gate_12&#45;&gt;expert_12_2</title>
<path fill="none" stroke="black" d="M936.73,-6713C798.31,-6713 542,-6713 542,-6713 542,-6713 542,-6629.3 542,-6629.3"/>
<polygon fill="black" stroke="black" points="545.5,-6629.3 542,-6619.3 538.5,-6629.3 545.5,-6629.3"/>
</g>
<!-- expert_12_3 -->
<g id="node238" class="node">
<title>expert_12_3</title>
<path fill="lightsteelblue" stroke="black" d="M880,-6619C880,-6619 714,-6619 714,-6619 708,-6619 702,-6613 702,-6607 702,-6607 702,-6563 702,-6563 702,-6557 708,-6551 714,-6551 714,-6551 880,-6551 880,-6551 886,-6551 892,-6557 892,-6563 892,-6563 892,-6607 892,-6607 892,-6613 886,-6619 880,-6619"/>
<text text-anchor="middle" x="797" y="-6603.8" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="797" y="-6588.8" font-family="Arial" font-size="14.00">GPU 15</text>
<text text-anchor="middle" x="797" y="-6573.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="797" y="-6558.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_12&#45;&gt;expert_12_3 -->
<g id="edge290" class="edge">
<title>expert_gate_12&#45;&gt;expert_12_3</title>
<path fill="none" stroke="black" d="M936.67,-6702C862.69,-6702 768,-6702 768,-6702 768,-6702 768,-6629.16 768,-6629.16"/>
<polygon fill="black" stroke="black" points="771.5,-6629.16 768,-6619.16 764.5,-6629.16 771.5,-6629.16"/>
</g>
<!-- expert_12_4 -->
<g id="node239" class="node">
<title>expert_12_4</title>
<path fill="lightsteelblue" stroke="black" d="M1106,-6619C1106,-6619 940,-6619 940,-6619 934,-6619 928,-6613 928,-6607 928,-6607 928,-6563 928,-6563 928,-6557 934,-6551 940,-6551 940,-6551 1106,-6551 1106,-6551 1112,-6551 1118,-6557 1118,-6563 1118,-6563 1118,-6607 1118,-6607 1118,-6613 1112,-6619 1106,-6619"/>
<text text-anchor="middle" x="1023" y="-6603.8" font-family="Arial" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1023" y="-6588.8" font-family="Arial" font-size="14.00">GPU 0</text>
<text text-anchor="middle" x="1023" y="-6573.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1023" y="-6558.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_12&#45;&gt;expert_12_4 -->
<g id="edge291" class="edge">
<title>expert_gate_12&#45;&gt;expert_12_4</title>
<path fill="none" stroke="black" d="M1023,-6691.81C1023,-6691.81 1023,-6629.26 1023,-6629.26"/>
<polygon fill="black" stroke="black" points="1026.5,-6629.26 1023,-6619.26 1019.5,-6629.26 1026.5,-6629.26"/>
</g>
<!-- expert_12_5 -->
<g id="node240" class="node">
<title>expert_12_5</title>
<path fill="lightsteelblue" stroke="black" d="M1332,-6619C1332,-6619 1166,-6619 1166,-6619 1160,-6619 1154,-6613 1154,-6607 1154,-6607 1154,-6563 1154,-6563 1154,-6557 1160,-6551 1166,-6551 1166,-6551 1332,-6551 1332,-6551 1338,-6551 1344,-6557 1344,-6563 1344,-6563 1344,-6607 1344,-6607 1344,-6613 1338,-6619 1332,-6619"/>
<text text-anchor="middle" x="1249" y="-6603.8" font-family="Arial" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1249" y="-6588.8" font-family="Arial" font-size="14.00">GPU 1</text>
<text text-anchor="middle" x="1249" y="-6573.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1249" y="-6558.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_12&#45;&gt;expert_12_5 -->
<g id="edge292" class="edge">
<title>expert_gate_12&#45;&gt;expert_12_5</title>
<path fill="none" stroke="black" d="M1109.29,-6705C1140.29,-6705 1167.75,-6705 1167.75,-6705 1167.75,-6705 1167.75,-6629.07 1167.75,-6629.07"/>
<polygon fill="black" stroke="black" points="1171.25,-6629.07 1167.75,-6619.07 1164.25,-6629.07 1171.25,-6629.07"/>
</g>
<!-- expert_12_6 -->
<g id="node241" class="node">
<title>expert_12_6</title>
<path fill="lightsteelblue" stroke="black" d="M1558,-6619C1558,-6619 1392,-6619 1392,-6619 1386,-6619 1380,-6613 1380,-6607 1380,-6607 1380,-6563 1380,-6563 1380,-6557 1386,-6551 1392,-6551 1392,-6551 1558,-6551 1558,-6551 1564,-6551 1570,-6557 1570,-6563 1570,-6563 1570,-6607 1570,-6607 1570,-6613 1564,-6619 1558,-6619"/>
<text text-anchor="middle" x="1475" y="-6603.8" font-family="Arial" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="1475" y="-6588.8" font-family="Arial" font-size="14.00">GPU 2</text>
<text text-anchor="middle" x="1475" y="-6573.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1475" y="-6558.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_12&#45;&gt;expert_12_6 -->
<g id="edge293" class="edge">
<title>expert_gate_12&#45;&gt;expert_12_6</title>
<path fill="none" stroke="black" d="M1109.11,-6718C1232.79,-6718 1446,-6718 1446,-6718 1446,-6718 1446,-6629.25 1446,-6629.25"/>
<polygon fill="black" stroke="black" points="1449.5,-6629.25 1446,-6619.25 1442.5,-6629.25 1449.5,-6629.25"/>
</g>
<!-- expert_12_7 -->
<g id="node242" class="node">
<title>expert_12_7</title>
<path fill="lightsteelblue" stroke="black" d="M1784,-6619C1784,-6619 1618,-6619 1618,-6619 1612,-6619 1606,-6613 1606,-6607 1606,-6607 1606,-6563 1606,-6563 1606,-6557 1612,-6551 1618,-6551 1618,-6551 1784,-6551 1784,-6551 1790,-6551 1796,-6557 1796,-6563 1796,-6563 1796,-6607 1796,-6607 1796,-6613 1790,-6619 1784,-6619"/>
<text text-anchor="middle" x="1701" y="-6603.8" font-family="Arial" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="1701" y="-6588.8" font-family="Arial" font-size="14.00">GPU 3</text>
<text text-anchor="middle" x="1701" y="-6573.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1701" y="-6558.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_12&#45;&gt;expert_12_7 -->
<g id="edge294" class="edge">
<title>expert_gate_12&#45;&gt;expert_12_7</title>
<path fill="none" stroke="black" d="M1109.18,-6731C1285.72,-6731 1672,-6731 1672,-6731 1672,-6731 1672,-6629.23 1672,-6629.23"/>
<polygon fill="black" stroke="black" points="1675.5,-6629.23 1672,-6619.23 1668.5,-6629.23 1675.5,-6629.23"/>
</g>
<!-- expert_agg_12 -->
<g id="node243" class="node">
<title>expert_agg_12</title>
<path fill="lightsalmon" stroke="black" d="M1098.5,-6478C1098.5,-6478 947.5,-6478 947.5,-6478 941.5,-6478 935.5,-6472 935.5,-6466 935.5,-6466 935.5,-6437 935.5,-6437 935.5,-6431 941.5,-6425 947.5,-6425 947.5,-6425 1098.5,-6425 1098.5,-6425 1104.5,-6425 1110.5,-6431 1110.5,-6437 1110.5,-6437 1110.5,-6466 1110.5,-6466 1110.5,-6472 1104.5,-6478 1098.5,-6478"/>
<text text-anchor="middle" x="1023" y="-6462.8" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1023" y="-6447.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1023" y="-6432.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- expert_12_0&#45;&gt;expert_agg_12 -->
<g id="edge295" class="edge">
<title>expert_12_0&#45;&gt;expert_agg_12</title>
<path fill="none" stroke="black" d="M198.5,-6550.96C198.5,-6506.71 198.5,-6435 198.5,-6435 198.5,-6435 925.15,-6435 925.15,-6435"/>
<polygon fill="black" stroke="black" points="925.15,-6438.5 935.15,-6435 925.15,-6431.5 925.15,-6438.5"/>
</g>
<!-- expert_12_1&#45;&gt;expert_agg_12 -->
<g id="edge296" class="edge">
<title>expert_12_1&#45;&gt;expert_agg_12</title>
<path fill="none" stroke="black" d="M424.5,-6551C424.5,-6509.85 424.5,-6446 424.5,-6446 424.5,-6446 925.33,-6446 925.33,-6446"/>
<polygon fill="black" stroke="black" points="925.33,-6449.5 935.33,-6446 925.33,-6442.5 925.33,-6449.5"/>
</g>
<!-- expert_12_2&#45;&gt;expert_agg_12 -->
<g id="edge297" class="edge">
<title>expert_12_2&#45;&gt;expert_agg_12</title>
<path fill="none" stroke="black" d="M650.5,-6550.77C650.5,-6512.55 650.5,-6456 650.5,-6456 650.5,-6456 925.19,-6456 925.19,-6456"/>
<polygon fill="black" stroke="black" points="925.19,-6459.5 935.19,-6456 925.19,-6452.5 925.19,-6459.5"/>
</g>
<!-- expert_12_3&#45;&gt;expert_agg_12 -->
<g id="edge298" class="edge">
<title>expert_12_3&#45;&gt;expert_agg_12</title>
<path fill="none" stroke="black" d="M876.5,-6550.87C876.5,-6516.02 876.5,-6467 876.5,-6467 876.5,-6467 925.24,-6467 925.24,-6467"/>
<polygon fill="black" stroke="black" points="925.24,-6470.5 935.24,-6467 925.24,-6463.5 925.24,-6470.5"/>
</g>
<!-- expert_12_4&#45;&gt;expert_agg_12 -->
<g id="edge299" class="edge">
<title>expert_12_4&#45;&gt;expert_agg_12</title>
<path fill="none" stroke="black" d="M1023,-6550.97C1023,-6550.97 1023,-6488.32 1023,-6488.32"/>
<polygon fill="black" stroke="black" points="1026.5,-6488.32 1023,-6478.32 1019.5,-6488.32 1026.5,-6488.32"/>
</g>
<!-- expert_12_5&#45;&gt;expert_agg_12 -->
<g id="edge300" class="edge">
<title>expert_12_5&#45;&gt;expert_agg_12</title>
<path fill="none" stroke="black" d="M1192.25,-6550.97C1192.25,-6515.18 1192.25,-6464 1192.25,-6464 1192.25,-6464 1120.6,-6464 1120.6,-6464"/>
<polygon fill="black" stroke="black" points="1120.6,-6460.5 1110.6,-6464 1120.6,-6467.5 1120.6,-6460.5"/>
</g>
<!-- expert_12_6&#45;&gt;expert_agg_12 -->
<g id="edge301" class="edge">
<title>expert_12_6&#45;&gt;expert_agg_12</title>
<path fill="none" stroke="black" d="M1388.25,-6550.84C1388.25,-6511.14 1388.25,-6451 1388.25,-6451 1388.25,-6451 1120.95,-6451 1120.95,-6451"/>
<polygon fill="black" stroke="black" points="1120.95,-6447.5 1110.95,-6451 1120.95,-6454.5 1120.95,-6447.5"/>
</g>
<!-- expert_12_7&#45;&gt;expert_agg_12 -->
<g id="edge302" class="edge">
<title>expert_12_7&#45;&gt;expert_agg_12</title>
<path fill="none" stroke="black" d="M1654.75,-6550.91C1654.75,-6507.48 1654.75,-6438 1654.75,-6438 1654.75,-6438 1120.51,-6438 1120.51,-6438"/>
<polygon fill="black" stroke="black" points="1120.51,-6434.5 1110.51,-6438 1120.51,-6441.5 1120.51,-6434.5"/>
</g>
<!-- activation_12 -->
<g id="node244" class="node">
<title>activation_12</title>
<path fill="lightyellow" stroke="black" d="M1218.5,-6352C1218.5,-6352 1057.5,-6352 1057.5,-6352 1051.5,-6352 1045.5,-6346 1045.5,-6340 1045.5,-6340 1045.5,-6326 1045.5,-6326 1045.5,-6320 1051.5,-6314 1057.5,-6314 1057.5,-6314 1218.5,-6314 1218.5,-6314 1224.5,-6314 1230.5,-6320 1230.5,-6326 1230.5,-6326 1230.5,-6340 1230.5,-6340 1230.5,-6346 1224.5,-6352 1218.5,-6352"/>
<text text-anchor="middle" x="1138" y="-6336.8" font-family="Arial" font-size="14.00">GELU</text>
<text text-anchor="middle" x="1138" y="-6321.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- expert_agg_12&#45;&gt;activation_12 -->
<g id="edge303" class="edge">
<title>expert_agg_12&#45;&gt;activation_12</title>
<path fill="none" stroke="black" d="M1078,-6424.91C1078,-6424.91 1078,-6362.13 1078,-6362.13"/>
<polygon fill="black" stroke="black" points="1081.5,-6362.13 1078,-6352.13 1074.5,-6362.13 1081.5,-6362.13"/>
</g>
<!-- dense_4h_h_12 -->
<g id="node245" class="node">
<title>dense_4h_h_12</title>
<path fill="lightblue" stroke="black" d="M1384.5,-6241C1384.5,-6241 1223.5,-6241 1223.5,-6241 1217.5,-6241 1211.5,-6235 1211.5,-6229 1211.5,-6229 1211.5,-6185 1211.5,-6185 1211.5,-6179 1217.5,-6173 1223.5,-6173 1223.5,-6173 1384.5,-6173 1384.5,-6173 1390.5,-6173 1396.5,-6179 1396.5,-6185 1396.5,-6185 1396.5,-6229 1396.5,-6229 1396.5,-6235 1390.5,-6241 1384.5,-6241"/>
<text text-anchor="middle" x="1304" y="-6225.8" font-family="Arial" font-size="14.00">Dense 4H→H</text>
<text text-anchor="middle" x="1304" y="-6210.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1304" y="-6195.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1304" y="-6180.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- activation_12&#45;&gt;dense_4h_h_12 -->
<g id="edge304" class="edge">
<title>activation_12&#45;&gt;dense_4h_h_12</title>
<path fill="none" stroke="black" d="M1221,-6313.86C1221,-6313.86 1221,-6251.07 1221,-6251.07"/>
<polygon fill="black" stroke="black" points="1224.5,-6251.07 1221,-6241.07 1217.5,-6251.07 1224.5,-6251.07"/>
</g>
<!-- allreduce_mlp_12 -->
<g id="node246" class="node">
<title>allreduce_mlp_12</title>
<path fill="lightcoral" stroke="black" d="M1691.5,-6100C1691.5,-6100 1558.5,-6100 1558.5,-6100 1552.5,-6100 1546.5,-6094 1546.5,-6088 1546.5,-6088 1546.5,-6074 1546.5,-6074 1546.5,-6068 1552.5,-6062 1558.5,-6062 1558.5,-6062 1691.5,-6062 1691.5,-6062 1697.5,-6062 1703.5,-6068 1703.5,-6074 1703.5,-6074 1703.5,-6088 1703.5,-6088 1703.5,-6094 1697.5,-6100 1691.5,-6100"/>
<text text-anchor="middle" x="1625" y="-6084.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1625" y="-6069.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- dense_4h_h_12&#45;&gt;allreduce_mlp_12 -->
<g id="edge305" class="edge">
<title>dense_4h_h_12&#45;&gt;allreduce_mlp_12</title>
<path fill="none" stroke="black" d="M1371.5,-6172.9C1371.5,-6135.59 1371.5,-6081 1371.5,-6081 1371.5,-6081 1536.18,-6081 1536.18,-6081"/>
<polygon fill="black" stroke="black" points="1536.18,-6084.5 1546.18,-6081 1536.18,-6077.5 1536.18,-6084.5"/>
</g>
<!-- residual2_12 -->
<g id="node251" class="node">
<title>residual2_12</title>
<path fill="lightgray" stroke="black" d="M1739.5,-5989C1739.5,-5989 1606.5,-5989 1606.5,-5989 1600.5,-5989 1594.5,-5983 1594.5,-5977 1594.5,-5977 1594.5,-5963 1594.5,-5963 1594.5,-5957 1600.5,-5951 1606.5,-5951 1606.5,-5951 1739.5,-5951 1739.5,-5951 1745.5,-5951 1751.5,-5957 1751.5,-5963 1751.5,-5963 1751.5,-5977 1751.5,-5977 1751.5,-5983 1745.5,-5989 1739.5,-5989"/>
<text text-anchor="middle" x="1673" y="-5973.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1673" y="-5958.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_mlp_12&#45;&gt;residual2_12 -->
<g id="edge313" class="edge">
<title>allreduce_mlp_12&#45;&gt;residual2_12</title>
<path fill="none" stroke="black" d="M1649,-6061.92C1649,-6061.92 1649,-5999.2 1649,-5999.2"/>
<polygon fill="black" stroke="black" points="1652.5,-5999.2 1649,-5989.2 1645.5,-5999.2 1652.5,-5999.2"/>
</g>
<!-- norm1_12 -->
<g id="node248" class="node">
<title>norm1_12</title>
<path fill="lightcyan" stroke="black" d="M1078.5,-7750C1078.5,-7750 945.5,-7750 945.5,-7750 939.5,-7750 933.5,-7744 933.5,-7738 933.5,-7738 933.5,-7724 933.5,-7724 933.5,-7718 939.5,-7712 945.5,-7712 945.5,-7712 1078.5,-7712 1078.5,-7712 1084.5,-7712 1090.5,-7718 1090.5,-7724 1090.5,-7724 1090.5,-7738 1090.5,-7738 1090.5,-7744 1084.5,-7750 1078.5,-7750"/>
<text text-anchor="middle" x="1012" y="-7734.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1012" y="-7719.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- input_12&#45;&gt;norm1_12 -->
<g id="edge306" class="edge">
<title>input_12&#45;&gt;norm1_12</title>
<path fill="none" stroke="black" d="M1055.25,-7830.08C1055.25,-7830.08 1055.25,-7760.19 1055.25,-7760.19"/>
<polygon fill="black" stroke="black" points="1058.75,-7760.19 1055.25,-7750.19 1051.75,-7760.19 1058.75,-7760.19"/>
</g>
<!-- input_12&#45;&gt;residual1_12 -->
<g id="edge307" class="edge">
<title>input_12&#45;&gt;residual1_12</title>
<path fill="none" stroke="black" d="M1159,-7823.57C1159,-7823.57 1159,-7124.29 1159,-7124.29"/>
<polygon fill="black" stroke="black" points="1162.5,-7124.29 1159,-7114.29 1155.5,-7124.29 1162.5,-7124.29"/>
</g>
<!-- norm1_12&#45;&gt;qkv_proj_12 -->
<g id="edge308" class="edge">
<title>norm1_12&#45;&gt;qkv_proj_12</title>
<path fill="none" stroke="black" d="M1012,-7711.81C1012,-7711.81 1012,-7643.06 1012,-7643.06"/>
<polygon fill="black" stroke="black" points="1015.5,-7643.06 1012,-7633.06 1008.5,-7643.06 1015.5,-7643.06"/>
</g>
<!-- norm2_12 -->
<g id="node250" class="node">
<title>norm2_12</title>
<path fill="lightcyan" stroke="black" d="M1169.5,-7003C1169.5,-7003 1036.5,-7003 1036.5,-7003 1030.5,-7003 1024.5,-6997 1024.5,-6991 1024.5,-6991 1024.5,-6977 1024.5,-6977 1024.5,-6971 1030.5,-6965 1036.5,-6965 1036.5,-6965 1169.5,-6965 1169.5,-6965 1175.5,-6965 1181.5,-6971 1181.5,-6977 1181.5,-6977 1181.5,-6991 1181.5,-6991 1181.5,-6997 1175.5,-7003 1169.5,-7003"/>
<text text-anchor="middle" x="1103" y="-6987.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1103" y="-6972.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual1_12&#45;&gt;norm2_12 -->
<g id="edge310" class="edge">
<title>residual1_12&#45;&gt;norm2_12</title>
<path fill="none" stroke="black" d="M1120.5,-7075.92C1120.5,-7075.92 1120.5,-7013.2 1120.5,-7013.2"/>
<polygon fill="black" stroke="black" points="1124,-7013.2 1120.5,-7003.2 1117,-7013.2 1124,-7013.2"/>
</g>
<!-- residual1_12&#45;&gt;residual2_12 -->
<g id="edge311" class="edge">
<title>residual1_12&#45;&gt;residual2_12</title>
<path fill="none" stroke="black" d="M1216.81,-7095C1395.56,-7095 1816.33,-7095 1816.33,-7095 1816.33,-7095 1816.33,-5970 1816.33,-5970 1816.33,-5970 1761.79,-5970 1761.79,-5970"/>
<polygon fill="black" stroke="black" points="1761.79,-5966.5 1751.79,-5970 1761.79,-5973.5 1761.79,-5966.5"/>
</g>
<!-- norm2_12&#45;&gt;dense_h_4h_12 -->
<g id="edge312" class="edge">
<title>norm2_12&#45;&gt;dense_h_4h_12</title>
<path fill="none" stroke="black" d="M1085,-6964.81C1085,-6964.81 1085,-6896.06 1085,-6896.06"/>
<polygon fill="black" stroke="black" points="1088.5,-6896.06 1085,-6886.06 1081.5,-6896.06 1088.5,-6896.06"/>
</g>
<!-- output_12 -->
<g id="node252" class="node">
<title>output_12</title>
<ellipse fill="white" stroke="black" cx="1673" cy="-5851" rx="111" ry="27"/>
<text text-anchor="middle" x="1673" y="-5854.8" font-family="Arial" font-size="14.00">Layer 13 Output</text>
<text text-anchor="middle" x="1673" y="-5839.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual2_12&#45;&gt;output_12 -->
<g id="edge314" class="edge">
<title>residual2_12&#45;&gt;output_12</title>
<path fill="none" stroke="black" d="M1673,-5950.88C1673,-5950.88 1673,-5888.05 1673,-5888.05"/>
<polygon fill="black" stroke="black" points="1676.5,-5888.05 1673,-5878.05 1669.5,-5888.05 1676.5,-5888.05"/>
</g>
<!-- input_13 -->
<g id="node261" class="node">
<title>input_13</title>
<ellipse fill="white" stroke="black" cx="1673" cy="-5689" rx="111" ry="27"/>
<text text-anchor="middle" x="1673" y="-5692.8" font-family="Arial" font-size="14.00">Layer 14 Input</text>
<text text-anchor="middle" x="1673" y="-5677.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- output_12&#45;&gt;input_13 -->
<g id="edge390" class="edge">
<title>output_12&#45;&gt;input_13</title>
<path fill="none" stroke="red" stroke-width="2" stroke-dasharray="5,2" d="M1673,-5823.88C1673,-5823.88 1673,-5726.2 1673,-5726.2"/>
<polygon fill="red" stroke="red" stroke-width="2" points="1676.5,-5726.2 1673,-5716.2 1669.5,-5726.2 1676.5,-5726.2"/>
<text text-anchor="middle" x="1729" y="-5776.8" font-family="Times,serif" font-size="14.00">GPU&#45;to&#45;GPU</text>
<text text-anchor="middle" x="1729" y="-5761.8" font-family="Times,serif" font-size="14.00">Communication</text>
</g>
<!-- qkv_proj_13 -->
<g id="node253" class="node">
<title>qkv_proj_13</title>
<path fill="lightgreen" stroke="black" d="M1737.5,-5472C1737.5,-5472 1558.5,-5472 1558.5,-5472 1552.5,-5472 1546.5,-5466 1546.5,-5460 1546.5,-5460 1546.5,-5416 1546.5,-5416 1546.5,-5410 1552.5,-5404 1558.5,-5404 1558.5,-5404 1737.5,-5404 1737.5,-5404 1743.5,-5404 1749.5,-5410 1749.5,-5416 1749.5,-5416 1749.5,-5460 1749.5,-5460 1749.5,-5466 1743.5,-5472 1737.5,-5472"/>
<text text-anchor="middle" x="1648" y="-5456.8" font-family="Arial" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1648" y="-5441.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1648" y="-5426.8" font-family="Arial" font-size="14.00">[1024, seq_len, 3*hidden]</text>
<text text-anchor="middle" x="1648" y="-5411.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 3*hidden/tp]</text>
</g>
<!-- attn_comp_13 -->
<g id="node254" class="node">
<title>attn_comp_13</title>
<path fill="lightyellow" stroke="black" d="M1727,-5331C1727,-5331 1579,-5331 1579,-5331 1573,-5331 1567,-5325 1567,-5319 1567,-5319 1567,-5290 1567,-5290 1567,-5284 1573,-5278 1579,-5278 1579,-5278 1727,-5278 1727,-5278 1733,-5278 1739,-5284 1739,-5290 1739,-5290 1739,-5319 1739,-5319 1739,-5325 1733,-5331 1727,-5331"/>
<text text-anchor="middle" x="1653" y="-5315.8" font-family="Arial" font-size="14.00">Attention</text>
<text text-anchor="middle" x="1653" y="-5300.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1653" y="-5285.8" font-family="Arial" font-size="14.00">Heads: 2 per GPU</text>
</g>
<!-- qkv_proj_13&#45;&gt;attn_comp_13 -->
<g id="edge315" class="edge">
<title>qkv_proj_13&#45;&gt;attn_comp_13</title>
<path fill="none" stroke="black" d="M1653,-5403.97C1653,-5403.97 1653,-5341.32 1653,-5341.32"/>
<polygon fill="black" stroke="black" points="1656.5,-5341.32 1653,-5331.32 1649.5,-5341.32 1656.5,-5341.32"/>
</g>
<!-- out_proj_13 -->
<g id="node255" class="node">
<title>out_proj_13</title>
<path fill="lightgreen" stroke="black" d="M1732.5,-5205C1732.5,-5205 1581.5,-5205 1581.5,-5205 1575.5,-5205 1569.5,-5199 1569.5,-5193 1569.5,-5193 1569.5,-5149 1569.5,-5149 1569.5,-5143 1575.5,-5137 1581.5,-5137 1581.5,-5137 1732.5,-5137 1732.5,-5137 1738.5,-5137 1744.5,-5143 1744.5,-5149 1744.5,-5149 1744.5,-5193 1744.5,-5193 1744.5,-5199 1738.5,-5205 1732.5,-5205"/>
<text text-anchor="middle" x="1657" y="-5189.8" font-family="Arial" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="1657" y="-5174.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1657" y="-5159.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1657" y="-5144.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- attn_comp_13&#45;&gt;out_proj_13 -->
<g id="edge316" class="edge">
<title>attn_comp_13&#45;&gt;out_proj_13</title>
<path fill="none" stroke="black" d="M1654.25,-5277.81C1654.25,-5277.81 1654.25,-5215.26 1654.25,-5215.26"/>
<polygon fill="black" stroke="black" points="1657.75,-5215.26 1654.25,-5205.26 1650.75,-5215.26 1657.75,-5215.26"/>
</g>
<!-- allreduce_attn_13 -->
<g id="node256" class="node">
<title>allreduce_attn_13</title>
<path fill="lightcoral" stroke="black" d="M1725.5,-5064C1725.5,-5064 1592.5,-5064 1592.5,-5064 1586.5,-5064 1580.5,-5058 1580.5,-5052 1580.5,-5052 1580.5,-5038 1580.5,-5038 1580.5,-5032 1586.5,-5026 1592.5,-5026 1592.5,-5026 1725.5,-5026 1725.5,-5026 1731.5,-5026 1737.5,-5032 1737.5,-5038 1737.5,-5038 1737.5,-5052 1737.5,-5052 1737.5,-5058 1731.5,-5064 1725.5,-5064"/>
<text text-anchor="middle" x="1659" y="-5048.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1659" y="-5033.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- out_proj_13&#45;&gt;allreduce_attn_13 -->
<g id="edge317" class="edge">
<title>out_proj_13&#45;&gt;allreduce_attn_13</title>
<path fill="none" stroke="black" d="M1659,-5136.9C1659,-5136.9 1659,-5074.24 1659,-5074.24"/>
<polygon fill="black" stroke="black" points="1662.5,-5074.24 1659,-5064.24 1655.5,-5074.24 1662.5,-5074.24"/>
</g>
<!-- residual1_13 -->
<g id="node263" class="node">
<title>residual1_13</title>
<path fill="lightgray" stroke="black" d="M1763.5,-4953C1763.5,-4953 1630.5,-4953 1630.5,-4953 1624.5,-4953 1618.5,-4947 1618.5,-4941 1618.5,-4941 1618.5,-4927 1618.5,-4927 1618.5,-4921 1624.5,-4915 1630.5,-4915 1630.5,-4915 1763.5,-4915 1763.5,-4915 1769.5,-4915 1775.5,-4921 1775.5,-4927 1775.5,-4927 1775.5,-4941 1775.5,-4941 1775.5,-4947 1769.5,-4953 1763.5,-4953"/>
<text text-anchor="middle" x="1697" y="-4937.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1697" y="-4922.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_attn_13&#45;&gt;residual1_13 -->
<g id="edge324" class="edge">
<title>allreduce_attn_13&#45;&gt;residual1_13</title>
<path fill="none" stroke="black" d="M1678,-5025.92C1678,-5025.92 1678,-4963.2 1678,-4963.2"/>
<polygon fill="black" stroke="black" points="1681.5,-4963.2 1678,-4953.2 1674.5,-4963.2 1681.5,-4963.2"/>
</g>
<!-- dense_h_4h_13 -->
<g id="node257" class="node">
<title>dense_h_4h_13</title>
<path fill="lightblue" stroke="black" d="M1737.5,-4725C1737.5,-4725 1558.5,-4725 1558.5,-4725 1552.5,-4725 1546.5,-4719 1546.5,-4713 1546.5,-4713 1546.5,-4669 1546.5,-4669 1546.5,-4663 1552.5,-4657 1558.5,-4657 1558.5,-4657 1737.5,-4657 1737.5,-4657 1743.5,-4657 1749.5,-4663 1749.5,-4669 1749.5,-4669 1749.5,-4713 1749.5,-4713 1749.5,-4719 1743.5,-4725 1737.5,-4725"/>
<text text-anchor="middle" x="1648" y="-4709.8" font-family="Arial" font-size="14.00">Dense H→4H</text>
<text text-anchor="middle" x="1648" y="-4694.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1648" y="-4679.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
<text text-anchor="middle" x="1648" y="-4664.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- activation_13 -->
<g id="node258" class="node">
<title>activation_13</title>
<path fill="lightyellow" stroke="black" d="M1730.5,-4584C1730.5,-4584 1569.5,-4584 1569.5,-4584 1563.5,-4584 1557.5,-4578 1557.5,-4572 1557.5,-4572 1557.5,-4558 1557.5,-4558 1557.5,-4552 1563.5,-4546 1569.5,-4546 1569.5,-4546 1730.5,-4546 1730.5,-4546 1736.5,-4546 1742.5,-4552 1742.5,-4558 1742.5,-4558 1742.5,-4572 1742.5,-4572 1742.5,-4578 1736.5,-4584 1730.5,-4584"/>
<text text-anchor="middle" x="1650" y="-4568.8" font-family="Arial" font-size="14.00">GELU</text>
<text text-anchor="middle" x="1650" y="-4553.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- dense_h_4h_13&#45;&gt;activation_13 -->
<g id="edge318" class="edge">
<title>dense_h_4h_13&#45;&gt;activation_13</title>
<path fill="none" stroke="black" d="M1650,-4656.9C1650,-4656.9 1650,-4594.24 1650,-4594.24"/>
<polygon fill="black" stroke="black" points="1653.5,-4594.24 1650,-4584.24 1646.5,-4594.24 1653.5,-4594.24"/>
</g>
<!-- dense_4h_h_13 -->
<g id="node259" class="node">
<title>dense_4h_h_13</title>
<path fill="lightblue" stroke="black" d="M1731.5,-4473C1731.5,-4473 1570.5,-4473 1570.5,-4473 1564.5,-4473 1558.5,-4467 1558.5,-4461 1558.5,-4461 1558.5,-4417 1558.5,-4417 1558.5,-4411 1564.5,-4405 1570.5,-4405 1570.5,-4405 1731.5,-4405 1731.5,-4405 1737.5,-4405 1743.5,-4411 1743.5,-4417 1743.5,-4417 1743.5,-4461 1743.5,-4461 1743.5,-4467 1737.5,-4473 1731.5,-4473"/>
<text text-anchor="middle" x="1651" y="-4457.8" font-family="Arial" font-size="14.00">Dense 4H→H</text>
<text text-anchor="middle" x="1651" y="-4442.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1651" y="-4427.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1651" y="-4412.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- activation_13&#45;&gt;dense_4h_h_13 -->
<g id="edge319" class="edge">
<title>activation_13&#45;&gt;dense_4h_h_13</title>
<path fill="none" stroke="black" d="M1650.5,-4545.86C1650.5,-4545.86 1650.5,-4483.07 1650.5,-4483.07"/>
<polygon fill="black" stroke="black" points="1654,-4483.07 1650.5,-4473.07 1647,-4483.07 1654,-4483.07"/>
</g>
<!-- allreduce_mlp_13 -->
<g id="node260" class="node">
<title>allreduce_mlp_13</title>
<path fill="lightcoral" stroke="black" d="M1717.5,-4332C1717.5,-4332 1584.5,-4332 1584.5,-4332 1578.5,-4332 1572.5,-4326 1572.5,-4320 1572.5,-4320 1572.5,-4306 1572.5,-4306 1572.5,-4300 1578.5,-4294 1584.5,-4294 1584.5,-4294 1717.5,-4294 1717.5,-4294 1723.5,-4294 1729.5,-4300 1729.5,-4306 1729.5,-4306 1729.5,-4320 1729.5,-4320 1729.5,-4326 1723.5,-4332 1717.5,-4332"/>
<text text-anchor="middle" x="1651" y="-4316.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1651" y="-4301.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- dense_4h_h_13&#45;&gt;allreduce_mlp_13 -->
<g id="edge320" class="edge">
<title>dense_4h_h_13&#45;&gt;allreduce_mlp_13</title>
<path fill="none" stroke="black" d="M1651,-4404.9C1651,-4404.9 1651,-4342.24 1651,-4342.24"/>
<polygon fill="black" stroke="black" points="1654.5,-4342.24 1651,-4332.24 1647.5,-4342.24 1654.5,-4342.24"/>
</g>
<!-- residual2_13 -->
<g id="node265" class="node">
<title>residual2_13</title>
<path fill="lightgray" stroke="black" d="M1718.5,-4221C1718.5,-4221 1585.5,-4221 1585.5,-4221 1579.5,-4221 1573.5,-4215 1573.5,-4209 1573.5,-4209 1573.5,-4195 1573.5,-4195 1573.5,-4189 1579.5,-4183 1585.5,-4183 1585.5,-4183 1718.5,-4183 1718.5,-4183 1724.5,-4183 1730.5,-4189 1730.5,-4195 1730.5,-4195 1730.5,-4209 1730.5,-4209 1730.5,-4215 1724.5,-4221 1718.5,-4221"/>
<text text-anchor="middle" x="1652" y="-4205.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1652" y="-4190.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_mlp_13&#45;&gt;residual2_13 -->
<g id="edge328" class="edge">
<title>allreduce_mlp_13&#45;&gt;residual2_13</title>
<path fill="none" stroke="black" d="M1651.5,-4293.92C1651.5,-4293.92 1651.5,-4231.2 1651.5,-4231.2"/>
<polygon fill="black" stroke="black" points="1655,-4231.2 1651.5,-4221.2 1648,-4231.2 1655,-4231.2"/>
</g>
<!-- norm1_13 -->
<g id="node262" class="node">
<title>norm1_13</title>
<path fill="lightcyan" stroke="black" d="M1726.5,-5589C1726.5,-5589 1593.5,-5589 1593.5,-5589 1587.5,-5589 1581.5,-5583 1581.5,-5577 1581.5,-5577 1581.5,-5563 1581.5,-5563 1581.5,-5557 1587.5,-5551 1593.5,-5551 1593.5,-5551 1726.5,-5551 1726.5,-5551 1732.5,-5551 1738.5,-5557 1738.5,-5563 1738.5,-5563 1738.5,-5577 1738.5,-5577 1738.5,-5583 1732.5,-5589 1726.5,-5589"/>
<text text-anchor="middle" x="1660" y="-5573.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1660" y="-5558.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- input_13&#45;&gt;norm1_13 -->
<g id="edge321" class="edge">
<title>input_13&#45;&gt;norm1_13</title>
<path fill="none" stroke="black" d="M1660,-5662C1660,-5662 1660,-5599.12 1660,-5599.12"/>
<polygon fill="black" stroke="black" points="1663.5,-5599.12 1660,-5589.12 1656.5,-5599.12 1663.5,-5599.12"/>
</g>
<!-- input_13&#45;&gt;residual1_13 -->
<g id="edge322" class="edge">
<title>input_13&#45;&gt;residual1_13</title>
<path fill="none" stroke="black" d="M1762.5,-5672.88C1762.5,-5672.88 1762.5,-4963.31 1762.5,-4963.31"/>
<polygon fill="black" stroke="black" points="1766,-4963.31 1762.5,-4953.31 1759,-4963.31 1766,-4963.31"/>
</g>
<!-- norm1_13&#45;&gt;qkv_proj_13 -->
<g id="edge323" class="edge">
<title>norm1_13&#45;&gt;qkv_proj_13</title>
<path fill="none" stroke="black" d="M1660,-5550.81C1660,-5550.81 1660,-5482.06 1660,-5482.06"/>
<polygon fill="black" stroke="black" points="1663.5,-5482.06 1660,-5472.06 1656.5,-5482.06 1663.5,-5482.06"/>
</g>
<!-- norm2_13 -->
<g id="node264" class="node">
<title>norm2_13</title>
<path fill="lightcyan" stroke="black" d="M1726.5,-4842C1726.5,-4842 1593.5,-4842 1593.5,-4842 1587.5,-4842 1581.5,-4836 1581.5,-4830 1581.5,-4830 1581.5,-4816 1581.5,-4816 1581.5,-4810 1587.5,-4804 1593.5,-4804 1593.5,-4804 1726.5,-4804 1726.5,-4804 1732.5,-4804 1738.5,-4810 1738.5,-4816 1738.5,-4816 1738.5,-4830 1738.5,-4830 1738.5,-4836 1732.5,-4842 1726.5,-4842"/>
<text text-anchor="middle" x="1660" y="-4826.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1660" y="-4811.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual1_13&#45;&gt;norm2_13 -->
<g id="edge325" class="edge">
<title>residual1_13&#45;&gt;norm2_13</title>
<path fill="none" stroke="black" d="M1678.5,-4914.92C1678.5,-4914.92 1678.5,-4852.2 1678.5,-4852.2"/>
<polygon fill="black" stroke="black" points="1682,-4852.2 1678.5,-4842.2 1675,-4852.2 1682,-4852.2"/>
</g>
<!-- residual1_13&#45;&gt;residual2_13 -->
<g id="edge326" class="edge">
<title>residual1_13&#45;&gt;residual2_13</title>
<path fill="none" stroke="black" d="M1756.25,-4914.8C1756.25,-4799.3 1756.25,-4202 1756.25,-4202 1756.25,-4202 1740.75,-4202 1740.75,-4202"/>
<polygon fill="black" stroke="black" points="1740.75,-4198.5 1730.75,-4202 1740.75,-4205.5 1740.75,-4198.5"/>
</g>
<!-- norm2_13&#45;&gt;dense_h_4h_13 -->
<g id="edge327" class="edge">
<title>norm2_13&#45;&gt;dense_h_4h_13</title>
<path fill="none" stroke="black" d="M1660,-4803.81C1660,-4803.81 1660,-4735.06 1660,-4735.06"/>
<polygon fill="black" stroke="black" points="1663.5,-4735.06 1660,-4725.06 1656.5,-4735.06 1663.5,-4735.06"/>
</g>
<!-- output_13 -->
<g id="node266" class="node">
<title>output_13</title>
<ellipse fill="white" stroke="black" cx="1652" cy="-4083" rx="111" ry="27"/>
<text text-anchor="middle" x="1652" y="-4086.8" font-family="Arial" font-size="14.00">Layer 14 Output</text>
<text text-anchor="middle" x="1652" y="-4071.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual2_13&#45;&gt;output_13 -->
<g id="edge329" class="edge">
<title>residual2_13&#45;&gt;output_13</title>
<path fill="none" stroke="black" d="M1652,-4182.88C1652,-4182.88 1652,-4120.05 1652,-4120.05"/>
<polygon fill="black" stroke="black" points="1655.5,-4120.05 1652,-4110.05 1648.5,-4120.05 1655.5,-4120.05"/>
</g>
<!-- input_14 -->
<g id="node285" class="node">
<title>input_14</title>
<ellipse fill="white" stroke="black" cx="1652" cy="-3921" rx="111" ry="27"/>
<text text-anchor="middle" x="1652" y="-3924.8" font-family="Arial" font-size="14.00">Layer 15 Input</text>
<text text-anchor="middle" x="1652" y="-3909.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- output_13&#45;&gt;input_14 -->
<g id="edge391" class="edge">
<title>output_13&#45;&gt;input_14</title>
<path fill="none" stroke="red" stroke-width="2" stroke-dasharray="5,2" d="M1652,-4055.88C1652,-4055.88 1652,-3958.2 1652,-3958.2"/>
<polygon fill="red" stroke="red" stroke-width="2" points="1655.5,-3958.2 1652,-3948.2 1648.5,-3958.2 1655.5,-3958.2"/>
<text text-anchor="middle" x="1708" y="-4008.8" font-family="Times,serif" font-size="14.00">GPU&#45;to&#45;GPU</text>
<text text-anchor="middle" x="1708" y="-3993.8" font-family="Times,serif" font-size="14.00">Communication</text>
</g>
<!-- qkv_proj_14 -->
<g id="node267" class="node">
<title>qkv_proj_14</title>
<path fill="lightgreen" stroke="black" d="M1632.5,-3704C1632.5,-3704 1453.5,-3704 1453.5,-3704 1447.5,-3704 1441.5,-3698 1441.5,-3692 1441.5,-3692 1441.5,-3648 1441.5,-3648 1441.5,-3642 1447.5,-3636 1453.5,-3636 1453.5,-3636 1632.5,-3636 1632.5,-3636 1638.5,-3636 1644.5,-3642 1644.5,-3648 1644.5,-3648 1644.5,-3692 1644.5,-3692 1644.5,-3698 1638.5,-3704 1632.5,-3704"/>
<text text-anchor="middle" x="1543" y="-3688.8" font-family="Arial" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1543" y="-3673.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1543" y="-3658.8" font-family="Arial" font-size="14.00">[1024, seq_len, 3*hidden]</text>
<text text-anchor="middle" x="1543" y="-3643.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 3*hidden/tp]</text>
</g>
<!-- attn_comp_14 -->
<g id="node268" class="node">
<title>attn_comp_14</title>
<path fill="lightyellow" stroke="black" d="M1624,-3563C1624,-3563 1476,-3563 1476,-3563 1470,-3563 1464,-3557 1464,-3551 1464,-3551 1464,-3522 1464,-3522 1464,-3516 1470,-3510 1476,-3510 1476,-3510 1624,-3510 1624,-3510 1630,-3510 1636,-3516 1636,-3522 1636,-3522 1636,-3551 1636,-3551 1636,-3557 1630,-3563 1624,-3563"/>
<text text-anchor="middle" x="1550" y="-3547.8" font-family="Arial" font-size="14.00">Attention</text>
<text text-anchor="middle" x="1550" y="-3532.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1550" y="-3517.8" font-family="Arial" font-size="14.00">Heads: 2 per GPU</text>
</g>
<!-- qkv_proj_14&#45;&gt;attn_comp_14 -->
<g id="edge330" class="edge">
<title>qkv_proj_14&#45;&gt;attn_comp_14</title>
<path fill="none" stroke="black" d="M1550,-3635.97C1550,-3635.97 1550,-3573.32 1550,-3573.32"/>
<polygon fill="black" stroke="black" points="1553.5,-3573.32 1550,-3563.32 1546.5,-3573.32 1553.5,-3573.32"/>
</g>
<!-- out_proj_14 -->
<g id="node269" class="node">
<title>out_proj_14</title>
<path fill="lightgreen" stroke="black" d="M1630.5,-3437C1630.5,-3437 1479.5,-3437 1479.5,-3437 1473.5,-3437 1467.5,-3431 1467.5,-3425 1467.5,-3425 1467.5,-3381 1467.5,-3381 1467.5,-3375 1473.5,-3369 1479.5,-3369 1479.5,-3369 1630.5,-3369 1630.5,-3369 1636.5,-3369 1642.5,-3375 1642.5,-3381 1642.5,-3381 1642.5,-3425 1642.5,-3425 1642.5,-3431 1636.5,-3437 1630.5,-3437"/>
<text text-anchor="middle" x="1555" y="-3421.8" font-family="Arial" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="1555" y="-3406.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1555" y="-3391.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1555" y="-3376.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- attn_comp_14&#45;&gt;out_proj_14 -->
<g id="edge331" class="edge">
<title>attn_comp_14&#45;&gt;out_proj_14</title>
<path fill="none" stroke="black" d="M1551.75,-3509.81C1551.75,-3509.81 1551.75,-3447.26 1551.75,-3447.26"/>
<polygon fill="black" stroke="black" points="1555.25,-3447.26 1551.75,-3437.26 1548.25,-3447.26 1555.25,-3447.26"/>
</g>
<!-- allreduce_attn_14 -->
<g id="node270" class="node">
<title>allreduce_attn_14</title>
<path fill="lightcoral" stroke="black" d="M1630.5,-3296C1630.5,-3296 1497.5,-3296 1497.5,-3296 1491.5,-3296 1485.5,-3290 1485.5,-3284 1485.5,-3284 1485.5,-3270 1485.5,-3270 1485.5,-3264 1491.5,-3258 1497.5,-3258 1497.5,-3258 1630.5,-3258 1630.5,-3258 1636.5,-3258 1642.5,-3264 1642.5,-3270 1642.5,-3270 1642.5,-3284 1642.5,-3284 1642.5,-3290 1636.5,-3296 1630.5,-3296"/>
<text text-anchor="middle" x="1564" y="-3280.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1564" y="-3265.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- out_proj_14&#45;&gt;allreduce_attn_14 -->
<g id="edge332" class="edge">
<title>out_proj_14&#45;&gt;allreduce_attn_14</title>
<path fill="none" stroke="black" d="M1564,-3368.9C1564,-3368.9 1564,-3306.24 1564,-3306.24"/>
<polygon fill="black" stroke="black" points="1567.5,-3306.24 1564,-3296.24 1560.5,-3306.24 1567.5,-3306.24"/>
</g>
<!-- residual1_14 -->
<g id="node287" class="node">
<title>residual1_14</title>
<path fill="lightgray" stroke="black" d="M1745.5,-3185C1745.5,-3185 1612.5,-3185 1612.5,-3185 1606.5,-3185 1600.5,-3179 1600.5,-3173 1600.5,-3173 1600.5,-3159 1600.5,-3159 1600.5,-3153 1606.5,-3147 1612.5,-3147 1612.5,-3147 1745.5,-3147 1745.5,-3147 1751.5,-3147 1757.5,-3153 1757.5,-3159 1757.5,-3159 1757.5,-3173 1757.5,-3173 1757.5,-3179 1751.5,-3185 1745.5,-3185"/>
<text text-anchor="middle" x="1679" y="-3169.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1679" y="-3154.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_attn_14&#45;&gt;residual1_14 -->
<g id="edge356" class="edge">
<title>allreduce_attn_14&#45;&gt;residual1_14</title>
<path fill="none" stroke="black" d="M1621.5,-3257.92C1621.5,-3257.92 1621.5,-3195.2 1621.5,-3195.2"/>
<polygon fill="black" stroke="black" points="1625,-3195.2 1621.5,-3185.2 1618,-3195.2 1625,-3195.2"/>
</g>
<!-- dense_h_4h_14 -->
<g id="node271" class="node">
<title>dense_h_4h_14</title>
<path fill="lightblue" stroke="black" d="M1334.5,-2957C1334.5,-2957 1155.5,-2957 1155.5,-2957 1149.5,-2957 1143.5,-2951 1143.5,-2945 1143.5,-2945 1143.5,-2901 1143.5,-2901 1143.5,-2895 1149.5,-2889 1155.5,-2889 1155.5,-2889 1334.5,-2889 1334.5,-2889 1340.5,-2889 1346.5,-2895 1346.5,-2901 1346.5,-2901 1346.5,-2945 1346.5,-2945 1346.5,-2951 1340.5,-2957 1334.5,-2957"/>
<text text-anchor="middle" x="1245" y="-2941.8" font-family="Arial" font-size="14.00">Dense H→4H</text>
<text text-anchor="middle" x="1245" y="-2926.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1245" y="-2911.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
<text text-anchor="middle" x="1245" y="-2896.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- expert_gate_14 -->
<g id="node272" class="node">
<title>expert_gate_14</title>
<path fill="lightpink" stroke="black" d="M1256,-2816C1256,-2816 1108,-2816 1108,-2816 1102,-2816 1096,-2810 1096,-2804 1096,-2804 1096,-2775 1096,-2775 1096,-2769 1102,-2763 1108,-2763 1108,-2763 1256,-2763 1256,-2763 1262,-2763 1268,-2769 1268,-2775 1268,-2775 1268,-2804 1268,-2804 1268,-2810 1262,-2816 1256,-2816"/>
<text text-anchor="middle" x="1182" y="-2800.8" font-family="Arial" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1182" y="-2785.8" font-family="Arial" font-size="14.00">[1024, seq_len, 8 experts]</text>
<text text-anchor="middle" x="1182" y="-2770.8" font-family="Arial" font-size="14.00">Top&#45;2 routing</text>
</g>
<!-- dense_h_4h_14&#45;&gt;expert_gate_14 -->
<g id="edge333" class="edge">
<title>dense_h_4h_14&#45;&gt;expert_gate_14</title>
<path fill="none" stroke="black" d="M1205.75,-2888.97C1205.75,-2888.97 1205.75,-2826.32 1205.75,-2826.32"/>
<polygon fill="black" stroke="black" points="1209.25,-2826.32 1205.75,-2816.32 1202.25,-2826.32 1209.25,-2826.32"/>
</g>
<!-- expert_14_0 -->
<g id="node273" class="node">
<title>expert_14_0</title>
<path fill="lightsteelblue" stroke="black" d="M361,-2690C361,-2690 195,-2690 195,-2690 189,-2690 183,-2684 183,-2678 183,-2678 183,-2634 183,-2634 183,-2628 189,-2622 195,-2622 195,-2622 361,-2622 361,-2622 367,-2622 373,-2628 373,-2634 373,-2634 373,-2678 373,-2678 373,-2684 367,-2690 361,-2690"/>
<text text-anchor="middle" x="278" y="-2674.8" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="278" y="-2659.8" font-family="Arial" font-size="14.00">GPU 14</text>
<text text-anchor="middle" x="278" y="-2644.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="278" y="-2629.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_14&#45;&gt;expert_14_0 -->
<g id="edge334" class="edge">
<title>expert_gate_14&#45;&gt;expert_14_0</title>
<path fill="none" stroke="black" d="M1095.75,-2805C875.85,-2805 311.5,-2805 311.5,-2805 311.5,-2805 311.5,-2700.18 311.5,-2700.18"/>
<polygon fill="black" stroke="black" points="315,-2700.18 311.5,-2690.18 308,-2700.18 315,-2700.18"/>
</g>
<!-- expert_14_1 -->
<g id="node274" class="node">
<title>expert_14_1</title>
<path fill="lightsteelblue" stroke="black" d="M587,-2690C587,-2690 421,-2690 421,-2690 415,-2690 409,-2684 409,-2678 409,-2678 409,-2634 409,-2634 409,-2628 415,-2622 421,-2622 421,-2622 587,-2622 587,-2622 593,-2622 599,-2628 599,-2634 599,-2634 599,-2678 599,-2678 599,-2684 593,-2690 587,-2690"/>
<text text-anchor="middle" x="504" y="-2674.8" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="504" y="-2659.8" font-family="Arial" font-size="14.00">GPU 15</text>
<text text-anchor="middle" x="504" y="-2644.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="504" y="-2629.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_14&#45;&gt;expert_14_1 -->
<g id="edge335" class="edge">
<title>expert_gate_14&#45;&gt;expert_14_1</title>
<path fill="none" stroke="black" d="M1095.75,-2794C920.13,-2794 537.5,-2794 537.5,-2794 537.5,-2794 537.5,-2700.11 537.5,-2700.11"/>
<polygon fill="black" stroke="black" points="541,-2700.11 537.5,-2690.11 534,-2700.11 541,-2700.11"/>
</g>
<!-- expert_14_2 -->
<g id="node275" class="node">
<title>expert_14_2</title>
<path fill="lightsteelblue" stroke="black" d="M813,-2690C813,-2690 647,-2690 647,-2690 641,-2690 635,-2684 635,-2678 635,-2678 635,-2634 635,-2634 635,-2628 641,-2622 647,-2622 647,-2622 813,-2622 813,-2622 819,-2622 825,-2628 825,-2634 825,-2634 825,-2678 825,-2678 825,-2684 819,-2690 813,-2690"/>
<text text-anchor="middle" x="730" y="-2674.8" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="730" y="-2659.8" font-family="Arial" font-size="14.00">GPU 0</text>
<text text-anchor="middle" x="730" y="-2644.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="730" y="-2629.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_14&#45;&gt;expert_14_2 -->
<g id="edge336" class="edge">
<title>expert_gate_14&#45;&gt;expert_14_2</title>
<path fill="none" stroke="black" d="M1095.79,-2784C973.28,-2784 763.5,-2784 763.5,-2784 763.5,-2784 763.5,-2700.3 763.5,-2700.3"/>
<polygon fill="black" stroke="black" points="767,-2700.3 763.5,-2690.3 760,-2700.3 767,-2700.3"/>
</g>
<!-- expert_14_3 -->
<g id="node276" class="node">
<title>expert_14_3</title>
<path fill="lightsteelblue" stroke="black" d="M1039,-2690C1039,-2690 873,-2690 873,-2690 867,-2690 861,-2684 861,-2678 861,-2678 861,-2634 861,-2634 861,-2628 867,-2622 873,-2622 873,-2622 1039,-2622 1039,-2622 1045,-2622 1051,-2628 1051,-2634 1051,-2634 1051,-2678 1051,-2678 1051,-2684 1045,-2690 1039,-2690"/>
<text text-anchor="middle" x="956" y="-2674.8" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="956" y="-2659.8" font-family="Arial" font-size="14.00">GPU 1</text>
<text text-anchor="middle" x="956" y="-2644.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="956" y="-2629.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_14&#45;&gt;expert_14_3 -->
<g id="edge337" class="edge">
<title>expert_gate_14&#45;&gt;expert_14_3</title>
<path fill="none" stroke="black" d="M1095.77,-2773C1044.94,-2773 990.5,-2773 990.5,-2773 990.5,-2773 990.5,-2700.16 990.5,-2700.16"/>
<polygon fill="black" stroke="black" points="994,-2700.16 990.5,-2690.16 987,-2700.16 994,-2700.16"/>
</g>
<!-- expert_14_4 -->
<g id="node277" class="node">
<title>expert_14_4</title>
<path fill="lightsteelblue" stroke="black" d="M1265,-2690C1265,-2690 1099,-2690 1099,-2690 1093,-2690 1087,-2684 1087,-2678 1087,-2678 1087,-2634 1087,-2634 1087,-2628 1093,-2622 1099,-2622 1099,-2622 1265,-2622 1265,-2622 1271,-2622 1277,-2628 1277,-2634 1277,-2634 1277,-2678 1277,-2678 1277,-2684 1271,-2690 1265,-2690"/>
<text text-anchor="middle" x="1182" y="-2674.8" font-family="Arial" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1182" y="-2659.8" font-family="Arial" font-size="14.00">GPU 2</text>
<text text-anchor="middle" x="1182" y="-2644.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1182" y="-2629.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_14&#45;&gt;expert_14_4 -->
<g id="edge338" class="edge">
<title>expert_gate_14&#45;&gt;expert_14_4</title>
<path fill="none" stroke="black" d="M1182,-2762.81C1182,-2762.81 1182,-2700.26 1182,-2700.26"/>
<polygon fill="black" stroke="black" points="1185.5,-2700.26 1182,-2690.26 1178.5,-2700.26 1185.5,-2700.26"/>
</g>
<!-- expert_14_5 -->
<g id="node278" class="node">
<title>expert_14_5</title>
<path fill="lightsteelblue" stroke="black" d="M1491,-2690C1491,-2690 1325,-2690 1325,-2690 1319,-2690 1313,-2684 1313,-2678 1313,-2678 1313,-2634 1313,-2634 1313,-2628 1319,-2622 1325,-2622 1325,-2622 1491,-2622 1491,-2622 1497,-2622 1503,-2628 1503,-2634 1503,-2634 1503,-2678 1503,-2678 1503,-2684 1497,-2690 1491,-2690"/>
<text text-anchor="middle" x="1408" y="-2674.8" font-family="Arial" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1408" y="-2659.8" font-family="Arial" font-size="14.00">GPU 3</text>
<text text-anchor="middle" x="1408" y="-2644.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1408" y="-2629.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_14&#45;&gt;expert_14_5 -->
<g id="edge339" class="edge">
<title>expert_gate_14&#45;&gt;expert_14_5</title>
<path fill="none" stroke="black" d="M1268.37,-2776C1300.71,-2776 1329.75,-2776 1329.75,-2776 1329.75,-2776 1329.75,-2700.07 1329.75,-2700.07"/>
<polygon fill="black" stroke="black" points="1333.25,-2700.07 1329.75,-2690.07 1326.25,-2700.07 1333.25,-2700.07"/>
</g>
<!-- expert_14_6 -->
<g id="node279" class="node">
<title>expert_14_6</title>
<path fill="lightsteelblue" stroke="black" d="M1717,-2690C1717,-2690 1551,-2690 1551,-2690 1545,-2690 1539,-2684 1539,-2678 1539,-2678 1539,-2634 1539,-2634 1539,-2628 1545,-2622 1551,-2622 1551,-2622 1717,-2622 1717,-2622 1723,-2622 1729,-2628 1729,-2634 1729,-2634 1729,-2678 1729,-2678 1729,-2684 1723,-2690 1717,-2690"/>
<text text-anchor="middle" x="1634" y="-2674.8" font-family="Arial" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="1634" y="-2659.8" font-family="Arial" font-size="14.00">GPU 4</text>
<text text-anchor="middle" x="1634" y="-2644.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1634" y="-2629.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_14&#45;&gt;expert_14_6 -->
<g id="edge340" class="edge">
<title>expert_gate_14&#45;&gt;expert_14_6</title>
<path fill="none" stroke="black" d="M1268.28,-2789C1380.47,-2789 1562.25,-2789 1562.25,-2789 1562.25,-2789 1562.25,-2700.25 1562.25,-2700.25"/>
<polygon fill="black" stroke="black" points="1565.75,-2700.25 1562.25,-2690.25 1558.75,-2700.25 1565.75,-2700.25"/>
</g>
<!-- expert_14_7 -->
<g id="node280" class="node">
<title>expert_14_7</title>
<path fill="lightsteelblue" stroke="black" d="M1943,-2690C1943,-2690 1777,-2690 1777,-2690 1771,-2690 1765,-2684 1765,-2678 1765,-2678 1765,-2634 1765,-2634 1765,-2628 1771,-2622 1777,-2622 1777,-2622 1943,-2622 1943,-2622 1949,-2622 1955,-2628 1955,-2634 1955,-2634 1955,-2678 1955,-2678 1955,-2684 1949,-2690 1943,-2690"/>
<text text-anchor="middle" x="1860" y="-2674.8" font-family="Arial" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="1860" y="-2659.8" font-family="Arial" font-size="14.00">GPU 5</text>
<text text-anchor="middle" x="1860" y="-2644.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1860" y="-2629.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden/tp]</text>
</g>
<!-- expert_gate_14&#45;&gt;expert_14_7 -->
<g id="edge341" class="edge">
<title>expert_gate_14&#45;&gt;expert_14_7</title>
<path fill="none" stroke="black" d="M1268.17,-2802C1431.56,-2802 1770.25,-2802 1770.25,-2802 1770.25,-2802 1770.25,-2700.23 1770.25,-2700.23"/>
<polygon fill="black" stroke="black" points="1773.75,-2700.23 1770.25,-2690.23 1766.75,-2700.23 1773.75,-2700.23"/>
</g>
<!-- expert_agg_14 -->
<g id="node281" class="node">
<title>expert_agg_14</title>
<path fill="lightsalmon" stroke="black" d="M1257.5,-2549C1257.5,-2549 1106.5,-2549 1106.5,-2549 1100.5,-2549 1094.5,-2543 1094.5,-2537 1094.5,-2537 1094.5,-2508 1094.5,-2508 1094.5,-2502 1100.5,-2496 1106.5,-2496 1106.5,-2496 1257.5,-2496 1257.5,-2496 1263.5,-2496 1269.5,-2502 1269.5,-2508 1269.5,-2508 1269.5,-2537 1269.5,-2537 1269.5,-2543 1263.5,-2549 1257.5,-2549"/>
<text text-anchor="middle" x="1182" y="-2533.8" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1182" y="-2518.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1182" y="-2503.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- expert_14_0&#45;&gt;expert_agg_14 -->
<g id="edge342" class="edge">
<title>expert_14_0&#45;&gt;expert_agg_14</title>
<path fill="none" stroke="black" d="M278,-2621.96C278,-2577.71 278,-2506 278,-2506 278,-2506 1084.5,-2506 1084.5,-2506"/>
<polygon fill="black" stroke="black" points="1084.5,-2509.5 1094.5,-2506 1084.5,-2502.5 1084.5,-2509.5"/>
</g>
<!-- expert_14_1&#45;&gt;expert_agg_14 -->
<g id="edge343" class="edge">
<title>expert_14_1&#45;&gt;expert_agg_14</title>
<path fill="none" stroke="black" d="M504,-2622C504,-2580.85 504,-2517 504,-2517 504,-2517 1084.41,-2517 1084.41,-2517"/>
<polygon fill="black" stroke="black" points="1084.41,-2520.5 1094.41,-2517 1084.41,-2513.5 1084.41,-2520.5"/>
</g>
<!-- expert_14_2&#45;&gt;expert_agg_14 -->
<g id="edge344" class="edge">
<title>expert_14_2&#45;&gt;expert_agg_14</title>
<path fill="none" stroke="black" d="M730,-2621.77C730,-2583.55 730,-2527 730,-2527 730,-2527 1084.31,-2527 1084.31,-2527"/>
<polygon fill="black" stroke="black" points="1084.31,-2530.5 1094.31,-2527 1084.31,-2523.5 1084.31,-2530.5"/>
</g>
<!-- expert_14_3&#45;&gt;expert_agg_14 -->
<g id="edge345" class="edge">
<title>expert_14_3&#45;&gt;expert_agg_14</title>
<path fill="none" stroke="black" d="M956,-2621.87C956,-2587.02 956,-2538 956,-2538 956,-2538 1084.3,-2538 1084.3,-2538"/>
<polygon fill="black" stroke="black" points="1084.3,-2541.5 1094.3,-2538 1084.3,-2534.5 1084.3,-2541.5"/>
</g>
<!-- expert_14_4&#45;&gt;expert_agg_14 -->
<g id="edge346" class="edge">
<title>expert_14_4&#45;&gt;expert_agg_14</title>
<path fill="none" stroke="black" d="M1182,-2621.97C1182,-2621.97 1182,-2559.32 1182,-2559.32"/>
<polygon fill="black" stroke="black" points="1185.5,-2559.32 1182,-2549.32 1178.5,-2559.32 1185.5,-2559.32"/>
</g>
<!-- expert_14_5&#45;&gt;expert_agg_14 -->
<g id="edge347" class="edge">
<title>expert_14_5&#45;&gt;expert_agg_14</title>
<path fill="none" stroke="black" d="M1374.25,-2621.87C1374.25,-2587.02 1374.25,-2538 1374.25,-2538 1374.25,-2538 1279.69,-2538 1279.69,-2538"/>
<polygon fill="black" stroke="black" points="1279.69,-2534.5 1269.69,-2538 1279.69,-2541.5 1279.69,-2534.5"/>
</g>
<!-- expert_14_6&#45;&gt;expert_agg_14 -->
<g id="edge348" class="edge">
<title>expert_14_6&#45;&gt;expert_agg_14</title>
<path fill="none" stroke="black" d="M1579.75,-2621.77C1579.75,-2583.55 1579.75,-2527 1579.75,-2527 1579.75,-2527 1279.78,-2527 1279.78,-2527"/>
<polygon fill="black" stroke="black" points="1279.78,-2523.5 1269.78,-2527 1279.78,-2530.5 1279.78,-2523.5"/>
</g>
<!-- expert_14_7&#45;&gt;expert_agg_14 -->
<g id="edge349" class="edge">
<title>expert_14_7&#45;&gt;expert_agg_14</title>
<path fill="none" stroke="black" d="M1783.75,-2622C1783.75,-2580.85 1783.75,-2517 1783.75,-2517 1783.75,-2517 1279.82,-2517 1279.82,-2517"/>
<polygon fill="black" stroke="black" points="1279.82,-2513.5 1269.82,-2517 1279.82,-2520.5 1279.82,-2513.5"/>
</g>
<!-- activation_14 -->
<g id="node282" class="node">
<title>activation_14</title>
<path fill="lightyellow" stroke="black" d="M1608.5,-2423C1608.5,-2423 1447.5,-2423 1447.5,-2423 1441.5,-2423 1435.5,-2417 1435.5,-2411 1435.5,-2411 1435.5,-2397 1435.5,-2397 1435.5,-2391 1441.5,-2385 1447.5,-2385 1447.5,-2385 1608.5,-2385 1608.5,-2385 1614.5,-2385 1620.5,-2391 1620.5,-2397 1620.5,-2397 1620.5,-2411 1620.5,-2411 1620.5,-2417 1614.5,-2423 1608.5,-2423"/>
<text text-anchor="middle" x="1528" y="-2407.8" font-family="Arial" font-size="14.00">GELU</text>
<text text-anchor="middle" x="1528" y="-2392.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- expert_agg_14&#45;&gt;activation_14 -->
<g id="edge350" class="edge">
<title>expert_agg_14&#45;&gt;activation_14</title>
<path fill="none" stroke="black" d="M1269.75,-2506C1354.22,-2506 1469.25,-2506 1469.25,-2506 1469.25,-2506 1469.25,-2433.19 1469.25,-2433.19"/>
<polygon fill="black" stroke="black" points="1472.75,-2433.19 1469.25,-2423.19 1465.75,-2433.19 1472.75,-2433.19"/>
</g>
<!-- dense_4h_h_14 -->
<g id="node283" class="node">
<title>dense_4h_h_14</title>
<path fill="lightblue" stroke="black" d="M1790.5,-2312C1790.5,-2312 1629.5,-2312 1629.5,-2312 1623.5,-2312 1617.5,-2306 1617.5,-2300 1617.5,-2300 1617.5,-2256 1617.5,-2256 1617.5,-2250 1623.5,-2244 1629.5,-2244 1629.5,-2244 1790.5,-2244 1790.5,-2244 1796.5,-2244 1802.5,-2250 1802.5,-2256 1802.5,-2256 1802.5,-2300 1802.5,-2300 1802.5,-2306 1796.5,-2312 1790.5,-2312"/>
<text text-anchor="middle" x="1710" y="-2296.8" font-family="Arial" font-size="14.00">Dense 4H→H</text>
<text text-anchor="middle" x="1710" y="-2281.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1710" y="-2266.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1710" y="-2251.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- activation_14&#45;&gt;dense_4h_h_14 -->
<g id="edge351" class="edge">
<title>activation_14&#45;&gt;dense_4h_h_14</title>
<path fill="none" stroke="black" d="M1620.52,-2404C1649.83,-2404 1674.75,-2404 1674.75,-2404 1674.75,-2404 1674.75,-2322.1 1674.75,-2322.1"/>
<polygon fill="black" stroke="black" points="1678.25,-2322.1 1674.75,-2312.1 1671.25,-2322.1 1678.25,-2322.1"/>
</g>
<!-- allreduce_mlp_14 -->
<g id="node284" class="node">
<title>allreduce_mlp_14</title>
<path fill="lightcoral" stroke="black" d="M1892.5,-2171C1892.5,-2171 1759.5,-2171 1759.5,-2171 1753.5,-2171 1747.5,-2165 1747.5,-2159 1747.5,-2159 1747.5,-2145 1747.5,-2145 1747.5,-2139 1753.5,-2133 1759.5,-2133 1759.5,-2133 1892.5,-2133 1892.5,-2133 1898.5,-2133 1904.5,-2139 1904.5,-2145 1904.5,-2145 1904.5,-2159 1904.5,-2159 1904.5,-2165 1898.5,-2171 1892.5,-2171"/>
<text text-anchor="middle" x="1826" y="-2155.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1826" y="-2140.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- dense_4h_h_14&#45;&gt;allreduce_mlp_14 -->
<g id="edge352" class="edge">
<title>dense_4h_h_14&#45;&gt;allreduce_mlp_14</title>
<path fill="none" stroke="black" d="M1775,-2243.9C1775,-2243.9 1775,-2181.24 1775,-2181.24"/>
<polygon fill="black" stroke="black" points="1778.5,-2181.24 1775,-2171.24 1771.5,-2181.24 1778.5,-2181.24"/>
</g>
<!-- residual2_14 -->
<g id="node289" class="node">
<title>residual2_14</title>
<path fill="lightgray" stroke="black" d="M1944.5,-2060C1944.5,-2060 1811.5,-2060 1811.5,-2060 1805.5,-2060 1799.5,-2054 1799.5,-2048 1799.5,-2048 1799.5,-2034 1799.5,-2034 1799.5,-2028 1805.5,-2022 1811.5,-2022 1811.5,-2022 1944.5,-2022 1944.5,-2022 1950.5,-2022 1956.5,-2028 1956.5,-2034 1956.5,-2034 1956.5,-2048 1956.5,-2048 1956.5,-2054 1950.5,-2060 1944.5,-2060"/>
<text text-anchor="middle" x="1878" y="-2044.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1878" y="-2029.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_mlp_14&#45;&gt;residual2_14 -->
<g id="edge360" class="edge">
<title>allreduce_mlp_14&#45;&gt;residual2_14</title>
<path fill="none" stroke="black" d="M1852,-2132.92C1852,-2132.92 1852,-2070.2 1852,-2070.2"/>
<polygon fill="black" stroke="black" points="1855.5,-2070.2 1852,-2060.2 1848.5,-2070.2 1855.5,-2070.2"/>
</g>
<!-- norm1_14 -->
<g id="node286" class="node">
<title>norm1_14</title>
<path fill="lightcyan" stroke="black" d="M1621.5,-3821C1621.5,-3821 1488.5,-3821 1488.5,-3821 1482.5,-3821 1476.5,-3815 1476.5,-3809 1476.5,-3809 1476.5,-3795 1476.5,-3795 1476.5,-3789 1482.5,-3783 1488.5,-3783 1488.5,-3783 1621.5,-3783 1621.5,-3783 1627.5,-3783 1633.5,-3789 1633.5,-3795 1633.5,-3795 1633.5,-3809 1633.5,-3809 1633.5,-3815 1627.5,-3821 1621.5,-3821"/>
<text text-anchor="middle" x="1555" y="-3805.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1555" y="-3790.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- input_14&#45;&gt;norm1_14 -->
<g id="edge353" class="edge">
<title>input_14&#45;&gt;norm1_14</title>
<path fill="none" stroke="black" d="M1587.25,-3898.9C1587.25,-3898.9 1587.25,-3831.23 1587.25,-3831.23"/>
<polygon fill="black" stroke="black" points="1590.75,-3831.23 1587.25,-3821.23 1583.75,-3831.23 1590.75,-3831.23"/>
</g>
<!-- input_14&#45;&gt;residual1_14 -->
<g id="edge354" class="edge">
<title>input_14&#45;&gt;residual1_14</title>
<path fill="none" stroke="black" d="M1701,-3896.73C1701,-3896.73 1701,-3195.15 1701,-3195.15"/>
<polygon fill="black" stroke="black" points="1704.5,-3195.15 1701,-3185.15 1697.5,-3195.15 1704.5,-3195.15"/>
</g>
<!-- norm1_14&#45;&gt;qkv_proj_14 -->
<g id="edge355" class="edge">
<title>norm1_14&#45;&gt;qkv_proj_14</title>
<path fill="none" stroke="black" d="M1555,-3782.81C1555,-3782.81 1555,-3714.06 1555,-3714.06"/>
<polygon fill="black" stroke="black" points="1558.5,-3714.06 1555,-3704.06 1551.5,-3714.06 1558.5,-3714.06"/>
</g>
<!-- norm2_14 -->
<g id="node288" class="node">
<title>norm2_14</title>
<path fill="lightcyan" stroke="black" d="M1730.5,-3074C1730.5,-3074 1597.5,-3074 1597.5,-3074 1591.5,-3074 1585.5,-3068 1585.5,-3062 1585.5,-3062 1585.5,-3048 1585.5,-3048 1585.5,-3042 1591.5,-3036 1597.5,-3036 1597.5,-3036 1730.5,-3036 1730.5,-3036 1736.5,-3036 1742.5,-3042 1742.5,-3048 1742.5,-3048 1742.5,-3062 1742.5,-3062 1742.5,-3068 1736.5,-3074 1730.5,-3074"/>
<text text-anchor="middle" x="1664" y="-3058.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1664" y="-3043.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual1_14&#45;&gt;norm2_14 -->
<g id="edge357" class="edge">
<title>residual1_14&#45;&gt;norm2_14</title>
<path fill="none" stroke="black" d="M1671.5,-3146.92C1671.5,-3146.92 1671.5,-3084.2 1671.5,-3084.2"/>
<polygon fill="black" stroke="black" points="1675,-3084.2 1671.5,-3074.2 1668,-3084.2 1675,-3084.2"/>
</g>
<!-- residual1_14&#45;&gt;residual2_14 -->
<g id="edge358" class="edge">
<title>residual1_14&#45;&gt;residual2_14</title>
<path fill="none" stroke="black" d="M1750,-3147C1750,-3046.87 1750,-2585 1750,-2585 1750,-2585 1929.75,-2585 1929.75,-2585 1929.75,-2585 1929.75,-2070.04 1929.75,-2070.04"/>
<polygon fill="black" stroke="black" points="1933.25,-2070.04 1929.75,-2060.04 1926.25,-2070.04 1933.25,-2070.04"/>
</g>
<!-- norm2_14&#45;&gt;dense_h_4h_14 -->
<g id="edge359" class="edge">
<title>norm2_14&#45;&gt;dense_h_4h_14</title>
<path fill="none" stroke="black" d="M1585.16,-3055C1472.52,-3055 1279,-3055 1279,-3055 1279,-3055 1279,-2967.34 1279,-2967.34"/>
<polygon fill="black" stroke="black" points="1282.5,-2967.34 1279,-2957.34 1275.5,-2967.34 1282.5,-2967.34"/>
</g>
<!-- output_14 -->
<g id="node290" class="node">
<title>output_14</title>
<ellipse fill="white" stroke="black" cx="1878" cy="-1922" rx="111" ry="27"/>
<text text-anchor="middle" x="1878" y="-1925.8" font-family="Arial" font-size="14.00">Layer 15 Output</text>
<text text-anchor="middle" x="1878" y="-1910.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual2_14&#45;&gt;output_14 -->
<g id="edge361" class="edge">
<title>residual2_14&#45;&gt;output_14</title>
<path fill="none" stroke="black" d="M1878,-2021.88C1878,-2021.88 1878,-1959.05 1878,-1959.05"/>
<polygon fill="black" stroke="black" points="1881.5,-1959.05 1878,-1949.05 1874.5,-1959.05 1881.5,-1959.05"/>
</g>
<!-- input_15 -->
<g id="node299" class="node">
<title>input_15</title>
<ellipse fill="white" stroke="black" cx="1878" cy="-1760" rx="111" ry="27"/>
<text text-anchor="middle" x="1878" y="-1763.8" font-family="Arial" font-size="14.00">Layer 16 Input</text>
<text text-anchor="middle" x="1878" y="-1748.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- output_14&#45;&gt;input_15 -->
<g id="edge392" class="edge">
<title>output_14&#45;&gt;input_15</title>
<path fill="none" stroke="red" stroke-width="2" stroke-dasharray="5,2" d="M1878,-1894.88C1878,-1894.88 1878,-1797.2 1878,-1797.2"/>
<polygon fill="red" stroke="red" stroke-width="2" points="1881.5,-1797.2 1878,-1787.2 1874.5,-1797.2 1881.5,-1797.2"/>
<text text-anchor="middle" x="1934" y="-1847.8" font-family="Times,serif" font-size="14.00">GPU&#45;to&#45;GPU</text>
<text text-anchor="middle" x="1934" y="-1832.8" font-family="Times,serif" font-size="14.00">Communication</text>
</g>
<!-- qkv_proj_15 -->
<g id="node291" class="node">
<title>qkv_proj_15</title>
<path fill="lightgreen" stroke="black" d="M1946.5,-1543C1946.5,-1543 1767.5,-1543 1767.5,-1543 1761.5,-1543 1755.5,-1537 1755.5,-1531 1755.5,-1531 1755.5,-1487 1755.5,-1487 1755.5,-1481 1761.5,-1475 1767.5,-1475 1767.5,-1475 1946.5,-1475 1946.5,-1475 1952.5,-1475 1958.5,-1481 1958.5,-1487 1958.5,-1487 1958.5,-1531 1958.5,-1531 1958.5,-1537 1952.5,-1543 1946.5,-1543"/>
<text text-anchor="middle" x="1857" y="-1527.8" font-family="Arial" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1857" y="-1512.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1857" y="-1497.8" font-family="Arial" font-size="14.00">[1024, seq_len, 3*hidden]</text>
<text text-anchor="middle" x="1857" y="-1482.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 3*hidden/tp]</text>
</g>
<!-- attn_comp_15 -->
<g id="node292" class="node">
<title>attn_comp_15</title>
<path fill="lightyellow" stroke="black" d="M1938,-1402C1938,-1402 1790,-1402 1790,-1402 1784,-1402 1778,-1396 1778,-1390 1778,-1390 1778,-1361 1778,-1361 1778,-1355 1784,-1349 1790,-1349 1790,-1349 1938,-1349 1938,-1349 1944,-1349 1950,-1355 1950,-1361 1950,-1361 1950,-1390 1950,-1390 1950,-1396 1944,-1402 1938,-1402"/>
<text text-anchor="middle" x="1864" y="-1386.8" font-family="Arial" font-size="14.00">Attention</text>
<text text-anchor="middle" x="1864" y="-1371.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1864" y="-1356.8" font-family="Arial" font-size="14.00">Heads: 2 per GPU</text>
</g>
<!-- qkv_proj_15&#45;&gt;attn_comp_15 -->
<g id="edge362" class="edge">
<title>qkv_proj_15&#45;&gt;attn_comp_15</title>
<path fill="none" stroke="black" d="M1864,-1474.97C1864,-1474.97 1864,-1412.32 1864,-1412.32"/>
<polygon fill="black" stroke="black" points="1867.5,-1412.32 1864,-1402.32 1860.5,-1412.32 1867.5,-1412.32"/>
</g>
<!-- out_proj_15 -->
<g id="node293" class="node">
<title>out_proj_15</title>
<path fill="lightgreen" stroke="black" d="M1944.5,-1276C1944.5,-1276 1793.5,-1276 1793.5,-1276 1787.5,-1276 1781.5,-1270 1781.5,-1264 1781.5,-1264 1781.5,-1220 1781.5,-1220 1781.5,-1214 1787.5,-1208 1793.5,-1208 1793.5,-1208 1944.5,-1208 1944.5,-1208 1950.5,-1208 1956.5,-1214 1956.5,-1220 1956.5,-1220 1956.5,-1264 1956.5,-1264 1956.5,-1270 1950.5,-1276 1944.5,-1276"/>
<text text-anchor="middle" x="1869" y="-1260.8" font-family="Arial" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="1869" y="-1245.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1869" y="-1230.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden/tp]</text>
<text text-anchor="middle" x="1869" y="-1215.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- attn_comp_15&#45;&gt;out_proj_15 -->
<g id="edge363" class="edge">
<title>attn_comp_15&#45;&gt;out_proj_15</title>
<path fill="none" stroke="black" d="M1865.75,-1348.81C1865.75,-1348.81 1865.75,-1286.26 1865.75,-1286.26"/>
<polygon fill="black" stroke="black" points="1869.25,-1286.26 1865.75,-1276.26 1862.25,-1286.26 1869.25,-1286.26"/>
</g>
<!-- allreduce_attn_15 -->
<g id="node294" class="node">
<title>allreduce_attn_15</title>
<path fill="lightcoral" stroke="black" d="M1944.5,-1135C1944.5,-1135 1811.5,-1135 1811.5,-1135 1805.5,-1135 1799.5,-1129 1799.5,-1123 1799.5,-1123 1799.5,-1109 1799.5,-1109 1799.5,-1103 1805.5,-1097 1811.5,-1097 1811.5,-1097 1944.5,-1097 1944.5,-1097 1950.5,-1097 1956.5,-1103 1956.5,-1109 1956.5,-1109 1956.5,-1123 1956.5,-1123 1956.5,-1129 1950.5,-1135 1944.5,-1135"/>
<text text-anchor="middle" x="1878" y="-1119.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1878" y="-1104.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- out_proj_15&#45;&gt;allreduce_attn_15 -->
<g id="edge364" class="edge">
<title>out_proj_15&#45;&gt;allreduce_attn_15</title>
<path fill="none" stroke="black" d="M1878,-1207.9C1878,-1207.9 1878,-1145.24 1878,-1145.24"/>
<polygon fill="black" stroke="black" points="1881.5,-1145.24 1878,-1135.24 1874.5,-1145.24 1881.5,-1145.24"/>
</g>
<!-- residual1_15 -->
<g id="node301" class="node">
<title>residual1_15</title>
<path fill="lightgray" stroke="black" d="M1954.5,-1024C1954.5,-1024 1821.5,-1024 1821.5,-1024 1815.5,-1024 1809.5,-1018 1809.5,-1012 1809.5,-1012 1809.5,-998 1809.5,-998 1809.5,-992 1815.5,-986 1821.5,-986 1821.5,-986 1954.5,-986 1954.5,-986 1960.5,-986 1966.5,-992 1966.5,-998 1966.5,-998 1966.5,-1012 1966.5,-1012 1966.5,-1018 1960.5,-1024 1954.5,-1024"/>
<text text-anchor="middle" x="1888" y="-1008.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1888" y="-993.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_attn_15&#45;&gt;residual1_15 -->
<g id="edge371" class="edge">
<title>allreduce_attn_15&#45;&gt;residual1_15</title>
<path fill="none" stroke="black" d="M1883,-1096.92C1883,-1096.92 1883,-1034.2 1883,-1034.2"/>
<polygon fill="black" stroke="black" points="1886.5,-1034.2 1883,-1024.2 1879.5,-1034.2 1886.5,-1034.2"/>
</g>
<!-- dense_h_4h_15 -->
<g id="node295" class="node">
<title>dense_h_4h_15</title>
<path fill="lightblue" stroke="black" d="M1946.5,-796C1946.5,-796 1767.5,-796 1767.5,-796 1761.5,-796 1755.5,-790 1755.5,-784 1755.5,-784 1755.5,-740 1755.5,-740 1755.5,-734 1761.5,-728 1767.5,-728 1767.5,-728 1946.5,-728 1946.5,-728 1952.5,-728 1958.5,-734 1958.5,-740 1958.5,-740 1958.5,-784 1958.5,-784 1958.5,-790 1952.5,-796 1946.5,-796"/>
<text text-anchor="middle" x="1857" y="-780.8" font-family="Arial" font-size="14.00">Dense H→4H</text>
<text text-anchor="middle" x="1857" y="-765.8" font-family="Arial" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="1857" y="-750.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
<text text-anchor="middle" x="1857" y="-735.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- activation_15 -->
<g id="node296" class="node">
<title>activation_15</title>
<path fill="lightyellow" stroke="black" d="M1942.5,-655C1942.5,-655 1781.5,-655 1781.5,-655 1775.5,-655 1769.5,-649 1769.5,-643 1769.5,-643 1769.5,-629 1769.5,-629 1769.5,-623 1775.5,-617 1781.5,-617 1781.5,-617 1942.5,-617 1942.5,-617 1948.5,-617 1954.5,-623 1954.5,-629 1954.5,-629 1954.5,-643 1954.5,-643 1954.5,-649 1948.5,-655 1942.5,-655"/>
<text text-anchor="middle" x="1862" y="-639.8" font-family="Arial" font-size="14.00">GELU</text>
<text text-anchor="middle" x="1862" y="-624.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
</g>
<!-- dense_h_4h_15&#45;&gt;activation_15 -->
<g id="edge365" class="edge">
<title>dense_h_4h_15&#45;&gt;activation_15</title>
<path fill="none" stroke="black" d="M1862,-727.9C1862,-727.9 1862,-665.24 1862,-665.24"/>
<polygon fill="black" stroke="black" points="1865.5,-665.24 1862,-655.24 1858.5,-665.24 1865.5,-665.24"/>
</g>
<!-- dense_4h_h_15 -->
<g id="node297" class="node">
<title>dense_4h_h_15</title>
<path fill="lightblue" stroke="black" d="M1945.5,-544C1945.5,-544 1784.5,-544 1784.5,-544 1778.5,-544 1772.5,-538 1772.5,-532 1772.5,-532 1772.5,-488 1772.5,-488 1772.5,-482 1778.5,-476 1784.5,-476 1784.5,-476 1945.5,-476 1945.5,-476 1951.5,-476 1957.5,-482 1957.5,-488 1957.5,-488 1957.5,-532 1957.5,-532 1957.5,-538 1951.5,-544 1945.5,-544"/>
<text text-anchor="middle" x="1865" y="-528.8" font-family="Arial" font-size="14.00">Dense 4H→H</text>
<text text-anchor="middle" x="1865" y="-513.8" font-family="Arial" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="1865" y="-498.8" font-family="Arial" font-size="14.00">[1024, seq_len, 4*hidden/tp]</text>
<text text-anchor="middle" x="1865" y="-483.8" font-family="Arial" font-size="14.00">→ [1024, seq_len, hidden]</text>
</g>
<!-- activation_15&#45;&gt;dense_4h_h_15 -->
<g id="edge366" class="edge">
<title>activation_15&#45;&gt;dense_4h_h_15</title>
<path fill="none" stroke="black" d="M1863.5,-616.86C1863.5,-616.86 1863.5,-554.07 1863.5,-554.07"/>
<polygon fill="black" stroke="black" points="1867,-554.07 1863.5,-544.07 1860,-554.07 1867,-554.07"/>
</g>
<!-- allreduce_mlp_15 -->
<g id="node298" class="node">
<title>allreduce_mlp_15</title>
<path fill="lightcoral" stroke="black" d="M1937.5,-403C1937.5,-403 1804.5,-403 1804.5,-403 1798.5,-403 1792.5,-397 1792.5,-391 1792.5,-391 1792.5,-377 1792.5,-377 1792.5,-371 1798.5,-365 1804.5,-365 1804.5,-365 1937.5,-365 1937.5,-365 1943.5,-365 1949.5,-371 1949.5,-377 1949.5,-377 1949.5,-391 1949.5,-391 1949.5,-397 1943.5,-403 1937.5,-403"/>
<text text-anchor="middle" x="1871" y="-387.8" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1871" y="-372.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- dense_4h_h_15&#45;&gt;allreduce_mlp_15 -->
<g id="edge367" class="edge">
<title>dense_4h_h_15&#45;&gt;allreduce_mlp_15</title>
<path fill="none" stroke="black" d="M1871,-475.9C1871,-475.9 1871,-413.24 1871,-413.24"/>
<polygon fill="black" stroke="black" points="1874.5,-413.24 1871,-403.24 1867.5,-413.24 1874.5,-413.24"/>
</g>
<!-- residual2_15 -->
<g id="node303" class="node">
<title>residual2_15</title>
<path fill="lightgray" stroke="black" d="M1938.5,-292C1938.5,-292 1805.5,-292 1805.5,-292 1799.5,-292 1793.5,-286 1793.5,-280 1793.5,-280 1793.5,-266 1793.5,-266 1793.5,-260 1799.5,-254 1805.5,-254 1805.5,-254 1938.5,-254 1938.5,-254 1944.5,-254 1950.5,-260 1950.5,-266 1950.5,-266 1950.5,-280 1950.5,-280 1950.5,-286 1944.5,-292 1938.5,-292"/>
<text text-anchor="middle" x="1872" y="-276.8" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1872" y="-261.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- allreduce_mlp_15&#45;&gt;residual2_15 -->
<g id="edge375" class="edge">
<title>allreduce_mlp_15&#45;&gt;residual2_15</title>
<path fill="none" stroke="black" d="M1871.5,-364.92C1871.5,-364.92 1871.5,-302.2 1871.5,-302.2"/>
<polygon fill="black" stroke="black" points="1875,-302.2 1871.5,-292.2 1868,-302.2 1875,-302.2"/>
</g>
<!-- norm1_15 -->
<g id="node300" class="node">
<title>norm1_15</title>
<path fill="lightcyan" stroke="black" d="M1935.5,-1660C1935.5,-1660 1802.5,-1660 1802.5,-1660 1796.5,-1660 1790.5,-1654 1790.5,-1648 1790.5,-1648 1790.5,-1634 1790.5,-1634 1790.5,-1628 1796.5,-1622 1802.5,-1622 1802.5,-1622 1935.5,-1622 1935.5,-1622 1941.5,-1622 1947.5,-1628 1947.5,-1634 1947.5,-1634 1947.5,-1648 1947.5,-1648 1947.5,-1654 1941.5,-1660 1935.5,-1660"/>
<text text-anchor="middle" x="1869" y="-1644.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1869" y="-1629.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- input_15&#45;&gt;norm1_15 -->
<g id="edge368" class="edge">
<title>input_15&#45;&gt;norm1_15</title>
<path fill="none" stroke="black" d="M1869,-1733C1869,-1733 1869,-1670.12 1869,-1670.12"/>
<polygon fill="black" stroke="black" points="1872.5,-1670.12 1869,-1660.12 1865.5,-1670.12 1872.5,-1670.12"/>
</g>
<!-- input_15&#45;&gt;residual1_15 -->
<g id="edge369" class="edge">
<title>input_15&#45;&gt;residual1_15</title>
<path fill="none" stroke="black" d="M1962.5,-1742.45C1962.5,-1742.45 1962.5,-1034.15 1962.5,-1034.15"/>
<polygon fill="black" stroke="black" points="1966,-1034.15 1962.5,-1024.15 1959,-1034.15 1966,-1034.15"/>
</g>
<!-- norm1_15&#45;&gt;qkv_proj_15 -->
<g id="edge370" class="edge">
<title>norm1_15&#45;&gt;qkv_proj_15</title>
<path fill="none" stroke="black" d="M1869,-1621.81C1869,-1621.81 1869,-1553.06 1869,-1553.06"/>
<polygon fill="black" stroke="black" points="1872.5,-1553.06 1869,-1543.06 1865.5,-1553.06 1872.5,-1553.06"/>
</g>
<!-- norm2_15 -->
<g id="node302" class="node">
<title>norm2_15</title>
<path fill="lightcyan" stroke="black" d="M1940.5,-913C1940.5,-913 1807.5,-913 1807.5,-913 1801.5,-913 1795.5,-907 1795.5,-901 1795.5,-901 1795.5,-887 1795.5,-887 1795.5,-881 1801.5,-875 1807.5,-875 1807.5,-875 1940.5,-875 1940.5,-875 1946.5,-875 1952.5,-881 1952.5,-887 1952.5,-887 1952.5,-901 1952.5,-901 1952.5,-907 1946.5,-913 1940.5,-913"/>
<text text-anchor="middle" x="1874" y="-897.8" font-family="Arial" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1874" y="-882.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual1_15&#45;&gt;norm2_15 -->
<g id="edge372" class="edge">
<title>residual1_15&#45;&gt;norm2_15</title>
<path fill="none" stroke="black" d="M1881,-985.92C1881,-985.92 1881,-923.2 1881,-923.2"/>
<polygon fill="black" stroke="black" points="1884.5,-923.2 1881,-913.2 1877.5,-923.2 1884.5,-923.2"/>
</g>
<!-- residual1_15&#45;&gt;residual2_15 -->
<g id="edge373" class="edge">
<title>residual1_15&#45;&gt;residual2_15</title>
<path fill="none" stroke="black" d="M1962.5,-985.8C1962.5,-870.3 1962.5,-273 1962.5,-273 1962.5,-273 1960.67,-273 1960.67,-273"/>
<polygon fill="black" stroke="black" points="1960.67,-269.5 1950.67,-273 1960.67,-276.5 1960.67,-269.5"/>
</g>
<!-- norm2_15&#45;&gt;dense_h_4h_15 -->
<g id="edge374" class="edge">
<title>norm2_15&#45;&gt;dense_h_4h_15</title>
<path fill="none" stroke="black" d="M1874,-874.81C1874,-874.81 1874,-806.06 1874,-806.06"/>
<polygon fill="black" stroke="black" points="1877.5,-806.06 1874,-796.06 1870.5,-806.06 1877.5,-806.06"/>
</g>
<!-- output_15 -->
<g id="node304" class="node">
<title>output_15</title>
<ellipse fill="white" stroke="black" cx="1872" cy="-154" rx="111" ry="27"/>
<text text-anchor="middle" x="1872" y="-157.8" font-family="Arial" font-size="14.00">Layer 16 Output</text>
<text text-anchor="middle" x="1872" y="-142.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- residual2_15&#45;&gt;output_15 -->
<g id="edge376" class="edge">
<title>residual2_15&#45;&gt;output_15</title>
<path fill="none" stroke="black" d="M1872,-253.88C1872,-253.88 1872,-191.05 1872,-191.05"/>
<polygon fill="black" stroke="black" points="1875.5,-191.05 1872,-181.05 1868.5,-191.05 1875.5,-191.05"/>
</g>
<!-- output -->
<g id="node306" class="node">
<title>output</title>
<ellipse fill="#e6e6e6" stroke="black" cx="1872" cy="-27" rx="111" ry="27"/>
<text text-anchor="middle" x="1872" y="-30.8" font-family="Arial" font-size="14.00">Model Output</text>
<text text-anchor="middle" x="1872" y="-15.8" font-family="Arial" font-size="14.00">[1024, seq_len, hidden]</text>
</g>
<!-- output_15&#45;&gt;output -->
<g id="edge393" class="edge">
<title>output_15&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1872,-126.76C1872,-126.76 1872,-64.2 1872,-64.2"/>
<polygon fill="black" stroke="black" points="1875.5,-64.2 1872,-54.2 1868.5,-64.2 1875.5,-64.2"/>
</g>
<!-- input -->
<g id="node305" class="node">
<title>input</title>
<ellipse fill="#e6e6e6" stroke="black" cx="2007" cy="-31557" rx="140" ry="27"/>
<text text-anchor="middle" x="2007" y="-31560.8" font-family="Arial" font-size="14.00">Model Input</text>
<text text-anchor="middle" x="2007" y="-31545.8" font-family="Arial" font-size="14.00">[batch=1024, seq_len, hidden]</text>
</g>
<!-- input&#45;&gt;input_0 -->
<g id="edge377" class="edge">
<title>input&#45;&gt;input_0</title>
<path fill="none" stroke="black" d="M2007,-31529.76C2007,-31529.76 2007,-31461.2 2007,-31461.2"/>
<polygon fill="black" stroke="black" points="2010.5,-31461.2 2007,-31451.2 2003.5,-31461.2 2010.5,-31461.2"/>
</g>
</g>
</svg>
