<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="1800pt" height="8pt"
 viewBox="0.00 0.00 1800.00 8.44" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.01 0.01) rotate(0) translate(4 601)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-601 128979,-601 128979,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_gpu_0</title>
<path fill="lightblue" stroke="lightblue" d="M12108,-280.5C12108,-280.5 24163,-280.5 24163,-280.5 24169,-280.5 24175,-286.5 24175,-292.5 24175,-292.5 24175,-577 24175,-577 24175,-583 24169,-589 24163,-589 24163,-589 12108,-589 12108,-589 12102,-589 12096,-583 12096,-577 12096,-577 12096,-292.5 12096,-292.5 12096,-286.5 12102,-280.5 12108,-280.5"/>
<text text-anchor="middle" x="18135.5" y="-573.8" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_gpu_1</title>
<path fill="lightblue" stroke="lightblue" d="M20,-280.5C20,-280.5 12076,-280.5 12076,-280.5 12082,-280.5 12088,-286.5 12088,-292.5 12088,-292.5 12088,-577 12088,-577 12088,-583 12082,-589 12076,-589 12076,-589 20,-589 20,-589 14,-589 8,-583 8,-577 8,-577 8,-292.5 8,-292.5 8,-286.5 14,-280.5 20,-280.5"/>
<text text-anchor="middle" x="6048" y="-573.8" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_gpu_2</title>
<path fill="lightblue" stroke="lightblue" d="M25341,-280.5C25341,-280.5 37398,-280.5 37398,-280.5 37404,-280.5 37410,-286.5 37410,-292.5 37410,-292.5 37410,-577 37410,-577 37410,-583 37404,-589 37398,-589 37398,-589 25341,-589 25341,-589 25335,-589 25329,-583 25329,-577 25329,-577 25329,-292.5 25329,-292.5 25329,-286.5 25335,-280.5 25341,-280.5"/>
<text text-anchor="middle" x="31369.5" y="-573.8" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_gpu_3</title>
<path fill="lightblue" stroke="lightblue" d="M37430,-280.5C37430,-280.5 49487,-280.5 49487,-280.5 49493,-280.5 49499,-286.5 49499,-292.5 49499,-292.5 49499,-577 49499,-577 49499,-583 49493,-589 49487,-589 49487,-589 37430,-589 37430,-589 37424,-589 37418,-583 37418,-577 37418,-577 37418,-292.5 37418,-292.5 37418,-286.5 37424,-280.5 37430,-280.5"/>
<text text-anchor="middle" x="43458.5" y="-573.8" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_gpu_4</title>
<path fill="lightblue" stroke="lightblue" d="M49519,-280.5C49519,-280.5 55753,-280.5 55753,-280.5 55759,-280.5 55765,-286.5 55765,-292.5 55765,-292.5 55765,-577 55765,-577 55765,-583 55759,-589 55753,-589 55753,-589 49519,-589 49519,-589 49513,-589 49507,-583 49507,-577 49507,-577 49507,-292.5 49507,-292.5 49507,-286.5 49513,-280.5 49519,-280.5"/>
<text text-anchor="middle" x="52636" y="-573.8" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_gpu_5</title>
<path fill="lightblue" stroke="lightblue" d="M55785,-280.5C55785,-280.5 62018,-280.5 62018,-280.5 62024,-280.5 62030,-286.5 62030,-292.5 62030,-292.5 62030,-577 62030,-577 62030,-583 62024,-589 62018,-589 62018,-589 55785,-589 55785,-589 55779,-589 55773,-583 55773,-577 55773,-577 55773,-292.5 55773,-292.5 55773,-286.5 55779,-280.5 55785,-280.5"/>
<text text-anchor="middle" x="58901.5" y="-573.8" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_gpu_6</title>
<path fill="lightblue" stroke="lightblue" d="M63196,-280.5C63196,-280.5 69429,-280.5 69429,-280.5 69435,-280.5 69441,-286.5 69441,-292.5 69441,-292.5 69441,-577 69441,-577 69441,-583 69435,-589 69429,-589 69429,-589 63196,-589 63196,-589 63190,-589 63184,-583 63184,-577 63184,-577 63184,-292.5 63184,-292.5 63184,-286.5 63190,-280.5 63196,-280.5"/>
<text text-anchor="middle" x="66312.5" y="-573.8" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_gpu_7</title>
<path fill="lightblue" stroke="lightblue" d="M69461,-280.5C69461,-280.5 75694,-280.5 75694,-280.5 75700,-280.5 75706,-286.5 75706,-292.5 75706,-292.5 75706,-577 75706,-577 75706,-583 75700,-589 75694,-589 75694,-589 69461,-589 69461,-589 69455,-589 69449,-583 69449,-577 69449,-577 69449,-292.5 69449,-292.5 69449,-286.5 69455,-280.5 69461,-280.5"/>
<text text-anchor="middle" x="72577.5" y="-573.8" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_gpu_8</title>
<path fill="lightblue" stroke="lightblue" d="M76657,-280.5C76657,-280.5 82890,-280.5 82890,-280.5 82896,-280.5 82902,-286.5 82902,-292.5 82902,-292.5 82902,-577 82902,-577 82902,-583 82896,-589 82890,-589 82890,-589 76657,-589 76657,-589 76651,-589 76645,-583 76645,-577 76645,-577 76645,-292.5 76645,-292.5 76645,-286.5 76651,-280.5 76657,-280.5"/>
<text text-anchor="middle" x="79773.5" y="-573.8" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<g id="clust10" class="cluster">
<title>cluster_gpu_9</title>
<path fill="lightblue" stroke="lightblue" d="M82922,-280.5C82922,-280.5 89154,-280.5 89154,-280.5 89160,-280.5 89166,-286.5 89166,-292.5 89166,-292.5 89166,-577 89166,-577 89166,-583 89160,-589 89154,-589 89154,-589 82922,-589 82922,-589 82916,-589 82910,-583 82910,-577 82910,-577 82910,-292.5 82910,-292.5 82910,-286.5 82916,-280.5 82922,-280.5"/>
<text text-anchor="middle" x="86038" y="-573.8" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<g id="clust11" class="cluster">
<title>cluster_gpu_10</title>
<path fill="lightblue" stroke="lightblue" d="M90294,-280.5C90294,-280.5 96527,-280.5 96527,-280.5 96533,-280.5 96539,-286.5 96539,-292.5 96539,-292.5 96539,-577 96539,-577 96539,-583 96533,-589 96527,-589 96527,-589 90294,-589 90294,-589 90288,-589 90282,-583 90282,-577 90282,-577 90282,-292.5 90282,-292.5 90282,-286.5 90288,-280.5 90294,-280.5"/>
<text text-anchor="middle" x="93410.5" y="-573.8" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<g id="clust12" class="cluster">
<title>cluster_gpu_11</title>
<path fill="lightblue" stroke="lightblue" d="M96559,-280.5C96559,-280.5 102792,-280.5 102792,-280.5 102798,-280.5 102804,-286.5 102804,-292.5 102804,-292.5 102804,-577 102804,-577 102804,-583 102798,-589 102792,-589 102792,-589 96559,-589 96559,-589 96553,-589 96547,-583 96547,-577 96547,-577 96547,-292.5 96547,-292.5 96547,-286.5 96553,-280.5 96559,-280.5"/>
<text text-anchor="middle" x="99675.5" y="-573.8" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<g id="clust13" class="cluster">
<title>cluster_gpu_12</title>
<path fill="lightblue" stroke="lightblue" d="M102824,-280.5C102824,-280.5 109056,-280.5 109056,-280.5 109062,-280.5 109068,-286.5 109068,-292.5 109068,-292.5 109068,-577 109068,-577 109068,-583 109062,-589 109056,-589 109056,-589 102824,-589 102824,-589 102818,-589 102812,-583 102812,-577 102812,-577 102812,-292.5 102812,-292.5 102812,-286.5 102818,-280.5 102824,-280.5"/>
<text text-anchor="middle" x="105940" y="-573.8" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<g id="clust14" class="cluster">
<title>cluster_gpu_13</title>
<path fill="lightblue" stroke="lightblue" d="M109088,-280.5C109088,-280.5 115319,-280.5 115319,-280.5 115325,-280.5 115331,-286.5 115331,-292.5 115331,-292.5 115331,-577 115331,-577 115331,-583 115325,-589 115319,-589 115319,-589 109088,-589 109088,-589 109082,-589 109076,-583 109076,-577 109076,-577 109076,-292.5 109076,-292.5 109076,-286.5 109082,-280.5 109088,-280.5"/>
<text text-anchor="middle" x="112203.5" y="-573.8" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<g id="clust15" class="cluster">
<title>cluster_gpu_14</title>
<path fill="lightblue" stroke="lightblue" d="M116459,-280.5C116459,-280.5 122691,-280.5 122691,-280.5 122697,-280.5 122703,-286.5 122703,-292.5 122703,-292.5 122703,-577 122703,-577 122703,-583 122697,-589 122691,-589 122691,-589 116459,-589 116459,-589 116453,-589 116447,-583 116447,-577 116447,-577 116447,-292.5 116447,-292.5 116447,-286.5 116453,-280.5 116459,-280.5"/>
<text text-anchor="middle" x="119575" y="-573.8" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<g id="clust16" class="cluster">
<title>cluster_gpu_15</title>
<path fill="lightblue" stroke="lightblue" d="M122723,-280.5C122723,-280.5 128955,-280.5 128955,-280.5 128961,-280.5 128967,-286.5 128967,-292.5 128967,-292.5 128967,-577 128967,-577 128967,-583 128961,-589 128955,-589 128955,-589 122723,-589 122723,-589 122717,-589 122711,-583 122711,-577 122711,-577 122711,-292.5 122711,-292.5 122711,-286.5 122717,-280.5 122723,-280.5"/>
<text text-anchor="middle" x="125839" y="-573.8" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- embed_0 -->
<g id="node1" class="node">
<title>embed_0</title>
<polygon fill="none" stroke="black" points="12324,-516.5 12104,-516.5 12104,-463.5 12324,-463.5 12324,-516.5"/>
<text text-anchor="middle" x="12214" y="-501.3" font-family="Times,serif" font-size="14.00">Input Embedding</text>
<text text-anchor="middle" x="12214" y="-486.3" font-family="Times,serif" font-size="14.00">[B=1024, L=2048, D=8192]</text>
<text text-anchor="middle" x="12214" y="-471.3" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer0_gpu0_ln1 -->
<g id="node2" class="node">
<title>layer0_gpu0_ln1</title>
<ellipse fill="none" stroke="black" cx="12214" cy="-326" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="12214" y="-337.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="12214" y="-322.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="12214" y="-307.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- embed_0&#45;&gt;layer0_gpu0_ln1 -->
<g id="edge1" class="edge">
<title>embed_0&#45;&gt;layer0_gpu0_ln1</title>
<path fill="none" stroke="black" d="M12214,-463.33C12214,-439.41 12214,-403.17 12214,-374.06"/>
<polygon fill="black" stroke="black" points="12217.5,-373.69 12214,-363.69 12210.5,-373.69 12217.5,-373.69"/>
</g>
<!-- layer0_gpu0_qkv -->
<g id="node3" class="node">
<title>layer0_gpu0_qkv</title>
<polygon fill="none" stroke="black" points="24001,-524 23871,-524 23871,-456 24001,-456 24001,-524"/>
<text text-anchor="middle" x="23936" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="23936" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="23936" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="23936" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer0_gpu0_reshape -->
<g id="node4" class="node">
<title>layer0_gpu0_reshape</title>
<ellipse fill="none" stroke="black" cx="23785" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="23785" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="23785" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="23785" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer0_gpu0_attn -->
<g id="node5" class="node">
<title>layer0_gpu0_attn</title>
<polygon fill="none" stroke="black" points="23544,-558 23389,-490 23544,-422 23699,-490 23544,-558"/>
<text text-anchor="middle" x="23544" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="23544" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="23544" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="23544" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer0_gpu0_out_proj -->
<g id="node6" class="node">
<title>layer0_gpu0_out_proj</title>
<polygon fill="none" stroke="black" points="16859,-524 16715,-524 16715,-456 16859,-456 16859,-524"/>
<text text-anchor="middle" x="16787" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="16787" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="16787" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="16787" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer0_concat_group0 -->
<g id="node657" class="node">
<title>layer0_concat_group0</title>
<polygon fill="yellow" stroke="black" points="24971,-302.8 24971,-349.2 24899.53,-382 24798.47,-382 24727,-349.2 24727,-302.8 24798.47,-270 24899.53,-270 24971,-302.8"/>
<polygon fill="none" stroke="black" points="24975,-300.24 24975,-351.76 24900.41,-386 24797.59,-386 24723,-351.76 24723,-300.24 24797.59,-266 24900.41,-266 24975,-300.24"/>
<text text-anchor="middle" x="24849" y="-344.8" font-family="Times,serif" font-size="14.00">Concat Dimensions</text>
<text text-anchor="middle" x="24849" y="-329.8" font-family="Times,serif" font-size="14.00">Head Group 0</text>
<text text-anchor="middle" x="24849" y="-314.8" font-family="Times,serif" font-size="14.00">[B,L,4,512]</text>
<text text-anchor="middle" x="24849" y="-299.8" font-family="Times,serif" font-size="14.00">GPUs 0&#45;3</text>
</g>
<!-- layer0_gpu0_out_proj&#45;&gt;layer0_concat_group0 -->
<g id="edge17" class="edge">
<title>layer0_gpu0_out_proj&#45;&gt;layer0_concat_group0</title>
<path fill="none" stroke="black" d="M16816.81,-455.86C16830.88,-442.66 16848.78,-428.97 16868,-422 17072.89,-347.71 24500.76,-431.07 24714,-386 24727.29,-383.19 24740.88,-379.01 24754.06,-374.14"/>
<polygon fill="black" stroke="black" points="24755.5,-377.34 24763.59,-370.49 24753,-370.8 24755.5,-377.34"/>
</g>
<!-- layer0_gpu0_ln2 -->
<g id="node7" class="node">
<title>layer0_gpu0_ln2</title>
<ellipse fill="none" stroke="black" cx="23044" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="23044" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="23044" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="23044" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer0_gpu0_gate -->
<g id="node8" class="node">
<title>layer0_gpu0_gate</title>
<ellipse fill="none" stroke="black" cx="22877" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="22877" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="22877" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="22877" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer0_expert_all2all -->
<g id="node658" class="node">
<title>layer0_expert_all2all</title>
<polygon fill="purple" stroke="black" points="76397.5,-307.57 76397.5,-344.43 76336.29,-370.5 76249.71,-370.5 76188.5,-344.43 76188.5,-307.57 76249.71,-281.5 76336.29,-281.5 76397.5,-307.57"/>
<polygon fill="none" stroke="black" points="76401.5,-304.92 76401.5,-347.08 76337.1,-374.5 76248.9,-374.5 76184.5,-347.08 76184.5,-304.92 76248.9,-277.5 76337.1,-277.5 76401.5,-304.92"/>
<text text-anchor="middle" x="76293" y="-337.3" font-family="Times,serif" font-size="14.00">Expert All&#45;to&#45;All</text>
<text text-anchor="middle" x="76293" y="-322.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="76293" y="-307.3" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer0_gpu0_gate&#45;&gt;layer0_expert_all2all -->
<g id="edge18" class="edge">
<title>layer0_gpu0_gate&#45;&gt;layer0_expert_all2all</title>
<path fill="none" stroke="black" d="M22907.62,-455.47C22921.81,-442.37 22939.78,-428.86 22959,-422 23133.03,-359.88 75996.25,-428.82 76176,-386 76190.7,-382.5 76205.66,-376.84 76219.74,-370.38"/>
<polygon fill="black" stroke="black" points="76221.34,-373.49 76228.86,-366.03 76218.32,-367.18 76221.34,-373.49"/>
</g>
<!-- layer0_gpu0_expert0_mlp1 -->
<g id="node9" class="node">
<title>layer0_gpu0_expert0_mlp1</title>
<polygon fill="none" stroke="black" points="22785.5,-516.5 22648.5,-516.5 22648.5,-463.5 22785.5,-463.5 22785.5,-516.5"/>
<text text-anchor="middle" x="22717" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 0 Dense1</text>
<text text-anchor="middle" x="22717" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="22717" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer0_gpu0_expert0_gelu -->
<g id="node10" class="node">
<title>layer0_gpu0_expert0_gelu</title>
<ellipse fill="none" stroke="black" cx="22535" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="22535" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 0 GELU</text>
<text text-anchor="middle" x="22535" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="22535" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer0_gpu0_expert0_mlp2 -->
<g id="node11" class="node">
<title>layer0_gpu0_expert0_mlp2</title>
<polygon fill="none" stroke="black" points="22421.5,-516.5 22284.5,-516.5 22284.5,-463.5 22421.5,-463.5 22421.5,-516.5"/>
<text text-anchor="middle" x="22353" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 0 Dense2</text>
<text text-anchor="middle" x="22353" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="22353" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer0_gpu0_expert0_weight -->
<g id="node12" class="node">
<title>layer0_gpu0_expert0_weight</title>
<ellipse fill="none" stroke="black" cx="22171" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="22171" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 0 Weight</text>
<text text-anchor="middle" x="22171" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="22171" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer0_gpu0_expert1_mlp1 -->
<g id="node13" class="node">
<title>layer0_gpu0_expert1_mlp1</title>
<polygon fill="none" stroke="black" points="22057.5,-516.5 21920.5,-516.5 21920.5,-463.5 22057.5,-463.5 22057.5,-516.5"/>
<text text-anchor="middle" x="21989" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 1 Dense1</text>
<text text-anchor="middle" x="21989" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="21989" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer0_gpu0_expert1_gelu -->
<g id="node14" class="node">
<title>layer0_gpu0_expert1_gelu</title>
<ellipse fill="none" stroke="black" cx="21807" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="21807" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 1 GELU</text>
<text text-anchor="middle" x="21807" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="21807" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer0_gpu0_expert1_mlp2 -->
<g id="node15" class="node">
<title>layer0_gpu0_expert1_mlp2</title>
<polygon fill="none" stroke="black" points="21693.5,-516.5 21556.5,-516.5 21556.5,-463.5 21693.5,-463.5 21693.5,-516.5"/>
<text text-anchor="middle" x="21625" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 1 Dense2</text>
<text text-anchor="middle" x="21625" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="21625" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer0_gpu0_expert1_weight -->
<g id="node16" class="node">
<title>layer0_gpu0_expert1_weight</title>
<ellipse fill="none" stroke="black" cx="21443" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="21443" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 1 Weight</text>
<text text-anchor="middle" x="21443" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="21443" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer0_gpu0_moe_agg -->
<g id="node17" class="node">
<title>layer0_gpu0_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="21325.5,-471.57 21325.5,-508.43 21259.6,-534.5 21166.4,-534.5 21100.5,-508.43 21100.5,-471.57 21166.4,-445.5 21259.6,-445.5 21325.5,-471.57"/>
<polygon fill="none" stroke="black" points="21329.5,-468.85 21329.5,-511.15 21260.36,-538.5 21165.64,-538.5 21096.5,-511.15 21096.5,-468.85 21165.64,-441.5 21260.36,-441.5 21329.5,-468.85"/>
<text text-anchor="middle" x="21213" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="21213" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="21213" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer1_gpu0_ln1 -->
<g id="node18" class="node">
<title>layer1_gpu0_ln1</title>
<ellipse fill="none" stroke="black" cx="14211" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="14211" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="14211" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="14211" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer1_gpu0_qkv -->
<g id="node19" class="node">
<title>layer1_gpu0_qkv</title>
<polygon fill="none" stroke="black" points="20913,-524 20783,-524 20783,-456 20913,-456 20913,-524"/>
<text text-anchor="middle" x="20848" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="20848" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="20848" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="20848" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer1_gpu0_reshape -->
<g id="node20" class="node">
<title>layer1_gpu0_reshape</title>
<ellipse fill="none" stroke="black" cx="20697" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="20697" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="20697" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="20697" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer1_gpu0_attn -->
<g id="node21" class="node">
<title>layer1_gpu0_attn</title>
<polygon fill="none" stroke="black" points="20456,-558 20301,-490 20456,-422 20611,-490 20456,-558"/>
<text text-anchor="middle" x="20456" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="20456" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="20456" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="20456" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer1_gpu0_out_proj -->
<g id="node22" class="node">
<title>layer1_gpu0_out_proj</title>
<polygon fill="none" stroke="black" points="15079,-524 14935,-524 14935,-456 15079,-456 15079,-524"/>
<text text-anchor="middle" x="15007" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="15007" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="15007" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="15007" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer1_concat_group0 -->
<g id="node659" class="node">
<title>layer1_concat_group0</title>
<polygon fill="yellow" stroke="black" points="24431,-302.8 24431,-349.2 24359.53,-382 24258.47,-382 24187,-349.2 24187,-302.8 24258.47,-270 24359.53,-270 24431,-302.8"/>
<polygon fill="none" stroke="black" points="24435,-300.24 24435,-351.76 24360.41,-386 24257.59,-386 24183,-351.76 24183,-300.24 24257.59,-266 24360.41,-266 24435,-300.24"/>
<text text-anchor="middle" x="24309" y="-344.8" font-family="Times,serif" font-size="14.00">Concat Dimensions</text>
<text text-anchor="middle" x="24309" y="-329.8" font-family="Times,serif" font-size="14.00">Head Group 0</text>
<text text-anchor="middle" x="24309" y="-314.8" font-family="Times,serif" font-size="14.00">[B,L,4,512]</text>
<text text-anchor="middle" x="24309" y="-299.8" font-family="Times,serif" font-size="14.00">GPUs 0&#45;3</text>
</g>
<!-- layer1_gpu0_out_proj&#45;&gt;layer1_concat_group0 -->
<g id="edge19" class="edge">
<title>layer1_gpu0_out_proj&#45;&gt;layer1_concat_group0</title>
<path fill="none" stroke="black" d="M15036.81,-455.86C15050.88,-442.66 15068.78,-428.96 15088,-422 15325.43,-336 23932.28,-439.88 24179,-386 24191.13,-383.35 24203.5,-379.48 24215.54,-374.96"/>
<polygon fill="black" stroke="black" points="24217.07,-378.12 24225.11,-371.21 24214.52,-371.6 24217.07,-378.12"/>
</g>
<!-- layer1_gpu0_ln2 -->
<g id="node23" class="node">
<title>layer1_gpu0_ln2</title>
<ellipse fill="none" stroke="black" cx="19956" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="19956" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="19956" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="19956" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer1_gpu0_gate -->
<g id="node24" class="node">
<title>layer1_gpu0_gate</title>
<ellipse fill="none" stroke="black" cx="21005" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="21005" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="21005" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="21005" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer1_expert_all2all -->
<g id="node660" class="node">
<title>layer1_expert_all2all</title>
<polygon fill="purple" stroke="black" points="76162.5,-307.57 76162.5,-344.43 76101.29,-370.5 76014.71,-370.5 75953.5,-344.43 75953.5,-307.57 76014.71,-281.5 76101.29,-281.5 76162.5,-307.57"/>
<polygon fill="none" stroke="black" points="76166.5,-304.92 76166.5,-347.08 76102.1,-374.5 76013.9,-374.5 75949.5,-347.08 75949.5,-304.92 76013.9,-277.5 76102.1,-277.5 76166.5,-304.92"/>
<text text-anchor="middle" x="76058" y="-337.3" font-family="Times,serif" font-size="14.00">Expert All&#45;to&#45;All</text>
<text text-anchor="middle" x="76058" y="-322.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="76058" y="-307.3" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer1_gpu0_gate&#45;&gt;layer1_expert_all2all -->
<g id="edge20" class="edge">
<title>layer1_gpu0_gate&#45;&gt;layer1_expert_all2all</title>
<path fill="none" stroke="black" d="M21035.68,-455.82C21050.11,-442.6 21068.45,-428.91 21088,-422 21267.57,-358.5 75755.72,-430.14 75941,-386 75955.7,-382.5 75970.66,-376.84 75984.74,-370.38"/>
<polygon fill="black" stroke="black" points="75986.34,-373.49 75993.86,-366.03 75983.32,-367.18 75986.34,-373.49"/>
</g>
<!-- layer1_gpu0_expert0_mlp1 -->
<g id="node25" class="node">
<title>layer1_gpu0_expert0_mlp1</title>
<polygon fill="none" stroke="black" points="19697.5,-516.5 19560.5,-516.5 19560.5,-463.5 19697.5,-463.5 19697.5,-516.5"/>
<text text-anchor="middle" x="19629" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 0 Dense1</text>
<text text-anchor="middle" x="19629" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="19629" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer1_gpu0_expert0_gelu -->
<g id="node26" class="node">
<title>layer1_gpu0_expert0_gelu</title>
<ellipse fill="none" stroke="black" cx="19447" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="19447" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 0 GELU</text>
<text text-anchor="middle" x="19447" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="19447" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer1_gpu0_expert0_mlp2 -->
<g id="node27" class="node">
<title>layer1_gpu0_expert0_mlp2</title>
<polygon fill="none" stroke="black" points="19333.5,-516.5 19196.5,-516.5 19196.5,-463.5 19333.5,-463.5 19333.5,-516.5"/>
<text text-anchor="middle" x="19265" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 0 Dense2</text>
<text text-anchor="middle" x="19265" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="19265" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer1_gpu0_expert0_weight -->
<g id="node28" class="node">
<title>layer1_gpu0_expert0_weight</title>
<ellipse fill="none" stroke="black" cx="19083" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="19083" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 0 Weight</text>
<text text-anchor="middle" x="19083" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="19083" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer1_gpu0_expert1_mlp1 -->
<g id="node29" class="node">
<title>layer1_gpu0_expert1_mlp1</title>
<polygon fill="none" stroke="black" points="18969.5,-516.5 18832.5,-516.5 18832.5,-463.5 18969.5,-463.5 18969.5,-516.5"/>
<text text-anchor="middle" x="18901" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 1 Dense1</text>
<text text-anchor="middle" x="18901" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="18901" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer1_gpu0_expert1_gelu -->
<g id="node30" class="node">
<title>layer1_gpu0_expert1_gelu</title>
<ellipse fill="none" stroke="black" cx="18719" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="18719" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 1 GELU</text>
<text text-anchor="middle" x="18719" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="18719" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer1_gpu0_expert1_mlp2 -->
<g id="node31" class="node">
<title>layer1_gpu0_expert1_mlp2</title>
<polygon fill="none" stroke="black" points="18605.5,-516.5 18468.5,-516.5 18468.5,-463.5 18605.5,-463.5 18605.5,-516.5"/>
<text text-anchor="middle" x="18537" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 1 Dense2</text>
<text text-anchor="middle" x="18537" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="18537" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer1_gpu0_expert1_weight -->
<g id="node32" class="node">
<title>layer1_gpu0_expert1_weight</title>
<ellipse fill="none" stroke="black" cx="18355" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="18355" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 1 Weight</text>
<text text-anchor="middle" x="18355" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="18355" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer1_gpu0_moe_agg -->
<g id="node33" class="node">
<title>layer1_gpu0_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="20278.5,-471.57 20278.5,-508.43 20212.6,-534.5 20119.4,-534.5 20053.5,-508.43 20053.5,-471.57 20119.4,-445.5 20212.6,-445.5 20278.5,-471.57"/>
<polygon fill="none" stroke="black" points="20282.5,-468.85 20282.5,-511.15 20213.36,-538.5 20118.64,-538.5 20049.5,-511.15 20049.5,-468.85 20118.64,-441.5 20213.36,-441.5 20282.5,-468.85"/>
<text text-anchor="middle" x="20166" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="20166" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="20166" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer2_gpu0_ln1 -->
<g id="node34" class="node">
<title>layer2_gpu0_ln1</title>
<ellipse fill="none" stroke="black" cx="13873" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="13873" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="13873" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="13873" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer2_gpu0_qkv -->
<g id="node35" class="node">
<title>layer2_gpu0_qkv</title>
<polygon fill="none" stroke="black" points="17828,-524 17698,-524 17698,-456 17828,-456 17828,-524"/>
<text text-anchor="middle" x="17763" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="17763" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="17763" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="17763" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer2_gpu0_reshape -->
<g id="node36" class="node">
<title>layer2_gpu0_reshape</title>
<ellipse fill="none" stroke="black" cx="17612" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="17612" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="17612" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="17612" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer2_gpu0_attn -->
<g id="node37" class="node">
<title>layer2_gpu0_attn</title>
<polygon fill="none" stroke="black" points="17371,-558 17216,-490 17371,-422 17526,-490 17371,-558"/>
<text text-anchor="middle" x="17371" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="17371" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="17371" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="17371" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer2_gpu0_out_proj -->
<g id="node38" class="node">
<title>layer2_gpu0_out_proj</title>
<polygon fill="none" stroke="black" points="17990,-524 17846,-524 17846,-456 17990,-456 17990,-524"/>
<text text-anchor="middle" x="17918" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="17918" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="17918" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="17918" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer2_concat_group0 -->
<g id="node661" class="node">
<title>layer2_concat_group0</title>
<polygon fill="yellow" stroke="black" points="25317,-302.8 25317,-349.2 25245.53,-382 25144.47,-382 25073,-349.2 25073,-302.8 25144.47,-270 25245.53,-270 25317,-302.8"/>
<polygon fill="none" stroke="black" points="25321,-300.24 25321,-351.76 25246.41,-386 25143.59,-386 25069,-351.76 25069,-300.24 25143.59,-266 25246.41,-266 25321,-300.24"/>
<text text-anchor="middle" x="25195" y="-344.8" font-family="Times,serif" font-size="14.00">Concat Dimensions</text>
<text text-anchor="middle" x="25195" y="-329.8" font-family="Times,serif" font-size="14.00">Head Group 0</text>
<text text-anchor="middle" x="25195" y="-314.8" font-family="Times,serif" font-size="14.00">[B,L,4,512]</text>
<text text-anchor="middle" x="25195" y="-299.8" font-family="Times,serif" font-size="14.00">GPUs 0&#45;3</text>
</g>
<!-- layer2_gpu0_out_proj&#45;&gt;layer2_concat_group0 -->
<g id="edge21" class="edge">
<title>layer2_gpu0_out_proj&#45;&gt;layer2_concat_group0</title>
<path fill="none" stroke="black" d="M17948.26,-455.86C17962.51,-442.66 17980.62,-428.97 18000,-422 18184.42,-355.71 24863.01,-425.31 25055,-386 25069.52,-383.03 25084.41,-378.52 25098.81,-373.29"/>
<polygon fill="black" stroke="black" points="25100.07,-376.55 25108.19,-369.76 25097.6,-370 25100.07,-376.55"/>
</g>
<!-- layer2_gpu0_ln2 -->
<g id="node39" class="node">
<title>layer2_gpu0_ln2</title>
<ellipse fill="none" stroke="black" cx="16953" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="16953" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="16953" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="16953" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer2_gpu0_gate -->
<g id="node40" class="node">
<title>layer2_gpu0_gate</title>
<ellipse fill="none" stroke="black" cx="24093" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="24093" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="24093" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="24093" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer2_expert_all2all -->
<g id="node662" class="node">
<title>layer2_expert_all2all</title>
<polygon fill="purple" stroke="black" points="76632.5,-307.57 76632.5,-344.43 76571.29,-370.5 76484.71,-370.5 76423.5,-344.43 76423.5,-307.57 76484.71,-281.5 76571.29,-281.5 76632.5,-307.57"/>
<polygon fill="none" stroke="black" points="76636.5,-304.92 76636.5,-347.08 76572.1,-374.5 76483.9,-374.5 76419.5,-347.08 76419.5,-304.92 76483.9,-277.5 76572.1,-277.5 76636.5,-304.92"/>
<text text-anchor="middle" x="76528" y="-337.3" font-family="Times,serif" font-size="14.00">Expert All&#45;to&#45;All</text>
<text text-anchor="middle" x="76528" y="-322.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="76528" y="-307.3" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer2_gpu0_gate&#45;&gt;layer2_expert_all2all -->
<g id="edge22" class="edge">
<title>layer2_gpu0_gate&#45;&gt;layer2_expert_all2all</title>
<path fill="none" stroke="black" d="M24165.5,-483.7C24355.59,-470.08 24884.17,-434.13 25325,-422 25502.31,-417.12 76238.45,-427.11 76411,-386 76425.7,-382.5 76440.66,-376.84 76454.74,-370.38"/>
<polygon fill="black" stroke="black" points="76456.34,-373.49 76463.86,-366.03 76453.32,-367.18 76456.34,-373.49"/>
</g>
<!-- layer2_gpu0_expert0_mlp1 -->
<g id="node41" class="node">
<title>layer2_gpu0_expert0_mlp1</title>
<polygon fill="none" stroke="black" points="16696.5,-516.5 16559.5,-516.5 16559.5,-463.5 16696.5,-463.5 16696.5,-516.5"/>
<text text-anchor="middle" x="16628" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 0 Dense1</text>
<text text-anchor="middle" x="16628" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="16628" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer2_gpu0_expert0_gelu -->
<g id="node42" class="node">
<title>layer2_gpu0_expert0_gelu</title>
<ellipse fill="none" stroke="black" cx="16446" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="16446" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 0 GELU</text>
<text text-anchor="middle" x="16446" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="16446" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer2_gpu0_expert0_mlp2 -->
<g id="node43" class="node">
<title>layer2_gpu0_expert0_mlp2</title>
<polygon fill="none" stroke="black" points="16332.5,-516.5 16195.5,-516.5 16195.5,-463.5 16332.5,-463.5 16332.5,-516.5"/>
<text text-anchor="middle" x="16264" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 0 Dense2</text>
<text text-anchor="middle" x="16264" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="16264" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer2_gpu0_expert0_weight -->
<g id="node44" class="node">
<title>layer2_gpu0_expert0_weight</title>
<ellipse fill="none" stroke="black" cx="16082" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="16082" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 0 Weight</text>
<text text-anchor="middle" x="16082" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="16082" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer2_gpu0_expert1_mlp1 -->
<g id="node45" class="node">
<title>layer2_gpu0_expert1_mlp1</title>
<polygon fill="none" stroke="black" points="15968.5,-516.5 15831.5,-516.5 15831.5,-463.5 15968.5,-463.5 15968.5,-516.5"/>
<text text-anchor="middle" x="15900" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 1 Dense1</text>
<text text-anchor="middle" x="15900" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="15900" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer2_gpu0_expert1_gelu -->
<g id="node46" class="node">
<title>layer2_gpu0_expert1_gelu</title>
<ellipse fill="none" stroke="black" cx="15718" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="15718" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 1 GELU</text>
<text text-anchor="middle" x="15718" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="15718" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer2_gpu0_expert1_mlp2 -->
<g id="node47" class="node">
<title>layer2_gpu0_expert1_mlp2</title>
<polygon fill="none" stroke="black" points="15604.5,-516.5 15467.5,-516.5 15467.5,-463.5 15604.5,-463.5 15604.5,-516.5"/>
<text text-anchor="middle" x="15536" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 1 Dense2</text>
<text text-anchor="middle" x="15536" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="15536" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer2_gpu0_expert1_weight -->
<g id="node48" class="node">
<title>layer2_gpu0_expert1_weight</title>
<ellipse fill="none" stroke="black" cx="15354" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="15354" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 1 Weight</text>
<text text-anchor="middle" x="15354" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="15354" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer2_gpu0_moe_agg -->
<g id="node49" class="node">
<title>layer2_gpu0_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="23366.5,-471.57 23366.5,-508.43 23300.6,-534.5 23207.4,-534.5 23141.5,-508.43 23141.5,-471.57 23207.4,-445.5 23300.6,-445.5 23366.5,-471.57"/>
<polygon fill="none" stroke="black" points="23370.5,-468.85 23370.5,-511.15 23301.36,-538.5 23206.64,-538.5 23137.5,-511.15 23137.5,-468.85 23206.64,-441.5 23301.36,-441.5 23370.5,-468.85"/>
<text text-anchor="middle" x="23254" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="23254" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="23254" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer3_gpu0_ln1 -->
<g id="node50" class="node">
<title>layer3_gpu0_ln1</title>
<ellipse fill="none" stroke="black" cx="17122" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="17122" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="17122" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="17122" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer3_gpu0_qkv -->
<g id="node51" class="node">
<title>layer3_gpu0_qkv</title>
<polygon fill="none" stroke="black" points="14917,-524 14787,-524 14787,-456 14917,-456 14917,-524"/>
<text text-anchor="middle" x="14852" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="14852" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="14852" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="14852" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer3_gpu0_reshape -->
<g id="node52" class="node">
<title>layer3_gpu0_reshape</title>
<ellipse fill="none" stroke="black" cx="14701" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="14701" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="14701" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="14701" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer3_gpu0_attn -->
<g id="node53" class="node">
<title>layer3_gpu0_attn</title>
<polygon fill="none" stroke="black" points="14460,-558 14305,-490 14460,-422 14615,-490 14460,-558"/>
<text text-anchor="middle" x="14460" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="14460" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="14460" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="14460" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer3_gpu0_out_proj -->
<g id="node54" class="node">
<title>layer3_gpu0_out_proj</title>
<polygon fill="none" stroke="black" points="15241,-524 15097,-524 15097,-456 15241,-456 15241,-524"/>
<text text-anchor="middle" x="15169" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="15169" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="15169" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="15169" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer3_concat_group0 -->
<g id="node663" class="node">
<title>layer3_concat_group0</title>
<polygon fill="yellow" stroke="black" points="24701,-302.8 24701,-349.2 24629.53,-382 24528.47,-382 24457,-349.2 24457,-302.8 24528.47,-270 24629.53,-270 24701,-302.8"/>
<polygon fill="none" stroke="black" points="24705,-300.24 24705,-351.76 24630.41,-386 24527.59,-386 24453,-351.76 24453,-300.24 24527.59,-266 24630.41,-266 24705,-300.24"/>
<text text-anchor="middle" x="24579" y="-344.8" font-family="Times,serif" font-size="14.00">Concat Dimensions</text>
<text text-anchor="middle" x="24579" y="-329.8" font-family="Times,serif" font-size="14.00">Head Group 0</text>
<text text-anchor="middle" x="24579" y="-314.8" font-family="Times,serif" font-size="14.00">[B,L,4,512]</text>
<text text-anchor="middle" x="24579" y="-299.8" font-family="Times,serif" font-size="14.00">GPUs 0&#45;3</text>
</g>
<!-- layer3_gpu0_out_proj&#45;&gt;layer3_concat_group0 -->
<g id="edge23" class="edge">
<title>layer3_gpu0_out_proj&#45;&gt;layer3_concat_group0</title>
<path fill="none" stroke="black" d="M15198.81,-455.86C15212.88,-442.66 15230.78,-428.96 15250,-422 15370.06,-378.51 24319.06,-412.37 24444,-386 24457.29,-383.2 24470.88,-379.01 24484.07,-374.15"/>
<polygon fill="black" stroke="black" points="24485.51,-377.35 24493.59,-370.5 24483,-370.81 24485.51,-377.35"/>
</g>
<!-- layer3_gpu0_ln2 -->
<g id="node55" class="node">
<title>layer3_gpu0_ln2</title>
<ellipse fill="none" stroke="black" cx="14042" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="14042" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="14042" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="14042" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer3_gpu0_gate -->
<g id="node56" class="node">
<title>layer3_gpu0_gate</title>
<ellipse fill="none" stroke="black" cx="19789" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="19789" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="19789" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="19789" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer3_expert_all2all -->
<g id="node664" class="node">
<title>layer3_expert_all2all</title>
<polygon fill="purple" stroke="black" points="75927.5,-307.57 75927.5,-344.43 75866.29,-370.5 75779.71,-370.5 75718.5,-344.43 75718.5,-307.57 75779.71,-281.5 75866.29,-281.5 75927.5,-307.57"/>
<polygon fill="none" stroke="black" points="75931.5,-304.92 75931.5,-347.08 75867.1,-374.5 75778.9,-374.5 75714.5,-347.08 75714.5,-304.92 75778.9,-277.5 75867.1,-277.5 75931.5,-304.92"/>
<text text-anchor="middle" x="75823" y="-337.3" font-family="Times,serif" font-size="14.00">Expert All&#45;to&#45;All</text>
<text text-anchor="middle" x="75823" y="-322.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="75823" y="-307.3" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer3_gpu0_gate&#45;&gt;layer3_expert_all2all -->
<g id="edge24" class="edge">
<title>layer3_gpu0_gate&#45;&gt;layer3_expert_all2all</title>
<path fill="none" stroke="black" d="M19819.62,-455.47C19833.81,-442.37 19851.78,-428.86 19871,-422 20053.6,-356.82 75521.71,-432.26 75710,-386 75723.8,-382.61 75737.78,-377.21 75750.98,-371.02"/>
<polygon fill="black" stroke="black" points="75752.54,-374.16 75759.99,-366.63 75749.47,-367.87 75752.54,-374.16"/>
</g>
<!-- layer3_gpu0_expert0_mlp1 -->
<g id="node57" class="node">
<title>layer3_gpu0_expert0_mlp1</title>
<polygon fill="none" stroke="black" points="13779.5,-516.5 13642.5,-516.5 13642.5,-463.5 13779.5,-463.5 13779.5,-516.5"/>
<text text-anchor="middle" x="13711" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 0 Dense1</text>
<text text-anchor="middle" x="13711" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="13711" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer3_gpu0_expert0_gelu -->
<g id="node58" class="node">
<title>layer3_gpu0_expert0_gelu</title>
<ellipse fill="none" stroke="black" cx="13529" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="13529" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 0 GELU</text>
<text text-anchor="middle" x="13529" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="13529" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer3_gpu0_expert0_mlp2 -->
<g id="node59" class="node">
<title>layer3_gpu0_expert0_mlp2</title>
<polygon fill="none" stroke="black" points="13415.5,-516.5 13278.5,-516.5 13278.5,-463.5 13415.5,-463.5 13415.5,-516.5"/>
<text text-anchor="middle" x="13347" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 0 Dense2</text>
<text text-anchor="middle" x="13347" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="13347" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer3_gpu0_expert0_weight -->
<g id="node60" class="node">
<title>layer3_gpu0_expert0_weight</title>
<ellipse fill="none" stroke="black" cx="13165" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="13165" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 0 Weight</text>
<text text-anchor="middle" x="13165" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="13165" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer3_gpu0_expert1_mlp1 -->
<g id="node61" class="node">
<title>layer3_gpu0_expert1_mlp1</title>
<polygon fill="none" stroke="black" points="13051.5,-516.5 12914.5,-516.5 12914.5,-463.5 13051.5,-463.5 13051.5,-516.5"/>
<text text-anchor="middle" x="12983" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 1 Dense1</text>
<text text-anchor="middle" x="12983" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="12983" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer3_gpu0_expert1_gelu -->
<g id="node62" class="node">
<title>layer3_gpu0_expert1_gelu</title>
<ellipse fill="none" stroke="black" cx="12801" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="12801" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 1 GELU</text>
<text text-anchor="middle" x="12801" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="12801" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer3_gpu0_expert1_mlp2 -->
<g id="node63" class="node">
<title>layer3_gpu0_expert1_mlp2</title>
<polygon fill="none" stroke="black" points="12687.5,-516.5 12550.5,-516.5 12550.5,-463.5 12687.5,-463.5 12687.5,-516.5"/>
<text text-anchor="middle" x="12619" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 1 Dense2</text>
<text text-anchor="middle" x="12619" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="12619" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer3_gpu0_expert1_weight -->
<g id="node64" class="node">
<title>layer3_gpu0_expert1_weight</title>
<ellipse fill="none" stroke="black" cx="12437" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="12437" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 1 Weight</text>
<text text-anchor="middle" x="12437" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="12437" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- layer3_gpu0_moe_agg -->
<g id="node65" class="node">
<title>layer3_gpu0_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="18237.5,-471.57 18237.5,-508.43 18171.6,-534.5 18078.4,-534.5 18012.5,-508.43 18012.5,-471.57 18078.4,-445.5 18171.6,-445.5 18237.5,-471.57"/>
<polygon fill="none" stroke="black" points="18241.5,-468.85 18241.5,-511.15 18172.36,-538.5 18077.64,-538.5 18008.5,-511.15 18008.5,-468.85 18077.64,-441.5 18172.36,-441.5 18241.5,-468.85"/>
<text text-anchor="middle" x="18125" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="18125" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="18125" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- embed_1 -->
<g id="node66" class="node">
<title>embed_1</title>
<polygon fill="none" stroke="black" points="236,-516.5 16,-516.5 16,-463.5 236,-463.5 236,-516.5"/>
<text text-anchor="middle" x="126" y="-501.3" font-family="Times,serif" font-size="14.00">Input Embedding</text>
<text text-anchor="middle" x="126" y="-486.3" font-family="Times,serif" font-size="14.00">[B=1024, L=2048, D=8192]</text>
<text text-anchor="middle" x="126" y="-471.3" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer0_gpu1_ln1 -->
<g id="node67" class="node">
<title>layer0_gpu1_ln1</title>
<ellipse fill="none" stroke="black" cx="126" cy="-326" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="126" y="-337.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="126" y="-322.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="126" y="-307.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- embed_1&#45;&gt;layer0_gpu1_ln1 -->
<g id="edge2" class="edge">
<title>embed_1&#45;&gt;layer0_gpu1_ln1</title>
<path fill="none" stroke="black" d="M126,-463.33C126,-439.41 126,-403.17 126,-374.06"/>
<polygon fill="black" stroke="black" points="129.5,-373.69 126,-363.69 122.5,-373.69 129.5,-373.69"/>
</g>
<!-- layer0_gpu1_qkv -->
<g id="node68" class="node">
<title>layer0_gpu1_qkv</title>
<polygon fill="none" stroke="black" points="11914,-524 11784,-524 11784,-456 11914,-456 11914,-524"/>
<text text-anchor="middle" x="11849" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="11849" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="11849" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="11849" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer0_gpu1_reshape -->
<g id="node69" class="node">
<title>layer0_gpu1_reshape</title>
<ellipse fill="none" stroke="black" cx="11698" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="11698" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="11698" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="11698" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer0_gpu1_attn -->
<g id="node70" class="node">
<title>layer0_gpu1_attn</title>
<polygon fill="none" stroke="black" points="11457,-558 11302,-490 11457,-422 11612,-490 11457,-558"/>
<text text-anchor="middle" x="11457" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="11457" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="11457" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="11457" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer0_gpu1_out_proj -->
<g id="node71" class="node">
<title>layer0_gpu1_out_proj</title>
<polygon fill="none" stroke="black" points="5111,-524 4967,-524 4967,-456 5111,-456 5111,-524"/>
<text text-anchor="middle" x="5039" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="5039" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="5039" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="5039" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer0_gpu1_out_proj&#45;&gt;layer0_concat_group0 -->
<g id="edge25" class="edge">
<title>layer0_gpu1_out_proj&#45;&gt;layer0_concat_group0</title>
<path fill="none" stroke="black" d="M5068.81,-455.84C5082.87,-442.63 5100.77,-428.94 5120,-422 5247.98,-375.79 24580.83,-413.96 24714,-386 24727.29,-383.21 24740.88,-379.04 24754.07,-374.18"/>
<polygon fill="black" stroke="black" points="24755.51,-377.37 24763.59,-370.53 24753,-370.84 24755.51,-377.37"/>
</g>
<!-- layer0_gpu1_ln2 -->
<g id="node72" class="node">
<title>layer0_gpu1_ln2</title>
<ellipse fill="none" stroke="black" cx="10957" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="10957" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="10957" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="10957" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer0_gpu1_gate -->
<g id="node73" class="node">
<title>layer0_gpu1_gate</title>
<ellipse fill="none" stroke="black" cx="10790" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="10790" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="10790" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="10790" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer0_gpu1_gate&#45;&gt;layer0_expert_all2all -->
<g id="edge26" class="edge">
<title>layer0_gpu1_gate&#45;&gt;layer0_expert_all2all</title>
<path fill="none" stroke="black" d="M10820.62,-455.47C10834.81,-442.37 10852.78,-428.86 10872,-422 11085.56,-345.78 75955.42,-438.53 76176,-386 76190.7,-382.5 76205.66,-376.84 76219.74,-370.38"/>
<polygon fill="black" stroke="black" points="76221.34,-373.5 76228.86,-366.03 76218.32,-367.18 76221.34,-373.5"/>
</g>
<!-- layer0_gpu1_expert2_mlp1 -->
<g id="node74" class="node">
<title>layer0_gpu1_expert2_mlp1</title>
<polygon fill="none" stroke="black" points="10698.5,-516.5 10561.5,-516.5 10561.5,-463.5 10698.5,-463.5 10698.5,-516.5"/>
<text text-anchor="middle" x="10630" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 2 Dense1</text>
<text text-anchor="middle" x="10630" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="10630" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer0_gpu1_expert2_gelu -->
<g id="node75" class="node">
<title>layer0_gpu1_expert2_gelu</title>
<ellipse fill="none" stroke="black" cx="10448" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="10448" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 2 GELU</text>
<text text-anchor="middle" x="10448" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="10448" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer0_gpu1_expert2_mlp2 -->
<g id="node76" class="node">
<title>layer0_gpu1_expert2_mlp2</title>
<polygon fill="none" stroke="black" points="10334.5,-516.5 10197.5,-516.5 10197.5,-463.5 10334.5,-463.5 10334.5,-516.5"/>
<text text-anchor="middle" x="10266" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 2 Dense2</text>
<text text-anchor="middle" x="10266" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="10266" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer0_gpu1_expert2_weight -->
<g id="node77" class="node">
<title>layer0_gpu1_expert2_weight</title>
<ellipse fill="none" stroke="black" cx="10084" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="10084" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 2 Weight</text>
<text text-anchor="middle" x="10084" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="10084" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer0_gpu1_expert3_mlp1 -->
<g id="node78" class="node">
<title>layer0_gpu1_expert3_mlp1</title>
<polygon fill="none" stroke="black" points="9970.5,-516.5 9833.5,-516.5 9833.5,-463.5 9970.5,-463.5 9970.5,-516.5"/>
<text text-anchor="middle" x="9902" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 3 Dense1</text>
<text text-anchor="middle" x="9902" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="9902" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer0_gpu1_expert3_gelu -->
<g id="node79" class="node">
<title>layer0_gpu1_expert3_gelu</title>
<ellipse fill="none" stroke="black" cx="9720" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="9720" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 3 GELU</text>
<text text-anchor="middle" x="9720" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="9720" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer0_gpu1_expert3_mlp2 -->
<g id="node80" class="node">
<title>layer0_gpu1_expert3_mlp2</title>
<polygon fill="none" stroke="black" points="9606.5,-516.5 9469.5,-516.5 9469.5,-463.5 9606.5,-463.5 9606.5,-516.5"/>
<text text-anchor="middle" x="9538" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 3 Dense2</text>
<text text-anchor="middle" x="9538" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="9538" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer0_gpu1_expert3_weight -->
<g id="node81" class="node">
<title>layer0_gpu1_expert3_weight</title>
<ellipse fill="none" stroke="black" cx="9356" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="9356" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 3 Weight</text>
<text text-anchor="middle" x="9356" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="9356" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer0_gpu1_moe_agg -->
<g id="node82" class="node">
<title>layer0_gpu1_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="9238.5,-471.57 9238.5,-508.43 9172.6,-534.5 9079.4,-534.5 9013.5,-508.43 9013.5,-471.57 9079.4,-445.5 9172.6,-445.5 9238.5,-471.57"/>
<polygon fill="none" stroke="black" points="9242.5,-468.85 9242.5,-511.15 9173.36,-538.5 9078.64,-538.5 9009.5,-511.15 9009.5,-468.85 9078.64,-441.5 9173.36,-441.5 9242.5,-468.85"/>
<text text-anchor="middle" x="9126" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="9126" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="9126" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer1_gpu1_ln1 -->
<g id="node83" class="node">
<title>layer1_gpu1_ln1</title>
<ellipse fill="none" stroke="black" cx="2123" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="2123" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="2123" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="2123" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer1_gpu1_qkv -->
<g id="node84" class="node">
<title>layer1_gpu1_qkv</title>
<polygon fill="none" stroke="black" points="8826,-524 8696,-524 8696,-456 8826,-456 8826,-524"/>
<text text-anchor="middle" x="8761" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="8761" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="8761" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="8761" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer1_gpu1_reshape -->
<g id="node85" class="node">
<title>layer1_gpu1_reshape</title>
<ellipse fill="none" stroke="black" cx="8610" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="8610" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="8610" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="8610" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer1_gpu1_attn -->
<g id="node86" class="node">
<title>layer1_gpu1_attn</title>
<polygon fill="none" stroke="black" points="8369,-558 8214,-490 8369,-422 8524,-490 8369,-558"/>
<text text-anchor="middle" x="8369" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="8369" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="8369" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="8369" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer1_gpu1_out_proj -->
<g id="node87" class="node">
<title>layer1_gpu1_out_proj</title>
<polygon fill="none" stroke="black" points="3161,-524 3017,-524 3017,-456 3161,-456 3161,-524"/>
<text text-anchor="middle" x="3089" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="3089" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="3089" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="3089" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer1_gpu1_out_proj&#45;&gt;layer1_concat_group0 -->
<g id="edge27" class="edge">
<title>layer1_gpu1_out_proj&#45;&gt;layer1_concat_group0</title>
<path fill="none" stroke="black" d="M3118.8,-455.84C3132.87,-442.63 3150.77,-428.94 3170,-422 3307.23,-372.47 24036.43,-416.97 24179,-386 24191.14,-383.36 24203.5,-379.5 24215.54,-374.99"/>
<polygon fill="black" stroke="black" points="24217.08,-378.15 24225.12,-371.24 24214.53,-371.63 24217.08,-378.15"/>
</g>
<!-- layer1_gpu1_ln2 -->
<g id="node88" class="node">
<title>layer1_gpu1_ln2</title>
<ellipse fill="none" stroke="black" cx="7869" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="7869" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="7869" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="7869" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer1_gpu1_gate -->
<g id="node89" class="node">
<title>layer1_gpu1_gate</title>
<ellipse fill="none" stroke="black" cx="8918" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="8918" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="8918" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="8918" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer1_gpu1_gate&#45;&gt;layer1_expert_all2all -->
<g id="edge28" class="edge">
<title>layer1_gpu1_gate&#45;&gt;layer1_expert_all2all</title>
<path fill="none" stroke="black" d="M8948.68,-455.81C8963.11,-442.6 8981.45,-428.91 9001,-422 9220.14,-344.52 75714.89,-439.85 75941,-386 75955.7,-382.5 75970.66,-376.84 75984.74,-370.38"/>
<polygon fill="black" stroke="black" points="75986.34,-373.5 75993.86,-366.03 75983.32,-367.18 75986.34,-373.5"/>
</g>
<!-- layer1_gpu1_expert2_mlp1 -->
<g id="node90" class="node">
<title>layer1_gpu1_expert2_mlp1</title>
<polygon fill="none" stroke="black" points="7610.5,-516.5 7473.5,-516.5 7473.5,-463.5 7610.5,-463.5 7610.5,-516.5"/>
<text text-anchor="middle" x="7542" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 2 Dense1</text>
<text text-anchor="middle" x="7542" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="7542" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer1_gpu1_expert2_gelu -->
<g id="node91" class="node">
<title>layer1_gpu1_expert2_gelu</title>
<ellipse fill="none" stroke="black" cx="7360" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="7360" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 2 GELU</text>
<text text-anchor="middle" x="7360" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="7360" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer1_gpu1_expert2_mlp2 -->
<g id="node92" class="node">
<title>layer1_gpu1_expert2_mlp2</title>
<polygon fill="none" stroke="black" points="7246.5,-516.5 7109.5,-516.5 7109.5,-463.5 7246.5,-463.5 7246.5,-516.5"/>
<text text-anchor="middle" x="7178" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 2 Dense2</text>
<text text-anchor="middle" x="7178" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="7178" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer1_gpu1_expert2_weight -->
<g id="node93" class="node">
<title>layer1_gpu1_expert2_weight</title>
<ellipse fill="none" stroke="black" cx="6996" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="6996" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 2 Weight</text>
<text text-anchor="middle" x="6996" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="6996" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer1_gpu1_expert3_mlp1 -->
<g id="node94" class="node">
<title>layer1_gpu1_expert3_mlp1</title>
<polygon fill="none" stroke="black" points="6882.5,-516.5 6745.5,-516.5 6745.5,-463.5 6882.5,-463.5 6882.5,-516.5"/>
<text text-anchor="middle" x="6814" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 3 Dense1</text>
<text text-anchor="middle" x="6814" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="6814" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer1_gpu1_expert3_gelu -->
<g id="node95" class="node">
<title>layer1_gpu1_expert3_gelu</title>
<ellipse fill="none" stroke="black" cx="6632" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="6632" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 3 GELU</text>
<text text-anchor="middle" x="6632" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="6632" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer1_gpu1_expert3_mlp2 -->
<g id="node96" class="node">
<title>layer1_gpu1_expert3_mlp2</title>
<polygon fill="none" stroke="black" points="6518.5,-516.5 6381.5,-516.5 6381.5,-463.5 6518.5,-463.5 6518.5,-516.5"/>
<text text-anchor="middle" x="6450" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 3 Dense2</text>
<text text-anchor="middle" x="6450" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="6450" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer1_gpu1_expert3_weight -->
<g id="node97" class="node">
<title>layer1_gpu1_expert3_weight</title>
<ellipse fill="none" stroke="black" cx="6268" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="6268" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 3 Weight</text>
<text text-anchor="middle" x="6268" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="6268" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer1_gpu1_moe_agg -->
<g id="node98" class="node">
<title>layer1_gpu1_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="8191.5,-471.57 8191.5,-508.43 8125.6,-534.5 8032.4,-534.5 7966.5,-508.43 7966.5,-471.57 8032.4,-445.5 8125.6,-445.5 8191.5,-471.57"/>
<polygon fill="none" stroke="black" points="8195.5,-468.85 8195.5,-511.15 8126.36,-538.5 8031.64,-538.5 7962.5,-511.15 7962.5,-468.85 8031.64,-441.5 8126.36,-441.5 8195.5,-468.85"/>
<text text-anchor="middle" x="8079" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="8079" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="8079" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer2_gpu1_ln1 -->
<g id="node99" class="node">
<title>layer2_gpu1_ln1</title>
<ellipse fill="none" stroke="black" cx="1785" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="1785" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="1785" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="1785" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer2_gpu1_qkv -->
<g id="node100" class="node">
<title>layer2_gpu1_qkv</title>
<polygon fill="none" stroke="black" points="5741,-524 5611,-524 5611,-456 5741,-456 5741,-524"/>
<text text-anchor="middle" x="5676" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5676" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="5676" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="5676" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer2_gpu1_reshape -->
<g id="node101" class="node">
<title>layer2_gpu1_reshape</title>
<ellipse fill="none" stroke="black" cx="5525" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="5525" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="5525" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="5525" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer2_gpu1_attn -->
<g id="node102" class="node">
<title>layer2_gpu1_attn</title>
<polygon fill="none" stroke="black" points="5284,-558 5129,-490 5284,-422 5439,-490 5284,-558"/>
<text text-anchor="middle" x="5284" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="5284" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="5284" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="5284" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer2_gpu1_out_proj -->
<g id="node103" class="node">
<title>layer2_gpu1_out_proj</title>
<polygon fill="none" stroke="black" points="5903,-524 5759,-524 5759,-456 5903,-456 5903,-524"/>
<text text-anchor="middle" x="5831" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="5831" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="5831" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="5831" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer2_gpu1_out_proj&#45;&gt;layer2_concat_group0 -->
<g id="edge29" class="edge">
<title>layer2_gpu1_out_proj&#45;&gt;layer2_concat_group0</title>
<path fill="none" stroke="black" d="M5861.24,-455.83C5875.49,-442.62 5893.61,-428.93 5913,-422 6037.7,-377.4 24852.81,-404.12 24984,-386 25016.04,-381.57 25050.08,-373.58 25081.26,-364.87"/>
<polygon fill="black" stroke="black" points="25082.61,-368.12 25091.27,-362.02 25080.7,-361.39 25082.61,-368.12"/>
</g>
<!-- layer2_gpu1_ln2 -->
<g id="node104" class="node">
<title>layer2_gpu1_ln2</title>
<ellipse fill="none" stroke="black" cx="4873" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="4873" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="4873" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="4873" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer2_gpu1_gate -->
<g id="node105" class="node">
<title>layer2_gpu1_gate</title>
<ellipse fill="none" stroke="black" cx="12006" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="12006" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="12006" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="12006" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer2_gpu1_gate&#45;&gt;layer2_expert_all2all -->
<g id="edge30" class="edge">
<title>layer2_gpu1_gate&#45;&gt;layer2_expert_all2all</title>
<path fill="none" stroke="black" d="M12037.99,-455.79C12052.99,-442.58 12071.95,-428.89 12092,-422 12303.19,-349.38 76193.75,-437.74 76411,-386 76425.7,-382.5 76440.66,-376.84 76454.74,-370.38"/>
<polygon fill="black" stroke="black" points="76456.34,-373.5 76463.86,-366.03 76453.32,-367.18 76456.34,-373.5"/>
</g>
<!-- layer2_gpu1_expert2_mlp1 -->
<g id="node106" class="node">
<title>layer2_gpu1_expert2_mlp1</title>
<polygon fill="none" stroke="black" points="4616.5,-516.5 4479.5,-516.5 4479.5,-463.5 4616.5,-463.5 4616.5,-516.5"/>
<text text-anchor="middle" x="4548" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 2 Dense1</text>
<text text-anchor="middle" x="4548" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="4548" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer2_gpu1_expert2_gelu -->
<g id="node107" class="node">
<title>layer2_gpu1_expert2_gelu</title>
<ellipse fill="none" stroke="black" cx="4366" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="4366" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 2 GELU</text>
<text text-anchor="middle" x="4366" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="4366" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer2_gpu1_expert2_mlp2 -->
<g id="node108" class="node">
<title>layer2_gpu1_expert2_mlp2</title>
<polygon fill="none" stroke="black" points="4252.5,-516.5 4115.5,-516.5 4115.5,-463.5 4252.5,-463.5 4252.5,-516.5"/>
<text text-anchor="middle" x="4184" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 2 Dense2</text>
<text text-anchor="middle" x="4184" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="4184" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer2_gpu1_expert2_weight -->
<g id="node109" class="node">
<title>layer2_gpu1_expert2_weight</title>
<ellipse fill="none" stroke="black" cx="4002" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="4002" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 2 Weight</text>
<text text-anchor="middle" x="4002" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="4002" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer2_gpu1_expert3_mlp1 -->
<g id="node110" class="node">
<title>layer2_gpu1_expert3_mlp1</title>
<polygon fill="none" stroke="black" points="3888.5,-516.5 3751.5,-516.5 3751.5,-463.5 3888.5,-463.5 3888.5,-516.5"/>
<text text-anchor="middle" x="3820" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 3 Dense1</text>
<text text-anchor="middle" x="3820" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="3820" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer2_gpu1_expert3_gelu -->
<g id="node111" class="node">
<title>layer2_gpu1_expert3_gelu</title>
<ellipse fill="none" stroke="black" cx="3638" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="3638" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 3 GELU</text>
<text text-anchor="middle" x="3638" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="3638" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer2_gpu1_expert3_mlp2 -->
<g id="node112" class="node">
<title>layer2_gpu1_expert3_mlp2</title>
<polygon fill="none" stroke="black" points="3524.5,-516.5 3387.5,-516.5 3387.5,-463.5 3524.5,-463.5 3524.5,-516.5"/>
<text text-anchor="middle" x="3456" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 3 Dense2</text>
<text text-anchor="middle" x="3456" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="3456" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer2_gpu1_expert3_weight -->
<g id="node113" class="node">
<title>layer2_gpu1_expert3_weight</title>
<ellipse fill="none" stroke="black" cx="3274" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="3274" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 3 Weight</text>
<text text-anchor="middle" x="3274" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="3274" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer2_gpu1_moe_agg -->
<g id="node114" class="node">
<title>layer2_gpu1_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="11279.5,-471.57 11279.5,-508.43 11213.6,-534.5 11120.4,-534.5 11054.5,-508.43 11054.5,-471.57 11120.4,-445.5 11213.6,-445.5 11279.5,-471.57"/>
<polygon fill="none" stroke="black" points="11283.5,-468.85 11283.5,-511.15 11214.36,-538.5 11119.64,-538.5 11050.5,-511.15 11050.5,-468.85 11119.64,-441.5 11214.36,-441.5 11283.5,-468.85"/>
<text text-anchor="middle" x="11167" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="11167" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="11167" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer3_gpu1_ln1 -->
<g id="node115" class="node">
<title>layer3_gpu1_ln1</title>
<ellipse fill="none" stroke="black" cx="2923" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="2923" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="2923" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="2923" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer3_gpu1_qkv -->
<g id="node116" class="node">
<title>layer3_gpu1_qkv</title>
<polygon fill="none" stroke="black" points="2829,-524 2699,-524 2699,-456 2829,-456 2829,-524"/>
<text text-anchor="middle" x="2764" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="2764" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="2764" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="2764" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer3_gpu1_reshape -->
<g id="node117" class="node">
<title>layer3_gpu1_reshape</title>
<ellipse fill="none" stroke="black" cx="2613" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="2613" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="2613" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="2613" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer3_gpu1_attn -->
<g id="node118" class="node">
<title>layer3_gpu1_attn</title>
<polygon fill="none" stroke="black" points="2372,-558 2217,-490 2372,-422 2527,-490 2372,-558"/>
<text text-anchor="middle" x="2372" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="2372" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="2372" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="2372" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer3_gpu1_out_proj -->
<g id="node119" class="node">
<title>layer3_gpu1_out_proj</title>
<polygon fill="none" stroke="black" points="4779,-524 4635,-524 4635,-456 4779,-456 4779,-524"/>
<text text-anchor="middle" x="4707" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="4707" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="4707" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="4707" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer3_gpu1_out_proj&#45;&gt;layer3_concat_group0 -->
<g id="edge31" class="edge">
<title>layer3_gpu1_out_proj&#45;&gt;layer3_concat_group0</title>
<path fill="none" stroke="black" d="M4736.81,-455.84C4750.87,-442.63 4768.77,-428.94 4788,-422 4916.39,-375.65 24310.41,-414.04 24444,-386 24457.29,-383.21 24470.88,-379.04 24484.07,-374.18"/>
<polygon fill="black" stroke="black" points="24485.51,-377.37 24493.59,-370.53 24483,-370.84 24485.51,-377.37"/>
</g>
<!-- layer3_gpu1_ln2 -->
<g id="node120" class="node">
<title>layer3_gpu1_ln2</title>
<ellipse fill="none" stroke="black" cx="1954" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="1954" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="1954" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="1954" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer3_gpu1_gate -->
<g id="node121" class="node">
<title>layer3_gpu1_gate</title>
<ellipse fill="none" stroke="black" cx="7702" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="7702" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="7702" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="7702" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer3_gpu1_gate&#45;&gt;layer3_expert_all2all -->
<g id="edge32" class="edge">
<title>layer3_gpu1_gate&#45;&gt;layer3_expert_all2all</title>
<path fill="none" stroke="black" d="M7732.24,-455.82C7746.49,-442.61 7764.61,-428.92 7784,-422 8006.13,-342.72 75480.95,-442.26 75710,-386 75723.8,-382.61 75737.78,-377.21 75750.98,-371.03"/>
<polygon fill="black" stroke="black" points="75752.54,-374.16 75759.99,-366.63 75749.47,-367.87 75752.54,-374.16"/>
</g>
<!-- layer3_gpu1_expert2_mlp1 -->
<g id="node122" class="node">
<title>layer3_gpu1_expert2_mlp1</title>
<polygon fill="none" stroke="black" points="1691.5,-516.5 1554.5,-516.5 1554.5,-463.5 1691.5,-463.5 1691.5,-516.5"/>
<text text-anchor="middle" x="1623" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 2 Dense1</text>
<text text-anchor="middle" x="1623" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="1623" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer3_gpu1_expert2_gelu -->
<g id="node123" class="node">
<title>layer3_gpu1_expert2_gelu</title>
<ellipse fill="none" stroke="black" cx="1441" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="1441" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 2 GELU</text>
<text text-anchor="middle" x="1441" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="1441" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer3_gpu1_expert2_mlp2 -->
<g id="node124" class="node">
<title>layer3_gpu1_expert2_mlp2</title>
<polygon fill="none" stroke="black" points="1327.5,-516.5 1190.5,-516.5 1190.5,-463.5 1327.5,-463.5 1327.5,-516.5"/>
<text text-anchor="middle" x="1259" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 2 Dense2</text>
<text text-anchor="middle" x="1259" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="1259" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer3_gpu1_expert2_weight -->
<g id="node125" class="node">
<title>layer3_gpu1_expert2_weight</title>
<ellipse fill="none" stroke="black" cx="1077" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="1077" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 2 Weight</text>
<text text-anchor="middle" x="1077" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="1077" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer3_gpu1_expert3_mlp1 -->
<g id="node126" class="node">
<title>layer3_gpu1_expert3_mlp1</title>
<polygon fill="none" stroke="black" points="963.5,-516.5 826.5,-516.5 826.5,-463.5 963.5,-463.5 963.5,-516.5"/>
<text text-anchor="middle" x="895" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 3 Dense1</text>
<text text-anchor="middle" x="895" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="895" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer3_gpu1_expert3_gelu -->
<g id="node127" class="node">
<title>layer3_gpu1_expert3_gelu</title>
<ellipse fill="none" stroke="black" cx="713" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="713" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 3 GELU</text>
<text text-anchor="middle" x="713" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="713" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer3_gpu1_expert3_mlp2 -->
<g id="node128" class="node">
<title>layer3_gpu1_expert3_mlp2</title>
<polygon fill="none" stroke="black" points="599.5,-516.5 462.5,-516.5 462.5,-463.5 599.5,-463.5 599.5,-516.5"/>
<text text-anchor="middle" x="531" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 3 Dense2</text>
<text text-anchor="middle" x="531" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="531" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer3_gpu1_expert3_weight -->
<g id="node129" class="node">
<title>layer3_gpu1_expert3_weight</title>
<ellipse fill="none" stroke="black" cx="349" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="349" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 3 Weight</text>
<text text-anchor="middle" x="349" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="349" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- layer3_gpu1_moe_agg -->
<g id="node130" class="node">
<title>layer3_gpu1_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="6150.5,-471.57 6150.5,-508.43 6084.6,-534.5 5991.4,-534.5 5925.5,-508.43 5925.5,-471.57 5991.4,-445.5 6084.6,-445.5 6150.5,-471.57"/>
<polygon fill="none" stroke="black" points="6154.5,-468.85 6154.5,-511.15 6085.36,-538.5 5990.64,-538.5 5921.5,-511.15 5921.5,-468.85 5990.64,-441.5 6085.36,-441.5 6154.5,-468.85"/>
<text text-anchor="middle" x="6038" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="6038" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="6038" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- embed_2 -->
<g id="node131" class="node">
<title>embed_2</title>
<polygon fill="none" stroke="black" points="30087,-516.5 29867,-516.5 29867,-463.5 30087,-463.5 30087,-516.5"/>
<text text-anchor="middle" x="29977" y="-501.3" font-family="Times,serif" font-size="14.00">Input Embedding</text>
<text text-anchor="middle" x="29977" y="-486.3" font-family="Times,serif" font-size="14.00">[B=1024, L=2048, D=8192]</text>
<text text-anchor="middle" x="29977" y="-471.3" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer0_gpu2_ln1 -->
<g id="node132" class="node">
<title>layer0_gpu2_ln1</title>
<ellipse fill="none" stroke="black" cx="29977" cy="-326" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="29977" y="-337.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="29977" y="-322.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="29977" y="-307.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- embed_2&#45;&gt;layer0_gpu2_ln1 -->
<g id="edge3" class="edge">
<title>embed_2&#45;&gt;layer0_gpu2_ln1</title>
<path fill="none" stroke="black" d="M29977,-463.33C29977,-439.41 29977,-403.17 29977,-374.06"/>
<polygon fill="black" stroke="black" points="29980.5,-373.69 29977,-363.69 29973.5,-373.69 29980.5,-373.69"/>
</g>
<!-- layer0_gpu2_qkv -->
<g id="node133" class="node">
<title>layer0_gpu2_qkv</title>
<polygon fill="none" stroke="black" points="37236,-524 37106,-524 37106,-456 37236,-456 37236,-524"/>
<text text-anchor="middle" x="37171" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="37171" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="37171" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="37171" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer0_gpu2_reshape -->
<g id="node134" class="node">
<title>layer0_gpu2_reshape</title>
<ellipse fill="none" stroke="black" cx="37020" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="37020" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="37020" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="37020" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer0_gpu2_attn -->
<g id="node135" class="node">
<title>layer0_gpu2_attn</title>
<polygon fill="none" stroke="black" points="36779,-558 36624,-490 36779,-422 36934,-490 36779,-558"/>
<text text-anchor="middle" x="36779" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="36779" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="36779" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="36779" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer0_gpu2_out_proj -->
<g id="node136" class="node">
<title>layer0_gpu2_out_proj</title>
<polygon fill="none" stroke="black" points="27431,-524 27287,-524 27287,-456 27431,-456 27431,-524"/>
<text text-anchor="middle" x="27359" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="27359" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="27359" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="27359" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer0_gpu2_out_proj&#45;&gt;layer0_concat_group0 -->
<g id="edge33" class="edge">
<title>layer0_gpu2_out_proj&#45;&gt;layer0_concat_group0</title>
<path fill="none" stroke="black" d="M27329.15,-455.97C27315.08,-442.78 27297.18,-429.07 27278,-422 27158.68,-377.98 25113.46,-412.17 24989,-386 24974.74,-383 24960.11,-378.55 24945.94,-373.41"/>
<polygon fill="black" stroke="black" points="24946.81,-370 24936.22,-369.75 24944.34,-376.55 24946.81,-370"/>
</g>
<!-- layer0_gpu2_ln2 -->
<g id="node137" class="node">
<title>layer0_gpu2_ln2</title>
<ellipse fill="none" stroke="black" cx="36279" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="36279" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="36279" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="36279" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer0_gpu2_gate -->
<g id="node138" class="node">
<title>layer0_gpu2_gate</title>
<ellipse fill="none" stroke="black" cx="36112" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="36112" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="36112" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="36112" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer0_gpu2_gate&#45;&gt;layer0_expert_all2all -->
<g id="edge34" class="edge">
<title>layer0_gpu2_gate&#45;&gt;layer0_expert_all2all</title>
<path fill="none" stroke="black" d="M36142.62,-455.47C36156.81,-442.37 36174.78,-428.86 36194,-422 36324.74,-375.31 76040.96,-418.19 76176,-386 76190.7,-382.5 76205.66,-376.84 76219.74,-370.37"/>
<polygon fill="black" stroke="black" points="76221.34,-373.49 76228.86,-366.03 76218.32,-367.17 76221.34,-373.49"/>
</g>
<!-- layer0_gpu2_expert4_mlp1 -->
<g id="node139" class="node">
<title>layer0_gpu2_expert4_mlp1</title>
<polygon fill="none" stroke="black" points="36020.5,-516.5 35883.5,-516.5 35883.5,-463.5 36020.5,-463.5 36020.5,-516.5"/>
<text text-anchor="middle" x="35952" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 4 Dense1</text>
<text text-anchor="middle" x="35952" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="35952" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer0_gpu2_expert4_gelu -->
<g id="node140" class="node">
<title>layer0_gpu2_expert4_gelu</title>
<ellipse fill="none" stroke="black" cx="35770" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="35770" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 4 GELU</text>
<text text-anchor="middle" x="35770" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="35770" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer0_gpu2_expert4_mlp2 -->
<g id="node141" class="node">
<title>layer0_gpu2_expert4_mlp2</title>
<polygon fill="none" stroke="black" points="35656.5,-516.5 35519.5,-516.5 35519.5,-463.5 35656.5,-463.5 35656.5,-516.5"/>
<text text-anchor="middle" x="35588" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 4 Dense2</text>
<text text-anchor="middle" x="35588" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="35588" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer0_gpu2_expert4_weight -->
<g id="node142" class="node">
<title>layer0_gpu2_expert4_weight</title>
<ellipse fill="none" stroke="black" cx="35406" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="35406" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 4 Weight</text>
<text text-anchor="middle" x="35406" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="35406" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer0_gpu2_expert5_mlp1 -->
<g id="node143" class="node">
<title>layer0_gpu2_expert5_mlp1</title>
<polygon fill="none" stroke="black" points="35292.5,-516.5 35155.5,-516.5 35155.5,-463.5 35292.5,-463.5 35292.5,-516.5"/>
<text text-anchor="middle" x="35224" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 5 Dense1</text>
<text text-anchor="middle" x="35224" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="35224" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer0_gpu2_expert5_gelu -->
<g id="node144" class="node">
<title>layer0_gpu2_expert5_gelu</title>
<ellipse fill="none" stroke="black" cx="35042" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="35042" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 5 GELU</text>
<text text-anchor="middle" x="35042" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="35042" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer0_gpu2_expert5_mlp2 -->
<g id="node145" class="node">
<title>layer0_gpu2_expert5_mlp2</title>
<polygon fill="none" stroke="black" points="34928.5,-516.5 34791.5,-516.5 34791.5,-463.5 34928.5,-463.5 34928.5,-516.5"/>
<text text-anchor="middle" x="34860" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 5 Dense2</text>
<text text-anchor="middle" x="34860" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="34860" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer0_gpu2_expert5_weight -->
<g id="node146" class="node">
<title>layer0_gpu2_expert5_weight</title>
<ellipse fill="none" stroke="black" cx="34678" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="34678" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 5 Weight</text>
<text text-anchor="middle" x="34678" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="34678" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer0_gpu2_moe_agg -->
<g id="node147" class="node">
<title>layer0_gpu2_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="34560.5,-471.57 34560.5,-508.43 34494.6,-534.5 34401.4,-534.5 34335.5,-508.43 34335.5,-471.57 34401.4,-445.5 34494.6,-445.5 34560.5,-471.57"/>
<polygon fill="none" stroke="black" points="34564.5,-468.85 34564.5,-511.15 34495.36,-538.5 34400.64,-538.5 34331.5,-511.15 34331.5,-468.85 34400.64,-441.5 34495.36,-441.5 34564.5,-468.85"/>
<text text-anchor="middle" x="34448" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="34448" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="34448" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer1_gpu2_ln1 -->
<g id="node148" class="node">
<title>layer1_gpu2_ln1</title>
<ellipse fill="none" stroke="black" cx="30350" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="30350" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="30350" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="30350" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer1_gpu2_qkv -->
<g id="node149" class="node">
<title>layer1_gpu2_qkv</title>
<polygon fill="none" stroke="black" points="34148,-524 34018,-524 34018,-456 34148,-456 34148,-524"/>
<text text-anchor="middle" x="34083" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="34083" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="34083" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="34083" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer1_gpu2_reshape -->
<g id="node150" class="node">
<title>layer1_gpu2_reshape</title>
<ellipse fill="none" stroke="black" cx="33932" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="33932" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="33932" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="33932" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer1_gpu2_attn -->
<g id="node151" class="node">
<title>layer1_gpu2_attn</title>
<polygon fill="none" stroke="black" points="33691,-558 33536,-490 33691,-422 33846,-490 33691,-558"/>
<text text-anchor="middle" x="33691" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="33691" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="33691" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="33691" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer1_gpu2_out_proj -->
<g id="node152" class="node">
<title>layer1_gpu2_out_proj</title>
<polygon fill="none" stroke="black" points="25481,-524 25337,-524 25337,-456 25481,-456 25481,-524"/>
<text text-anchor="middle" x="25409" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="25409" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="25409" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="25409" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer1_gpu2_out_proj&#45;&gt;layer1_concat_group0 -->
<g id="edge35" class="edge">
<title>layer1_gpu2_out_proj&#45;&gt;layer1_concat_group0</title>
<path fill="none" stroke="black" d="M25336.82,-488.76C25174.48,-486.61 24769.31,-472.25 24444,-386 24431.39,-382.66 24418.45,-378.3 24405.8,-373.48"/>
<polygon fill="black" stroke="black" points="24406.79,-370.1 24396.2,-369.7 24404.23,-376.62 24406.79,-370.1"/>
</g>
<!-- layer1_gpu2_ln2 -->
<g id="node153" class="node">
<title>layer1_gpu2_ln2</title>
<ellipse fill="none" stroke="black" cx="33191" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="33191" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="33191" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="33191" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer1_gpu2_gate -->
<g id="node154" class="node">
<title>layer1_gpu2_gate</title>
<ellipse fill="none" stroke="black" cx="34240" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="34240" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="34240" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="34240" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer1_gpu2_gate&#45;&gt;layer1_expert_all2all -->
<g id="edge36" class="edge">
<title>layer1_gpu2_gate&#45;&gt;layer1_expert_all2all</title>
<path fill="none" stroke="black" d="M34270.68,-455.82C34285.12,-442.61 34303.45,-428.92 34323,-422 34459.23,-373.81 75800.43,-419.5 75941,-386 75955.7,-382.5 75970.66,-376.84 75984.74,-370.38"/>
<polygon fill="black" stroke="black" points="75986.34,-373.49 75993.86,-366.03 75983.32,-367.17 75986.34,-373.49"/>
</g>
<!-- layer1_gpu2_expert4_mlp1 -->
<g id="node155" class="node">
<title>layer1_gpu2_expert4_mlp1</title>
<polygon fill="none" stroke="black" points="32932.5,-516.5 32795.5,-516.5 32795.5,-463.5 32932.5,-463.5 32932.5,-516.5"/>
<text text-anchor="middle" x="32864" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 4 Dense1</text>
<text text-anchor="middle" x="32864" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="32864" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer1_gpu2_expert4_gelu -->
<g id="node156" class="node">
<title>layer1_gpu2_expert4_gelu</title>
<ellipse fill="none" stroke="black" cx="32682" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="32682" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 4 GELU</text>
<text text-anchor="middle" x="32682" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="32682" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer1_gpu2_expert4_mlp2 -->
<g id="node157" class="node">
<title>layer1_gpu2_expert4_mlp2</title>
<polygon fill="none" stroke="black" points="32568.5,-516.5 32431.5,-516.5 32431.5,-463.5 32568.5,-463.5 32568.5,-516.5"/>
<text text-anchor="middle" x="32500" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 4 Dense2</text>
<text text-anchor="middle" x="32500" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="32500" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer1_gpu2_expert4_weight -->
<g id="node158" class="node">
<title>layer1_gpu2_expert4_weight</title>
<ellipse fill="none" stroke="black" cx="32318" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="32318" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 4 Weight</text>
<text text-anchor="middle" x="32318" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="32318" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer1_gpu2_expert5_mlp1 -->
<g id="node159" class="node">
<title>layer1_gpu2_expert5_mlp1</title>
<polygon fill="none" stroke="black" points="32204.5,-516.5 32067.5,-516.5 32067.5,-463.5 32204.5,-463.5 32204.5,-516.5"/>
<text text-anchor="middle" x="32136" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 5 Dense1</text>
<text text-anchor="middle" x="32136" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="32136" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer1_gpu2_expert5_gelu -->
<g id="node160" class="node">
<title>layer1_gpu2_expert5_gelu</title>
<ellipse fill="none" stroke="black" cx="31954" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="31954" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 5 GELU</text>
<text text-anchor="middle" x="31954" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="31954" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer1_gpu2_expert5_mlp2 -->
<g id="node161" class="node">
<title>layer1_gpu2_expert5_mlp2</title>
<polygon fill="none" stroke="black" points="31840.5,-516.5 31703.5,-516.5 31703.5,-463.5 31840.5,-463.5 31840.5,-516.5"/>
<text text-anchor="middle" x="31772" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 5 Dense2</text>
<text text-anchor="middle" x="31772" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="31772" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer1_gpu2_expert5_weight -->
<g id="node162" class="node">
<title>layer1_gpu2_expert5_weight</title>
<ellipse fill="none" stroke="black" cx="31590" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="31590" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 5 Weight</text>
<text text-anchor="middle" x="31590" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="31590" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer1_gpu2_moe_agg -->
<g id="node163" class="node">
<title>layer1_gpu2_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="33513.5,-471.57 33513.5,-508.43 33447.6,-534.5 33354.4,-534.5 33288.5,-508.43 33288.5,-471.57 33354.4,-445.5 33447.6,-445.5 33513.5,-471.57"/>
<polygon fill="none" stroke="black" points="33517.5,-468.85 33517.5,-511.15 33448.36,-538.5 33353.64,-538.5 33284.5,-511.15 33284.5,-468.85 33353.64,-441.5 33448.36,-441.5 33517.5,-468.85"/>
<text text-anchor="middle" x="33401" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="33401" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="33401" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer2_gpu2_ln1 -->
<g id="node164" class="node">
<title>layer2_gpu2_ln1</title>
<ellipse fill="none" stroke="black" cx="28155" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="28155" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="28155" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="28155" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer2_gpu2_qkv -->
<g id="node165" class="node">
<title>layer2_gpu2_qkv</title>
<polygon fill="none" stroke="black" points="31056,-524 30926,-524 30926,-456 31056,-456 31056,-524"/>
<text text-anchor="middle" x="30991" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="30991" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="30991" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="30991" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer2_gpu2_reshape -->
<g id="node166" class="node">
<title>layer2_gpu2_reshape</title>
<ellipse fill="none" stroke="black" cx="30840" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="30840" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="30840" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="30840" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer2_gpu2_attn -->
<g id="node167" class="node">
<title>layer2_gpu2_attn</title>
<polygon fill="none" stroke="black" points="30599,-558 30444,-490 30599,-422 30754,-490 30599,-558"/>
<text text-anchor="middle" x="30599" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="30599" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="30599" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="30599" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer2_gpu2_out_proj -->
<g id="node168" class="node">
<title>layer2_gpu2_out_proj</title>
<polygon fill="none" stroke="black" points="28393,-524 28249,-524 28249,-456 28393,-456 28393,-524"/>
<text text-anchor="middle" x="28321" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="28321" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="28321" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="28321" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer2_gpu2_out_proj&#45;&gt;layer2_concat_group0 -->
<g id="edge37" class="edge">
<title>layer2_gpu2_out_proj&#45;&gt;layer2_concat_group0</title>
<path fill="none" stroke="black" d="M28291.16,-455.94C28277.09,-442.75 28259.19,-429.04 28240,-422 28087.96,-366.2 25483.08,-421.22 25325,-386 25312.88,-383.3 25300.52,-379.4 25288.49,-374.86"/>
<polygon fill="black" stroke="black" points="25289.5,-371.5 25278.91,-371.11 25286.94,-378.02 25289.5,-371.5"/>
</g>
<!-- layer2_gpu2_ln2 -->
<g id="node169" class="node">
<title>layer2_gpu2_ln2</title>
<ellipse fill="none" stroke="black" cx="30181" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="30181" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="30181" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="30181" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer2_gpu2_gate -->
<g id="node170" class="node">
<title>layer2_gpu2_gate</title>
<ellipse fill="none" stroke="black" cx="37328" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="37328" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="37328" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="37328" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer2_gpu2_gate&#45;&gt;layer2_expert_all2all -->
<g id="edge38" class="edge">
<title>layer2_gpu2_gate&#45;&gt;layer2_expert_all2all</title>
<path fill="none" stroke="black" d="M37359.99,-455.8C37374.99,-442.58 37393.96,-428.9 37414,-422 37670.08,-333.89 76147.57,-448.79 76411,-386 76425.7,-382.5 76440.66,-376.84 76454.74,-370.37"/>
<polygon fill="black" stroke="black" points="76456.34,-373.49 76463.86,-366.03 76453.32,-367.17 76456.34,-373.49"/>
</g>
<!-- layer2_gpu2_expert4_mlp1 -->
<g id="node171" class="node">
<title>layer2_gpu2_expert4_mlp1</title>
<polygon fill="none" stroke="black" points="29848.5,-516.5 29711.5,-516.5 29711.5,-463.5 29848.5,-463.5 29848.5,-516.5"/>
<text text-anchor="middle" x="29780" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 4 Dense1</text>
<text text-anchor="middle" x="29780" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="29780" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer2_gpu2_expert4_gelu -->
<g id="node172" class="node">
<title>layer2_gpu2_expert4_gelu</title>
<ellipse fill="none" stroke="black" cx="29598" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="29598" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 4 GELU</text>
<text text-anchor="middle" x="29598" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="29598" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer2_gpu2_expert4_mlp2 -->
<g id="node173" class="node">
<title>layer2_gpu2_expert4_mlp2</title>
<polygon fill="none" stroke="black" points="29484.5,-516.5 29347.5,-516.5 29347.5,-463.5 29484.5,-463.5 29484.5,-516.5"/>
<text text-anchor="middle" x="29416" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 4 Dense2</text>
<text text-anchor="middle" x="29416" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="29416" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer2_gpu2_expert4_weight -->
<g id="node174" class="node">
<title>layer2_gpu2_expert4_weight</title>
<ellipse fill="none" stroke="black" cx="29234" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="29234" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 4 Weight</text>
<text text-anchor="middle" x="29234" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="29234" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer2_gpu2_expert5_mlp1 -->
<g id="node175" class="node">
<title>layer2_gpu2_expert5_mlp1</title>
<polygon fill="none" stroke="black" points="29120.5,-516.5 28983.5,-516.5 28983.5,-463.5 29120.5,-463.5 29120.5,-516.5"/>
<text text-anchor="middle" x="29052" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 5 Dense1</text>
<text text-anchor="middle" x="29052" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="29052" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer2_gpu2_expert5_gelu -->
<g id="node176" class="node">
<title>layer2_gpu2_expert5_gelu</title>
<ellipse fill="none" stroke="black" cx="28870" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="28870" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 5 GELU</text>
<text text-anchor="middle" x="28870" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="28870" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer2_gpu2_expert5_mlp2 -->
<g id="node177" class="node">
<title>layer2_gpu2_expert5_mlp2</title>
<polygon fill="none" stroke="black" points="28756.5,-516.5 28619.5,-516.5 28619.5,-463.5 28756.5,-463.5 28756.5,-516.5"/>
<text text-anchor="middle" x="28688" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 5 Dense2</text>
<text text-anchor="middle" x="28688" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="28688" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer2_gpu2_expert5_weight -->
<g id="node178" class="node">
<title>layer2_gpu2_expert5_weight</title>
<ellipse fill="none" stroke="black" cx="28506" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="28506" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 5 Weight</text>
<text text-anchor="middle" x="28506" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="28506" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer2_gpu2_moe_agg -->
<g id="node179" class="node">
<title>layer2_gpu2_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="36601.5,-471.57 36601.5,-508.43 36535.6,-534.5 36442.4,-534.5 36376.5,-508.43 36376.5,-471.57 36442.4,-445.5 36535.6,-445.5 36601.5,-471.57"/>
<polygon fill="none" stroke="black" points="36605.5,-468.85 36605.5,-511.15 36536.36,-538.5 36441.64,-538.5 36372.5,-511.15 36372.5,-468.85 36441.64,-441.5 36536.36,-441.5 36605.5,-468.85"/>
<text text-anchor="middle" x="36489" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="36489" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="36489" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer3_gpu2_ln1 -->
<g id="node180" class="node">
<title>layer3_gpu2_ln1</title>
<ellipse fill="none" stroke="black" cx="31150" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="31150" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="31150" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="31150" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer3_gpu2_qkv -->
<g id="node181" class="node">
<title>layer3_gpu2_qkv</title>
<polygon fill="none" stroke="black" points="28061,-524 27931,-524 27931,-456 28061,-456 28061,-524"/>
<text text-anchor="middle" x="27996" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="27996" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="27996" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="27996" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer3_gpu2_reshape -->
<g id="node182" class="node">
<title>layer3_gpu2_reshape</title>
<ellipse fill="none" stroke="black" cx="27845" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="27845" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="27845" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="27845" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer3_gpu2_attn -->
<g id="node183" class="node">
<title>layer3_gpu2_attn</title>
<polygon fill="none" stroke="black" points="27604,-558 27449,-490 27604,-422 27759,-490 27604,-558"/>
<text text-anchor="middle" x="27604" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="27604" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="27604" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="27604" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer3_gpu2_out_proj -->
<g id="node184" class="node">
<title>layer3_gpu2_out_proj</title>
<polygon fill="none" stroke="black" points="27099,-524 26955,-524 26955,-456 27099,-456 27099,-524"/>
<text text-anchor="middle" x="27027" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="27027" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="27027" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="27027" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer3_gpu2_out_proj&#45;&gt;layer3_concat_group0 -->
<g id="edge39" class="edge">
<title>layer3_gpu2_out_proj&#45;&gt;layer3_concat_group0</title>
<path fill="none" stroke="black" d="M26997.15,-455.97C26983.08,-442.79 26965.18,-429.08 26946,-422 26713.31,-336.11 24956.37,-438.69 24714,-386 24700.83,-383.14 24687.35,-378.95 24674.27,-374.11"/>
<polygon fill="black" stroke="black" points="24675.4,-370.8 24664.81,-370.48 24672.89,-377.33 24675.4,-370.8"/>
</g>
<!-- layer3_gpu2_ln2 -->
<g id="node185" class="node">
<title>layer3_gpu2_ln2</title>
<ellipse fill="none" stroke="black" cx="27193" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="27193" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="27193" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="27193" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer3_gpu2_gate -->
<g id="node186" class="node">
<title>layer3_gpu2_gate</title>
<ellipse fill="none" stroke="black" cx="33024" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="33024" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="33024" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="33024" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer3_gpu2_gate&#45;&gt;layer3_expert_all2all -->
<g id="edge40" class="edge">
<title>layer3_gpu2_gate&#45;&gt;layer3_expert_all2all</title>
<path fill="none" stroke="black" d="M33054.62,-455.47C33068.81,-442.37 33086.78,-428.86 33106,-422 33245.32,-372.26 75566.35,-421.31 75710,-386 75723.79,-382.61 75737.78,-377.21 75750.98,-371.02"/>
<polygon fill="black" stroke="black" points="75752.54,-374.16 75759.99,-366.63 75749.47,-367.87 75752.54,-374.16"/>
</g>
<!-- layer3_gpu2_expert4_mlp1 -->
<g id="node187" class="node">
<title>layer3_gpu2_expert4_mlp1</title>
<polygon fill="none" stroke="black" points="26936.5,-516.5 26799.5,-516.5 26799.5,-463.5 26936.5,-463.5 26936.5,-516.5"/>
<text text-anchor="middle" x="26868" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 4 Dense1</text>
<text text-anchor="middle" x="26868" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="26868" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer3_gpu2_expert4_gelu -->
<g id="node188" class="node">
<title>layer3_gpu2_expert4_gelu</title>
<ellipse fill="none" stroke="black" cx="26686" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="26686" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 4 GELU</text>
<text text-anchor="middle" x="26686" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="26686" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer3_gpu2_expert4_mlp2 -->
<g id="node189" class="node">
<title>layer3_gpu2_expert4_mlp2</title>
<polygon fill="none" stroke="black" points="26572.5,-516.5 26435.5,-516.5 26435.5,-463.5 26572.5,-463.5 26572.5,-516.5"/>
<text text-anchor="middle" x="26504" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 4 Dense2</text>
<text text-anchor="middle" x="26504" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="26504" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer3_gpu2_expert4_weight -->
<g id="node190" class="node">
<title>layer3_gpu2_expert4_weight</title>
<ellipse fill="none" stroke="black" cx="26322" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="26322" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 4 Weight</text>
<text text-anchor="middle" x="26322" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="26322" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer3_gpu2_expert5_mlp1 -->
<g id="node191" class="node">
<title>layer3_gpu2_expert5_mlp1</title>
<polygon fill="none" stroke="black" points="26208.5,-516.5 26071.5,-516.5 26071.5,-463.5 26208.5,-463.5 26208.5,-516.5"/>
<text text-anchor="middle" x="26140" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 5 Dense1</text>
<text text-anchor="middle" x="26140" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="26140" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer3_gpu2_expert5_gelu -->
<g id="node192" class="node">
<title>layer3_gpu2_expert5_gelu</title>
<ellipse fill="none" stroke="black" cx="25958" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="25958" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 5 GELU</text>
<text text-anchor="middle" x="25958" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="25958" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer3_gpu2_expert5_mlp2 -->
<g id="node193" class="node">
<title>layer3_gpu2_expert5_mlp2</title>
<polygon fill="none" stroke="black" points="25844.5,-516.5 25707.5,-516.5 25707.5,-463.5 25844.5,-463.5 25844.5,-516.5"/>
<text text-anchor="middle" x="25776" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 5 Dense2</text>
<text text-anchor="middle" x="25776" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="25776" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer3_gpu2_expert5_weight -->
<g id="node194" class="node">
<title>layer3_gpu2_expert5_weight</title>
<ellipse fill="none" stroke="black" cx="25594" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="25594" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 5 Weight</text>
<text text-anchor="middle" x="25594" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="25594" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- layer3_gpu2_moe_agg -->
<g id="node195" class="node">
<title>layer3_gpu2_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="31472.5,-471.57 31472.5,-508.43 31406.6,-534.5 31313.4,-534.5 31247.5,-508.43 31247.5,-471.57 31313.4,-445.5 31406.6,-445.5 31472.5,-471.57"/>
<polygon fill="none" stroke="black" points="31476.5,-468.85 31476.5,-511.15 31407.36,-538.5 31312.64,-538.5 31243.5,-511.15 31243.5,-468.85 31312.64,-441.5 31407.36,-441.5 31476.5,-468.85"/>
<text text-anchor="middle" x="31360" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="31360" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="31360" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- embed_3 -->
<g id="node196" class="node">
<title>embed_3</title>
<polygon fill="none" stroke="black" points="42176,-516.5 41956,-516.5 41956,-463.5 42176,-463.5 42176,-516.5"/>
<text text-anchor="middle" x="42066" y="-501.3" font-family="Times,serif" font-size="14.00">Input Embedding</text>
<text text-anchor="middle" x="42066" y="-486.3" font-family="Times,serif" font-size="14.00">[B=1024, L=2048, D=8192]</text>
<text text-anchor="middle" x="42066" y="-471.3" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer0_gpu3_ln1 -->
<g id="node197" class="node">
<title>layer0_gpu3_ln1</title>
<ellipse fill="none" stroke="black" cx="42066" cy="-326" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="42066" y="-337.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="42066" y="-322.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="42066" y="-307.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- embed_3&#45;&gt;layer0_gpu3_ln1 -->
<g id="edge4" class="edge">
<title>embed_3&#45;&gt;layer0_gpu3_ln1</title>
<path fill="none" stroke="black" d="M42066,-463.33C42066,-439.41 42066,-403.17 42066,-374.06"/>
<polygon fill="black" stroke="black" points="42069.5,-373.69 42066,-363.69 42062.5,-373.69 42069.5,-373.69"/>
</g>
<!-- layer0_gpu3_qkv -->
<g id="node198" class="node">
<title>layer0_gpu3_qkv</title>
<polygon fill="none" stroke="black" points="49325,-524 49195,-524 49195,-456 49325,-456 49325,-524"/>
<text text-anchor="middle" x="49260" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="49260" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="49260" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="49260" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer0_gpu3_reshape -->
<g id="node199" class="node">
<title>layer0_gpu3_reshape</title>
<ellipse fill="none" stroke="black" cx="49109" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="49109" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="49109" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="49109" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer0_gpu3_attn -->
<g id="node200" class="node">
<title>layer0_gpu3_attn</title>
<polygon fill="none" stroke="black" points="48868,-558 48713,-490 48868,-422 49023,-490 48868,-558"/>
<text text-anchor="middle" x="48868" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="48868" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="48868" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="48868" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer0_gpu3_out_proj -->
<g id="node201" class="node">
<title>layer0_gpu3_out_proj</title>
<polygon fill="none" stroke="black" points="39520,-524 39376,-524 39376,-456 39520,-456 39520,-524"/>
<text text-anchor="middle" x="39448" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="39448" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="39448" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="39448" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer0_gpu3_out_proj&#45;&gt;layer0_concat_group0 -->
<g id="edge41" class="edge">
<title>layer0_gpu3_out_proj&#45;&gt;layer0_concat_group0</title>
<path fill="none" stroke="black" d="M39418.19,-455.85C39404.13,-442.64 39386.22,-428.95 39367,-422 39180.12,-354.46 25256.83,-413.25 25060,-386 25027.96,-381.56 24993.92,-373.56 24962.74,-364.86"/>
<polygon fill="black" stroke="black" points="24963.31,-361.38 24952.73,-362.01 24961.39,-368.11 24963.31,-361.38"/>
</g>
<!-- layer0_gpu3_ln2 -->
<g id="node202" class="node">
<title>layer0_gpu3_ln2</title>
<ellipse fill="none" stroke="black" cx="48368" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="48368" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="48368" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="48368" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer0_gpu3_gate -->
<g id="node203" class="node">
<title>layer0_gpu3_gate</title>
<ellipse fill="none" stroke="black" cx="48201" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="48201" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="48201" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="48201" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer0_gpu3_gate&#45;&gt;layer0_expert_all2all -->
<g id="edge42" class="edge">
<title>layer0_gpu3_gate&#45;&gt;layer0_expert_all2all</title>
<path fill="none" stroke="black" d="M48231.63,-455.47C48245.82,-442.37 48263.78,-428.87 48283,-422 48465.41,-356.82 75987.59,-430.95 76176,-386 76190.7,-382.49 76205.66,-376.83 76219.74,-370.37"/>
<polygon fill="black" stroke="black" points="76221.33,-373.49 76228.85,-366.02 76218.32,-367.17 76221.33,-373.49"/>
</g>
<!-- layer0_gpu3_expert6_mlp1 -->
<g id="node204" class="node">
<title>layer0_gpu3_expert6_mlp1</title>
<polygon fill="none" stroke="black" points="48109.5,-516.5 47972.5,-516.5 47972.5,-463.5 48109.5,-463.5 48109.5,-516.5"/>
<text text-anchor="middle" x="48041" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 6 Dense1</text>
<text text-anchor="middle" x="48041" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="48041" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer0_gpu3_expert6_gelu -->
<g id="node205" class="node">
<title>layer0_gpu3_expert6_gelu</title>
<ellipse fill="none" stroke="black" cx="47859" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="47859" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 6 GELU</text>
<text text-anchor="middle" x="47859" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="47859" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer0_gpu3_expert6_mlp2 -->
<g id="node206" class="node">
<title>layer0_gpu3_expert6_mlp2</title>
<polygon fill="none" stroke="black" points="47745.5,-516.5 47608.5,-516.5 47608.5,-463.5 47745.5,-463.5 47745.5,-516.5"/>
<text text-anchor="middle" x="47677" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 6 Dense2</text>
<text text-anchor="middle" x="47677" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="47677" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer0_gpu3_expert6_weight -->
<g id="node207" class="node">
<title>layer0_gpu3_expert6_weight</title>
<ellipse fill="none" stroke="black" cx="47495" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="47495" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 6 Weight</text>
<text text-anchor="middle" x="47495" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="47495" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer0_gpu3_expert7_mlp1 -->
<g id="node208" class="node">
<title>layer0_gpu3_expert7_mlp1</title>
<polygon fill="none" stroke="black" points="47381.5,-516.5 47244.5,-516.5 47244.5,-463.5 47381.5,-463.5 47381.5,-516.5"/>
<text text-anchor="middle" x="47313" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 7 Dense1</text>
<text text-anchor="middle" x="47313" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="47313" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer0_gpu3_expert7_gelu -->
<g id="node209" class="node">
<title>layer0_gpu3_expert7_gelu</title>
<ellipse fill="none" stroke="black" cx="47131" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="47131" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 7 GELU</text>
<text text-anchor="middle" x="47131" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="47131" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer0_gpu3_expert7_mlp2 -->
<g id="node210" class="node">
<title>layer0_gpu3_expert7_mlp2</title>
<polygon fill="none" stroke="black" points="47017.5,-516.5 46880.5,-516.5 46880.5,-463.5 47017.5,-463.5 47017.5,-516.5"/>
<text text-anchor="middle" x="46949" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 7 Dense2</text>
<text text-anchor="middle" x="46949" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="46949" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer0_gpu3_expert7_weight -->
<g id="node211" class="node">
<title>layer0_gpu3_expert7_weight</title>
<ellipse fill="none" stroke="black" cx="46767" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="46767" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 7 Weight</text>
<text text-anchor="middle" x="46767" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="46767" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer0_gpu3_moe_agg -->
<g id="node212" class="node">
<title>layer0_gpu3_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="46649.5,-471.57 46649.5,-508.43 46583.6,-534.5 46490.4,-534.5 46424.5,-508.43 46424.5,-471.57 46490.4,-445.5 46583.6,-445.5 46649.5,-471.57"/>
<polygon fill="none" stroke="black" points="46653.5,-468.85 46653.5,-511.15 46584.36,-538.5 46489.64,-538.5 46420.5,-511.15 46420.5,-468.85 46489.64,-441.5 46584.36,-441.5 46653.5,-468.85"/>
<text text-anchor="middle" x="46537" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="46537" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="46537" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer1_gpu3_ln1 -->
<g id="node213" class="node">
<title>layer1_gpu3_ln1</title>
<ellipse fill="none" stroke="black" cx="42439" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="42439" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="42439" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="42439" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer1_gpu3_qkv -->
<g id="node214" class="node">
<title>layer1_gpu3_qkv</title>
<polygon fill="none" stroke="black" points="46237,-524 46107,-524 46107,-456 46237,-456 46237,-524"/>
<text text-anchor="middle" x="46172" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="46172" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="46172" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="46172" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer1_gpu3_reshape -->
<g id="node215" class="node">
<title>layer1_gpu3_reshape</title>
<ellipse fill="none" stroke="black" cx="46021" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="46021" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="46021" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="46021" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer1_gpu3_attn -->
<g id="node216" class="node">
<title>layer1_gpu3_attn</title>
<polygon fill="none" stroke="black" points="45780,-558 45625,-490 45780,-422 45935,-490 45780,-558"/>
<text text-anchor="middle" x="45780" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="45780" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="45780" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="45780" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer1_gpu3_out_proj -->
<g id="node217" class="node">
<title>layer1_gpu3_out_proj</title>
<polygon fill="none" stroke="black" points="37570,-524 37426,-524 37426,-456 37570,-456 37570,-524"/>
<text text-anchor="middle" x="37498" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="37498" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="37498" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="37498" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer1_gpu3_out_proj&#45;&gt;layer1_concat_group0 -->
<g id="edge43" class="edge">
<title>layer1_gpu3_out_proj&#45;&gt;layer1_concat_group0</title>
<path fill="none" stroke="black" d="M37466.88,-455.83C37452.25,-442.62 37433.71,-428.93 37414,-422 37244.05,-362.26 24620.28,-423.09 24444,-386 24430.71,-383.2 24417.12,-379.03 24403.93,-374.16"/>
<polygon fill="black" stroke="black" points="24405,-370.83 24394.41,-370.51 24402.49,-377.36 24405,-370.83"/>
</g>
<!-- layer1_gpu3_ln2 -->
<g id="node218" class="node">
<title>layer1_gpu3_ln2</title>
<ellipse fill="none" stroke="black" cx="45280" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="45280" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="45280" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="45280" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer1_gpu3_gate -->
<g id="node219" class="node">
<title>layer1_gpu3_gate</title>
<ellipse fill="none" stroke="black" cx="46329" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="46329" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="46329" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="46329" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer1_gpu3_gate&#45;&gt;layer1_expert_all2all -->
<g id="edge44" class="edge">
<title>layer1_gpu3_gate&#45;&gt;layer1_expert_all2all</title>
<path fill="none" stroke="black" d="M46359.68,-455.82C46374.12,-442.61 46392.45,-428.92 46412,-422 46605.31,-353.58 75741.53,-433.58 75941,-386 75955.7,-382.49 75970.66,-376.83 75984.74,-370.37"/>
<polygon fill="black" stroke="black" points="75986.33,-373.49 75993.85,-366.02 75983.32,-367.17 75986.33,-373.49"/>
</g>
<!-- layer1_gpu3_expert6_mlp1 -->
<g id="node220" class="node">
<title>layer1_gpu3_expert6_mlp1</title>
<polygon fill="none" stroke="black" points="45021.5,-516.5 44884.5,-516.5 44884.5,-463.5 45021.5,-463.5 45021.5,-516.5"/>
<text text-anchor="middle" x="44953" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 6 Dense1</text>
<text text-anchor="middle" x="44953" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="44953" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer1_gpu3_expert6_gelu -->
<g id="node221" class="node">
<title>layer1_gpu3_expert6_gelu</title>
<ellipse fill="none" stroke="black" cx="44771" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="44771" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 6 GELU</text>
<text text-anchor="middle" x="44771" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="44771" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer1_gpu3_expert6_mlp2 -->
<g id="node222" class="node">
<title>layer1_gpu3_expert6_mlp2</title>
<polygon fill="none" stroke="black" points="44657.5,-516.5 44520.5,-516.5 44520.5,-463.5 44657.5,-463.5 44657.5,-516.5"/>
<text text-anchor="middle" x="44589" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 6 Dense2</text>
<text text-anchor="middle" x="44589" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="44589" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer1_gpu3_expert6_weight -->
<g id="node223" class="node">
<title>layer1_gpu3_expert6_weight</title>
<ellipse fill="none" stroke="black" cx="44407" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="44407" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 6 Weight</text>
<text text-anchor="middle" x="44407" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="44407" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer1_gpu3_expert7_mlp1 -->
<g id="node224" class="node">
<title>layer1_gpu3_expert7_mlp1</title>
<polygon fill="none" stroke="black" points="44293.5,-516.5 44156.5,-516.5 44156.5,-463.5 44293.5,-463.5 44293.5,-516.5"/>
<text text-anchor="middle" x="44225" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 7 Dense1</text>
<text text-anchor="middle" x="44225" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="44225" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer1_gpu3_expert7_gelu -->
<g id="node225" class="node">
<title>layer1_gpu3_expert7_gelu</title>
<ellipse fill="none" stroke="black" cx="44043" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="44043" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 7 GELU</text>
<text text-anchor="middle" x="44043" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="44043" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer1_gpu3_expert7_mlp2 -->
<g id="node226" class="node">
<title>layer1_gpu3_expert7_mlp2</title>
<polygon fill="none" stroke="black" points="43929.5,-516.5 43792.5,-516.5 43792.5,-463.5 43929.5,-463.5 43929.5,-516.5"/>
<text text-anchor="middle" x="43861" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 7 Dense2</text>
<text text-anchor="middle" x="43861" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="43861" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer1_gpu3_expert7_weight -->
<g id="node227" class="node">
<title>layer1_gpu3_expert7_weight</title>
<ellipse fill="none" stroke="black" cx="43679" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="43679" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 7 Weight</text>
<text text-anchor="middle" x="43679" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="43679" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer1_gpu3_moe_agg -->
<g id="node228" class="node">
<title>layer1_gpu3_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="45602.5,-471.57 45602.5,-508.43 45536.6,-534.5 45443.4,-534.5 45377.5,-508.43 45377.5,-471.57 45443.4,-445.5 45536.6,-445.5 45602.5,-471.57"/>
<polygon fill="none" stroke="black" points="45606.5,-468.85 45606.5,-511.15 45537.36,-538.5 45442.64,-538.5 45373.5,-511.15 45373.5,-468.85 45442.64,-441.5 45537.36,-441.5 45606.5,-468.85"/>
<text text-anchor="middle" x="45490" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="45490" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="45490" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer2_gpu3_ln1 -->
<g id="node229" class="node">
<title>layer2_gpu3_ln1</title>
<ellipse fill="none" stroke="black" cx="40406" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="40406" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="40406" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="40406" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer2_gpu3_qkv -->
<g id="node230" class="node">
<title>layer2_gpu3_qkv</title>
<polygon fill="none" stroke="black" points="43145,-524 43015,-524 43015,-456 43145,-456 43145,-524"/>
<text text-anchor="middle" x="43080" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="43080" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="43080" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="43080" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer2_gpu3_reshape -->
<g id="node231" class="node">
<title>layer2_gpu3_reshape</title>
<ellipse fill="none" stroke="black" cx="42929" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="42929" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="42929" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="42929" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer2_gpu3_attn -->
<g id="node232" class="node">
<title>layer2_gpu3_attn</title>
<polygon fill="none" stroke="black" points="42688,-558 42533,-490 42688,-422 42843,-490 42688,-558"/>
<text text-anchor="middle" x="42688" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="42688" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="42688" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="42688" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer2_gpu3_out_proj -->
<g id="node233" class="node">
<title>layer2_gpu3_out_proj</title>
<polygon fill="none" stroke="black" points="40312,-524 40168,-524 40168,-456 40312,-456 40312,-524"/>
<text text-anchor="middle" x="40240" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="40240" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="40240" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="40240" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer2_gpu3_out_proj&#45;&gt;layer2_concat_group0 -->
<g id="edge45" class="edge">
<title>layer2_gpu3_out_proj&#45;&gt;layer2_concat_group0</title>
<path fill="none" stroke="black" d="M40210.19,-455.85C40196.13,-442.64 40178.22,-428.95 40159,-422 39965.23,-351.98 25526.32,-429.8 25325,-386 25312.87,-383.36 25300.5,-379.49 25288.46,-374.98"/>
<polygon fill="black" stroke="black" points="25289.47,-371.62 25278.89,-371.23 25286.92,-378.14 25289.47,-371.62"/>
</g>
<!-- layer2_gpu3_ln2 -->
<g id="node234" class="node">
<title>layer2_gpu3_ln2</title>
<ellipse fill="none" stroke="black" cx="42270" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="42270" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="42270" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="42270" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer2_gpu3_gate -->
<g id="node235" class="node">
<title>layer2_gpu3_gate</title>
<ellipse fill="none" stroke="black" cx="49417" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="49417" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="49417" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="49417" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer2_gpu3_gate&#45;&gt;layer2_expert_all2all -->
<g id="edge46" class="edge">
<title>layer2_gpu3_gate&#45;&gt;layer2_expert_all2all</title>
<path fill="none" stroke="black" d="M49449,-455.8C49463.99,-442.59 49482.96,-428.9 49503,-422 49679.68,-361.17 76229.24,-429.36 76411,-386 76425.7,-382.49 76440.66,-376.83 76454.74,-370.37"/>
<polygon fill="black" stroke="black" points="76456.33,-373.49 76463.85,-366.02 76453.32,-367.17 76456.33,-373.49"/>
</g>
<!-- layer2_gpu3_expert6_mlp1 -->
<g id="node236" class="node">
<title>layer2_gpu3_expert6_mlp1</title>
<polygon fill="none" stroke="black" points="41937.5,-516.5 41800.5,-516.5 41800.5,-463.5 41937.5,-463.5 41937.5,-516.5"/>
<text text-anchor="middle" x="41869" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 6 Dense1</text>
<text text-anchor="middle" x="41869" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="41869" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer2_gpu3_expert6_gelu -->
<g id="node237" class="node">
<title>layer2_gpu3_expert6_gelu</title>
<ellipse fill="none" stroke="black" cx="41687" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="41687" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 6 GELU</text>
<text text-anchor="middle" x="41687" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="41687" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer2_gpu3_expert6_mlp2 -->
<g id="node238" class="node">
<title>layer2_gpu3_expert6_mlp2</title>
<polygon fill="none" stroke="black" points="41573.5,-516.5 41436.5,-516.5 41436.5,-463.5 41573.5,-463.5 41573.5,-516.5"/>
<text text-anchor="middle" x="41505" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 6 Dense2</text>
<text text-anchor="middle" x="41505" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="41505" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer2_gpu3_expert6_weight -->
<g id="node239" class="node">
<title>layer2_gpu3_expert6_weight</title>
<ellipse fill="none" stroke="black" cx="41323" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="41323" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 6 Weight</text>
<text text-anchor="middle" x="41323" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="41323" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer2_gpu3_expert7_mlp1 -->
<g id="node240" class="node">
<title>layer2_gpu3_expert7_mlp1</title>
<polygon fill="none" stroke="black" points="41209.5,-516.5 41072.5,-516.5 41072.5,-463.5 41209.5,-463.5 41209.5,-516.5"/>
<text text-anchor="middle" x="41141" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 7 Dense1</text>
<text text-anchor="middle" x="41141" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="41141" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer2_gpu3_expert7_gelu -->
<g id="node241" class="node">
<title>layer2_gpu3_expert7_gelu</title>
<ellipse fill="none" stroke="black" cx="40959" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="40959" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 7 GELU</text>
<text text-anchor="middle" x="40959" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="40959" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer2_gpu3_expert7_mlp2 -->
<g id="node242" class="node">
<title>layer2_gpu3_expert7_mlp2</title>
<polygon fill="none" stroke="black" points="40845.5,-516.5 40708.5,-516.5 40708.5,-463.5 40845.5,-463.5 40845.5,-516.5"/>
<text text-anchor="middle" x="40777" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 7 Dense2</text>
<text text-anchor="middle" x="40777" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="40777" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer2_gpu3_expert7_weight -->
<g id="node243" class="node">
<title>layer2_gpu3_expert7_weight</title>
<ellipse fill="none" stroke="black" cx="40595" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="40595" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 7 Weight</text>
<text text-anchor="middle" x="40595" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="40595" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer2_gpu3_moe_agg -->
<g id="node244" class="node">
<title>layer2_gpu3_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="48690.5,-471.57 48690.5,-508.43 48624.6,-534.5 48531.4,-534.5 48465.5,-508.43 48465.5,-471.57 48531.4,-445.5 48624.6,-445.5 48690.5,-471.57"/>
<polygon fill="none" stroke="black" points="48694.5,-468.85 48694.5,-511.15 48625.36,-538.5 48530.64,-538.5 48461.5,-511.15 48461.5,-468.85 48530.64,-441.5 48625.36,-441.5 48694.5,-468.85"/>
<text text-anchor="middle" x="48578" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="48578" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="48578" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer3_gpu3_ln1 -->
<g id="node245" class="node">
<title>layer3_gpu3_ln1</title>
<ellipse fill="none" stroke="black" cx="43239" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="43239" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="43239" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="43239" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer3_gpu3_qkv -->
<g id="node246" class="node">
<title>layer3_gpu3_qkv</title>
<polygon fill="none" stroke="black" points="40150,-524 40020,-524 40020,-456 40150,-456 40150,-524"/>
<text text-anchor="middle" x="40085" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="40085" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="40085" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="40085" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer3_gpu3_reshape -->
<g id="node247" class="node">
<title>layer3_gpu3_reshape</title>
<ellipse fill="none" stroke="black" cx="39934" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="39934" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="39934" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="39934" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer3_gpu3_attn -->
<g id="node248" class="node">
<title>layer3_gpu3_attn</title>
<polygon fill="none" stroke="black" points="39693,-558 39538,-490 39693,-422 39848,-490 39693,-558"/>
<text text-anchor="middle" x="39693" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="39693" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="39693" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="39693" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer3_gpu3_out_proj -->
<g id="node249" class="node">
<title>layer3_gpu3_out_proj</title>
<polygon fill="none" stroke="black" points="39188,-524 39044,-524 39044,-456 39188,-456 39188,-524"/>
<text text-anchor="middle" x="39116" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="39116" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="39116" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="39116" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer3_gpu3_out_proj&#45;&gt;layer3_concat_group0 -->
<g id="edge47" class="edge">
<title>layer3_gpu3_out_proj&#45;&gt;layer3_concat_group0</title>
<path fill="none" stroke="black" d="M39086.19,-455.85C39072.13,-442.64 39054.22,-428.95 39035,-422 38847.94,-354.39 24908.65,-426.93 24714,-386 24700.71,-383.2 24687.12,-379.03 24673.93,-374.17"/>
<polygon fill="black" stroke="black" points="24675,-370.83 24664.41,-370.52 24672.49,-377.36 24675,-370.83"/>
</g>
<!-- layer3_gpu3_ln2 -->
<g id="node250" class="node">
<title>layer3_gpu3_ln2</title>
<ellipse fill="none" stroke="black" cx="39282" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="39282" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="39282" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="39282" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer3_gpu3_gate -->
<g id="node251" class="node">
<title>layer3_gpu3_gate</title>
<ellipse fill="none" stroke="black" cx="45113" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="45113" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="45113" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="45113" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer3_gpu3_gate&#45;&gt;layer3_expert_all2all -->
<g id="edge48" class="edge">
<title>layer3_gpu3_gate&#45;&gt;layer3_expert_all2all</title>
<path fill="none" stroke="black" d="M45143.62,-455.47C45157.81,-442.37 45175.78,-428.87 45195,-422 45394.56,-350.71 75504.22,-436.62 75710,-386 75723.79,-382.61 75737.78,-377.21 75750.98,-371.02"/>
<polygon fill="black" stroke="black" points="75752.54,-374.15 75759.99,-366.62 75749.47,-367.86 75752.54,-374.15"/>
</g>
<!-- layer3_gpu3_expert6_mlp1 -->
<g id="node252" class="node">
<title>layer3_gpu3_expert6_mlp1</title>
<polygon fill="none" stroke="black" points="39025.5,-516.5 38888.5,-516.5 38888.5,-463.5 39025.5,-463.5 39025.5,-516.5"/>
<text text-anchor="middle" x="38957" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 6 Dense1</text>
<text text-anchor="middle" x="38957" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="38957" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer3_gpu3_expert6_gelu -->
<g id="node253" class="node">
<title>layer3_gpu3_expert6_gelu</title>
<ellipse fill="none" stroke="black" cx="38775" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="38775" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 6 GELU</text>
<text text-anchor="middle" x="38775" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="38775" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer3_gpu3_expert6_mlp2 -->
<g id="node254" class="node">
<title>layer3_gpu3_expert6_mlp2</title>
<polygon fill="none" stroke="black" points="38661.5,-516.5 38524.5,-516.5 38524.5,-463.5 38661.5,-463.5 38661.5,-516.5"/>
<text text-anchor="middle" x="38593" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 6 Dense2</text>
<text text-anchor="middle" x="38593" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="38593" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer3_gpu3_expert6_weight -->
<g id="node255" class="node">
<title>layer3_gpu3_expert6_weight</title>
<ellipse fill="none" stroke="black" cx="38411" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="38411" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 6 Weight</text>
<text text-anchor="middle" x="38411" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="38411" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer3_gpu3_expert7_mlp1 -->
<g id="node256" class="node">
<title>layer3_gpu3_expert7_mlp1</title>
<polygon fill="none" stroke="black" points="38297.5,-516.5 38160.5,-516.5 38160.5,-463.5 38297.5,-463.5 38297.5,-516.5"/>
<text text-anchor="middle" x="38229" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 7 Dense1</text>
<text text-anchor="middle" x="38229" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="38229" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer3_gpu3_expert7_gelu -->
<g id="node257" class="node">
<title>layer3_gpu3_expert7_gelu</title>
<ellipse fill="none" stroke="black" cx="38047" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="38047" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 7 GELU</text>
<text text-anchor="middle" x="38047" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4*8192//16]</text>
<text text-anchor="middle" x="38047" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer3_gpu3_expert7_mlp2 -->
<g id="node258" class="node">
<title>layer3_gpu3_expert7_mlp2</title>
<polygon fill="none" stroke="black" points="37933.5,-516.5 37796.5,-516.5 37796.5,-463.5 37933.5,-463.5 37933.5,-516.5"/>
<text text-anchor="middle" x="37865" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 7 Dense2</text>
<text text-anchor="middle" x="37865" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="37865" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer3_gpu3_expert7_weight -->
<g id="node259" class="node">
<title>layer3_gpu3_expert7_weight</title>
<ellipse fill="none" stroke="black" cx="37683" cy="-490" rx="95" ry="37.5"/>
<text text-anchor="middle" x="37683" y="-501.3" font-family="Times,serif" font-size="14.00">Expert 7 Weight</text>
<text text-anchor="middle" x="37683" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,1]</text>
<text text-anchor="middle" x="37683" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- layer3_gpu3_moe_agg -->
<g id="node260" class="node">
<title>layer3_gpu3_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="43561.5,-471.57 43561.5,-508.43 43495.6,-534.5 43402.4,-534.5 43336.5,-508.43 43336.5,-471.57 43402.4,-445.5 43495.6,-445.5 43561.5,-471.57"/>
<polygon fill="none" stroke="black" points="43565.5,-468.85 43565.5,-511.15 43496.36,-538.5 43401.64,-538.5 43332.5,-511.15 43332.5,-468.85 43401.64,-441.5 43496.36,-441.5 43565.5,-468.85"/>
<text text-anchor="middle" x="43449" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="43449" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="43449" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- embed_4 -->
<g id="node261" class="node">
<title>embed_4</title>
<polygon fill="none" stroke="black" points="49905,-516.5 49685,-516.5 49685,-463.5 49905,-463.5 49905,-516.5"/>
<text text-anchor="middle" x="49795" y="-501.3" font-family="Times,serif" font-size="14.00">Input Embedding</text>
<text text-anchor="middle" x="49795" y="-486.3" font-family="Times,serif" font-size="14.00">[B=1024, L=2048, D=8192]</text>
<text text-anchor="middle" x="49795" y="-471.3" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer0_gpu4_ln1 -->
<g id="node262" class="node">
<title>layer0_gpu4_ln1</title>
<ellipse fill="none" stroke="black" cx="49795" cy="-326" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="49795" y="-337.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="49795" y="-322.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="49795" y="-307.3" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- embed_4&#45;&gt;layer0_gpu4_ln1 -->
<g id="edge5" class="edge">
<title>embed_4&#45;&gt;layer0_gpu4_ln1</title>
<path fill="none" stroke="black" d="M49795,-463.33C49795,-439.41 49795,-403.17 49795,-374.06"/>
<polygon fill="black" stroke="black" points="49798.5,-373.69 49795,-363.69 49791.5,-373.69 49798.5,-373.69"/>
</g>
<!-- layer0_gpu4_qkv -->
<g id="node263" class="node">
<title>layer0_gpu4_qkv</title>
<polygon fill="none" stroke="black" points="55591,-524 55461,-524 55461,-456 55591,-456 55591,-524"/>
<text text-anchor="middle" x="55526" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="55526" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="55526" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="55526" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer0_gpu4_reshape -->
<g id="node264" class="node">
<title>layer0_gpu4_reshape</title>
<ellipse fill="none" stroke="black" cx="55375" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="55375" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="55375" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="55375" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer0_gpu4_attn -->
<g id="node265" class="node">
<title>layer0_gpu4_attn</title>
<polygon fill="none" stroke="black" points="55134,-558 54979,-490 55134,-422 55289,-490 55134,-558"/>
<text text-anchor="middle" x="55134" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="55134" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="55134" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="55134" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer0_gpu4_out_proj -->
<g id="node266" class="node">
<title>layer0_gpu4_out_proj</title>
<polygon fill="none" stroke="black" points="51700,-524 51556,-524 51556,-456 51700,-456 51700,-524"/>
<text text-anchor="middle" x="51628" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="51628" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="51628" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="51628" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer0_concat_group1 -->
<g id="node665" class="node">
<title>layer0_concat_group1</title>
<polygon fill="yellow" stroke="black" points="62826,-302.8 62826,-349.2 62754.53,-382 62653.47,-382 62582,-349.2 62582,-302.8 62653.47,-270 62754.53,-270 62826,-302.8"/>
<polygon fill="none" stroke="black" points="62830,-300.24 62830,-351.76 62755.41,-386 62652.59,-386 62578,-351.76 62578,-300.24 62652.59,-266 62755.41,-266 62830,-300.24"/>
<text text-anchor="middle" x="62704" y="-344.8" font-family="Times,serif" font-size="14.00">Concat Dimensions</text>
<text text-anchor="middle" x="62704" y="-329.8" font-family="Times,serif" font-size="14.00">Head Group 1</text>
<text text-anchor="middle" x="62704" y="-314.8" font-family="Times,serif" font-size="14.00">[B,L,4,512]</text>
<text text-anchor="middle" x="62704" y="-299.8" font-family="Times,serif" font-size="14.00">GPUs 4&#45;7</text>
</g>
<!-- layer0_gpu4_out_proj&#45;&gt;layer0_concat_group1 -->
<g id="edge49" class="edge">
<title>layer0_gpu4_out_proj&#45;&gt;layer0_concat_group1</title>
<path fill="none" stroke="black" d="M51657.81,-455.85C51671.87,-442.65 51689.78,-428.95 51709,-422 51850.83,-370.68 62421.41,-417.1 62569,-386 62582.29,-383.2 62595.88,-379.02 62609.07,-374.16"/>
<polygon fill="black" stroke="black" points="62610.51,-377.35 62618.59,-370.51 62608,-370.82 62610.51,-377.35"/>
</g>
<!-- layer0_gpu4_ln2 -->
<g id="node267" class="node">
<title>layer0_gpu4_ln2</title>
<ellipse fill="none" stroke="black" cx="54634" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="54634" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="54634" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="54634" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer0_gpu4_gate -->
<g id="node268" class="node">
<title>layer0_gpu4_gate</title>
<ellipse fill="none" stroke="black" cx="54467" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="54467" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="54467" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="54467" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer0_gpu4_gate&#45;&gt;layer0_expert_all2all -->
<g id="edge50" class="edge">
<title>layer0_gpu4_gate&#45;&gt;layer0_expert_all2all</title>
<path fill="none" stroke="black" d="M54497.63,-455.48C54511.82,-442.38 54529.78,-428.87 54549,-422 54690.42,-371.44 76029.92,-420.88 76176,-386 76190.7,-382.49 76205.65,-376.83 76219.74,-370.37"/>
<polygon fill="black" stroke="black" points="76221.33,-373.48 76228.85,-366.02 76218.32,-367.16 76221.33,-373.48"/>
</g>
<!-- layer0_gpu4_moe_agg -->
<g id="node269" class="node">
<title>layer0_gpu4_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="54371.5,-471.57 54371.5,-508.43 54305.6,-534.5 54212.4,-534.5 54146.5,-508.43 54146.5,-471.57 54212.4,-445.5 54305.6,-445.5 54371.5,-471.57"/>
<polygon fill="none" stroke="black" points="54375.5,-468.85 54375.5,-511.15 54306.36,-538.5 54211.64,-538.5 54142.5,-511.15 54142.5,-468.85 54211.64,-441.5 54306.36,-441.5 54375.5,-468.85"/>
<text text-anchor="middle" x="54259" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="54259" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="54259" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer1_gpu4_ln1 -->
<g id="node270" class="node">
<title>layer1_gpu4_ln1</title>
<ellipse fill="none" stroke="black" cx="50168" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="50168" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="50168" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="50168" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer1_gpu4_qkv -->
<g id="node271" class="node">
<title>layer1_gpu4_qkv</title>
<polygon fill="none" stroke="black" points="53959,-524 53829,-524 53829,-456 53959,-456 53959,-524"/>
<text text-anchor="middle" x="53894" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="53894" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="53894" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="53894" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer1_gpu4_reshape -->
<g id="node272" class="node">
<title>layer1_gpu4_reshape</title>
<ellipse fill="none" stroke="black" cx="53743" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="53743" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="53743" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="53743" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer1_gpu4_attn -->
<g id="node273" class="node">
<title>layer1_gpu4_attn</title>
<polygon fill="none" stroke="black" points="53502,-558 53347,-490 53502,-422 53657,-490 53502,-558"/>
<text text-anchor="middle" x="53502" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="53502" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="53502" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="53502" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer1_gpu4_out_proj -->
<g id="node274" class="node">
<title>layer1_gpu4_out_proj</title>
<polygon fill="none" stroke="black" points="51206,-524 51062,-524 51062,-456 51206,-456 51206,-524"/>
<text text-anchor="middle" x="51134" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="51134" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="51134" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="51134" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer1_concat_group1 -->
<g id="node666" class="node">
<title>layer1_concat_group1</title>
<polygon fill="yellow" stroke="black" points="62286,-302.8 62286,-349.2 62214.53,-382 62113.47,-382 62042,-349.2 62042,-302.8 62113.47,-270 62214.53,-270 62286,-302.8"/>
<polygon fill="none" stroke="black" points="62290,-300.24 62290,-351.76 62215.41,-386 62112.59,-386 62038,-351.76 62038,-300.24 62112.59,-266 62215.41,-266 62290,-300.24"/>
<text text-anchor="middle" x="62164" y="-344.8" font-family="Times,serif" font-size="14.00">Concat Dimensions</text>
<text text-anchor="middle" x="62164" y="-329.8" font-family="Times,serif" font-size="14.00">Head Group 1</text>
<text text-anchor="middle" x="62164" y="-314.8" font-family="Times,serif" font-size="14.00">[B,L,4,512]</text>
<text text-anchor="middle" x="62164" y="-299.8" font-family="Times,serif" font-size="14.00">GPUs 4&#45;7</text>
</g>
<!-- layer1_gpu4_out_proj&#45;&gt;layer1_concat_group1 -->
<g id="edge51" class="edge">
<title>layer1_gpu4_out_proj&#45;&gt;layer1_concat_group1</title>
<path fill="none" stroke="black" d="M51163.81,-455.85C51177.87,-442.65 51195.78,-428.96 51215,-422 51356.3,-370.87 61887.18,-418.01 62034,-386 62046.13,-383.35 62058.5,-379.48 62070.54,-374.97"/>
<polygon fill="black" stroke="black" points="62072.08,-378.13 62080.11,-371.22 62069.52,-371.61 62072.08,-378.13"/>
</g>
<!-- layer1_gpu4_ln2 -->
<g id="node275" class="node">
<title>layer1_gpu4_ln2</title>
<ellipse fill="none" stroke="black" cx="53002" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="53002" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="53002" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="53002" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer1_gpu4_gate -->
<g id="node276" class="node">
<title>layer1_gpu4_gate</title>
<ellipse fill="none" stroke="black" cx="54051" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="54051" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="54051" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="54051" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer1_gpu4_gate&#45;&gt;layer1_expert_all2all -->
<g id="edge52" class="edge">
<title>layer1_gpu4_gate&#45;&gt;layer1_expert_all2all</title>
<path fill="none" stroke="black" d="M54081.68,-455.82C54096.12,-442.61 54114.45,-428.92 54134,-422 54276.75,-371.44 75793.7,-421.17 75941,-386 75955.7,-382.49 75970.65,-376.83 75984.74,-370.37"/>
<polygon fill="black" stroke="black" points="75986.33,-373.48 75993.85,-366.02 75983.32,-367.16 75986.33,-373.48"/>
</g>
<!-- layer1_gpu4_moe_agg -->
<g id="node277" class="node">
<title>layer1_gpu4_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="53324.5,-471.57 53324.5,-508.43 53258.6,-534.5 53165.4,-534.5 53099.5,-508.43 53099.5,-471.57 53165.4,-445.5 53258.6,-445.5 53324.5,-471.57"/>
<polygon fill="none" stroke="black" points="53328.5,-468.85 53328.5,-511.15 53259.36,-538.5 53164.64,-538.5 53095.5,-511.15 53095.5,-468.85 53164.64,-441.5 53259.36,-441.5 53328.5,-468.85"/>
<text text-anchor="middle" x="53212" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="53212" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="53212" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer2_gpu4_ln1 -->
<g id="node278" class="node">
<title>layer2_gpu4_ln1</title>
<ellipse fill="none" stroke="black" cx="49591" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="49591" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="49591" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="49591" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer2_gpu4_qkv -->
<g id="node279" class="node">
<title>layer2_gpu4_qkv</title>
<polygon fill="none" stroke="black" points="52330,-524 52200,-524 52200,-456 52330,-456 52330,-524"/>
<text text-anchor="middle" x="52265" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="52265" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="52265" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="52265" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer2_gpu4_reshape -->
<g id="node280" class="node">
<title>layer2_gpu4_reshape</title>
<ellipse fill="none" stroke="black" cx="52114" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="52114" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="52114" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="52114" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer2_gpu4_attn -->
<g id="node281" class="node">
<title>layer2_gpu4_attn</title>
<polygon fill="none" stroke="black" points="51873,-558 51718,-490 51873,-422 52028,-490 51873,-558"/>
<text text-anchor="middle" x="51873" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="51873" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="51873" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="51873" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer2_gpu4_out_proj -->
<g id="node282" class="node">
<title>layer2_gpu4_out_proj</title>
<polygon fill="none" stroke="black" points="52492,-524 52348,-524 52348,-456 52492,-456 52492,-524"/>
<text text-anchor="middle" x="52420" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="52420" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="52420" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="52420" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer2_concat_group1 -->
<g id="node667" class="node">
<title>layer2_concat_group1</title>
<polygon fill="yellow" stroke="black" points="63172,-302.8 63172,-349.2 63100.53,-382 62999.47,-382 62928,-349.2 62928,-302.8 62999.47,-270 63100.53,-270 63172,-302.8"/>
<polygon fill="none" stroke="black" points="63176,-300.24 63176,-351.76 63101.41,-386 62998.59,-386 62924,-351.76 62924,-300.24 62998.59,-266 63101.41,-266 63176,-300.24"/>
<text text-anchor="middle" x="63050" y="-344.8" font-family="Times,serif" font-size="14.00">Concat Dimensions</text>
<text text-anchor="middle" x="63050" y="-329.8" font-family="Times,serif" font-size="14.00">Head Group 1</text>
<text text-anchor="middle" x="63050" y="-314.8" font-family="Times,serif" font-size="14.00">[B,L,4,512]</text>
<text text-anchor="middle" x="63050" y="-299.8" font-family="Times,serif" font-size="14.00">GPUs 4&#45;7</text>
</g>
<!-- layer2_gpu4_out_proj&#45;&gt;layer2_concat_group1 -->
<g id="edge53" class="edge">
<title>layer2_gpu4_out_proj&#45;&gt;layer2_concat_group1</title>
<path fill="none" stroke="black" d="M52450.25,-455.85C52464.5,-442.64 52482.62,-428.95 52502,-422 52637.15,-373.54 62696.8,-405.76 62839,-386 62871.04,-381.55 62905.08,-373.54 62936.25,-364.84"/>
<polygon fill="black" stroke="black" points="62937.61,-368.09 62946.27,-361.99 62935.69,-361.36 62937.61,-368.09"/>
</g>
<!-- layer2_gpu4_ln2 -->
<g id="node283" class="node">
<title>layer2_gpu4_ln2</title>
<ellipse fill="none" stroke="black" cx="51462" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="51462" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="51462" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="51462" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer2_gpu4_gate -->
<g id="node284" class="node">
<title>layer2_gpu4_gate</title>
<ellipse fill="none" stroke="black" cx="55683" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="55683" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="55683" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="55683" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer2_gpu4_gate&#45;&gt;layer2_expert_all2all -->
<g id="edge54" class="edge">
<title>layer2_gpu4_gate&#45;&gt;layer2_expert_all2all</title>
<path fill="none" stroke="black" d="M55715,-455.81C55729.99,-442.59 55748.96,-428.91 55769,-422 55904.53,-375.31 76271.57,-419.29 76411,-386 76425.7,-382.49 76440.65,-376.83 76454.74,-370.36"/>
<polygon fill="black" stroke="black" points="76456.33,-373.48 76463.85,-366.02 76453.32,-367.16 76456.33,-373.48"/>
</g>
<!-- layer2_gpu4_moe_agg -->
<g id="node285" class="node">
<title>layer2_gpu4_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="54956.5,-471.57 54956.5,-508.43 54890.6,-534.5 54797.4,-534.5 54731.5,-508.43 54731.5,-471.57 54797.4,-445.5 54890.6,-445.5 54956.5,-471.57"/>
<polygon fill="none" stroke="black" points="54960.5,-468.85 54960.5,-511.15 54891.36,-538.5 54796.64,-538.5 54727.5,-511.15 54727.5,-468.85 54796.64,-441.5 54891.36,-441.5 54960.5,-468.85"/>
<text text-anchor="middle" x="54844" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="54844" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="54844" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer3_gpu4_ln1 -->
<g id="node286" class="node">
<title>layer3_gpu4_ln1</title>
<ellipse fill="none" stroke="black" cx="50968" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="50968" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="50968" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="50968" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer3_gpu4_qkv -->
<g id="node287" class="node">
<title>layer3_gpu4_qkv</title>
<polygon fill="none" stroke="black" points="50874,-524 50744,-524 50744,-456 50874,-456 50874,-524"/>
<text text-anchor="middle" x="50809" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="50809" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="50809" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="50809" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer3_gpu4_reshape -->
<g id="node288" class="node">
<title>layer3_gpu4_reshape</title>
<ellipse fill="none" stroke="black" cx="50658" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="50658" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="50658" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="50658" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer3_gpu4_attn -->
<g id="node289" class="node">
<title>layer3_gpu4_attn</title>
<polygon fill="none" stroke="black" points="50417,-558 50262,-490 50417,-422 50572,-490 50417,-558"/>
<text text-anchor="middle" x="50417" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="50417" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="50417" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="50417" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer3_gpu4_out_proj -->
<g id="node290" class="node">
<title>layer3_gpu4_out_proj</title>
<polygon fill="none" stroke="black" points="51368,-524 51224,-524 51224,-456 51368,-456 51368,-524"/>
<text text-anchor="middle" x="51296" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="51296" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="51296" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="51296" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer3_concat_group1 -->
<g id="node668" class="node">
<title>layer3_concat_group1</title>
<polygon fill="yellow" stroke="black" points="62556,-302.8 62556,-349.2 62484.53,-382 62383.47,-382 62312,-349.2 62312,-302.8 62383.47,-270 62484.53,-270 62556,-302.8"/>
<polygon fill="none" stroke="black" points="62560,-300.24 62560,-351.76 62485.41,-386 62382.59,-386 62308,-351.76 62308,-300.24 62382.59,-266 62485.41,-266 62560,-300.24"/>
<text text-anchor="middle" x="62434" y="-344.8" font-family="Times,serif" font-size="14.00">Concat Dimensions</text>
<text text-anchor="middle" x="62434" y="-329.8" font-family="Times,serif" font-size="14.00">Head Group 1</text>
<text text-anchor="middle" x="62434" y="-314.8" font-family="Times,serif" font-size="14.00">[B,L,4,512]</text>
<text text-anchor="middle" x="62434" y="-299.8" font-family="Times,serif" font-size="14.00">GPUs 4&#45;7</text>
</g>
<!-- layer3_gpu4_out_proj&#45;&gt;layer3_concat_group1 -->
<g id="edge55" class="edge">
<title>layer3_gpu4_out_proj&#45;&gt;layer3_concat_group1</title>
<path fill="none" stroke="black" d="M51325.81,-455.85C51339.87,-442.65 51357.78,-428.95 51377,-422 51519.64,-370.38 62150.56,-417.27 62299,-386 62312.29,-383.2 62325.88,-379.02 62339.07,-374.16"/>
<polygon fill="black" stroke="black" points="62340.51,-377.35 62348.59,-370.51 62338,-370.82 62340.51,-377.35"/>
</g>
<!-- layer3_gpu4_ln2 -->
<g id="node291" class="node">
<title>layer3_gpu4_ln2</title>
<ellipse fill="none" stroke="black" cx="49999" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="49999" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="49999" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="49999" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer3_gpu4_gate -->
<g id="node292" class="node">
<title>layer3_gpu4_gate</title>
<ellipse fill="none" stroke="black" cx="52835" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="52835" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="52835" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="52835" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- layer3_gpu4_gate&#45;&gt;layer3_expert_all2all -->
<g id="edge56" class="edge">
<title>layer3_gpu4_gate&#45;&gt;layer3_expert_all2all</title>
<path fill="none" stroke="black" d="M52865.63,-455.48C52879.82,-442.38 52897.78,-428.87 52917,-422 53066.05,-368.72 75556.3,-423.84 75710,-386 75723.79,-382.6 75737.77,-377.2 75750.98,-371.01"/>
<polygon fill="black" stroke="black" points="75752.54,-374.15 75759.99,-366.62 75749.47,-367.86 75752.54,-374.15"/>
</g>
<!-- layer3_gpu4_moe_agg -->
<g id="node293" class="node">
<title>layer3_gpu4_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="52739.5,-471.57 52739.5,-508.43 52673.6,-534.5 52580.4,-534.5 52514.5,-508.43 52514.5,-471.57 52580.4,-445.5 52673.6,-445.5 52739.5,-471.57"/>
<polygon fill="none" stroke="black" points="52743.5,-468.85 52743.5,-511.15 52674.36,-538.5 52579.64,-538.5 52510.5,-511.15 52510.5,-468.85 52579.64,-441.5 52674.36,-441.5 52743.5,-468.85"/>
<text text-anchor="middle" x="52627" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="52627" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="52627" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- embed_5 -->
<g id="node294" class="node">
<title>embed_5</title>
<polygon fill="none" stroke="black" points="56171,-516.5 55951,-516.5 55951,-463.5 56171,-463.5 56171,-516.5"/>
<text text-anchor="middle" x="56061" y="-501.3" font-family="Times,serif" font-size="14.00">Input Embedding</text>
<text text-anchor="middle" x="56061" y="-486.3" font-family="Times,serif" font-size="14.00">[B=1024, L=2048, D=8192]</text>
<text text-anchor="middle" x="56061" y="-471.3" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer0_gpu5_ln1 -->
<g id="node295" class="node">
<title>layer0_gpu5_ln1</title>
<ellipse fill="none" stroke="black" cx="56061" cy="-326" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="56061" y="-337.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="56061" y="-322.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="56061" y="-307.3" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- embed_5&#45;&gt;layer0_gpu5_ln1 -->
<g id="edge6" class="edge">
<title>embed_5&#45;&gt;layer0_gpu5_ln1</title>
<path fill="none" stroke="black" d="M56061,-463.33C56061,-439.41 56061,-403.17 56061,-374.06"/>
<polygon fill="black" stroke="black" points="56064.5,-373.69 56061,-363.69 56057.5,-373.69 56064.5,-373.69"/>
</g>
<!-- layer0_gpu5_qkv -->
<g id="node296" class="node">
<title>layer0_gpu5_qkv</title>
<polygon fill="none" stroke="black" points="61856,-524 61726,-524 61726,-456 61856,-456 61856,-524"/>
<text text-anchor="middle" x="61791" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="61791" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="61791" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="61791" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer0_gpu5_reshape -->
<g id="node297" class="node">
<title>layer0_gpu5_reshape</title>
<ellipse fill="none" stroke="black" cx="61640" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="61640" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="61640" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="61640" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer0_gpu5_attn -->
<g id="node298" class="node">
<title>layer0_gpu5_attn</title>
<polygon fill="none" stroke="black" points="61399,-558 61244,-490 61399,-422 61554,-490 61399,-558"/>
<text text-anchor="middle" x="61399" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="61399" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="61399" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="61399" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer0_gpu5_out_proj -->
<g id="node299" class="node">
<title>layer0_gpu5_out_proj</title>
<polygon fill="none" stroke="black" points="57626,-524 57482,-524 57482,-456 57626,-456 57626,-524"/>
<text text-anchor="middle" x="57554" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="57554" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="57554" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="57554" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer0_gpu5_out_proj&#45;&gt;layer0_concat_group1 -->
<g id="edge57" class="edge">
<title>layer0_gpu5_out_proj&#45;&gt;layer0_concat_group1</title>
<path fill="none" stroke="black" d="M57583.82,-455.89C57597.89,-442.69 57615.79,-428.99 57635,-422 57763.79,-375.11 62434.94,-414.53 62569,-386 62582.29,-383.17 62595.87,-378.98 62609.06,-374.11"/>
<polygon fill="black" stroke="black" points="62610.5,-377.3 62618.58,-370.45 62607.99,-370.77 62610.5,-377.3"/>
</g>
<!-- layer0_gpu5_ln2 -->
<g id="node300" class="node">
<title>layer0_gpu5_ln2</title>
<ellipse fill="none" stroke="black" cx="60899" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="60899" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="60899" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="60899" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer0_gpu5_gate -->
<g id="node301" class="node">
<title>layer0_gpu5_gate</title>
<ellipse fill="none" stroke="black" cx="60732" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="60732" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="60732" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="60732" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer0_gpu5_gate&#45;&gt;layer0_expert_all2all -->
<g id="edge58" class="edge">
<title>layer0_gpu5_gate&#45;&gt;layer0_expert_all2all</title>
<path fill="none" stroke="black" d="M60762.63,-455.48C60776.82,-442.39 60794.79,-428.88 60814,-422 61014.88,-350.1 75968.49,-435.62 76176,-386 76190.7,-382.48 76205.65,-376.82 76219.73,-370.36"/>
<polygon fill="black" stroke="black" points="76221.33,-373.47 76228.85,-366.01 76218.32,-367.16 76221.33,-373.47"/>
</g>
<!-- layer0_gpu5_moe_agg -->
<g id="node302" class="node">
<title>layer0_gpu5_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="60636.5,-471.57 60636.5,-508.43 60570.6,-534.5 60477.4,-534.5 60411.5,-508.43 60411.5,-471.57 60477.4,-445.5 60570.6,-445.5 60636.5,-471.57"/>
<polygon fill="none" stroke="black" points="60640.5,-468.85 60640.5,-511.15 60571.36,-538.5 60476.64,-538.5 60407.5,-511.15 60407.5,-468.85 60476.64,-441.5 60571.36,-441.5 60640.5,-468.85"/>
<text text-anchor="middle" x="60524" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="60524" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="60524" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer1_gpu5_ln1 -->
<g id="node303" class="node">
<title>layer1_gpu5_ln1</title>
<ellipse fill="none" stroke="black" cx="56434" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="56434" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="56434" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="56434" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer1_gpu5_qkv -->
<g id="node304" class="node">
<title>layer1_gpu5_qkv</title>
<polygon fill="none" stroke="black" points="60224,-524 60094,-524 60094,-456 60224,-456 60224,-524"/>
<text text-anchor="middle" x="60159" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="60159" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="60159" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="60159" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer1_gpu5_reshape -->
<g id="node305" class="node">
<title>layer1_gpu5_reshape</title>
<ellipse fill="none" stroke="black" cx="60008" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="60008" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="60008" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="60008" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer1_gpu5_attn -->
<g id="node306" class="node">
<title>layer1_gpu5_attn</title>
<polygon fill="none" stroke="black" points="59767,-558 59612,-490 59767,-422 59922,-490 59767,-558"/>
<text text-anchor="middle" x="59767" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="59767" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="59767" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="59767" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer1_gpu5_out_proj -->
<g id="node307" class="node">
<title>layer1_gpu5_out_proj</title>
<polygon fill="none" stroke="black" points="57302,-524 57158,-524 57158,-456 57302,-456 57302,-524"/>
<text text-anchor="middle" x="57230" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="57230" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="57230" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="57230" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer1_gpu5_out_proj&#45;&gt;layer1_concat_group1 -->
<g id="edge59" class="edge">
<title>layer1_gpu5_out_proj&#45;&gt;layer1_concat_group1</title>
<path fill="none" stroke="black" d="M57259.82,-455.89C57273.89,-442.7 57291.79,-429 57311,-422 57434.27,-377.09 61905.87,-414.23 62034,-386 62046.13,-383.33 62058.49,-379.44 62070.53,-374.92"/>
<polygon fill="black" stroke="black" points="62072.07,-378.07 62080.1,-371.17 62069.51,-371.56 62072.07,-378.07"/>
</g>
<!-- layer1_gpu5_ln2 -->
<g id="node308" class="node">
<title>layer1_gpu5_ln2</title>
<ellipse fill="none" stroke="black" cx="59267" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="59267" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="59267" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="59267" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer1_gpu5_gate -->
<g id="node309" class="node">
<title>layer1_gpu5_gate</title>
<ellipse fill="none" stroke="black" cx="60316" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="60316" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="60316" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="60316" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer1_gpu5_gate&#45;&gt;layer1_expert_all2all -->
<g id="edge60" class="edge">
<title>layer1_gpu5_gate&#45;&gt;layer1_expert_all2all</title>
<path fill="none" stroke="black" d="M60346.68,-455.83C60361.12,-442.62 60379.45,-428.93 60399,-422 60602.45,-349.87 75731.06,-436.2 75941,-386 75955.7,-382.49 75970.65,-376.82 75984.73,-370.36"/>
<polygon fill="black" stroke="black" points="75986.33,-373.47 75993.85,-366.01 75983.32,-367.16 75986.33,-373.47"/>
</g>
<!-- layer1_gpu5_moe_agg -->
<g id="node310" class="node">
<title>layer1_gpu5_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="59589.5,-471.57 59589.5,-508.43 59523.6,-534.5 59430.4,-534.5 59364.5,-508.43 59364.5,-471.57 59430.4,-445.5 59523.6,-445.5 59589.5,-471.57"/>
<polygon fill="none" stroke="black" points="59593.5,-468.85 59593.5,-511.15 59524.36,-538.5 59429.64,-538.5 59360.5,-511.15 59360.5,-468.85 59429.64,-441.5 59524.36,-441.5 59593.5,-468.85"/>
<text text-anchor="middle" x="59477" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="59477" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="59477" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer2_gpu5_ln1 -->
<g id="node311" class="node">
<title>layer2_gpu5_ln1</title>
<ellipse fill="none" stroke="black" cx="55857" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="55857" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="55857" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="55857" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer2_gpu5_qkv -->
<g id="node312" class="node">
<title>layer2_gpu5_qkv</title>
<polygon fill="none" stroke="black" points="58595,-524 58465,-524 58465,-456 58595,-456 58595,-524"/>
<text text-anchor="middle" x="58530" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="58530" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="58530" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="58530" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer2_gpu5_reshape -->
<g id="node313" class="node">
<title>layer2_gpu5_reshape</title>
<ellipse fill="none" stroke="black" cx="58379" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="58379" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="58379" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="58379" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer2_gpu5_attn -->
<g id="node314" class="node">
<title>layer2_gpu5_attn</title>
<polygon fill="none" stroke="black" points="58138,-558 57983,-490 58138,-422 58293,-490 58138,-558"/>
<text text-anchor="middle" x="58138" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="58138" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="58138" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="58138" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer2_gpu5_out_proj -->
<g id="node315" class="node">
<title>layer2_gpu5_out_proj</title>
<polygon fill="none" stroke="black" points="58757,-524 58613,-524 58613,-456 58757,-456 58757,-524"/>
<text text-anchor="middle" x="58685" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="58685" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="58685" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="58685" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer2_gpu5_out_proj&#45;&gt;layer2_concat_group1 -->
<g id="edge61" class="edge">
<title>layer2_gpu5_out_proj&#45;&gt;layer2_concat_group1</title>
<path fill="none" stroke="black" d="M58715.27,-455.9C58729.52,-442.7 58747.64,-429 58767,-422 58983.47,-343.75 62684.59,-432.58 62910,-386 62924.27,-383.05 62938.9,-378.63 62953.08,-373.5"/>
<polygon fill="black" stroke="black" points="62954.67,-376.64 62962.8,-369.85 62952.21,-370.09 62954.67,-376.64"/>
</g>
<!-- layer2_gpu5_ln2 -->
<g id="node316" class="node">
<title>layer2_gpu5_ln2</title>
<ellipse fill="none" stroke="black" cx="57720" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="57720" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="57720" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="57720" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer2_gpu5_gate -->
<g id="node317" class="node">
<title>layer2_gpu5_gate</title>
<ellipse fill="none" stroke="black" cx="61948" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="61948" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="61948" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="61948" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer2_gpu5_gate&#45;&gt;layer2_expert_all2all -->
<g id="edge62" class="edge">
<title>layer2_gpu5_gate&#45;&gt;layer2_expert_all2all</title>
<path fill="none" stroke="black" d="M62020.5,-483.75C62210.6,-470.26 62739.18,-434.58 63180,-422 63363.69,-416.76 76232.28,-428.77 76411,-386 76425.7,-382.48 76440.65,-376.82 76454.73,-370.35"/>
<polygon fill="black" stroke="black" points="76456.33,-373.47 76463.85,-366.01 76453.32,-367.15 76456.33,-373.47"/>
</g>
<!-- layer2_gpu5_moe_agg -->
<g id="node318" class="node">
<title>layer2_gpu5_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="61221.5,-471.57 61221.5,-508.43 61155.6,-534.5 61062.4,-534.5 60996.5,-508.43 60996.5,-471.57 61062.4,-445.5 61155.6,-445.5 61221.5,-471.57"/>
<polygon fill="none" stroke="black" points="61225.5,-468.85 61225.5,-511.15 61156.36,-538.5 61061.64,-538.5 60992.5,-511.15 60992.5,-468.85 61061.64,-441.5 61156.36,-441.5 61225.5,-468.85"/>
<text text-anchor="middle" x="61109" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="61109" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="61109" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer3_gpu5_ln1 -->
<g id="node319" class="node">
<title>layer3_gpu5_ln1</title>
<ellipse fill="none" stroke="black" cx="57889" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="57889" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="57889" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="57889" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer3_gpu5_qkv -->
<g id="node320" class="node">
<title>layer3_gpu5_qkv</title>
<polygon fill="none" stroke="black" points="57140,-524 57010,-524 57010,-456 57140,-456 57140,-524"/>
<text text-anchor="middle" x="57075" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="57075" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="57075" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="57075" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer3_gpu5_reshape -->
<g id="node321" class="node">
<title>layer3_gpu5_reshape</title>
<ellipse fill="none" stroke="black" cx="56924" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="56924" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="56924" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="56924" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer3_gpu5_attn -->
<g id="node322" class="node">
<title>layer3_gpu5_attn</title>
<polygon fill="none" stroke="black" points="56683,-558 56528,-490 56683,-422 56838,-490 56683,-558"/>
<text text-anchor="middle" x="56683" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="56683" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="56683" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="56683" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer3_gpu5_out_proj -->
<g id="node323" class="node">
<title>layer3_gpu5_out_proj</title>
<polygon fill="none" stroke="black" points="57464,-524 57320,-524 57320,-456 57464,-456 57464,-524"/>
<text text-anchor="middle" x="57392" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="57392" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="57392" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="57392" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer3_gpu5_out_proj&#45;&gt;layer3_concat_group1 -->
<g id="edge63" class="edge">
<title>layer3_gpu5_out_proj&#45;&gt;layer3_concat_group1</title>
<path fill="none" stroke="black" d="M57421.82,-455.89C57435.89,-442.69 57453.79,-428.99 57473,-422 57598.97,-376.12 62167.88,-413.91 62299,-386 62312.29,-383.17 62325.87,-378.98 62339.06,-374.11"/>
<polygon fill="black" stroke="black" points="62340.5,-377.3 62348.58,-370.45 62337.99,-370.77 62340.5,-377.3"/>
</g>
<!-- layer3_gpu5_ln2 -->
<g id="node324" class="node">
<title>layer3_gpu5_ln2</title>
<ellipse fill="none" stroke="black" cx="56265" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="56265" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="56265" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="56265" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer3_gpu5_gate -->
<g id="node325" class="node">
<title>layer3_gpu5_gate</title>
<ellipse fill="none" stroke="black" cx="59100" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="59100" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="59100" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="59100" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- layer3_gpu5_gate&#45;&gt;layer3_expert_all2all -->
<g id="edge64" class="edge">
<title>layer3_gpu5_gate&#45;&gt;layer3_expert_all2all</title>
<path fill="none" stroke="black" d="M59130.63,-455.48C59144.82,-442.38 59162.79,-428.87 59182,-422 59398.14,-344.66 75487.12,-440.94 75710,-386 75723.79,-382.6 75737.77,-377.2 75750.98,-371.01"/>
<polygon fill="black" stroke="black" points="75752.53,-374.14 75759.99,-366.61 75749.46,-367.85 75752.53,-374.14"/>
</g>
<!-- layer3_gpu5_moe_agg -->
<g id="node326" class="node">
<title>layer3_gpu5_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="59004.5,-471.57 59004.5,-508.43 58938.6,-534.5 58845.4,-534.5 58779.5,-508.43 58779.5,-471.57 58845.4,-445.5 58938.6,-445.5 59004.5,-471.57"/>
<polygon fill="none" stroke="black" points="59008.5,-468.85 59008.5,-511.15 58939.36,-538.5 58844.64,-538.5 58775.5,-511.15 58775.5,-468.85 58844.64,-441.5 58939.36,-441.5 59008.5,-468.85"/>
<text text-anchor="middle" x="58892" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="58892" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="58892" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- embed_6 -->
<g id="node327" class="node">
<title>embed_6</title>
<polygon fill="none" stroke="black" points="65030,-516.5 64810,-516.5 64810,-463.5 65030,-463.5 65030,-516.5"/>
<text text-anchor="middle" x="64920" y="-501.3" font-family="Times,serif" font-size="14.00">Input Embedding</text>
<text text-anchor="middle" x="64920" y="-486.3" font-family="Times,serif" font-size="14.00">[B=1024, L=2048, D=8192]</text>
<text text-anchor="middle" x="64920" y="-471.3" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer0_gpu6_ln1 -->
<g id="node328" class="node">
<title>layer0_gpu6_ln1</title>
<ellipse fill="none" stroke="black" cx="64920" cy="-326" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="64920" y="-337.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="64920" y="-322.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="64920" y="-307.3" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- embed_6&#45;&gt;layer0_gpu6_ln1 -->
<g id="edge7" class="edge">
<title>embed_6&#45;&gt;layer0_gpu6_ln1</title>
<path fill="none" stroke="black" d="M64920,-463.33C64920,-439.41 64920,-403.17 64920,-374.06"/>
<polygon fill="black" stroke="black" points="64923.5,-373.69 64920,-363.69 64916.5,-373.69 64923.5,-373.69"/>
</g>
<!-- layer0_gpu6_qkv -->
<g id="node329" class="node">
<title>layer0_gpu6_qkv</title>
<polygon fill="none" stroke="black" points="69267,-524 69137,-524 69137,-456 69267,-456 69267,-524"/>
<text text-anchor="middle" x="69202" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="69202" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="69202" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="69202" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer0_gpu6_reshape -->
<g id="node330" class="node">
<title>layer0_gpu6_reshape</title>
<ellipse fill="none" stroke="black" cx="69051" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="69051" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="69051" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="69051" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer0_gpu6_attn -->
<g id="node331" class="node">
<title>layer0_gpu6_attn</title>
<polygon fill="none" stroke="black" points="68810,-558 68655,-490 68810,-422 68965,-490 68810,-558"/>
<text text-anchor="middle" x="68810" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="68810" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="68810" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="68810" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer0_gpu6_out_proj -->
<g id="node332" class="node">
<title>layer0_gpu6_out_proj</title>
<polygon fill="none" stroke="black" points="63830,-524 63686,-524 63686,-456 63830,-456 63830,-524"/>
<text text-anchor="middle" x="63758" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="63758" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="63758" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="63758" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer0_gpu6_out_proj&#45;&gt;layer0_concat_group1 -->
<g id="edge65" class="edge">
<title>layer0_gpu6_out_proj&#45;&gt;layer0_concat_group1</title>
<path fill="none" stroke="black" d="M63727.68,-455.86C63713.65,-442.83 63695.91,-429.27 63677,-422 63504.06,-355.49 63024.78,-426.62 62844,-386 62829.89,-382.83 62815.39,-378.31 62801.33,-373.16"/>
<polygon fill="black" stroke="black" points="62802.27,-369.77 62791.68,-369.51 62799.79,-376.32 62802.27,-369.77"/>
</g>
<!-- layer0_gpu6_ln2 -->
<g id="node333" class="node">
<title>layer0_gpu6_ln2</title>
<ellipse fill="none" stroke="black" cx="68310" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="68310" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="68310" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="68310" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer0_gpu6_gate -->
<g id="node334" class="node">
<title>layer0_gpu6_gate</title>
<ellipse fill="none" stroke="black" cx="68143" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="68143" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="68143" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="68143" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer0_gpu6_gate&#45;&gt;layer0_expert_all2all -->
<g id="edge66" class="edge">
<title>layer0_gpu6_gate&#45;&gt;layer0_expert_all2all</title>
<path fill="none" stroke="black" d="M68173.64,-455.5C68187.83,-442.41 68205.79,-428.9 68225,-422 68432.86,-347.35 75961.25,-437.6 76176,-386 76190.7,-382.47 76205.65,-376.8 76219.73,-370.33"/>
<polygon fill="black" stroke="black" points="76221.33,-373.45 76228.84,-365.98 76218.31,-367.13 76221.33,-373.45"/>
</g>
<!-- layer0_gpu6_moe_agg -->
<g id="node335" class="node">
<title>layer0_gpu6_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="68047.5,-471.57 68047.5,-508.43 67981.6,-534.5 67888.4,-534.5 67822.5,-508.43 67822.5,-471.57 67888.4,-445.5 67981.6,-445.5 68047.5,-471.57"/>
<polygon fill="none" stroke="black" points="68051.5,-468.85 68051.5,-511.15 67982.36,-538.5 67887.64,-538.5 67818.5,-511.15 67818.5,-468.85 67887.64,-441.5 67982.36,-441.5 68051.5,-468.85"/>
<text text-anchor="middle" x="67935" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="67935" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="67935" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer1_gpu6_ln1 -->
<g id="node336" class="node">
<title>layer1_gpu6_ln1</title>
<ellipse fill="none" stroke="black" cx="65293" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="65293" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="65293" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="65293" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer1_gpu6_qkv -->
<g id="node337" class="node">
<title>layer1_gpu6_qkv</title>
<polygon fill="none" stroke="black" points="67635,-524 67505,-524 67505,-456 67635,-456 67635,-524"/>
<text text-anchor="middle" x="67570" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="67570" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="67570" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="67570" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer1_gpu6_reshape -->
<g id="node338" class="node">
<title>layer1_gpu6_reshape</title>
<ellipse fill="none" stroke="black" cx="67419" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="67419" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="67419" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="67419" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer1_gpu6_attn -->
<g id="node339" class="node">
<title>layer1_gpu6_attn</title>
<polygon fill="none" stroke="black" points="67178,-558 67023,-490 67178,-422 67333,-490 67178,-558"/>
<text text-anchor="middle" x="67178" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="67178" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="67178" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="67178" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer1_gpu6_out_proj -->
<g id="node340" class="node">
<title>layer1_gpu6_out_proj</title>
<polygon fill="none" stroke="black" points="63336,-524 63192,-524 63192,-456 63336,-456 63336,-524"/>
<text text-anchor="middle" x="63264" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="63264" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="63264" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="63264" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer1_gpu6_out_proj&#45;&gt;layer1_concat_group1 -->
<g id="edge67" class="edge">
<title>layer1_gpu6_out_proj&#45;&gt;layer1_concat_group1</title>
<path fill="none" stroke="black" d="M63191.82,-488.76C63029.48,-486.61 62624.31,-472.25 62299,-386 62286.39,-382.66 62273.45,-378.3 62260.8,-373.48"/>
<polygon fill="black" stroke="black" points="62261.79,-370.1 62251.2,-369.7 62259.23,-376.62 62261.79,-370.1"/>
</g>
<!-- layer1_gpu6_ln2 -->
<g id="node341" class="node">
<title>layer1_gpu6_ln2</title>
<ellipse fill="none" stroke="black" cx="66678" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="66678" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="66678" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="66678" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer1_gpu6_gate -->
<g id="node342" class="node">
<title>layer1_gpu6_gate</title>
<ellipse fill="none" stroke="black" cx="67727" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="67727" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="67727" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="67727" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer1_gpu6_gate&#45;&gt;layer1_expert_all2all -->
<g id="edge68" class="edge">
<title>layer1_gpu6_gate&#45;&gt;layer1_expert_all2all</title>
<path fill="none" stroke="black" d="M67757.69,-455.85C67772.13,-442.64 67790.46,-428.95 67810,-422 68022.8,-346.3 75721.38,-438.75 75941,-386 75955.7,-382.47 75970.65,-376.8 75984.73,-370.33"/>
<polygon fill="black" stroke="black" points="75986.33,-373.45 75993.85,-365.98 75983.31,-367.13 75986.33,-373.45"/>
</g>
<!-- layer1_gpu6_moe_agg -->
<g id="node343" class="node">
<title>layer1_gpu6_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="67000.5,-471.57 67000.5,-508.43 66934.6,-534.5 66841.4,-534.5 66775.5,-508.43 66775.5,-471.57 66841.4,-445.5 66934.6,-445.5 67000.5,-471.57"/>
<polygon fill="none" stroke="black" points="67004.5,-468.85 67004.5,-511.15 66935.36,-538.5 66840.64,-538.5 66771.5,-511.15 66771.5,-468.85 66840.64,-441.5 66935.36,-441.5 67004.5,-468.85"/>
<text text-anchor="middle" x="66888" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="66888" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="66888" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer2_gpu6_ln1 -->
<g id="node344" class="node">
<title>layer2_gpu6_ln1</title>
<ellipse fill="none" stroke="black" cx="64554" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="64554" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="64554" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="64554" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer2_gpu6_qkv -->
<g id="node345" class="node">
<title>layer2_gpu6_qkv</title>
<polygon fill="none" stroke="black" points="65999,-524 65869,-524 65869,-456 65999,-456 65999,-524"/>
<text text-anchor="middle" x="65934" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="65934" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="65934" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="65934" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer2_gpu6_reshape -->
<g id="node346" class="node">
<title>layer2_gpu6_reshape</title>
<ellipse fill="none" stroke="black" cx="65783" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="65783" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="65783" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="65783" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer2_gpu6_attn -->
<g id="node347" class="node">
<title>layer2_gpu6_attn</title>
<polygon fill="none" stroke="black" points="65542,-558 65387,-490 65542,-422 65697,-490 65542,-558"/>
<text text-anchor="middle" x="65542" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="65542" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="65542" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="65542" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer2_gpu6_out_proj -->
<g id="node348" class="node">
<title>layer2_gpu6_out_proj</title>
<polygon fill="none" stroke="black" points="64792,-524 64648,-524 64648,-456 64792,-456 64792,-524"/>
<text text-anchor="middle" x="64720" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="64720" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="64720" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="64720" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer2_gpu6_out_proj&#45;&gt;layer2_concat_group1 -->
<g id="edge69" class="edge">
<title>layer2_gpu6_out_proj&#45;&gt;layer2_concat_group1</title>
<path fill="none" stroke="black" d="M64689.74,-455.69C64675.72,-442.63 64657.97,-429.1 64639,-422 64487.11,-365.2 63338.06,-422.24 63180,-386 63167.99,-383.25 63155.74,-379.34 63143.8,-374.83"/>
<polygon fill="black" stroke="black" points="63144.89,-371.49 63134.3,-371.09 63142.33,-378.01 63144.89,-371.49"/>
</g>
<!-- layer2_gpu6_ln2 -->
<g id="node349" class="node">
<title>layer2_gpu6_ln2</title>
<ellipse fill="none" stroke="black" cx="65124" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="65124" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="65124" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="65124" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer2_gpu6_gate -->
<g id="node350" class="node">
<title>layer2_gpu6_gate</title>
<ellipse fill="none" stroke="black" cx="69359" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="69359" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="69359" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="69359" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer2_gpu6_gate&#45;&gt;layer2_expert_all2all -->
<g id="edge70" class="edge">
<title>layer2_gpu6_gate&#45;&gt;layer2_expert_all2all</title>
<path fill="none" stroke="black" d="M69391.01,-455.84C69406.01,-442.63 69424.97,-428.94 69445,-422 69627.84,-358.66 76222.87,-431.27 76411,-386 76425.7,-382.46 76440.65,-376.79 76454.73,-370.32"/>
<polygon fill="black" stroke="black" points="76456.32,-373.44 76463.84,-365.97 76453.31,-367.12 76456.32,-373.44"/>
</g>
<!-- layer2_gpu6_moe_agg -->
<g id="node351" class="node">
<title>layer2_gpu6_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="68632.5,-471.57 68632.5,-508.43 68566.6,-534.5 68473.4,-534.5 68407.5,-508.43 68407.5,-471.57 68473.4,-445.5 68566.6,-445.5 68632.5,-471.57"/>
<polygon fill="none" stroke="black" points="68636.5,-468.85 68636.5,-511.15 68567.36,-538.5 68472.64,-538.5 68403.5,-511.15 68403.5,-468.85 68472.64,-441.5 68567.36,-441.5 68636.5,-468.85"/>
<text text-anchor="middle" x="68520" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="68520" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="68520" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer3_gpu6_ln1 -->
<g id="node352" class="node">
<title>layer3_gpu6_ln1</title>
<ellipse fill="none" stroke="black" cx="66093" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="66093" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="66093" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="66093" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer3_gpu6_qkv -->
<g id="node353" class="node">
<title>layer3_gpu6_qkv</title>
<polygon fill="none" stroke="black" points="64460,-524 64330,-524 64330,-456 64460,-456 64460,-524"/>
<text text-anchor="middle" x="64395" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="64395" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="64395" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="64395" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer3_gpu6_reshape -->
<g id="node354" class="node">
<title>layer3_gpu6_reshape</title>
<ellipse fill="none" stroke="black" cx="64244" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="64244" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="64244" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="64244" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer3_gpu6_attn -->
<g id="node355" class="node">
<title>layer3_gpu6_attn</title>
<polygon fill="none" stroke="black" points="64003,-558 63848,-490 64003,-422 64158,-490 64003,-558"/>
<text text-anchor="middle" x="64003" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="64003" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="64003" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="64003" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer3_gpu6_out_proj -->
<g id="node356" class="node">
<title>layer3_gpu6_out_proj</title>
<polygon fill="none" stroke="black" points="63498,-524 63354,-524 63354,-456 63498,-456 63498,-524"/>
<text text-anchor="middle" x="63426" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="63426" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="63426" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="63426" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer3_gpu6_out_proj&#45;&gt;layer3_concat_group1 -->
<g id="edge71" class="edge">
<title>layer3_gpu6_out_proj&#45;&gt;layer3_concat_group1</title>
<path fill="none" stroke="black" d="M63395.67,-455.89C63381.63,-442.87 63363.9,-429.3 63345,-422 63183.97,-359.78 62737.12,-425.22 62569,-386 62555.97,-382.96 62542.63,-378.7 62529.65,-373.84"/>
<polygon fill="black" stroke="black" points="62530.86,-370.56 62520.27,-370.21 62528.33,-377.09 62530.86,-370.56"/>
</g>
<!-- layer3_gpu6_ln2 -->
<g id="node357" class="node">
<title>layer3_gpu6_ln2</title>
<ellipse fill="none" stroke="black" cx="63592" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="63592" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="63592" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="63592" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer3_gpu6_gate -->
<g id="node358" class="node">
<title>layer3_gpu6_gate</title>
<ellipse fill="none" stroke="black" cx="66511" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="66511" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="66511" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="66511" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- layer3_gpu6_gate&#45;&gt;layer3_expert_all2all -->
<g id="edge72" class="edge">
<title>layer3_gpu6_gate&#45;&gt;layer3_expert_all2all</title>
<path fill="none" stroke="black" d="M66541.63,-455.5C66555.83,-442.4 66573.79,-428.89 66593,-422 66831.37,-336.47 75464.16,-446.83 75710,-386 75723.79,-382.59 75737.77,-377.18 75750.97,-370.99"/>
<polygon fill="black" stroke="black" points="75752.53,-374.12 75759.98,-366.59 75749.46,-367.83 75752.53,-374.12"/>
</g>
<!-- layer3_gpu6_moe_agg -->
<g id="node359" class="node">
<title>layer3_gpu6_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="66415.5,-471.57 66415.5,-508.43 66349.6,-534.5 66256.4,-534.5 66190.5,-508.43 66190.5,-471.57 66256.4,-445.5 66349.6,-445.5 66415.5,-471.57"/>
<polygon fill="none" stroke="black" points="66419.5,-468.85 66419.5,-511.15 66350.36,-538.5 66255.64,-538.5 66186.5,-511.15 66186.5,-468.85 66255.64,-441.5 66350.36,-441.5 66419.5,-468.85"/>
<text text-anchor="middle" x="66303" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="66303" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="66303" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- embed_7 -->
<g id="node360" class="node">
<title>embed_7</title>
<polygon fill="none" stroke="black" points="71295,-516.5 71075,-516.5 71075,-463.5 71295,-463.5 71295,-516.5"/>
<text text-anchor="middle" x="71185" y="-501.3" font-family="Times,serif" font-size="14.00">Input Embedding</text>
<text text-anchor="middle" x="71185" y="-486.3" font-family="Times,serif" font-size="14.00">[B=1024, L=2048, D=8192]</text>
<text text-anchor="middle" x="71185" y="-471.3" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer0_gpu7_ln1 -->
<g id="node361" class="node">
<title>layer0_gpu7_ln1</title>
<ellipse fill="none" stroke="black" cx="71185" cy="-326" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="71185" y="-337.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="71185" y="-322.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="71185" y="-307.3" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- embed_7&#45;&gt;layer0_gpu7_ln1 -->
<g id="edge8" class="edge">
<title>embed_7&#45;&gt;layer0_gpu7_ln1</title>
<path fill="none" stroke="black" d="M71185,-463.33C71185,-439.41 71185,-403.17 71185,-374.06"/>
<polygon fill="black" stroke="black" points="71188.5,-373.69 71185,-363.69 71181.5,-373.69 71188.5,-373.69"/>
</g>
<!-- layer0_gpu7_qkv -->
<g id="node362" class="node">
<title>layer0_gpu7_qkv</title>
<polygon fill="none" stroke="black" points="75532,-524 75402,-524 75402,-456 75532,-456 75532,-524"/>
<text text-anchor="middle" x="75467" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="75467" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="75467" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="75467" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer0_gpu7_reshape -->
<g id="node363" class="node">
<title>layer0_gpu7_reshape</title>
<ellipse fill="none" stroke="black" cx="75316" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="75316" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="75316" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="75316" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer0_gpu7_attn -->
<g id="node364" class="node">
<title>layer0_gpu7_attn</title>
<polygon fill="none" stroke="black" points="75075,-558 74920,-490 75075,-422 75230,-490 75075,-558"/>
<text text-anchor="middle" x="75075" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="75075" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="75075" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="75075" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer0_gpu7_out_proj -->
<g id="node365" class="node">
<title>layer0_gpu7_out_proj</title>
<polygon fill="none" stroke="black" points="70095,-524 69951,-524 69951,-456 70095,-456 70095,-524"/>
<text text-anchor="middle" x="70023" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="70023" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="70023" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="70023" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer0_gpu7_out_proj&#45;&gt;layer0_concat_group1 -->
<g id="edge73" class="edge">
<title>layer0_gpu7_out_proj&#45;&gt;layer0_concat_group1</title>
<path fill="none" stroke="black" d="M69993.18,-455.87C69979.12,-442.67 69961.21,-428.97 69942,-422 69758.51,-355.42 63108.32,-413.02 62915,-386 62883.05,-381.53 62849.11,-373.55 62818,-364.87"/>
<polygon fill="black" stroke="black" points="62818.58,-361.4 62808.01,-362.03 62816.67,-368.13 62818.58,-361.4"/>
</g>
<!-- layer0_gpu7_ln2 -->
<g id="node366" class="node">
<title>layer0_gpu7_ln2</title>
<ellipse fill="none" stroke="black" cx="74575" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="74575" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="74575" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="74575" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer0_gpu7_gate -->
<g id="node367" class="node">
<title>layer0_gpu7_gate</title>
<ellipse fill="none" stroke="black" cx="74408" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="74408" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="74408" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="74408" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer0_gpu7_gate&#45;&gt;layer0_expert_all2all -->
<g id="edge74" class="edge">
<title>layer0_gpu7_gate&#45;&gt;layer0_expert_all2all</title>
<path fill="none" stroke="black" d="M74438.69,-455.66C74452.89,-442.59 74470.85,-429.06 74490,-422 74665.81,-357.19 75994.18,-431.3 76176,-386 76190.58,-382.37 76205.42,-376.68 76219.42,-370.25"/>
<polygon fill="black" stroke="black" points="76220.97,-373.39 76228.49,-365.92 76217.95,-367.07 76220.97,-373.39"/>
</g>
<!-- layer0_gpu7_moe_agg -->
<g id="node368" class="node">
<title>layer0_gpu7_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="74312.5,-471.57 74312.5,-508.43 74246.6,-534.5 74153.4,-534.5 74087.5,-508.43 74087.5,-471.57 74153.4,-445.5 74246.6,-445.5 74312.5,-471.57"/>
<polygon fill="none" stroke="black" points="74316.5,-468.85 74316.5,-511.15 74247.36,-538.5 74152.64,-538.5 74083.5,-511.15 74083.5,-468.85 74152.64,-441.5 74247.36,-441.5 74316.5,-468.85"/>
<text text-anchor="middle" x="74200" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="74200" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="74200" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer1_gpu7_ln1 -->
<g id="node369" class="node">
<title>layer1_gpu7_ln1</title>
<ellipse fill="none" stroke="black" cx="71558" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="71558" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="71558" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="71558" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer1_gpu7_qkv -->
<g id="node370" class="node">
<title>layer1_gpu7_qkv</title>
<polygon fill="none" stroke="black" points="73900,-524 73770,-524 73770,-456 73900,-456 73900,-524"/>
<text text-anchor="middle" x="73835" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="73835" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="73835" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="73835" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer1_gpu7_reshape -->
<g id="node371" class="node">
<title>layer1_gpu7_reshape</title>
<ellipse fill="none" stroke="black" cx="73684" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="73684" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="73684" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="73684" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer1_gpu7_attn -->
<g id="node372" class="node">
<title>layer1_gpu7_attn</title>
<polygon fill="none" stroke="black" points="73443,-558 73288,-490 73443,-422 73598,-490 73443,-558"/>
<text text-anchor="middle" x="73443" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="73443" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="73443" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="73443" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer1_gpu7_out_proj -->
<g id="node373" class="node">
<title>layer1_gpu7_out_proj</title>
<polygon fill="none" stroke="black" points="69601,-524 69457,-524 69457,-456 69601,-456 69601,-524"/>
<text text-anchor="middle" x="69529" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="69529" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="69529" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="69529" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer1_gpu7_out_proj&#45;&gt;layer1_concat_group1 -->
<g id="edge75" class="edge">
<title>layer1_gpu7_out_proj&#45;&gt;layer1_concat_group1</title>
<path fill="none" stroke="black" d="M69497.87,-455.85C69483.24,-442.64 69464.7,-428.95 69445,-422 69257.81,-355.96 62493.2,-427.09 62299,-386 62285.71,-383.19 62272.12,-379 62258.94,-374.14"/>
<polygon fill="black" stroke="black" points="62260,-370.8 62249.41,-370.48 62257.5,-377.33 62260,-370.8"/>
</g>
<!-- layer1_gpu7_ln2 -->
<g id="node374" class="node">
<title>layer1_gpu7_ln2</title>
<ellipse fill="none" stroke="black" cx="72943" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="72943" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="72943" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="72943" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer1_gpu7_gate -->
<g id="node375" class="node">
<title>layer1_gpu7_gate</title>
<ellipse fill="none" stroke="black" cx="73992" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="73992" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="73992" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="73992" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer1_gpu7_gate&#45;&gt;layer1_expert_all2all -->
<g id="edge76" class="edge">
<title>layer1_gpu7_gate&#45;&gt;layer1_expert_all2all</title>
<path fill="none" stroke="black" d="M74023.13,-455.63C74037.52,-442.56 74055.68,-429.03 74075,-422 74269.86,-351.05 75739.73,-435.93 75941,-386 75955.58,-382.38 75970.42,-376.71 75984.42,-370.27"/>
<polygon fill="black" stroke="black" points="75985.97,-373.41 75993.49,-365.95 75982.96,-367.09 75985.97,-373.41"/>
</g>
<!-- layer1_gpu7_moe_agg -->
<g id="node376" class="node">
<title>layer1_gpu7_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="73265.5,-471.57 73265.5,-508.43 73199.6,-534.5 73106.4,-534.5 73040.5,-508.43 73040.5,-471.57 73106.4,-445.5 73199.6,-445.5 73265.5,-471.57"/>
<polygon fill="none" stroke="black" points="73269.5,-468.85 73269.5,-511.15 73200.36,-538.5 73105.64,-538.5 73036.5,-511.15 73036.5,-468.85 73105.64,-441.5 73200.36,-441.5 73269.5,-468.85"/>
<text text-anchor="middle" x="73153" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="73153" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="73153" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer2_gpu7_ln1 -->
<g id="node377" class="node">
<title>layer2_gpu7_ln1</title>
<ellipse fill="none" stroke="black" cx="70981" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="70981" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="70981" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="70981" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer2_gpu7_qkv -->
<g id="node378" class="node">
<title>layer2_gpu7_qkv</title>
<polygon fill="none" stroke="black" points="72264,-524 72134,-524 72134,-456 72264,-456 72264,-524"/>
<text text-anchor="middle" x="72199" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="72199" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="72199" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="72199" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer2_gpu7_reshape -->
<g id="node379" class="node">
<title>layer2_gpu7_reshape</title>
<ellipse fill="none" stroke="black" cx="72048" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="72048" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="72048" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="72048" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer2_gpu7_attn -->
<g id="node380" class="node">
<title>layer2_gpu7_attn</title>
<polygon fill="none" stroke="black" points="71807,-558 71652,-490 71807,-422 71962,-490 71807,-558"/>
<text text-anchor="middle" x="71807" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="71807" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="71807" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="71807" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer2_gpu7_out_proj -->
<g id="node381" class="node">
<title>layer2_gpu7_out_proj</title>
<polygon fill="none" stroke="black" points="70887,-524 70743,-524 70743,-456 70887,-456 70887,-524"/>
<text text-anchor="middle" x="70815" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="70815" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="70815" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="70815" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer2_gpu7_out_proj&#45;&gt;layer2_concat_group1 -->
<g id="edge77" class="edge">
<title>layer2_gpu7_out_proj&#45;&gt;layer2_concat_group1</title>
<path fill="none" stroke="black" d="M70785.19,-455.87C70771.12,-442.66 70753.22,-428.97 70734,-422 70536.74,-350.46 63384.99,-430.85 63180,-386 63167.87,-383.35 63155.51,-379.47 63143.47,-374.95"/>
<polygon fill="black" stroke="black" points="63144.48,-371.59 63133.89,-371.2 63141.93,-378.11 63144.48,-371.59"/>
</g>
<!-- layer2_gpu7_ln2 -->
<g id="node382" class="node">
<title>layer2_gpu7_ln2</title>
<ellipse fill="none" stroke="black" cx="71389" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="71389" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="71389" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="71389" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer2_gpu7_gate -->
<g id="node383" class="node">
<title>layer2_gpu7_gate</title>
<ellipse fill="none" stroke="black" cx="75624" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="75624" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="75624" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="75624" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer2_gpu7_gate&#45;&gt;layer2_expert_all2all -->
<g id="edge78" class="edge">
<title>layer2_gpu7_gate&#45;&gt;layer2_expert_all2all</title>
<path fill="none" stroke="black" d="M75697.35,-487.57C75838.58,-483.05 76156.82,-464.24 76411,-386 76424.87,-381.73 76439.09,-375.93 76452.62,-369.62"/>
<polygon fill="black" stroke="black" points="76454.37,-372.66 76461.87,-365.18 76451.34,-366.35 76454.37,-372.66"/>
</g>
<!-- layer2_gpu7_moe_agg -->
<g id="node384" class="node">
<title>layer2_gpu7_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="74897.5,-471.57 74897.5,-508.43 74831.6,-534.5 74738.4,-534.5 74672.5,-508.43 74672.5,-471.57 74738.4,-445.5 74831.6,-445.5 74897.5,-471.57"/>
<polygon fill="none" stroke="black" points="74901.5,-468.85 74901.5,-511.15 74832.36,-538.5 74737.64,-538.5 74668.5,-511.15 74668.5,-468.85 74737.64,-441.5 74832.36,-441.5 74901.5,-468.85"/>
<text text-anchor="middle" x="74785" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="74785" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="74785" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer3_gpu7_ln1 -->
<g id="node385" class="node">
<title>layer3_gpu7_ln1</title>
<ellipse fill="none" stroke="black" cx="72358" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="72358" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="72358" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="72358" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer3_gpu7_qkv -->
<g id="node386" class="node">
<title>layer3_gpu7_qkv</title>
<polygon fill="none" stroke="black" points="70725,-524 70595,-524 70595,-456 70725,-456 70725,-524"/>
<text text-anchor="middle" x="70660" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="70660" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="70660" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="70660" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer3_gpu7_reshape -->
<g id="node387" class="node">
<title>layer3_gpu7_reshape</title>
<ellipse fill="none" stroke="black" cx="70509" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="70509" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="70509" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="70509" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer3_gpu7_attn -->
<g id="node388" class="node">
<title>layer3_gpu7_attn</title>
<polygon fill="none" stroke="black" points="70268,-558 70113,-490 70268,-422 70423,-490 70268,-558"/>
<text text-anchor="middle" x="70268" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="70268" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="70268" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="70268" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer3_gpu7_out_proj -->
<g id="node389" class="node">
<title>layer3_gpu7_out_proj</title>
<polygon fill="none" stroke="black" points="69763,-524 69619,-524 69619,-456 69763,-456 69763,-524"/>
<text text-anchor="middle" x="69691" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="69691" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="69691" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="69691" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer3_gpu7_out_proj&#45;&gt;layer3_concat_group1 -->
<g id="edge79" class="edge">
<title>layer3_gpu7_out_proj&#45;&gt;layer3_concat_group1</title>
<path fill="none" stroke="black" d="M69661.18,-455.87C69647.12,-442.67 69629.21,-428.97 69610,-422 69426.14,-355.28 62760.35,-426.5 62569,-386 62555.71,-383.19 62542.12,-379 62528.94,-374.14"/>
<polygon fill="black" stroke="black" points="62530.01,-370.8 62519.41,-370.48 62527.5,-377.33 62530.01,-370.8"/>
</g>
<!-- layer3_gpu7_ln2 -->
<g id="node390" class="node">
<title>layer3_gpu7_ln2</title>
<ellipse fill="none" stroke="black" cx="69857" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="69857" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="69857" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="69857" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer3_gpu7_gate -->
<g id="node391" class="node">
<title>layer3_gpu7_gate</title>
<ellipse fill="none" stroke="black" cx="72776" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="72776" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="72776" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="72776" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- layer3_gpu7_gate&#45;&gt;layer3_expert_all2all -->
<g id="edge80" class="edge">
<title>layer3_gpu7_gate&#45;&gt;layer3_expert_all2all</title>
<path fill="none" stroke="black" d="M72806.66,-455.58C72820.86,-442.5 72838.82,-428.98 72858,-422 73006.91,-367.84 75556.35,-424.73 75710,-386 75723.77,-382.53 75737.75,-377.09 75750.95,-370.89"/>
<polygon fill="black" stroke="black" points="75752.51,-374.02 75759.95,-366.48 75749.43,-367.73 75752.51,-374.02"/>
</g>
<!-- layer3_gpu7_moe_agg -->
<g id="node392" class="node">
<title>layer3_gpu7_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="72680.5,-471.57 72680.5,-508.43 72614.6,-534.5 72521.4,-534.5 72455.5,-508.43 72455.5,-471.57 72521.4,-445.5 72614.6,-445.5 72680.5,-471.57"/>
<polygon fill="none" stroke="black" points="72684.5,-468.85 72684.5,-511.15 72615.36,-538.5 72520.64,-538.5 72451.5,-511.15 72451.5,-468.85 72520.64,-441.5 72615.36,-441.5 72684.5,-468.85"/>
<text text-anchor="middle" x="72568" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="72568" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="72568" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- embed_8 -->
<g id="node393" class="node">
<title>embed_8</title>
<polygon fill="none" stroke="black" points="80307,-516.5 80087,-516.5 80087,-463.5 80307,-463.5 80307,-516.5"/>
<text text-anchor="middle" x="80197" y="-501.3" font-family="Times,serif" font-size="14.00">Input Embedding</text>
<text text-anchor="middle" x="80197" y="-486.3" font-family="Times,serif" font-size="14.00">[B=1024, L=2048, D=8192]</text>
<text text-anchor="middle" x="80197" y="-471.3" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer0_gpu8_ln1 -->
<g id="node394" class="node">
<title>layer0_gpu8_ln1</title>
<ellipse fill="none" stroke="black" cx="80197" cy="-326" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="80197" y="-337.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="80197" y="-322.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="80197" y="-307.3" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- embed_8&#45;&gt;layer0_gpu8_ln1 -->
<g id="edge9" class="edge">
<title>embed_8&#45;&gt;layer0_gpu8_ln1</title>
<path fill="none" stroke="black" d="M80197,-463.33C80197,-439.41 80197,-403.17 80197,-374.06"/>
<polygon fill="black" stroke="black" points="80200.5,-373.69 80197,-363.69 80193.5,-373.69 80200.5,-373.69"/>
</g>
<!-- layer0_gpu8_qkv -->
<g id="node395" class="node">
<title>layer0_gpu8_qkv</title>
<polygon fill="none" stroke="black" points="82732,-524 82602,-524 82602,-456 82732,-456 82732,-524"/>
<text text-anchor="middle" x="82667" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="82667" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="82667" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="82667" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer0_gpu8_reshape -->
<g id="node396" class="node">
<title>layer0_gpu8_reshape</title>
<ellipse fill="none" stroke="black" cx="82516" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="82516" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="82516" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="82516" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer0_gpu8_attn -->
<g id="node397" class="node">
<title>layer0_gpu8_attn</title>
<polygon fill="none" stroke="black" points="82275,-558 82120,-490 82275,-422 82430,-490 82275,-558"/>
<text text-anchor="middle" x="82275" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="82275" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="82275" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="82275" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer0_gpu8_out_proj -->
<g id="node398" class="node">
<title>layer0_gpu8_out_proj</title>
<polygon fill="none" stroke="black" points="82102,-524 81958,-524 81958,-456 82102,-456 82102,-524"/>
<text text-anchor="middle" x="82030" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="82030" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="82030" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="82030" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer0_concat_group2 -->
<g id="node669" class="node">
<title>layer0_concat_group2</title>
<polygon fill="yellow" stroke="black" points="89962,-302.8 89962,-349.2 89890.53,-382 89789.47,-382 89718,-349.2 89718,-302.8 89789.47,-270 89890.53,-270 89962,-302.8"/>
<polygon fill="none" stroke="black" points="89966,-300.24 89966,-351.76 89891.41,-386 89788.59,-386 89714,-351.76 89714,-300.24 89788.59,-266 89891.41,-266 89966,-300.24"/>
<text text-anchor="middle" x="89840" y="-344.8" font-family="Times,serif" font-size="14.00">Concat Dimensions</text>
<text text-anchor="middle" x="89840" y="-329.8" font-family="Times,serif" font-size="14.00">Head Group 2</text>
<text text-anchor="middle" x="89840" y="-314.8" font-family="Times,serif" font-size="14.00">[B,L,4,512]</text>
<text text-anchor="middle" x="89840" y="-299.8" font-family="Times,serif" font-size="14.00">GPUs 8&#45;11</text>
</g>
<!-- layer0_gpu8_out_proj&#45;&gt;layer0_concat_group2 -->
<g id="edge81" class="edge">
<title>layer0_gpu8_out_proj&#45;&gt;layer0_concat_group2</title>
<path fill="none" stroke="black" d="M82059.81,-455.87C82073.88,-442.66 82091.78,-428.97 82111,-422 82309.31,-350.08 89498.62,-429.64 89705,-386 89718.29,-383.19 89731.88,-379.01 89745.06,-374.14"/>
<polygon fill="black" stroke="black" points="89746.5,-377.34 89754.59,-370.49 89744,-370.8 89746.5,-377.34"/>
</g>
<!-- layer0_gpu8_ln2 -->
<g id="node399" class="node">
<title>layer0_gpu8_ln2</title>
<ellipse fill="none" stroke="black" cx="81864" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="81864" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="81864" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="81864" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer0_gpu8_gate -->
<g id="node400" class="node">
<title>layer0_gpu8_gate</title>
<ellipse fill="none" stroke="black" cx="78359" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="78359" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="78359" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="78359" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer0_gpu8_gate&#45;&gt;layer0_expert_all2all -->
<g id="edge82" class="edge">
<title>layer0_gpu8_gate&#45;&gt;layer0_expert_all2all</title>
<path fill="none" stroke="black" d="M78328.31,-455.64C78314.11,-442.57 78296.15,-429.04 78277,-422 78082.36,-350.47 76612.36,-435.59 76411,-386 76396.22,-382.36 76381.17,-376.64 76366.97,-370.15"/>
<polygon fill="black" stroke="black" points="76368.32,-366.92 76357.78,-365.8 76365.32,-373.24 76368.32,-366.92"/>
</g>
<!-- layer0_gpu8_moe_agg -->
<g id="node401" class="node">
<title>layer0_gpu8_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="78679.5,-471.57 78679.5,-508.43 78613.6,-534.5 78520.4,-534.5 78454.5,-508.43 78454.5,-471.57 78520.4,-445.5 78613.6,-445.5 78679.5,-471.57"/>
<polygon fill="none" stroke="black" points="78683.5,-468.85 78683.5,-511.15 78614.36,-538.5 78519.64,-538.5 78450.5,-511.15 78450.5,-468.85 78519.64,-441.5 78614.36,-441.5 78683.5,-468.85"/>
<text text-anchor="middle" x="78567" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="78567" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="78567" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer1_gpu8_ln1 -->
<g id="node402" class="node">
<title>layer1_gpu8_ln1</title>
<ellipse fill="none" stroke="black" cx="80570" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="80570" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="80570" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="80570" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer1_gpu8_qkv -->
<g id="node403" class="node">
<title>layer1_gpu8_qkv</title>
<polygon fill="none" stroke="black" points="81276,-524 81146,-524 81146,-456 81276,-456 81276,-524"/>
<text text-anchor="middle" x="81211" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="81211" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="81211" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="81211" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer1_gpu8_reshape -->
<g id="node404" class="node">
<title>layer1_gpu8_reshape</title>
<ellipse fill="none" stroke="black" cx="81060" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="81060" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="81060" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="81060" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer1_gpu8_attn -->
<g id="node405" class="node">
<title>layer1_gpu8_attn</title>
<polygon fill="none" stroke="black" points="80819,-558 80664,-490 80819,-422 80974,-490 80819,-558"/>
<text text-anchor="middle" x="80819" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="80819" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="80819" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="80819" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer1_gpu8_out_proj -->
<g id="node406" class="node">
<title>layer1_gpu8_out_proj</title>
<polygon fill="none" stroke="black" points="81608,-524 81464,-524 81464,-456 81608,-456 81608,-524"/>
<text text-anchor="middle" x="81536" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="81536" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="81536" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="81536" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer1_concat_group2 -->
<g id="node670" class="node">
<title>layer1_concat_group2</title>
<polygon fill="yellow" stroke="black" points="89422,-302.8 89422,-349.2 89350.53,-382 89249.47,-382 89178,-349.2 89178,-302.8 89249.47,-270 89350.53,-270 89422,-302.8"/>
<polygon fill="none" stroke="black" points="89426,-300.24 89426,-351.76 89351.41,-386 89248.59,-386 89174,-351.76 89174,-300.24 89248.59,-266 89351.41,-266 89426,-300.24"/>
<text text-anchor="middle" x="89300" y="-344.8" font-family="Times,serif" font-size="14.00">Concat Dimensions</text>
<text text-anchor="middle" x="89300" y="-329.8" font-family="Times,serif" font-size="14.00">Head Group 2</text>
<text text-anchor="middle" x="89300" y="-314.8" font-family="Times,serif" font-size="14.00">[B,L,4,512]</text>
<text text-anchor="middle" x="89300" y="-299.8" font-family="Times,serif" font-size="14.00">GPUs 8&#45;11</text>
</g>
<!-- layer1_gpu8_out_proj&#45;&gt;layer1_concat_group2 -->
<g id="edge83" class="edge">
<title>layer1_gpu8_out_proj&#45;&gt;layer1_concat_group2</title>
<path fill="none" stroke="black" d="M81565.81,-455.87C81579.88,-442.66 81597.78,-428.97 81617,-422 81814.24,-350.47 88965.04,-430.85 89170,-386 89182.13,-383.35 89194.49,-379.47 89206.53,-374.95"/>
<polygon fill="black" stroke="black" points="89208.07,-378.11 89216.11,-371.2 89205.52,-371.59 89208.07,-378.11"/>
</g>
<!-- layer1_gpu8_ln2 -->
<g id="node407" class="node">
<title>layer1_gpu8_ln2</title>
<ellipse fill="none" stroke="black" cx="80401" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="80401" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="80401" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="80401" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer1_gpu8_gate -->
<g id="node408" class="node">
<title>layer1_gpu8_gate</title>
<ellipse fill="none" stroke="black" cx="77312" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="77312" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="77312" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="77312" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer1_gpu8_gate&#45;&gt;layer1_expert_all2all -->
<g id="edge84" class="edge">
<title>layer1_gpu8_gate&#45;&gt;layer1_expert_all2all</title>
<path fill="none" stroke="black" d="M77281.26,-455.78C77267.05,-442.73 77249.1,-429.18 77230,-422 77010.63,-339.53 76403.14,-443.73 76176,-386 76161.34,-382.27 76146.39,-376.54 76132.28,-370.09"/>
<polygon fill="black" stroke="black" points="76133.68,-366.88 76123.14,-365.76 76130.68,-373.21 76133.68,-366.88"/>
</g>
<!-- layer1_gpu8_moe_agg -->
<g id="node409" class="node">
<title>layer1_gpu8_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="78263.5,-471.57 78263.5,-508.43 78197.6,-534.5 78104.4,-534.5 78038.5,-508.43 78038.5,-471.57 78104.4,-445.5 78197.6,-445.5 78263.5,-471.57"/>
<polygon fill="none" stroke="black" points="78267.5,-468.85 78267.5,-511.15 78198.36,-538.5 78103.64,-538.5 78034.5,-511.15 78034.5,-468.85 78103.64,-441.5 78198.36,-441.5 78267.5,-468.85"/>
<text text-anchor="middle" x="78151" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="78151" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="78151" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer2_gpu8_ln1 -->
<g id="node410" class="node">
<title>layer2_gpu8_ln1</title>
<ellipse fill="none" stroke="black" cx="79993" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="79993" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="79993" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="79993" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer2_gpu8_qkv -->
<g id="node411" class="node">
<title>layer2_gpu8_qkv</title>
<polygon fill="none" stroke="black" points="79648,-524 79518,-524 79518,-456 79648,-456 79648,-524"/>
<text text-anchor="middle" x="79583" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="79583" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="79583" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="79583" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer2_gpu8_reshape -->
<g id="node412" class="node">
<title>layer2_gpu8_reshape</title>
<ellipse fill="none" stroke="black" cx="79432" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="79432" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="79432" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="79432" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer2_gpu8_attn -->
<g id="node413" class="node">
<title>layer2_gpu8_attn</title>
<polygon fill="none" stroke="black" points="79191,-558 79036,-490 79191,-422 79346,-490 79191,-558"/>
<text text-anchor="middle" x="79191" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="79191" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="79191" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="79191" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer2_gpu8_out_proj -->
<g id="node414" class="node">
<title>layer2_gpu8_out_proj</title>
<polygon fill="none" stroke="black" points="82894,-524 82750,-524 82750,-456 82894,-456 82894,-524"/>
<text text-anchor="middle" x="82822" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="82822" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="82822" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="82822" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer2_concat_group2 -->
<g id="node671" class="node">
<title>layer2_concat_group2</title>
<polygon fill="yellow" stroke="black" points="90270,-302.8 90270,-349.2 90198.53,-382 90097.47,-382 90026,-349.2 90026,-302.8 90097.47,-270 90198.53,-270 90270,-302.8"/>
<polygon fill="none" stroke="black" points="90274,-300.24 90274,-351.76 90199.41,-386 90096.59,-386 90022,-351.76 90022,-300.24 90096.59,-266 90199.41,-266 90274,-300.24"/>
<text text-anchor="middle" x="90148" y="-344.8" font-family="Times,serif" font-size="14.00">Concat Dimensions</text>
<text text-anchor="middle" x="90148" y="-329.8" font-family="Times,serif" font-size="14.00">Head Group 2</text>
<text text-anchor="middle" x="90148" y="-314.8" font-family="Times,serif" font-size="14.00">[B,L,4,512]</text>
<text text-anchor="middle" x="90148" y="-299.8" font-family="Times,serif" font-size="14.00">GPUs 8&#45;11</text>
</g>
<!-- layer2_gpu8_out_proj&#45;&gt;layer2_concat_group2 -->
<g id="edge85" class="edge">
<title>layer2_gpu8_out_proj&#45;&gt;layer2_concat_group2</title>
<path fill="none" stroke="black" d="M82853.13,-455.85C82867.76,-442.64 82886.3,-428.95 82906,-422 83091.18,-356.67 89781.36,-418.62 89975,-386 89997.22,-382.26 90020.41,-376.05 90042.34,-369.04"/>
<polygon fill="black" stroke="black" points="90043.57,-372.32 90051.99,-365.88 90041.39,-365.67 90043.57,-372.32"/>
</g>
<!-- layer2_gpu8_ln2 -->
<g id="node415" class="node">
<title>layer2_gpu8_ln2</title>
<ellipse fill="none" stroke="black" cx="78777" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="78777" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="78777" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="78777" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer2_gpu8_gate -->
<g id="node416" class="node">
<title>layer2_gpu8_gate</title>
<ellipse fill="none" stroke="black" cx="78944" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="78944" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="78944" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="78944" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer2_gpu8_gate&#45;&gt;layer2_expert_all2all -->
<g id="edge86" class="edge">
<title>layer2_gpu8_gate&#45;&gt;layer2_expert_all2all</title>
<path fill="none" stroke="black" d="M78913.32,-455.61C78899.13,-442.54 78881.16,-429.01 78862,-422 78630.21,-337.22 76880.22,-446.75 76641,-386 76627.23,-382.5 76613.26,-377.05 76600.06,-370.84"/>
<polygon fill="black" stroke="black" points="76601.58,-367.69 76591.06,-366.44 76598.5,-373.98 76601.58,-367.69"/>
</g>
<!-- layer2_gpu8_moe_agg -->
<g id="node417" class="node">
<title>layer2_gpu8_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="79895.5,-471.57 79895.5,-508.43 79829.6,-534.5 79736.4,-534.5 79670.5,-508.43 79670.5,-471.57 79736.4,-445.5 79829.6,-445.5 79895.5,-471.57"/>
<polygon fill="none" stroke="black" points="79899.5,-468.85 79899.5,-511.15 79830.36,-538.5 79735.64,-538.5 79666.5,-511.15 79666.5,-468.85 79735.64,-441.5 79830.36,-441.5 79899.5,-468.85"/>
<text text-anchor="middle" x="79783" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="79783" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="79783" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer3_gpu8_ln1 -->
<g id="node418" class="node">
<title>layer3_gpu8_ln1</title>
<ellipse fill="none" stroke="black" cx="81370" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="81370" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="81370" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="81370" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer3_gpu8_qkv -->
<g id="node419" class="node">
<title>layer3_gpu8_qkv</title>
<polygon fill="none" stroke="black" points="78016,-524 77886,-524 77886,-456 78016,-456 78016,-524"/>
<text text-anchor="middle" x="77951" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="77951" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="77951" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="77951" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer3_gpu8_reshape -->
<g id="node420" class="node">
<title>layer3_gpu8_reshape</title>
<ellipse fill="none" stroke="black" cx="77800" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="77800" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="77800" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="77800" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer3_gpu8_attn -->
<g id="node421" class="node">
<title>layer3_gpu8_attn</title>
<polygon fill="none" stroke="black" points="77559,-558 77404,-490 77559,-422 77714,-490 77559,-558"/>
<text text-anchor="middle" x="77559" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="77559" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="77559" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="77559" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer3_gpu8_out_proj -->
<g id="node422" class="node">
<title>layer3_gpu8_out_proj</title>
<polygon fill="none" stroke="black" points="81770,-524 81626,-524 81626,-456 81770,-456 81770,-524"/>
<text text-anchor="middle" x="81698" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="81698" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="81698" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="81698" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer3_concat_group2 -->
<g id="node672" class="node">
<title>layer3_concat_group2</title>
<polygon fill="yellow" stroke="black" points="89692,-302.8 89692,-349.2 89620.53,-382 89519.47,-382 89448,-349.2 89448,-302.8 89519.47,-270 89620.53,-270 89692,-302.8"/>
<polygon fill="none" stroke="black" points="89696,-300.24 89696,-351.76 89621.41,-386 89518.59,-386 89444,-351.76 89444,-300.24 89518.59,-266 89621.41,-266 89696,-300.24"/>
<text text-anchor="middle" x="89570" y="-344.8" font-family="Times,serif" font-size="14.00">Concat Dimensions</text>
<text text-anchor="middle" x="89570" y="-329.8" font-family="Times,serif" font-size="14.00">Head Group 2</text>
<text text-anchor="middle" x="89570" y="-314.8" font-family="Times,serif" font-size="14.00">[B,L,4,512]</text>
<text text-anchor="middle" x="89570" y="-299.8" font-family="Times,serif" font-size="14.00">GPUs 8&#45;11</text>
</g>
<!-- layer3_gpu8_out_proj&#45;&gt;layer3_concat_group2 -->
<g id="edge87" class="edge">
<title>layer3_gpu8_out_proj&#45;&gt;layer3_concat_group2</title>
<path fill="none" stroke="black" d="M81727.81,-455.87C81741.88,-442.66 81759.78,-428.97 81779,-422 81978.93,-349.5 89226.93,-429.99 89435,-386 89448.29,-383.19 89461.88,-379.01 89475.06,-374.14"/>
<polygon fill="black" stroke="black" points="89476.5,-377.34 89484.59,-370.49 89474,-370.8 89476.5,-377.34"/>
</g>
<!-- layer3_gpu8_ln2 -->
<g id="node423" class="node">
<title>layer3_gpu8_ln2</title>
<ellipse fill="none" stroke="black" cx="77145" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="77145" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="77145" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="77145" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer3_gpu8_gate -->
<g id="node424" class="node">
<title>layer3_gpu8_gate</title>
<ellipse fill="none" stroke="black" cx="76978" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="76978" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="76978" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="76978" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- layer3_gpu8_gate&#45;&gt;layer3_expert_all2all -->
<g id="edge88" class="edge">
<title>layer3_gpu8_gate&#45;&gt;layer3_expert_all2all</title>
<path fill="none" stroke="black" d="M76947.25,-455.81C76933.04,-442.77 76915.09,-429.21 76896,-422 76697.34,-346.91 76146.74,-438.68 75941,-386 75926.35,-382.25 75911.4,-376.51 75897.29,-370.05"/>
<polygon fill="black" stroke="black" points="75898.69,-366.84 75888.15,-365.72 75895.69,-373.16 75898.69,-366.84"/>
</g>
<!-- layer3_gpu8_moe_agg -->
<g id="node425" class="node">
<title>layer3_gpu8_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="76882.5,-471.57 76882.5,-508.43 76816.6,-534.5 76723.4,-534.5 76657.5,-508.43 76657.5,-471.57 76723.4,-445.5 76816.6,-445.5 76882.5,-471.57"/>
<polygon fill="none" stroke="black" points="76886.5,-468.85 76886.5,-511.15 76817.36,-538.5 76722.64,-538.5 76653.5,-511.15 76653.5,-468.85 76722.64,-441.5 76817.36,-441.5 76886.5,-468.85"/>
<text text-anchor="middle" x="76770" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="76770" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="76770" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- embed_9 -->
<g id="node426" class="node">
<title>embed_9</title>
<polygon fill="none" stroke="black" points="86572,-516.5 86352,-516.5 86352,-463.5 86572,-463.5 86572,-516.5"/>
<text text-anchor="middle" x="86462" y="-501.3" font-family="Times,serif" font-size="14.00">Input Embedding</text>
<text text-anchor="middle" x="86462" y="-486.3" font-family="Times,serif" font-size="14.00">[B=1024, L=2048, D=8192]</text>
<text text-anchor="middle" x="86462" y="-471.3" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer0_gpu9_ln1 -->
<g id="node427" class="node">
<title>layer0_gpu9_ln1</title>
<ellipse fill="none" stroke="black" cx="86462" cy="-326" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="86462" y="-337.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="86462" y="-322.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="86462" y="-307.3" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- embed_9&#45;&gt;layer0_gpu9_ln1 -->
<g id="edge10" class="edge">
<title>embed_9&#45;&gt;layer0_gpu9_ln1</title>
<path fill="none" stroke="black" d="M86462,-463.33C86462,-439.41 86462,-403.17 86462,-374.06"/>
<polygon fill="black" stroke="black" points="86465.5,-373.69 86462,-363.69 86458.5,-373.69 86465.5,-373.69"/>
</g>
<!-- layer0_gpu9_qkv -->
<g id="node428" class="node">
<title>layer0_gpu9_qkv</title>
<polygon fill="none" stroke="black" points="88996,-524 88866,-524 88866,-456 88996,-456 88996,-524"/>
<text text-anchor="middle" x="88931" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="88931" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="88931" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="88931" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer0_gpu9_reshape -->
<g id="node429" class="node">
<title>layer0_gpu9_reshape</title>
<ellipse fill="none" stroke="black" cx="88780" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="88780" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="88780" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="88780" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer0_gpu9_attn -->
<g id="node430" class="node">
<title>layer0_gpu9_attn</title>
<polygon fill="none" stroke="black" points="88539,-558 88384,-490 88539,-422 88694,-490 88539,-558"/>
<text text-anchor="middle" x="88539" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="88539" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="88539" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="88539" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer0_gpu9_out_proj -->
<g id="node431" class="node">
<title>layer0_gpu9_out_proj</title>
<polygon fill="none" stroke="black" points="88027,-524 87883,-524 87883,-456 88027,-456 88027,-524"/>
<text text-anchor="middle" x="87955" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="87955" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="87955" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="87955" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer0_gpu9_out_proj&#45;&gt;layer0_concat_group2 -->
<g id="edge89" class="edge">
<title>layer0_gpu9_out_proj&#45;&gt;layer0_concat_group2</title>
<path fill="none" stroke="black" d="M87985.25,-455.67C87999.27,-442.6 88017.02,-429.07 88036,-422 88209.84,-357.3 89523.85,-425.9 89705,-386 89718.17,-383.1 89731.63,-378.89 89744.72,-374.04"/>
<polygon fill="black" stroke="black" points="89746.1,-377.26 89754.17,-370.4 89743.58,-370.73 89746.1,-377.26"/>
</g>
<!-- layer0_gpu9_ln2 -->
<g id="node432" class="node">
<title>layer0_gpu9_ln2</title>
<ellipse fill="none" stroke="black" cx="88121" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="88121" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="88121" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="88121" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer0_gpu9_gate -->
<g id="node433" class="node">
<title>layer0_gpu9_gate</title>
<ellipse fill="none" stroke="black" cx="84624" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="84624" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="84624" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="84624" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer0_gpu9_gate&#45;&gt;layer0_expert_all2all -->
<g id="edge90" class="edge">
<title>layer0_gpu9_gate&#45;&gt;layer0_expert_all2all</title>
<path fill="none" stroke="black" d="M84593.36,-455.5C84579.17,-442.41 84561.21,-428.9 84542,-422 84329.43,-345.67 76630.71,-438.38 76411,-386 76396.2,-382.47 76381.13,-376.8 76366.93,-370.33"/>
<polygon fill="black" stroke="black" points="76368.27,-367.1 76357.74,-365.99 76365.28,-373.43 76368.27,-367.1"/>
</g>
<!-- layer0_gpu9_moe_agg -->
<g id="node434" class="node">
<title>layer0_gpu9_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="84944.5,-471.57 84944.5,-508.43 84878.6,-534.5 84785.4,-534.5 84719.5,-508.43 84719.5,-471.57 84785.4,-445.5 84878.6,-445.5 84944.5,-471.57"/>
<polygon fill="none" stroke="black" points="84948.5,-468.85 84948.5,-511.15 84879.36,-538.5 84784.64,-538.5 84715.5,-511.15 84715.5,-468.85 84784.64,-441.5 84879.36,-441.5 84948.5,-468.85"/>
<text text-anchor="middle" x="84832" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="84832" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="84832" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer1_gpu9_ln1 -->
<g id="node435" class="node">
<title>layer1_gpu9_ln1</title>
<ellipse fill="none" stroke="black" cx="86835" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="86835" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="86835" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="86835" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer1_gpu9_qkv -->
<g id="node436" class="node">
<title>layer1_gpu9_qkv</title>
<polygon fill="none" stroke="black" points="87541,-524 87411,-524 87411,-456 87541,-456 87541,-524"/>
<text text-anchor="middle" x="87476" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="87476" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="87476" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="87476" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer1_gpu9_reshape -->
<g id="node437" class="node">
<title>layer1_gpu9_reshape</title>
<ellipse fill="none" stroke="black" cx="87325" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="87325" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="87325" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="87325" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer1_gpu9_attn -->
<g id="node438" class="node">
<title>layer1_gpu9_attn</title>
<polygon fill="none" stroke="black" points="87084,-558 86929,-490 87084,-422 87239,-490 87084,-558"/>
<text text-anchor="middle" x="87084" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="87084" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="87084" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="87084" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer1_gpu9_out_proj -->
<g id="node439" class="node">
<title>layer1_gpu9_out_proj</title>
<polygon fill="none" stroke="black" points="87703,-524 87559,-524 87559,-456 87703,-456 87703,-524"/>
<text text-anchor="middle" x="87631" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="87631" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="87631" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="87631" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer1_gpu9_out_proj&#45;&gt;layer1_concat_group2 -->
<g id="edge91" class="edge">
<title>layer1_gpu9_out_proj&#45;&gt;layer1_concat_group2</title>
<path fill="none" stroke="black" d="M87661.26,-455.69C87675.28,-442.63 87693.03,-429.1 87712,-422 87863.78,-365.24 89012.05,-422.21 89170,-386 89182.01,-383.25 89194.26,-379.34 89206.2,-374.83"/>
<polygon fill="black" stroke="black" points="89207.67,-378.01 89215.7,-371.09 89205.11,-371.49 89207.67,-378.01"/>
</g>
<!-- layer1_gpu9_ln2 -->
<g id="node440" class="node">
<title>layer1_gpu9_ln2</title>
<ellipse fill="none" stroke="black" cx="86666" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="86666" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="86666" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="86666" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer1_gpu9_gate -->
<g id="node441" class="node">
<title>layer1_gpu9_gate</title>
<ellipse fill="none" stroke="black" cx="83577" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="83577" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="83577" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="83577" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer1_gpu9_gate&#45;&gt;layer1_expert_all2all -->
<g id="edge92" class="edge">
<title>layer1_gpu9_gate&#45;&gt;layer1_expert_all2all</title>
<path fill="none" stroke="black" d="M83546.36,-455.51C83532.17,-442.41 83514.2,-428.9 83495,-422 83303.67,-353.24 76373.75,-433.2 76176,-386 76161.2,-382.47 76146.13,-376.79 76131.93,-370.33"/>
<polygon fill="black" stroke="black" points="76133.27,-367.09 76122.74,-365.98 76130.28,-373.42 76133.27,-367.09"/>
</g>
<!-- layer1_gpu9_moe_agg -->
<g id="node442" class="node">
<title>layer1_gpu9_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="84528.5,-471.57 84528.5,-508.43 84462.6,-534.5 84369.4,-534.5 84303.5,-508.43 84303.5,-471.57 84369.4,-445.5 84462.6,-445.5 84528.5,-471.57"/>
<polygon fill="none" stroke="black" points="84532.5,-468.85 84532.5,-511.15 84463.36,-538.5 84368.64,-538.5 84299.5,-511.15 84299.5,-468.85 84368.64,-441.5 84463.36,-441.5 84532.5,-468.85"/>
<text text-anchor="middle" x="84416" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="84416" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="84416" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer2_gpu9_ln1 -->
<g id="node443" class="node">
<title>layer2_gpu9_ln1</title>
<ellipse fill="none" stroke="black" cx="86258" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="86258" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="86258" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="86258" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer2_gpu9_qkv -->
<g id="node444" class="node">
<title>layer2_gpu9_qkv</title>
<polygon fill="none" stroke="black" points="85913,-524 85783,-524 85783,-456 85913,-456 85913,-524"/>
<text text-anchor="middle" x="85848" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="85848" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="85848" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="85848" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer2_gpu9_reshape -->
<g id="node445" class="node">
<title>layer2_gpu9_reshape</title>
<ellipse fill="none" stroke="black" cx="85697" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="85697" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="85697" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="85697" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer2_gpu9_attn -->
<g id="node446" class="node">
<title>layer2_gpu9_attn</title>
<polygon fill="none" stroke="black" points="85456,-558 85301,-490 85456,-422 85611,-490 85456,-558"/>
<text text-anchor="middle" x="85456" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="85456" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="85456" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="85456" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer2_gpu9_out_proj -->
<g id="node447" class="node">
<title>layer2_gpu9_out_proj</title>
<polygon fill="none" stroke="black" points="89158,-524 89014,-524 89014,-456 89158,-456 89158,-524"/>
<text text-anchor="middle" x="89086" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="89086" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="89086" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="89086" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer2_gpu9_out_proj&#45;&gt;layer2_concat_group2 -->
<g id="edge93" class="edge">
<title>layer2_gpu9_out_proj&#45;&gt;layer2_concat_group2</title>
<path fill="none" stroke="black" d="M89158.12,-487.95C89315.17,-484.14 89698.82,-466.61 90008,-386 90021.69,-382.43 90035.78,-377.77 90049.51,-372.63"/>
<polygon fill="black" stroke="black" points="90050.88,-375.85 90058.95,-369 90048.36,-369.32 90050.88,-375.85"/>
</g>
<!-- layer2_gpu9_ln2 -->
<g id="node448" class="node">
<title>layer2_gpu9_ln2</title>
<ellipse fill="none" stroke="black" cx="85042" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="85042" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="85042" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="85042" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer2_gpu9_gate -->
<g id="node449" class="node">
<title>layer2_gpu9_gate</title>
<ellipse fill="none" stroke="black" cx="85209" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="85209" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="85209" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="85209" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer2_gpu9_gate&#45;&gt;layer2_expert_all2all -->
<g id="edge94" class="edge">
<title>layer2_gpu9_gate&#45;&gt;layer2_expert_all2all</title>
<path fill="none" stroke="black" d="M85178.36,-455.5C85164.17,-442.41 85146.21,-428.89 85127,-422 84905.14,-342.36 76869.81,-442.65 76641,-386 76627.21,-382.59 76613.23,-377.17 76600.03,-370.98"/>
<polygon fill="black" stroke="black" points="76601.54,-367.83 76591.02,-366.59 76598.47,-374.12 76601.54,-367.83"/>
</g>
<!-- layer2_gpu9_moe_agg -->
<g id="node450" class="node">
<title>layer2_gpu9_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="86160.5,-471.57 86160.5,-508.43 86094.6,-534.5 86001.4,-534.5 85935.5,-508.43 85935.5,-471.57 86001.4,-445.5 86094.6,-445.5 86160.5,-471.57"/>
<polygon fill="none" stroke="black" points="86164.5,-468.85 86164.5,-511.15 86095.36,-538.5 86000.64,-538.5 85931.5,-511.15 85931.5,-468.85 86000.64,-441.5 86095.36,-441.5 86164.5,-468.85"/>
<text text-anchor="middle" x="86048" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="86048" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="86048" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer3_gpu9_ln1 -->
<g id="node451" class="node">
<title>layer3_gpu9_ln1</title>
<ellipse fill="none" stroke="black" cx="88290" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="88290" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="88290" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="88290" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer3_gpu9_qkv -->
<g id="node452" class="node">
<title>layer3_gpu9_qkv</title>
<polygon fill="none" stroke="black" points="84281,-524 84151,-524 84151,-456 84281,-456 84281,-524"/>
<text text-anchor="middle" x="84216" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="84216" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="84216" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="84216" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer3_gpu9_reshape -->
<g id="node453" class="node">
<title>layer3_gpu9_reshape</title>
<ellipse fill="none" stroke="black" cx="84065" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="84065" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="84065" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="84065" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer3_gpu9_attn -->
<g id="node454" class="node">
<title>layer3_gpu9_attn</title>
<polygon fill="none" stroke="black" points="83824,-558 83669,-490 83824,-422 83979,-490 83824,-558"/>
<text text-anchor="middle" x="83824" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="83824" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="83824" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="83824" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer3_gpu9_out_proj -->
<g id="node455" class="node">
<title>layer3_gpu9_out_proj</title>
<polygon fill="none" stroke="black" points="87865,-524 87721,-524 87721,-456 87865,-456 87865,-524"/>
<text text-anchor="middle" x="87793" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="87793" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="87793" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="87793" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer3_gpu9_out_proj&#45;&gt;layer3_concat_group2 -->
<g id="edge95" class="edge">
<title>layer3_gpu9_out_proj&#45;&gt;layer3_concat_group2</title>
<path fill="none" stroke="black" d="M87823.25,-455.68C87837.27,-442.62 87855.02,-429.08 87874,-422 88036.55,-361.36 89265.6,-423.44 89435,-386 89448.16,-383.09 89461.63,-378.88 89474.71,-374.02"/>
<polygon fill="black" stroke="black" points="89476.09,-377.24 89484.17,-370.38 89473.58,-370.71 89476.09,-377.24"/>
</g>
<!-- layer3_gpu9_ln2 -->
<g id="node456" class="node">
<title>layer3_gpu9_ln2</title>
<ellipse fill="none" stroke="black" cx="83410" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="83410" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="83410" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="83410" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer3_gpu9_gate -->
<g id="node457" class="node">
<title>layer3_gpu9_gate</title>
<ellipse fill="none" stroke="black" cx="83243" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="83243" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="83243" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="83243" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- layer3_gpu9_gate&#45;&gt;layer3_expert_all2all -->
<g id="edge96" class="edge">
<title>layer3_gpu9_gate&#45;&gt;layer3_expert_all2all</title>
<path fill="none" stroke="black" d="M83212.36,-455.51C83198.17,-442.41 83180.2,-428.9 83161,-422 82972.26,-354.17 76136.08,-432.57 75941,-386 75926.2,-382.47 75911.13,-376.79 75896.93,-370.33"/>
<polygon fill="black" stroke="black" points="75898.27,-367.09 75887.74,-365.98 75895.28,-373.42 75898.27,-367.09"/>
</g>
<!-- layer3_gpu9_moe_agg -->
<g id="node458" class="node">
<title>layer3_gpu9_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="83147.5,-471.57 83147.5,-508.43 83081.6,-534.5 82988.4,-534.5 82922.5,-508.43 82922.5,-471.57 82988.4,-445.5 83081.6,-445.5 83147.5,-471.57"/>
<polygon fill="none" stroke="black" points="83151.5,-468.85 83151.5,-511.15 83082.36,-538.5 82987.64,-538.5 82918.5,-511.15 82918.5,-468.85 82987.64,-441.5 83082.36,-441.5 83151.5,-468.85"/>
<text text-anchor="middle" x="83035" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="83035" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="83035" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- embed_10 -->
<g id="node459" class="node">
<title>embed_10</title>
<polygon fill="none" stroke="black" points="95731,-516.5 95511,-516.5 95511,-463.5 95731,-463.5 95731,-516.5"/>
<text text-anchor="middle" x="95621" y="-501.3" font-family="Times,serif" font-size="14.00">Input Embedding</text>
<text text-anchor="middle" x="95621" y="-486.3" font-family="Times,serif" font-size="14.00">[B=1024, L=2048, D=8192]</text>
<text text-anchor="middle" x="95621" y="-471.3" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer0_gpu10_ln1 -->
<g id="node460" class="node">
<title>layer0_gpu10_ln1</title>
<ellipse fill="none" stroke="black" cx="95621" cy="-326" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="95621" y="-337.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="95621" y="-322.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="95621" y="-307.3" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- embed_10&#45;&gt;layer0_gpu10_ln1 -->
<g id="edge11" class="edge">
<title>embed_10&#45;&gt;layer0_gpu10_ln1</title>
<path fill="none" stroke="black" d="M95621,-463.33C95621,-439.41 95621,-403.17 95621,-374.06"/>
<polygon fill="black" stroke="black" points="95624.5,-373.69 95621,-363.69 95617.5,-373.69 95624.5,-373.69"/>
</g>
<!-- layer0_gpu10_qkv -->
<g id="node461" class="node">
<title>layer0_gpu10_qkv</title>
<polygon fill="none" stroke="black" points="96361,-524 96231,-524 96231,-456 96361,-456 96361,-524"/>
<text text-anchor="middle" x="96296" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="96296" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="96296" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="96296" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer0_gpu10_reshape -->
<g id="node462" class="node">
<title>layer0_gpu10_reshape</title>
<ellipse fill="none" stroke="black" cx="96145" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="96145" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="96145" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="96145" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer0_gpu10_attn -->
<g id="node463" class="node">
<title>layer0_gpu10_attn</title>
<polygon fill="none" stroke="black" points="95904,-558 95749,-490 95904,-422 96059,-490 95904,-558"/>
<text text-anchor="middle" x="95904" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="95904" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="95904" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="95904" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer0_gpu10_out_proj -->
<g id="node464" class="node">
<title>layer0_gpu10_out_proj</title>
<polygon fill="none" stroke="black" points="94193,-524 94049,-524 94049,-456 94193,-456 94193,-524"/>
<text text-anchor="middle" x="94121" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="94121" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="94121" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="94121" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer0_gpu10_out_proj&#45;&gt;layer0_concat_group2 -->
<g id="edge97" class="edge">
<title>layer0_gpu10_out_proj&#45;&gt;layer0_concat_group2</title>
<path fill="none" stroke="black" d="M94091.17,-455.9C94077.1,-442.71 94059.2,-429.01 94040,-422 93829.83,-345.28 90233.55,-423.59 90013,-386 89990.79,-382.22 89967.6,-375.99 89945.67,-368.97"/>
<polygon fill="black" stroke="black" points="89946.62,-365.6 89936.02,-365.81 89944.44,-372.25 89946.62,-365.6"/>
</g>
<!-- layer0_gpu10_ln2 -->
<g id="node465" class="node">
<title>layer0_gpu10_ln2</title>
<ellipse fill="none" stroke="black" cx="95417" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="95417" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="95417" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="95417" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer0_gpu10_gate -->
<g id="node466" class="node">
<title>layer0_gpu10_gate</title>
<ellipse fill="none" stroke="black" cx="91996" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="91996" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="91996" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="91996" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer0_gpu10_gate&#45;&gt;layer0_expert_all2all -->
<g id="edge98" class="edge">
<title>layer0_gpu10_gate&#45;&gt;layer0_expert_all2all</title>
<path fill="none" stroke="black" d="M91965.37,-455.48C91951.18,-442.39 91933.21,-428.88 91914,-422 91711.27,-349.44 76620.5,-435.71 76411,-386 76396.1,-382.46 76380.94,-376.75 76366.66,-370.24"/>
<polygon fill="black" stroke="black" points="76367.95,-366.98 76357.42,-365.86 76364.96,-373.31 76367.95,-366.98"/>
</g>
<!-- layer0_gpu10_moe_agg -->
<g id="node467" class="node">
<title>layer0_gpu10_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="92316.5,-471.57 92316.5,-508.43 92250.6,-534.5 92157.4,-534.5 92091.5,-508.43 92091.5,-471.57 92157.4,-445.5 92250.6,-445.5 92316.5,-471.57"/>
<polygon fill="none" stroke="black" points="92320.5,-468.85 92320.5,-511.15 92251.36,-538.5 92156.64,-538.5 92087.5,-511.15 92087.5,-468.85 92156.64,-441.5 92251.36,-441.5 92320.5,-468.85"/>
<text text-anchor="middle" x="92204" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="92204" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="92204" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer1_gpu10_ln1 -->
<g id="node468" class="node">
<title>layer1_gpu10_ln1</title>
<ellipse fill="none" stroke="black" cx="95248" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="95248" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="95248" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="95248" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer1_gpu10_qkv -->
<g id="node469" class="node">
<title>layer1_gpu10_qkv</title>
<polygon fill="none" stroke="black" points="94823,-524 94693,-524 94693,-456 94823,-456 94823,-524"/>
<text text-anchor="middle" x="94758" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="94758" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="94758" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="94758" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer1_gpu10_reshape -->
<g id="node470" class="node">
<title>layer1_gpu10_reshape</title>
<ellipse fill="none" stroke="black" cx="94607" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="94607" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="94607" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="94607" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer1_gpu10_attn -->
<g id="node471" class="node">
<title>layer1_gpu10_attn</title>
<polygon fill="none" stroke="black" points="94366,-558 94211,-490 94366,-422 94521,-490 94366,-558"/>
<text text-anchor="middle" x="94366" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="94366" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="94366" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="94366" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer1_gpu10_out_proj -->
<g id="node472" class="node">
<title>layer1_gpu10_out_proj</title>
<polygon fill="none" stroke="black" points="93699,-524 93555,-524 93555,-456 93699,-456 93699,-524"/>
<text text-anchor="middle" x="93627" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="93627" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="93627" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="93627" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer1_gpu10_out_proj&#45;&gt;layer1_concat_group2 -->
<g id="edge99" class="edge">
<title>layer1_gpu10_out_proj&#45;&gt;layer1_concat_group2</title>
<path fill="none" stroke="black" d="M93597.17,-455.9C93583.11,-442.71 93565.2,-429.01 93546,-422 93331.44,-343.7 89658.36,-433.7 89435,-386 89421.72,-383.16 89408.13,-378.96 89394.95,-374.09"/>
<polygon fill="black" stroke="black" points="89396.02,-370.75 89385.43,-370.43 89393.5,-377.29 89396.02,-370.75"/>
</g>
<!-- layer1_gpu10_ln2 -->
<g id="node473" class="node">
<title>layer1_gpu10_ln2</title>
<ellipse fill="none" stroke="black" cx="93955" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="93955" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="93955" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="93955" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer1_gpu10_gate -->
<g id="node474" class="node">
<title>layer1_gpu10_gate</title>
<ellipse fill="none" stroke="black" cx="90949" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="90949" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="90949" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="90949" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer1_gpu10_gate&#45;&gt;layer1_expert_all2all -->
<g id="edge100" class="edge">
<title>layer1_gpu10_gate&#45;&gt;layer1_expert_all2all</title>
<path fill="none" stroke="black" d="M90918.37,-455.48C90904.18,-442.39 90886.21,-428.88 90867,-422 90674.9,-353.23 76374.53,-433.12 76176,-386 76161.1,-382.46 76145.94,-376.75 76131.66,-370.24"/>
<polygon fill="black" stroke="black" points="76132.96,-366.98 76122.42,-365.86 76129.96,-373.3 76132.96,-366.98"/>
</g>
<!-- layer1_gpu10_moe_agg -->
<g id="node475" class="node">
<title>layer1_gpu10_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="91900.5,-471.57 91900.5,-508.43 91834.6,-534.5 91741.4,-534.5 91675.5,-508.43 91675.5,-471.57 91741.4,-445.5 91834.6,-445.5 91900.5,-471.57"/>
<polygon fill="none" stroke="black" points="91904.5,-468.85 91904.5,-511.15 91835.36,-538.5 91740.64,-538.5 91671.5,-511.15 91671.5,-468.85 91740.64,-441.5 91835.36,-441.5 91904.5,-468.85"/>
<text text-anchor="middle" x="91788" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="91788" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="91788" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer2_gpu10_ln1 -->
<g id="node476" class="node">
<title>layer2_gpu10_ln1</title>
<ellipse fill="none" stroke="black" cx="95079" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="95079" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="95079" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="95079" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer2_gpu10_qkv -->
<g id="node477" class="node">
<title>layer2_gpu10_qkv</title>
<polygon fill="none" stroke="black" points="93285,-524 93155,-524 93155,-456 93285,-456 93285,-524"/>
<text text-anchor="middle" x="93220" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="93220" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="93220" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="93220" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer2_gpu10_reshape -->
<g id="node478" class="node">
<title>layer2_gpu10_reshape</title>
<ellipse fill="none" stroke="black" cx="93069" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="93069" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="93069" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="93069" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer2_gpu10_attn -->
<g id="node479" class="node">
<title>layer2_gpu10_attn</title>
<polygon fill="none" stroke="black" points="92828,-558 92673,-490 92828,-422 92983,-490 92828,-558"/>
<text text-anchor="middle" x="92828" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="92828" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="92828" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="92828" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer2_gpu10_out_proj -->
<g id="node480" class="node">
<title>layer2_gpu10_out_proj</title>
<polygon fill="none" stroke="black" points="94985,-524 94841,-524 94841,-456 94985,-456 94985,-524"/>
<text text-anchor="middle" x="94913" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="94913" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="94913" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="94913" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer2_gpu10_out_proj&#45;&gt;layer2_concat_group2 -->
<g id="edge101" class="edge">
<title>layer2_gpu10_out_proj&#45;&gt;layer2_concat_group2</title>
<path fill="none" stroke="black" d="M94883.17,-455.9C94869.11,-442.7 94851.2,-429 94832,-422 94594.29,-335.36 90525.08,-440.47 90278,-386 90265.87,-383.33 90253.51,-379.44 90241.47,-374.92"/>
<polygon fill="black" stroke="black" points="90242.49,-371.55 90231.9,-371.16 90239.93,-378.07 90242.49,-371.55"/>
</g>
<!-- layer2_gpu10_ln2 -->
<g id="node481" class="node">
<title>layer2_gpu10_ln2</title>
<ellipse fill="none" stroke="black" cx="92414" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="92414" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="92414" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="92414" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer2_gpu10_gate -->
<g id="node482" class="node">
<title>layer2_gpu10_gate</title>
<ellipse fill="none" stroke="black" cx="92581" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="92581" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="92581" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="92581" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer2_gpu10_gate&#45;&gt;layer2_expert_all2all -->
<g id="edge102" class="edge">
<title>layer2_gpu10_gate&#45;&gt;layer2_expert_all2all</title>
<path fill="none" stroke="black" d="M92550.37,-455.48C92536.18,-442.39 92518.21,-428.88 92499,-422 92291.63,-347.79 76854.85,-438.72 76641,-386 76627.21,-382.6 76613.23,-377.2 76600.02,-371.01"/>
<polygon fill="black" stroke="black" points="76601.54,-367.85 76591.01,-366.61 76598.47,-374.14 76601.54,-367.85"/>
</g>
<!-- layer2_gpu10_moe_agg -->
<g id="node483" class="node">
<title>layer2_gpu10_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="93532.5,-471.57 93532.5,-508.43 93466.6,-534.5 93373.4,-534.5 93307.5,-508.43 93307.5,-471.57 93373.4,-445.5 93466.6,-445.5 93532.5,-471.57"/>
<polygon fill="none" stroke="black" points="93536.5,-468.85 93536.5,-511.15 93467.36,-538.5 93372.64,-538.5 93303.5,-511.15 93303.5,-468.85 93372.64,-441.5 93467.36,-441.5 93536.5,-468.85"/>
<text text-anchor="middle" x="93420" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="93420" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="93420" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer3_gpu10_ln1 -->
<g id="node484" class="node">
<title>layer3_gpu10_ln1</title>
<ellipse fill="none" stroke="black" cx="96455" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="96455" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="96455" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="96455" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer3_gpu10_qkv -->
<g id="node485" class="node">
<title>layer3_gpu10_qkv</title>
<polygon fill="none" stroke="black" points="91653,-524 91523,-524 91523,-456 91653,-456 91653,-524"/>
<text text-anchor="middle" x="91588" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="91588" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="91588" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="91588" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer3_gpu10_reshape -->
<g id="node486" class="node">
<title>layer3_gpu10_reshape</title>
<ellipse fill="none" stroke="black" cx="91437" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="91437" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="91437" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="91437" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer3_gpu10_attn -->
<g id="node487" class="node">
<title>layer3_gpu10_attn</title>
<polygon fill="none" stroke="black" points="91196,-558 91041,-490 91196,-422 91351,-490 91196,-558"/>
<text text-anchor="middle" x="91196" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="91196" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="91196" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="91196" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer3_gpu10_out_proj -->
<g id="node488" class="node">
<title>layer3_gpu10_out_proj</title>
<polygon fill="none" stroke="black" points="93861,-524 93717,-524 93717,-456 93861,-456 93861,-524"/>
<text text-anchor="middle" x="93789" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="93789" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="93789" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="93789" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer3_gpu10_out_proj&#45;&gt;layer3_concat_group2 -->
<g id="edge103" class="edge">
<title>layer3_gpu10_out_proj&#45;&gt;layer3_concat_group2</title>
<path fill="none" stroke="black" d="M93759.17,-455.91C93745.1,-442.71 93727.2,-429.01 93708,-422 93499.09,-345.73 89922.49,-432.47 89705,-386 89691.72,-383.16 89678.13,-378.96 89664.95,-374.09"/>
<polygon fill="black" stroke="black" points="89666.02,-370.75 89655.43,-370.43 89663.51,-377.28 89666.02,-370.75"/>
</g>
<!-- layer3_gpu10_ln2 -->
<g id="node489" class="node">
<title>layer3_gpu10_ln2</title>
<ellipse fill="none" stroke="black" cx="90782" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="90782" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="90782" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="90782" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer3_gpu10_gate -->
<g id="node490" class="node">
<title>layer3_gpu10_gate</title>
<ellipse fill="none" stroke="black" cx="90615" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="90615" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="90615" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="90615" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- layer3_gpu10_gate&#45;&gt;layer3_expert_all2all -->
<g id="edge104" class="edge">
<title>layer3_gpu10_gate&#45;&gt;layer3_expert_all2all</title>
<path fill="none" stroke="black" d="M90584.37,-455.48C90570.18,-442.39 90552.21,-428.88 90533,-422 90342.19,-353.69 76138.19,-432.81 75941,-386 75926.1,-382.46 75910.94,-376.75 75896.66,-370.24"/>
<polygon fill="black" stroke="black" points="75897.96,-366.98 75887.42,-365.86 75894.96,-373.3 75897.96,-366.98"/>
</g>
<!-- layer3_gpu10_moe_agg -->
<g id="node491" class="node">
<title>layer3_gpu10_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="90519.5,-471.57 90519.5,-508.43 90453.6,-534.5 90360.4,-534.5 90294.5,-508.43 90294.5,-471.57 90360.4,-445.5 90453.6,-445.5 90519.5,-471.57"/>
<polygon fill="none" stroke="black" points="90523.5,-468.85 90523.5,-511.15 90454.36,-538.5 90359.64,-538.5 90290.5,-511.15 90290.5,-468.85 90359.64,-441.5 90454.36,-441.5 90523.5,-468.85"/>
<text text-anchor="middle" x="90407" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="90407" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="90407" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- embed_11 -->
<g id="node492" class="node">
<title>embed_11</title>
<polygon fill="none" stroke="black" points="101996,-516.5 101776,-516.5 101776,-463.5 101996,-463.5 101996,-516.5"/>
<text text-anchor="middle" x="101886" y="-501.3" font-family="Times,serif" font-size="14.00">Input Embedding</text>
<text text-anchor="middle" x="101886" y="-486.3" font-family="Times,serif" font-size="14.00">[B=1024, L=2048, D=8192]</text>
<text text-anchor="middle" x="101886" y="-471.3" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer0_gpu11_ln1 -->
<g id="node493" class="node">
<title>layer0_gpu11_ln1</title>
<ellipse fill="none" stroke="black" cx="101886" cy="-326" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="101886" y="-337.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="101886" y="-322.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="101886" y="-307.3" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- embed_11&#45;&gt;layer0_gpu11_ln1 -->
<g id="edge12" class="edge">
<title>embed_11&#45;&gt;layer0_gpu11_ln1</title>
<path fill="none" stroke="black" d="M101886,-463.33C101886,-439.41 101886,-403.17 101886,-374.06"/>
<polygon fill="black" stroke="black" points="101889.5,-373.69 101886,-363.69 101882.5,-373.69 101889.5,-373.69"/>
</g>
<!-- layer0_gpu11_qkv -->
<g id="node494" class="node">
<title>layer0_gpu11_qkv</title>
<polygon fill="none" stroke="black" points="102626,-524 102496,-524 102496,-456 102626,-456 102626,-524"/>
<text text-anchor="middle" x="102561" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="102561" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="102561" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="102561" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer0_gpu11_reshape -->
<g id="node495" class="node">
<title>layer0_gpu11_reshape</title>
<ellipse fill="none" stroke="black" cx="102410" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="102410" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="102410" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="102410" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer0_gpu11_attn -->
<g id="node496" class="node">
<title>layer0_gpu11_attn</title>
<polygon fill="none" stroke="black" points="102169,-558 102014,-490 102169,-422 102324,-490 102169,-558"/>
<text text-anchor="middle" x="102169" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="102169" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="102169" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="102169" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer0_gpu11_out_proj -->
<g id="node497" class="node">
<title>layer0_gpu11_out_proj</title>
<polygon fill="none" stroke="black" points="100458,-524 100314,-524 100314,-456 100458,-456 100458,-524"/>
<text text-anchor="middle" x="100386" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="100386" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="100386" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="100386" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer0_gpu11_out_proj&#45;&gt;layer0_concat_group2 -->
<g id="edge105" class="edge">
<title>layer0_gpu11_out_proj&#45;&gt;layer0_concat_group2</title>
<path fill="none" stroke="black" d="M100356.19,-455.85C100342.13,-442.65 100324.22,-428.96 100305,-422 100170.59,-373.35 90153.98,-409.63 90013,-386 89990.64,-382.25 89967.3,-376 89945.25,-368.94"/>
<polygon fill="black" stroke="black" points="89946.15,-365.55 89935.55,-365.76 89943.96,-372.2 89946.15,-365.55"/>
</g>
<!-- layer0_gpu11_ln2 -->
<g id="node498" class="node">
<title>layer0_gpu11_ln2</title>
<ellipse fill="none" stroke="black" cx="101682" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="101682" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="101682" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="101682" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer0_gpu11_gate -->
<g id="node499" class="node">
<title>layer0_gpu11_gate</title>
<ellipse fill="none" stroke="black" cx="98261" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="98261" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="98261" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="98261" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer0_gpu11_gate&#45;&gt;layer0_expert_all2all -->
<g id="edge106" class="edge">
<title>layer0_gpu11_gate&#45;&gt;layer0_expert_all2all</title>
<path fill="none" stroke="black" d="M98230.37,-455.48C98216.18,-442.38 98198.22,-428.87 98179,-422 98036.66,-371.11 76558.09,-420.85 76411,-386 76396.1,-382.47 76380.93,-376.76 76366.66,-370.25"/>
<polygon fill="black" stroke="black" points="76367.95,-366.99 76357.42,-365.87 76364.96,-373.31 76367.95,-366.99"/>
</g>
<!-- layer0_gpu11_moe_agg -->
<g id="node500" class="node">
<title>layer0_gpu11_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="98581.5,-471.57 98581.5,-508.43 98515.6,-534.5 98422.4,-534.5 98356.5,-508.43 98356.5,-471.57 98422.4,-445.5 98515.6,-445.5 98581.5,-471.57"/>
<polygon fill="none" stroke="black" points="98585.5,-468.85 98585.5,-511.15 98516.36,-538.5 98421.64,-538.5 98352.5,-511.15 98352.5,-468.85 98421.64,-441.5 98516.36,-441.5 98585.5,-468.85"/>
<text text-anchor="middle" x="98469" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="98469" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="98469" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer1_gpu11_ln1 -->
<g id="node501" class="node">
<title>layer1_gpu11_ln1</title>
<ellipse fill="none" stroke="black" cx="101513" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="101513" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="101513" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="101513" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer1_gpu11_qkv -->
<g id="node502" class="node">
<title>layer1_gpu11_qkv</title>
<polygon fill="none" stroke="black" points="101088,-524 100958,-524 100958,-456 101088,-456 101088,-524"/>
<text text-anchor="middle" x="101023" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="101023" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="101023" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="101023" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer1_gpu11_reshape -->
<g id="node503" class="node">
<title>layer1_gpu11_reshape</title>
<ellipse fill="none" stroke="black" cx="100872" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="100872" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="100872" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="100872" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer1_gpu11_attn -->
<g id="node504" class="node">
<title>layer1_gpu11_attn</title>
<polygon fill="none" stroke="black" points="100631,-558 100476,-490 100631,-422 100786,-490 100631,-558"/>
<text text-anchor="middle" x="100631" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="100631" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="100631" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="100631" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer1_gpu11_out_proj -->
<g id="node505" class="node">
<title>layer1_gpu11_out_proj</title>
<polygon fill="none" stroke="black" points="99964,-524 99820,-524 99820,-456 99964,-456 99964,-524"/>
<text text-anchor="middle" x="99892" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="99892" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="99892" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="99892" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer1_gpu11_out_proj&#45;&gt;layer1_concat_group2 -->
<g id="edge107" class="edge">
<title>layer1_gpu11_out_proj&#45;&gt;layer1_concat_group2</title>
<path fill="none" stroke="black" d="M99862.19,-455.85C99848.13,-442.65 99830.22,-428.96 99811,-422 99675.49,-372.95 89576.01,-415.72 89435,-386 89421.71,-383.2 89408.12,-379.02 89394.93,-374.16"/>
<polygon fill="black" stroke="black" points="89396,-370.82 89385.41,-370.5 89393.49,-377.35 89396,-370.82"/>
</g>
<!-- layer1_gpu11_ln2 -->
<g id="node506" class="node">
<title>layer1_gpu11_ln2</title>
<ellipse fill="none" stroke="black" cx="100220" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="100220" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="100220" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="100220" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer1_gpu11_gate -->
<g id="node507" class="node">
<title>layer1_gpu11_gate</title>
<ellipse fill="none" stroke="black" cx="97214" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="97214" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="97214" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="97214" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer1_gpu11_gate&#45;&gt;layer1_expert_all2all -->
<g id="edge108" class="edge">
<title>layer1_gpu11_gate&#45;&gt;layer1_expert_all2all</title>
<path fill="none" stroke="black" d="M97183.37,-455.48C97169.18,-442.38 97151.21,-428.87 97132,-422 96994.97,-373 76317.61,-419.56 76176,-386 76161.1,-382.47 76145.93,-376.76 76131.66,-370.25"/>
<polygon fill="black" stroke="black" points="76132.95,-366.99 76122.42,-365.87 76129.96,-373.31 76132.95,-366.99"/>
</g>
<!-- layer1_gpu11_moe_agg -->
<g id="node508" class="node">
<title>layer1_gpu11_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="98165.5,-471.57 98165.5,-508.43 98099.6,-534.5 98006.4,-534.5 97940.5,-508.43 97940.5,-471.57 98006.4,-445.5 98099.6,-445.5 98165.5,-471.57"/>
<polygon fill="none" stroke="black" points="98169.5,-468.85 98169.5,-511.15 98100.36,-538.5 98005.64,-538.5 97936.5,-511.15 97936.5,-468.85 98005.64,-441.5 98100.36,-441.5 98169.5,-468.85"/>
<text text-anchor="middle" x="98053" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="98053" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="98053" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer2_gpu11_ln1 -->
<g id="node509" class="node">
<title>layer2_gpu11_ln1</title>
<ellipse fill="none" stroke="black" cx="101344" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="101344" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="101344" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="101344" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer2_gpu11_qkv -->
<g id="node510" class="node">
<title>layer2_gpu11_qkv</title>
<polygon fill="none" stroke="black" points="99550,-524 99420,-524 99420,-456 99550,-456 99550,-524"/>
<text text-anchor="middle" x="99485" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="99485" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="99485" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="99485" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer2_gpu11_reshape -->
<g id="node511" class="node">
<title>layer2_gpu11_reshape</title>
<ellipse fill="none" stroke="black" cx="99334" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="99334" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="99334" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="99334" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer2_gpu11_attn -->
<g id="node512" class="node">
<title>layer2_gpu11_attn</title>
<polygon fill="none" stroke="black" points="99093,-558 98938,-490 99093,-422 99248,-490 99093,-558"/>
<text text-anchor="middle" x="99093" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="99093" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="99093" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="99093" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer2_gpu11_out_proj -->
<g id="node513" class="node">
<title>layer2_gpu11_out_proj</title>
<polygon fill="none" stroke="black" points="101250,-524 101106,-524 101106,-456 101250,-456 101250,-524"/>
<text text-anchor="middle" x="101178" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="101178" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="101178" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="101178" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer2_gpu11_out_proj&#45;&gt;layer2_concat_group2 -->
<g id="edge109" class="edge">
<title>layer2_gpu11_out_proj&#45;&gt;layer2_concat_group2</title>
<path fill="none" stroke="black" d="M101148.19,-455.85C101134.13,-442.65 101116.22,-428.96 101097,-422 100955.7,-370.87 90424.82,-418.01 90278,-386 90265.87,-383.35 90253.5,-379.48 90241.46,-374.97"/>
<polygon fill="black" stroke="black" points="90242.48,-371.61 90231.89,-371.22 90239.92,-378.13 90242.48,-371.61"/>
</g>
<!-- layer2_gpu11_ln2 -->
<g id="node514" class="node">
<title>layer2_gpu11_ln2</title>
<ellipse fill="none" stroke="black" cx="98679" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="98679" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="98679" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="98679" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer2_gpu11_gate -->
<g id="node515" class="node">
<title>layer2_gpu11_gate</title>
<ellipse fill="none" stroke="black" cx="98846" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="98846" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="98846" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="98846" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer2_gpu11_gate&#45;&gt;layer2_expert_all2all -->
<g id="edge110" class="edge">
<title>layer2_gpu11_gate&#45;&gt;layer2_expert_all2all</title>
<path fill="none" stroke="black" d="M98815.37,-455.48C98801.18,-442.38 98783.22,-428.87 98764,-422 98619.33,-370.28 76790.18,-422.73 76641,-386 76627.21,-382.6 76613.23,-377.2 76600.02,-371.01"/>
<polygon fill="black" stroke="black" points="76601.53,-367.86 76591.01,-366.62 76598.46,-374.15 76601.53,-367.86"/>
</g>
<!-- layer2_gpu11_moe_agg -->
<g id="node516" class="node">
<title>layer2_gpu11_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="99797.5,-471.57 99797.5,-508.43 99731.6,-534.5 99638.4,-534.5 99572.5,-508.43 99572.5,-471.57 99638.4,-445.5 99731.6,-445.5 99797.5,-471.57"/>
<polygon fill="none" stroke="black" points="99801.5,-468.85 99801.5,-511.15 99732.36,-538.5 99637.64,-538.5 99568.5,-511.15 99568.5,-468.85 99637.64,-441.5 99732.36,-441.5 99801.5,-468.85"/>
<text text-anchor="middle" x="99685" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="99685" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="99685" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer3_gpu11_ln1 -->
<g id="node517" class="node">
<title>layer3_gpu11_ln1</title>
<ellipse fill="none" stroke="black" cx="102720" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="102720" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="102720" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="102720" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer3_gpu11_qkv -->
<g id="node518" class="node">
<title>layer3_gpu11_qkv</title>
<polygon fill="none" stroke="black" points="97918,-524 97788,-524 97788,-456 97918,-456 97918,-524"/>
<text text-anchor="middle" x="97853" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="97853" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="97853" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="97853" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer3_gpu11_reshape -->
<g id="node519" class="node">
<title>layer3_gpu11_reshape</title>
<ellipse fill="none" stroke="black" cx="97702" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="97702" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="97702" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="97702" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer3_gpu11_attn -->
<g id="node520" class="node">
<title>layer3_gpu11_attn</title>
<polygon fill="none" stroke="black" points="97461,-558 97306,-490 97461,-422 97616,-490 97461,-558"/>
<text text-anchor="middle" x="97461" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="97461" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="97461" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="97461" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer3_gpu11_out_proj -->
<g id="node521" class="node">
<title>layer3_gpu11_out_proj</title>
<polygon fill="none" stroke="black" points="100126,-524 99982,-524 99982,-456 100126,-456 100126,-524"/>
<text text-anchor="middle" x="100054" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="100054" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="100054" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="100054" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer3_gpu11_out_proj&#45;&gt;layer3_concat_group2 -->
<g id="edge111" class="edge">
<title>layer3_gpu11_out_proj&#45;&gt;layer3_concat_group2</title>
<path fill="none" stroke="black" d="M100024.19,-455.85C100010.13,-442.65 99992.22,-428.96 99973,-422 99838.9,-373.46 89844.55,-415.42 89705,-386 89691.71,-383.2 89678.12,-379.02 89664.93,-374.16"/>
<polygon fill="black" stroke="black" points="89666,-370.82 89655.41,-370.5 89663.49,-377.35 89666,-370.82"/>
</g>
<!-- layer3_gpu11_ln2 -->
<g id="node522" class="node">
<title>layer3_gpu11_ln2</title>
<ellipse fill="none" stroke="black" cx="97047" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="97047" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="97047" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="97047" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer3_gpu11_gate -->
<g id="node523" class="node">
<title>layer3_gpu11_gate</title>
<ellipse fill="none" stroke="black" cx="96880" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="96880" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="96880" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="96880" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- layer3_gpu11_gate&#45;&gt;layer3_expert_all2all -->
<g id="edge112" class="edge">
<title>layer3_gpu11_gate&#45;&gt;layer3_expert_all2all</title>
<path fill="none" stroke="black" d="M96849.37,-455.48C96835.18,-442.38 96817.21,-428.87 96798,-422 96661.62,-373.23 76081.94,-419.4 75941,-386 75926.1,-382.47 75910.93,-376.76 75896.66,-370.25"/>
<polygon fill="black" stroke="black" points="75897.95,-366.99 75887.42,-365.87 75894.96,-373.31 75897.95,-366.99"/>
</g>
<!-- layer3_gpu11_moe_agg -->
<g id="node524" class="node">
<title>layer3_gpu11_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="96784.5,-471.57 96784.5,-508.43 96718.6,-534.5 96625.4,-534.5 96559.5,-508.43 96559.5,-471.57 96625.4,-445.5 96718.6,-445.5 96784.5,-471.57"/>
<polygon fill="none" stroke="black" points="96788.5,-468.85 96788.5,-511.15 96719.36,-538.5 96624.64,-538.5 96555.5,-511.15 96555.5,-468.85 96624.64,-441.5 96719.36,-441.5 96788.5,-468.85"/>
<text text-anchor="middle" x="96672" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="96672" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="96672" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- embed_12 -->
<g id="node525" class="node">
<title>embed_12</title>
<polygon fill="none" stroke="black" points="106812,-516.5 106592,-516.5 106592,-463.5 106812,-463.5 106812,-516.5"/>
<text text-anchor="middle" x="106702" y="-501.3" font-family="Times,serif" font-size="14.00">Input Embedding</text>
<text text-anchor="middle" x="106702" y="-486.3" font-family="Times,serif" font-size="14.00">[B=1024, L=2048, D=8192]</text>
<text text-anchor="middle" x="106702" y="-471.3" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer0_gpu12_ln1 -->
<g id="node526" class="node">
<title>layer0_gpu12_ln1</title>
<ellipse fill="none" stroke="black" cx="106702" cy="-326" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="106702" y="-337.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="106702" y="-322.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="106702" y="-307.3" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- embed_12&#45;&gt;layer0_gpu12_ln1 -->
<g id="edge13" class="edge">
<title>embed_12&#45;&gt;layer0_gpu12_ln1</title>
<path fill="none" stroke="black" d="M106702,-463.33C106702,-439.41 106702,-403.17 106702,-374.06"/>
<polygon fill="black" stroke="black" points="106705.5,-373.69 106702,-363.69 106698.5,-373.69 106705.5,-373.69"/>
</g>
<!-- layer0_gpu12_qkv -->
<g id="node527" class="node">
<title>layer0_gpu12_qkv</title>
<polygon fill="none" stroke="black" points="108898,-524 108768,-524 108768,-456 108898,-456 108898,-524"/>
<text text-anchor="middle" x="108833" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="108833" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="108833" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="108833" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer0_gpu12_reshape -->
<g id="node528" class="node">
<title>layer0_gpu12_reshape</title>
<ellipse fill="none" stroke="black" cx="108682" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="108682" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="108682" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="108682" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer0_gpu12_attn -->
<g id="node529" class="node">
<title>layer0_gpu12_attn</title>
<polygon fill="none" stroke="black" points="108441,-558 108286,-490 108441,-422 108596,-490 108441,-558"/>
<text text-anchor="middle" x="108441" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="108441" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="108441" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="108441" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer0_gpu12_out_proj -->
<g id="node530" class="node">
<title>layer0_gpu12_out_proj</title>
<polygon fill="none" stroke="black" points="108268,-524 108124,-524 108124,-456 108268,-456 108268,-524"/>
<text text-anchor="middle" x="108196" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="108196" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="108196" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="108196" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer0_concat_group3 -->
<g id="node673" class="node">
<title>layer0_concat_group3</title>
<polygon fill="yellow" stroke="black" points="116127,-302.8 116127,-349.2 116055.53,-382 115954.47,-382 115883,-349.2 115883,-302.8 115954.47,-270 116055.53,-270 116127,-302.8"/>
<polygon fill="none" stroke="black" points="116131,-300.24 116131,-351.76 116056.41,-386 115953.59,-386 115879,-351.76 115879,-300.24 115953.59,-266 116056.41,-266 116131,-300.24"/>
<text text-anchor="middle" x="116005" y="-344.8" font-family="Times,serif" font-size="14.00">Concat Dimensions</text>
<text text-anchor="middle" x="116005" y="-329.8" font-family="Times,serif" font-size="14.00">Head Group 3</text>
<text text-anchor="middle" x="116005" y="-314.8" font-family="Times,serif" font-size="14.00">[B,L,4,512]</text>
<text text-anchor="middle" x="116005" y="-299.8" font-family="Times,serif" font-size="14.00">GPUs 12&#45;15</text>
</g>
<!-- layer0_gpu12_out_proj&#45;&gt;layer0_concat_group3 -->
<g id="edge113" class="edge">
<title>layer0_gpu12_out_proj&#45;&gt;layer0_concat_group3</title>
<path fill="none" stroke="black" d="M108225.81,-455.87C108239.88,-442.66 108257.78,-428.97 108277,-422 108475.28,-350.09 115663.64,-429.63 115870,-386 115883.29,-383.19 115896.88,-379.01 115910.06,-374.14"/>
<polygon fill="black" stroke="black" points="115911.5,-377.34 115919.59,-370.49 115909,-370.8 115911.5,-377.34"/>
</g>
<!-- layer0_gpu12_ln2 -->
<g id="node531" class="node">
<title>layer0_gpu12_ln2</title>
<ellipse fill="none" stroke="black" cx="108030" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="108030" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="108030" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="108030" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer0_gpu12_gate -->
<g id="node532" class="node">
<title>layer0_gpu12_gate</title>
<ellipse fill="none" stroke="black" cx="104526" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="104526" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="104526" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="104526" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer0_gpu12_gate&#45;&gt;layer0_expert_all2all -->
<g id="edge114" class="edge">
<title>layer0_gpu12_gate&#45;&gt;layer0_expert_all2all</title>
<path fill="none" stroke="black" d="M104495.37,-455.47C104481.18,-442.37 104463.22,-428.87 104444,-422 104260.68,-356.5 76600.44,-430.85 76411,-386 76396.1,-382.47 76380.93,-376.76 76366.66,-370.25"/>
<polygon fill="black" stroke="black" points="76367.95,-366.99 76357.42,-365.87 76364.95,-373.32 76367.95,-366.99"/>
</g>
<!-- layer0_gpu12_moe_agg -->
<g id="node533" class="node">
<title>layer0_gpu12_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="104846.5,-471.57 104846.5,-508.43 104780.6,-534.5 104687.4,-534.5 104621.5,-508.43 104621.5,-471.57 104687.4,-445.5 104780.6,-445.5 104846.5,-471.57"/>
<polygon fill="none" stroke="black" points="104850.5,-468.85 104850.5,-511.15 104781.36,-538.5 104686.64,-538.5 104617.5,-511.15 104617.5,-468.85 104686.64,-441.5 104781.36,-441.5 104850.5,-468.85"/>
<text text-anchor="middle" x="104734" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="104734" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="104734" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer1_gpu12_ln1 -->
<g id="node534" class="node">
<title>layer1_gpu12_ln1</title>
<ellipse fill="none" stroke="black" cx="106329" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="106329" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="106329" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="106329" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer1_gpu12_qkv -->
<g id="node535" class="node">
<title>layer1_gpu12_qkv</title>
<polygon fill="none" stroke="black" points="107442,-524 107312,-524 107312,-456 107442,-456 107442,-524"/>
<text text-anchor="middle" x="107377" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="107377" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="107377" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="107377" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer1_gpu12_reshape -->
<g id="node536" class="node">
<title>layer1_gpu12_reshape</title>
<ellipse fill="none" stroke="black" cx="107226" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="107226" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="107226" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="107226" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer1_gpu12_attn -->
<g id="node537" class="node">
<title>layer1_gpu12_attn</title>
<polygon fill="none" stroke="black" points="106985,-558 106830,-490 106985,-422 107140,-490 106985,-558"/>
<text text-anchor="middle" x="106985" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="106985" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="106985" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="106985" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer1_gpu12_out_proj -->
<g id="node538" class="node">
<title>layer1_gpu12_out_proj</title>
<polygon fill="none" stroke="black" points="107774,-524 107630,-524 107630,-456 107774,-456 107774,-524"/>
<text text-anchor="middle" x="107702" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="107702" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="107702" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="107702" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer1_concat_group3 -->
<g id="node674" class="node">
<title>layer1_concat_group3</title>
<polygon fill="yellow" stroke="black" points="115587,-302.8 115587,-349.2 115515.53,-382 115414.47,-382 115343,-349.2 115343,-302.8 115414.47,-270 115515.53,-270 115587,-302.8"/>
<polygon fill="none" stroke="black" points="115591,-300.24 115591,-351.76 115516.41,-386 115413.59,-386 115339,-351.76 115339,-300.24 115413.59,-266 115516.41,-266 115591,-300.24"/>
<text text-anchor="middle" x="115465" y="-344.8" font-family="Times,serif" font-size="14.00">Concat Dimensions</text>
<text text-anchor="middle" x="115465" y="-329.8" font-family="Times,serif" font-size="14.00">Head Group 3</text>
<text text-anchor="middle" x="115465" y="-314.8" font-family="Times,serif" font-size="14.00">[B,L,4,512]</text>
<text text-anchor="middle" x="115465" y="-299.8" font-family="Times,serif" font-size="14.00">GPUs 12&#45;15</text>
</g>
<!-- layer1_gpu12_out_proj&#45;&gt;layer1_concat_group3 -->
<g id="edge115" class="edge">
<title>layer1_gpu12_out_proj&#45;&gt;layer1_concat_group3</title>
<path fill="none" stroke="black" d="M107731.81,-455.87C107745.88,-442.66 107763.78,-428.97 107783,-422 107980.21,-350.48 115130.07,-430.84 115335,-386 115347.13,-383.35 115359.49,-379.47 115371.53,-374.95"/>
<polygon fill="black" stroke="black" points="115373.07,-378.11 115381.11,-371.2 115370.52,-371.59 115373.07,-378.11"/>
</g>
<!-- layer1_gpu12_ln2 -->
<g id="node539" class="node">
<title>layer1_gpu12_ln2</title>
<ellipse fill="none" stroke="black" cx="106498" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="106498" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="106498" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="106498" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer1_gpu12_gate -->
<g id="node540" class="node">
<title>layer1_gpu12_gate</title>
<ellipse fill="none" stroke="black" cx="103479" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="103479" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="103479" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="103479" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer1_gpu12_gate&#45;&gt;layer1_expert_all2all -->
<g id="edge116" class="edge">
<title>layer1_gpu12_gate&#45;&gt;layer1_expert_all2all</title>
<path fill="none" stroke="black" d="M103448.37,-455.47C103434.18,-442.37 103416.22,-428.87 103397,-422 103218.99,-358.39 76359.95,-429.55 76176,-386 76161.1,-382.47 76145.93,-376.76 76131.66,-370.25"/>
<polygon fill="black" stroke="black" points="76132.95,-366.99 76122.42,-365.87 76129.95,-373.32 76132.95,-366.99"/>
</g>
<!-- layer1_gpu12_moe_agg -->
<g id="node541" class="node">
<title>layer1_gpu12_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="104430.5,-471.57 104430.5,-508.43 104364.6,-534.5 104271.4,-534.5 104205.5,-508.43 104205.5,-471.57 104271.4,-445.5 104364.6,-445.5 104430.5,-471.57"/>
<polygon fill="none" stroke="black" points="104434.5,-468.85 104434.5,-511.15 104365.36,-538.5 104270.64,-538.5 104201.5,-511.15 104201.5,-468.85 104270.64,-441.5 104365.36,-441.5 104434.5,-468.85"/>
<text text-anchor="middle" x="104318" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="104318" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="104318" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer2_gpu12_ln1 -->
<g id="node542" class="node">
<title>layer2_gpu12_ln1</title>
<ellipse fill="none" stroke="black" cx="106160" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="106160" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="106160" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="106160" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer2_gpu12_qkv -->
<g id="node543" class="node">
<title>layer2_gpu12_qkv</title>
<polygon fill="none" stroke="black" points="105815,-524 105685,-524 105685,-456 105815,-456 105815,-524"/>
<text text-anchor="middle" x="105750" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="105750" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="105750" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="105750" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer2_gpu12_reshape -->
<g id="node544" class="node">
<title>layer2_gpu12_reshape</title>
<ellipse fill="none" stroke="black" cx="105599" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="105599" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="105599" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="105599" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer2_gpu12_attn -->
<g id="node545" class="node">
<title>layer2_gpu12_attn</title>
<polygon fill="none" stroke="black" points="105358,-558 105203,-490 105358,-422 105513,-490 105358,-558"/>
<text text-anchor="middle" x="105358" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="105358" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="105358" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="105358" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer2_gpu12_out_proj -->
<g id="node546" class="node">
<title>layer2_gpu12_out_proj</title>
<polygon fill="none" stroke="black" points="109060,-524 108916,-524 108916,-456 109060,-456 109060,-524"/>
<text text-anchor="middle" x="108988" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="108988" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="108988" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="108988" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer2_concat_group3 -->
<g id="node675" class="node">
<title>layer2_concat_group3</title>
<polygon fill="yellow" stroke="black" points="116435,-302.8 116435,-349.2 116363.53,-382 116262.47,-382 116191,-349.2 116191,-302.8 116262.47,-270 116363.53,-270 116435,-302.8"/>
<polygon fill="none" stroke="black" points="116439,-300.24 116439,-351.76 116364.41,-386 116261.59,-386 116187,-351.76 116187,-300.24 116261.59,-266 116364.41,-266 116439,-300.24"/>
<text text-anchor="middle" x="116313" y="-344.8" font-family="Times,serif" font-size="14.00">Concat Dimensions</text>
<text text-anchor="middle" x="116313" y="-329.8" font-family="Times,serif" font-size="14.00">Head Group 3</text>
<text text-anchor="middle" x="116313" y="-314.8" font-family="Times,serif" font-size="14.00">[B,L,4,512]</text>
<text text-anchor="middle" x="116313" y="-299.8" font-family="Times,serif" font-size="14.00">GPUs 12&#45;15</text>
</g>
<!-- layer2_gpu12_out_proj&#45;&gt;layer2_concat_group3 -->
<g id="edge117" class="edge">
<title>layer2_gpu12_out_proj&#45;&gt;layer2_concat_group3</title>
<path fill="none" stroke="black" d="M109019.13,-455.85C109033.76,-442.64 109052.3,-428.95 109072,-422 109257.15,-356.67 115946.39,-418.61 116140,-386 116162.22,-382.26 116185.41,-376.05 116207.34,-369.04"/>
<polygon fill="black" stroke="black" points="116208.57,-372.32 116216.99,-365.88 116206.39,-365.67 116208.57,-372.32"/>
</g>
<!-- layer2_gpu12_ln2 -->
<g id="node547" class="node">
<title>layer2_gpu12_ln2</title>
<ellipse fill="none" stroke="black" cx="104944" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="104944" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="104944" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="104944" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer2_gpu12_gate -->
<g id="node548" class="node">
<title>layer2_gpu12_gate</title>
<ellipse fill="none" stroke="black" cx="105111" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="105111" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="105111" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="105111" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer2_gpu12_gate&#45;&gt;layer2_expert_all2all -->
<g id="edge118" class="edge">
<title>layer2_gpu12_gate&#45;&gt;layer2_expert_all2all</title>
<path fill="none" stroke="black" d="M105080.37,-455.47C105066.18,-442.37 105048.22,-428.87 105029,-422 104843.36,-355.67 76832.43,-433.1 76641,-386 76627.21,-382.61 76613.23,-377.21 76600.02,-371.02"/>
<polygon fill="black" stroke="black" points="76601.53,-367.86 76591.01,-366.62 76598.46,-374.15 76601.53,-367.86"/>
</g>
<!-- layer2_gpu12_moe_agg -->
<g id="node549" class="node">
<title>layer2_gpu12_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="106062.5,-471.57 106062.5,-508.43 105996.6,-534.5 105903.4,-534.5 105837.5,-508.43 105837.5,-471.57 105903.4,-445.5 105996.6,-445.5 106062.5,-471.57"/>
<polygon fill="none" stroke="black" points="106066.5,-468.85 106066.5,-511.15 105997.36,-538.5 105902.64,-538.5 105833.5,-511.15 105833.5,-468.85 105902.64,-441.5 105997.36,-441.5 106066.5,-468.85"/>
<text text-anchor="middle" x="105950" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="105950" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="105950" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer3_gpu12_ln1 -->
<g id="node550" class="node">
<title>layer3_gpu12_ln1</title>
<ellipse fill="none" stroke="black" cx="107536" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="107536" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="107536" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="107536" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer3_gpu12_qkv -->
<g id="node551" class="node">
<title>layer3_gpu12_qkv</title>
<polygon fill="none" stroke="black" points="104183,-524 104053,-524 104053,-456 104183,-456 104183,-524"/>
<text text-anchor="middle" x="104118" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="104118" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="104118" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="104118" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer3_gpu12_reshape -->
<g id="node552" class="node">
<title>layer3_gpu12_reshape</title>
<ellipse fill="none" stroke="black" cx="103967" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="103967" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="103967" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="103967" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer3_gpu12_attn -->
<g id="node553" class="node">
<title>layer3_gpu12_attn</title>
<polygon fill="none" stroke="black" points="103726,-558 103571,-490 103726,-422 103881,-490 103726,-558"/>
<text text-anchor="middle" x="103726" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="103726" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="103726" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="103726" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer3_gpu12_out_proj -->
<g id="node554" class="node">
<title>layer3_gpu12_out_proj</title>
<polygon fill="none" stroke="black" points="107936,-524 107792,-524 107792,-456 107936,-456 107936,-524"/>
<text text-anchor="middle" x="107864" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="107864" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="107864" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="107864" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer3_concat_group3 -->
<g id="node676" class="node">
<title>layer3_concat_group3</title>
<polygon fill="yellow" stroke="black" points="115857,-302.8 115857,-349.2 115785.53,-382 115684.47,-382 115613,-349.2 115613,-302.8 115684.47,-270 115785.53,-270 115857,-302.8"/>
<polygon fill="none" stroke="black" points="115861,-300.24 115861,-351.76 115786.41,-386 115683.59,-386 115609,-351.76 115609,-300.24 115683.59,-266 115786.41,-266 115861,-300.24"/>
<text text-anchor="middle" x="115735" y="-344.8" font-family="Times,serif" font-size="14.00">Concat Dimensions</text>
<text text-anchor="middle" x="115735" y="-329.8" font-family="Times,serif" font-size="14.00">Head Group 3</text>
<text text-anchor="middle" x="115735" y="-314.8" font-family="Times,serif" font-size="14.00">[B,L,4,512]</text>
<text text-anchor="middle" x="115735" y="-299.8" font-family="Times,serif" font-size="14.00">GPUs 12&#45;15</text>
</g>
<!-- layer3_gpu12_out_proj&#45;&gt;layer3_concat_group3 -->
<g id="edge119" class="edge">
<title>layer3_gpu12_out_proj&#45;&gt;layer3_concat_group3</title>
<path fill="none" stroke="black" d="M107893.81,-455.87C107907.88,-442.66 107925.78,-428.97 107945,-422 108144.9,-349.51 115391.96,-429.99 115600,-386 115613.29,-383.19 115626.88,-379.01 115640.06,-374.14"/>
<polygon fill="black" stroke="black" points="115641.5,-377.34 115649.59,-370.49 115639,-370.8 115641.5,-377.34"/>
</g>
<!-- layer3_gpu12_ln2 -->
<g id="node555" class="node">
<title>layer3_gpu12_ln2</title>
<ellipse fill="none" stroke="black" cx="103312" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="103312" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="103312" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="103312" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer3_gpu12_gate -->
<g id="node556" class="node">
<title>layer3_gpu12_gate</title>
<ellipse fill="none" stroke="black" cx="103145" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="103145" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="103145" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="103145" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- layer3_gpu12_gate&#45;&gt;layer3_expert_all2all -->
<g id="edge120" class="edge">
<title>layer3_gpu12_gate&#45;&gt;layer3_expert_all2all</title>
<path fill="none" stroke="black" d="M103114.37,-455.47C103100.18,-442.37 103082.22,-428.87 103063,-422 102885.64,-358.62 76124.28,-429.4 75941,-386 75926.1,-382.47 75910.93,-376.76 75896.66,-370.25"/>
<polygon fill="black" stroke="black" points="75897.95,-366.99 75887.42,-365.87 75894.95,-373.32 75897.95,-366.99"/>
</g>
<!-- layer3_gpu12_moe_agg -->
<g id="node557" class="node">
<title>layer3_gpu12_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="103049.5,-471.57 103049.5,-508.43 102983.6,-534.5 102890.4,-534.5 102824.5,-508.43 102824.5,-471.57 102890.4,-445.5 102983.6,-445.5 103049.5,-471.57"/>
<polygon fill="none" stroke="black" points="103053.5,-468.85 103053.5,-511.15 102984.36,-538.5 102889.64,-538.5 102820.5,-511.15 102820.5,-468.85 102889.64,-441.5 102984.36,-441.5 103053.5,-468.85"/>
<text text-anchor="middle" x="102937" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="102937" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="102937" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- embed_13 -->
<g id="node558" class="node">
<title>embed_13</title>
<polygon fill="none" stroke="black" points="113076,-516.5 112856,-516.5 112856,-463.5 113076,-463.5 113076,-516.5"/>
<text text-anchor="middle" x="112966" y="-501.3" font-family="Times,serif" font-size="14.00">Input Embedding</text>
<text text-anchor="middle" x="112966" y="-486.3" font-family="Times,serif" font-size="14.00">[B=1024, L=2048, D=8192]</text>
<text text-anchor="middle" x="112966" y="-471.3" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer0_gpu13_ln1 -->
<g id="node559" class="node">
<title>layer0_gpu13_ln1</title>
<ellipse fill="none" stroke="black" cx="112966" cy="-326" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="112966" y="-337.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="112966" y="-322.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="112966" y="-307.3" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- embed_13&#45;&gt;layer0_gpu13_ln1 -->
<g id="edge14" class="edge">
<title>embed_13&#45;&gt;layer0_gpu13_ln1</title>
<path fill="none" stroke="black" d="M112966,-463.33C112966,-439.41 112966,-403.17 112966,-374.06"/>
<polygon fill="black" stroke="black" points="112969.5,-373.69 112966,-363.69 112962.5,-373.69 112969.5,-373.69"/>
</g>
<!-- layer0_gpu13_qkv -->
<g id="node560" class="node">
<title>layer0_gpu13_qkv</title>
<polygon fill="none" stroke="black" points="115161,-524 115031,-524 115031,-456 115161,-456 115161,-524"/>
<text text-anchor="middle" x="115096" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="115096" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="115096" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="115096" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer0_gpu13_reshape -->
<g id="node561" class="node">
<title>layer0_gpu13_reshape</title>
<ellipse fill="none" stroke="black" cx="114945" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="114945" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="114945" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="114945" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer0_gpu13_attn -->
<g id="node562" class="node">
<title>layer0_gpu13_attn</title>
<polygon fill="none" stroke="black" points="114704,-558 114549,-490 114704,-422 114859,-490 114704,-558"/>
<text text-anchor="middle" x="114704" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="114704" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="114704" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="114704" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer0_gpu13_out_proj -->
<g id="node563" class="node">
<title>layer0_gpu13_out_proj</title>
<polygon fill="none" stroke="black" points="114192,-524 114048,-524 114048,-456 114192,-456 114192,-524"/>
<text text-anchor="middle" x="114120" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="114120" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="114120" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="114120" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer0_gpu13_out_proj&#45;&gt;layer0_concat_group3 -->
<g id="edge121" class="edge">
<title>layer0_gpu13_out_proj&#45;&gt;layer0_concat_group3</title>
<path fill="none" stroke="black" d="M114150.25,-455.67C114164.27,-442.6 114182.02,-429.07 114201,-422 114374.84,-357.3 115688.85,-425.9 115870,-386 115883.17,-383.1 115896.63,-378.89 115909.72,-374.04"/>
<polygon fill="black" stroke="black" points="115911.1,-377.26 115919.17,-370.4 115908.58,-370.73 115911.1,-377.26"/>
</g>
<!-- layer0_gpu13_ln2 -->
<g id="node564" class="node">
<title>layer0_gpu13_ln2</title>
<ellipse fill="none" stroke="black" cx="114286" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="114286" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="114286" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="114286" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer0_gpu13_gate -->
<g id="node565" class="node">
<title>layer0_gpu13_gate</title>
<ellipse fill="none" stroke="black" cx="110790" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="110790" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="110790" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="110790" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer0_gpu13_gate&#45;&gt;layer0_expert_all2all -->
<g id="edge122" class="edge">
<title>layer0_gpu13_gate&#45;&gt;layer0_expert_all2all</title>
<path fill="none" stroke="black" d="M110759.38,-455.47C110745.19,-442.37 110727.22,-428.86 110708,-422 110483.7,-341.89 76642.77,-440.84 76411,-386 76396.1,-382.47 76380.93,-376.77 76366.66,-370.26"/>
<polygon fill="black" stroke="black" points="76367.95,-367 76357.42,-365.88 76364.95,-373.32 76367.95,-367"/>
</g>
<!-- layer0_gpu13_moe_agg -->
<g id="node566" class="node">
<title>layer0_gpu13_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="111110.5,-471.57 111110.5,-508.43 111044.6,-534.5 110951.4,-534.5 110885.5,-508.43 110885.5,-471.57 110951.4,-445.5 111044.6,-445.5 111110.5,-471.57"/>
<polygon fill="none" stroke="black" points="111114.5,-468.85 111114.5,-511.15 111045.36,-538.5 110950.64,-538.5 110881.5,-511.15 110881.5,-468.85 110950.64,-441.5 111045.36,-441.5 111114.5,-468.85"/>
<text text-anchor="middle" x="110998" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="110998" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="110998" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer1_gpu13_ln1 -->
<g id="node567" class="node">
<title>layer1_gpu13_ln1</title>
<ellipse fill="none" stroke="black" cx="112593" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="112593" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="112593" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="112593" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer1_gpu13_qkv -->
<g id="node568" class="node">
<title>layer1_gpu13_qkv</title>
<polygon fill="none" stroke="black" points="113706,-524 113576,-524 113576,-456 113706,-456 113706,-524"/>
<text text-anchor="middle" x="113641" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="113641" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="113641" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="113641" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer1_gpu13_reshape -->
<g id="node569" class="node">
<title>layer1_gpu13_reshape</title>
<ellipse fill="none" stroke="black" cx="113490" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="113490" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="113490" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="113490" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer1_gpu13_attn -->
<g id="node570" class="node">
<title>layer1_gpu13_attn</title>
<polygon fill="none" stroke="black" points="113249,-558 113094,-490 113249,-422 113404,-490 113249,-558"/>
<text text-anchor="middle" x="113249" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="113249" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="113249" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="113249" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer1_gpu13_out_proj -->
<g id="node571" class="node">
<title>layer1_gpu13_out_proj</title>
<polygon fill="none" stroke="black" points="113868,-524 113724,-524 113724,-456 113868,-456 113868,-524"/>
<text text-anchor="middle" x="113796" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="113796" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="113796" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="113796" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer1_gpu13_out_proj&#45;&gt;layer1_concat_group3 -->
<g id="edge123" class="edge">
<title>layer1_gpu13_out_proj&#45;&gt;layer1_concat_group3</title>
<path fill="none" stroke="black" d="M113826.26,-455.69C113840.28,-442.63 113858.03,-429.1 113877,-422 114028.78,-365.24 115177.05,-422.21 115335,-386 115347.01,-383.25 115359.26,-379.34 115371.2,-374.83"/>
<polygon fill="black" stroke="black" points="115372.67,-378.01 115380.7,-371.09 115370.11,-371.49 115372.67,-378.01"/>
</g>
<!-- layer1_gpu13_ln2 -->
<g id="node572" class="node">
<title>layer1_gpu13_ln2</title>
<ellipse fill="none" stroke="black" cx="112762" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="112762" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="112762" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="112762" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer1_gpu13_gate -->
<g id="node573" class="node">
<title>layer1_gpu13_gate</title>
<ellipse fill="none" stroke="black" cx="109743" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="109743" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="109743" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="109743" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer1_gpu13_gate&#45;&gt;layer1_expert_all2all -->
<g id="edge124" class="edge">
<title>layer1_gpu13_gate&#45;&gt;layer1_expert_all2all</title>
<path fill="none" stroke="black" d="M109712.38,-455.47C109698.19,-442.37 109680.22,-428.86 109661,-422 109442.02,-343.78 76402.29,-439.55 76176,-386 76161.1,-382.47 76145.93,-376.77 76131.66,-370.26"/>
<polygon fill="black" stroke="black" points="76132.95,-367 76122.42,-365.88 76129.95,-373.32 76132.95,-367"/>
</g>
<!-- layer1_gpu13_moe_agg -->
<g id="node574" class="node">
<title>layer1_gpu13_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="110694.5,-471.57 110694.5,-508.43 110628.6,-534.5 110535.4,-534.5 110469.5,-508.43 110469.5,-471.57 110535.4,-445.5 110628.6,-445.5 110694.5,-471.57"/>
<polygon fill="none" stroke="black" points="110698.5,-468.85 110698.5,-511.15 110629.36,-538.5 110534.64,-538.5 110465.5,-511.15 110465.5,-468.85 110534.64,-441.5 110629.36,-441.5 110698.5,-468.85"/>
<text text-anchor="middle" x="110582" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="110582" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="110582" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer2_gpu13_ln1 -->
<g id="node575" class="node">
<title>layer2_gpu13_ln1</title>
<ellipse fill="none" stroke="black" cx="112424" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="112424" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="112424" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="112424" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer2_gpu13_qkv -->
<g id="node576" class="node">
<title>layer2_gpu13_qkv</title>
<polygon fill="none" stroke="black" points="112079,-524 111949,-524 111949,-456 112079,-456 112079,-524"/>
<text text-anchor="middle" x="112014" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="112014" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="112014" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="112014" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer2_gpu13_reshape -->
<g id="node577" class="node">
<title>layer2_gpu13_reshape</title>
<ellipse fill="none" stroke="black" cx="111863" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="111863" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="111863" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="111863" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer2_gpu13_attn -->
<g id="node578" class="node">
<title>layer2_gpu13_attn</title>
<polygon fill="none" stroke="black" points="111622,-558 111467,-490 111622,-422 111777,-490 111622,-558"/>
<text text-anchor="middle" x="111622" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="111622" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="111622" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="111622" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer2_gpu13_out_proj -->
<g id="node579" class="node">
<title>layer2_gpu13_out_proj</title>
<polygon fill="none" stroke="black" points="115323,-524 115179,-524 115179,-456 115323,-456 115323,-524"/>
<text text-anchor="middle" x="115251" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="115251" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="115251" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="115251" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer2_gpu13_out_proj&#45;&gt;layer2_concat_group3 -->
<g id="edge125" class="edge">
<title>layer2_gpu13_out_proj&#45;&gt;layer2_concat_group3</title>
<path fill="none" stroke="black" d="M115323.12,-487.95C115480.17,-484.14 115863.82,-466.61 116173,-386 116186.69,-382.43 116200.78,-377.77 116214.51,-372.63"/>
<polygon fill="black" stroke="black" points="116215.88,-375.85 116223.95,-369 116213.36,-369.32 116215.88,-375.85"/>
</g>
<!-- layer2_gpu13_ln2 -->
<g id="node580" class="node">
<title>layer2_gpu13_ln2</title>
<ellipse fill="none" stroke="black" cx="111208" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="111208" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="111208" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="111208" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer2_gpu13_gate -->
<g id="node581" class="node">
<title>layer2_gpu13_gate</title>
<ellipse fill="none" stroke="black" cx="111375" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="111375" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="111375" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="111375" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer2_gpu13_gate&#45;&gt;layer2_expert_all2all -->
<g id="edge126" class="edge">
<title>layer2_gpu13_gate&#45;&gt;layer2_expert_all2all</title>
<path fill="none" stroke="black" d="M111344.38,-455.47C111330.19,-442.37 111312.22,-428.86 111293,-422 111066.38,-341.06 76874.68,-443.46 76641,-386 76627.21,-382.61 76613.22,-377.21 76600.02,-371.02"/>
<polygon fill="black" stroke="black" points="76601.53,-367.86 76591.01,-366.62 76598.46,-374.16 76601.53,-367.86"/>
</g>
<!-- layer2_gpu13_moe_agg -->
<g id="node582" class="node">
<title>layer2_gpu13_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="112326.5,-471.57 112326.5,-508.43 112260.6,-534.5 112167.4,-534.5 112101.5,-508.43 112101.5,-471.57 112167.4,-445.5 112260.6,-445.5 112326.5,-471.57"/>
<polygon fill="none" stroke="black" points="112330.5,-468.85 112330.5,-511.15 112261.36,-538.5 112166.64,-538.5 112097.5,-511.15 112097.5,-468.85 112166.64,-441.5 112261.36,-441.5 112330.5,-468.85"/>
<text text-anchor="middle" x="112214" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="112214" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="112214" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer3_gpu13_ln1 -->
<g id="node583" class="node">
<title>layer3_gpu13_ln1</title>
<ellipse fill="none" stroke="black" cx="114455" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="114455" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="114455" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="114455" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer3_gpu13_qkv -->
<g id="node584" class="node">
<title>layer3_gpu13_qkv</title>
<polygon fill="none" stroke="black" points="110447,-524 110317,-524 110317,-456 110447,-456 110447,-524"/>
<text text-anchor="middle" x="110382" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="110382" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="110382" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="110382" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer3_gpu13_reshape -->
<g id="node585" class="node">
<title>layer3_gpu13_reshape</title>
<ellipse fill="none" stroke="black" cx="110231" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="110231" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="110231" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="110231" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer3_gpu13_attn -->
<g id="node586" class="node">
<title>layer3_gpu13_attn</title>
<polygon fill="none" stroke="black" points="109990,-558 109835,-490 109990,-422 110145,-490 109990,-558"/>
<text text-anchor="middle" x="109990" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="109990" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="109990" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="109990" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer3_gpu13_out_proj -->
<g id="node587" class="node">
<title>layer3_gpu13_out_proj</title>
<polygon fill="none" stroke="black" points="114030,-524 113886,-524 113886,-456 114030,-456 114030,-524"/>
<text text-anchor="middle" x="113958" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="113958" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="113958" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="113958" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer3_gpu13_out_proj&#45;&gt;layer3_concat_group3 -->
<g id="edge127" class="edge">
<title>layer3_gpu13_out_proj&#45;&gt;layer3_concat_group3</title>
<path fill="none" stroke="black" d="M113988.25,-455.68C114002.27,-442.62 114020.02,-429.08 114039,-422 114201.55,-361.36 115430.6,-423.44 115600,-386 115613.16,-383.09 115626.63,-378.88 115639.71,-374.02"/>
<polygon fill="black" stroke="black" points="115641.09,-377.24 115649.17,-370.38 115638.58,-370.71 115641.09,-377.24"/>
</g>
<!-- layer3_gpu13_ln2 -->
<g id="node588" class="node">
<title>layer3_gpu13_ln2</title>
<ellipse fill="none" stroke="black" cx="109576" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="109576" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="109576" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="109576" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer3_gpu13_gate -->
<g id="node589" class="node">
<title>layer3_gpu13_gate</title>
<ellipse fill="none" stroke="black" cx="109409" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="109409" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="109409" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="109409" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- layer3_gpu13_gate&#45;&gt;layer3_expert_all2all -->
<g id="edge128" class="edge">
<title>layer3_gpu13_gate&#45;&gt;layer3_expert_all2all</title>
<path fill="none" stroke="black" d="M109378.38,-455.47C109364.19,-442.37 109346.22,-428.86 109327,-422 109108.66,-344.01 76166.62,-439.39 75941,-386 75926.1,-382.47 75910.93,-376.77 75896.66,-370.26"/>
<polygon fill="black" stroke="black" points="75897.95,-367 75887.42,-365.88 75894.95,-373.32 75897.95,-367"/>
</g>
<!-- layer3_gpu13_moe_agg -->
<g id="node590" class="node">
<title>layer3_gpu13_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="109313.5,-471.57 109313.5,-508.43 109247.6,-534.5 109154.4,-534.5 109088.5,-508.43 109088.5,-471.57 109154.4,-445.5 109247.6,-445.5 109313.5,-471.57"/>
<polygon fill="none" stroke="black" points="109317.5,-468.85 109317.5,-511.15 109248.36,-538.5 109153.64,-538.5 109084.5,-511.15 109084.5,-468.85 109153.64,-441.5 109248.36,-441.5 109317.5,-468.85"/>
<text text-anchor="middle" x="109201" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="109201" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="109201" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- embed_14 -->
<g id="node591" class="node">
<title>embed_14</title>
<polygon fill="none" stroke="black" points="122695,-516.5 122475,-516.5 122475,-463.5 122695,-463.5 122695,-516.5"/>
<text text-anchor="middle" x="122585" y="-501.3" font-family="Times,serif" font-size="14.00">Input Embedding</text>
<text text-anchor="middle" x="122585" y="-486.3" font-family="Times,serif" font-size="14.00">[B=1024, L=2048, D=8192]</text>
<text text-anchor="middle" x="122585" y="-471.3" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer0_gpu14_ln1 -->
<g id="node592" class="node">
<title>layer0_gpu14_ln1</title>
<ellipse fill="none" stroke="black" cx="122585" cy="-326" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="122585" y="-337.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="122585" y="-322.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="122585" y="-307.3" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- embed_14&#45;&gt;layer0_gpu14_ln1 -->
<g id="edge15" class="edge">
<title>embed_14&#45;&gt;layer0_gpu14_ln1</title>
<path fill="none" stroke="black" d="M122585,-463.33C122585,-439.41 122585,-403.17 122585,-374.06"/>
<polygon fill="black" stroke="black" points="122588.5,-373.69 122585,-363.69 122581.5,-373.69 122588.5,-373.69"/>
</g>
<!-- layer0_gpu14_qkv -->
<g id="node593" class="node">
<title>layer0_gpu14_qkv</title>
<polygon fill="none" stroke="black" points="122457,-524 122327,-524 122327,-456 122457,-456 122457,-524"/>
<text text-anchor="middle" x="122392" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="122392" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="122392" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="122392" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer0_gpu14_reshape -->
<g id="node594" class="node">
<title>layer0_gpu14_reshape</title>
<ellipse fill="none" stroke="black" cx="122241" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="122241" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="122241" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="122241" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer0_gpu14_attn -->
<g id="node595" class="node">
<title>layer0_gpu14_attn</title>
<polygon fill="none" stroke="black" points="122000,-558 121845,-490 122000,-422 122155,-490 122000,-558"/>
<text text-anchor="middle" x="122000" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="122000" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="122000" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="122000" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer0_gpu14_out_proj -->
<g id="node596" class="node">
<title>layer0_gpu14_out_proj</title>
<polygon fill="none" stroke="black" points="120358,-524 120214,-524 120214,-456 120358,-456 120358,-524"/>
<text text-anchor="middle" x="120286" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="120286" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="120286" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="120286" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer0_gpu14_out_proj&#45;&gt;layer0_concat_group3 -->
<g id="edge129" class="edge">
<title>layer0_gpu14_out_proj&#45;&gt;layer0_concat_group3</title>
<path fill="none" stroke="black" d="M120256.17,-455.9C120242.1,-442.71 120224.2,-429.01 120205,-422 119994.83,-345.28 116398.55,-423.59 116178,-386 116155.79,-382.22 116132.6,-375.99 116110.67,-368.97"/>
<polygon fill="black" stroke="black" points="116111.62,-365.6 116101.02,-365.81 116109.44,-372.25 116111.62,-365.6"/>
</g>
<!-- layer0_gpu14_ln2 -->
<g id="node597" class="node">
<title>layer0_gpu14_ln2</title>
<ellipse fill="none" stroke="black" cx="121582" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="121582" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="121582" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="121582" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer0_gpu14_gate -->
<g id="node598" class="node">
<title>layer0_gpu14_gate</title>
<ellipse fill="none" stroke="black" cx="118161" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="118161" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="118161" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="118161" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer0_gpu14_gate&#45;&gt;layer0_expert_all2all -->
<g id="edge130" class="edge">
<title>layer0_gpu14_gate&#45;&gt;layer0_expert_all2all</title>
<path fill="none" stroke="black" d="M118130.38,-455.47C118116.19,-442.37 118098.22,-428.86 118079,-422 117942.75,-373.35 76551.8,-419.3 76411,-386 76396.1,-382.48 76380.93,-376.77 76366.66,-370.26"/>
<polygon fill="black" stroke="black" points="76367.95,-367 76357.41,-365.88 76364.95,-373.32 76367.95,-367"/>
</g>
<!-- layer0_gpu14_moe_agg -->
<g id="node599" class="node">
<title>layer0_gpu14_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="118481.5,-471.57 118481.5,-508.43 118415.6,-534.5 118322.4,-534.5 118256.5,-508.43 118256.5,-471.57 118322.4,-445.5 118415.6,-445.5 118481.5,-471.57"/>
<polygon fill="none" stroke="black" points="118485.5,-468.85 118485.5,-511.15 118416.36,-538.5 118321.64,-538.5 118252.5,-511.15 118252.5,-468.85 118321.64,-441.5 118416.36,-441.5 118485.5,-468.85"/>
<text text-anchor="middle" x="118369" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="118369" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="118369" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer1_gpu14_ln1 -->
<g id="node600" class="node">
<title>layer1_gpu14_ln1</title>
<ellipse fill="none" stroke="black" cx="121413" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="121413" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="121413" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="121413" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer1_gpu14_qkv -->
<g id="node601" class="node">
<title>layer1_gpu14_qkv</title>
<polygon fill="none" stroke="black" points="120988,-524 120858,-524 120858,-456 120988,-456 120988,-524"/>
<text text-anchor="middle" x="120923" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="120923" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="120923" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="120923" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer1_gpu14_reshape -->
<g id="node602" class="node">
<title>layer1_gpu14_reshape</title>
<ellipse fill="none" stroke="black" cx="120772" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="120772" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="120772" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="120772" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer1_gpu14_attn -->
<g id="node603" class="node">
<title>layer1_gpu14_attn</title>
<polygon fill="none" stroke="black" points="120531,-558 120376,-490 120531,-422 120686,-490 120531,-558"/>
<text text-anchor="middle" x="120531" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="120531" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="120531" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="120531" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer1_gpu14_out_proj -->
<g id="node604" class="node">
<title>layer1_gpu14_out_proj</title>
<polygon fill="none" stroke="black" points="119864,-524 119720,-524 119720,-456 119864,-456 119864,-524"/>
<text text-anchor="middle" x="119792" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="119792" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="119792" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="119792" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer1_gpu14_out_proj&#45;&gt;layer1_concat_group3 -->
<g id="edge131" class="edge">
<title>layer1_gpu14_out_proj&#45;&gt;layer1_concat_group3</title>
<path fill="none" stroke="black" d="M119762.17,-455.9C119748.11,-442.71 119730.2,-429.01 119711,-422 119496.44,-343.7 115823.36,-433.7 115600,-386 115586.72,-383.16 115573.13,-378.96 115559.95,-374.09"/>
<polygon fill="black" stroke="black" points="115561.02,-370.75 115550.43,-370.43 115558.5,-377.29 115561.02,-370.75"/>
</g>
<!-- layer1_gpu14_ln2 -->
<g id="node605" class="node">
<title>layer1_gpu14_ln2</title>
<ellipse fill="none" stroke="black" cx="120120" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="120120" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="120120" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="120120" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer1_gpu14_gate -->
<g id="node606" class="node">
<title>layer1_gpu14_gate</title>
<ellipse fill="none" stroke="black" cx="117114" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="117114" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="117114" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="117114" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer1_gpu14_gate&#45;&gt;layer1_expert_all2all -->
<g id="edge132" class="edge">
<title>layer1_gpu14_gate&#45;&gt;layer1_expert_all2all</title>
<path fill="none" stroke="black" d="M117083.38,-455.47C117069.19,-442.37 117051.22,-428.86 117032,-422 116898.4,-374.29 76314.05,-418.65 76176,-386 76161.1,-382.48 76145.93,-376.77 76131.66,-370.26"/>
<polygon fill="black" stroke="black" points="76132.95,-367 76122.41,-365.88 76129.95,-373.32 76132.95,-367"/>
</g>
<!-- layer1_gpu14_moe_agg -->
<g id="node607" class="node">
<title>layer1_gpu14_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="118065.5,-471.57 118065.5,-508.43 117999.6,-534.5 117906.4,-534.5 117840.5,-508.43 117840.5,-471.57 117906.4,-445.5 117999.6,-445.5 118065.5,-471.57"/>
<polygon fill="none" stroke="black" points="118069.5,-468.85 118069.5,-511.15 118000.36,-538.5 117905.64,-538.5 117836.5,-511.15 117836.5,-468.85 117905.64,-441.5 118000.36,-441.5 118069.5,-468.85"/>
<text text-anchor="middle" x="117953" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="117953" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="117953" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer2_gpu14_ln1 -->
<g id="node608" class="node">
<title>layer2_gpu14_ln1</title>
<ellipse fill="none" stroke="black" cx="121244" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="121244" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="121244" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="121244" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer2_gpu14_qkv -->
<g id="node609" class="node">
<title>layer2_gpu14_qkv</title>
<polygon fill="none" stroke="black" points="119450,-524 119320,-524 119320,-456 119450,-456 119450,-524"/>
<text text-anchor="middle" x="119385" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="119385" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="119385" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="119385" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer2_gpu14_reshape -->
<g id="node610" class="node">
<title>layer2_gpu14_reshape</title>
<ellipse fill="none" stroke="black" cx="119234" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="119234" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="119234" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="119234" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer2_gpu14_attn -->
<g id="node611" class="node">
<title>layer2_gpu14_attn</title>
<polygon fill="none" stroke="black" points="118993,-558 118838,-490 118993,-422 119148,-490 118993,-558"/>
<text text-anchor="middle" x="118993" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="118993" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="118993" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="118993" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer2_gpu14_out_proj -->
<g id="node612" class="node">
<title>layer2_gpu14_out_proj</title>
<polygon fill="none" stroke="black" points="121150,-524 121006,-524 121006,-456 121150,-456 121150,-524"/>
<text text-anchor="middle" x="121078" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="121078" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="121078" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="121078" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer2_gpu14_out_proj&#45;&gt;layer2_concat_group3 -->
<g id="edge133" class="edge">
<title>layer2_gpu14_out_proj&#45;&gt;layer2_concat_group3</title>
<path fill="none" stroke="black" d="M121048.17,-455.9C121034.11,-442.7 121016.2,-429 120997,-422 120759.29,-335.36 116690.08,-440.47 116443,-386 116430.87,-383.33 116418.51,-379.44 116406.47,-374.92"/>
<polygon fill="black" stroke="black" points="116407.49,-371.55 116396.9,-371.16 116404.93,-378.07 116407.49,-371.55"/>
</g>
<!-- layer2_gpu14_ln2 -->
<g id="node613" class="node">
<title>layer2_gpu14_ln2</title>
<ellipse fill="none" stroke="black" cx="118579" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="118579" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="118579" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="118579" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer2_gpu14_gate -->
<g id="node614" class="node">
<title>layer2_gpu14_gate</title>
<ellipse fill="none" stroke="black" cx="118746" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="118746" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="118746" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="118746" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer2_gpu14_gate&#45;&gt;layer2_expert_all2all -->
<g id="edge134" class="edge">
<title>layer2_gpu14_gate&#45;&gt;layer2_expert_all2all</title>
<path fill="none" stroke="black" d="M118715.38,-455.47C118701.19,-442.37 118683.22,-428.86 118664,-422 118526.58,-372.93 76782.7,-420.83 76641,-386 76627.21,-382.61 76613.22,-377.21 76600.02,-371.02"/>
<polygon fill="black" stroke="black" points="76601.53,-367.87 76591.01,-366.63 76598.46,-374.16 76601.53,-367.87"/>
</g>
<!-- layer2_gpu14_moe_agg -->
<g id="node615" class="node">
<title>layer2_gpu14_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="119697.5,-471.57 119697.5,-508.43 119631.6,-534.5 119538.4,-534.5 119472.5,-508.43 119472.5,-471.57 119538.4,-445.5 119631.6,-445.5 119697.5,-471.57"/>
<polygon fill="none" stroke="black" points="119701.5,-468.85 119701.5,-511.15 119632.36,-538.5 119537.64,-538.5 119468.5,-511.15 119468.5,-468.85 119537.64,-441.5 119632.36,-441.5 119701.5,-468.85"/>
<text text-anchor="middle" x="119585" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="119585" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="119585" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer3_gpu14_ln1 -->
<g id="node616" class="node">
<title>layer3_gpu14_ln1</title>
<ellipse fill="none" stroke="black" cx="121751" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="121751" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="121751" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="121751" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer3_gpu14_qkv -->
<g id="node617" class="node">
<title>layer3_gpu14_qkv</title>
<polygon fill="none" stroke="black" points="117818,-524 117688,-524 117688,-456 117818,-456 117818,-524"/>
<text text-anchor="middle" x="117753" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="117753" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="117753" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="117753" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer3_gpu14_reshape -->
<g id="node618" class="node">
<title>layer3_gpu14_reshape</title>
<ellipse fill="none" stroke="black" cx="117602" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="117602" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="117602" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="117602" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer3_gpu14_attn -->
<g id="node619" class="node">
<title>layer3_gpu14_attn</title>
<polygon fill="none" stroke="black" points="117361,-558 117206,-490 117361,-422 117516,-490 117361,-558"/>
<text text-anchor="middle" x="117361" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="117361" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="117361" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="117361" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer3_gpu14_out_proj -->
<g id="node620" class="node">
<title>layer3_gpu14_out_proj</title>
<polygon fill="none" stroke="black" points="120026,-524 119882,-524 119882,-456 120026,-456 120026,-524"/>
<text text-anchor="middle" x="119954" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="119954" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="119954" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="119954" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer3_gpu14_out_proj&#45;&gt;layer3_concat_group3 -->
<g id="edge135" class="edge">
<title>layer3_gpu14_out_proj&#45;&gt;layer3_concat_group3</title>
<path fill="none" stroke="black" d="M119924.17,-455.91C119910.1,-442.71 119892.2,-429.01 119873,-422 119664.09,-345.73 116087.49,-432.47 115870,-386 115856.72,-383.16 115843.13,-378.96 115829.95,-374.09"/>
<polygon fill="black" stroke="black" points="115831.02,-370.75 115820.43,-370.43 115828.51,-377.28 115831.02,-370.75"/>
</g>
<!-- layer3_gpu14_ln2 -->
<g id="node621" class="node">
<title>layer3_gpu14_ln2</title>
<ellipse fill="none" stroke="black" cx="116947" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="116947" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="116947" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="116947" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer3_gpu14_gate -->
<g id="node622" class="node">
<title>layer3_gpu14_gate</title>
<ellipse fill="none" stroke="black" cx="116780" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="116780" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="116780" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="116780" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- layer3_gpu14_gate&#45;&gt;layer3_expert_all2all -->
<g id="edge136" class="edge">
<title>layer3_gpu14_gate&#45;&gt;layer3_expert_all2all</title>
<path fill="none" stroke="black" d="M116749.38,-455.47C116735.19,-442.37 116717.22,-428.86 116698,-422 116564.72,-374.41 76078.72,-418.57 75941,-386 75926.1,-382.48 75910.93,-376.77 75896.66,-370.26"/>
<polygon fill="black" stroke="black" points="75897.95,-367 75887.41,-365.88 75894.95,-373.32 75897.95,-367"/>
</g>
<!-- layer3_gpu14_moe_agg -->
<g id="node623" class="node">
<title>layer3_gpu14_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="116684.5,-471.57 116684.5,-508.43 116618.6,-534.5 116525.4,-534.5 116459.5,-508.43 116459.5,-471.57 116525.4,-445.5 116618.6,-445.5 116684.5,-471.57"/>
<polygon fill="none" stroke="black" points="116688.5,-468.85 116688.5,-511.15 116619.36,-538.5 116524.64,-538.5 116455.5,-511.15 116455.5,-468.85 116524.64,-441.5 116619.36,-441.5 116688.5,-468.85"/>
<text text-anchor="middle" x="116572" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="116572" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="116572" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- embed_15 -->
<g id="node624" class="node">
<title>embed_15</title>
<polygon fill="none" stroke="black" points="128959,-516.5 128739,-516.5 128739,-463.5 128959,-463.5 128959,-516.5"/>
<text text-anchor="middle" x="128849" y="-501.3" font-family="Times,serif" font-size="14.00">Input Embedding</text>
<text text-anchor="middle" x="128849" y="-486.3" font-family="Times,serif" font-size="14.00">[B=1024, L=2048, D=8192]</text>
<text text-anchor="middle" x="128849" y="-471.3" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer0_gpu15_ln1 -->
<g id="node625" class="node">
<title>layer0_gpu15_ln1</title>
<ellipse fill="none" stroke="black" cx="128849" cy="-326" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="128849" y="-337.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="128849" y="-322.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="128849" y="-307.3" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- embed_15&#45;&gt;layer0_gpu15_ln1 -->
<g id="edge16" class="edge">
<title>embed_15&#45;&gt;layer0_gpu15_ln1</title>
<path fill="none" stroke="black" d="M128849,-463.33C128849,-439.41 128849,-403.17 128849,-374.06"/>
<polygon fill="black" stroke="black" points="128852.5,-373.69 128849,-363.69 128845.5,-373.69 128852.5,-373.69"/>
</g>
<!-- layer0_gpu15_qkv -->
<g id="node626" class="node">
<title>layer0_gpu15_qkv</title>
<polygon fill="none" stroke="black" points="128721,-524 128591,-524 128591,-456 128721,-456 128721,-524"/>
<text text-anchor="middle" x="128656" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="128656" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="128656" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="128656" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer0_gpu15_reshape -->
<g id="node627" class="node">
<title>layer0_gpu15_reshape</title>
<ellipse fill="none" stroke="black" cx="128505" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="128505" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="128505" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="128505" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer0_gpu15_attn -->
<g id="node628" class="node">
<title>layer0_gpu15_attn</title>
<polygon fill="none" stroke="black" points="128264,-558 128109,-490 128264,-422 128419,-490 128264,-558"/>
<text text-anchor="middle" x="128264" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="128264" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="128264" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="128264" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer0_gpu15_out_proj -->
<g id="node629" class="node">
<title>layer0_gpu15_out_proj</title>
<polygon fill="none" stroke="black" points="126622,-524 126478,-524 126478,-456 126622,-456 126622,-524"/>
<text text-anchor="middle" x="126550" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="126550" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="126550" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="126550" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer0_gpu15_out_proj&#45;&gt;layer0_concat_group3 -->
<g id="edge137" class="edge">
<title>layer0_gpu15_out_proj&#45;&gt;layer0_concat_group3</title>
<path fill="none" stroke="black" d="M126520.19,-455.85C126506.13,-442.65 126488.22,-428.96 126469,-422 126334.6,-373.35 116318.96,-409.63 116178,-386 116155.64,-382.25 116132.3,-376 116110.25,-368.94"/>
<polygon fill="black" stroke="black" points="116111.15,-365.55 116100.55,-365.76 116108.96,-372.2 116111.15,-365.55"/>
</g>
<!-- layer0_gpu15_ln2 -->
<g id="node630" class="node">
<title>layer0_gpu15_ln2</title>
<ellipse fill="none" stroke="black" cx="127846" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="127846" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="127846" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="127846" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer0_gpu15_gate -->
<g id="node631" class="node">
<title>layer0_gpu15_gate</title>
<ellipse fill="none" stroke="black" cx="124425" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="124425" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="124425" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="124425" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer0_gpu15_gate&#45;&gt;layer0_expert_all2all -->
<g id="edge138" class="edge">
<title>layer0_gpu15_gate&#45;&gt;layer0_expert_all2all</title>
<path fill="none" stroke="black" d="M124394.38,-455.47C124380.19,-442.37 124362.22,-428.86 124343,-422 124186.26,-366.04 76572.96,-424.3 76411,-386 76396.1,-382.48 76380.93,-376.77 76366.66,-370.26"/>
<polygon fill="black" stroke="black" points="76367.95,-367 76357.41,-365.88 76364.95,-373.33 76367.95,-367"/>
</g>
<!-- layer0_gpu15_moe_agg -->
<g id="node632" class="node">
<title>layer0_gpu15_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="124745.5,-471.57 124745.5,-508.43 124679.6,-534.5 124586.4,-534.5 124520.5,-508.43 124520.5,-471.57 124586.4,-445.5 124679.6,-445.5 124745.5,-471.57"/>
<polygon fill="none" stroke="black" points="124749.5,-468.85 124749.5,-511.15 124680.36,-538.5 124585.64,-538.5 124516.5,-511.15 124516.5,-468.85 124585.64,-441.5 124680.36,-441.5 124749.5,-468.85"/>
<text text-anchor="middle" x="124633" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="124633" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="124633" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer1_gpu15_ln1 -->
<g id="node633" class="node">
<title>layer1_gpu15_ln1</title>
<ellipse fill="none" stroke="black" cx="127677" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="127677" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="127677" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="127677" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer1_gpu15_qkv -->
<g id="node634" class="node">
<title>layer1_gpu15_qkv</title>
<polygon fill="none" stroke="black" points="127252,-524 127122,-524 127122,-456 127252,-456 127252,-524"/>
<text text-anchor="middle" x="127187" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="127187" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="127187" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="127187" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer1_gpu15_reshape -->
<g id="node635" class="node">
<title>layer1_gpu15_reshape</title>
<ellipse fill="none" stroke="black" cx="127036" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="127036" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="127036" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="127036" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer1_gpu15_attn -->
<g id="node636" class="node">
<title>layer1_gpu15_attn</title>
<polygon fill="none" stroke="black" points="126795,-558 126640,-490 126795,-422 126950,-490 126795,-558"/>
<text text-anchor="middle" x="126795" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="126795" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="126795" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="126795" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer1_gpu15_out_proj -->
<g id="node637" class="node">
<title>layer1_gpu15_out_proj</title>
<polygon fill="none" stroke="black" points="126128,-524 125984,-524 125984,-456 126128,-456 126128,-524"/>
<text text-anchor="middle" x="126056" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="126056" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="126056" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="126056" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer1_gpu15_out_proj&#45;&gt;layer1_concat_group3 -->
<g id="edge139" class="edge">
<title>layer1_gpu15_out_proj&#45;&gt;layer1_concat_group3</title>
<path fill="none" stroke="black" d="M126026.19,-455.85C126012.13,-442.65 125994.22,-428.96 125975,-422 125839.5,-372.96 115741,-415.72 115600,-386 115586.71,-383.2 115573.12,-379.02 115559.93,-374.16"/>
<polygon fill="black" stroke="black" points="115561,-370.82 115550.41,-370.5 115558.49,-377.35 115561,-370.82"/>
</g>
<!-- layer1_gpu15_ln2 -->
<g id="node638" class="node">
<title>layer1_gpu15_ln2</title>
<ellipse fill="none" stroke="black" cx="126384" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="126384" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="126384" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="126384" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer1_gpu15_gate -->
<g id="node639" class="node">
<title>layer1_gpu15_gate</title>
<ellipse fill="none" stroke="black" cx="123378" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="123378" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="123378" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="123378" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer1_gpu15_gate&#45;&gt;layer1_expert_all2all -->
<g id="edge140" class="edge">
<title>layer1_gpu15_gate&#45;&gt;layer1_expert_all2all</title>
<path fill="none" stroke="black" d="M123347.38,-455.47C123333.19,-442.37 123315.22,-428.86 123296,-422 123141.91,-366.99 76335.22,-423.65 76176,-386 76161.1,-382.48 76145.93,-376.77 76131.66,-370.26"/>
<polygon fill="black" stroke="black" points="76132.95,-367 76122.41,-365.88 76129.95,-373.33 76132.95,-367"/>
</g>
<!-- layer1_gpu15_moe_agg -->
<g id="node640" class="node">
<title>layer1_gpu15_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="124329.5,-471.57 124329.5,-508.43 124263.6,-534.5 124170.4,-534.5 124104.5,-508.43 124104.5,-471.57 124170.4,-445.5 124263.6,-445.5 124329.5,-471.57"/>
<polygon fill="none" stroke="black" points="124333.5,-468.85 124333.5,-511.15 124264.36,-538.5 124169.64,-538.5 124100.5,-511.15 124100.5,-468.85 124169.64,-441.5 124264.36,-441.5 124333.5,-468.85"/>
<text text-anchor="middle" x="124217" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="124217" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="124217" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer2_gpu15_ln1 -->
<g id="node641" class="node">
<title>layer2_gpu15_ln1</title>
<ellipse fill="none" stroke="black" cx="127508" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="127508" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="127508" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="127508" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer2_gpu15_qkv -->
<g id="node642" class="node">
<title>layer2_gpu15_qkv</title>
<polygon fill="none" stroke="black" points="125714,-524 125584,-524 125584,-456 125714,-456 125714,-524"/>
<text text-anchor="middle" x="125649" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="125649" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="125649" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="125649" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer2_gpu15_reshape -->
<g id="node643" class="node">
<title>layer2_gpu15_reshape</title>
<ellipse fill="none" stroke="black" cx="125498" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="125498" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="125498" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="125498" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer2_gpu15_attn -->
<g id="node644" class="node">
<title>layer2_gpu15_attn</title>
<polygon fill="none" stroke="black" points="125257,-558 125102,-490 125257,-422 125412,-490 125257,-558"/>
<text text-anchor="middle" x="125257" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="125257" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="125257" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="125257" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer2_gpu15_out_proj -->
<g id="node645" class="node">
<title>layer2_gpu15_out_proj</title>
<polygon fill="none" stroke="black" points="127414,-524 127270,-524 127270,-456 127414,-456 127414,-524"/>
<text text-anchor="middle" x="127342" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="127342" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="127342" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="127342" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer2_gpu15_out_proj&#45;&gt;layer2_concat_group3 -->
<g id="edge141" class="edge">
<title>layer2_gpu15_out_proj&#45;&gt;layer2_concat_group3</title>
<path fill="none" stroke="black" d="M127312.19,-455.85C127298.13,-442.65 127280.22,-428.96 127261,-422 127119.72,-370.87 116589.8,-418.01 116443,-386 116430.87,-383.35 116418.5,-379.48 116406.46,-374.97"/>
<polygon fill="black" stroke="black" points="116407.48,-371.61 116396.89,-371.22 116404.92,-378.13 116407.48,-371.61"/>
</g>
<!-- layer2_gpu15_ln2 -->
<g id="node646" class="node">
<title>layer2_gpu15_ln2</title>
<ellipse fill="none" stroke="black" cx="124843" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="124843" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="124843" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="124843" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer2_gpu15_gate -->
<g id="node647" class="node">
<title>layer2_gpu15_gate</title>
<ellipse fill="none" stroke="black" cx="125010" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="125010" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="125010" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="125010" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer2_gpu15_gate&#45;&gt;layer2_expert_all2all -->
<g id="edge142" class="edge">
<title>layer2_gpu15_gate&#45;&gt;layer2_expert_all2all</title>
<path fill="none" stroke="black" d="M124979.38,-455.47C124965.19,-442.37 124947.22,-428.86 124928,-422 124770.1,-365.63 76803.82,-426.01 76641,-386 76627.2,-382.61 76613.22,-377.21 76600.02,-371.02"/>
<polygon fill="black" stroke="black" points="76601.53,-367.87 76591.01,-366.63 76598.46,-374.16 76601.53,-367.87"/>
</g>
<!-- layer2_gpu15_moe_agg -->
<g id="node648" class="node">
<title>layer2_gpu15_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="125961.5,-471.57 125961.5,-508.43 125895.6,-534.5 125802.4,-534.5 125736.5,-508.43 125736.5,-471.57 125802.4,-445.5 125895.6,-445.5 125961.5,-471.57"/>
<polygon fill="none" stroke="black" points="125965.5,-468.85 125965.5,-511.15 125896.36,-538.5 125801.64,-538.5 125732.5,-511.15 125732.5,-468.85 125801.64,-441.5 125896.36,-441.5 125965.5,-468.85"/>
<text text-anchor="middle" x="125849" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="125849" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="125849" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer3_gpu15_ln1 -->
<g id="node649" class="node">
<title>layer3_gpu15_ln1</title>
<ellipse fill="none" stroke="black" cx="128015" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="128015" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm1</text>
<text text-anchor="middle" x="128015" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="128015" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer3_gpu15_qkv -->
<g id="node650" class="node">
<title>layer3_gpu15_qkv</title>
<polygon fill="none" stroke="black" points="124082,-524 123952,-524 123952,-456 124082,-456 124082,-524"/>
<text text-anchor="middle" x="124017" y="-508.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="124017" y="-493.8" font-family="Times,serif" font-size="14.00">Column Parallel</text>
<text text-anchor="middle" x="124017" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,3*4*128]</text>
<text text-anchor="middle" x="124017" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer3_gpu15_reshape -->
<g id="node651" class="node">
<title>layer3_gpu15_reshape</title>
<ellipse fill="none" stroke="black" cx="123866" cy="-490" rx="68" ry="37.5"/>
<text text-anchor="middle" x="123866" y="-501.3" font-family="Times,serif" font-size="14.00">Reshape</text>
<text text-anchor="middle" x="123866" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="123866" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer3_gpu15_attn -->
<g id="node652" class="node">
<title>layer3_gpu15_attn</title>
<polygon fill="none" stroke="black" points="123625,-558 123470,-490 123625,-422 123780,-490 123625,-558"/>
<text text-anchor="middle" x="123625" y="-508.8" font-family="Times,serif" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="123625" y="-493.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="123625" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4,128]</text>
<text text-anchor="middle" x="123625" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer3_gpu15_out_proj -->
<g id="node653" class="node">
<title>layer3_gpu15_out_proj</title>
<polygon fill="none" stroke="black" points="126290,-524 126146,-524 126146,-456 126290,-456 126290,-524"/>
<text text-anchor="middle" x="126218" y="-508.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="126218" y="-493.8" font-family="Times,serif" font-size="14.00">Row Parallel</text>
<text text-anchor="middle" x="126218" y="-478.8" font-family="Times,serif" font-size="14.00">[B,L,4*128]</text>
<text text-anchor="middle" x="126218" y="-463.8" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer3_gpu15_out_proj&#45;&gt;layer3_concat_group3 -->
<g id="edge143" class="edge">
<title>layer3_gpu15_out_proj&#45;&gt;layer3_concat_group3</title>
<path fill="none" stroke="black" d="M126188.19,-455.85C126174.13,-442.65 126156.22,-428.96 126137,-422 126002.92,-373.47 116009.53,-415.41 115870,-386 115856.71,-383.2 115843.12,-379.02 115829.93,-374.16"/>
<polygon fill="black" stroke="black" points="115831,-370.82 115820.41,-370.5 115828.49,-377.35 115831,-370.82"/>
</g>
<!-- layer3_gpu15_ln2 -->
<g id="node654" class="node">
<title>layer3_gpu15_ln2</title>
<ellipse fill="none" stroke="black" cx="123211" cy="-490" rx="75.73" ry="37.5"/>
<text text-anchor="middle" x="123211" y="-501.3" font-family="Times,serif" font-size="14.00">LayerNorm2</text>
<text text-anchor="middle" x="123211" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,D]</text>
<text text-anchor="middle" x="123211" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer3_gpu15_gate -->
<g id="node655" class="node">
<title>layer3_gpu15_gate</title>
<ellipse fill="none" stroke="black" cx="123044" cy="-490" rx="73.5" ry="37.5"/>
<text text-anchor="middle" x="123044" y="-501.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="123044" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8]</text>
<text text-anchor="middle" x="123044" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer3_gpu15_gate&#45;&gt;layer3_expert_all2all -->
<g id="edge144" class="edge">
<title>layer3_gpu15_gate&#45;&gt;layer3_expert_all2all</title>
<path fill="none" stroke="black" d="M123013.38,-455.47C122999.19,-442.37 122981.22,-428.86 122962,-422 122808.24,-367.1 76099.89,-423.57 75941,-386 75926.1,-382.48 75910.93,-376.77 75896.66,-370.26"/>
<polygon fill="black" stroke="black" points="75897.95,-367 75887.41,-365.88 75894.95,-373.33 75897.95,-367"/>
</g>
<!-- layer3_gpu15_moe_agg -->
<g id="node656" class="node">
<title>layer3_gpu15_moe_agg</title>
<polygon fill="lightgreen" stroke="black" points="122948.5,-471.57 122948.5,-508.43 122882.6,-534.5 122789.4,-534.5 122723.5,-508.43 122723.5,-471.57 122789.4,-445.5 122882.6,-445.5 122948.5,-471.57"/>
<polygon fill="none" stroke="black" points="122952.5,-468.85 122952.5,-511.15 122883.36,-538.5 122788.64,-538.5 122719.5,-511.15 122719.5,-468.85 122788.64,-441.5 122883.36,-441.5 122952.5,-468.85"/>
<text text-anchor="middle" x="122836" y="-501.3" font-family="Times,serif" font-size="14.00">MoE Aggregation</text>
<text text-anchor="middle" x="122836" y="-486.3" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="122836" y="-471.3" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- layer0_final_concat -->
<g id="node677" class="node">
<title>layer0_final_concat</title>
<polygon fill="orange" stroke="black" points="76610.5,-163.07 76610.5,-199.93 76534.64,-226 76427.36,-226 76351.5,-199.93 76351.5,-163.07 76427.36,-137 76534.64,-137 76610.5,-163.07"/>
<polygon fill="none" stroke="black" points="76614.5,-160.21 76614.5,-202.79 76535.31,-230 76426.69,-230 76347.5,-202.79 76347.5,-160.21 76426.69,-133 76535.31,-133 76614.5,-160.21"/>
<text text-anchor="middle" x="76481" y="-192.8" font-family="Times,serif" font-size="14.00">Concat Head Groups</text>
<text text-anchor="middle" x="76481" y="-177.8" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="76481" y="-162.8" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer0_concat_group0&#45;&gt;layer0_final_concat -->
<g id="edge145" class="edge">
<title>layer0_concat_group0&#45;&gt;layer0_final_concat</title>
<path fill="none" stroke="black" d="M24945.99,-286.65C24971.9,-278.13 25000.16,-270.34 25027,-266 25377.87,-209.24 75854.91,-260.81 76209,-230 76255.95,-225.91 76306.96,-217.96 76351.98,-209.71"/>
<polygon fill="black" stroke="black" points="76352.89,-213.1 76362.09,-207.84 76351.62,-206.22 76352.89,-213.1"/>
</g>
<!-- layer0_expert_all2all&#45;&gt;layer0_gpu0_moe_agg -->
<g id="edge225" class="edge">
<title>layer0_expert_all2all&#45;&gt;layer0_gpu0_moe_agg</title>
<path fill="none" stroke="black" d="M76228.86,-366.03C76212.22,-374.26 76193.93,-381.73 76176,-386 75805.55,-474.25 21708.47,-329.75 21339,-422 21320.85,-426.53 21302.44,-434.22 21285.51,-442.81"/>
<polygon fill="black" stroke="black" points="21283.5,-439.91 21276.27,-447.66 21286.75,-446.11 21283.5,-439.91"/>
</g>
<!-- layer0_expert_all2all&#45;&gt;layer0_gpu1_moe_agg -->
<g id="edge226" class="edge">
<title>layer0_expert_all2all&#45;&gt;layer0_gpu1_moe_agg</title>
<path fill="none" stroke="black" d="M76228.86,-366.03C76212.22,-374.26 76193.93,-381.73 76176,-386 75949.95,-439.84 9477.46,-365.72 9252,-422 9233.85,-426.53 9215.44,-434.22 9198.51,-442.81"/>
<polygon fill="black" stroke="black" points="9196.49,-439.91 9189.27,-447.66 9199.75,-446.11 9196.49,-439.91"/>
</g>
<!-- layer0_expert_all2all&#45;&gt;layer0_gpu2_moe_agg -->
<g id="edge227" class="edge">
<title>layer0_expert_all2all&#45;&gt;layer0_gpu2_moe_agg</title>
<path fill="none" stroke="black" d="M76228.86,-366.03C76212.22,-374.25 76193.92,-381.73 76176,-386 75894.97,-452.98 34854.29,-351.98 34574,-422 34555.85,-426.53 34537.44,-434.22 34520.51,-442.81"/>
<polygon fill="black" stroke="black" points="34518.5,-439.92 34511.27,-447.66 34521.75,-446.11 34518.5,-439.92"/>
</g>
<!-- layer0_expert_all2all&#45;&gt;layer0_gpu3_moe_agg -->
<g id="edge228" class="edge">
<title>layer0_expert_all2all&#45;&gt;layer0_gpu3_moe_agg</title>
<path fill="none" stroke="black" d="M76228.85,-366.02C76212.22,-374.25 76193.92,-381.72 76176,-386 75777.28,-481.1 47060.67,-322.59 46663,-422 46644.85,-426.54 46626.44,-434.23 46609.51,-442.82"/>
<polygon fill="black" stroke="black" points="46607.5,-439.92 46600.27,-447.67 46610.75,-446.12 46607.5,-439.92"/>
</g>
<!-- layer0_expert_all2all&#45;&gt;layer0_gpu4_moe_agg -->
<g id="edge229" class="edge">
<title>layer0_expert_all2all&#45;&gt;layer0_gpu4_moe_agg</title>
<path fill="none" stroke="black" d="M76228.85,-366.02C76212.22,-374.24 76193.92,-381.72 76176,-386 75881.62,-456.28 54678.6,-348.53 54385,-422 54366.85,-426.54 54348.44,-434.23 54331.51,-442.82"/>
<polygon fill="black" stroke="black" points="54329.5,-439.93 54322.27,-447.67 54332.75,-446.13 54329.5,-439.93"/>
</g>
<!-- layer0_expert_all2all&#45;&gt;layer0_gpu5_moe_agg -->
<g id="edge230" class="edge">
<title>layer0_expert_all2all&#45;&gt;layer0_gpu5_moe_agg</title>
<path fill="none" stroke="black" d="M76228.85,-366.01C76212.22,-374.23 76193.92,-381.72 76176,-386 75756.54,-486.29 61068.35,-317.17 60650,-422 60631.85,-426.55 60613.45,-434.24 60596.52,-442.83"/>
<polygon fill="black" stroke="black" points="60594.5,-439.94 60587.27,-447.68 60597.75,-446.13 60594.5,-439.94"/>
</g>
<!-- layer0_expert_all2all&#45;&gt;layer0_gpu6_moe_agg -->
<g id="edge231" class="edge">
<title>layer0_expert_all2all&#45;&gt;layer0_gpu6_moe_agg</title>
<path fill="none" stroke="black" d="M76228.85,-365.98C76212.21,-374.21 76193.92,-381.7 76176,-386 75956.82,-438.65 68279.6,-366.98 68061,-422 68042.86,-426.57 68024.45,-434.27 68007.52,-442.86"/>
<polygon fill="black" stroke="black" points="68005.51,-439.96 67998.28,-447.71 68008.76,-446.16 68005.51,-439.96"/>
</g>
<!-- layer0_expert_all2all&#45;&gt;layer0_gpu7_moe_agg -->
<g id="edge232" class="edge">
<title>layer0_expert_all2all&#45;&gt;layer0_gpu7_moe_agg</title>
<path fill="none" stroke="black" d="M76228.49,-365.95C76211.94,-374.12 76193.77,-381.59 76176,-386 75776.92,-485.04 74723.99,-318.64 74326,-422 74307.99,-426.68 74289.71,-434.37 74272.86,-442.92"/>
<polygon fill="black" stroke="black" points="74270.89,-440 74263.66,-447.74 74274.14,-446.2 74270.89,-440"/>
</g>
<!-- layer0_expert_all2all&#45;&gt;layer0_gpu8_moe_agg -->
<g id="edge233" class="edge">
<title>layer0_expert_all2all&#45;&gt;layer0_gpu8_moe_agg</title>
<path fill="none" stroke="black" d="M76357.78,-365.82C76374.55,-374.05 76392.98,-381.58 76411,-386 76630.2,-439.8 78223.59,-365.09 78442,-422 78459.89,-426.66 78478.04,-434.35 78494.76,-442.9"/>
<polygon fill="black" stroke="black" points="78493.41,-446.14 78503.89,-447.72 78496.68,-439.95 78493.41,-446.14"/>
</g>
<!-- layer0_expert_all2all&#45;&gt;layer0_gpu9_moe_agg -->
<g id="edge234" class="edge">
<title>layer0_expert_all2all&#45;&gt;layer0_gpu9_moe_agg</title>
<path fill="none" stroke="black" d="M76357.74,-365.99C76374.51,-374.21 76392.95,-381.7 76411,-386 76635.17,-439.43 84483.61,-365.39 84707,-422 84724.92,-426.54 84743.09,-434.18 84759.81,-442.72"/>
<polygon fill="black" stroke="black" points="84758.46,-445.96 84768.94,-447.54 84761.73,-439.77 84758.46,-445.96"/>
</g>
<!-- layer0_expert_all2all&#45;&gt;layer0_gpu10_moe_agg -->
<g id="edge235" class="edge">
<title>layer0_expert_all2all&#45;&gt;layer0_gpu10_moe_agg</title>
<path fill="none" stroke="black" d="M76357.42,-365.86C76374.28,-374.14 76392.84,-381.69 76411,-386 76622.73,-436.24 91868,-368.76 92079,-422 92096.93,-426.52 92115.09,-434.16 92131.82,-442.69"/>
<polygon fill="black" stroke="black" points="92130.47,-445.94 92140.95,-447.51 92133.73,-439.75 92130.47,-445.94"/>
</g>
<!-- layer0_expert_all2all&#45;&gt;layer0_gpu11_moe_agg -->
<g id="edge236" class="edge">
<title>layer0_expert_all2all&#45;&gt;layer0_gpu11_moe_agg</title>
<path fill="none" stroke="black" d="M76357.42,-365.87C76374.28,-374.15 76392.84,-381.7 76411,-386 76707.42,-456.23 98048.61,-347.57 98344,-422 98361.93,-426.52 98380.1,-434.15 98396.82,-442.68"/>
<polygon fill="black" stroke="black" points="98395.47,-445.93 98405.95,-447.5 98398.74,-439.74 98395.47,-445.93"/>
</g>
<!-- layer0_expert_all2all&#45;&gt;layer0_gpu12_moe_agg -->
<g id="edge237" class="edge">
<title>layer0_expert_all2all&#45;&gt;layer0_gpu12_moe_agg</title>
<path fill="none" stroke="black" d="M76357.42,-365.87C76374.28,-374.16 76392.84,-381.7 76411,-386 76792.1,-476.22 104229.21,-326.38 104609,-422 104626.93,-426.51 104645.1,-434.15 104661.82,-442.68"/>
<polygon fill="black" stroke="black" points="104660.47,-445.92 104670.95,-447.49 104663.74,-439.73 104660.47,-445.92"/>
</g>
<!-- layer0_expert_all2all&#45;&gt;layer0_gpu13_moe_agg -->
<g id="edge238" class="edge">
<title>layer0_expert_all2all&#45;&gt;layer0_gpu13_moe_agg</title>
<path fill="none" stroke="black" d="M76357.42,-365.88C76374.28,-374.16 76392.83,-381.7 76411,-386 76643.89,-441.11 110640.92,-363.59 110873,-422 110890.93,-426.51 110909.1,-434.14 110925.82,-442.67"/>
<polygon fill="black" stroke="black" points="110924.47,-445.92 110934.95,-447.49 110927.74,-439.73 110924.47,-445.92"/>
</g>
<!-- layer0_expert_all2all&#45;&gt;layer0_gpu14_moe_agg -->
<g id="edge239" class="edge">
<title>layer0_expert_all2all&#45;&gt;layer0_gpu14_moe_agg</title>
<path fill="none" stroke="black" d="M76357.41,-365.88C76374.28,-374.16 76392.83,-381.7 76411,-386 76693.71,-452.87 117962.27,-351.13 118244,-422 118261.93,-426.51 118280.1,-434.14 118296.82,-442.67"/>
<polygon fill="black" stroke="black" points="118295.47,-445.92 118305.95,-447.49 118298.74,-439.73 118295.47,-445.92"/>
</g>
<!-- layer0_expert_all2all&#45;&gt;layer0_gpu15_moe_agg -->
<g id="edge240" class="edge">
<title>layer0_expert_all2all&#45;&gt;layer0_gpu15_moe_agg</title>
<path fill="none" stroke="black" d="M76357.41,-365.88C76374.28,-374.16 76392.83,-381.7 76411,-386 76736.04,-462.86 124184.08,-340.53 124508,-422 124525.93,-426.51 124544.1,-434.14 124560.82,-442.67"/>
<polygon fill="black" stroke="black" points="124559.47,-445.92 124569.95,-447.49 124562.74,-439.72 124559.47,-445.92"/>
</g>
<!-- layer1_final_concat -->
<g id="node678" class="node">
<title>layer1_final_concat</title>
<polygon fill="orange" stroke="black" points="75649.5,-163.07 75649.5,-199.93 75573.64,-226 75466.36,-226 75390.5,-199.93 75390.5,-163.07 75466.36,-137 75573.64,-137 75649.5,-163.07"/>
<polygon fill="none" stroke="black" points="75653.5,-160.21 75653.5,-202.79 75574.31,-230 75465.69,-230 75386.5,-202.79 75386.5,-160.21 75465.69,-133 75574.31,-133 75653.5,-160.21"/>
<text text-anchor="middle" x="75520" y="-192.8" font-family="Times,serif" font-size="14.00">Concat Head Groups</text>
<text text-anchor="middle" x="75520" y="-177.8" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="75520" y="-162.8" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer1_concat_group0&#45;&gt;layer1_final_concat -->
<g id="edge165" class="edge">
<title>layer1_concat_group0&#45;&gt;layer1_final_concat</title>
<path fill="none" stroke="black" d="M24394.4,-281.47C24410.5,-275.07 24427.48,-269.47 24444,-266 24780.35,-195.42 72417.06,-183.22 75376.19,-182.53"/>
<polygon fill="black" stroke="black" points="75376.31,-186.03 75386.31,-182.53 75376.31,-179.03 75376.31,-186.03"/>
</g>
<!-- layer1_expert_all2all&#45;&gt;layer1_gpu0_moe_agg -->
<g id="edge241" class="edge">
<title>layer1_expert_all2all&#45;&gt;layer1_gpu0_moe_agg</title>
<path fill="none" stroke="black" d="M75993.86,-366.03C75977.22,-374.26 75958.93,-381.73 75941,-386 75565.07,-475.55 20666.94,-328.38 20292,-422 20273.85,-426.53 20255.44,-434.22 20238.51,-442.81"/>
<polygon fill="black" stroke="black" points="20236.49,-439.91 20229.27,-447.66 20239.75,-446.11 20236.49,-439.91"/>
</g>
<!-- layer1_expert_all2all&#45;&gt;layer1_gpu1_moe_agg -->
<g id="edge242" class="edge">
<title>layer1_expert_all2all&#45;&gt;layer1_gpu1_moe_agg</title>
<path fill="none" stroke="black" d="M75993.86,-366.03C75977.22,-374.26 75958.93,-381.73 75941,-386 75712.2,-440.49 8433.19,-365.04 8205,-422 8186.85,-426.53 8168.44,-434.22 8151.51,-442.81"/>
<polygon fill="black" stroke="black" points="8149.49,-439.91 8142.27,-447.66 8152.75,-446.11 8149.49,-439.91"/>
</g>
<!-- layer1_expert_all2all&#45;&gt;layer1_gpu2_moe_agg -->
<g id="edge243" class="edge">
<title>layer1_expert_all2all&#45;&gt;layer1_gpu2_moe_agg</title>
<path fill="none" stroke="black" d="M75993.86,-366.03C75977.22,-374.25 75958.92,-381.73 75941,-386 75654.48,-454.28 33812.76,-350.62 33527,-422 33508.85,-426.53 33490.44,-434.22 33473.51,-442.81"/>
<polygon fill="black" stroke="black" points="33471.5,-439.92 33464.27,-447.66 33474.75,-446.11 33471.5,-439.92"/>
</g>
<!-- layer1_expert_all2all&#45;&gt;layer1_gpu3_moe_agg -->
<g id="edge244" class="edge">
<title>layer1_expert_all2all&#45;&gt;layer1_gpu3_moe_agg</title>
<path fill="none" stroke="black" d="M75993.86,-366.02C75977.22,-374.25 75958.92,-381.73 75941,-386 75531.31,-483.71 46024.61,-319.86 45616,-422 45597.85,-426.54 45579.44,-434.23 45562.51,-442.82"/>
<polygon fill="black" stroke="black" points="45560.5,-439.92 45553.27,-447.67 45563.75,-446.12 45560.5,-439.92"/>
</g>
<!-- layer1_expert_all2all&#45;&gt;layer1_gpu4_moe_agg -->
<g id="edge245" class="edge">
<title>layer1_expert_all2all&#45;&gt;layer1_gpu4_moe_agg</title>
<path fill="none" stroke="black" d="M75993.85,-366.02C75977.22,-374.24 75958.92,-381.72 75941,-386 75635.65,-458.89 53642.54,-345.81 53338,-422 53319.85,-426.54 53301.44,-434.23 53284.51,-442.82"/>
<polygon fill="black" stroke="black" points="53282.5,-439.93 53275.27,-447.67 53285.75,-446.12 53282.5,-439.93"/>
</g>
<!-- layer1_expert_all2all&#45;&gt;layer1_gpu5_moe_agg -->
<g id="edge246" class="edge">
<title>layer1_expert_all2all&#45;&gt;layer1_gpu5_moe_agg</title>
<path fill="none" stroke="black" d="M75993.85,-366.01C75977.22,-374.24 75958.92,-381.72 75941,-386 75720.3,-438.75 59823.12,-366.86 59603,-422 59584.85,-426.55 59566.45,-434.24 59549.51,-442.83"/>
<polygon fill="black" stroke="black" points="59547.5,-439.93 59540.27,-447.68 59550.75,-446.13 59547.5,-439.93"/>
</g>
<!-- layer1_expert_all2all&#45;&gt;layer1_gpu6_moe_agg -->
<g id="edge247" class="edge">
<title>layer1_expert_all2all&#45;&gt;layer1_gpu6_moe_agg</title>
<path fill="none" stroke="black" d="M75993.85,-365.99C75977.21,-374.21 75958.92,-381.7 75941,-386 75699.87,-443.87 67254.49,-361.52 67014,-422 66995.86,-426.56 66977.45,-434.26 66960.52,-442.85"/>
<polygon fill="black" stroke="black" points="66958.51,-439.96 66951.28,-447.7 66961.76,-446.16 66958.51,-439.96"/>
</g>
<!-- layer1_expert_all2all&#45;&gt;layer1_gpu7_moe_agg -->
<g id="edge248" class="edge">
<title>layer1_expert_all2all&#45;&gt;layer1_gpu7_moe_agg</title>
<path fill="none" stroke="black" d="M75993.51,-366.02C75976.96,-374.19 75958.79,-381.64 75941,-386 75653.69,-456.4 73565.53,-348.5 73279,-422 73260.98,-426.62 73242.69,-434.3 73225.84,-442.84"/>
<polygon fill="black" stroke="black" points="73223.87,-439.92 73216.63,-447.66 73227.12,-446.12 73223.87,-439.92"/>
</g>
<!-- layer1_expert_all2all&#45;&gt;layer1_gpu8_moe_agg -->
<g id="edge249" class="edge">
<title>layer1_expert_all2all&#45;&gt;layer1_gpu8_moe_agg</title>
<path fill="none" stroke="black" d="M76122.78,-365.8C76139.56,-374.03 76157.99,-381.56 76176,-386 76575.03,-484.31 77627.23,-318.7 78025,-422 78043.01,-426.68 78061.29,-434.37 78078.14,-442.92"/>
<polygon fill="black" stroke="black" points="78076.86,-446.2 78087.34,-447.74 78080.11,-440 78076.86,-446.2"/>
</g>
<!-- layer1_expert_all2all&#45;&gt;layer1_gpu9_moe_agg -->
<g id="edge250" class="edge">
<title>layer1_expert_all2all&#45;&gt;layer1_gpu9_moe_agg</title>
<path fill="none" stroke="black" d="M76122.74,-365.99C76139.51,-374.21 76157.95,-381.7 76176,-386 76395.25,-438.27 84071.43,-366.98 84290,-422 84308.14,-426.57 84326.55,-434.27 84343.48,-442.86"/>
<polygon fill="black" stroke="black" points="84342.24,-446.16 84352.72,-447.71 84345.49,-439.96 84342.24,-446.16"/>
</g>
<!-- layer1_expert_all2all&#45;&gt;layer1_gpu10_moe_agg -->
<g id="edge251" class="edge">
<title>layer1_expert_all2all&#45;&gt;layer1_gpu10_moe_agg</title>
<path fill="none" stroke="black" d="M76122.42,-365.86C76139.28,-374.14 76157.84,-381.69 76176,-386 76594.55,-485.32 91244.73,-317.44 91662,-422 91680.15,-426.55 91698.55,-434.24 91715.48,-442.83"/>
<polygon fill="black" stroke="black" points="91714.25,-446.13 91724.73,-447.68 91717.5,-439.94 91714.25,-446.13"/>
</g>
<!-- layer1_expert_all2all&#45;&gt;layer1_gpu11_moe_agg -->
<g id="edge252" class="edge">
<title>layer1_expert_all2all&#45;&gt;layer1_gpu11_moe_agg</title>
<path fill="none" stroke="black" d="M76122.42,-365.87C76139.28,-374.15 76157.84,-381.7 76176,-386 76469.96,-455.65 97633.94,-348.67 97927,-422 97945.15,-426.54 97963.56,-434.23 97980.49,-442.82"/>
<polygon fill="black" stroke="black" points="97979.25,-446.13 97989.73,-447.67 97982.5,-439.93 97979.25,-446.13"/>
</g>
<!-- layer1_expert_all2all&#45;&gt;layer1_gpu12_moe_agg -->
<g id="edge253" class="edge">
<title>layer1_expert_all2all&#45;&gt;layer1_gpu12_moe_agg</title>
<path fill="none" stroke="black" d="M76122.42,-365.87C76139.28,-374.16 76157.84,-381.7 76176,-386 76554.64,-475.64 103814.51,-327.62 104192,-422 104210.15,-426.54 104228.56,-434.23 104245.49,-442.82"/>
<polygon fill="black" stroke="black" points="104244.25,-446.12 104254.73,-447.67 104247.5,-439.92 104244.25,-446.12"/>
</g>
<!-- layer1_expert_all2all&#45;&gt;layer1_gpu13_moe_agg -->
<g id="edge254" class="edge">
<title>layer1_expert_all2all&#45;&gt;layer1_gpu13_moe_agg</title>
<path fill="none" stroke="black" d="M76122.42,-365.88C76139.28,-374.16 76157.83,-381.7 76176,-386 76407.66,-440.82 110225.05,-364.28 110456,-422 110474.15,-426.54 110492.56,-434.23 110509.49,-442.81"/>
<polygon fill="black" stroke="black" points="110508.25,-446.12 110518.73,-447.66 110511.5,-439.92 110508.25,-446.12"/>
</g>
<!-- layer1_expert_all2all&#45;&gt;layer1_gpu14_moe_agg -->
<g id="edge255" class="edge">
<title>layer1_expert_all2all&#45;&gt;layer1_gpu14_moe_agg</title>
<path fill="none" stroke="black" d="M76122.41,-365.88C76139.28,-374.16 76157.83,-381.7 76176,-386 76457.48,-452.58 117546.38,-351.9 117827,-422 117845.15,-426.53 117863.56,-434.22 117880.49,-442.81"/>
<polygon fill="black" stroke="black" points="117879.25,-446.11 117889.73,-447.66 117882.5,-439.92 117879.25,-446.11"/>
</g>
<!-- layer1_expert_all2all&#45;&gt;layer1_gpu15_moe_agg -->
<g id="edge256" class="edge">
<title>layer1_expert_all2all&#45;&gt;layer1_gpu15_moe_agg</title>
<path fill="none" stroke="black" d="M76122.41,-365.88C76139.28,-374.16 76157.83,-381.7 76176,-386 76499.81,-462.57 123768.17,-341.38 124091,-422 124109.15,-426.53 124127.56,-434.22 124144.49,-442.81"/>
<polygon fill="black" stroke="black" points="124143.25,-446.11 124153.73,-447.66 124146.5,-439.91 124143.25,-446.11"/>
</g>
<!-- layer2_final_concat -->
<g id="node679" class="node">
<title>layer2_final_concat</title>
<polygon fill="orange" stroke="black" points="76960.5,-163.07 76960.5,-199.93 76884.64,-226 76777.36,-226 76701.5,-199.93 76701.5,-163.07 76777.36,-137 76884.64,-137 76960.5,-163.07"/>
<polygon fill="none" stroke="black" points="76964.5,-160.21 76964.5,-202.79 76885.31,-230 76776.69,-230 76697.5,-202.79 76697.5,-160.21 76776.69,-133 76885.31,-133 76964.5,-160.21"/>
<text text-anchor="middle" x="76831" y="-192.8" font-family="Times,serif" font-size="14.00">Concat Head Groups</text>
<text text-anchor="middle" x="76831" y="-177.8" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="76831" y="-162.8" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer2_concat_group0&#45;&gt;layer2_final_concat -->
<g id="edge185" class="edge">
<title>layer2_concat_group0&#45;&gt;layer2_final_concat</title>
<path fill="none" stroke="black" d="M25278.88,-280.74C25293.87,-274.64 25309.62,-269.33 25325,-266 25673.16,-190.56 76270.03,-270.22 76624,-230 76653.46,-226.65 76684.83,-220.72 76714.02,-214.16"/>
<polygon fill="black" stroke="black" points="76714.86,-217.56 76723.82,-211.91 76713.29,-210.74 76714.86,-217.56"/>
</g>
<!-- layer2_expert_all2all&#45;&gt;layer2_gpu0_moe_agg -->
<g id="edge257" class="edge">
<title>layer2_expert_all2all&#45;&gt;layer2_gpu0_moe_agg</title>
<path fill="none" stroke="black" d="M76463.86,-366.03C76447.22,-374.26 76428.93,-381.73 76411,-386 76052.75,-471.34 23737.3,-332.78 23380,-422 23361.85,-426.53 23343.44,-434.22 23326.51,-442.81"/>
<polygon fill="black" stroke="black" points="23324.5,-439.91 23317.27,-447.66 23327.75,-446.11 23324.5,-439.91"/>
</g>
<!-- layer2_expert_all2all&#45;&gt;layer2_gpu1_moe_agg -->
<g id="edge258" class="edge">
<title>layer2_expert_all2all&#45;&gt;layer2_gpu1_moe_agg</title>
<path fill="none" stroke="black" d="M76463.86,-366.03C76447.22,-374.26 76428.93,-381.73 76411,-386 76191.05,-438.38 11512.37,-367.24 11293,-422 11274.85,-426.53 11256.44,-434.22 11239.51,-442.81"/>
<polygon fill="black" stroke="black" points="11237.49,-439.91 11230.27,-447.66 11240.75,-446.11 11237.49,-439.91"/>
</g>
<!-- layer2_expert_all2all&#45;&gt;layer2_gpu2_moe_agg -->
<g id="edge259" class="edge">
<title>layer2_expert_all2all&#45;&gt;layer2_gpu2_moe_agg</title>
<path fill="none" stroke="black" d="M76463.86,-366.03C76447.22,-374.25 76428.92,-381.73 76411,-386 76142.17,-450.08 36883.12,-355.02 36615,-422 36596.85,-426.53 36578.44,-434.22 36561.51,-442.81"/>
<polygon fill="black" stroke="black" points="36559.5,-439.92 36552.27,-447.66 36562.75,-446.12 36559.5,-439.92"/>
</g>
<!-- layer2_expert_all2all&#45;&gt;layer2_gpu3_moe_agg -->
<g id="edge260" class="edge">
<title>layer2_expert_all2all&#45;&gt;layer2_gpu3_moe_agg</title>
<path fill="none" stroke="black" d="M76463.85,-366.02C76447.22,-374.25 76428.92,-381.72 76411,-386 76036.68,-475.3 49077.33,-328.66 48704,-422 48685.85,-426.54 48667.44,-434.23 48650.51,-442.82"/>
<polygon fill="black" stroke="black" points="48648.5,-439.92 48641.27,-447.67 48651.75,-446.12 48648.5,-439.92"/>
</g>
<!-- layer2_expert_all2all&#45;&gt;layer2_gpu4_moe_agg -->
<g id="edge261" class="edge">
<title>layer2_expert_all2all&#45;&gt;layer2_gpu4_moe_agg</title>
<path fill="none" stroke="black" d="M76463.85,-366.02C76447.22,-374.24 76428.92,-381.72 76411,-386 76121.35,-455.16 55258.88,-349.71 54970,-422 54951.85,-426.54 54933.44,-434.23 54916.51,-442.82"/>
<polygon fill="black" stroke="black" points="54914.5,-439.93 54907.27,-447.67 54917.75,-446.13 54914.5,-439.93"/>
</g>
<!-- layer2_expert_all2all&#45;&gt;layer2_gpu5_moe_agg -->
<g id="edge262" class="edge">
<title>layer2_expert_all2all&#45;&gt;layer2_gpu5_moe_agg</title>
<path fill="none" stroke="black" d="M76463.85,-366.01C76447.22,-374.23 76428.92,-381.71 76411,-386 76001,-484.04 61643.91,-319.53 61235,-422 61216.85,-426.55 61198.45,-434.24 61181.52,-442.83"/>
<polygon fill="black" stroke="black" points="61179.5,-439.94 61172.27,-447.68 61182.75,-446.14 61179.5,-439.94"/>
</g>
<!-- layer2_expert_all2all&#45;&gt;layer2_gpu6_moe_agg -->
<g id="edge263" class="edge">
<title>layer2_expert_all2all&#45;&gt;layer2_gpu6_moe_agg</title>
<path fill="none" stroke="black" d="M76463.84,-365.98C76447.21,-374.21 76428.92,-381.69 76411,-386 75991.55,-486.8 69064.33,-316.66 68646,-422 68627.86,-426.57 68609.45,-434.27 68592.52,-442.86"/>
<polygon fill="black" stroke="black" points="68590.51,-439.97 68583.28,-447.71 68593.76,-446.17 68590.51,-439.97"/>
</g>
<!-- layer2_expert_all2all&#45;&gt;layer2_gpu7_moe_agg -->
<g id="edge264" class="edge">
<title>layer2_expert_all2all&#45;&gt;layer2_gpu7_moe_agg</title>
<path fill="none" stroke="black" d="M76463.48,-365.89C76446.92,-374.06 76428.76,-381.55 76411,-386 76087.57,-467.05 75233.53,-337.46 74911,-422 74893,-426.72 74874.72,-434.43 74857.87,-442.98"/>
<polygon fill="black" stroke="black" points="74855.91,-440.06 74848.67,-447.8 74859.15,-446.26 74855.91,-440.06"/>
</g>
<!-- layer2_expert_all2all&#45;&gt;layer2_gpu8_moe_agg -->
<g id="edge265" class="edge">
<title>layer2_expert_all2all&#45;&gt;layer2_gpu8_moe_agg</title>
<path fill="none" stroke="black" d="M76591.04,-366.49C76606.79,-374.48 76624.05,-381.73 76641,-386 76966,-467.8 79332.31,-338.98 79657,-422 79675.02,-426.61 79693.32,-434.28 79710.17,-442.82"/>
<polygon fill="black" stroke="black" points="79708.89,-446.1 79719.37,-447.64 79712.14,-439.9 79708.89,-446.1"/>
</g>
<!-- layer2_expert_all2all&#45;&gt;layer2_gpu9_moe_agg -->
<g id="edge266" class="edge">
<title>layer2_expert_all2all&#45;&gt;layer2_gpu9_moe_agg</title>
<path fill="none" stroke="black" d="M76591.02,-366.59C76606.77,-374.58 76624.03,-381.8 76641,-386 76891.26,-447.92 85671.97,-359.14 85922,-422 85940.14,-426.56 85958.55,-434.26 85975.48,-442.85"/>
<polygon fill="black" stroke="black" points="85974.24,-446.16 85984.72,-447.7 85977.49,-439.96 85974.24,-446.16"/>
</g>
<!-- layer2_expert_all2all&#45;&gt;layer2_gpu10_moe_agg -->
<g id="edge267" class="edge">
<title>layer2_expert_all2all&#45;&gt;layer2_gpu10_moe_agg</title>
<path fill="none" stroke="black" d="M76591.01,-366.61C76606.77,-374.6 76624.02,-381.82 76641,-386 76865.57,-441.36 93069.64,-365.8 93294,-422 93312.15,-426.55 93330.55,-434.24 93347.49,-442.83"/>
<polygon fill="black" stroke="black" points="93346.25,-446.13 93356.73,-447.68 93349.5,-439.93 93346.25,-446.13"/>
</g>
<!-- layer2_expert_all2all&#45;&gt;layer2_gpu11_moe_agg -->
<g id="edge268" class="edge">
<title>layer2_expert_all2all&#45;&gt;layer2_gpu11_moe_agg</title>
<path fill="none" stroke="black" d="M76591.01,-366.62C76606.76,-374.6 76624.02,-381.82 76641,-386 76950.08,-462.09 99250.21,-344.75 99559,-422 99577.15,-426.54 99595.56,-434.23 99612.49,-442.82"/>
<polygon fill="black" stroke="black" points="99611.25,-446.12 99621.73,-447.67 99614.5,-439.93 99611.25,-446.12"/>
</g>
<!-- layer2_expert_all2all&#45;&gt;layer2_gpu12_moe_agg -->
<g id="edge269" class="edge">
<title>layer2_expert_all2all&#45;&gt;layer2_gpu12_moe_agg</title>
<path fill="none" stroke="black" d="M76591.01,-366.62C76606.76,-374.61 76624.02,-381.82 76641,-386 77034.59,-482.82 105430.78,-323.7 105824,-422 105842.15,-426.54 105860.56,-434.23 105877.49,-442.82"/>
<polygon fill="black" stroke="black" points="105876.25,-446.12 105886.73,-447.67 105879.5,-439.92 105876.25,-446.12"/>
</g>
<!-- layer2_expert_all2all&#45;&gt;layer2_gpu13_moe_agg -->
<g id="edge270" class="edge">
<title>layer2_expert_all2all&#45;&gt;layer2_gpu13_moe_agg</title>
<path fill="none" stroke="black" d="M76591.01,-366.63C76606.76,-374.61 76624.02,-381.83 76641,-386 76880.04,-444.78 111849.18,-362.32 112088,-422 112106.15,-426.54 112124.56,-434.23 112141.49,-442.81"/>
<polygon fill="black" stroke="black" points="112140.25,-446.12 112150.73,-447.66 112143.5,-439.92 112140.25,-446.12"/>
</g>
<!-- layer2_expert_all2all&#45;&gt;layer2_gpu14_moe_agg -->
<g id="edge271" class="edge">
<title>layer2_expert_all2all&#45;&gt;layer2_gpu14_moe_agg</title>
<path fill="none" stroke="black" d="M76591.01,-366.63C76606.76,-374.61 76624.02,-381.83 76641,-386 76929.75,-456.97 119170.52,-349.94 119459,-422 119477.15,-426.53 119495.56,-434.22 119512.49,-442.81"/>
<polygon fill="black" stroke="black" points="119511.25,-446.11 119521.73,-447.66 119514.5,-439.92 119511.25,-446.11"/>
</g>
<!-- layer2_expert_all2all&#45;&gt;layer2_gpu15_moe_agg -->
<g id="edge272" class="edge">
<title>layer2_expert_all2all&#45;&gt;layer2_gpu15_moe_agg</title>
<path fill="none" stroke="black" d="M76591.01,-366.63C76606.76,-374.61 76624.02,-381.83 76641,-386 76972,-467.34 125392.31,-339.42 125723,-422 125741.15,-426.53 125759.56,-434.22 125776.49,-442.81"/>
<polygon fill="black" stroke="black" points="125775.25,-446.11 125785.73,-447.66 125778.5,-439.91 125775.25,-446.11"/>
</g>
<!-- layer3_final_concat -->
<g id="node680" class="node">
<title>layer3_final_concat</title>
<polygon fill="orange" stroke="black" points="76195.5,-163.07 76195.5,-199.93 76119.64,-226 76012.36,-226 75936.5,-199.93 75936.5,-163.07 76012.36,-137 76119.64,-137 76195.5,-163.07"/>
<polygon fill="none" stroke="black" points="76199.5,-160.21 76199.5,-202.79 76120.31,-230 76011.69,-230 75932.5,-202.79 75932.5,-160.21 76011.69,-133 76120.31,-133 76199.5,-160.21"/>
<text text-anchor="middle" x="76066" y="-192.8" font-family="Times,serif" font-size="14.00">Concat Head Groups</text>
<text text-anchor="middle" x="76066" y="-177.8" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="76066" y="-162.8" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer3_concat_group0&#45;&gt;layer3_final_concat -->
<g id="edge205" class="edge">
<title>layer3_concat_group0&#45;&gt;layer3_final_concat</title>
<path fill="none" stroke="black" d="M24664.4,-281.46C24680.5,-275.06 24697.48,-269.46 24714,-266 24887.15,-229.75 75486.4,-240.43 75663,-230 75749.32,-224.9 75845.51,-213.77 75922.25,-203.57"/>
<polygon fill="black" stroke="black" points="75923.03,-207 75932.47,-202.2 75922.1,-200.06 75923.03,-207"/>
</g>
<!-- layer3_expert_all2all&#45;&gt;layer3_gpu0_moe_agg -->
<g id="edge273" class="edge">
<title>layer3_expert_all2all&#45;&gt;layer3_gpu0_moe_agg</title>
<path fill="none" stroke="black" d="M75759.99,-366.63C75744.24,-374.61 75726.98,-381.83 75710,-386 75322.5,-481.2 18638.14,-325.34 18251,-422 18232.85,-426.53 18214.44,-434.22 18197.51,-442.81"/>
<polygon fill="black" stroke="black" points="18195.49,-439.91 18188.27,-447.66 18198.75,-446.11 18195.49,-439.91"/>
</g>
<!-- layer3_expert_all2all&#45;&gt;layer3_gpu1_moe_agg -->
<g id="edge274" class="edge">
<title>layer3_expert_all2all&#45;&gt;layer3_gpu1_moe_agg</title>
<path fill="none" stroke="black" d="M75759.99,-366.63C75744.24,-374.61 75726.98,-381.83 75710,-386 75475.49,-443.6 6398.29,-363.52 6164,-422 6145.85,-426.53 6127.44,-434.22 6110.51,-442.81"/>
<polygon fill="black" stroke="black" points="6108.49,-439.91 6101.27,-447.66 6111.75,-446.11 6108.49,-439.91"/>
</g>
<!-- layer3_expert_all2all&#45;&gt;layer3_gpu2_moe_agg -->
<g id="edge275" class="edge">
<title>layer3_expert_all2all&#45;&gt;layer3_gpu2_moe_agg</title>
<path fill="none" stroke="black" d="M75759.99,-366.63C75744.24,-374.61 75726.98,-381.83 75710,-386 75411.76,-459.3 31783.96,-347.58 31486,-422 31467.85,-426.53 31449.44,-434.22 31432.51,-442.81"/>
<polygon fill="black" stroke="black" points="31430.5,-439.92 31423.27,-447.66 31433.75,-446.11 31430.5,-439.92"/>
</g>
<!-- layer3_expert_all2all&#45;&gt;layer3_gpu3_moe_agg -->
<g id="edge276" class="edge">
<title>layer3_expert_all2all&#45;&gt;layer3_gpu3_moe_agg</title>
<path fill="none" stroke="black" d="M75759.99,-366.62C75744.24,-374.61 75726.98,-381.82 75710,-386 75493.3,-439.3 43791.5,-367.89 43575,-422 43556.85,-426.54 43538.44,-434.23 43521.51,-442.82"/>
<polygon fill="black" stroke="black" points="43519.5,-439.92 43512.27,-447.66 43522.75,-446.12 43519.5,-439.92"/>
</g>
<!-- layer3_expert_all2all&#45;&gt;layer3_gpu4_moe_agg -->
<g id="edge277" class="edge">
<title>layer3_expert_all2all&#45;&gt;layer3_gpu4_moe_agg</title>
<path fill="none" stroke="black" d="M75759.99,-366.62C75744.24,-374.6 75726.98,-381.82 75710,-386 75400.4,-462.22 53062.31,-344.62 52753,-422 52734.85,-426.54 52716.44,-434.23 52699.51,-442.82"/>
<polygon fill="black" stroke="black" points="52697.5,-439.93 52690.27,-447.67 52700.75,-446.12 52697.5,-439.93"/>
</g>
<!-- layer3_expert_all2all&#45;&gt;layer3_gpu5_moe_agg -->
<g id="edge278" class="edge">
<title>layer3_expert_all2all&#45;&gt;layer3_gpu5_moe_agg</title>
<path fill="none" stroke="black" d="M75759.99,-366.61C75744.23,-374.6 75726.98,-381.82 75710,-386 75484.9,-441.48 59242.89,-365.67 59018,-422 58999.85,-426.55 58981.45,-434.24 58964.51,-442.83"/>
<polygon fill="black" stroke="black" points="58962.5,-439.93 58955.27,-447.68 58965.75,-446.13 58962.5,-439.93"/>
</g>
<!-- layer3_expert_all2all&#45;&gt;layer3_gpu6_moe_agg -->
<g id="edge279" class="edge">
<title>layer3_expert_all2all&#45;&gt;layer3_gpu6_moe_agg</title>
<path fill="none" stroke="black" d="M75759.98,-366.59C75744.23,-374.58 75726.97,-381.8 75710,-386 75459.74,-447.92 66679.03,-359.14 66429,-422 66410.86,-426.56 66392.45,-434.26 66375.52,-442.85"/>
<polygon fill="black" stroke="black" points="66373.51,-439.96 66366.28,-447.7 66376.76,-446.16 66373.51,-439.96"/>
</g>
<!-- layer3_expert_all2all&#45;&gt;layer3_gpu7_moe_agg -->
<g id="edge280" class="edge">
<title>layer3_expert_all2all&#45;&gt;layer3_gpu7_moe_agg</title>
<path fill="none" stroke="black" d="M75759.96,-366.49C75744.21,-374.48 75726.95,-381.73 75710,-386 75385,-467.8 73018.69,-338.98 72694,-422 72675.98,-426.61 72657.68,-434.28 72640.83,-442.82"/>
<polygon fill="black" stroke="black" points="72638.86,-439.9 72631.63,-447.64 72642.11,-446.1 72638.86,-439.9"/>
</g>
<!-- layer3_expert_all2all&#45;&gt;layer3_gpu8_moe_agg -->
<g id="edge281" class="edge">
<title>layer3_expert_all2all&#45;&gt;layer3_gpu8_moe_agg</title>
<path fill="none" stroke="black" d="M75889.39,-365.1C75905.81,-373.14 75923.68,-380.76 75941,-386 76182.36,-458.98 76478.24,-480.34 76643.27,-486.53"/>
<polygon fill="black" stroke="black" points="76643.34,-490.04 76653.47,-486.9 76643.6,-483.04 76643.34,-490.04"/>
</g>
<!-- layer3_expert_all2all&#45;&gt;layer3_gpu9_moe_agg -->
<g id="edge282" class="edge">
<title>layer3_expert_all2all&#45;&gt;layer3_gpu9_moe_agg</title>
<path fill="none" stroke="black" d="M75887.74,-365.98C75904.52,-374.2 75922.95,-381.69 75941,-386 76317.37,-475.88 82530.34,-329.23 82906,-422 82924.88,-426.66 82944.09,-434.59 82961.71,-443.39"/>
<polygon fill="black" stroke="black" points="82960.27,-446.59 82970.77,-448.06 82963.48,-440.37 82960.27,-446.59"/>
</g>
<!-- layer3_expert_all2all&#45;&gt;layer3_gpu10_moe_agg -->
<g id="edge283" class="edge">
<title>layer3_expert_all2all&#45;&gt;layer3_gpu10_moe_agg</title>
<path fill="none" stroke="black" d="M75887.42,-365.86C75904.28,-374.14 75922.84,-381.69 75941,-386 76119.76,-428.46 88986.34,-416.78 89170,-422 89575.99,-433.54 90056.15,-464.51 90280.11,-479.97"/>
<polygon fill="black" stroke="black" points="90280.04,-483.47 90290.26,-480.67 90280.52,-476.49 90280.04,-483.47"/>
</g>
<!-- layer3_expert_all2all&#45;&gt;layer3_gpu11_moe_agg -->
<g id="edge284" class="edge">
<title>layer3_expert_all2all&#45;&gt;layer3_gpu11_moe_agg</title>
<path fill="none" stroke="black" d="M75887.42,-365.87C75904.28,-374.15 75922.84,-381.7 75941,-386 76219.43,-451.98 96265.09,-353.88 96543,-422 96561.89,-426.63 96581.1,-434.54 96598.72,-443.35"/>
<polygon fill="black" stroke="black" points="96597.29,-446.55 96607.78,-448.02 96600.49,-440.32 96597.29,-446.55"/>
</g>
<!-- layer3_expert_all2all&#45;&gt;layer3_gpu12_moe_agg -->
<g id="edge285" class="edge">
<title>layer3_expert_all2all&#45;&gt;layer3_gpu12_moe_agg</title>
<path fill="none" stroke="black" d="M75887.42,-365.87C75904.28,-374.16 75922.84,-381.7 75941,-386 76304.11,-471.98 102445.56,-333.23 102808,-422 102826.89,-426.63 102846.1,-434.54 102863.72,-443.34"/>
<polygon fill="black" stroke="black" points="102862.29,-446.54 102872.78,-448.01 102865.5,-440.32 102862.29,-446.54"/>
</g>
<!-- layer3_expert_all2all&#45;&gt;layer3_gpu13_moe_agg -->
<g id="edge286" class="edge">
<title>layer3_expert_all2all&#45;&gt;layer3_gpu13_moe_agg</title>
<path fill="none" stroke="black" d="M75887.42,-365.88C75904.28,-374.16 75922.83,-381.7 75941,-386 76164.89,-438.98 108848.52,-367.3 109072,-422 109090.89,-426.62 109110.1,-434.54 109127.72,-443.34"/>
<polygon fill="black" stroke="black" points="109126.29,-446.54 109136.78,-448.01 109129.5,-440.31 109126.29,-446.54"/>
</g>
<!-- layer3_expert_all2all&#45;&gt;layer3_gpu14_moe_agg -->
<g id="edge287" class="edge">
<title>layer3_expert_all2all&#45;&gt;layer3_gpu14_moe_agg</title>
<path fill="none" stroke="black" d="M75887.42,-365.88C75904.28,-374.16 75922.83,-381.7 75941,-386 76074.11,-417.49 115198.27,-418.24 115335,-422 115741,-433.17 116221.15,-464.32 116445.12,-479.89"/>
<polygon fill="black" stroke="black" points="116445.04,-483.4 116455.26,-480.6 116445.53,-476.41 116445.04,-483.4"/>
</g>
<!-- layer3_expert_all2all&#45;&gt;layer3_gpu15_moe_agg -->
<g id="edge288" class="edge">
<title>layer3_expert_all2all&#45;&gt;layer3_gpu15_moe_agg</title>
<path fill="none" stroke="black" d="M75887.41,-365.88C75904.28,-374.16 75922.83,-381.7 75941,-386 76257.05,-460.74 122391.54,-344.83 122707,-422 122725.89,-426.62 122745.1,-434.53 122762.72,-443.33"/>
<polygon fill="black" stroke="black" points="122761.29,-446.53 122771.78,-448 122764.5,-440.31 122761.29,-446.53"/>
</g>
<!-- layer0_concat_group1&#45;&gt;layer0_final_concat -->
<g id="edge146" class="edge">
<title>layer0_concat_group1&#45;&gt;layer0_final_concat</title>
<path fill="none" stroke="black" d="M62800.99,-286.69C62826.9,-278.16 62855.17,-270.37 62882,-266 63247.39,-206.52 75840.23,-262.46 76209,-230 76255.84,-225.88 76306.71,-217.94 76351.65,-209.72"/>
<polygon fill="black" stroke="black" points="76352.55,-213.11 76361.74,-207.85 76351.27,-206.23 76352.55,-213.11"/>
</g>
<!-- layer1_concat_group1&#45;&gt;layer1_final_concat -->
<g id="edge166" class="edge">
<title>layer1_concat_group1&#45;&gt;layer1_final_concat</title>
<path fill="none" stroke="black" d="M62249.42,-281.54C62265.51,-275.12 62282.49,-269.51 62299,-266 62635.85,-194.5 73964.66,-183.67 75376.13,-182.6"/>
<polygon fill="black" stroke="black" points="75376.32,-186.1 75386.32,-182.59 75376.31,-179.1 75376.32,-186.1"/>
</g>
<!-- layer2_concat_group1&#45;&gt;layer2_final_concat -->
<g id="edge186" class="edge">
<title>layer2_concat_group1&#45;&gt;layer2_final_concat</title>
<path fill="none" stroke="black" d="M63133.89,-280.77C63148.87,-274.67 63164.62,-269.35 63180,-266 63544.9,-186.56 76252.98,-272.53 76624,-230 76653.46,-226.62 76684.83,-220.68 76714.01,-214.12"/>
<polygon fill="black" stroke="black" points="76714.85,-217.52 76723.82,-211.87 76713.29,-210.69 76714.85,-217.52"/>
</g>
<!-- layer3_concat_group1&#45;&gt;layer3_final_concat -->
<g id="edge206" class="edge">
<title>layer3_concat_group1&#45;&gt;layer3_final_concat</title>
<path fill="none" stroke="black" d="M62519.41,-281.49C62535.51,-275.08 62552.48,-269.48 62569,-266 62746.96,-228.55 75481.47,-240.91 75663,-230 75749.31,-224.81 75845.5,-213.68 75922.25,-203.5"/>
<polygon fill="black" stroke="black" points="75923.02,-206.92 75932.47,-202.13 75922.09,-199.99 75923.02,-206.92"/>
</g>
<!-- layer0_concat_group2&#45;&gt;layer0_final_concat -->
<g id="edge147" class="edge">
<title>layer0_concat_group2&#45;&gt;layer0_final_concat</title>
<path fill="none" stroke="black" d="M89754.59,-281.49C89738.49,-275.08 89721.52,-269.48 89705,-266 89351.19,-191.55 77048.22,-271 76689,-230 76659.32,-226.61 76627.71,-220.65 76598.32,-214.06"/>
<polygon fill="black" stroke="black" points="76598.97,-210.62 76588.44,-211.81 76597.41,-217.45 76598.97,-210.62"/>
</g>
<!-- layer1_concat_group2&#45;&gt;layer1_final_concat -->
<g id="edge167" class="edge">
<title>layer1_concat_group2&#45;&gt;layer1_final_concat</title>
<path fill="none" stroke="black" d="M89216.11,-280.77C89201.13,-274.67 89185.38,-269.35 89170,-266 88990.24,-226.86 76107.64,-241.01 75924,-230 75837.47,-224.81 75741.05,-213.68 75664.11,-203.5"/>
<polygon fill="black" stroke="black" points="75664.24,-199.98 75653.87,-202.13 75663.31,-206.92 75664.24,-199.98"/>
</g>
<!-- layer2_concat_group2&#45;&gt;layer2_final_concat -->
<g id="edge187" class="edge">
<title>layer2_concat_group2&#45;&gt;layer2_final_concat</title>
<path fill="none" stroke="black" d="M90060.81,-282.12C90043.68,-275.46 90025.57,-269.61 90008,-266 89671.85,-196.95 78384.04,-183.98 76974.93,-182.63"/>
<polygon fill="black" stroke="black" points="76974.77,-179.13 76964.76,-182.62 76974.76,-186.13 76974.77,-179.13"/>
</g>
<!-- layer3_concat_group2&#45;&gt;layer3_final_concat -->
<g id="edge207" class="edge">
<title>layer3_concat_group2&#45;&gt;layer3_final_concat</title>
<path fill="none" stroke="black" d="M89484.59,-281.49C89468.49,-275.08 89451.52,-269.48 89435,-266 89079.02,-191.1 76701.39,-261.79 76339,-230 76291.78,-225.86 76240.48,-217.87 76195.22,-209.61"/>
<polygon fill="black" stroke="black" points="76195.83,-206.16 76185.36,-207.79 76194.56,-213.04 76195.83,-206.16"/>
</g>
<!-- layer0_concat_group3&#45;&gt;layer0_final_concat -->
<g id="edge148" class="edge">
<title>layer0_concat_group3&#45;&gt;layer0_final_concat</title>
<path fill="none" stroke="black" d="M115919.6,-281.46C115903.5,-275.06 115886.52,-269.46 115870,-266 115603.69,-210.22 76959.36,-260.6 76689,-230 76659.32,-226.64 76627.7,-220.68 76598.31,-214.1"/>
<polygon fill="black" stroke="black" points="76598.96,-210.66 76588.44,-211.85 76597.41,-217.49 76598.96,-210.66"/>
</g>
<!-- layer1_concat_group3&#45;&gt;layer1_final_concat -->
<g id="edge168" class="edge">
<title>layer1_concat_group3&#45;&gt;layer1_final_concat</title>
<path fill="none" stroke="black" d="M115381.12,-280.75C115366.13,-274.64 115350.38,-269.33 115335,-266 115067.53,-208.02 76197.21,-246.13 75924,-230 75837.47,-224.89 75741.04,-213.76 75664.1,-203.56"/>
<polygon fill="black" stroke="black" points="75664.24,-200.05 75653.86,-202.19 75663.31,-206.99 75664.24,-200.05"/>
</g>
<!-- layer2_concat_group3&#45;&gt;layer2_final_concat -->
<g id="edge188" class="edge">
<title>layer2_concat_group3&#45;&gt;layer2_final_concat</title>
<path fill="none" stroke="black" d="M116226.2,-282.2C116208.96,-275.49 116190.71,-269.6 116173,-266 115914.76,-213.52 79554.6,-184.6 76975.06,-182.61"/>
<polygon fill="black" stroke="black" points="76974.84,-179.11 76964.84,-182.6 76974.83,-186.11 76974.84,-179.11"/>
</g>
<!-- layer3_concat_group3&#45;&gt;layer3_final_concat -->
<g id="edge208" class="edge">
<title>layer3_concat_group3&#45;&gt;layer3_final_concat</title>
<path fill="none" stroke="black" d="M115649.6,-281.46C115633.5,-275.06 115616.52,-269.46 115600,-266 115333.14,-210.11 76610.62,-253.58 76339,-230 76291.67,-225.89 76240.23,-217.88 76194.9,-209.6"/>
<polygon fill="black" stroke="black" points="76195.49,-206.15 76185.02,-207.77 76194.22,-213.03 76195.49,-206.15"/>
</g>
<!-- layer0_final_concat&#45;&gt;layer1_gpu0_ln1 -->
<g id="edge149" class="edge">
<title>layer0_final_concat&#45;&gt;layer1_gpu0_ln1</title>
<path fill="none" stroke="black" d="M76362.09,-207.84C76314.7,-216.74 76259.5,-225.61 76209,-230 75849.01,-261.32 24535.34,-263 24174,-266 20827.91,-293.82 19991.79,-333.71 16646,-386 16515.45,-388.04 14419.03,-378.28 14296,-422 14279.72,-427.78 14264.18,-438.05 14250.94,-448.84"/>
<polygon fill="black" stroke="black" points="14248.35,-446.44 14243,-455.59 14252.89,-451.77 14248.35,-446.44"/>
</g>
<!-- layer0_final_concat&#45;&gt;layer1_gpu1_ln1 -->
<g id="edge150" class="edge">
<title>layer0_final_concat&#45;&gt;layer1_gpu1_ln1</title>
<path fill="none" stroke="black" d="M76362.09,-207.84C76314.7,-216.74 76259.5,-225.61 76209,-230 75199.57,-317.73 4266.45,-190.96 3256,-266 2786.38,-300.88 2640.32,-235.31 2208,-422 2192.43,-428.72 2177.27,-439.04 2164.17,-449.57"/>
<polygon fill="black" stroke="black" points="2161.74,-447.04 2156.29,-456.13 2166.22,-452.42 2161.74,-447.04"/>
</g>
<!-- layer0_final_concat&#45;&gt;layer1_gpu2_ln1 -->
<g id="edge151" class="edge">
<title>layer0_final_concat&#45;&gt;layer1_gpu2_ln1</title>
<path fill="none" stroke="black" d="M76362.09,-207.84C76314.69,-216.73 76259.5,-225.6 76209,-230 75603.15,-282.75 33030.66,-241.94 32423,-266 31537.42,-301.06 31260.36,-99.1 30435,-422 30419.06,-428.24 30403.7,-438.52 30390.53,-449.18"/>
<polygon fill="black" stroke="black" points="30388.02,-446.71 30382.62,-455.83 30392.53,-452.07 30388.02,-446.71"/>
</g>
<!-- layer0_final_concat&#45;&gt;layer1_gpu3_ln1 -->
<g id="edge152" class="edge">
<title>layer0_final_concat&#45;&gt;layer1_gpu3_ln1</title>
<path fill="none" stroke="black" d="M76362.08,-207.83C76314.69,-216.72 76259.5,-225.59 76209,-230 75328.12,-306.84 45260.42,-228.38 44377,-266 43551.28,-301.16 43292.81,-118.7 42524,-422 42508.08,-428.28 42492.72,-438.58 42479.55,-449.23"/>
<polygon fill="black" stroke="black" points="42477.05,-446.77 42471.64,-455.88 42481.55,-452.12 42477.05,-446.77"/>
</g>
<!-- layer0_final_concat&#45;&gt;layer1_gpu4_ln1 -->
<g id="edge153" class="edge">
<title>layer0_final_concat&#45;&gt;layer1_gpu4_ln1</title>
<path fill="none" stroke="black" d="M76362.08,-207.82C76314.69,-216.71 76259.5,-225.59 76209,-230 75538.14,-288.64 52638.7,-234.93 51966,-266 51202.33,-301.27 50963.18,-139.03 50253,-422 50237.1,-428.34 50221.75,-438.65 50208.58,-449.3"/>
<polygon fill="black" stroke="black" points="50206.07,-446.83 50200.67,-455.95 50210.58,-452.19 50206.07,-446.83"/>
</g>
<!-- layer0_final_concat&#45;&gt;layer1_gpu5_ln1 -->
<g id="edge154" class="edge">
<title>layer0_final_concat&#45;&gt;layer1_gpu5_ln1</title>
<path fill="none" stroke="black" d="M76361.75,-207.85C76314.43,-216.72 76259.38,-225.57 76209,-230 75816.62,-264.51 62422.84,-259.93 62029,-266 61416.61,-275.44 57094.77,-213.19 56519,-422 56502.76,-427.89 56487.23,-438.19 56473.98,-448.97"/>
<polygon fill="black" stroke="black" points="56471.4,-446.57 56466.05,-455.71 56475.93,-451.9 56471.4,-446.57"/>
</g>
<!-- layer0_final_concat&#45;&gt;layer1_gpu6_ln1 -->
<g id="edge155" class="edge">
<title>layer0_final_concat&#45;&gt;layer1_gpu6_ln1</title>
<path fill="none" stroke="black" d="M76361.74,-207.82C76314.43,-216.69 76259.38,-225.54 76209,-230 75685.21,-276.4 67268.93,-235.12 66744,-266 66134,-301.88 65943.03,-189.33 65378,-422 65362.17,-428.52 65346.85,-438.88 65333.67,-449.53"/>
<polygon fill="black" stroke="black" points="65331.17,-447.05 65325.76,-456.16 65335.67,-452.42 65331.17,-447.05"/>
</g>
<!-- layer0_final_concat&#45;&gt;layer1_gpu7_ln1 -->
<g id="edge156" class="edge">
<title>layer0_final_concat&#45;&gt;layer1_gpu7_ln1</title>
<path fill="none" stroke="black" d="M76361.39,-207.72C76314.15,-216.55 76259.24,-225.4 76209,-230 75404.33,-303.75 73377.91,-194.95 72573,-266 72155.52,-302.85 72026.22,-252.31 71643,-422 71627.49,-428.87 71612.35,-439.22 71599.25,-449.75"/>
<polygon fill="black" stroke="black" points="71596.82,-447.22 71591.37,-456.3 71601.3,-452.6 71596.82,-447.22"/>
</g>
<!-- layer0_final_concat&#45;&gt;layer1_gpu8_ln1 -->
<g id="edge157" class="edge">
<title>layer0_final_concat&#45;&gt;layer1_gpu8_ln1</title>
<path fill="none" stroke="black" d="M76588.73,-211.72C76620.75,-219.15 76656.08,-226.12 76689,-230 76887.25,-253.36 80093.24,-201.04 80282,-266 80386.87,-302.09 80483.21,-393.39 80533.5,-447.31"/>
<polygon fill="black" stroke="black" points="80531.23,-450.01 80540.58,-454.99 80536.37,-445.27 80531.23,-450.01"/>
</g>
<!-- layer0_final_concat&#45;&gt;layer1_gpu9_ln1 -->
<g id="edge158" class="edge">
<title>layer0_final_concat&#45;&gt;layer1_gpu9_ln1</title>
<path fill="none" stroke="black" d="M76588.44,-211.79C76620.54,-219.25 76655.97,-226.22 76689,-230 76825.03,-245.59 86417.39,-221.86 86547,-266 86652.27,-301.85 86748.81,-393.67 86798.94,-447.65"/>
<polygon fill="black" stroke="black" points="86796.65,-450.34 86806,-455.33 86801.81,-445.6 86796.65,-450.34"/>
</g>
<!-- layer0_final_concat&#45;&gt;layer1_gpu10_ln1 -->
<g id="edge159" class="edge">
<title>layer0_final_concat&#45;&gt;layer1_gpu10_ln1</title>
<path fill="none" stroke="black" d="M76588.44,-211.82C76620.53,-219.28 76655.97,-226.24 76689,-230 77131.03,-280.33 92260.35,-251.41 92705,-266 93252.25,-283.96 94653.18,-224.86 95164,-422 95179.85,-428.12 95195.06,-438.37 95208.07,-449.03"/>
<polygon fill="black" stroke="black" points="95206,-451.86 95215.88,-455.69 95210.54,-446.54 95206,-451.86"/>
</g>
<!-- layer0_final_concat&#45;&gt;layer1_gpu11_ln1 -->
<g id="edge160" class="edge">
<title>layer0_final_concat&#45;&gt;layer1_gpu11_ln1</title>
<path fill="none" stroke="black" d="M76588.44,-211.83C76620.53,-219.29 76655.97,-226.25 76689,-230 76996.41,-264.91 98655.77,-255.97 98965,-266 99513.36,-283.79 100917.13,-224.49 101429,-422 101444.85,-428.12 101460.06,-438.36 101473.07,-449.03"/>
<polygon fill="black" stroke="black" points="101471,-451.86 101480.88,-455.69 101475.54,-446.53 101471,-451.86"/>
</g>
<!-- layer0_final_concat&#45;&gt;layer1_gpu12_ln1 -->
<g id="edge161" class="edge">
<title>layer0_final_concat&#45;&gt;layer1_gpu12_ln1</title>
<path fill="none" stroke="black" d="M76588.44,-211.84C76620.53,-219.3 76655.97,-226.25 76689,-230 77072.87,-273.53 104119.06,-248.48 104505,-266 105280.64,-301.2 105524.34,-133.03 106245,-422 106260.77,-428.32 106275.96,-438.63 106288.97,-449.29"/>
<polygon fill="black" stroke="black" points="106286.9,-452.12 106296.78,-455.93 106291.44,-446.79 106286.9,-452.12"/>
</g>
<!-- layer0_final_concat&#45;&gt;layer1_gpu13_ln1 -->
<g id="edge162" class="edge">
<title>layer0_final_concat&#45;&gt;layer1_gpu13_ln1</title>
<path fill="none" stroke="black" d="M76588.44,-211.85C76620.53,-219.3 76655.97,-226.26 76689,-230 77159.33,-283.27 110296.15,-244.6 110769,-266 111544.64,-301.11 111788.34,-133.03 112509,-422 112524.77,-428.32 112539.96,-438.63 112552.97,-449.29"/>
<polygon fill="black" stroke="black" points="112550.9,-452.12 112560.78,-455.93 112555.44,-446.79 112550.9,-452.12"/>
</g>
<!-- layer0_final_concat&#45;&gt;layer1_gpu14_ln1 -->
<g id="edge163" class="edge">
<title>layer0_final_concat&#45;&gt;layer1_gpu14_ln1</title>
<path fill="none" stroke="black" d="M76588.44,-211.85C76620.53,-219.31 76655.97,-226.26 76689,-230 77271.13,-295.88 118284.79,-238.76 118870,-266 119448.72,-292.94 119589.75,-350.34 120168,-386 120296.82,-393.94 121207.86,-377.49 121329,-422 121345.09,-427.91 121360.46,-438.22 121373.55,-449"/>
<polygon fill="black" stroke="black" points="121371.52,-451.87 121381.39,-455.74 121376.09,-446.57 121371.52,-451.87"/>
</g>
<!-- layer0_final_concat&#45;&gt;layer1_gpu15_ln1 -->
<g id="edge164" class="edge">
<title>layer0_final_concat&#45;&gt;layer1_gpu15_ln1</title>
<path fill="none" stroke="black" d="M76588.44,-211.85C76620.53,-219.31 76655.97,-226.26 76689,-230 77023.26,-267.81 124792.97,-250.4 125129,-266 125708.61,-292.91 125849.86,-350.35 126429,-386 126558.15,-393.95 127471.54,-377.38 127593,-422 127609.1,-427.91 127624.46,-438.22 127637.55,-449"/>
<polygon fill="black" stroke="black" points="127635.52,-451.87 127645.39,-455.74 127640.09,-446.57 127635.52,-451.87"/>
</g>
<!-- layer1_final_concat&#45;&gt;layer2_gpu0_ln1 -->
<g id="edge169" class="edge">
<title>layer1_final_concat&#45;&gt;layer2_gpu0_ln1</title>
<path fill="none" stroke="black" d="M75386.5,-182.46C72545.2,-181.71 25241.08,-170.65 19169,-266 18010.4,-284.19 15044.85,-22.92 13957,-422 13940.9,-427.91 13925.53,-438.21 13912.45,-448.99"/>
<polygon fill="black" stroke="black" points="13909.91,-446.56 13904.61,-455.73 13914.47,-451.86 13909.91,-446.56"/>
</g>
<!-- layer1_final_concat&#45;&gt;layer2_gpu1_ln1 -->
<g id="edge170" class="edge">
<title>layer1_final_concat&#45;&gt;layer2_gpu1_ln1</title>
<path fill="none" stroke="black" d="M75386.34,-182.54C71939.54,-183.57 2980.7,-205.02 2490,-266 2207.6,-301.09 2124.03,-295.74 1869,-422 1854.19,-429.33 1839.56,-439.62 1826.78,-449.93"/>
<polygon fill="black" stroke="black" points="1824.52,-447.25 1819.06,-456.33 1828.99,-452.64 1824.52,-447.25"/>
</g>
<!-- layer1_final_concat&#45;&gt;layer2_gpu2_ln1 -->
<g id="edge171" class="edge">
<title>layer1_final_concat&#45;&gt;layer2_gpu2_ln1</title>
<path fill="none" stroke="black" d="M75386.39,-182.56C72538.55,-183.83 25120.04,-205.86 25060,-266 25022.32,-303.74 25022.51,-348.06 25060,-386 25118.77,-445.48 27991.16,-394.14 28070,-422 28086.59,-427.86 28102.41,-438.4 28115.81,-449.41"/>
<polygon fill="black" stroke="black" points="28113.53,-452.06 28123.41,-455.91 28118.09,-446.75 28113.53,-452.06"/>
</g>
<!-- layer1_final_concat&#45;&gt;layer2_gpu3_ln1 -->
<g id="edge172" class="edge">
<title>layer1_final_concat&#45;&gt;layer2_gpu3_ln1</title>
<path fill="none" stroke="black" d="M75386.39,-182.44C73157.71,-181.45 43770.99,-170.32 41981,-266 41316.11,-301.54 41107.87,-171.37 40491,-422 40475.14,-428.44 40459.81,-438.78 40446.63,-449.43"/>
<polygon fill="black" stroke="black" points="40444.13,-446.96 40438.72,-456.07 40448.63,-452.32 40444.13,-446.96"/>
</g>
<!-- layer1_final_concat&#45;&gt;layer2_gpu4_ln1 -->
<g id="edge173" class="edge">
<title>layer1_final_concat&#45;&gt;layer2_gpu4_ln1</title>
<path fill="none" stroke="black" d="M75386.17,-182.46C73395.23,-181.92 49857.06,-177.46 49710,-266 49646.43,-304.27 49614.92,-389.29 49600.85,-442.59"/>
<polygon fill="black" stroke="black" points="49597.41,-441.93 49598.34,-452.48 49604.19,-443.65 49597.41,-441.93"/>
</g>
<!-- layer1_final_concat&#45;&gt;layer2_gpu5_ln1 -->
<g id="edge174" class="edge">
<title>layer1_final_concat&#45;&gt;layer2_gpu5_ln1</title>
<path fill="none" stroke="black" d="M75386.21,-182.6C73673.31,-183.94 56086.58,-199.35 55976,-266 55912.45,-304.31 55880.93,-389.31 55866.86,-442.6"/>
<polygon fill="black" stroke="black" points="55863.42,-441.94 55864.35,-452.49 55870.2,-443.66 55863.42,-441.94"/>
</g>
<!-- layer1_final_concat&#45;&gt;layer2_gpu6_ln1 -->
<g id="edge175" class="edge">
<title>layer1_final_concat&#45;&gt;layer2_gpu6_ln1</title>
<path fill="none" stroke="black" d="M75386.3,-182.74C74039.65,-185.25 62972.94,-207.68 62915,-266 62877.41,-303.84 62877.73,-347.85 62915,-386 62975.35,-447.77 64387.74,-392.77 64469,-422 64485.25,-427.85 64500.79,-438.13 64514.04,-448.92"/>
<polygon fill="black" stroke="black" points="64512.09,-451.85 64521.97,-455.66 64516.62,-446.52 64512.09,-451.85"/>
</g>
<!-- layer1_final_concat&#45;&gt;layer2_gpu7_ln1 -->
<g id="edge176" class="edge">
<title>layer1_final_concat&#45;&gt;layer2_gpu7_ln1</title>
<path fill="none" stroke="black" d="M75386.3,-183.17C74657.52,-187.07 71193.68,-208.6 71100,-266 71036.73,-304.77 71005.12,-389.62 70990.95,-442.76"/>
<polygon fill="black" stroke="black" points="70987.52,-442.06 70988.43,-452.62 70994.3,-443.8 70987.52,-442.06"/>
</g>
<!-- layer1_final_concat&#45;&gt;layer2_gpu8_ln1 -->
<g id="edge177" class="edge">
<title>layer1_final_concat&#45;&gt;layer2_gpu8_ln1</title>
<path fill="none" stroke="black" d="M75653.52,-200.54C75732.12,-210.57 75833.56,-222.51 75924,-230 76807.56,-303.14 79079.47,-109.09 79909,-422 79925.04,-428.05 79940.4,-438.4 79953.48,-449.17"/>
<polygon fill="black" stroke="black" points="79951.46,-452.04 79961.33,-455.9 79956.02,-446.73 79951.46,-452.04"/>
</g>
<!-- layer1_final_concat&#45;&gt;layer2_gpu9_ln1 -->
<g id="edge178" class="edge">
<title>layer1_final_concat&#45;&gt;layer2_gpu9_ln1</title>
<path fill="none" stroke="black" d="M75653.87,-202.05C75732.38,-212.56 75833.6,-224.47 75924,-230 76698.34,-277.37 82130.48,-245.5 82906,-266 83632.8,-285.21 85493.68,-165.54 86174,-422 86190.05,-428.05 86205.4,-438.39 86218.49,-449.17"/>
<polygon fill="black" stroke="black" points="86216.46,-452.04 86226.33,-455.89 86221.02,-446.73 86216.46,-452.04"/>
</g>
<!-- layer1_final_concat&#45;&gt;layer2_gpu10_ln1 -->
<g id="edge179" class="edge">
<title>layer1_final_concat&#45;&gt;layer2_gpu10_ln1</title>
<path fill="none" stroke="black" d="M75653.86,-202.14C75732.37,-212.68 75833.59,-224.59 75924,-230 76720.3,-277.65 89485.55,-245.26 90283,-266 91360.4,-294.03 91627.81,-350.85 92705,-386 92832.11,-390.15 94874.17,-379.39 94994,-422 95010.27,-427.79 95025.82,-438.06 95039.06,-448.84"/>
<polygon fill="black" stroke="black" points="95037.11,-451.78 95047,-455.59 95041.65,-446.45 95037.11,-451.78"/>
</g>
<!-- layer1_final_concat&#45;&gt;layer2_gpu11_ln1 -->
<g id="edge180" class="edge">
<title>layer1_final_concat&#45;&gt;layer2_gpu11_ln1</title>
<path fill="none" stroke="black" d="M75653.86,-202.16C75732.37,-212.71 75833.59,-224.62 75924,-230 77067.48,-297.99 95397.87,-236.65 96543,-266 97620.41,-293.62 97887.81,-350.87 98965,-386 99092.39,-390.15 101138.9,-379.3 101259,-422 101275.27,-427.79 101290.82,-438.06 101304.06,-448.84"/>
<polygon fill="black" stroke="black" points="101302.11,-451.78 101312,-455.59 101306.65,-446.45 101302.11,-451.78"/>
</g>
<!-- layer1_final_concat&#45;&gt;layer2_gpu12_ln1 -->
<g id="edge181" class="edge">
<title>layer1_final_concat&#45;&gt;layer2_gpu12_ln1</title>
<path fill="none" stroke="black" d="M75653.86,-202.18C75732.37,-212.73 75833.59,-224.64 75924,-230 76669.47,-274.17 102061.7,-239.15 102808,-266 103563.62,-293.19 103749.72,-350.66 104505,-386 104592.21,-390.08 105993.94,-392.22 106076,-422 106092.12,-427.85 106107.49,-438.14 106120.58,-448.92"/>
<polygon fill="black" stroke="black" points="106118.55,-451.79 106128.42,-455.66 106123.12,-446.49 106118.55,-451.79"/>
</g>
<!-- layer1_final_concat&#45;&gt;layer2_gpu13_ln1 -->
<g id="edge182" class="edge">
<title>layer1_final_concat&#45;&gt;layer2_gpu13_ln1</title>
<path fill="none" stroke="black" d="M75653.86,-202.19C75732.37,-212.74 75833.59,-224.65 75924,-230 76843.17,-284.35 108151.81,-233.01 109072,-266 109827.62,-293.09 110013.72,-350.66 110769,-386 110856.21,-390.08 112257.94,-392.22 112340,-422 112356.12,-427.85 112371.49,-438.14 112384.58,-448.92"/>
<polygon fill="black" stroke="black" points="112382.55,-451.79 112392.42,-455.66 112387.12,-446.49 112382.55,-451.79"/>
</g>
<!-- layer1_final_concat&#45;&gt;layer2_gpu14_ln1 -->
<g id="edge183" class="edge">
<title>layer1_final_concat&#45;&gt;layer2_gpu14_ln1</title>
<path fill="none" stroke="black" d="M75653.86,-202.19C75732.37,-212.75 75833.58,-224.66 75924,-230 77047.71,-296.33 115322.69,-237.64 116448,-266 117525.42,-293.15 117792.81,-350.85 118870,-386 118997.11,-390.15 121039.17,-379.39 121159,-422 121175.27,-427.79 121190.82,-438.06 121204.06,-448.84"/>
<polygon fill="black" stroke="black" points="121202.11,-451.78 121212,-455.59 121206.65,-446.45 121202.11,-451.78"/>
</g>
<!-- layer1_final_concat&#45;&gt;layer2_gpu15_ln1 -->
<g id="edge184" class="edge">
<title>layer1_final_concat&#45;&gt;layer2_gpu15_ln1</title>
<path fill="none" stroke="black" d="M75653.86,-202.2C75732.37,-212.76 75833.58,-224.67 75924,-230 76572.64,-268.25 122057.44,-249.67 122707,-266 123784.42,-293.09 124051.81,-350.87 125129,-386 125256.39,-390.15 127302.9,-379.3 127423,-422 127439.27,-427.79 127454.82,-438.06 127468.06,-448.84"/>
<polygon fill="black" stroke="black" points="127466.11,-451.78 127476,-455.59 127470.65,-446.45 127466.11,-451.78"/>
</g>
<!-- layer2_final_concat&#45;&gt;layer3_gpu0_ln1 -->
<g id="edge189" class="edge">
<title>layer2_final_concat&#45;&gt;layer3_gpu0_ln1</title>
<path fill="none" stroke="black" d="M76723.82,-211.91C76691.95,-219.35 76656.79,-226.27 76624,-230 76535.05,-240.11 25138.41,-222.81 25060,-266 25004.7,-296.46 25039.24,-355.43 24984,-386 24889.49,-438.3 17308.97,-386.38 17207,-422 17190.39,-427.8 17174.56,-438.32 17161.16,-449.33"/>
<polygon fill="black" stroke="black" points="17158.89,-446.68 17153.57,-455.84 17163.44,-451.99 17158.89,-446.68"/>
</g>
<!-- layer2_final_concat&#45;&gt;layer3_gpu1_ln1 -->
<g id="edge190" class="edge">
<title>layer2_final_concat&#45;&gt;layer3_gpu1_ln1</title>
<path fill="none" stroke="black" d="M76723.82,-211.92C76691.95,-219.35 76656.79,-226.28 76624,-230 76401.36,-255.28 12316.06,-264.01 12092,-266 11587.28,-270.47 3483.45,-252.56 3008,-422 2991.73,-427.8 2976.19,-438.07 2962.94,-448.86"/>
<polygon fill="black" stroke="black" points="2960.36,-446.46 2955.01,-455.6 2964.89,-451.79 2960.36,-446.46"/>
</g>
<!-- layer2_final_concat&#45;&gt;layer3_gpu2_ln1 -->
<g id="edge191" class="edge">
<title>layer2_final_concat&#45;&gt;layer3_gpu2_ln1</title>
<path fill="none" stroke="black" d="M76723.82,-211.91C76691.95,-219.34 76656.79,-226.27 76624,-230 76353.45,-260.77 37686.27,-262.44 37414,-266 37371.08,-266.56 31275.37,-407.43 31235,-422 31218.75,-427.86 31203.22,-438.16 31189.97,-448.94"/>
<polygon fill="black" stroke="black" points="31187.39,-446.54 31182.04,-455.68 31191.92,-451.87 31187.39,-446.54"/>
</g>
<!-- layer2_final_concat&#45;&gt;layer3_gpu3_ln1 -->
<g id="edge192" class="edge">
<title>layer2_final_concat&#45;&gt;layer3_gpu3_ln1</title>
<path fill="none" stroke="black" d="M76723.82,-211.9C76691.95,-219.33 76656.79,-226.26 76624,-230 76249.74,-272.64 49879.65,-261 49503,-266 49417.16,-267.14 43404.75,-392.86 43324,-422 43307.75,-427.86 43292.22,-438.16 43278.97,-448.94"/>
<polygon fill="black" stroke="black" points="43276.39,-446.54 43271.04,-455.68 43280.92,-451.87 43276.39,-446.54"/>
</g>
<!-- layer2_final_concat&#45;&gt;layer3_gpu4_ln1 -->
<g id="edge193" class="edge">
<title>layer2_final_concat&#45;&gt;layer3_gpu4_ln1</title>
<path fill="none" stroke="black" d="M76723.82,-211.89C76691.95,-219.33 76656.79,-226.26 76624,-230 76336.22,-262.85 56058.61,-260.96 55769,-266 55703.47,-267.14 51114.56,-399.51 51053,-422 51036.78,-427.93 51021.24,-438.24 51008,-449.02"/>
<polygon fill="black" stroke="black" points="51005.42,-446.61 51000.06,-455.75 51009.95,-451.95 51005.42,-446.61"/>
</g>
<!-- layer2_final_concat&#45;&gt;layer3_gpu5_ln1 -->
<g id="edge194" class="edge">
<title>layer2_final_concat&#45;&gt;layer3_gpu5_ln1</title>
<path fill="none" stroke="black" d="M76723.82,-211.87C76691.95,-219.31 76656.79,-226.24 76624,-230 76529.42,-240.84 62998.34,-219.99 62915,-266 62859.73,-296.51 62894.19,-355.36 62839,-386 62720.85,-451.6 58101.52,-377.26 57974,-422 57957.4,-427.82 57941.57,-438.35 57928.17,-449.36"/>
<polygon fill="black" stroke="black" points="57925.9,-446.7 57920.58,-455.87 57930.45,-452.02 57925.9,-446.7"/>
</g>
<!-- layer2_final_concat&#45;&gt;layer3_gpu6_ln1 -->
<g id="edge195" class="edge">
<title>layer2_final_concat&#45;&gt;layer3_gpu6_ln1</title>
<path fill="none" stroke="black" d="M76723.54,-211.89C76691.75,-219.3 76656.69,-226.21 76624,-230 76227.81,-275.88 69843.7,-255.49 69445,-266 69354.18,-268.4 66263.11,-390.2 66178,-422 66161.82,-428.05 66146.3,-438.39 66133.05,-449.16"/>
<polygon fill="black" stroke="black" points="66130.48,-446.76 66125.11,-455.89 66135,-452.1 66130.48,-446.76"/>
</g>
<!-- layer2_final_concat&#45;&gt;layer3_gpu7_ln1 -->
<g id="edge196" class="edge">
<title>layer2_final_concat&#45;&gt;layer3_gpu7_ln1</title>
<path fill="none" stroke="black" d="M76722.39,-211.43C76690.87,-218.73 76656.25,-225.71 76624,-230 76219.26,-283.89 76113.93,-248.25 75706,-266 74980.75,-297.56 73123,-167.87 72443,-422 72426.82,-428.05 72411.3,-438.39 72398.05,-449.16"/>
<polygon fill="black" stroke="black" points="72395.48,-446.76 72390.11,-455.89 72400.01,-452.1 72395.48,-446.76"/>
</g>
<!-- layer2_final_concat&#45;&gt;layer3_gpu8_ln1 -->
<g id="edge197" class="edge">
<title>layer2_final_concat&#45;&gt;layer3_gpu8_ln1</title>
<path fill="none" stroke="black" d="M76964.62,-182.97C77527.33,-185.34 79706.49,-198.79 80390,-266 80791.84,-305.51 80916.33,-257.34 81285,-422 81300.34,-428.85 81315.34,-439.1 81328.36,-449.52"/>
<polygon fill="black" stroke="black" points="81326.26,-452.33 81336.2,-456.01 81330.73,-446.94 81326.26,-452.33"/>
</g>
<!-- layer2_final_concat&#45;&gt;layer3_gpu9_ln1 -->
<g id="edge198" class="edge">
<title>layer2_final_concat&#45;&gt;layer3_gpu9_ln1</title>
<path fill="none" stroke="black" d="M76964.73,-182.71C78343.13,-184.9 89914.49,-205.11 89975,-266 90012.59,-303.83 90012.29,-347.87 89975,-386 89912.84,-449.57 88458.67,-391.93 88375,-422 88358.75,-427.84 88343.2,-438.13 88329.96,-448.91"/>
<polygon fill="black" stroke="black" points="88327.38,-446.51 88322.03,-455.65 88331.91,-451.85 88327.38,-446.51"/>
</g>
<!-- layer2_final_concat&#45;&gt;layer3_gpu10_ln1 -->
<g id="edge199" class="edge">
<title>layer2_final_concat&#45;&gt;layer3_gpu10_ln1</title>
<path fill="none" stroke="black" d="M76964.71,-182.67C78625.68,-184.8 95211.4,-207.57 95706,-266 96007.05,-301.56 96096.92,-290.38 96370,-422 96385,-429.23 96399.8,-439.48 96412.74,-449.8"/>
<polygon fill="black" stroke="black" points="96410.59,-452.56 96420.54,-456.2 96415.03,-447.15 96410.59,-452.56"/>
</g>
<!-- layer2_final_concat&#45;&gt;layer3_gpu11_ln1 -->
<g id="edge200" class="edge">
<title>layer2_final_concat&#45;&gt;layer3_gpu11_ln1</title>
<path fill="none" stroke="black" d="M76964.8,-182.52C78905.17,-182.82 101307.5,-187.99 101971,-266 102272.07,-301.4 102361.92,-290.38 102635,-422 102650,-429.23 102664.8,-439.48 102677.74,-449.8"/>
<polygon fill="black" stroke="black" points="102675.59,-452.56 102685.54,-456.2 102680.03,-447.15 102675.59,-452.56"/>
</g>
<!-- layer2_final_concat&#45;&gt;layer3_gpu12_ln1 -->
<g id="edge201" class="edge">
<title>layer2_final_concat&#45;&gt;layer3_gpu12_ln1</title>
<path fill="none" stroke="black" d="M76964.55,-182.44C79094.34,-181.61 105993.29,-172.89 106787,-266 107088.08,-301.32 107177.92,-290.38 107451,-422 107466,-429.23 107480.8,-439.48 107493.74,-449.8"/>
<polygon fill="black" stroke="black" points="107491.59,-452.56 107501.54,-456.2 107496.03,-447.15 107491.59,-452.56"/>
</g>
<!-- layer2_final_concat&#45;&gt;layer3_gpu13_ln1 -->
<g id="edge202" class="edge">
<title>layer2_final_concat&#45;&gt;layer3_gpu13_ln1</title>
<path fill="none" stroke="black" d="M76964.83,-182.46C79461.23,-181.73 116046.88,-172.68 116140,-266 116177.67,-303.75 116177.29,-347.87 116140,-386 116077.84,-449.57 114623.67,-391.93 114540,-422 114523.75,-427.84 114508.2,-438.13 114494.96,-448.91"/>
<polygon fill="black" stroke="black" points="114492.38,-446.51 114487.03,-455.65 114496.91,-451.85 114492.38,-446.51"/>
</g>
<!-- layer2_final_concat&#45;&gt;layer3_gpu14_ln1 -->
<g id="edge203" class="edge">
<title>layer2_final_concat&#45;&gt;layer3_gpu14_ln1</title>
<path fill="none" stroke="black" d="M76964.85,-182.57C79559,-183.86 119005.42,-204.55 120168,-266 120836.89,-301.36 121047.09,-168.28 121667,-422 121682.73,-428.44 121697.9,-438.78 121710.92,-449.43"/>
<polygon fill="black" stroke="black" points="121708.84,-452.26 121718.73,-456.06 121713.37,-446.92 121708.84,-452.26"/>
</g>
<!-- layer2_final_concat&#45;&gt;layer3_gpu15_ln1 -->
<g id="edge204" class="edge">
<title>layer2_final_concat&#45;&gt;layer3_gpu15_ln1</title>
<path fill="none" stroke="black" d="M76964.6,-182.53C79747.75,-183.24 125095.42,-195.81 126429,-266 127099.22,-301.28 127309.84,-167.84 127931,-422 127946.73,-428.44 127961.9,-438.77 127974.92,-449.42"/>
<polygon fill="black" stroke="black" points="127972.84,-452.25 127982.73,-456.06 127977.38,-446.92 127972.84,-452.25"/>
</g>
<!-- final_output -->
<g id="node681" class="node">
<title>final_output</title>
<polygon fill="green" stroke="black" points="76152,-30.07 76152,-66.93 76101.62,-93 76030.38,-93 75980,-66.93 75980,-30.07 76030.38,-4 76101.62,-4 76152,-30.07"/>
<polygon fill="none" stroke="black" points="76156,-27.63 76156,-69.37 76102.6,-97 76029.4,-97 75976,-69.37 75976,-27.63 76029.4,0 76102.6,0 76156,-27.63"/>
<text text-anchor="middle" x="76066" y="-59.8" font-family="Times,serif" font-size="14.00">Final Output</text>
<text text-anchor="middle" x="76066" y="-44.8" font-family="Times,serif" font-size="14.00">[B,L,8192]</text>
<text text-anchor="middle" x="76066" y="-29.8" font-family="Times,serif" font-size="14.00">All GPUs</text>
</g>
<!-- layer3_final_concat&#45;&gt;final_output -->
<g id="edge209" class="edge">
<title>layer3_final_concat&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M75975.14,-145.39C75960.57,-125.59 75961.32,-101.02 75977.41,-81.71"/>
<polygon fill="black" stroke="black" points="75980.14,-83.92 75984.62,-74.32 75975.13,-79.03 75980.14,-83.92"/>
</g>
<!-- layer3_final_concat&#45;&gt;final_output -->
<g id="edge210" class="edge">
<title>layer3_final_concat&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M75985.19,-141.9C75975.57,-124.26 75975.95,-103.47 75986.34,-86.08"/>
<polygon fill="black" stroke="black" points="75989.27,-88.01 75992.25,-77.84 75983.58,-83.93 75989.27,-88.01"/>
</g>
<!-- layer3_final_concat&#45;&gt;final_output -->
<g id="edge211" class="edge">
<title>layer3_final_concat&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M75996.11,-138.33C75990.28,-123.34 75990.3,-106.48 75996.17,-91.5"/>
<polygon fill="black" stroke="black" points="75999.35,-92.98 76000.58,-82.45 75993.05,-89.91 75999.35,-92.98"/>
</g>
<!-- layer3_final_concat&#45;&gt;final_output -->
<g id="edge212" class="edge">
<title>layer3_final_concat&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M76007.66,-134.31C76004.59,-122.34 76004.45,-109.43 76007.25,-97.37"/>
<polygon fill="black" stroke="black" points="76010.69,-98.08 76010.29,-87.49 76004,-96.02 76010.69,-98.08"/>
</g>
<!-- layer3_final_concat&#45;&gt;final_output -->
<g id="edge213" class="edge">
<title>layer3_final_concat&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M76020.34,-132.84C76018.58,-123.17 76018.28,-112.95 76019.45,-103.09"/>
<polygon fill="black" stroke="black" points="76022.94,-103.45 76021.2,-93 76016.04,-102.25 76022.94,-103.45"/>
</g>
<!-- layer3_final_concat&#45;&gt;final_output -->
<g id="edge214" class="edge">
<title>layer3_final_concat&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M76033.39,-132.84C76032.31,-124.62 76032,-115.99 76032.45,-107.54"/>
<polygon fill="black" stroke="black" points="76035.95,-107.62 76033.36,-97.35 76028.98,-106.99 76035.95,-107.62"/>
</g>
<!-- layer3_final_concat&#45;&gt;final_output -->
<g id="edge215" class="edge">
<title>layer3_final_concat&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M76046.43,-132.84C76045.79,-124.62 76045.6,-115.99 76045.87,-107.54"/>
<polygon fill="black" stroke="black" points="76049.37,-107.52 76046.42,-97.35 76042.38,-107.15 76049.37,-107.52"/>
</g>
<!-- layer3_final_concat&#45;&gt;final_output -->
<g id="edge216" class="edge">
<title>layer3_final_concat&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M76059.48,-132.84C76059.26,-124.62 76059.2,-115.99 76059.29,-107.54"/>
<polygon fill="black" stroke="black" points="76062.79,-107.41 76059.47,-97.35 76055.79,-107.28 76062.79,-107.41"/>
</g>
<!-- layer3_final_concat&#45;&gt;final_output -->
<g id="edge217" class="edge">
<title>layer3_final_concat&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M76072.52,-132.84C76072.74,-124.62 76072.8,-115.99 76072.71,-107.54"/>
<polygon fill="black" stroke="black" points="76076.21,-107.28 76072.53,-97.35 76069.21,-107.41 76076.21,-107.28"/>
</g>
<!-- layer3_final_concat&#45;&gt;final_output -->
<g id="edge218" class="edge">
<title>layer3_final_concat&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M76085.57,-132.84C76086.21,-124.62 76086.4,-115.99 76086.13,-107.54"/>
<polygon fill="black" stroke="black" points="76089.62,-107.15 76085.58,-97.35 76082.63,-107.52 76089.62,-107.15"/>
</g>
<!-- layer3_final_concat&#45;&gt;final_output -->
<g id="edge219" class="edge">
<title>layer3_final_concat&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M76098.61,-132.84C76099.69,-124.62 76100,-115.99 76099.55,-107.54"/>
<polygon fill="black" stroke="black" points="76103.02,-106.99 76098.64,-97.35 76096.05,-107.62 76103.02,-106.99"/>
</g>
<!-- layer3_final_concat&#45;&gt;final_output -->
<g id="edge220" class="edge">
<title>layer3_final_concat&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M76111.66,-132.84C76113.42,-123.17 76113.72,-112.95 76112.55,-103.09"/>
<polygon fill="black" stroke="black" points="76115.96,-102.25 76110.8,-93 76109.06,-103.45 76115.96,-102.25"/>
</g>
<!-- layer3_final_concat&#45;&gt;final_output -->
<g id="edge221" class="edge">
<title>layer3_final_concat&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M76124.34,-134.31C76127.41,-122.34 76127.55,-109.43 76124.75,-97.37"/>
<polygon fill="black" stroke="black" points="76128,-96.02 76121.71,-87.49 76121.31,-98.08 76128,-96.02"/>
</g>
<!-- layer3_final_concat&#45;&gt;final_output -->
<g id="edge222" class="edge">
<title>layer3_final_concat&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M76135.89,-138.33C76141.72,-123.34 76141.7,-106.48 76135.83,-91.5"/>
<polygon fill="black" stroke="black" points="76138.95,-89.91 76131.42,-82.45 76132.65,-92.98 76138.95,-89.91"/>
</g>
<!-- layer3_final_concat&#45;&gt;final_output -->
<g id="edge223" class="edge">
<title>layer3_final_concat&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M76146.81,-141.9C76156.43,-124.26 76156.05,-103.47 76145.66,-86.08"/>
<polygon fill="black" stroke="black" points="76148.42,-83.93 76139.75,-77.84 76142.73,-88.01 76148.42,-83.93"/>
</g>
<!-- layer3_final_concat&#45;&gt;final_output -->
<g id="edge224" class="edge">
<title>layer3_final_concat&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M76156.86,-145.39C76171.43,-125.59 76170.68,-101.02 76154.59,-81.71"/>
<polygon fill="black" stroke="black" points="76156.87,-79.03 76147.38,-74.32 76151.86,-83.92 76156.87,-79.03"/>
</g>
</g>
</svg>
