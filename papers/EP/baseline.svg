<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: baseline_moe_deployment Pages: 1 -->
<svg width="1440pt" height="90pt"
 viewBox="0.00 0.00 1440.00 90.48" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.1 0.1) rotate(0) translate(4 896.81)">
<title>baseline_moe_deployment</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-896.81 14332,-896.81 14332,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_stage0</title>
<path fill="none" stroke="black" d="M7180,-231.98C7180,-231.98 14308,-231.98 14308,-231.98 14314,-231.98 14320,-237.98 14320,-243.98 14320,-243.98 14320,-763.81 14320,-763.81 14320,-769.81 14314,-775.81 14308,-775.81 14308,-775.81 7180,-775.81 7180,-775.81 7174,-775.81 7168,-769.81 7168,-763.81 7168,-763.81 7168,-243.98 7168,-243.98 7168,-237.98 7174,-231.98 7180,-231.98"/>
<text text-anchor="middle" x="10744" y="-760.61" font-family="Times,serif" font-size="14.00">Pipeline Stage 0 (Layers 0&#45;1)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_GPU_0</title>
<path fill="none" stroke="lightblue" d="M7188,-239.98C7188,-239.98 8049,-239.98 8049,-239.98 8055,-239.98 8061,-245.98 8061,-251.98 8061,-251.98 8061,-732.81 8061,-732.81 8061,-738.81 8055,-744.81 8049,-744.81 8049,-744.81 7188,-744.81 7188,-744.81 7182,-744.81 7176,-738.81 7176,-732.81 7176,-732.81 7176,-251.98 7176,-251.98 7176,-245.98 7182,-239.98 7188,-239.98"/>
<text text-anchor="middle" x="7618.5" y="-729.61" font-family="Times,serif" font-size="14.00">GPU_0 (4 experts)</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_GPU_1</title>
<path fill="none" stroke="lightgreen" d="M8081,-239.98C8081,-239.98 8942,-239.98 8942,-239.98 8948,-239.98 8954,-245.98 8954,-251.98 8954,-251.98 8954,-732.81 8954,-732.81 8954,-738.81 8948,-744.81 8942,-744.81 8942,-744.81 8081,-744.81 8081,-744.81 8075,-744.81 8069,-738.81 8069,-732.81 8069,-732.81 8069,-251.98 8069,-251.98 8069,-245.98 8075,-239.98 8081,-239.98"/>
<text text-anchor="middle" x="8511.5" y="-729.61" font-family="Times,serif" font-size="14.00">GPU_1 (4 experts)</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_GPU_2</title>
<path fill="none" stroke="lightyellow" d="M8974,-239.98C8974,-239.98 9835,-239.98 9835,-239.98 9841,-239.98 9847,-245.98 9847,-251.98 9847,-251.98 9847,-732.81 9847,-732.81 9847,-738.81 9841,-744.81 9835,-744.81 9835,-744.81 8974,-744.81 8974,-744.81 8968,-744.81 8962,-738.81 8962,-732.81 8962,-732.81 8962,-251.98 8962,-251.98 8962,-245.98 8968,-239.98 8974,-239.98"/>
<text text-anchor="middle" x="9404.5" y="-729.61" font-family="Times,serif" font-size="14.00">GPU_2 (4 experts)</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_GPU_3</title>
<path fill="none" stroke="lightpink" d="M9867,-239.98C9867,-239.98 10728,-239.98 10728,-239.98 10734,-239.98 10740,-245.98 10740,-251.98 10740,-251.98 10740,-732.81 10740,-732.81 10740,-738.81 10734,-744.81 10728,-744.81 10728,-744.81 9867,-744.81 9867,-744.81 9861,-744.81 9855,-738.81 9855,-732.81 9855,-732.81 9855,-251.98 9855,-251.98 9855,-245.98 9861,-239.98 9867,-239.98"/>
<text text-anchor="middle" x="10297.5" y="-729.61" font-family="Times,serif" font-size="14.00">GPU_3 (4 experts)</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_GPU_4</title>
<path fill="none" stroke="lightblue" d="M10760,-239.98C10760,-239.98 11621,-239.98 11621,-239.98 11627,-239.98 11633,-245.98 11633,-251.98 11633,-251.98 11633,-732.81 11633,-732.81 11633,-738.81 11627,-744.81 11621,-744.81 11621,-744.81 10760,-744.81 10760,-744.81 10754,-744.81 10748,-738.81 10748,-732.81 10748,-732.81 10748,-251.98 10748,-251.98 10748,-245.98 10754,-239.98 10760,-239.98"/>
<text text-anchor="middle" x="11190.5" y="-729.61" font-family="Times,serif" font-size="14.00">GPU_4 (4 experts)</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_GPU_5</title>
<path fill="none" stroke="lightgreen" d="M11653,-239.98C11653,-239.98 12514,-239.98 12514,-239.98 12520,-239.98 12526,-245.98 12526,-251.98 12526,-251.98 12526,-732.81 12526,-732.81 12526,-738.81 12520,-744.81 12514,-744.81 12514,-744.81 11653,-744.81 11653,-744.81 11647,-744.81 11641,-738.81 11641,-732.81 11641,-732.81 11641,-251.98 11641,-251.98 11641,-245.98 11647,-239.98 11653,-239.98"/>
<text text-anchor="middle" x="12083.5" y="-729.61" font-family="Times,serif" font-size="14.00">GPU_5 (4 experts)</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_GPU_6</title>
<path fill="none" stroke="lightyellow" d="M12546,-239.98C12546,-239.98 13407,-239.98 13407,-239.98 13413,-239.98 13419,-245.98 13419,-251.98 13419,-251.98 13419,-732.81 13419,-732.81 13419,-738.81 13413,-744.81 13407,-744.81 13407,-744.81 12546,-744.81 12546,-744.81 12540,-744.81 12534,-738.81 12534,-732.81 12534,-732.81 12534,-251.98 12534,-251.98 12534,-245.98 12540,-239.98 12546,-239.98"/>
<text text-anchor="middle" x="12976.5" y="-729.61" font-family="Times,serif" font-size="14.00">GPU_6 (4 experts)</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_GPU_7</title>
<path fill="none" stroke="lightpink" d="M13439,-239.98C13439,-239.98 14300,-239.98 14300,-239.98 14306,-239.98 14312,-245.98 14312,-251.98 14312,-251.98 14312,-732.81 14312,-732.81 14312,-738.81 14306,-744.81 14300,-744.81 14300,-744.81 13439,-744.81 13439,-744.81 13433,-744.81 13427,-738.81 13427,-732.81 13427,-732.81 13427,-251.98 13427,-251.98 13427,-245.98 13433,-239.98 13439,-239.98"/>
<text text-anchor="middle" x="13869.5" y="-729.61" font-family="Times,serif" font-size="14.00">GPU_7 (4 experts)</text>
</g>
<g id="clust10" class="cluster">
<title>cluster_stage1</title>
<path fill="none" stroke="black" d="M20,-117C20,-117 7148,-117 7148,-117 7154,-117 7160,-123 7160,-129 7160,-129 7160,-599.86 7160,-599.86 7160,-605.86 7154,-611.86 7148,-611.86 7148,-611.86 20,-611.86 20,-611.86 14,-611.86 8,-605.86 8,-599.86 8,-599.86 8,-129 8,-129 8,-123 14,-117 20,-117"/>
<text text-anchor="middle" x="3584" y="-596.66" font-family="Times,serif" font-size="14.00">Pipeline Stage 1 (Layers 2&#45;3)</text>
</g>
<g id="clust11" class="cluster">
<title>cluster_GPU_8</title>
<path fill="none" stroke="lightblue" d="M28,-125C28,-125 889,-125 889,-125 895,-125 901,-131 901,-137 901,-137 901,-568.86 901,-568.86 901,-574.86 895,-580.86 889,-580.86 889,-580.86 28,-580.86 28,-580.86 22,-580.86 16,-574.86 16,-568.86 16,-568.86 16,-137 16,-137 16,-131 22,-125 28,-125"/>
<text text-anchor="middle" x="458.5" y="-565.66" font-family="Times,serif" font-size="14.00">GPU_8 (4 experts)</text>
</g>
<g id="clust12" class="cluster">
<title>cluster_GPU_9</title>
<path fill="none" stroke="lightgreen" d="M921,-125C921,-125 1782,-125 1782,-125 1788,-125 1794,-131 1794,-137 1794,-137 1794,-568.86 1794,-568.86 1794,-574.86 1788,-580.86 1782,-580.86 1782,-580.86 921,-580.86 921,-580.86 915,-580.86 909,-574.86 909,-568.86 909,-568.86 909,-137 909,-137 909,-131 915,-125 921,-125"/>
<text text-anchor="middle" x="1351.5" y="-565.66" font-family="Times,serif" font-size="14.00">GPU_9 (4 experts)</text>
</g>
<g id="clust13" class="cluster">
<title>cluster_GPU_10</title>
<path fill="none" stroke="lightyellow" d="M1814,-125C1814,-125 2675,-125 2675,-125 2681,-125 2687,-131 2687,-137 2687,-137 2687,-568.86 2687,-568.86 2687,-574.86 2681,-580.86 2675,-580.86 2675,-580.86 1814,-580.86 1814,-580.86 1808,-580.86 1802,-574.86 1802,-568.86 1802,-568.86 1802,-137 1802,-137 1802,-131 1808,-125 1814,-125"/>
<text text-anchor="middle" x="2244.5" y="-565.66" font-family="Times,serif" font-size="14.00">GPU_10 (4 experts)</text>
</g>
<g id="clust14" class="cluster">
<title>cluster_GPU_11</title>
<path fill="none" stroke="lightpink" d="M2707,-125C2707,-125 3568,-125 3568,-125 3574,-125 3580,-131 3580,-137 3580,-137 3580,-568.86 3580,-568.86 3580,-574.86 3574,-580.86 3568,-580.86 3568,-580.86 2707,-580.86 2707,-580.86 2701,-580.86 2695,-574.86 2695,-568.86 2695,-568.86 2695,-137 2695,-137 2695,-131 2701,-125 2707,-125"/>
<text text-anchor="middle" x="3137.5" y="-565.66" font-family="Times,serif" font-size="14.00">GPU_11 (4 experts)</text>
</g>
<g id="clust15" class="cluster">
<title>cluster_GPU_12</title>
<path fill="none" stroke="lightblue" d="M3600,-125C3600,-125 4461,-125 4461,-125 4467,-125 4473,-131 4473,-137 4473,-137 4473,-568.86 4473,-568.86 4473,-574.86 4467,-580.86 4461,-580.86 4461,-580.86 3600,-580.86 3600,-580.86 3594,-580.86 3588,-574.86 3588,-568.86 3588,-568.86 3588,-137 3588,-137 3588,-131 3594,-125 3600,-125"/>
<text text-anchor="middle" x="4030.5" y="-565.66" font-family="Times,serif" font-size="14.00">GPU_12 (4 experts)</text>
</g>
<g id="clust16" class="cluster">
<title>cluster_GPU_13</title>
<path fill="none" stroke="lightgreen" d="M4493,-125C4493,-125 5354,-125 5354,-125 5360,-125 5366,-131 5366,-137 5366,-137 5366,-568.86 5366,-568.86 5366,-574.86 5360,-580.86 5354,-580.86 5354,-580.86 4493,-580.86 4493,-580.86 4487,-580.86 4481,-574.86 4481,-568.86 4481,-568.86 4481,-137 4481,-137 4481,-131 4487,-125 4493,-125"/>
<text text-anchor="middle" x="4923.5" y="-565.66" font-family="Times,serif" font-size="14.00">GPU_13 (4 experts)</text>
</g>
<g id="clust17" class="cluster">
<title>cluster_GPU_14</title>
<path fill="none" stroke="lightyellow" d="M5386,-125C5386,-125 6247,-125 6247,-125 6253,-125 6259,-131 6259,-137 6259,-137 6259,-568.86 6259,-568.86 6259,-574.86 6253,-580.86 6247,-580.86 6247,-580.86 5386,-580.86 5386,-580.86 5380,-580.86 5374,-574.86 5374,-568.86 5374,-568.86 5374,-137 5374,-137 5374,-131 5380,-125 5386,-125"/>
<text text-anchor="middle" x="5816.5" y="-565.66" font-family="Times,serif" font-size="14.00">GPU_14 (4 experts)</text>
</g>
<g id="clust18" class="cluster">
<title>cluster_GPU_15</title>
<path fill="none" stroke="lightpink" d="M6279,-125C6279,-125 7140,-125 7140,-125 7146,-125 7152,-131 7152,-137 7152,-137 7152,-568.86 7152,-568.86 7152,-574.86 7146,-580.86 7140,-580.86 7140,-580.86 6279,-580.86 6279,-580.86 6273,-580.86 6267,-574.86 6267,-568.86 6267,-568.86 6267,-137 6267,-137 6267,-131 6273,-125 6279,-125"/>
<text text-anchor="middle" x="6709.5" y="-565.66" font-family="Times,serif" font-size="14.00">GPU_15 (4 experts)</text>
</g>
<!-- gpu0_layer0_expert0 -->
<g id="node1" class="node">
<title>gpu0_layer0_expert0</title>
<polygon fill="lightblue" stroke="black" points="7720.5,-300.98 7627.5,-300.98 7627.5,-247.98 7720.5,-247.98 7720.5,-300.98"/>
<text text-anchor="middle" x="7674" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="7674" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="7674" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 0</text>
</g>
<!-- gpu0_layer0_expert1 -->
<g id="node2" class="node">
<title>gpu0_layer0_expert1</title>
<polygon fill="lightblue" stroke="black" points="7831.5,-300.98 7738.5,-300.98 7738.5,-247.98 7831.5,-247.98 7831.5,-300.98"/>
<text text-anchor="middle" x="7785" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="7785" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="7785" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 0</text>
</g>
<!-- gpu0_layer0_expert2 -->
<g id="node3" class="node">
<title>gpu0_layer0_expert2</title>
<polygon fill="lightblue" stroke="black" points="7942.5,-300.98 7849.5,-300.98 7849.5,-247.98 7942.5,-247.98 7942.5,-300.98"/>
<text text-anchor="middle" x="7896" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="7896" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="7896" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 0</text>
</g>
<!-- gpu0_layer0_expert3 -->
<g id="node4" class="node">
<title>gpu0_layer0_expert3</title>
<polygon fill="lightblue" stroke="black" points="8053.5,-300.98 7960.5,-300.98 7960.5,-247.98 8053.5,-247.98 8053.5,-300.98"/>
<text text-anchor="middle" x="8007" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="8007" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="8007" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 0</text>
</g>
<!-- gpu0_layer1_expert0 -->
<g id="node5" class="node">
<title>gpu0_layer1_expert0</title>
<polygon fill="lightblue" stroke="black" points="7276.5,-300.98 7183.5,-300.98 7183.5,-247.98 7276.5,-247.98 7276.5,-300.98"/>
<text text-anchor="middle" x="7230" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="7230" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="7230" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 0</text>
</g>
<!-- gpu8_layer2_expert0 -->
<g id="node113" class="node">
<title>gpu8_layer2_expert0</title>
<polygon fill="lightblue" stroke="black" points="560.5,-186 467.5,-186 467.5,-133 560.5,-133 560.5,-186"/>
<text text-anchor="middle" x="514" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="514" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="514" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 0</text>
</g>
<!-- gpu0_layer1_expert0&#45;&gt;gpu8_layer2_expert0 -->
<g id="edge65" class="edge">
<title>gpu0_layer1_expert0&#45;&gt;gpu8_layer2_expert0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7211.15,-247.83C7197.76,-231.91 7178.27,-212.85 7156,-204 7072.39,-170.77 869.49,-204.66 570.66,-184.78"/>
<polygon fill="red" stroke="red" points="570.94,-181.29 560.63,-183.73 570.21,-188.26 570.94,-181.29"/>
<text text-anchor="middle" x="7213.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu0_layer1_expert1 -->
<g id="node6" class="node">
<title>gpu0_layer1_expert1</title>
<polygon fill="lightblue" stroke="black" points="7387.5,-300.98 7294.5,-300.98 7294.5,-247.98 7387.5,-247.98 7387.5,-300.98"/>
<text text-anchor="middle" x="7341" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="7341" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="7341" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 0</text>
</g>
<!-- gpu8_layer2_expert1 -->
<g id="node114" class="node">
<title>gpu8_layer2_expert1</title>
<polygon fill="lightblue" stroke="black" points="671.5,-186 578.5,-186 578.5,-133 671.5,-133 671.5,-186"/>
<text text-anchor="middle" x="625" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="625" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="625" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 0</text>
</g>
<!-- gpu0_layer1_expert1&#45;&gt;gpu8_layer2_expert1 -->
<g id="edge66" class="edge">
<title>gpu0_layer1_expert1&#45;&gt;gpu8_layer2_expert1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7316.95,-247.73C7300.21,-231.77 7276.4,-212.7 7251,-204 7166.1,-174.91 979.71,-204.75 681.64,-184.78"/>
<polygon fill="red" stroke="red" points="681.95,-181.3 671.63,-183.73 681.21,-188.26 681.95,-181.3"/>
<text text-anchor="middle" x="7312.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu0_layer1_expert2 -->
<g id="node7" class="node">
<title>gpu0_layer1_expert2</title>
<polygon fill="lightblue" stroke="black" points="7498.5,-300.98 7405.5,-300.98 7405.5,-247.98 7498.5,-247.98 7498.5,-300.98"/>
<text text-anchor="middle" x="7452" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="7452" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="7452" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 0</text>
</g>
<!-- gpu8_layer2_expert2 -->
<g id="node115" class="node">
<title>gpu8_layer2_expert2</title>
<polygon fill="lightblue" stroke="black" points="782.5,-186 689.5,-186 689.5,-133 782.5,-133 782.5,-186"/>
<text text-anchor="middle" x="736" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="736" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="736" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 0</text>
</g>
<!-- gpu0_layer1_expert2&#45;&gt;gpu8_layer2_expert2 -->
<g id="edge67" class="edge">
<title>gpu0_layer1_expert2&#45;&gt;gpu8_layer2_expert2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7425.1,-247.91C7405.88,-231.58 7378.46,-212.02 7350,-204 7263.77,-179.71 1090.11,-204.88 792.62,-184.79"/>
<polygon fill="red" stroke="red" points="792.95,-181.3 782.63,-183.73 792.21,-188.26 792.95,-181.3"/>
<text text-anchor="middle" x="7417.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu0_layer1_expert3 -->
<g id="node8" class="node">
<title>gpu0_layer1_expert3</title>
<polygon fill="lightblue" stroke="black" points="7609.5,-300.98 7516.5,-300.98 7516.5,-247.98 7609.5,-247.98 7609.5,-300.98"/>
<text text-anchor="middle" x="7563" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="7563" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="7563" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 0</text>
</g>
<!-- gpu8_layer2_expert3 -->
<g id="node116" class="node">
<title>gpu8_layer2_expert3</title>
<polygon fill="lightblue" stroke="black" points="893.5,-186 800.5,-186 800.5,-133 893.5,-133 893.5,-186"/>
<text text-anchor="middle" x="847" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="847" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="847" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 0</text>
</g>
<!-- gpu0_layer1_expert3&#45;&gt;gpu8_layer2_expert3 -->
<g id="edge68" class="edge">
<title>gpu0_layer1_expert3&#45;&gt;gpu8_layer2_expert3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M7534.77,-247.98C7514.3,-231.44 7485.04,-211.61 7455,-204 7278.63,-159.31 1083.01,-223.66 905,-186 904.53,-185.9 904.06,-185.8 903.59,-185.69"/>
<polygon fill="red" stroke="red" points="904.2,-182.23 893.62,-182.92 902.32,-188.97 904.2,-182.23"/>
<text text-anchor="middle" x="7524.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu0_layer0_mha_qkv -->
<g id="node9" class="node">
<title>gpu0_layer0_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="7943" cy="-676.34" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="7943" y="-687.64" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="7943" y="-672.64" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="7943" y="-657.64" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- gpu0_layer0_mha_attn -->
<g id="node10" class="node">
<title>gpu0_layer0_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="7931" cy="-512.38" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="7931" y="-516.18" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="7931" y="-501.18" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- gpu0_layer0_mha_qkv&#45;&gt;gpu0_layer0_mha_attn -->
<g id="edge1" class="edge">
<title>gpu0_layer0_mha_qkv&#45;&gt;gpu0_layer0_mha_attn</title>
<path fill="none" stroke="black" d="M7940.28,-638.59C7938.3,-611.89 7935.64,-575.95 7933.67,-549.42"/>
<polygon fill="black" stroke="black" points="7937.16,-549.11 7932.93,-539.4 7930.18,-549.63 7937.16,-549.11"/>
</g>
<!-- gpu0_layer0_mha_out -->
<g id="node11" class="node">
<title>gpu0_layer0_mha_out</title>
<ellipse fill="orange" stroke="black" cx="7896" cy="-400.43" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="7896" y="-411.73" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="7896" y="-396.73" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="7896" y="-381.73" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- gpu0_layer0_mha_attn&#45;&gt;gpu0_layer0_mha_out -->
<g id="edge2" class="edge">
<title>gpu0_layer0_mha_attn&#45;&gt;gpu0_layer0_mha_out</title>
<path fill="none" stroke="black" d="M7922.79,-485.6C7919.16,-474.17 7914.76,-460.37 7910.59,-447.28"/>
<polygon fill="black" stroke="black" points="7913.84,-445.92 7907.47,-437.45 7907.16,-448.04 7913.84,-445.92"/>
</g>
<!-- gpu0_layer0_mha_out&#45;&gt;gpu0_layer0_expert0 -->
<g id="edge97" class="edge">
<title>gpu0_layer0_mha_out&#45;&gt;gpu0_layer0_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7849.7,-377.32C7815.64,-360.55 7768.59,-336.3 7729,-311.95 7726.22,-310.24 7723.37,-308.46 7720.52,-306.64"/>
<polygon fill="blue" stroke="blue" points="7722.25,-303.6 7711.95,-301.13 7718.46,-309.49 7722.25,-303.6"/>
<text text-anchor="middle" x="7804.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu0_layer0_mha_out&#45;&gt;gpu0_layer0_expert1 -->
<g id="edge105" class="edge">
<title>gpu0_layer0_mha_out&#45;&gt;gpu0_layer0_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7867.41,-367.51C7851.23,-349.43 7831.01,-326.86 7814.65,-308.59"/>
<polygon fill="blue" stroke="blue" points="7817.18,-306.16 7807.9,-301.05 7811.96,-310.83 7817.18,-306.16"/>
<text text-anchor="middle" x="7869.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu0_layer0_mha_out&#45;&gt;gpu0_layer0_expert2 -->
<g id="edge113" class="edge">
<title>gpu0_layer0_mha_out&#45;&gt;gpu0_layer0_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7896,-362.91C7896,-346.62 7896,-327.5 7896,-311.3"/>
<polygon fill="blue" stroke="blue" points="7899.5,-311.13 7896,-301.13 7892.5,-311.13 7899.5,-311.13"/>
<text text-anchor="middle" x="7917.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu0_layer0_mha_out&#45;&gt;gpu0_layer0_expert3 -->
<g id="edge121" class="edge">
<title>gpu0_layer0_mha_out&#45;&gt;gpu0_layer0_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7924.59,-367.51C7940.77,-349.43 7960.99,-326.86 7977.35,-308.59"/>
<polygon fill="blue" stroke="blue" points="7980.04,-310.83 7984.1,-301.05 7974.82,-306.16 7980.04,-310.83"/>
<text text-anchor="middle" x="7980.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu0_layer1_mha_qkv -->
<g id="node12" class="node">
<title>gpu0_layer1_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="7397" cy="-676.34" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="7397" y="-687.64" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="7397" y="-672.64" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="7397" y="-657.64" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- gpu0_layer1_mha_attn -->
<g id="node13" class="node">
<title>gpu0_layer1_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="7397" cy="-512.38" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="7397" y="-516.18" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="7397" y="-501.18" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- gpu0_layer1_mha_qkv&#45;&gt;gpu0_layer1_mha_attn -->
<g id="edge3" class="edge">
<title>gpu0_layer1_mha_qkv&#45;&gt;gpu0_layer1_mha_attn</title>
<path fill="none" stroke="black" d="M7397,-638.59C7397,-611.89 7397,-575.95 7397,-549.42"/>
<polygon fill="black" stroke="black" points="7400.5,-549.4 7397,-539.4 7393.5,-549.4 7400.5,-549.4"/>
</g>
<!-- gpu0_layer1_mha_out -->
<g id="node14" class="node">
<title>gpu0_layer1_mha_out</title>
<ellipse fill="orange" stroke="black" cx="7397" cy="-400.43" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="7397" y="-411.73" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="7397" y="-396.73" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="7397" y="-381.73" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<!-- gpu0_layer1_mha_attn&#45;&gt;gpu0_layer1_mha_out -->
<g id="edge4" class="edge">
<title>gpu0_layer1_mha_attn&#45;&gt;gpu0_layer1_mha_out</title>
<path fill="none" stroke="black" d="M7397,-485.33C7397,-474.2 7397,-460.87 7397,-448.14"/>
<polygon fill="black" stroke="black" points="7400.5,-448.12 7397,-438.12 7393.5,-448.12 7400.5,-448.12"/>
</g>
<!-- gpu0_layer1_mha_out&#45;&gt;gpu0_layer1_expert0 -->
<g id="edge129" class="edge">
<title>gpu0_layer1_mha_out&#45;&gt;gpu0_layer1_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7357.43,-372.4C7345.03,-363.77 7331.36,-354.08 7319,-344.95 7302.9,-333.06 7285.49,-319.61 7270.37,-307.72"/>
<polygon fill="blue" stroke="blue" points="7272.25,-304.75 7262.23,-301.3 7267.92,-310.24 7272.25,-304.75"/>
<text text-anchor="middle" x="7340.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu0_layer1_mha_out&#45;&gt;gpu0_layer1_expert1 -->
<g id="edge137" class="edge">
<title>gpu0_layer1_mha_out&#45;&gt;gpu0_layer1_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7381.1,-364.24C7373.53,-347.49 7364.5,-327.5 7356.93,-310.74"/>
<polygon fill="blue" stroke="blue" points="7359.97,-308.96 7352.66,-301.29 7353.59,-311.85 7359.97,-308.96"/>
<text text-anchor="middle" x="7394.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu0_layer1_mha_out&#45;&gt;gpu0_layer1_expert2 -->
<g id="edge145" class="edge">
<title>gpu0_layer1_mha_out&#45;&gt;gpu0_layer1_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7412.61,-364.24C7420.05,-347.49 7428.92,-327.5 7436.35,-310.74"/>
<polygon fill="blue" stroke="blue" points="7439.69,-311.85 7440.55,-301.29 7433.29,-309.01 7439.69,-311.85"/>
<text text-anchor="middle" x="7449.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu0_layer1_mha_out&#45;&gt;gpu0_layer1_expert3 -->
<g id="edge153" class="edge">
<title>gpu0_layer1_mha_out&#45;&gt;gpu0_layer1_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M7436.6,-372.44C7449,-363.81 7462.67,-354.11 7475,-344.95 7491.08,-333 7508.46,-319.43 7523.49,-307.47"/>
<polygon fill="blue" stroke="blue" points="7525.95,-309.99 7531.58,-301.01 7521.58,-304.52 7525.95,-309.99"/>
<text text-anchor="middle" x="7516.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu1_layer0_expert0 -->
<g id="node15" class="node">
<title>gpu1_layer0_expert0</title>
<polygon fill="lightgreen" stroke="black" points="8613.5,-300.98 8520.5,-300.98 8520.5,-247.98 8613.5,-247.98 8613.5,-300.98"/>
<text text-anchor="middle" x="8567" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="8567" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="8567" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 1</text>
</g>
<!-- gpu1_layer0_expert1 -->
<g id="node16" class="node">
<title>gpu1_layer0_expert1</title>
<polygon fill="lightgreen" stroke="black" points="8724.5,-300.98 8631.5,-300.98 8631.5,-247.98 8724.5,-247.98 8724.5,-300.98"/>
<text text-anchor="middle" x="8678" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="8678" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="8678" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 1</text>
</g>
<!-- gpu1_layer0_expert2 -->
<g id="node17" class="node">
<title>gpu1_layer0_expert2</title>
<polygon fill="lightgreen" stroke="black" points="8835.5,-300.98 8742.5,-300.98 8742.5,-247.98 8835.5,-247.98 8835.5,-300.98"/>
<text text-anchor="middle" x="8789" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="8789" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="8789" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 1</text>
</g>
<!-- gpu1_layer0_expert3 -->
<g id="node18" class="node">
<title>gpu1_layer0_expert3</title>
<polygon fill="lightgreen" stroke="black" points="8946.5,-300.98 8853.5,-300.98 8853.5,-247.98 8946.5,-247.98 8946.5,-300.98"/>
<text text-anchor="middle" x="8900" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="8900" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="8900" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 1</text>
</g>
<!-- gpu1_layer1_expert0 -->
<g id="node19" class="node">
<title>gpu1_layer1_expert0</title>
<polygon fill="lightgreen" stroke="black" points="8169.5,-300.98 8076.5,-300.98 8076.5,-247.98 8169.5,-247.98 8169.5,-300.98"/>
<text text-anchor="middle" x="8123" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="8123" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="8123" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 1</text>
</g>
<!-- gpu9_layer2_expert0 -->
<g id="node127" class="node">
<title>gpu9_layer2_expert0</title>
<polygon fill="lightgreen" stroke="black" points="1453.5,-186 1360.5,-186 1360.5,-133 1453.5,-133 1453.5,-186"/>
<text text-anchor="middle" x="1407" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="1407" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="1407" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 1</text>
</g>
<!-- gpu1_layer1_expert0&#45;&gt;gpu9_layer2_expert0 -->
<g id="edge69" class="edge">
<title>gpu1_layer1_expert0&#45;&gt;gpu9_layer2_expert0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8093.83,-247.77C8085.11,-241.49 8075.16,-235.55 8065,-231.98 7959.4,-194.82 7673.9,-207.27 7562,-204 7478.8,-201.57 1751.47,-204.27 1463.79,-184.8"/>
<polygon fill="red" stroke="red" points="1463.95,-181.29 1453.63,-183.73 1463.21,-188.26 1463.95,-181.29"/>
<text text-anchor="middle" x="8035.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu1_layer1_expert1 -->
<g id="node20" class="node">
<title>gpu1_layer1_expert1</title>
<polygon fill="lightgreen" stroke="black" points="8280.5,-300.98 8187.5,-300.98 8187.5,-247.98 8280.5,-247.98 8280.5,-300.98"/>
<text text-anchor="middle" x="8234" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="8234" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="8234" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 1</text>
</g>
<!-- gpu9_layer2_expert1 -->
<g id="node128" class="node">
<title>gpu9_layer2_expert1</title>
<polygon fill="lightgreen" stroke="black" points="1564.5,-186 1471.5,-186 1471.5,-133 1564.5,-133 1564.5,-186"/>
<text text-anchor="middle" x="1518" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1518" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="1518" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 1</text>
</g>
<!-- gpu1_layer1_expert1&#45;&gt;gpu9_layer2_expert1 -->
<g id="edge70" class="edge">
<title>gpu1_layer1_expert1&#45;&gt;gpu9_layer2_expert1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8203.65,-247.78C8195.68,-241.95 8186.83,-236.23 8178,-231.98 8134.49,-211.01 8120.88,-210.34 8073,-204 7896.28,-180.61 1904.32,-224 1574.52,-185.27"/>
<polygon fill="red" stroke="red" points="1575.05,-181.81 1564.63,-183.73 1573.98,-188.72 1575.05,-181.81"/>
<text text-anchor="middle" x="8180.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu1_layer1_expert2 -->
<g id="node21" class="node">
<title>gpu1_layer1_expert2</title>
<polygon fill="lightgreen" stroke="black" points="8391.5,-300.98 8298.5,-300.98 8298.5,-247.98 8391.5,-247.98 8391.5,-300.98"/>
<text text-anchor="middle" x="8345" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="8345" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="8345" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 1</text>
</g>
<!-- gpu9_layer2_expert2 -->
<g id="node129" class="node">
<title>gpu9_layer2_expert2</title>
<polygon fill="lightgreen" stroke="black" points="1675.5,-186 1582.5,-186 1582.5,-133 1675.5,-133 1675.5,-186"/>
<text text-anchor="middle" x="1629" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="1629" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="1629" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 1</text>
</g>
<!-- gpu1_layer1_expert2&#45;&gt;gpu9_layer2_expert2 -->
<g id="edge71" class="edge">
<title>gpu1_layer1_expert2&#45;&gt;gpu9_layer2_expert2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8314.03,-247.78C8306.44,-242.15 8298.15,-236.52 8290,-231.98 8260.01,-215.26 8251.73,-210.37 8218,-204 8041.92,-170.74 2017.1,-223.95 1685.57,-185.27"/>
<polygon fill="red" stroke="red" points="1686.05,-181.8 1675.63,-183.73 1684.98,-188.72 1686.05,-181.8"/>
<text text-anchor="middle" x="8298.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu1_layer1_expert3 -->
<g id="node22" class="node">
<title>gpu1_layer1_expert3</title>
<polygon fill="lightgreen" stroke="black" points="8502.5,-300.98 8409.5,-300.98 8409.5,-247.98 8502.5,-247.98 8502.5,-300.98"/>
<text text-anchor="middle" x="8456" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="8456" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="8456" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 1</text>
</g>
<!-- gpu9_layer2_expert3 -->
<g id="node130" class="node">
<title>gpu9_layer2_expert3</title>
<polygon fill="lightgreen" stroke="black" points="1786.5,-186 1693.5,-186 1693.5,-133 1786.5,-133 1786.5,-186"/>
<text text-anchor="middle" x="1740" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1740" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="1740" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 1</text>
</g>
<!-- gpu1_layer1_expert3&#45;&gt;gpu9_layer2_expert3 -->
<g id="edge72" class="edge">
<title>gpu1_layer1_expert3&#45;&gt;gpu9_layer2_expert3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8424.74,-247.83C8401.79,-230.98 8369,-210.85 8336,-204 8158.18,-167.1 1975.68,-223.59 1798,-186 1797.53,-185.9 1797.06,-185.8 1796.59,-185.69"/>
<polygon fill="red" stroke="red" points="1797.2,-182.23 1786.62,-182.92 1795.32,-188.97 1797.2,-182.23"/>
<text text-anchor="middle" x="8408.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu1_layer0_mha_qkv -->
<g id="node23" class="node">
<title>gpu1_layer0_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="8877" cy="-676.34" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="8877" y="-687.64" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="8877" y="-672.64" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="8877" y="-657.64" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- gpu1_layer0_mha_attn -->
<g id="node24" class="node">
<title>gpu1_layer0_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="8824" cy="-512.38" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="8824" y="-516.18" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="8824" y="-501.18" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- gpu1_layer0_mha_qkv&#45;&gt;gpu1_layer0_mha_attn -->
<g id="edge5" class="edge">
<title>gpu1_layer0_mha_qkv&#45;&gt;gpu1_layer0_mha_attn</title>
<path fill="none" stroke="black" d="M8865.24,-639.39C8856.42,-612.46 8844.42,-575.77 8835.63,-548.93"/>
<polygon fill="black" stroke="black" points="8838.87,-547.58 8832.44,-539.16 8832.22,-549.76 8838.87,-547.58"/>
</g>
<!-- gpu1_layer0_mha_out -->
<g id="node25" class="node">
<title>gpu1_layer0_mha_out</title>
<ellipse fill="orange" stroke="black" cx="8789" cy="-400.43" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="8789" y="-411.73" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="8789" y="-396.73" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="8789" y="-381.73" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- gpu1_layer0_mha_attn&#45;&gt;gpu1_layer0_mha_out -->
<g id="edge6" class="edge">
<title>gpu1_layer0_mha_attn&#45;&gt;gpu1_layer0_mha_out</title>
<path fill="none" stroke="black" d="M8815.79,-485.6C8812.16,-474.17 8807.76,-460.37 8803.59,-447.28"/>
<polygon fill="black" stroke="black" points="8806.84,-445.92 8800.47,-437.45 8800.16,-448.04 8806.84,-445.92"/>
</g>
<!-- gpu1_layer0_mha_out&#45;&gt;gpu1_layer0_expert0 -->
<g id="edge98" class="edge">
<title>gpu1_layer0_mha_out&#45;&gt;gpu1_layer0_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8742.59,-377.37C8722.82,-367.74 8699.62,-356.11 8679,-344.95 8653.59,-331.2 8647.55,-327.17 8623,-311.95 8620.19,-310.21 8617.31,-308.4 8614.41,-306.57"/>
<polygon fill="blue" stroke="blue" points="8616.03,-303.45 8605.72,-301.02 8612.26,-309.35 8616.03,-303.45"/>
<text text-anchor="middle" x="8700.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu1_layer0_mha_out&#45;&gt;gpu1_layer0_expert1 -->
<g id="edge106" class="edge">
<title>gpu1_layer0_mha_out&#45;&gt;gpu1_layer0_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8760.41,-367.51C8744.23,-349.43 8724.01,-326.86 8707.65,-308.59"/>
<polygon fill="blue" stroke="blue" points="8710.18,-306.16 8700.9,-301.05 8704.96,-310.83 8710.18,-306.16"/>
<text text-anchor="middle" x="8761.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu1_layer0_mha_out&#45;&gt;gpu1_layer0_expert2 -->
<g id="edge114" class="edge">
<title>gpu1_layer0_mha_out&#45;&gt;gpu1_layer0_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8789,-362.91C8789,-346.62 8789,-327.5 8789,-311.3"/>
<polygon fill="blue" stroke="blue" points="8792.5,-311.13 8789,-301.13 8785.5,-311.13 8792.5,-311.13"/>
<text text-anchor="middle" x="8810.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu1_layer0_mha_out&#45;&gt;gpu1_layer0_expert3 -->
<g id="edge122" class="edge">
<title>gpu1_layer0_mha_out&#45;&gt;gpu1_layer0_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8817.59,-367.51C8833.77,-349.43 8853.99,-326.86 8870.35,-308.59"/>
<polygon fill="blue" stroke="blue" points="8873.04,-310.83 8877.1,-301.05 8867.82,-306.16 8873.04,-310.83"/>
<text text-anchor="middle" x="8872.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu1_layer1_mha_qkv -->
<g id="node26" class="node">
<title>gpu1_layer1_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="8285" cy="-676.34" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="8285" y="-687.64" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="8285" y="-672.64" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="8285" y="-657.64" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- gpu1_layer1_mha_attn -->
<g id="node27" class="node">
<title>gpu1_layer1_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="8285" cy="-512.38" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="8285" y="-516.18" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="8285" y="-501.18" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- gpu1_layer1_mha_qkv&#45;&gt;gpu1_layer1_mha_attn -->
<g id="edge7" class="edge">
<title>gpu1_layer1_mha_qkv&#45;&gt;gpu1_layer1_mha_attn</title>
<path fill="none" stroke="black" d="M8285,-638.59C8285,-611.89 8285,-575.95 8285,-549.42"/>
<polygon fill="black" stroke="black" points="8288.5,-549.4 8285,-539.4 8281.5,-549.4 8288.5,-549.4"/>
</g>
<!-- gpu1_layer1_mha_out -->
<g id="node28" class="node">
<title>gpu1_layer1_mha_out</title>
<ellipse fill="orange" stroke="black" cx="8285" cy="-400.43" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="8285" y="-411.73" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="8285" y="-396.73" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="8285" y="-381.73" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<!-- gpu1_layer1_mha_attn&#45;&gt;gpu1_layer1_mha_out -->
<g id="edge8" class="edge">
<title>gpu1_layer1_mha_attn&#45;&gt;gpu1_layer1_mha_out</title>
<path fill="none" stroke="black" d="M8285,-485.33C8285,-474.2 8285,-460.87 8285,-448.14"/>
<polygon fill="black" stroke="black" points="8288.5,-448.12 8285,-438.12 8281.5,-448.12 8288.5,-448.12"/>
</g>
<!-- gpu1_layer1_mha_out&#45;&gt;gpu1_layer1_expert0 -->
<g id="edge130" class="edge">
<title>gpu1_layer1_mha_out&#45;&gt;gpu1_layer1_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8244.54,-373.08C8231.7,-364.4 8217.57,-354.52 8205,-344.95 8189.73,-333.34 8173.5,-319.84 8159.54,-307.86"/>
<polygon fill="blue" stroke="blue" points="8161.46,-304.89 8151.61,-301 8156.89,-310.19 8161.46,-304.89"/>
<text text-anchor="middle" x="8226.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu1_layer1_mha_out&#45;&gt;gpu1_layer1_expert1 -->
<g id="edge138" class="edge">
<title>gpu1_layer1_mha_out&#45;&gt;gpu1_layer1_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8266.9,-364.57C8263.79,-358.11 8260.69,-351.38 8258,-344.95 8253.44,-334.05 8249.03,-321.94 8245.27,-310.92"/>
<polygon fill="blue" stroke="blue" points="8248.5,-309.55 8242.01,-301.18 8241.86,-311.77 8248.5,-309.55"/>
<text text-anchor="middle" x="8279.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu1_layer1_mha_out&#45;&gt;gpu1_layer1_expert2 -->
<g id="edge146" class="edge">
<title>gpu1_layer1_mha_out&#45;&gt;gpu1_layer1_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8302.03,-364.24C8310.14,-347.49 8319.82,-327.5 8327.93,-310.74"/>
<polygon fill="blue" stroke="blue" points="8331.3,-311.82 8332.5,-301.29 8325,-308.77 8331.3,-311.82"/>
<text text-anchor="middle" x="8339.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu1_layer1_mha_out&#45;&gt;gpu1_layer1_expert3 -->
<g id="edge154" class="edge">
<title>gpu1_layer1_mha_out&#45;&gt;gpu1_layer1_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M8325.17,-372.7C8338,-363.99 8352.19,-354.19 8365,-344.95 8381.75,-332.87 8399.89,-319.15 8415.53,-307.12"/>
<polygon fill="blue" stroke="blue" points="8417.69,-309.87 8423.47,-300.99 8413.41,-304.33 8417.69,-309.87"/>
<text text-anchor="middle" x="8406.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu2_layer0_expert0 -->
<g id="node29" class="node">
<title>gpu2_layer0_expert0</title>
<polygon fill="lightyellow" stroke="black" points="9506.5,-300.98 9413.5,-300.98 9413.5,-247.98 9506.5,-247.98 9506.5,-300.98"/>
<text text-anchor="middle" x="9460" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="9460" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="9460" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 2</text>
</g>
<!-- gpu2_layer0_expert1 -->
<g id="node30" class="node">
<title>gpu2_layer0_expert1</title>
<polygon fill="lightyellow" stroke="black" points="9617.5,-300.98 9524.5,-300.98 9524.5,-247.98 9617.5,-247.98 9617.5,-300.98"/>
<text text-anchor="middle" x="9571" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="9571" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="9571" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 2</text>
</g>
<!-- gpu2_layer0_expert2 -->
<g id="node31" class="node">
<title>gpu2_layer0_expert2</title>
<polygon fill="lightyellow" stroke="black" points="9728.5,-300.98 9635.5,-300.98 9635.5,-247.98 9728.5,-247.98 9728.5,-300.98"/>
<text text-anchor="middle" x="9682" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="9682" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="9682" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 2</text>
</g>
<!-- gpu2_layer0_expert3 -->
<g id="node32" class="node">
<title>gpu2_layer0_expert3</title>
<polygon fill="lightyellow" stroke="black" points="9839.5,-300.98 9746.5,-300.98 9746.5,-247.98 9839.5,-247.98 9839.5,-300.98"/>
<text text-anchor="middle" x="9793" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="9793" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="9793" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 2</text>
</g>
<!-- gpu2_layer1_expert0 -->
<g id="node33" class="node">
<title>gpu2_layer1_expert0</title>
<polygon fill="lightyellow" stroke="black" points="9062.5,-300.98 8969.5,-300.98 8969.5,-247.98 9062.5,-247.98 9062.5,-300.98"/>
<text text-anchor="middle" x="9016" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="9016" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="9016" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 2</text>
</g>
<!-- gpu10_layer2_expert0 -->
<g id="node141" class="node">
<title>gpu10_layer2_expert0</title>
<polygon fill="lightyellow" stroke="black" points="2346.5,-186 2253.5,-186 2253.5,-133 2346.5,-133 2346.5,-186"/>
<text text-anchor="middle" x="2300" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="2300" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="2300" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 2</text>
</g>
<!-- gpu2_layer1_expert0&#45;&gt;gpu10_layer2_expert0 -->
<g id="edge73" class="edge">
<title>gpu2_layer1_expert0&#45;&gt;gpu10_layer2_expert0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M8986.83,-247.77C8978.12,-241.48 8968.16,-235.55 8958,-231.98 8904.25,-213.09 8502.95,-205.64 8446,-204 8362.92,-201.61 2644.04,-204.25 2356.77,-184.8"/>
<polygon fill="red" stroke="red" points="2356.95,-181.29 2346.63,-183.73 2356.21,-188.26 2356.95,-181.29"/>
<text text-anchor="middle" x="8879.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu2_layer1_expert1 -->
<g id="node34" class="node">
<title>gpu2_layer1_expert1</title>
<polygon fill="lightyellow" stroke="black" points="9173.5,-300.98 9080.5,-300.98 9080.5,-247.98 9173.5,-247.98 9173.5,-300.98"/>
<text text-anchor="middle" x="9127" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="9127" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="9127" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 2</text>
</g>
<!-- gpu10_layer2_expert1 -->
<g id="node142" class="node">
<title>gpu10_layer2_expert1</title>
<polygon fill="lightyellow" stroke="black" points="2457.5,-186 2364.5,-186 2364.5,-133 2457.5,-133 2457.5,-186"/>
<text text-anchor="middle" x="2411" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="2411" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="2411" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 2</text>
</g>
<!-- gpu2_layer1_expert1&#45;&gt;gpu10_layer2_expert1 -->
<g id="edge74" class="edge">
<title>gpu2_layer1_expert1&#45;&gt;gpu10_layer2_expert1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9098.34,-247.9C9090.29,-241.86 9081.21,-236 9072,-231.98 9007.87,-203.91 8986.71,-210.34 8917,-204 8829.3,-196.02 2766.12,-205.1 2467.9,-184.82"/>
<polygon fill="red" stroke="red" points="2467.95,-181.3 2457.63,-183.73 2467.21,-188.26 2467.95,-181.3"/>
<text text-anchor="middle" x="9070.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu2_layer1_expert2 -->
<g id="node35" class="node">
<title>gpu2_layer1_expert2</title>
<polygon fill="lightyellow" stroke="black" points="9284.5,-300.98 9191.5,-300.98 9191.5,-247.98 9284.5,-247.98 9284.5,-300.98"/>
<text text-anchor="middle" x="9238" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="9238" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="9238" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 2</text>
</g>
<!-- gpu10_layer2_expert2 -->
<g id="node143" class="node">
<title>gpu10_layer2_expert2</title>
<polygon fill="lightyellow" stroke="black" points="2568.5,-186 2475.5,-186 2475.5,-133 2568.5,-133 2568.5,-186"/>
<text text-anchor="middle" x="2522" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2522" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="2522" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 2</text>
</g>
<!-- gpu2_layer1_expert2&#45;&gt;gpu10_layer2_expert2 -->
<g id="edge75" class="edge">
<title>gpu2_layer1_expert2&#45;&gt;gpu10_layer2_expert2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9207.36,-247.91C9199.69,-242.21 9191.29,-236.52 9183,-231.98 9151.81,-214.87 9143,-210.37 9108,-204 8931.78,-171.95 2909.94,-223.96 2578.57,-185.27"/>
<polygon fill="red" stroke="red" points="2579.05,-181.8 2568.63,-183.73 2577.98,-188.72 2579.05,-181.8"/>
<text text-anchor="middle" x="9191.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu2_layer1_expert3 -->
<g id="node36" class="node">
<title>gpu2_layer1_expert3</title>
<polygon fill="lightyellow" stroke="black" points="9395.5,-300.98 9302.5,-300.98 9302.5,-247.98 9395.5,-247.98 9395.5,-300.98"/>
<text text-anchor="middle" x="9349" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="9349" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="9349" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 2</text>
</g>
<!-- gpu10_layer2_expert3 -->
<g id="node144" class="node">
<title>gpu10_layer2_expert3</title>
<polygon fill="lightyellow" stroke="black" points="2679.5,-186 2586.5,-186 2586.5,-133 2679.5,-133 2679.5,-186"/>
<text text-anchor="middle" x="2633" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2633" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="2633" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 2</text>
</g>
<!-- gpu2_layer1_expert3&#45;&gt;gpu10_layer2_expert3 -->
<g id="edge76" class="edge">
<title>gpu2_layer1_expert3&#45;&gt;gpu10_layer2_expert3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9317.74,-247.83C9294.79,-230.98 9262,-210.85 9229,-204 9051.18,-167.1 2868.68,-223.59 2691,-186 2690.53,-185.9 2690.06,-185.8 2689.59,-185.69"/>
<polygon fill="red" stroke="red" points="2690.2,-182.23 2679.62,-182.92 2688.32,-188.97 2690.2,-182.23"/>
<text text-anchor="middle" x="9301.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu2_layer0_mha_qkv -->
<g id="node37" class="node">
<title>gpu2_layer0_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="9770" cy="-676.34" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="9770" y="-687.64" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="9770" y="-672.64" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="9770" y="-657.64" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- gpu2_layer0_mha_attn -->
<g id="node38" class="node">
<title>gpu2_layer0_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="9717" cy="-512.38" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="9717" y="-516.18" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="9717" y="-501.18" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- gpu2_layer0_mha_qkv&#45;&gt;gpu2_layer0_mha_attn -->
<g id="edge9" class="edge">
<title>gpu2_layer0_mha_qkv&#45;&gt;gpu2_layer0_mha_attn</title>
<path fill="none" stroke="black" d="M9758.24,-639.39C9749.42,-612.46 9737.42,-575.77 9728.63,-548.93"/>
<polygon fill="black" stroke="black" points="9731.87,-547.58 9725.44,-539.16 9725.22,-549.76 9731.87,-547.58"/>
</g>
<!-- gpu2_layer0_mha_out -->
<g id="node39" class="node">
<title>gpu2_layer0_mha_out</title>
<ellipse fill="orange" stroke="black" cx="9682" cy="-400.43" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="9682" y="-411.73" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="9682" y="-396.73" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="9682" y="-381.73" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- gpu2_layer0_mha_attn&#45;&gt;gpu2_layer0_mha_out -->
<g id="edge10" class="edge">
<title>gpu2_layer0_mha_attn&#45;&gt;gpu2_layer0_mha_out</title>
<path fill="none" stroke="black" d="M9708.79,-485.6C9705.16,-474.17 9700.76,-460.37 9696.59,-447.28"/>
<polygon fill="black" stroke="black" points="9699.84,-445.92 9693.47,-437.45 9693.16,-448.04 9699.84,-445.92"/>
</g>
<!-- gpu2_layer0_mha_out&#45;&gt;gpu2_layer0_expert0 -->
<g id="edge99" class="edge">
<title>gpu2_layer0_mha_out&#45;&gt;gpu2_layer0_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9635.59,-377.37C9615.82,-367.74 9592.62,-356.11 9572,-344.95 9546.59,-331.2 9540.55,-327.17 9516,-311.95 9513.19,-310.21 9510.31,-308.4 9507.41,-306.57"/>
<polygon fill="blue" stroke="blue" points="9509.03,-303.45 9498.72,-301.02 9505.26,-309.35 9509.03,-303.45"/>
<text text-anchor="middle" x="9593.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu2_layer0_mha_out&#45;&gt;gpu2_layer0_expert1 -->
<g id="edge107" class="edge">
<title>gpu2_layer0_mha_out&#45;&gt;gpu2_layer0_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9653.41,-367.51C9637.23,-349.43 9617.01,-326.86 9600.65,-308.59"/>
<polygon fill="blue" stroke="blue" points="9603.18,-306.16 9593.9,-301.05 9597.96,-310.83 9603.18,-306.16"/>
<text text-anchor="middle" x="9654.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu2_layer0_mha_out&#45;&gt;gpu2_layer0_expert2 -->
<g id="edge115" class="edge">
<title>gpu2_layer0_mha_out&#45;&gt;gpu2_layer0_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9682,-362.91C9682,-346.62 9682,-327.5 9682,-311.3"/>
<polygon fill="blue" stroke="blue" points="9685.5,-311.13 9682,-301.13 9678.5,-311.13 9685.5,-311.13"/>
<text text-anchor="middle" x="9703.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu2_layer0_mha_out&#45;&gt;gpu2_layer0_expert3 -->
<g id="edge123" class="edge">
<title>gpu2_layer0_mha_out&#45;&gt;gpu2_layer0_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9710.59,-367.51C9726.77,-349.43 9746.99,-326.86 9763.35,-308.59"/>
<polygon fill="blue" stroke="blue" points="9766.04,-310.83 9770.1,-301.05 9760.82,-306.16 9766.04,-310.83"/>
<text text-anchor="middle" x="9765.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu2_layer1_mha_qkv -->
<g id="node40" class="node">
<title>gpu2_layer1_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="9183" cy="-676.34" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="9183" y="-687.64" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="9183" y="-672.64" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="9183" y="-657.64" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- gpu2_layer1_mha_attn -->
<g id="node41" class="node">
<title>gpu2_layer1_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="9183" cy="-512.38" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="9183" y="-516.18" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="9183" y="-501.18" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- gpu2_layer1_mha_qkv&#45;&gt;gpu2_layer1_mha_attn -->
<g id="edge11" class="edge">
<title>gpu2_layer1_mha_qkv&#45;&gt;gpu2_layer1_mha_attn</title>
<path fill="none" stroke="black" d="M9183,-638.59C9183,-611.89 9183,-575.95 9183,-549.42"/>
<polygon fill="black" stroke="black" points="9186.5,-549.4 9183,-539.4 9179.5,-549.4 9186.5,-549.4"/>
</g>
<!-- gpu2_layer1_mha_out -->
<g id="node42" class="node">
<title>gpu2_layer1_mha_out</title>
<ellipse fill="orange" stroke="black" cx="9183" cy="-400.43" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="9183" y="-411.73" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="9183" y="-396.73" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="9183" y="-381.73" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<!-- gpu2_layer1_mha_attn&#45;&gt;gpu2_layer1_mha_out -->
<g id="edge12" class="edge">
<title>gpu2_layer1_mha_attn&#45;&gt;gpu2_layer1_mha_out</title>
<path fill="none" stroke="black" d="M9183,-485.33C9183,-474.2 9183,-460.87 9183,-448.14"/>
<polygon fill="black" stroke="black" points="9186.5,-448.12 9183,-438.12 9179.5,-448.12 9186.5,-448.12"/>
</g>
<!-- gpu2_layer1_mha_out&#45;&gt;gpu2_layer1_expert0 -->
<g id="edge131" class="edge">
<title>gpu2_layer1_mha_out&#45;&gt;gpu2_layer1_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9143.27,-372.77C9130.6,-364.07 9116.6,-354.26 9104,-344.95 9087.88,-333.05 9070.5,-319.49 9055.47,-307.52"/>
<polygon fill="blue" stroke="blue" points="9057.38,-304.57 9047.39,-301.06 9053.01,-310.04 9057.38,-304.57"/>
<text text-anchor="middle" x="9125.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu2_layer1_mha_out&#45;&gt;gpu2_layer1_expert1 -->
<g id="edge139" class="edge">
<title>gpu2_layer1_mha_out&#45;&gt;gpu2_layer1_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9167.1,-364.24C9159.53,-347.49 9150.5,-327.5 9142.93,-310.74"/>
<polygon fill="blue" stroke="blue" points="9145.97,-308.96 9138.66,-301.29 9139.59,-311.85 9145.97,-308.96"/>
<text text-anchor="middle" x="9179.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu2_layer1_mha_out&#45;&gt;gpu2_layer1_expert2 -->
<g id="edge147" class="edge">
<title>gpu2_layer1_mha_out&#45;&gt;gpu2_layer1_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9198.61,-364.24C9206.05,-347.49 9214.92,-327.5 9222.35,-310.74"/>
<polygon fill="blue" stroke="blue" points="9225.69,-311.85 9226.55,-301.29 9219.29,-309.01 9225.69,-311.85"/>
<text text-anchor="middle" x="9234.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu2_layer1_mha_out&#45;&gt;gpu2_layer1_expert3 -->
<g id="edge155" class="edge">
<title>gpu2_layer1_mha_out&#45;&gt;gpu2_layer1_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M9222.03,-372.35C9234.27,-363.71 9247.78,-354.04 9260,-344.95 9276.06,-333.01 9293.47,-319.55 9308.59,-307.67"/>
<polygon fill="blue" stroke="blue" points="9311.04,-310.19 9316.73,-301.26 9306.71,-304.69 9311.04,-310.19"/>
<text text-anchor="middle" x="9300.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu3_layer0_expert0 -->
<g id="node43" class="node">
<title>gpu3_layer0_expert0</title>
<polygon fill="lightpink" stroke="black" points="10399.5,-300.98 10306.5,-300.98 10306.5,-247.98 10399.5,-247.98 10399.5,-300.98"/>
<text text-anchor="middle" x="10353" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="10353" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="10353" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 3</text>
</g>
<!-- gpu3_layer0_expert1 -->
<g id="node44" class="node">
<title>gpu3_layer0_expert1</title>
<polygon fill="lightpink" stroke="black" points="10510.5,-300.98 10417.5,-300.98 10417.5,-247.98 10510.5,-247.98 10510.5,-300.98"/>
<text text-anchor="middle" x="10464" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="10464" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="10464" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 3</text>
</g>
<!-- gpu3_layer0_expert2 -->
<g id="node45" class="node">
<title>gpu3_layer0_expert2</title>
<polygon fill="lightpink" stroke="black" points="10621.5,-300.98 10528.5,-300.98 10528.5,-247.98 10621.5,-247.98 10621.5,-300.98"/>
<text text-anchor="middle" x="10575" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="10575" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="10575" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 3</text>
</g>
<!-- gpu3_layer0_expert3 -->
<g id="node46" class="node">
<title>gpu3_layer0_expert3</title>
<polygon fill="lightpink" stroke="black" points="10732.5,-300.98 10639.5,-300.98 10639.5,-247.98 10732.5,-247.98 10732.5,-300.98"/>
<text text-anchor="middle" x="10686" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="10686" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="10686" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 3</text>
</g>
<!-- gpu3_layer1_expert0 -->
<g id="node47" class="node">
<title>gpu3_layer1_expert0</title>
<polygon fill="lightpink" stroke="black" points="9955.5,-300.98 9862.5,-300.98 9862.5,-247.98 9955.5,-247.98 9955.5,-300.98"/>
<text text-anchor="middle" x="9909" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="9909" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="9909" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 3</text>
</g>
<!-- gpu11_layer2_expert0 -->
<g id="node155" class="node">
<title>gpu11_layer2_expert0</title>
<polygon fill="lightpink" stroke="black" points="3239.5,-186 3146.5,-186 3146.5,-133 3239.5,-133 3239.5,-186"/>
<text text-anchor="middle" x="3193" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="3193" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="3193" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 3</text>
</g>
<!-- gpu3_layer1_expert0&#45;&gt;gpu11_layer2_expert0 -->
<g id="edge77" class="edge">
<title>gpu3_layer1_expert0&#45;&gt;gpu11_layer2_expert0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9879.83,-247.77C9871.12,-241.48 9861.16,-235.55 9851,-231.98 9797.25,-213.09 9395.95,-205.64 9339,-204 9255.92,-201.61 3537.04,-204.25 3249.77,-184.8"/>
<polygon fill="red" stroke="red" points="3249.95,-181.29 3239.63,-183.73 3249.21,-188.26 3249.95,-181.29"/>
<text text-anchor="middle" x="9772.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu3_layer1_expert1 -->
<g id="node48" class="node">
<title>gpu3_layer1_expert1</title>
<polygon fill="lightpink" stroke="black" points="10066.5,-300.98 9973.5,-300.98 9973.5,-247.98 10066.5,-247.98 10066.5,-300.98"/>
<text text-anchor="middle" x="10020" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="10020" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="10020" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 3</text>
</g>
<!-- gpu11_layer2_expert1 -->
<g id="node156" class="node">
<title>gpu11_layer2_expert1</title>
<polygon fill="lightpink" stroke="black" points="3350.5,-186 3257.5,-186 3257.5,-133 3350.5,-133 3350.5,-186"/>
<text text-anchor="middle" x="3304" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="3304" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="3304" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 3</text>
</g>
<!-- gpu3_layer1_expert1&#45;&gt;gpu11_layer2_expert1 -->
<g id="edge78" class="edge">
<title>gpu3_layer1_expert1&#45;&gt;gpu11_layer2_expert1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M9991.34,-247.9C9983.29,-241.86 9974.21,-236 9965,-231.98 9900.87,-203.91 9879.71,-210.34 9810,-204 9722.3,-196.02 3659.12,-205.1 3360.9,-184.82"/>
<polygon fill="red" stroke="red" points="3360.95,-181.3 3350.63,-183.73 3360.21,-188.26 3360.95,-181.3"/>
<text text-anchor="middle" x="9963.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu3_layer1_expert2 -->
<g id="node49" class="node">
<title>gpu3_layer1_expert2</title>
<polygon fill="lightpink" stroke="black" points="10177.5,-300.98 10084.5,-300.98 10084.5,-247.98 10177.5,-247.98 10177.5,-300.98"/>
<text text-anchor="middle" x="10131" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="10131" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="10131" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 3</text>
</g>
<!-- gpu11_layer2_expert2 -->
<g id="node157" class="node">
<title>gpu11_layer2_expert2</title>
<polygon fill="lightpink" stroke="black" points="3461.5,-186 3368.5,-186 3368.5,-133 3461.5,-133 3461.5,-186"/>
<text text-anchor="middle" x="3415" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="3415" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="3415" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 3</text>
</g>
<!-- gpu3_layer1_expert2&#45;&gt;gpu11_layer2_expert2 -->
<g id="edge79" class="edge">
<title>gpu3_layer1_expert2&#45;&gt;gpu11_layer2_expert2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10100.36,-247.91C10092.69,-242.21 10084.29,-236.52 10076,-231.98 10044.81,-214.87 10036,-210.37 10001,-204 9824.78,-171.95 3802.94,-223.96 3471.57,-185.27"/>
<polygon fill="red" stroke="red" points="3472.05,-181.8 3461.63,-183.73 3470.98,-188.72 3472.05,-181.8"/>
<text text-anchor="middle" x="10084.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu3_layer1_expert3 -->
<g id="node50" class="node">
<title>gpu3_layer1_expert3</title>
<polygon fill="lightpink" stroke="black" points="10288.5,-300.98 10195.5,-300.98 10195.5,-247.98 10288.5,-247.98 10288.5,-300.98"/>
<text text-anchor="middle" x="10242" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="10242" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="10242" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 3</text>
</g>
<!-- gpu11_layer2_expert3 -->
<g id="node158" class="node">
<title>gpu11_layer2_expert3</title>
<polygon fill="lightpink" stroke="black" points="3572.5,-186 3479.5,-186 3479.5,-133 3572.5,-133 3572.5,-186"/>
<text text-anchor="middle" x="3526" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="3526" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="3526" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 3</text>
</g>
<!-- gpu3_layer1_expert3&#45;&gt;gpu11_layer2_expert3 -->
<g id="edge80" class="edge">
<title>gpu3_layer1_expert3&#45;&gt;gpu11_layer2_expert3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10210.74,-247.83C10187.79,-230.98 10155,-210.85 10122,-204 9944.18,-167.1 3761.68,-223.59 3584,-186 3583.53,-185.9 3583.06,-185.8 3582.59,-185.69"/>
<polygon fill="red" stroke="red" points="3583.2,-182.23 3572.62,-182.92 3581.32,-188.97 3583.2,-182.23"/>
<text text-anchor="middle" x="10194.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu3_layer0_mha_qkv -->
<g id="node51" class="node">
<title>gpu3_layer0_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="10663" cy="-676.34" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="10663" y="-687.64" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="10663" y="-672.64" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="10663" y="-657.64" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- gpu3_layer0_mha_attn -->
<g id="node52" class="node">
<title>gpu3_layer0_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="10610" cy="-512.38" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="10610" y="-516.18" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="10610" y="-501.18" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- gpu3_layer0_mha_qkv&#45;&gt;gpu3_layer0_mha_attn -->
<g id="edge13" class="edge">
<title>gpu3_layer0_mha_qkv&#45;&gt;gpu3_layer0_mha_attn</title>
<path fill="none" stroke="black" d="M10651.24,-639.39C10642.42,-612.46 10630.42,-575.77 10621.63,-548.93"/>
<polygon fill="black" stroke="black" points="10624.87,-547.58 10618.44,-539.16 10618.22,-549.76 10624.87,-547.58"/>
</g>
<!-- gpu3_layer0_mha_out -->
<g id="node53" class="node">
<title>gpu3_layer0_mha_out</title>
<ellipse fill="orange" stroke="black" cx="10575" cy="-400.43" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="10575" y="-411.73" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="10575" y="-396.73" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="10575" y="-381.73" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- gpu3_layer0_mha_attn&#45;&gt;gpu3_layer0_mha_out -->
<g id="edge14" class="edge">
<title>gpu3_layer0_mha_attn&#45;&gt;gpu3_layer0_mha_out</title>
<path fill="none" stroke="black" d="M10601.79,-485.6C10598.16,-474.17 10593.76,-460.37 10589.59,-447.28"/>
<polygon fill="black" stroke="black" points="10592.84,-445.92 10586.47,-437.45 10586.16,-448.04 10592.84,-445.92"/>
</g>
<!-- gpu3_layer0_mha_out&#45;&gt;gpu3_layer0_expert0 -->
<g id="edge100" class="edge">
<title>gpu3_layer0_mha_out&#45;&gt;gpu3_layer0_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10528.59,-377.37C10508.82,-367.74 10485.62,-356.11 10465,-344.95 10439.59,-331.2 10433.55,-327.17 10409,-311.95 10406.19,-310.21 10403.31,-308.4 10400.41,-306.57"/>
<polygon fill="blue" stroke="blue" points="10402.03,-303.45 10391.72,-301.02 10398.26,-309.35 10402.03,-303.45"/>
<text text-anchor="middle" x="10486.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu3_layer0_mha_out&#45;&gt;gpu3_layer0_expert1 -->
<g id="edge108" class="edge">
<title>gpu3_layer0_mha_out&#45;&gt;gpu3_layer0_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10546.41,-367.51C10530.23,-349.43 10510.01,-326.86 10493.65,-308.59"/>
<polygon fill="blue" stroke="blue" points="10496.18,-306.16 10486.9,-301.05 10490.96,-310.83 10496.18,-306.16"/>
<text text-anchor="middle" x="10547.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu3_layer0_mha_out&#45;&gt;gpu3_layer0_expert2 -->
<g id="edge116" class="edge">
<title>gpu3_layer0_mha_out&#45;&gt;gpu3_layer0_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10575,-362.91C10575,-346.62 10575,-327.5 10575,-311.3"/>
<polygon fill="blue" stroke="blue" points="10578.5,-311.13 10575,-301.13 10571.5,-311.13 10578.5,-311.13"/>
<text text-anchor="middle" x="10596.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu3_layer0_mha_out&#45;&gt;gpu3_layer0_expert3 -->
<g id="edge124" class="edge">
<title>gpu3_layer0_mha_out&#45;&gt;gpu3_layer0_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10603.59,-367.51C10619.77,-349.43 10639.99,-326.86 10656.35,-308.59"/>
<polygon fill="blue" stroke="blue" points="10659.04,-310.83 10663.1,-301.05 10653.82,-306.16 10659.04,-310.83"/>
<text text-anchor="middle" x="10658.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu3_layer1_mha_qkv -->
<g id="node54" class="node">
<title>gpu3_layer1_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="10076" cy="-676.34" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="10076" y="-687.64" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="10076" y="-672.64" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="10076" y="-657.64" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- gpu3_layer1_mha_attn -->
<g id="node55" class="node">
<title>gpu3_layer1_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="10076" cy="-512.38" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="10076" y="-516.18" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="10076" y="-501.18" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- gpu3_layer1_mha_qkv&#45;&gt;gpu3_layer1_mha_attn -->
<g id="edge15" class="edge">
<title>gpu3_layer1_mha_qkv&#45;&gt;gpu3_layer1_mha_attn</title>
<path fill="none" stroke="black" d="M10076,-638.59C10076,-611.89 10076,-575.95 10076,-549.42"/>
<polygon fill="black" stroke="black" points="10079.5,-549.4 10076,-539.4 10072.5,-549.4 10079.5,-549.4"/>
</g>
<!-- gpu3_layer1_mha_out -->
<g id="node56" class="node">
<title>gpu3_layer1_mha_out</title>
<ellipse fill="orange" stroke="black" cx="10076" cy="-400.43" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="10076" y="-411.73" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="10076" y="-396.73" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="10076" y="-381.73" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- gpu3_layer1_mha_attn&#45;&gt;gpu3_layer1_mha_out -->
<g id="edge16" class="edge">
<title>gpu3_layer1_mha_attn&#45;&gt;gpu3_layer1_mha_out</title>
<path fill="none" stroke="black" d="M10076,-485.33C10076,-474.2 10076,-460.87 10076,-448.14"/>
<polygon fill="black" stroke="black" points="10079.5,-448.12 10076,-438.12 10072.5,-448.12 10079.5,-448.12"/>
</g>
<!-- gpu3_layer1_mha_out&#45;&gt;gpu3_layer1_expert0 -->
<g id="edge132" class="edge">
<title>gpu3_layer1_mha_out&#45;&gt;gpu3_layer1_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10036.27,-372.77C10023.6,-364.07 10009.6,-354.26 9997,-344.95 9980.88,-333.05 9963.5,-319.49 9948.47,-307.52"/>
<polygon fill="blue" stroke="blue" points="9950.38,-304.57 9940.39,-301.06 9946.01,-310.04 9950.38,-304.57"/>
<text text-anchor="middle" x="10018.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu3_layer1_mha_out&#45;&gt;gpu3_layer1_expert1 -->
<g id="edge140" class="edge">
<title>gpu3_layer1_mha_out&#45;&gt;gpu3_layer1_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10060.1,-364.24C10052.53,-347.49 10043.5,-327.5 10035.93,-310.74"/>
<polygon fill="blue" stroke="blue" points="10038.97,-308.96 10031.66,-301.29 10032.59,-311.85 10038.97,-308.96"/>
<text text-anchor="middle" x="10072.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu3_layer1_mha_out&#45;&gt;gpu3_layer1_expert2 -->
<g id="edge148" class="edge">
<title>gpu3_layer1_mha_out&#45;&gt;gpu3_layer1_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10091.61,-364.24C10099.05,-347.49 10107.92,-327.5 10115.35,-310.74"/>
<polygon fill="blue" stroke="blue" points="10118.69,-311.85 10119.55,-301.29 10112.29,-309.01 10118.69,-311.85"/>
<text text-anchor="middle" x="10127.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu3_layer1_mha_out&#45;&gt;gpu3_layer1_expert3 -->
<g id="edge156" class="edge">
<title>gpu3_layer1_mha_out&#45;&gt;gpu3_layer1_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10115.03,-372.35C10127.27,-363.71 10140.78,-354.04 10153,-344.95 10169.06,-333.01 10186.47,-319.55 10201.59,-307.67"/>
<polygon fill="blue" stroke="blue" points="10204.04,-310.19 10209.73,-301.26 10199.71,-304.69 10204.04,-310.19"/>
<text text-anchor="middle" x="10193.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu4_layer0_expert0 -->
<g id="node57" class="node">
<title>gpu4_layer0_expert0</title>
<polygon fill="lightblue" stroke="black" points="11292.5,-300.98 11199.5,-300.98 11199.5,-247.98 11292.5,-247.98 11292.5,-300.98"/>
<text text-anchor="middle" x="11246" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="11246" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="11246" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 4</text>
</g>
<!-- gpu4_layer0_expert1 -->
<g id="node58" class="node">
<title>gpu4_layer0_expert1</title>
<polygon fill="lightblue" stroke="black" points="11403.5,-300.98 11310.5,-300.98 11310.5,-247.98 11403.5,-247.98 11403.5,-300.98"/>
<text text-anchor="middle" x="11357" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="11357" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="11357" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 4</text>
</g>
<!-- gpu4_layer0_expert2 -->
<g id="node59" class="node">
<title>gpu4_layer0_expert2</title>
<polygon fill="lightblue" stroke="black" points="11514.5,-300.98 11421.5,-300.98 11421.5,-247.98 11514.5,-247.98 11514.5,-300.98"/>
<text text-anchor="middle" x="11468" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="11468" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="11468" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 4</text>
</g>
<!-- gpu4_layer0_expert3 -->
<g id="node60" class="node">
<title>gpu4_layer0_expert3</title>
<polygon fill="lightblue" stroke="black" points="11625.5,-300.98 11532.5,-300.98 11532.5,-247.98 11625.5,-247.98 11625.5,-300.98"/>
<text text-anchor="middle" x="11579" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="11579" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="11579" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 4</text>
</g>
<!-- gpu4_layer1_expert0 -->
<g id="node61" class="node">
<title>gpu4_layer1_expert0</title>
<polygon fill="lightblue" stroke="black" points="10848.5,-300.98 10755.5,-300.98 10755.5,-247.98 10848.5,-247.98 10848.5,-300.98"/>
<text text-anchor="middle" x="10802" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="10802" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="10802" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 4</text>
</g>
<!-- gpu12_layer2_expert0 -->
<g id="node169" class="node">
<title>gpu12_layer2_expert0</title>
<polygon fill="lightblue" stroke="black" points="4132.5,-186 4039.5,-186 4039.5,-133 4132.5,-133 4132.5,-186"/>
<text text-anchor="middle" x="4086" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="4086" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="4086" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 4</text>
</g>
<!-- gpu4_layer1_expert0&#45;&gt;gpu12_layer2_expert0 -->
<g id="edge81" class="edge">
<title>gpu4_layer1_expert0&#45;&gt;gpu12_layer2_expert0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10772.83,-247.77C10764.12,-241.48 10754.16,-235.55 10744,-231.98 10690.25,-213.09 10288.95,-205.64 10232,-204 10148.92,-201.61 4430.04,-204.25 4142.77,-184.8"/>
<polygon fill="red" stroke="red" points="4142.95,-181.29 4132.63,-183.73 4142.21,-188.26 4142.95,-181.29"/>
<text text-anchor="middle" x="10665.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu4_layer1_expert1 -->
<g id="node62" class="node">
<title>gpu4_layer1_expert1</title>
<polygon fill="lightblue" stroke="black" points="10959.5,-300.98 10866.5,-300.98 10866.5,-247.98 10959.5,-247.98 10959.5,-300.98"/>
<text text-anchor="middle" x="10913" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="10913" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="10913" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 4</text>
</g>
<!-- gpu12_layer2_expert1 -->
<g id="node170" class="node">
<title>gpu12_layer2_expert1</title>
<polygon fill="lightblue" stroke="black" points="4243.5,-186 4150.5,-186 4150.5,-133 4243.5,-133 4243.5,-186"/>
<text text-anchor="middle" x="4197" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="4197" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="4197" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 4</text>
</g>
<!-- gpu4_layer1_expert1&#45;&gt;gpu12_layer2_expert1 -->
<g id="edge82" class="edge">
<title>gpu4_layer1_expert1&#45;&gt;gpu12_layer2_expert1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10884.34,-247.9C10876.29,-241.86 10867.21,-236 10858,-231.98 10793.87,-203.91 10772.71,-210.34 10703,-204 10615.3,-196.02 4552.12,-205.1 4253.9,-184.82"/>
<polygon fill="red" stroke="red" points="4253.95,-181.3 4243.63,-183.73 4253.21,-188.26 4253.95,-181.3"/>
<text text-anchor="middle" x="10856.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu4_layer1_expert2 -->
<g id="node63" class="node">
<title>gpu4_layer1_expert2</title>
<polygon fill="lightblue" stroke="black" points="11070.5,-300.98 10977.5,-300.98 10977.5,-247.98 11070.5,-247.98 11070.5,-300.98"/>
<text text-anchor="middle" x="11024" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="11024" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="11024" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 4</text>
</g>
<!-- gpu12_layer2_expert2 -->
<g id="node171" class="node">
<title>gpu12_layer2_expert2</title>
<polygon fill="lightblue" stroke="black" points="4354.5,-186 4261.5,-186 4261.5,-133 4354.5,-133 4354.5,-186"/>
<text text-anchor="middle" x="4308" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="4308" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="4308" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 4</text>
</g>
<!-- gpu4_layer1_expert2&#45;&gt;gpu12_layer2_expert2 -->
<g id="edge83" class="edge">
<title>gpu4_layer1_expert2&#45;&gt;gpu12_layer2_expert2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M10993.36,-247.91C10985.69,-242.21 10977.29,-236.52 10969,-231.98 10937.81,-214.87 10929,-210.37 10894,-204 10717.78,-171.95 4695.94,-223.96 4364.57,-185.27"/>
<polygon fill="red" stroke="red" points="4365.05,-181.8 4354.63,-183.73 4363.98,-188.72 4365.05,-181.8"/>
<text text-anchor="middle" x="10977.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu4_layer1_expert3 -->
<g id="node64" class="node">
<title>gpu4_layer1_expert3</title>
<polygon fill="lightblue" stroke="black" points="11181.5,-300.98 11088.5,-300.98 11088.5,-247.98 11181.5,-247.98 11181.5,-300.98"/>
<text text-anchor="middle" x="11135" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="11135" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="11135" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 4</text>
</g>
<!-- gpu12_layer2_expert3 -->
<g id="node172" class="node">
<title>gpu12_layer2_expert3</title>
<polygon fill="lightblue" stroke="black" points="4465.5,-186 4372.5,-186 4372.5,-133 4465.5,-133 4465.5,-186"/>
<text text-anchor="middle" x="4419" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="4419" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="4419" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 4</text>
</g>
<!-- gpu4_layer1_expert3&#45;&gt;gpu12_layer2_expert3 -->
<g id="edge84" class="edge">
<title>gpu4_layer1_expert3&#45;&gt;gpu12_layer2_expert3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11103.74,-247.83C11080.79,-230.98 11048,-210.85 11015,-204 10837.18,-167.1 4654.68,-223.59 4477,-186 4476.53,-185.9 4476.06,-185.8 4475.59,-185.69"/>
<polygon fill="red" stroke="red" points="4476.2,-182.23 4465.62,-182.92 4474.32,-188.97 4476.2,-182.23"/>
<text text-anchor="middle" x="11087.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu4_layer0_mha_qkv -->
<g id="node65" class="node">
<title>gpu4_layer0_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="11149" cy="-676.34" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="11149" y="-687.64" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="11149" y="-672.64" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="11149" y="-657.64" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- gpu4_layer0_mha_attn -->
<g id="node66" class="node">
<title>gpu4_layer0_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="11271" cy="-512.38" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="11271" y="-516.18" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="11271" y="-501.18" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- gpu4_layer0_mha_qkv&#45;&gt;gpu4_layer0_mha_attn -->
<g id="edge17" class="edge">
<title>gpu4_layer0_mha_qkv&#45;&gt;gpu4_layer0_mha_attn</title>
<path fill="none" stroke="black" d="M11174.28,-641.78C11195.28,-613.9 11225,-574.45 11245.94,-546.65"/>
<polygon fill="black" stroke="black" points="11248.91,-548.52 11252.13,-538.43 11243.32,-544.31 11248.91,-548.52"/>
</g>
<!-- gpu4_layer0_mha_out -->
<g id="node67" class="node">
<title>gpu4_layer0_mha_out</title>
<ellipse fill="orange" stroke="black" cx="11357" cy="-400.43" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="11357" y="-411.73" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="11357" y="-396.73" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="11357" y="-381.73" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- gpu4_layer0_mha_attn&#45;&gt;gpu4_layer0_mha_out -->
<g id="edge18" class="edge">
<title>gpu4_layer0_mha_attn&#45;&gt;gpu4_layer0_mha_out</title>
<path fill="none" stroke="black" d="M11290.3,-486.71C11300.5,-473.67 11313.28,-457.33 11324.91,-442.45"/>
<polygon fill="black" stroke="black" points="11327.84,-444.4 11331.24,-434.37 11322.32,-440.09 11327.84,-444.4"/>
</g>
<!-- gpu4_layer0_mha_out&#45;&gt;gpu4_layer0_expert0 -->
<g id="edge101" class="edge">
<title>gpu4_layer0_mha_out&#45;&gt;gpu4_layer0_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11328.41,-367.51C11312.23,-349.43 11292.01,-326.86 11275.65,-308.59"/>
<polygon fill="blue" stroke="blue" points="11278.18,-306.16 11268.9,-301.05 11272.96,-310.83 11278.18,-306.16"/>
<text text-anchor="middle" x="11329.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu4_layer0_mha_out&#45;&gt;gpu4_layer0_expert1 -->
<g id="edge109" class="edge">
<title>gpu4_layer0_mha_out&#45;&gt;gpu4_layer0_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11357,-362.91C11357,-346.62 11357,-327.5 11357,-311.3"/>
<polygon fill="blue" stroke="blue" points="11360.5,-311.13 11357,-301.13 11353.5,-311.13 11360.5,-311.13"/>
<text text-anchor="middle" x="11378.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu4_layer0_mha_out&#45;&gt;gpu4_layer0_expert2 -->
<g id="edge117" class="edge">
<title>gpu4_layer0_mha_out&#45;&gt;gpu4_layer0_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11385.59,-367.51C11401.77,-349.43 11421.99,-326.86 11438.35,-308.59"/>
<polygon fill="blue" stroke="blue" points="11441.04,-310.83 11445.1,-301.05 11435.82,-306.16 11441.04,-310.83"/>
<text text-anchor="middle" x="11440.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu4_layer0_mha_out&#45;&gt;gpu4_layer0_expert3 -->
<g id="edge125" class="edge">
<title>gpu4_layer0_mha_out&#45;&gt;gpu4_layer0_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11403.3,-377.32C11437.36,-360.55 11484.41,-336.3 11524,-311.95 11526.78,-310.24 11529.63,-308.46 11532.48,-306.64"/>
<polygon fill="blue" stroke="blue" points="11534.54,-309.49 11541.05,-301.13 11530.75,-303.6 11534.54,-309.49"/>
<text text-anchor="middle" x="11513.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu4_layer1_mha_qkv -->
<g id="node68" class="node">
<title>gpu4_layer1_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="10958" cy="-676.34" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="10958" y="-687.64" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="10958" y="-672.64" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="10958" y="-657.64" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- gpu4_layer1_mha_attn -->
<g id="node69" class="node">
<title>gpu4_layer1_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="10958" cy="-512.38" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="10958" y="-516.18" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="10958" y="-501.18" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- gpu4_layer1_mha_qkv&#45;&gt;gpu4_layer1_mha_attn -->
<g id="edge19" class="edge">
<title>gpu4_layer1_mha_qkv&#45;&gt;gpu4_layer1_mha_attn</title>
<path fill="none" stroke="black" d="M10958,-638.59C10958,-611.89 10958,-575.95 10958,-549.42"/>
<polygon fill="black" stroke="black" points="10961.5,-549.4 10958,-539.4 10954.5,-549.4 10961.5,-549.4"/>
</g>
<!-- gpu4_layer1_mha_out -->
<g id="node70" class="node">
<title>gpu4_layer1_mha_out</title>
<ellipse fill="orange" stroke="black" cx="10958" cy="-400.43" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="10958" y="-411.73" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="10958" y="-396.73" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="10958" y="-381.73" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<!-- gpu4_layer1_mha_attn&#45;&gt;gpu4_layer1_mha_out -->
<g id="edge20" class="edge">
<title>gpu4_layer1_mha_attn&#45;&gt;gpu4_layer1_mha_out</title>
<path fill="none" stroke="black" d="M10958,-485.33C10958,-474.2 10958,-460.87 10958,-448.14"/>
<polygon fill="black" stroke="black" points="10961.5,-448.12 10958,-438.12 10954.5,-448.12 10961.5,-448.12"/>
</g>
<!-- gpu4_layer1_mha_out&#45;&gt;gpu4_layer1_expert0 -->
<g id="edge133" class="edge">
<title>gpu4_layer1_mha_out&#45;&gt;gpu4_layer1_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10919.81,-371.55C10908.5,-363.13 10896.16,-353.78 10885,-344.95 10870.09,-333.16 10854,-319.85 10840,-308.05"/>
<polygon fill="blue" stroke="blue" points="10841.92,-305.08 10832.02,-301.3 10837.4,-310.43 10841.92,-305.08"/>
<text text-anchor="middle" x="10906.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu4_layer1_mha_out&#45;&gt;gpu4_layer1_expert1 -->
<g id="edge141" class="edge">
<title>gpu4_layer1_mha_out&#45;&gt;gpu4_layer1_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10944.04,-363.75C10941.65,-357.5 10939.23,-351.05 10937,-344.95 10932.98,-333.94 10928.75,-321.88 10924.98,-310.95"/>
<polygon fill="blue" stroke="blue" points="10928.23,-309.62 10921.67,-301.29 10921.6,-311.88 10928.23,-309.62"/>
<text text-anchor="middle" x="10958.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu4_layer1_mha_out&#45;&gt;gpu4_layer1_expert2 -->
<g id="edge149" class="edge">
<title>gpu4_layer1_mha_out&#45;&gt;gpu4_layer1_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10976.56,-364.57C10985.63,-347.53 10996.52,-327.09 11005.57,-310.09"/>
<polygon fill="blue" stroke="blue" points="11008.78,-311.51 11010.39,-301.04 11002.6,-308.22 11008.78,-311.51"/>
<text text-anchor="middle" x="11015.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu4_layer1_mha_out&#45;&gt;gpu4_layer1_expert3 -->
<g id="edge157" class="edge">
<title>gpu4_layer1_mha_out&#45;&gt;gpu4_layer1_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M10998.83,-373.28C11012.36,-364.44 11027.42,-354.41 11041,-344.95 11058.3,-332.9 11077.04,-319.19 11093.2,-307.15"/>
<polygon fill="blue" stroke="blue" points="11095.48,-309.81 11101.39,-301.02 11091.29,-304.2 11095.48,-309.81"/>
<text text-anchor="middle" x="11082.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu5_layer0_expert0 -->
<g id="node71" class="node">
<title>gpu5_layer0_expert0</title>
<polygon fill="lightgreen" stroke="black" points="12185.5,-300.98 12092.5,-300.98 12092.5,-247.98 12185.5,-247.98 12185.5,-300.98"/>
<text text-anchor="middle" x="12139" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="12139" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="12139" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 5</text>
</g>
<!-- gpu5_layer0_expert1 -->
<g id="node72" class="node">
<title>gpu5_layer0_expert1</title>
<polygon fill="lightgreen" stroke="black" points="12296.5,-300.98 12203.5,-300.98 12203.5,-247.98 12296.5,-247.98 12296.5,-300.98"/>
<text text-anchor="middle" x="12250" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="12250" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="12250" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 5</text>
</g>
<!-- gpu5_layer0_expert2 -->
<g id="node73" class="node">
<title>gpu5_layer0_expert2</title>
<polygon fill="lightgreen" stroke="black" points="12407.5,-300.98 12314.5,-300.98 12314.5,-247.98 12407.5,-247.98 12407.5,-300.98"/>
<text text-anchor="middle" x="12361" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="12361" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="12361" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 5</text>
</g>
<!-- gpu5_layer0_expert3 -->
<g id="node74" class="node">
<title>gpu5_layer0_expert3</title>
<polygon fill="lightgreen" stroke="black" points="12518.5,-300.98 12425.5,-300.98 12425.5,-247.98 12518.5,-247.98 12518.5,-300.98"/>
<text text-anchor="middle" x="12472" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="12472" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="12472" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 5</text>
</g>
<!-- gpu5_layer1_expert0 -->
<g id="node75" class="node">
<title>gpu5_layer1_expert0</title>
<polygon fill="lightgreen" stroke="black" points="11741.5,-300.98 11648.5,-300.98 11648.5,-247.98 11741.5,-247.98 11741.5,-300.98"/>
<text text-anchor="middle" x="11695" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="11695" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="11695" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 5</text>
</g>
<!-- gpu13_layer2_expert0 -->
<g id="node183" class="node">
<title>gpu13_layer2_expert0</title>
<polygon fill="lightgreen" stroke="black" points="5025.5,-186 4932.5,-186 4932.5,-133 5025.5,-133 5025.5,-186"/>
<text text-anchor="middle" x="4979" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="4979" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="4979" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 5</text>
</g>
<!-- gpu5_layer1_expert0&#45;&gt;gpu13_layer2_expert0 -->
<g id="edge85" class="edge">
<title>gpu5_layer1_expert0&#45;&gt;gpu13_layer2_expert0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11665.83,-247.77C11657.12,-241.48 11647.16,-235.55 11637,-231.98 11583.25,-213.09 11181.95,-205.64 11125,-204 11041.92,-201.61 5323.04,-204.25 5035.77,-184.8"/>
<polygon fill="red" stroke="red" points="5035.95,-181.29 5025.63,-183.73 5035.21,-188.26 5035.95,-181.29"/>
<text text-anchor="middle" x="11558.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu5_layer1_expert1 -->
<g id="node76" class="node">
<title>gpu5_layer1_expert1</title>
<polygon fill="lightgreen" stroke="black" points="11852.5,-300.98 11759.5,-300.98 11759.5,-247.98 11852.5,-247.98 11852.5,-300.98"/>
<text text-anchor="middle" x="11806" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="11806" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="11806" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 5</text>
</g>
<!-- gpu13_layer2_expert1 -->
<g id="node184" class="node">
<title>gpu13_layer2_expert1</title>
<polygon fill="lightgreen" stroke="black" points="5136.5,-186 5043.5,-186 5043.5,-133 5136.5,-133 5136.5,-186"/>
<text text-anchor="middle" x="5090" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="5090" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="5090" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 5</text>
</g>
<!-- gpu5_layer1_expert1&#45;&gt;gpu13_layer2_expert1 -->
<g id="edge86" class="edge">
<title>gpu5_layer1_expert1&#45;&gt;gpu13_layer2_expert1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11777.34,-247.9C11769.29,-241.86 11760.21,-236 11751,-231.98 11686.87,-203.91 11665.71,-210.34 11596,-204 11508.3,-196.02 5445.12,-205.1 5146.9,-184.82"/>
<polygon fill="red" stroke="red" points="5146.95,-181.3 5136.63,-183.73 5146.21,-188.26 5146.95,-181.3"/>
<text text-anchor="middle" x="11749.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu5_layer1_expert2 -->
<g id="node77" class="node">
<title>gpu5_layer1_expert2</title>
<polygon fill="lightgreen" stroke="black" points="11963.5,-300.98 11870.5,-300.98 11870.5,-247.98 11963.5,-247.98 11963.5,-300.98"/>
<text text-anchor="middle" x="11917" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="11917" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="11917" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 5</text>
</g>
<!-- gpu13_layer2_expert2 -->
<g id="node185" class="node">
<title>gpu13_layer2_expert2</title>
<polygon fill="lightgreen" stroke="black" points="5247.5,-186 5154.5,-186 5154.5,-133 5247.5,-133 5247.5,-186"/>
<text text-anchor="middle" x="5201" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="5201" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="5201" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 5</text>
</g>
<!-- gpu5_layer1_expert2&#45;&gt;gpu13_layer2_expert2 -->
<g id="edge87" class="edge">
<title>gpu5_layer1_expert2&#45;&gt;gpu13_layer2_expert2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11886.36,-247.91C11878.69,-242.21 11870.29,-236.52 11862,-231.98 11830.81,-214.87 11822,-210.37 11787,-204 11610.78,-171.95 5588.94,-223.96 5257.57,-185.27"/>
<polygon fill="red" stroke="red" points="5258.05,-181.8 5247.63,-183.73 5256.98,-188.72 5258.05,-181.8"/>
<text text-anchor="middle" x="11870.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu5_layer1_expert3 -->
<g id="node78" class="node">
<title>gpu5_layer1_expert3</title>
<polygon fill="lightgreen" stroke="black" points="12074.5,-300.98 11981.5,-300.98 11981.5,-247.98 12074.5,-247.98 12074.5,-300.98"/>
<text text-anchor="middle" x="12028" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="12028" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="12028" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 5</text>
</g>
<!-- gpu13_layer2_expert3 -->
<g id="node186" class="node">
<title>gpu13_layer2_expert3</title>
<polygon fill="lightgreen" stroke="black" points="5358.5,-186 5265.5,-186 5265.5,-133 5358.5,-133 5358.5,-186"/>
<text text-anchor="middle" x="5312" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="5312" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="5312" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 5</text>
</g>
<!-- gpu5_layer1_expert3&#45;&gt;gpu13_layer2_expert3 -->
<g id="edge88" class="edge">
<title>gpu5_layer1_expert3&#45;&gt;gpu13_layer2_expert3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M11996.74,-247.83C11973.79,-230.98 11941,-210.85 11908,-204 11730.18,-167.1 5547.68,-223.59 5370,-186 5369.53,-185.9 5369.06,-185.8 5368.59,-185.69"/>
<polygon fill="red" stroke="red" points="5369.2,-182.23 5358.62,-182.92 5367.32,-188.97 5369.2,-182.23"/>
<text text-anchor="middle" x="11980.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu5_layer0_mha_qkv -->
<g id="node79" class="node">
<title>gpu5_layer0_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="12053" cy="-676.34" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="12053" y="-687.64" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="12053" y="-672.64" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="12053" y="-657.64" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- gpu5_layer0_mha_attn -->
<g id="node80" class="node">
<title>gpu5_layer0_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="12170" cy="-512.38" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="12170" y="-516.18" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="12170" y="-501.18" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- gpu5_layer0_mha_qkv&#45;&gt;gpu5_layer0_mha_attn -->
<g id="edge21" class="edge">
<title>gpu5_layer0_mha_qkv&#45;&gt;gpu5_layer0_mha_attn</title>
<path fill="none" stroke="black" d="M12077.53,-641.39C12097.69,-613.48 12126.09,-574.17 12146.08,-546.49"/>
<polygon fill="black" stroke="black" points="12148.98,-548.46 12152,-538.3 12143.3,-544.36 12148.98,-548.46"/>
</g>
<!-- gpu5_layer0_mha_out -->
<g id="node81" class="node">
<title>gpu5_layer0_mha_out</title>
<ellipse fill="orange" stroke="black" cx="12250" cy="-400.43" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="12250" y="-411.73" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="12250" y="-396.73" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="12250" y="-381.73" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- gpu5_layer0_mha_attn&#45;&gt;gpu5_layer0_mha_out -->
<g id="edge22" class="edge">
<title>gpu5_layer0_mha_attn&#45;&gt;gpu5_layer0_mha_out</title>
<path fill="none" stroke="black" d="M12188.15,-486.43C12197.48,-473.62 12209.09,-457.66 12219.73,-443.04"/>
<polygon fill="black" stroke="black" points="12222.8,-444.77 12225.85,-434.62 12217.14,-440.65 12222.8,-444.77"/>
</g>
<!-- gpu5_layer0_mha_out&#45;&gt;gpu5_layer0_expert0 -->
<g id="edge102" class="edge">
<title>gpu5_layer0_mha_out&#45;&gt;gpu5_layer0_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M12221.41,-367.51C12205.23,-349.43 12185.01,-326.86 12168.65,-308.59"/>
<polygon fill="blue" stroke="blue" points="12171.18,-306.16 12161.9,-301.05 12165.96,-310.83 12171.18,-306.16"/>
<text text-anchor="middle" x="12222.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu5_layer0_mha_out&#45;&gt;gpu5_layer0_expert1 -->
<g id="edge110" class="edge">
<title>gpu5_layer0_mha_out&#45;&gt;gpu5_layer0_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M12250,-362.91C12250,-346.62 12250,-327.5 12250,-311.3"/>
<polygon fill="blue" stroke="blue" points="12253.5,-311.13 12250,-301.13 12246.5,-311.13 12253.5,-311.13"/>
<text text-anchor="middle" x="12271.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu5_layer0_mha_out&#45;&gt;gpu5_layer0_expert2 -->
<g id="edge118" class="edge">
<title>gpu5_layer0_mha_out&#45;&gt;gpu5_layer0_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M12278.59,-367.51C12294.77,-349.43 12314.99,-326.86 12331.35,-308.59"/>
<polygon fill="blue" stroke="blue" points="12334.04,-310.83 12338.1,-301.05 12328.82,-306.16 12334.04,-310.83"/>
<text text-anchor="middle" x="12333.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu5_layer0_mha_out&#45;&gt;gpu5_layer0_expert3 -->
<g id="edge126" class="edge">
<title>gpu5_layer0_mha_out&#45;&gt;gpu5_layer0_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M12296.3,-377.32C12330.36,-360.55 12377.41,-336.3 12417,-311.95 12419.78,-310.24 12422.63,-308.46 12425.48,-306.64"/>
<polygon fill="blue" stroke="blue" points="12427.54,-309.49 12434.05,-301.13 12423.75,-303.6 12427.54,-309.49"/>
<text text-anchor="middle" x="12406.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu5_layer1_mha_qkv -->
<g id="node82" class="node">
<title>gpu5_layer1_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="11862" cy="-676.34" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="11862" y="-687.64" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="11862" y="-672.64" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="11862" y="-657.64" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- gpu5_layer1_mha_attn -->
<g id="node83" class="node">
<title>gpu5_layer1_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="11862" cy="-512.38" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="11862" y="-516.18" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="11862" y="-501.18" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- gpu5_layer1_mha_qkv&#45;&gt;gpu5_layer1_mha_attn -->
<g id="edge23" class="edge">
<title>gpu5_layer1_mha_qkv&#45;&gt;gpu5_layer1_mha_attn</title>
<path fill="none" stroke="black" d="M11862,-638.59C11862,-611.89 11862,-575.95 11862,-549.42"/>
<polygon fill="black" stroke="black" points="11865.5,-549.4 11862,-539.4 11858.5,-549.4 11865.5,-549.4"/>
</g>
<!-- gpu5_layer1_mha_out -->
<g id="node84" class="node">
<title>gpu5_layer1_mha_out</title>
<ellipse fill="orange" stroke="black" cx="11862" cy="-400.43" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="11862" y="-411.73" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="11862" y="-396.73" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="11862" y="-381.73" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<!-- gpu5_layer1_mha_attn&#45;&gt;gpu5_layer1_mha_out -->
<g id="edge24" class="edge">
<title>gpu5_layer1_mha_attn&#45;&gt;gpu5_layer1_mha_out</title>
<path fill="none" stroke="black" d="M11862,-485.33C11862,-474.2 11862,-460.87 11862,-448.14"/>
<polygon fill="black" stroke="black" points="11865.5,-448.12 11862,-438.12 11858.5,-448.12 11865.5,-448.12"/>
</g>
<!-- gpu5_layer1_mha_out&#45;&gt;gpu5_layer1_expert0 -->
<g id="edge134" class="edge">
<title>gpu5_layer1_mha_out&#45;&gt;gpu5_layer1_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11822.27,-372.77C11809.6,-364.07 11795.6,-354.26 11783,-344.95 11766.88,-333.05 11749.5,-319.49 11734.47,-307.52"/>
<polygon fill="blue" stroke="blue" points="11736.38,-304.57 11726.39,-301.06 11732.01,-310.04 11736.38,-304.57"/>
<text text-anchor="middle" x="11804.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu5_layer1_mha_out&#45;&gt;gpu5_layer1_expert1 -->
<g id="edge142" class="edge">
<title>gpu5_layer1_mha_out&#45;&gt;gpu5_layer1_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11846.1,-364.24C11838.53,-347.49 11829.5,-327.5 11821.93,-310.74"/>
<polygon fill="blue" stroke="blue" points="11824.97,-308.96 11817.66,-301.29 11818.59,-311.85 11824.97,-308.96"/>
<text text-anchor="middle" x="11858.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu5_layer1_mha_out&#45;&gt;gpu5_layer1_expert2 -->
<g id="edge150" class="edge">
<title>gpu5_layer1_mha_out&#45;&gt;gpu5_layer1_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11877.61,-364.24C11885.05,-347.49 11893.92,-327.5 11901.35,-310.74"/>
<polygon fill="blue" stroke="blue" points="11904.69,-311.85 11905.55,-301.29 11898.29,-309.01 11904.69,-311.85"/>
<text text-anchor="middle" x="11913.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu5_layer1_mha_out&#45;&gt;gpu5_layer1_expert3 -->
<g id="edge158" class="edge">
<title>gpu5_layer1_mha_out&#45;&gt;gpu5_layer1_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M11901.03,-372.35C11913.27,-363.71 11926.78,-354.04 11939,-344.95 11955.06,-333.01 11972.47,-319.55 11987.59,-307.67"/>
<polygon fill="blue" stroke="blue" points="11990.04,-310.19 11995.73,-301.26 11985.71,-304.69 11990.04,-310.19"/>
<text text-anchor="middle" x="11979.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu6_layer0_expert0 -->
<g id="node85" class="node">
<title>gpu6_layer0_expert0</title>
<polygon fill="lightyellow" stroke="black" points="13078.5,-300.98 12985.5,-300.98 12985.5,-247.98 13078.5,-247.98 13078.5,-300.98"/>
<text text-anchor="middle" x="13032" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="13032" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="13032" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 6</text>
</g>
<!-- gpu6_layer0_expert1 -->
<g id="node86" class="node">
<title>gpu6_layer0_expert1</title>
<polygon fill="lightyellow" stroke="black" points="13189.5,-300.98 13096.5,-300.98 13096.5,-247.98 13189.5,-247.98 13189.5,-300.98"/>
<text text-anchor="middle" x="13143" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="13143" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="13143" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 6</text>
</g>
<!-- gpu6_layer0_expert2 -->
<g id="node87" class="node">
<title>gpu6_layer0_expert2</title>
<polygon fill="lightyellow" stroke="black" points="13300.5,-300.98 13207.5,-300.98 13207.5,-247.98 13300.5,-247.98 13300.5,-300.98"/>
<text text-anchor="middle" x="13254" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="13254" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="13254" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 6</text>
</g>
<!-- gpu6_layer0_expert3 -->
<g id="node88" class="node">
<title>gpu6_layer0_expert3</title>
<polygon fill="lightyellow" stroke="black" points="13411.5,-300.98 13318.5,-300.98 13318.5,-247.98 13411.5,-247.98 13411.5,-300.98"/>
<text text-anchor="middle" x="13365" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="13365" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="13365" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 6</text>
</g>
<!-- gpu6_layer1_expert0 -->
<g id="node89" class="node">
<title>gpu6_layer1_expert0</title>
<polygon fill="lightyellow" stroke="black" points="12634.5,-300.98 12541.5,-300.98 12541.5,-247.98 12634.5,-247.98 12634.5,-300.98"/>
<text text-anchor="middle" x="12588" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="12588" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="12588" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 6</text>
</g>
<!-- gpu14_layer2_expert0 -->
<g id="node197" class="node">
<title>gpu14_layer2_expert0</title>
<polygon fill="lightyellow" stroke="black" points="5918.5,-186 5825.5,-186 5825.5,-133 5918.5,-133 5918.5,-186"/>
<text text-anchor="middle" x="5872" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="5872" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="5872" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 6</text>
</g>
<!-- gpu6_layer1_expert0&#45;&gt;gpu14_layer2_expert0 -->
<g id="edge89" class="edge">
<title>gpu6_layer1_expert0&#45;&gt;gpu14_layer2_expert0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M12558.83,-247.77C12550.12,-241.48 12540.16,-235.55 12530,-231.98 12476.25,-213.09 12074.95,-205.64 12018,-204 11934.92,-201.61 6216.04,-204.25 5928.77,-184.8"/>
<polygon fill="red" stroke="red" points="5928.95,-181.29 5918.63,-183.73 5928.21,-188.26 5928.95,-181.29"/>
<text text-anchor="middle" x="12451.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu6_layer1_expert1 -->
<g id="node90" class="node">
<title>gpu6_layer1_expert1</title>
<polygon fill="lightyellow" stroke="black" points="12745.5,-300.98 12652.5,-300.98 12652.5,-247.98 12745.5,-247.98 12745.5,-300.98"/>
<text text-anchor="middle" x="12699" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="12699" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="12699" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 6</text>
</g>
<!-- gpu14_layer2_expert1 -->
<g id="node198" class="node">
<title>gpu14_layer2_expert1</title>
<polygon fill="lightyellow" stroke="black" points="6029.5,-186 5936.5,-186 5936.5,-133 6029.5,-133 6029.5,-186"/>
<text text-anchor="middle" x="5983" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="5983" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="5983" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 6</text>
</g>
<!-- gpu6_layer1_expert1&#45;&gt;gpu14_layer2_expert1 -->
<g id="edge90" class="edge">
<title>gpu6_layer1_expert1&#45;&gt;gpu14_layer2_expert1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M12670.34,-247.9C12662.29,-241.86 12653.21,-236 12644,-231.98 12579.87,-203.91 12558.71,-210.34 12489,-204 12401.3,-196.02 6338.12,-205.1 6039.9,-184.82"/>
<polygon fill="red" stroke="red" points="6039.95,-181.3 6029.63,-183.73 6039.21,-188.26 6039.95,-181.3"/>
<text text-anchor="middle" x="12642.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu6_layer1_expert2 -->
<g id="node91" class="node">
<title>gpu6_layer1_expert2</title>
<polygon fill="lightyellow" stroke="black" points="12856.5,-300.98 12763.5,-300.98 12763.5,-247.98 12856.5,-247.98 12856.5,-300.98"/>
<text text-anchor="middle" x="12810" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="12810" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="12810" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 6</text>
</g>
<!-- gpu14_layer2_expert2 -->
<g id="node199" class="node">
<title>gpu14_layer2_expert2</title>
<polygon fill="lightyellow" stroke="black" points="6140.5,-186 6047.5,-186 6047.5,-133 6140.5,-133 6140.5,-186"/>
<text text-anchor="middle" x="6094" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="6094" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="6094" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 6</text>
</g>
<!-- gpu6_layer1_expert2&#45;&gt;gpu14_layer2_expert2 -->
<g id="edge91" class="edge">
<title>gpu6_layer1_expert2&#45;&gt;gpu14_layer2_expert2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M12779.36,-247.91C12771.69,-242.21 12763.29,-236.52 12755,-231.98 12723.81,-214.87 12715,-210.37 12680,-204 12503.78,-171.95 6481.94,-223.96 6150.57,-185.27"/>
<polygon fill="red" stroke="red" points="6151.05,-181.8 6140.63,-183.73 6149.98,-188.72 6151.05,-181.8"/>
<text text-anchor="middle" x="12763.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu6_layer1_expert3 -->
<g id="node92" class="node">
<title>gpu6_layer1_expert3</title>
<polygon fill="lightyellow" stroke="black" points="12967.5,-300.98 12874.5,-300.98 12874.5,-247.98 12967.5,-247.98 12967.5,-300.98"/>
<text text-anchor="middle" x="12921" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="12921" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="12921" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 6</text>
</g>
<!-- gpu14_layer2_expert3 -->
<g id="node200" class="node">
<title>gpu14_layer2_expert3</title>
<polygon fill="lightyellow" stroke="black" points="6251.5,-186 6158.5,-186 6158.5,-133 6251.5,-133 6251.5,-186"/>
<text text-anchor="middle" x="6205" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="6205" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="6205" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 6</text>
</g>
<!-- gpu6_layer1_expert3&#45;&gt;gpu14_layer2_expert3 -->
<g id="edge92" class="edge">
<title>gpu6_layer1_expert3&#45;&gt;gpu14_layer2_expert3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M12889.74,-247.83C12866.79,-230.98 12834,-210.85 12801,-204 12623.18,-167.1 6440.68,-223.59 6263,-186 6262.53,-185.9 6262.06,-185.8 6261.59,-185.69"/>
<polygon fill="red" stroke="red" points="6262.2,-182.23 6251.62,-182.92 6260.32,-188.97 6262.2,-182.23"/>
<text text-anchor="middle" x="12873.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu6_layer0_mha_qkv -->
<g id="node93" class="node">
<title>gpu6_layer0_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="13037" cy="-676.34" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="13037" y="-687.64" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="13037" y="-672.64" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="13037" y="-657.64" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- gpu6_layer0_mha_attn -->
<g id="node94" class="node">
<title>gpu6_layer0_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="13107" cy="-512.38" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="13107" y="-516.18" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="13107" y="-501.18" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- gpu6_layer0_mha_qkv&#45;&gt;gpu6_layer0_mha_attn -->
<g id="edge25" class="edge">
<title>gpu6_layer0_mha_qkv&#45;&gt;gpu6_layer0_mha_attn</title>
<path fill="none" stroke="black" d="M13052.36,-639.8C13064.08,-612.68 13080.15,-575.51 13091.82,-548.5"/>
<polygon fill="black" stroke="black" points="13095.15,-549.61 13095.91,-539.04 13088.73,-546.83 13095.15,-549.61"/>
</g>
<!-- gpu6_layer0_mha_out -->
<g id="node95" class="node">
<title>gpu6_layer0_mha_out</title>
<ellipse fill="orange" stroke="black" cx="13143" cy="-400.43" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="13143" y="-411.73" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="13143" y="-396.73" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="13143" y="-381.73" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- gpu6_layer0_mha_attn&#45;&gt;gpu6_layer0_mha_out -->
<g id="edge26" class="edge">
<title>gpu6_layer0_mha_attn&#45;&gt;gpu6_layer0_mha_out</title>
<path fill="none" stroke="black" d="M13115.44,-485.6C13119.18,-474.17 13123.7,-460.37 13127.99,-447.28"/>
<polygon fill="black" stroke="black" points="13131.42,-448.05 13131.21,-437.45 13124.77,-445.87 13131.42,-448.05"/>
</g>
<!-- gpu6_layer0_mha_out&#45;&gt;gpu6_layer0_expert0 -->
<g id="edge103" class="edge">
<title>gpu6_layer0_mha_out&#45;&gt;gpu6_layer0_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M13114.41,-367.51C13098.23,-349.43 13078.01,-326.86 13061.65,-308.59"/>
<polygon fill="blue" stroke="blue" points="13064.18,-306.16 13054.9,-301.05 13058.96,-310.83 13064.18,-306.16"/>
<text text-anchor="middle" x="13115.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu6_layer0_mha_out&#45;&gt;gpu6_layer0_expert1 -->
<g id="edge111" class="edge">
<title>gpu6_layer0_mha_out&#45;&gt;gpu6_layer0_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M13143,-362.91C13143,-346.62 13143,-327.5 13143,-311.3"/>
<polygon fill="blue" stroke="blue" points="13146.5,-311.13 13143,-301.13 13139.5,-311.13 13146.5,-311.13"/>
<text text-anchor="middle" x="13164.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu6_layer0_mha_out&#45;&gt;gpu6_layer0_expert2 -->
<g id="edge119" class="edge">
<title>gpu6_layer0_mha_out&#45;&gt;gpu6_layer0_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M13171.59,-367.51C13187.77,-349.43 13207.99,-326.86 13224.35,-308.59"/>
<polygon fill="blue" stroke="blue" points="13227.04,-310.83 13231.1,-301.05 13221.82,-306.16 13227.04,-310.83"/>
<text text-anchor="middle" x="13226.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu6_layer0_mha_out&#45;&gt;gpu6_layer0_expert3 -->
<g id="edge127" class="edge">
<title>gpu6_layer0_mha_out&#45;&gt;gpu6_layer0_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M13189.3,-377.32C13223.36,-360.55 13270.41,-336.3 13310,-311.95 13312.78,-310.24 13315.63,-308.46 13318.48,-306.64"/>
<polygon fill="blue" stroke="blue" points="13320.54,-309.49 13327.05,-301.13 13316.75,-303.6 13320.54,-309.49"/>
<text text-anchor="middle" x="13299.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu6_layer1_mha_qkv -->
<g id="node96" class="node">
<title>gpu6_layer1_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="12743" cy="-676.34" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="12743" y="-687.64" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="12743" y="-672.64" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="12743" y="-657.64" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- gpu6_layer1_mha_attn -->
<g id="node97" class="node">
<title>gpu6_layer1_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="12743" cy="-512.38" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="12743" y="-516.18" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="12743" y="-501.18" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- gpu6_layer1_mha_qkv&#45;&gt;gpu6_layer1_mha_attn -->
<g id="edge27" class="edge">
<title>gpu6_layer1_mha_qkv&#45;&gt;gpu6_layer1_mha_attn</title>
<path fill="none" stroke="black" d="M12743,-638.59C12743,-611.89 12743,-575.95 12743,-549.42"/>
<polygon fill="black" stroke="black" points="12746.5,-549.4 12743,-539.4 12739.5,-549.4 12746.5,-549.4"/>
</g>
<!-- gpu6_layer1_mha_out -->
<g id="node98" class="node">
<title>gpu6_layer1_mha_out</title>
<ellipse fill="orange" stroke="black" cx="12743" cy="-400.43" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="12743" y="-411.73" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="12743" y="-396.73" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="12743" y="-381.73" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<!-- gpu6_layer1_mha_attn&#45;&gt;gpu6_layer1_mha_out -->
<g id="edge28" class="edge">
<title>gpu6_layer1_mha_attn&#45;&gt;gpu6_layer1_mha_out</title>
<path fill="none" stroke="black" d="M12743,-485.33C12743,-474.2 12743,-460.87 12743,-448.14"/>
<polygon fill="black" stroke="black" points="12746.5,-448.12 12743,-438.12 12739.5,-448.12 12746.5,-448.12"/>
</g>
<!-- gpu6_layer1_mha_out&#45;&gt;gpu6_layer1_expert0 -->
<g id="edge135" class="edge">
<title>gpu6_layer1_mha_out&#45;&gt;gpu6_layer1_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M12705.36,-371.5C12694.21,-363.08 12682.04,-353.74 12671,-344.95 12656.13,-333.12 12640.05,-319.79 12626.04,-307.99"/>
<polygon fill="blue" stroke="blue" points="12627.96,-305.03 12618.06,-301.25 12623.44,-310.37 12627.96,-305.03"/>
<text text-anchor="middle" x="12692.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu6_layer1_mha_out&#45;&gt;gpu6_layer1_expert1 -->
<g id="edge143" class="edge">
<title>gpu6_layer1_mha_out&#45;&gt;gpu6_layer1_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M12730.27,-363.58C12724.39,-347 12717.42,-327.37 12711.56,-310.85"/>
<polygon fill="blue" stroke="blue" points="12714.71,-309.27 12708.07,-301.02 12708.11,-311.61 12714.71,-309.27"/>
<text text-anchor="middle" x="12744.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu6_layer1_mha_out&#45;&gt;gpu6_layer1_expert2 -->
<g id="edge151" class="edge">
<title>gpu6_layer1_mha_out&#45;&gt;gpu6_layer1_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M12761.84,-364.57C12771.05,-347.53 12782.1,-327.09 12791.29,-310.09"/>
<polygon fill="blue" stroke="blue" points="12794.51,-311.5 12796.18,-301.04 12788.35,-308.17 12794.51,-311.5"/>
<text text-anchor="middle" x="12801.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu6_layer1_mha_out&#45;&gt;gpu6_layer1_expert3 -->
<g id="edge159" class="edge">
<title>gpu6_layer1_mha_out&#45;&gt;gpu6_layer1_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M12784.35,-373.33C12798.04,-364.49 12813.28,-354.46 12827,-344.95 12844.33,-332.95 12863.07,-319.24 12879.23,-307.2"/>
<polygon fill="blue" stroke="blue" points="12881.52,-309.86 12887.42,-301.07 12877.32,-304.26 12881.52,-309.86"/>
<text text-anchor="middle" x="12868.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu7_layer0_expert0 -->
<g id="node99" class="node">
<title>gpu7_layer0_expert0</title>
<polygon fill="lightpink" stroke="black" points="13971.5,-300.98 13878.5,-300.98 13878.5,-247.98 13971.5,-247.98 13971.5,-300.98"/>
<text text-anchor="middle" x="13925" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="13925" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="13925" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 7</text>
</g>
<!-- gpu7_layer0_expert1 -->
<g id="node100" class="node">
<title>gpu7_layer0_expert1</title>
<polygon fill="lightpink" stroke="black" points="14082.5,-300.98 13989.5,-300.98 13989.5,-247.98 14082.5,-247.98 14082.5,-300.98"/>
<text text-anchor="middle" x="14036" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="14036" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="14036" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 7</text>
</g>
<!-- gpu7_layer0_expert2 -->
<g id="node101" class="node">
<title>gpu7_layer0_expert2</title>
<polygon fill="lightpink" stroke="black" points="14193.5,-300.98 14100.5,-300.98 14100.5,-247.98 14193.5,-247.98 14193.5,-300.98"/>
<text text-anchor="middle" x="14147" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="14147" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="14147" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 7</text>
</g>
<!-- gpu7_layer0_expert3 -->
<g id="node102" class="node">
<title>gpu7_layer0_expert3</title>
<polygon fill="lightpink" stroke="black" points="14304.5,-300.98 14211.5,-300.98 14211.5,-247.98 14304.5,-247.98 14304.5,-300.98"/>
<text text-anchor="middle" x="14258" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="14258" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="14258" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 7</text>
</g>
<!-- gpu7_layer1_expert0 -->
<g id="node103" class="node">
<title>gpu7_layer1_expert0</title>
<polygon fill="lightpink" stroke="black" points="13527.5,-300.98 13434.5,-300.98 13434.5,-247.98 13527.5,-247.98 13527.5,-300.98"/>
<text text-anchor="middle" x="13481" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="13481" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="13481" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 7</text>
</g>
<!-- gpu15_layer2_expert0 -->
<g id="node211" class="node">
<title>gpu15_layer2_expert0</title>
<polygon fill="lightpink" stroke="black" points="6811.5,-186 6718.5,-186 6718.5,-133 6811.5,-133 6811.5,-186"/>
<text text-anchor="middle" x="6765" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="6765" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="6765" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 7</text>
</g>
<!-- gpu7_layer1_expert0&#45;&gt;gpu15_layer2_expert0 -->
<g id="edge93" class="edge">
<title>gpu7_layer1_expert0&#45;&gt;gpu15_layer2_expert0</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M13451.83,-247.77C13443.12,-241.48 13433.16,-235.55 13423,-231.98 13369.25,-213.09 12967.95,-205.64 12911,-204 12827.92,-201.61 7109.04,-204.25 6821.77,-184.8"/>
<polygon fill="red" stroke="red" points="6821.95,-181.29 6811.63,-183.73 6821.21,-188.26 6821.95,-181.29"/>
<text text-anchor="middle" x="13344.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu7_layer1_expert1 -->
<g id="node104" class="node">
<title>gpu7_layer1_expert1</title>
<polygon fill="lightpink" stroke="black" points="13638.5,-300.98 13545.5,-300.98 13545.5,-247.98 13638.5,-247.98 13638.5,-300.98"/>
<text text-anchor="middle" x="13592" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="13592" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="13592" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 7</text>
</g>
<!-- gpu15_layer2_expert1 -->
<g id="node212" class="node">
<title>gpu15_layer2_expert1</title>
<polygon fill="lightpink" stroke="black" points="6922.5,-186 6829.5,-186 6829.5,-133 6922.5,-133 6922.5,-186"/>
<text text-anchor="middle" x="6876" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="6876" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="6876" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 7</text>
</g>
<!-- gpu7_layer1_expert1&#45;&gt;gpu15_layer2_expert1 -->
<g id="edge94" class="edge">
<title>gpu7_layer1_expert1&#45;&gt;gpu15_layer2_expert1</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M13563.34,-247.9C13555.29,-241.86 13546.21,-236 13537,-231.98 13472.87,-203.91 13451.71,-210.34 13382,-204 13294.3,-196.02 7231.12,-205.1 6932.9,-184.82"/>
<polygon fill="red" stroke="red" points="6932.95,-181.3 6922.63,-183.73 6932.21,-188.26 6932.95,-181.3"/>
<text text-anchor="middle" x="13535.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu7_layer1_expert2 -->
<g id="node105" class="node">
<title>gpu7_layer1_expert2</title>
<polygon fill="lightpink" stroke="black" points="13749.5,-300.98 13656.5,-300.98 13656.5,-247.98 13749.5,-247.98 13749.5,-300.98"/>
<text text-anchor="middle" x="13703" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="13703" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="13703" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 7</text>
</g>
<!-- gpu15_layer2_expert2 -->
<g id="node213" class="node">
<title>gpu15_layer2_expert2</title>
<polygon fill="lightpink" stroke="black" points="7033.5,-186 6940.5,-186 6940.5,-133 7033.5,-133 7033.5,-186"/>
<text text-anchor="middle" x="6987" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="6987" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="6987" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 7</text>
</g>
<!-- gpu7_layer1_expert2&#45;&gt;gpu15_layer2_expert2 -->
<g id="edge95" class="edge">
<title>gpu7_layer1_expert2&#45;&gt;gpu15_layer2_expert2</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M13672.36,-247.91C13664.69,-242.21 13656.29,-236.52 13648,-231.98 13616.81,-214.87 13608,-210.37 13573,-204 13396.78,-171.95 7374.94,-223.96 7043.57,-185.27"/>
<polygon fill="red" stroke="red" points="7044.05,-181.8 7033.63,-183.73 7042.98,-188.72 7044.05,-181.8"/>
<text text-anchor="middle" x="13656.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu7_layer1_expert3 -->
<g id="node106" class="node">
<title>gpu7_layer1_expert3</title>
<polygon fill="lightpink" stroke="black" points="13860.5,-300.98 13767.5,-300.98 13767.5,-247.98 13860.5,-247.98 13860.5,-300.98"/>
<text text-anchor="middle" x="13814" y="-285.78" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="13814" y="-270.78" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="13814" y="-255.78" font-family="Times,serif" font-size="14.00">TP&#45;shard 7</text>
</g>
<!-- gpu15_layer2_expert3 -->
<g id="node214" class="node">
<title>gpu15_layer2_expert3</title>
<polygon fill="lightpink" stroke="black" points="7144.5,-186 7051.5,-186 7051.5,-133 7144.5,-133 7144.5,-186"/>
<text text-anchor="middle" x="7098" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="7098" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="7098" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 7</text>
</g>
<!-- gpu7_layer1_expert3&#45;&gt;gpu15_layer2_expert3 -->
<g id="edge96" class="edge">
<title>gpu7_layer1_expert3&#45;&gt;gpu15_layer2_expert3</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M13782.73,-247.87C13759.78,-231.04 13726.99,-210.91 13694,-204 13524.6,-168.51 7789.62,-161.25 7154.9,-160.56"/>
<polygon fill="red" stroke="red" points="7154.64,-157.06 7144.63,-160.55 7154.63,-164.06 7154.64,-157.06"/>
<text text-anchor="middle" x="13766.5" y="-207.8" font-family="Times,serif" font-size="14.00">PP&#45;comm</text>
</g>
<!-- gpu7_layer0_mha_qkv -->
<g id="node107" class="node">
<title>gpu7_layer0_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="13854" cy="-676.34" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="13854" y="-687.64" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="13854" y="-672.64" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="13854" y="-657.64" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- gpu7_layer0_mha_attn -->
<g id="node108" class="node">
<title>gpu7_layer0_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="14012" cy="-512.38" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="14012" y="-516.18" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="14012" y="-501.18" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- gpu7_layer0_mha_qkv&#45;&gt;gpu7_layer0_mha_attn -->
<g id="edge29" class="edge">
<title>gpu7_layer0_mha_qkv&#45;&gt;gpu7_layer0_mha_attn</title>
<path fill="none" stroke="black" d="M13885.22,-643.34C13913.12,-614.74 13953.76,-573.08 13981.46,-544.69"/>
<polygon fill="black" stroke="black" points="13984.08,-547.02 13988.56,-537.41 13979.07,-542.13 13984.08,-547.02"/>
</g>
<!-- gpu7_layer0_mha_out -->
<g id="node109" class="node">
<title>gpu7_layer0_mha_out</title>
<ellipse fill="orange" stroke="black" cx="14036" cy="-400.43" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="14036" y="-411.73" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="14036" y="-396.73" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="14036" y="-381.73" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- gpu7_layer0_mha_attn&#45;&gt;gpu7_layer0_mha_out -->
<g id="edge30" class="edge">
<title>gpu7_layer0_mha_attn&#45;&gt;gpu7_layer0_mha_out</title>
<path fill="none" stroke="black" d="M14017.63,-485.6C14020.08,-474.39 14023.02,-460.88 14025.83,-448.01"/>
<polygon fill="black" stroke="black" points="14029.33,-448.39 14028.05,-437.87 14022.49,-446.89 14029.33,-448.39"/>
</g>
<!-- gpu7_layer0_mha_out&#45;&gt;gpu7_layer0_expert0 -->
<g id="edge104" class="edge">
<title>gpu7_layer0_mha_out&#45;&gt;gpu7_layer0_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M14007.41,-367.51C13991.23,-349.43 13971.01,-326.86 13954.65,-308.59"/>
<polygon fill="blue" stroke="blue" points="13957.18,-306.16 13947.9,-301.05 13951.96,-310.83 13957.18,-306.16"/>
<text text-anchor="middle" x="14008.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu7_layer0_mha_out&#45;&gt;gpu7_layer0_expert1 -->
<g id="edge112" class="edge">
<title>gpu7_layer0_mha_out&#45;&gt;gpu7_layer0_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M14036,-362.91C14036,-346.62 14036,-327.5 14036,-311.3"/>
<polygon fill="blue" stroke="blue" points="14039.5,-311.13 14036,-301.13 14032.5,-311.13 14039.5,-311.13"/>
<text text-anchor="middle" x="14057.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu7_layer0_mha_out&#45;&gt;gpu7_layer0_expert2 -->
<g id="edge120" class="edge">
<title>gpu7_layer0_mha_out&#45;&gt;gpu7_layer0_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M14064.59,-367.51C14080.77,-349.43 14100.99,-326.86 14117.35,-308.59"/>
<polygon fill="blue" stroke="blue" points="14120.04,-310.83 14124.1,-301.05 14114.82,-306.16 14120.04,-310.83"/>
<text text-anchor="middle" x="14119.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu7_layer0_mha_out&#45;&gt;gpu7_layer0_expert3 -->
<g id="edge128" class="edge">
<title>gpu7_layer0_mha_out&#45;&gt;gpu7_layer0_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M14082.3,-377.32C14116.36,-360.55 14163.41,-336.3 14203,-311.95 14205.78,-310.24 14208.63,-308.46 14211.48,-306.64"/>
<polygon fill="blue" stroke="blue" points="14213.54,-309.49 14220.05,-301.13 14209.75,-303.6 14213.54,-309.49"/>
<text text-anchor="middle" x="14192.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu7_layer1_mha_qkv -->
<g id="node110" class="node">
<title>gpu7_layer1_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="13635" cy="-676.34" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="13635" y="-687.64" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="13635" y="-672.64" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="13635" y="-657.64" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- gpu7_layer1_mha_attn -->
<g id="node111" class="node">
<title>gpu7_layer1_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="13635" cy="-512.38" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="13635" y="-516.18" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="13635" y="-501.18" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- gpu7_layer1_mha_qkv&#45;&gt;gpu7_layer1_mha_attn -->
<g id="edge31" class="edge">
<title>gpu7_layer1_mha_qkv&#45;&gt;gpu7_layer1_mha_attn</title>
<path fill="none" stroke="black" d="M13635,-638.59C13635,-611.89 13635,-575.95 13635,-549.42"/>
<polygon fill="black" stroke="black" points="13638.5,-549.4 13635,-539.4 13631.5,-549.4 13638.5,-549.4"/>
</g>
<!-- gpu7_layer1_mha_out -->
<g id="node112" class="node">
<title>gpu7_layer1_mha_out</title>
<ellipse fill="orange" stroke="black" cx="13635" cy="-400.43" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="13635" y="-411.73" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="13635" y="-396.73" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="13635" y="-381.73" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- gpu7_layer1_mha_attn&#45;&gt;gpu7_layer1_mha_out -->
<g id="edge32" class="edge">
<title>gpu7_layer1_mha_attn&#45;&gt;gpu7_layer1_mha_out</title>
<path fill="none" stroke="black" d="M13635,-485.33C13635,-474.2 13635,-460.87 13635,-448.14"/>
<polygon fill="black" stroke="black" points="13638.5,-448.12 13635,-438.12 13631.5,-448.12 13638.5,-448.12"/>
</g>
<!-- gpu7_layer1_mha_out&#45;&gt;gpu7_layer1_expert0 -->
<g id="edge136" class="edge">
<title>gpu7_layer1_mha_out&#45;&gt;gpu7_layer1_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M13597.55,-371.17C13586.66,-362.82 13574.79,-353.6 13564,-344.95 13549.17,-333.07 13533.1,-319.73 13519.09,-307.94"/>
<polygon fill="blue" stroke="blue" points="13521,-304.97 13511.1,-301.2 13516.49,-310.32 13521,-304.97"/>
<text text-anchor="middle" x="13585.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu7_layer1_mha_out&#45;&gt;gpu7_layer1_expert1 -->
<g id="edge144" class="edge">
<title>gpu7_layer1_mha_out&#45;&gt;gpu7_layer1_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M13622.52,-363.68C13620.34,-357.44 13618.1,-351.01 13616,-344.95 13612.16,-333.88 13607.98,-321.8 13604.2,-310.87"/>
<polygon fill="blue" stroke="blue" points="13607.44,-309.53 13600.87,-301.22 13600.83,-311.81 13607.44,-309.53"/>
<text text-anchor="middle" x="13637.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu7_layer1_mha_out&#45;&gt;gpu7_layer1_expert2 -->
<g id="edge152" class="edge">
<title>gpu7_layer1_mha_out&#45;&gt;gpu7_layer1_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M13653.94,-364.9C13663.29,-347.86 13674.55,-327.34 13683.92,-310.26"/>
<polygon fill="blue" stroke="blue" points="13687.16,-311.62 13688.9,-301.17 13681.03,-308.26 13687.16,-311.62"/>
<text text-anchor="middle" x="13694.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu7_layer1_mha_out&#45;&gt;gpu7_layer1_expert3 -->
<g id="edge160" class="edge">
<title>gpu7_layer1_mha_out&#45;&gt;gpu7_layer1_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M13676.43,-373.65C13690.4,-364.76 13706,-354.6 13720,-344.95 13737.36,-332.99 13756.11,-319.3 13772.27,-307.25"/>
<polygon fill="blue" stroke="blue" points="13774.55,-309.91 13780.46,-301.11 13770.35,-304.31 13774.55,-309.91"/>
<text text-anchor="middle" x="13761.5" y="-333.75" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu8_layer3_expert0 -->
<g id="node117" class="node">
<title>gpu8_layer3_expert0</title>
<polygon fill="lightblue" stroke="black" points="116.5,-186 23.5,-186 23.5,-133 116.5,-133 116.5,-186"/>
<text text-anchor="middle" x="70" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="70" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="70" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 0</text>
</g>
<!-- output -->
<g id="node226" class="node">
<title>output</title>
<polygon fill="none" stroke="black" points="3759.23,-76 3350.03,-76 3244.77,0 3653.97,0 3759.23,-76"/>
<text text-anchor="middle" x="3502" y="-41.8" font-family="Times,serif" font-size="14.00">Output Tokens</text>
<text text-anchor="middle" x="3502" y="-26.8" font-family="Times,serif" font-size="14.00">(BS=1024, Seq=1024, H=4096)</text>
</g>
<!-- gpu8_layer3_expert0&#45;&gt;output -->
<g id="edge233" class="edge">
<title>gpu8_layer3_expert0&#45;&gt;output</title>
<path fill="none" stroke="black" d="M98.62,-132.84C106.67,-126.79 115.77,-120.96 125,-117 182.55,-92.32 201.64,-99.66 264,-94 853.56,-40.51 2664.17,-37.8 3288.07,-38.53"/>
<polygon fill="black" stroke="black" points="3288.07,-42.03 3298.08,-38.54 3288.08,-35.03 3288.07,-42.03"/>
<text text-anchor="middle" x="315.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu8_layer3_expert1 -->
<g id="node118" class="node">
<title>gpu8_layer3_expert1</title>
<polygon fill="lightblue" stroke="black" points="227.5,-186 134.5,-186 134.5,-133 227.5,-133 227.5,-186"/>
<text text-anchor="middle" x="181" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="181" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="181" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 0</text>
</g>
<!-- gpu8_layer3_expert1&#45;&gt;output -->
<g id="edge234" class="edge">
<title>gpu8_layer3_expert1&#45;&gt;output</title>
<path fill="none" stroke="black" d="M208.49,-132.82C216.75,-126.54 226.23,-120.6 236,-117 264.2,-106.62 341.08,-111.82 371,-109 422.76,-104.13 435.16,-97.81 487,-94 1032.49,-53.88 2696.19,-42.61 3289.24,-39.82"/>
<polygon fill="black" stroke="black" points="3289.63,-43.32 3299.61,-39.78 3289.59,-36.32 3289.63,-43.32"/>
<text text-anchor="middle" x="538.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu8_layer3_expert2 -->
<g id="node119" class="node">
<title>gpu8_layer3_expert2</title>
<polygon fill="lightblue" stroke="black" points="338.5,-186 245.5,-186 245.5,-133 338.5,-133 338.5,-186"/>
<text text-anchor="middle" x="292" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="292" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="292" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 0</text>
</g>
<!-- gpu8_layer3_expert2&#45;&gt;output -->
<g id="edge235" class="edge">
<title>gpu8_layer3_expert2&#45;&gt;output</title>
<path fill="none" stroke="black" d="M319.15,-132.87C327.47,-126.5 337.07,-120.5 347,-117 372.89,-107.86 566.7,-111.95 594,-109 630.4,-105.06 638.58,-97.7 675,-94 1180.87,-42.59 2719.31,-38.37 3287.85,-38.63"/>
<polygon fill="black" stroke="black" points="3288.22,-42.13 3298.22,-38.63 3288.22,-35.13 3288.22,-42.13"/>
<text text-anchor="middle" x="726.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu8_layer3_expert3 -->
<g id="node120" class="node">
<title>gpu8_layer3_expert3</title>
<polygon fill="lightblue" stroke="black" points="449.5,-186 356.5,-186 356.5,-133 449.5,-133 449.5,-186"/>
<text text-anchor="middle" x="403" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="403" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="403" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 0</text>
</g>
<!-- gpu8_layer3_expert3&#45;&gt;output -->
<g id="edge236" class="edge">
<title>gpu8_layer3_expert3&#45;&gt;output</title>
<path fill="none" stroke="black" d="M430.13,-132.82C438.46,-126.45 448.06,-120.47 458,-117 492,-105.14 746.09,-111.76 782,-109 833.83,-105.02 846.16,-97.89 898,-94 1360.9,-59.28 2756.23,-44.88 3290.62,-40.53"/>
<polygon fill="black" stroke="black" points="3290.78,-44.03 3300.75,-40.45 3290.73,-37.03 3290.78,-44.03"/>
<text text-anchor="middle" x="949.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu8_layer2_mha_qkv -->
<g id="node121" class="node">
<title>gpu8_layer2_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="680" cy="-512.38" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="680" y="-523.68" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="680" y="-508.68" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="680" y="-493.68" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- gpu8_layer2_mha_attn -->
<g id="node122" class="node">
<title>gpu8_layer2_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="680" cy="-400.43" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="680" y="-404.23" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="680" y="-389.23" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- gpu8_layer2_mha_qkv&#45;&gt;gpu8_layer2_mha_attn -->
<g id="edge33" class="edge">
<title>gpu8_layer2_mha_qkv&#45;&gt;gpu8_layer2_mha_attn</title>
<path fill="none" stroke="black" d="M680,-474.77C680,-462.79 680,-449.49 680,-437.54"/>
<polygon fill="black" stroke="black" points="683.5,-437.46 680,-427.46 676.5,-437.46 683.5,-437.46"/>
</g>
<!-- gpu8_layer2_mha_out -->
<g id="node123" class="node">
<title>gpu8_layer2_mha_out</title>
<ellipse fill="orange" stroke="black" cx="680" cy="-274.48" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="680" y="-285.78" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="680" y="-270.78" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="680" y="-255.78" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- gpu8_layer2_mha_attn&#45;&gt;gpu8_layer2_mha_out -->
<g id="edge34" class="edge">
<title>gpu8_layer2_mha_attn&#45;&gt;gpu8_layer2_mha_out</title>
<path fill="none" stroke="black" d="M680,-373.45C680,-358.75 680,-339.92 680,-322.7"/>
<polygon fill="black" stroke="black" points="683.5,-322.24 680,-312.24 676.5,-322.24 683.5,-322.24"/>
</g>
<!-- gpu8_layer2_mha_out&#45;&gt;gpu8_layer2_expert0 -->
<g id="edge161" class="edge">
<title>gpu8_layer2_mha_out&#45;&gt;gpu8_layer2_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M640.24,-246.42C616.11,-229.99 585.22,-208.97 560.03,-191.83"/>
<polygon fill="blue" stroke="blue" points="561.96,-188.91 551.73,-186.18 558.02,-194.7 561.96,-188.91"/>
<text text-anchor="middle" x="618.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu8_layer2_mha_out&#45;&gt;gpu8_layer2_expert1 -->
<g id="edge169" class="edge">
<title>gpu8_layer2_mha_out&#45;&gt;gpu8_layer2_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M662.9,-238.35C656.24,-224.67 648.62,-209.02 641.97,-195.36"/>
<polygon fill="blue" stroke="blue" points="645.07,-193.73 637.55,-186.27 638.78,-196.8 645.07,-193.73"/>
<text text-anchor="middle" x="674.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu8_layer2_mha_out&#45;&gt;gpu8_layer2_expert2 -->
<g id="edge177" class="edge">
<title>gpu8_layer2_mha_out&#45;&gt;gpu8_layer2_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M697.41,-238.35C704.19,-224.67 711.95,-209.02 718.72,-195.36"/>
<polygon fill="blue" stroke="blue" points="721.92,-196.79 723.22,-186.27 715.65,-193.68 721.92,-196.79"/>
<text text-anchor="middle" x="735.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu8_layer2_mha_out&#45;&gt;gpu8_layer2_expert3 -->
<g id="edge185" class="edge">
<title>gpu8_layer2_mha_out&#45;&gt;gpu8_layer2_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M719.99,-246.64C733.07,-237.85 747.66,-228.02 761,-219 774.01,-210.2 788.1,-200.63 801.04,-191.83"/>
<polygon fill="blue" stroke="blue" points="803.06,-194.69 809.35,-186.17 799.12,-188.9 803.06,-194.69"/>
<text text-anchor="middle" x="804.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu8_layer3_mha_qkv -->
<g id="node124" class="node">
<title>gpu8_layer3_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="231" cy="-512.38" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="231" y="-523.68" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="231" y="-508.68" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="231" y="-493.68" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- gpu8_layer3_mha_attn -->
<g id="node125" class="node">
<title>gpu8_layer3_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="231" cy="-400.43" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="231" y="-404.23" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="231" y="-389.23" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- gpu8_layer3_mha_qkv&#45;&gt;gpu8_layer3_mha_attn -->
<g id="edge35" class="edge">
<title>gpu8_layer3_mha_qkv&#45;&gt;gpu8_layer3_mha_attn</title>
<path fill="none" stroke="black" d="M231,-474.77C231,-462.79 231,-449.49 231,-437.54"/>
<polygon fill="black" stroke="black" points="234.5,-437.46 231,-427.46 227.5,-437.46 234.5,-437.46"/>
</g>
<!-- gpu8_layer3_mha_out -->
<g id="node126" class="node">
<title>gpu8_layer3_mha_out</title>
<ellipse fill="orange" stroke="black" cx="231" cy="-274.48" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="231" y="-285.78" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="231" y="-270.78" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="231" y="-255.78" font-family="Times,serif" font-size="14.00">GPU 8</text>
</g>
<!-- gpu8_layer3_mha_attn&#45;&gt;gpu8_layer3_mha_out -->
<g id="edge36" class="edge">
<title>gpu8_layer3_mha_attn&#45;&gt;gpu8_layer3_mha_out</title>
<path fill="none" stroke="black" d="M231,-373.45C231,-358.75 231,-339.92 231,-322.7"/>
<polygon fill="black" stroke="black" points="234.5,-322.24 231,-312.24 227.5,-322.24 234.5,-322.24"/>
</g>
<!-- gpu8_layer3_mha_out&#45;&gt;gpu8_layer3_expert0 -->
<g id="edge193" class="edge">
<title>gpu8_layer3_mha_out&#45;&gt;gpu8_layer3_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M191.53,-246.44C178.88,-237.73 164.82,-227.99 152,-219 139.67,-210.35 126.35,-200.9 114.11,-192.17"/>
<polygon fill="blue" stroke="blue" points="116.01,-189.22 105.84,-186.25 111.94,-194.91 116.01,-189.22"/>
<text text-anchor="middle" x="173.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu8_layer3_mha_out&#45;&gt;gpu8_layer3_expert1 -->
<g id="edge201" class="edge">
<title>gpu8_layer3_mha_out&#45;&gt;gpu8_layer3_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M213.93,-238.44C210.89,-232.01 207.8,-225.32 205,-219 201.68,-211.52 198.26,-203.44 195.08,-195.74"/>
<polygon fill="blue" stroke="blue" points="198.23,-194.19 191.21,-186.26 191.75,-196.84 198.23,-194.19"/>
<text text-anchor="middle" x="226.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu8_layer3_mha_out&#45;&gt;gpu8_layer3_expert2 -->
<g id="edge209" class="edge">
<title>gpu8_layer3_mha_out&#45;&gt;gpu8_layer3_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M249.8,-238.66C257.25,-224.86 265.8,-209.02 273.25,-195.23"/>
<polygon fill="blue" stroke="blue" points="276.53,-196.52 278.2,-186.06 270.37,-193.19 276.53,-196.52"/>
<text text-anchor="middle" x="288.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu8_layer3_mha_out&#45;&gt;gpu8_layer3_expert3 -->
<g id="edge217" class="edge">
<title>gpu8_layer3_mha_out&#45;&gt;gpu8_layer3_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M271.53,-246.88C285.04,-238.02 300.17,-228.08 314,-219 327.44,-210.17 342.02,-200.59 355.41,-191.79"/>
<polygon fill="blue" stroke="blue" points="357.58,-194.55 364.01,-186.13 353.73,-188.7 357.58,-194.55"/>
<text text-anchor="middle" x="357.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu9_layer3_expert0 -->
<g id="node131" class="node">
<title>gpu9_layer3_expert0</title>
<polygon fill="lightgreen" stroke="black" points="1009.5,-186 916.5,-186 916.5,-133 1009.5,-133 1009.5,-186"/>
<text text-anchor="middle" x="963" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="963" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="963" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 1</text>
</g>
<!-- gpu9_layer3_expert0&#45;&gt;output -->
<g id="edge237" class="edge">
<title>gpu9_layer3_expert0&#45;&gt;output</title>
<path fill="none" stroke="black" d="M980.56,-132.89C991.95,-118.6 1008.16,-102.09 1027,-94 1129.95,-49.78 2707.73,-41.1 3289.06,-39.41"/>
<polygon fill="black" stroke="black" points="3289.25,-42.91 3299.24,-39.38 3289.22,-35.91 3289.25,-42.91"/>
<text text-anchor="middle" x="1078.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu9_layer3_expert1 -->
<g id="node132" class="node">
<title>gpu9_layer3_expert1</title>
<polygon fill="lightgreen" stroke="black" points="1120.5,-186 1027.5,-186 1027.5,-133 1120.5,-133 1120.5,-186"/>
<text text-anchor="middle" x="1074" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1074" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="1074" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 1</text>
</g>
<!-- gpu9_layer3_expert1&#45;&gt;output -->
<g id="edge238" class="edge">
<title>gpu9_layer3_expert1&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1100.22,-132.75C1116.96,-118.21 1139.96,-101.5 1164,-94 1264.4,-62.67 2734.26,-46.02 3290.68,-40.82"/>
<polygon fill="black" stroke="black" points="3290.86,-44.32 3300.83,-40.72 3290.8,-37.32 3290.86,-44.32"/>
<text text-anchor="middle" x="1215.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu9_layer3_expert2 -->
<g id="node133" class="node">
<title>gpu9_layer3_expert2</title>
<polygon fill="lightgreen" stroke="black" points="1231.5,-186 1138.5,-186 1138.5,-133 1231.5,-133 1231.5,-186"/>
<text text-anchor="middle" x="1185" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="1185" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="1185" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 1</text>
</g>
<!-- gpu9_layer3_expert2&#45;&gt;output -->
<g id="edge239" class="edge">
<title>gpu9_layer3_expert2&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1212.86,-132.83C1221.06,-126.63 1230.41,-120.72 1240,-117 1290.56,-97.37 1428.86,-97.3 1483,-94 2141.19,-53.93 2921.85,-43.05 3289.9,-40.1"/>
<polygon fill="black" stroke="black" points="3290.16,-43.6 3300.13,-40.02 3290.1,-36.6 3290.16,-43.6"/>
<text text-anchor="middle" x="1534.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu9_layer3_expert3 -->
<g id="node134" class="node">
<title>gpu9_layer3_expert3</title>
<polygon fill="lightgreen" stroke="black" points="1342.5,-186 1249.5,-186 1249.5,-133 1342.5,-133 1342.5,-186"/>
<text text-anchor="middle" x="1296" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1296" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="1296" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 1</text>
</g>
<!-- gpu9_layer3_expert3&#45;&gt;output -->
<g id="edge240" class="edge">
<title>gpu9_layer3_expert3&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1323.15,-132.87C1331.48,-126.51 1341.08,-120.51 1351,-117 1376.05,-108.14 1563.47,-110.44 1590,-109 1678.56,-104.18 1700.43,-98.76 1789,-94 2331.12,-64.88 2970.63,-49.33 3293.33,-42.8"/>
<polygon fill="black" stroke="black" points="3293.8,-46.29 3303.73,-42.59 3293.66,-39.29 3293.8,-46.29"/>
<text text-anchor="middle" x="1840.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu9_layer2_mha_qkv -->
<g id="node135" class="node">
<title>gpu9_layer2_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="1573" cy="-512.38" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="1573" y="-523.68" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="1573" y="-508.68" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="1573" y="-493.68" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- gpu9_layer2_mha_attn -->
<g id="node136" class="node">
<title>gpu9_layer2_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="1573" cy="-400.43" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="1573" y="-404.23" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="1573" y="-389.23" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- gpu9_layer2_mha_qkv&#45;&gt;gpu9_layer2_mha_attn -->
<g id="edge37" class="edge">
<title>gpu9_layer2_mha_qkv&#45;&gt;gpu9_layer2_mha_attn</title>
<path fill="none" stroke="black" d="M1573,-474.77C1573,-462.79 1573,-449.49 1573,-437.54"/>
<polygon fill="black" stroke="black" points="1576.5,-437.46 1573,-427.46 1569.5,-437.46 1576.5,-437.46"/>
</g>
<!-- gpu9_layer2_mha_out -->
<g id="node137" class="node">
<title>gpu9_layer2_mha_out</title>
<ellipse fill="orange" stroke="black" cx="1573" cy="-274.48" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="1573" y="-285.78" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="1573" y="-270.78" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="1573" y="-255.78" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- gpu9_layer2_mha_attn&#45;&gt;gpu9_layer2_mha_out -->
<g id="edge38" class="edge">
<title>gpu9_layer2_mha_attn&#45;&gt;gpu9_layer2_mha_out</title>
<path fill="none" stroke="black" d="M1573,-373.45C1573,-358.75 1573,-339.92 1573,-322.7"/>
<polygon fill="black" stroke="black" points="1576.5,-322.24 1573,-312.24 1569.5,-322.24 1576.5,-322.24"/>
</g>
<!-- gpu9_layer2_mha_out&#45;&gt;gpu9_layer2_expert0 -->
<g id="edge162" class="edge">
<title>gpu9_layer2_mha_out&#45;&gt;gpu9_layer2_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M1533.24,-246.42C1509.11,-229.99 1478.22,-208.97 1453.03,-191.83"/>
<polygon fill="blue" stroke="blue" points="1454.96,-188.91 1444.73,-186.18 1451.02,-194.7 1454.96,-188.91"/>
<text text-anchor="middle" x="1511.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu9_layer2_mha_out&#45;&gt;gpu9_layer2_expert1 -->
<g id="edge170" class="edge">
<title>gpu9_layer2_mha_out&#45;&gt;gpu9_layer2_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M1555.9,-238.35C1549.24,-224.67 1541.62,-209.02 1534.97,-195.36"/>
<polygon fill="blue" stroke="blue" points="1538.07,-193.73 1530.55,-186.27 1531.78,-196.8 1538.07,-193.73"/>
<text text-anchor="middle" x="1567.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu9_layer2_mha_out&#45;&gt;gpu9_layer2_expert2 -->
<g id="edge178" class="edge">
<title>gpu9_layer2_mha_out&#45;&gt;gpu9_layer2_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M1590.41,-238.35C1597.19,-224.67 1604.95,-209.02 1611.72,-195.36"/>
<polygon fill="blue" stroke="blue" points="1614.92,-196.79 1616.22,-186.27 1608.65,-193.68 1614.92,-196.79"/>
<text text-anchor="middle" x="1628.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu9_layer2_mha_out&#45;&gt;gpu9_layer2_expert3 -->
<g id="edge186" class="edge">
<title>gpu9_layer2_mha_out&#45;&gt;gpu9_layer2_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M1612.99,-246.64C1626.07,-237.85 1640.66,-228.02 1654,-219 1667.01,-210.2 1681.1,-200.63 1694.04,-191.83"/>
<polygon fill="blue" stroke="blue" points="1696.06,-194.69 1702.35,-186.17 1692.12,-188.9 1696.06,-194.69"/>
<text text-anchor="middle" x="1697.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu9_layer3_mha_qkv -->
<g id="node138" class="node">
<title>gpu9_layer3_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="1125" cy="-512.38" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="1125" y="-523.68" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="1125" y="-508.68" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="1125" y="-493.68" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- gpu9_layer3_mha_attn -->
<g id="node139" class="node">
<title>gpu9_layer3_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="1125" cy="-400.43" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="1125" y="-404.23" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="1125" y="-389.23" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- gpu9_layer3_mha_qkv&#45;&gt;gpu9_layer3_mha_attn -->
<g id="edge39" class="edge">
<title>gpu9_layer3_mha_qkv&#45;&gt;gpu9_layer3_mha_attn</title>
<path fill="none" stroke="black" d="M1125,-474.77C1125,-462.79 1125,-449.49 1125,-437.54"/>
<polygon fill="black" stroke="black" points="1128.5,-437.46 1125,-427.46 1121.5,-437.46 1128.5,-437.46"/>
</g>
<!-- gpu9_layer3_mha_out -->
<g id="node140" class="node">
<title>gpu9_layer3_mha_out</title>
<ellipse fill="orange" stroke="black" cx="1125" cy="-274.48" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="1125" y="-285.78" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="1125" y="-270.78" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="1125" y="-255.78" font-family="Times,serif" font-size="14.00">GPU 9</text>
</g>
<!-- gpu9_layer3_mha_attn&#45;&gt;gpu9_layer3_mha_out -->
<g id="edge40" class="edge">
<title>gpu9_layer3_mha_attn&#45;&gt;gpu9_layer3_mha_out</title>
<path fill="none" stroke="black" d="M1125,-373.45C1125,-358.75 1125,-339.92 1125,-322.7"/>
<polygon fill="black" stroke="black" points="1128.5,-322.24 1125,-312.24 1121.5,-322.24 1128.5,-322.24"/>
</g>
<!-- gpu9_layer3_mha_out&#45;&gt;gpu9_layer3_expert0 -->
<g id="edge194" class="edge">
<title>gpu9_layer3_mha_out&#45;&gt;gpu9_layer3_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M1085.41,-246.77C1072.49,-237.98 1058.1,-228.13 1045,-219 1032.53,-210.31 1019.07,-200.77 1006.73,-191.97"/>
<polygon fill="blue" stroke="blue" points="1008.57,-188.98 998.4,-186.01 1004.5,-194.67 1008.57,-188.98"/>
<text text-anchor="middle" x="1066.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu9_layer3_mha_out&#45;&gt;gpu9_layer3_expert1 -->
<g id="edge202" class="edge">
<title>gpu9_layer3_mha_out&#45;&gt;gpu9_layer3_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M1107.2,-238.49C1104.06,-232.04 1100.87,-225.35 1098,-219 1094.56,-211.39 1091.04,-203.14 1087.8,-195.3"/>
<polygon fill="blue" stroke="blue" points="1091.03,-193.94 1084.01,-186.01 1084.55,-196.59 1091.03,-193.94"/>
<text text-anchor="middle" x="1119.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu9_layer3_mha_out&#45;&gt;gpu9_layer3_expert2 -->
<g id="edge210" class="edge">
<title>gpu9_layer3_mha_out&#45;&gt;gpu9_layer3_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M1143.49,-238.66C1150.82,-224.86 1159.23,-209.02 1166.56,-195.23"/>
<polygon fill="blue" stroke="blue" points="1169.83,-196.53 1171.43,-186.06 1163.65,-193.25 1169.83,-196.53"/>
<text text-anchor="middle" x="1182.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu9_layer3_mha_out&#45;&gt;gpu9_layer3_expert3 -->
<g id="edge218" class="edge">
<title>gpu9_layer3_mha_out&#45;&gt;gpu9_layer3_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M1165.56,-246.92C1179.07,-238.06 1194.19,-228.12 1208,-219 1221.31,-210.21 1235.73,-200.64 1248.97,-191.84"/>
<polygon fill="blue" stroke="blue" points="1251.09,-194.63 1257.48,-186.18 1247.22,-188.8 1251.09,-194.63"/>
<text text-anchor="middle" x="1251.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu10_layer3_expert0 -->
<g id="node145" class="node">
<title>gpu10_layer3_expert0</title>
<polygon fill="lightyellow" stroke="black" points="1902.5,-186 1809.5,-186 1809.5,-133 1902.5,-133 1902.5,-186"/>
<text text-anchor="middle" x="1856" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="1856" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="1856" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 2</text>
</g>
<!-- gpu10_layer3_expert0&#45;&gt;output -->
<g id="edge241" class="edge">
<title>gpu10_layer3_expert0&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1872.51,-133C1883.29,-118.75 1898.74,-102.24 1917,-94 1978.53,-66.23 2876.35,-48.72 3292.74,-42.06"/>
<polygon fill="black" stroke="black" points="3292.85,-45.56 3302.79,-41.9 3292.74,-38.56 3292.85,-45.56"/>
<text text-anchor="middle" x="1968.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu10_layer3_expert1 -->
<g id="node146" class="node">
<title>gpu10_layer3_expert1</title>
<polygon fill="lightyellow" stroke="black" points="2013.5,-186 1920.5,-186 1920.5,-133 2013.5,-133 2013.5,-186"/>
<text text-anchor="middle" x="1967" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1967" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="1967" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 2</text>
</g>
<!-- gpu10_layer3_expert1&#45;&gt;output -->
<g id="edge242" class="edge">
<title>gpu10_layer3_expert1&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1992.03,-132.9C2007.76,-118.62 2029.33,-102.11 2052,-94 2165.16,-53.52 2915.28,-42.83 3289.9,-40.01"/>
<polygon fill="black" stroke="black" points="3290.07,-43.51 3300.05,-39.93 3290.02,-36.51 3290.07,-43.51"/>
<text text-anchor="middle" x="2103.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu10_layer3_expert2 -->
<g id="node147" class="node">
<title>gpu10_layer3_expert2</title>
<polygon fill="lightyellow" stroke="black" points="2124.5,-186 2031.5,-186 2031.5,-133 2124.5,-133 2124.5,-186"/>
<text text-anchor="middle" x="2078" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2078" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="2078" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 2</text>
</g>
<!-- gpu10_layer3_expert2&#45;&gt;output -->
<g id="edge243" class="edge">
<title>gpu10_layer3_expert2&#45;&gt;output</title>
<path fill="none" stroke="black" d="M2105.89,-132.89C2114.08,-126.69 2123.43,-120.77 2133,-117 2224.05,-81.11 2254.42,-101.45 2352,-94 2682.17,-68.79 3066.6,-53.17 3296.8,-45.29"/>
<polygon fill="black" stroke="black" points="3297.09,-48.79 3306.96,-44.95 3296.85,-41.79 3297.09,-48.79"/>
<text text-anchor="middle" x="2403.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu10_layer3_expert3 -->
<g id="node148" class="node">
<title>gpu10_layer3_expert3</title>
<polygon fill="lightyellow" stroke="black" points="2235.5,-186 2142.5,-186 2142.5,-133 2235.5,-133 2235.5,-186"/>
<text text-anchor="middle" x="2189" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2189" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="2189" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 2</text>
</g>
<!-- gpu10_layer3_expert3&#45;&gt;output -->
<g id="edge244" class="edge">
<title>gpu10_layer3_expert3&#45;&gt;output</title>
<path fill="none" stroke="black" d="M2216.16,-132.9C2224.48,-126.53 2234.08,-120.53 2244,-117 2266.52,-108.99 2435.13,-110.24 2459,-109 2540.93,-104.73 3027.51,-71.56 3306.21,-52.46"/>
<polygon fill="black" stroke="black" points="3306.71,-55.93 3316.45,-51.76 3306.23,-48.95 3306.71,-55.93"/>
<text text-anchor="middle" x="2735.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu10_layer2_mha_qkv -->
<g id="node149" class="node">
<title>gpu10_layer2_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="2466" cy="-512.38" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="2466" y="-523.68" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="2466" y="-508.68" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="2466" y="-493.68" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- gpu10_layer2_mha_attn -->
<g id="node150" class="node">
<title>gpu10_layer2_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="2466" cy="-400.43" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="2466" y="-404.23" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="2466" y="-389.23" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- gpu10_layer2_mha_qkv&#45;&gt;gpu10_layer2_mha_attn -->
<g id="edge41" class="edge">
<title>gpu10_layer2_mha_qkv&#45;&gt;gpu10_layer2_mha_attn</title>
<path fill="none" stroke="black" d="M2466,-474.77C2466,-462.79 2466,-449.49 2466,-437.54"/>
<polygon fill="black" stroke="black" points="2469.5,-437.46 2466,-427.46 2462.5,-437.46 2469.5,-437.46"/>
</g>
<!-- gpu10_layer2_mha_out -->
<g id="node151" class="node">
<title>gpu10_layer2_mha_out</title>
<ellipse fill="orange" stroke="black" cx="2466" cy="-274.48" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="2466" y="-285.78" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="2466" y="-270.78" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="2466" y="-255.78" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- gpu10_layer2_mha_attn&#45;&gt;gpu10_layer2_mha_out -->
<g id="edge42" class="edge">
<title>gpu10_layer2_mha_attn&#45;&gt;gpu10_layer2_mha_out</title>
<path fill="none" stroke="black" d="M2466,-373.45C2466,-358.75 2466,-339.92 2466,-322.7"/>
<polygon fill="black" stroke="black" points="2469.5,-322.24 2466,-312.24 2462.5,-322.24 2469.5,-322.24"/>
</g>
<!-- gpu10_layer2_mha_out&#45;&gt;gpu10_layer2_expert0 -->
<g id="edge163" class="edge">
<title>gpu10_layer2_mha_out&#45;&gt;gpu10_layer2_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M2426.24,-246.42C2402.11,-229.99 2371.22,-208.97 2346.03,-191.83"/>
<polygon fill="blue" stroke="blue" points="2347.96,-188.91 2337.73,-186.18 2344.02,-194.7 2347.96,-188.91"/>
<text text-anchor="middle" x="2404.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu10_layer2_mha_out&#45;&gt;gpu10_layer2_expert1 -->
<g id="edge171" class="edge">
<title>gpu10_layer2_mha_out&#45;&gt;gpu10_layer2_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M2448.9,-238.35C2442.24,-224.67 2434.62,-209.02 2427.97,-195.36"/>
<polygon fill="blue" stroke="blue" points="2431.07,-193.73 2423.55,-186.27 2424.78,-196.8 2431.07,-193.73"/>
<text text-anchor="middle" x="2460.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu10_layer2_mha_out&#45;&gt;gpu10_layer2_expert2 -->
<g id="edge179" class="edge">
<title>gpu10_layer2_mha_out&#45;&gt;gpu10_layer2_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M2483.41,-238.35C2490.19,-224.67 2497.95,-209.02 2504.72,-195.36"/>
<polygon fill="blue" stroke="blue" points="2507.92,-196.79 2509.22,-186.27 2501.65,-193.68 2507.92,-196.79"/>
<text text-anchor="middle" x="2521.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu10_layer2_mha_out&#45;&gt;gpu10_layer2_expert3 -->
<g id="edge187" class="edge">
<title>gpu10_layer2_mha_out&#45;&gt;gpu10_layer2_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M2505.99,-246.64C2519.07,-237.85 2533.66,-228.02 2547,-219 2560.01,-210.2 2574.1,-200.63 2587.04,-191.83"/>
<polygon fill="blue" stroke="blue" points="2589.06,-194.69 2595.35,-186.17 2585.12,-188.9 2589.06,-194.69"/>
<text text-anchor="middle" x="2590.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu10_layer3_mha_qkv -->
<g id="node152" class="node">
<title>gpu10_layer3_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="2012" cy="-512.38" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="2012" y="-523.68" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="2012" y="-508.68" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="2012" y="-493.68" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- gpu10_layer3_mha_attn -->
<g id="node153" class="node">
<title>gpu10_layer3_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="2012" cy="-400.43" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="2012" y="-404.23" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="2012" y="-389.23" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- gpu10_layer3_mha_qkv&#45;&gt;gpu10_layer3_mha_attn -->
<g id="edge43" class="edge">
<title>gpu10_layer3_mha_qkv&#45;&gt;gpu10_layer3_mha_attn</title>
<path fill="none" stroke="black" d="M2012,-474.77C2012,-462.79 2012,-449.49 2012,-437.54"/>
<polygon fill="black" stroke="black" points="2015.5,-437.46 2012,-427.46 2008.5,-437.46 2015.5,-437.46"/>
</g>
<!-- gpu10_layer3_mha_out -->
<g id="node154" class="node">
<title>gpu10_layer3_mha_out</title>
<ellipse fill="orange" stroke="black" cx="2012" cy="-274.48" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="2012" y="-285.78" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="2012" y="-270.78" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="2012" y="-255.78" font-family="Times,serif" font-size="14.00">GPU 10</text>
</g>
<!-- gpu10_layer3_mha_attn&#45;&gt;gpu10_layer3_mha_out -->
<g id="edge44" class="edge">
<title>gpu10_layer3_mha_attn&#45;&gt;gpu10_layer3_mha_out</title>
<path fill="none" stroke="black" d="M2012,-373.45C2012,-358.75 2012,-339.92 2012,-322.7"/>
<polygon fill="black" stroke="black" points="2015.5,-322.24 2012,-312.24 2008.5,-322.24 2015.5,-322.24"/>
</g>
<!-- gpu10_layer3_mha_out&#45;&gt;gpu10_layer3_expert0 -->
<g id="edge195" class="edge">
<title>gpu10_layer3_mha_out&#45;&gt;gpu10_layer3_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M1973.84,-245.84C1951.42,-229.61 1923.01,-209.03 1899.7,-192.15"/>
<polygon fill="blue" stroke="blue" points="1901.52,-189.14 1891.36,-186.11 1897.41,-194.81 1901.52,-189.14"/>
<text text-anchor="middle" x="1955.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu10_layer3_mha_out&#45;&gt;gpu10_layer3_expert1 -->
<g id="edge203" class="edge">
<title>gpu10_layer3_mha_out&#45;&gt;gpu10_layer3_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M1997.89,-238.04C1992.49,-224.5 1986.35,-209.08 1980.97,-195.57"/>
<polygon fill="blue" stroke="blue" points="1984.16,-194.13 1977.21,-186.13 1977.66,-196.72 1984.16,-194.13"/>
<text text-anchor="middle" x="2011.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu10_layer3_mha_out&#45;&gt;gpu10_layer3_expert2 -->
<g id="edge211" class="edge">
<title>gpu10_layer3_mha_out&#45;&gt;gpu10_layer3_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M2032.16,-238.97C2040.31,-225.02 2049.69,-208.96 2057.84,-195.01"/>
<polygon fill="blue" stroke="blue" points="2060.97,-196.59 2062.99,-186.19 2054.92,-193.06 2060.97,-196.59"/>
<text text-anchor="middle" x="2072.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu10_layer3_mha_out&#45;&gt;gpu10_layer3_expert3 -->
<g id="edge219" class="edge">
<title>gpu10_layer3_mha_out&#45;&gt;gpu10_layer3_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M2053.16,-247.49C2067.37,-238.48 2083.4,-228.32 2098,-219 2111.77,-210.21 2126.68,-200.65 2140.37,-191.85"/>
<polygon fill="blue" stroke="blue" points="2142.65,-194.54 2149.17,-186.19 2138.87,-188.65 2142.65,-194.54"/>
<text text-anchor="middle" x="2142.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu11_layer3_expert0 -->
<g id="node159" class="node">
<title>gpu11_layer3_expert0</title>
<polygon fill="lightpink" stroke="black" points="2795.5,-186 2702.5,-186 2702.5,-133 2795.5,-133 2795.5,-186"/>
<text text-anchor="middle" x="2749" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="2749" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="2749" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 3</text>
</g>
<!-- gpu11_layer3_expert0&#45;&gt;output -->
<g id="edge245" class="edge">
<title>gpu11_layer3_expert0&#45;&gt;output</title>
<path fill="none" stroke="black" d="M2773.11,-132.93C2788.04,-118.85 2808.44,-102.54 2830,-94 2911.55,-61.7 3127.91,-48.37 3293.3,-42.87"/>
<polygon fill="black" stroke="black" points="3293.74,-46.36 3303.62,-42.53 3293.51,-39.36 3293.74,-46.36"/>
<text text-anchor="middle" x="2881.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu11_layer3_expert1 -->
<g id="node160" class="node">
<title>gpu11_layer3_expert1</title>
<polygon fill="lightpink" stroke="black" points="2906.5,-186 2813.5,-186 2813.5,-133 2906.5,-133 2906.5,-186"/>
<text text-anchor="middle" x="2860" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="2860" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="2860" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 3</text>
</g>
<!-- gpu11_layer3_expert1&#45;&gt;output -->
<g id="edge246" class="edge">
<title>gpu11_layer3_expert1&#45;&gt;output</title>
<path fill="none" stroke="black" d="M2888.64,-132.88C2896.69,-126.84 2905.78,-120.99 2915,-117 2970.04,-93.15 2988.65,-102.72 3048,-94 3135.75,-81.11 3233.37,-68.99 3315.53,-59.43"/>
<polygon fill="black" stroke="black" points="3315.94,-62.91 3325.47,-58.28 3315.13,-55.96 3315.94,-62.91"/>
<text text-anchor="middle" x="3099.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu11_layer3_expert2 -->
<g id="node161" class="node">
<title>gpu11_layer3_expert2</title>
<polygon fill="lightpink" stroke="black" points="3017.5,-186 2924.5,-186 2924.5,-133 3017.5,-133 3017.5,-186"/>
<text text-anchor="middle" x="2971" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2971" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="2971" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 3</text>
</g>
<!-- gpu11_layer3_expert2&#45;&gt;output -->
<g id="edge247" class="edge">
<title>gpu11_layer3_expert2&#45;&gt;output</title>
<path fill="none" stroke="black" d="M2998.5,-132.84C3006.76,-126.56 3016.24,-120.61 3026,-117 3052.94,-107.04 3126.52,-112.74 3155,-109 3215.19,-101.1 3280.6,-88.87 3338.24,-76.84"/>
<polygon fill="black" stroke="black" points="3339.09,-80.23 3348.16,-74.75 3337.65,-73.38 3339.09,-80.23"/>
<text text-anchor="middle" x="3293.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu11_layer3_expert3 -->
<g id="node162" class="node">
<title>gpu11_layer3_expert3</title>
<polygon fill="lightpink" stroke="black" points="3128.5,-186 3035.5,-186 3035.5,-133 3128.5,-133 3128.5,-186"/>
<text text-anchor="middle" x="3082" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="3082" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="3082" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 3</text>
</g>
<!-- gpu11_layer3_expert3&#45;&gt;output -->
<g id="edge248" class="edge">
<title>gpu11_layer3_expert3&#45;&gt;output</title>
<path fill="none" stroke="black" d="M3109.15,-132.88C3117.48,-126.52 3127.08,-120.52 3137,-117 3185.2,-99.92 3317.53,-121.98 3367,-109 3390.35,-102.87 3414.24,-92.19 3435.31,-80.99"/>
<polygon fill="black" stroke="black" points="3437.05,-84.03 3444.16,-76.17 3433.7,-77.89 3437.05,-84.03"/>
<text text-anchor="middle" x="3458.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu11_layer2_mha_qkv -->
<g id="node163" class="node">
<title>gpu11_layer2_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="3359" cy="-512.38" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="3359" y="-523.68" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="3359" y="-508.68" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="3359" y="-493.68" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- gpu11_layer2_mha_attn -->
<g id="node164" class="node">
<title>gpu11_layer2_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="3359" cy="-400.43" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="3359" y="-404.23" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="3359" y="-389.23" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- gpu11_layer2_mha_qkv&#45;&gt;gpu11_layer2_mha_attn -->
<g id="edge45" class="edge">
<title>gpu11_layer2_mha_qkv&#45;&gt;gpu11_layer2_mha_attn</title>
<path fill="none" stroke="black" d="M3359,-474.77C3359,-462.79 3359,-449.49 3359,-437.54"/>
<polygon fill="black" stroke="black" points="3362.5,-437.46 3359,-427.46 3355.5,-437.46 3362.5,-437.46"/>
</g>
<!-- gpu11_layer2_mha_out -->
<g id="node165" class="node">
<title>gpu11_layer2_mha_out</title>
<ellipse fill="orange" stroke="black" cx="3359" cy="-274.48" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="3359" y="-285.78" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="3359" y="-270.78" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="3359" y="-255.78" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- gpu11_layer2_mha_attn&#45;&gt;gpu11_layer2_mha_out -->
<g id="edge46" class="edge">
<title>gpu11_layer2_mha_attn&#45;&gt;gpu11_layer2_mha_out</title>
<path fill="none" stroke="black" d="M3359,-373.45C3359,-358.75 3359,-339.92 3359,-322.7"/>
<polygon fill="black" stroke="black" points="3362.5,-322.24 3359,-312.24 3355.5,-322.24 3362.5,-322.24"/>
</g>
<!-- gpu11_layer2_mha_out&#45;&gt;gpu11_layer2_expert0 -->
<g id="edge164" class="edge">
<title>gpu11_layer2_mha_out&#45;&gt;gpu11_layer2_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3319.24,-246.42C3295.11,-229.99 3264.22,-208.97 3239.03,-191.83"/>
<polygon fill="blue" stroke="blue" points="3240.96,-188.91 3230.73,-186.18 3237.02,-194.7 3240.96,-188.91"/>
<text text-anchor="middle" x="3297.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu11_layer2_mha_out&#45;&gt;gpu11_layer2_expert1 -->
<g id="edge172" class="edge">
<title>gpu11_layer2_mha_out&#45;&gt;gpu11_layer2_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3341.9,-238.35C3335.24,-224.67 3327.62,-209.02 3320.97,-195.36"/>
<polygon fill="blue" stroke="blue" points="3324.07,-193.73 3316.55,-186.27 3317.78,-196.8 3324.07,-193.73"/>
<text text-anchor="middle" x="3353.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu11_layer2_mha_out&#45;&gt;gpu11_layer2_expert2 -->
<g id="edge180" class="edge">
<title>gpu11_layer2_mha_out&#45;&gt;gpu11_layer2_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3376.41,-238.35C3383.19,-224.67 3390.95,-209.02 3397.72,-195.36"/>
<polygon fill="blue" stroke="blue" points="3400.92,-196.79 3402.22,-186.27 3394.65,-193.68 3400.92,-196.79"/>
<text text-anchor="middle" x="3414.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu11_layer2_mha_out&#45;&gt;gpu11_layer2_expert3 -->
<g id="edge188" class="edge">
<title>gpu11_layer2_mha_out&#45;&gt;gpu11_layer2_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3398.99,-246.64C3412.07,-237.85 3426.66,-228.02 3440,-219 3453.01,-210.2 3467.1,-200.63 3480.04,-191.83"/>
<polygon fill="blue" stroke="blue" points="3482.06,-194.69 3488.35,-186.17 3478.12,-188.9 3482.06,-194.69"/>
<text text-anchor="middle" x="3483.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu11_layer3_mha_qkv -->
<g id="node166" class="node">
<title>gpu11_layer3_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="2905" cy="-512.38" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="2905" y="-523.68" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="2905" y="-508.68" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="2905" y="-493.68" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- gpu11_layer3_mha_attn -->
<g id="node167" class="node">
<title>gpu11_layer3_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="2905" cy="-400.43" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="2905" y="-404.23" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="2905" y="-389.23" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- gpu11_layer3_mha_qkv&#45;&gt;gpu11_layer3_mha_attn -->
<g id="edge47" class="edge">
<title>gpu11_layer3_mha_qkv&#45;&gt;gpu11_layer3_mha_attn</title>
<path fill="none" stroke="black" d="M2905,-474.77C2905,-462.79 2905,-449.49 2905,-437.54"/>
<polygon fill="black" stroke="black" points="2908.5,-437.46 2905,-427.46 2901.5,-437.46 2908.5,-437.46"/>
</g>
<!-- gpu11_layer3_mha_out -->
<g id="node168" class="node">
<title>gpu11_layer3_mha_out</title>
<ellipse fill="orange" stroke="black" cx="2905" cy="-274.48" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="2905" y="-285.78" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="2905" y="-270.78" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="2905" y="-255.78" font-family="Times,serif" font-size="14.00">GPU 11</text>
</g>
<!-- gpu11_layer3_mha_attn&#45;&gt;gpu11_layer3_mha_out -->
<g id="edge48" class="edge">
<title>gpu11_layer3_mha_attn&#45;&gt;gpu11_layer3_mha_out</title>
<path fill="none" stroke="black" d="M2905,-373.45C2905,-358.75 2905,-339.92 2905,-322.7"/>
<polygon fill="black" stroke="black" points="2908.5,-322.24 2905,-312.24 2901.5,-322.24 2908.5,-322.24"/>
</g>
<!-- gpu11_layer3_mha_out&#45;&gt;gpu11_layer3_expert0 -->
<g id="edge196" class="edge">
<title>gpu11_layer3_mha_out&#45;&gt;gpu11_layer3_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M2866.84,-245.84C2844.42,-229.61 2816.01,-209.03 2792.7,-192.15"/>
<polygon fill="blue" stroke="blue" points="2794.52,-189.14 2784.36,-186.11 2790.41,-194.81 2794.52,-189.14"/>
<text text-anchor="middle" x="2848.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu11_layer3_mha_out&#45;&gt;gpu11_layer3_expert1 -->
<g id="edge204" class="edge">
<title>gpu11_layer3_mha_out&#45;&gt;gpu11_layer3_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M2890.89,-238.04C2885.49,-224.5 2879.35,-209.08 2873.97,-195.57"/>
<polygon fill="blue" stroke="blue" points="2877.16,-194.13 2870.21,-186.13 2870.66,-196.72 2877.16,-194.13"/>
<text text-anchor="middle" x="2904.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu11_layer3_mha_out&#45;&gt;gpu11_layer3_expert2 -->
<g id="edge212" class="edge">
<title>gpu11_layer3_mha_out&#45;&gt;gpu11_layer3_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M2925.16,-238.97C2933.31,-225.02 2942.69,-208.96 2950.84,-195.01"/>
<polygon fill="blue" stroke="blue" points="2953.97,-196.59 2955.99,-186.19 2947.92,-193.06 2953.97,-196.59"/>
<text text-anchor="middle" x="2965.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu11_layer3_mha_out&#45;&gt;gpu11_layer3_expert3 -->
<g id="edge220" class="edge">
<title>gpu11_layer3_mha_out&#45;&gt;gpu11_layer3_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M2946.16,-247.49C2960.37,-238.48 2976.4,-228.32 2991,-219 3004.77,-210.21 3019.68,-200.65 3033.37,-191.85"/>
<polygon fill="blue" stroke="blue" points="3035.65,-194.54 3042.17,-186.19 3031.87,-188.65 3035.65,-194.54"/>
<text text-anchor="middle" x="3035.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu12_layer3_expert0 -->
<g id="node173" class="node">
<title>gpu12_layer3_expert0</title>
<polygon fill="lightblue" stroke="black" points="3688.5,-186 3595.5,-186 3595.5,-133 3688.5,-133 3688.5,-186"/>
<text text-anchor="middle" x="3642" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="3642" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="3642" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 4</text>
</g>
<!-- gpu12_layer3_expert0&#45;&gt;output -->
<g id="edge249" class="edge">
<title>gpu12_layer3_expert0&#45;&gt;output</title>
<path fill="none" stroke="black" d="M3611.97,-132.86C3594.87,-118.27 3573,-99.6 3553.26,-82.76"/>
<polygon fill="black" stroke="black" points="3555.41,-79.99 3545.54,-76.16 3550.87,-85.32 3555.41,-79.99"/>
<text text-anchor="middle" x="3632.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu12_layer3_expert1 -->
<g id="node174" class="node">
<title>gpu12_layer3_expert1</title>
<polygon fill="lightblue" stroke="black" points="3799.5,-186 3706.5,-186 3706.5,-133 3799.5,-133 3799.5,-186"/>
<text text-anchor="middle" x="3753" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="3753" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="3753" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 4</text>
</g>
<!-- gpu12_layer3_expert1&#45;&gt;output -->
<g id="edge250" class="edge">
<title>gpu12_layer3_expert1&#45;&gt;output</title>
<path fill="none" stroke="black" d="M3732.51,-132.75C3720.74,-119.49 3704.96,-104.04 3688,-94 3679.52,-88.98 3670.56,-84.39 3661.32,-80.2"/>
<polygon fill="black" stroke="black" points="3662.57,-76.93 3652,-76.14 3659.77,-83.34 3662.57,-76.93"/>
<text text-anchor="middle" x="3760.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu12_layer3_expert2 -->
<g id="node175" class="node">
<title>gpu12_layer3_expert2</title>
<polygon fill="lightblue" stroke="black" points="3910.5,-186 3817.5,-186 3817.5,-133 3910.5,-133 3910.5,-186"/>
<text text-anchor="middle" x="3864" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="3864" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="3864" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 4</text>
</g>
<!-- gpu12_layer3_expert2&#45;&gt;output -->
<g id="edge251" class="edge">
<title>gpu12_layer3_expert2&#45;&gt;output</title>
<path fill="none" stroke="black" d="M3851.22,-132.96C3843.02,-119.25 3831.09,-103.3 3816,-94 3804.71,-87.05 3786.65,-80.77 3764.75,-75.16"/>
<polygon fill="black" stroke="black" points="3765.33,-71.7 3754.78,-72.71 3763.66,-78.49 3765.33,-71.7"/>
<text text-anchor="middle" x="3884.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu12_layer3_expert3 -->
<g id="node176" class="node">
<title>gpu12_layer3_expert3</title>
<polygon fill="lightblue" stroke="black" points="4021.5,-186 3928.5,-186 3928.5,-133 4021.5,-133 4021.5,-186"/>
<text text-anchor="middle" x="3975" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="3975" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="3975" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 4</text>
</g>
<!-- gpu12_layer3_expert3&#45;&gt;output -->
<g id="edge252" class="edge">
<title>gpu12_layer3_expert3&#45;&gt;output</title>
<path fill="none" stroke="black" d="M3967.47,-132.82C3962.08,-119.07 3953.36,-103.13 3940,-94 3904.89,-70.01 3817.91,-56.49 3730.63,-48.86"/>
<polygon fill="black" stroke="black" points="3730.8,-45.36 3720.54,-48.01 3730.21,-52.34 3730.8,-45.36"/>
<text text-anchor="middle" x="4005.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu12_layer2_mha_qkv -->
<g id="node177" class="node">
<title>gpu12_layer2_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="4252" cy="-512.38" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="4252" y="-523.68" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="4252" y="-508.68" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="4252" y="-493.68" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- gpu12_layer2_mha_attn -->
<g id="node178" class="node">
<title>gpu12_layer2_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="4252" cy="-400.43" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="4252" y="-404.23" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="4252" y="-389.23" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- gpu12_layer2_mha_qkv&#45;&gt;gpu12_layer2_mha_attn -->
<g id="edge49" class="edge">
<title>gpu12_layer2_mha_qkv&#45;&gt;gpu12_layer2_mha_attn</title>
<path fill="none" stroke="black" d="M4252,-474.77C4252,-462.79 4252,-449.49 4252,-437.54"/>
<polygon fill="black" stroke="black" points="4255.5,-437.46 4252,-427.46 4248.5,-437.46 4255.5,-437.46"/>
</g>
<!-- gpu12_layer2_mha_out -->
<g id="node179" class="node">
<title>gpu12_layer2_mha_out</title>
<ellipse fill="orange" stroke="black" cx="4252" cy="-274.48" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="4252" y="-285.78" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="4252" y="-270.78" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="4252" y="-255.78" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- gpu12_layer2_mha_attn&#45;&gt;gpu12_layer2_mha_out -->
<g id="edge50" class="edge">
<title>gpu12_layer2_mha_attn&#45;&gt;gpu12_layer2_mha_out</title>
<path fill="none" stroke="black" d="M4252,-373.45C4252,-358.75 4252,-339.92 4252,-322.7"/>
<polygon fill="black" stroke="black" points="4255.5,-322.24 4252,-312.24 4248.5,-322.24 4255.5,-322.24"/>
</g>
<!-- gpu12_layer2_mha_out&#45;&gt;gpu12_layer2_expert0 -->
<g id="edge165" class="edge">
<title>gpu12_layer2_mha_out&#45;&gt;gpu12_layer2_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4212.24,-246.42C4188.11,-229.99 4157.22,-208.97 4132.03,-191.83"/>
<polygon fill="blue" stroke="blue" points="4133.96,-188.91 4123.73,-186.18 4130.02,-194.7 4133.96,-188.91"/>
<text text-anchor="middle" x="4190.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu12_layer2_mha_out&#45;&gt;gpu12_layer2_expert1 -->
<g id="edge173" class="edge">
<title>gpu12_layer2_mha_out&#45;&gt;gpu12_layer2_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4234.9,-238.35C4228.24,-224.67 4220.62,-209.02 4213.97,-195.36"/>
<polygon fill="blue" stroke="blue" points="4217.07,-193.73 4209.55,-186.27 4210.78,-196.8 4217.07,-193.73"/>
<text text-anchor="middle" x="4246.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu12_layer2_mha_out&#45;&gt;gpu12_layer2_expert2 -->
<g id="edge181" class="edge">
<title>gpu12_layer2_mha_out&#45;&gt;gpu12_layer2_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4269.41,-238.35C4276.19,-224.67 4283.95,-209.02 4290.72,-195.36"/>
<polygon fill="blue" stroke="blue" points="4293.92,-196.79 4295.22,-186.27 4287.65,-193.68 4293.92,-196.79"/>
<text text-anchor="middle" x="4307.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu12_layer2_mha_out&#45;&gt;gpu12_layer2_expert3 -->
<g id="edge189" class="edge">
<title>gpu12_layer2_mha_out&#45;&gt;gpu12_layer2_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4291.99,-246.64C4305.07,-237.85 4319.66,-228.02 4333,-219 4346.01,-210.2 4360.1,-200.63 4373.04,-191.83"/>
<polygon fill="blue" stroke="blue" points="4375.06,-194.69 4381.35,-186.17 4371.12,-188.9 4375.06,-194.69"/>
<text text-anchor="middle" x="4376.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu12_layer3_mha_qkv -->
<g id="node180" class="node">
<title>gpu12_layer3_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="3809" cy="-512.38" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="3809" y="-523.68" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="3809" y="-508.68" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="3809" y="-493.68" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- gpu12_layer3_mha_attn -->
<g id="node181" class="node">
<title>gpu12_layer3_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="3809" cy="-400.43" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="3809" y="-404.23" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="3809" y="-389.23" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- gpu12_layer3_mha_qkv&#45;&gt;gpu12_layer3_mha_attn -->
<g id="edge51" class="edge">
<title>gpu12_layer3_mha_qkv&#45;&gt;gpu12_layer3_mha_attn</title>
<path fill="none" stroke="black" d="M3809,-474.77C3809,-462.79 3809,-449.49 3809,-437.54"/>
<polygon fill="black" stroke="black" points="3812.5,-437.46 3809,-427.46 3805.5,-437.46 3812.5,-437.46"/>
</g>
<!-- gpu12_layer3_mha_out -->
<g id="node182" class="node">
<title>gpu12_layer3_mha_out</title>
<ellipse fill="orange" stroke="black" cx="3809" cy="-274.48" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="3809" y="-285.78" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="3809" y="-270.78" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="3809" y="-255.78" font-family="Times,serif" font-size="14.00">GPU 12</text>
</g>
<!-- gpu12_layer3_mha_attn&#45;&gt;gpu12_layer3_mha_out -->
<g id="edge52" class="edge">
<title>gpu12_layer3_mha_attn&#45;&gt;gpu12_layer3_mha_out</title>
<path fill="none" stroke="black" d="M3809,-373.45C3809,-358.75 3809,-339.92 3809,-322.7"/>
<polygon fill="black" stroke="black" points="3812.5,-322.24 3809,-312.24 3805.5,-322.24 3812.5,-322.24"/>
</g>
<!-- gpu12_layer3_mha_out&#45;&gt;gpu12_layer3_expert0 -->
<g id="edge197" class="edge">
<title>gpu12_layer3_mha_out&#45;&gt;gpu12_layer3_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3769.42,-246.7C3745.07,-230.23 3713.75,-209.04 3688.26,-191.8"/>
<polygon fill="blue" stroke="blue" points="3690.1,-188.82 3679.86,-186.11 3686.18,-194.61 3690.1,-188.82"/>
<text text-anchor="middle" x="3747.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu12_layer3_mha_out&#45;&gt;gpu12_layer3_expert1 -->
<g id="edge205" class="edge">
<title>gpu12_layer3_mha_out&#45;&gt;gpu12_layer3_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3791.59,-238.35C3784.81,-224.67 3777.05,-209.02 3770.28,-195.36"/>
<polygon fill="blue" stroke="blue" points="3773.35,-193.68 3765.78,-186.27 3767.08,-196.79 3773.35,-193.68"/>
<text text-anchor="middle" x="3802.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu12_layer3_mha_out&#45;&gt;gpu12_layer3_expert2 -->
<g id="edge213" class="edge">
<title>gpu12_layer3_mha_out&#45;&gt;gpu12_layer3_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3826.1,-238.35C3832.76,-224.67 3840.38,-209.02 3847.03,-195.36"/>
<polygon fill="blue" stroke="blue" points="3850.22,-196.8 3851.45,-186.27 3843.93,-193.73 3850.22,-196.8"/>
<text text-anchor="middle" x="3863.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu12_layer3_mha_out&#45;&gt;gpu12_layer3_expert3 -->
<g id="edge221" class="edge">
<title>gpu12_layer3_mha_out&#45;&gt;gpu12_layer3_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M3848.76,-246.42C3872.89,-229.99 3903.78,-208.97 3928.97,-191.83"/>
<polygon fill="blue" stroke="blue" points="3930.98,-194.7 3937.27,-186.18 3927.04,-188.91 3930.98,-194.7"/>
<text text-anchor="middle" x="3928.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu13_layer3_expert0 -->
<g id="node187" class="node">
<title>gpu13_layer3_expert0</title>
<polygon fill="lightgreen" stroke="black" points="4581.5,-186 4488.5,-186 4488.5,-133 4581.5,-133 4581.5,-186"/>
<text text-anchor="middle" x="4535" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="4535" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="4535" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 5</text>
</g>
<!-- gpu13_layer3_expert0&#45;&gt;output -->
<g id="edge253" class="edge">
<title>gpu13_layer3_expert0&#45;&gt;output</title>
<path fill="none" stroke="black" d="M4505.77,-132.96C4497.06,-126.68 4487.12,-120.7 4477,-117 4468.4,-113.86 4028.61,-79.53 3742.69,-57.47"/>
<polygon fill="black" stroke="black" points="3742.83,-53.97 3732.59,-56.69 3742.29,-60.95 3742.83,-53.97"/>
<text text-anchor="middle" x="4440.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu13_layer3_expert1 -->
<g id="node188" class="node">
<title>gpu13_layer3_expert1</title>
<polygon fill="lightgreen" stroke="black" points="4692.5,-186 4599.5,-186 4599.5,-133 4692.5,-133 4692.5,-186"/>
<text text-anchor="middle" x="4646" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="4646" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="4646" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 5</text>
</g>
<!-- gpu13_layer3_expert1&#45;&gt;output -->
<g id="edge254" class="edge">
<title>gpu13_layer3_expert1&#45;&gt;output</title>
<path fill="none" stroke="black" d="M4616,-132.89C4607.96,-126.99 4598.98,-121.22 4590,-117 4570.53,-107.86 4517.27,-97.16 4496,-94 4230.38,-54.5 3921.02,-42.69 3718.87,-39.5"/>
<polygon fill="black" stroke="black" points="3718.78,-36 3708.72,-39.35 3718.67,-43 3718.78,-36"/>
<text text-anchor="middle" x="4617.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu13_layer3_expert2 -->
<g id="node189" class="node">
<title>gpu13_layer3_expert2</title>
<polygon fill="lightgreen" stroke="black" points="4803.5,-186 4710.5,-186 4710.5,-133 4803.5,-133 4803.5,-186"/>
<text text-anchor="middle" x="4757" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="4757" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="4757" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 5</text>
</g>
<!-- gpu13_layer3_expert2&#45;&gt;output -->
<g id="edge255" class="edge">
<title>gpu13_layer3_expert2&#45;&gt;output</title>
<path fill="none" stroke="black" d="M4731.95,-132.97C4716.2,-118.72 4694.64,-102.21 4672,-94 4585.54,-62.63 4036.99,-48.13 3722.62,-42.32"/>
<polygon fill="black" stroke="black" points="3722.52,-38.82 3712.46,-42.14 3722.4,-45.82 3722.52,-38.82"/>
<text text-anchor="middle" x="4752.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu13_layer3_expert3 -->
<g id="node190" class="node">
<title>gpu13_layer3_expert3</title>
<polygon fill="lightgreen" stroke="black" points="4914.5,-186 4821.5,-186 4821.5,-133 4914.5,-133 4914.5,-186"/>
<text text-anchor="middle" x="4868" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="4868" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="4868" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 5</text>
</g>
<!-- gpu13_layer3_expert3&#45;&gt;output -->
<g id="edge256" class="edge">
<title>gpu13_layer3_expert3&#45;&gt;output</title>
<path fill="none" stroke="black" d="M4851.58,-132.72C4841.01,-118.57 4825.92,-102.26 4808,-94 4712.01,-49.77 4064.16,-40.79 3718.44,-39.17"/>
<polygon fill="black" stroke="black" points="3718.31,-35.67 3708.3,-39.13 3718.28,-42.67 3718.31,-35.67"/>
<text text-anchor="middle" x="4881.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu13_layer2_mha_qkv -->
<g id="node191" class="node">
<title>gpu13_layer2_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="5145" cy="-512.38" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="5145" y="-523.68" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="5145" y="-508.68" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="5145" y="-493.68" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- gpu13_layer2_mha_attn -->
<g id="node192" class="node">
<title>gpu13_layer2_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="5145" cy="-400.43" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="5145" y="-404.23" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="5145" y="-389.23" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- gpu13_layer2_mha_qkv&#45;&gt;gpu13_layer2_mha_attn -->
<g id="edge53" class="edge">
<title>gpu13_layer2_mha_qkv&#45;&gt;gpu13_layer2_mha_attn</title>
<path fill="none" stroke="black" d="M5145,-474.77C5145,-462.79 5145,-449.49 5145,-437.54"/>
<polygon fill="black" stroke="black" points="5148.5,-437.46 5145,-427.46 5141.5,-437.46 5148.5,-437.46"/>
</g>
<!-- gpu13_layer2_mha_out -->
<g id="node193" class="node">
<title>gpu13_layer2_mha_out</title>
<ellipse fill="orange" stroke="black" cx="5145" cy="-274.48" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="5145" y="-285.78" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="5145" y="-270.78" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="5145" y="-255.78" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- gpu13_layer2_mha_attn&#45;&gt;gpu13_layer2_mha_out -->
<g id="edge54" class="edge">
<title>gpu13_layer2_mha_attn&#45;&gt;gpu13_layer2_mha_out</title>
<path fill="none" stroke="black" d="M5145,-373.45C5145,-358.75 5145,-339.92 5145,-322.7"/>
<polygon fill="black" stroke="black" points="5148.5,-322.24 5145,-312.24 5141.5,-322.24 5148.5,-322.24"/>
</g>
<!-- gpu13_layer2_mha_out&#45;&gt;gpu13_layer2_expert0 -->
<g id="edge166" class="edge">
<title>gpu13_layer2_mha_out&#45;&gt;gpu13_layer2_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5105.24,-246.42C5081.11,-229.99 5050.22,-208.97 5025.03,-191.83"/>
<polygon fill="blue" stroke="blue" points="5026.96,-188.91 5016.73,-186.18 5023.02,-194.7 5026.96,-188.91"/>
<text text-anchor="middle" x="5083.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu13_layer2_mha_out&#45;&gt;gpu13_layer2_expert1 -->
<g id="edge174" class="edge">
<title>gpu13_layer2_mha_out&#45;&gt;gpu13_layer2_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5127.9,-238.35C5121.24,-224.67 5113.62,-209.02 5106.97,-195.36"/>
<polygon fill="blue" stroke="blue" points="5110.07,-193.73 5102.55,-186.27 5103.78,-196.8 5110.07,-193.73"/>
<text text-anchor="middle" x="5139.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu13_layer2_mha_out&#45;&gt;gpu13_layer2_expert2 -->
<g id="edge182" class="edge">
<title>gpu13_layer2_mha_out&#45;&gt;gpu13_layer2_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5162.41,-238.35C5169.19,-224.67 5176.95,-209.02 5183.72,-195.36"/>
<polygon fill="blue" stroke="blue" points="5186.92,-196.79 5188.22,-186.27 5180.65,-193.68 5186.92,-196.79"/>
<text text-anchor="middle" x="5200.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu13_layer2_mha_out&#45;&gt;gpu13_layer2_expert3 -->
<g id="edge190" class="edge">
<title>gpu13_layer2_mha_out&#45;&gt;gpu13_layer2_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5184.99,-246.64C5198.07,-237.85 5212.66,-228.02 5226,-219 5239.01,-210.2 5253.1,-200.63 5266.04,-191.83"/>
<polygon fill="blue" stroke="blue" points="5268.06,-194.69 5274.35,-186.17 5264.12,-188.9 5268.06,-194.69"/>
<text text-anchor="middle" x="5269.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu13_layer3_mha_qkv -->
<g id="node194" class="node">
<title>gpu13_layer3_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="4697" cy="-512.38" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="4697" y="-523.68" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="4697" y="-508.68" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="4697" y="-493.68" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- gpu13_layer3_mha_attn -->
<g id="node195" class="node">
<title>gpu13_layer3_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="4697" cy="-400.43" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="4697" y="-404.23" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="4697" y="-389.23" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- gpu13_layer3_mha_qkv&#45;&gt;gpu13_layer3_mha_attn -->
<g id="edge55" class="edge">
<title>gpu13_layer3_mha_qkv&#45;&gt;gpu13_layer3_mha_attn</title>
<path fill="none" stroke="black" d="M4697,-474.77C4697,-462.79 4697,-449.49 4697,-437.54"/>
<polygon fill="black" stroke="black" points="4700.5,-437.46 4697,-427.46 4693.5,-437.46 4700.5,-437.46"/>
</g>
<!-- gpu13_layer3_mha_out -->
<g id="node196" class="node">
<title>gpu13_layer3_mha_out</title>
<ellipse fill="orange" stroke="black" cx="4697" cy="-274.48" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="4697" y="-285.78" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="4697" y="-270.78" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="4697" y="-255.78" font-family="Times,serif" font-size="14.00">GPU 13</text>
</g>
<!-- gpu13_layer3_mha_attn&#45;&gt;gpu13_layer3_mha_out -->
<g id="edge56" class="edge">
<title>gpu13_layer3_mha_attn&#45;&gt;gpu13_layer3_mha_out</title>
<path fill="none" stroke="black" d="M4697,-373.45C4697,-358.75 4697,-339.92 4697,-322.7"/>
<polygon fill="black" stroke="black" points="4700.5,-322.24 4697,-312.24 4693.5,-322.24 4700.5,-322.24"/>
</g>
<!-- gpu13_layer3_mha_out&#45;&gt;gpu13_layer3_expert0 -->
<g id="edge198" class="edge">
<title>gpu13_layer3_mha_out&#45;&gt;gpu13_layer3_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4657.41,-246.77C4644.49,-237.98 4630.1,-228.13 4617,-219 4604.53,-210.31 4591.07,-200.77 4578.73,-191.97"/>
<polygon fill="blue" stroke="blue" points="4580.57,-188.98 4570.4,-186.01 4576.5,-194.67 4580.57,-188.98"/>
<text text-anchor="middle" x="4638.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu13_layer3_mha_out&#45;&gt;gpu13_layer3_expert1 -->
<g id="edge206" class="edge">
<title>gpu13_layer3_mha_out&#45;&gt;gpu13_layer3_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4679.2,-238.49C4676.06,-232.04 4672.87,-225.35 4670,-219 4666.56,-211.39 4663.04,-203.14 4659.8,-195.3"/>
<polygon fill="blue" stroke="blue" points="4663.03,-193.94 4656.01,-186.01 4656.55,-196.59 4663.03,-193.94"/>
<text text-anchor="middle" x="4691.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu13_layer3_mha_out&#45;&gt;gpu13_layer3_expert2 -->
<g id="edge214" class="edge">
<title>gpu13_layer3_mha_out&#45;&gt;gpu13_layer3_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4715.49,-238.66C4722.82,-224.86 4731.23,-209.02 4738.56,-195.23"/>
<polygon fill="blue" stroke="blue" points="4741.83,-196.53 4743.43,-186.06 4735.65,-193.25 4741.83,-196.53"/>
<text text-anchor="middle" x="4754.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu13_layer3_mha_out&#45;&gt;gpu13_layer3_expert3 -->
<g id="edge222" class="edge">
<title>gpu13_layer3_mha_out&#45;&gt;gpu13_layer3_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M4737.56,-246.92C4751.07,-238.06 4766.19,-228.12 4780,-219 4793.31,-210.21 4807.73,-200.64 4820.97,-191.84"/>
<polygon fill="blue" stroke="blue" points="4823.09,-194.63 4829.48,-186.18 4819.22,-188.8 4823.09,-194.63"/>
<text text-anchor="middle" x="4823.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu14_layer3_expert0 -->
<g id="node201" class="node">
<title>gpu14_layer3_expert0</title>
<polygon fill="lightyellow" stroke="black" points="5474.5,-186 5381.5,-186 5381.5,-133 5474.5,-133 5474.5,-186"/>
<text text-anchor="middle" x="5428" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="5428" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="5428" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 6</text>
</g>
<!-- gpu14_layer3_expert0&#45;&gt;output -->
<g id="edge257" class="edge">
<title>gpu14_layer3_expert0&#45;&gt;output</title>
<path fill="none" stroke="black" d="M5399.13,-133C5390.35,-126.63 5380.28,-120.6 5370,-117 5347.27,-109.03 4961.06,-95.1 4937,-94 4510.01,-74.48 4011.33,-56.44 3728.49,-46.65"/>
<polygon fill="black" stroke="black" points="3728.22,-43.14 3718.11,-46.29 3727.98,-50.13 3728.22,-43.14"/>
<text text-anchor="middle" x="5322.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu14_layer3_expert1 -->
<g id="node202" class="node">
<title>gpu14_layer3_expert1</title>
<polygon fill="lightyellow" stroke="black" points="5585.5,-186 5492.5,-186 5492.5,-133 5585.5,-133 5585.5,-186"/>
<text text-anchor="middle" x="5539" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="5539" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="5539" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 6</text>
</g>
<!-- gpu14_layer3_expert1&#45;&gt;output -->
<g id="edge258" class="edge">
<title>gpu14_layer3_expert1&#45;&gt;output</title>
<path fill="none" stroke="black" d="M5509.37,-132.95C5501.24,-126.98 5492.14,-121.16 5483,-117 5461.26,-107.11 5401.71,-96.92 5378,-94 5063.43,-55.28 4143.56,-43.65 3720.04,-40.29"/>
<polygon fill="black" stroke="black" points="3719.85,-36.79 3709.82,-40.21 3719.79,-43.79 3719.85,-36.79"/>
<text text-anchor="middle" x="5509.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu14_layer3_expert2 -->
<g id="node203" class="node">
<title>gpu14_layer3_expert2</title>
<polygon fill="lightyellow" stroke="black" points="5696.5,-186 5603.5,-186 5603.5,-133 5696.5,-133 5696.5,-186"/>
<text text-anchor="middle" x="5650" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="5650" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="5650" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 6</text>
</g>
<!-- gpu14_layer3_expert2&#45;&gt;output -->
<g id="edge259" class="edge">
<title>gpu14_layer3_expert2&#45;&gt;output</title>
<path fill="none" stroke="black" d="M5623.99,-132.72C5607.66,-118.37 5585.34,-101.86 5562,-94 5476.09,-65.06 4234.51,-47.46 3721.41,-41.39"/>
<polygon fill="black" stroke="black" points="3721.33,-37.89 3711.29,-41.28 3721.25,-44.89 3721.33,-37.89"/>
<text text-anchor="middle" x="5643.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu14_layer3_expert3 -->
<g id="node204" class="node">
<title>gpu14_layer3_expert3</title>
<polygon fill="lightyellow" stroke="black" points="5807.5,-186 5714.5,-186 5714.5,-133 5807.5,-133 5807.5,-186"/>
<text text-anchor="middle" x="5761" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="5761" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="5761" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 6</text>
</g>
<!-- gpu14_layer3_expert3&#45;&gt;output -->
<g id="edge260" class="edge">
<title>gpu14_layer3_expert3&#45;&gt;output</title>
<path fill="none" stroke="black" d="M5744.15,-132.92C5733.18,-118.65 5717.48,-102.14 5699,-94 5609.61,-54.61 4256.95,-43.04 3719.63,-39.99"/>
<polygon fill="black" stroke="black" points="3719.45,-36.49 3709.43,-39.94 3719.41,-43.49 3719.45,-36.49"/>
<text text-anchor="middle" x="5773.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu14_layer2_mha_qkv -->
<g id="node205" class="node">
<title>gpu14_layer2_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="6038" cy="-512.38" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="6038" y="-523.68" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="6038" y="-508.68" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="6038" y="-493.68" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- gpu14_layer2_mha_attn -->
<g id="node206" class="node">
<title>gpu14_layer2_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="6038" cy="-400.43" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="6038" y="-404.23" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="6038" y="-389.23" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- gpu14_layer2_mha_qkv&#45;&gt;gpu14_layer2_mha_attn -->
<g id="edge57" class="edge">
<title>gpu14_layer2_mha_qkv&#45;&gt;gpu14_layer2_mha_attn</title>
<path fill="none" stroke="black" d="M6038,-474.77C6038,-462.79 6038,-449.49 6038,-437.54"/>
<polygon fill="black" stroke="black" points="6041.5,-437.46 6038,-427.46 6034.5,-437.46 6041.5,-437.46"/>
</g>
<!-- gpu14_layer2_mha_out -->
<g id="node207" class="node">
<title>gpu14_layer2_mha_out</title>
<ellipse fill="orange" stroke="black" cx="6038" cy="-274.48" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="6038" y="-285.78" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="6038" y="-270.78" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="6038" y="-255.78" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- gpu14_layer2_mha_attn&#45;&gt;gpu14_layer2_mha_out -->
<g id="edge58" class="edge">
<title>gpu14_layer2_mha_attn&#45;&gt;gpu14_layer2_mha_out</title>
<path fill="none" stroke="black" d="M6038,-373.45C6038,-358.75 6038,-339.92 6038,-322.7"/>
<polygon fill="black" stroke="black" points="6041.5,-322.24 6038,-312.24 6034.5,-322.24 6041.5,-322.24"/>
</g>
<!-- gpu14_layer2_mha_out&#45;&gt;gpu14_layer2_expert0 -->
<g id="edge167" class="edge">
<title>gpu14_layer2_mha_out&#45;&gt;gpu14_layer2_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5998.24,-246.42C5974.11,-229.99 5943.22,-208.97 5918.03,-191.83"/>
<polygon fill="blue" stroke="blue" points="5919.96,-188.91 5909.73,-186.18 5916.02,-194.7 5919.96,-188.91"/>
<text text-anchor="middle" x="5976.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu14_layer2_mha_out&#45;&gt;gpu14_layer2_expert1 -->
<g id="edge175" class="edge">
<title>gpu14_layer2_mha_out&#45;&gt;gpu14_layer2_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6020.9,-238.35C6014.24,-224.67 6006.62,-209.02 5999.97,-195.36"/>
<polygon fill="blue" stroke="blue" points="6003.07,-193.73 5995.55,-186.27 5996.78,-196.8 6003.07,-193.73"/>
<text text-anchor="middle" x="6032.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu14_layer2_mha_out&#45;&gt;gpu14_layer2_expert2 -->
<g id="edge183" class="edge">
<title>gpu14_layer2_mha_out&#45;&gt;gpu14_layer2_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6055.41,-238.35C6062.19,-224.67 6069.95,-209.02 6076.72,-195.36"/>
<polygon fill="blue" stroke="blue" points="6079.92,-196.79 6081.22,-186.27 6073.65,-193.68 6079.92,-196.79"/>
<text text-anchor="middle" x="6093.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu14_layer2_mha_out&#45;&gt;gpu14_layer2_expert3 -->
<g id="edge191" class="edge">
<title>gpu14_layer2_mha_out&#45;&gt;gpu14_layer2_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6077.99,-246.64C6091.07,-237.85 6105.66,-228.02 6119,-219 6132.01,-210.2 6146.1,-200.63 6159.04,-191.83"/>
<polygon fill="blue" stroke="blue" points="6161.06,-194.69 6167.35,-186.17 6157.12,-188.9 6161.06,-194.69"/>
<text text-anchor="middle" x="6162.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu14_layer3_mha_qkv -->
<g id="node208" class="node">
<title>gpu14_layer3_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="5589" cy="-512.38" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="5589" y="-523.68" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="5589" y="-508.68" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="5589" y="-493.68" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- gpu14_layer3_mha_attn -->
<g id="node209" class="node">
<title>gpu14_layer3_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="5589" cy="-400.43" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="5589" y="-404.23" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="5589" y="-389.23" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- gpu14_layer3_mha_qkv&#45;&gt;gpu14_layer3_mha_attn -->
<g id="edge59" class="edge">
<title>gpu14_layer3_mha_qkv&#45;&gt;gpu14_layer3_mha_attn</title>
<path fill="none" stroke="black" d="M5589,-474.77C5589,-462.79 5589,-449.49 5589,-437.54"/>
<polygon fill="black" stroke="black" points="5592.5,-437.46 5589,-427.46 5585.5,-437.46 5592.5,-437.46"/>
</g>
<!-- gpu14_layer3_mha_out -->
<g id="node210" class="node">
<title>gpu14_layer3_mha_out</title>
<ellipse fill="orange" stroke="black" cx="5589" cy="-274.48" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="5589" y="-285.78" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="5589" y="-270.78" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="5589" y="-255.78" font-family="Times,serif" font-size="14.00">GPU 14</text>
</g>
<!-- gpu14_layer3_mha_attn&#45;&gt;gpu14_layer3_mha_out -->
<g id="edge60" class="edge">
<title>gpu14_layer3_mha_attn&#45;&gt;gpu14_layer3_mha_out</title>
<path fill="none" stroke="black" d="M5589,-373.45C5589,-358.75 5589,-339.92 5589,-322.7"/>
<polygon fill="black" stroke="black" points="5592.5,-322.24 5589,-312.24 5585.5,-322.24 5592.5,-322.24"/>
</g>
<!-- gpu14_layer3_mha_out&#45;&gt;gpu14_layer3_expert0 -->
<g id="edge199" class="edge">
<title>gpu14_layer3_mha_out&#45;&gt;gpu14_layer3_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5549.53,-246.44C5536.88,-237.73 5522.82,-227.99 5510,-219 5497.67,-210.35 5484.35,-200.9 5472.11,-192.17"/>
<polygon fill="blue" stroke="blue" points="5474.01,-189.22 5463.84,-186.25 5469.94,-194.91 5474.01,-189.22"/>
<text text-anchor="middle" x="5531.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu14_layer3_mha_out&#45;&gt;gpu14_layer3_expert1 -->
<g id="edge207" class="edge">
<title>gpu14_layer3_mha_out&#45;&gt;gpu14_layer3_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5571.93,-238.44C5568.89,-232.01 5565.8,-225.32 5563,-219 5559.68,-211.52 5556.26,-203.44 5553.08,-195.74"/>
<polygon fill="blue" stroke="blue" points="5556.23,-194.19 5549.21,-186.26 5549.75,-196.84 5556.23,-194.19"/>
<text text-anchor="middle" x="5584.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu14_layer3_mha_out&#45;&gt;gpu14_layer3_expert2 -->
<g id="edge215" class="edge">
<title>gpu14_layer3_mha_out&#45;&gt;gpu14_layer3_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5607.8,-238.66C5615.25,-224.86 5623.8,-209.02 5631.25,-195.23"/>
<polygon fill="blue" stroke="blue" points="5634.53,-196.52 5636.2,-186.06 5628.37,-193.19 5634.53,-196.52"/>
<text text-anchor="middle" x="5646.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu14_layer3_mha_out&#45;&gt;gpu14_layer3_expert3 -->
<g id="edge223" class="edge">
<title>gpu14_layer3_mha_out&#45;&gt;gpu14_layer3_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M5629.53,-246.88C5643.04,-238.02 5658.17,-228.08 5672,-219 5685.44,-210.17 5700.02,-200.59 5713.41,-191.79"/>
<polygon fill="blue" stroke="blue" points="5715.58,-194.55 5722.01,-186.13 5711.73,-188.7 5715.58,-194.55"/>
<text text-anchor="middle" x="5715.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu15_layer3_expert0 -->
<g id="node215" class="node">
<title>gpu15_layer3_expert0</title>
<polygon fill="lightpink" stroke="black" points="6367.5,-186 6274.5,-186 6274.5,-133 6367.5,-133 6367.5,-186"/>
<text text-anchor="middle" x="6321" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="6321" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="6321" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 7</text>
</g>
<!-- gpu15_layer3_expert0&#45;&gt;output -->
<g id="edge261" class="edge">
<title>gpu15_layer3_expert0&#45;&gt;output</title>
<path fill="none" stroke="black" d="M6292.13,-132.99C6283.35,-126.63 6273.28,-120.6 6263,-117 6240.21,-109.02 5853.13,-94.92 5829,-94 5055.12,-64.35 4135.8,-48.27 3722.51,-42.06"/>
<polygon fill="black" stroke="black" points="3722.29,-38.56 3712.24,-41.91 3722.18,-45.55 3722.29,-38.56"/>
<text text-anchor="middle" x="6215.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu15_layer3_expert1 -->
<g id="node216" class="node">
<title>gpu15_layer3_expert1</title>
<polygon fill="lightpink" stroke="black" points="6478.5,-186 6385.5,-186 6385.5,-133 6478.5,-133 6478.5,-186"/>
<text text-anchor="middle" x="6432" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="6432" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="6432" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 7</text>
</g>
<!-- gpu15_layer3_expert1&#45;&gt;output -->
<g id="edge262" class="edge">
<title>gpu15_layer3_expert1&#45;&gt;output</title>
<path fill="none" stroke="black" d="M6402.37,-132.95C6394.24,-126.98 6385.14,-121.16 6376,-117 6354.26,-107.11 6294.72,-96.81 6271,-94 6021.28,-64.46 4330.67,-46.47 3720.8,-40.88"/>
<polygon fill="black" stroke="black" points="3720.61,-37.38 3710.58,-40.79 3720.54,-44.38 3720.61,-37.38"/>
<text text-anchor="middle" x="6402.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu15_layer3_expert2 -->
<g id="node217" class="node">
<title>gpu15_layer3_expert2</title>
<polygon fill="lightpink" stroke="black" points="6589.5,-186 6496.5,-186 6496.5,-133 6589.5,-133 6589.5,-186"/>
<text text-anchor="middle" x="6543" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="6543" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="6543" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 7</text>
</g>
<!-- gpu15_layer3_expert2&#45;&gt;output -->
<g id="edge263" class="edge">
<title>gpu15_layer3_expert2&#45;&gt;output</title>
<path fill="none" stroke="black" d="M6517.39,-132.98C6501.04,-118.53 6478.55,-101.83 6455,-94 6325.83,-51.06 4378.68,-41.51 3718.79,-39.51"/>
<polygon fill="black" stroke="black" points="3718.7,-36.01 3708.69,-39.48 3718.68,-43.01 3718.7,-36.01"/>
<text text-anchor="middle" x="6536.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu15_layer3_expert3 -->
<g id="node218" class="node">
<title>gpu15_layer3_expert3</title>
<polygon fill="lightpink" stroke="black" points="6700.5,-186 6607.5,-186 6607.5,-133 6700.5,-133 6700.5,-186"/>
<text text-anchor="middle" x="6654" y="-170.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="6654" y="-155.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="6654" y="-140.8" font-family="Times,serif" font-size="14.00">TP&#45;shard 7</text>
</g>
<!-- gpu15_layer3_expert3&#45;&gt;output -->
<g id="edge264" class="edge">
<title>gpu15_layer3_expert3&#45;&gt;output</title>
<path fill="none" stroke="black" d="M6637.18,-132.88C6626.21,-118.58 6610.51,-102.08 6592,-94 6526.27,-65.32 4413.98,-46.17 3720.3,-40.65"/>
<polygon fill="black" stroke="black" points="3720.22,-37.15 3710.2,-40.57 3720.17,-44.15 3720.22,-37.15"/>
<text text-anchor="middle" x="6666.5" y="-97.8" font-family="Times,serif" font-size="14.00">Output gather</text>
</g>
<!-- gpu15_layer2_mha_qkv -->
<g id="node219" class="node">
<title>gpu15_layer2_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="6931" cy="-512.38" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="6931" y="-523.68" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="6931" y="-508.68" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="6931" y="-493.68" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- gpu15_layer2_mha_attn -->
<g id="node220" class="node">
<title>gpu15_layer2_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="6931" cy="-400.43" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="6931" y="-404.23" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="6931" y="-389.23" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- gpu15_layer2_mha_qkv&#45;&gt;gpu15_layer2_mha_attn -->
<g id="edge61" class="edge">
<title>gpu15_layer2_mha_qkv&#45;&gt;gpu15_layer2_mha_attn</title>
<path fill="none" stroke="black" d="M6931,-474.77C6931,-462.79 6931,-449.49 6931,-437.54"/>
<polygon fill="black" stroke="black" points="6934.5,-437.46 6931,-427.46 6927.5,-437.46 6934.5,-437.46"/>
</g>
<!-- gpu15_layer2_mha_out -->
<g id="node221" class="node">
<title>gpu15_layer2_mha_out</title>
<ellipse fill="orange" stroke="black" cx="6931" cy="-274.48" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="6931" y="-285.78" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="6931" y="-270.78" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="6931" y="-255.78" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- gpu15_layer2_mha_attn&#45;&gt;gpu15_layer2_mha_out -->
<g id="edge62" class="edge">
<title>gpu15_layer2_mha_attn&#45;&gt;gpu15_layer2_mha_out</title>
<path fill="none" stroke="black" d="M6931,-373.45C6931,-358.75 6931,-339.92 6931,-322.7"/>
<polygon fill="black" stroke="black" points="6934.5,-322.24 6931,-312.24 6927.5,-322.24 6934.5,-322.24"/>
</g>
<!-- gpu15_layer2_mha_out&#45;&gt;gpu15_layer2_expert0 -->
<g id="edge168" class="edge">
<title>gpu15_layer2_mha_out&#45;&gt;gpu15_layer2_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6891.24,-246.42C6867.11,-229.99 6836.22,-208.97 6811.03,-191.83"/>
<polygon fill="blue" stroke="blue" points="6812.96,-188.91 6802.73,-186.18 6809.02,-194.7 6812.96,-188.91"/>
<text text-anchor="middle" x="6869.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu15_layer2_mha_out&#45;&gt;gpu15_layer2_expert1 -->
<g id="edge176" class="edge">
<title>gpu15_layer2_mha_out&#45;&gt;gpu15_layer2_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6913.9,-238.35C6907.24,-224.67 6899.62,-209.02 6892.97,-195.36"/>
<polygon fill="blue" stroke="blue" points="6896.07,-193.73 6888.55,-186.27 6889.78,-196.8 6896.07,-193.73"/>
<text text-anchor="middle" x="6925.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu15_layer2_mha_out&#45;&gt;gpu15_layer2_expert2 -->
<g id="edge184" class="edge">
<title>gpu15_layer2_mha_out&#45;&gt;gpu15_layer2_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6948.41,-238.35C6955.19,-224.67 6962.95,-209.02 6969.72,-195.36"/>
<polygon fill="blue" stroke="blue" points="6972.92,-196.79 6974.22,-186.27 6966.65,-193.68 6972.92,-196.79"/>
<text text-anchor="middle" x="6986.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu15_layer2_mha_out&#45;&gt;gpu15_layer2_expert3 -->
<g id="edge192" class="edge">
<title>gpu15_layer2_mha_out&#45;&gt;gpu15_layer2_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6970.99,-246.64C6984.07,-237.85 6998.66,-228.02 7012,-219 7025.01,-210.2 7039.1,-200.63 7052.04,-191.83"/>
<polygon fill="blue" stroke="blue" points="7054.06,-194.69 7060.35,-186.17 7050.12,-188.9 7054.06,-194.69"/>
<text text-anchor="middle" x="7055.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu15_layer3_mha_qkv -->
<g id="node222" class="node">
<title>gpu15_layer3_mha_qkv</title>
<ellipse fill="orange" stroke="black" cx="6488" cy="-512.38" rx="62.87" ry="37.45"/>
<text text-anchor="middle" x="6488" y="-523.68" font-family="Times,serif" font-size="14.00">MHA QKV</text>
<text text-anchor="middle" x="6488" y="-508.68" font-family="Times,serif" font-size="14.00">TP&#45;col</text>
<text text-anchor="middle" x="6488" y="-493.68" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- gpu15_layer3_mha_attn -->
<g id="node223" class="node">
<title>gpu15_layer3_mha_attn</title>
<ellipse fill="orange" stroke="black" cx="6488" cy="-400.43" rx="62.45" ry="26.74"/>
<text text-anchor="middle" x="6488" y="-404.23" font-family="Times,serif" font-size="14.00">MHA Attn</text>
<text text-anchor="middle" x="6488" y="-389.23" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- gpu15_layer3_mha_qkv&#45;&gt;gpu15_layer3_mha_attn -->
<g id="edge63" class="edge">
<title>gpu15_layer3_mha_qkv&#45;&gt;gpu15_layer3_mha_attn</title>
<path fill="none" stroke="black" d="M6488,-474.77C6488,-462.79 6488,-449.49 6488,-437.54"/>
<polygon fill="black" stroke="black" points="6491.5,-437.46 6488,-427.46 6484.5,-437.46 6491.5,-437.46"/>
</g>
<!-- gpu15_layer3_mha_out -->
<g id="node224" class="node">
<title>gpu15_layer3_mha_out</title>
<ellipse fill="orange" stroke="black" cx="6488" cy="-274.48" rx="58.88" ry="37.45"/>
<text text-anchor="middle" x="6488" y="-285.78" font-family="Times,serif" font-size="14.00">MHA Out</text>
<text text-anchor="middle" x="6488" y="-270.78" font-family="Times,serif" font-size="14.00">TP&#45;row</text>
<text text-anchor="middle" x="6488" y="-255.78" font-family="Times,serif" font-size="14.00">GPU 15</text>
</g>
<!-- gpu15_layer3_mha_attn&#45;&gt;gpu15_layer3_mha_out -->
<g id="edge64" class="edge">
<title>gpu15_layer3_mha_attn&#45;&gt;gpu15_layer3_mha_out</title>
<path fill="none" stroke="black" d="M6488,-373.45C6488,-358.75 6488,-339.92 6488,-322.7"/>
<polygon fill="black" stroke="black" points="6491.5,-322.24 6488,-312.24 6484.5,-322.24 6491.5,-322.24"/>
</g>
<!-- gpu15_layer3_mha_out&#45;&gt;gpu15_layer3_expert0 -->
<g id="edge200" class="edge">
<title>gpu15_layer3_mha_out&#45;&gt;gpu15_layer3_expert0</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6448.42,-246.7C6424.07,-230.23 6392.75,-209.04 6367.26,-191.8"/>
<polygon fill="blue" stroke="blue" points="6369.1,-188.82 6358.86,-186.11 6365.18,-194.61 6369.1,-188.82"/>
<text text-anchor="middle" x="6426.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu15_layer3_mha_out&#45;&gt;gpu15_layer3_expert1 -->
<g id="edge208" class="edge">
<title>gpu15_layer3_mha_out&#45;&gt;gpu15_layer3_expert1</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6470.59,-238.35C6463.81,-224.67 6456.05,-209.02 6449.28,-195.36"/>
<polygon fill="blue" stroke="blue" points="6452.35,-193.68 6444.78,-186.27 6446.08,-196.79 6452.35,-193.68"/>
<text text-anchor="middle" x="6481.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu15_layer3_mha_out&#45;&gt;gpu15_layer3_expert2 -->
<g id="edge216" class="edge">
<title>gpu15_layer3_mha_out&#45;&gt;gpu15_layer3_expert2</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6505.1,-238.35C6511.76,-224.67 6519.38,-209.02 6526.03,-195.36"/>
<polygon fill="blue" stroke="blue" points="6529.22,-196.8 6530.45,-186.27 6522.93,-193.73 6529.22,-196.8"/>
<text text-anchor="middle" x="6542.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- gpu15_layer3_mha_out&#45;&gt;gpu15_layer3_expert3 -->
<g id="edge224" class="edge">
<title>gpu15_layer3_mha_out&#45;&gt;gpu15_layer3_expert3</title>
<path fill="none" stroke="blue" stroke-dasharray="1,5" d="M6527.76,-246.42C6551.89,-229.99 6582.78,-208.97 6607.97,-191.83"/>
<polygon fill="blue" stroke="blue" points="6609.98,-194.7 6616.27,-186.18 6606.04,-188.91 6609.98,-194.7"/>
<text text-anchor="middle" x="6607.5" y="-207.8" font-family="Times,serif" font-size="14.00">TP&#45;AR</text>
</g>
<!-- input -->
<g id="node225" class="node">
<title>input</title>
<polygon fill="none" stroke="black" points="11162.23,-892.81 10753.03,-892.81 10647.77,-816.81 11056.97,-816.81 11162.23,-892.81"/>
<text text-anchor="middle" x="10905" y="-858.61" font-family="Times,serif" font-size="14.00">Input Tokens</text>
<text text-anchor="middle" x="10905" y="-843.61" font-family="Times,serif" font-size="14.00">(BS=1024, Seq=1024, H=4096)</text>
</g>
<!-- input&#45;&gt;gpu0_layer0_mha_qkv -->
<g id="edge225" class="edge">
<title>input&#45;&gt;gpu0_layer0_mha_qkv</title>
<path fill="none" stroke="black" d="M10696.11,-851.73C10060.86,-844.93 8187.84,-821.11 8065,-775.81 8032.19,-763.71 8001.58,-738.96 7979.23,-717.29"/>
<polygon fill="black" stroke="black" points="7981.54,-714.65 7971.98,-710.09 7976.61,-719.62 7981.54,-714.65"/>
<text text-anchor="middle" x="8304" y="-787.61" font-family="Times,serif" font-size="14.00">Input shard</text>
</g>
<!-- input&#45;&gt;gpu1_layer0_mha_qkv -->
<g id="edge226" class="edge">
<title>input&#45;&gt;gpu1_layer0_mha_qkv</title>
<path fill="none" stroke="black" d="M10693.68,-849.98C10205.4,-840.48 9034.59,-813.88 8958,-775.81 8934.24,-764 8914.97,-741.66 8901.19,-721.24"/>
<polygon fill="black" stroke="black" points="8904,-719.13 8895.63,-712.64 8898.12,-722.94 8904,-719.13"/>
<text text-anchor="middle" x="9166" y="-787.61" font-family="Times,serif" font-size="14.00">Input shard</text>
</g>
<!-- input&#45;&gt;gpu2_layer0_mha_qkv -->
<g id="edge227" class="edge">
<title>input&#45;&gt;gpu2_layer0_mha_qkv</title>
<path fill="none" stroke="black" d="M10689.16,-846.89C10402.38,-836.31 9923.32,-813.29 9851,-775.81 9827.44,-763.6 9808.18,-741.23 9794.37,-720.9"/>
<polygon fill="black" stroke="black" points="9797.18,-718.8 9788.78,-712.34 9791.32,-722.63 9797.18,-718.8"/>
<text text-anchor="middle" x="9981" y="-787.61" font-family="Times,serif" font-size="14.00">Input shard</text>
</g>
<!-- input&#45;&gt;gpu3_layer0_mha_qkv -->
<g id="edge228" class="edge">
<title>input&#45;&gt;gpu3_layer0_mha_qkv</title>
<path fill="none" stroke="black" d="M10811.13,-816.73C10788.01,-805.4 10764.14,-791.66 10744,-775.81 10724,-760.07 10705.62,-738.6 10691.45,-719.73"/>
<polygon fill="black" stroke="black" points="10694.18,-717.54 10685.44,-711.55 10688.54,-721.68 10694.18,-717.54"/>
<text text-anchor="middle" x="10818" y="-787.61" font-family="Times,serif" font-size="14.00">Input shard</text>
</g>
<!-- input&#45;&gt;gpu4_layer0_mha_qkv -->
<g id="edge229" class="edge">
<title>input&#45;&gt;gpu4_layer0_mha_qkv</title>
<path fill="none" stroke="black" d="M10968.06,-816.73C10988.23,-804.28 11010.39,-789.95 11030,-775.81 11056.46,-756.74 11084.65,-733.55 11106.94,-714.47"/>
<polygon fill="black" stroke="black" points="11109.28,-717.08 11114.57,-707.91 11104.71,-711.78 11109.28,-717.08"/>
<text text-anchor="middle" x="11058" y="-787.61" font-family="Times,serif" font-size="14.00">Input shard</text>
</g>
<!-- input&#45;&gt;gpu5_layer0_mha_qkv -->
<g id="edge230" class="edge">
<title>input&#45;&gt;gpu5_layer0_mha_qkv</title>
<path fill="none" stroke="black" d="M11107.12,-852.92C11363.29,-849.3 11788.99,-834.32 11934,-775.81 11965.73,-763.01 11995.39,-738.51 12017.16,-717.15"/>
<polygon fill="black" stroke="black" points="12019.65,-719.61 12024.23,-710.05 12014.69,-714.67 12019.65,-719.61"/>
<text text-anchor="middle" x="11947" y="-787.61" font-family="Times,serif" font-size="14.00">Input shard</text>
</g>
<!-- input&#45;&gt;gpu6_layer0_mha_qkv -->
<g id="edge231" class="edge">
<title>input&#45;&gt;gpu6_layer0_mha_qkv</title>
<path fill="none" stroke="black" d="M11103.16,-849.93C11558.29,-840.41 12651.89,-813.86 12815,-775.81 12875.38,-761.73 12939.64,-731.34 12983.4,-708.02"/>
<polygon fill="black" stroke="black" points="12985.27,-710.98 12992.42,-703.15 12981.95,-704.82 12985.27,-710.98"/>
<text text-anchor="middle" x="12804" y="-787.61" font-family="Times,serif" font-size="14.00">Input shard</text>
</g>
<!-- input&#45;&gt;gpu7_layer0_mha_qkv -->
<g id="edge232" class="edge">
<title>input&#45;&gt;gpu7_layer0_mha_qkv</title>
<path fill="none" stroke="black" d="M11104.89,-851.29C11725.23,-843.06 13583.55,-815.23 13707,-775.81 13746.15,-763.31 13784.53,-736.98 13812.25,-714.69"/>
<polygon fill="black" stroke="black" points="13814.63,-717.27 13820.14,-708.22 13810.19,-711.86 13814.63,-717.27"/>
<text text-anchor="middle" x="13696" y="-787.61" font-family="Times,serif" font-size="14.00">Input shard</text>
</g>
</g>
</svg>
