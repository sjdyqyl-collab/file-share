<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: MoE_Baseline_Parallelism Pages: 1 -->
<svg width="6322pt" height="4186pt"
 viewBox="0.00 0.00 6322.00 4186.25" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 4182.25)">
<title>MoE_Baseline_Parallelism</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-4182.25 6318,-4182.25 6318,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_stage_1</title>
<path fill="none" stroke="black" d="M38,-2153.6C38,-2153.6 6294,-2153.6 6294,-2153.6 6300,-2153.6 6306,-2159.6 6306,-2165.6 6306,-2165.6 6306,-4085.51 6306,-4085.51 6306,-4091.51 6300,-4097.51 6294,-4097.51 6294,-4097.51 38,-4097.51 38,-4097.51 32,-4097.51 26,-4091.51 26,-4085.51 26,-4085.51 26,-2165.6 26,-2165.6 26,-2159.6 32,-2153.6 38,-2153.6"/>
<text text-anchor="middle" x="3166" y="-4082.31" font-family="Times,serif" font-size="14.00">Pipeline Stage 1 (GPUs 0&#45;7)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_layer_1</title>
<path fill="none" stroke="black" d="M46,-3122.55C46,-3122.55 6286,-3122.55 6286,-3122.55 6292,-3122.55 6298,-3128.55 6298,-3134.55 6298,-3134.55 6298,-4054.51 6298,-4054.51 6298,-4060.51 6292,-4066.51 6286,-4066.51 6286,-4066.51 46,-4066.51 46,-4066.51 40,-4066.51 34,-4060.51 34,-4054.51 34,-4054.51 34,-3134.55 34,-3134.55 34,-3128.55 40,-3122.55 46,-3122.55"/>
<text text-anchor="middle" x="3166" y="-4051.31" font-family="Times,serif" font-size="14.00">MoE Layer 1</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_tp_1_0</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="42,-3130.55 42,-4035.51 816,-4035.51 816,-3130.55 42,-3130.55"/>
<text text-anchor="middle" x="429" y="-4020.31" font-family="Times,serif" font-size="14.00">TP Group 0 (GPU 0)</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_tp_1_1</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="824,-3130.55 824,-4035.51 1598,-4035.51 1598,-3130.55 824,-3130.55"/>
<text text-anchor="middle" x="1211" y="-4020.31" font-family="Times,serif" font-size="14.00">TP Group 1 (GPU 1)</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_tp_1_2</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1606,-3130.55 1606,-4035.51 2380,-4035.51 2380,-3130.55 1606,-3130.55"/>
<text text-anchor="middle" x="1993" y="-4020.31" font-family="Times,serif" font-size="14.00">TP Group 2 (GPU 2)</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_tp_1_3</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="2388,-3130.55 2388,-4035.51 3162,-4035.51 3162,-3130.55 2388,-3130.55"/>
<text text-anchor="middle" x="2775" y="-4020.31" font-family="Times,serif" font-size="14.00">TP Group 3 (GPU 3)</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_tp_1_4</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="3170,-3130.55 3170,-4035.51 3944,-4035.51 3944,-3130.55 3170,-3130.55"/>
<text text-anchor="middle" x="3557" y="-4020.31" font-family="Times,serif" font-size="14.00">TP Group 4 (GPU 4)</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_tp_1_5</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="3952,-3130.55 3952,-4035.51 4726,-4035.51 4726,-3130.55 3952,-3130.55"/>
<text text-anchor="middle" x="4339" y="-4020.31" font-family="Times,serif" font-size="14.00">TP Group 5 (GPU 5)</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_tp_1_6</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="4734,-3130.55 4734,-4035.51 5508,-4035.51 5508,-3130.55 4734,-3130.55"/>
<text text-anchor="middle" x="5121" y="-4020.31" font-family="Times,serif" font-size="14.00">TP Group 6 (GPU 6)</text>
</g>
<g id="clust10" class="cluster">
<title>cluster_tp_1_7</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="5516,-3130.55 5516,-4035.51 6290,-4035.51 6290,-3130.55 5516,-3130.55"/>
<text text-anchor="middle" x="5903" y="-4020.31" font-family="Times,serif" font-size="14.00">TP Group 7 (GPU 7)</text>
</g>
<g id="clust11" class="cluster">
<title>cluster_layer_2</title>
<path fill="none" stroke="black" d="M46,-2161.6C46,-2161.6 6286,-2161.6 6286,-2161.6 6292,-2161.6 6298,-2167.6 6298,-2173.6 6298,-2173.6 6298,-3093.55 6298,-3093.55 6298,-3099.55 6292,-3105.55 6286,-3105.55 6286,-3105.55 46,-3105.55 46,-3105.55 40,-3105.55 34,-3099.55 34,-3093.55 34,-3093.55 34,-2173.6 34,-2173.6 34,-2167.6 40,-2161.6 46,-2161.6"/>
<text text-anchor="middle" x="3166" y="-3090.35" font-family="Times,serif" font-size="14.00">MoE Layer 2</text>
</g>
<g id="clust12" class="cluster">
<title>cluster_tp_2_0</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="42,-2169.6 42,-3074.55 816,-3074.55 816,-2169.6 42,-2169.6"/>
<text text-anchor="middle" x="429" y="-3059.35" font-family="Times,serif" font-size="14.00">TP Group 0 (GPU 0)</text>
</g>
<g id="clust13" class="cluster">
<title>cluster_tp_2_1</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="824,-2169.6 824,-3074.55 1598,-3074.55 1598,-2169.6 824,-2169.6"/>
<text text-anchor="middle" x="1211" y="-3059.35" font-family="Times,serif" font-size="14.00">TP Group 1 (GPU 1)</text>
</g>
<g id="clust14" class="cluster">
<title>cluster_tp_2_2</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1606,-2169.6 1606,-3074.55 2380,-3074.55 2380,-2169.6 1606,-2169.6"/>
<text text-anchor="middle" x="1993" y="-3059.35" font-family="Times,serif" font-size="14.00">TP Group 2 (GPU 2)</text>
</g>
<g id="clust15" class="cluster">
<title>cluster_tp_2_3</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="2388,-2169.6 2388,-3074.55 3162,-3074.55 3162,-2169.6 2388,-2169.6"/>
<text text-anchor="middle" x="2775" y="-3059.35" font-family="Times,serif" font-size="14.00">TP Group 3 (GPU 3)</text>
</g>
<g id="clust16" class="cluster">
<title>cluster_tp_2_4</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="3170,-2169.6 3170,-3074.55 3944,-3074.55 3944,-2169.6 3170,-2169.6"/>
<text text-anchor="middle" x="3557" y="-3059.35" font-family="Times,serif" font-size="14.00">TP Group 4 (GPU 4)</text>
</g>
<g id="clust17" class="cluster">
<title>cluster_tp_2_5</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="3952,-2169.6 3952,-3074.55 4726,-3074.55 4726,-2169.6 3952,-2169.6"/>
<text text-anchor="middle" x="4339" y="-3059.35" font-family="Times,serif" font-size="14.00">TP Group 5 (GPU 5)</text>
</g>
<g id="clust18" class="cluster">
<title>cluster_tp_2_6</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="4734,-2169.6 4734,-3074.55 5508,-3074.55 5508,-2169.6 4734,-2169.6"/>
<text text-anchor="middle" x="5121" y="-3059.35" font-family="Times,serif" font-size="14.00">TP Group 6 (GPU 6)</text>
</g>
<g id="clust19" class="cluster">
<title>cluster_tp_2_7</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="5516,-2169.6 5516,-3074.55 6290,-3074.55 6290,-2169.6 5516,-2169.6"/>
<text text-anchor="middle" x="5903" y="-3059.35" font-family="Times,serif" font-size="14.00">TP Group 7 (GPU 7)</text>
</g>
<g id="clust20" class="cluster">
<title>cluster_stage_2</title>
<path fill="none" stroke="black" d="M20,-80.74C20,-80.74 6276,-80.74 6276,-80.74 6282,-80.74 6288,-86.74 6288,-92.74 6288,-92.74 6288,-2012.65 6288,-2012.65 6288,-2018.65 6282,-2024.65 6276,-2024.65 6276,-2024.65 20,-2024.65 20,-2024.65 14,-2024.65 8,-2018.65 8,-2012.65 8,-2012.65 8,-92.74 8,-92.74 8,-86.74 14,-80.74 20,-80.74"/>
<text text-anchor="middle" x="3148" y="-2009.45" font-family="Times,serif" font-size="14.00">Pipeline Stage 2 (GPUs 8&#45;15)</text>
</g>
<g id="clust21" class="cluster">
<title>cluster_layer_3</title>
<path fill="none" stroke="black" d="M28,-1049.69C28,-1049.69 6268,-1049.69 6268,-1049.69 6274,-1049.69 6280,-1055.69 6280,-1061.69 6280,-1061.69 6280,-1981.65 6280,-1981.65 6280,-1987.65 6274,-1993.65 6268,-1993.65 6268,-1993.65 28,-1993.65 28,-1993.65 22,-1993.65 16,-1987.65 16,-1981.65 16,-1981.65 16,-1061.69 16,-1061.69 16,-1055.69 22,-1049.69 28,-1049.69"/>
<text text-anchor="middle" x="3148" y="-1978.45" font-family="Times,serif" font-size="14.00">MoE Layer 3</text>
</g>
<g id="clust22" class="cluster">
<title>cluster_tp_3_0</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="24,-1057.69 24,-1962.65 798,-1962.65 798,-1057.69 24,-1057.69"/>
<text text-anchor="middle" x="411" y="-1947.45" font-family="Times,serif" font-size="14.00">TP Group 0 (GPU 8)</text>
</g>
<g id="clust23" class="cluster">
<title>cluster_tp_3_1</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="806,-1057.69 806,-1962.65 1580,-1962.65 1580,-1057.69 806,-1057.69"/>
<text text-anchor="middle" x="1193" y="-1947.45" font-family="Times,serif" font-size="14.00">TP Group 1 (GPU 9)</text>
</g>
<g id="clust24" class="cluster">
<title>cluster_tp_3_2</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1588,-1057.69 1588,-1962.65 2362,-1962.65 2362,-1057.69 1588,-1057.69"/>
<text text-anchor="middle" x="1975" y="-1947.45" font-family="Times,serif" font-size="14.00">TP Group 2 (GPU 10)</text>
</g>
<g id="clust25" class="cluster">
<title>cluster_tp_3_3</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="2370,-1057.69 2370,-1962.65 3144,-1962.65 3144,-1057.69 2370,-1057.69"/>
<text text-anchor="middle" x="2757" y="-1947.45" font-family="Times,serif" font-size="14.00">TP Group 3 (GPU 11)</text>
</g>
<g id="clust26" class="cluster">
<title>cluster_tp_3_4</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="3152,-1057.69 3152,-1962.65 3926,-1962.65 3926,-1057.69 3152,-1057.69"/>
<text text-anchor="middle" x="3539" y="-1947.45" font-family="Times,serif" font-size="14.00">TP Group 4 (GPU 12)</text>
</g>
<g id="clust27" class="cluster">
<title>cluster_tp_3_5</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="3934,-1057.69 3934,-1962.65 4708,-1962.65 4708,-1057.69 3934,-1057.69"/>
<text text-anchor="middle" x="4321" y="-1947.45" font-family="Times,serif" font-size="14.00">TP Group 5 (GPU 13)</text>
</g>
<g id="clust28" class="cluster">
<title>cluster_tp_3_6</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="4716,-1057.69 4716,-1962.65 5490,-1962.65 5490,-1057.69 4716,-1057.69"/>
<text text-anchor="middle" x="5103" y="-1947.45" font-family="Times,serif" font-size="14.00">TP Group 6 (GPU 14)</text>
</g>
<g id="clust29" class="cluster">
<title>cluster_tp_3_7</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="5498,-1057.69 5498,-1962.65 6272,-1962.65 6272,-1057.69 5498,-1057.69"/>
<text text-anchor="middle" x="5885" y="-1947.45" font-family="Times,serif" font-size="14.00">TP Group 7 (GPU 15)</text>
</g>
<g id="clust30" class="cluster">
<title>cluster_layer_4</title>
<path fill="none" stroke="black" d="M28,-88.74C28,-88.74 6268,-88.74 6268,-88.74 6274,-88.74 6280,-94.74 6280,-100.74 6280,-100.74 6280,-1020.69 6280,-1020.69 6280,-1026.69 6274,-1032.69 6268,-1032.69 6268,-1032.69 28,-1032.69 28,-1032.69 22,-1032.69 16,-1026.69 16,-1020.69 16,-1020.69 16,-100.74 16,-100.74 16,-94.74 22,-88.74 28,-88.74"/>
<text text-anchor="middle" x="3148" y="-1017.49" font-family="Times,serif" font-size="14.00">MoE Layer 4</text>
</g>
<g id="clust31" class="cluster">
<title>cluster_tp_4_0</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="24,-96.74 24,-1001.69 798,-1001.69 798,-96.74 24,-96.74"/>
<text text-anchor="middle" x="411" y="-986.49" font-family="Times,serif" font-size="14.00">TP Group 0 (GPU 8)</text>
</g>
<g id="clust32" class="cluster">
<title>cluster_tp_4_1</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="806,-96.74 806,-1001.69 1580,-1001.69 1580,-96.74 806,-96.74"/>
<text text-anchor="middle" x="1193" y="-986.49" font-family="Times,serif" font-size="14.00">TP Group 1 (GPU 9)</text>
</g>
<g id="clust33" class="cluster">
<title>cluster_tp_4_2</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1588,-96.74 1588,-1001.69 2362,-1001.69 2362,-96.74 1588,-96.74"/>
<text text-anchor="middle" x="1975" y="-986.49" font-family="Times,serif" font-size="14.00">TP Group 2 (GPU 10)</text>
</g>
<g id="clust34" class="cluster">
<title>cluster_tp_4_3</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="2370,-96.74 2370,-1001.69 3144,-1001.69 3144,-96.74 2370,-96.74"/>
<text text-anchor="middle" x="2757" y="-986.49" font-family="Times,serif" font-size="14.00">TP Group 3 (GPU 11)</text>
</g>
<g id="clust35" class="cluster">
<title>cluster_tp_4_4</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="3152,-96.74 3152,-1001.69 3926,-1001.69 3926,-96.74 3152,-96.74"/>
<text text-anchor="middle" x="3539" y="-986.49" font-family="Times,serif" font-size="14.00">TP Group 4 (GPU 12)</text>
</g>
<g id="clust36" class="cluster">
<title>cluster_tp_4_5</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="3934,-96.74 3934,-1001.69 4708,-1001.69 4708,-96.74 3934,-96.74"/>
<text text-anchor="middle" x="4321" y="-986.49" font-family="Times,serif" font-size="14.00">TP Group 5 (GPU 13)</text>
</g>
<g id="clust37" class="cluster">
<title>cluster_tp_4_6</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="4716,-96.74 4716,-1001.69 5490,-1001.69 5490,-96.74 4716,-96.74"/>
<text text-anchor="middle" x="5103" y="-986.49" font-family="Times,serif" font-size="14.00">TP Group 6 (GPU 14)</text>
</g>
<g id="clust38" class="cluster">
<title>cluster_tp_4_7</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="5498,-96.74 5498,-1001.69 6272,-1001.69 6272,-96.74 5498,-96.74"/>
<text text-anchor="middle" x="5885" y="-986.49" font-family="Times,serif" font-size="14.00">TP Group 7 (GPU 15)</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightblue" stroke="black" cx="2701" cy="-4151.38" rx="161.85" ry="26.74"/>
<text text-anchor="middle" x="2701" y="-4155.18" font-family="Arial" font-size="14.00">Input Tokens</text>
<text text-anchor="middle" x="2701" y="-4140.18" font-family="Arial" font-size="14.00">(Batch: 1024 tokens, Hidden: 8192)</text>
</g>
<!-- ln1_1_0 -->
<g id="node2" class="node">
<title>ln1_1_0</title>
<polygon fill="lightyellow" stroke="black" points="808.5,-4004.51 623.5,-4004.51 623.5,-3951.51 808.5,-3951.51 808.5,-4004.51"/>
<text text-anchor="middle" x="716" y="-3989.31" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="716" y="-3974.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="716" y="-3959.31" font-family="Arial" font-size="14.00">GPU: 0</text>
</g>
<!-- input&#45;&gt;ln1_1_0 -->
<g id="edge1" class="edge">
<title>input&#45;&gt;ln1_1_0</title>
<path fill="none" stroke="black" d="M2558.05,-4164C2097.93,-4164 685.17,-4164 685.17,-4164 685.17,-4164 685.17,-4014.66 685.17,-4014.66"/>
<polygon fill="black" stroke="black" points="688.67,-4014.65 685.17,-4004.66 681.67,-4014.66 688.67,-4014.65"/>
</g>
<!-- input&#45;&gt;ln1_1_0 -->
<g id="edge2" class="edge">
<title>input&#45;&gt;ln1_1_0</title>
<path fill="none" stroke="black" d="M2539,-4151C2070.44,-4151 746.83,-4151 746.83,-4151 746.83,-4151 746.83,-4014.66 746.83,-4014.66"/>
<polygon fill="black" stroke="black" points="750.33,-4014.66 746.83,-4004.66 743.33,-4014.66 750.33,-4014.66"/>
</g>
<!-- ln1_1_1 -->
<g id="node13" class="node">
<title>ln1_1_1</title>
<polygon fill="lightyellow" stroke="black" points="1587.5,-4004.51 1402.5,-4004.51 1402.5,-3951.51 1587.5,-3951.51 1587.5,-4004.51"/>
<text text-anchor="middle" x="1495" y="-3989.31" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="1495" y="-3974.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1495" y="-3959.31" font-family="Arial" font-size="14.00">GPU: 1</text>
</g>
<!-- input&#45;&gt;ln1_1_1 -->
<g id="edge60" class="edge">
<title>input&#45;&gt;ln1_1_1</title>
<path fill="none" stroke="black" d="M2564.12,-4137C2248.2,-4137 1495,-4137 1495,-4137 1495,-4137 1495,-4014.62 1495,-4014.62"/>
<polygon fill="black" stroke="black" points="1498.5,-4014.62 1495,-4004.62 1491.5,-4014.62 1498.5,-4014.62"/>
</g>
<!-- ln1_1_2 -->
<g id="node24" class="node">
<title>ln1_1_2</title>
<polygon fill="lightyellow" stroke="black" points="2325.5,-4004.51 2140.5,-4004.51 2140.5,-3951.51 2325.5,-3951.51 2325.5,-4004.51"/>
<text text-anchor="middle" x="2233" y="-3989.31" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="2233" y="-3974.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="2233" y="-3959.31" font-family="Arial" font-size="14.00">GPU: 2</text>
</g>
<!-- input&#45;&gt;ln1_1_2 -->
<g id="edge117" class="edge">
<title>input&#45;&gt;ln1_1_2</title>
<path fill="none" stroke="black" d="M2546.54,-4143.01C2546.54,-4108.38 2546.54,-3978 2546.54,-3978 2546.54,-3978 2335.8,-3978 2335.8,-3978"/>
<polygon fill="black" stroke="black" points="2335.8,-3974.5 2325.8,-3978 2335.8,-3981.5 2335.8,-3974.5"/>
</g>
<!-- ln1_1_3 -->
<g id="node35" class="node">
<title>ln1_1_3</title>
<polygon fill="lightyellow" stroke="black" points="2831.5,-4004.51 2646.5,-4004.51 2646.5,-3951.51 2831.5,-3951.51 2831.5,-4004.51"/>
<text text-anchor="middle" x="2739" y="-3989.31" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="2739" y="-3974.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="2739" y="-3959.31" font-family="Arial" font-size="14.00">GPU: 3</text>
</g>
<!-- input&#45;&gt;ln1_1_3 -->
<g id="edge174" class="edge">
<title>input&#45;&gt;ln1_1_3</title>
<path fill="none" stroke="black" d="M2739,-4125.05C2739,-4125.05 2739,-4014.59 2739,-4014.59"/>
<polygon fill="black" stroke="black" points="2742.5,-4014.59 2739,-4004.59 2735.5,-4014.59 2742.5,-4014.59"/>
</g>
<!-- ln1_1_4 -->
<g id="node46" class="node">
<title>ln1_1_4</title>
<polygon fill="lightyellow" stroke="black" points="3369.5,-4004.51 3184.5,-4004.51 3184.5,-3951.51 3369.5,-3951.51 3369.5,-4004.51"/>
<text text-anchor="middle" x="3277" y="-3989.31" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="3277" y="-3974.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="3277" y="-3959.31" font-family="Arial" font-size="14.00">GPU: 4</text>
</g>
<!-- input&#45;&gt;ln1_1_4 -->
<g id="edge231" class="edge">
<title>input&#45;&gt;ln1_1_4</title>
<path fill="none" stroke="black" d="M2853.96,-4142.54C2853.96,-4107.21 2853.96,-3978 2853.96,-3978 2853.96,-3978 3174.42,-3978 3174.42,-3978"/>
<polygon fill="black" stroke="black" points="3174.42,-3981.5 3184.42,-3978 3174.42,-3974.5 3174.42,-3981.5"/>
</g>
<!-- ln1_1_5 -->
<g id="node57" class="node">
<title>ln1_1_5</title>
<polygon fill="lightyellow" stroke="black" points="4151.5,-4004.51 3966.5,-4004.51 3966.5,-3951.51 4151.5,-3951.51 4151.5,-4004.51"/>
<text text-anchor="middle" x="4059" y="-3989.31" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="4059" y="-3974.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="4059" y="-3959.31" font-family="Arial" font-size="14.00">GPU: 5</text>
</g>
<!-- input&#45;&gt;ln1_1_5 -->
<g id="edge288" class="edge">
<title>input&#45;&gt;ln1_1_5</title>
<path fill="none" stroke="black" d="M2838.06,-4137C3182.86,-4137 4059,-4137 4059,-4137 4059,-4137 4059,-4014.62 4059,-4014.62"/>
<polygon fill="black" stroke="black" points="4062.5,-4014.62 4059,-4004.62 4055.5,-4014.62 4062.5,-4014.62"/>
</g>
<!-- ln1_1_6 -->
<g id="node68" class="node">
<title>ln1_1_6</title>
<polygon fill="lightyellow" stroke="black" points="4933.5,-4004.51 4748.5,-4004.51 4748.5,-3951.51 4933.5,-3951.51 4933.5,-4004.51"/>
<text text-anchor="middle" x="4841" y="-3989.31" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="4841" y="-3974.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="4841" y="-3959.31" font-family="Arial" font-size="14.00">GPU: 6</text>
</g>
<!-- input&#45;&gt;ln1_1_6 -->
<g id="edge345" class="edge">
<title>input&#45;&gt;ln1_1_6</title>
<path fill="none" stroke="black" d="M2863.16,-4151C3362.14,-4151 4841,-4151 4841,-4151 4841,-4151 4841,-4014.66 4841,-4014.66"/>
<polygon fill="black" stroke="black" points="4844.5,-4014.66 4841,-4004.66 4837.5,-4014.66 4844.5,-4014.66"/>
</g>
<!-- ln1_1_7 -->
<g id="node79" class="node">
<title>ln1_1_7</title>
<polygon fill="lightyellow" stroke="black" points="5715.5,-4004.51 5530.5,-4004.51 5530.5,-3951.51 5715.5,-3951.51 5715.5,-4004.51"/>
<text text-anchor="middle" x="5623" y="-3989.31" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="5623" y="-3974.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5623" y="-3959.31" font-family="Arial" font-size="14.00">GPU: 7</text>
</g>
<!-- input&#45;&gt;ln1_1_7 -->
<g id="edge402" class="edge">
<title>input&#45;&gt;ln1_1_7</title>
<path fill="none" stroke="black" d="M2844.41,-4164C3431.8,-4164 5623,-4164 5623,-4164 5623,-4164 5623,-4014.66 5623,-4014.66"/>
<polygon fill="black" stroke="black" points="5626.5,-4014.65 5623,-4004.66 5619.5,-4014.66 5626.5,-4014.65"/>
</g>
<!-- attn_1_0 -->
<g id="node3" class="node">
<title>attn_1_0</title>
<polygon fill="lightgreen" stroke="black" points="797,-3914.51 585,-3914.51 585,-3861.51 797,-3861.51 797,-3914.51"/>
<text text-anchor="middle" x="691" y="-3899.31" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="691" y="-3884.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="691" y="-3869.31" font-family="Arial" font-size="14.00">GPU: 0</text>
</g>
<!-- ln1_1_0&#45;&gt;attn_1_0 -->
<g id="edge3" class="edge">
<title>ln1_1_0&#45;&gt;attn_1_0</title>
<path fill="none" stroke="black" d="M710.25,-3951.49C710.25,-3951.49 710.25,-3924.64 710.25,-3924.64"/>
<polygon fill="black" stroke="black" points="713.75,-3924.64 710.25,-3914.64 706.75,-3924.64 713.75,-3924.64"/>
</g>
<!-- residual1_1_0 -->
<g id="node4" class="node">
<title>residual1_1_0</title>
<polygon fill="lightcoral" stroke="black" points="592,-3824.51 407,-3771.51 592,-3718.51 777,-3771.51 592,-3824.51"/>
<text text-anchor="middle" x="592" y="-3782.81" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="592" y="-3767.81" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="592" y="-3752.81" font-family="Arial" font-size="14.00">GPU: 0</text>
</g>
<!-- attn_1_0&#45;&gt;residual1_1_0 -->
<g id="edge4" class="edge">
<title>attn_1_0&#45;&gt;residual1_1_0</title>
<path fill="none" stroke="black" d="M681,-3861.28C681,-3861.28 681,-3809.33 681,-3809.33"/>
<polygon fill="black" stroke="black" points="684.5,-3809.33 681,-3799.33 677.5,-3809.33 684.5,-3809.33"/>
</g>
<!-- gate_1_0 -->
<g id="node5" class="node">
<title>gate_1_0</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="612.5,-3681.51 439.5,-3681.51 439.5,-3613.51 612.5,-3613.51 612.5,-3681.51"/>
<text text-anchor="middle" x="526" y="-3666.31" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="526" y="-3651.31" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="526" y="-3636.31" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="526" y="-3621.31" font-family="Arial" font-size="14.00">GPU: 0</text>
</g>
<!-- residual1_1_0&#45;&gt;gate_1_0 -->
<g id="edge5" class="edge">
<title>residual1_1_0&#45;&gt;gate_1_0</title>
<path fill="none" stroke="black" d="M526,-3737.29C526,-3737.29 526,-3691.61 526,-3691.61"/>
<polygon fill="black" stroke="black" points="529.5,-3691.61 526,-3681.61 522.5,-3691.61 529.5,-3691.61"/>
</g>
<!-- expert_1_0_0 -->
<g id="node6" class="node">
<title>expert_1_0_0</title>
<polygon fill="lightpink" stroke="black" points="226,-3566.51 50,-3566.51 50,-3498.51 226,-3498.51 226,-3566.51"/>
<text text-anchor="middle" x="138" y="-3551.31" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="138" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="138" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="138" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 0</text>
</g>
<!-- gate_1_0&#45;&gt;expert_1_0_0 -->
<g id="edge6" class="edge">
<title>gate_1_0&#45;&gt;expert_1_0_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M439.41,-3658C325.06,-3658 138,-3658 138,-3658 138,-3658 138,-3576.8 138,-3576.8"/>
<polygon fill="black" stroke="black" points="141.5,-3576.8 138,-3566.8 134.5,-3576.8 141.5,-3576.8"/>
<text text-anchor="middle" x="224" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_0_1 -->
<g id="node7" class="node">
<title>expert_1_0_1</title>
<polygon fill="lightpink" stroke="black" points="420,-3566.51 244,-3566.51 244,-3498.51 420,-3498.51 420,-3566.51"/>
<text text-anchor="middle" x="332" y="-3551.31" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="332" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="332" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="332" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 0</text>
</g>
<!-- gate_1_0&#45;&gt;expert_1_0_1 -->
<g id="edge7" class="edge">
<title>gate_1_0&#45;&gt;expert_1_0_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M439.31,-3636C424.35,-3636 413.5,-3636 413.5,-3636 413.5,-3636 413.5,-3576.68 413.5,-3576.68"/>
<polygon fill="black" stroke="black" points="417,-3576.68 413.5,-3566.68 410,-3576.68 417,-3576.68"/>
<text text-anchor="middle" x="418" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_0_2 -->
<g id="node8" class="node">
<title>expert_1_0_2</title>
<polygon fill="lightpink" stroke="black" points="614,-3566.51 438,-3566.51 438,-3498.51 614,-3498.51 614,-3566.51"/>
<text text-anchor="middle" x="526" y="-3551.31" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="526" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="526" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="526" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 0</text>
</g>
<!-- gate_1_0&#45;&gt;expert_1_0_2 -->
<g id="edge8" class="edge">
<title>gate_1_0&#45;&gt;expert_1_0_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M526,-3613.31C526,-3613.31 526,-3576.77 526,-3576.77"/>
<polygon fill="black" stroke="black" points="529.5,-3576.77 526,-3566.77 522.5,-3576.77 529.5,-3576.77"/>
<text text-anchor="middle" x="541" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_0_3 -->
<g id="node9" class="node">
<title>expert_1_0_3</title>
<polygon fill="lightpink" stroke="black" points="808,-3566.51 632,-3566.51 632,-3498.51 808,-3498.51 808,-3566.51"/>
<text text-anchor="middle" x="720" y="-3551.31" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="720" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="720" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="720" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 0</text>
</g>
<!-- gate_1_0&#45;&gt;expert_1_0_3 -->
<g id="edge9" class="edge">
<title>gate_1_0&#45;&gt;expert_1_0_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M612.64,-3630C658.11,-3630 704.5,-3630 704.5,-3630 704.5,-3630 704.5,-3576.61 704.5,-3576.61"/>
<polygon fill="black" stroke="black" points="708,-3576.61 704.5,-3566.61 701,-3576.61 708,-3576.61"/>
<text text-anchor="middle" x="664" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_1_0 -->
<g id="node10" class="node">
<title>expert_agg_1_0</title>
<polygon fill="lightsteelblue" stroke="black" points="462.5,-3461.51 277.5,-3461.51 277.5,-3393.51 462.5,-3393.51 462.5,-3461.51"/>
<text text-anchor="middle" x="370" y="-3446.31" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="370" y="-3431.31" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="370" y="-3416.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="370" y="-3401.31" font-family="Arial" font-size="14.00">GPU: 0</text>
</g>
<!-- expert_1_0_0&#45;&gt;expert_agg_1_0 -->
<g id="edge10" class="edge">
<title>expert_1_0_0&#45;&gt;expert_agg_1_0</title>
<path fill="none" stroke="black" d="M205.5,-3498.25C205.5,-3467.44 205.5,-3427 205.5,-3427 205.5,-3427 267.17,-3427 267.17,-3427"/>
<polygon fill="black" stroke="black" points="267.17,-3430.5 277.17,-3427 267.17,-3423.5 267.17,-3430.5"/>
</g>
<!-- expert_1_0_1&#45;&gt;expert_agg_1_0 -->
<g id="edge11" class="edge">
<title>expert_1_0_1&#45;&gt;expert_agg_1_0</title>
<path fill="none" stroke="black" d="M348.75,-3498.42C348.75,-3498.42 348.75,-3471.79 348.75,-3471.79"/>
<polygon fill="black" stroke="black" points="352.25,-3471.79 348.75,-3461.79 345.25,-3471.79 352.25,-3471.79"/>
</g>
<!-- expert_1_0_2&#45;&gt;expert_agg_1_0 -->
<g id="edge12" class="edge">
<title>expert_1_0_2&#45;&gt;expert_agg_1_0</title>
<path fill="none" stroke="black" d="M450.25,-3498.42C450.25,-3498.42 450.25,-3471.79 450.25,-3471.79"/>
<polygon fill="black" stroke="black" points="453.75,-3471.79 450.25,-3461.79 446.75,-3471.79 453.75,-3471.79"/>
</g>
<!-- expert_1_0_3&#45;&gt;expert_agg_1_0 -->
<g id="edge13" class="edge">
<title>expert_1_0_3&#45;&gt;expert_agg_1_0</title>
<path fill="none" stroke="black" d="M749.33,-3498.39C749.33,-3471.32 749.33,-3438 749.33,-3438 749.33,-3438 472.8,-3438 472.8,-3438"/>
<polygon fill="black" stroke="black" points="472.8,-3434.5 462.8,-3438 472.8,-3441.5 472.8,-3434.5"/>
</g>
<!-- residual2_1_0 -->
<g id="node11" class="node">
<title>residual2_1_0</title>
<polygon fill="lightcoral" stroke="black" points="370,-3356.51 185,-3303.51 370,-3250.51 555,-3303.51 370,-3356.51"/>
<text text-anchor="middle" x="370" y="-3314.81" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="370" y="-3299.81" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="370" y="-3284.81" font-family="Arial" font-size="14.00">GPU: 0</text>
</g>
<!-- expert_agg_1_0&#45;&gt;residual2_1_0 -->
<g id="edge14" class="edge">
<title>expert_agg_1_0&#45;&gt;residual2_1_0</title>
<path fill="none" stroke="black" d="M370,-3393.29C370,-3393.29 370,-3366.68 370,-3366.68"/>
<polygon fill="black" stroke="black" points="373.5,-3366.68 370,-3356.68 366.5,-3366.68 373.5,-3366.68"/>
</g>
<!-- allreduce_1_0 -->
<g id="node12" class="node">
<title>allreduce_1_0</title>
<ellipse fill="yellow" stroke="black" cx="370" cy="-3176.03" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="370" y="-3187.33" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="370" y="-3172.33" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="370" y="-3157.33" font-family="Arial" font-size="14.00">GPU: 0</text>
</g>
<!-- residual2_1_0&#45;&gt;allreduce_1_0 -->
<g id="edge15" class="edge">
<title>residual2_1_0&#45;&gt;allreduce_1_0</title>
<path fill="none" stroke="black" d="M370,-3250.18C370,-3250.18 370,-3223.64 370,-3223.64"/>
<polygon fill="black" stroke="black" points="373.5,-3223.64 370,-3213.64 366.5,-3223.64 373.5,-3223.64"/>
</g>
<!-- ln1_2_0 -->
<g id="node90" class="node">
<title>ln1_2_0</title>
<polygon fill="lightyellow" stroke="black" points="462.5,-3043.55 277.5,-3043.55 277.5,-2990.55 462.5,-2990.55 462.5,-3043.55"/>
<text text-anchor="middle" x="370" y="-3028.35" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="370" y="-3013.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="370" y="-2998.35" font-family="Arial" font-size="14.00">GPU: 0</text>
</g>
<!-- allreduce_1_0&#45;&gt;ln1_2_0 -->
<g id="edge16" class="edge">
<title>allreduce_1_0&#45;&gt;ln1_2_0</title>
<path fill="none" stroke="black" d="M370,-3138.35C370,-3138.35 370,-3054.02 370,-3054.02"/>
<polygon fill="black" stroke="black" points="373.5,-3054.02 370,-3044.02 366.5,-3054.02 373.5,-3054.02"/>
</g>
<!-- attn_1_1 -->
<g id="node14" class="node">
<title>attn_1_1</title>
<polygon fill="lightgreen" stroke="black" points="1503,-3914.51 1291,-3914.51 1291,-3861.51 1503,-3861.51 1503,-3914.51"/>
<text text-anchor="middle" x="1397" y="-3899.31" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="1397" y="-3884.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1397" y="-3869.31" font-family="Arial" font-size="14.00">GPU: 1</text>
</g>
<!-- ln1_1_1&#45;&gt;attn_1_1 -->
<g id="edge61" class="edge">
<title>ln1_1_1&#45;&gt;attn_1_1</title>
<path fill="none" stroke="black" d="M1452.75,-3951.49C1452.75,-3951.49 1452.75,-3924.64 1452.75,-3924.64"/>
<polygon fill="black" stroke="black" points="1456.25,-3924.64 1452.75,-3914.64 1449.25,-3924.64 1456.25,-3924.64"/>
</g>
<!-- residual1_1_1 -->
<g id="node15" class="node">
<title>residual1_1_1</title>
<polygon fill="lightcoral" stroke="black" points="1344,-3824.51 1159,-3771.51 1344,-3718.51 1529,-3771.51 1344,-3824.51"/>
<text text-anchor="middle" x="1344" y="-3782.81" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="1344" y="-3767.81" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1344" y="-3752.81" font-family="Arial" font-size="14.00">GPU: 1</text>
</g>
<!-- attn_1_1&#45;&gt;residual1_1_1 -->
<g id="edge62" class="edge">
<title>attn_1_1&#45;&gt;residual1_1_1</title>
<path fill="none" stroke="black" d="M1397,-3861.28C1397,-3861.28 1397,-3819.59 1397,-3819.59"/>
<polygon fill="black" stroke="black" points="1400.5,-3819.59 1397,-3809.59 1393.5,-3819.59 1400.5,-3819.59"/>
</g>
<!-- gate_1_1 -->
<g id="node16" class="node">
<title>gate_1_1</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="1394.5,-3681.51 1221.5,-3681.51 1221.5,-3613.51 1394.5,-3613.51 1394.5,-3681.51"/>
<text text-anchor="middle" x="1308" y="-3666.31" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="1308" y="-3651.31" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="1308" y="-3636.31" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="1308" y="-3621.31" font-family="Arial" font-size="14.00">GPU: 1</text>
</g>
<!-- residual1_1_1&#45;&gt;gate_1_1 -->
<g id="edge63" class="edge">
<title>residual1_1_1&#45;&gt;gate_1_1</title>
<path fill="none" stroke="black" d="M1308,-3728.49C1308,-3728.49 1308,-3691.86 1308,-3691.86"/>
<polygon fill="black" stroke="black" points="1311.5,-3691.86 1308,-3681.86 1304.5,-3691.86 1311.5,-3691.86"/>
</g>
<!-- expert_1_1_0 -->
<g id="node17" class="node">
<title>expert_1_1_0</title>
<polygon fill="lightpink" stroke="black" points="1008,-3566.51 832,-3566.51 832,-3498.51 1008,-3498.51 1008,-3566.51"/>
<text text-anchor="middle" x="920" y="-3551.31" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="920" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="920" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="920" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 1</text>
</g>
<!-- gate_1_1&#45;&gt;expert_1_1_0 -->
<g id="edge64" class="edge">
<title>gate_1_1&#45;&gt;expert_1_1_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1221.41,-3664C1107.06,-3664 920,-3664 920,-3664 920,-3664 920,-3576.71 920,-3576.71"/>
<polygon fill="black" stroke="black" points="923.5,-3576.71 920,-3566.71 916.5,-3576.71 923.5,-3576.71"/>
<text text-anchor="middle" x="1041" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_1_1 -->
<g id="node18" class="node">
<title>expert_1_1_1</title>
<polygon fill="lightpink" stroke="black" points="1202,-3566.51 1026,-3566.51 1026,-3498.51 1202,-3498.51 1202,-3566.51"/>
<text text-anchor="middle" x="1114" y="-3551.31" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1114" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="1114" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="1114" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 1</text>
</g>
<!-- gate_1_1&#45;&gt;expert_1_1_1 -->
<g id="edge65" class="edge">
<title>gate_1_1&#45;&gt;expert_1_1_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1221.19,-3647C1198.62,-3647 1180.5,-3647 1180.5,-3647 1180.5,-3647 1180.5,-3576.55 1180.5,-3576.55"/>
<polygon fill="black" stroke="black" points="1184,-3576.55 1180.5,-3566.55 1177,-3576.55 1184,-3576.55"/>
<text text-anchor="middle" x="1200" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_1_2 -->
<g id="node19" class="node">
<title>expert_1_1_2</title>
<polygon fill="lightpink" stroke="black" points="1396,-3566.51 1220,-3566.51 1220,-3498.51 1396,-3498.51 1396,-3566.51"/>
<text text-anchor="middle" x="1308" y="-3551.31" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="1308" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="1308" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="1308" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 1</text>
</g>
<!-- gate_1_1&#45;&gt;expert_1_1_2 -->
<g id="edge66" class="edge">
<title>gate_1_1&#45;&gt;expert_1_1_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1308,-3613.31C1308,-3613.31 1308,-3576.77 1308,-3576.77"/>
<polygon fill="black" stroke="black" points="1311.5,-3576.77 1308,-3566.77 1304.5,-3576.77 1311.5,-3576.77"/>
<text text-anchor="middle" x="1323" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_1_3 -->
<g id="node20" class="node">
<title>expert_1_1_3</title>
<polygon fill="lightpink" stroke="black" points="1590,-3566.51 1414,-3566.51 1414,-3498.51 1590,-3498.51 1590,-3566.51"/>
<text text-anchor="middle" x="1502" y="-3551.31" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1502" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="1502" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="1502" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 1</text>
</g>
<!-- gate_1_1&#45;&gt;expert_1_1_3 -->
<g id="edge67" class="edge">
<title>gate_1_1&#45;&gt;expert_1_1_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1394.54,-3630C1433.76,-3630 1471.5,-3630 1471.5,-3630 1471.5,-3630 1471.5,-3576.61 1471.5,-3576.61"/>
<polygon fill="black" stroke="black" points="1475,-3576.61 1471.5,-3566.61 1468,-3576.61 1475,-3576.61"/>
<text text-anchor="middle" x="1446" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_1_1 -->
<g id="node21" class="node">
<title>expert_agg_1_1</title>
<polygon fill="lightsteelblue" stroke="black" points="1244.5,-3461.51 1059.5,-3461.51 1059.5,-3393.51 1244.5,-3393.51 1244.5,-3461.51"/>
<text text-anchor="middle" x="1152" y="-3446.31" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1152" y="-3431.31" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="1152" y="-3416.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1152" y="-3401.31" font-family="Arial" font-size="14.00">GPU: 1</text>
</g>
<!-- expert_1_1_0&#45;&gt;expert_agg_1_1 -->
<g id="edge68" class="edge">
<title>expert_1_1_0&#45;&gt;expert_agg_1_1</title>
<path fill="none" stroke="black" d="M987.5,-3498.49C987.5,-3464.11 987.5,-3416 987.5,-3416 987.5,-3416 1049.17,-3416 1049.17,-3416"/>
<polygon fill="black" stroke="black" points="1049.17,-3419.5 1059.17,-3416 1049.17,-3412.5 1049.17,-3419.5"/>
</g>
<!-- expert_1_1_1&#45;&gt;expert_agg_1_1 -->
<g id="edge69" class="edge">
<title>expert_1_1_1&#45;&gt;expert_agg_1_1</title>
<path fill="none" stroke="black" d="M1130.75,-3498.42C1130.75,-3498.42 1130.75,-3471.79 1130.75,-3471.79"/>
<polygon fill="black" stroke="black" points="1134.25,-3471.79 1130.75,-3461.79 1127.25,-3471.79 1134.25,-3471.79"/>
</g>
<!-- expert_1_1_2&#45;&gt;expert_agg_1_1 -->
<g id="edge70" class="edge">
<title>expert_1_1_2&#45;&gt;expert_agg_1_1</title>
<path fill="none" stroke="black" d="M1232.25,-3498.42C1232.25,-3498.42 1232.25,-3471.79 1232.25,-3471.79"/>
<polygon fill="black" stroke="black" points="1235.75,-3471.79 1232.25,-3461.79 1228.75,-3471.79 1235.75,-3471.79"/>
</g>
<!-- expert_1_1_3&#45;&gt;expert_agg_1_1 -->
<g id="edge71" class="edge">
<title>expert_1_1_3&#45;&gt;expert_agg_1_1</title>
<path fill="none" stroke="black" d="M1531.33,-3498.39C1531.33,-3471.32 1531.33,-3438 1531.33,-3438 1531.33,-3438 1254.8,-3438 1254.8,-3438"/>
<polygon fill="black" stroke="black" points="1254.8,-3434.5 1244.8,-3438 1254.8,-3441.5 1254.8,-3434.5"/>
</g>
<!-- residual2_1_1 -->
<g id="node22" class="node">
<title>residual2_1_1</title>
<polygon fill="lightcoral" stroke="black" points="1152,-3356.51 967,-3303.51 1152,-3250.51 1337,-3303.51 1152,-3356.51"/>
<text text-anchor="middle" x="1152" y="-3314.81" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1152" y="-3299.81" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1152" y="-3284.81" font-family="Arial" font-size="14.00">GPU: 1</text>
</g>
<!-- expert_agg_1_1&#45;&gt;residual2_1_1 -->
<g id="edge72" class="edge">
<title>expert_agg_1_1&#45;&gt;residual2_1_1</title>
<path fill="none" stroke="black" d="M1152,-3393.29C1152,-3393.29 1152,-3366.68 1152,-3366.68"/>
<polygon fill="black" stroke="black" points="1155.5,-3366.68 1152,-3356.68 1148.5,-3366.68 1155.5,-3366.68"/>
</g>
<!-- allreduce_1_1 -->
<g id="node23" class="node">
<title>allreduce_1_1</title>
<ellipse fill="yellow" stroke="black" cx="1152" cy="-3176.03" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="1152" y="-3187.33" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1152" y="-3172.33" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="1152" y="-3157.33" font-family="Arial" font-size="14.00">GPU: 1</text>
</g>
<!-- residual2_1_1&#45;&gt;allreduce_1_1 -->
<g id="edge73" class="edge">
<title>residual2_1_1&#45;&gt;allreduce_1_1</title>
<path fill="none" stroke="black" d="M1152,-3250.18C1152,-3250.18 1152,-3223.64 1152,-3223.64"/>
<polygon fill="black" stroke="black" points="1155.5,-3223.64 1152,-3213.64 1148.5,-3223.64 1155.5,-3223.64"/>
</g>
<!-- ln1_2_1 -->
<g id="node101" class="node">
<title>ln1_2_1</title>
<polygon fill="lightyellow" stroke="black" points="1244.5,-3043.55 1059.5,-3043.55 1059.5,-2990.55 1244.5,-2990.55 1244.5,-3043.55"/>
<text text-anchor="middle" x="1152" y="-3028.35" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="1152" y="-3013.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1152" y="-2998.35" font-family="Arial" font-size="14.00">GPU: 1</text>
</g>
<!-- allreduce_1_1&#45;&gt;ln1_2_1 -->
<g id="edge74" class="edge">
<title>allreduce_1_1&#45;&gt;ln1_2_1</title>
<path fill="none" stroke="black" d="M1152,-3138.35C1152,-3138.35 1152,-3054.02 1152,-3054.02"/>
<polygon fill="black" stroke="black" points="1155.5,-3054.02 1152,-3044.02 1148.5,-3054.02 1155.5,-3054.02"/>
</g>
<!-- attn_1_2 -->
<g id="node25" class="node">
<title>attn_1_2</title>
<polygon fill="lightgreen" stroke="black" points="2284,-3914.51 2072,-3914.51 2072,-3861.51 2284,-3861.51 2284,-3914.51"/>
<text text-anchor="middle" x="2178" y="-3899.31" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="2178" y="-3884.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="2178" y="-3869.31" font-family="Arial" font-size="14.00">GPU: 2</text>
</g>
<!-- ln1_1_2&#45;&gt;attn_1_2 -->
<g id="edge118" class="edge">
<title>ln1_1_2&#45;&gt;attn_1_2</title>
<path fill="none" stroke="black" d="M2212.25,-3951.49C2212.25,-3951.49 2212.25,-3924.64 2212.25,-3924.64"/>
<polygon fill="black" stroke="black" points="2215.75,-3924.64 2212.25,-3914.64 2208.75,-3924.64 2215.75,-3924.64"/>
</g>
<!-- residual1_1_2 -->
<g id="node26" class="node">
<title>residual1_1_2</title>
<polygon fill="lightcoral" stroke="black" points="2156,-3824.51 1971,-3771.51 2156,-3718.51 2341,-3771.51 2156,-3824.51"/>
<text text-anchor="middle" x="2156" y="-3782.81" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="2156" y="-3767.81" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="2156" y="-3752.81" font-family="Arial" font-size="14.00">GPU: 2</text>
</g>
<!-- attn_1_2&#45;&gt;residual1_1_2 -->
<g id="edge119" class="edge">
<title>attn_1_2&#45;&gt;residual1_1_2</title>
<path fill="none" stroke="black" d="M2178,-3861.28C2178,-3861.28 2178,-3828.22 2178,-3828.22"/>
<polygon fill="black" stroke="black" points="2181.5,-3828.22 2178,-3818.22 2174.5,-3828.22 2181.5,-3828.22"/>
</g>
<!-- gate_1_2 -->
<g id="node27" class="node">
<title>gate_1_2</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="2176.5,-3681.51 2003.5,-3681.51 2003.5,-3613.51 2176.5,-3613.51 2176.5,-3681.51"/>
<text text-anchor="middle" x="2090" y="-3666.31" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="2090" y="-3651.31" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="2090" y="-3636.31" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="2090" y="-3621.31" font-family="Arial" font-size="14.00">GPU: 2</text>
</g>
<!-- residual1_1_2&#45;&gt;gate_1_2 -->
<g id="edge120" class="edge">
<title>residual1_1_2&#45;&gt;gate_1_2</title>
<path fill="none" stroke="black" d="M2090,-3737.29C2090,-3737.29 2090,-3691.61 2090,-3691.61"/>
<polygon fill="black" stroke="black" points="2093.5,-3691.61 2090,-3681.61 2086.5,-3691.61 2093.5,-3691.61"/>
</g>
<!-- expert_1_2_0 -->
<g id="node28" class="node">
<title>expert_1_2_0</title>
<polygon fill="lightpink" stroke="black" points="1790,-3566.51 1614,-3566.51 1614,-3498.51 1790,-3498.51 1790,-3566.51"/>
<text text-anchor="middle" x="1702" y="-3551.31" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="1702" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="1702" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="1702" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 2</text>
</g>
<!-- gate_1_2&#45;&gt;expert_1_2_0 -->
<g id="edge121" class="edge">
<title>gate_1_2&#45;&gt;expert_1_2_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2003.41,-3664C1889.06,-3664 1702,-3664 1702,-3664 1702,-3664 1702,-3576.71 1702,-3576.71"/>
<polygon fill="black" stroke="black" points="1705.5,-3576.71 1702,-3566.71 1698.5,-3576.71 1705.5,-3576.71"/>
<text text-anchor="middle" x="1823" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_2_1 -->
<g id="node29" class="node">
<title>expert_1_2_1</title>
<polygon fill="lightpink" stroke="black" points="1984,-3566.51 1808,-3566.51 1808,-3498.51 1984,-3498.51 1984,-3566.51"/>
<text text-anchor="middle" x="1896" y="-3551.31" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1896" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="1896" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="1896" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 2</text>
</g>
<!-- gate_1_2&#45;&gt;expert_1_2_1 -->
<g id="edge122" class="edge">
<title>gate_1_2&#45;&gt;expert_1_2_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2003.31,-3647C1988.35,-3647 1977.5,-3647 1977.5,-3647 1977.5,-3647 1977.5,-3576.55 1977.5,-3576.55"/>
<polygon fill="black" stroke="black" points="1981,-3576.55 1977.5,-3566.55 1974,-3576.55 1981,-3576.55"/>
<text text-anchor="middle" x="1982" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_2_2 -->
<g id="node30" class="node">
<title>expert_1_2_2</title>
<polygon fill="lightpink" stroke="black" points="2178,-3566.51 2002,-3566.51 2002,-3498.51 2178,-3498.51 2178,-3566.51"/>
<text text-anchor="middle" x="2090" y="-3551.31" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2090" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="2090" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="2090" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 2</text>
</g>
<!-- gate_1_2&#45;&gt;expert_1_2_2 -->
<g id="edge123" class="edge">
<title>gate_1_2&#45;&gt;expert_1_2_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2090,-3613.31C2090,-3613.31 2090,-3576.77 2090,-3576.77"/>
<polygon fill="black" stroke="black" points="2093.5,-3576.77 2090,-3566.77 2086.5,-3576.77 2093.5,-3576.77"/>
<text text-anchor="middle" x="2105" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_2_3 -->
<g id="node31" class="node">
<title>expert_1_2_3</title>
<polygon fill="lightpink" stroke="black" points="2372,-3566.51 2196,-3566.51 2196,-3498.51 2372,-3498.51 2372,-3566.51"/>
<text text-anchor="middle" x="2284" y="-3551.31" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2284" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="2284" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="2284" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 2</text>
</g>
<!-- gate_1_2&#45;&gt;expert_1_2_3 -->
<g id="edge124" class="edge">
<title>gate_1_2&#45;&gt;expert_1_2_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2176.64,-3636C2222.11,-3636 2268.5,-3636 2268.5,-3636 2268.5,-3636 2268.5,-3576.68 2268.5,-3576.68"/>
<polygon fill="black" stroke="black" points="2272,-3576.68 2268.5,-3566.68 2265,-3576.68 2272,-3576.68"/>
<text text-anchor="middle" x="2228" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_1_2 -->
<g id="node32" class="node">
<title>expert_agg_1_2</title>
<polygon fill="lightsteelblue" stroke="black" points="2026.5,-3461.51 1841.5,-3461.51 1841.5,-3393.51 2026.5,-3393.51 2026.5,-3461.51"/>
<text text-anchor="middle" x="1934" y="-3446.31" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1934" y="-3431.31" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="1934" y="-3416.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1934" y="-3401.31" font-family="Arial" font-size="14.00">GPU: 2</text>
</g>
<!-- expert_1_2_0&#45;&gt;expert_agg_1_2 -->
<g id="edge125" class="edge">
<title>expert_1_2_0&#45;&gt;expert_agg_1_2</title>
<path fill="none" stroke="black" d="M1769.5,-3498.49C1769.5,-3464.11 1769.5,-3416 1769.5,-3416 1769.5,-3416 1831.17,-3416 1831.17,-3416"/>
<polygon fill="black" stroke="black" points="1831.17,-3419.5 1841.17,-3416 1831.17,-3412.5 1831.17,-3419.5"/>
</g>
<!-- expert_1_2_1&#45;&gt;expert_agg_1_2 -->
<g id="edge126" class="edge">
<title>expert_1_2_1&#45;&gt;expert_agg_1_2</title>
<path fill="none" stroke="black" d="M1912.75,-3498.42C1912.75,-3498.42 1912.75,-3471.79 1912.75,-3471.79"/>
<polygon fill="black" stroke="black" points="1916.25,-3471.79 1912.75,-3461.79 1909.25,-3471.79 1916.25,-3471.79"/>
</g>
<!-- expert_1_2_2&#45;&gt;expert_agg_1_2 -->
<g id="edge127" class="edge">
<title>expert_1_2_2&#45;&gt;expert_agg_1_2</title>
<path fill="none" stroke="black" d="M2014.25,-3498.42C2014.25,-3498.42 2014.25,-3471.79 2014.25,-3471.79"/>
<polygon fill="black" stroke="black" points="2017.75,-3471.79 2014.25,-3461.79 2010.75,-3471.79 2017.75,-3471.79"/>
</g>
<!-- expert_1_2_3&#45;&gt;expert_agg_1_2 -->
<g id="edge128" class="edge">
<title>expert_1_2_3&#45;&gt;expert_agg_1_2</title>
<path fill="none" stroke="black" d="M2313.33,-3498.39C2313.33,-3471.32 2313.33,-3438 2313.33,-3438 2313.33,-3438 2036.8,-3438 2036.8,-3438"/>
<polygon fill="black" stroke="black" points="2036.8,-3434.5 2026.8,-3438 2036.8,-3441.5 2036.8,-3434.5"/>
</g>
<!-- residual2_1_2 -->
<g id="node33" class="node">
<title>residual2_1_2</title>
<polygon fill="lightcoral" stroke="black" points="1934,-3356.51 1749,-3303.51 1934,-3250.51 2119,-3303.51 1934,-3356.51"/>
<text text-anchor="middle" x="1934" y="-3314.81" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1934" y="-3299.81" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1934" y="-3284.81" font-family="Arial" font-size="14.00">GPU: 2</text>
</g>
<!-- expert_agg_1_2&#45;&gt;residual2_1_2 -->
<g id="edge129" class="edge">
<title>expert_agg_1_2&#45;&gt;residual2_1_2</title>
<path fill="none" stroke="black" d="M1934,-3393.29C1934,-3393.29 1934,-3366.68 1934,-3366.68"/>
<polygon fill="black" stroke="black" points="1937.5,-3366.68 1934,-3356.68 1930.5,-3366.68 1937.5,-3366.68"/>
</g>
<!-- allreduce_1_2 -->
<g id="node34" class="node">
<title>allreduce_1_2</title>
<ellipse fill="yellow" stroke="black" cx="1934" cy="-3176.03" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="1934" y="-3187.33" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1934" y="-3172.33" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="1934" y="-3157.33" font-family="Arial" font-size="14.00">GPU: 2</text>
</g>
<!-- residual2_1_2&#45;&gt;allreduce_1_2 -->
<g id="edge130" class="edge">
<title>residual2_1_2&#45;&gt;allreduce_1_2</title>
<path fill="none" stroke="black" d="M1934,-3250.18C1934,-3250.18 1934,-3223.64 1934,-3223.64"/>
<polygon fill="black" stroke="black" points="1937.5,-3223.64 1934,-3213.64 1930.5,-3223.64 1937.5,-3223.64"/>
</g>
<!-- ln1_2_2 -->
<g id="node112" class="node">
<title>ln1_2_2</title>
<polygon fill="lightyellow" stroke="black" points="2026.5,-3043.55 1841.5,-3043.55 1841.5,-2990.55 2026.5,-2990.55 2026.5,-3043.55"/>
<text text-anchor="middle" x="1934" y="-3028.35" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="1934" y="-3013.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1934" y="-2998.35" font-family="Arial" font-size="14.00">GPU: 2</text>
</g>
<!-- allreduce_1_2&#45;&gt;ln1_2_2 -->
<g id="edge131" class="edge">
<title>allreduce_1_2&#45;&gt;ln1_2_2</title>
<path fill="none" stroke="black" d="M1934,-3138.35C1934,-3138.35 1934,-3054.02 1934,-3054.02"/>
<polygon fill="black" stroke="black" points="1937.5,-3054.02 1934,-3044.02 1930.5,-3054.02 1937.5,-3054.02"/>
</g>
<!-- attn_1_3 -->
<g id="node36" class="node">
<title>attn_1_3</title>
<polygon fill="lightgreen" stroke="black" points="2845,-3914.51 2633,-3914.51 2633,-3861.51 2845,-3861.51 2845,-3914.51"/>
<text text-anchor="middle" x="2739" y="-3899.31" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="2739" y="-3884.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="2739" y="-3869.31" font-family="Arial" font-size="14.00">GPU: 3</text>
</g>
<!-- ln1_1_3&#45;&gt;attn_1_3 -->
<g id="edge175" class="edge">
<title>ln1_1_3&#45;&gt;attn_1_3</title>
<path fill="none" stroke="black" d="M2739,-3951.49C2739,-3951.49 2739,-3924.64 2739,-3924.64"/>
<polygon fill="black" stroke="black" points="2742.5,-3924.64 2739,-3914.64 2735.5,-3924.64 2742.5,-3924.64"/>
</g>
<!-- residual1_1_3 -->
<g id="node37" class="node">
<title>residual1_1_3</title>
<polygon fill="lightcoral" stroke="black" points="2739,-3824.51 2554,-3771.51 2739,-3718.51 2924,-3771.51 2739,-3824.51"/>
<text text-anchor="middle" x="2739" y="-3782.81" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="2739" y="-3767.81" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="2739" y="-3752.81" font-family="Arial" font-size="14.00">GPU: 3</text>
</g>
<!-- attn_1_3&#45;&gt;residual1_1_3 -->
<g id="edge176" class="edge">
<title>attn_1_3&#45;&gt;residual1_1_3</title>
<path fill="none" stroke="black" d="M2739,-3861.28C2739,-3861.28 2739,-3834.75 2739,-3834.75"/>
<polygon fill="black" stroke="black" points="2742.5,-3834.75 2739,-3824.75 2735.5,-3834.75 2742.5,-3834.75"/>
</g>
<!-- gate_1_3 -->
<g id="node38" class="node">
<title>gate_1_3</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="2825.5,-3681.51 2652.5,-3681.51 2652.5,-3613.51 2825.5,-3613.51 2825.5,-3681.51"/>
<text text-anchor="middle" x="2739" y="-3666.31" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="2739" y="-3651.31" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="2739" y="-3636.31" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="2739" y="-3621.31" font-family="Arial" font-size="14.00">GPU: 3</text>
</g>
<!-- residual1_1_3&#45;&gt;gate_1_3 -->
<g id="edge177" class="edge">
<title>residual1_1_3&#45;&gt;gate_1_3</title>
<path fill="none" stroke="black" d="M2739,-3718.2C2739,-3718.2 2739,-3691.78 2739,-3691.78"/>
<polygon fill="black" stroke="black" points="2742.5,-3691.78 2739,-3681.78 2735.5,-3691.78 2742.5,-3691.78"/>
</g>
<!-- expert_1_3_0 -->
<g id="node39" class="node">
<title>expert_1_3_0</title>
<polygon fill="lightpink" stroke="black" points="2572,-3566.51 2396,-3566.51 2396,-3498.51 2572,-3498.51 2572,-3566.51"/>
<text text-anchor="middle" x="2484" y="-3551.31" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="2484" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="2484" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="2484" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 3</text>
</g>
<!-- gate_1_3&#45;&gt;expert_1_3_0 -->
<g id="edge178" class="edge">
<title>gate_1_3&#45;&gt;expert_1_3_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2652.29,-3658C2607.86,-3658 2563,-3658 2563,-3658 2563,-3658 2563,-3576.8 2563,-3576.8"/>
<polygon fill="black" stroke="black" points="2566.5,-3576.8 2563,-3566.8 2559.5,-3576.8 2566.5,-3576.8"/>
<text text-anchor="middle" x="2605" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_3_1 -->
<g id="node40" class="node">
<title>expert_1_3_1</title>
<polygon fill="lightpink" stroke="black" points="2766,-3566.51 2590,-3566.51 2590,-3498.51 2766,-3498.51 2766,-3566.51"/>
<text text-anchor="middle" x="2678" y="-3551.31" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="2678" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="2678" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="2678" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 3</text>
</g>
<!-- gate_1_3&#45;&gt;expert_1_3_1 -->
<g id="edge179" class="edge">
<title>gate_1_3&#45;&gt;expert_1_3_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2709.25,-3613.31C2709.25,-3613.31 2709.25,-3576.77 2709.25,-3576.77"/>
<polygon fill="black" stroke="black" points="2712.75,-3576.77 2709.25,-3566.77 2705.75,-3576.77 2712.75,-3576.77"/>
<text text-anchor="middle" x="2728" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_3_2 -->
<g id="node41" class="node">
<title>expert_1_3_2</title>
<polygon fill="lightpink" stroke="black" points="2960,-3566.51 2784,-3566.51 2784,-3498.51 2960,-3498.51 2960,-3566.51"/>
<text text-anchor="middle" x="2872" y="-3551.31" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2872" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="2872" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="2872" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 3</text>
</g>
<!-- gate_1_3&#45;&gt;expert_1_3_2 -->
<g id="edge180" class="edge">
<title>gate_1_3&#45;&gt;expert_1_3_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2804.75,-3613.31C2804.75,-3613.31 2804.75,-3576.77 2804.75,-3576.77"/>
<polygon fill="black" stroke="black" points="2808.25,-3576.77 2804.75,-3566.77 2801.25,-3576.77 2808.25,-3576.77"/>
<text text-anchor="middle" x="2851" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_3_3 -->
<g id="node42" class="node">
<title>expert_1_3_3</title>
<polygon fill="lightpink" stroke="black" points="3154,-3566.51 2978,-3566.51 2978,-3498.51 3154,-3498.51 3154,-3566.51"/>
<text text-anchor="middle" x="3066" y="-3551.31" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="3066" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="3066" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="3066" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 3</text>
</g>
<!-- gate_1_3&#45;&gt;expert_1_3_3 -->
<g id="edge181" class="edge">
<title>gate_1_3&#45;&gt;expert_1_3_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2825.77,-3658C2922.65,-3658 3066,-3658 3066,-3658 3066,-3658 3066,-3576.8 3066,-3576.8"/>
<polygon fill="black" stroke="black" points="3069.5,-3576.8 3066,-3566.8 3062.5,-3576.8 3069.5,-3576.8"/>
<text text-anchor="middle" x="3010" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_1_3 -->
<g id="node43" class="node">
<title>expert_agg_1_3</title>
<polygon fill="lightsteelblue" stroke="black" points="2808.5,-3461.51 2623.5,-3461.51 2623.5,-3393.51 2808.5,-3393.51 2808.5,-3461.51"/>
<text text-anchor="middle" x="2716" y="-3446.31" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="2716" y="-3431.31" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="2716" y="-3416.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="2716" y="-3401.31" font-family="Arial" font-size="14.00">GPU: 3</text>
</g>
<!-- expert_1_3_0&#45;&gt;expert_agg_1_3 -->
<g id="edge182" class="edge">
<title>expert_1_3_0&#45;&gt;expert_agg_1_3</title>
<path fill="none" stroke="black" d="M2551.5,-3498.49C2551.5,-3464.11 2551.5,-3416 2551.5,-3416 2551.5,-3416 2613.17,-3416 2613.17,-3416"/>
<polygon fill="black" stroke="black" points="2613.17,-3419.5 2623.17,-3416 2613.17,-3412.5 2613.17,-3419.5"/>
</g>
<!-- expert_1_3_1&#45;&gt;expert_agg_1_3 -->
<g id="edge183" class="edge">
<title>expert_1_3_1&#45;&gt;expert_agg_1_3</title>
<path fill="none" stroke="black" d="M2694.75,-3498.42C2694.75,-3498.42 2694.75,-3471.79 2694.75,-3471.79"/>
<polygon fill="black" stroke="black" points="2698.25,-3471.79 2694.75,-3461.79 2691.25,-3471.79 2698.25,-3471.79"/>
</g>
<!-- expert_1_3_2&#45;&gt;expert_agg_1_3 -->
<g id="edge184" class="edge">
<title>expert_1_3_2&#45;&gt;expert_agg_1_3</title>
<path fill="none" stroke="black" d="M2796.25,-3498.42C2796.25,-3498.42 2796.25,-3471.79 2796.25,-3471.79"/>
<polygon fill="black" stroke="black" points="2799.75,-3471.79 2796.25,-3461.79 2792.75,-3471.79 2799.75,-3471.79"/>
</g>
<!-- expert_1_3_3&#45;&gt;expert_agg_1_3 -->
<g id="edge185" class="edge">
<title>expert_1_3_3&#45;&gt;expert_agg_1_3</title>
<path fill="none" stroke="black" d="M3095.33,-3498.39C3095.33,-3471.32 3095.33,-3438 3095.33,-3438 3095.33,-3438 2818.8,-3438 2818.8,-3438"/>
<polygon fill="black" stroke="black" points="2818.8,-3434.5 2808.8,-3438 2818.8,-3441.5 2818.8,-3434.5"/>
</g>
<!-- residual2_1_3 -->
<g id="node44" class="node">
<title>residual2_1_3</title>
<polygon fill="lightcoral" stroke="black" points="2716,-3356.51 2531,-3303.51 2716,-3250.51 2901,-3303.51 2716,-3356.51"/>
<text text-anchor="middle" x="2716" y="-3314.81" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="2716" y="-3299.81" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="2716" y="-3284.81" font-family="Arial" font-size="14.00">GPU: 3</text>
</g>
<!-- expert_agg_1_3&#45;&gt;residual2_1_3 -->
<g id="edge186" class="edge">
<title>expert_agg_1_3&#45;&gt;residual2_1_3</title>
<path fill="none" stroke="black" d="M2716,-3393.29C2716,-3393.29 2716,-3366.68 2716,-3366.68"/>
<polygon fill="black" stroke="black" points="2719.5,-3366.68 2716,-3356.68 2712.5,-3366.68 2719.5,-3366.68"/>
</g>
<!-- allreduce_1_3 -->
<g id="node45" class="node">
<title>allreduce_1_3</title>
<ellipse fill="yellow" stroke="black" cx="2716" cy="-3176.03" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="2716" y="-3187.33" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="2716" y="-3172.33" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="2716" y="-3157.33" font-family="Arial" font-size="14.00">GPU: 3</text>
</g>
<!-- residual2_1_3&#45;&gt;allreduce_1_3 -->
<g id="edge187" class="edge">
<title>residual2_1_3&#45;&gt;allreduce_1_3</title>
<path fill="none" stroke="black" d="M2716,-3250.18C2716,-3250.18 2716,-3223.64 2716,-3223.64"/>
<polygon fill="black" stroke="black" points="2719.5,-3223.64 2716,-3213.64 2712.5,-3223.64 2719.5,-3223.64"/>
</g>
<!-- ln1_2_3 -->
<g id="node123" class="node">
<title>ln1_2_3</title>
<polygon fill="lightyellow" stroke="black" points="2808.5,-3043.55 2623.5,-3043.55 2623.5,-2990.55 2808.5,-2990.55 2808.5,-3043.55"/>
<text text-anchor="middle" x="2716" y="-3028.35" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="2716" y="-3013.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="2716" y="-2998.35" font-family="Arial" font-size="14.00">GPU: 3</text>
</g>
<!-- allreduce_1_3&#45;&gt;ln1_2_3 -->
<g id="edge188" class="edge">
<title>allreduce_1_3&#45;&gt;ln1_2_3</title>
<path fill="none" stroke="black" d="M2716,-3138.35C2716,-3138.35 2716,-3054.02 2716,-3054.02"/>
<polygon fill="black" stroke="black" points="2719.5,-3054.02 2716,-3044.02 2712.5,-3054.02 2719.5,-3054.02"/>
</g>
<!-- attn_1_4 -->
<g id="node47" class="node">
<title>attn_1_4</title>
<polygon fill="lightgreen" stroke="black" points="3478,-3914.51 3266,-3914.51 3266,-3861.51 3478,-3861.51 3478,-3914.51"/>
<text text-anchor="middle" x="3372" y="-3899.31" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="3372" y="-3884.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="3372" y="-3869.31" font-family="Arial" font-size="14.00">GPU: 4</text>
</g>
<!-- ln1_1_4&#45;&gt;attn_1_4 -->
<g id="edge232" class="edge">
<title>ln1_1_4&#45;&gt;attn_1_4</title>
<path fill="none" stroke="black" d="M3317.75,-3951.49C3317.75,-3951.49 3317.75,-3924.64 3317.75,-3924.64"/>
<polygon fill="black" stroke="black" points="3321.25,-3924.64 3317.75,-3914.64 3314.25,-3924.64 3321.25,-3924.64"/>
</g>
<!-- residual1_1_4 -->
<g id="node48" class="node">
<title>residual1_1_4</title>
<polygon fill="lightcoral" stroke="black" points="3394,-3824.51 3209,-3771.51 3394,-3718.51 3579,-3771.51 3394,-3824.51"/>
<text text-anchor="middle" x="3394" y="-3782.81" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="3394" y="-3767.81" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="3394" y="-3752.81" font-family="Arial" font-size="14.00">GPU: 4</text>
</g>
<!-- attn_1_4&#45;&gt;residual1_1_4 -->
<g id="edge233" class="edge">
<title>attn_1_4&#45;&gt;residual1_1_4</title>
<path fill="none" stroke="black" d="M3372,-3861.28C3372,-3861.28 3372,-3828.22 3372,-3828.22"/>
<polygon fill="black" stroke="black" points="3375.5,-3828.22 3372,-3818.22 3368.5,-3828.22 3375.5,-3828.22"/>
</g>
<!-- gate_1_4 -->
<g id="node49" class="node">
<title>gate_1_4</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="3546.5,-3681.51 3373.5,-3681.51 3373.5,-3613.51 3546.5,-3613.51 3546.5,-3681.51"/>
<text text-anchor="middle" x="3460" y="-3666.31" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="3460" y="-3651.31" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="3460" y="-3636.31" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="3460" y="-3621.31" font-family="Arial" font-size="14.00">GPU: 4</text>
</g>
<!-- residual1_1_4&#45;&gt;gate_1_4 -->
<g id="edge234" class="edge">
<title>residual1_1_4&#45;&gt;gate_1_4</title>
<path fill="none" stroke="black" d="M3460,-3737.29C3460,-3737.29 3460,-3691.61 3460,-3691.61"/>
<polygon fill="black" stroke="black" points="3463.5,-3691.61 3460,-3681.61 3456.5,-3691.61 3463.5,-3691.61"/>
</g>
<!-- expert_1_4_0 -->
<g id="node50" class="node">
<title>expert_1_4_0</title>
<polygon fill="lightpink" stroke="black" points="3354,-3566.51 3178,-3566.51 3178,-3498.51 3354,-3498.51 3354,-3566.51"/>
<text text-anchor="middle" x="3266" y="-3551.31" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="3266" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="3266" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="3266" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 4</text>
</g>
<!-- gate_1_4&#45;&gt;expert_1_4_0 -->
<g id="edge235" class="edge">
<title>gate_1_4&#45;&gt;expert_1_4_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3373.36,-3636C3327.89,-3636 3281.5,-3636 3281.5,-3636 3281.5,-3636 3281.5,-3576.68 3281.5,-3576.68"/>
<polygon fill="black" stroke="black" points="3285,-3576.68 3281.5,-3566.68 3278,-3576.68 3285,-3576.68"/>
<text text-anchor="middle" x="3351" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_4_1 -->
<g id="node51" class="node">
<title>expert_1_4_1</title>
<polygon fill="lightpink" stroke="black" points="3548,-3566.51 3372,-3566.51 3372,-3498.51 3548,-3498.51 3548,-3566.51"/>
<text text-anchor="middle" x="3460" y="-3551.31" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="3460" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="3460" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="3460" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 4</text>
</g>
<!-- gate_1_4&#45;&gt;expert_1_4_1 -->
<g id="edge236" class="edge">
<title>gate_1_4&#45;&gt;expert_1_4_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3460,-3613.31C3460,-3613.31 3460,-3576.77 3460,-3576.77"/>
<polygon fill="black" stroke="black" points="3463.5,-3576.77 3460,-3566.77 3456.5,-3576.77 3463.5,-3576.77"/>
<text text-anchor="middle" x="3475" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_4_2 -->
<g id="node52" class="node">
<title>expert_1_4_2</title>
<polygon fill="lightpink" stroke="black" points="3742,-3566.51 3566,-3566.51 3566,-3498.51 3742,-3498.51 3742,-3566.51"/>
<text text-anchor="middle" x="3654" y="-3551.31" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="3654" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="3654" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="3654" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 4</text>
</g>
<!-- gate_1_4&#45;&gt;expert_1_4_2 -->
<g id="edge237" class="edge">
<title>gate_1_4&#45;&gt;expert_1_4_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3546.69,-3630C3561.65,-3630 3572.5,-3630 3572.5,-3630 3572.5,-3630 3572.5,-3576.61 3572.5,-3576.61"/>
<polygon fill="black" stroke="black" points="3576,-3576.61 3572.5,-3566.61 3569,-3576.61 3576,-3576.61"/>
<text text-anchor="middle" x="3598" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_4_3 -->
<g id="node53" class="node">
<title>expert_1_4_3</title>
<polygon fill="lightpink" stroke="black" points="3936,-3566.51 3760,-3566.51 3760,-3498.51 3936,-3498.51 3936,-3566.51"/>
<text text-anchor="middle" x="3848" y="-3551.31" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="3848" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="3848" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="3848" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 4</text>
</g>
<!-- gate_1_4&#45;&gt;expert_1_4_3 -->
<g id="edge238" class="edge">
<title>gate_1_4&#45;&gt;expert_1_4_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3546.59,-3664C3660.94,-3664 3848,-3664 3848,-3664 3848,-3664 3848,-3576.71 3848,-3576.71"/>
<polygon fill="black" stroke="black" points="3851.5,-3576.71 3848,-3566.71 3844.5,-3576.71 3851.5,-3576.71"/>
<text text-anchor="middle" x="3757" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_1_4 -->
<g id="node54" class="node">
<title>expert_agg_1_4</title>
<polygon fill="lightsteelblue" stroke="black" points="3590.5,-3461.51 3405.5,-3461.51 3405.5,-3393.51 3590.5,-3393.51 3590.5,-3461.51"/>
<text text-anchor="middle" x="3498" y="-3446.31" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="3498" y="-3431.31" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="3498" y="-3416.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="3498" y="-3401.31" font-family="Arial" font-size="14.00">GPU: 4</text>
</g>
<!-- expert_1_4_0&#45;&gt;expert_agg_1_4 -->
<g id="edge239" class="edge">
<title>expert_1_4_0&#45;&gt;expert_agg_1_4</title>
<path fill="none" stroke="black" d="M3333.5,-3498.49C3333.5,-3464.11 3333.5,-3416 3333.5,-3416 3333.5,-3416 3395.17,-3416 3395.17,-3416"/>
<polygon fill="black" stroke="black" points="3395.17,-3419.5 3405.17,-3416 3395.17,-3412.5 3395.17,-3419.5"/>
</g>
<!-- expert_1_4_1&#45;&gt;expert_agg_1_4 -->
<g id="edge240" class="edge">
<title>expert_1_4_1&#45;&gt;expert_agg_1_4</title>
<path fill="none" stroke="black" d="M3476.75,-3498.42C3476.75,-3498.42 3476.75,-3471.79 3476.75,-3471.79"/>
<polygon fill="black" stroke="black" points="3480.25,-3471.79 3476.75,-3461.79 3473.25,-3471.79 3480.25,-3471.79"/>
</g>
<!-- expert_1_4_2&#45;&gt;expert_agg_1_4 -->
<g id="edge241" class="edge">
<title>expert_1_4_2&#45;&gt;expert_agg_1_4</title>
<path fill="none" stroke="black" d="M3578.25,-3498.42C3578.25,-3498.42 3578.25,-3471.79 3578.25,-3471.79"/>
<polygon fill="black" stroke="black" points="3581.75,-3471.79 3578.25,-3461.79 3574.75,-3471.79 3581.75,-3471.79"/>
</g>
<!-- expert_1_4_3&#45;&gt;expert_agg_1_4 -->
<g id="edge242" class="edge">
<title>expert_1_4_3&#45;&gt;expert_agg_1_4</title>
<path fill="none" stroke="black" d="M3877.33,-3498.39C3877.33,-3471.32 3877.33,-3438 3877.33,-3438 3877.33,-3438 3600.8,-3438 3600.8,-3438"/>
<polygon fill="black" stroke="black" points="3600.8,-3434.5 3590.8,-3438 3600.8,-3441.5 3600.8,-3434.5"/>
</g>
<!-- residual2_1_4 -->
<g id="node55" class="node">
<title>residual2_1_4</title>
<polygon fill="lightcoral" stroke="black" points="3498,-3356.51 3313,-3303.51 3498,-3250.51 3683,-3303.51 3498,-3356.51"/>
<text text-anchor="middle" x="3498" y="-3314.81" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="3498" y="-3299.81" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="3498" y="-3284.81" font-family="Arial" font-size="14.00">GPU: 4</text>
</g>
<!-- expert_agg_1_4&#45;&gt;residual2_1_4 -->
<g id="edge243" class="edge">
<title>expert_agg_1_4&#45;&gt;residual2_1_4</title>
<path fill="none" stroke="black" d="M3498,-3393.29C3498,-3393.29 3498,-3366.68 3498,-3366.68"/>
<polygon fill="black" stroke="black" points="3501.5,-3366.68 3498,-3356.68 3494.5,-3366.68 3501.5,-3366.68"/>
</g>
<!-- allreduce_1_4 -->
<g id="node56" class="node">
<title>allreduce_1_4</title>
<ellipse fill="yellow" stroke="black" cx="3498" cy="-3176.03" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="3498" y="-3187.33" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="3498" y="-3172.33" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="3498" y="-3157.33" font-family="Arial" font-size="14.00">GPU: 4</text>
</g>
<!-- residual2_1_4&#45;&gt;allreduce_1_4 -->
<g id="edge244" class="edge">
<title>residual2_1_4&#45;&gt;allreduce_1_4</title>
<path fill="none" stroke="black" d="M3498,-3250.18C3498,-3250.18 3498,-3223.64 3498,-3223.64"/>
<polygon fill="black" stroke="black" points="3501.5,-3223.64 3498,-3213.64 3494.5,-3223.64 3501.5,-3223.64"/>
</g>
<!-- ln1_2_4 -->
<g id="node134" class="node">
<title>ln1_2_4</title>
<polygon fill="lightyellow" stroke="black" points="3590.5,-3043.55 3405.5,-3043.55 3405.5,-2990.55 3590.5,-2990.55 3590.5,-3043.55"/>
<text text-anchor="middle" x="3498" y="-3028.35" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="3498" y="-3013.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="3498" y="-2998.35" font-family="Arial" font-size="14.00">GPU: 4</text>
</g>
<!-- allreduce_1_4&#45;&gt;ln1_2_4 -->
<g id="edge245" class="edge">
<title>allreduce_1_4&#45;&gt;ln1_2_4</title>
<path fill="none" stroke="black" d="M3498,-3138.35C3498,-3138.35 3498,-3054.02 3498,-3054.02"/>
<polygon fill="black" stroke="black" points="3501.5,-3054.02 3498,-3044.02 3494.5,-3054.02 3501.5,-3054.02"/>
</g>
<!-- attn_1_5 -->
<g id="node58" class="node">
<title>attn_1_5</title>
<polygon fill="lightgreen" stroke="black" points="4260,-3914.51 4048,-3914.51 4048,-3861.51 4260,-3861.51 4260,-3914.51"/>
<text text-anchor="middle" x="4154" y="-3899.31" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="4154" y="-3884.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="4154" y="-3869.31" font-family="Arial" font-size="14.00">GPU: 5</text>
</g>
<!-- ln1_1_5&#45;&gt;attn_1_5 -->
<g id="edge289" class="edge">
<title>ln1_1_5&#45;&gt;attn_1_5</title>
<path fill="none" stroke="black" d="M4099.75,-3951.49C4099.75,-3951.49 4099.75,-3924.64 4099.75,-3924.64"/>
<polygon fill="black" stroke="black" points="4103.25,-3924.64 4099.75,-3914.64 4096.25,-3924.64 4103.25,-3924.64"/>
</g>
<!-- residual1_1_5 -->
<g id="node59" class="node">
<title>residual1_1_5</title>
<polygon fill="lightcoral" stroke="black" points="4176,-3824.51 3991,-3771.51 4176,-3718.51 4361,-3771.51 4176,-3824.51"/>
<text text-anchor="middle" x="4176" y="-3782.81" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="4176" y="-3767.81" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="4176" y="-3752.81" font-family="Arial" font-size="14.00">GPU: 5</text>
</g>
<!-- attn_1_5&#45;&gt;residual1_1_5 -->
<g id="edge290" class="edge">
<title>attn_1_5&#45;&gt;residual1_1_5</title>
<path fill="none" stroke="black" d="M4154,-3861.28C4154,-3861.28 4154,-3828.22 4154,-3828.22"/>
<polygon fill="black" stroke="black" points="4157.5,-3828.22 4154,-3818.22 4150.5,-3828.22 4157.5,-3828.22"/>
</g>
<!-- gate_1_5 -->
<g id="node60" class="node">
<title>gate_1_5</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="4328.5,-3681.51 4155.5,-3681.51 4155.5,-3613.51 4328.5,-3613.51 4328.5,-3681.51"/>
<text text-anchor="middle" x="4242" y="-3666.31" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="4242" y="-3651.31" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="4242" y="-3636.31" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="4242" y="-3621.31" font-family="Arial" font-size="14.00">GPU: 5</text>
</g>
<!-- residual1_1_5&#45;&gt;gate_1_5 -->
<g id="edge291" class="edge">
<title>residual1_1_5&#45;&gt;gate_1_5</title>
<path fill="none" stroke="black" d="M4242,-3737.29C4242,-3737.29 4242,-3691.61 4242,-3691.61"/>
<polygon fill="black" stroke="black" points="4245.5,-3691.61 4242,-3681.61 4238.5,-3691.61 4245.5,-3691.61"/>
</g>
<!-- expert_1_5_0 -->
<g id="node61" class="node">
<title>expert_1_5_0</title>
<polygon fill="lightpink" stroke="black" points="4136,-3566.51 3960,-3566.51 3960,-3498.51 4136,-3498.51 4136,-3566.51"/>
<text text-anchor="middle" x="4048" y="-3551.31" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="4048" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="4048" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="4048" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 5</text>
</g>
<!-- gate_1_5&#45;&gt;expert_1_5_0 -->
<g id="edge292" class="edge">
<title>gate_1_5&#45;&gt;expert_1_5_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4155.36,-3647C4109.89,-3647 4063.5,-3647 4063.5,-3647 4063.5,-3647 4063.5,-3576.55 4063.5,-3576.55"/>
<polygon fill="black" stroke="black" points="4067,-3576.55 4063.5,-3566.55 4060,-3576.55 4067,-3576.55"/>
<text text-anchor="middle" x="4134" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_5_1 -->
<g id="node62" class="node">
<title>expert_1_5_1</title>
<polygon fill="lightpink" stroke="black" points="4330,-3566.51 4154,-3566.51 4154,-3498.51 4330,-3498.51 4330,-3566.51"/>
<text text-anchor="middle" x="4242" y="-3551.31" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="4242" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="4242" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="4242" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 5</text>
</g>
<!-- gate_1_5&#45;&gt;expert_1_5_1 -->
<g id="edge293" class="edge">
<title>gate_1_5&#45;&gt;expert_1_5_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4242,-3613.31C4242,-3613.31 4242,-3576.77 4242,-3576.77"/>
<polygon fill="black" stroke="black" points="4245.5,-3576.77 4242,-3566.77 4238.5,-3576.77 4245.5,-3576.77"/>
<text text-anchor="middle" x="4257" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_5_2 -->
<g id="node63" class="node">
<title>expert_1_5_2</title>
<polygon fill="lightpink" stroke="black" points="4524,-3566.51 4348,-3566.51 4348,-3498.51 4524,-3498.51 4524,-3566.51"/>
<text text-anchor="middle" x="4436" y="-3551.31" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="4436" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="4436" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="4436" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 5</text>
</g>
<!-- gate_1_5&#45;&gt;expert_1_5_2 -->
<g id="edge294" class="edge">
<title>gate_1_5&#45;&gt;expert_1_5_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4328.69,-3630C4343.65,-3630 4354.5,-3630 4354.5,-3630 4354.5,-3630 4354.5,-3576.61 4354.5,-3576.61"/>
<polygon fill="black" stroke="black" points="4358,-3576.61 4354.5,-3566.61 4351,-3576.61 4358,-3576.61"/>
<text text-anchor="middle" x="4380" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_5_3 -->
<g id="node64" class="node">
<title>expert_1_5_3</title>
<polygon fill="lightpink" stroke="black" points="4718,-3566.51 4542,-3566.51 4542,-3498.51 4718,-3498.51 4718,-3566.51"/>
<text text-anchor="middle" x="4630" y="-3551.31" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="4630" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="4630" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="4630" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 5</text>
</g>
<!-- gate_1_5&#45;&gt;expert_1_5_3 -->
<g id="edge295" class="edge">
<title>gate_1_5&#45;&gt;expert_1_5_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4328.59,-3664C4442.94,-3664 4630,-3664 4630,-3664 4630,-3664 4630,-3576.71 4630,-3576.71"/>
<polygon fill="black" stroke="black" points="4633.5,-3576.71 4630,-3566.71 4626.5,-3576.71 4633.5,-3576.71"/>
<text text-anchor="middle" x="4539" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_1_5 -->
<g id="node65" class="node">
<title>expert_agg_1_5</title>
<polygon fill="lightsteelblue" stroke="black" points="4372.5,-3461.51 4187.5,-3461.51 4187.5,-3393.51 4372.5,-3393.51 4372.5,-3461.51"/>
<text text-anchor="middle" x="4280" y="-3446.31" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="4280" y="-3431.31" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="4280" y="-3416.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="4280" y="-3401.31" font-family="Arial" font-size="14.00">GPU: 5</text>
</g>
<!-- expert_1_5_0&#45;&gt;expert_agg_1_5 -->
<g id="edge296" class="edge">
<title>expert_1_5_0&#45;&gt;expert_agg_1_5</title>
<path fill="none" stroke="black" d="M4115.5,-3498.49C4115.5,-3464.11 4115.5,-3416 4115.5,-3416 4115.5,-3416 4177.17,-3416 4177.17,-3416"/>
<polygon fill="black" stroke="black" points="4177.17,-3419.5 4187.17,-3416 4177.17,-3412.5 4177.17,-3419.5"/>
</g>
<!-- expert_1_5_1&#45;&gt;expert_agg_1_5 -->
<g id="edge297" class="edge">
<title>expert_1_5_1&#45;&gt;expert_agg_1_5</title>
<path fill="none" stroke="black" d="M4258.75,-3498.42C4258.75,-3498.42 4258.75,-3471.79 4258.75,-3471.79"/>
<polygon fill="black" stroke="black" points="4262.25,-3471.79 4258.75,-3461.79 4255.25,-3471.79 4262.25,-3471.79"/>
</g>
<!-- expert_1_5_2&#45;&gt;expert_agg_1_5 -->
<g id="edge298" class="edge">
<title>expert_1_5_2&#45;&gt;expert_agg_1_5</title>
<path fill="none" stroke="black" d="M4360.25,-3498.42C4360.25,-3498.42 4360.25,-3471.79 4360.25,-3471.79"/>
<polygon fill="black" stroke="black" points="4363.75,-3471.79 4360.25,-3461.79 4356.75,-3471.79 4363.75,-3471.79"/>
</g>
<!-- expert_1_5_3&#45;&gt;expert_agg_1_5 -->
<g id="edge299" class="edge">
<title>expert_1_5_3&#45;&gt;expert_agg_1_5</title>
<path fill="none" stroke="black" d="M4659.33,-3498.39C4659.33,-3471.32 4659.33,-3438 4659.33,-3438 4659.33,-3438 4382.8,-3438 4382.8,-3438"/>
<polygon fill="black" stroke="black" points="4382.8,-3434.5 4372.8,-3438 4382.8,-3441.5 4382.8,-3434.5"/>
</g>
<!-- residual2_1_5 -->
<g id="node66" class="node">
<title>residual2_1_5</title>
<polygon fill="lightcoral" stroke="black" points="4280,-3356.51 4095,-3303.51 4280,-3250.51 4465,-3303.51 4280,-3356.51"/>
<text text-anchor="middle" x="4280" y="-3314.81" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="4280" y="-3299.81" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="4280" y="-3284.81" font-family="Arial" font-size="14.00">GPU: 5</text>
</g>
<!-- expert_agg_1_5&#45;&gt;residual2_1_5 -->
<g id="edge300" class="edge">
<title>expert_agg_1_5&#45;&gt;residual2_1_5</title>
<path fill="none" stroke="black" d="M4280,-3393.29C4280,-3393.29 4280,-3366.68 4280,-3366.68"/>
<polygon fill="black" stroke="black" points="4283.5,-3366.68 4280,-3356.68 4276.5,-3366.68 4283.5,-3366.68"/>
</g>
<!-- allreduce_1_5 -->
<g id="node67" class="node">
<title>allreduce_1_5</title>
<ellipse fill="yellow" stroke="black" cx="4280" cy="-3176.03" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="4280" y="-3187.33" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="4280" y="-3172.33" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="4280" y="-3157.33" font-family="Arial" font-size="14.00">GPU: 5</text>
</g>
<!-- residual2_1_5&#45;&gt;allreduce_1_5 -->
<g id="edge301" class="edge">
<title>residual2_1_5&#45;&gt;allreduce_1_5</title>
<path fill="none" stroke="black" d="M4280,-3250.18C4280,-3250.18 4280,-3223.64 4280,-3223.64"/>
<polygon fill="black" stroke="black" points="4283.5,-3223.64 4280,-3213.64 4276.5,-3223.64 4283.5,-3223.64"/>
</g>
<!-- ln1_2_5 -->
<g id="node145" class="node">
<title>ln1_2_5</title>
<polygon fill="lightyellow" stroke="black" points="4372.5,-3043.55 4187.5,-3043.55 4187.5,-2990.55 4372.5,-2990.55 4372.5,-3043.55"/>
<text text-anchor="middle" x="4280" y="-3028.35" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="4280" y="-3013.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="4280" y="-2998.35" font-family="Arial" font-size="14.00">GPU: 5</text>
</g>
<!-- allreduce_1_5&#45;&gt;ln1_2_5 -->
<g id="edge302" class="edge">
<title>allreduce_1_5&#45;&gt;ln1_2_5</title>
<path fill="none" stroke="black" d="M4280,-3138.35C4280,-3138.35 4280,-3054.02 4280,-3054.02"/>
<polygon fill="black" stroke="black" points="4283.5,-3054.02 4280,-3044.02 4276.5,-3054.02 4283.5,-3054.02"/>
</g>
<!-- attn_1_6 -->
<g id="node69" class="node">
<title>attn_1_6</title>
<polygon fill="lightgreen" stroke="black" points="5042,-3914.51 4830,-3914.51 4830,-3861.51 5042,-3861.51 5042,-3914.51"/>
<text text-anchor="middle" x="4936" y="-3899.31" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="4936" y="-3884.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="4936" y="-3869.31" font-family="Arial" font-size="14.00">GPU: 6</text>
</g>
<!-- ln1_1_6&#45;&gt;attn_1_6 -->
<g id="edge346" class="edge">
<title>ln1_1_6&#45;&gt;attn_1_6</title>
<path fill="none" stroke="black" d="M4881.75,-3951.49C4881.75,-3951.49 4881.75,-3924.64 4881.75,-3924.64"/>
<polygon fill="black" stroke="black" points="4885.25,-3924.64 4881.75,-3914.64 4878.25,-3924.64 4885.25,-3924.64"/>
</g>
<!-- residual1_1_6 -->
<g id="node70" class="node">
<title>residual1_1_6</title>
<polygon fill="lightcoral" stroke="black" points="4958,-3824.51 4773,-3771.51 4958,-3718.51 5143,-3771.51 4958,-3824.51"/>
<text text-anchor="middle" x="4958" y="-3782.81" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="4958" y="-3767.81" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="4958" y="-3752.81" font-family="Arial" font-size="14.00">GPU: 6</text>
</g>
<!-- attn_1_6&#45;&gt;residual1_1_6 -->
<g id="edge347" class="edge">
<title>attn_1_6&#45;&gt;residual1_1_6</title>
<path fill="none" stroke="black" d="M4936,-3861.28C4936,-3861.28 4936,-3828.22 4936,-3828.22"/>
<polygon fill="black" stroke="black" points="4939.5,-3828.22 4936,-3818.22 4932.5,-3828.22 4939.5,-3828.22"/>
</g>
<!-- gate_1_6 -->
<g id="node71" class="node">
<title>gate_1_6</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="5110.5,-3681.51 4937.5,-3681.51 4937.5,-3613.51 5110.5,-3613.51 5110.5,-3681.51"/>
<text text-anchor="middle" x="5024" y="-3666.31" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="5024" y="-3651.31" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="5024" y="-3636.31" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="5024" y="-3621.31" font-family="Arial" font-size="14.00">GPU: 6</text>
</g>
<!-- residual1_1_6&#45;&gt;gate_1_6 -->
<g id="edge348" class="edge">
<title>residual1_1_6&#45;&gt;gate_1_6</title>
<path fill="none" stroke="black" d="M5024,-3737.29C5024,-3737.29 5024,-3691.61 5024,-3691.61"/>
<polygon fill="black" stroke="black" points="5027.5,-3691.61 5024,-3681.61 5020.5,-3691.61 5027.5,-3691.61"/>
</g>
<!-- expert_1_6_0 -->
<g id="node72" class="node">
<title>expert_1_6_0</title>
<polygon fill="lightpink" stroke="black" points="4918,-3566.51 4742,-3566.51 4742,-3498.51 4918,-3498.51 4918,-3566.51"/>
<text text-anchor="middle" x="4830" y="-3551.31" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="4830" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="4830" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="4830" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 6</text>
</g>
<!-- gate_1_6&#45;&gt;expert_1_6_0 -->
<g id="edge349" class="edge">
<title>gate_1_6&#45;&gt;expert_1_6_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4937.36,-3647C4891.89,-3647 4845.5,-3647 4845.5,-3647 4845.5,-3647 4845.5,-3576.55 4845.5,-3576.55"/>
<polygon fill="black" stroke="black" points="4849,-3576.55 4845.5,-3566.55 4842,-3576.55 4849,-3576.55"/>
<text text-anchor="middle" x="4916" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_6_1 -->
<g id="node73" class="node">
<title>expert_1_6_1</title>
<polygon fill="lightpink" stroke="black" points="5112,-3566.51 4936,-3566.51 4936,-3498.51 5112,-3498.51 5112,-3566.51"/>
<text text-anchor="middle" x="5024" y="-3551.31" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="5024" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="5024" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="5024" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 6</text>
</g>
<!-- gate_1_6&#45;&gt;expert_1_6_1 -->
<g id="edge350" class="edge">
<title>gate_1_6&#45;&gt;expert_1_6_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5024,-3613.31C5024,-3613.31 5024,-3576.77 5024,-3576.77"/>
<polygon fill="black" stroke="black" points="5027.5,-3576.77 5024,-3566.77 5020.5,-3576.77 5027.5,-3576.77"/>
<text text-anchor="middle" x="5039" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_6_2 -->
<g id="node74" class="node">
<title>expert_1_6_2</title>
<polygon fill="lightpink" stroke="black" points="5306,-3566.51 5130,-3566.51 5130,-3498.51 5306,-3498.51 5306,-3566.51"/>
<text text-anchor="middle" x="5218" y="-3551.31" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="5218" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="5218" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="5218" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 6</text>
</g>
<!-- gate_1_6&#45;&gt;expert_1_6_2 -->
<g id="edge351" class="edge">
<title>gate_1_6&#45;&gt;expert_1_6_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5110.69,-3630C5125.65,-3630 5136.5,-3630 5136.5,-3630 5136.5,-3630 5136.5,-3576.61 5136.5,-3576.61"/>
<polygon fill="black" stroke="black" points="5140,-3576.61 5136.5,-3566.61 5133,-3576.61 5140,-3576.61"/>
<text text-anchor="middle" x="5162" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_6_3 -->
<g id="node75" class="node">
<title>expert_1_6_3</title>
<polygon fill="lightpink" stroke="black" points="5500,-3566.51 5324,-3566.51 5324,-3498.51 5500,-3498.51 5500,-3566.51"/>
<text text-anchor="middle" x="5412" y="-3551.31" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="5412" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="5412" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="5412" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 6</text>
</g>
<!-- gate_1_6&#45;&gt;expert_1_6_3 -->
<g id="edge352" class="edge">
<title>gate_1_6&#45;&gt;expert_1_6_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5110.59,-3664C5224.94,-3664 5412,-3664 5412,-3664 5412,-3664 5412,-3576.71 5412,-3576.71"/>
<polygon fill="black" stroke="black" points="5415.5,-3576.71 5412,-3566.71 5408.5,-3576.71 5415.5,-3576.71"/>
<text text-anchor="middle" x="5321" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_1_6 -->
<g id="node76" class="node">
<title>expert_agg_1_6</title>
<polygon fill="lightsteelblue" stroke="black" points="5154.5,-3461.51 4969.5,-3461.51 4969.5,-3393.51 5154.5,-3393.51 5154.5,-3461.51"/>
<text text-anchor="middle" x="5062" y="-3446.31" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="5062" y="-3431.31" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="5062" y="-3416.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5062" y="-3401.31" font-family="Arial" font-size="14.00">GPU: 6</text>
</g>
<!-- expert_1_6_0&#45;&gt;expert_agg_1_6 -->
<g id="edge353" class="edge">
<title>expert_1_6_0&#45;&gt;expert_agg_1_6</title>
<path fill="none" stroke="black" d="M4897.5,-3498.49C4897.5,-3464.11 4897.5,-3416 4897.5,-3416 4897.5,-3416 4959.17,-3416 4959.17,-3416"/>
<polygon fill="black" stroke="black" points="4959.17,-3419.5 4969.17,-3416 4959.17,-3412.5 4959.17,-3419.5"/>
</g>
<!-- expert_1_6_1&#45;&gt;expert_agg_1_6 -->
<g id="edge354" class="edge">
<title>expert_1_6_1&#45;&gt;expert_agg_1_6</title>
<path fill="none" stroke="black" d="M5040.75,-3498.42C5040.75,-3498.42 5040.75,-3471.79 5040.75,-3471.79"/>
<polygon fill="black" stroke="black" points="5044.25,-3471.79 5040.75,-3461.79 5037.25,-3471.79 5044.25,-3471.79"/>
</g>
<!-- expert_1_6_2&#45;&gt;expert_agg_1_6 -->
<g id="edge355" class="edge">
<title>expert_1_6_2&#45;&gt;expert_agg_1_6</title>
<path fill="none" stroke="black" d="M5142.25,-3498.42C5142.25,-3498.42 5142.25,-3471.79 5142.25,-3471.79"/>
<polygon fill="black" stroke="black" points="5145.75,-3471.79 5142.25,-3461.79 5138.75,-3471.79 5145.75,-3471.79"/>
</g>
<!-- expert_1_6_3&#45;&gt;expert_agg_1_6 -->
<g id="edge356" class="edge">
<title>expert_1_6_3&#45;&gt;expert_agg_1_6</title>
<path fill="none" stroke="black" d="M5441.33,-3498.39C5441.33,-3471.32 5441.33,-3438 5441.33,-3438 5441.33,-3438 5164.8,-3438 5164.8,-3438"/>
<polygon fill="black" stroke="black" points="5164.8,-3434.5 5154.8,-3438 5164.8,-3441.5 5164.8,-3434.5"/>
</g>
<!-- residual2_1_6 -->
<g id="node77" class="node">
<title>residual2_1_6</title>
<polygon fill="lightcoral" stroke="black" points="5062,-3356.51 4877,-3303.51 5062,-3250.51 5247,-3303.51 5062,-3356.51"/>
<text text-anchor="middle" x="5062" y="-3314.81" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="5062" y="-3299.81" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5062" y="-3284.81" font-family="Arial" font-size="14.00">GPU: 6</text>
</g>
<!-- expert_agg_1_6&#45;&gt;residual2_1_6 -->
<g id="edge357" class="edge">
<title>expert_agg_1_6&#45;&gt;residual2_1_6</title>
<path fill="none" stroke="black" d="M5062,-3393.29C5062,-3393.29 5062,-3366.68 5062,-3366.68"/>
<polygon fill="black" stroke="black" points="5065.5,-3366.68 5062,-3356.68 5058.5,-3366.68 5065.5,-3366.68"/>
</g>
<!-- allreduce_1_6 -->
<g id="node78" class="node">
<title>allreduce_1_6</title>
<ellipse fill="yellow" stroke="black" cx="5062" cy="-3176.03" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="5062" y="-3187.33" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="5062" y="-3172.33" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="5062" y="-3157.33" font-family="Arial" font-size="14.00">GPU: 6</text>
</g>
<!-- residual2_1_6&#45;&gt;allreduce_1_6 -->
<g id="edge358" class="edge">
<title>residual2_1_6&#45;&gt;allreduce_1_6</title>
<path fill="none" stroke="black" d="M5062,-3250.18C5062,-3250.18 5062,-3223.64 5062,-3223.64"/>
<polygon fill="black" stroke="black" points="5065.5,-3223.64 5062,-3213.64 5058.5,-3223.64 5065.5,-3223.64"/>
</g>
<!-- ln1_2_6 -->
<g id="node156" class="node">
<title>ln1_2_6</title>
<polygon fill="lightyellow" stroke="black" points="5154.5,-3043.55 4969.5,-3043.55 4969.5,-2990.55 5154.5,-2990.55 5154.5,-3043.55"/>
<text text-anchor="middle" x="5062" y="-3028.35" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="5062" y="-3013.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5062" y="-2998.35" font-family="Arial" font-size="14.00">GPU: 6</text>
</g>
<!-- allreduce_1_6&#45;&gt;ln1_2_6 -->
<g id="edge359" class="edge">
<title>allreduce_1_6&#45;&gt;ln1_2_6</title>
<path fill="none" stroke="black" d="M5062,-3138.35C5062,-3138.35 5062,-3054.02 5062,-3054.02"/>
<polygon fill="black" stroke="black" points="5065.5,-3054.02 5062,-3044.02 5058.5,-3054.02 5065.5,-3054.02"/>
</g>
<!-- attn_1_7 -->
<g id="node80" class="node">
<title>attn_1_7</title>
<polygon fill="lightgreen" stroke="black" points="5775,-3914.51 5563,-3914.51 5563,-3861.51 5775,-3861.51 5775,-3914.51"/>
<text text-anchor="middle" x="5669" y="-3899.31" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="5669" y="-3884.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5669" y="-3869.31" font-family="Arial" font-size="14.00">GPU: 7</text>
</g>
<!-- ln1_1_7&#45;&gt;attn_1_7 -->
<g id="edge403" class="edge">
<title>ln1_1_7&#45;&gt;attn_1_7</title>
<path fill="none" stroke="black" d="M5639.25,-3951.49C5639.25,-3951.49 5639.25,-3924.64 5639.25,-3924.64"/>
<polygon fill="black" stroke="black" points="5642.75,-3924.64 5639.25,-3914.64 5635.75,-3924.64 5642.75,-3924.64"/>
</g>
<!-- residual1_1_7 -->
<g id="node81" class="node">
<title>residual1_1_7</title>
<polygon fill="lightcoral" stroke="black" points="5757,-3824.51 5572,-3771.51 5757,-3718.51 5942,-3771.51 5757,-3824.51"/>
<text text-anchor="middle" x="5757" y="-3782.81" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="5757" y="-3767.81" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5757" y="-3752.81" font-family="Arial" font-size="14.00">GPU: 7</text>
</g>
<!-- attn_1_7&#45;&gt;residual1_1_7 -->
<g id="edge404" class="edge">
<title>attn_1_7&#45;&gt;residual1_1_7</title>
<path fill="none" stroke="black" d="M5673.5,-3861.28C5673.5,-3861.28 5673.5,-3810.97 5673.5,-3810.97"/>
<polygon fill="black" stroke="black" points="5677,-3810.97 5673.5,-3800.97 5670,-3810.97 5677,-3810.97"/>
</g>
<!-- gate_1_7 -->
<g id="node82" class="node">
<title>gate_1_7</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="5892.5,-3681.51 5719.5,-3681.51 5719.5,-3613.51 5892.5,-3613.51 5892.5,-3681.51"/>
<text text-anchor="middle" x="5806" y="-3666.31" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="5806" y="-3651.31" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="5806" y="-3636.31" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="5806" y="-3621.31" font-family="Arial" font-size="14.00">GPU: 7</text>
</g>
<!-- residual1_1_7&#45;&gt;gate_1_7 -->
<g id="edge405" class="edge">
<title>residual1_1_7&#45;&gt;gate_1_7</title>
<path fill="none" stroke="black" d="M5806,-3732.27C5806,-3732.27 5806,-3691.88 5806,-3691.88"/>
<polygon fill="black" stroke="black" points="5809.5,-3691.88 5806,-3681.88 5802.5,-3691.88 5809.5,-3691.88"/>
</g>
<!-- expert_1_7_0 -->
<g id="node83" class="node">
<title>expert_1_7_0</title>
<polygon fill="lightpink" stroke="black" points="5700,-3566.51 5524,-3566.51 5524,-3498.51 5700,-3498.51 5700,-3566.51"/>
<text text-anchor="middle" x="5612" y="-3551.31" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="5612" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="5612" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="5612" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 7</text>
</g>
<!-- gate_1_7&#45;&gt;expert_1_7_0 -->
<g id="edge406" class="edge">
<title>gate_1_7&#45;&gt;expert_1_7_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5719.01,-3647C5677.18,-3647 5636,-3647 5636,-3647 5636,-3647 5636,-3576.55 5636,-3576.55"/>
<polygon fill="black" stroke="black" points="5639.5,-3576.55 5636,-3566.55 5632.5,-3576.55 5639.5,-3576.55"/>
<text text-anchor="middle" x="5698" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_7_1 -->
<g id="node84" class="node">
<title>expert_1_7_1</title>
<polygon fill="lightpink" stroke="black" points="5894,-3566.51 5718,-3566.51 5718,-3498.51 5894,-3498.51 5894,-3566.51"/>
<text text-anchor="middle" x="5806" y="-3551.31" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="5806" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="5806" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="5806" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 7</text>
</g>
<!-- gate_1_7&#45;&gt;expert_1_7_1 -->
<g id="edge407" class="edge">
<title>gate_1_7&#45;&gt;expert_1_7_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5806,-3613.31C5806,-3613.31 5806,-3576.77 5806,-3576.77"/>
<polygon fill="black" stroke="black" points="5809.5,-3576.77 5806,-3566.77 5802.5,-3576.77 5809.5,-3576.77"/>
<text text-anchor="middle" x="5821" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_7_2 -->
<g id="node85" class="node">
<title>expert_1_7_2</title>
<polygon fill="lightpink" stroke="black" points="6088,-3566.51 5912,-3566.51 5912,-3498.51 6088,-3498.51 6088,-3566.51"/>
<text text-anchor="middle" x="6000" y="-3551.31" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="6000" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="6000" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="6000" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 7</text>
</g>
<!-- gate_1_7&#45;&gt;expert_1_7_2 -->
<g id="edge408" class="edge">
<title>gate_1_7&#45;&gt;expert_1_7_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5892.65,-3636C5912.04,-3636 5927,-3636 5927,-3636 5927,-3636 5927,-3576.68 5927,-3576.68"/>
<polygon fill="black" stroke="black" points="5930.5,-3576.68 5927,-3566.68 5923.5,-3576.68 5930.5,-3576.68"/>
<text text-anchor="middle" x="5944" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_1_7_3 -->
<g id="node86" class="node">
<title>expert_1_7_3</title>
<polygon fill="lightpink" stroke="black" points="6282,-3566.51 6106,-3566.51 6106,-3498.51 6282,-3498.51 6282,-3566.51"/>
<text text-anchor="middle" x="6194" y="-3551.31" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="6194" y="-3536.31" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="6194" y="-3521.31" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="6194" y="-3506.31" font-family="Arial" font-size="14.00">GPU: 7</text>
</g>
<!-- gate_1_7&#45;&gt;expert_1_7_3 -->
<g id="edge409" class="edge">
<title>gate_1_7&#45;&gt;expert_1_7_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5892.59,-3658C6006.94,-3658 6194,-3658 6194,-3658 6194,-3658 6194,-3576.8 6194,-3576.8"/>
<polygon fill="black" stroke="black" points="6197.5,-3576.8 6194,-3566.8 6190.5,-3576.8 6197.5,-3576.8"/>
<text text-anchor="middle" x="6103" y="-3587.51" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_1_7 -->
<g id="node87" class="node">
<title>expert_agg_1_7</title>
<polygon fill="lightsteelblue" stroke="black" points="5936.5,-3461.51 5751.5,-3461.51 5751.5,-3393.51 5936.5,-3393.51 5936.5,-3461.51"/>
<text text-anchor="middle" x="5844" y="-3446.31" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="5844" y="-3431.31" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="5844" y="-3416.31" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5844" y="-3401.31" font-family="Arial" font-size="14.00">GPU: 7</text>
</g>
<!-- expert_1_7_0&#45;&gt;expert_agg_1_7 -->
<g id="edge410" class="edge">
<title>expert_1_7_0&#45;&gt;expert_agg_1_7</title>
<path fill="none" stroke="black" d="M5679.5,-3498.49C5679.5,-3464.11 5679.5,-3416 5679.5,-3416 5679.5,-3416 5741.17,-3416 5741.17,-3416"/>
<polygon fill="black" stroke="black" points="5741.17,-3419.5 5751.17,-3416 5741.17,-3412.5 5741.17,-3419.5"/>
</g>
<!-- expert_1_7_1&#45;&gt;expert_agg_1_7 -->
<g id="edge411" class="edge">
<title>expert_1_7_1&#45;&gt;expert_agg_1_7</title>
<path fill="none" stroke="black" d="M5822.75,-3498.42C5822.75,-3498.42 5822.75,-3471.79 5822.75,-3471.79"/>
<polygon fill="black" stroke="black" points="5826.25,-3471.79 5822.75,-3461.79 5819.25,-3471.79 5826.25,-3471.79"/>
</g>
<!-- expert_1_7_2&#45;&gt;expert_agg_1_7 -->
<g id="edge412" class="edge">
<title>expert_1_7_2&#45;&gt;expert_agg_1_7</title>
<path fill="none" stroke="black" d="M5924.25,-3498.42C5924.25,-3498.42 5924.25,-3471.79 5924.25,-3471.79"/>
<polygon fill="black" stroke="black" points="5927.75,-3471.79 5924.25,-3461.79 5920.75,-3471.79 5927.75,-3471.79"/>
</g>
<!-- expert_1_7_3&#45;&gt;expert_agg_1_7 -->
<g id="edge413" class="edge">
<title>expert_1_7_3&#45;&gt;expert_agg_1_7</title>
<path fill="none" stroke="black" d="M6223.33,-3498.25C6223.33,-3467.44 6223.33,-3427 6223.33,-3427 6223.33,-3427 5946.8,-3427 5946.8,-3427"/>
<polygon fill="black" stroke="black" points="5946.8,-3423.5 5936.8,-3427 5946.8,-3430.5 5946.8,-3423.5"/>
</g>
<!-- residual2_1_7 -->
<g id="node88" class="node">
<title>residual2_1_7</title>
<polygon fill="lightcoral" stroke="black" points="5844,-3356.51 5659,-3303.51 5844,-3250.51 6029,-3303.51 5844,-3356.51"/>
<text text-anchor="middle" x="5844" y="-3314.81" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="5844" y="-3299.81" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5844" y="-3284.81" font-family="Arial" font-size="14.00">GPU: 7</text>
</g>
<!-- expert_agg_1_7&#45;&gt;residual2_1_7 -->
<g id="edge414" class="edge">
<title>expert_agg_1_7&#45;&gt;residual2_1_7</title>
<path fill="none" stroke="black" d="M5844,-3393.29C5844,-3393.29 5844,-3366.68 5844,-3366.68"/>
<polygon fill="black" stroke="black" points="5847.5,-3366.68 5844,-3356.68 5840.5,-3366.68 5847.5,-3366.68"/>
</g>
<!-- allreduce_1_7 -->
<g id="node89" class="node">
<title>allreduce_1_7</title>
<ellipse fill="yellow" stroke="black" cx="5844" cy="-3176.03" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="5844" y="-3187.33" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="5844" y="-3172.33" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="5844" y="-3157.33" font-family="Arial" font-size="14.00">GPU: 7</text>
</g>
<!-- residual2_1_7&#45;&gt;allreduce_1_7 -->
<g id="edge415" class="edge">
<title>residual2_1_7&#45;&gt;allreduce_1_7</title>
<path fill="none" stroke="black" d="M5844,-3250.18C5844,-3250.18 5844,-3223.64 5844,-3223.64"/>
<polygon fill="black" stroke="black" points="5847.5,-3223.64 5844,-3213.64 5840.5,-3223.64 5847.5,-3223.64"/>
</g>
<!-- ln1_2_7 -->
<g id="node167" class="node">
<title>ln1_2_7</title>
<polygon fill="lightyellow" stroke="black" points="5936.5,-3043.55 5751.5,-3043.55 5751.5,-2990.55 5936.5,-2990.55 5936.5,-3043.55"/>
<text text-anchor="middle" x="5844" y="-3028.35" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="5844" y="-3013.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5844" y="-2998.35" font-family="Arial" font-size="14.00">GPU: 7</text>
</g>
<!-- allreduce_1_7&#45;&gt;ln1_2_7 -->
<g id="edge416" class="edge">
<title>allreduce_1_7&#45;&gt;ln1_2_7</title>
<path fill="none" stroke="black" d="M5844,-3138.35C5844,-3138.35 5844,-3054.02 5844,-3054.02"/>
<polygon fill="black" stroke="black" points="5847.5,-3054.02 5844,-3044.02 5840.5,-3054.02 5847.5,-3054.02"/>
</g>
<!-- attn_2_0 -->
<g id="node91" class="node">
<title>attn_2_0</title>
<polygon fill="lightgreen" stroke="black" points="476,-2953.55 264,-2953.55 264,-2900.55 476,-2900.55 476,-2953.55"/>
<text text-anchor="middle" x="370" y="-2938.35" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="370" y="-2923.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="370" y="-2908.35" font-family="Arial" font-size="14.00">GPU: 0</text>
</g>
<!-- ln1_2_0&#45;&gt;attn_2_0 -->
<g id="edge17" class="edge">
<title>ln1_2_0&#45;&gt;attn_2_0</title>
<path fill="none" stroke="black" d="M370,-2990.54C370,-2990.54 370,-2963.69 370,-2963.69"/>
<polygon fill="black" stroke="black" points="373.5,-2963.69 370,-2953.69 366.5,-2963.69 373.5,-2963.69"/>
</g>
<!-- residual1_2_0 -->
<g id="node92" class="node">
<title>residual1_2_0</title>
<polygon fill="lightcoral" stroke="black" points="370,-2863.55 185,-2810.55 370,-2757.55 555,-2810.55 370,-2863.55"/>
<text text-anchor="middle" x="370" y="-2821.85" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="370" y="-2806.85" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="370" y="-2791.85" font-family="Arial" font-size="14.00">GPU: 0</text>
</g>
<!-- attn_2_0&#45;&gt;residual1_2_0 -->
<g id="edge18" class="edge">
<title>attn_2_0&#45;&gt;residual1_2_0</title>
<path fill="none" stroke="black" d="M370,-2900.33C370,-2900.33 370,-2873.79 370,-2873.79"/>
<polygon fill="black" stroke="black" points="373.5,-2873.79 370,-2863.79 366.5,-2873.79 373.5,-2873.79"/>
</g>
<!-- gate_2_0 -->
<g id="node93" class="node">
<title>gate_2_0</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="456.5,-2720.55 283.5,-2720.55 283.5,-2652.55 456.5,-2652.55 456.5,-2720.55"/>
<text text-anchor="middle" x="370" y="-2705.35" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="370" y="-2690.35" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="370" y="-2675.35" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="370" y="-2660.35" font-family="Arial" font-size="14.00">GPU: 0</text>
</g>
<!-- residual1_2_0&#45;&gt;gate_2_0 -->
<g id="edge19" class="edge">
<title>residual1_2_0&#45;&gt;gate_2_0</title>
<path fill="none" stroke="black" d="M370,-2757.25C370,-2757.25 370,-2730.83 370,-2730.83"/>
<polygon fill="black" stroke="black" points="373.5,-2730.83 370,-2720.83 366.5,-2730.83 373.5,-2730.83"/>
</g>
<!-- expert_2_0_0 -->
<g id="node94" class="node">
<title>expert_2_0_0</title>
<polygon fill="lightpink" stroke="black" points="226,-2605.55 50,-2605.55 50,-2537.55 226,-2537.55 226,-2605.55"/>
<text text-anchor="middle" x="138" y="-2590.35" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="138" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="138" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="138" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 0</text>
</g>
<!-- gate_2_0&#45;&gt;expert_2_0_0 -->
<g id="edge20" class="edge">
<title>gate_2_0&#45;&gt;expert_2_0_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M283.41,-2686C243.78,-2686 205.5,-2686 205.5,-2686 205.5,-2686 205.5,-2615.58 205.5,-2615.58"/>
<polygon fill="black" stroke="black" points="209,-2615.58 205.5,-2605.58 202,-2615.58 209,-2615.58"/>
<text text-anchor="middle" x="259" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_0_1 -->
<g id="node95" class="node">
<title>expert_2_0_1</title>
<polygon fill="lightpink" stroke="black" points="420,-2605.55 244,-2605.55 244,-2537.55 420,-2537.55 420,-2605.55"/>
<text text-anchor="middle" x="332" y="-2590.35" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="332" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="332" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="332" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 0</text>
</g>
<!-- gate_2_0&#45;&gt;expert_2_0_1 -->
<g id="edge22" class="edge">
<title>gate_2_0&#45;&gt;expert_2_0_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M351.75,-2652.36C351.75,-2652.36 351.75,-2615.81 351.75,-2615.81"/>
<polygon fill="black" stroke="black" points="355.25,-2615.81 351.75,-2605.81 348.25,-2615.81 355.25,-2615.81"/>
<text text-anchor="middle" x="382" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_0_2 -->
<g id="node96" class="node">
<title>expert_2_0_2</title>
<polygon fill="lightpink" stroke="black" points="614,-2605.55 438,-2605.55 438,-2537.55 614,-2537.55 614,-2605.55"/>
<text text-anchor="middle" x="526" y="-2590.35" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="526" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="526" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="526" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 0</text>
</g>
<!-- gate_2_0&#45;&gt;expert_2_0_2 -->
<g id="edge24" class="edge">
<title>gate_2_0&#45;&gt;expert_2_0_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M447.25,-2652.36C447.25,-2652.36 447.25,-2615.81 447.25,-2615.81"/>
<polygon fill="black" stroke="black" points="450.75,-2615.81 447.25,-2605.81 443.75,-2615.81 450.75,-2615.81"/>
<text text-anchor="middle" x="505" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_0_3 -->
<g id="node97" class="node">
<title>expert_2_0_3</title>
<polygon fill="lightpink" stroke="black" points="808,-2605.55 632,-2605.55 632,-2537.55 808,-2537.55 808,-2605.55"/>
<text text-anchor="middle" x="720" y="-2590.35" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="720" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="720" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="720" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 0</text>
</g>
<!-- gate_2_0&#45;&gt;expert_2_0_3 -->
<g id="edge26" class="edge">
<title>gate_2_0&#45;&gt;expert_2_0_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M456.78,-2697C551.74,-2697 690.67,-2697 690.67,-2697 690.67,-2697 690.67,-2615.83 690.67,-2615.83"/>
<polygon fill="black" stroke="black" points="694.17,-2615.83 690.67,-2605.83 687.17,-2615.83 694.17,-2615.83"/>
<text text-anchor="middle" x="664" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_2_0 -->
<g id="node98" class="node">
<title>expert_agg_2_0</title>
<polygon fill="lightsteelblue" stroke="black" points="484.5,-2500.55 299.5,-2500.55 299.5,-2432.55 484.5,-2432.55 484.5,-2500.55"/>
<text text-anchor="middle" x="392" y="-2485.35" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="392" y="-2470.35" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="392" y="-2455.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="392" y="-2440.35" font-family="Arial" font-size="14.00">GPU: 0</text>
</g>
<!-- expert_2_0_0&#45;&gt;expert_agg_2_0 -->
<g id="edge21" class="edge">
<title>expert_2_0_0&#45;&gt;expert_agg_2_0</title>
<path fill="none" stroke="black" d="M216.5,-2537.28C216.5,-2506.46 216.5,-2466 216.5,-2466 216.5,-2466 289.37,-2466 289.37,-2466"/>
<polygon fill="black" stroke="black" points="289.37,-2469.5 299.37,-2466 289.37,-2462.5 289.37,-2469.5"/>
</g>
<!-- expert_2_0_1&#45;&gt;expert_agg_2_0 -->
<g id="edge23" class="edge">
<title>expert_2_0_1&#45;&gt;expert_agg_2_0</title>
<path fill="none" stroke="black" d="M359.75,-2537.46C359.75,-2537.46 359.75,-2510.83 359.75,-2510.83"/>
<polygon fill="black" stroke="black" points="363.25,-2510.83 359.75,-2500.83 356.25,-2510.83 363.25,-2510.83"/>
</g>
<!-- expert_2_0_2&#45;&gt;expert_agg_2_0 -->
<g id="edge25" class="edge">
<title>expert_2_0_2&#45;&gt;expert_agg_2_0</title>
<path fill="none" stroke="black" d="M461.25,-2537.46C461.25,-2537.46 461.25,-2510.83 461.25,-2510.83"/>
<polygon fill="black" stroke="black" points="464.75,-2510.83 461.25,-2500.83 457.75,-2510.83 464.75,-2510.83"/>
</g>
<!-- expert_2_0_3&#45;&gt;expert_agg_2_0 -->
<g id="edge27" class="edge">
<title>expert_2_0_3&#45;&gt;expert_agg_2_0</title>
<path fill="none" stroke="black" d="M711,-2537.42C711,-2510.33 711,-2477 711,-2477 711,-2477 494.7,-2477 494.7,-2477"/>
<polygon fill="black" stroke="black" points="494.7,-2473.5 484.7,-2477 494.7,-2480.5 494.7,-2473.5"/>
</g>
<!-- residual2_2_0 -->
<g id="node99" class="node">
<title>residual2_2_0</title>
<polygon fill="lightcoral" stroke="black" points="392,-2395.55 207,-2342.55 392,-2289.55 577,-2342.55 392,-2395.55"/>
<text text-anchor="middle" x="392" y="-2353.85" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="392" y="-2338.85" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="392" y="-2323.85" font-family="Arial" font-size="14.00">GPU: 0</text>
</g>
<!-- expert_agg_2_0&#45;&gt;residual2_2_0 -->
<g id="edge28" class="edge">
<title>expert_agg_2_0&#45;&gt;residual2_2_0</title>
<path fill="none" stroke="black" d="M392,-2432.34C392,-2432.34 392,-2405.72 392,-2405.72"/>
<polygon fill="black" stroke="black" points="395.5,-2405.72 392,-2395.72 388.5,-2405.72 395.5,-2405.72"/>
</g>
<!-- allreduce_2_0 -->
<g id="node100" class="node">
<title>allreduce_2_0</title>
<ellipse fill="yellow" stroke="black" cx="392" cy="-2215.08" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="392" y="-2226.38" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="392" y="-2211.38" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="392" y="-2196.38" font-family="Arial" font-size="14.00">GPU: 0</text>
</g>
<!-- residual2_2_0&#45;&gt;allreduce_2_0 -->
<g id="edge29" class="edge">
<title>residual2_2_0&#45;&gt;allreduce_2_0</title>
<path fill="none" stroke="black" d="M392,-2289.23C392,-2289.23 392,-2262.69 392,-2262.69"/>
<polygon fill="black" stroke="black" points="395.5,-2262.69 392,-2252.69 388.5,-2262.69 395.5,-2262.69"/>
</g>
<!-- pipeline_comm_1_2_0 -->
<g id="node355" class="node">
<title>pipeline_comm_1_2_0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="1,5" cx="392" cy="-2089.12" rx="115.93" ry="37.45"/>
<text text-anchor="middle" x="392" y="-2100.42" font-family="Arial" font-size="14.00">Pipeline Communication</text>
<text text-anchor="middle" x="392" y="-2085.42" font-family="Arial" font-size="14.00">Stage 1→2</text>
<text text-anchor="middle" x="392" y="-2070.42" font-family="Arial" font-size="14.00">GPU 0→8</text>
</g>
<!-- allreduce_2_0&#45;&gt;pipeline_comm_1_2_0 -->
<g id="edge30" class="edge">
<title>allreduce_2_0&#45;&gt;pipeline_comm_1_2_0</title>
<path fill="none" stroke="black" d="M392,-2177.29C392,-2177.29 392,-2136.89 392,-2136.89"/>
<polygon fill="black" stroke="black" points="395.5,-2136.89 392,-2126.89 388.5,-2136.89 395.5,-2136.89"/>
</g>
<!-- attn_2_1 -->
<g id="node102" class="node">
<title>attn_2_1</title>
<polygon fill="lightgreen" stroke="black" points="1258,-2953.55 1046,-2953.55 1046,-2900.55 1258,-2900.55 1258,-2953.55"/>
<text text-anchor="middle" x="1152" y="-2938.35" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="1152" y="-2923.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1152" y="-2908.35" font-family="Arial" font-size="14.00">GPU: 1</text>
</g>
<!-- ln1_2_1&#45;&gt;attn_2_1 -->
<g id="edge75" class="edge">
<title>ln1_2_1&#45;&gt;attn_2_1</title>
<path fill="none" stroke="black" d="M1152,-2990.54C1152,-2990.54 1152,-2963.69 1152,-2963.69"/>
<polygon fill="black" stroke="black" points="1155.5,-2963.69 1152,-2953.69 1148.5,-2963.69 1155.5,-2963.69"/>
</g>
<!-- residual1_2_1 -->
<g id="node103" class="node">
<title>residual1_2_1</title>
<polygon fill="lightcoral" stroke="black" points="1152,-2863.55 967,-2810.55 1152,-2757.55 1337,-2810.55 1152,-2863.55"/>
<text text-anchor="middle" x="1152" y="-2821.85" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="1152" y="-2806.85" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1152" y="-2791.85" font-family="Arial" font-size="14.00">GPU: 1</text>
</g>
<!-- attn_2_1&#45;&gt;residual1_2_1 -->
<g id="edge76" class="edge">
<title>attn_2_1&#45;&gt;residual1_2_1</title>
<path fill="none" stroke="black" d="M1152,-2900.33C1152,-2900.33 1152,-2873.79 1152,-2873.79"/>
<polygon fill="black" stroke="black" points="1155.5,-2873.79 1152,-2863.79 1148.5,-2873.79 1155.5,-2873.79"/>
</g>
<!-- gate_2_1 -->
<g id="node104" class="node">
<title>gate_2_1</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="1238.5,-2720.55 1065.5,-2720.55 1065.5,-2652.55 1238.5,-2652.55 1238.5,-2720.55"/>
<text text-anchor="middle" x="1152" y="-2705.35" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="1152" y="-2690.35" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="1152" y="-2675.35" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="1152" y="-2660.35" font-family="Arial" font-size="14.00">GPU: 1</text>
</g>
<!-- residual1_2_1&#45;&gt;gate_2_1 -->
<g id="edge77" class="edge">
<title>residual1_2_1&#45;&gt;gate_2_1</title>
<path fill="none" stroke="black" d="M1152,-2757.25C1152,-2757.25 1152,-2730.83 1152,-2730.83"/>
<polygon fill="black" stroke="black" points="1155.5,-2730.83 1152,-2720.83 1148.5,-2730.83 1155.5,-2730.83"/>
</g>
<!-- expert_2_1_0 -->
<g id="node105" class="node">
<title>expert_2_1_0</title>
<polygon fill="lightpink" stroke="black" points="1008,-2605.55 832,-2605.55 832,-2537.55 1008,-2537.55 1008,-2605.55"/>
<text text-anchor="middle" x="920" y="-2590.35" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="920" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="920" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="920" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 1</text>
</g>
<!-- gate_2_1&#45;&gt;expert_2_1_0 -->
<g id="edge78" class="edge">
<title>gate_2_1&#45;&gt;expert_2_1_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1065.41,-2675C1025.78,-2675 987.5,-2675 987.5,-2675 987.5,-2675 987.5,-2615.71 987.5,-2615.71"/>
<polygon fill="black" stroke="black" points="991,-2615.71 987.5,-2605.71 984,-2615.71 991,-2615.71"/>
<text text-anchor="middle" x="1041" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_1_1 -->
<g id="node106" class="node">
<title>expert_2_1_1</title>
<polygon fill="lightpink" stroke="black" points="1202,-2605.55 1026,-2605.55 1026,-2537.55 1202,-2537.55 1202,-2605.55"/>
<text text-anchor="middle" x="1114" y="-2590.35" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1114" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="1114" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="1114" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 1</text>
</g>
<!-- gate_2_1&#45;&gt;expert_2_1_1 -->
<g id="edge80" class="edge">
<title>gate_2_1&#45;&gt;expert_2_1_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1133.75,-2652.36C1133.75,-2652.36 1133.75,-2615.81 1133.75,-2615.81"/>
<polygon fill="black" stroke="black" points="1137.25,-2615.81 1133.75,-2605.81 1130.25,-2615.81 1137.25,-2615.81"/>
<text text-anchor="middle" x="1164" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_1_2 -->
<g id="node107" class="node">
<title>expert_2_1_2</title>
<polygon fill="lightpink" stroke="black" points="1396,-2605.55 1220,-2605.55 1220,-2537.55 1396,-2537.55 1396,-2605.55"/>
<text text-anchor="middle" x="1308" y="-2590.35" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="1308" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="1308" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="1308" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 1</text>
</g>
<!-- gate_2_1&#45;&gt;expert_2_1_2 -->
<g id="edge82" class="edge">
<title>gate_2_1&#45;&gt;expert_2_1_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1229.25,-2652.36C1229.25,-2652.36 1229.25,-2615.81 1229.25,-2615.81"/>
<polygon fill="black" stroke="black" points="1232.75,-2615.81 1229.25,-2605.81 1225.75,-2615.81 1232.75,-2615.81"/>
<text text-anchor="middle" x="1287" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_1_3 -->
<g id="node108" class="node">
<title>expert_2_1_3</title>
<polygon fill="lightpink" stroke="black" points="1590,-2605.55 1414,-2605.55 1414,-2537.55 1590,-2537.55 1590,-2605.55"/>
<text text-anchor="middle" x="1502" y="-2590.35" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1502" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="1502" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="1502" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 1</text>
</g>
<!-- gate_2_1&#45;&gt;expert_2_1_3 -->
<g id="edge84" class="edge">
<title>gate_2_1&#45;&gt;expert_2_1_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1238.78,-2697C1333.74,-2697 1472.67,-2697 1472.67,-2697 1472.67,-2697 1472.67,-2615.83 1472.67,-2615.83"/>
<polygon fill="black" stroke="black" points="1476.17,-2615.83 1472.67,-2605.83 1469.17,-2615.83 1476.17,-2615.83"/>
<text text-anchor="middle" x="1446" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_2_1 -->
<g id="node109" class="node">
<title>expert_agg_2_1</title>
<polygon fill="lightsteelblue" stroke="black" points="1276.5,-2500.55 1091.5,-2500.55 1091.5,-2432.55 1276.5,-2432.55 1276.5,-2500.55"/>
<text text-anchor="middle" x="1184" y="-2485.35" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1184" y="-2470.35" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="1184" y="-2455.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1184" y="-2440.35" font-family="Arial" font-size="14.00">GPU: 1</text>
</g>
<!-- expert_2_1_0&#45;&gt;expert_agg_2_1 -->
<g id="edge79" class="edge">
<title>expert_2_1_0&#45;&gt;expert_agg_2_1</title>
<path fill="none" stroke="black" d="M1003.5,-2537.53C1003.5,-2503.13 1003.5,-2455 1003.5,-2455 1003.5,-2455 1081.37,-2455 1081.37,-2455"/>
<polygon fill="black" stroke="black" points="1081.37,-2458.5 1091.37,-2455 1081.37,-2451.5 1081.37,-2458.5"/>
</g>
<!-- expert_2_1_1&#45;&gt;expert_agg_2_1 -->
<g id="edge81" class="edge">
<title>expert_2_1_1&#45;&gt;expert_agg_2_1</title>
<path fill="none" stroke="black" d="M1146.75,-2537.46C1146.75,-2537.46 1146.75,-2510.83 1146.75,-2510.83"/>
<polygon fill="black" stroke="black" points="1150.25,-2510.83 1146.75,-2500.83 1143.25,-2510.83 1150.25,-2510.83"/>
</g>
<!-- expert_2_1_2&#45;&gt;expert_agg_2_1 -->
<g id="edge83" class="edge">
<title>expert_2_1_2&#45;&gt;expert_agg_2_1</title>
<path fill="none" stroke="black" d="M1248.25,-2537.46C1248.25,-2537.46 1248.25,-2510.83 1248.25,-2510.83"/>
<polygon fill="black" stroke="black" points="1251.75,-2510.83 1248.25,-2500.83 1244.75,-2510.83 1251.75,-2510.83"/>
</g>
<!-- expert_2_1_3&#45;&gt;expert_agg_2_1 -->
<g id="edge85" class="edge">
<title>expert_2_1_3&#45;&gt;expert_agg_2_1</title>
<path fill="none" stroke="black" d="M1493,-2537.42C1493,-2510.33 1493,-2477 1493,-2477 1493,-2477 1286.71,-2477 1286.71,-2477"/>
<polygon fill="black" stroke="black" points="1286.71,-2473.5 1276.71,-2477 1286.71,-2480.5 1286.71,-2473.5"/>
</g>
<!-- residual2_2_1 -->
<g id="node110" class="node">
<title>residual2_2_1</title>
<polygon fill="lightcoral" stroke="black" points="1184,-2395.55 999,-2342.55 1184,-2289.55 1369,-2342.55 1184,-2395.55"/>
<text text-anchor="middle" x="1184" y="-2353.85" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1184" y="-2338.85" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1184" y="-2323.85" font-family="Arial" font-size="14.00">GPU: 1</text>
</g>
<!-- expert_agg_2_1&#45;&gt;residual2_2_1 -->
<g id="edge86" class="edge">
<title>expert_agg_2_1&#45;&gt;residual2_2_1</title>
<path fill="none" stroke="black" d="M1184,-2432.34C1184,-2432.34 1184,-2405.72 1184,-2405.72"/>
<polygon fill="black" stroke="black" points="1187.5,-2405.72 1184,-2395.72 1180.5,-2405.72 1187.5,-2405.72"/>
</g>
<!-- allreduce_2_1 -->
<g id="node111" class="node">
<title>allreduce_2_1</title>
<ellipse fill="yellow" stroke="black" cx="1184" cy="-2215.08" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="1184" y="-2226.38" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1184" y="-2211.38" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="1184" y="-2196.38" font-family="Arial" font-size="14.00">GPU: 1</text>
</g>
<!-- residual2_2_1&#45;&gt;allreduce_2_1 -->
<g id="edge87" class="edge">
<title>residual2_2_1&#45;&gt;allreduce_2_1</title>
<path fill="none" stroke="black" d="M1184,-2289.23C1184,-2289.23 1184,-2262.69 1184,-2262.69"/>
<polygon fill="black" stroke="black" points="1187.5,-2262.69 1184,-2252.69 1180.5,-2262.69 1187.5,-2262.69"/>
</g>
<!-- pipeline_comm_1_2_1 -->
<g id="node356" class="node">
<title>pipeline_comm_1_2_1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="1,5" cx="1184" cy="-2089.12" rx="115.93" ry="37.45"/>
<text text-anchor="middle" x="1184" y="-2100.42" font-family="Arial" font-size="14.00">Pipeline Communication</text>
<text text-anchor="middle" x="1184" y="-2085.42" font-family="Arial" font-size="14.00">Stage 1→2</text>
<text text-anchor="middle" x="1184" y="-2070.42" font-family="Arial" font-size="14.00">GPU 1→9</text>
</g>
<!-- allreduce_2_1&#45;&gt;pipeline_comm_1_2_1 -->
<g id="edge88" class="edge">
<title>allreduce_2_1&#45;&gt;pipeline_comm_1_2_1</title>
<path fill="none" stroke="black" d="M1184,-2177.29C1184,-2177.29 1184,-2136.89 1184,-2136.89"/>
<polygon fill="black" stroke="black" points="1187.5,-2136.89 1184,-2126.89 1180.5,-2136.89 1187.5,-2136.89"/>
</g>
<!-- attn_2_2 -->
<g id="node113" class="node">
<title>attn_2_2</title>
<polygon fill="lightgreen" stroke="black" points="2040,-2953.55 1828,-2953.55 1828,-2900.55 2040,-2900.55 2040,-2953.55"/>
<text text-anchor="middle" x="1934" y="-2938.35" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="1934" y="-2923.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1934" y="-2908.35" font-family="Arial" font-size="14.00">GPU: 2</text>
</g>
<!-- ln1_2_2&#45;&gt;attn_2_2 -->
<g id="edge132" class="edge">
<title>ln1_2_2&#45;&gt;attn_2_2</title>
<path fill="none" stroke="black" d="M1934,-2990.54C1934,-2990.54 1934,-2963.69 1934,-2963.69"/>
<polygon fill="black" stroke="black" points="1937.5,-2963.69 1934,-2953.69 1930.5,-2963.69 1937.5,-2963.69"/>
</g>
<!-- residual1_2_2 -->
<g id="node114" class="node">
<title>residual1_2_2</title>
<polygon fill="lightcoral" stroke="black" points="1934,-2863.55 1749,-2810.55 1934,-2757.55 2119,-2810.55 1934,-2863.55"/>
<text text-anchor="middle" x="1934" y="-2821.85" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="1934" y="-2806.85" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1934" y="-2791.85" font-family="Arial" font-size="14.00">GPU: 2</text>
</g>
<!-- attn_2_2&#45;&gt;residual1_2_2 -->
<g id="edge133" class="edge">
<title>attn_2_2&#45;&gt;residual1_2_2</title>
<path fill="none" stroke="black" d="M1934,-2900.33C1934,-2900.33 1934,-2873.79 1934,-2873.79"/>
<polygon fill="black" stroke="black" points="1937.5,-2873.79 1934,-2863.79 1930.5,-2873.79 1937.5,-2873.79"/>
</g>
<!-- gate_2_2 -->
<g id="node115" class="node">
<title>gate_2_2</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="2020.5,-2720.55 1847.5,-2720.55 1847.5,-2652.55 2020.5,-2652.55 2020.5,-2720.55"/>
<text text-anchor="middle" x="1934" y="-2705.35" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="1934" y="-2690.35" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="1934" y="-2675.35" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="1934" y="-2660.35" font-family="Arial" font-size="14.00">GPU: 2</text>
</g>
<!-- residual1_2_2&#45;&gt;gate_2_2 -->
<g id="edge134" class="edge">
<title>residual1_2_2&#45;&gt;gate_2_2</title>
<path fill="none" stroke="black" d="M1934,-2757.25C1934,-2757.25 1934,-2730.83 1934,-2730.83"/>
<polygon fill="black" stroke="black" points="1937.5,-2730.83 1934,-2720.83 1930.5,-2730.83 1937.5,-2730.83"/>
</g>
<!-- expert_2_2_0 -->
<g id="node116" class="node">
<title>expert_2_2_0</title>
<polygon fill="lightpink" stroke="black" points="1790,-2605.55 1614,-2605.55 1614,-2537.55 1790,-2537.55 1790,-2605.55"/>
<text text-anchor="middle" x="1702" y="-2590.35" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="1702" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="1702" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="1702" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 2</text>
</g>
<!-- gate_2_2&#45;&gt;expert_2_2_0 -->
<g id="edge135" class="edge">
<title>gate_2_2&#45;&gt;expert_2_2_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1847.41,-2675C1807.78,-2675 1769.5,-2675 1769.5,-2675 1769.5,-2675 1769.5,-2615.71 1769.5,-2615.71"/>
<polygon fill="black" stroke="black" points="1773,-2615.71 1769.5,-2605.71 1766,-2615.71 1773,-2615.71"/>
<text text-anchor="middle" x="1823" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_2_1 -->
<g id="node117" class="node">
<title>expert_2_2_1</title>
<polygon fill="lightpink" stroke="black" points="1984,-2605.55 1808,-2605.55 1808,-2537.55 1984,-2537.55 1984,-2605.55"/>
<text text-anchor="middle" x="1896" y="-2590.35" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1896" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="1896" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="1896" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 2</text>
</g>
<!-- gate_2_2&#45;&gt;expert_2_2_1 -->
<g id="edge137" class="edge">
<title>gate_2_2&#45;&gt;expert_2_2_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1915.75,-2652.36C1915.75,-2652.36 1915.75,-2615.81 1915.75,-2615.81"/>
<polygon fill="black" stroke="black" points="1919.25,-2615.81 1915.75,-2605.81 1912.25,-2615.81 1919.25,-2615.81"/>
<text text-anchor="middle" x="1946" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_2_2 -->
<g id="node118" class="node">
<title>expert_2_2_2</title>
<polygon fill="lightpink" stroke="black" points="2178,-2605.55 2002,-2605.55 2002,-2537.55 2178,-2537.55 2178,-2605.55"/>
<text text-anchor="middle" x="2090" y="-2590.35" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2090" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="2090" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="2090" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 2</text>
</g>
<!-- gate_2_2&#45;&gt;expert_2_2_2 -->
<g id="edge139" class="edge">
<title>gate_2_2&#45;&gt;expert_2_2_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2011.25,-2652.36C2011.25,-2652.36 2011.25,-2615.81 2011.25,-2615.81"/>
<polygon fill="black" stroke="black" points="2014.75,-2615.81 2011.25,-2605.81 2007.75,-2615.81 2014.75,-2615.81"/>
<text text-anchor="middle" x="2069" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_2_3 -->
<g id="node119" class="node">
<title>expert_2_2_3</title>
<polygon fill="lightpink" stroke="black" points="2372,-2605.55 2196,-2605.55 2196,-2537.55 2372,-2537.55 2372,-2605.55"/>
<text text-anchor="middle" x="2284" y="-2590.35" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2284" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="2284" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="2284" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 2</text>
</g>
<!-- gate_2_2&#45;&gt;expert_2_2_3 -->
<g id="edge141" class="edge">
<title>gate_2_2&#45;&gt;expert_2_2_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2020.78,-2697C2115.74,-2697 2254.67,-2697 2254.67,-2697 2254.67,-2697 2254.67,-2615.83 2254.67,-2615.83"/>
<polygon fill="black" stroke="black" points="2258.17,-2615.83 2254.67,-2605.83 2251.17,-2615.83 2258.17,-2615.83"/>
<text text-anchor="middle" x="2228" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_2_2 -->
<g id="node120" class="node">
<title>expert_agg_2_2</title>
<polygon fill="lightsteelblue" stroke="black" points="2065.5,-2500.55 1880.5,-2500.55 1880.5,-2432.55 2065.5,-2432.55 2065.5,-2500.55"/>
<text text-anchor="middle" x="1973" y="-2485.35" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1973" y="-2470.35" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="1973" y="-2455.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1973" y="-2440.35" font-family="Arial" font-size="14.00">GPU: 2</text>
</g>
<!-- expert_2_2_0&#45;&gt;expert_agg_2_2 -->
<g id="edge136" class="edge">
<title>expert_2_2_0&#45;&gt;expert_agg_2_2</title>
<path fill="none" stroke="black" d="M1783.5,-2537.53C1783.5,-2503.13 1783.5,-2455 1783.5,-2455 1783.5,-2455 1870.47,-2455 1870.47,-2455"/>
<polygon fill="black" stroke="black" points="1870.47,-2458.5 1880.47,-2455 1870.47,-2451.5 1870.47,-2458.5"/>
</g>
<!-- expert_2_2_1&#45;&gt;expert_agg_2_2 -->
<g id="edge138" class="edge">
<title>expert_2_2_1&#45;&gt;expert_agg_2_2</title>
<path fill="none" stroke="black" d="M1932.25,-2537.46C1932.25,-2537.46 1932.25,-2510.83 1932.25,-2510.83"/>
<polygon fill="black" stroke="black" points="1935.75,-2510.83 1932.25,-2500.83 1928.75,-2510.83 1935.75,-2510.83"/>
</g>
<!-- expert_2_2_2&#45;&gt;expert_agg_2_2 -->
<g id="edge140" class="edge">
<title>expert_2_2_2&#45;&gt;expert_agg_2_2</title>
<path fill="none" stroke="black" d="M2033.75,-2537.46C2033.75,-2537.46 2033.75,-2510.83 2033.75,-2510.83"/>
<polygon fill="black" stroke="black" points="2037.25,-2510.83 2033.75,-2500.83 2030.25,-2510.83 2037.25,-2510.83"/>
</g>
<!-- expert_2_2_3&#45;&gt;expert_agg_2_2 -->
<g id="edge142" class="edge">
<title>expert_2_2_3&#45;&gt;expert_agg_2_2</title>
<path fill="none" stroke="black" d="M2275,-2537.42C2275,-2510.33 2275,-2477 2275,-2477 2275,-2477 2075.66,-2477 2075.66,-2477"/>
<polygon fill="black" stroke="black" points="2075.66,-2473.5 2065.66,-2477 2075.66,-2480.5 2075.66,-2473.5"/>
</g>
<!-- residual2_2_2 -->
<g id="node121" class="node">
<title>residual2_2_2</title>
<polygon fill="lightcoral" stroke="black" points="1973,-2395.55 1788,-2342.55 1973,-2289.55 2158,-2342.55 1973,-2395.55"/>
<text text-anchor="middle" x="1973" y="-2353.85" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1973" y="-2338.85" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1973" y="-2323.85" font-family="Arial" font-size="14.00">GPU: 2</text>
</g>
<!-- expert_agg_2_2&#45;&gt;residual2_2_2 -->
<g id="edge143" class="edge">
<title>expert_agg_2_2&#45;&gt;residual2_2_2</title>
<path fill="none" stroke="black" d="M1973,-2432.34C1973,-2432.34 1973,-2405.72 1973,-2405.72"/>
<polygon fill="black" stroke="black" points="1976.5,-2405.72 1973,-2395.72 1969.5,-2405.72 1976.5,-2405.72"/>
</g>
<!-- allreduce_2_2 -->
<g id="node122" class="node">
<title>allreduce_2_2</title>
<ellipse fill="yellow" stroke="black" cx="1973" cy="-2215.08" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="1973" y="-2226.38" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1973" y="-2211.38" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="1973" y="-2196.38" font-family="Arial" font-size="14.00">GPU: 2</text>
</g>
<!-- residual2_2_2&#45;&gt;allreduce_2_2 -->
<g id="edge144" class="edge">
<title>residual2_2_2&#45;&gt;allreduce_2_2</title>
<path fill="none" stroke="black" d="M1973,-2289.23C1973,-2289.23 1973,-2262.69 1973,-2262.69"/>
<polygon fill="black" stroke="black" points="1976.5,-2262.69 1973,-2252.69 1969.5,-2262.69 1976.5,-2262.69"/>
</g>
<!-- pipeline_comm_1_2_2 -->
<g id="node357" class="node">
<title>pipeline_comm_1_2_2</title>
<ellipse fill="none" stroke="black" stroke-dasharray="1,5" cx="1973" cy="-2089.12" rx="115.93" ry="37.45"/>
<text text-anchor="middle" x="1973" y="-2100.42" font-family="Arial" font-size="14.00">Pipeline Communication</text>
<text text-anchor="middle" x="1973" y="-2085.42" font-family="Arial" font-size="14.00">Stage 1→2</text>
<text text-anchor="middle" x="1973" y="-2070.42" font-family="Arial" font-size="14.00">GPU 2→10</text>
</g>
<!-- allreduce_2_2&#45;&gt;pipeline_comm_1_2_2 -->
<g id="edge145" class="edge">
<title>allreduce_2_2&#45;&gt;pipeline_comm_1_2_2</title>
<path fill="none" stroke="black" d="M1973,-2177.29C1973,-2177.29 1973,-2136.89 1973,-2136.89"/>
<polygon fill="black" stroke="black" points="1976.5,-2136.89 1973,-2126.89 1969.5,-2136.89 1976.5,-2136.89"/>
</g>
<!-- attn_2_3 -->
<g id="node124" class="node">
<title>attn_2_3</title>
<polygon fill="lightgreen" stroke="black" points="2822,-2953.55 2610,-2953.55 2610,-2900.55 2822,-2900.55 2822,-2953.55"/>
<text text-anchor="middle" x="2716" y="-2938.35" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="2716" y="-2923.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="2716" y="-2908.35" font-family="Arial" font-size="14.00">GPU: 3</text>
</g>
<!-- ln1_2_3&#45;&gt;attn_2_3 -->
<g id="edge189" class="edge">
<title>ln1_2_3&#45;&gt;attn_2_3</title>
<path fill="none" stroke="black" d="M2716,-2990.54C2716,-2990.54 2716,-2963.69 2716,-2963.69"/>
<polygon fill="black" stroke="black" points="2719.5,-2963.69 2716,-2953.69 2712.5,-2963.69 2719.5,-2963.69"/>
</g>
<!-- residual1_2_3 -->
<g id="node125" class="node">
<title>residual1_2_3</title>
<polygon fill="lightcoral" stroke="black" points="2716,-2863.55 2531,-2810.55 2716,-2757.55 2901,-2810.55 2716,-2863.55"/>
<text text-anchor="middle" x="2716" y="-2821.85" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="2716" y="-2806.85" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="2716" y="-2791.85" font-family="Arial" font-size="14.00">GPU: 3</text>
</g>
<!-- attn_2_3&#45;&gt;residual1_2_3 -->
<g id="edge190" class="edge">
<title>attn_2_3&#45;&gt;residual1_2_3</title>
<path fill="none" stroke="black" d="M2716,-2900.33C2716,-2900.33 2716,-2873.79 2716,-2873.79"/>
<polygon fill="black" stroke="black" points="2719.5,-2873.79 2716,-2863.79 2712.5,-2873.79 2719.5,-2873.79"/>
</g>
<!-- gate_2_3 -->
<g id="node126" class="node">
<title>gate_2_3</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="2802.5,-2720.55 2629.5,-2720.55 2629.5,-2652.55 2802.5,-2652.55 2802.5,-2720.55"/>
<text text-anchor="middle" x="2716" y="-2705.35" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="2716" y="-2690.35" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="2716" y="-2675.35" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="2716" y="-2660.35" font-family="Arial" font-size="14.00">GPU: 3</text>
</g>
<!-- residual1_2_3&#45;&gt;gate_2_3 -->
<g id="edge191" class="edge">
<title>residual1_2_3&#45;&gt;gate_2_3</title>
<path fill="none" stroke="black" d="M2716,-2757.25C2716,-2757.25 2716,-2730.83 2716,-2730.83"/>
<polygon fill="black" stroke="black" points="2719.5,-2730.83 2716,-2720.83 2712.5,-2730.83 2719.5,-2730.83"/>
</g>
<!-- expert_2_3_0 -->
<g id="node127" class="node">
<title>expert_2_3_0</title>
<polygon fill="lightpink" stroke="black" points="2572,-2605.55 2396,-2605.55 2396,-2537.55 2572,-2537.55 2572,-2605.55"/>
<text text-anchor="middle" x="2484" y="-2590.35" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="2484" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="2484" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="2484" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 3</text>
</g>
<!-- gate_2_3&#45;&gt;expert_2_3_0 -->
<g id="edge192" class="edge">
<title>gate_2_3&#45;&gt;expert_2_3_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2629.41,-2675C2589.78,-2675 2551.5,-2675 2551.5,-2675 2551.5,-2675 2551.5,-2615.71 2551.5,-2615.71"/>
<polygon fill="black" stroke="black" points="2555,-2615.71 2551.5,-2605.71 2548,-2615.71 2555,-2615.71"/>
<text text-anchor="middle" x="2605" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_3_1 -->
<g id="node128" class="node">
<title>expert_2_3_1</title>
<polygon fill="lightpink" stroke="black" points="2766,-2605.55 2590,-2605.55 2590,-2537.55 2766,-2537.55 2766,-2605.55"/>
<text text-anchor="middle" x="2678" y="-2590.35" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="2678" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="2678" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="2678" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 3</text>
</g>
<!-- gate_2_3&#45;&gt;expert_2_3_1 -->
<g id="edge194" class="edge">
<title>gate_2_3&#45;&gt;expert_2_3_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2697.75,-2652.36C2697.75,-2652.36 2697.75,-2615.81 2697.75,-2615.81"/>
<polygon fill="black" stroke="black" points="2701.25,-2615.81 2697.75,-2605.81 2694.25,-2615.81 2701.25,-2615.81"/>
<text text-anchor="middle" x="2728" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_3_2 -->
<g id="node129" class="node">
<title>expert_2_3_2</title>
<polygon fill="lightpink" stroke="black" points="2960,-2605.55 2784,-2605.55 2784,-2537.55 2960,-2537.55 2960,-2605.55"/>
<text text-anchor="middle" x="2872" y="-2590.35" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2872" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="2872" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="2872" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 3</text>
</g>
<!-- gate_2_3&#45;&gt;expert_2_3_2 -->
<g id="edge196" class="edge">
<title>gate_2_3&#45;&gt;expert_2_3_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2793.25,-2652.36C2793.25,-2652.36 2793.25,-2615.81 2793.25,-2615.81"/>
<polygon fill="black" stroke="black" points="2796.75,-2615.81 2793.25,-2605.81 2789.75,-2615.81 2796.75,-2615.81"/>
<text text-anchor="middle" x="2851" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_3_3 -->
<g id="node130" class="node">
<title>expert_2_3_3</title>
<polygon fill="lightpink" stroke="black" points="3154,-2605.55 2978,-2605.55 2978,-2537.55 3154,-2537.55 3154,-2605.55"/>
<text text-anchor="middle" x="3066" y="-2590.35" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="3066" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="3066" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="3066" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 3</text>
</g>
<!-- gate_2_3&#45;&gt;expert_2_3_3 -->
<g id="edge198" class="edge">
<title>gate_2_3&#45;&gt;expert_2_3_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2802.78,-2697C2897.74,-2697 3036.67,-2697 3036.67,-2697 3036.67,-2697 3036.67,-2615.83 3036.67,-2615.83"/>
<polygon fill="black" stroke="black" points="3040.17,-2615.83 3036.67,-2605.83 3033.17,-2615.83 3040.17,-2615.83"/>
<text text-anchor="middle" x="3010" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_2_3 -->
<g id="node131" class="node">
<title>expert_agg_2_3</title>
<polygon fill="lightsteelblue" stroke="black" points="2853.5,-2500.55 2668.5,-2500.55 2668.5,-2432.55 2853.5,-2432.55 2853.5,-2500.55"/>
<text text-anchor="middle" x="2761" y="-2485.35" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="2761" y="-2470.35" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="2761" y="-2455.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="2761" y="-2440.35" font-family="Arial" font-size="14.00">GPU: 3</text>
</g>
<!-- expert_2_3_0&#45;&gt;expert_agg_2_3 -->
<g id="edge193" class="edge">
<title>expert_2_3_0&#45;&gt;expert_agg_2_3</title>
<path fill="none" stroke="black" d="M2563,-2537.53C2563,-2503.13 2563,-2455 2563,-2455 2563,-2455 2658.38,-2455 2658.38,-2455"/>
<polygon fill="black" stroke="black" points="2658.38,-2458.5 2668.38,-2455 2658.38,-2451.5 2658.38,-2458.5"/>
</g>
<!-- expert_2_3_1&#45;&gt;expert_agg_2_3 -->
<g id="edge195" class="edge">
<title>expert_2_3_1&#45;&gt;expert_agg_2_3</title>
<path fill="none" stroke="black" d="M2717.25,-2537.46C2717.25,-2537.46 2717.25,-2510.83 2717.25,-2510.83"/>
<polygon fill="black" stroke="black" points="2720.75,-2510.83 2717.25,-2500.83 2713.75,-2510.83 2720.75,-2510.83"/>
</g>
<!-- expert_2_3_2&#45;&gt;expert_agg_2_3 -->
<g id="edge197" class="edge">
<title>expert_2_3_2&#45;&gt;expert_agg_2_3</title>
<path fill="none" stroke="black" d="M2818.75,-2537.46C2818.75,-2537.46 2818.75,-2510.83 2818.75,-2510.83"/>
<polygon fill="black" stroke="black" points="2822.25,-2510.83 2818.75,-2500.83 2815.25,-2510.83 2822.25,-2510.83"/>
</g>
<!-- expert_2_3_3&#45;&gt;expert_agg_2_3 -->
<g id="edge199" class="edge">
<title>expert_2_3_3&#45;&gt;expert_agg_2_3</title>
<path fill="none" stroke="black" d="M3057,-2537.42C3057,-2510.33 3057,-2477 3057,-2477 3057,-2477 2863.84,-2477 2863.84,-2477"/>
<polygon fill="black" stroke="black" points="2863.84,-2473.5 2853.84,-2477 2863.84,-2480.5 2863.84,-2473.5"/>
</g>
<!-- residual2_2_3 -->
<g id="node132" class="node">
<title>residual2_2_3</title>
<polygon fill="lightcoral" stroke="black" points="2761,-2395.55 2576,-2342.55 2761,-2289.55 2946,-2342.55 2761,-2395.55"/>
<text text-anchor="middle" x="2761" y="-2353.85" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="2761" y="-2338.85" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="2761" y="-2323.85" font-family="Arial" font-size="14.00">GPU: 3</text>
</g>
<!-- expert_agg_2_3&#45;&gt;residual2_2_3 -->
<g id="edge200" class="edge">
<title>expert_agg_2_3&#45;&gt;residual2_2_3</title>
<path fill="none" stroke="black" d="M2761,-2432.34C2761,-2432.34 2761,-2405.72 2761,-2405.72"/>
<polygon fill="black" stroke="black" points="2764.5,-2405.72 2761,-2395.72 2757.5,-2405.72 2764.5,-2405.72"/>
</g>
<!-- allreduce_2_3 -->
<g id="node133" class="node">
<title>allreduce_2_3</title>
<ellipse fill="yellow" stroke="black" cx="2761" cy="-2215.08" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="2761" y="-2226.38" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="2761" y="-2211.38" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="2761" y="-2196.38" font-family="Arial" font-size="14.00">GPU: 3</text>
</g>
<!-- residual2_2_3&#45;&gt;allreduce_2_3 -->
<g id="edge201" class="edge">
<title>residual2_2_3&#45;&gt;allreduce_2_3</title>
<path fill="none" stroke="black" d="M2761,-2289.23C2761,-2289.23 2761,-2262.69 2761,-2262.69"/>
<polygon fill="black" stroke="black" points="2764.5,-2262.69 2761,-2252.69 2757.5,-2262.69 2764.5,-2262.69"/>
</g>
<!-- pipeline_comm_1_2_3 -->
<g id="node358" class="node">
<title>pipeline_comm_1_2_3</title>
<ellipse fill="none" stroke="black" stroke-dasharray="1,5" cx="2761" cy="-2089.12" rx="115.93" ry="37.45"/>
<text text-anchor="middle" x="2761" y="-2100.42" font-family="Arial" font-size="14.00">Pipeline Communication</text>
<text text-anchor="middle" x="2761" y="-2085.42" font-family="Arial" font-size="14.00">Stage 1→2</text>
<text text-anchor="middle" x="2761" y="-2070.42" font-family="Arial" font-size="14.00">GPU 3→11</text>
</g>
<!-- allreduce_2_3&#45;&gt;pipeline_comm_1_2_3 -->
<g id="edge202" class="edge">
<title>allreduce_2_3&#45;&gt;pipeline_comm_1_2_3</title>
<path fill="none" stroke="black" d="M2761,-2177.29C2761,-2177.29 2761,-2136.89 2761,-2136.89"/>
<polygon fill="black" stroke="black" points="2764.5,-2136.89 2761,-2126.89 2757.5,-2136.89 2764.5,-2136.89"/>
</g>
<!-- attn_2_4 -->
<g id="node135" class="node">
<title>attn_2_4</title>
<polygon fill="lightgreen" stroke="black" points="3604,-2953.55 3392,-2953.55 3392,-2900.55 3604,-2900.55 3604,-2953.55"/>
<text text-anchor="middle" x="3498" y="-2938.35" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="3498" y="-2923.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="3498" y="-2908.35" font-family="Arial" font-size="14.00">GPU: 4</text>
</g>
<!-- ln1_2_4&#45;&gt;attn_2_4 -->
<g id="edge246" class="edge">
<title>ln1_2_4&#45;&gt;attn_2_4</title>
<path fill="none" stroke="black" d="M3498,-2990.54C3498,-2990.54 3498,-2963.69 3498,-2963.69"/>
<polygon fill="black" stroke="black" points="3501.5,-2963.69 3498,-2953.69 3494.5,-2963.69 3501.5,-2963.69"/>
</g>
<!-- residual1_2_4 -->
<g id="node136" class="node">
<title>residual1_2_4</title>
<polygon fill="lightcoral" stroke="black" points="3498,-2863.55 3313,-2810.55 3498,-2757.55 3683,-2810.55 3498,-2863.55"/>
<text text-anchor="middle" x="3498" y="-2821.85" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="3498" y="-2806.85" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="3498" y="-2791.85" font-family="Arial" font-size="14.00">GPU: 4</text>
</g>
<!-- attn_2_4&#45;&gt;residual1_2_4 -->
<g id="edge247" class="edge">
<title>attn_2_4&#45;&gt;residual1_2_4</title>
<path fill="none" stroke="black" d="M3498,-2900.33C3498,-2900.33 3498,-2873.79 3498,-2873.79"/>
<polygon fill="black" stroke="black" points="3501.5,-2873.79 3498,-2863.79 3494.5,-2873.79 3501.5,-2873.79"/>
</g>
<!-- gate_2_4 -->
<g id="node137" class="node">
<title>gate_2_4</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="3584.5,-2720.55 3411.5,-2720.55 3411.5,-2652.55 3584.5,-2652.55 3584.5,-2720.55"/>
<text text-anchor="middle" x="3498" y="-2705.35" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="3498" y="-2690.35" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="3498" y="-2675.35" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="3498" y="-2660.35" font-family="Arial" font-size="14.00">GPU: 4</text>
</g>
<!-- residual1_2_4&#45;&gt;gate_2_4 -->
<g id="edge248" class="edge">
<title>residual1_2_4&#45;&gt;gate_2_4</title>
<path fill="none" stroke="black" d="M3498,-2757.25C3498,-2757.25 3498,-2730.83 3498,-2730.83"/>
<polygon fill="black" stroke="black" points="3501.5,-2730.83 3498,-2720.83 3494.5,-2730.83 3501.5,-2730.83"/>
</g>
<!-- expert_2_4_0 -->
<g id="node138" class="node">
<title>expert_2_4_0</title>
<polygon fill="lightpink" stroke="black" points="3354,-2605.55 3178,-2605.55 3178,-2537.55 3354,-2537.55 3354,-2605.55"/>
<text text-anchor="middle" x="3266" y="-2590.35" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="3266" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="3266" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="3266" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 4</text>
</g>
<!-- gate_2_4&#45;&gt;expert_2_4_0 -->
<g id="edge249" class="edge">
<title>gate_2_4&#45;&gt;expert_2_4_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3411.41,-2675C3371.78,-2675 3333.5,-2675 3333.5,-2675 3333.5,-2675 3333.5,-2615.71 3333.5,-2615.71"/>
<polygon fill="black" stroke="black" points="3337,-2615.71 3333.5,-2605.71 3330,-2615.71 3337,-2615.71"/>
<text text-anchor="middle" x="3387" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_4_1 -->
<g id="node139" class="node">
<title>expert_2_4_1</title>
<polygon fill="lightpink" stroke="black" points="3548,-2605.55 3372,-2605.55 3372,-2537.55 3548,-2537.55 3548,-2605.55"/>
<text text-anchor="middle" x="3460" y="-2590.35" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="3460" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="3460" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="3460" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 4</text>
</g>
<!-- gate_2_4&#45;&gt;expert_2_4_1 -->
<g id="edge251" class="edge">
<title>gate_2_4&#45;&gt;expert_2_4_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3479.75,-2652.36C3479.75,-2652.36 3479.75,-2615.81 3479.75,-2615.81"/>
<polygon fill="black" stroke="black" points="3483.25,-2615.81 3479.75,-2605.81 3476.25,-2615.81 3483.25,-2615.81"/>
<text text-anchor="middle" x="3510" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_4_2 -->
<g id="node140" class="node">
<title>expert_2_4_2</title>
<polygon fill="lightpink" stroke="black" points="3742,-2605.55 3566,-2605.55 3566,-2537.55 3742,-2537.55 3742,-2605.55"/>
<text text-anchor="middle" x="3654" y="-2590.35" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="3654" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="3654" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="3654" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 4</text>
</g>
<!-- gate_2_4&#45;&gt;expert_2_4_2 -->
<g id="edge253" class="edge">
<title>gate_2_4&#45;&gt;expert_2_4_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3575.25,-2652.36C3575.25,-2652.36 3575.25,-2615.81 3575.25,-2615.81"/>
<polygon fill="black" stroke="black" points="3578.75,-2615.81 3575.25,-2605.81 3571.75,-2615.81 3578.75,-2615.81"/>
<text text-anchor="middle" x="3633" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_4_3 -->
<g id="node141" class="node">
<title>expert_2_4_3</title>
<polygon fill="lightpink" stroke="black" points="3936,-2605.55 3760,-2605.55 3760,-2537.55 3936,-2537.55 3936,-2605.55"/>
<text text-anchor="middle" x="3848" y="-2590.35" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="3848" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="3848" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="3848" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 4</text>
</g>
<!-- gate_2_4&#45;&gt;expert_2_4_3 -->
<g id="edge255" class="edge">
<title>gate_2_4&#45;&gt;expert_2_4_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3584.78,-2697C3679.74,-2697 3818.67,-2697 3818.67,-2697 3818.67,-2697 3818.67,-2615.83 3818.67,-2615.83"/>
<polygon fill="black" stroke="black" points="3822.17,-2615.83 3818.67,-2605.83 3815.17,-2615.83 3822.17,-2615.83"/>
<text text-anchor="middle" x="3792" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_2_4 -->
<g id="node142" class="node">
<title>expert_agg_2_4</title>
<polygon fill="lightsteelblue" stroke="black" points="3581.5,-2500.55 3396.5,-2500.55 3396.5,-2432.55 3581.5,-2432.55 3581.5,-2500.55"/>
<text text-anchor="middle" x="3489" y="-2485.35" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="3489" y="-2470.35" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="3489" y="-2455.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="3489" y="-2440.35" font-family="Arial" font-size="14.00">GPU: 4</text>
</g>
<!-- expert_2_4_0&#45;&gt;expert_agg_2_4 -->
<g id="edge250" class="edge">
<title>expert_2_4_0&#45;&gt;expert_agg_2_4</title>
<path fill="none" stroke="black" d="M3329,-2537.53C3329,-2503.13 3329,-2455 3329,-2455 3329,-2455 3386.39,-2455 3386.39,-2455"/>
<polygon fill="black" stroke="black" points="3386.39,-2458.5 3396.39,-2455 3386.39,-2451.5 3386.39,-2458.5"/>
</g>
<!-- expert_2_4_1&#45;&gt;expert_agg_2_4 -->
<g id="edge252" class="edge">
<title>expert_2_4_1&#45;&gt;expert_agg_2_4</title>
<path fill="none" stroke="black" d="M3472.25,-2537.46C3472.25,-2537.46 3472.25,-2510.83 3472.25,-2510.83"/>
<polygon fill="black" stroke="black" points="3475.75,-2510.83 3472.25,-2500.83 3468.75,-2510.83 3475.75,-2510.83"/>
</g>
<!-- expert_2_4_2&#45;&gt;expert_agg_2_4 -->
<g id="edge254" class="edge">
<title>expert_2_4_2&#45;&gt;expert_agg_2_4</title>
<path fill="none" stroke="black" d="M3573.75,-2537.46C3573.75,-2537.46 3573.75,-2510.83 3573.75,-2510.83"/>
<polygon fill="black" stroke="black" points="3577.25,-2510.83 3573.75,-2500.83 3570.25,-2510.83 3577.25,-2510.83"/>
</g>
<!-- expert_2_4_3&#45;&gt;expert_agg_2_4 -->
<g id="edge256" class="edge">
<title>expert_2_4_3&#45;&gt;expert_agg_2_4</title>
<path fill="none" stroke="black" d="M3839,-2537.42C3839,-2510.33 3839,-2477 3839,-2477 3839,-2477 3591.87,-2477 3591.87,-2477"/>
<polygon fill="black" stroke="black" points="3591.87,-2473.5 3581.87,-2477 3591.87,-2480.5 3591.87,-2473.5"/>
</g>
<!-- residual2_2_4 -->
<g id="node143" class="node">
<title>residual2_2_4</title>
<polygon fill="lightcoral" stroke="black" points="3489,-2395.55 3304,-2342.55 3489,-2289.55 3674,-2342.55 3489,-2395.55"/>
<text text-anchor="middle" x="3489" y="-2353.85" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="3489" y="-2338.85" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="3489" y="-2323.85" font-family="Arial" font-size="14.00">GPU: 4</text>
</g>
<!-- expert_agg_2_4&#45;&gt;residual2_2_4 -->
<g id="edge257" class="edge">
<title>expert_agg_2_4&#45;&gt;residual2_2_4</title>
<path fill="none" stroke="black" d="M3489,-2432.34C3489,-2432.34 3489,-2405.72 3489,-2405.72"/>
<polygon fill="black" stroke="black" points="3492.5,-2405.72 3489,-2395.72 3485.5,-2405.72 3492.5,-2405.72"/>
</g>
<!-- allreduce_2_4 -->
<g id="node144" class="node">
<title>allreduce_2_4</title>
<ellipse fill="yellow" stroke="black" cx="3489" cy="-2215.08" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="3489" y="-2226.38" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="3489" y="-2211.38" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="3489" y="-2196.38" font-family="Arial" font-size="14.00">GPU: 4</text>
</g>
<!-- residual2_2_4&#45;&gt;allreduce_2_4 -->
<g id="edge258" class="edge">
<title>residual2_2_4&#45;&gt;allreduce_2_4</title>
<path fill="none" stroke="black" d="M3489,-2289.23C3489,-2289.23 3489,-2262.69 3489,-2262.69"/>
<polygon fill="black" stroke="black" points="3492.5,-2262.69 3489,-2252.69 3485.5,-2262.69 3492.5,-2262.69"/>
</g>
<!-- pipeline_comm_1_2_4 -->
<g id="node359" class="node">
<title>pipeline_comm_1_2_4</title>
<ellipse fill="none" stroke="black" stroke-dasharray="1,5" cx="3489" cy="-2089.12" rx="115.93" ry="37.45"/>
<text text-anchor="middle" x="3489" y="-2100.42" font-family="Arial" font-size="14.00">Pipeline Communication</text>
<text text-anchor="middle" x="3489" y="-2085.42" font-family="Arial" font-size="14.00">Stage 1→2</text>
<text text-anchor="middle" x="3489" y="-2070.42" font-family="Arial" font-size="14.00">GPU 4→12</text>
</g>
<!-- allreduce_2_4&#45;&gt;pipeline_comm_1_2_4 -->
<g id="edge259" class="edge">
<title>allreduce_2_4&#45;&gt;pipeline_comm_1_2_4</title>
<path fill="none" stroke="black" d="M3489,-2177.29C3489,-2177.29 3489,-2136.89 3489,-2136.89"/>
<polygon fill="black" stroke="black" points="3492.5,-2136.89 3489,-2126.89 3485.5,-2136.89 3492.5,-2136.89"/>
</g>
<!-- attn_2_5 -->
<g id="node146" class="node">
<title>attn_2_5</title>
<polygon fill="lightgreen" stroke="black" points="4386,-2953.55 4174,-2953.55 4174,-2900.55 4386,-2900.55 4386,-2953.55"/>
<text text-anchor="middle" x="4280" y="-2938.35" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="4280" y="-2923.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="4280" y="-2908.35" font-family="Arial" font-size="14.00">GPU: 5</text>
</g>
<!-- ln1_2_5&#45;&gt;attn_2_5 -->
<g id="edge303" class="edge">
<title>ln1_2_5&#45;&gt;attn_2_5</title>
<path fill="none" stroke="black" d="M4280,-2990.54C4280,-2990.54 4280,-2963.69 4280,-2963.69"/>
<polygon fill="black" stroke="black" points="4283.5,-2963.69 4280,-2953.69 4276.5,-2963.69 4283.5,-2963.69"/>
</g>
<!-- residual1_2_5 -->
<g id="node147" class="node">
<title>residual1_2_5</title>
<polygon fill="lightcoral" stroke="black" points="4280,-2863.55 4095,-2810.55 4280,-2757.55 4465,-2810.55 4280,-2863.55"/>
<text text-anchor="middle" x="4280" y="-2821.85" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="4280" y="-2806.85" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="4280" y="-2791.85" font-family="Arial" font-size="14.00">GPU: 5</text>
</g>
<!-- attn_2_5&#45;&gt;residual1_2_5 -->
<g id="edge304" class="edge">
<title>attn_2_5&#45;&gt;residual1_2_5</title>
<path fill="none" stroke="black" d="M4280,-2900.33C4280,-2900.33 4280,-2873.79 4280,-2873.79"/>
<polygon fill="black" stroke="black" points="4283.5,-2873.79 4280,-2863.79 4276.5,-2873.79 4283.5,-2873.79"/>
</g>
<!-- gate_2_5 -->
<g id="node148" class="node">
<title>gate_2_5</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="4366.5,-2720.55 4193.5,-2720.55 4193.5,-2652.55 4366.5,-2652.55 4366.5,-2720.55"/>
<text text-anchor="middle" x="4280" y="-2705.35" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="4280" y="-2690.35" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="4280" y="-2675.35" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="4280" y="-2660.35" font-family="Arial" font-size="14.00">GPU: 5</text>
</g>
<!-- residual1_2_5&#45;&gt;gate_2_5 -->
<g id="edge305" class="edge">
<title>residual1_2_5&#45;&gt;gate_2_5</title>
<path fill="none" stroke="black" d="M4280,-2757.25C4280,-2757.25 4280,-2730.83 4280,-2730.83"/>
<polygon fill="black" stroke="black" points="4283.5,-2730.83 4280,-2720.83 4276.5,-2730.83 4283.5,-2730.83"/>
</g>
<!-- expert_2_5_0 -->
<g id="node149" class="node">
<title>expert_2_5_0</title>
<polygon fill="lightpink" stroke="black" points="4136,-2605.55 3960,-2605.55 3960,-2537.55 4136,-2537.55 4136,-2605.55"/>
<text text-anchor="middle" x="4048" y="-2590.35" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="4048" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="4048" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="4048" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 5</text>
</g>
<!-- gate_2_5&#45;&gt;expert_2_5_0 -->
<g id="edge306" class="edge">
<title>gate_2_5&#45;&gt;expert_2_5_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4193.41,-2675C4153.78,-2675 4115.5,-2675 4115.5,-2675 4115.5,-2675 4115.5,-2615.71 4115.5,-2615.71"/>
<polygon fill="black" stroke="black" points="4119,-2615.71 4115.5,-2605.71 4112,-2615.71 4119,-2615.71"/>
<text text-anchor="middle" x="4169" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_5_1 -->
<g id="node150" class="node">
<title>expert_2_5_1</title>
<polygon fill="lightpink" stroke="black" points="4330,-2605.55 4154,-2605.55 4154,-2537.55 4330,-2537.55 4330,-2605.55"/>
<text text-anchor="middle" x="4242" y="-2590.35" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="4242" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="4242" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="4242" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 5</text>
</g>
<!-- gate_2_5&#45;&gt;expert_2_5_1 -->
<g id="edge308" class="edge">
<title>gate_2_5&#45;&gt;expert_2_5_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4261.75,-2652.36C4261.75,-2652.36 4261.75,-2615.81 4261.75,-2615.81"/>
<polygon fill="black" stroke="black" points="4265.25,-2615.81 4261.75,-2605.81 4258.25,-2615.81 4265.25,-2615.81"/>
<text text-anchor="middle" x="4292" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_5_2 -->
<g id="node151" class="node">
<title>expert_2_5_2</title>
<polygon fill="lightpink" stroke="black" points="4524,-2605.55 4348,-2605.55 4348,-2537.55 4524,-2537.55 4524,-2605.55"/>
<text text-anchor="middle" x="4436" y="-2590.35" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="4436" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="4436" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="4436" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 5</text>
</g>
<!-- gate_2_5&#45;&gt;expert_2_5_2 -->
<g id="edge310" class="edge">
<title>gate_2_5&#45;&gt;expert_2_5_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4357.25,-2652.36C4357.25,-2652.36 4357.25,-2615.81 4357.25,-2615.81"/>
<polygon fill="black" stroke="black" points="4360.75,-2615.81 4357.25,-2605.81 4353.75,-2615.81 4360.75,-2615.81"/>
<text text-anchor="middle" x="4415" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_5_3 -->
<g id="node152" class="node">
<title>expert_2_5_3</title>
<polygon fill="lightpink" stroke="black" points="4718,-2605.55 4542,-2605.55 4542,-2537.55 4718,-2537.55 4718,-2605.55"/>
<text text-anchor="middle" x="4630" y="-2590.35" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="4630" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="4630" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="4630" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 5</text>
</g>
<!-- gate_2_5&#45;&gt;expert_2_5_3 -->
<g id="edge312" class="edge">
<title>gate_2_5&#45;&gt;expert_2_5_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4366.78,-2697C4461.74,-2697 4600.67,-2697 4600.67,-2697 4600.67,-2697 4600.67,-2615.83 4600.67,-2615.83"/>
<polygon fill="black" stroke="black" points="4604.17,-2615.83 4600.67,-2605.83 4597.17,-2615.83 4604.17,-2615.83"/>
<text text-anchor="middle" x="4574" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_2_5 -->
<g id="node153" class="node">
<title>expert_agg_2_5</title>
<polygon fill="lightsteelblue" stroke="black" points="4371.5,-2500.55 4186.5,-2500.55 4186.5,-2432.55 4371.5,-2432.55 4371.5,-2500.55"/>
<text text-anchor="middle" x="4279" y="-2485.35" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="4279" y="-2470.35" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="4279" y="-2455.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="4279" y="-2440.35" font-family="Arial" font-size="14.00">GPU: 5</text>
</g>
<!-- expert_2_5_0&#45;&gt;expert_agg_2_5 -->
<g id="edge307" class="edge">
<title>expert_2_5_0&#45;&gt;expert_agg_2_5</title>
<path fill="none" stroke="black" d="M4115,-2537.53C4115,-2503.13 4115,-2455 4115,-2455 4115,-2455 4176.46,-2455 4176.46,-2455"/>
<polygon fill="black" stroke="black" points="4176.46,-2458.5 4186.46,-2455 4176.46,-2451.5 4176.46,-2458.5"/>
</g>
<!-- expert_2_5_1&#45;&gt;expert_agg_2_5 -->
<g id="edge309" class="edge">
<title>expert_2_5_1&#45;&gt;expert_agg_2_5</title>
<path fill="none" stroke="black" d="M4258.25,-2537.46C4258.25,-2537.46 4258.25,-2510.83 4258.25,-2510.83"/>
<polygon fill="black" stroke="black" points="4261.75,-2510.83 4258.25,-2500.83 4254.75,-2510.83 4261.75,-2510.83"/>
</g>
<!-- expert_2_5_2&#45;&gt;expert_agg_2_5 -->
<g id="edge311" class="edge">
<title>expert_2_5_2&#45;&gt;expert_agg_2_5</title>
<path fill="none" stroke="black" d="M4359.75,-2537.46C4359.75,-2537.46 4359.75,-2510.83 4359.75,-2510.83"/>
<polygon fill="black" stroke="black" points="4363.25,-2510.83 4359.75,-2500.83 4356.25,-2510.83 4363.25,-2510.83"/>
</g>
<!-- expert_2_5_3&#45;&gt;expert_agg_2_5 -->
<g id="edge313" class="edge">
<title>expert_2_5_3&#45;&gt;expert_agg_2_5</title>
<path fill="none" stroke="black" d="M4621,-2537.42C4621,-2510.33 4621,-2477 4621,-2477 4621,-2477 4381.55,-2477 4381.55,-2477"/>
<polygon fill="black" stroke="black" points="4381.55,-2473.5 4371.55,-2477 4381.55,-2480.5 4381.55,-2473.5"/>
</g>
<!-- residual2_2_5 -->
<g id="node154" class="node">
<title>residual2_2_5</title>
<polygon fill="lightcoral" stroke="black" points="4279,-2395.55 4094,-2342.55 4279,-2289.55 4464,-2342.55 4279,-2395.55"/>
<text text-anchor="middle" x="4279" y="-2353.85" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="4279" y="-2338.85" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="4279" y="-2323.85" font-family="Arial" font-size="14.00">GPU: 5</text>
</g>
<!-- expert_agg_2_5&#45;&gt;residual2_2_5 -->
<g id="edge314" class="edge">
<title>expert_agg_2_5&#45;&gt;residual2_2_5</title>
<path fill="none" stroke="black" d="M4279,-2432.34C4279,-2432.34 4279,-2405.72 4279,-2405.72"/>
<polygon fill="black" stroke="black" points="4282.5,-2405.72 4279,-2395.72 4275.5,-2405.72 4282.5,-2405.72"/>
</g>
<!-- allreduce_2_5 -->
<g id="node155" class="node">
<title>allreduce_2_5</title>
<ellipse fill="yellow" stroke="black" cx="4279" cy="-2215.08" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="4279" y="-2226.38" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="4279" y="-2211.38" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="4279" y="-2196.38" font-family="Arial" font-size="14.00">GPU: 5</text>
</g>
<!-- residual2_2_5&#45;&gt;allreduce_2_5 -->
<g id="edge315" class="edge">
<title>residual2_2_5&#45;&gt;allreduce_2_5</title>
<path fill="none" stroke="black" d="M4279,-2289.23C4279,-2289.23 4279,-2262.69 4279,-2262.69"/>
<polygon fill="black" stroke="black" points="4282.5,-2262.69 4279,-2252.69 4275.5,-2262.69 4282.5,-2262.69"/>
</g>
<!-- pipeline_comm_1_2_5 -->
<g id="node360" class="node">
<title>pipeline_comm_1_2_5</title>
<ellipse fill="none" stroke="black" stroke-dasharray="1,5" cx="4279" cy="-2089.12" rx="115.93" ry="37.45"/>
<text text-anchor="middle" x="4279" y="-2100.42" font-family="Arial" font-size="14.00">Pipeline Communication</text>
<text text-anchor="middle" x="4279" y="-2085.42" font-family="Arial" font-size="14.00">Stage 1→2</text>
<text text-anchor="middle" x="4279" y="-2070.42" font-family="Arial" font-size="14.00">GPU 5→13</text>
</g>
<!-- allreduce_2_5&#45;&gt;pipeline_comm_1_2_5 -->
<g id="edge316" class="edge">
<title>allreduce_2_5&#45;&gt;pipeline_comm_1_2_5</title>
<path fill="none" stroke="black" d="M4279,-2177.29C4279,-2177.29 4279,-2136.89 4279,-2136.89"/>
<polygon fill="black" stroke="black" points="4282.5,-2136.89 4279,-2126.89 4275.5,-2136.89 4282.5,-2136.89"/>
</g>
<!-- attn_2_6 -->
<g id="node157" class="node">
<title>attn_2_6</title>
<polygon fill="lightgreen" stroke="black" points="5168,-2953.55 4956,-2953.55 4956,-2900.55 5168,-2900.55 5168,-2953.55"/>
<text text-anchor="middle" x="5062" y="-2938.35" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="5062" y="-2923.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5062" y="-2908.35" font-family="Arial" font-size="14.00">GPU: 6</text>
</g>
<!-- ln1_2_6&#45;&gt;attn_2_6 -->
<g id="edge360" class="edge">
<title>ln1_2_6&#45;&gt;attn_2_6</title>
<path fill="none" stroke="black" d="M5062,-2990.54C5062,-2990.54 5062,-2963.69 5062,-2963.69"/>
<polygon fill="black" stroke="black" points="5065.5,-2963.69 5062,-2953.69 5058.5,-2963.69 5065.5,-2963.69"/>
</g>
<!-- residual1_2_6 -->
<g id="node158" class="node">
<title>residual1_2_6</title>
<polygon fill="lightcoral" stroke="black" points="5062,-2863.55 4877,-2810.55 5062,-2757.55 5247,-2810.55 5062,-2863.55"/>
<text text-anchor="middle" x="5062" y="-2821.85" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="5062" y="-2806.85" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5062" y="-2791.85" font-family="Arial" font-size="14.00">GPU: 6</text>
</g>
<!-- attn_2_6&#45;&gt;residual1_2_6 -->
<g id="edge361" class="edge">
<title>attn_2_6&#45;&gt;residual1_2_6</title>
<path fill="none" stroke="black" d="M5062,-2900.33C5062,-2900.33 5062,-2873.79 5062,-2873.79"/>
<polygon fill="black" stroke="black" points="5065.5,-2873.79 5062,-2863.79 5058.5,-2873.79 5065.5,-2873.79"/>
</g>
<!-- gate_2_6 -->
<g id="node159" class="node">
<title>gate_2_6</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="5148.5,-2720.55 4975.5,-2720.55 4975.5,-2652.55 5148.5,-2652.55 5148.5,-2720.55"/>
<text text-anchor="middle" x="5062" y="-2705.35" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="5062" y="-2690.35" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="5062" y="-2675.35" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="5062" y="-2660.35" font-family="Arial" font-size="14.00">GPU: 6</text>
</g>
<!-- residual1_2_6&#45;&gt;gate_2_6 -->
<g id="edge362" class="edge">
<title>residual1_2_6&#45;&gt;gate_2_6</title>
<path fill="none" stroke="black" d="M5062,-2757.25C5062,-2757.25 5062,-2730.83 5062,-2730.83"/>
<polygon fill="black" stroke="black" points="5065.5,-2730.83 5062,-2720.83 5058.5,-2730.83 5065.5,-2730.83"/>
</g>
<!-- expert_2_6_0 -->
<g id="node160" class="node">
<title>expert_2_6_0</title>
<polygon fill="lightpink" stroke="black" points="4918,-2605.55 4742,-2605.55 4742,-2537.55 4918,-2537.55 4918,-2605.55"/>
<text text-anchor="middle" x="4830" y="-2590.35" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="4830" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="4830" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="4830" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 6</text>
</g>
<!-- gate_2_6&#45;&gt;expert_2_6_0 -->
<g id="edge363" class="edge">
<title>gate_2_6&#45;&gt;expert_2_6_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4975.41,-2675C4935.78,-2675 4897.5,-2675 4897.5,-2675 4897.5,-2675 4897.5,-2615.71 4897.5,-2615.71"/>
<polygon fill="black" stroke="black" points="4901,-2615.71 4897.5,-2605.71 4894,-2615.71 4901,-2615.71"/>
<text text-anchor="middle" x="4951" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_6_1 -->
<g id="node161" class="node">
<title>expert_2_6_1</title>
<polygon fill="lightpink" stroke="black" points="5112,-2605.55 4936,-2605.55 4936,-2537.55 5112,-2537.55 5112,-2605.55"/>
<text text-anchor="middle" x="5024" y="-2590.35" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="5024" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="5024" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="5024" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 6</text>
</g>
<!-- gate_2_6&#45;&gt;expert_2_6_1 -->
<g id="edge365" class="edge">
<title>gate_2_6&#45;&gt;expert_2_6_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5043.75,-2652.36C5043.75,-2652.36 5043.75,-2615.81 5043.75,-2615.81"/>
<polygon fill="black" stroke="black" points="5047.25,-2615.81 5043.75,-2605.81 5040.25,-2615.81 5047.25,-2615.81"/>
<text text-anchor="middle" x="5074" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_6_2 -->
<g id="node162" class="node">
<title>expert_2_6_2</title>
<polygon fill="lightpink" stroke="black" points="5306,-2605.55 5130,-2605.55 5130,-2537.55 5306,-2537.55 5306,-2605.55"/>
<text text-anchor="middle" x="5218" y="-2590.35" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="5218" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="5218" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="5218" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 6</text>
</g>
<!-- gate_2_6&#45;&gt;expert_2_6_2 -->
<g id="edge367" class="edge">
<title>gate_2_6&#45;&gt;expert_2_6_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5139.25,-2652.36C5139.25,-2652.36 5139.25,-2615.81 5139.25,-2615.81"/>
<polygon fill="black" stroke="black" points="5142.75,-2615.81 5139.25,-2605.81 5135.75,-2615.81 5142.75,-2615.81"/>
<text text-anchor="middle" x="5197" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_6_3 -->
<g id="node163" class="node">
<title>expert_2_6_3</title>
<polygon fill="lightpink" stroke="black" points="5500,-2605.55 5324,-2605.55 5324,-2537.55 5500,-2537.55 5500,-2605.55"/>
<text text-anchor="middle" x="5412" y="-2590.35" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="5412" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="5412" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="5412" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 6</text>
</g>
<!-- gate_2_6&#45;&gt;expert_2_6_3 -->
<g id="edge369" class="edge">
<title>gate_2_6&#45;&gt;expert_2_6_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5148.78,-2697C5243.74,-2697 5382.67,-2697 5382.67,-2697 5382.67,-2697 5382.67,-2615.83 5382.67,-2615.83"/>
<polygon fill="black" stroke="black" points="5386.17,-2615.83 5382.67,-2605.83 5379.17,-2615.83 5386.17,-2615.83"/>
<text text-anchor="middle" x="5356" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_2_6 -->
<g id="node164" class="node">
<title>expert_agg_2_6</title>
<polygon fill="lightsteelblue" stroke="black" points="5162.5,-2500.55 4977.5,-2500.55 4977.5,-2432.55 5162.5,-2432.55 5162.5,-2500.55"/>
<text text-anchor="middle" x="5070" y="-2485.35" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="5070" y="-2470.35" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="5070" y="-2455.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5070" y="-2440.35" font-family="Arial" font-size="14.00">GPU: 6</text>
</g>
<!-- expert_2_6_0&#45;&gt;expert_agg_2_6 -->
<g id="edge364" class="edge">
<title>expert_2_6_0&#45;&gt;expert_agg_2_6</title>
<path fill="none" stroke="black" d="M4901.5,-2537.53C4901.5,-2503.13 4901.5,-2455 4901.5,-2455 4901.5,-2455 4967.37,-2455 4967.37,-2455"/>
<polygon fill="black" stroke="black" points="4967.37,-2458.5 4977.37,-2455 4967.37,-2451.5 4967.37,-2458.5"/>
</g>
<!-- expert_2_6_1&#45;&gt;expert_agg_2_6 -->
<g id="edge366" class="edge">
<title>expert_2_6_1&#45;&gt;expert_agg_2_6</title>
<path fill="none" stroke="black" d="M5044.75,-2537.46C5044.75,-2537.46 5044.75,-2510.83 5044.75,-2510.83"/>
<polygon fill="black" stroke="black" points="5048.25,-2510.83 5044.75,-2500.83 5041.25,-2510.83 5048.25,-2510.83"/>
</g>
<!-- expert_2_6_2&#45;&gt;expert_agg_2_6 -->
<g id="edge368" class="edge">
<title>expert_2_6_2&#45;&gt;expert_agg_2_6</title>
<path fill="none" stroke="black" d="M5146.25,-2537.46C5146.25,-2537.46 5146.25,-2510.83 5146.25,-2510.83"/>
<polygon fill="black" stroke="black" points="5149.75,-2510.83 5146.25,-2500.83 5142.75,-2510.83 5149.75,-2510.83"/>
</g>
<!-- expert_2_6_3&#45;&gt;expert_agg_2_6 -->
<g id="edge370" class="edge">
<title>expert_2_6_3&#45;&gt;expert_agg_2_6</title>
<path fill="none" stroke="black" d="M5403,-2537.42C5403,-2510.33 5403,-2477 5403,-2477 5403,-2477 5172.76,-2477 5172.76,-2477"/>
<polygon fill="black" stroke="black" points="5172.76,-2473.5 5162.76,-2477 5172.76,-2480.5 5172.76,-2473.5"/>
</g>
<!-- residual2_2_6 -->
<g id="node165" class="node">
<title>residual2_2_6</title>
<polygon fill="lightcoral" stroke="black" points="5070,-2395.55 4885,-2342.55 5070,-2289.55 5255,-2342.55 5070,-2395.55"/>
<text text-anchor="middle" x="5070" y="-2353.85" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="5070" y="-2338.85" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5070" y="-2323.85" font-family="Arial" font-size="14.00">GPU: 6</text>
</g>
<!-- expert_agg_2_6&#45;&gt;residual2_2_6 -->
<g id="edge371" class="edge">
<title>expert_agg_2_6&#45;&gt;residual2_2_6</title>
<path fill="none" stroke="black" d="M5070,-2432.34C5070,-2432.34 5070,-2405.72 5070,-2405.72"/>
<polygon fill="black" stroke="black" points="5073.5,-2405.72 5070,-2395.72 5066.5,-2405.72 5073.5,-2405.72"/>
</g>
<!-- allreduce_2_6 -->
<g id="node166" class="node">
<title>allreduce_2_6</title>
<ellipse fill="yellow" stroke="black" cx="5070" cy="-2215.08" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="5070" y="-2226.38" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="5070" y="-2211.38" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="5070" y="-2196.38" font-family="Arial" font-size="14.00">GPU: 6</text>
</g>
<!-- residual2_2_6&#45;&gt;allreduce_2_6 -->
<g id="edge372" class="edge">
<title>residual2_2_6&#45;&gt;allreduce_2_6</title>
<path fill="none" stroke="black" d="M5070,-2289.23C5070,-2289.23 5070,-2262.69 5070,-2262.69"/>
<polygon fill="black" stroke="black" points="5073.5,-2262.69 5070,-2252.69 5066.5,-2262.69 5073.5,-2262.69"/>
</g>
<!-- pipeline_comm_1_2_6 -->
<g id="node361" class="node">
<title>pipeline_comm_1_2_6</title>
<ellipse fill="none" stroke="black" stroke-dasharray="1,5" cx="5070" cy="-2089.12" rx="115.93" ry="37.45"/>
<text text-anchor="middle" x="5070" y="-2100.42" font-family="Arial" font-size="14.00">Pipeline Communication</text>
<text text-anchor="middle" x="5070" y="-2085.42" font-family="Arial" font-size="14.00">Stage 1→2</text>
<text text-anchor="middle" x="5070" y="-2070.42" font-family="Arial" font-size="14.00">GPU 6→14</text>
</g>
<!-- allreduce_2_6&#45;&gt;pipeline_comm_1_2_6 -->
<g id="edge373" class="edge">
<title>allreduce_2_6&#45;&gt;pipeline_comm_1_2_6</title>
<path fill="none" stroke="black" d="M5070,-2177.29C5070,-2177.29 5070,-2136.89 5070,-2136.89"/>
<polygon fill="black" stroke="black" points="5073.5,-2136.89 5070,-2126.89 5066.5,-2136.89 5073.5,-2136.89"/>
</g>
<!-- attn_2_7 -->
<g id="node168" class="node">
<title>attn_2_7</title>
<polygon fill="lightgreen" stroke="black" points="5950,-2953.55 5738,-2953.55 5738,-2900.55 5950,-2900.55 5950,-2953.55"/>
<text text-anchor="middle" x="5844" y="-2938.35" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="5844" y="-2923.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5844" y="-2908.35" font-family="Arial" font-size="14.00">GPU: 7</text>
</g>
<!-- ln1_2_7&#45;&gt;attn_2_7 -->
<g id="edge417" class="edge">
<title>ln1_2_7&#45;&gt;attn_2_7</title>
<path fill="none" stroke="black" d="M5844,-2990.54C5844,-2990.54 5844,-2963.69 5844,-2963.69"/>
<polygon fill="black" stroke="black" points="5847.5,-2963.69 5844,-2953.69 5840.5,-2963.69 5847.5,-2963.69"/>
</g>
<!-- residual1_2_7 -->
<g id="node169" class="node">
<title>residual1_2_7</title>
<polygon fill="lightcoral" stroke="black" points="5844,-2863.55 5659,-2810.55 5844,-2757.55 6029,-2810.55 5844,-2863.55"/>
<text text-anchor="middle" x="5844" y="-2821.85" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="5844" y="-2806.85" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5844" y="-2791.85" font-family="Arial" font-size="14.00">GPU: 7</text>
</g>
<!-- attn_2_7&#45;&gt;residual1_2_7 -->
<g id="edge418" class="edge">
<title>attn_2_7&#45;&gt;residual1_2_7</title>
<path fill="none" stroke="black" d="M5844,-2900.33C5844,-2900.33 5844,-2873.79 5844,-2873.79"/>
<polygon fill="black" stroke="black" points="5847.5,-2873.79 5844,-2863.79 5840.5,-2873.79 5847.5,-2873.79"/>
</g>
<!-- gate_2_7 -->
<g id="node170" class="node">
<title>gate_2_7</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="5930.5,-2720.55 5757.5,-2720.55 5757.5,-2652.55 5930.5,-2652.55 5930.5,-2720.55"/>
<text text-anchor="middle" x="5844" y="-2705.35" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="5844" y="-2690.35" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="5844" y="-2675.35" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="5844" y="-2660.35" font-family="Arial" font-size="14.00">GPU: 7</text>
</g>
<!-- residual1_2_7&#45;&gt;gate_2_7 -->
<g id="edge419" class="edge">
<title>residual1_2_7&#45;&gt;gate_2_7</title>
<path fill="none" stroke="black" d="M5844,-2757.25C5844,-2757.25 5844,-2730.83 5844,-2730.83"/>
<polygon fill="black" stroke="black" points="5847.5,-2730.83 5844,-2720.83 5840.5,-2730.83 5847.5,-2730.83"/>
</g>
<!-- expert_2_7_0 -->
<g id="node171" class="node">
<title>expert_2_7_0</title>
<polygon fill="lightpink" stroke="black" points="5700,-2605.55 5524,-2605.55 5524,-2537.55 5700,-2537.55 5700,-2605.55"/>
<text text-anchor="middle" x="5612" y="-2590.35" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="5612" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="5612" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="5612" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 7</text>
</g>
<!-- gate_2_7&#45;&gt;expert_2_7_0 -->
<g id="edge420" class="edge">
<title>gate_2_7&#45;&gt;expert_2_7_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5757.41,-2675C5717.78,-2675 5679.5,-2675 5679.5,-2675 5679.5,-2675 5679.5,-2615.71 5679.5,-2615.71"/>
<polygon fill="black" stroke="black" points="5683,-2615.71 5679.5,-2605.71 5676,-2615.71 5683,-2615.71"/>
<text text-anchor="middle" x="5733" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_7_1 -->
<g id="node172" class="node">
<title>expert_2_7_1</title>
<polygon fill="lightpink" stroke="black" points="5894,-2605.55 5718,-2605.55 5718,-2537.55 5894,-2537.55 5894,-2605.55"/>
<text text-anchor="middle" x="5806" y="-2590.35" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="5806" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="5806" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="5806" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 7</text>
</g>
<!-- gate_2_7&#45;&gt;expert_2_7_1 -->
<g id="edge422" class="edge">
<title>gate_2_7&#45;&gt;expert_2_7_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5825.75,-2652.36C5825.75,-2652.36 5825.75,-2615.81 5825.75,-2615.81"/>
<polygon fill="black" stroke="black" points="5829.25,-2615.81 5825.75,-2605.81 5822.25,-2615.81 5829.25,-2615.81"/>
<text text-anchor="middle" x="5856" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_7_2 -->
<g id="node173" class="node">
<title>expert_2_7_2</title>
<polygon fill="lightpink" stroke="black" points="6088,-2605.55 5912,-2605.55 5912,-2537.55 6088,-2537.55 6088,-2605.55"/>
<text text-anchor="middle" x="6000" y="-2590.35" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="6000" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="6000" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="6000" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 7</text>
</g>
<!-- gate_2_7&#45;&gt;expert_2_7_2 -->
<g id="edge424" class="edge">
<title>gate_2_7&#45;&gt;expert_2_7_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5921.25,-2652.36C5921.25,-2652.36 5921.25,-2615.81 5921.25,-2615.81"/>
<polygon fill="black" stroke="black" points="5924.75,-2615.81 5921.25,-2605.81 5917.75,-2615.81 5924.75,-2615.81"/>
<text text-anchor="middle" x="5979" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_2_7_3 -->
<g id="node174" class="node">
<title>expert_2_7_3</title>
<polygon fill="lightpink" stroke="black" points="6282,-2605.55 6106,-2605.55 6106,-2537.55 6282,-2537.55 6282,-2605.55"/>
<text text-anchor="middle" x="6194" y="-2590.35" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="6194" y="-2575.35" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="6194" y="-2560.35" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="6194" y="-2545.35" font-family="Arial" font-size="14.00">GPU: 7</text>
</g>
<!-- gate_2_7&#45;&gt;expert_2_7_3 -->
<g id="edge426" class="edge">
<title>gate_2_7&#45;&gt;expert_2_7_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5930.78,-2686C6025.74,-2686 6164.67,-2686 6164.67,-2686 6164.67,-2686 6164.67,-2615.58 6164.67,-2615.58"/>
<polygon fill="black" stroke="black" points="6168.17,-2615.58 6164.67,-2605.58 6161.17,-2615.58 6168.17,-2615.58"/>
<text text-anchor="middle" x="6138" y="-2626.55" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_2_7 -->
<g id="node175" class="node">
<title>expert_agg_2_7</title>
<polygon fill="lightsteelblue" stroke="black" points="5909.5,-2500.55 5724.5,-2500.55 5724.5,-2432.55 5909.5,-2432.55 5909.5,-2500.55"/>
<text text-anchor="middle" x="5817" y="-2485.35" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="5817" y="-2470.35" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="5817" y="-2455.35" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5817" y="-2440.35" font-family="Arial" font-size="14.00">GPU: 7</text>
</g>
<!-- expert_2_7_0&#45;&gt;expert_agg_2_7 -->
<g id="edge421" class="edge">
<title>expert_2_7_0&#45;&gt;expert_agg_2_7</title>
<path fill="none" stroke="black" d="M5666,-2537.53C5666,-2503.13 5666,-2455 5666,-2455 5666,-2455 5714.38,-2455 5714.38,-2455"/>
<polygon fill="black" stroke="black" points="5714.38,-2458.5 5724.38,-2455 5714.38,-2451.5 5714.38,-2458.5"/>
</g>
<!-- expert_2_7_1&#45;&gt;expert_agg_2_7 -->
<g id="edge423" class="edge">
<title>expert_2_7_1&#45;&gt;expert_agg_2_7</title>
<path fill="none" stroke="black" d="M5809.25,-2537.46C5809.25,-2537.46 5809.25,-2510.83 5809.25,-2510.83"/>
<polygon fill="black" stroke="black" points="5812.75,-2510.83 5809.25,-2500.83 5805.75,-2510.83 5812.75,-2510.83"/>
</g>
<!-- expert_2_7_2&#45;&gt;expert_agg_2_7 -->
<g id="edge425" class="edge">
<title>expert_2_7_2&#45;&gt;expert_agg_2_7</title>
<path fill="none" stroke="black" d="M5911.89,-2571C5905.65,-2571 5901.75,-2571 5901.75,-2571 5901.75,-2571 5901.75,-2510.75 5901.75,-2510.75"/>
<polygon fill="black" stroke="black" points="5905.25,-2510.75 5901.75,-2500.75 5898.25,-2510.75 5905.25,-2510.75"/>
</g>
<!-- expert_2_7_3&#45;&gt;expert_agg_2_7 -->
<g id="edge427" class="edge">
<title>expert_2_7_3&#45;&gt;expert_agg_2_7</title>
<path fill="none" stroke="black" d="M6185,-2537.28C6185,-2506.46 6185,-2466 6185,-2466 6185,-2466 5919.86,-2466 5919.86,-2466"/>
<polygon fill="black" stroke="black" points="5919.86,-2462.5 5909.86,-2466 5919.86,-2469.5 5919.86,-2462.5"/>
</g>
<!-- residual2_2_7 -->
<g id="node176" class="node">
<title>residual2_2_7</title>
<polygon fill="lightcoral" stroke="black" points="5817,-2395.55 5632,-2342.55 5817,-2289.55 6002,-2342.55 5817,-2395.55"/>
<text text-anchor="middle" x="5817" y="-2353.85" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="5817" y="-2338.85" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5817" y="-2323.85" font-family="Arial" font-size="14.00">GPU: 7</text>
</g>
<!-- expert_agg_2_7&#45;&gt;residual2_2_7 -->
<g id="edge428" class="edge">
<title>expert_agg_2_7&#45;&gt;residual2_2_7</title>
<path fill="none" stroke="black" d="M5817,-2432.34C5817,-2432.34 5817,-2405.72 5817,-2405.72"/>
<polygon fill="black" stroke="black" points="5820.5,-2405.72 5817,-2395.72 5813.5,-2405.72 5820.5,-2405.72"/>
</g>
<!-- allreduce_2_7 -->
<g id="node177" class="node">
<title>allreduce_2_7</title>
<ellipse fill="yellow" stroke="black" cx="5817" cy="-2215.08" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="5817" y="-2226.38" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="5817" y="-2211.38" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="5817" y="-2196.38" font-family="Arial" font-size="14.00">GPU: 7</text>
</g>
<!-- residual2_2_7&#45;&gt;allreduce_2_7 -->
<g id="edge429" class="edge">
<title>residual2_2_7&#45;&gt;allreduce_2_7</title>
<path fill="none" stroke="black" d="M5817,-2289.23C5817,-2289.23 5817,-2262.69 5817,-2262.69"/>
<polygon fill="black" stroke="black" points="5820.5,-2262.69 5817,-2252.69 5813.5,-2262.69 5820.5,-2262.69"/>
</g>
<!-- pipeline_comm_1_2_7 -->
<g id="node362" class="node">
<title>pipeline_comm_1_2_7</title>
<ellipse fill="none" stroke="black" stroke-dasharray="1,5" cx="5817" cy="-2089.12" rx="115.93" ry="37.45"/>
<text text-anchor="middle" x="5817" y="-2100.42" font-family="Arial" font-size="14.00">Pipeline Communication</text>
<text text-anchor="middle" x="5817" y="-2085.42" font-family="Arial" font-size="14.00">Stage 1→2</text>
<text text-anchor="middle" x="5817" y="-2070.42" font-family="Arial" font-size="14.00">GPU 7→15</text>
</g>
<!-- allreduce_2_7&#45;&gt;pipeline_comm_1_2_7 -->
<g id="edge430" class="edge">
<title>allreduce_2_7&#45;&gt;pipeline_comm_1_2_7</title>
<path fill="none" stroke="black" d="M5817,-2177.29C5817,-2177.29 5817,-2136.89 5817,-2136.89"/>
<polygon fill="black" stroke="black" points="5820.5,-2136.89 5817,-2126.89 5813.5,-2136.89 5820.5,-2136.89"/>
</g>
<!-- ln1_3_0 -->
<g id="node178" class="node">
<title>ln1_3_0</title>
<polygon fill="lightyellow" stroke="black" points="484.5,-1931.65 299.5,-1931.65 299.5,-1878.65 484.5,-1878.65 484.5,-1931.65"/>
<text text-anchor="middle" x="392" y="-1916.45" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="392" y="-1901.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="392" y="-1886.45" font-family="Arial" font-size="14.00">GPU: 8</text>
</g>
<!-- attn_3_0 -->
<g id="node179" class="node">
<title>attn_3_0</title>
<polygon fill="lightgreen" stroke="black" points="498,-1841.65 286,-1841.65 286,-1788.65 498,-1788.65 498,-1841.65"/>
<text text-anchor="middle" x="392" y="-1826.45" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="392" y="-1811.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="392" y="-1796.45" font-family="Arial" font-size="14.00">GPU: 8</text>
</g>
<!-- ln1_3_0&#45;&gt;attn_3_0 -->
<g id="edge32" class="edge">
<title>ln1_3_0&#45;&gt;attn_3_0</title>
<path fill="none" stroke="black" d="M392,-1878.63C392,-1878.63 392,-1851.78 392,-1851.78"/>
<polygon fill="black" stroke="black" points="395.5,-1851.78 392,-1841.78 388.5,-1851.78 395.5,-1851.78"/>
</g>
<!-- residual1_3_0 -->
<g id="node180" class="node">
<title>residual1_3_0</title>
<polygon fill="lightcoral" stroke="black" points="392,-1751.65 207,-1698.65 392,-1645.65 577,-1698.65 392,-1751.65"/>
<text text-anchor="middle" x="392" y="-1709.95" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="392" y="-1694.95" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="392" y="-1679.95" font-family="Arial" font-size="14.00">GPU: 8</text>
</g>
<!-- attn_3_0&#45;&gt;residual1_3_0 -->
<g id="edge33" class="edge">
<title>attn_3_0&#45;&gt;residual1_3_0</title>
<path fill="none" stroke="black" d="M392,-1788.42C392,-1788.42 392,-1761.89 392,-1761.89"/>
<polygon fill="black" stroke="black" points="395.5,-1761.89 392,-1751.89 388.5,-1761.89 395.5,-1761.89"/>
</g>
<!-- gate_3_0 -->
<g id="node181" class="node">
<title>gate_3_0</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="478.5,-1608.65 305.5,-1608.65 305.5,-1540.65 478.5,-1540.65 478.5,-1608.65"/>
<text text-anchor="middle" x="392" y="-1593.45" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="392" y="-1578.45" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="392" y="-1563.45" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="392" y="-1548.45" font-family="Arial" font-size="14.00">GPU: 8</text>
</g>
<!-- residual1_3_0&#45;&gt;gate_3_0 -->
<g id="edge34" class="edge">
<title>residual1_3_0&#45;&gt;gate_3_0</title>
<path fill="none" stroke="black" d="M392,-1645.34C392,-1645.34 392,-1618.92 392,-1618.92"/>
<polygon fill="black" stroke="black" points="395.5,-1618.92 392,-1608.92 388.5,-1618.92 395.5,-1618.92"/>
</g>
<!-- expert_3_0_0 -->
<g id="node182" class="node">
<title>expert_3_0_0</title>
<polygon fill="lightpink" stroke="black" points="208,-1493.65 32,-1493.65 32,-1425.65 208,-1425.65 208,-1493.65"/>
<text text-anchor="middle" x="120" y="-1478.45" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="120" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="120" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="120" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 8</text>
</g>
<!-- gate_3_0&#45;&gt;expert_3_0_0 -->
<g id="edge35" class="edge">
<title>gate_3_0&#45;&gt;expert_3_0_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M305.36,-1574C228.56,-1574 128.5,-1574 128.5,-1574 128.5,-1574 128.5,-1503.65 128.5,-1503.65"/>
<polygon fill="black" stroke="black" points="132,-1503.65 128.5,-1493.65 125,-1503.65 132,-1503.65"/>
<text text-anchor="middle" x="223" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_0_1 -->
<g id="node183" class="node">
<title>expert_3_0_1</title>
<polygon fill="lightpink" stroke="black" points="402,-1493.65 226,-1493.65 226,-1425.65 402,-1425.65 402,-1493.65"/>
<text text-anchor="middle" x="314" y="-1478.45" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="314" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="314" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="314" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 8</text>
</g>
<!-- gate_3_0&#45;&gt;expert_3_0_1 -->
<g id="edge37" class="edge">
<title>gate_3_0&#45;&gt;expert_3_0_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M353.75,-1540.45C353.75,-1540.45 353.75,-1503.91 353.75,-1503.91"/>
<polygon fill="black" stroke="black" points="357.25,-1503.91 353.75,-1493.91 350.25,-1503.91 357.25,-1503.91"/>
<text text-anchor="middle" x="364" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_0_2 -->
<g id="node184" class="node">
<title>expert_3_0_2</title>
<polygon fill="lightpink" stroke="black" points="596,-1493.65 420,-1493.65 420,-1425.65 596,-1425.65 596,-1493.65"/>
<text text-anchor="middle" x="508" y="-1478.45" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="508" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="508" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="508" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 8</text>
</g>
<!-- gate_3_0&#45;&gt;expert_3_0_2 -->
<g id="edge39" class="edge">
<title>gate_3_0&#45;&gt;expert_3_0_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M449.25,-1540.45C449.25,-1540.45 449.25,-1503.91 449.25,-1503.91"/>
<polygon fill="black" stroke="black" points="452.75,-1503.91 449.25,-1493.91 445.75,-1503.91 452.75,-1503.91"/>
<text text-anchor="middle" x="487" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_0_3 -->
<g id="node185" class="node">
<title>expert_3_0_3</title>
<polygon fill="lightpink" stroke="black" points="790,-1493.65 614,-1493.65 614,-1425.65 790,-1425.65 790,-1493.65"/>
<text text-anchor="middle" x="702" y="-1478.45" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="702" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="702" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="702" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 8</text>
</g>
<!-- gate_3_0&#45;&gt;expert_3_0_3 -->
<g id="edge41" class="edge">
<title>gate_3_0&#45;&gt;expert_3_0_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M478.67,-1585C544.22,-1585 623,-1585 623,-1585 623,-1585 623,-1503.9 623,-1503.9"/>
<polygon fill="black" stroke="black" points="626.5,-1503.9 623,-1493.9 619.5,-1503.9 626.5,-1503.9"/>
<text text-anchor="middle" x="646" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_3_0 -->
<g id="node186" class="node">
<title>expert_agg_3_0</title>
<polygon fill="lightsteelblue" stroke="black" points="444.5,-1388.65 259.5,-1388.65 259.5,-1320.65 444.5,-1320.65 444.5,-1388.65"/>
<text text-anchor="middle" x="352" y="-1373.45" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="352" y="-1358.45" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="352" y="-1343.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="352" y="-1328.45" font-family="Arial" font-size="14.00">GPU: 8</text>
</g>
<!-- expert_3_0_0&#45;&gt;expert_agg_3_0 -->
<g id="edge36" class="edge">
<title>expert_3_0_0&#45;&gt;expert_agg_3_0</title>
<path fill="none" stroke="black" d="M187.5,-1425.64C187.5,-1394.75 187.5,-1354 187.5,-1354 187.5,-1354 249.17,-1354 249.17,-1354"/>
<polygon fill="black" stroke="black" points="249.17,-1357.5 259.17,-1354 249.17,-1350.5 249.17,-1357.5"/>
</g>
<!-- expert_3_0_1&#45;&gt;expert_agg_3_0 -->
<g id="edge38" class="edge">
<title>expert_3_0_1&#45;&gt;expert_agg_3_0</title>
<path fill="none" stroke="black" d="M330.75,-1425.56C330.75,-1425.56 330.75,-1398.93 330.75,-1398.93"/>
<polygon fill="black" stroke="black" points="334.25,-1398.93 330.75,-1388.93 327.25,-1398.93 334.25,-1398.93"/>
</g>
<!-- expert_3_0_2&#45;&gt;expert_agg_3_0 -->
<g id="edge40" class="edge">
<title>expert_3_0_2&#45;&gt;expert_agg_3_0</title>
<path fill="none" stroke="black" d="M432.25,-1425.56C432.25,-1425.56 432.25,-1398.93 432.25,-1398.93"/>
<polygon fill="black" stroke="black" points="435.75,-1398.93 432.25,-1388.93 428.75,-1398.93 435.75,-1398.93"/>
</g>
<!-- expert_3_0_3&#45;&gt;expert_agg_3_0 -->
<g id="edge42" class="edge">
<title>expert_3_0_3&#45;&gt;expert_agg_3_0</title>
<path fill="none" stroke="black" d="M731.33,-1425.48C731.33,-1398.37 731.33,-1365 731.33,-1365 731.33,-1365 454.8,-1365 454.8,-1365"/>
<polygon fill="black" stroke="black" points="454.8,-1361.5 444.8,-1365 454.8,-1368.5 454.8,-1361.5"/>
</g>
<!-- residual2_3_0 -->
<g id="node187" class="node">
<title>residual2_3_0</title>
<polygon fill="lightcoral" stroke="black" points="352,-1283.65 167,-1230.65 352,-1177.65 537,-1230.65 352,-1283.65"/>
<text text-anchor="middle" x="352" y="-1241.95" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="352" y="-1226.95" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="352" y="-1211.95" font-family="Arial" font-size="14.00">GPU: 8</text>
</g>
<!-- expert_agg_3_0&#45;&gt;residual2_3_0 -->
<g id="edge43" class="edge">
<title>expert_agg_3_0&#45;&gt;residual2_3_0</title>
<path fill="none" stroke="black" d="M352,-1320.43C352,-1320.43 352,-1293.82 352,-1293.82"/>
<polygon fill="black" stroke="black" points="355.5,-1293.82 352,-1283.82 348.5,-1293.82 355.5,-1293.82"/>
</g>
<!-- allreduce_3_0 -->
<g id="node188" class="node">
<title>allreduce_3_0</title>
<ellipse fill="yellow" stroke="black" cx="352" cy="-1103.17" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="352" y="-1114.47" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="352" y="-1099.47" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="352" y="-1084.47" font-family="Arial" font-size="14.00">GPU: 8</text>
</g>
<!-- residual2_3_0&#45;&gt;allreduce_3_0 -->
<g id="edge44" class="edge">
<title>residual2_3_0&#45;&gt;allreduce_3_0</title>
<path fill="none" stroke="black" d="M352,-1177.32C352,-1177.32 352,-1150.78 352,-1150.78"/>
<polygon fill="black" stroke="black" points="355.5,-1150.78 352,-1140.78 348.5,-1150.78 355.5,-1150.78"/>
</g>
<!-- ln1_4_0 -->
<g id="node266" class="node">
<title>ln1_4_0</title>
<polygon fill="lightyellow" stroke="black" points="444.5,-970.69 259.5,-970.69 259.5,-917.69 444.5,-917.69 444.5,-970.69"/>
<text text-anchor="middle" x="352" y="-955.49" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="352" y="-940.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="352" y="-925.49" font-family="Arial" font-size="14.00">GPU: 8</text>
</g>
<!-- allreduce_3_0&#45;&gt;ln1_4_0 -->
<g id="edge45" class="edge">
<title>allreduce_3_0&#45;&gt;ln1_4_0</title>
<path fill="none" stroke="black" d="M352,-1065.49C352,-1065.49 352,-981.16 352,-981.16"/>
<polygon fill="black" stroke="black" points="355.5,-981.16 352,-971.16 348.5,-981.16 355.5,-981.16"/>
</g>
<!-- ln1_3_1 -->
<g id="node189" class="node">
<title>ln1_3_1</title>
<polygon fill="lightyellow" stroke="black" points="1276.5,-1931.65 1091.5,-1931.65 1091.5,-1878.65 1276.5,-1878.65 1276.5,-1931.65"/>
<text text-anchor="middle" x="1184" y="-1916.45" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="1184" y="-1901.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1184" y="-1886.45" font-family="Arial" font-size="14.00">GPU: 9</text>
</g>
<!-- attn_3_1 -->
<g id="node190" class="node">
<title>attn_3_1</title>
<polygon fill="lightgreen" stroke="black" points="1290,-1841.65 1078,-1841.65 1078,-1788.65 1290,-1788.65 1290,-1841.65"/>
<text text-anchor="middle" x="1184" y="-1826.45" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="1184" y="-1811.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1184" y="-1796.45" font-family="Arial" font-size="14.00">GPU: 9</text>
</g>
<!-- ln1_3_1&#45;&gt;attn_3_1 -->
<g id="edge90" class="edge">
<title>ln1_3_1&#45;&gt;attn_3_1</title>
<path fill="none" stroke="black" d="M1184,-1878.63C1184,-1878.63 1184,-1851.78 1184,-1851.78"/>
<polygon fill="black" stroke="black" points="1187.5,-1851.78 1184,-1841.78 1180.5,-1851.78 1187.5,-1851.78"/>
</g>
<!-- residual1_3_1 -->
<g id="node191" class="node">
<title>residual1_3_1</title>
<polygon fill="lightcoral" stroke="black" points="1184,-1751.65 999,-1698.65 1184,-1645.65 1369,-1698.65 1184,-1751.65"/>
<text text-anchor="middle" x="1184" y="-1709.95" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="1184" y="-1694.95" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1184" y="-1679.95" font-family="Arial" font-size="14.00">GPU: 9</text>
</g>
<!-- attn_3_1&#45;&gt;residual1_3_1 -->
<g id="edge91" class="edge">
<title>attn_3_1&#45;&gt;residual1_3_1</title>
<path fill="none" stroke="black" d="M1184,-1788.42C1184,-1788.42 1184,-1761.89 1184,-1761.89"/>
<polygon fill="black" stroke="black" points="1187.5,-1761.89 1184,-1751.89 1180.5,-1761.89 1187.5,-1761.89"/>
</g>
<!-- gate_3_1 -->
<g id="node192" class="node">
<title>gate_3_1</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="1270.5,-1608.65 1097.5,-1608.65 1097.5,-1540.65 1270.5,-1540.65 1270.5,-1608.65"/>
<text text-anchor="middle" x="1184" y="-1593.45" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="1184" y="-1578.45" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="1184" y="-1563.45" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="1184" y="-1548.45" font-family="Arial" font-size="14.00">GPU: 9</text>
</g>
<!-- residual1_3_1&#45;&gt;gate_3_1 -->
<g id="edge92" class="edge">
<title>residual1_3_1&#45;&gt;gate_3_1</title>
<path fill="none" stroke="black" d="M1184,-1645.34C1184,-1645.34 1184,-1618.92 1184,-1618.92"/>
<polygon fill="black" stroke="black" points="1187.5,-1618.92 1184,-1608.92 1180.5,-1618.92 1187.5,-1618.92"/>
</g>
<!-- expert_3_1_0 -->
<g id="node193" class="node">
<title>expert_3_1_0</title>
<polygon fill="lightpink" stroke="black" points="990,-1493.65 814,-1493.65 814,-1425.65 990,-1425.65 990,-1493.65"/>
<text text-anchor="middle" x="902" y="-1478.45" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="902" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="902" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="902" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 9</text>
</g>
<!-- gate_3_1&#45;&gt;expert_3_1_0 -->
<g id="edge93" class="edge">
<title>gate_3_1&#45;&gt;expert_3_1_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1097.25,-1563C1017.31,-1563 911,-1563 911,-1563 911,-1563 911,-1503.77 911,-1503.77"/>
<polygon fill="black" stroke="black" points="914.5,-1503.77 911,-1493.77 907.5,-1503.77 914.5,-1503.77"/>
<text text-anchor="middle" x="1005" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_1_1 -->
<g id="node194" class="node">
<title>expert_3_1_1</title>
<polygon fill="lightpink" stroke="black" points="1184,-1493.65 1008,-1493.65 1008,-1425.65 1184,-1425.65 1184,-1493.65"/>
<text text-anchor="middle" x="1096" y="-1478.45" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1096" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="1096" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="1096" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 9</text>
</g>
<!-- gate_3_1&#45;&gt;expert_3_1_1 -->
<g id="edge95" class="edge">
<title>gate_3_1&#45;&gt;expert_3_1_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1140.75,-1540.45C1140.75,-1540.45 1140.75,-1503.91 1140.75,-1503.91"/>
<polygon fill="black" stroke="black" points="1144.25,-1503.91 1140.75,-1493.91 1137.25,-1503.91 1144.25,-1503.91"/>
<text text-anchor="middle" x="1146" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_1_2 -->
<g id="node195" class="node">
<title>expert_3_1_2</title>
<polygon fill="lightpink" stroke="black" points="1378,-1493.65 1202,-1493.65 1202,-1425.65 1378,-1425.65 1378,-1493.65"/>
<text text-anchor="middle" x="1290" y="-1478.45" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="1290" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="1290" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="1290" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 9</text>
</g>
<!-- gate_3_1&#45;&gt;expert_3_1_2 -->
<g id="edge97" class="edge">
<title>gate_3_1&#45;&gt;expert_3_1_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1236.25,-1540.45C1236.25,-1540.45 1236.25,-1503.91 1236.25,-1503.91"/>
<polygon fill="black" stroke="black" points="1239.75,-1503.91 1236.25,-1493.91 1232.75,-1503.91 1239.75,-1503.91"/>
<text text-anchor="middle" x="1269" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_1_3 -->
<g id="node196" class="node">
<title>expert_3_1_3</title>
<polygon fill="lightpink" stroke="black" points="1572,-1493.65 1396,-1493.65 1396,-1425.65 1572,-1425.65 1572,-1493.65"/>
<text text-anchor="middle" x="1484" y="-1478.45" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1484" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="1484" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="1484" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 9</text>
</g>
<!-- gate_3_1&#45;&gt;expert_3_1_3 -->
<g id="edge99" class="edge">
<title>gate_3_1&#45;&gt;expert_3_1_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1270.71,-1585C1332.63,-1585 1405,-1585 1405,-1585 1405,-1585 1405,-1503.9 1405,-1503.9"/>
<polygon fill="black" stroke="black" points="1408.5,-1503.9 1405,-1493.9 1401.5,-1503.9 1408.5,-1503.9"/>
<text text-anchor="middle" x="1428" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_3_1 -->
<g id="node197" class="node">
<title>expert_agg_3_1</title>
<polygon fill="lightsteelblue" stroke="black" points="1226.5,-1388.65 1041.5,-1388.65 1041.5,-1320.65 1226.5,-1320.65 1226.5,-1388.65"/>
<text text-anchor="middle" x="1134" y="-1373.45" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1134" y="-1358.45" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="1134" y="-1343.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1134" y="-1328.45" font-family="Arial" font-size="14.00">GPU: 9</text>
</g>
<!-- expert_3_1_0&#45;&gt;expert_agg_3_1 -->
<g id="edge94" class="edge">
<title>expert_3_1_0&#45;&gt;expert_agg_3_1</title>
<path fill="none" stroke="black" d="M969.5,-1425.59C969.5,-1391.16 969.5,-1343 969.5,-1343 969.5,-1343 1031.17,-1343 1031.17,-1343"/>
<polygon fill="black" stroke="black" points="1031.17,-1346.5 1041.17,-1343 1031.17,-1339.5 1031.17,-1346.5"/>
</g>
<!-- expert_3_1_1&#45;&gt;expert_agg_3_1 -->
<g id="edge96" class="edge">
<title>expert_3_1_1&#45;&gt;expert_agg_3_1</title>
<path fill="none" stroke="black" d="M1112.75,-1425.56C1112.75,-1425.56 1112.75,-1398.93 1112.75,-1398.93"/>
<polygon fill="black" stroke="black" points="1116.25,-1398.93 1112.75,-1388.93 1109.25,-1398.93 1116.25,-1398.93"/>
</g>
<!-- expert_3_1_2&#45;&gt;expert_agg_3_1 -->
<g id="edge98" class="edge">
<title>expert_3_1_2&#45;&gt;expert_agg_3_1</title>
<path fill="none" stroke="black" d="M1214.25,-1425.56C1214.25,-1425.56 1214.25,-1398.93 1214.25,-1398.93"/>
<polygon fill="black" stroke="black" points="1217.75,-1398.93 1214.25,-1388.93 1210.75,-1398.93 1217.75,-1398.93"/>
</g>
<!-- expert_3_1_3&#45;&gt;expert_agg_3_1 -->
<g id="edge100" class="edge">
<title>expert_3_1_3&#45;&gt;expert_agg_3_1</title>
<path fill="none" stroke="black" d="M1513.33,-1425.48C1513.33,-1398.37 1513.33,-1365 1513.33,-1365 1513.33,-1365 1236.8,-1365 1236.8,-1365"/>
<polygon fill="black" stroke="black" points="1236.8,-1361.5 1226.8,-1365 1236.8,-1368.5 1236.8,-1361.5"/>
</g>
<!-- residual2_3_1 -->
<g id="node198" class="node">
<title>residual2_3_1</title>
<polygon fill="lightcoral" stroke="black" points="1134,-1283.65 949,-1230.65 1134,-1177.65 1319,-1230.65 1134,-1283.65"/>
<text text-anchor="middle" x="1134" y="-1241.95" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1134" y="-1226.95" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1134" y="-1211.95" font-family="Arial" font-size="14.00">GPU: 9</text>
</g>
<!-- expert_agg_3_1&#45;&gt;residual2_3_1 -->
<g id="edge101" class="edge">
<title>expert_agg_3_1&#45;&gt;residual2_3_1</title>
<path fill="none" stroke="black" d="M1134,-1320.43C1134,-1320.43 1134,-1293.82 1134,-1293.82"/>
<polygon fill="black" stroke="black" points="1137.5,-1293.82 1134,-1283.82 1130.5,-1293.82 1137.5,-1293.82"/>
</g>
<!-- allreduce_3_1 -->
<g id="node199" class="node">
<title>allreduce_3_1</title>
<ellipse fill="yellow" stroke="black" cx="1134" cy="-1103.17" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="1134" y="-1114.47" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1134" y="-1099.47" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="1134" y="-1084.47" font-family="Arial" font-size="14.00">GPU: 9</text>
</g>
<!-- residual2_3_1&#45;&gt;allreduce_3_1 -->
<g id="edge102" class="edge">
<title>residual2_3_1&#45;&gt;allreduce_3_1</title>
<path fill="none" stroke="black" d="M1134,-1177.32C1134,-1177.32 1134,-1150.78 1134,-1150.78"/>
<polygon fill="black" stroke="black" points="1137.5,-1150.78 1134,-1140.78 1130.5,-1150.78 1137.5,-1150.78"/>
</g>
<!-- ln1_4_1 -->
<g id="node277" class="node">
<title>ln1_4_1</title>
<polygon fill="lightyellow" stroke="black" points="1226.5,-970.69 1041.5,-970.69 1041.5,-917.69 1226.5,-917.69 1226.5,-970.69"/>
<text text-anchor="middle" x="1134" y="-955.49" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="1134" y="-940.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1134" y="-925.49" font-family="Arial" font-size="14.00">GPU: 9</text>
</g>
<!-- allreduce_3_1&#45;&gt;ln1_4_1 -->
<g id="edge103" class="edge">
<title>allreduce_3_1&#45;&gt;ln1_4_1</title>
<path fill="none" stroke="black" d="M1134,-1065.49C1134,-1065.49 1134,-981.16 1134,-981.16"/>
<polygon fill="black" stroke="black" points="1137.5,-981.16 1134,-971.16 1130.5,-981.16 1137.5,-981.16"/>
</g>
<!-- ln1_3_2 -->
<g id="node200" class="node">
<title>ln1_3_2</title>
<polygon fill="lightyellow" stroke="black" points="2065.5,-1931.65 1880.5,-1931.65 1880.5,-1878.65 2065.5,-1878.65 2065.5,-1931.65"/>
<text text-anchor="middle" x="1973" y="-1916.45" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="1973" y="-1901.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1973" y="-1886.45" font-family="Arial" font-size="14.00">GPU: 10</text>
</g>
<!-- attn_3_2 -->
<g id="node201" class="node">
<title>attn_3_2</title>
<polygon fill="lightgreen" stroke="black" points="2079,-1841.65 1867,-1841.65 1867,-1788.65 2079,-1788.65 2079,-1841.65"/>
<text text-anchor="middle" x="1973" y="-1826.45" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="1973" y="-1811.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1973" y="-1796.45" font-family="Arial" font-size="14.00">GPU: 10</text>
</g>
<!-- ln1_3_2&#45;&gt;attn_3_2 -->
<g id="edge147" class="edge">
<title>ln1_3_2&#45;&gt;attn_3_2</title>
<path fill="none" stroke="black" d="M1973,-1878.63C1973,-1878.63 1973,-1851.78 1973,-1851.78"/>
<polygon fill="black" stroke="black" points="1976.5,-1851.78 1973,-1841.78 1969.5,-1851.78 1976.5,-1851.78"/>
</g>
<!-- residual1_3_2 -->
<g id="node202" class="node">
<title>residual1_3_2</title>
<polygon fill="lightcoral" stroke="black" points="1973,-1751.65 1788,-1698.65 1973,-1645.65 2158,-1698.65 1973,-1751.65"/>
<text text-anchor="middle" x="1973" y="-1709.95" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="1973" y="-1694.95" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1973" y="-1679.95" font-family="Arial" font-size="14.00">GPU: 10</text>
</g>
<!-- attn_3_2&#45;&gt;residual1_3_2 -->
<g id="edge148" class="edge">
<title>attn_3_2&#45;&gt;residual1_3_2</title>
<path fill="none" stroke="black" d="M1973,-1788.42C1973,-1788.42 1973,-1761.89 1973,-1761.89"/>
<polygon fill="black" stroke="black" points="1976.5,-1761.89 1973,-1751.89 1969.5,-1761.89 1976.5,-1761.89"/>
</g>
<!-- gate_3_2 -->
<g id="node203" class="node">
<title>gate_3_2</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="2059.5,-1608.65 1886.5,-1608.65 1886.5,-1540.65 2059.5,-1540.65 2059.5,-1608.65"/>
<text text-anchor="middle" x="1973" y="-1593.45" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="1973" y="-1578.45" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="1973" y="-1563.45" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="1973" y="-1548.45" font-family="Arial" font-size="14.00">GPU: 10</text>
</g>
<!-- residual1_3_2&#45;&gt;gate_3_2 -->
<g id="edge149" class="edge">
<title>residual1_3_2&#45;&gt;gate_3_2</title>
<path fill="none" stroke="black" d="M1973,-1645.34C1973,-1645.34 1973,-1618.92 1973,-1618.92"/>
<polygon fill="black" stroke="black" points="1976.5,-1618.92 1973,-1608.92 1969.5,-1618.92 1976.5,-1618.92"/>
</g>
<!-- expert_3_2_0 -->
<g id="node204" class="node">
<title>expert_3_2_0</title>
<polygon fill="lightpink" stroke="black" points="1772,-1493.65 1596,-1493.65 1596,-1425.65 1772,-1425.65 1772,-1493.65"/>
<text text-anchor="middle" x="1684" y="-1478.45" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="1684" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="1684" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="1684" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 10</text>
</g>
<!-- gate_3_2&#45;&gt;expert_3_2_0 -->
<g id="edge150" class="edge">
<title>gate_3_2&#45;&gt;expert_3_2_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1886.32,-1563C1804.09,-1563 1693,-1563 1693,-1563 1693,-1563 1693,-1503.77 1693,-1503.77"/>
<polygon fill="black" stroke="black" points="1696.5,-1503.77 1693,-1493.77 1689.5,-1503.77 1696.5,-1503.77"/>
<text text-anchor="middle" x="1815" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_2_1 -->
<g id="node205" class="node">
<title>expert_3_2_1</title>
<polygon fill="lightpink" stroke="black" points="1966,-1493.65 1790,-1493.65 1790,-1425.65 1966,-1425.65 1966,-1493.65"/>
<text text-anchor="middle" x="1878" y="-1478.45" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1878" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="1878" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="1878" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 10</text>
</g>
<!-- gate_3_2&#45;&gt;expert_3_2_1 -->
<g id="edge152" class="edge">
<title>gate_3_2&#45;&gt;expert_3_2_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1926.25,-1540.45C1926.25,-1540.45 1926.25,-1503.91 1926.25,-1503.91"/>
<polygon fill="black" stroke="black" points="1929.75,-1503.91 1926.25,-1493.91 1922.75,-1503.91 1929.75,-1503.91"/>
<text text-anchor="middle" x="1962" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_2_2 -->
<g id="node206" class="node">
<title>expert_3_2_2</title>
<polygon fill="lightpink" stroke="black" points="2160,-1493.65 1984,-1493.65 1984,-1425.65 2160,-1425.65 2160,-1493.65"/>
<text text-anchor="middle" x="2072" y="-1478.45" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2072" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="2072" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="2072" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 10</text>
</g>
<!-- gate_3_2&#45;&gt;expert_3_2_2 -->
<g id="edge154" class="edge">
<title>gate_3_2&#45;&gt;expert_3_2_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2021.75,-1540.45C2021.75,-1540.45 2021.75,-1503.91 2021.75,-1503.91"/>
<polygon fill="black" stroke="black" points="2025.25,-1503.91 2021.75,-1493.91 2018.25,-1503.91 2025.25,-1503.91"/>
<text text-anchor="middle" x="2061" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_2_3 -->
<g id="node207" class="node">
<title>expert_3_2_3</title>
<polygon fill="lightpink" stroke="black" points="2354,-1493.65 2178,-1493.65 2178,-1425.65 2354,-1425.65 2354,-1493.65"/>
<text text-anchor="middle" x="2266" y="-1478.45" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2266" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="2266" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="2266" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 10</text>
</g>
<!-- gate_3_2&#45;&gt;expert_3_2_3 -->
<g id="edge156" class="edge">
<title>gate_3_2&#45;&gt;expert_3_2_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2059.73,-1563C2119.05,-1563 2187,-1563 2187,-1563 2187,-1563 2187,-1503.77 2187,-1503.77"/>
<polygon fill="black" stroke="black" points="2190.5,-1503.77 2187,-1493.77 2183.5,-1503.77 2190.5,-1503.77"/>
<text text-anchor="middle" x="2208" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_3_2 -->
<g id="node208" class="node">
<title>expert_agg_3_2</title>
<polygon fill="lightsteelblue" stroke="black" points="2056.5,-1388.65 1871.5,-1388.65 1871.5,-1320.65 2056.5,-1320.65 2056.5,-1388.65"/>
<text text-anchor="middle" x="1964" y="-1373.45" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1964" y="-1358.45" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="1964" y="-1343.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1964" y="-1328.45" font-family="Arial" font-size="14.00">GPU: 10</text>
</g>
<!-- expert_3_2_0&#45;&gt;expert_agg_3_2 -->
<g id="edge151" class="edge">
<title>expert_3_2_0&#45;&gt;expert_agg_3_2</title>
<path fill="none" stroke="black" d="M1713.33,-1425.59C1713.33,-1391.16 1713.33,-1343 1713.33,-1343 1713.33,-1343 1861.37,-1343 1861.37,-1343"/>
<polygon fill="black" stroke="black" points="1861.37,-1346.5 1871.37,-1343 1861.37,-1339.5 1861.37,-1346.5"/>
</g>
<!-- expert_3_2_1&#45;&gt;expert_agg_3_2 -->
<g id="edge153" class="edge">
<title>expert_3_2_1&#45;&gt;expert_agg_3_2</title>
<path fill="none" stroke="black" d="M1918.75,-1425.56C1918.75,-1425.56 1918.75,-1398.93 1918.75,-1398.93"/>
<polygon fill="black" stroke="black" points="1922.25,-1398.93 1918.75,-1388.93 1915.25,-1398.93 1922.25,-1398.93"/>
</g>
<!-- expert_3_2_2&#45;&gt;expert_agg_3_2 -->
<g id="edge155" class="edge">
<title>expert_3_2_2&#45;&gt;expert_agg_3_2</title>
<path fill="none" stroke="black" d="M2020.25,-1425.56C2020.25,-1425.56 2020.25,-1398.93 2020.25,-1398.93"/>
<polygon fill="black" stroke="black" points="2023.75,-1398.93 2020.25,-1388.93 2016.75,-1398.93 2023.75,-1398.93"/>
</g>
<!-- expert_3_2_3&#45;&gt;expert_agg_3_2 -->
<g id="edge157" class="edge">
<title>expert_3_2_3&#45;&gt;expert_agg_3_2</title>
<path fill="none" stroke="black" d="M2295.33,-1425.48C2295.33,-1398.37 2295.33,-1365 2295.33,-1365 2295.33,-1365 2066.74,-1365 2066.74,-1365"/>
<polygon fill="black" stroke="black" points="2066.74,-1361.5 2056.74,-1365 2066.74,-1368.5 2066.74,-1361.5"/>
</g>
<!-- residual2_3_2 -->
<g id="node209" class="node">
<title>residual2_3_2</title>
<polygon fill="lightcoral" stroke="black" points="1964,-1283.65 1779,-1230.65 1964,-1177.65 2149,-1230.65 1964,-1283.65"/>
<text text-anchor="middle" x="1964" y="-1241.95" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1964" y="-1226.95" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1964" y="-1211.95" font-family="Arial" font-size="14.00">GPU: 10</text>
</g>
<!-- expert_agg_3_2&#45;&gt;residual2_3_2 -->
<g id="edge158" class="edge">
<title>expert_agg_3_2&#45;&gt;residual2_3_2</title>
<path fill="none" stroke="black" d="M1964,-1320.43C1964,-1320.43 1964,-1293.82 1964,-1293.82"/>
<polygon fill="black" stroke="black" points="1967.5,-1293.82 1964,-1283.82 1960.5,-1293.82 1967.5,-1293.82"/>
</g>
<!-- allreduce_3_2 -->
<g id="node210" class="node">
<title>allreduce_3_2</title>
<ellipse fill="yellow" stroke="black" cx="1964" cy="-1103.17" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="1964" y="-1114.47" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1964" y="-1099.47" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="1964" y="-1084.47" font-family="Arial" font-size="14.00">GPU: 10</text>
</g>
<!-- residual2_3_2&#45;&gt;allreduce_3_2 -->
<g id="edge159" class="edge">
<title>residual2_3_2&#45;&gt;allreduce_3_2</title>
<path fill="none" stroke="black" d="M1964,-1177.32C1964,-1177.32 1964,-1150.78 1964,-1150.78"/>
<polygon fill="black" stroke="black" points="1967.5,-1150.78 1964,-1140.78 1960.5,-1150.78 1967.5,-1150.78"/>
</g>
<!-- ln1_4_2 -->
<g id="node288" class="node">
<title>ln1_4_2</title>
<polygon fill="lightyellow" stroke="black" points="2056.5,-970.69 1871.5,-970.69 1871.5,-917.69 2056.5,-917.69 2056.5,-970.69"/>
<text text-anchor="middle" x="1964" y="-955.49" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="1964" y="-940.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1964" y="-925.49" font-family="Arial" font-size="14.00">GPU: 10</text>
</g>
<!-- allreduce_3_2&#45;&gt;ln1_4_2 -->
<g id="edge160" class="edge">
<title>allreduce_3_2&#45;&gt;ln1_4_2</title>
<path fill="none" stroke="black" d="M1964,-1065.49C1964,-1065.49 1964,-981.16 1964,-981.16"/>
<polygon fill="black" stroke="black" points="1967.5,-981.16 1964,-971.16 1960.5,-981.16 1967.5,-981.16"/>
</g>
<!-- ln1_3_3 -->
<g id="node211" class="node">
<title>ln1_3_3</title>
<polygon fill="lightyellow" stroke="black" points="2853.5,-1931.65 2668.5,-1931.65 2668.5,-1878.65 2853.5,-1878.65 2853.5,-1931.65"/>
<text text-anchor="middle" x="2761" y="-1916.45" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="2761" y="-1901.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="2761" y="-1886.45" font-family="Arial" font-size="14.00">GPU: 11</text>
</g>
<!-- attn_3_3 -->
<g id="node212" class="node">
<title>attn_3_3</title>
<polygon fill="lightgreen" stroke="black" points="2867,-1841.65 2655,-1841.65 2655,-1788.65 2867,-1788.65 2867,-1841.65"/>
<text text-anchor="middle" x="2761" y="-1826.45" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="2761" y="-1811.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="2761" y="-1796.45" font-family="Arial" font-size="14.00">GPU: 11</text>
</g>
<!-- ln1_3_3&#45;&gt;attn_3_3 -->
<g id="edge204" class="edge">
<title>ln1_3_3&#45;&gt;attn_3_3</title>
<path fill="none" stroke="black" d="M2761,-1878.63C2761,-1878.63 2761,-1851.78 2761,-1851.78"/>
<polygon fill="black" stroke="black" points="2764.5,-1851.78 2761,-1841.78 2757.5,-1851.78 2764.5,-1851.78"/>
</g>
<!-- residual1_3_3 -->
<g id="node213" class="node">
<title>residual1_3_3</title>
<polygon fill="lightcoral" stroke="black" points="2761,-1751.65 2576,-1698.65 2761,-1645.65 2946,-1698.65 2761,-1751.65"/>
<text text-anchor="middle" x="2761" y="-1709.95" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="2761" y="-1694.95" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="2761" y="-1679.95" font-family="Arial" font-size="14.00">GPU: 11</text>
</g>
<!-- attn_3_3&#45;&gt;residual1_3_3 -->
<g id="edge205" class="edge">
<title>attn_3_3&#45;&gt;residual1_3_3</title>
<path fill="none" stroke="black" d="M2761,-1788.42C2761,-1788.42 2761,-1761.89 2761,-1761.89"/>
<polygon fill="black" stroke="black" points="2764.5,-1761.89 2761,-1751.89 2757.5,-1761.89 2764.5,-1761.89"/>
</g>
<!-- gate_3_3 -->
<g id="node214" class="node">
<title>gate_3_3</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="2847.5,-1608.65 2674.5,-1608.65 2674.5,-1540.65 2847.5,-1540.65 2847.5,-1608.65"/>
<text text-anchor="middle" x="2761" y="-1593.45" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="2761" y="-1578.45" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="2761" y="-1563.45" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="2761" y="-1548.45" font-family="Arial" font-size="14.00">GPU: 11</text>
</g>
<!-- residual1_3_3&#45;&gt;gate_3_3 -->
<g id="edge206" class="edge">
<title>residual1_3_3&#45;&gt;gate_3_3</title>
<path fill="none" stroke="black" d="M2761,-1645.34C2761,-1645.34 2761,-1618.92 2761,-1618.92"/>
<polygon fill="black" stroke="black" points="2764.5,-1618.92 2761,-1608.92 2757.5,-1618.92 2764.5,-1618.92"/>
</g>
<!-- expert_3_3_0 -->
<g id="node215" class="node">
<title>expert_3_3_0</title>
<polygon fill="lightpink" stroke="black" points="2554,-1493.65 2378,-1493.65 2378,-1425.65 2554,-1425.65 2554,-1493.65"/>
<text text-anchor="middle" x="2466" y="-1478.45" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="2466" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="2466" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="2466" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 11</text>
</g>
<!-- gate_3_3&#45;&gt;expert_3_3_0 -->
<g id="edge207" class="edge">
<title>gate_3_3&#45;&gt;expert_3_3_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2674.41,-1585C2590.24,-1585 2475,-1585 2475,-1585 2475,-1585 2475,-1503.9 2475,-1503.9"/>
<polygon fill="black" stroke="black" points="2478.5,-1503.9 2475,-1493.9 2471.5,-1503.9 2478.5,-1503.9"/>
<text text-anchor="middle" x="2566" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_3_1 -->
<g id="node216" class="node">
<title>expert_3_3_1</title>
<polygon fill="lightpink" stroke="black" points="2748,-1493.65 2572,-1493.65 2572,-1425.65 2748,-1425.65 2748,-1493.65"/>
<text text-anchor="middle" x="2660" y="-1478.45" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="2660" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="2660" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="2660" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 11</text>
</g>
<!-- gate_3_3&#45;&gt;expert_3_3_1 -->
<g id="edge209" class="edge">
<title>gate_3_3&#45;&gt;expert_3_3_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2711.25,-1540.45C2711.25,-1540.45 2711.25,-1503.91 2711.25,-1503.91"/>
<polygon fill="black" stroke="black" points="2714.75,-1503.91 2711.25,-1493.91 2707.75,-1503.91 2714.75,-1503.91"/>
<text text-anchor="middle" x="2689" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_3_2 -->
<g id="node217" class="node">
<title>expert_3_3_2</title>
<polygon fill="lightpink" stroke="black" points="2942,-1493.65 2766,-1493.65 2766,-1425.65 2942,-1425.65 2942,-1493.65"/>
<text text-anchor="middle" x="2854" y="-1478.45" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2854" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="2854" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="2854" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 11</text>
</g>
<!-- gate_3_3&#45;&gt;expert_3_3_2 -->
<g id="edge211" class="edge">
<title>gate_3_3&#45;&gt;expert_3_3_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2806.75,-1540.45C2806.75,-1540.45 2806.75,-1503.91 2806.75,-1503.91"/>
<polygon fill="black" stroke="black" points="2810.25,-1503.91 2806.75,-1493.91 2803.25,-1503.91 2810.25,-1503.91"/>
<text text-anchor="middle" x="2812" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_3_3 -->
<g id="node218" class="node">
<title>expert_3_3_3</title>
<polygon fill="lightpink" stroke="black" points="3136,-1493.65 2960,-1493.65 2960,-1425.65 3136,-1425.65 3136,-1493.65"/>
<text text-anchor="middle" x="3048" y="-1478.45" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="3048" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="3048" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="3048" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 11</text>
</g>
<!-- gate_3_3&#45;&gt;expert_3_3_3 -->
<g id="edge213" class="edge">
<title>gate_3_3&#45;&gt;expert_3_3_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2847.7,-1585C2904.78,-1585 2969,-1585 2969,-1585 2969,-1585 2969,-1503.9 2969,-1503.9"/>
<polygon fill="black" stroke="black" points="2972.5,-1503.9 2969,-1493.9 2965.5,-1503.9 2972.5,-1503.9"/>
<text text-anchor="middle" x="2971" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_3_3 -->
<g id="node219" class="node">
<title>expert_agg_3_3</title>
<polygon fill="lightsteelblue" stroke="black" points="2790.5,-1388.65 2605.5,-1388.65 2605.5,-1320.65 2790.5,-1320.65 2790.5,-1388.65"/>
<text text-anchor="middle" x="2698" y="-1373.45" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="2698" y="-1358.45" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="2698" y="-1343.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="2698" y="-1328.45" font-family="Arial" font-size="14.00">GPU: 11</text>
</g>
<!-- expert_3_3_0&#45;&gt;expert_agg_3_3 -->
<g id="edge208" class="edge">
<title>expert_3_3_0&#45;&gt;expert_agg_3_3</title>
<path fill="none" stroke="black" d="M2533.5,-1425.59C2533.5,-1391.16 2533.5,-1343 2533.5,-1343 2533.5,-1343 2595.17,-1343 2595.17,-1343"/>
<polygon fill="black" stroke="black" points="2595.17,-1346.5 2605.17,-1343 2595.17,-1339.5 2595.17,-1346.5"/>
</g>
<!-- expert_3_3_1&#45;&gt;expert_agg_3_3 -->
<g id="edge210" class="edge">
<title>expert_3_3_1&#45;&gt;expert_agg_3_3</title>
<path fill="none" stroke="black" d="M2676.75,-1425.56C2676.75,-1425.56 2676.75,-1398.93 2676.75,-1398.93"/>
<polygon fill="black" stroke="black" points="2680.25,-1398.93 2676.75,-1388.93 2673.25,-1398.93 2680.25,-1398.93"/>
</g>
<!-- expert_3_3_2&#45;&gt;expert_agg_3_3 -->
<g id="edge212" class="edge">
<title>expert_3_3_2&#45;&gt;expert_agg_3_3</title>
<path fill="none" stroke="black" d="M2778.25,-1425.56C2778.25,-1425.56 2778.25,-1398.93 2778.25,-1398.93"/>
<polygon fill="black" stroke="black" points="2781.75,-1398.93 2778.25,-1388.93 2774.75,-1398.93 2781.75,-1398.93"/>
</g>
<!-- expert_3_3_3&#45;&gt;expert_agg_3_3 -->
<g id="edge214" class="edge">
<title>expert_3_3_3&#45;&gt;expert_agg_3_3</title>
<path fill="none" stroke="black" d="M3077.33,-1425.48C3077.33,-1398.37 3077.33,-1365 3077.33,-1365 3077.33,-1365 2800.8,-1365 2800.8,-1365"/>
<polygon fill="black" stroke="black" points="2800.8,-1361.5 2790.8,-1365 2800.8,-1368.5 2800.8,-1361.5"/>
</g>
<!-- residual2_3_3 -->
<g id="node220" class="node">
<title>residual2_3_3</title>
<polygon fill="lightcoral" stroke="black" points="2698,-1283.65 2513,-1230.65 2698,-1177.65 2883,-1230.65 2698,-1283.65"/>
<text text-anchor="middle" x="2698" y="-1241.95" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="2698" y="-1226.95" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="2698" y="-1211.95" font-family="Arial" font-size="14.00">GPU: 11</text>
</g>
<!-- expert_agg_3_3&#45;&gt;residual2_3_3 -->
<g id="edge215" class="edge">
<title>expert_agg_3_3&#45;&gt;residual2_3_3</title>
<path fill="none" stroke="black" d="M2698,-1320.43C2698,-1320.43 2698,-1293.82 2698,-1293.82"/>
<polygon fill="black" stroke="black" points="2701.5,-1293.82 2698,-1283.82 2694.5,-1293.82 2701.5,-1293.82"/>
</g>
<!-- allreduce_3_3 -->
<g id="node221" class="node">
<title>allreduce_3_3</title>
<ellipse fill="yellow" stroke="black" cx="2698" cy="-1103.17" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="2698" y="-1114.47" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="2698" y="-1099.47" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="2698" y="-1084.47" font-family="Arial" font-size="14.00">GPU: 11</text>
</g>
<!-- residual2_3_3&#45;&gt;allreduce_3_3 -->
<g id="edge216" class="edge">
<title>residual2_3_3&#45;&gt;allreduce_3_3</title>
<path fill="none" stroke="black" d="M2698,-1177.32C2698,-1177.32 2698,-1150.78 2698,-1150.78"/>
<polygon fill="black" stroke="black" points="2701.5,-1150.78 2698,-1140.78 2694.5,-1150.78 2701.5,-1150.78"/>
</g>
<!-- ln1_4_3 -->
<g id="node299" class="node">
<title>ln1_4_3</title>
<polygon fill="lightyellow" stroke="black" points="2790.5,-970.69 2605.5,-970.69 2605.5,-917.69 2790.5,-917.69 2790.5,-970.69"/>
<text text-anchor="middle" x="2698" y="-955.49" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="2698" y="-940.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="2698" y="-925.49" font-family="Arial" font-size="14.00">GPU: 11</text>
</g>
<!-- allreduce_3_3&#45;&gt;ln1_4_3 -->
<g id="edge217" class="edge">
<title>allreduce_3_3&#45;&gt;ln1_4_3</title>
<path fill="none" stroke="black" d="M2698,-1065.49C2698,-1065.49 2698,-981.16 2698,-981.16"/>
<polygon fill="black" stroke="black" points="2701.5,-981.16 2698,-971.16 2694.5,-981.16 2701.5,-981.16"/>
</g>
<!-- ln1_3_4 -->
<g id="node222" class="node">
<title>ln1_3_4</title>
<polygon fill="lightyellow" stroke="black" points="3581.5,-1931.65 3396.5,-1931.65 3396.5,-1878.65 3581.5,-1878.65 3581.5,-1931.65"/>
<text text-anchor="middle" x="3489" y="-1916.45" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="3489" y="-1901.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="3489" y="-1886.45" font-family="Arial" font-size="14.00">GPU: 12</text>
</g>
<!-- attn_3_4 -->
<g id="node223" class="node">
<title>attn_3_4</title>
<polygon fill="lightgreen" stroke="black" points="3595,-1841.65 3383,-1841.65 3383,-1788.65 3595,-1788.65 3595,-1841.65"/>
<text text-anchor="middle" x="3489" y="-1826.45" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="3489" y="-1811.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="3489" y="-1796.45" font-family="Arial" font-size="14.00">GPU: 12</text>
</g>
<!-- ln1_3_4&#45;&gt;attn_3_4 -->
<g id="edge261" class="edge">
<title>ln1_3_4&#45;&gt;attn_3_4</title>
<path fill="none" stroke="black" d="M3489,-1878.63C3489,-1878.63 3489,-1851.78 3489,-1851.78"/>
<polygon fill="black" stroke="black" points="3492.5,-1851.78 3489,-1841.78 3485.5,-1851.78 3492.5,-1851.78"/>
</g>
<!-- residual1_3_4 -->
<g id="node224" class="node">
<title>residual1_3_4</title>
<polygon fill="lightcoral" stroke="black" points="3489,-1751.65 3304,-1698.65 3489,-1645.65 3674,-1698.65 3489,-1751.65"/>
<text text-anchor="middle" x="3489" y="-1709.95" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="3489" y="-1694.95" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="3489" y="-1679.95" font-family="Arial" font-size="14.00">GPU: 12</text>
</g>
<!-- attn_3_4&#45;&gt;residual1_3_4 -->
<g id="edge262" class="edge">
<title>attn_3_4&#45;&gt;residual1_3_4</title>
<path fill="none" stroke="black" d="M3489,-1788.42C3489,-1788.42 3489,-1761.89 3489,-1761.89"/>
<polygon fill="black" stroke="black" points="3492.5,-1761.89 3489,-1751.89 3485.5,-1761.89 3492.5,-1761.89"/>
</g>
<!-- gate_3_4 -->
<g id="node225" class="node">
<title>gate_3_4</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="3575.5,-1608.65 3402.5,-1608.65 3402.5,-1540.65 3575.5,-1540.65 3575.5,-1608.65"/>
<text text-anchor="middle" x="3489" y="-1593.45" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="3489" y="-1578.45" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="3489" y="-1563.45" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="3489" y="-1548.45" font-family="Arial" font-size="14.00">GPU: 12</text>
</g>
<!-- residual1_3_4&#45;&gt;gate_3_4 -->
<g id="edge263" class="edge">
<title>residual1_3_4&#45;&gt;gate_3_4</title>
<path fill="none" stroke="black" d="M3489,-1645.34C3489,-1645.34 3489,-1618.92 3489,-1618.92"/>
<polygon fill="black" stroke="black" points="3492.5,-1618.92 3489,-1608.92 3485.5,-1618.92 3492.5,-1618.92"/>
</g>
<!-- expert_3_4_0 -->
<g id="node226" class="node">
<title>expert_3_4_0</title>
<polygon fill="lightpink" stroke="black" points="3336,-1493.65 3160,-1493.65 3160,-1425.65 3336,-1425.65 3336,-1493.65"/>
<text text-anchor="middle" x="3248" y="-1478.45" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="3248" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="3248" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="3248" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 12</text>
</g>
<!-- gate_3_4&#45;&gt;expert_3_4_0 -->
<g id="edge264" class="edge">
<title>gate_3_4&#45;&gt;expert_3_4_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3402.02,-1563C3360.62,-1563 3320,-1563 3320,-1563 3320,-1563 3320,-1503.77 3320,-1503.77"/>
<polygon fill="black" stroke="black" points="3323.5,-1503.77 3320,-1493.77 3316.5,-1503.77 3323.5,-1503.77"/>
<text text-anchor="middle" x="3379" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_4_1 -->
<g id="node227" class="node">
<title>expert_3_4_1</title>
<polygon fill="lightpink" stroke="black" points="3530,-1493.65 3354,-1493.65 3354,-1425.65 3530,-1425.65 3530,-1493.65"/>
<text text-anchor="middle" x="3442" y="-1478.45" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="3442" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="3442" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="3442" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 12</text>
</g>
<!-- gate_3_4&#45;&gt;expert_3_4_1 -->
<g id="edge266" class="edge">
<title>gate_3_4&#45;&gt;expert_3_4_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3466.25,-1540.45C3466.25,-1540.45 3466.25,-1503.91 3466.25,-1503.91"/>
<polygon fill="black" stroke="black" points="3469.75,-1503.91 3466.25,-1493.91 3462.75,-1503.91 3469.75,-1503.91"/>
<text text-anchor="middle" x="3503" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_4_2 -->
<g id="node228" class="node">
<title>expert_3_4_2</title>
<polygon fill="lightpink" stroke="black" points="3724,-1493.65 3548,-1493.65 3548,-1425.65 3724,-1425.65 3724,-1493.65"/>
<text text-anchor="middle" x="3636" y="-1478.45" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="3636" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="3636" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="3636" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 12</text>
</g>
<!-- gate_3_4&#45;&gt;expert_3_4_2 -->
<g id="edge268" class="edge">
<title>gate_3_4&#45;&gt;expert_3_4_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3561.75,-1540.45C3561.75,-1540.45 3561.75,-1503.91 3561.75,-1503.91"/>
<polygon fill="black" stroke="black" points="3565.25,-1503.91 3561.75,-1493.91 3558.25,-1503.91 3565.25,-1503.91"/>
<text text-anchor="middle" x="3625" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_4_3 -->
<g id="node229" class="node">
<title>expert_3_4_3</title>
<polygon fill="lightpink" stroke="black" points="3918,-1493.65 3742,-1493.65 3742,-1425.65 3918,-1425.65 3918,-1493.65"/>
<text text-anchor="middle" x="3830" y="-1478.45" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="3830" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="3830" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="3830" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 12</text>
</g>
<!-- gate_3_4&#45;&gt;expert_3_4_3 -->
<g id="edge270" class="edge">
<title>gate_3_4&#45;&gt;expert_3_4_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3575.51,-1585C3651.83,-1585 3751,-1585 3751,-1585 3751,-1585 3751,-1503.9 3751,-1503.9"/>
<polygon fill="black" stroke="black" points="3754.5,-1503.9 3751,-1493.9 3747.5,-1503.9 3754.5,-1503.9"/>
<text text-anchor="middle" x="3783" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_3_4 -->
<g id="node230" class="node">
<title>expert_agg_3_4</title>
<polygon fill="lightsteelblue" stroke="black" points="3587.5,-1388.65 3402.5,-1388.65 3402.5,-1320.65 3587.5,-1320.65 3587.5,-1388.65"/>
<text text-anchor="middle" x="3495" y="-1373.45" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="3495" y="-1358.45" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="3495" y="-1343.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="3495" y="-1328.45" font-family="Arial" font-size="14.00">GPU: 12</text>
</g>
<!-- expert_3_4_0&#45;&gt;expert_agg_3_4 -->
<g id="edge265" class="edge">
<title>expert_3_4_0&#45;&gt;expert_agg_3_4</title>
<path fill="none" stroke="black" d="M3323,-1425.59C3323,-1391.16 3323,-1343 3323,-1343 3323,-1343 3392.45,-1343 3392.45,-1343"/>
<polygon fill="black" stroke="black" points="3392.45,-1346.5 3402.45,-1343 3392.45,-1339.5 3392.45,-1346.5"/>
</g>
<!-- expert_3_4_1&#45;&gt;expert_agg_3_4 -->
<g id="edge267" class="edge">
<title>expert_3_4_1&#45;&gt;expert_agg_3_4</title>
<path fill="none" stroke="black" d="M3466.25,-1425.56C3466.25,-1425.56 3466.25,-1398.93 3466.25,-1398.93"/>
<polygon fill="black" stroke="black" points="3469.75,-1398.93 3466.25,-1388.93 3462.75,-1398.93 3469.75,-1398.93"/>
</g>
<!-- expert_3_4_2&#45;&gt;expert_agg_3_4 -->
<g id="edge269" class="edge">
<title>expert_3_4_2&#45;&gt;expert_agg_3_4</title>
<path fill="none" stroke="black" d="M3567.75,-1425.56C3567.75,-1425.56 3567.75,-1398.93 3567.75,-1398.93"/>
<polygon fill="black" stroke="black" points="3571.25,-1398.93 3567.75,-1388.93 3564.25,-1398.93 3571.25,-1398.93"/>
</g>
<!-- expert_3_4_3&#45;&gt;expert_agg_3_4 -->
<g id="edge271" class="edge">
<title>expert_3_4_3&#45;&gt;expert_agg_3_4</title>
<path fill="none" stroke="black" d="M3859.33,-1425.48C3859.33,-1398.37 3859.33,-1365 3859.33,-1365 3859.33,-1365 3597.88,-1365 3597.88,-1365"/>
<polygon fill="black" stroke="black" points="3597.88,-1361.5 3587.88,-1365 3597.88,-1368.5 3597.88,-1361.5"/>
</g>
<!-- residual2_3_4 -->
<g id="node231" class="node">
<title>residual2_3_4</title>
<polygon fill="lightcoral" stroke="black" points="3495,-1283.65 3310,-1230.65 3495,-1177.65 3680,-1230.65 3495,-1283.65"/>
<text text-anchor="middle" x="3495" y="-1241.95" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="3495" y="-1226.95" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="3495" y="-1211.95" font-family="Arial" font-size="14.00">GPU: 12</text>
</g>
<!-- expert_agg_3_4&#45;&gt;residual2_3_4 -->
<g id="edge272" class="edge">
<title>expert_agg_3_4&#45;&gt;residual2_3_4</title>
<path fill="none" stroke="black" d="M3495,-1320.43C3495,-1320.43 3495,-1293.82 3495,-1293.82"/>
<polygon fill="black" stroke="black" points="3498.5,-1293.82 3495,-1283.82 3491.5,-1293.82 3498.5,-1293.82"/>
</g>
<!-- allreduce_3_4 -->
<g id="node232" class="node">
<title>allreduce_3_4</title>
<ellipse fill="yellow" stroke="black" cx="3495" cy="-1103.17" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="3495" y="-1114.47" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="3495" y="-1099.47" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="3495" y="-1084.47" font-family="Arial" font-size="14.00">GPU: 12</text>
</g>
<!-- residual2_3_4&#45;&gt;allreduce_3_4 -->
<g id="edge273" class="edge">
<title>residual2_3_4&#45;&gt;allreduce_3_4</title>
<path fill="none" stroke="black" d="M3495,-1177.32C3495,-1177.32 3495,-1150.78 3495,-1150.78"/>
<polygon fill="black" stroke="black" points="3498.5,-1150.78 3495,-1140.78 3491.5,-1150.78 3498.5,-1150.78"/>
</g>
<!-- ln1_4_4 -->
<g id="node310" class="node">
<title>ln1_4_4</title>
<polygon fill="lightyellow" stroke="black" points="3587.5,-970.69 3402.5,-970.69 3402.5,-917.69 3587.5,-917.69 3587.5,-970.69"/>
<text text-anchor="middle" x="3495" y="-955.49" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="3495" y="-940.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="3495" y="-925.49" font-family="Arial" font-size="14.00">GPU: 12</text>
</g>
<!-- allreduce_3_4&#45;&gt;ln1_4_4 -->
<g id="edge274" class="edge">
<title>allreduce_3_4&#45;&gt;ln1_4_4</title>
<path fill="none" stroke="black" d="M3495,-1065.49C3495,-1065.49 3495,-981.16 3495,-981.16"/>
<polygon fill="black" stroke="black" points="3498.5,-981.16 3495,-971.16 3491.5,-981.16 3498.5,-981.16"/>
</g>
<!-- ln1_3_5 -->
<g id="node233" class="node">
<title>ln1_3_5</title>
<polygon fill="lightyellow" stroke="black" points="4371.5,-1931.65 4186.5,-1931.65 4186.5,-1878.65 4371.5,-1878.65 4371.5,-1931.65"/>
<text text-anchor="middle" x="4279" y="-1916.45" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="4279" y="-1901.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="4279" y="-1886.45" font-family="Arial" font-size="14.00">GPU: 13</text>
</g>
<!-- attn_3_5 -->
<g id="node234" class="node">
<title>attn_3_5</title>
<polygon fill="lightgreen" stroke="black" points="4385,-1841.65 4173,-1841.65 4173,-1788.65 4385,-1788.65 4385,-1841.65"/>
<text text-anchor="middle" x="4279" y="-1826.45" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="4279" y="-1811.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="4279" y="-1796.45" font-family="Arial" font-size="14.00">GPU: 13</text>
</g>
<!-- ln1_3_5&#45;&gt;attn_3_5 -->
<g id="edge318" class="edge">
<title>ln1_3_5&#45;&gt;attn_3_5</title>
<path fill="none" stroke="black" d="M4279,-1878.63C4279,-1878.63 4279,-1851.78 4279,-1851.78"/>
<polygon fill="black" stroke="black" points="4282.5,-1851.78 4279,-1841.78 4275.5,-1851.78 4282.5,-1851.78"/>
</g>
<!-- residual1_3_5 -->
<g id="node235" class="node">
<title>residual1_3_5</title>
<polygon fill="lightcoral" stroke="black" points="4279,-1751.65 4094,-1698.65 4279,-1645.65 4464,-1698.65 4279,-1751.65"/>
<text text-anchor="middle" x="4279" y="-1709.95" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="4279" y="-1694.95" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="4279" y="-1679.95" font-family="Arial" font-size="14.00">GPU: 13</text>
</g>
<!-- attn_3_5&#45;&gt;residual1_3_5 -->
<g id="edge319" class="edge">
<title>attn_3_5&#45;&gt;residual1_3_5</title>
<path fill="none" stroke="black" d="M4279,-1788.42C4279,-1788.42 4279,-1761.89 4279,-1761.89"/>
<polygon fill="black" stroke="black" points="4282.5,-1761.89 4279,-1751.89 4275.5,-1761.89 4282.5,-1761.89"/>
</g>
<!-- gate_3_5 -->
<g id="node236" class="node">
<title>gate_3_5</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="4365.5,-1608.65 4192.5,-1608.65 4192.5,-1540.65 4365.5,-1540.65 4365.5,-1608.65"/>
<text text-anchor="middle" x="4279" y="-1593.45" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="4279" y="-1578.45" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="4279" y="-1563.45" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="4279" y="-1548.45" font-family="Arial" font-size="14.00">GPU: 13</text>
</g>
<!-- residual1_3_5&#45;&gt;gate_3_5 -->
<g id="edge320" class="edge">
<title>residual1_3_5&#45;&gt;gate_3_5</title>
<path fill="none" stroke="black" d="M4279,-1645.34C4279,-1645.34 4279,-1618.92 4279,-1618.92"/>
<polygon fill="black" stroke="black" points="4282.5,-1618.92 4279,-1608.92 4275.5,-1618.92 4282.5,-1618.92"/>
</g>
<!-- expert_3_5_0 -->
<g id="node237" class="node">
<title>expert_3_5_0</title>
<polygon fill="lightpink" stroke="black" points="4118,-1493.65 3942,-1493.65 3942,-1425.65 4118,-1425.65 4118,-1493.65"/>
<text text-anchor="middle" x="4030" y="-1478.45" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="4030" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="4030" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="4030" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 13</text>
</g>
<!-- gate_3_5&#45;&gt;expert_3_5_0 -->
<g id="edge321" class="edge">
<title>gate_3_5&#45;&gt;expert_3_5_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4192.25,-1563C4149.08,-1563 4106,-1563 4106,-1563 4106,-1563 4106,-1503.77 4106,-1503.77"/>
<polygon fill="black" stroke="black" points="4109.5,-1503.77 4106,-1493.77 4102.5,-1503.77 4109.5,-1503.77"/>
<text text-anchor="middle" x="4171" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_5_1 -->
<g id="node238" class="node">
<title>expert_3_5_1</title>
<polygon fill="lightpink" stroke="black" points="4312,-1493.65 4136,-1493.65 4136,-1425.65 4312,-1425.65 4312,-1493.65"/>
<text text-anchor="middle" x="4224" y="-1478.45" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="4224" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="4224" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="4224" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 13</text>
</g>
<!-- gate_3_5&#45;&gt;expert_3_5_1 -->
<g id="edge323" class="edge">
<title>gate_3_5&#45;&gt;expert_3_5_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4252.25,-1540.45C4252.25,-1540.45 4252.25,-1503.91 4252.25,-1503.91"/>
<polygon fill="black" stroke="black" points="4255.75,-1503.91 4252.25,-1493.91 4248.75,-1503.91 4255.75,-1503.91"/>
<text text-anchor="middle" x="4294" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_5_2 -->
<g id="node239" class="node">
<title>expert_3_5_2</title>
<polygon fill="lightpink" stroke="black" points="4506,-1493.65 4330,-1493.65 4330,-1425.65 4506,-1425.65 4506,-1493.65"/>
<text text-anchor="middle" x="4418" y="-1478.45" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="4418" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="4418" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="4418" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 13</text>
</g>
<!-- gate_3_5&#45;&gt;expert_3_5_2 -->
<g id="edge325" class="edge">
<title>gate_3_5&#45;&gt;expert_3_5_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4347.75,-1540.45C4347.75,-1540.45 4347.75,-1503.91 4347.75,-1503.91"/>
<polygon fill="black" stroke="black" points="4351.25,-1503.91 4347.75,-1493.91 4344.25,-1503.91 4351.25,-1503.91"/>
<text text-anchor="middle" x="4417" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_5_3 -->
<g id="node240" class="node">
<title>expert_3_5_3</title>
<polygon fill="lightpink" stroke="black" points="4700,-1493.65 4524,-1493.65 4524,-1425.65 4700,-1425.65 4700,-1493.65"/>
<text text-anchor="middle" x="4612" y="-1478.45" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="4612" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="4612" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="4612" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 13</text>
</g>
<!-- gate_3_5&#45;&gt;expert_3_5_3 -->
<g id="edge327" class="edge">
<title>gate_3_5&#45;&gt;expert_3_5_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4365.7,-1585C4439.28,-1585 4533,-1585 4533,-1585 4533,-1585 4533,-1503.9 4533,-1503.9"/>
<polygon fill="black" stroke="black" points="4536.5,-1503.9 4533,-1493.9 4529.5,-1503.9 4536.5,-1503.9"/>
<text text-anchor="middle" x="4576" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_3_5 -->
<g id="node241" class="node">
<title>expert_agg_3_5</title>
<polygon fill="lightsteelblue" stroke="black" points="4354.5,-1388.65 4169.5,-1388.65 4169.5,-1320.65 4354.5,-1320.65 4354.5,-1388.65"/>
<text text-anchor="middle" x="4262" y="-1373.45" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="4262" y="-1358.45" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="4262" y="-1343.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="4262" y="-1328.45" font-family="Arial" font-size="14.00">GPU: 13</text>
</g>
<!-- expert_3_5_0&#45;&gt;expert_agg_3_5 -->
<g id="edge322" class="edge">
<title>expert_3_5_0&#45;&gt;expert_agg_3_5</title>
<path fill="none" stroke="black" d="M4097.5,-1425.59C4097.5,-1391.16 4097.5,-1343 4097.5,-1343 4097.5,-1343 4159.17,-1343 4159.17,-1343"/>
<polygon fill="black" stroke="black" points="4159.17,-1346.5 4169.17,-1343 4159.17,-1339.5 4159.17,-1346.5"/>
</g>
<!-- expert_3_5_1&#45;&gt;expert_agg_3_5 -->
<g id="edge324" class="edge">
<title>expert_3_5_1&#45;&gt;expert_agg_3_5</title>
<path fill="none" stroke="black" d="M4240.75,-1425.56C4240.75,-1425.56 4240.75,-1398.93 4240.75,-1398.93"/>
<polygon fill="black" stroke="black" points="4244.25,-1398.93 4240.75,-1388.93 4237.25,-1398.93 4244.25,-1398.93"/>
</g>
<!-- expert_3_5_2&#45;&gt;expert_agg_3_5 -->
<g id="edge326" class="edge">
<title>expert_3_5_2&#45;&gt;expert_agg_3_5</title>
<path fill="none" stroke="black" d="M4342.25,-1425.56C4342.25,-1425.56 4342.25,-1398.93 4342.25,-1398.93"/>
<polygon fill="black" stroke="black" points="4345.75,-1398.93 4342.25,-1388.93 4338.75,-1398.93 4345.75,-1398.93"/>
</g>
<!-- expert_3_5_3&#45;&gt;expert_agg_3_5 -->
<g id="edge328" class="edge">
<title>expert_3_5_3&#45;&gt;expert_agg_3_5</title>
<path fill="none" stroke="black" d="M4641.33,-1425.48C4641.33,-1398.37 4641.33,-1365 4641.33,-1365 4641.33,-1365 4364.8,-1365 4364.8,-1365"/>
<polygon fill="black" stroke="black" points="4364.8,-1361.5 4354.8,-1365 4364.8,-1368.5 4364.8,-1361.5"/>
</g>
<!-- residual2_3_5 -->
<g id="node242" class="node">
<title>residual2_3_5</title>
<polygon fill="lightcoral" stroke="black" points="4262,-1283.65 4077,-1230.65 4262,-1177.65 4447,-1230.65 4262,-1283.65"/>
<text text-anchor="middle" x="4262" y="-1241.95" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="4262" y="-1226.95" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="4262" y="-1211.95" font-family="Arial" font-size="14.00">GPU: 13</text>
</g>
<!-- expert_agg_3_5&#45;&gt;residual2_3_5 -->
<g id="edge329" class="edge">
<title>expert_agg_3_5&#45;&gt;residual2_3_5</title>
<path fill="none" stroke="black" d="M4262,-1320.43C4262,-1320.43 4262,-1293.82 4262,-1293.82"/>
<polygon fill="black" stroke="black" points="4265.5,-1293.82 4262,-1283.82 4258.5,-1293.82 4265.5,-1293.82"/>
</g>
<!-- allreduce_3_5 -->
<g id="node243" class="node">
<title>allreduce_3_5</title>
<ellipse fill="yellow" stroke="black" cx="4262" cy="-1103.17" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="4262" y="-1114.47" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="4262" y="-1099.47" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="4262" y="-1084.47" font-family="Arial" font-size="14.00">GPU: 13</text>
</g>
<!-- residual2_3_5&#45;&gt;allreduce_3_5 -->
<g id="edge330" class="edge">
<title>residual2_3_5&#45;&gt;allreduce_3_5</title>
<path fill="none" stroke="black" d="M4262,-1177.32C4262,-1177.32 4262,-1150.78 4262,-1150.78"/>
<polygon fill="black" stroke="black" points="4265.5,-1150.78 4262,-1140.78 4258.5,-1150.78 4265.5,-1150.78"/>
</g>
<!-- ln1_4_5 -->
<g id="node321" class="node">
<title>ln1_4_5</title>
<polygon fill="lightyellow" stroke="black" points="4354.5,-970.69 4169.5,-970.69 4169.5,-917.69 4354.5,-917.69 4354.5,-970.69"/>
<text text-anchor="middle" x="4262" y="-955.49" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="4262" y="-940.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="4262" y="-925.49" font-family="Arial" font-size="14.00">GPU: 13</text>
</g>
<!-- allreduce_3_5&#45;&gt;ln1_4_5 -->
<g id="edge331" class="edge">
<title>allreduce_3_5&#45;&gt;ln1_4_5</title>
<path fill="none" stroke="black" d="M4262,-1065.49C4262,-1065.49 4262,-981.16 4262,-981.16"/>
<polygon fill="black" stroke="black" points="4265.5,-981.16 4262,-971.16 4258.5,-981.16 4265.5,-981.16"/>
</g>
<!-- ln1_3_6 -->
<g id="node244" class="node">
<title>ln1_3_6</title>
<polygon fill="lightyellow" stroke="black" points="5162.5,-1931.65 4977.5,-1931.65 4977.5,-1878.65 5162.5,-1878.65 5162.5,-1931.65"/>
<text text-anchor="middle" x="5070" y="-1916.45" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="5070" y="-1901.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5070" y="-1886.45" font-family="Arial" font-size="14.00">GPU: 14</text>
</g>
<!-- attn_3_6 -->
<g id="node245" class="node">
<title>attn_3_6</title>
<polygon fill="lightgreen" stroke="black" points="5176,-1841.65 4964,-1841.65 4964,-1788.65 5176,-1788.65 5176,-1841.65"/>
<text text-anchor="middle" x="5070" y="-1826.45" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="5070" y="-1811.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5070" y="-1796.45" font-family="Arial" font-size="14.00">GPU: 14</text>
</g>
<!-- ln1_3_6&#45;&gt;attn_3_6 -->
<g id="edge375" class="edge">
<title>ln1_3_6&#45;&gt;attn_3_6</title>
<path fill="none" stroke="black" d="M5070,-1878.63C5070,-1878.63 5070,-1851.78 5070,-1851.78"/>
<polygon fill="black" stroke="black" points="5073.5,-1851.78 5070,-1841.78 5066.5,-1851.78 5073.5,-1851.78"/>
</g>
<!-- residual1_3_6 -->
<g id="node246" class="node">
<title>residual1_3_6</title>
<polygon fill="lightcoral" stroke="black" points="5070,-1751.65 4885,-1698.65 5070,-1645.65 5255,-1698.65 5070,-1751.65"/>
<text text-anchor="middle" x="5070" y="-1709.95" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="5070" y="-1694.95" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5070" y="-1679.95" font-family="Arial" font-size="14.00">GPU: 14</text>
</g>
<!-- attn_3_6&#45;&gt;residual1_3_6 -->
<g id="edge376" class="edge">
<title>attn_3_6&#45;&gt;residual1_3_6</title>
<path fill="none" stroke="black" d="M5070,-1788.42C5070,-1788.42 5070,-1761.89 5070,-1761.89"/>
<polygon fill="black" stroke="black" points="5073.5,-1761.89 5070,-1751.89 5066.5,-1761.89 5073.5,-1761.89"/>
</g>
<!-- gate_3_6 -->
<g id="node247" class="node">
<title>gate_3_6</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="5156.5,-1608.65 4983.5,-1608.65 4983.5,-1540.65 5156.5,-1540.65 5156.5,-1608.65"/>
<text text-anchor="middle" x="5070" y="-1593.45" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="5070" y="-1578.45" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="5070" y="-1563.45" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="5070" y="-1548.45" font-family="Arial" font-size="14.00">GPU: 14</text>
</g>
<!-- residual1_3_6&#45;&gt;gate_3_6 -->
<g id="edge377" class="edge">
<title>residual1_3_6&#45;&gt;gate_3_6</title>
<path fill="none" stroke="black" d="M5070,-1645.34C5070,-1645.34 5070,-1618.92 5070,-1618.92"/>
<polygon fill="black" stroke="black" points="5073.5,-1618.92 5070,-1608.92 5066.5,-1618.92 5073.5,-1618.92"/>
</g>
<!-- expert_3_6_0 -->
<g id="node248" class="node">
<title>expert_3_6_0</title>
<polygon fill="lightpink" stroke="black" points="4900,-1493.65 4724,-1493.65 4724,-1425.65 4900,-1425.65 4900,-1493.65"/>
<text text-anchor="middle" x="4812" y="-1478.45" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="4812" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="4812" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="4812" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 14</text>
</g>
<!-- gate_3_6&#45;&gt;expert_3_6_0 -->
<g id="edge378" class="edge">
<title>gate_3_6&#45;&gt;expert_3_6_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4983.33,-1563C4938.27,-1563 4892.5,-1563 4892.5,-1563 4892.5,-1563 4892.5,-1503.77 4892.5,-1503.77"/>
<polygon fill="black" stroke="black" points="4896,-1503.77 4892.5,-1493.77 4889,-1503.77 4896,-1503.77"/>
<text text-anchor="middle" x="4865" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_6_1 -->
<g id="node249" class="node">
<title>expert_3_6_1</title>
<polygon fill="lightpink" stroke="black" points="5094,-1493.65 4918,-1493.65 4918,-1425.65 5094,-1425.65 5094,-1493.65"/>
<text text-anchor="middle" x="5006" y="-1478.45" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="5006" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="5006" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="5006" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 14</text>
</g>
<!-- gate_3_6&#45;&gt;expert_3_6_1 -->
<g id="edge380" class="edge">
<title>gate_3_6&#45;&gt;expert_3_6_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5038.75,-1540.45C5038.75,-1540.45 5038.75,-1503.91 5038.75,-1503.91"/>
<polygon fill="black" stroke="black" points="5042.25,-1503.91 5038.75,-1493.91 5035.25,-1503.91 5042.25,-1503.91"/>
<text text-anchor="middle" x="5059" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_6_2 -->
<g id="node250" class="node">
<title>expert_3_6_2</title>
<polygon fill="lightpink" stroke="black" points="5288,-1493.65 5112,-1493.65 5112,-1425.65 5288,-1425.65 5288,-1493.65"/>
<text text-anchor="middle" x="5200" y="-1478.45" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="5200" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="5200" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="5200" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 14</text>
</g>
<!-- gate_3_6&#45;&gt;expert_3_6_2 -->
<g id="edge382" class="edge">
<title>gate_3_6&#45;&gt;expert_3_6_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5134.25,-1540.45C5134.25,-1540.45 5134.25,-1503.91 5134.25,-1503.91"/>
<polygon fill="black" stroke="black" points="5137.75,-1503.91 5134.25,-1493.91 5130.75,-1503.91 5137.75,-1503.91"/>
<text text-anchor="middle" x="5182" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_6_3 -->
<g id="node251" class="node">
<title>expert_3_6_3</title>
<polygon fill="lightpink" stroke="black" points="5482,-1493.65 5306,-1493.65 5306,-1425.65 5482,-1425.65 5482,-1493.65"/>
<text text-anchor="middle" x="5394" y="-1478.45" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="5394" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="5394" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="5394" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 14</text>
</g>
<!-- gate_3_6&#45;&gt;expert_3_6_3 -->
<g id="edge384" class="edge">
<title>gate_3_6&#45;&gt;expert_3_6_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5156.72,-1585C5227.2,-1585 5315,-1585 5315,-1585 5315,-1585 5315,-1503.9 5315,-1503.9"/>
<polygon fill="black" stroke="black" points="5318.5,-1503.9 5315,-1493.9 5311.5,-1503.9 5318.5,-1503.9"/>
<text text-anchor="middle" x="5305" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_3_6 -->
<g id="node252" class="node">
<title>expert_agg_3_6</title>
<polygon fill="lightsteelblue" stroke="black" points="5136.5,-1388.65 4951.5,-1388.65 4951.5,-1320.65 5136.5,-1320.65 5136.5,-1388.65"/>
<text text-anchor="middle" x="5044" y="-1373.45" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="5044" y="-1358.45" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="5044" y="-1343.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5044" y="-1328.45" font-family="Arial" font-size="14.00">GPU: 14</text>
</g>
<!-- expert_3_6_0&#45;&gt;expert_agg_3_6 -->
<g id="edge379" class="edge">
<title>expert_3_6_0&#45;&gt;expert_agg_3_6</title>
<path fill="none" stroke="black" d="M4879.5,-1425.59C4879.5,-1391.16 4879.5,-1343 4879.5,-1343 4879.5,-1343 4941.17,-1343 4941.17,-1343"/>
<polygon fill="black" stroke="black" points="4941.17,-1346.5 4951.17,-1343 4941.17,-1339.5 4941.17,-1346.5"/>
</g>
<!-- expert_3_6_1&#45;&gt;expert_agg_3_6 -->
<g id="edge381" class="edge">
<title>expert_3_6_1&#45;&gt;expert_agg_3_6</title>
<path fill="none" stroke="black" d="M5022.75,-1425.56C5022.75,-1425.56 5022.75,-1398.93 5022.75,-1398.93"/>
<polygon fill="black" stroke="black" points="5026.25,-1398.93 5022.75,-1388.93 5019.25,-1398.93 5026.25,-1398.93"/>
</g>
<!-- expert_3_6_2&#45;&gt;expert_agg_3_6 -->
<g id="edge383" class="edge">
<title>expert_3_6_2&#45;&gt;expert_agg_3_6</title>
<path fill="none" stroke="black" d="M5124.25,-1425.56C5124.25,-1425.56 5124.25,-1398.93 5124.25,-1398.93"/>
<polygon fill="black" stroke="black" points="5127.75,-1398.93 5124.25,-1388.93 5120.75,-1398.93 5127.75,-1398.93"/>
</g>
<!-- expert_3_6_3&#45;&gt;expert_agg_3_6 -->
<g id="edge385" class="edge">
<title>expert_3_6_3&#45;&gt;expert_agg_3_6</title>
<path fill="none" stroke="black" d="M5423.33,-1425.48C5423.33,-1398.37 5423.33,-1365 5423.33,-1365 5423.33,-1365 5146.8,-1365 5146.8,-1365"/>
<polygon fill="black" stroke="black" points="5146.8,-1361.5 5136.8,-1365 5146.8,-1368.5 5146.8,-1361.5"/>
</g>
<!-- residual2_3_6 -->
<g id="node253" class="node">
<title>residual2_3_6</title>
<polygon fill="lightcoral" stroke="black" points="5044,-1283.65 4859,-1230.65 5044,-1177.65 5229,-1230.65 5044,-1283.65"/>
<text text-anchor="middle" x="5044" y="-1241.95" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="5044" y="-1226.95" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5044" y="-1211.95" font-family="Arial" font-size="14.00">GPU: 14</text>
</g>
<!-- expert_agg_3_6&#45;&gt;residual2_3_6 -->
<g id="edge386" class="edge">
<title>expert_agg_3_6&#45;&gt;residual2_3_6</title>
<path fill="none" stroke="black" d="M5044,-1320.43C5044,-1320.43 5044,-1293.82 5044,-1293.82"/>
<polygon fill="black" stroke="black" points="5047.5,-1293.82 5044,-1283.82 5040.5,-1293.82 5047.5,-1293.82"/>
</g>
<!-- allreduce_3_6 -->
<g id="node254" class="node">
<title>allreduce_3_6</title>
<ellipse fill="yellow" stroke="black" cx="5044" cy="-1103.17" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="5044" y="-1114.47" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="5044" y="-1099.47" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="5044" y="-1084.47" font-family="Arial" font-size="14.00">GPU: 14</text>
</g>
<!-- residual2_3_6&#45;&gt;allreduce_3_6 -->
<g id="edge387" class="edge">
<title>residual2_3_6&#45;&gt;allreduce_3_6</title>
<path fill="none" stroke="black" d="M5044,-1177.32C5044,-1177.32 5044,-1150.78 5044,-1150.78"/>
<polygon fill="black" stroke="black" points="5047.5,-1150.78 5044,-1140.78 5040.5,-1150.78 5047.5,-1150.78"/>
</g>
<!-- ln1_4_6 -->
<g id="node332" class="node">
<title>ln1_4_6</title>
<polygon fill="lightyellow" stroke="black" points="5136.5,-970.69 4951.5,-970.69 4951.5,-917.69 5136.5,-917.69 5136.5,-970.69"/>
<text text-anchor="middle" x="5044" y="-955.49" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="5044" y="-940.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5044" y="-925.49" font-family="Arial" font-size="14.00">GPU: 14</text>
</g>
<!-- allreduce_3_6&#45;&gt;ln1_4_6 -->
<g id="edge388" class="edge">
<title>allreduce_3_6&#45;&gt;ln1_4_6</title>
<path fill="none" stroke="black" d="M5044,-1065.49C5044,-1065.49 5044,-981.16 5044,-981.16"/>
<polygon fill="black" stroke="black" points="5047.5,-981.16 5044,-971.16 5040.5,-981.16 5047.5,-981.16"/>
</g>
<!-- ln1_3_7 -->
<g id="node255" class="node">
<title>ln1_3_7</title>
<polygon fill="lightyellow" stroke="black" points="5909.5,-1931.65 5724.5,-1931.65 5724.5,-1878.65 5909.5,-1878.65 5909.5,-1931.65"/>
<text text-anchor="middle" x="5817" y="-1916.45" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="5817" y="-1901.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5817" y="-1886.45" font-family="Arial" font-size="14.00">GPU: 15</text>
</g>
<!-- attn_3_7 -->
<g id="node256" class="node">
<title>attn_3_7</title>
<polygon fill="lightgreen" stroke="black" points="5923,-1841.65 5711,-1841.65 5711,-1788.65 5923,-1788.65 5923,-1841.65"/>
<text text-anchor="middle" x="5817" y="-1826.45" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="5817" y="-1811.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5817" y="-1796.45" font-family="Arial" font-size="14.00">GPU: 15</text>
</g>
<!-- ln1_3_7&#45;&gt;attn_3_7 -->
<g id="edge432" class="edge">
<title>ln1_3_7&#45;&gt;attn_3_7</title>
<path fill="none" stroke="black" d="M5817,-1878.63C5817,-1878.63 5817,-1851.78 5817,-1851.78"/>
<polygon fill="black" stroke="black" points="5820.5,-1851.78 5817,-1841.78 5813.5,-1851.78 5820.5,-1851.78"/>
</g>
<!-- residual1_3_7 -->
<g id="node257" class="node">
<title>residual1_3_7</title>
<polygon fill="lightcoral" stroke="black" points="5817,-1751.65 5632,-1698.65 5817,-1645.65 6002,-1698.65 5817,-1751.65"/>
<text text-anchor="middle" x="5817" y="-1709.95" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="5817" y="-1694.95" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5817" y="-1679.95" font-family="Arial" font-size="14.00">GPU: 15</text>
</g>
<!-- attn_3_7&#45;&gt;residual1_3_7 -->
<g id="edge433" class="edge">
<title>attn_3_7&#45;&gt;residual1_3_7</title>
<path fill="none" stroke="black" d="M5817,-1788.42C5817,-1788.42 5817,-1761.89 5817,-1761.89"/>
<polygon fill="black" stroke="black" points="5820.5,-1761.89 5817,-1751.89 5813.5,-1761.89 5820.5,-1761.89"/>
</g>
<!-- gate_3_7 -->
<g id="node258" class="node">
<title>gate_3_7</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="5903.5,-1608.65 5730.5,-1608.65 5730.5,-1540.65 5903.5,-1540.65 5903.5,-1608.65"/>
<text text-anchor="middle" x="5817" y="-1593.45" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="5817" y="-1578.45" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="5817" y="-1563.45" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="5817" y="-1548.45" font-family="Arial" font-size="14.00">GPU: 15</text>
</g>
<!-- residual1_3_7&#45;&gt;gate_3_7 -->
<g id="edge434" class="edge">
<title>residual1_3_7&#45;&gt;gate_3_7</title>
<path fill="none" stroke="black" d="M5817,-1645.34C5817,-1645.34 5817,-1618.92 5817,-1618.92"/>
<polygon fill="black" stroke="black" points="5820.5,-1618.92 5817,-1608.92 5813.5,-1618.92 5820.5,-1618.92"/>
</g>
<!-- expert_3_7_0 -->
<g id="node259" class="node">
<title>expert_3_7_0</title>
<polygon fill="lightpink" stroke="black" points="5682,-1493.65 5506,-1493.65 5506,-1425.65 5682,-1425.65 5682,-1493.65"/>
<text text-anchor="middle" x="5594" y="-1478.45" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="5594" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="5594" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="5594" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 15</text>
</g>
<!-- gate_3_7&#45;&gt;expert_3_7_0 -->
<g id="edge435" class="edge">
<title>gate_3_7&#45;&gt;expert_3_7_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5730.44,-1563C5692.74,-1563 5657,-1563 5657,-1563 5657,-1563 5657,-1503.77 5657,-1503.77"/>
<polygon fill="black" stroke="black" points="5660.5,-1503.77 5657,-1493.77 5653.5,-1503.77 5660.5,-1503.77"/>
<text text-anchor="middle" x="5686" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_7_1 -->
<g id="node260" class="node">
<title>expert_3_7_1</title>
<polygon fill="lightpink" stroke="black" points="5876,-1493.65 5700,-1493.65 5700,-1425.65 5876,-1425.65 5876,-1493.65"/>
<text text-anchor="middle" x="5788" y="-1478.45" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="5788" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="5788" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="5788" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 15</text>
</g>
<!-- gate_3_7&#45;&gt;expert_3_7_1 -->
<g id="edge437" class="edge">
<title>gate_3_7&#45;&gt;expert_3_7_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5803.25,-1540.45C5803.25,-1540.45 5803.25,-1503.91 5803.25,-1503.91"/>
<polygon fill="black" stroke="black" points="5806.75,-1503.91 5803.25,-1493.91 5799.75,-1503.91 5806.75,-1503.91"/>
<text text-anchor="middle" x="5809" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_7_2 -->
<g id="node261" class="node">
<title>expert_3_7_2</title>
<polygon fill="lightpink" stroke="black" points="6070,-1493.65 5894,-1493.65 5894,-1425.65 6070,-1425.65 6070,-1493.65"/>
<text text-anchor="middle" x="5982" y="-1478.45" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="5982" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="5982" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="5982" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 15</text>
</g>
<!-- gate_3_7&#45;&gt;expert_3_7_2 -->
<g id="edge439" class="edge">
<title>gate_3_7&#45;&gt;expert_3_7_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5898.75,-1540.45C5898.75,-1540.45 5898.75,-1503.91 5898.75,-1503.91"/>
<polygon fill="black" stroke="black" points="5902.25,-1503.91 5898.75,-1493.91 5895.25,-1503.91 5902.25,-1503.91"/>
<text text-anchor="middle" x="5932" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_3_7_3 -->
<g id="node262" class="node">
<title>expert_3_7_3</title>
<polygon fill="lightpink" stroke="black" points="6264,-1493.65 6088,-1493.65 6088,-1425.65 6264,-1425.65 6264,-1493.65"/>
<text text-anchor="middle" x="6176" y="-1478.45" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="6176" y="-1463.45" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="6176" y="-1448.45" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="6176" y="-1433.45" font-family="Arial" font-size="14.00">GPU: 15</text>
</g>
<!-- gate_3_7&#45;&gt;expert_3_7_3 -->
<g id="edge441" class="edge">
<title>gate_3_7&#45;&gt;expert_3_7_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5903.68,-1574C5985.91,-1574 6097,-1574 6097,-1574 6097,-1574 6097,-1503.65 6097,-1503.65"/>
<polygon fill="black" stroke="black" points="6100.5,-1503.65 6097,-1493.65 6093.5,-1503.65 6100.5,-1503.65"/>
<text text-anchor="middle" x="6091" y="-1514.65" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_3_7 -->
<g id="node263" class="node">
<title>expert_agg_3_7</title>
<polygon fill="lightsteelblue" stroke="black" points="5918.5,-1388.65 5733.5,-1388.65 5733.5,-1320.65 5918.5,-1320.65 5918.5,-1388.65"/>
<text text-anchor="middle" x="5826" y="-1373.45" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="5826" y="-1358.45" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="5826" y="-1343.45" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5826" y="-1328.45" font-family="Arial" font-size="14.00">GPU: 15</text>
</g>
<!-- expert_3_7_0&#45;&gt;expert_agg_3_7 -->
<g id="edge436" class="edge">
<title>expert_3_7_0&#45;&gt;expert_agg_3_7</title>
<path fill="none" stroke="black" d="M5661.5,-1425.59C5661.5,-1391.16 5661.5,-1343 5661.5,-1343 5661.5,-1343 5723.17,-1343 5723.17,-1343"/>
<polygon fill="black" stroke="black" points="5723.17,-1346.5 5733.17,-1343 5723.17,-1339.5 5723.17,-1346.5"/>
</g>
<!-- expert_3_7_1&#45;&gt;expert_agg_3_7 -->
<g id="edge438" class="edge">
<title>expert_3_7_1&#45;&gt;expert_agg_3_7</title>
<path fill="none" stroke="black" d="M5804.75,-1425.56C5804.75,-1425.56 5804.75,-1398.93 5804.75,-1398.93"/>
<polygon fill="black" stroke="black" points="5808.25,-1398.93 5804.75,-1388.93 5801.25,-1398.93 5808.25,-1398.93"/>
</g>
<!-- expert_3_7_2&#45;&gt;expert_agg_3_7 -->
<g id="edge440" class="edge">
<title>expert_3_7_2&#45;&gt;expert_agg_3_7</title>
<path fill="none" stroke="black" d="M5906.25,-1425.56C5906.25,-1425.56 5906.25,-1398.93 5906.25,-1398.93"/>
<polygon fill="black" stroke="black" points="5909.75,-1398.93 5906.25,-1388.93 5902.75,-1398.93 5909.75,-1398.93"/>
</g>
<!-- expert_3_7_3&#45;&gt;expert_agg_3_7 -->
<g id="edge442" class="edge">
<title>expert_3_7_3&#45;&gt;expert_agg_3_7</title>
<path fill="none" stroke="black" d="M6205.33,-1425.64C6205.33,-1394.75 6205.33,-1354 6205.33,-1354 6205.33,-1354 5928.8,-1354 5928.8,-1354"/>
<polygon fill="black" stroke="black" points="5928.8,-1350.5 5918.8,-1354 5928.8,-1357.5 5928.8,-1350.5"/>
</g>
<!-- residual2_3_7 -->
<g id="node264" class="node">
<title>residual2_3_7</title>
<polygon fill="lightcoral" stroke="black" points="5826,-1283.65 5641,-1230.65 5826,-1177.65 6011,-1230.65 5826,-1283.65"/>
<text text-anchor="middle" x="5826" y="-1241.95" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="5826" y="-1226.95" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5826" y="-1211.95" font-family="Arial" font-size="14.00">GPU: 15</text>
</g>
<!-- expert_agg_3_7&#45;&gt;residual2_3_7 -->
<g id="edge443" class="edge">
<title>expert_agg_3_7&#45;&gt;residual2_3_7</title>
<path fill="none" stroke="black" d="M5826,-1320.43C5826,-1320.43 5826,-1293.82 5826,-1293.82"/>
<polygon fill="black" stroke="black" points="5829.5,-1293.82 5826,-1283.82 5822.5,-1293.82 5829.5,-1293.82"/>
</g>
<!-- allreduce_3_7 -->
<g id="node265" class="node">
<title>allreduce_3_7</title>
<ellipse fill="yellow" stroke="black" cx="5826" cy="-1103.17" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="5826" y="-1114.47" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="5826" y="-1099.47" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="5826" y="-1084.47" font-family="Arial" font-size="14.00">GPU: 15</text>
</g>
<!-- residual2_3_7&#45;&gt;allreduce_3_7 -->
<g id="edge444" class="edge">
<title>residual2_3_7&#45;&gt;allreduce_3_7</title>
<path fill="none" stroke="black" d="M5826,-1177.32C5826,-1177.32 5826,-1150.78 5826,-1150.78"/>
<polygon fill="black" stroke="black" points="5829.5,-1150.78 5826,-1140.78 5822.5,-1150.78 5829.5,-1150.78"/>
</g>
<!-- ln1_4_7 -->
<g id="node343" class="node">
<title>ln1_4_7</title>
<polygon fill="lightyellow" stroke="black" points="5918.5,-970.69 5733.5,-970.69 5733.5,-917.69 5918.5,-917.69 5918.5,-970.69"/>
<text text-anchor="middle" x="5826" y="-955.49" font-family="Arial" font-size="14.00">LayerNorm (TP shard 1/8)</text>
<text text-anchor="middle" x="5826" y="-940.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5826" y="-925.49" font-family="Arial" font-size="14.00">GPU: 15</text>
</g>
<!-- allreduce_3_7&#45;&gt;ln1_4_7 -->
<g id="edge445" class="edge">
<title>allreduce_3_7&#45;&gt;ln1_4_7</title>
<path fill="none" stroke="black" d="M5826,-1065.49C5826,-1065.49 5826,-981.16 5826,-981.16"/>
<polygon fill="black" stroke="black" points="5829.5,-981.16 5826,-971.16 5822.5,-981.16 5829.5,-981.16"/>
</g>
<!-- attn_4_0 -->
<g id="node267" class="node">
<title>attn_4_0</title>
<polygon fill="lightgreen" stroke="black" points="458,-880.69 246,-880.69 246,-827.69 458,-827.69 458,-880.69"/>
<text text-anchor="middle" x="352" y="-865.49" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="352" y="-850.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="352" y="-835.49" font-family="Arial" font-size="14.00">GPU: 8</text>
</g>
<!-- ln1_4_0&#45;&gt;attn_4_0 -->
<g id="edge46" class="edge">
<title>ln1_4_0&#45;&gt;attn_4_0</title>
<path fill="none" stroke="black" d="M352,-917.68C352,-917.68 352,-890.83 352,-890.83"/>
<polygon fill="black" stroke="black" points="355.5,-890.83 352,-880.83 348.5,-890.83 355.5,-890.83"/>
</g>
<!-- residual1_4_0 -->
<g id="node268" class="node">
<title>residual1_4_0</title>
<polygon fill="lightcoral" stroke="black" points="352,-790.69 167,-737.69 352,-684.69 537,-737.69 352,-790.69"/>
<text text-anchor="middle" x="352" y="-748.99" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="352" y="-733.99" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="352" y="-718.99" font-family="Arial" font-size="14.00">GPU: 8</text>
</g>
<!-- attn_4_0&#45;&gt;residual1_4_0 -->
<g id="edge47" class="edge">
<title>attn_4_0&#45;&gt;residual1_4_0</title>
<path fill="none" stroke="black" d="M352,-827.47C352,-827.47 352,-800.93 352,-800.93"/>
<polygon fill="black" stroke="black" points="355.5,-800.93 352,-790.93 348.5,-800.93 355.5,-800.93"/>
</g>
<!-- gate_4_0 -->
<g id="node269" class="node">
<title>gate_4_0</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="438.5,-647.69 265.5,-647.69 265.5,-579.69 438.5,-579.69 438.5,-647.69"/>
<text text-anchor="middle" x="352" y="-632.49" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="352" y="-617.49" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="352" y="-602.49" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="352" y="-587.49" font-family="Arial" font-size="14.00">GPU: 8</text>
</g>
<!-- residual1_4_0&#45;&gt;gate_4_0 -->
<g id="edge48" class="edge">
<title>residual1_4_0&#45;&gt;gate_4_0</title>
<path fill="none" stroke="black" d="M352,-684.39C352,-684.39 352,-657.97 352,-657.97"/>
<polygon fill="black" stroke="black" points="355.5,-657.97 352,-647.97 348.5,-657.97 355.5,-657.97"/>
</g>
<!-- expert_4_0_0 -->
<g id="node270" class="node">
<title>expert_4_0_0</title>
<polygon fill="lightpink" stroke="black" points="208,-532.69 32,-532.69 32,-464.69 208,-464.69 208,-532.69"/>
<text text-anchor="middle" x="120" y="-517.49" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="120" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="120" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="120" y="-472.49" font-family="Arial" font-size="14.00">GPU: 8</text>
</g>
<!-- gate_4_0&#45;&gt;expert_4_0_0 -->
<g id="edge49" class="edge">
<title>gate_4_0&#45;&gt;expert_4_0_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M265.41,-613C225.78,-613 187.5,-613 187.5,-613 187.5,-613 187.5,-542.99 187.5,-542.99"/>
<polygon fill="black" stroke="black" points="191,-542.99 187.5,-532.99 184,-542.99 191,-542.99"/>
<text text-anchor="middle" x="241" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_0_1 -->
<g id="node271" class="node">
<title>expert_4_0_1</title>
<polygon fill="lightpink" stroke="black" points="402,-532.69 226,-532.69 226,-464.69 402,-464.69 402,-532.69"/>
<text text-anchor="middle" x="314" y="-517.49" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="314" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="314" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="314" y="-472.49" font-family="Arial" font-size="14.00">GPU: 8</text>
</g>
<!-- gate_4_0&#45;&gt;expert_4_0_1 -->
<g id="edge51" class="edge">
<title>gate_4_0&#45;&gt;expert_4_0_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M333.75,-579.5C333.75,-579.5 333.75,-542.95 333.75,-542.95"/>
<polygon fill="black" stroke="black" points="337.25,-542.95 333.75,-532.95 330.25,-542.95 337.25,-542.95"/>
<text text-anchor="middle" x="364" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_0_2 -->
<g id="node272" class="node">
<title>expert_4_0_2</title>
<polygon fill="lightpink" stroke="black" points="596,-532.69 420,-532.69 420,-464.69 596,-464.69 596,-532.69"/>
<text text-anchor="middle" x="508" y="-517.49" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="508" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="508" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="508" y="-472.49" font-family="Arial" font-size="14.00">GPU: 8</text>
</g>
<!-- gate_4_0&#45;&gt;expert_4_0_2 -->
<g id="edge53" class="edge">
<title>gate_4_0&#45;&gt;expert_4_0_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M429.25,-579.5C429.25,-579.5 429.25,-542.95 429.25,-542.95"/>
<polygon fill="black" stroke="black" points="432.75,-542.95 429.25,-532.95 425.75,-542.95 432.75,-542.95"/>
<text text-anchor="middle" x="487" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_0_3 -->
<g id="node273" class="node">
<title>expert_4_0_3</title>
<polygon fill="lightpink" stroke="black" points="790,-532.69 614,-532.69 614,-464.69 790,-464.69 790,-532.69"/>
<text text-anchor="middle" x="702" y="-517.49" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="702" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="702" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="702" y="-472.49" font-family="Arial" font-size="14.00">GPU: 8</text>
</g>
<!-- gate_4_0&#45;&gt;expert_4_0_3 -->
<g id="edge55" class="edge">
<title>gate_4_0&#45;&gt;expert_4_0_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M438.78,-625C533.74,-625 672.67,-625 672.67,-625 672.67,-625 672.67,-542.87 672.67,-542.87"/>
<polygon fill="black" stroke="black" points="676.17,-542.87 672.67,-532.87 669.17,-542.87 676.17,-542.87"/>
<text text-anchor="middle" x="646" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_4_0 -->
<g id="node274" class="node">
<title>expert_agg_4_0</title>
<polygon fill="lightsteelblue" stroke="black" points="503.5,-427.69 318.5,-427.69 318.5,-359.69 503.5,-359.69 503.5,-427.69"/>
<text text-anchor="middle" x="411" y="-412.49" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="411" y="-397.49" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="411" y="-382.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="411" y="-367.49" font-family="Arial" font-size="14.00">GPU: 8</text>
</g>
<!-- expert_4_0_0&#45;&gt;expert_agg_4_0 -->
<g id="edge50" class="edge">
<title>expert_4_0_0&#45;&gt;expert_agg_4_0</title>
<path fill="none" stroke="black" d="M120,-464.67C120,-433.77 120,-393 120,-393 120,-393 308.13,-393 308.13,-393"/>
<polygon fill="black" stroke="black" points="308.13,-396.5 318.13,-393 308.13,-389.5 308.13,-396.5"/>
</g>
<!-- expert_4_0_1&#45;&gt;expert_agg_4_0 -->
<g id="edge52" class="edge">
<title>expert_4_0_1&#45;&gt;expert_agg_4_0</title>
<path fill="none" stroke="black" d="M360.25,-464.6C360.25,-464.6 360.25,-437.97 360.25,-437.97"/>
<polygon fill="black" stroke="black" points="363.75,-437.97 360.25,-427.97 356.75,-437.97 363.75,-437.97"/>
</g>
<!-- expert_4_0_2&#45;&gt;expert_agg_4_0 -->
<g id="edge54" class="edge">
<title>expert_4_0_2&#45;&gt;expert_agg_4_0</title>
<path fill="none" stroke="black" d="M461.75,-464.6C461.75,-464.6 461.75,-437.97 461.75,-437.97"/>
<polygon fill="black" stroke="black" points="465.25,-437.97 461.75,-427.97 458.25,-437.97 465.25,-437.97"/>
</g>
<!-- expert_4_0_3&#45;&gt;expert_agg_4_0 -->
<g id="edge56" class="edge">
<title>expert_4_0_3&#45;&gt;expert_agg_4_0</title>
<path fill="none" stroke="black" d="M702,-464.63C702,-430.18 702,-382 702,-382 702,-382 513.87,-382 513.87,-382"/>
<polygon fill="black" stroke="black" points="513.87,-378.5 503.87,-382 513.87,-385.5 513.87,-378.5"/>
</g>
<!-- residual2_4_0 -->
<g id="node275" class="node">
<title>residual2_4_0</title>
<polygon fill="lightcoral" stroke="black" points="411,-322.69 226,-269.69 411,-216.69 596,-269.69 411,-322.69"/>
<text text-anchor="middle" x="411" y="-280.99" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="411" y="-265.99" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="411" y="-250.99" font-family="Arial" font-size="14.00">GPU: 8</text>
</g>
<!-- expert_agg_4_0&#45;&gt;residual2_4_0 -->
<g id="edge57" class="edge">
<title>expert_agg_4_0&#45;&gt;residual2_4_0</title>
<path fill="none" stroke="black" d="M411,-359.48C411,-359.48 411,-332.86 411,-332.86"/>
<polygon fill="black" stroke="black" points="414.5,-332.86 411,-322.86 407.5,-332.86 414.5,-332.86"/>
</g>
<!-- allreduce_4_0 -->
<g id="node276" class="node">
<title>allreduce_4_0</title>
<ellipse fill="yellow" stroke="black" cx="411" cy="-142.22" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="411" y="-153.52" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="411" y="-138.52" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="411" y="-123.52" font-family="Arial" font-size="14.00">GPU: 8</text>
</g>
<!-- residual2_4_0&#45;&gt;allreduce_4_0 -->
<g id="edge58" class="edge">
<title>residual2_4_0&#45;&gt;allreduce_4_0</title>
<path fill="none" stroke="black" d="M411,-216.37C411,-216.37 411,-189.83 411,-189.83"/>
<polygon fill="black" stroke="black" points="414.5,-189.83 411,-179.83 407.5,-189.83 414.5,-189.83"/>
</g>
<!-- output -->
<g id="node354" class="node">
<title>output</title>
<ellipse fill="lightblue" stroke="black" cx="411" cy="-26.87" rx="161.85" ry="26.74"/>
<text text-anchor="middle" x="411" y="-30.67" font-family="Arial" font-size="14.00">Output Tokens</text>
<text text-anchor="middle" x="411" y="-15.67" font-family="Arial" font-size="14.00">(Batch: 1024 tokens, Hidden: 8192)</text>
</g>
<!-- allreduce_4_0&#45;&gt;output -->
<g id="edge59" class="edge">
<title>allreduce_4_0&#45;&gt;output</title>
<path fill="none" stroke="black" d="M411,-104.45C411,-104.45 411,-63.76 411,-63.76"/>
<polygon fill="black" stroke="black" points="414.5,-63.76 411,-53.76 407.5,-63.76 414.5,-63.76"/>
</g>
<!-- attn_4_1 -->
<g id="node278" class="node">
<title>attn_4_1</title>
<polygon fill="lightgreen" stroke="black" points="1240,-880.69 1028,-880.69 1028,-827.69 1240,-827.69 1240,-880.69"/>
<text text-anchor="middle" x="1134" y="-865.49" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="1134" y="-850.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1134" y="-835.49" font-family="Arial" font-size="14.00">GPU: 9</text>
</g>
<!-- ln1_4_1&#45;&gt;attn_4_1 -->
<g id="edge104" class="edge">
<title>ln1_4_1&#45;&gt;attn_4_1</title>
<path fill="none" stroke="black" d="M1134,-917.68C1134,-917.68 1134,-890.83 1134,-890.83"/>
<polygon fill="black" stroke="black" points="1137.5,-890.83 1134,-880.83 1130.5,-890.83 1137.5,-890.83"/>
</g>
<!-- residual1_4_1 -->
<g id="node279" class="node">
<title>residual1_4_1</title>
<polygon fill="lightcoral" stroke="black" points="1134,-790.69 949,-737.69 1134,-684.69 1319,-737.69 1134,-790.69"/>
<text text-anchor="middle" x="1134" y="-748.99" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="1134" y="-733.99" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1134" y="-718.99" font-family="Arial" font-size="14.00">GPU: 9</text>
</g>
<!-- attn_4_1&#45;&gt;residual1_4_1 -->
<g id="edge105" class="edge">
<title>attn_4_1&#45;&gt;residual1_4_1</title>
<path fill="none" stroke="black" d="M1134,-827.47C1134,-827.47 1134,-800.93 1134,-800.93"/>
<polygon fill="black" stroke="black" points="1137.5,-800.93 1134,-790.93 1130.5,-800.93 1137.5,-800.93"/>
</g>
<!-- gate_4_1 -->
<g id="node280" class="node">
<title>gate_4_1</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="1220.5,-647.69 1047.5,-647.69 1047.5,-579.69 1220.5,-579.69 1220.5,-647.69"/>
<text text-anchor="middle" x="1134" y="-632.49" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="1134" y="-617.49" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="1134" y="-602.49" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="1134" y="-587.49" font-family="Arial" font-size="14.00">GPU: 9</text>
</g>
<!-- residual1_4_1&#45;&gt;gate_4_1 -->
<g id="edge106" class="edge">
<title>residual1_4_1&#45;&gt;gate_4_1</title>
<path fill="none" stroke="black" d="M1134,-684.39C1134,-684.39 1134,-657.97 1134,-657.97"/>
<polygon fill="black" stroke="black" points="1137.5,-657.97 1134,-647.97 1130.5,-657.97 1137.5,-657.97"/>
</g>
<!-- expert_4_1_0 -->
<g id="node281" class="node">
<title>expert_4_1_0</title>
<polygon fill="lightpink" stroke="black" points="990,-532.69 814,-532.69 814,-464.69 990,-464.69 990,-532.69"/>
<text text-anchor="middle" x="902" y="-517.49" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="902" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="902" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="902" y="-472.49" font-family="Arial" font-size="14.00">GPU: 9</text>
</g>
<!-- gate_4_1&#45;&gt;expert_4_1_0 -->
<g id="edge107" class="edge">
<title>gate_4_1&#45;&gt;expert_4_1_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1047.41,-602C1007.78,-602 969.5,-602 969.5,-602 969.5,-602 969.5,-542.81 969.5,-542.81"/>
<polygon fill="black" stroke="black" points="973,-542.81 969.5,-532.81 966,-542.81 973,-542.81"/>
<text text-anchor="middle" x="1023" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_1_1 -->
<g id="node282" class="node">
<title>expert_4_1_1</title>
<polygon fill="lightpink" stroke="black" points="1184,-532.69 1008,-532.69 1008,-464.69 1184,-464.69 1184,-532.69"/>
<text text-anchor="middle" x="1096" y="-517.49" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1096" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="1096" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="1096" y="-472.49" font-family="Arial" font-size="14.00">GPU: 9</text>
</g>
<!-- gate_4_1&#45;&gt;expert_4_1_1 -->
<g id="edge109" class="edge">
<title>gate_4_1&#45;&gt;expert_4_1_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1115.75,-579.5C1115.75,-579.5 1115.75,-542.95 1115.75,-542.95"/>
<polygon fill="black" stroke="black" points="1119.25,-542.95 1115.75,-532.95 1112.25,-542.95 1119.25,-542.95"/>
<text text-anchor="middle" x="1146" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_1_2 -->
<g id="node283" class="node">
<title>expert_4_1_2</title>
<polygon fill="lightpink" stroke="black" points="1378,-532.69 1202,-532.69 1202,-464.69 1378,-464.69 1378,-532.69"/>
<text text-anchor="middle" x="1290" y="-517.49" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="1290" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="1290" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="1290" y="-472.49" font-family="Arial" font-size="14.00">GPU: 9</text>
</g>
<!-- gate_4_1&#45;&gt;expert_4_1_2 -->
<g id="edge111" class="edge">
<title>gate_4_1&#45;&gt;expert_4_1_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1211.25,-579.5C1211.25,-579.5 1211.25,-542.95 1211.25,-542.95"/>
<polygon fill="black" stroke="black" points="1214.75,-542.95 1211.25,-532.95 1207.75,-542.95 1214.75,-542.95"/>
<text text-anchor="middle" x="1269" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_1_3 -->
<g id="node284" class="node">
<title>expert_4_1_3</title>
<polygon fill="lightpink" stroke="black" points="1572,-532.69 1396,-532.69 1396,-464.69 1572,-464.69 1572,-532.69"/>
<text text-anchor="middle" x="1484" y="-517.49" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1484" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="1484" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="1484" y="-472.49" font-family="Arial" font-size="14.00">GPU: 9</text>
</g>
<!-- gate_4_1&#45;&gt;expert_4_1_3 -->
<g id="edge113" class="edge">
<title>gate_4_1&#45;&gt;expert_4_1_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1220.78,-625C1315.74,-625 1454.67,-625 1454.67,-625 1454.67,-625 1454.67,-542.87 1454.67,-542.87"/>
<polygon fill="black" stroke="black" points="1458.17,-542.87 1454.67,-532.87 1451.17,-542.87 1458.17,-542.87"/>
<text text-anchor="middle" x="1428" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_4_1 -->
<g id="node285" class="node">
<title>expert_agg_4_1</title>
<polygon fill="lightsteelblue" stroke="black" points="1285.5,-427.69 1100.5,-427.69 1100.5,-359.69 1285.5,-359.69 1285.5,-427.69"/>
<text text-anchor="middle" x="1193" y="-412.49" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1193" y="-397.49" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="1193" y="-382.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1193" y="-367.49" font-family="Arial" font-size="14.00">GPU: 9</text>
</g>
<!-- expert_4_1_0&#45;&gt;expert_agg_4_1 -->
<g id="edge108" class="edge">
<title>expert_4_1_0&#45;&gt;expert_agg_4_1</title>
<path fill="none" stroke="black" d="M902,-464.6C902,-437.81 902,-405 902,-405 902,-405 1090.13,-405 1090.13,-405"/>
<polygon fill="black" stroke="black" points="1090.13,-408.5 1100.13,-405 1090.13,-401.5 1090.13,-408.5"/>
</g>
<!-- expert_4_1_1&#45;&gt;expert_agg_4_1 -->
<g id="edge110" class="edge">
<title>expert_4_1_1&#45;&gt;expert_agg_4_1</title>
<path fill="none" stroke="black" d="M1142.25,-464.6C1142.25,-464.6 1142.25,-437.97 1142.25,-437.97"/>
<polygon fill="black" stroke="black" points="1145.75,-437.97 1142.25,-427.97 1138.75,-437.97 1145.75,-437.97"/>
</g>
<!-- expert_4_1_2&#45;&gt;expert_agg_4_1 -->
<g id="edge112" class="edge">
<title>expert_4_1_2&#45;&gt;expert_agg_4_1</title>
<path fill="none" stroke="black" d="M1243.75,-464.6C1243.75,-464.6 1243.75,-437.97 1243.75,-437.97"/>
<polygon fill="black" stroke="black" points="1247.25,-437.97 1243.75,-427.97 1240.25,-437.97 1247.25,-437.97"/>
</g>
<!-- expert_4_1_3&#45;&gt;expert_agg_4_1 -->
<g id="edge114" class="edge">
<title>expert_4_1_3&#45;&gt;expert_agg_4_1</title>
<path fill="none" stroke="black" d="M1484,-464.63C1484,-430.18 1484,-382 1484,-382 1484,-382 1295.87,-382 1295.87,-382"/>
<polygon fill="black" stroke="black" points="1295.87,-378.5 1285.87,-382 1295.87,-385.5 1295.87,-378.5"/>
</g>
<!-- residual2_4_1 -->
<g id="node286" class="node">
<title>residual2_4_1</title>
<polygon fill="lightcoral" stroke="black" points="1193,-322.69 1008,-269.69 1193,-216.69 1378,-269.69 1193,-322.69"/>
<text text-anchor="middle" x="1193" y="-280.99" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1193" y="-265.99" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1193" y="-250.99" font-family="Arial" font-size="14.00">GPU: 9</text>
</g>
<!-- expert_agg_4_1&#45;&gt;residual2_4_1 -->
<g id="edge115" class="edge">
<title>expert_agg_4_1&#45;&gt;residual2_4_1</title>
<path fill="none" stroke="black" d="M1193,-359.48C1193,-359.48 1193,-332.86 1193,-332.86"/>
<polygon fill="black" stroke="black" points="1196.5,-332.86 1193,-322.86 1189.5,-332.86 1196.5,-332.86"/>
</g>
<!-- allreduce_4_1 -->
<g id="node287" class="node">
<title>allreduce_4_1</title>
<ellipse fill="yellow" stroke="black" cx="1193" cy="-142.22" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="1193" y="-153.52" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1193" y="-138.52" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="1193" y="-123.52" font-family="Arial" font-size="14.00">GPU: 9</text>
</g>
<!-- residual2_4_1&#45;&gt;allreduce_4_1 -->
<g id="edge116" class="edge">
<title>residual2_4_1&#45;&gt;allreduce_4_1</title>
<path fill="none" stroke="black" d="M1193,-216.37C1193,-216.37 1193,-189.83 1193,-189.83"/>
<polygon fill="black" stroke="black" points="1196.5,-189.83 1193,-179.83 1189.5,-189.83 1196.5,-189.83"/>
</g>
<!-- attn_4_2 -->
<g id="node289" class="node">
<title>attn_4_2</title>
<polygon fill="lightgreen" stroke="black" points="2070,-880.69 1858,-880.69 1858,-827.69 2070,-827.69 2070,-880.69"/>
<text text-anchor="middle" x="1964" y="-865.49" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="1964" y="-850.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1964" y="-835.49" font-family="Arial" font-size="14.00">GPU: 10</text>
</g>
<!-- ln1_4_2&#45;&gt;attn_4_2 -->
<g id="edge161" class="edge">
<title>ln1_4_2&#45;&gt;attn_4_2</title>
<path fill="none" stroke="black" d="M1964,-917.68C1964,-917.68 1964,-890.83 1964,-890.83"/>
<polygon fill="black" stroke="black" points="1967.5,-890.83 1964,-880.83 1960.5,-890.83 1967.5,-890.83"/>
</g>
<!-- residual1_4_2 -->
<g id="node290" class="node">
<title>residual1_4_2</title>
<polygon fill="lightcoral" stroke="black" points="1964,-790.69 1779,-737.69 1964,-684.69 2149,-737.69 1964,-790.69"/>
<text text-anchor="middle" x="1964" y="-748.99" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="1964" y="-733.99" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1964" y="-718.99" font-family="Arial" font-size="14.00">GPU: 10</text>
</g>
<!-- attn_4_2&#45;&gt;residual1_4_2 -->
<g id="edge162" class="edge">
<title>attn_4_2&#45;&gt;residual1_4_2</title>
<path fill="none" stroke="black" d="M1964,-827.47C1964,-827.47 1964,-800.93 1964,-800.93"/>
<polygon fill="black" stroke="black" points="1967.5,-800.93 1964,-790.93 1960.5,-800.93 1967.5,-800.93"/>
</g>
<!-- gate_4_2 -->
<g id="node291" class="node">
<title>gate_4_2</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="2050.5,-647.69 1877.5,-647.69 1877.5,-579.69 2050.5,-579.69 2050.5,-647.69"/>
<text text-anchor="middle" x="1964" y="-632.49" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="1964" y="-617.49" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="1964" y="-602.49" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="1964" y="-587.49" font-family="Arial" font-size="14.00">GPU: 10</text>
</g>
<!-- residual1_4_2&#45;&gt;gate_4_2 -->
<g id="edge163" class="edge">
<title>residual1_4_2&#45;&gt;gate_4_2</title>
<path fill="none" stroke="black" d="M1964,-684.39C1964,-684.39 1964,-657.97 1964,-657.97"/>
<polygon fill="black" stroke="black" points="1967.5,-657.97 1964,-647.97 1960.5,-657.97 1967.5,-657.97"/>
</g>
<!-- expert_4_2_0 -->
<g id="node292" class="node">
<title>expert_4_2_0</title>
<polygon fill="lightpink" stroke="black" points="1772,-532.69 1596,-532.69 1596,-464.69 1772,-464.69 1772,-532.69"/>
<text text-anchor="middle" x="1684" y="-517.49" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="1684" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="1684" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="1684" y="-472.49" font-family="Arial" font-size="14.00">GPU: 10</text>
</g>
<!-- gate_4_2&#45;&gt;expert_4_2_0 -->
<g id="edge164" class="edge">
<title>gate_4_2&#45;&gt;expert_4_2_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1877.42,-602C1785.91,-602 1654.67,-602 1654.67,-602 1654.67,-602 1654.67,-542.81 1654.67,-542.81"/>
<polygon fill="black" stroke="black" points="1658.17,-542.81 1654.67,-532.81 1651.17,-542.81 1658.17,-542.81"/>
<text text-anchor="middle" x="1770" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_2_1 -->
<g id="node293" class="node">
<title>expert_4_2_1</title>
<polygon fill="lightpink" stroke="black" points="1966,-532.69 1790,-532.69 1790,-464.69 1966,-464.69 1966,-532.69"/>
<text text-anchor="middle" x="1878" y="-517.49" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1878" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="1878" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="1878" y="-472.49" font-family="Arial" font-size="14.00">GPU: 10</text>
</g>
<!-- gate_4_2&#45;&gt;expert_4_2_1 -->
<g id="edge166" class="edge">
<title>gate_4_2&#45;&gt;expert_4_2_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1921.75,-579.5C1921.75,-579.5 1921.75,-542.95 1921.75,-542.95"/>
<polygon fill="black" stroke="black" points="1925.25,-542.95 1921.75,-532.95 1918.25,-542.95 1925.25,-542.95"/>
<text text-anchor="middle" x="1893" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_2_2 -->
<g id="node294" class="node">
<title>expert_4_2_2</title>
<polygon fill="lightpink" stroke="black" points="2160,-532.69 1984,-532.69 1984,-464.69 2160,-464.69 2160,-532.69"/>
<text text-anchor="middle" x="2072" y="-517.49" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2072" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="2072" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="2072" y="-472.49" font-family="Arial" font-size="14.00">GPU: 10</text>
</g>
<!-- gate_4_2&#45;&gt;expert_4_2_2 -->
<g id="edge168" class="edge">
<title>gate_4_2&#45;&gt;expert_4_2_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2017.25,-579.5C2017.25,-579.5 2017.25,-542.95 2017.25,-542.95"/>
<polygon fill="black" stroke="black" points="2020.75,-542.95 2017.25,-532.95 2013.75,-542.95 2020.75,-542.95"/>
<text text-anchor="middle" x="2016" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_2_3 -->
<g id="node295" class="node">
<title>expert_4_2_3</title>
<polygon fill="lightpink" stroke="black" points="2354,-532.69 2178,-532.69 2178,-464.69 2354,-464.69 2354,-532.69"/>
<text text-anchor="middle" x="2266" y="-517.49" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2266" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="2266" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="2266" y="-472.49" font-family="Arial" font-size="14.00">GPU: 10</text>
</g>
<!-- gate_4_2&#45;&gt;expert_4_2_3 -->
<g id="edge170" class="edge">
<title>gate_4_2&#45;&gt;expert_4_2_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2050.65,-625C2130.49,-625 2236.67,-625 2236.67,-625 2236.67,-625 2236.67,-542.87 2236.67,-542.87"/>
<polygon fill="black" stroke="black" points="2240.17,-542.87 2236.67,-532.87 2233.17,-542.87 2240.17,-542.87"/>
<text text-anchor="middle" x="2175" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_4_2 -->
<g id="node296" class="node">
<title>expert_agg_4_2</title>
<polygon fill="lightsteelblue" stroke="black" points="2067.5,-427.69 1882.5,-427.69 1882.5,-359.69 2067.5,-359.69 2067.5,-427.69"/>
<text text-anchor="middle" x="1975" y="-412.49" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1975" y="-397.49" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="1975" y="-382.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1975" y="-367.49" font-family="Arial" font-size="14.00">GPU: 10</text>
</g>
<!-- expert_4_2_0&#45;&gt;expert_agg_4_2 -->
<g id="edge165" class="edge">
<title>expert_4_2_0&#45;&gt;expert_agg_4_2</title>
<path fill="none" stroke="black" d="M1684,-464.6C1684,-437.81 1684,-405 1684,-405 1684,-405 1872.13,-405 1872.13,-405"/>
<polygon fill="black" stroke="black" points="1872.13,-408.5 1882.13,-405 1872.13,-401.5 1872.13,-408.5"/>
</g>
<!-- expert_4_2_1&#45;&gt;expert_agg_4_2 -->
<g id="edge167" class="edge">
<title>expert_4_2_1&#45;&gt;expert_agg_4_2</title>
<path fill="none" stroke="black" d="M1924.25,-464.6C1924.25,-464.6 1924.25,-437.97 1924.25,-437.97"/>
<polygon fill="black" stroke="black" points="1927.75,-437.97 1924.25,-427.97 1920.75,-437.97 1927.75,-437.97"/>
</g>
<!-- expert_4_2_2&#45;&gt;expert_agg_4_2 -->
<g id="edge169" class="edge">
<title>expert_4_2_2&#45;&gt;expert_agg_4_2</title>
<path fill="none" stroke="black" d="M2025.75,-464.6C2025.75,-464.6 2025.75,-437.97 2025.75,-437.97"/>
<polygon fill="black" stroke="black" points="2029.25,-437.97 2025.75,-427.97 2022.25,-437.97 2029.25,-437.97"/>
</g>
<!-- expert_4_2_3&#45;&gt;expert_agg_4_2 -->
<g id="edge171" class="edge">
<title>expert_4_2_3&#45;&gt;expert_agg_4_2</title>
<path fill="none" stroke="black" d="M2266,-464.63C2266,-430.18 2266,-382 2266,-382 2266,-382 2077.87,-382 2077.87,-382"/>
<polygon fill="black" stroke="black" points="2077.87,-378.5 2067.87,-382 2077.87,-385.5 2077.87,-378.5"/>
</g>
<!-- residual2_4_2 -->
<g id="node297" class="node">
<title>residual2_4_2</title>
<polygon fill="lightcoral" stroke="black" points="1975,-322.69 1790,-269.69 1975,-216.69 2160,-269.69 1975,-322.69"/>
<text text-anchor="middle" x="1975" y="-280.99" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="1975" y="-265.99" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="1975" y="-250.99" font-family="Arial" font-size="14.00">GPU: 10</text>
</g>
<!-- expert_agg_4_2&#45;&gt;residual2_4_2 -->
<g id="edge172" class="edge">
<title>expert_agg_4_2&#45;&gt;residual2_4_2</title>
<path fill="none" stroke="black" d="M1975,-359.48C1975,-359.48 1975,-332.86 1975,-332.86"/>
<polygon fill="black" stroke="black" points="1978.5,-332.86 1975,-322.86 1971.5,-332.86 1978.5,-332.86"/>
</g>
<!-- allreduce_4_2 -->
<g id="node298" class="node">
<title>allreduce_4_2</title>
<ellipse fill="yellow" stroke="black" cx="1975" cy="-142.22" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="1975" y="-153.52" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1975" y="-138.52" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="1975" y="-123.52" font-family="Arial" font-size="14.00">GPU: 10</text>
</g>
<!-- residual2_4_2&#45;&gt;allreduce_4_2 -->
<g id="edge173" class="edge">
<title>residual2_4_2&#45;&gt;allreduce_4_2</title>
<path fill="none" stroke="black" d="M1975,-216.37C1975,-216.37 1975,-189.83 1975,-189.83"/>
<polygon fill="black" stroke="black" points="1978.5,-189.83 1975,-179.83 1971.5,-189.83 1978.5,-189.83"/>
</g>
<!-- attn_4_3 -->
<g id="node300" class="node">
<title>attn_4_3</title>
<polygon fill="lightgreen" stroke="black" points="2804,-880.69 2592,-880.69 2592,-827.69 2804,-827.69 2804,-880.69"/>
<text text-anchor="middle" x="2698" y="-865.49" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="2698" y="-850.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="2698" y="-835.49" font-family="Arial" font-size="14.00">GPU: 11</text>
</g>
<!-- ln1_4_3&#45;&gt;attn_4_3 -->
<g id="edge218" class="edge">
<title>ln1_4_3&#45;&gt;attn_4_3</title>
<path fill="none" stroke="black" d="M2698,-917.68C2698,-917.68 2698,-890.83 2698,-890.83"/>
<polygon fill="black" stroke="black" points="2701.5,-890.83 2698,-880.83 2694.5,-890.83 2701.5,-890.83"/>
</g>
<!-- residual1_4_3 -->
<g id="node301" class="node">
<title>residual1_4_3</title>
<polygon fill="lightcoral" stroke="black" points="2698,-790.69 2513,-737.69 2698,-684.69 2883,-737.69 2698,-790.69"/>
<text text-anchor="middle" x="2698" y="-748.99" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="2698" y="-733.99" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="2698" y="-718.99" font-family="Arial" font-size="14.00">GPU: 11</text>
</g>
<!-- attn_4_3&#45;&gt;residual1_4_3 -->
<g id="edge219" class="edge">
<title>attn_4_3&#45;&gt;residual1_4_3</title>
<path fill="none" stroke="black" d="M2698,-827.47C2698,-827.47 2698,-800.93 2698,-800.93"/>
<polygon fill="black" stroke="black" points="2701.5,-800.93 2698,-790.93 2694.5,-800.93 2701.5,-800.93"/>
</g>
<!-- gate_4_3 -->
<g id="node302" class="node">
<title>gate_4_3</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="2784.5,-647.69 2611.5,-647.69 2611.5,-579.69 2784.5,-579.69 2784.5,-647.69"/>
<text text-anchor="middle" x="2698" y="-632.49" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="2698" y="-617.49" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="2698" y="-602.49" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="2698" y="-587.49" font-family="Arial" font-size="14.00">GPU: 11</text>
</g>
<!-- residual1_4_3&#45;&gt;gate_4_3 -->
<g id="edge220" class="edge">
<title>residual1_4_3&#45;&gt;gate_4_3</title>
<path fill="none" stroke="black" d="M2698,-684.39C2698,-684.39 2698,-657.97 2698,-657.97"/>
<polygon fill="black" stroke="black" points="2701.5,-657.97 2698,-647.97 2694.5,-657.97 2701.5,-657.97"/>
</g>
<!-- expert_4_3_0 -->
<g id="node303" class="node">
<title>expert_4_3_0</title>
<polygon fill="lightpink" stroke="black" points="2554,-532.69 2378,-532.69 2378,-464.69 2554,-464.69 2554,-532.69"/>
<text text-anchor="middle" x="2466" y="-517.49" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="2466" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="2466" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="2466" y="-472.49" font-family="Arial" font-size="14.00">GPU: 11</text>
</g>
<!-- gate_4_3&#45;&gt;expert_4_3_0 -->
<g id="edge221" class="edge">
<title>gate_4_3&#45;&gt;expert_4_3_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2611.41,-602C2571.78,-602 2533.5,-602 2533.5,-602 2533.5,-602 2533.5,-542.81 2533.5,-542.81"/>
<polygon fill="black" stroke="black" points="2537,-542.81 2533.5,-532.81 2530,-542.81 2537,-542.81"/>
<text text-anchor="middle" x="2587" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_3_1 -->
<g id="node304" class="node">
<title>expert_4_3_1</title>
<polygon fill="lightpink" stroke="black" points="2748,-532.69 2572,-532.69 2572,-464.69 2748,-464.69 2748,-532.69"/>
<text text-anchor="middle" x="2660" y="-517.49" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="2660" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="2660" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="2660" y="-472.49" font-family="Arial" font-size="14.00">GPU: 11</text>
</g>
<!-- gate_4_3&#45;&gt;expert_4_3_1 -->
<g id="edge223" class="edge">
<title>gate_4_3&#45;&gt;expert_4_3_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2679.75,-579.5C2679.75,-579.5 2679.75,-542.95 2679.75,-542.95"/>
<polygon fill="black" stroke="black" points="2683.25,-542.95 2679.75,-532.95 2676.25,-542.95 2683.25,-542.95"/>
<text text-anchor="middle" x="2710" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_3_2 -->
<g id="node305" class="node">
<title>expert_4_3_2</title>
<polygon fill="lightpink" stroke="black" points="2942,-532.69 2766,-532.69 2766,-464.69 2942,-464.69 2942,-532.69"/>
<text text-anchor="middle" x="2854" y="-517.49" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2854" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="2854" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="2854" y="-472.49" font-family="Arial" font-size="14.00">GPU: 11</text>
</g>
<!-- gate_4_3&#45;&gt;expert_4_3_2 -->
<g id="edge225" class="edge">
<title>gate_4_3&#45;&gt;expert_4_3_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2775.25,-579.5C2775.25,-579.5 2775.25,-542.95 2775.25,-542.95"/>
<polygon fill="black" stroke="black" points="2778.75,-542.95 2775.25,-532.95 2771.75,-542.95 2778.75,-542.95"/>
<text text-anchor="middle" x="2833" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_3_3 -->
<g id="node306" class="node">
<title>expert_4_3_3</title>
<polygon fill="lightpink" stroke="black" points="3136,-532.69 2960,-532.69 2960,-464.69 3136,-464.69 3136,-532.69"/>
<text text-anchor="middle" x="3048" y="-517.49" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="3048" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="3048" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="3048" y="-472.49" font-family="Arial" font-size="14.00">GPU: 11</text>
</g>
<!-- gate_4_3&#45;&gt;expert_4_3_3 -->
<g id="edge227" class="edge">
<title>gate_4_3&#45;&gt;expert_4_3_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2784.78,-625C2879.74,-625 3018.67,-625 3018.67,-625 3018.67,-625 3018.67,-542.87 3018.67,-542.87"/>
<polygon fill="black" stroke="black" points="3022.17,-542.87 3018.67,-532.87 3015.17,-542.87 3022.17,-542.87"/>
<text text-anchor="middle" x="2992" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_4_3 -->
<g id="node307" class="node">
<title>expert_agg_4_3</title>
<polygon fill="lightsteelblue" stroke="black" points="2849.5,-427.69 2664.5,-427.69 2664.5,-359.69 2849.5,-359.69 2849.5,-427.69"/>
<text text-anchor="middle" x="2757" y="-412.49" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="2757" y="-397.49" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="2757" y="-382.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="2757" y="-367.49" font-family="Arial" font-size="14.00">GPU: 11</text>
</g>
<!-- expert_4_3_0&#45;&gt;expert_agg_4_3 -->
<g id="edge222" class="edge">
<title>expert_4_3_0&#45;&gt;expert_agg_4_3</title>
<path fill="none" stroke="black" d="M2466,-464.6C2466,-437.81 2466,-405 2466,-405 2466,-405 2654.13,-405 2654.13,-405"/>
<polygon fill="black" stroke="black" points="2654.13,-408.5 2664.13,-405 2654.13,-401.5 2654.13,-408.5"/>
</g>
<!-- expert_4_3_1&#45;&gt;expert_agg_4_3 -->
<g id="edge224" class="edge">
<title>expert_4_3_1&#45;&gt;expert_agg_4_3</title>
<path fill="none" stroke="black" d="M2706.25,-464.6C2706.25,-464.6 2706.25,-437.97 2706.25,-437.97"/>
<polygon fill="black" stroke="black" points="2709.75,-437.97 2706.25,-427.97 2702.75,-437.97 2709.75,-437.97"/>
</g>
<!-- expert_4_3_2&#45;&gt;expert_agg_4_3 -->
<g id="edge226" class="edge">
<title>expert_4_3_2&#45;&gt;expert_agg_4_3</title>
<path fill="none" stroke="black" d="M2807.75,-464.6C2807.75,-464.6 2807.75,-437.97 2807.75,-437.97"/>
<polygon fill="black" stroke="black" points="2811.25,-437.97 2807.75,-427.97 2804.25,-437.97 2811.25,-437.97"/>
</g>
<!-- expert_4_3_3&#45;&gt;expert_agg_4_3 -->
<g id="edge228" class="edge">
<title>expert_4_3_3&#45;&gt;expert_agg_4_3</title>
<path fill="none" stroke="black" d="M3048,-464.63C3048,-430.18 3048,-382 3048,-382 3048,-382 2859.87,-382 2859.87,-382"/>
<polygon fill="black" stroke="black" points="2859.87,-378.5 2849.87,-382 2859.87,-385.5 2859.87,-378.5"/>
</g>
<!-- residual2_4_3 -->
<g id="node308" class="node">
<title>residual2_4_3</title>
<polygon fill="lightcoral" stroke="black" points="2757,-322.69 2572,-269.69 2757,-216.69 2942,-269.69 2757,-322.69"/>
<text text-anchor="middle" x="2757" y="-280.99" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="2757" y="-265.99" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="2757" y="-250.99" font-family="Arial" font-size="14.00">GPU: 11</text>
</g>
<!-- expert_agg_4_3&#45;&gt;residual2_4_3 -->
<g id="edge229" class="edge">
<title>expert_agg_4_3&#45;&gt;residual2_4_3</title>
<path fill="none" stroke="black" d="M2757,-359.48C2757,-359.48 2757,-332.86 2757,-332.86"/>
<polygon fill="black" stroke="black" points="2760.5,-332.86 2757,-322.86 2753.5,-332.86 2760.5,-332.86"/>
</g>
<!-- allreduce_4_3 -->
<g id="node309" class="node">
<title>allreduce_4_3</title>
<ellipse fill="yellow" stroke="black" cx="2757" cy="-142.22" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="2757" y="-153.52" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="2757" y="-138.52" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="2757" y="-123.52" font-family="Arial" font-size="14.00">GPU: 11</text>
</g>
<!-- residual2_4_3&#45;&gt;allreduce_4_3 -->
<g id="edge230" class="edge">
<title>residual2_4_3&#45;&gt;allreduce_4_3</title>
<path fill="none" stroke="black" d="M2757,-216.37C2757,-216.37 2757,-189.83 2757,-189.83"/>
<polygon fill="black" stroke="black" points="2760.5,-189.83 2757,-179.83 2753.5,-189.83 2760.5,-189.83"/>
</g>
<!-- attn_4_4 -->
<g id="node311" class="node">
<title>attn_4_4</title>
<polygon fill="lightgreen" stroke="black" points="3601,-880.69 3389,-880.69 3389,-827.69 3601,-827.69 3601,-880.69"/>
<text text-anchor="middle" x="3495" y="-865.49" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="3495" y="-850.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="3495" y="-835.49" font-family="Arial" font-size="14.00">GPU: 12</text>
</g>
<!-- ln1_4_4&#45;&gt;attn_4_4 -->
<g id="edge275" class="edge">
<title>ln1_4_4&#45;&gt;attn_4_4</title>
<path fill="none" stroke="black" d="M3495,-917.68C3495,-917.68 3495,-890.83 3495,-890.83"/>
<polygon fill="black" stroke="black" points="3498.5,-890.83 3495,-880.83 3491.5,-890.83 3498.5,-890.83"/>
</g>
<!-- residual1_4_4 -->
<g id="node312" class="node">
<title>residual1_4_4</title>
<polygon fill="lightcoral" stroke="black" points="3495,-790.69 3310,-737.69 3495,-684.69 3680,-737.69 3495,-790.69"/>
<text text-anchor="middle" x="3495" y="-748.99" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="3495" y="-733.99" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="3495" y="-718.99" font-family="Arial" font-size="14.00">GPU: 12</text>
</g>
<!-- attn_4_4&#45;&gt;residual1_4_4 -->
<g id="edge276" class="edge">
<title>attn_4_4&#45;&gt;residual1_4_4</title>
<path fill="none" stroke="black" d="M3495,-827.47C3495,-827.47 3495,-800.93 3495,-800.93"/>
<polygon fill="black" stroke="black" points="3498.5,-800.93 3495,-790.93 3491.5,-800.93 3498.5,-800.93"/>
</g>
<!-- gate_4_4 -->
<g id="node313" class="node">
<title>gate_4_4</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="3581.5,-647.69 3408.5,-647.69 3408.5,-579.69 3581.5,-579.69 3581.5,-647.69"/>
<text text-anchor="middle" x="3495" y="-632.49" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="3495" y="-617.49" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="3495" y="-602.49" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="3495" y="-587.49" font-family="Arial" font-size="14.00">GPU: 12</text>
</g>
<!-- residual1_4_4&#45;&gt;gate_4_4 -->
<g id="edge277" class="edge">
<title>residual1_4_4&#45;&gt;gate_4_4</title>
<path fill="none" stroke="black" d="M3495,-684.39C3495,-684.39 3495,-657.97 3495,-657.97"/>
<polygon fill="black" stroke="black" points="3498.5,-657.97 3495,-647.97 3491.5,-657.97 3498.5,-657.97"/>
</g>
<!-- expert_4_4_0 -->
<g id="node314" class="node">
<title>expert_4_4_0</title>
<polygon fill="lightpink" stroke="black" points="3336,-532.69 3160,-532.69 3160,-464.69 3336,-464.69 3336,-532.69"/>
<text text-anchor="middle" x="3248" y="-517.49" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="3248" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="3248" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="3248" y="-472.49" font-family="Arial" font-size="14.00">GPU: 12</text>
</g>
<!-- gate_4_4&#45;&gt;expert_4_4_0 -->
<g id="edge278" class="edge">
<title>gate_4_4&#45;&gt;expert_4_4_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3408.5,-602C3365.66,-602 3323,-602 3323,-602 3323,-602 3323,-542.81 3323,-542.81"/>
<polygon fill="black" stroke="black" points="3326.5,-542.81 3323,-532.81 3319.5,-542.81 3326.5,-542.81"/>
<text text-anchor="middle" x="3387" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_4_1 -->
<g id="node315" class="node">
<title>expert_4_4_1</title>
<polygon fill="lightpink" stroke="black" points="3530,-532.69 3354,-532.69 3354,-464.69 3530,-464.69 3530,-532.69"/>
<text text-anchor="middle" x="3442" y="-517.49" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="3442" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="3442" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="3442" y="-472.49" font-family="Arial" font-size="14.00">GPU: 12</text>
</g>
<!-- gate_4_4&#45;&gt;expert_4_4_1 -->
<g id="edge280" class="edge">
<title>gate_4_4&#45;&gt;expert_4_4_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3469.25,-579.5C3469.25,-579.5 3469.25,-542.95 3469.25,-542.95"/>
<polygon fill="black" stroke="black" points="3472.75,-542.95 3469.25,-532.95 3465.75,-542.95 3472.75,-542.95"/>
<text text-anchor="middle" x="3510" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_4_2 -->
<g id="node316" class="node">
<title>expert_4_4_2</title>
<polygon fill="lightpink" stroke="black" points="3724,-532.69 3548,-532.69 3548,-464.69 3724,-464.69 3724,-532.69"/>
<text text-anchor="middle" x="3636" y="-517.49" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="3636" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="3636" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="3636" y="-472.49" font-family="Arial" font-size="14.00">GPU: 12</text>
</g>
<!-- gate_4_4&#45;&gt;expert_4_4_2 -->
<g id="edge282" class="edge">
<title>gate_4_4&#45;&gt;expert_4_4_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3564.75,-579.5C3564.75,-579.5 3564.75,-542.95 3564.75,-542.95"/>
<polygon fill="black" stroke="black" points="3568.25,-542.95 3564.75,-532.95 3561.25,-542.95 3568.25,-542.95"/>
<text text-anchor="middle" x="3633" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_4_3 -->
<g id="node317" class="node">
<title>expert_4_4_3</title>
<polygon fill="lightpink" stroke="black" points="3918,-532.69 3742,-532.69 3742,-464.69 3918,-464.69 3918,-532.69"/>
<text text-anchor="middle" x="3830" y="-517.49" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="3830" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="3830" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="3830" y="-472.49" font-family="Arial" font-size="14.00">GPU: 12</text>
</g>
<!-- gate_4_4&#45;&gt;expert_4_4_3 -->
<g id="edge284" class="edge">
<title>gate_4_4&#45;&gt;expert_4_4_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3581.77,-625C3672.14,-625 3800.67,-625 3800.67,-625 3800.67,-625 3800.67,-542.87 3800.67,-542.87"/>
<polygon fill="black" stroke="black" points="3804.17,-542.87 3800.67,-532.87 3797.17,-542.87 3804.17,-542.87"/>
<text text-anchor="middle" x="3792" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_4_4 -->
<g id="node318" class="node">
<title>expert_agg_4_4</title>
<polygon fill="lightsteelblue" stroke="black" points="3631.5,-427.69 3446.5,-427.69 3446.5,-359.69 3631.5,-359.69 3631.5,-427.69"/>
<text text-anchor="middle" x="3539" y="-412.49" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="3539" y="-397.49" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="3539" y="-382.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="3539" y="-367.49" font-family="Arial" font-size="14.00">GPU: 12</text>
</g>
<!-- expert_4_4_0&#45;&gt;expert_agg_4_4 -->
<g id="edge279" class="edge">
<title>expert_4_4_0&#45;&gt;expert_agg_4_4</title>
<path fill="none" stroke="black" d="M3248,-464.6C3248,-437.81 3248,-405 3248,-405 3248,-405 3436.13,-405 3436.13,-405"/>
<polygon fill="black" stroke="black" points="3436.13,-408.5 3446.13,-405 3436.13,-401.5 3436.13,-408.5"/>
</g>
<!-- expert_4_4_1&#45;&gt;expert_agg_4_4 -->
<g id="edge281" class="edge">
<title>expert_4_4_1&#45;&gt;expert_agg_4_4</title>
<path fill="none" stroke="black" d="M3488.25,-464.6C3488.25,-464.6 3488.25,-437.97 3488.25,-437.97"/>
<polygon fill="black" stroke="black" points="3491.75,-437.97 3488.25,-427.97 3484.75,-437.97 3491.75,-437.97"/>
</g>
<!-- expert_4_4_2&#45;&gt;expert_agg_4_4 -->
<g id="edge283" class="edge">
<title>expert_4_4_2&#45;&gt;expert_agg_4_4</title>
<path fill="none" stroke="black" d="M3589.75,-464.6C3589.75,-464.6 3589.75,-437.97 3589.75,-437.97"/>
<polygon fill="black" stroke="black" points="3593.25,-437.97 3589.75,-427.97 3586.25,-437.97 3593.25,-437.97"/>
</g>
<!-- expert_4_4_3&#45;&gt;expert_agg_4_4 -->
<g id="edge285" class="edge">
<title>expert_4_4_3&#45;&gt;expert_agg_4_4</title>
<path fill="none" stroke="black" d="M3830,-464.63C3830,-430.18 3830,-382 3830,-382 3830,-382 3641.87,-382 3641.87,-382"/>
<polygon fill="black" stroke="black" points="3641.87,-378.5 3631.87,-382 3641.87,-385.5 3641.87,-378.5"/>
</g>
<!-- residual2_4_4 -->
<g id="node319" class="node">
<title>residual2_4_4</title>
<polygon fill="lightcoral" stroke="black" points="3539,-322.69 3354,-269.69 3539,-216.69 3724,-269.69 3539,-322.69"/>
<text text-anchor="middle" x="3539" y="-280.99" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="3539" y="-265.99" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="3539" y="-250.99" font-family="Arial" font-size="14.00">GPU: 12</text>
</g>
<!-- expert_agg_4_4&#45;&gt;residual2_4_4 -->
<g id="edge286" class="edge">
<title>expert_agg_4_4&#45;&gt;residual2_4_4</title>
<path fill="none" stroke="black" d="M3539,-359.48C3539,-359.48 3539,-332.86 3539,-332.86"/>
<polygon fill="black" stroke="black" points="3542.5,-332.86 3539,-322.86 3535.5,-332.86 3542.5,-332.86"/>
</g>
<!-- allreduce_4_4 -->
<g id="node320" class="node">
<title>allreduce_4_4</title>
<ellipse fill="yellow" stroke="black" cx="3539" cy="-142.22" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="3539" y="-153.52" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="3539" y="-138.52" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="3539" y="-123.52" font-family="Arial" font-size="14.00">GPU: 12</text>
</g>
<!-- residual2_4_4&#45;&gt;allreduce_4_4 -->
<g id="edge287" class="edge">
<title>residual2_4_4&#45;&gt;allreduce_4_4</title>
<path fill="none" stroke="black" d="M3539,-216.37C3539,-216.37 3539,-189.83 3539,-189.83"/>
<polygon fill="black" stroke="black" points="3542.5,-189.83 3539,-179.83 3535.5,-189.83 3542.5,-189.83"/>
</g>
<!-- attn_4_5 -->
<g id="node322" class="node">
<title>attn_4_5</title>
<polygon fill="lightgreen" stroke="black" points="4368,-880.69 4156,-880.69 4156,-827.69 4368,-827.69 4368,-880.69"/>
<text text-anchor="middle" x="4262" y="-865.49" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="4262" y="-850.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="4262" y="-835.49" font-family="Arial" font-size="14.00">GPU: 13</text>
</g>
<!-- ln1_4_5&#45;&gt;attn_4_5 -->
<g id="edge332" class="edge">
<title>ln1_4_5&#45;&gt;attn_4_5</title>
<path fill="none" stroke="black" d="M4262,-917.68C4262,-917.68 4262,-890.83 4262,-890.83"/>
<polygon fill="black" stroke="black" points="4265.5,-890.83 4262,-880.83 4258.5,-890.83 4265.5,-890.83"/>
</g>
<!-- residual1_4_5 -->
<g id="node323" class="node">
<title>residual1_4_5</title>
<polygon fill="lightcoral" stroke="black" points="4262,-790.69 4077,-737.69 4262,-684.69 4447,-737.69 4262,-790.69"/>
<text text-anchor="middle" x="4262" y="-748.99" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="4262" y="-733.99" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="4262" y="-718.99" font-family="Arial" font-size="14.00">GPU: 13</text>
</g>
<!-- attn_4_5&#45;&gt;residual1_4_5 -->
<g id="edge333" class="edge">
<title>attn_4_5&#45;&gt;residual1_4_5</title>
<path fill="none" stroke="black" d="M4262,-827.47C4262,-827.47 4262,-800.93 4262,-800.93"/>
<polygon fill="black" stroke="black" points="4265.5,-800.93 4262,-790.93 4258.5,-800.93 4265.5,-800.93"/>
</g>
<!-- gate_4_5 -->
<g id="node324" class="node">
<title>gate_4_5</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="4348.5,-647.69 4175.5,-647.69 4175.5,-579.69 4348.5,-579.69 4348.5,-647.69"/>
<text text-anchor="middle" x="4262" y="-632.49" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="4262" y="-617.49" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="4262" y="-602.49" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="4262" y="-587.49" font-family="Arial" font-size="14.00">GPU: 13</text>
</g>
<!-- residual1_4_5&#45;&gt;gate_4_5 -->
<g id="edge334" class="edge">
<title>residual1_4_5&#45;&gt;gate_4_5</title>
<path fill="none" stroke="black" d="M4262,-684.39C4262,-684.39 4262,-657.97 4262,-657.97"/>
<polygon fill="black" stroke="black" points="4265.5,-657.97 4262,-647.97 4258.5,-657.97 4265.5,-657.97"/>
</g>
<!-- expert_4_5_0 -->
<g id="node325" class="node">
<title>expert_4_5_0</title>
<polygon fill="lightpink" stroke="black" points="4118,-532.69 3942,-532.69 3942,-464.69 4118,-464.69 4118,-532.69"/>
<text text-anchor="middle" x="4030" y="-517.49" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="4030" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="4030" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="4030" y="-472.49" font-family="Arial" font-size="14.00">GPU: 13</text>
</g>
<!-- gate_4_5&#45;&gt;expert_4_5_0 -->
<g id="edge335" class="edge">
<title>gate_4_5&#45;&gt;expert_4_5_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4175.41,-602C4135.78,-602 4097.5,-602 4097.5,-602 4097.5,-602 4097.5,-542.81 4097.5,-542.81"/>
<polygon fill="black" stroke="black" points="4101,-542.81 4097.5,-532.81 4094,-542.81 4101,-542.81"/>
<text text-anchor="middle" x="4151" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_5_1 -->
<g id="node326" class="node">
<title>expert_4_5_1</title>
<polygon fill="lightpink" stroke="black" points="4312,-532.69 4136,-532.69 4136,-464.69 4312,-464.69 4312,-532.69"/>
<text text-anchor="middle" x="4224" y="-517.49" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="4224" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="4224" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="4224" y="-472.49" font-family="Arial" font-size="14.00">GPU: 13</text>
</g>
<!-- gate_4_5&#45;&gt;expert_4_5_1 -->
<g id="edge337" class="edge">
<title>gate_4_5&#45;&gt;expert_4_5_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4243.75,-579.5C4243.75,-579.5 4243.75,-542.95 4243.75,-542.95"/>
<polygon fill="black" stroke="black" points="4247.25,-542.95 4243.75,-532.95 4240.25,-542.95 4247.25,-542.95"/>
<text text-anchor="middle" x="4274" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_5_2 -->
<g id="node327" class="node">
<title>expert_4_5_2</title>
<polygon fill="lightpink" stroke="black" points="4506,-532.69 4330,-532.69 4330,-464.69 4506,-464.69 4506,-532.69"/>
<text text-anchor="middle" x="4418" y="-517.49" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="4418" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="4418" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="4418" y="-472.49" font-family="Arial" font-size="14.00">GPU: 13</text>
</g>
<!-- gate_4_5&#45;&gt;expert_4_5_2 -->
<g id="edge339" class="edge">
<title>gate_4_5&#45;&gt;expert_4_5_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4339.25,-579.5C4339.25,-579.5 4339.25,-542.95 4339.25,-542.95"/>
<polygon fill="black" stroke="black" points="4342.75,-542.95 4339.25,-532.95 4335.75,-542.95 4342.75,-542.95"/>
<text text-anchor="middle" x="4397" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_5_3 -->
<g id="node328" class="node">
<title>expert_4_5_3</title>
<polygon fill="lightpink" stroke="black" points="4700,-532.69 4524,-532.69 4524,-464.69 4700,-464.69 4700,-532.69"/>
<text text-anchor="middle" x="4612" y="-517.49" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="4612" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="4612" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="4612" y="-472.49" font-family="Arial" font-size="14.00">GPU: 13</text>
</g>
<!-- gate_4_5&#45;&gt;expert_4_5_3 -->
<g id="edge341" class="edge">
<title>gate_4_5&#45;&gt;expert_4_5_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4348.78,-625C4443.74,-625 4582.67,-625 4582.67,-625 4582.67,-625 4582.67,-542.87 4582.67,-542.87"/>
<polygon fill="black" stroke="black" points="4586.17,-542.87 4582.67,-532.87 4579.17,-542.87 4586.17,-542.87"/>
<text text-anchor="middle" x="4556" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_4_5 -->
<g id="node329" class="node">
<title>expert_agg_4_5</title>
<polygon fill="lightsteelblue" stroke="black" points="4413.5,-427.69 4228.5,-427.69 4228.5,-359.69 4413.5,-359.69 4413.5,-427.69"/>
<text text-anchor="middle" x="4321" y="-412.49" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="4321" y="-397.49" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="4321" y="-382.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="4321" y="-367.49" font-family="Arial" font-size="14.00">GPU: 13</text>
</g>
<!-- expert_4_5_0&#45;&gt;expert_agg_4_5 -->
<g id="edge336" class="edge">
<title>expert_4_5_0&#45;&gt;expert_agg_4_5</title>
<path fill="none" stroke="black" d="M4030,-464.6C4030,-437.81 4030,-405 4030,-405 4030,-405 4218.13,-405 4218.13,-405"/>
<polygon fill="black" stroke="black" points="4218.13,-408.5 4228.13,-405 4218.13,-401.5 4218.13,-408.5"/>
</g>
<!-- expert_4_5_1&#45;&gt;expert_agg_4_5 -->
<g id="edge338" class="edge">
<title>expert_4_5_1&#45;&gt;expert_agg_4_5</title>
<path fill="none" stroke="black" d="M4270.25,-464.6C4270.25,-464.6 4270.25,-437.97 4270.25,-437.97"/>
<polygon fill="black" stroke="black" points="4273.75,-437.97 4270.25,-427.97 4266.75,-437.97 4273.75,-437.97"/>
</g>
<!-- expert_4_5_2&#45;&gt;expert_agg_4_5 -->
<g id="edge340" class="edge">
<title>expert_4_5_2&#45;&gt;expert_agg_4_5</title>
<path fill="none" stroke="black" d="M4371.75,-464.6C4371.75,-464.6 4371.75,-437.97 4371.75,-437.97"/>
<polygon fill="black" stroke="black" points="4375.25,-437.97 4371.75,-427.97 4368.25,-437.97 4375.25,-437.97"/>
</g>
<!-- expert_4_5_3&#45;&gt;expert_agg_4_5 -->
<g id="edge342" class="edge">
<title>expert_4_5_3&#45;&gt;expert_agg_4_5</title>
<path fill="none" stroke="black" d="M4612,-464.63C4612,-430.18 4612,-382 4612,-382 4612,-382 4423.87,-382 4423.87,-382"/>
<polygon fill="black" stroke="black" points="4423.87,-378.5 4413.87,-382 4423.87,-385.5 4423.87,-378.5"/>
</g>
<!-- residual2_4_5 -->
<g id="node330" class="node">
<title>residual2_4_5</title>
<polygon fill="lightcoral" stroke="black" points="4321,-322.69 4136,-269.69 4321,-216.69 4506,-269.69 4321,-322.69"/>
<text text-anchor="middle" x="4321" y="-280.99" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="4321" y="-265.99" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="4321" y="-250.99" font-family="Arial" font-size="14.00">GPU: 13</text>
</g>
<!-- expert_agg_4_5&#45;&gt;residual2_4_5 -->
<g id="edge343" class="edge">
<title>expert_agg_4_5&#45;&gt;residual2_4_5</title>
<path fill="none" stroke="black" d="M4321,-359.48C4321,-359.48 4321,-332.86 4321,-332.86"/>
<polygon fill="black" stroke="black" points="4324.5,-332.86 4321,-322.86 4317.5,-332.86 4324.5,-332.86"/>
</g>
<!-- allreduce_4_5 -->
<g id="node331" class="node">
<title>allreduce_4_5</title>
<ellipse fill="yellow" stroke="black" cx="4321" cy="-142.22" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="4321" y="-153.52" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="4321" y="-138.52" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="4321" y="-123.52" font-family="Arial" font-size="14.00">GPU: 13</text>
</g>
<!-- residual2_4_5&#45;&gt;allreduce_4_5 -->
<g id="edge344" class="edge">
<title>residual2_4_5&#45;&gt;allreduce_4_5</title>
<path fill="none" stroke="black" d="M4321,-216.37C4321,-216.37 4321,-189.83 4321,-189.83"/>
<polygon fill="black" stroke="black" points="4324.5,-189.83 4321,-179.83 4317.5,-189.83 4324.5,-189.83"/>
</g>
<!-- attn_4_6 -->
<g id="node333" class="node">
<title>attn_4_6</title>
<polygon fill="lightgreen" stroke="black" points="5150,-880.69 4938,-880.69 4938,-827.69 5150,-827.69 5150,-880.69"/>
<text text-anchor="middle" x="5044" y="-865.49" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="5044" y="-850.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5044" y="-835.49" font-family="Arial" font-size="14.00">GPU: 14</text>
</g>
<!-- ln1_4_6&#45;&gt;attn_4_6 -->
<g id="edge389" class="edge">
<title>ln1_4_6&#45;&gt;attn_4_6</title>
<path fill="none" stroke="black" d="M5044,-917.68C5044,-917.68 5044,-890.83 5044,-890.83"/>
<polygon fill="black" stroke="black" points="5047.5,-890.83 5044,-880.83 5040.5,-890.83 5047.5,-890.83"/>
</g>
<!-- residual1_4_6 -->
<g id="node334" class="node">
<title>residual1_4_6</title>
<polygon fill="lightcoral" stroke="black" points="5044,-790.69 4859,-737.69 5044,-684.69 5229,-737.69 5044,-790.69"/>
<text text-anchor="middle" x="5044" y="-748.99" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="5044" y="-733.99" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5044" y="-718.99" font-family="Arial" font-size="14.00">GPU: 14</text>
</g>
<!-- attn_4_6&#45;&gt;residual1_4_6 -->
<g id="edge390" class="edge">
<title>attn_4_6&#45;&gt;residual1_4_6</title>
<path fill="none" stroke="black" d="M5044,-827.47C5044,-827.47 5044,-800.93 5044,-800.93"/>
<polygon fill="black" stroke="black" points="5047.5,-800.93 5044,-790.93 5040.5,-800.93 5047.5,-800.93"/>
</g>
<!-- gate_4_6 -->
<g id="node335" class="node">
<title>gate_4_6</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="5130.5,-647.69 4957.5,-647.69 4957.5,-579.69 5130.5,-579.69 5130.5,-647.69"/>
<text text-anchor="middle" x="5044" y="-632.49" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="5044" y="-617.49" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="5044" y="-602.49" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="5044" y="-587.49" font-family="Arial" font-size="14.00">GPU: 14</text>
</g>
<!-- residual1_4_6&#45;&gt;gate_4_6 -->
<g id="edge391" class="edge">
<title>residual1_4_6&#45;&gt;gate_4_6</title>
<path fill="none" stroke="black" d="M5044,-684.39C5044,-684.39 5044,-657.97 5044,-657.97"/>
<polygon fill="black" stroke="black" points="5047.5,-657.97 5044,-647.97 5040.5,-657.97 5047.5,-657.97"/>
</g>
<!-- expert_4_6_0 -->
<g id="node336" class="node">
<title>expert_4_6_0</title>
<polygon fill="lightpink" stroke="black" points="4900,-532.69 4724,-532.69 4724,-464.69 4900,-464.69 4900,-532.69"/>
<text text-anchor="middle" x="4812" y="-517.49" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="4812" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="4812" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="4812" y="-472.49" font-family="Arial" font-size="14.00">GPU: 14</text>
</g>
<!-- gate_4_6&#45;&gt;expert_4_6_0 -->
<g id="edge392" class="edge">
<title>gate_4_6&#45;&gt;expert_4_6_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4957.41,-602C4917.78,-602 4879.5,-602 4879.5,-602 4879.5,-602 4879.5,-542.81 4879.5,-542.81"/>
<polygon fill="black" stroke="black" points="4883,-542.81 4879.5,-532.81 4876,-542.81 4883,-542.81"/>
<text text-anchor="middle" x="4915" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_6_1 -->
<g id="node337" class="node">
<title>expert_4_6_1</title>
<polygon fill="lightpink" stroke="black" points="5094,-532.69 4918,-532.69 4918,-464.69 5094,-464.69 5094,-532.69"/>
<text text-anchor="middle" x="5006" y="-517.49" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="5006" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="5006" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="5006" y="-472.49" font-family="Arial" font-size="14.00">GPU: 14</text>
</g>
<!-- gate_4_6&#45;&gt;expert_4_6_1 -->
<g id="edge394" class="edge">
<title>gate_4_6&#45;&gt;expert_4_6_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5025.75,-579.5C5025.75,-579.5 5025.75,-542.95 5025.75,-542.95"/>
<polygon fill="black" stroke="black" points="5029.25,-542.95 5025.75,-532.95 5022.25,-542.95 5029.25,-542.95"/>
<text text-anchor="middle" x="5056" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_6_2 -->
<g id="node338" class="node">
<title>expert_4_6_2</title>
<polygon fill="lightpink" stroke="black" points="5288,-532.69 5112,-532.69 5112,-464.69 5288,-464.69 5288,-532.69"/>
<text text-anchor="middle" x="5200" y="-517.49" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="5200" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="5200" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="5200" y="-472.49" font-family="Arial" font-size="14.00">GPU: 14</text>
</g>
<!-- gate_4_6&#45;&gt;expert_4_6_2 -->
<g id="edge396" class="edge">
<title>gate_4_6&#45;&gt;expert_4_6_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5121.25,-579.5C5121.25,-579.5 5121.25,-542.95 5121.25,-542.95"/>
<polygon fill="black" stroke="black" points="5124.75,-542.95 5121.25,-532.95 5117.75,-542.95 5124.75,-542.95"/>
<text text-anchor="middle" x="5179" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_6_3 -->
<g id="node339" class="node">
<title>expert_4_6_3</title>
<polygon fill="lightpink" stroke="black" points="5482,-532.69 5306,-532.69 5306,-464.69 5482,-464.69 5482,-532.69"/>
<text text-anchor="middle" x="5394" y="-517.49" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="5394" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="5394" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="5394" y="-472.49" font-family="Arial" font-size="14.00">GPU: 14</text>
</g>
<!-- gate_4_6&#45;&gt;expert_4_6_3 -->
<g id="edge398" class="edge">
<title>gate_4_6&#45;&gt;expert_4_6_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5130.78,-625C5225.74,-625 5364.67,-625 5364.67,-625 5364.67,-625 5364.67,-542.87 5364.67,-542.87"/>
<polygon fill="black" stroke="black" points="5368.17,-542.87 5364.67,-532.87 5361.17,-542.87 5368.17,-542.87"/>
<text text-anchor="middle" x="5338" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_4_6 -->
<g id="node340" class="node">
<title>expert_agg_4_6</title>
<polygon fill="lightsteelblue" stroke="black" points="5195.5,-427.69 5010.5,-427.69 5010.5,-359.69 5195.5,-359.69 5195.5,-427.69"/>
<text text-anchor="middle" x="5103" y="-412.49" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="5103" y="-397.49" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="5103" y="-382.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5103" y="-367.49" font-family="Arial" font-size="14.00">GPU: 14</text>
</g>
<!-- expert_4_6_0&#45;&gt;expert_agg_4_6 -->
<g id="edge393" class="edge">
<title>expert_4_6_0&#45;&gt;expert_agg_4_6</title>
<path fill="none" stroke="black" d="M4812,-464.6C4812,-437.81 4812,-405 4812,-405 4812,-405 5000.13,-405 5000.13,-405"/>
<polygon fill="black" stroke="black" points="5000.13,-408.5 5010.13,-405 5000.13,-401.5 5000.13,-408.5"/>
</g>
<!-- expert_4_6_1&#45;&gt;expert_agg_4_6 -->
<g id="edge395" class="edge">
<title>expert_4_6_1&#45;&gt;expert_agg_4_6</title>
<path fill="none" stroke="black" d="M5052.25,-464.6C5052.25,-464.6 5052.25,-437.97 5052.25,-437.97"/>
<polygon fill="black" stroke="black" points="5055.75,-437.97 5052.25,-427.97 5048.75,-437.97 5055.75,-437.97"/>
</g>
<!-- expert_4_6_2&#45;&gt;expert_agg_4_6 -->
<g id="edge397" class="edge">
<title>expert_4_6_2&#45;&gt;expert_agg_4_6</title>
<path fill="none" stroke="black" d="M5153.75,-464.6C5153.75,-464.6 5153.75,-437.97 5153.75,-437.97"/>
<polygon fill="black" stroke="black" points="5157.25,-437.97 5153.75,-427.97 5150.25,-437.97 5157.25,-437.97"/>
</g>
<!-- expert_4_6_3&#45;&gt;expert_agg_4_6 -->
<g id="edge399" class="edge">
<title>expert_4_6_3&#45;&gt;expert_agg_4_6</title>
<path fill="none" stroke="black" d="M5394,-464.63C5394,-430.18 5394,-382 5394,-382 5394,-382 5205.87,-382 5205.87,-382"/>
<polygon fill="black" stroke="black" points="5205.87,-378.5 5195.87,-382 5205.87,-385.5 5205.87,-378.5"/>
</g>
<!-- residual2_4_6 -->
<g id="node341" class="node">
<title>residual2_4_6</title>
<polygon fill="lightcoral" stroke="black" points="5103,-322.69 4918,-269.69 5103,-216.69 5288,-269.69 5103,-322.69"/>
<text text-anchor="middle" x="5103" y="-280.99" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="5103" y="-265.99" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5103" y="-250.99" font-family="Arial" font-size="14.00">GPU: 14</text>
</g>
<!-- expert_agg_4_6&#45;&gt;residual2_4_6 -->
<g id="edge400" class="edge">
<title>expert_agg_4_6&#45;&gt;residual2_4_6</title>
<path fill="none" stroke="black" d="M5103,-359.48C5103,-359.48 5103,-332.86 5103,-332.86"/>
<polygon fill="black" stroke="black" points="5106.5,-332.86 5103,-322.86 5099.5,-332.86 5106.5,-332.86"/>
</g>
<!-- allreduce_4_6 -->
<g id="node342" class="node">
<title>allreduce_4_6</title>
<ellipse fill="yellow" stroke="black" cx="5103" cy="-142.22" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="5103" y="-153.52" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="5103" y="-138.52" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="5103" y="-123.52" font-family="Arial" font-size="14.00">GPU: 14</text>
</g>
<!-- residual2_4_6&#45;&gt;allreduce_4_6 -->
<g id="edge401" class="edge">
<title>residual2_4_6&#45;&gt;allreduce_4_6</title>
<path fill="none" stroke="black" d="M5103,-216.37C5103,-216.37 5103,-189.83 5103,-189.83"/>
<polygon fill="black" stroke="black" points="5106.5,-189.83 5103,-179.83 5099.5,-189.83 5106.5,-189.83"/>
</g>
<!-- attn_4_7 -->
<g id="node344" class="node">
<title>attn_4_7</title>
<polygon fill="lightgreen" stroke="black" points="5932,-880.69 5720,-880.69 5720,-827.69 5932,-827.69 5932,-880.69"/>
<text text-anchor="middle" x="5826" y="-865.49" font-family="Arial" font-size="14.00">MHA Shard (2 heads × 512 dim)</text>
<text text-anchor="middle" x="5826" y="-850.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5826" y="-835.49" font-family="Arial" font-size="14.00">GPU: 15</text>
</g>
<!-- ln1_4_7&#45;&gt;attn_4_7 -->
<g id="edge446" class="edge">
<title>ln1_4_7&#45;&gt;attn_4_7</title>
<path fill="none" stroke="black" d="M5826,-917.68C5826,-917.68 5826,-890.83 5826,-890.83"/>
<polygon fill="black" stroke="black" points="5829.5,-890.83 5826,-880.83 5822.5,-890.83 5829.5,-890.83"/>
</g>
<!-- residual1_4_7 -->
<g id="node345" class="node">
<title>residual1_4_7</title>
<polygon fill="lightcoral" stroke="black" points="5826,-790.69 5641,-737.69 5826,-684.69 6011,-737.69 5826,-790.69"/>
<text text-anchor="middle" x="5826" y="-748.99" font-family="Arial" font-size="14.00">Add &amp; LayerNorm</text>
<text text-anchor="middle" x="5826" y="-733.99" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5826" y="-718.99" font-family="Arial" font-size="14.00">GPU: 15</text>
</g>
<!-- attn_4_7&#45;&gt;residual1_4_7 -->
<g id="edge447" class="edge">
<title>attn_4_7&#45;&gt;residual1_4_7</title>
<path fill="none" stroke="black" d="M5826,-827.47C5826,-827.47 5826,-800.93 5826,-800.93"/>
<polygon fill="black" stroke="black" points="5829.5,-800.93 5826,-790.93 5822.5,-800.93 5829.5,-800.93"/>
</g>
<!-- gate_4_7 -->
<g id="node346" class="node">
<title>gate_4_7</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="5912.5,-647.69 5739.5,-647.69 5739.5,-579.69 5912.5,-579.69 5912.5,-647.69"/>
<text text-anchor="middle" x="5826" y="-632.49" font-family="Arial" font-size="14.00">Expert Gating</text>
<text text-anchor="middle" x="5826" y="-617.49" font-family="Arial" font-size="14.00">(Compute routing)</text>
<text text-anchor="middle" x="5826" y="-602.49" font-family="Arial" font-size="14.00">(Batch: 1024, Experts: 32)</text>
<text text-anchor="middle" x="5826" y="-587.49" font-family="Arial" font-size="14.00">GPU: 15</text>
</g>
<!-- residual1_4_7&#45;&gt;gate_4_7 -->
<g id="edge448" class="edge">
<title>residual1_4_7&#45;&gt;gate_4_7</title>
<path fill="none" stroke="black" d="M5826,-684.39C5826,-684.39 5826,-657.97 5826,-657.97"/>
<polygon fill="black" stroke="black" points="5829.5,-657.97 5826,-647.97 5822.5,-657.97 5829.5,-657.97"/>
</g>
<!-- expert_4_7_0 -->
<g id="node347" class="node">
<title>expert_4_7_0</title>
<polygon fill="lightpink" stroke="black" points="5682,-532.69 5506,-532.69 5506,-464.69 5682,-464.69 5682,-532.69"/>
<text text-anchor="middle" x="5594" y="-517.49" font-family="Arial" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="5594" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="5594" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="5594" y="-472.49" font-family="Arial" font-size="14.00">GPU: 15</text>
</g>
<!-- gate_4_7&#45;&gt;expert_4_7_0 -->
<g id="edge449" class="edge">
<title>gate_4_7&#45;&gt;expert_4_7_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5739.41,-602C5699.78,-602 5661.5,-602 5661.5,-602 5661.5,-602 5661.5,-542.81 5661.5,-542.81"/>
<polygon fill="black" stroke="black" points="5665,-542.81 5661.5,-532.81 5658,-542.81 5665,-542.81"/>
<text text-anchor="middle" x="5715" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_7_1 -->
<g id="node348" class="node">
<title>expert_4_7_1</title>
<polygon fill="lightpink" stroke="black" points="5876,-532.69 5700,-532.69 5700,-464.69 5876,-464.69 5876,-532.69"/>
<text text-anchor="middle" x="5788" y="-517.49" font-family="Arial" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="5788" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="5788" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="5788" y="-472.49" font-family="Arial" font-size="14.00">GPU: 15</text>
</g>
<!-- gate_4_7&#45;&gt;expert_4_7_1 -->
<g id="edge451" class="edge">
<title>gate_4_7&#45;&gt;expert_4_7_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5807.75,-579.5C5807.75,-579.5 5807.75,-542.95 5807.75,-542.95"/>
<polygon fill="black" stroke="black" points="5811.25,-542.95 5807.75,-532.95 5804.25,-542.95 5811.25,-542.95"/>
<text text-anchor="middle" x="5838" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_7_2 -->
<g id="node349" class="node">
<title>expert_4_7_2</title>
<polygon fill="lightpink" stroke="black" points="6070,-532.69 5894,-532.69 5894,-464.69 6070,-464.69 6070,-532.69"/>
<text text-anchor="middle" x="5982" y="-517.49" font-family="Arial" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="5982" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="5982" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="5982" y="-472.49" font-family="Arial" font-size="14.00">GPU: 15</text>
</g>
<!-- gate_4_7&#45;&gt;expert_4_7_2 -->
<g id="edge453" class="edge">
<title>gate_4_7&#45;&gt;expert_4_7_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5903.25,-579.5C5903.25,-579.5 5903.25,-542.95 5903.25,-542.95"/>
<polygon fill="black" stroke="black" points="5906.75,-542.95 5903.25,-532.95 5899.75,-542.95 5906.75,-542.95"/>
<text text-anchor="middle" x="5961" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_4_7_3 -->
<g id="node350" class="node">
<title>expert_4_7_3</title>
<polygon fill="lightpink" stroke="black" points="6264,-532.69 6088,-532.69 6088,-464.69 6264,-464.69 6264,-532.69"/>
<text text-anchor="middle" x="6176" y="-517.49" font-family="Arial" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="6176" y="-502.49" font-family="Arial" font-size="14.00">MLP (1024→4096→1024)</text>
<text text-anchor="middle" x="6176" y="-487.49" font-family="Arial" font-size="14.00">(Batch: ~32 tokens)</text>
<text text-anchor="middle" x="6176" y="-472.49" font-family="Arial" font-size="14.00">GPU: 15</text>
</g>
<!-- gate_4_7&#45;&gt;expert_4_7_3 -->
<g id="edge455" class="edge">
<title>gate_4_7&#45;&gt;expert_4_7_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5912.78,-613C6007.74,-613 6146.67,-613 6146.67,-613 6146.67,-613 6146.67,-542.99 6146.67,-542.99"/>
<polygon fill="black" stroke="black" points="6150.17,-542.99 6146.67,-532.99 6143.17,-542.99 6150.17,-542.99"/>
<text text-anchor="middle" x="6120" y="-553.69" font-family="Arial" font-size="10.00">tokens</text>
</g>
<!-- expert_agg_4_7 -->
<g id="node351" class="node">
<title>expert_agg_4_7</title>
<polygon fill="lightsteelblue" stroke="black" points="5977.5,-427.69 5792.5,-427.69 5792.5,-359.69 5977.5,-359.69 5977.5,-427.69"/>
<text text-anchor="middle" x="5885" y="-412.49" font-family="Arial" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="5885" y="-397.49" font-family="Arial" font-size="14.00">(4 experts)</text>
<text text-anchor="middle" x="5885" y="-382.49" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5885" y="-367.49" font-family="Arial" font-size="14.00">GPU: 15</text>
</g>
<!-- expert_4_7_0&#45;&gt;expert_agg_4_7 -->
<g id="edge450" class="edge">
<title>expert_4_7_0&#45;&gt;expert_agg_4_7</title>
<path fill="none" stroke="black" d="M5594,-464.6C5594,-437.81 5594,-405 5594,-405 5594,-405 5782.13,-405 5782.13,-405"/>
<polygon fill="black" stroke="black" points="5782.13,-408.5 5792.13,-405 5782.13,-401.5 5782.13,-408.5"/>
</g>
<!-- expert_4_7_1&#45;&gt;expert_agg_4_7 -->
<g id="edge452" class="edge">
<title>expert_4_7_1&#45;&gt;expert_agg_4_7</title>
<path fill="none" stroke="black" d="M5834.25,-464.6C5834.25,-464.6 5834.25,-437.97 5834.25,-437.97"/>
<polygon fill="black" stroke="black" points="5837.75,-437.97 5834.25,-427.97 5830.75,-437.97 5837.75,-437.97"/>
</g>
<!-- expert_4_7_2&#45;&gt;expert_agg_4_7 -->
<g id="edge454" class="edge">
<title>expert_4_7_2&#45;&gt;expert_agg_4_7</title>
<path fill="none" stroke="black" d="M5935.75,-464.6C5935.75,-464.6 5935.75,-437.97 5935.75,-437.97"/>
<polygon fill="black" stroke="black" points="5939.25,-437.97 5935.75,-427.97 5932.25,-437.97 5939.25,-437.97"/>
</g>
<!-- expert_4_7_3&#45;&gt;expert_agg_4_7 -->
<g id="edge456" class="edge">
<title>expert_4_7_3&#45;&gt;expert_agg_4_7</title>
<path fill="none" stroke="black" d="M6176,-464.67C6176,-433.77 6176,-393 6176,-393 6176,-393 5987.87,-393 5987.87,-393"/>
<polygon fill="black" stroke="black" points="5987.87,-389.5 5977.87,-393 5987.87,-396.5 5987.87,-389.5"/>
</g>
<!-- residual2_4_7 -->
<g id="node352" class="node">
<title>residual2_4_7</title>
<polygon fill="lightcoral" stroke="black" points="5885,-322.69 5700,-269.69 5885,-216.69 6070,-269.69 5885,-322.69"/>
<text text-anchor="middle" x="5885" y="-280.99" font-family="Arial" font-size="14.00">Add</text>
<text text-anchor="middle" x="5885" y="-265.99" font-family="Arial" font-size="14.00">(Batch: 1024, Hidden: 1024)</text>
<text text-anchor="middle" x="5885" y="-250.99" font-family="Arial" font-size="14.00">GPU: 15</text>
</g>
<!-- expert_agg_4_7&#45;&gt;residual2_4_7 -->
<g id="edge457" class="edge">
<title>expert_agg_4_7&#45;&gt;residual2_4_7</title>
<path fill="none" stroke="black" d="M5885,-359.48C5885,-359.48 5885,-332.86 5885,-332.86"/>
<polygon fill="black" stroke="black" points="5888.5,-332.86 5885,-322.86 5881.5,-332.86 5888.5,-332.86"/>
</g>
<!-- allreduce_4_7 -->
<g id="node353" class="node">
<title>allreduce_4_7</title>
<ellipse fill="yellow" stroke="black" cx="5885" cy="-142.22" rx="97.66" ry="37.45"/>
<text text-anchor="middle" x="5885" y="-153.52" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="5885" y="-138.52" font-family="Arial" font-size="14.00">(TP across 8 GPUs)</text>
<text text-anchor="middle" x="5885" y="-123.52" font-family="Arial" font-size="14.00">GPU: 15</text>
</g>
<!-- residual2_4_7&#45;&gt;allreduce_4_7 -->
<g id="edge458" class="edge">
<title>residual2_4_7&#45;&gt;allreduce_4_7</title>
<path fill="none" stroke="black" d="M5885,-216.37C5885,-216.37 5885,-189.83 5885,-189.83"/>
<polygon fill="black" stroke="black" points="5888.5,-189.83 5885,-179.83 5881.5,-189.83 5888.5,-189.83"/>
</g>
<!-- pipeline_comm_1_2_0&#45;&gt;ln1_3_0 -->
<g id="edge31" class="edge">
<title>pipeline_comm_1_2_0&#45;&gt;ln1_3_0</title>
<path fill="none" stroke="black" d="M392,-2051.45C392,-2051.45 392,-1941.76 392,-1941.76"/>
<polygon fill="black" stroke="black" points="395.5,-1941.76 392,-1931.76 388.5,-1941.76 395.5,-1941.76"/>
</g>
<!-- pipeline_comm_1_2_1&#45;&gt;ln1_3_1 -->
<g id="edge89" class="edge">
<title>pipeline_comm_1_2_1&#45;&gt;ln1_3_1</title>
<path fill="none" stroke="black" d="M1184,-2051.45C1184,-2051.45 1184,-1941.76 1184,-1941.76"/>
<polygon fill="black" stroke="black" points="1187.5,-1941.76 1184,-1931.76 1180.5,-1941.76 1187.5,-1941.76"/>
</g>
<!-- pipeline_comm_1_2_2&#45;&gt;ln1_3_2 -->
<g id="edge146" class="edge">
<title>pipeline_comm_1_2_2&#45;&gt;ln1_3_2</title>
<path fill="none" stroke="black" d="M1973,-2051.45C1973,-2051.45 1973,-1941.76 1973,-1941.76"/>
<polygon fill="black" stroke="black" points="1976.5,-1941.76 1973,-1931.76 1969.5,-1941.76 1976.5,-1941.76"/>
</g>
<!-- pipeline_comm_1_2_3&#45;&gt;ln1_3_3 -->
<g id="edge203" class="edge">
<title>pipeline_comm_1_2_3&#45;&gt;ln1_3_3</title>
<path fill="none" stroke="black" d="M2761,-2051.45C2761,-2051.45 2761,-1941.76 2761,-1941.76"/>
<polygon fill="black" stroke="black" points="2764.5,-1941.76 2761,-1931.76 2757.5,-1941.76 2764.5,-1941.76"/>
</g>
<!-- pipeline_comm_1_2_4&#45;&gt;ln1_3_4 -->
<g id="edge260" class="edge">
<title>pipeline_comm_1_2_4&#45;&gt;ln1_3_4</title>
<path fill="none" stroke="black" d="M3489,-2051.45C3489,-2051.45 3489,-1941.76 3489,-1941.76"/>
<polygon fill="black" stroke="black" points="3492.5,-1941.76 3489,-1931.76 3485.5,-1941.76 3492.5,-1941.76"/>
</g>
<!-- pipeline_comm_1_2_5&#45;&gt;ln1_3_5 -->
<g id="edge317" class="edge">
<title>pipeline_comm_1_2_5&#45;&gt;ln1_3_5</title>
<path fill="none" stroke="black" d="M4279,-2051.45C4279,-2051.45 4279,-1941.76 4279,-1941.76"/>
<polygon fill="black" stroke="black" points="4282.5,-1941.76 4279,-1931.76 4275.5,-1941.76 4282.5,-1941.76"/>
</g>
<!-- pipeline_comm_1_2_6&#45;&gt;ln1_3_6 -->
<g id="edge374" class="edge">
<title>pipeline_comm_1_2_6&#45;&gt;ln1_3_6</title>
<path fill="none" stroke="black" d="M5070,-2051.45C5070,-2051.45 5070,-1941.76 5070,-1941.76"/>
<polygon fill="black" stroke="black" points="5073.5,-1941.76 5070,-1931.76 5066.5,-1941.76 5073.5,-1941.76"/>
</g>
<!-- pipeline_comm_1_2_7&#45;&gt;ln1_3_7 -->
<g id="edge431" class="edge">
<title>pipeline_comm_1_2_7&#45;&gt;ln1_3_7</title>
<path fill="none" stroke="black" d="M5817,-2051.45C5817,-2051.45 5817,-1941.76 5817,-1941.76"/>
<polygon fill="black" stroke="black" points="5820.5,-1941.76 5817,-1931.76 5813.5,-1941.76 5820.5,-1941.76"/>
</g>
</g>
</svg>
