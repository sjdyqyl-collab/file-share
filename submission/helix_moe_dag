// Helix MoE Transformer DAG with 16-GPU Two-Level Partitioning
digraph {
	nodesep=0.8 rankdir=TB ranksep=1.2 splines=ortho
	node [fillcolor=lightblue shape=rectangle style=filled]
	edge [fontsize=10]
	subgraph cluster_input {
		fillcolor=lightgray label="Input Processing" style=rounded
		input [label="Input Tokens
(B×L×D)
All GPUs" fillcolor=lightgreen shape=ellipse]
		embed [label="Embedding Layer
(B×L×D)
All GPUs" fillcolor=lightblue shape=rectangle]
		pos_enc [label="Positional Encoding
(B×L×D)
All GPUs" fillcolor=lightblue shape=rectangle]
	}
	subgraph cluster_layer1 {
		fillcolor=lightyellow label="Layer 1 (MoE)" style=rounded
		ln1_0 [label="LayerNorm
(B×L×D)
GPU 0-3" fillcolor=lightblue shape=rectangle]
		ln1_1 [label="LayerNorm
(B×L×D)
GPU 4-7" fillcolor=lightblue shape=rectangle]
		ln1_2 [label="LayerNorm
(B×L×D)
GPU 8-11" fillcolor=lightblue shape=rectangle]
		ln1_3 [label="LayerNorm
(B×L×D)
GPU 12-15" fillcolor=lightblue shape=rectangle]
		q_proj_0_0 [label="Q Projection
(B×L×d_s×h_g)
GPU 0" fillcolor=lightcoral shape=rectangle]
		k_proj_0_0 [label="K Projection
(B×L×d_s×h_g)
GPU 0" fillcolor=lightcoral shape=rectangle]
		v_proj_0_0 [label="V Projection
(B×L×d_s×h_g)
GPU 0" fillcolor=lightcoral shape=rectangle]
		attn_0_0 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 0" fillcolor=orange shape=rectangle]
		q_proj_0_1 [label="Q Projection
(B×L×d_s×h_g)
GPU 1" fillcolor=lightcoral shape=rectangle]
		k_proj_0_1 [label="K Projection
(B×L×d_s×h_g)
GPU 1" fillcolor=lightcoral shape=rectangle]
		v_proj_0_1 [label="V Projection
(B×L×d_s×h_g)
GPU 1" fillcolor=lightcoral shape=rectangle]
		attn_0_1 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 1" fillcolor=orange shape=rectangle]
		q_proj_0_2 [label="Q Projection
(B×L×d_s×h_g)
GPU 2" fillcolor=lightcoral shape=rectangle]
		k_proj_0_2 [label="K Projection
(B×L×d_s×h_g)
GPU 2" fillcolor=lightcoral shape=rectangle]
		v_proj_0_2 [label="V Projection
(B×L×d_s×h_g)
GPU 2" fillcolor=lightcoral shape=rectangle]
		attn_0_2 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 2" fillcolor=orange shape=rectangle]
		q_proj_0_3 [label="Q Projection
(B×L×d_s×h_g)
GPU 3" fillcolor=lightcoral shape=rectangle]
		k_proj_0_3 [label="K Projection
(B×L×d_s×h_g)
GPU 3" fillcolor=lightcoral shape=rectangle]
		v_proj_0_3 [label="V Projection
(B×L×d_s×h_g)
GPU 3" fillcolor=lightcoral shape=rectangle]
		attn_0_3 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 3" fillcolor=orange shape=rectangle]
		q_proj_1_0 [label="Q Projection
(B×L×d_s×h_g)
GPU 4" fillcolor=lightcoral shape=rectangle]
		k_proj_1_0 [label="K Projection
(B×L×d_s×h_g)
GPU 4" fillcolor=lightcoral shape=rectangle]
		v_proj_1_0 [label="V Projection
(B×L×d_s×h_g)
GPU 4" fillcolor=lightcoral shape=rectangle]
		attn_1_0 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 4" fillcolor=orange shape=rectangle]
		q_proj_1_1 [label="Q Projection
(B×L×d_s×h_g)
GPU 5" fillcolor=lightcoral shape=rectangle]
		k_proj_1_1 [label="K Projection
(B×L×d_s×h_g)
GPU 5" fillcolor=lightcoral shape=rectangle]
		v_proj_1_1 [label="V Projection
(B×L×d_s×h_g)
GPU 5" fillcolor=lightcoral shape=rectangle]
		attn_1_1 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 5" fillcolor=orange shape=rectangle]
		q_proj_1_2 [label="Q Projection
(B×L×d_s×h_g)
GPU 6" fillcolor=lightcoral shape=rectangle]
		k_proj_1_2 [label="K Projection
(B×L×d_s×h_g)
GPU 6" fillcolor=lightcoral shape=rectangle]
		v_proj_1_2 [label="V Projection
(B×L×d_s×h_g)
GPU 6" fillcolor=lightcoral shape=rectangle]
		attn_1_2 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 6" fillcolor=orange shape=rectangle]
		q_proj_1_3 [label="Q Projection
(B×L×d_s×h_g)
GPU 7" fillcolor=lightcoral shape=rectangle]
		k_proj_1_3 [label="K Projection
(B×L×d_s×h_g)
GPU 7" fillcolor=lightcoral shape=rectangle]
		v_proj_1_3 [label="V Projection
(B×L×d_s×h_g)
GPU 7" fillcolor=lightcoral shape=rectangle]
		attn_1_3 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 7" fillcolor=orange shape=rectangle]
		q_proj_2_0 [label="Q Projection
(B×L×d_s×h_g)
GPU 8" fillcolor=lightcoral shape=rectangle]
		k_proj_2_0 [label="K Projection
(B×L×d_s×h_g)
GPU 8" fillcolor=lightcoral shape=rectangle]
		v_proj_2_0 [label="V Projection
(B×L×d_s×h_g)
GPU 8" fillcolor=lightcoral shape=rectangle]
		attn_2_0 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 8" fillcolor=orange shape=rectangle]
		q_proj_2_1 [label="Q Projection
(B×L×d_s×h_g)
GPU 9" fillcolor=lightcoral shape=rectangle]
		k_proj_2_1 [label="K Projection
(B×L×d_s×h_g)
GPU 9" fillcolor=lightcoral shape=rectangle]
		v_proj_2_1 [label="V Projection
(B×L×d_s×h_g)
GPU 9" fillcolor=lightcoral shape=rectangle]
		attn_2_1 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 9" fillcolor=orange shape=rectangle]
		q_proj_2_2 [label="Q Projection
(B×L×d_s×h_g)
GPU 10" fillcolor=lightcoral shape=rectangle]
		k_proj_2_2 [label="K Projection
(B×L×d_s×h_g)
GPU 10" fillcolor=lightcoral shape=rectangle]
		v_proj_2_2 [label="V Projection
(B×L×d_s×h_g)
GPU 10" fillcolor=lightcoral shape=rectangle]
		attn_2_2 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 10" fillcolor=orange shape=rectangle]
		q_proj_2_3 [label="Q Projection
(B×L×d_s×h_g)
GPU 11" fillcolor=lightcoral shape=rectangle]
		k_proj_2_3 [label="K Projection
(B×L×d_s×h_g)
GPU 11" fillcolor=lightcoral shape=rectangle]
		v_proj_2_3 [label="V Projection
(B×L×d_s×h_g)
GPU 11" fillcolor=lightcoral shape=rectangle]
		attn_2_3 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 11" fillcolor=orange shape=rectangle]
		q_proj_3_0 [label="Q Projection
(B×L×d_s×h_g)
GPU 12" fillcolor=lightcoral shape=rectangle]
		k_proj_3_0 [label="K Projection
(B×L×d_s×h_g)
GPU 12" fillcolor=lightcoral shape=rectangle]
		v_proj_3_0 [label="V Projection
(B×L×d_s×h_g)
GPU 12" fillcolor=lightcoral shape=rectangle]
		attn_3_0 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 12" fillcolor=orange shape=rectangle]
		q_proj_3_1 [label="Q Projection
(B×L×d_s×h_g)
GPU 13" fillcolor=lightcoral shape=rectangle]
		k_proj_3_1 [label="K Projection
(B×L×d_s×h_g)
GPU 13" fillcolor=lightcoral shape=rectangle]
		v_proj_3_1 [label="V Projection
(B×L×d_s×h_g)
GPU 13" fillcolor=lightcoral shape=rectangle]
		attn_3_1 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 13" fillcolor=orange shape=rectangle]
		q_proj_3_2 [label="Q Projection
(B×L×d_s×h_g)
GPU 14" fillcolor=lightcoral shape=rectangle]
		k_proj_3_2 [label="K Projection
(B×L×d_s×h_g)
GPU 14" fillcolor=lightcoral shape=rectangle]
		v_proj_3_2 [label="V Projection
(B×L×d_s×h_g)
GPU 14" fillcolor=lightcoral shape=rectangle]
		attn_3_2 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 14" fillcolor=orange shape=rectangle]
		q_proj_3_3 [label="Q Projection
(B×L×d_s×h_g)
GPU 15" fillcolor=lightcoral shape=rectangle]
		k_proj_3_3 [label="K Projection
(B×L×d_s×h_g)
GPU 15" fillcolor=lightcoral shape=rectangle]
		v_proj_3_3 [label="V Projection
(B×L×d_s×h_g)
GPU 15" fillcolor=lightcoral shape=rectangle]
		attn_3_3 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 15" fillcolor=orange shape=rectangle]
		concat_dim_0 [label="Dimension Concatenation
(B×L×d×h_g)
GPUs 0-3" fillcolor=lightgreen shape=parallelogram style=dashed]
		concat_dim_1 [label="Dimension Concatenation
(B×L×d×h_g)
GPUs 4-7" fillcolor=lightgreen shape=parallelogram style=dashed]
		concat_dim_2 [label="Dimension Concatenation
(B×L×d×h_g)
GPUs 8-11" fillcolor=lightgreen shape=parallelogram style=dashed]
		concat_dim_3 [label="Dimension Concatenation
(B×L×d×h_g)
GPUs 12-15" fillcolor=lightgreen shape=parallelogram style=dashed]
		concat_heads [label="Head Group Concatenation
(B×L×D)
All GPUs" fillcolor=lightgreen shape=parallelogram]
		out_proj [label="Output Projection
(B×L×D)
All GPUs" fillcolor=lightcoral shape=rectangle]
		residual1 [label="Residual Add
(B×L×D)
All GPUs" fillcolor=yellow shape=ellipse]
		ln2 [label="LayerNorm
(B×L×D)
All GPUs" fillcolor=lightblue shape=rectangle]
		gate [label="MoE Gate
(B×L×num_experts)
All GPUs" fillcolor=purple shape=parallelogram]
		expert_select [label="Expert Selection
(B×L×top_k)
All GPUs" fillcolor=purple shape=parallelogram style=dashed]
		expert0_linear1_0 [label="Expert 0 Linear1
(B×L×ffn_hidden_size/2)
GPU 0" fillcolor=lightcoral shape=rectangle]
		expert0_gelu_0 [label="Expert 0 GELU
(B×L×ffn_hidden_size/2)
GPU 0" fillcolor=lightblue shape=rectangle]
		expert0_linear2_0 [label="Expert 0 Linear2
(B×L×D/2)
GPU 0" fillcolor=lightcoral shape=rectangle]
		expert0_linear1_1 [label="Expert 0 Linear1
(B×L×ffn_hidden_size/2)
GPU 1" fillcolor=lightcoral shape=rectangle]
		expert0_gelu_1 [label="Expert 0 GELU
(B×L×ffn_hidden_size/2)
GPU 1" fillcolor=lightblue shape=rectangle]
		expert0_linear2_1 [label="Expert 0 Linear2
(B×L×D/2)
GPU 1" fillcolor=lightcoral shape=rectangle]
		expert0_agg [label="Expert 0 Output Aggregation
(B×L×D)
GPUs 0,1" fillcolor=lightgreen shape=parallelogram]
		expert1_linear1_2 [label="Expert 1 Linear1
(B×L×ffn_hidden_size/2)
GPU 2" fillcolor=lightcoral shape=rectangle]
		expert1_gelu_2 [label="Expert 1 GELU
(B×L×ffn_hidden_size/2)
GPU 2" fillcolor=lightblue shape=rectangle]
		expert1_linear2_2 [label="Expert 1 Linear2
(B×L×D/2)
GPU 2" fillcolor=lightcoral shape=rectangle]
		expert1_linear1_3 [label="Expert 1 Linear1
(B×L×ffn_hidden_size/2)
GPU 3" fillcolor=lightcoral shape=rectangle]
		expert1_gelu_3 [label="Expert 1 GELU
(B×L×ffn_hidden_size/2)
GPU 3" fillcolor=lightblue shape=rectangle]
		expert1_linear2_3 [label="Expert 1 Linear2
(B×L×D/2)
GPU 3" fillcolor=lightcoral shape=rectangle]
		expert1_agg [label="Expert 1 Output Aggregation
(B×L×D)
GPUs 2,3" fillcolor=lightgreen shape=parallelogram]
		expert2_linear1_4 [label="Expert 2 Linear1
(B×L×ffn_hidden_size/2)
GPU 4" fillcolor=lightcoral shape=rectangle]
		expert2_gelu_4 [label="Expert 2 GELU
(B×L×ffn_hidden_size/2)
GPU 4" fillcolor=lightblue shape=rectangle]
		expert2_linear2_4 [label="Expert 2 Linear2
(B×L×D/2)
GPU 4" fillcolor=lightcoral shape=rectangle]
		expert2_linear1_5 [label="Expert 2 Linear1
(B×L×ffn_hidden_size/2)
GPU 5" fillcolor=lightcoral shape=rectangle]
		expert2_gelu_5 [label="Expert 2 GELU
(B×L×ffn_hidden_size/2)
GPU 5" fillcolor=lightblue shape=rectangle]
		expert2_linear2_5 [label="Expert 2 Linear2
(B×L×D/2)
GPU 5" fillcolor=lightcoral shape=rectangle]
		expert2_agg [label="Expert 2 Output Aggregation
(B×L×D)
GPUs 4,5" fillcolor=lightgreen shape=parallelogram]
		expert3_linear1_6 [label="Expert 3 Linear1
(B×L×ffn_hidden_size/2)
GPU 6" fillcolor=lightcoral shape=rectangle]
		expert3_gelu_6 [label="Expert 3 GELU
(B×L×ffn_hidden_size/2)
GPU 6" fillcolor=lightblue shape=rectangle]
		expert3_linear2_6 [label="Expert 3 Linear2
(B×L×D/2)
GPU 6" fillcolor=lightcoral shape=rectangle]
		expert3_linear1_7 [label="Expert 3 Linear1
(B×L×ffn_hidden_size/2)
GPU 7" fillcolor=lightcoral shape=rectangle]
		expert3_gelu_7 [label="Expert 3 GELU
(B×L×ffn_hidden_size/2)
GPU 7" fillcolor=lightblue shape=rectangle]
		expert3_linear2_7 [label="Expert 3 Linear2
(B×L×D/2)
GPU 7" fillcolor=lightcoral shape=rectangle]
		expert3_agg [label="Expert 3 Output Aggregation
(B×L×D)
GPUs 6,7" fillcolor=lightgreen shape=parallelogram]
		expert4_linear1_8 [label="Expert 4 Linear1
(B×L×ffn_hidden_size/2)
GPU 8" fillcolor=lightcoral shape=rectangle]
		expert4_gelu_8 [label="Expert 4 GELU
(B×L×ffn_hidden_size/2)
GPU 8" fillcolor=lightblue shape=rectangle]
		expert4_linear2_8 [label="Expert 4 Linear2
(B×L×D/2)
GPU 8" fillcolor=lightcoral shape=rectangle]
		expert4_linear1_9 [label="Expert 4 Linear1
(B×L×ffn_hidden_size/2)
GPU 9" fillcolor=lightcoral shape=rectangle]
		expert4_gelu_9 [label="Expert 4 GELU
(B×L×ffn_hidden_size/2)
GPU 9" fillcolor=lightblue shape=rectangle]
		expert4_linear2_9 [label="Expert 4 Linear2
(B×L×D/2)
GPU 9" fillcolor=lightcoral shape=rectangle]
		expert4_agg [label="Expert 4 Output Aggregation
(B×L×D)
GPUs 8,9" fillcolor=lightgreen shape=parallelogram]
		expert5_linear1_10 [label="Expert 5 Linear1
(B×L×ffn_hidden_size/2)
GPU 10" fillcolor=lightcoral shape=rectangle]
		expert5_gelu_10 [label="Expert 5 GELU
(B×L×ffn_hidden_size/2)
GPU 10" fillcolor=lightblue shape=rectangle]
		expert5_linear2_10 [label="Expert 5 Linear2
(B×L×D/2)
GPU 10" fillcolor=lightcoral shape=rectangle]
		expert5_linear1_11 [label="Expert 5 Linear1
(B×L×ffn_hidden_size/2)
GPU 11" fillcolor=lightcoral shape=rectangle]
		expert5_gelu_11 [label="Expert 5 GELU
(B×L×ffn_hidden_size/2)
GPU 11" fillcolor=lightblue shape=rectangle]
		expert5_linear2_11 [label="Expert 5 Linear2
(B×L×D/2)
GPU 11" fillcolor=lightcoral shape=rectangle]
		expert5_agg [label="Expert 5 Output Aggregation
(B×L×D)
GPUs 10,11" fillcolor=lightgreen shape=parallelogram]
		expert6_linear1_12 [label="Expert 6 Linear1
(B×L×ffn_hidden_size/2)
GPU 12" fillcolor=lightcoral shape=rectangle]
		expert6_gelu_12 [label="Expert 6 GELU
(B×L×ffn_hidden_size/2)
GPU 12" fillcolor=lightblue shape=rectangle]
		expert6_linear2_12 [label="Expert 6 Linear2
(B×L×D/2)
GPU 12" fillcolor=lightcoral shape=rectangle]
		expert6_linear1_13 [label="Expert 6 Linear1
(B×L×ffn_hidden_size/2)
GPU 13" fillcolor=lightcoral shape=rectangle]
		expert6_gelu_13 [label="Expert 6 GELU
(B×L×ffn_hidden_size/2)
GPU 13" fillcolor=lightblue shape=rectangle]
		expert6_linear2_13 [label="Expert 6 Linear2
(B×L×D/2)
GPU 13" fillcolor=lightcoral shape=rectangle]
		expert6_agg [label="Expert 6 Output Aggregation
(B×L×D)
GPUs 12,13" fillcolor=lightgreen shape=parallelogram]
		expert7_linear1_14 [label="Expert 7 Linear1
(B×L×ffn_hidden_size/2)
GPU 14" fillcolor=lightcoral shape=rectangle]
		expert7_gelu_14 [label="Expert 7 GELU
(B×L×ffn_hidden_size/2)
GPU 14" fillcolor=lightblue shape=rectangle]
		expert7_linear2_14 [label="Expert 7 Linear2
(B×L×D/2)
GPU 14" fillcolor=lightcoral shape=rectangle]
		expert7_linear1_15 [label="Expert 7 Linear1
(B×L×ffn_hidden_size/2)
GPU 15" fillcolor=lightcoral shape=rectangle]
		expert7_gelu_15 [label="Expert 7 GELU
(B×L×ffn_hidden_size/2)
GPU 15" fillcolor=lightblue shape=rectangle]
		expert7_linear2_15 [label="Expert 7 Linear2
(B×L×D/2)
GPU 15" fillcolor=lightcoral shape=rectangle]
		expert7_agg [label="Expert 7 Output Aggregation
(B×L×D)
GPUs 14,15" fillcolor=lightgreen shape=parallelogram]
		expert_outputs [label="Expert Outputs Aggregation
(B×L×D)
All GPUs" fillcolor=lightgreen shape=parallelogram]
		weighted_sum [label="Weighted Sum
(B×L×D)
All GPUs" fillcolor=lightgreen shape=parallelogram]
		residual2 [label="Residual Add
(B×L×D)
All GPUs" fillcolor=yellow shape=ellipse]
	}
	subgraph cluster_layer2 {
		fillcolor=lightyellow label="Layer 2 (MoE)" style=rounded
		ln2_0 [label="LayerNorm
(B×L×D)
GPU 0-3" fillcolor=lightblue shape=rectangle]
		ln2_1 [label="LayerNorm
(B×L×D)
GPU 4-7" fillcolor=lightblue shape=rectangle]
		ln2_2 [label="LayerNorm
(B×L×D)
GPU 8-11" fillcolor=lightblue shape=rectangle]
		ln2_3 [label="LayerNorm
(B×L×D)
GPU 12-15" fillcolor=lightblue shape=rectangle]
		q_proj_2_0_0 [label="Q Projection
(B×L×d_s×h_g)
GPU 0" fillcolor=lightcoral shape=rectangle]
		k_proj_2_0_0 [label="K Projection
(B×L×d_s×h_g)
GPU 0" fillcolor=lightcoral shape=rectangle]
		v_proj_2_0_0 [label="V Projection
(B×L×d_s×h_g)
GPU 0" fillcolor=lightcoral shape=rectangle]
		attn_2_0_0 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 0" fillcolor=orange shape=rectangle]
		q_proj_2_0_1 [label="Q Projection
(B×L×d_s×h_g)
GPU 1" fillcolor=lightcoral shape=rectangle]
		k_proj_2_0_1 [label="K Projection
(B×L×d_s×h_g)
GPU 1" fillcolor=lightcoral shape=rectangle]
		v_proj_2_0_1 [label="V Projection
(B×L×d_s×h_g)
GPU 1" fillcolor=lightcoral shape=rectangle]
		attn_2_0_1 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 1" fillcolor=orange shape=rectangle]
		q_proj_2_0_2 [label="Q Projection
(B×L×d_s×h_g)
GPU 2" fillcolor=lightcoral shape=rectangle]
		k_proj_2_0_2 [label="K Projection
(B×L×d_s×h_g)
GPU 2" fillcolor=lightcoral shape=rectangle]
		v_proj_2_0_2 [label="V Projection
(B×L×d_s×h_g)
GPU 2" fillcolor=lightcoral shape=rectangle]
		attn_2_0_2 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 2" fillcolor=orange shape=rectangle]
		q_proj_2_0_3 [label="Q Projection
(B×L×d_s×h_g)
GPU 3" fillcolor=lightcoral shape=rectangle]
		k_proj_2_0_3 [label="K Projection
(B×L×d_s×h_g)
GPU 3" fillcolor=lightcoral shape=rectangle]
		v_proj_2_0_3 [label="V Projection
(B×L×d_s×h_g)
GPU 3" fillcolor=lightcoral shape=rectangle]
		attn_2_0_3 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 3" fillcolor=orange shape=rectangle]
		q_proj_2_1_0 [label="Q Projection
(B×L×d_s×h_g)
GPU 4" fillcolor=lightcoral shape=rectangle]
		k_proj_2_1_0 [label="K Projection
(B×L×d_s×h_g)
GPU 4" fillcolor=lightcoral shape=rectangle]
		v_proj_2_1_0 [label="V Projection
(B×L×d_s×h_g)
GPU 4" fillcolor=lightcoral shape=rectangle]
		attn_2_1_0 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 4" fillcolor=orange shape=rectangle]
		q_proj_2_1_1 [label="Q Projection
(B×L×d_s×h_g)
GPU 5" fillcolor=lightcoral shape=rectangle]
		k_proj_2_1_1 [label="K Projection
(B×L×d_s×h_g)
GPU 5" fillcolor=lightcoral shape=rectangle]
		v_proj_2_1_1 [label="V Projection
(B×L×d_s×h_g)
GPU 5" fillcolor=lightcoral shape=rectangle]
		attn_2_1_1 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 5" fillcolor=orange shape=rectangle]
		q_proj_2_1_2 [label="Q Projection
(B×L×d_s×h_g)
GPU 6" fillcolor=lightcoral shape=rectangle]
		k_proj_2_1_2 [label="K Projection
(B×L×d_s×h_g)
GPU 6" fillcolor=lightcoral shape=rectangle]
		v_proj_2_1_2 [label="V Projection
(B×L×d_s×h_g)
GPU 6" fillcolor=lightcoral shape=rectangle]
		attn_2_1_2 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 6" fillcolor=orange shape=rectangle]
		q_proj_2_1_3 [label="Q Projection
(B×L×d_s×h_g)
GPU 7" fillcolor=lightcoral shape=rectangle]
		k_proj_2_1_3 [label="K Projection
(B×L×d_s×h_g)
GPU 7" fillcolor=lightcoral shape=rectangle]
		v_proj_2_1_3 [label="V Projection
(B×L×d_s×h_g)
GPU 7" fillcolor=lightcoral shape=rectangle]
		attn_2_1_3 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 7" fillcolor=orange shape=rectangle]
		q_proj_2_2_0 [label="Q Projection
(B×L×d_s×h_g)
GPU 8" fillcolor=lightcoral shape=rectangle]
		k_proj_2_2_0 [label="K Projection
(B×L×d_s×h_g)
GPU 8" fillcolor=lightcoral shape=rectangle]
		v_proj_2_2_0 [label="V Projection
(B×L×d_s×h_g)
GPU 8" fillcolor=lightcoral shape=rectangle]
		attn_2_2_0 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 8" fillcolor=orange shape=rectangle]
		q_proj_2_2_1 [label="Q Projection
(B×L×d_s×h_g)
GPU 9" fillcolor=lightcoral shape=rectangle]
		k_proj_2_2_1 [label="K Projection
(B×L×d_s×h_g)
GPU 9" fillcolor=lightcoral shape=rectangle]
		v_proj_2_2_1 [label="V Projection
(B×L×d_s×h_g)
GPU 9" fillcolor=lightcoral shape=rectangle]
		attn_2_2_1 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 9" fillcolor=orange shape=rectangle]
		q_proj_2_2_2 [label="Q Projection
(B×L×d_s×h_g)
GPU 10" fillcolor=lightcoral shape=rectangle]
		k_proj_2_2_2 [label="K Projection
(B×L×d_s×h_g)
GPU 10" fillcolor=lightcoral shape=rectangle]
		v_proj_2_2_2 [label="V Projection
(B×L×d_s×h_g)
GPU 10" fillcolor=lightcoral shape=rectangle]
		attn_2_2_2 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 10" fillcolor=orange shape=rectangle]
		q_proj_2_2_3 [label="Q Projection
(B×L×d_s×h_g)
GPU 11" fillcolor=lightcoral shape=rectangle]
		k_proj_2_2_3 [label="K Projection
(B×L×d_s×h_g)
GPU 11" fillcolor=lightcoral shape=rectangle]
		v_proj_2_2_3 [label="V Projection
(B×L×d_s×h_g)
GPU 11" fillcolor=lightcoral shape=rectangle]
		attn_2_2_3 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 11" fillcolor=orange shape=rectangle]
		q_proj_2_3_0 [label="Q Projection
(B×L×d_s×h_g)
GPU 12" fillcolor=lightcoral shape=rectangle]
		k_proj_2_3_0 [label="K Projection
(B×L×d_s×h_g)
GPU 12" fillcolor=lightcoral shape=rectangle]
		v_proj_2_3_0 [label="V Projection
(B×L×d_s×h_g)
GPU 12" fillcolor=lightcoral shape=rectangle]
		attn_2_3_0 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 12" fillcolor=orange shape=rectangle]
		q_proj_2_3_1 [label="Q Projection
(B×L×d_s×h_g)
GPU 13" fillcolor=lightcoral shape=rectangle]
		k_proj_2_3_1 [label="K Projection
(B×L×d_s×h_g)
GPU 13" fillcolor=lightcoral shape=rectangle]
		v_proj_2_3_1 [label="V Projection
(B×L×d_s×h_g)
GPU 13" fillcolor=lightcoral shape=rectangle]
		attn_2_3_1 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 13" fillcolor=orange shape=rectangle]
		q_proj_2_3_2 [label="Q Projection
(B×L×d_s×h_g)
GPU 14" fillcolor=lightcoral shape=rectangle]
		k_proj_2_3_2 [label="K Projection
(B×L×d_s×h_g)
GPU 14" fillcolor=lightcoral shape=rectangle]
		v_proj_2_3_2 [label="V Projection
(B×L×d_s×h_g)
GPU 14" fillcolor=lightcoral shape=rectangle]
		attn_2_3_2 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 14" fillcolor=orange shape=rectangle]
		q_proj_2_3_3 [label="Q Projection
(B×L×d_s×h_g)
GPU 15" fillcolor=lightcoral shape=rectangle]
		k_proj_2_3_3 [label="K Projection
(B×L×d_s×h_g)
GPU 15" fillcolor=lightcoral shape=rectangle]
		v_proj_2_3_3 [label="V Projection
(B×L×d_s×h_g)
GPU 15" fillcolor=lightcoral shape=rectangle]
		attn_2_3_3 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 15" fillcolor=orange shape=rectangle]
		concat_dim_2_0 [label="Dimension Concatenation
(B×L×d×h_g)
GPUs 0-3" fillcolor=lightgreen shape=parallelogram style=dashed]
		concat_dim_2_1 [label="Dimension Concatenation
(B×L×d×h_g)
GPUs 4-7" fillcolor=lightgreen shape=parallelogram style=dashed]
		concat_dim_2_2 [label="Dimension Concatenation
(B×L×d×h_g)
GPUs 8-11" fillcolor=lightgreen shape=parallelogram style=dashed]
		concat_dim_2_3 [label="Dimension Concatenation
(B×L×d×h_g)
GPUs 12-15" fillcolor=lightgreen shape=parallelogram style=dashed]
		concat_heads_2 [label="Head Group Concatenation
(B×L×D)
All GPUs" fillcolor=lightgreen shape=parallelogram]
		out_proj_2 [label="Output Projection
(B×L×D)
All GPUs" fillcolor=lightcoral shape=rectangle]
		residual2_1 [label="Residual Add
(B×L×D)
All GPUs" fillcolor=yellow shape=ellipse]
		ln2_mlp [label="LayerNorm
(B×L×D)
All GPUs" fillcolor=lightblue shape=rectangle]
		gate2 [label="MoE Gate
(B×L×num_experts)
All GPUs" fillcolor=purple shape=parallelogram]
		expert_select2 [label="Expert Selection
(B×L×top_k)
All GPUs" fillcolor=purple shape=parallelogram style=dashed]
		expert2_0_linear1_0 [label="Expert 0 Linear1
(B×L×ffn_hidden_size/2)
GPU 0" fillcolor=lightcoral shape=rectangle]
		expert2_0_gelu_0 [label="Expert 0 GELU
(B×L×ffn_hidden_size/2)
GPU 0" fillcolor=lightblue shape=rectangle]
		expert2_0_linear2_0 [label="Expert 0 Linear2
(B×L×D/2)
GPU 0" fillcolor=lightcoral shape=rectangle]
		expert2_0_linear1_1 [label="Expert 0 Linear1
(B×L×ffn_hidden_size/2)
GPU 1" fillcolor=lightcoral shape=rectangle]
		expert2_0_gelu_1 [label="Expert 0 GELU
(B×L×ffn_hidden_size/2)
GPU 1" fillcolor=lightblue shape=rectangle]
		expert2_0_linear2_1 [label="Expert 0 Linear2
(B×L×D/2)
GPU 1" fillcolor=lightcoral shape=rectangle]
		expert2_0_agg [label="Expert 0 Output Aggregation
(B×L×D)
GPUs 0,1" fillcolor=lightgreen shape=parallelogram]
		expert2_1_linear1_2 [label="Expert 1 Linear1
(B×L×ffn_hidden_size/2)
GPU 2" fillcolor=lightcoral shape=rectangle]
		expert2_1_gelu_2 [label="Expert 1 GELU
(B×L×ffn_hidden_size/2)
GPU 2" fillcolor=lightblue shape=rectangle]
		expert2_1_linear2_2 [label="Expert 1 Linear2
(B×L×D/2)
GPU 2" fillcolor=lightcoral shape=rectangle]
		expert2_1_linear1_3 [label="Expert 1 Linear1
(B×L×ffn_hidden_size/2)
GPU 3" fillcolor=lightcoral shape=rectangle]
		expert2_1_gelu_3 [label="Expert 1 GELU
(B×L×ffn_hidden_size/2)
GPU 3" fillcolor=lightblue shape=rectangle]
		expert2_1_linear2_3 [label="Expert 1 Linear2
(B×L×D/2)
GPU 3" fillcolor=lightcoral shape=rectangle]
		expert2_1_agg [label="Expert 1 Output Aggregation
(B×L×D)
GPUs 2,3" fillcolor=lightgreen shape=parallelogram]
		expert2_2_linear1_4 [label="Expert 2 Linear1
(B×L×ffn_hidden_size/2)
GPU 4" fillcolor=lightcoral shape=rectangle]
		expert2_2_gelu_4 [label="Expert 2 GELU
(B×L×ffn_hidden_size/2)
GPU 4" fillcolor=lightblue shape=rectangle]
		expert2_2_linear2_4 [label="Expert 2 Linear2
(B×L×D/2)
GPU 4" fillcolor=lightcoral shape=rectangle]
		expert2_2_linear1_5 [label="Expert 2 Linear1
(B×L×ffn_hidden_size/2)
GPU 5" fillcolor=lightcoral shape=rectangle]
		expert2_2_gelu_5 [label="Expert 2 GELU
(B×L×ffn_hidden_size/2)
GPU 5" fillcolor=lightblue shape=rectangle]
		expert2_2_linear2_5 [label="Expert 2 Linear2
(B×L×D/2)
GPU 5" fillcolor=lightcoral shape=rectangle]
		expert2_2_agg [label="Expert 2 Output Aggregation
(B×L×D)
GPUs 4,5" fillcolor=lightgreen shape=parallelogram]
		expert2_3_linear1_6 [label="Expert 3 Linear1
(B×L×ffn_hidden_size/2)
GPU 6" fillcolor=lightcoral shape=rectangle]
		expert2_3_gelu_6 [label="Expert 3 GELU
(B×L×ffn_hidden_size/2)
GPU 6" fillcolor=lightblue shape=rectangle]
		expert2_3_linear2_6 [label="Expert 3 Linear2
(B×L×D/2)
GPU 6" fillcolor=lightcoral shape=rectangle]
		expert2_3_linear1_7 [label="Expert 3 Linear1
(B×L×ffn_hidden_size/2)
GPU 7" fillcolor=lightcoral shape=rectangle]
		expert2_3_gelu_7 [label="Expert 3 GELU
(B×L×ffn_hidden_size/2)
GPU 7" fillcolor=lightblue shape=rectangle]
		expert2_3_linear2_7 [label="Expert 3 Linear2
(B×L×D/2)
GPU 7" fillcolor=lightcoral shape=rectangle]
		expert2_3_agg [label="Expert 3 Output Aggregation
(B×L×D)
GPUs 6,7" fillcolor=lightgreen shape=parallelogram]
		expert2_4_linear1_8 [label="Expert 4 Linear1
(B×L×ffn_hidden_size/2)
GPU 8" fillcolor=lightcoral shape=rectangle]
		expert2_4_gelu_8 [label="Expert 4 GELU
(B×L×ffn_hidden_size/2)
GPU 8" fillcolor=lightblue shape=rectangle]
		expert2_4_linear2_8 [label="Expert 4 Linear2
(B×L×D/2)
GPU 8" fillcolor=lightcoral shape=rectangle]
		expert2_4_linear1_9 [label="Expert 4 Linear1
(B×L×ffn_hidden_size/2)
GPU 9" fillcolor=lightcoral shape=rectangle]
		expert2_4_gelu_9 [label="Expert 4 GELU
(B×L×ffn_hidden_size/2)
GPU 9" fillcolor=lightblue shape=rectangle]
		expert2_4_linear2_9 [label="Expert 4 Linear2
(B×L×D/2)
GPU 9" fillcolor=lightcoral shape=rectangle]
		expert2_4_agg [label="Expert 4 Output Aggregation
(B×L×D)
GPUs 8,9" fillcolor=lightgreen shape=parallelogram]
		expert2_5_linear1_10 [label="Expert 5 Linear1
(B×L×ffn_hidden_size/2)
GPU 10" fillcolor=lightcoral shape=rectangle]
		expert2_5_gelu_10 [label="Expert 5 GELU
(B×L×ffn_hidden_size/2)
GPU 10" fillcolor=lightblue shape=rectangle]
		expert2_5_linear2_10 [label="Expert 5 Linear2
(B×L×D/2)
GPU 10" fillcolor=lightcoral shape=rectangle]
		expert2_5_linear1_11 [label="Expert 5 Linear1
(B×L×ffn_hidden_size/2)
GPU 11" fillcolor=lightcoral shape=rectangle]
		expert2_5_gelu_11 [label="Expert 5 GELU
(B×L×ffn_hidden_size/2)
GPU 11" fillcolor=lightblue shape=rectangle]
		expert2_5_linear2_11 [label="Expert 5 Linear2
(B×L×D/2)
GPU 11" fillcolor=lightcoral shape=rectangle]
		expert2_5_agg [label="Expert 5 Output Aggregation
(B×L×D)
GPUs 10,11" fillcolor=lightgreen shape=parallelogram]
		expert2_6_linear1_12 [label="Expert 6 Linear1
(B×L×ffn_hidden_size/2)
GPU 12" fillcolor=lightcoral shape=rectangle]
		expert2_6_gelu_12 [label="Expert 6 GELU
(B×L×ffn_hidden_size/2)
GPU 12" fillcolor=lightblue shape=rectangle]
		expert2_6_linear2_12 [label="Expert 6 Linear2
(B×L×D/2)
GPU 12" fillcolor=lightcoral shape=rectangle]
		expert2_6_linear1_13 [label="Expert 6 Linear1
(B×L×ffn_hidden_size/2)
GPU 13" fillcolor=lightcoral shape=rectangle]
		expert2_6_gelu_13 [label="Expert 6 GELU
(B×L×ffn_hidden_size/2)
GPU 13" fillcolor=lightblue shape=rectangle]
		expert2_6_linear2_13 [label="Expert 6 Linear2
(B×L×D/2)
GPU 13" fillcolor=lightcoral shape=rectangle]
		expert2_6_agg [label="Expert 6 Output Aggregation
(B×L×D)
GPUs 12,13" fillcolor=lightgreen shape=parallelogram]
		expert2_7_linear1_14 [label="Expert 7 Linear1
(B×L×ffn_hidden_size/2)
GPU 14" fillcolor=lightcoral shape=rectangle]
		expert2_7_gelu_14 [label="Expert 7 GELU
(B×L×ffn_hidden_size/2)
GPU 14" fillcolor=lightblue shape=rectangle]
		expert2_7_linear2_14 [label="Expert 7 Linear2
(B×L×D/2)
GPU 14" fillcolor=lightcoral shape=rectangle]
		expert2_7_linear1_15 [label="Expert 7 Linear1
(B×L×ffn_hidden_size/2)
GPU 15" fillcolor=lightcoral shape=rectangle]
		expert2_7_gelu_15 [label="Expert 7 GELU
(B×L×ffn_hidden_size/2)
GPU 15" fillcolor=lightblue shape=rectangle]
		expert2_7_linear2_15 [label="Expert 7 Linear2
(B×L×D/2)
GPU 15" fillcolor=lightcoral shape=rectangle]
		expert2_7_agg [label="Expert 7 Output Aggregation
(B×L×D)
GPUs 14,15" fillcolor=lightgreen shape=parallelogram]
		expert_outputs2 [label="Expert Outputs Aggregation
(B×L×D)
All GPUs" fillcolor=lightgreen shape=parallelogram]
		weighted_sum2 [label="Weighted Sum
(B×L×D)
All GPUs" fillcolor=lightgreen shape=parallelogram]
		residual2_2 [label="Residual Add
(B×L×D)
All GPUs" fillcolor=yellow shape=ellipse]
	}
	subgraph cluster_layer3 {
		fillcolor=lightyellow label="Layer 3 (MoE)" style=rounded
		ln3_0 [label="LayerNorm
(B×L×D)
GPU 0-3" fillcolor=lightblue shape=rectangle]
		ln3_1 [label="LayerNorm
(B×L×D)
GPU 4-7" fillcolor=lightblue shape=rectangle]
		ln3_2 [label="LayerNorm
(B×L×D)
GPU 8-11" fillcolor=lightblue shape=rectangle]
		ln3_3 [label="LayerNorm
(B×L×D)
GPU 12-15" fillcolor=lightblue shape=rectangle]
		q_proj_3_0_0 [label="Q Projection
(B×L×d_s×h_g)
GPU 0" fillcolor=lightcoral shape=rectangle]
		k_proj_3_0_0 [label="K Projection
(B×L×d_s×h_g)
GPU 0" fillcolor=lightcoral shape=rectangle]
		v_proj_3_0_0 [label="V Projection
(B×L×d_s×h_g)
GPU 0" fillcolor=lightcoral shape=rectangle]
		attn_3_0_0 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 0" fillcolor=orange shape=rectangle]
		q_proj_3_0_1 [label="Q Projection
(B×L×d_s×h_g)
GPU 1" fillcolor=lightcoral shape=rectangle]
		k_proj_3_0_1 [label="K Projection
(B×L×d_s×h_g)
GPU 1" fillcolor=lightcoral shape=rectangle]
		v_proj_3_0_1 [label="V Projection
(B×L×d_s×h_g)
GPU 1" fillcolor=lightcoral shape=rectangle]
		attn_3_0_1 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 1" fillcolor=orange shape=rectangle]
		q_proj_3_0_2 [label="Q Projection
(B×L×d_s×h_g)
GPU 2" fillcolor=lightcoral shape=rectangle]
		k_proj_3_0_2 [label="K Projection
(B×L×d_s×h_g)
GPU 2" fillcolor=lightcoral shape=rectangle]
		v_proj_3_0_2 [label="V Projection
(B×L×d_s×h_g)
GPU 2" fillcolor=lightcoral shape=rectangle]
		attn_3_0_2 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 2" fillcolor=orange shape=rectangle]
		q_proj_3_0_3 [label="Q Projection
(B×L×d_s×h_g)
GPU 3" fillcolor=lightcoral shape=rectangle]
		k_proj_3_0_3 [label="K Projection
(B×L×d_s×h_g)
GPU 3" fillcolor=lightcoral shape=rectangle]
		v_proj_3_0_3 [label="V Projection
(B×L×d_s×h_g)
GPU 3" fillcolor=lightcoral shape=rectangle]
		attn_3_0_3 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 3" fillcolor=orange shape=rectangle]
		q_proj_3_1_0 [label="Q Projection
(B×L×d_s×h_g)
GPU 4" fillcolor=lightcoral shape=rectangle]
		k_proj_3_1_0 [label="K Projection
(B×L×d_s×h_g)
GPU 4" fillcolor=lightcoral shape=rectangle]
		v_proj_3_1_0 [label="V Projection
(B×L×d_s×h_g)
GPU 4" fillcolor=lightcoral shape=rectangle]
		attn_3_1_0 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 4" fillcolor=orange shape=rectangle]
		q_proj_3_1_1 [label="Q Projection
(B×L×d_s×h_g)
GPU 5" fillcolor=lightcoral shape=rectangle]
		k_proj_3_1_1 [label="K Projection
(B×L×d_s×h_g)
GPU 5" fillcolor=lightcoral shape=rectangle]
		v_proj_3_1_1 [label="V Projection
(B×L×d_s×h_g)
GPU 5" fillcolor=lightcoral shape=rectangle]
		attn_3_1_1 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 5" fillcolor=orange shape=rectangle]
		q_proj_3_1_2 [label="Q Projection
(B×L×d_s×h_g)
GPU 6" fillcolor=lightcoral shape=rectangle]
		k_proj_3_1_2 [label="K Projection
(B×L×d_s×h_g)
GPU 6" fillcolor=lightcoral shape=rectangle]
		v_proj_3_1_2 [label="V Projection
(B×L×d_s×h_g)
GPU 6" fillcolor=lightcoral shape=rectangle]
		attn_3_1_2 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 6" fillcolor=orange shape=rectangle]
		q_proj_3_1_3 [label="Q Projection
(B×L×d_s×h_g)
GPU 7" fillcolor=lightcoral shape=rectangle]
		k_proj_3_1_3 [label="K Projection
(B×L×d_s×h_g)
GPU 7" fillcolor=lightcoral shape=rectangle]
		v_proj_3_1_3 [label="V Projection
(B×L×d_s×h_g)
GPU 7" fillcolor=lightcoral shape=rectangle]
		attn_3_1_3 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 7" fillcolor=orange shape=rectangle]
		q_proj_3_2_0 [label="Q Projection
(B×L×d_s×h_g)
GPU 8" fillcolor=lightcoral shape=rectangle]
		k_proj_3_2_0 [label="K Projection
(B×L×d_s×h_g)
GPU 8" fillcolor=lightcoral shape=rectangle]
		v_proj_3_2_0 [label="V Projection
(B×L×d_s×h_g)
GPU 8" fillcolor=lightcoral shape=rectangle]
		attn_3_2_0 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 8" fillcolor=orange shape=rectangle]
		q_proj_3_2_1 [label="Q Projection
(B×L×d_s×h_g)
GPU 9" fillcolor=lightcoral shape=rectangle]
		k_proj_3_2_1 [label="K Projection
(B×L×d_s×h_g)
GPU 9" fillcolor=lightcoral shape=rectangle]
		v_proj_3_2_1 [label="V Projection
(B×L×d_s×h_g)
GPU 9" fillcolor=lightcoral shape=rectangle]
		attn_3_2_1 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 9" fillcolor=orange shape=rectangle]
		q_proj_3_2_2 [label="Q Projection
(B×L×d_s×h_g)
GPU 10" fillcolor=lightcoral shape=rectangle]
		k_proj_3_2_2 [label="K Projection
(B×L×d_s×h_g)
GPU 10" fillcolor=lightcoral shape=rectangle]
		v_proj_3_2_2 [label="V Projection
(B×L×d_s×h_g)
GPU 10" fillcolor=lightcoral shape=rectangle]
		attn_3_2_2 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 10" fillcolor=orange shape=rectangle]
		q_proj_3_2_3 [label="Q Projection
(B×L×d_s×h_g)
GPU 11" fillcolor=lightcoral shape=rectangle]
		k_proj_3_2_3 [label="K Projection
(B×L×d_s×h_g)
GPU 11" fillcolor=lightcoral shape=rectangle]
		v_proj_3_2_3 [label="V Projection
(B×L×d_s×h_g)
GPU 11" fillcolor=lightcoral shape=rectangle]
		attn_3_2_3 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 11" fillcolor=orange shape=rectangle]
		q_proj_3_3_0 [label="Q Projection
(B×L×d_s×h_g)
GPU 12" fillcolor=lightcoral shape=rectangle]
		k_proj_3_3_0 [label="K Projection
(B×L×d_s×h_g)
GPU 12" fillcolor=lightcoral shape=rectangle]
		v_proj_3_3_0 [label="V Projection
(B×L×d_s×h_g)
GPU 12" fillcolor=lightcoral shape=rectangle]
		attn_3_3_0 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 12" fillcolor=orange shape=rectangle]
		q_proj_3_3_1 [label="Q Projection
(B×L×d_s×h_g)
GPU 13" fillcolor=lightcoral shape=rectangle]
		k_proj_3_3_1 [label="K Projection
(B×L×d_s×h_g)
GPU 13" fillcolor=lightcoral shape=rectangle]
		v_proj_3_3_1 [label="V Projection
(B×L×d_s×h_g)
GPU 13" fillcolor=lightcoral shape=rectangle]
		attn_3_3_1 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 13" fillcolor=orange shape=rectangle]
		q_proj_3_3_2 [label="Q Projection
(B×L×d_s×h_g)
GPU 14" fillcolor=lightcoral shape=rectangle]
		k_proj_3_3_2 [label="K Projection
(B×L×d_s×h_g)
GPU 14" fillcolor=lightcoral shape=rectangle]
		v_proj_3_3_2 [label="V Projection
(B×L×d_s×h_g)
GPU 14" fillcolor=lightcoral shape=rectangle]
		attn_3_3_2 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 14" fillcolor=orange shape=rectangle]
		q_proj_3_3_3 [label="Q Projection
(B×L×d_s×h_g)
GPU 15" fillcolor=lightcoral shape=rectangle]
		k_proj_3_3_3 [label="K Projection
(B×L×d_s×h_g)
GPU 15" fillcolor=lightcoral shape=rectangle]
		v_proj_3_3_3 [label="V Projection
(B×L×d_s×h_g)
GPU 15" fillcolor=lightcoral shape=rectangle]
		attn_3_3_3 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 15" fillcolor=orange shape=rectangle]
		concat_dim_3_0 [label="Dimension Concatenation
(B×L×d×h_g)
GPUs 0-3" fillcolor=lightgreen shape=parallelogram style=dashed]
		concat_dim_3_1 [label="Dimension Concatenation
(B×L×d×h_g)
GPUs 4-7" fillcolor=lightgreen shape=parallelogram style=dashed]
		concat_dim_3_2 [label="Dimension Concatenation
(B×L×d×h_g)
GPUs 8-11" fillcolor=lightgreen shape=parallelogram style=dashed]
		concat_dim_3_3 [label="Dimension Concatenation
(B×L×d×h_g)
GPUs 12-15" fillcolor=lightgreen shape=parallelogram style=dashed]
		concat_heads_3 [label="Head Group Concatenation
(B×L×D)
All GPUs" fillcolor=lightgreen shape=parallelogram]
		out_proj_3 [label="Output Projection
(B×L×D)
All GPUs" fillcolor=lightcoral shape=rectangle]
		residual3_1 [label="Residual Add
(B×L×D)
All GPUs" fillcolor=yellow shape=ellipse]
		ln3_mlp [label="LayerNorm
(B×L×D)
All GPUs" fillcolor=lightblue shape=rectangle]
		gate3 [label="MoE Gate
(B×L×num_experts)
All GPUs" fillcolor=purple shape=parallelogram]
		expert_select3 [label="Expert Selection
(B×L×top_k)
All GPUs" fillcolor=purple shape=parallelogram style=dashed]
		expert3_0_linear1_0 [label="Expert 0 Linear1
(B×L×ffn_hidden_size/2)
GPU 0" fillcolor=lightcoral shape=rectangle]
		expert3_0_gelu_0 [label="Expert 0 GELU
(B×L×ffn_hidden_size/2)
GPU 0" fillcolor=lightblue shape=rectangle]
		expert3_0_linear2_0 [label="Expert 0 Linear2
(B×L×D/2)
GPU 0" fillcolor=lightcoral shape=rectangle]
		expert3_0_linear1_1 [label="Expert 0 Linear1
(B×L×ffn_hidden_size/2)
GPU 1" fillcolor=lightcoral shape=rectangle]
		expert3_0_gelu_1 [label="Expert 0 GELU
(B×L×ffn_hidden_size/2)
GPU 1" fillcolor=lightblue shape=rectangle]
		expert3_0_linear2_1 [label="Expert 0 Linear2
(B×L×D/2)
GPU 1" fillcolor=lightcoral shape=rectangle]
		expert3_0_agg [label="Expert 0 Output Aggregation
(B×L×D)
GPUs 0,1" fillcolor=lightgreen shape=parallelogram]
		expert3_1_linear1_2 [label="Expert 1 Linear1
(B×L×ffn_hidden_size/2)
GPU 2" fillcolor=lightcoral shape=rectangle]
		expert3_1_gelu_2 [label="Expert 1 GELU
(B×L×ffn_hidden_size/2)
GPU 2" fillcolor=lightblue shape=rectangle]
		expert3_1_linear2_2 [label="Expert 1 Linear2
(B×L×D/2)
GPU 2" fillcolor=lightcoral shape=rectangle]
		expert3_1_linear1_3 [label="Expert 1 Linear1
(B×L×ffn_hidden_size/2)
GPU 3" fillcolor=lightcoral shape=rectangle]
		expert3_1_gelu_3 [label="Expert 1 GELU
(B×L×ffn_hidden_size/2)
GPU 3" fillcolor=lightblue shape=rectangle]
		expert3_1_linear2_3 [label="Expert 1 Linear2
(B×L×D/2)
GPU 3" fillcolor=lightcoral shape=rectangle]
		expert3_1_agg [label="Expert 1 Output Aggregation
(B×L×D)
GPUs 2,3" fillcolor=lightgreen shape=parallelogram]
		expert3_2_linear1_4 [label="Expert 2 Linear1
(B×L×ffn_hidden_size/2)
GPU 4" fillcolor=lightcoral shape=rectangle]
		expert3_2_gelu_4 [label="Expert 2 GELU
(B×L×ffn_hidden_size/2)
GPU 4" fillcolor=lightblue shape=rectangle]
		expert3_2_linear2_4 [label="Expert 2 Linear2
(B×L×D/2)
GPU 4" fillcolor=lightcoral shape=rectangle]
		expert3_2_linear1_5 [label="Expert 2 Linear1
(B×L×ffn_hidden_size/2)
GPU 5" fillcolor=lightcoral shape=rectangle]
		expert3_2_gelu_5 [label="Expert 2 GELU
(B×L×ffn_hidden_size/2)
GPU 5" fillcolor=lightblue shape=rectangle]
		expert3_2_linear2_5 [label="Expert 2 Linear2
(B×L×D/2)
GPU 5" fillcolor=lightcoral shape=rectangle]
		expert3_2_agg [label="Expert 2 Output Aggregation
(B×L×D)
GPUs 4,5" fillcolor=lightgreen shape=parallelogram]
		expert3_3_linear1_6 [label="Expert 3 Linear1
(B×L×ffn_hidden_size/2)
GPU 6" fillcolor=lightcoral shape=rectangle]
		expert3_3_gelu_6 [label="Expert 3 GELU
(B×L×ffn_hidden_size/2)
GPU 6" fillcolor=lightblue shape=rectangle]
		expert3_3_linear2_6 [label="Expert 3 Linear2
(B×L×D/2)
GPU 6" fillcolor=lightcoral shape=rectangle]
		expert3_3_linear1_7 [label="Expert 3 Linear1
(B×L×ffn_hidden_size/2)
GPU 7" fillcolor=lightcoral shape=rectangle]
		expert3_3_gelu_7 [label="Expert 3 GELU
(B×L×ffn_hidden_size/2)
GPU 7" fillcolor=lightblue shape=rectangle]
		expert3_3_linear2_7 [label="Expert 3 Linear2
(B×L×D/2)
GPU 7" fillcolor=lightcoral shape=rectangle]
		expert3_3_agg [label="Expert 3 Output Aggregation
(B×L×D)
GPUs 6,7" fillcolor=lightgreen shape=parallelogram]
		expert3_4_linear1_8 [label="Expert 4 Linear1
(B×L×ffn_hidden_size/2)
GPU 8" fillcolor=lightcoral shape=rectangle]
		expert3_4_gelu_8 [label="Expert 4 GELU
(B×L×ffn_hidden_size/2)
GPU 8" fillcolor=lightblue shape=rectangle]
		expert3_4_linear2_8 [label="Expert 4 Linear2
(B×L×D/2)
GPU 8" fillcolor=lightcoral shape=rectangle]
		expert3_4_linear1_9 [label="Expert 4 Linear1
(B×L×ffn_hidden_size/2)
GPU 9" fillcolor=lightcoral shape=rectangle]
		expert3_4_gelu_9 [label="Expert 4 GELU
(B×L×ffn_hidden_size/2)
GPU 9" fillcolor=lightblue shape=rectangle]
		expert3_4_linear2_9 [label="Expert 4 Linear2
(B×L×D/2)
GPU 9" fillcolor=lightcoral shape=rectangle]
		expert3_4_agg [label="Expert 4 Output Aggregation
(B×L×D)
GPUs 8,9" fillcolor=lightgreen shape=parallelogram]
		expert3_5_linear1_10 [label="Expert 5 Linear1
(B×L×ffn_hidden_size/2)
GPU 10" fillcolor=lightcoral shape=rectangle]
		expert3_5_gelu_10 [label="Expert 5 GELU
(B×L×ffn_hidden_size/2)
GPU 10" fillcolor=lightblue shape=rectangle]
		expert3_5_linear2_10 [label="Expert 5 Linear2
(B×L×D/2)
GPU 10" fillcolor=lightcoral shape=rectangle]
		expert3_5_linear1_11 [label="Expert 5 Linear1
(B×L×ffn_hidden_size/2)
GPU 11" fillcolor=lightcoral shape=rectangle]
		expert3_5_gelu_11 [label="Expert 5 GELU
(B×L×ffn_hidden_size/2)
GPU 11" fillcolor=lightblue shape=rectangle]
		expert3_5_linear2_11 [label="Expert 5 Linear2
(B×L×D/2)
GPU 11" fillcolor=lightcoral shape=rectangle]
		expert3_5_agg [label="Expert 5 Output Aggregation
(B×L×D)
GPUs 10,11" fillcolor=lightgreen shape=parallelogram]
		expert3_6_linear1_12 [label="Expert 6 Linear1
(B×L×ffn_hidden_size/2)
GPU 12" fillcolor=lightcoral shape=rectangle]
		expert3_6_gelu_12 [label="Expert 6 GELU
(B×L×ffn_hidden_size/2)
GPU 12" fillcolor=lightblue shape=rectangle]
		expert3_6_linear2_12 [label="Expert 6 Linear2
(B×L×D/2)
GPU 12" fillcolor=lightcoral shape=rectangle]
		expert3_6_linear1_13 [label="Expert 6 Linear1
(B×L×ffn_hidden_size/2)
GPU 13" fillcolor=lightcoral shape=rectangle]
		expert3_6_gelu_13 [label="Expert 6 GELU
(B×L×ffn_hidden_size/2)
GPU 13" fillcolor=lightblue shape=rectangle]
		expert3_6_linear2_13 [label="Expert 6 Linear2
(B×L×D/2)
GPU 13" fillcolor=lightcoral shape=rectangle]
		expert3_6_agg [label="Expert 6 Output Aggregation
(B×L×D)
GPUs 12,13" fillcolor=lightgreen shape=parallelogram]
		expert3_7_linear1_14 [label="Expert 7 Linear1
(B×L×ffn_hidden_size/2)
GPU 14" fillcolor=lightcoral shape=rectangle]
		expert3_7_gelu_14 [label="Expert 7 GELU
(B×L×ffn_hidden_size/2)
GPU 14" fillcolor=lightblue shape=rectangle]
		expert3_7_linear2_14 [label="Expert 7 Linear2
(B×L×D/2)
GPU 14" fillcolor=lightcoral shape=rectangle]
		expert3_7_linear1_15 [label="Expert 7 Linear1
(B×L×ffn_hidden_size/2)
GPU 15" fillcolor=lightcoral shape=rectangle]
		expert3_7_gelu_15 [label="Expert 7 GELU
(B×L×ffn_hidden_size/2)
GPU 15" fillcolor=lightblue shape=rectangle]
		expert3_7_linear2_15 [label="Expert 7 Linear2
(B×L×D/2)
GPU 15" fillcolor=lightcoral shape=rectangle]
		expert3_7_agg [label="Expert 7 Output Aggregation
(B×L×D)
GPUs 14,15" fillcolor=lightgreen shape=parallelogram]
		expert_outputs3 [label="Expert Outputs Aggregation
(B×L×D)
All GPUs" fillcolor=lightgreen shape=parallelogram]
		weighted_sum3 [label="Weighted Sum
(B×L×D)
All GPUs" fillcolor=lightgreen shape=parallelogram]
		residual3_2 [label="Residual Add
(B×L×D)
All GPUs" fillcolor=yellow shape=ellipse]
	}
	subgraph cluster_layer4 {
		fillcolor=lightyellow label="Layer 4 (MoE)" style=rounded
		ln4_0 [label="LayerNorm
(B×L×D)
GPU 0-3" fillcolor=lightblue shape=rectangle]
		ln4_1 [label="LayerNorm
(B×L×D)
GPU 4-7" fillcolor=lightblue shape=rectangle]
		ln4_2 [label="LayerNorm
(B×L×D)
GPU 8-11" fillcolor=lightblue shape=rectangle]
		ln4_3 [label="LayerNorm
(B×L×D)
GPU 12-15" fillcolor=lightblue shape=rectangle]
		q_proj_4_0_0 [label="Q Projection
(B×L×d_s×h_g)
GPU 0" fillcolor=lightcoral shape=rectangle]
		k_proj_4_0_0 [label="K Projection
(B×L×d_s×h_g)
GPU 0" fillcolor=lightcoral shape=rectangle]
		v_proj_4_0_0 [label="V Projection
(B×L×d_s×h_g)
GPU 0" fillcolor=lightcoral shape=rectangle]
		attn_4_0_0 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 0" fillcolor=orange shape=rectangle]
		q_proj_4_0_1 [label="Q Projection
(B×L×d_s×h_g)
GPU 1" fillcolor=lightcoral shape=rectangle]
		k_proj_4_0_1 [label="K Projection
(B×L×d_s×h_g)
GPU 1" fillcolor=lightcoral shape=rectangle]
		v_proj_4_0_1 [label="V Projection
(B×L×d_s×h_g)
GPU 1" fillcolor=lightcoral shape=rectangle]
		attn_4_0_1 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 1" fillcolor=orange shape=rectangle]
		q_proj_4_0_2 [label="Q Projection
(B×L×d_s×h_g)
GPU 2" fillcolor=lightcoral shape=rectangle]
		k_proj_4_0_2 [label="K Projection
(B×L×d_s×h_g)
GPU 2" fillcolor=lightcoral shape=rectangle]
		v_proj_4_0_2 [label="V Projection
(B×L×d_s×h_g)
GPU 2" fillcolor=lightcoral shape=rectangle]
		attn_4_0_2 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 2" fillcolor=orange shape=rectangle]
		q_proj_4_0_3 [label="Q Projection
(B×L×d_s×h_g)
GPU 3" fillcolor=lightcoral shape=rectangle]
		k_proj_4_0_3 [label="K Projection
(B×L×d_s×h_g)
GPU 3" fillcolor=lightcoral shape=rectangle]
		v_proj_4_0_3 [label="V Projection
(B×L×d_s×h_g)
GPU 3" fillcolor=lightcoral shape=rectangle]
		attn_4_0_3 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 3" fillcolor=orange shape=rectangle]
		q_proj_4_1_0 [label="Q Projection
(B×L×d_s×h_g)
GPU 4" fillcolor=lightcoral shape=rectangle]
		k_proj_4_1_0 [label="K Projection
(B×L×d_s×h_g)
GPU 4" fillcolor=lightcoral shape=rectangle]
		v_proj_4_1_0 [label="V Projection
(B×L×d_s×h_g)
GPU 4" fillcolor=lightcoral shape=rectangle]
		attn_4_1_0 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 4" fillcolor=orange shape=rectangle]
		q_proj_4_1_1 [label="Q Projection
(B×L×d_s×h_g)
GPU 5" fillcolor=lightcoral shape=rectangle]
		k_proj_4_1_1 [label="K Projection
(B×L×d_s×h_g)
GPU 5" fillcolor=lightcoral shape=rectangle]
		v_proj_4_1_1 [label="V Projection
(B×L×d_s×h_g)
GPU 5" fillcolor=lightcoral shape=rectangle]
		attn_4_1_1 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 5" fillcolor=orange shape=rectangle]
		q_proj_4_1_2 [label="Q Projection
(B×L×d_s×h_g)
GPU 6" fillcolor=lightcoral shape=rectangle]
		k_proj_4_1_2 [label="K Projection
(B×L×d_s×h_g)
GPU 6" fillcolor=lightcoral shape=rectangle]
		v_proj_4_1_2 [label="V Projection
(B×L×d_s×h_g)
GPU 6" fillcolor=lightcoral shape=rectangle]
		attn_4_1_2 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 6" fillcolor=orange shape=rectangle]
		q_proj_4_1_3 [label="Q Projection
(B×L×d_s×h_g)
GPU 7" fillcolor=lightcoral shape=rectangle]
		k_proj_4_1_3 [label="K Projection
(B×L×d_s×h_g)
GPU 7" fillcolor=lightcoral shape=rectangle]
		v_proj_4_1_3 [label="V Projection
(B×L×d_s×h_g)
GPU 7" fillcolor=lightcoral shape=rectangle]
		attn_4_1_3 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 7" fillcolor=orange shape=rectangle]
		q_proj_4_2_0 [label="Q Projection
(B×L×d_s×h_g)
GPU 8" fillcolor=lightcoral shape=rectangle]
		k_proj_4_2_0 [label="K Projection
(B×L×d_s×h_g)
GPU 8" fillcolor=lightcoral shape=rectangle]
		v_proj_4_2_0 [label="V Projection
(B×L×d_s×h_g)
GPU 8" fillcolor=lightcoral shape=rectangle]
		attn_4_2_0 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 8" fillcolor=orange shape=rectangle]
		q_proj_4_2_1 [label="Q Projection
(B×L×d_s×h_g)
GPU 9" fillcolor=lightcoral shape=rectangle]
		k_proj_4_2_1 [label="K Projection
(B×L×d_s×h_g)
GPU 9" fillcolor=lightcoral shape=rectangle]
		v_proj_4_2_1 [label="V Projection
(B×L×d_s×h_g)
GPU 9" fillcolor=lightcoral shape=rectangle]
		attn_4_2_1 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 9" fillcolor=orange shape=rectangle]
		q_proj_4_2_2 [label="Q Projection
(B×L×d_s×h_g)
GPU 10" fillcolor=lightcoral shape=rectangle]
		k_proj_4_2_2 [label="K Projection
(B×L×d_s×h_g)
GPU 10" fillcolor=lightcoral shape=rectangle]
		v_proj_4_2_2 [label="V Projection
(B×L×d_s×h_g)
GPU 10" fillcolor=lightcoral shape=rectangle]
		attn_4_2_2 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 10" fillcolor=orange shape=rectangle]
		q_proj_4_2_3 [label="Q Projection
(B×L×d_s×h_g)
GPU 11" fillcolor=lightcoral shape=rectangle]
		k_proj_4_2_3 [label="K Projection
(B×L×d_s×h_g)
GPU 11" fillcolor=lightcoral shape=rectangle]
		v_proj_4_2_3 [label="V Projection
(B×L×d_s×h_g)
GPU 11" fillcolor=lightcoral shape=rectangle]
		attn_4_2_3 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 11" fillcolor=orange shape=rectangle]
		q_proj_4_3_0 [label="Q Projection
(B×L×d_s×h_g)
GPU 12" fillcolor=lightcoral shape=rectangle]
		k_proj_4_3_0 [label="K Projection
(B×L×d_s×h_g)
GPU 12" fillcolor=lightcoral shape=rectangle]
		v_proj_4_3_0 [label="V Projection
(B×L×d_s×h_g)
GPU 12" fillcolor=lightcoral shape=rectangle]
		attn_4_3_0 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 12" fillcolor=orange shape=rectangle]
		q_proj_4_3_1 [label="Q Projection
(B×L×d_s×h_g)
GPU 13" fillcolor=lightcoral shape=rectangle]
		k_proj_4_3_1 [label="K Projection
(B×L×d_s×h_g)
GPU 13" fillcolor=lightcoral shape=rectangle]
		v_proj_4_3_1 [label="V Projection
(B×L×d_s×h_g)
GPU 13" fillcolor=lightcoral shape=rectangle]
		attn_4_3_1 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 13" fillcolor=orange shape=rectangle]
		q_proj_4_3_2 [label="Q Projection
(B×L×d_s×h_g)
GPU 14" fillcolor=lightcoral shape=rectangle]
		k_proj_4_3_2 [label="K Projection
(B×L×d_s×h_g)
GPU 14" fillcolor=lightcoral shape=rectangle]
		v_proj_4_3_2 [label="V Projection
(B×L×d_s×h_g)
GPU 14" fillcolor=lightcoral shape=rectangle]
		attn_4_3_2 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 14" fillcolor=orange shape=rectangle]
		q_proj_4_3_3 [label="Q Projection
(B×L×d_s×h_g)
GPU 15" fillcolor=lightcoral shape=rectangle]
		k_proj_4_3_3 [label="K Projection
(B×L×d_s×h_g)
GPU 15" fillcolor=lightcoral shape=rectangle]
		v_proj_4_3_3 [label="V Projection
(B×L×d_s×h_g)
GPU 15" fillcolor=lightcoral shape=rectangle]
		attn_4_3_3 [label="Scaled Dot-Product Attention
(B×L×d_s×h_g)
GPU 15" fillcolor=orange shape=rectangle]
		concat_dim_4_0 [label="Dimension Concatenation
(B×L×d×h_g)
GPUs 0-3" fillcolor=lightgreen shape=parallelogram style=dashed]
		concat_dim_4_1 [label="Dimension Concatenation
(B×L×d×h_g)
GPUs 4-7" fillcolor=lightgreen shape=parallelogram style=dashed]
		concat_dim_4_2 [label="Dimension Concatenation
(B×L×d×h_g)
GPUs 8-11" fillcolor=lightgreen shape=parallelogram style=dashed]
		concat_dim_4_3 [label="Dimension Concatenation
(B×L×d×h_g)
GPUs 12-15" fillcolor=lightgreen shape=parallelogram style=dashed]
		concat_heads_4 [label="Head Group Concatenation
(B×L×D)
All GPUs" fillcolor=lightgreen shape=parallelogram]
		out_proj_4 [label="Output Projection
(B×L×D)
All GPUs" fillcolor=lightcoral shape=rectangle]
		residual4_1 [label="Residual Add
(B×L×D)
All GPUs" fillcolor=yellow shape=ellipse]
		ln4_mlp [label="LayerNorm
(B×L×D)
All GPUs" fillcolor=lightblue shape=rectangle]
		gate4 [label="MoE Gate
(B×L×num_experts)
All GPUs" fillcolor=purple shape=parallelogram]
		expert_select4 [label="Expert Selection
(B×L×top_k)
All GPUs" fillcolor=purple shape=parallelogram style=dashed]
		expert4_0_linear1_0 [label="Expert 0 Linear1
(B×L×ffn_hidden_size/2)
GPU 0" fillcolor=lightcoral shape=rectangle]
		expert4_0_gelu_0 [label="Expert 0 GELU
(B×L×ffn_hidden_size/2)
GPU 0" fillcolor=lightblue shape=rectangle]
		expert4_0_linear2_0 [label="Expert 0 Linear2
(B×L×D/2)
GPU 0" fillcolor=lightcoral shape=rectangle]
		expert4_0_linear1_1 [label="Expert 0 Linear1
(B×L×ffn_hidden_size/2)
GPU 1" fillcolor=lightcoral shape=rectangle]
		expert4_0_gelu_1 [label="Expert 0 GELU
(B×L×ffn_hidden_size/2)
GPU 1" fillcolor=lightblue shape=rectangle]
		expert4_0_linear2_1 [label="Expert 0 Linear2
(B×L×D/2)
GPU 1" fillcolor=lightcoral shape=rectangle]
		expert4_0_agg [label="Expert 0 Output Aggregation
(B×L×D)
GPUs 0,1" fillcolor=lightgreen shape=parallelogram]
		expert4_1_linear1_2 [label="Expert 1 Linear1
(B×L×ffn_hidden_size/2)
GPU 2" fillcolor=lightcoral shape=rectangle]
		expert4_1_gelu_2 [label="Expert 1 GELU
(B×L×ffn_hidden_size/2)
GPU 2" fillcolor=lightblue shape=rectangle]
		expert4_1_linear2_2 [label="Expert 1 Linear2
(B×L×D/2)
GPU 2" fillcolor=lightcoral shape=rectangle]
		expert4_1_linear1_3 [label="Expert 1 Linear1
(B×L×ffn_hidden_size/2)
GPU 3" fillcolor=lightcoral shape=rectangle]
		expert4_1_gelu_3 [label="Expert 1 GELU
(B×L×ffn_hidden_size/2)
GPU 3" fillcolor=lightblue shape=rectangle]
		expert4_1_linear2_3 [label="Expert 1 Linear2
(B×L×D/2)
GPU 3" fillcolor=lightcoral shape=rectangle]
		expert4_1_agg [label="Expert 1 Output Aggregation
(B×L×D)
GPUs 2,3" fillcolor=lightgreen shape=parallelogram]
		expert4_2_linear1_4 [label="Expert 2 Linear1
(B×L×ffn_hidden_size/2)
GPU 4" fillcolor=lightcoral shape=rectangle]
		expert4_2_gelu_4 [label="Expert 2 GELU
(B×L×ffn_hidden_size/2)
GPU 4" fillcolor=lightblue shape=rectangle]
		expert4_2_linear2_4 [label="Expert 2 Linear2
(B×L×D/2)
GPU 4" fillcolor=lightcoral shape=rectangle]
		expert4_2_linear1_5 [label="Expert 2 Linear1
(B×L×ffn_hidden_size/2)
GPU 5" fillcolor=lightcoral shape=rectangle]
		expert4_2_gelu_5 [label="Expert 2 GELU
(B×L×ffn_hidden_size/2)
GPU 5" fillcolor=lightblue shape=rectangle]
		expert4_2_linear2_5 [label="Expert 2 Linear2
(B×L×D/2)
GPU 5" fillcolor=lightcoral shape=rectangle]
		expert4_2_agg [label="Expert 2 Output Aggregation
(B×L×D)
GPUs 4,5" fillcolor=lightgreen shape=parallelogram]
		expert4_3_linear1_6 [label="Expert 3 Linear1
(B×L×ffn_hidden_size/2)
GPU 6" fillcolor=lightcoral shape=rectangle]
		expert4_3_gelu_6 [label="Expert 3 GELU
(B×L×ffn_hidden_size/2)
GPU 6" fillcolor=lightblue shape=rectangle]
		expert4_3_linear2_6 [label="Expert 3 Linear2
(B×L×D/2)
GPU 6" fillcolor=lightcoral shape=rectangle]
		expert4_3_linear1_7 [label="Expert 3 Linear1
(B×L×ffn_hidden_size/2)
GPU 7" fillcolor=lightcoral shape=rectangle]
		expert4_3_gelu_7 [label="Expert 3 GELU
(B×L×ffn_hidden_size/2)
GPU 7" fillcolor=lightblue shape=rectangle]
		expert4_3_linear2_7 [label="Expert 3 Linear2
(B×L×D/2)
GPU 7" fillcolor=lightcoral shape=rectangle]
		expert4_3_agg [label="Expert 3 Output Aggregation
(B×L×D)
GPUs 6,7" fillcolor=lightgreen shape=parallelogram]
		expert4_4_linear1_8 [label="Expert 4 Linear1
(B×L×ffn_hidden_size/2)
GPU 8" fillcolor=lightcoral shape=rectangle]
		expert4_4_gelu_8 [label="Expert 4 GELU
(B×L×ffn_hidden_size/2)
GPU 8" fillcolor=lightblue shape=rectangle]
		expert4_4_linear2_8 [label="Expert 4 Linear2
(B×L×D/2)
GPU 8" fillcolor=lightcoral shape=rectangle]
		expert4_4_linear1_9 [label="Expert 4 Linear1
(B×L×ffn_hidden_size/2)
GPU 9" fillcolor=lightcoral shape=rectangle]
		expert4_4_gelu_9 [label="Expert 4 GELU
(B×L×ffn_hidden_size/2)
GPU 9" fillcolor=lightblue shape=rectangle]
		expert4_4_linear2_9 [label="Expert 4 Linear2
(B×L×D/2)
GPU 9" fillcolor=lightcoral shape=rectangle]
		expert4_4_agg [label="Expert 4 Output Aggregation
(B×L×D)
GPUs 8,9" fillcolor=lightgreen shape=parallelogram]
		expert4_5_linear1_10 [label="Expert 5 Linear1
(B×L×ffn_hidden_size/2)
GPU 10" fillcolor=lightcoral shape=rectangle]
		expert4_5_gelu_10 [label="Expert 5 GELU
(B×L×ffn_hidden_size/2)
GPU 10" fillcolor=lightblue shape=rectangle]
		expert4_5_linear2_10 [label="Expert 5 Linear2
(B×L×D/2)
GPU 10" fillcolor=lightcoral shape=rectangle]
		expert4_5_linear1_11 [label="Expert 5 Linear1
(B×L×ffn_hidden_size/2)
GPU 11" fillcolor=lightcoral shape=rectangle]
		expert4_5_gelu_11 [label="Expert 5 GELU
(B×L×ffn_hidden_size/2)
GPU 11" fillcolor=lightblue shape=rectangle]
		expert4_5_linear2_11 [label="Expert 5 Linear2
(B×L×D/2)
GPU 11" fillcolor=lightcoral shape=rectangle]
		expert4_5_agg [label="Expert 5 Output Aggregation
(B×L×D)
GPUs 10,11" fillcolor=lightgreen shape=parallelogram]
		expert4_6_linear1_12 [label="Expert 6 Linear1
(B×L×ffn_hidden_size/2)
GPU 12" fillcolor=lightcoral shape=rectangle]
		expert4_6_gelu_12 [label="Expert 6 GELU
(B×L×ffn_hidden_size/2)
GPU 12" fillcolor=lightblue shape=rectangle]
		expert4_6_linear2_12 [label="Expert 6 Linear2
(B×L×D/2)
GPU 12" fillcolor=lightcoral shape=rectangle]
		expert4_6_linear1_13 [label="Expert 6 Linear1
(B×L×ffn_hidden_size/2)
GPU 13" fillcolor=lightcoral shape=rectangle]
		expert4_6_gelu_13 [label="Expert 6 GELU
(B×L×ffn_hidden_size/2)
GPU 13" fillcolor=lightblue shape=rectangle]
		expert4_6_linear2_13 [label="Expert 6 Linear2
(B×L×D/2)
GPU 13" fillcolor=lightcoral shape=rectangle]
		expert4_6_agg [label="Expert 6 Output Aggregation
(B×L×D)
GPUs 12,13" fillcolor=lightgreen shape=parallelogram]
		expert4_7_linear1_14 [label="Expert 7 Linear1
(B×L×ffn_hidden_size/2)
GPU 14" fillcolor=lightcoral shape=rectangle]
		expert4_7_gelu_14 [label="Expert 7 GELU
(B×L×ffn_hidden_size/2)
GPU 14" fillcolor=lightblue shape=rectangle]
		expert4_7_linear2_14 [label="Expert 7 Linear2
(B×L×D/2)
GPU 14" fillcolor=lightcoral shape=rectangle]
		expert4_7_linear1_15 [label="Expert 7 Linear1
(B×L×ffn_hidden_size/2)
GPU 15" fillcolor=lightcoral shape=rectangle]
		expert4_7_gelu_15 [label="Expert 7 GELU
(B×L×ffn_hidden_size/2)
GPU 15" fillcolor=lightblue shape=rectangle]
		expert4_7_linear2_15 [label="Expert 7 Linear2
(B×L×D/2)
GPU 15" fillcolor=lightcoral shape=rectangle]
		expert4_7_agg [label="Expert 7 Output Aggregation
(B×L×D)
GPUs 14,15" fillcolor=lightgreen shape=parallelogram]
		expert_outputs4 [label="Expert Outputs Aggregation
(B×L×D)
All GPUs" fillcolor=lightgreen shape=parallelogram]
		weighted_sum4 [label="Weighted Sum
(B×L×D)
All GPUs" fillcolor=lightgreen shape=parallelogram]
		residual4_2 [label="Residual Add
(B×L×D)
All GPUs" fillcolor=yellow shape=ellipse]
	}
	subgraph cluster_output {
		fillcolor=lightgray label="Output Processing" style=rounded
		final_ln [label="Final LayerNorm
(B×L×D)
All GPUs" fillcolor=lightblue shape=rectangle]
		lm_head [label="Language Model Head
(B×L×Vocab)
All GPUs" fillcolor=lightcoral shape=rectangle]
		output [label="Output Tokens
(B×L)
All GPUs" fillcolor=lightgreen shape=ellipse]
	}
	input -> embed
	embed -> pos_enc
	pos_enc -> ln1_0
	ln1_0 -> q_proj_0_0
	ln1_0 -> k_proj_0_0
	ln1_0 -> v_proj_0_0
	q_proj_0_0 -> attn_0_0
	k_proj_0_0 -> attn_0_0
	v_proj_0_0 -> attn_0_0
	attn_0_0 -> concat_dim_0
	ln1_0 -> q_proj_0_1
	ln1_0 -> k_proj_0_1
	ln1_0 -> v_proj_0_1
	q_proj_0_1 -> attn_0_1
	k_proj_0_1 -> attn_0_1
	v_proj_0_1 -> attn_0_1
	attn_0_1 -> concat_dim_0
	ln1_0 -> q_proj_0_2
	ln1_0 -> k_proj_0_2
	ln1_0 -> v_proj_0_2
	q_proj_0_2 -> attn_0_2
	k_proj_0_2 -> attn_0_2
	v_proj_0_2 -> attn_0_2
	attn_0_2 -> concat_dim_0
	ln1_0 -> q_proj_0_3
	ln1_0 -> k_proj_0_3
	ln1_0 -> v_proj_0_3
	q_proj_0_3 -> attn_0_3
	k_proj_0_3 -> attn_0_3
	v_proj_0_3 -> attn_0_3
	attn_0_3 -> concat_dim_0
	concat_dim_0 -> concat_heads
	pos_enc -> ln1_1
	ln1_1 -> q_proj_1_0
	ln1_1 -> k_proj_1_0
	ln1_1 -> v_proj_1_0
	q_proj_1_0 -> attn_1_0
	k_proj_1_0 -> attn_1_0
	v_proj_1_0 -> attn_1_0
	attn_1_0 -> concat_dim_1
	ln1_1 -> q_proj_1_1
	ln1_1 -> k_proj_1_1
	ln1_1 -> v_proj_1_1
	q_proj_1_1 -> attn_1_1
	k_proj_1_1 -> attn_1_1
	v_proj_1_1 -> attn_1_1
	attn_1_1 -> concat_dim_1
	ln1_1 -> q_proj_1_2
	ln1_1 -> k_proj_1_2
	ln1_1 -> v_proj_1_2
	q_proj_1_2 -> attn_1_2
	k_proj_1_2 -> attn_1_2
	v_proj_1_2 -> attn_1_2
	attn_1_2 -> concat_dim_1
	ln1_1 -> q_proj_1_3
	ln1_1 -> k_proj_1_3
	ln1_1 -> v_proj_1_3
	q_proj_1_3 -> attn_1_3
	k_proj_1_3 -> attn_1_3
	v_proj_1_3 -> attn_1_3
	attn_1_3 -> concat_dim_1
	concat_dim_1 -> concat_heads
	pos_enc -> ln1_2
	ln1_2 -> q_proj_2_0
	ln1_2 -> k_proj_2_0
	ln1_2 -> v_proj_2_0
	q_proj_2_0 -> attn_2_0
	k_proj_2_0 -> attn_2_0
	v_proj_2_0 -> attn_2_0
	attn_2_0 -> concat_dim_2
	ln1_2 -> q_proj_2_1
	ln1_2 -> k_proj_2_1
	ln1_2 -> v_proj_2_1
	q_proj_2_1 -> attn_2_1
	k_proj_2_1 -> attn_2_1
	v_proj_2_1 -> attn_2_1
	attn_2_1 -> concat_dim_2
	ln1_2 -> q_proj_2_2
	ln1_2 -> k_proj_2_2
	ln1_2 -> v_proj_2_2
	q_proj_2_2 -> attn_2_2
	k_proj_2_2 -> attn_2_2
	v_proj_2_2 -> attn_2_2
	attn_2_2 -> concat_dim_2
	ln1_2 -> q_proj_2_3
	ln1_2 -> k_proj_2_3
	ln1_2 -> v_proj_2_3
	q_proj_2_3 -> attn_2_3
	k_proj_2_3 -> attn_2_3
	v_proj_2_3 -> attn_2_3
	attn_2_3 -> concat_dim_2
	concat_dim_2 -> concat_heads
	pos_enc -> ln1_3
	ln1_3 -> q_proj_3_0
	ln1_3 -> k_proj_3_0
	ln1_3 -> v_proj_3_0
	q_proj_3_0 -> attn_3_0
	k_proj_3_0 -> attn_3_0
	v_proj_3_0 -> attn_3_0
	attn_3_0 -> concat_dim_3
	ln1_3 -> q_proj_3_1
	ln1_3 -> k_proj_3_1
	ln1_3 -> v_proj_3_1
	q_proj_3_1 -> attn_3_1
	k_proj_3_1 -> attn_3_1
	v_proj_3_1 -> attn_3_1
	attn_3_1 -> concat_dim_3
	ln1_3 -> q_proj_3_2
	ln1_3 -> k_proj_3_2
	ln1_3 -> v_proj_3_2
	q_proj_3_2 -> attn_3_2
	k_proj_3_2 -> attn_3_2
	v_proj_3_2 -> attn_3_2
	attn_3_2 -> concat_dim_3
	ln1_3 -> q_proj_3_3
	ln1_3 -> k_proj_3_3
	ln1_3 -> v_proj_3_3
	q_proj_3_3 -> attn_3_3
	k_proj_3_3 -> attn_3_3
	v_proj_3_3 -> attn_3_3
	attn_3_3 -> concat_dim_3
	concat_dim_3 -> concat_heads
	concat_heads -> out_proj
	out_proj -> residual1
	pos_enc -> residual1
	residual1 -> ln2
	ln2 -> gate
	gate -> expert_select
	expert_select -> expert0_linear1_0 [style=dashed]
	expert0_linear1_0 -> expert0_gelu_0
	expert0_gelu_0 -> expert0_linear2_0
	expert0_linear2_0 -> expert0_agg
	expert_select -> expert0_linear1_1 [style=dashed]
	expert0_linear1_1 -> expert0_gelu_1
	expert0_gelu_1 -> expert0_linear2_1
	expert0_linear2_1 -> expert0_agg
	expert0_agg -> expert_outputs
	expert_select -> expert1_linear1_2 [style=dashed]
	expert1_linear1_2 -> expert1_gelu_2
	expert1_gelu_2 -> expert1_linear2_2
	expert1_linear2_2 -> expert1_agg
	expert_select -> expert1_linear1_3 [style=dashed]
	expert1_linear1_3 -> expert1_gelu_3
	expert1_gelu_3 -> expert1_linear2_3
	expert1_linear2_3 -> expert1_agg
	expert1_agg -> expert_outputs
	expert_select -> expert2_linear1_4 [style=dashed]
	expert2_linear1_4 -> expert2_gelu_4
	expert2_gelu_4 -> expert2_linear2_4
	expert2_linear2_4 -> expert2_agg
	expert_select -> expert2_linear1_5 [style=dashed]
	expert2_linear1_5 -> expert2_gelu_5
	expert2_gelu_5 -> expert2_linear2_5
	expert2_linear2_5 -> expert2_agg
	expert2_agg -> expert_outputs
	expert_select -> expert3_linear1_6 [style=dashed]
	expert3_linear1_6 -> expert3_gelu_6
	expert3_gelu_6 -> expert3_linear2_6
	expert3_linear2_6 -> expert3_agg
	expert_select -> expert3_linear1_7 [style=dashed]
	expert3_linear1_7 -> expert3_gelu_7
	expert3_gelu_7 -> expert3_linear2_7
	expert3_linear2_7 -> expert3_agg
	expert3_agg -> expert_outputs
	expert_select -> expert4_linear1_8 [style=dashed]
	expert4_linear1_8 -> expert4_gelu_8
	expert4_gelu_8 -> expert4_linear2_8
	expert4_linear2_8 -> expert4_agg
	expert_select -> expert4_linear1_9 [style=dashed]
	expert4_linear1_9 -> expert4_gelu_9
	expert4_gelu_9 -> expert4_linear2_9
	expert4_linear2_9 -> expert4_agg
	expert4_agg -> expert_outputs
	expert_select -> expert5_linear1_10 [style=dashed]
	expert5_linear1_10 -> expert5_gelu_10
	expert5_gelu_10 -> expert5_linear2_10
	expert5_linear2_10 -> expert5_agg
	expert_select -> expert5_linear1_11 [style=dashed]
	expert5_linear1_11 -> expert5_gelu_11
	expert5_gelu_11 -> expert5_linear2_11
	expert5_linear2_11 -> expert5_agg
	expert5_agg -> expert_outputs
	expert_select -> expert6_linear1_12 [style=dashed]
	expert6_linear1_12 -> expert6_gelu_12
	expert6_gelu_12 -> expert6_linear2_12
	expert6_linear2_12 -> expert6_agg
	expert_select -> expert6_linear1_13 [style=dashed]
	expert6_linear1_13 -> expert6_gelu_13
	expert6_gelu_13 -> expert6_linear2_13
	expert6_linear2_13 -> expert6_agg
	expert6_agg -> expert_outputs
	expert_select -> expert7_linear1_14 [style=dashed]
	expert7_linear1_14 -> expert7_gelu_14
	expert7_gelu_14 -> expert7_linear2_14
	expert7_linear2_14 -> expert7_agg
	expert_select -> expert7_linear1_15 [style=dashed]
	expert7_linear1_15 -> expert7_gelu_15
	expert7_gelu_15 -> expert7_linear2_15
	expert7_linear2_15 -> expert7_agg
	expert7_agg -> expert_outputs
	expert_outputs -> weighted_sum
	weighted_sum -> residual2
	residual1 -> residual2
	residual2 -> ln2_0
	ln2_0 -> q_proj_2_0_0
	ln2_0 -> k_proj_2_0_0
	ln2_0 -> v_proj_2_0_0
	q_proj_2_0_0 -> attn_2_0_0
	k_proj_2_0_0 -> attn_2_0_0
	v_proj_2_0_0 -> attn_2_0_0
	attn_2_0_0 -> concat_dim_2_0
	ln2_0 -> q_proj_2_0_1
	ln2_0 -> k_proj_2_0_1
	ln2_0 -> v_proj_2_0_1
	q_proj_2_0_1 -> attn_2_0_1
	k_proj_2_0_1 -> attn_2_0_1
	v_proj_2_0_1 -> attn_2_0_1
	attn_2_0_1 -> concat_dim_2_0
	ln2_0 -> q_proj_2_0_2
	ln2_0 -> k_proj_2_0_2
	ln2_0 -> v_proj_2_0_2
	q_proj_2_0_2 -> attn_2_0_2
	k_proj_2_0_2 -> attn_2_0_2
	v_proj_2_0_2 -> attn_2_0_2
	attn_2_0_2 -> concat_dim_2_0
	ln2_0 -> q_proj_2_0_3
	ln2_0 -> k_proj_2_0_3
	ln2_0 -> v_proj_2_0_3
	q_proj_2_0_3 -> attn_2_0_3
	k_proj_2_0_3 -> attn_2_0_3
	v_proj_2_0_3 -> attn_2_0_3
	attn_2_0_3 -> concat_dim_2_0
	concat_dim_2_0 -> concat_heads_2
	residual2 -> ln2_1
	ln2_1 -> q_proj_2_1_0
	ln2_1 -> k_proj_2_1_0
	ln2_1 -> v_proj_2_1_0
	q_proj_2_1_0 -> attn_2_1_0
	k_proj_2_1_0 -> attn_2_1_0
	v_proj_2_1_0 -> attn_2_1_0
	attn_2_1_0 -> concat_dim_2_1
	ln2_1 -> q_proj_2_1_1
	ln2_1 -> k_proj_2_1_1
	ln2_1 -> v_proj_2_1_1
	q_proj_2_1_1 -> attn_2_1_1
	k_proj_2_1_1 -> attn_2_1_1
	v_proj_2_1_1 -> attn_2_1_1
	attn_2_1_1 -> concat_dim_2_1
	ln2_1 -> q_proj_2_1_2
	ln2_1 -> k_proj_2_1_2
	ln2_1 -> v_proj_2_1_2
	q_proj_2_1_2 -> attn_2_1_2
	k_proj_2_1_2 -> attn_2_1_2
	v_proj_2_1_2 -> attn_2_1_2
	attn_2_1_2 -> concat_dim_2_1
	ln2_1 -> q_proj_2_1_3
	ln2_1 -> k_proj_2_1_3
	ln2_1 -> v_proj_2_1_3
	q_proj_2_1_3 -> attn_2_1_3
	k_proj_2_1_3 -> attn_2_1_3
	v_proj_2_1_3 -> attn_2_1_3
	attn_2_1_3 -> concat_dim_2_1
	concat_dim_2_1 -> concat_heads_2
	residual2 -> ln2_2
	ln2_2 -> q_proj_2_2_0
	ln2_2 -> k_proj_2_2_0
	ln2_2 -> v_proj_2_2_0
	q_proj_2_2_0 -> attn_2_2_0
	k_proj_2_2_0 -> attn_2_2_0
	v_proj_2_2_0 -> attn_2_2_0
	attn_2_2_0 -> concat_dim_2_2
	ln2_2 -> q_proj_2_2_1
	ln2_2 -> k_proj_2_2_1
	ln2_2 -> v_proj_2_2_1
	q_proj_2_2_1 -> attn_2_2_1
	k_proj_2_2_1 -> attn_2_2_1
	v_proj_2_2_1 -> attn_2_2_1
	attn_2_2_1 -> concat_dim_2_2
	ln2_2 -> q_proj_2_2_2
	ln2_2 -> k_proj_2_2_2
	ln2_2 -> v_proj_2_2_2
	q_proj_2_2_2 -> attn_2_2_2
	k_proj_2_2_2 -> attn_2_2_2
	v_proj_2_2_2 -> attn_2_2_2
	attn_2_2_2 -> concat_dim_2_2
	ln2_2 -> q_proj_2_2_3
	ln2_2 -> k_proj_2_2_3
	ln2_2 -> v_proj_2_2_3
	q_proj_2_2_3 -> attn_2_2_3
	k_proj_2_2_3 -> attn_2_2_3
	v_proj_2_2_3 -> attn_2_2_3
	attn_2_2_3 -> concat_dim_2_2
	concat_dim_2_2 -> concat_heads_2
	residual2 -> ln2_3
	ln2_3 -> q_proj_2_3_0
	ln2_3 -> k_proj_2_3_0
	ln2_3 -> v_proj_2_3_0
	q_proj_2_3_0 -> attn_2_3_0
	k_proj_2_3_0 -> attn_2_3_0
	v_proj_2_3_0 -> attn_2_3_0
	attn_2_3_0 -> concat_dim_2_3
	ln2_3 -> q_proj_2_3_1
	ln2_3 -> k_proj_2_3_1
	ln2_3 -> v_proj_2_3_1
	q_proj_2_3_1 -> attn_2_3_1
	k_proj_2_3_1 -> attn_2_3_1
	v_proj_2_3_1 -> attn_2_3_1
	attn_2_3_1 -> concat_dim_2_3
	ln2_3 -> q_proj_2_3_2
	ln2_3 -> k_proj_2_3_2
	ln2_3 -> v_proj_2_3_2
	q_proj_2_3_2 -> attn_2_3_2
	k_proj_2_3_2 -> attn_2_3_2
	v_proj_2_3_2 -> attn_2_3_2
	attn_2_3_2 -> concat_dim_2_3
	ln2_3 -> q_proj_2_3_3
	ln2_3 -> k_proj_2_3_3
	ln2_3 -> v_proj_2_3_3
	q_proj_2_3_3 -> attn_2_3_3
	k_proj_2_3_3 -> attn_2_3_3
	v_proj_2_3_3 -> attn_2_3_3
	attn_2_3_3 -> concat_dim_2_3
	concat_dim_2_3 -> concat_heads_2
	concat_heads_2 -> out_proj_2
	out_proj_2 -> residual2_1
	residual2 -> residual2_1
	residual2_1 -> ln2_mlp
	ln2_mlp -> gate2
	gate2 -> expert_select2
	expert_select2 -> expert2_0_linear1_0 [style=dashed]
	expert2_0_linear1_0 -> expert2_0_gelu_0
	expert2_0_gelu_0 -> expert2_0_linear2_0
	expert2_0_linear2_0 -> expert2_0_agg
	expert_select2 -> expert2_0_linear1_1 [style=dashed]
	expert2_0_linear1_1 -> expert2_0_gelu_1
	expert2_0_gelu_1 -> expert2_0_linear2_1
	expert2_0_linear2_1 -> expert2_0_agg
	expert2_0_agg -> expert_outputs2
	expert_select2 -> expert2_1_linear1_2 [style=dashed]
	expert2_1_linear1_2 -> expert2_1_gelu_2
	expert2_1_gelu_2 -> expert2_1_linear2_2
	expert2_1_linear2_2 -> expert2_1_agg
	expert_select2 -> expert2_1_linear1_3 [style=dashed]
	expert2_1_linear1_3 -> expert2_1_gelu_3
	expert2_1_gelu_3 -> expert2_1_linear2_3
	expert2_1_linear2_3 -> expert2_1_agg
	expert2_1_agg -> expert_outputs2
	expert_select2 -> expert2_2_linear1_4 [style=dashed]
	expert2_2_linear1_4 -> expert2_2_gelu_4
	expert2_2_gelu_4 -> expert2_2_linear2_4
	expert2_2_linear2_4 -> expert2_2_agg
	expert_select2 -> expert2_2_linear1_5 [style=dashed]
	expert2_2_linear1_5 -> expert2_2_gelu_5
	expert2_2_gelu_5 -> expert2_2_linear2_5
	expert2_2_linear2_5 -> expert2_2_agg
	expert2_2_agg -> expert_outputs2
	expert_select2 -> expert2_3_linear1_6 [style=dashed]
	expert2_3_linear1_6 -> expert2_3_gelu_6
	expert2_3_gelu_6 -> expert2_3_linear2_6
	expert2_3_linear2_6 -> expert2_3_agg
	expert_select2 -> expert2_3_linear1_7 [style=dashed]
	expert2_3_linear1_7 -> expert2_3_gelu_7
	expert2_3_gelu_7 -> expert2_3_linear2_7
	expert2_3_linear2_7 -> expert2_3_agg
	expert2_3_agg -> expert_outputs2
	expert_select2 -> expert2_4_linear1_8 [style=dashed]
	expert2_4_linear1_8 -> expert2_4_gelu_8
	expert2_4_gelu_8 -> expert2_4_linear2_8
	expert2_4_linear2_8 -> expert2_4_agg
	expert_select2 -> expert2_4_linear1_9 [style=dashed]
	expert2_4_linear1_9 -> expert2_4_gelu_9
	expert2_4_gelu_9 -> expert2_4_linear2_9
	expert2_4_linear2_9 -> expert2_4_agg
	expert2_4_agg -> expert_outputs2
	expert_select2 -> expert2_5_linear1_10 [style=dashed]
	expert2_5_linear1_10 -> expert2_5_gelu_10
	expert2_5_gelu_10 -> expert2_5_linear2_10
	expert2_5_linear2_10 -> expert2_5_agg
	expert_select2 -> expert2_5_linear1_11 [style=dashed]
	expert2_5_linear1_11 -> expert2_5_gelu_11
	expert2_5_gelu_11 -> expert2_5_linear2_11
	expert2_5_linear2_11 -> expert2_5_agg
	expert2_5_agg -> expert_outputs2
	expert_select2 -> expert2_6_linear1_12 [style=dashed]
	expert2_6_linear1_12 -> expert2_6_gelu_12
	expert2_6_gelu_12 -> expert2_6_linear2_12
	expert2_6_linear2_12 -> expert2_6_agg
	expert_select2 -> expert2_6_linear1_13 [style=dashed]
	expert2_6_linear1_13 -> expert2_6_gelu_13
	expert2_6_gelu_13 -> expert2_6_linear2_13
	expert2_6_linear2_13 -> expert2_6_agg
	expert2_6_agg -> expert_outputs2
	expert_select2 -> expert2_7_linear1_14 [style=dashed]
	expert2_7_linear1_14 -> expert2_7_gelu_14
	expert2_7_gelu_14 -> expert2_7_linear2_14
	expert2_7_linear2_14 -> expert2_7_agg
	expert_select2 -> expert2_7_linear1_15 [style=dashed]
	expert2_7_linear1_15 -> expert2_7_gelu_15
	expert2_7_gelu_15 -> expert2_7_linear2_15
	expert2_7_linear2_15 -> expert2_7_agg
	expert2_7_agg -> expert_outputs2
	expert_outputs2 -> weighted_sum2
	weighted_sum2 -> residual2_2
	residual2_1 -> residual2_2
	residual2_2 -> ln3_0
	ln3_0 -> q_proj_3_0_0
	ln3_0 -> k_proj_3_0_0
	ln3_0 -> v_proj_3_0_0
	q_proj_3_0_0 -> attn_3_0_0
	k_proj_3_0_0 -> attn_3_0_0
	v_proj_3_0_0 -> attn_3_0_0
	attn_3_0_0 -> concat_dim_3_0
	ln3_0 -> q_proj_3_0_1
	ln3_0 -> k_proj_3_0_1
	ln3_0 -> v_proj_3_0_1
	q_proj_3_0_1 -> attn_3_0_1
	k_proj_3_0_1 -> attn_3_0_1
	v_proj_3_0_1 -> attn_3_0_1
	attn_3_0_1 -> concat_dim_3_0
	ln3_0 -> q_proj_3_0_2
	ln3_0 -> k_proj_3_0_2
	ln3_0 -> v_proj_3_0_2
	q_proj_3_0_2 -> attn_3_0_2
	k_proj_3_0_2 -> attn_3_0_2
	v_proj_3_0_2 -> attn_3_0_2
	attn_3_0_2 -> concat_dim_3_0
	ln3_0 -> q_proj_3_0_3
	ln3_0 -> k_proj_3_0_3
	ln3_0 -> v_proj_3_0_3
	q_proj_3_0_3 -> attn_3_0_3
	k_proj_3_0_3 -> attn_3_0_3
	v_proj_3_0_3 -> attn_3_0_3
	attn_3_0_3 -> concat_dim_3_0
	concat_dim_3_0 -> concat_heads_3
	residual2_2 -> ln3_1
	ln3_1 -> q_proj_3_1_0
	ln3_1 -> k_proj_3_1_0
	ln3_1 -> v_proj_3_1_0
	q_proj_3_1_0 -> attn_3_1_0
	k_proj_3_1_0 -> attn_3_1_0
	v_proj_3_1_0 -> attn_3_1_0
	attn_3_1_0 -> concat_dim_3_1
	ln3_1 -> q_proj_3_1_1
	ln3_1 -> k_proj_3_1_1
	ln3_1 -> v_proj_3_1_1
	q_proj_3_1_1 -> attn_3_1_1
	k_proj_3_1_1 -> attn_3_1_1
	v_proj_3_1_1 -> attn_3_1_1
	attn_3_1_1 -> concat_dim_3_1
	ln3_1 -> q_proj_3_1_2
	ln3_1 -> k_proj_3_1_2
	ln3_1 -> v_proj_3_1_2
	q_proj_3_1_2 -> attn_3_1_2
	k_proj_3_1_2 -> attn_3_1_2
	v_proj_3_1_2 -> attn_3_1_2
	attn_3_1_2 -> concat_dim_3_1
	ln3_1 -> q_proj_3_1_3
	ln3_1 -> k_proj_3_1_3
	ln3_1 -> v_proj_3_1_3
	q_proj_3_1_3 -> attn_3_1_3
	k_proj_3_1_3 -> attn_3_1_3
	v_proj_3_1_3 -> attn_3_1_3
	attn_3_1_3 -> concat_dim_3_1
	concat_dim_3_1 -> concat_heads_3
	residual2_2 -> ln3_2
	ln3_2 -> q_proj_3_2_0
	ln3_2 -> k_proj_3_2_0
	ln3_2 -> v_proj_3_2_0
	q_proj_3_2_0 -> attn_3_2_0
	k_proj_3_2_0 -> attn_3_2_0
	v_proj_3_2_0 -> attn_3_2_0
	attn_3_2_0 -> concat_dim_3_2
	ln3_2 -> q_proj_3_2_1
	ln3_2 -> k_proj_3_2_1
	ln3_2 -> v_proj_3_2_1
	q_proj_3_2_1 -> attn_3_2_1
	k_proj_3_2_1 -> attn_3_2_1
	v_proj_3_2_1 -> attn_3_2_1
	attn_3_2_1 -> concat_dim_3_2
	ln3_2 -> q_proj_3_2_2
	ln3_2 -> k_proj_3_2_2
	ln3_2 -> v_proj_3_2_2
	q_proj_3_2_2 -> attn_3_2_2
	k_proj_3_2_2 -> attn_3_2_2
	v_proj_3_2_2 -> attn_3_2_2
	attn_3_2_2 -> concat_dim_3_2
	ln3_2 -> q_proj_3_2_3
	ln3_2 -> k_proj_3_2_3
	ln3_2 -> v_proj_3_2_3
	q_proj_3_2_3 -> attn_3_2_3
	k_proj_3_2_3 -> attn_3_2_3
	v_proj_3_2_3 -> attn_3_2_3
	attn_3_2_3 -> concat_dim_3_2
	concat_dim_3_2 -> concat_heads_3
	residual2_2 -> ln3_3
	ln3_3 -> q_proj_3_3_0
	ln3_3 -> k_proj_3_3_0
	ln3_3 -> v_proj_3_3_0
	q_proj_3_3_0 -> attn_3_3_0
	k_proj_3_3_0 -> attn_3_3_0
	v_proj_3_3_0 -> attn_3_3_0
	attn_3_3_0 -> concat_dim_3_3
	ln3_3 -> q_proj_3_3_1
	ln3_3 -> k_proj_3_3_1
	ln3_3 -> v_proj_3_3_1
	q_proj_3_3_1 -> attn_3_3_1
	k_proj_3_3_1 -> attn_3_3_1
	v_proj_3_3_1 -> attn_3_3_1
	attn_3_3_1 -> concat_dim_3_3
	ln3_3 -> q_proj_3_3_2
	ln3_3 -> k_proj_3_3_2
	ln3_3 -> v_proj_3_3_2
	q_proj_3_3_2 -> attn_3_3_2
	k_proj_3_3_2 -> attn_3_3_2
	v_proj_3_3_2 -> attn_3_3_2
	attn_3_3_2 -> concat_dim_3_3
	ln3_3 -> q_proj_3_3_3
	ln3_3 -> k_proj_3_3_3
	ln3_3 -> v_proj_3_3_3
	q_proj_3_3_3 -> attn_3_3_3
	k_proj_3_3_3 -> attn_3_3_3
	v_proj_3_3_3 -> attn_3_3_3
	attn_3_3_3 -> concat_dim_3_3
	concat_dim_3_3 -> concat_heads_3
	concat_heads_3 -> out_proj_3
	out_proj_3 -> residual3_1
	residual2_2 -> residual3_1
	residual3_1 -> ln3_mlp
	ln3_mlp -> gate3
	gate3 -> expert_select3
	expert_select3 -> expert3_0_linear1_0 [style=dashed]
	expert3_0_linear1_0 -> expert3_0_gelu_0
	expert3_0_gelu_0 -> expert3_0_linear2_0
	expert3_0_linear2_0 -> expert3_0_agg
	expert_select3 -> expert3_0_linear1_1 [style=dashed]
	expert3_0_linear1_1 -> expert3_0_gelu_1
	expert3_0_gelu_1 -> expert3_0_linear2_1
	expert3_0_linear2_1 -> expert3_0_agg
	expert3_0_agg -> expert_outputs3
	expert_select3 -> expert3_1_linear1_2 [style=dashed]
	expert3_1_linear1_2 -> expert3_1_gelu_2
	expert3_1_gelu_2 -> expert3_1_linear2_2
	expert3_1_linear2_2 -> expert3_1_agg
	expert_select3 -> expert3_1_linear1_3 [style=dashed]
	expert3_1_linear1_3 -> expert3_1_gelu_3
	expert3_1_gelu_3 -> expert3_1_linear2_3
	expert3_1_linear2_3 -> expert3_1_agg
	expert3_1_agg -> expert_outputs3
	expert_select3 -> expert3_2_linear1_4 [style=dashed]
	expert3_2_linear1_4 -> expert3_2_gelu_4
	expert3_2_gelu_4 -> expert3_2_linear2_4
	expert3_2_linear2_4 -> expert3_2_agg
	expert_select3 -> expert3_2_linear1_5 [style=dashed]
	expert3_2_linear1_5 -> expert3_2_gelu_5
	expert3_2_gelu_5 -> expert3_2_linear2_5
	expert3_2_linear2_5 -> expert3_2_agg
	expert3_2_agg -> expert_outputs3
	expert_select3 -> expert3_3_linear1_6 [style=dashed]
	expert3_3_linear1_6 -> expert3_3_gelu_6
	expert3_3_gelu_6 -> expert3_3_linear2_6
	expert3_3_linear2_6 -> expert3_3_agg
	expert_select3 -> expert3_3_linear1_7 [style=dashed]
	expert3_3_linear1_7 -> expert3_3_gelu_7
	expert3_3_gelu_7 -> expert3_3_linear2_7
	expert3_3_linear2_7 -> expert3_3_agg
	expert3_3_agg -> expert_outputs3
	expert_select3 -> expert3_4_linear1_8 [style=dashed]
	expert3_4_linear1_8 -> expert3_4_gelu_8
	expert3_4_gelu_8 -> expert3_4_linear2_8
	expert3_4_linear2_8 -> expert3_4_agg
	expert_select3 -> expert3_4_linear1_9 [style=dashed]
	expert3_4_linear1_9 -> expert3_4_gelu_9
	expert3_4_gelu_9 -> expert3_4_linear2_9
	expert3_4_linear2_9 -> expert3_4_agg
	expert3_4_agg -> expert_outputs3
	expert_select3 -> expert3_5_linear1_10 [style=dashed]
	expert3_5_linear1_10 -> expert3_5_gelu_10
	expert3_5_gelu_10 -> expert3_5_linear2_10
	expert3_5_linear2_10 -> expert3_5_agg
	expert_select3 -> expert3_5_linear1_11 [style=dashed]
	expert3_5_linear1_11 -> expert3_5_gelu_11
	expert3_5_gelu_11 -> expert3_5_linear2_11
	expert3_5_linear2_11 -> expert3_5_agg
	expert3_5_agg -> expert_outputs3
	expert_select3 -> expert3_6_linear1_12 [style=dashed]
	expert3_6_linear1_12 -> expert3_6_gelu_12
	expert3_6_gelu_12 -> expert3_6_linear2_12
	expert3_6_linear2_12 -> expert3_6_agg
	expert_select3 -> expert3_6_linear1_13 [style=dashed]
	expert3_6_linear1_13 -> expert3_6_gelu_13
	expert3_6_gelu_13 -> expert3_6_linear2_13
	expert3_6_linear2_13 -> expert3_6_agg
	expert3_6_agg -> expert_outputs3
	expert_select3 -> expert3_7_linear1_14 [style=dashed]
	expert3_7_linear1_14 -> expert3_7_gelu_14
	expert3_7_gelu_14 -> expert3_7_linear2_14
	expert3_7_linear2_14 -> expert3_7_agg
	expert_select3 -> expert3_7_linear1_15 [style=dashed]
	expert3_7_linear1_15 -> expert3_7_gelu_15
	expert3_7_gelu_15 -> expert3_7_linear2_15
	expert3_7_linear2_15 -> expert3_7_agg
	expert3_7_agg -> expert_outputs3
	expert_outputs3 -> weighted_sum3
	weighted_sum3 -> residual3_2
	residual3_1 -> residual3_2
	residual3_2 -> ln4_0
	ln4_0 -> q_proj_4_0_0
	ln4_0 -> k_proj_4_0_0
	ln4_0 -> v_proj_4_0_0
	q_proj_4_0_0 -> attn_4_0_0
	k_proj_4_0_0 -> attn_4_0_0
	v_proj_4_0_0 -> attn_4_0_0
	attn_4_0_0 -> concat_dim_4_0
	ln4_0 -> q_proj_4_0_1
	ln4_0 -> k_proj_4_0_1
	ln4_0 -> v_proj_4_0_1
	q_proj_4_0_1 -> attn_4_0_1
	k_proj_4_0_1 -> attn_4_0_1
	v_proj_4_0_1 -> attn_4_0_1
	attn_4_0_1 -> concat_dim_4_0
	ln4_0 -> q_proj_4_0_2
	ln4_0 -> k_proj_4_0_2
	ln4_0 -> v_proj_4_0_2
	q_proj_4_0_2 -> attn_4_0_2
	k_proj_4_0_2 -> attn_4_0_2
	v_proj_4_0_2 -> attn_4_0_2
	attn_4_0_2 -> concat_dim_4_0
	ln4_0 -> q_proj_4_0_3
	ln4_0 -> k_proj_4_0_3
	ln4_0 -> v_proj_4_0_3
	q_proj_4_0_3 -> attn_4_0_3
	k_proj_4_0_3 -> attn_4_0_3
	v_proj_4_0_3 -> attn_4_0_3
	attn_4_0_3 -> concat_dim_4_0
	concat_dim_4_0 -> concat_heads_4
	residual3_2 -> ln4_1
	ln4_1 -> q_proj_4_1_0
	ln4_1 -> k_proj_4_1_0
	ln4_1 -> v_proj_4_1_0
	q_proj_4_1_0 -> attn_4_1_0
	k_proj_4_1_0 -> attn_4_1_0
	v_proj_4_1_0 -> attn_4_1_0
	attn_4_1_0 -> concat_dim_4_1
	ln4_1 -> q_proj_4_1_1
	ln4_1 -> k_proj_4_1_1
	ln4_1 -> v_proj_4_1_1
	q_proj_4_1_1 -> attn_4_1_1
	k_proj_4_1_1 -> attn_4_1_1
	v_proj_4_1_1 -> attn_4_1_1
	attn_4_1_1 -> concat_dim_4_1
	ln4_1 -> q_proj_4_1_2
	ln4_1 -> k_proj_4_1_2
	ln4_1 -> v_proj_4_1_2
	q_proj_4_1_2 -> attn_4_1_2
	k_proj_4_1_2 -> attn_4_1_2
	v_proj_4_1_2 -> attn_4_1_2
	attn_4_1_2 -> concat_dim_4_1
	ln4_1 -> q_proj_4_1_3
	ln4_1 -> k_proj_4_1_3
	ln4_1 -> v_proj_4_1_3
	q_proj_4_1_3 -> attn_4_1_3
	k_proj_4_1_3 -> attn_4_1_3
	v_proj_4_1_3 -> attn_4_1_3
	attn_4_1_3 -> concat_dim_4_1
	concat_dim_4_1 -> concat_heads_4
	residual3_2 -> ln4_2
	ln4_2 -> q_proj_4_2_0
	ln4_2 -> k_proj_4_2_0
	ln4_2 -> v_proj_4_2_0
	q_proj_4_2_0 -> attn_4_2_0
	k_proj_4_2_0 -> attn_4_2_0
	v_proj_4_2_0 -> attn_4_2_0
	attn_4_2_0 -> concat_dim_4_2
	ln4_2 -> q_proj_4_2_1
	ln4_2 -> k_proj_4_2_1
	ln4_2 -> v_proj_4_2_1
	q_proj_4_2_1 -> attn_4_2_1
	k_proj_4_2_1 -> attn_4_2_1
	v_proj_4_2_1 -> attn_4_2_1
	attn_4_2_1 -> concat_dim_4_2
	ln4_2 -> q_proj_4_2_2
	ln4_2 -> k_proj_4_2_2
	ln4_2 -> v_proj_4_2_2
	q_proj_4_2_2 -> attn_4_2_2
	k_proj_4_2_2 -> attn_4_2_2
	v_proj_4_2_2 -> attn_4_2_2
	attn_4_2_2 -> concat_dim_4_2
	ln4_2 -> q_proj_4_2_3
	ln4_2 -> k_proj_4_2_3
	ln4_2 -> v_proj_4_2_3
	q_proj_4_2_3 -> attn_4_2_3
	k_proj_4_2_3 -> attn_4_2_3
	v_proj_4_2_3 -> attn_4_2_3
	attn_4_2_3 -> concat_dim_4_2
	concat_dim_4_2 -> concat_heads_4
	residual3_2 -> ln4_3
	ln4_3 -> q_proj_4_3_0
	ln4_3 -> k_proj_4_3_0
	ln4_3 -> v_proj_4_3_0
	q_proj_4_3_0 -> attn_4_3_0
	k_proj_4_3_0 -> attn_4_3_0
	v_proj_4_3_0 -> attn_4_3_0
	attn_4_3_0 -> concat_dim_4_3
	ln4_3 -> q_proj_4_3_1
	ln4_3 -> k_proj_4_3_1
	ln4_3 -> v_proj_4_3_1
	q_proj_4_3_1 -> attn_4_3_1
	k_proj_4_3_1 -> attn_4_3_1
	v_proj_4_3_1 -> attn_4_3_1
	attn_4_3_1 -> concat_dim_4_3
	ln4_3 -> q_proj_4_3_2
	ln4_3 -> k_proj_4_3_2
	ln4_3 -> v_proj_4_3_2
	q_proj_4_3_2 -> attn_4_3_2
	k_proj_4_3_2 -> attn_4_3_2
	v_proj_4_3_2 -> attn_4_3_2
	attn_4_3_2 -> concat_dim_4_3
	ln4_3 -> q_proj_4_3_3
	ln4_3 -> k_proj_4_3_3
	ln4_3 -> v_proj_4_3_3
	q_proj_4_3_3 -> attn_4_3_3
	k_proj_4_3_3 -> attn_4_3_3
	v_proj_4_3_3 -> attn_4_3_3
	attn_4_3_3 -> concat_dim_4_3
	concat_dim_4_3 -> concat_heads_4
	concat_heads_4 -> out_proj_4
	out_proj_4 -> residual4_1
	residual3_2 -> residual4_1
	residual4_1 -> ln4_mlp
	ln4_mlp -> gate4
	gate4 -> expert_select4
	expert_select4 -> expert4_0_linear1_0 [style=dashed]
	expert4_0_linear1_0 -> expert4_0_gelu_0
	expert4_0_gelu_0 -> expert4_0_linear2_0
	expert4_0_linear2_0 -> expert4_0_agg
	expert_select4 -> expert4_0_linear1_1 [style=dashed]
	expert4_0_linear1_1 -> expert4_0_gelu_1
	expert4_0_gelu_1 -> expert4_0_linear2_1
	expert4_0_linear2_1 -> expert4_0_agg
	expert4_0_agg -> expert_outputs4
	expert_select4 -> expert4_1_linear1_2 [style=dashed]
	expert4_1_linear1_2 -> expert4_1_gelu_2
	expert4_1_gelu_2 -> expert4_1_linear2_2
	expert4_1_linear2_2 -> expert4_1_agg
	expert_select4 -> expert4_1_linear1_3 [style=dashed]
	expert4_1_linear1_3 -> expert4_1_gelu_3
	expert4_1_gelu_3 -> expert4_1_linear2_3
	expert4_1_linear2_3 -> expert4_1_agg
	expert4_1_agg -> expert_outputs4
	expert_select4 -> expert4_2_linear1_4 [style=dashed]
	expert4_2_linear1_4 -> expert4_2_gelu_4
	expert4_2_gelu_4 -> expert4_2_linear2_4
	expert4_2_linear2_4 -> expert4_2_agg
	expert_select4 -> expert4_2_linear1_5 [style=dashed]
	expert4_2_linear1_5 -> expert4_2_gelu_5
	expert4_2_gelu_5 -> expert4_2_linear2_5
	expert4_2_linear2_5 -> expert4_2_agg
	expert4_2_agg -> expert_outputs4
	expert_select4 -> expert4_3_linear1_6 [style=dashed]
	expert4_3_linear1_6 -> expert4_3_gelu_6
	expert4_3_gelu_6 -> expert4_3_linear2_6
	expert4_3_linear2_6 -> expert4_3_agg
	expert_select4 -> expert4_3_linear1_7 [style=dashed]
	expert4_3_linear1_7 -> expert4_3_gelu_7
	expert4_3_gelu_7 -> expert4_3_linear2_7
	expert4_3_linear2_7 -> expert4_3_agg
	expert4_3_agg -> expert_outputs4
	expert_select4 -> expert4_4_linear1_8 [style=dashed]
	expert4_4_linear1_8 -> expert4_4_gelu_8
	expert4_4_gelu_8 -> expert4_4_linear2_8
	expert4_4_linear2_8 -> expert4_4_agg
	expert_select4 -> expert4_4_linear1_9 [style=dashed]
	expert4_4_linear1_9 -> expert4_4_gelu_9
	expert4_4_gelu_9 -> expert4_4_linear2_9
	expert4_4_linear2_9 -> expert4_4_agg
	expert4_4_agg -> expert_outputs4
	expert_select4 -> expert4_5_linear1_10 [style=dashed]
	expert4_5_linear1_10 -> expert4_5_gelu_10
	expert4_5_gelu_10 -> expert4_5_linear2_10
	expert4_5_linear2_10 -> expert4_5_agg
	expert_select4 -> expert4_5_linear1_11 [style=dashed]
	expert4_5_linear1_11 -> expert4_5_gelu_11
	expert4_5_gelu_11 -> expert4_5_linear2_11
	expert4_5_linear2_11 -> expert4_5_agg
	expert4_5_agg -> expert_outputs4
	expert_select4 -> expert4_6_linear1_12 [style=dashed]
	expert4_6_linear1_12 -> expert4_6_gelu_12
	expert4_6_gelu_12 -> expert4_6_linear2_12
	expert4_6_linear2_12 -> expert4_6_agg
	expert_select4 -> expert4_6_linear1_13 [style=dashed]
	expert4_6_linear1_13 -> expert4_6_gelu_13
	expert4_6_gelu_13 -> expert4_6_linear2_13
	expert4_6_linear2_13 -> expert4_6_agg
	expert4_6_agg -> expert_outputs4
	expert_select4 -> expert4_7_linear1_14 [style=dashed]
	expert4_7_linear1_14 -> expert4_7_gelu_14
	expert4_7_gelu_14 -> expert4_7_linear2_14
	expert4_7_linear2_14 -> expert4_7_agg
	expert_select4 -> expert4_7_linear1_15 [style=dashed]
	expert4_7_linear1_15 -> expert4_7_gelu_15
	expert4_7_gelu_15 -> expert4_7_linear2_15
	expert4_7_linear2_15 -> expert4_7_agg
	expert4_7_agg -> expert_outputs4
	expert_outputs4 -> weighted_sum4
	weighted_sum4 -> residual4_2
	residual4_1 -> residual4_2
	residual4_2 -> final_ln
	final_ln -> lm_head
	lm_head -> output
}
