<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="1440pt" height="441pt"
 viewBox="0.00 0.00 1440.00 440.91" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.18 0.18) rotate(0) translate(4 2437.84)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-2437.84 7971,-2437.84 7971,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_input</title>
<polygon fill="none" stroke="black" points="4412,-2169.84 4412,-2314.84 4724,-2314.84 4724,-2169.84 4412,-2169.84"/>
<text text-anchor="middle" x="4568" y="-2299.64" font-family="Times,serif" font-size="14.00">Input Layer</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_mha0</title>
<polygon fill="none" stroke="black" points="2554,-1423.93 2554,-1945.34 4360,-1945.34 4360,-1423.93 2554,-1423.93"/>
<text text-anchor="middle" x="3457" y="-1930.14" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_expert0_0</title>
<polygon fill="none" stroke="black" points="6088,-2032.34 6088,-2425.84 6298,-2425.84 6298,-2032.34 6088,-2032.34"/>
<text text-anchor="middle" x="6193" y="-2410.64" font-family="Times,serif" font-size="14.00">Expert 0</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_expert0_1</title>
<polygon fill="none" stroke="black" points="5444,-2032.34 5444,-2425.84 5654,-2425.84 5654,-2032.34 5444,-2032.34"/>
<text text-anchor="middle" x="5549" y="-2410.64" font-family="Times,serif" font-size="14.00">Expert 1</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_expert0_2</title>
<polygon fill="none" stroke="black" points="6410,-2032.34 6410,-2425.84 6620,-2425.84 6620,-2032.34 6410,-2032.34"/>
<text text-anchor="middle" x="6515" y="-2410.64" font-family="Times,serif" font-size="14.00">Expert 2</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_expert0_3</title>
<polygon fill="none" stroke="black" points="7054,-2032.34 7054,-2425.84 7264,-2425.84 7264,-2032.34 7054,-2032.34"/>
<text text-anchor="middle" x="7159" y="-2410.64" font-family="Times,serif" font-size="14.00">Expert 3</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_expert0_4</title>
<polygon fill="none" stroke="black" points="6732,-2032.34 6732,-2425.84 6942,-2425.84 6942,-2032.34 6732,-2032.34"/>
<text text-anchor="middle" x="6837" y="-2410.64" font-family="Times,serif" font-size="14.00">Expert 4</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_expert0_5</title>
<polygon fill="none" stroke="black" points="5766,-2032.34 5766,-2425.84 5976,-2425.84 5976,-2032.34 5766,-2032.34"/>
<text text-anchor="middle" x="5871" y="-2410.64" font-family="Times,serif" font-size="14.00">Expert 5</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_expert0_6</title>
<polygon fill="none" stroke="black" points="4904,-2032.34 4904,-2425.84 5114,-2425.84 5114,-2032.34 4904,-2032.34"/>
<text text-anchor="middle" x="5009" y="-2410.64" font-family="Times,serif" font-size="14.00">Expert 6</text>
</g>
<g id="clust10" class="cluster">
<title>cluster_expert0_7</title>
<polygon fill="none" stroke="black" points="5226,-2032.34 5226,-2425.84 5436,-2425.84 5436,-2032.34 5226,-2032.34"/>
<text text-anchor="middle" x="5331" y="-2410.64" font-family="Times,serif" font-size="14.00">Expert 7</text>
</g>
<g id="clust11" class="cluster">
<title>cluster_moe0</title>
<polygon fill="none" stroke="black" points="5388,-1683.84 5388,-1986.84 6268,-1986.84 6268,-1683.84 5388,-1683.84"/>
<text text-anchor="middle" x="5828" y="-1971.64" font-family="Times,serif" font-size="14.00">Mixture of Experts</text>
</g>
<g id="clust12" class="cluster">
<title>cluster_layer0</title>
<polygon fill="none" stroke="black" points="4400,-1668.84 4400,-2150.84 4794,-2150.84 4794,-1668.84 4400,-1668.84"/>
<text text-anchor="middle" x="4597" y="-2135.64" font-family="Times,serif" font-size="14.00">Layer 0</text>
</g>
<g id="clust14" class="cluster">
<title>cluster_mha2</title>
<polygon fill="none" stroke="black" points="6153,-853.95 6153,-1363.43 7959,-1363.43 7959,-853.95 6153,-853.95"/>
<text text-anchor="middle" x="7056" y="-1348.23" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
</g>
<g id="clust15" class="cluster">
<title>cluster_expert2_0</title>
<polygon fill="none" stroke="black" points="1050,-1434.91 1050,-1787.34 1260,-1787.34 1260,-1434.91 1050,-1434.91"/>
<text text-anchor="middle" x="1155" y="-1772.14" font-family="Times,serif" font-size="14.00">Expert 8</text>
</g>
<g id="clust16" class="cluster">
<title>cluster_expert2_1</title>
<polygon fill="none" stroke="black" points="84,-1434.91 84,-1787.34 294,-1787.34 294,-1434.91 84,-1434.91"/>
<text text-anchor="middle" x="189" y="-1772.14" font-family="Times,serif" font-size="14.00">Expert 9</text>
</g>
<g id="clust17" class="cluster">
<title>cluster_expert2_2</title>
<polygon fill="none" stroke="black" points="406,-1434.91 406,-1787.34 616,-1787.34 616,-1434.91 406,-1434.91"/>
<text text-anchor="middle" x="511" y="-1772.14" font-family="Times,serif" font-size="14.00">Expert 10</text>
</g>
<g id="clust18" class="cluster">
<title>cluster_expert2_3</title>
<polygon fill="none" stroke="black" points="728,-1434.91 728,-1787.34 938,-1787.34 938,-1434.91 728,-1434.91"/>
<text text-anchor="middle" x="833" y="-1772.14" font-family="Times,serif" font-size="14.00">Expert 11</text>
</g>
<g id="clust19" class="cluster">
<title>cluster_expert2_4</title>
<polygon fill="none" stroke="black" points="1372,-1434.91 1372,-1787.34 1582,-1787.34 1582,-1434.91 1372,-1434.91"/>
<text text-anchor="middle" x="1477" y="-1772.14" font-family="Times,serif" font-size="14.00">Expert 12</text>
</g>
<g id="clust20" class="cluster">
<title>cluster_expert2_5</title>
<polygon fill="none" stroke="black" points="1694,-1434.91 1694,-1787.34 1904,-1787.34 1904,-1434.91 1694,-1434.91"/>
<text text-anchor="middle" x="1799" y="-1772.14" font-family="Times,serif" font-size="14.00">Expert 13</text>
</g>
<g id="clust21" class="cluster">
<title>cluster_expert2_6</title>
<polygon fill="none" stroke="black" points="1912,-1434.91 1912,-1787.34 2122,-1787.34 2122,-1434.91 1912,-1434.91"/>
<text text-anchor="middle" x="2017" y="-1772.14" font-family="Times,serif" font-size="14.00">Expert 14</text>
</g>
<g id="clust22" class="cluster">
<title>cluster_expert2_7</title>
<polygon fill="none" stroke="black" points="2234,-1434.91 2234,-1787.34 2444,-1787.34 2444,-1434.91 2234,-1434.91"/>
<text text-anchor="middle" x="2339" y="-1772.14" font-family="Times,serif" font-size="14.00">Expert 15</text>
</g>
<g id="clust23" class="cluster">
<title>cluster_moe2</title>
<polygon fill="none" stroke="black" points="1024,-1101.93 1024,-1404.93 1904,-1404.93 1904,-1101.93 1024,-1101.93"/>
<text text-anchor="middle" x="1464" y="-1389.73" font-family="Times,serif" font-size="14.00">Mixture of Experts</text>
</g>
<g id="clust24" class="cluster">
<title>cluster_layer2</title>
<polygon fill="none" stroke="black" points="4368,-1086.93 4368,-1537.88 4762,-1537.88 4762,-1086.93 4368,-1086.93"/>
<text text-anchor="middle" x="4565" y="-1522.68" font-family="Times,serif" font-size="14.00">Layer 2</text>
</g>
<g id="clust25" class="cluster">
<title>cluster_mha3</title>
<polygon fill="none" stroke="black" points="1831,-652 1831,-1067.93 3637,-1067.93 3637,-652 1831,-652"/>
<text text-anchor="middle" x="2734" y="-1052.73" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
</g>
<g id="clust26" class="cluster">
<title>cluster_expert3_0</title>
<polygon fill="none" stroke="black" points="5291,-662.98 5291,-956.93 5501,-956.93 5501,-662.98 5291,-662.98"/>
<text text-anchor="middle" x="5396" y="-941.73" font-family="Times,serif" font-size="14.00">Expert 8</text>
</g>
<g id="clust27" class="cluster">
<title>cluster_expert3_1</title>
<polygon fill="none" stroke="black" points="3785,-662.98 3785,-956.93 3995,-956.93 3995,-662.98 3785,-662.98"/>
<text text-anchor="middle" x="3890" y="-941.73" font-family="Times,serif" font-size="14.00">Expert 9</text>
</g>
<g id="clust28" class="cluster">
<title>cluster_expert3_2</title>
<polygon fill="none" stroke="black" points="4325,-662.98 4325,-956.93 4535,-956.93 4535,-662.98 4325,-662.98"/>
<text text-anchor="middle" x="4430" y="-941.73" font-family="Times,serif" font-size="14.00">Expert 10</text>
</g>
<g id="clust29" class="cluster">
<title>cluster_expert3_3</title>
<polygon fill="none" stroke="black" points="5935,-662.98 5935,-956.93 6145,-956.93 6145,-662.98 5935,-662.98"/>
<text text-anchor="middle" x="6040" y="-941.73" font-family="Times,serif" font-size="14.00">Expert 11</text>
</g>
<g id="clust30" class="cluster">
<title>cluster_expert3_4</title>
<polygon fill="none" stroke="black" points="5613,-662.98 5613,-956.93 5823,-956.93 5823,-662.98 5613,-662.98"/>
<text text-anchor="middle" x="5718" y="-941.73" font-family="Times,serif" font-size="14.00">Expert 12</text>
</g>
<g id="clust31" class="cluster">
<title>cluster_expert3_5</title>
<polygon fill="none" stroke="black" points="4107,-662.98 4107,-956.93 4317,-956.93 4317,-662.98 4107,-662.98"/>
<text text-anchor="middle" x="4212" y="-941.73" font-family="Times,serif" font-size="14.00">Expert 13</text>
</g>
<g id="clust32" class="cluster">
<title>cluster_expert3_6</title>
<polygon fill="none" stroke="black" points="4969,-662.98 4969,-956.93 5179,-956.93 5179,-662.98 4969,-662.98"/>
<text text-anchor="middle" x="5074" y="-941.73" font-family="Times,serif" font-size="14.00">Expert 14</text>
</g>
<g id="clust33" class="cluster">
<title>cluster_expert3_7</title>
<polygon fill="none" stroke="black" points="4647,-662.98 4647,-956.93 4857,-956.93 4857,-662.98 4647,-662.98"/>
<text text-anchor="middle" x="4752" y="-941.73" font-family="Times,serif" font-size="14.00">Expert 15</text>
</g>
<g id="clust34" class="cluster">
<title>cluster_moe3</title>
<polygon fill="none" stroke="black" points="4269,-330 4269,-633 5149,-633 5149,-330 4269,-330"/>
<text text-anchor="middle" x="4709" y="-617.8" font-family="Times,serif" font-size="14.00">Mixture of Experts</text>
</g>
<g id="clust35" class="cluster">
<title>cluster_layer3</title>
<polygon fill="none" stroke="black" points="3287,-315 3287,-618 3681,-618 3681,-315 3287,-315"/>
<text text-anchor="middle" x="3484" y="-602.8" font-family="Times,serif" font-size="14.00">Layer 3</text>
</g>
<g id="clust37" class="cluster">
<title>cluster_output</title>
<polygon fill="none" stroke="black" points="3303,-8 3303,-296 3665,-296 3665,-8 3303,-8"/>
<text text-anchor="middle" x="3484" y="-280.8" font-family="Times,serif" font-size="14.00">Output Layer</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4716.01,-2283.84 4480.56,-2283.84 4419.99,-2177.84 4655.44,-2177.84 4716.01,-2283.84"/>
<text text-anchor="middle" x="4568" y="-2242.14" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="4568" y="-2227.14" font-family="Times,serif" font-size="14.00">X: [B, L, d_model]</text>
<text text-anchor="middle" x="4568" y="-2212.14" font-family="Times,serif" font-size="14.00">GPU: Host</text>
</g>
<!-- split0 -->
<g id="node54" class="node">
<title>split0</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4727.82,-2119.84 4473.58,-2119.84 4408.18,-2013.84 4662.42,-2013.84 4727.82,-2119.84"/>
<text text-anchor="middle" x="4568" y="-2078.14" font-family="Times,serif" font-size="14.00">Split for Pipeline</text>
<text text-anchor="middle" x="4568" y="-2063.14" font-family="Times,serif" font-size="14.00">X: [B, L/P, d_model]</text>
<text text-anchor="middle" x="4568" y="-2048.14" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
</g>
<!-- input&#45;&gt;split0 -->
<g id="edge1" class="edge">
<title>input&#45;&gt;split0</title>
<path fill="none" stroke="black" d="M4568,-2177.69C4568,-2162.51 4568,-2145.78 4568,-2130.05"/>
<polygon fill="black" stroke="black" points="4571.5,-2129.89 4568,-2119.89 4564.5,-2129.89 4571.5,-2129.89"/>
</g>
<!-- qkv0_0 -->
<g id="node2" class="node">
<title>qkv0_0</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3674,-1914.34 3466,-1914.34 3466,-1861.34 3674,-1861.34 3674,-1914.34"/>
<text text-anchor="middle" x="3570" y="-1899.14" font-family="Times,serif" font-size="14.00">QKV Projection 0</text>
<text text-anchor="middle" x="3570" y="-1884.14" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="3570" y="-1869.14" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- attn0_0 -->
<g id="node10" class="node">
<title>attn0_0</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3674,-1756.34 3466,-1756.34 3466,-1703.34 3674,-1703.34 3674,-1756.34"/>
<text text-anchor="middle" x="3570" y="-1741.14" font-family="Times,serif" font-size="14.00">Attention 0</text>
<text text-anchor="middle" x="3570" y="-1726.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="3570" y="-1711.14" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- qkv0_0&#45;&gt;attn0_0 -->
<g id="edge3" class="edge">
<title>qkv0_0&#45;&gt;attn0_0</title>
<path fill="none" stroke="black" d="M3570,-1861.08C3570,-1835.26 3570,-1795.3 3570,-1766.45"/>
<polygon fill="black" stroke="black" points="3573.5,-1766.38 3570,-1756.38 3566.5,-1766.38 3573.5,-1766.38"/>
</g>
<!-- qkv0_1 -->
<g id="node3" class="node">
<title>qkv0_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3900,-1914.34 3692,-1914.34 3692,-1861.34 3900,-1861.34 3900,-1914.34"/>
<text text-anchor="middle" x="3796" y="-1899.14" font-family="Times,serif" font-size="14.00">QKV Projection 1</text>
<text text-anchor="middle" x="3796" y="-1884.14" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="3796" y="-1869.14" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- attn0_1 -->
<g id="node11" class="node">
<title>attn0_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3900,-1756.34 3692,-1756.34 3692,-1703.34 3900,-1703.34 3900,-1756.34"/>
<text text-anchor="middle" x="3796" y="-1741.14" font-family="Times,serif" font-size="14.00">Attention 1</text>
<text text-anchor="middle" x="3796" y="-1726.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="3796" y="-1711.14" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- qkv0_1&#45;&gt;attn0_1 -->
<g id="edge7" class="edge">
<title>qkv0_1&#45;&gt;attn0_1</title>
<path fill="none" stroke="black" d="M3796,-1861.08C3796,-1835.26 3796,-1795.3 3796,-1766.45"/>
<polygon fill="black" stroke="black" points="3799.5,-1766.38 3796,-1756.38 3792.5,-1766.38 3799.5,-1766.38"/>
</g>
<!-- qkv0_2 -->
<g id="node4" class="node">
<title>qkv0_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4126,-1914.34 3918,-1914.34 3918,-1861.34 4126,-1861.34 4126,-1914.34"/>
<text text-anchor="middle" x="4022" y="-1899.14" font-family="Times,serif" font-size="14.00">QKV Projection 2</text>
<text text-anchor="middle" x="4022" y="-1884.14" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="4022" y="-1869.14" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- attn0_2 -->
<g id="node12" class="node">
<title>attn0_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4126,-1756.34 3918,-1756.34 3918,-1703.34 4126,-1703.34 4126,-1756.34"/>
<text text-anchor="middle" x="4022" y="-1741.14" font-family="Times,serif" font-size="14.00">Attention 2</text>
<text text-anchor="middle" x="4022" y="-1726.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="4022" y="-1711.14" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- qkv0_2&#45;&gt;attn0_2 -->
<g id="edge11" class="edge">
<title>qkv0_2&#45;&gt;attn0_2</title>
<path fill="none" stroke="black" d="M4022,-1861.08C4022,-1835.26 4022,-1795.3 4022,-1766.45"/>
<polygon fill="black" stroke="black" points="4025.5,-1766.38 4022,-1756.38 4018.5,-1766.38 4025.5,-1766.38"/>
</g>
<!-- qkv0_3 -->
<g id="node5" class="node">
<title>qkv0_3</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4352,-1914.34 4144,-1914.34 4144,-1861.34 4352,-1861.34 4352,-1914.34"/>
<text text-anchor="middle" x="4248" y="-1899.14" font-family="Times,serif" font-size="14.00">QKV Projection 3</text>
<text text-anchor="middle" x="4248" y="-1884.14" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="4248" y="-1869.14" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- attn0_3 -->
<g id="node13" class="node">
<title>attn0_3</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4352,-1756.34 4144,-1756.34 4144,-1703.34 4352,-1703.34 4352,-1756.34"/>
<text text-anchor="middle" x="4248" y="-1741.14" font-family="Times,serif" font-size="14.00">Attention 3</text>
<text text-anchor="middle" x="4248" y="-1726.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="4248" y="-1711.14" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- qkv0_3&#45;&gt;attn0_3 -->
<g id="edge15" class="edge">
<title>qkv0_3&#45;&gt;attn0_3</title>
<path fill="none" stroke="black" d="M4248,-1861.08C4248,-1835.26 4248,-1795.3 4248,-1766.45"/>
<polygon fill="black" stroke="black" points="4251.5,-1766.38 4248,-1756.38 4244.5,-1766.38 4251.5,-1766.38"/>
</g>
<!-- qkv0_4 -->
<g id="node6" class="node">
<title>qkv0_4</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2770,-1914.34 2562,-1914.34 2562,-1861.34 2770,-1861.34 2770,-1914.34"/>
<text text-anchor="middle" x="2666" y="-1899.14" font-family="Times,serif" font-size="14.00">QKV Projection 4</text>
<text text-anchor="middle" x="2666" y="-1884.14" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="2666" y="-1869.14" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- attn0_4 -->
<g id="node14" class="node">
<title>attn0_4</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2770,-1756.34 2562,-1756.34 2562,-1703.34 2770,-1703.34 2770,-1756.34"/>
<text text-anchor="middle" x="2666" y="-1741.14" font-family="Times,serif" font-size="14.00">Attention 4</text>
<text text-anchor="middle" x="2666" y="-1726.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="2666" y="-1711.14" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- qkv0_4&#45;&gt;attn0_4 -->
<g id="edge19" class="edge">
<title>qkv0_4&#45;&gt;attn0_4</title>
<path fill="none" stroke="black" d="M2666,-1861.08C2666,-1835.26 2666,-1795.3 2666,-1766.45"/>
<polygon fill="black" stroke="black" points="2669.5,-1766.38 2666,-1756.38 2662.5,-1766.38 2669.5,-1766.38"/>
</g>
<!-- qkv0_5 -->
<g id="node7" class="node">
<title>qkv0_5</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2996,-1914.34 2788,-1914.34 2788,-1861.34 2996,-1861.34 2996,-1914.34"/>
<text text-anchor="middle" x="2892" y="-1899.14" font-family="Times,serif" font-size="14.00">QKV Projection 5</text>
<text text-anchor="middle" x="2892" y="-1884.14" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="2892" y="-1869.14" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- attn0_5 -->
<g id="node15" class="node">
<title>attn0_5</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2996,-1756.34 2788,-1756.34 2788,-1703.34 2996,-1703.34 2996,-1756.34"/>
<text text-anchor="middle" x="2892" y="-1741.14" font-family="Times,serif" font-size="14.00">Attention 5</text>
<text text-anchor="middle" x="2892" y="-1726.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="2892" y="-1711.14" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- qkv0_5&#45;&gt;attn0_5 -->
<g id="edge23" class="edge">
<title>qkv0_5&#45;&gt;attn0_5</title>
<path fill="none" stroke="black" d="M2892,-1861.08C2892,-1835.26 2892,-1795.3 2892,-1766.45"/>
<polygon fill="black" stroke="black" points="2895.5,-1766.38 2892,-1756.38 2888.5,-1766.38 2895.5,-1766.38"/>
</g>
<!-- qkv0_6 -->
<g id="node8" class="node">
<title>qkv0_6</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3222,-1914.34 3014,-1914.34 3014,-1861.34 3222,-1861.34 3222,-1914.34"/>
<text text-anchor="middle" x="3118" y="-1899.14" font-family="Times,serif" font-size="14.00">QKV Projection 6</text>
<text text-anchor="middle" x="3118" y="-1884.14" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="3118" y="-1869.14" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- attn0_6 -->
<g id="node16" class="node">
<title>attn0_6</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3222,-1756.34 3014,-1756.34 3014,-1703.34 3222,-1703.34 3222,-1756.34"/>
<text text-anchor="middle" x="3118" y="-1741.14" font-family="Times,serif" font-size="14.00">Attention 6</text>
<text text-anchor="middle" x="3118" y="-1726.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="3118" y="-1711.14" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- qkv0_6&#45;&gt;attn0_6 -->
<g id="edge27" class="edge">
<title>qkv0_6&#45;&gt;attn0_6</title>
<path fill="none" stroke="black" d="M3118,-1861.08C3118,-1835.26 3118,-1795.3 3118,-1766.45"/>
<polygon fill="black" stroke="black" points="3121.5,-1766.38 3118,-1756.38 3114.5,-1766.38 3121.5,-1766.38"/>
</g>
<!-- qkv0_7 -->
<g id="node9" class="node">
<title>qkv0_7</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3448,-1914.34 3240,-1914.34 3240,-1861.34 3448,-1861.34 3448,-1914.34"/>
<text text-anchor="middle" x="3344" y="-1899.14" font-family="Times,serif" font-size="14.00">QKV Projection 7</text>
<text text-anchor="middle" x="3344" y="-1884.14" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="3344" y="-1869.14" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- attn0_7 -->
<g id="node17" class="node">
<title>attn0_7</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3448,-1756.34 3240,-1756.34 3240,-1703.34 3448,-1703.34 3448,-1756.34"/>
<text text-anchor="middle" x="3344" y="-1741.14" font-family="Times,serif" font-size="14.00">Attention 7</text>
<text text-anchor="middle" x="3344" y="-1726.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="3344" y="-1711.14" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- qkv0_7&#45;&gt;attn0_7 -->
<g id="edge31" class="edge">
<title>qkv0_7&#45;&gt;attn0_7</title>
<path fill="none" stroke="black" d="M3344,-1861.08C3344,-1835.26 3344,-1795.3 3344,-1766.45"/>
<polygon fill="black" stroke="black" points="3347.5,-1766.38 3344,-1756.38 3340.5,-1766.38 3347.5,-1766.38"/>
</g>
<!-- out0_0 -->
<g id="node18" class="node">
<title>out0_0</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3674,-1628.86 3466,-1628.86 3466,-1575.86 3674,-1575.86 3674,-1628.86"/>
<text text-anchor="middle" x="3570" y="-1613.66" font-family="Times,serif" font-size="14.00">Output Proj 0</text>
<text text-anchor="middle" x="3570" y="-1598.66" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="3570" y="-1583.66" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- attn0_0&#45;&gt;out0_0 -->
<g id="edge4" class="edge">
<title>attn0_0&#45;&gt;out0_0</title>
<path fill="none" stroke="black" d="M3570,-1703.14C3570,-1684.7 3570,-1659.61 3570,-1639.21"/>
<polygon fill="black" stroke="black" points="3573.5,-1639.02 3570,-1629.02 3566.5,-1639.02 3573.5,-1639.02"/>
</g>
<!-- out0_1 -->
<g id="node19" class="node">
<title>out0_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3900,-1628.86 3692,-1628.86 3692,-1575.86 3900,-1575.86 3900,-1628.86"/>
<text text-anchor="middle" x="3796" y="-1613.66" font-family="Times,serif" font-size="14.00">Output Proj 1</text>
<text text-anchor="middle" x="3796" y="-1598.66" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="3796" y="-1583.66" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- attn0_1&#45;&gt;out0_1 -->
<g id="edge8" class="edge">
<title>attn0_1&#45;&gt;out0_1</title>
<path fill="none" stroke="black" d="M3796,-1703.14C3796,-1684.7 3796,-1659.61 3796,-1639.21"/>
<polygon fill="black" stroke="black" points="3799.5,-1639.02 3796,-1629.02 3792.5,-1639.02 3799.5,-1639.02"/>
</g>
<!-- out0_2 -->
<g id="node20" class="node">
<title>out0_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4126,-1628.86 3918,-1628.86 3918,-1575.86 4126,-1575.86 4126,-1628.86"/>
<text text-anchor="middle" x="4022" y="-1613.66" font-family="Times,serif" font-size="14.00">Output Proj 2</text>
<text text-anchor="middle" x="4022" y="-1598.66" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="4022" y="-1583.66" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- attn0_2&#45;&gt;out0_2 -->
<g id="edge12" class="edge">
<title>attn0_2&#45;&gt;out0_2</title>
<path fill="none" stroke="black" d="M4022,-1703.14C4022,-1684.7 4022,-1659.61 4022,-1639.21"/>
<polygon fill="black" stroke="black" points="4025.5,-1639.02 4022,-1629.02 4018.5,-1639.02 4025.5,-1639.02"/>
</g>
<!-- out0_3 -->
<g id="node21" class="node">
<title>out0_3</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4352,-1628.86 4144,-1628.86 4144,-1575.86 4352,-1575.86 4352,-1628.86"/>
<text text-anchor="middle" x="4248" y="-1613.66" font-family="Times,serif" font-size="14.00">Output Proj 3</text>
<text text-anchor="middle" x="4248" y="-1598.66" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="4248" y="-1583.66" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- attn0_3&#45;&gt;out0_3 -->
<g id="edge16" class="edge">
<title>attn0_3&#45;&gt;out0_3</title>
<path fill="none" stroke="black" d="M4248,-1703.14C4248,-1684.7 4248,-1659.61 4248,-1639.21"/>
<polygon fill="black" stroke="black" points="4251.5,-1639.02 4248,-1629.02 4244.5,-1639.02 4251.5,-1639.02"/>
</g>
<!-- out0_4 -->
<g id="node22" class="node">
<title>out0_4</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2770,-1628.86 2562,-1628.86 2562,-1575.86 2770,-1575.86 2770,-1628.86"/>
<text text-anchor="middle" x="2666" y="-1613.66" font-family="Times,serif" font-size="14.00">Output Proj 4</text>
<text text-anchor="middle" x="2666" y="-1598.66" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="2666" y="-1583.66" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- attn0_4&#45;&gt;out0_4 -->
<g id="edge20" class="edge">
<title>attn0_4&#45;&gt;out0_4</title>
<path fill="none" stroke="black" d="M2666,-1703.14C2666,-1684.7 2666,-1659.61 2666,-1639.21"/>
<polygon fill="black" stroke="black" points="2669.5,-1639.02 2666,-1629.02 2662.5,-1639.02 2669.5,-1639.02"/>
</g>
<!-- out0_5 -->
<g id="node23" class="node">
<title>out0_5</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2996,-1628.86 2788,-1628.86 2788,-1575.86 2996,-1575.86 2996,-1628.86"/>
<text text-anchor="middle" x="2892" y="-1613.66" font-family="Times,serif" font-size="14.00">Output Proj 5</text>
<text text-anchor="middle" x="2892" y="-1598.66" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="2892" y="-1583.66" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- attn0_5&#45;&gt;out0_5 -->
<g id="edge24" class="edge">
<title>attn0_5&#45;&gt;out0_5</title>
<path fill="none" stroke="black" d="M2892,-1703.14C2892,-1684.7 2892,-1659.61 2892,-1639.21"/>
<polygon fill="black" stroke="black" points="2895.5,-1639.02 2892,-1629.02 2888.5,-1639.02 2895.5,-1639.02"/>
</g>
<!-- out0_6 -->
<g id="node24" class="node">
<title>out0_6</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3222,-1628.86 3014,-1628.86 3014,-1575.86 3222,-1575.86 3222,-1628.86"/>
<text text-anchor="middle" x="3118" y="-1613.66" font-family="Times,serif" font-size="14.00">Output Proj 6</text>
<text text-anchor="middle" x="3118" y="-1598.66" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="3118" y="-1583.66" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- attn0_6&#45;&gt;out0_6 -->
<g id="edge28" class="edge">
<title>attn0_6&#45;&gt;out0_6</title>
<path fill="none" stroke="black" d="M3118,-1703.14C3118,-1684.7 3118,-1659.61 3118,-1639.21"/>
<polygon fill="black" stroke="black" points="3121.5,-1639.02 3118,-1629.02 3114.5,-1639.02 3121.5,-1639.02"/>
</g>
<!-- out0_7 -->
<g id="node25" class="node">
<title>out0_7</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3448,-1628.86 3240,-1628.86 3240,-1575.86 3448,-1575.86 3448,-1628.86"/>
<text text-anchor="middle" x="3344" y="-1613.66" font-family="Times,serif" font-size="14.00">Output Proj 7</text>
<text text-anchor="middle" x="3344" y="-1598.66" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="3344" y="-1583.66" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- attn0_7&#45;&gt;out0_7 -->
<g id="edge32" class="edge">
<title>attn0_7&#45;&gt;out0_7</title>
<path fill="none" stroke="black" d="M3344,-1703.14C3344,-1684.7 3344,-1659.61 3344,-1639.21"/>
<polygon fill="black" stroke="black" points="3347.5,-1639.02 3344,-1629.02 3340.5,-1639.02 3347.5,-1639.02"/>
</g>
<!-- ar0 -->
<g id="node26" class="node">
<title>ar0</title>
<ellipse fill="lightcoral" stroke="lightcoral" cx="3570" cy="-1469.41" rx="111.03" ry="37.45"/>
<text text-anchor="middle" x="3570" y="-1480.71" font-family="Times,serif" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="3570" y="-1465.71" font-family="Times,serif" font-size="14.00">Sum across 8 GPUs</text>
<text text-anchor="middle" x="3570" y="-1450.71" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
</g>
<!-- out0_0&#45;&gt;ar0 -->
<g id="edge5" class="edge">
<title>out0_0&#45;&gt;ar0</title>
<path fill="none" stroke="black" d="M3570,-1575.8C3570,-1559.13 3570,-1536.88 3570,-1517.12"/>
<polygon fill="black" stroke="black" points="3573.5,-1517.05 3570,-1507.05 3566.5,-1517.05 3573.5,-1517.05"/>
</g>
<!-- out0_1&#45;&gt;ar0 -->
<g id="edge9" class="edge">
<title>out0_1&#45;&gt;ar0</title>
<path fill="none" stroke="black" d="M3751.89,-1575.8C3718.23,-1556.3 3671.39,-1529.16 3633.68,-1507.3"/>
<polygon fill="black" stroke="black" points="3635.2,-1504.14 3624.79,-1502.16 3631.69,-1510.2 3635.2,-1504.14"/>
</g>
<!-- out0_2&#45;&gt;ar0 -->
<g id="edge13" class="edge">
<title>out0_2&#45;&gt;ar0</title>
<path fill="none" stroke="black" d="M3944.32,-1575.83C3932.51,-1572.08 3920.45,-1568.33 3909,-1564.88 3827.3,-1540.32 3733.87,-1514.45 3665.81,-1496"/>
<polygon fill="black" stroke="black" points="3666.53,-1492.57 3655.96,-1493.33 3664.7,-1499.32 3666.53,-1492.57"/>
</g>
<!-- out0_3&#45;&gt;ar0 -->
<g id="edge17" class="edge">
<title>out0_3&#45;&gt;ar0</title>
<path fill="none" stroke="black" d="M4174.29,-1575.85C4161.29,-1571.85 4147.82,-1568.01 4135,-1564.88 3980.47,-1527.24 3798.52,-1499.76 3683.71,-1484.43"/>
<polygon fill="black" stroke="black" points="3683.88,-1480.92 3673.5,-1483.08 3682.96,-1487.86 3683.88,-1480.92"/>
</g>
<!-- out0_4&#45;&gt;ar0 -->
<g id="edge21" class="edge">
<title>out0_4&#45;&gt;ar0</title>
<path fill="none" stroke="black" d="M2738.07,-1575.81C2751.55,-1571.69 2765.61,-1567.82 2779,-1564.88 3014.15,-1513.39 3295.19,-1488.25 3451.02,-1477.42"/>
<polygon fill="black" stroke="black" points="3451.37,-1480.91 3461.1,-1476.73 3450.89,-1473.92 3451.37,-1480.91"/>
</g>
<!-- out0_5&#45;&gt;ar0 -->
<g id="edge25" class="edge">
<title>out0_5&#45;&gt;ar0</title>
<path fill="none" stroke="black" d="M2965.71,-1575.85C2978.71,-1571.85 2992.18,-1568.01 3005,-1564.88 3159.53,-1527.24 3341.48,-1499.76 3456.29,-1484.43"/>
<polygon fill="black" stroke="black" points="3457.04,-1487.86 3466.5,-1483.08 3456.12,-1480.92 3457.04,-1487.86"/>
</g>
<!-- out0_6&#45;&gt;ar0 -->
<g id="edge29" class="edge">
<title>out0_6&#45;&gt;ar0</title>
<path fill="none" stroke="black" d="M3195.68,-1575.83C3207.49,-1572.08 3219.55,-1568.33 3231,-1564.88 3312.7,-1540.32 3406.13,-1514.45 3474.19,-1496"/>
<polygon fill="black" stroke="black" points="3475.3,-1499.32 3484.04,-1493.33 3473.47,-1492.57 3475.3,-1499.32"/>
</g>
<!-- out0_7&#45;&gt;ar0 -->
<g id="edge33" class="edge">
<title>out0_7&#45;&gt;ar0</title>
<path fill="none" stroke="black" d="M3388.11,-1575.8C3421.77,-1556.3 3468.61,-1529.16 3506.32,-1507.3"/>
<polygon fill="black" stroke="black" points="3508.31,-1510.2 3515.21,-1502.16 3504.8,-1504.14 3508.31,-1510.2"/>
</g>
<!-- res0 -->
<g id="node55" class="node">
<title>res0</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4785.88,-1940.84 4485.42,-1940.84 4408.12,-1834.84 4708.58,-1834.84 4785.88,-1940.84"/>
<text text-anchor="middle" x="4597" y="-1899.14" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="4597" y="-1884.14" font-family="Times,serif" font-size="14.00">Input: [B, L/P, d_model]</text>
<text text-anchor="middle" x="4597" y="-1869.14" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
</g>
<!-- ar0&#45;&gt;res0 -->
<g id="edge34" class="edge">
<title>ar0&#45;&gt;res0</title>
<path fill="none" stroke="black" d="M3679.35,-1476.28C3884.86,-1488.36 4312.49,-1518.75 4361,-1564.88 4433.68,-1634 4339.33,-1706.72 4399,-1787.34 4411.1,-1803.68 4426.64,-1817.52 4443.68,-1829.18"/>
<polygon fill="black" stroke="black" points="4441.88,-1832.19 4452.17,-1834.74 4445.72,-1826.33 4441.88,-1832.19"/>
</g>
<!-- expert0_0_1 -->
<g id="node27" class="node">
<title>expert0_0_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="6289,-2394.84 6101,-2394.84 6101,-2341.84 6289,-2341.84 6289,-2394.84"/>
<text text-anchor="middle" x="6195" y="-2379.64" font-family="Times,serif" font-size="14.00">Expert 0 Linear1</text>
<text text-anchor="middle" x="6195" y="-2364.64" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="6195" y="-2349.64" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- expert0_0_act -->
<g id="node28" class="node">
<title>expert0_0_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="6257.5,-2249.84 6132.5,-2249.84 6132.5,-2211.84 6257.5,-2211.84 6257.5,-2249.84"/>
<text text-anchor="middle" x="6195" y="-2234.64" font-family="Times,serif" font-size="14.00">Expert 0 GELU</text>
<text text-anchor="middle" x="6195" y="-2219.64" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- expert0_0_1&#45;&gt;expert0_0_act -->
<g id="edge39" class="edge">
<title>expert0_0_1&#45;&gt;expert0_0_act</title>
<path fill="none" stroke="black" d="M6195,-2341.53C6195,-2318.36 6195,-2284.39 6195,-2260.41"/>
<polygon fill="black" stroke="black" points="6198.5,-2260.17 6195,-2250.17 6191.5,-2260.17 6198.5,-2260.17"/>
</g>
<!-- expert0_0_2 -->
<g id="node29" class="node">
<title>expert0_0_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="6290,-2093.34 6096,-2093.34 6096,-2040.34 6290,-2040.34 6290,-2093.34"/>
<text text-anchor="middle" x="6193" y="-2078.14" font-family="Times,serif" font-size="14.00">Expert 0 Linear2</text>
<text text-anchor="middle" x="6193" y="-2063.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="6193" y="-2048.14" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- expert0_0_act&#45;&gt;expert0_0_2 -->
<g id="edge40" class="edge">
<title>expert0_0_act&#45;&gt;expert0_0_2</title>
<path fill="none" stroke="black" d="M6194.77,-2211.57C6194.45,-2185.51 6193.86,-2137.13 6193.44,-2103.75"/>
<polygon fill="black" stroke="black" points="6196.94,-2103.44 6193.32,-2093.48 6189.94,-2103.53 6196.94,-2103.44"/>
</g>
<!-- combine0 -->
<g id="node53" class="node">
<title>combine0</title>
<polygon fill="lightcoral" stroke="lightcoral" points="5866.19,-1940.84 5492.06,-1940.84 5395.81,-1834.84 5769.94,-1834.84 5866.19,-1940.84"/>
<text text-anchor="middle" x="5631" y="-1899.14" font-family="Times,serif" font-size="14.00">Combine Expert Outputs</text>
<text text-anchor="middle" x="5631" y="-1884.14" font-family="Times,serif" font-size="14.00">Weighted sum by gate scores</text>
<text text-anchor="middle" x="5631" y="-1869.14" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
</g>
<!-- expert0_0_2&#45;&gt;combine0 -->
<g id="edge41" class="edge">
<title>expert0_0_2&#45;&gt;combine0</title>
<path fill="none" stroke="black" d="M6147.92,-2040.33C6128.27,-2030.39 6104.6,-2019.93 6082,-2013.84 5994.54,-1990.26 5966.81,-2018.06 5879,-1995.84 5832.2,-1983.99 5782.94,-1964.37 5740.76,-1945.14"/>
<polygon fill="black" stroke="black" points="5742.14,-1941.93 5731.59,-1940.92 5739.21,-1948.28 5742.14,-1941.93"/>
</g>
<!-- expert0_1_1 -->
<g id="node30" class="node">
<title>expert0_1_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="5645,-2394.84 5457,-2394.84 5457,-2341.84 5645,-2341.84 5645,-2394.84"/>
<text text-anchor="middle" x="5551" y="-2379.64" font-family="Times,serif" font-size="14.00">Expert 1 Linear1</text>
<text text-anchor="middle" x="5551" y="-2364.64" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="5551" y="-2349.64" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- expert0_1_act -->
<g id="node31" class="node">
<title>expert0_1_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="5613.5,-2249.84 5488.5,-2249.84 5488.5,-2211.84 5613.5,-2211.84 5613.5,-2249.84"/>
<text text-anchor="middle" x="5551" y="-2234.64" font-family="Times,serif" font-size="14.00">Expert 1 GELU</text>
<text text-anchor="middle" x="5551" y="-2219.64" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- expert0_1_1&#45;&gt;expert0_1_act -->
<g id="edge43" class="edge">
<title>expert0_1_1&#45;&gt;expert0_1_act</title>
<path fill="none" stroke="black" d="M5551,-2341.53C5551,-2318.36 5551,-2284.39 5551,-2260.41"/>
<polygon fill="black" stroke="black" points="5554.5,-2260.17 5551,-2250.17 5547.5,-2260.17 5554.5,-2260.17"/>
</g>
<!-- expert0_1_2 -->
<g id="node32" class="node">
<title>expert0_1_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="5646,-2093.34 5452,-2093.34 5452,-2040.34 5646,-2040.34 5646,-2093.34"/>
<text text-anchor="middle" x="5549" y="-2078.14" font-family="Times,serif" font-size="14.00">Expert 1 Linear2</text>
<text text-anchor="middle" x="5549" y="-2063.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="5549" y="-2048.14" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- expert0_1_act&#45;&gt;expert0_1_2 -->
<g id="edge44" class="edge">
<title>expert0_1_act&#45;&gt;expert0_1_2</title>
<path fill="none" stroke="black" d="M5550.77,-2211.57C5550.45,-2185.51 5549.86,-2137.13 5549.44,-2103.75"/>
<polygon fill="black" stroke="black" points="5552.94,-2103.44 5549.32,-2093.48 5545.94,-2103.53 5552.94,-2103.44"/>
</g>
<!-- expert0_1_2&#45;&gt;combine0 -->
<g id="edge45" class="edge">
<title>expert0_1_2&#45;&gt;combine0</title>
<path fill="none" stroke="black" d="M5560.92,-2040.1C5571.79,-2016.64 5588.28,-1981.05 5602.53,-1950.29"/>
<polygon fill="black" stroke="black" points="5605.84,-1951.46 5606.87,-1940.92 5599.49,-1948.52 5605.84,-1951.46"/>
</g>
<!-- expert0_2_1 -->
<g id="node33" class="node">
<title>expert0_2_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="6611,-2394.84 6423,-2394.84 6423,-2341.84 6611,-2341.84 6611,-2394.84"/>
<text text-anchor="middle" x="6517" y="-2379.64" font-family="Times,serif" font-size="14.00">Expert 2 Linear1</text>
<text text-anchor="middle" x="6517" y="-2364.64" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="6517" y="-2349.64" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- expert0_2_act -->
<g id="node34" class="node">
<title>expert0_2_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="6579.5,-2249.84 6454.5,-2249.84 6454.5,-2211.84 6579.5,-2211.84 6579.5,-2249.84"/>
<text text-anchor="middle" x="6517" y="-2234.64" font-family="Times,serif" font-size="14.00">Expert 2 GELU</text>
<text text-anchor="middle" x="6517" y="-2219.64" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- expert0_2_1&#45;&gt;expert0_2_act -->
<g id="edge47" class="edge">
<title>expert0_2_1&#45;&gt;expert0_2_act</title>
<path fill="none" stroke="black" d="M6517,-2341.53C6517,-2318.36 6517,-2284.39 6517,-2260.41"/>
<polygon fill="black" stroke="black" points="6520.5,-2260.17 6517,-2250.17 6513.5,-2260.17 6520.5,-2260.17"/>
</g>
<!-- expert0_2_2 -->
<g id="node35" class="node">
<title>expert0_2_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="6612,-2093.34 6418,-2093.34 6418,-2040.34 6612,-2040.34 6612,-2093.34"/>
<text text-anchor="middle" x="6515" y="-2078.14" font-family="Times,serif" font-size="14.00">Expert 2 Linear2</text>
<text text-anchor="middle" x="6515" y="-2063.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="6515" y="-2048.14" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- expert0_2_act&#45;&gt;expert0_2_2 -->
<g id="edge48" class="edge">
<title>expert0_2_act&#45;&gt;expert0_2_2</title>
<path fill="none" stroke="black" d="M6516.77,-2211.57C6516.45,-2185.51 6515.86,-2137.13 6515.44,-2103.75"/>
<polygon fill="black" stroke="black" points="6518.94,-2103.44 6515.32,-2093.48 6511.94,-2103.53 6518.94,-2103.44"/>
</g>
<!-- expert0_2_2&#45;&gt;combine0 -->
<g id="edge49" class="edge">
<title>expert0_2_2&#45;&gt;combine0</title>
<path fill="none" stroke="black" d="M6471.13,-2040.33C6451.3,-2030.12 6427.16,-2019.46 6404,-2013.84 6289.62,-1986.06 5988.59,-2017.71 5875,-1986.84 5834.9,-1975.94 5792.46,-1960.4 5754.42,-1944.89"/>
<polygon fill="black" stroke="black" points="5755.43,-1941.52 5744.85,-1940.96 5752.77,-1948 5755.43,-1941.52"/>
</g>
<!-- expert0_3_1 -->
<g id="node36" class="node">
<title>expert0_3_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="7255,-2394.84 7067,-2394.84 7067,-2341.84 7255,-2341.84 7255,-2394.84"/>
<text text-anchor="middle" x="7161" y="-2379.64" font-family="Times,serif" font-size="14.00">Expert 3 Linear1</text>
<text text-anchor="middle" x="7161" y="-2364.64" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="7161" y="-2349.64" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- expert0_3_act -->
<g id="node37" class="node">
<title>expert0_3_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="7223.5,-2249.84 7098.5,-2249.84 7098.5,-2211.84 7223.5,-2211.84 7223.5,-2249.84"/>
<text text-anchor="middle" x="7161" y="-2234.64" font-family="Times,serif" font-size="14.00">Expert 3 GELU</text>
<text text-anchor="middle" x="7161" y="-2219.64" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- expert0_3_1&#45;&gt;expert0_3_act -->
<g id="edge51" class="edge">
<title>expert0_3_1&#45;&gt;expert0_3_act</title>
<path fill="none" stroke="black" d="M7161,-2341.53C7161,-2318.36 7161,-2284.39 7161,-2260.41"/>
<polygon fill="black" stroke="black" points="7164.5,-2260.17 7161,-2250.17 7157.5,-2260.17 7164.5,-2260.17"/>
</g>
<!-- expert0_3_2 -->
<g id="node38" class="node">
<title>expert0_3_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="7256,-2093.34 7062,-2093.34 7062,-2040.34 7256,-2040.34 7256,-2093.34"/>
<text text-anchor="middle" x="7159" y="-2078.14" font-family="Times,serif" font-size="14.00">Expert 3 Linear2</text>
<text text-anchor="middle" x="7159" y="-2063.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="7159" y="-2048.14" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- expert0_3_act&#45;&gt;expert0_3_2 -->
<g id="edge52" class="edge">
<title>expert0_3_act&#45;&gt;expert0_3_2</title>
<path fill="none" stroke="black" d="M7160.77,-2211.57C7160.45,-2185.51 7159.86,-2137.13 7159.44,-2103.75"/>
<polygon fill="black" stroke="black" points="7162.94,-2103.44 7159.32,-2093.48 7155.94,-2103.53 7162.94,-2103.44"/>
</g>
<!-- expert0_3_2&#45;&gt;combine0 -->
<g id="edge53" class="edge">
<title>expert0_3_2&#45;&gt;combine0</title>
<path fill="none" stroke="black" d="M7115.44,-2040.29C7095.57,-2030.01 7071.31,-2019.31 7048,-2013.84 6984.54,-1998.94 5938.85,-1999.94 5875,-1986.84 5831.44,-1977.89 5785.7,-1961.57 5745.75,-1944.77"/>
<polygon fill="black" stroke="black" points="5747.09,-1941.54 5736.52,-1940.84 5744.35,-1947.98 5747.09,-1941.54"/>
</g>
<!-- expert0_4_1 -->
<g id="node39" class="node">
<title>expert0_4_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="6933,-2394.84 6745,-2394.84 6745,-2341.84 6933,-2341.84 6933,-2394.84"/>
<text text-anchor="middle" x="6839" y="-2379.64" font-family="Times,serif" font-size="14.00">Expert 4 Linear1</text>
<text text-anchor="middle" x="6839" y="-2364.64" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="6839" y="-2349.64" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- expert0_4_act -->
<g id="node40" class="node">
<title>expert0_4_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="6901.5,-2249.84 6776.5,-2249.84 6776.5,-2211.84 6901.5,-2211.84 6901.5,-2249.84"/>
<text text-anchor="middle" x="6839" y="-2234.64" font-family="Times,serif" font-size="14.00">Expert 4 GELU</text>
<text text-anchor="middle" x="6839" y="-2219.64" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- expert0_4_1&#45;&gt;expert0_4_act -->
<g id="edge55" class="edge">
<title>expert0_4_1&#45;&gt;expert0_4_act</title>
<path fill="none" stroke="black" d="M6839,-2341.53C6839,-2318.36 6839,-2284.39 6839,-2260.41"/>
<polygon fill="black" stroke="black" points="6842.5,-2260.17 6839,-2250.17 6835.5,-2260.17 6842.5,-2260.17"/>
</g>
<!-- expert0_4_2 -->
<g id="node41" class="node">
<title>expert0_4_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="6934,-2093.34 6740,-2093.34 6740,-2040.34 6934,-2040.34 6934,-2093.34"/>
<text text-anchor="middle" x="6837" y="-2078.14" font-family="Times,serif" font-size="14.00">Expert 4 Linear2</text>
<text text-anchor="middle" x="6837" y="-2063.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="6837" y="-2048.14" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- expert0_4_act&#45;&gt;expert0_4_2 -->
<g id="edge56" class="edge">
<title>expert0_4_act&#45;&gt;expert0_4_2</title>
<path fill="none" stroke="black" d="M6838.77,-2211.57C6838.45,-2185.51 6837.86,-2137.13 6837.44,-2103.75"/>
<polygon fill="black" stroke="black" points="6840.94,-2103.44 6837.32,-2093.48 6833.94,-2103.53 6840.94,-2103.44"/>
</g>
<!-- expert0_4_2&#45;&gt;combine0 -->
<g id="edge57" class="edge">
<title>expert0_4_2&#45;&gt;combine0</title>
<path fill="none" stroke="black" d="M6793.44,-2040.3C6773.56,-2030.02 6749.3,-2019.32 6726,-2013.84 6644.75,-1994.72 6058.33,-2000.58 5975,-1995.84 5930.45,-1993.3 5918.39,-1997.26 5875,-1986.84 5833.19,-1976.79 5789.11,-1960.87 5750.1,-1944.75"/>
<polygon fill="black" stroke="black" points="5751.39,-1941.5 5740.81,-1940.88 5748.69,-1947.96 5751.39,-1941.5"/>
</g>
<!-- expert0_5_1 -->
<g id="node42" class="node">
<title>expert0_5_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="5967,-2394.84 5779,-2394.84 5779,-2341.84 5967,-2341.84 5967,-2394.84"/>
<text text-anchor="middle" x="5873" y="-2379.64" font-family="Times,serif" font-size="14.00">Expert 5 Linear1</text>
<text text-anchor="middle" x="5873" y="-2364.64" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="5873" y="-2349.64" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- expert0_5_act -->
<g id="node43" class="node">
<title>expert0_5_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="5935.5,-2249.84 5810.5,-2249.84 5810.5,-2211.84 5935.5,-2211.84 5935.5,-2249.84"/>
<text text-anchor="middle" x="5873" y="-2234.64" font-family="Times,serif" font-size="14.00">Expert 5 GELU</text>
<text text-anchor="middle" x="5873" y="-2219.64" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- expert0_5_1&#45;&gt;expert0_5_act -->
<g id="edge59" class="edge">
<title>expert0_5_1&#45;&gt;expert0_5_act</title>
<path fill="none" stroke="black" d="M5873,-2341.53C5873,-2318.36 5873,-2284.39 5873,-2260.41"/>
<polygon fill="black" stroke="black" points="5876.5,-2260.17 5873,-2250.17 5869.5,-2260.17 5876.5,-2260.17"/>
</g>
<!-- expert0_5_2 -->
<g id="node44" class="node">
<title>expert0_5_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="5968,-2093.34 5774,-2093.34 5774,-2040.34 5968,-2040.34 5968,-2093.34"/>
<text text-anchor="middle" x="5871" y="-2078.14" font-family="Times,serif" font-size="14.00">Expert 5 Linear2</text>
<text text-anchor="middle" x="5871" y="-2063.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="5871" y="-2048.14" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- expert0_5_act&#45;&gt;expert0_5_2 -->
<g id="edge60" class="edge">
<title>expert0_5_act&#45;&gt;expert0_5_2</title>
<path fill="none" stroke="black" d="M5872.77,-2211.57C5872.45,-2185.51 5871.86,-2137.13 5871.44,-2103.75"/>
<polygon fill="black" stroke="black" points="5874.94,-2103.44 5871.32,-2093.48 5867.94,-2103.53 5874.94,-2103.44"/>
</g>
<!-- expert0_5_2&#45;&gt;combine0 -->
<g id="edge61" class="edge">
<title>expert0_5_2&#45;&gt;combine0</title>
<path fill="none" stroke="black" d="M5836.36,-2040.29C5803.43,-2016 5752.73,-1978.61 5709.94,-1947.06"/>
<polygon fill="black" stroke="black" points="5711.9,-1944.15 5701.77,-1941.03 5707.74,-1949.78 5711.9,-1944.15"/>
</g>
<!-- expert0_6_1 -->
<g id="node45" class="node">
<title>expert0_6_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="5101,-2394.84 4913,-2394.84 4913,-2341.84 5101,-2341.84 5101,-2394.84"/>
<text text-anchor="middle" x="5007" y="-2379.64" font-family="Times,serif" font-size="14.00">Expert 6 Linear1</text>
<text text-anchor="middle" x="5007" y="-2364.64" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="5007" y="-2349.64" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- expert0_6_act -->
<g id="node46" class="node">
<title>expert0_6_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="5070.5,-2249.84 4945.5,-2249.84 4945.5,-2211.84 5070.5,-2211.84 5070.5,-2249.84"/>
<text text-anchor="middle" x="5008" y="-2234.64" font-family="Times,serif" font-size="14.00">Expert 6 GELU</text>
<text text-anchor="middle" x="5008" y="-2219.64" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- expert0_6_1&#45;&gt;expert0_6_act -->
<g id="edge63" class="edge">
<title>expert0_6_1&#45;&gt;expert0_6_act</title>
<path fill="none" stroke="black" d="M5007.19,-2341.53C5007.36,-2318.36 5007.61,-2284.39 5007.79,-2260.41"/>
<polygon fill="black" stroke="black" points="5011.29,-2260.19 5007.86,-2250.17 5004.29,-2260.14 5011.29,-2260.19"/>
</g>
<!-- expert0_6_2 -->
<g id="node47" class="node">
<title>expert0_6_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="5106,-2093.34 4912,-2093.34 4912,-2040.34 5106,-2040.34 5106,-2093.34"/>
<text text-anchor="middle" x="5009" y="-2078.14" font-family="Times,serif" font-size="14.00">Expert 6 Linear2</text>
<text text-anchor="middle" x="5009" y="-2063.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="5009" y="-2048.14" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- expert0_6_act&#45;&gt;expert0_6_2 -->
<g id="edge64" class="edge">
<title>expert0_6_act&#45;&gt;expert0_6_2</title>
<path fill="none" stroke="black" d="M5008.11,-2211.57C5008.27,-2185.51 5008.57,-2137.13 5008.78,-2103.75"/>
<polygon fill="black" stroke="black" points="5012.28,-2103.5 5008.84,-2093.48 5005.28,-2103.46 5012.28,-2103.5"/>
</g>
<!-- expert0_6_2&#45;&gt;combine0 -->
<g id="edge65" class="edge">
<title>expert0_6_2&#45;&gt;combine0</title>
<path fill="none" stroke="black" d="M5058.13,-2040.26C5077.11,-2031.06 5099.23,-2021.16 5120,-2013.84 5231.7,-1974.45 5361.36,-1942.89 5462.12,-1921.34"/>
<polygon fill="black" stroke="black" points="5463.04,-1924.72 5472.09,-1919.22 5461.58,-1917.87 5463.04,-1924.72"/>
</g>
<!-- expert0_7_1 -->
<g id="node48" class="node">
<title>expert0_7_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="5423,-2394.84 5235,-2394.84 5235,-2341.84 5423,-2341.84 5423,-2394.84"/>
<text text-anchor="middle" x="5329" y="-2379.64" font-family="Times,serif" font-size="14.00">Expert 7 Linear1</text>
<text text-anchor="middle" x="5329" y="-2364.64" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="5329" y="-2349.64" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- expert0_7_act -->
<g id="node49" class="node">
<title>expert0_7_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="5392.5,-2249.84 5267.5,-2249.84 5267.5,-2211.84 5392.5,-2211.84 5392.5,-2249.84"/>
<text text-anchor="middle" x="5330" y="-2234.64" font-family="Times,serif" font-size="14.00">Expert 7 GELU</text>
<text text-anchor="middle" x="5330" y="-2219.64" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- expert0_7_1&#45;&gt;expert0_7_act -->
<g id="edge67" class="edge">
<title>expert0_7_1&#45;&gt;expert0_7_act</title>
<path fill="none" stroke="black" d="M5329.19,-2341.53C5329.36,-2318.36 5329.61,-2284.39 5329.79,-2260.41"/>
<polygon fill="black" stroke="black" points="5333.29,-2260.19 5329.86,-2250.17 5326.29,-2260.14 5333.29,-2260.19"/>
</g>
<!-- expert0_7_2 -->
<g id="node50" class="node">
<title>expert0_7_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="5428,-2093.34 5234,-2093.34 5234,-2040.34 5428,-2040.34 5428,-2093.34"/>
<text text-anchor="middle" x="5331" y="-2078.14" font-family="Times,serif" font-size="14.00">Expert 7 Linear2</text>
<text text-anchor="middle" x="5331" y="-2063.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="5331" y="-2048.14" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- expert0_7_act&#45;&gt;expert0_7_2 -->
<g id="edge68" class="edge">
<title>expert0_7_act&#45;&gt;expert0_7_2</title>
<path fill="none" stroke="black" d="M5330.11,-2211.57C5330.27,-2185.51 5330.57,-2137.13 5330.78,-2103.75"/>
<polygon fill="black" stroke="black" points="5334.28,-2103.5 5330.84,-2093.48 5327.28,-2103.46 5334.28,-2103.5"/>
</g>
<!-- expert0_7_2&#45;&gt;combine0 -->
<g id="edge69" class="edge">
<title>expert0_7_2&#45;&gt;combine0</title>
<path fill="none" stroke="black" d="M5374.3,-2040.29C5415.88,-2015.76 5480.13,-1977.85 5533.95,-1946.09"/>
<polygon fill="black" stroke="black" points="5536.01,-1948.95 5542.84,-1940.85 5532.45,-1942.92 5536.01,-1948.95"/>
</g>
<!-- gate0 -->
<g id="node51" class="node">
<title>gate0</title>
<polygon fill="lightcoral" stroke="lightcoral" points="6072,-1955.84 5884,-1887.84 6072,-1819.84 6260,-1887.84 6072,-1955.84"/>
<text text-anchor="middle" x="6072" y="-1906.64" font-family="Times,serif" font-size="14.00">Gate</text>
<text text-anchor="middle" x="6072" y="-1891.64" font-family="Times,serif" font-size="14.00">Compute routing scores</text>
<text text-anchor="middle" x="6072" y="-1876.64" font-family="Times,serif" font-size="14.00">Input: [B, L/P, d_model]</text>
<text text-anchor="middle" x="6072" y="-1861.64" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
</g>
<!-- select0 -->
<g id="node52" class="node">
<title>select0</title>
<polygon fill="lightcoral" stroke="lightcoral" points="6260.13,-1767.84 5987.9,-1767.84 5917.87,-1691.84 6190.1,-1691.84 6260.13,-1767.84"/>
<text text-anchor="middle" x="6089" y="-1733.64" font-family="Times,serif" font-size="14.00">Select Top&#45;2 Experts</text>
<text text-anchor="middle" x="6089" y="-1718.64" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
</g>
<!-- gate0&#45;&gt;select0 -->
<g id="edge37" class="edge">
<title>gate0&#45;&gt;select0</title>
<path fill="none" stroke="black" d="M6079.06,-1822.03C6080.66,-1807.36 6082.33,-1792.04 6083.83,-1778.24"/>
<polygon fill="black" stroke="black" points="6087.34,-1778.34 6084.95,-1768.02 6080.39,-1777.58 6087.34,-1778.34"/>
</g>
<!-- select0&#45;&gt;expert0_0_1 -->
<g id="edge38" class="edge">
<title>select0&#45;&gt;expert0_0_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M6257.3,-1767.9C6273.86,-1776.65 6289.23,-1787.47 6302,-1800.84 6329.42,-1829.53 6326,-1847.15 6326,-1886.84 6326,-2231.84 6326,-2231.84 6326,-2231.84 6326,-2276.78 6288.29,-2312.51 6253.33,-2335.96"/>
<polygon fill="black" stroke="black" points="6251.02,-2333.29 6244.53,-2341.66 6254.82,-2339.17 6251.02,-2333.29"/>
<text text-anchor="middle" x="6363" y="-2063.14" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- select0&#45;&gt;expert0_1_1 -->
<g id="edge42" class="edge">
<title>select0&#45;&gt;expert0_1_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5960.16,-1738.08C5767.85,-1750.23 5424.21,-1777.61 5387,-1819.84 5337.93,-1875.52 5337.22,-1931.79 5387,-1986.84 5427.15,-2031.23 5614.85,-1969.44 5655,-2013.84 5700.12,-2063.73 5659.11,-2258.09 5623,-2314.84 5618.12,-2322.5 5611.69,-2329.42 5604.67,-2335.52"/>
<polygon fill="black" stroke="black" points="5602.46,-2332.81 5596.88,-2341.82 5606.86,-2338.26 5602.46,-2332.81"/>
<text text-anchor="middle" x="5711" y="-2063.14" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- select0&#45;&gt;expert0_2_1 -->
<g id="edge46" class="edge">
<title>select0&#45;&gt;expert0_2_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M6237.33,-1742.98C6402.94,-1760.74 6648,-1801.45 6648,-1886.84 6648,-2231.84 6648,-2231.84 6648,-2231.84 6648,-2276.78 6610.29,-2312.51 6575.33,-2335.96"/>
<polygon fill="black" stroke="black" points="6573.02,-2333.29 6566.53,-2341.66 6576.82,-2339.17 6573.02,-2333.29"/>
<text text-anchor="middle" x="6685" y="-2063.14" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- select0&#45;&gt;expert0_3_1 -->
<g id="edge50" class="edge">
<title>select0&#45;&gt;expert0_3_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M6229.65,-1734.62C6547.15,-1745.04 7292,-1780.78 7292,-1886.84 7292,-2231.84 7292,-2231.84 7292,-2231.84 7292,-2276.78 7254.29,-2312.51 7219.33,-2335.96"/>
<polygon fill="black" stroke="black" points="7217.02,-2333.29 7210.53,-2341.66 7220.82,-2339.17 7217.02,-2333.29"/>
<text text-anchor="middle" x="7329" y="-2063.14" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- select0&#45;&gt;expert0_4_1 -->
<g id="edge54" class="edge">
<title>select0&#45;&gt;expert0_4_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M6236.46,-1742.05C6487.26,-1763.13 6970,-1813.25 6970,-1886.84 6970,-2231.84 6970,-2231.84 6970,-2231.84 6970,-2276.78 6932.29,-2312.51 6897.33,-2335.96"/>
<polygon fill="black" stroke="black" points="6895.02,-2333.29 6888.53,-2341.66 6898.82,-2339.17 6895.02,-2333.29"/>
<text text-anchor="middle" x="7007" y="-2063.14" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- select0&#45;&gt;expert0_5_1 -->
<g id="edge58" class="edge">
<title>select0&#45;&gt;expert0_5_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M6211.02,-1768.09C6234.04,-1780.79 6255.2,-1797.63 6269,-1819.84 6308.16,-1882.89 6318.69,-1931.7 6269,-1986.84 6230.26,-2029.82 6053.08,-1975.2 6010,-2013.84 5997.26,-2025.26 5954.33,-2300.5 5945,-2314.84 5940.04,-2322.46 5933.57,-2329.34 5926.54,-2335.43"/>
<polygon fill="black" stroke="black" points="5924.32,-2332.72 5918.73,-2341.72 5928.71,-2338.17 5924.32,-2332.72"/>
<text text-anchor="middle" x="6047" y="-2063.14" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- select0&#45;&gt;expert0_6_1 -->
<g id="edge62" class="edge">
<title>select0&#45;&gt;expert0_6_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5956.19,-1733.44C5630.77,-1741.59 4820,-1773.28 4820,-1886.84 4820,-2231.84 4820,-2231.84 4820,-2231.84 4820,-2282.86 4866.22,-2316.64 4912.7,-2337.71"/>
<polygon fill="black" stroke="black" points="4911.42,-2340.97 4921.98,-2341.76 4914.21,-2334.55 4911.42,-2340.97"/>
<text text-anchor="middle" x="4857" y="-2063.14" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- select0&#45;&gt;expert0_7_1 -->
<g id="edge66" class="edge">
<title>select0&#45;&gt;expert0_7_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5960.79,-1738.83C5702.08,-1756.69 5142,-1804.83 5142,-1886.84 5142,-2231.84 5142,-2231.84 5142,-2231.84 5142,-2282.86 5188.22,-2316.64 5234.7,-2337.71"/>
<polygon fill="black" stroke="black" points="5233.42,-2340.97 5243.98,-2341.76 5236.21,-2334.55 5233.42,-2340.97"/>
<text text-anchor="middle" x="5179" y="-2063.14" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- res_moe0 -->
<g id="node56" class="node">
<title>res_moe0</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4785.88,-1782.84 4485.42,-1782.84 4408.12,-1676.84 4708.58,-1676.84 4785.88,-1782.84"/>
<text text-anchor="middle" x="4597" y="-1741.14" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="4597" y="-1726.14" font-family="Times,serif" font-size="14.00">Input: [B, L/P, d_model]</text>
<text text-anchor="middle" x="4597" y="-1711.14" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
</g>
<!-- combine0&#45;&gt;res_moe0 -->
<g id="edge70" class="edge">
<title>combine0&#45;&gt;res_moe0</title>
<path fill="none" stroke="black" d="M5412.98,-1853.94C5223.99,-1825.43 4953.78,-1784.66 4776.9,-1757.98"/>
<polygon fill="black" stroke="black" points="4777.38,-1754.51 4766.97,-1756.48 4776.34,-1761.43 4777.38,-1754.51"/>
</g>
<!-- split0&#45;&gt;qkv0_0 -->
<g id="edge2" class="edge">
<title>split0&#45;&gt;qkv0_0</title>
<path fill="none" stroke="black" d="M4439.14,-2064.01C4227.33,-2059.41 3815.84,-2043.27 3683,-1986.84 3649.65,-1972.67 3619.08,-1944.83 3598.17,-1922.43"/>
<polygon fill="black" stroke="black" points="3600.51,-1919.8 3591.19,-1914.76 3595.34,-1924.51 3600.51,-1919.8"/>
</g>
<!-- split0&#45;&gt;qkv0_1 -->
<g id="edge6" class="edge">
<title>split0&#45;&gt;qkv0_1</title>
<path fill="none" stroke="black" d="M4435.98,-2059.16C4271.38,-2049.27 4000.53,-2027.37 3909,-1986.84 3875.87,-1972.16 3845.28,-1944.37 3824.31,-1922.12"/>
<polygon fill="black" stroke="black" points="3826.65,-1919.49 3817.3,-1914.51 3821.5,-1924.23 3826.65,-1919.49"/>
</g>
<!-- split0&#45;&gt;qkv0_2 -->
<g id="edge10" class="edge">
<title>split0&#45;&gt;qkv0_2</title>
<path fill="none" stroke="black" d="M4436.45,-2059.95C4347.61,-2051.71 4229.73,-2032.3 4135,-1986.84 4102.54,-1971.26 4072.09,-1943.81 4051,-1921.91"/>
<polygon fill="black" stroke="black" points="4053.35,-1919.3 4043.94,-1914.43 4048.26,-1924.11 4053.35,-1919.3"/>
</g>
<!-- split0&#45;&gt;qkv0_3 -->
<g id="edge14" class="edge">
<title>split0&#45;&gt;qkv0_3</title>
<path fill="none" stroke="black" d="M4448.37,-2013.79C4430.59,-2005.23 4412.65,-1996.1 4396,-1986.84 4359.6,-1966.59 4320.38,-1940.4 4291.47,-1920.19"/>
<polygon fill="black" stroke="black" points="4293.41,-1917.28 4283.22,-1914.4 4289.39,-1923.01 4293.41,-1917.28"/>
</g>
<!-- split0&#45;&gt;qkv0_4 -->
<g id="edge18" class="edge">
<title>split0&#45;&gt;qkv0_4</title>
<path fill="none" stroke="black" d="M4439.49,-2065.03C4055.18,-2061.94 2931.84,-2047.75 2779,-1986.84 2744.97,-1973.27 2714.14,-1944.91 2693.31,-1922.16"/>
<polygon fill="black" stroke="black" points="2695.91,-1919.82 2686.64,-1914.7 2690.69,-1924.49 2695.91,-1919.82"/>
</g>
<!-- split0&#45;&gt;qkv0_5 -->
<g id="edge22" class="edge">
<title>split0&#45;&gt;qkv0_5</title>
<path fill="none" stroke="black" d="M4439.16,-2064.13C4088.83,-2058.82 3136.27,-2039.64 3005,-1986.84 2971.02,-1973.17 2940.18,-1944.81 2919.33,-1922.1"/>
<polygon fill="black" stroke="black" points="2921.94,-1919.76 2912.66,-1914.64 2916.72,-1924.43 2921.94,-1919.76"/>
</g>
<!-- split0&#45;&gt;qkv0_6 -->
<g id="edge26" class="edge">
<title>split0&#45;&gt;qkv0_6</title>
<path fill="none" stroke="black" d="M4438.22,-2062.91C4124.15,-2055.16 3340.8,-2031.55 3231,-1986.84 3197.08,-1973.02 3166.23,-1944.68 3145.37,-1922.01"/>
<polygon fill="black" stroke="black" points="3147.97,-1919.67 3138.69,-1914.57 3142.76,-1924.35 3147.97,-1919.67"/>
</g>
<!-- split0&#45;&gt;qkv0_7 -->
<g id="edge30" class="edge">
<title>split0&#45;&gt;qkv0_7</title>
<path fill="none" stroke="black" d="M4440.44,-2066.81C4187.47,-2067.1 3631.63,-2059.17 3457,-1986.84 3423.31,-1972.88 3392.57,-1944.74 3371.69,-1922.18"/>
<polygon fill="black" stroke="black" points="3374.03,-1919.55 3364.73,-1914.47 3368.83,-1924.24 3374.03,-1919.55"/>
</g>
<!-- split0&#45;&gt;res0 -->
<g id="edge35" class="edge">
<title>split0&#45;&gt;res0</title>
<path fill="none" stroke="black" d="M4576.54,-2013.69C4579.77,-1993.97 4583.48,-1971.34 4586.85,-1950.81"/>
<polygon fill="black" stroke="black" points="4590.3,-1951.35 4588.47,-1940.92 4583.4,-1950.22 4590.3,-1951.35"/>
</g>
<!-- res0&#45;&gt;gate0 -->
<g id="edge36" class="edge">
<title>res0&#45;&gt;gate0</title>
<path fill="none" stroke="black" d="M4770.56,-1919.53C4931.31,-1947.18 5177.38,-1985.17 5393,-2000.34 5497.85,-2007.71 5764.15,-2026.33 5866,-2000.34 5913.52,-1988.21 5961.89,-1962.62 5999.8,-1938.91"/>
<polygon fill="black" stroke="black" points="6002.15,-1941.56 6008.72,-1933.25 5998.4,-1935.65 6002.15,-1941.56"/>
</g>
<!-- res0&#45;&gt;res_moe0 -->
<g id="edge71" class="edge">
<title>res0&#45;&gt;res_moe0</title>
<path fill="none" stroke="black" d="M4597,-1834.46C4597,-1821.27 4597,-1806.98 4597,-1793.35"/>
<polygon fill="black" stroke="black" points="4600.5,-1793.08 4597,-1783.08 4593.5,-1793.08 4600.5,-1793.08"/>
</g>
<!-- send_stage0 -->
<g id="node57" class="node">
<title>send_stage0</title>
<ellipse fill="lightcoral" stroke="lightcoral" cx="4624" cy="-1602.36" rx="108.79" ry="37.45"/>
<text text-anchor="middle" x="4624" y="-1613.66" font-family="Times,serif" font-size="14.00">Send to Stage 1</text>
<text text-anchor="middle" x="4624" y="-1598.66" font-family="Times,serif" font-size="14.00">X: [B, L/P, d_model]</text>
<text text-anchor="middle" x="4624" y="-1583.66" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7 → 8&#45;15</text>
</g>
<!-- res_moe0&#45;&gt;send_stage0 -->
<g id="edge72" class="edge">
<title>res_moe0&#45;&gt;send_stage0</title>
<path fill="none" stroke="black" d="M4608.22,-1676.71C4610.13,-1667.81 4612.11,-1658.61 4613.99,-1649.86"/>
<polygon fill="black" stroke="black" points="4617.47,-1650.36 4616.15,-1639.85 4610.62,-1648.89 4617.47,-1650.36"/>
</g>
<!-- recv_stage1 -->
<g id="node110" class="node">
<title>recv_stage1</title>
<ellipse fill="lightcoral" stroke="lightcoral" cx="4634" cy="-1469.41" rx="120.42" ry="37.45"/>
<text text-anchor="middle" x="4634" y="-1480.71" font-family="Times,serif" font-size="14.00">Receive from Stage 0</text>
<text text-anchor="middle" x="4634" y="-1465.71" font-family="Times,serif" font-size="14.00">X: [B, L/P, d_model]</text>
<text text-anchor="middle" x="4634" y="-1450.71" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15</text>
</g>
<!-- send_stage0&#45;&gt;recv_stage1 -->
<g id="edge73" class="edge">
<title>send_stage0&#45;&gt;recv_stage1</title>
<path fill="none" stroke="black" d="M4626.79,-1564.88C4627.91,-1550.11 4629.23,-1532.86 4630.43,-1517.18"/>
<polygon fill="black" stroke="black" points="4633.92,-1517.38 4631.19,-1507.14 4626.94,-1516.85 4633.92,-1517.38"/>
</g>
<!-- qkv2_8 -->
<g id="node58" class="node">
<title>qkv2_8</title>
<polygon fill="lightcoral" stroke="lightcoral" points="7499,-1332.43 7291,-1332.43 7291,-1279.43 7499,-1279.43 7499,-1332.43"/>
<text text-anchor="middle" x="7395" y="-1317.23" font-family="Times,serif" font-size="14.00">QKV Projection 8</text>
<text text-anchor="middle" x="7395" y="-1302.23" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="7395" y="-1287.23" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- attn2_8 -->
<g id="node66" class="node">
<title>attn2_8</title>
<polygon fill="lightcoral" stroke="lightcoral" points="7499,-1174.43 7291,-1174.43 7291,-1121.43 7499,-1121.43 7499,-1174.43"/>
<text text-anchor="middle" x="7395" y="-1159.23" font-family="Times,serif" font-size="14.00">Attention 8</text>
<text text-anchor="middle" x="7395" y="-1144.23" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="7395" y="-1129.23" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- qkv2_8&#45;&gt;attn2_8 -->
<g id="edge75" class="edge">
<title>qkv2_8&#45;&gt;attn2_8</title>
<path fill="none" stroke="black" d="M7395,-1279.17C7395,-1253.35 7395,-1213.4 7395,-1184.55"/>
<polygon fill="black" stroke="black" points="7398.5,-1184.47 7395,-1174.47 7391.5,-1184.47 7398.5,-1184.47"/>
</g>
<!-- qkv2_9 -->
<g id="node59" class="node">
<title>qkv2_9</title>
<polygon fill="lightcoral" stroke="lightcoral" points="7725,-1332.43 7517,-1332.43 7517,-1279.43 7725,-1279.43 7725,-1332.43"/>
<text text-anchor="middle" x="7621" y="-1317.23" font-family="Times,serif" font-size="14.00">QKV Projection 9</text>
<text text-anchor="middle" x="7621" y="-1302.23" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="7621" y="-1287.23" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- attn2_9 -->
<g id="node67" class="node">
<title>attn2_9</title>
<polygon fill="lightcoral" stroke="lightcoral" points="7725,-1174.43 7517,-1174.43 7517,-1121.43 7725,-1121.43 7725,-1174.43"/>
<text text-anchor="middle" x="7621" y="-1159.23" font-family="Times,serif" font-size="14.00">Attention 9</text>
<text text-anchor="middle" x="7621" y="-1144.23" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="7621" y="-1129.23" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- qkv2_9&#45;&gt;attn2_9 -->
<g id="edge79" class="edge">
<title>qkv2_9&#45;&gt;attn2_9</title>
<path fill="none" stroke="black" d="M7621,-1279.17C7621,-1253.35 7621,-1213.4 7621,-1184.55"/>
<polygon fill="black" stroke="black" points="7624.5,-1184.47 7621,-1174.47 7617.5,-1184.47 7624.5,-1184.47"/>
</g>
<!-- qkv2_10 -->
<g id="node60" class="node">
<title>qkv2_10</title>
<polygon fill="lightcoral" stroke="lightcoral" points="7951,-1332.43 7743,-1332.43 7743,-1279.43 7951,-1279.43 7951,-1332.43"/>
<text text-anchor="middle" x="7847" y="-1317.23" font-family="Times,serif" font-size="14.00">QKV Projection 10</text>
<text text-anchor="middle" x="7847" y="-1302.23" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="7847" y="-1287.23" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- attn2_10 -->
<g id="node68" class="node">
<title>attn2_10</title>
<polygon fill="lightcoral" stroke="lightcoral" points="7951,-1174.43 7743,-1174.43 7743,-1121.43 7951,-1121.43 7951,-1174.43"/>
<text text-anchor="middle" x="7847" y="-1159.23" font-family="Times,serif" font-size="14.00">Attention 10</text>
<text text-anchor="middle" x="7847" y="-1144.23" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="7847" y="-1129.23" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- qkv2_10&#45;&gt;attn2_10 -->
<g id="edge83" class="edge">
<title>qkv2_10&#45;&gt;attn2_10</title>
<path fill="none" stroke="black" d="M7847,-1279.17C7847,-1253.35 7847,-1213.4 7847,-1184.55"/>
<polygon fill="black" stroke="black" points="7850.5,-1184.47 7847,-1174.47 7843.5,-1184.47 7850.5,-1184.47"/>
</g>
<!-- qkv2_11 -->
<g id="node61" class="node">
<title>qkv2_11</title>
<polygon fill="lightcoral" stroke="lightcoral" points="6369,-1332.43 6161,-1332.43 6161,-1279.43 6369,-1279.43 6369,-1332.43"/>
<text text-anchor="middle" x="6265" y="-1317.23" font-family="Times,serif" font-size="14.00">QKV Projection 11</text>
<text text-anchor="middle" x="6265" y="-1302.23" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="6265" y="-1287.23" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- attn2_11 -->
<g id="node69" class="node">
<title>attn2_11</title>
<polygon fill="lightcoral" stroke="lightcoral" points="6369,-1174.43 6161,-1174.43 6161,-1121.43 6369,-1121.43 6369,-1174.43"/>
<text text-anchor="middle" x="6265" y="-1159.23" font-family="Times,serif" font-size="14.00">Attention 11</text>
<text text-anchor="middle" x="6265" y="-1144.23" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="6265" y="-1129.23" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- qkv2_11&#45;&gt;attn2_11 -->
<g id="edge87" class="edge">
<title>qkv2_11&#45;&gt;attn2_11</title>
<path fill="none" stroke="black" d="M6265,-1279.17C6265,-1253.35 6265,-1213.4 6265,-1184.55"/>
<polygon fill="black" stroke="black" points="6268.5,-1184.47 6265,-1174.47 6261.5,-1184.47 6268.5,-1184.47"/>
</g>
<!-- qkv2_12 -->
<g id="node62" class="node">
<title>qkv2_12</title>
<polygon fill="lightcoral" stroke="lightcoral" points="6595,-1332.43 6387,-1332.43 6387,-1279.43 6595,-1279.43 6595,-1332.43"/>
<text text-anchor="middle" x="6491" y="-1317.23" font-family="Times,serif" font-size="14.00">QKV Projection 12</text>
<text text-anchor="middle" x="6491" y="-1302.23" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="6491" y="-1287.23" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- attn2_12 -->
<g id="node70" class="node">
<title>attn2_12</title>
<polygon fill="lightcoral" stroke="lightcoral" points="6595,-1174.43 6387,-1174.43 6387,-1121.43 6595,-1121.43 6595,-1174.43"/>
<text text-anchor="middle" x="6491" y="-1159.23" font-family="Times,serif" font-size="14.00">Attention 12</text>
<text text-anchor="middle" x="6491" y="-1144.23" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="6491" y="-1129.23" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- qkv2_12&#45;&gt;attn2_12 -->
<g id="edge91" class="edge">
<title>qkv2_12&#45;&gt;attn2_12</title>
<path fill="none" stroke="black" d="M6491,-1279.17C6491,-1253.35 6491,-1213.4 6491,-1184.55"/>
<polygon fill="black" stroke="black" points="6494.5,-1184.47 6491,-1174.47 6487.5,-1184.47 6494.5,-1184.47"/>
</g>
<!-- qkv2_13 -->
<g id="node63" class="node">
<title>qkv2_13</title>
<polygon fill="lightcoral" stroke="lightcoral" points="6821,-1332.43 6613,-1332.43 6613,-1279.43 6821,-1279.43 6821,-1332.43"/>
<text text-anchor="middle" x="6717" y="-1317.23" font-family="Times,serif" font-size="14.00">QKV Projection 13</text>
<text text-anchor="middle" x="6717" y="-1302.23" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="6717" y="-1287.23" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- attn2_13 -->
<g id="node71" class="node">
<title>attn2_13</title>
<polygon fill="lightcoral" stroke="lightcoral" points="6821,-1174.43 6613,-1174.43 6613,-1121.43 6821,-1121.43 6821,-1174.43"/>
<text text-anchor="middle" x="6717" y="-1159.23" font-family="Times,serif" font-size="14.00">Attention 13</text>
<text text-anchor="middle" x="6717" y="-1144.23" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="6717" y="-1129.23" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- qkv2_13&#45;&gt;attn2_13 -->
<g id="edge95" class="edge">
<title>qkv2_13&#45;&gt;attn2_13</title>
<path fill="none" stroke="black" d="M6717,-1279.17C6717,-1253.35 6717,-1213.4 6717,-1184.55"/>
<polygon fill="black" stroke="black" points="6720.5,-1184.47 6717,-1174.47 6713.5,-1184.47 6720.5,-1184.47"/>
</g>
<!-- qkv2_14 -->
<g id="node64" class="node">
<title>qkv2_14</title>
<polygon fill="lightcoral" stroke="lightcoral" points="7047,-1332.43 6839,-1332.43 6839,-1279.43 7047,-1279.43 7047,-1332.43"/>
<text text-anchor="middle" x="6943" y="-1317.23" font-family="Times,serif" font-size="14.00">QKV Projection 14</text>
<text text-anchor="middle" x="6943" y="-1302.23" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="6943" y="-1287.23" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- attn2_14 -->
<g id="node72" class="node">
<title>attn2_14</title>
<polygon fill="lightcoral" stroke="lightcoral" points="7047,-1174.43 6839,-1174.43 6839,-1121.43 7047,-1121.43 7047,-1174.43"/>
<text text-anchor="middle" x="6943" y="-1159.23" font-family="Times,serif" font-size="14.00">Attention 14</text>
<text text-anchor="middle" x="6943" y="-1144.23" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="6943" y="-1129.23" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- qkv2_14&#45;&gt;attn2_14 -->
<g id="edge99" class="edge">
<title>qkv2_14&#45;&gt;attn2_14</title>
<path fill="none" stroke="black" d="M6943,-1279.17C6943,-1253.35 6943,-1213.4 6943,-1184.55"/>
<polygon fill="black" stroke="black" points="6946.5,-1184.47 6943,-1174.47 6939.5,-1184.47 6946.5,-1184.47"/>
</g>
<!-- qkv2_15 -->
<g id="node65" class="node">
<title>qkv2_15</title>
<polygon fill="lightcoral" stroke="lightcoral" points="7273,-1332.43 7065,-1332.43 7065,-1279.43 7273,-1279.43 7273,-1332.43"/>
<text text-anchor="middle" x="7169" y="-1317.23" font-family="Times,serif" font-size="14.00">QKV Projection 15</text>
<text text-anchor="middle" x="7169" y="-1302.23" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="7169" y="-1287.23" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- attn2_15 -->
<g id="node73" class="node">
<title>attn2_15</title>
<polygon fill="lightcoral" stroke="lightcoral" points="7273,-1174.43 7065,-1174.43 7065,-1121.43 7273,-1121.43 7273,-1174.43"/>
<text text-anchor="middle" x="7169" y="-1159.23" font-family="Times,serif" font-size="14.00">Attention 15</text>
<text text-anchor="middle" x="7169" y="-1144.23" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="7169" y="-1129.23" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- qkv2_15&#45;&gt;attn2_15 -->
<g id="edge103" class="edge">
<title>qkv2_15&#45;&gt;attn2_15</title>
<path fill="none" stroke="black" d="M7169,-1279.17C7169,-1253.35 7169,-1213.4 7169,-1184.55"/>
<polygon fill="black" stroke="black" points="7172.5,-1184.47 7169,-1174.47 7165.5,-1184.47 7172.5,-1184.47"/>
</g>
<!-- out2_8 -->
<g id="node74" class="node">
<title>out2_8</title>
<polygon fill="lightcoral" stroke="lightcoral" points="7499,-1036.93 7291,-1036.93 7291,-983.93 7499,-983.93 7499,-1036.93"/>
<text text-anchor="middle" x="7395" y="-1021.73" font-family="Times,serif" font-size="14.00">Output Proj 8</text>
<text text-anchor="middle" x="7395" y="-1006.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="7395" y="-991.73" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- attn2_8&#45;&gt;out2_8 -->
<g id="edge76" class="edge">
<title>attn2_8&#45;&gt;out2_8</title>
<path fill="none" stroke="black" d="M7395,-1121.12C7395,-1100.22 7395,-1070.52 7395,-1047.3"/>
<polygon fill="black" stroke="black" points="7398.5,-1047.14 7395,-1037.14 7391.5,-1047.14 7398.5,-1047.14"/>
</g>
<!-- out2_9 -->
<g id="node75" class="node">
<title>out2_9</title>
<polygon fill="lightcoral" stroke="lightcoral" points="7725,-1036.93 7517,-1036.93 7517,-983.93 7725,-983.93 7725,-1036.93"/>
<text text-anchor="middle" x="7621" y="-1021.73" font-family="Times,serif" font-size="14.00">Output Proj 9</text>
<text text-anchor="middle" x="7621" y="-1006.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="7621" y="-991.73" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- attn2_9&#45;&gt;out2_9 -->
<g id="edge80" class="edge">
<title>attn2_9&#45;&gt;out2_9</title>
<path fill="none" stroke="black" d="M7621,-1121.12C7621,-1100.22 7621,-1070.52 7621,-1047.3"/>
<polygon fill="black" stroke="black" points="7624.5,-1047.14 7621,-1037.14 7617.5,-1047.14 7624.5,-1047.14"/>
</g>
<!-- out2_10 -->
<g id="node76" class="node">
<title>out2_10</title>
<polygon fill="lightcoral" stroke="lightcoral" points="7951,-1036.93 7743,-1036.93 7743,-983.93 7951,-983.93 7951,-1036.93"/>
<text text-anchor="middle" x="7847" y="-1021.73" font-family="Times,serif" font-size="14.00">Output Proj 10</text>
<text text-anchor="middle" x="7847" y="-1006.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="7847" y="-991.73" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- attn2_10&#45;&gt;out2_10 -->
<g id="edge84" class="edge">
<title>attn2_10&#45;&gt;out2_10</title>
<path fill="none" stroke="black" d="M7847,-1121.12C7847,-1100.22 7847,-1070.52 7847,-1047.3"/>
<polygon fill="black" stroke="black" points="7850.5,-1047.14 7847,-1037.14 7843.5,-1047.14 7850.5,-1047.14"/>
</g>
<!-- out2_11 -->
<g id="node77" class="node">
<title>out2_11</title>
<polygon fill="lightcoral" stroke="lightcoral" points="6369,-1036.93 6161,-1036.93 6161,-983.93 6369,-983.93 6369,-1036.93"/>
<text text-anchor="middle" x="6265" y="-1021.73" font-family="Times,serif" font-size="14.00">Output Proj 11</text>
<text text-anchor="middle" x="6265" y="-1006.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="6265" y="-991.73" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- attn2_11&#45;&gt;out2_11 -->
<g id="edge88" class="edge">
<title>attn2_11&#45;&gt;out2_11</title>
<path fill="none" stroke="black" d="M6265,-1121.12C6265,-1100.22 6265,-1070.52 6265,-1047.3"/>
<polygon fill="black" stroke="black" points="6268.5,-1047.14 6265,-1037.14 6261.5,-1047.14 6268.5,-1047.14"/>
</g>
<!-- out2_12 -->
<g id="node78" class="node">
<title>out2_12</title>
<polygon fill="lightcoral" stroke="lightcoral" points="6595,-1036.93 6387,-1036.93 6387,-983.93 6595,-983.93 6595,-1036.93"/>
<text text-anchor="middle" x="6491" y="-1021.73" font-family="Times,serif" font-size="14.00">Output Proj 12</text>
<text text-anchor="middle" x="6491" y="-1006.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="6491" y="-991.73" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- attn2_12&#45;&gt;out2_12 -->
<g id="edge92" class="edge">
<title>attn2_12&#45;&gt;out2_12</title>
<path fill="none" stroke="black" d="M6491,-1121.12C6491,-1100.22 6491,-1070.52 6491,-1047.3"/>
<polygon fill="black" stroke="black" points="6494.5,-1047.14 6491,-1037.14 6487.5,-1047.14 6494.5,-1047.14"/>
</g>
<!-- out2_13 -->
<g id="node79" class="node">
<title>out2_13</title>
<polygon fill="lightcoral" stroke="lightcoral" points="6821,-1036.93 6613,-1036.93 6613,-983.93 6821,-983.93 6821,-1036.93"/>
<text text-anchor="middle" x="6717" y="-1021.73" font-family="Times,serif" font-size="14.00">Output Proj 13</text>
<text text-anchor="middle" x="6717" y="-1006.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="6717" y="-991.73" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- attn2_13&#45;&gt;out2_13 -->
<g id="edge96" class="edge">
<title>attn2_13&#45;&gt;out2_13</title>
<path fill="none" stroke="black" d="M6717,-1121.12C6717,-1100.22 6717,-1070.52 6717,-1047.3"/>
<polygon fill="black" stroke="black" points="6720.5,-1047.14 6717,-1037.14 6713.5,-1047.14 6720.5,-1047.14"/>
</g>
<!-- out2_14 -->
<g id="node80" class="node">
<title>out2_14</title>
<polygon fill="lightcoral" stroke="lightcoral" points="7047,-1036.93 6839,-1036.93 6839,-983.93 7047,-983.93 7047,-1036.93"/>
<text text-anchor="middle" x="6943" y="-1021.73" font-family="Times,serif" font-size="14.00">Output Proj 14</text>
<text text-anchor="middle" x="6943" y="-1006.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="6943" y="-991.73" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- attn2_14&#45;&gt;out2_14 -->
<g id="edge100" class="edge">
<title>attn2_14&#45;&gt;out2_14</title>
<path fill="none" stroke="black" d="M6943,-1121.12C6943,-1100.22 6943,-1070.52 6943,-1047.3"/>
<polygon fill="black" stroke="black" points="6946.5,-1047.14 6943,-1037.14 6939.5,-1047.14 6946.5,-1047.14"/>
</g>
<!-- out2_15 -->
<g id="node81" class="node">
<title>out2_15</title>
<polygon fill="lightcoral" stroke="lightcoral" points="7273,-1036.93 7065,-1036.93 7065,-983.93 7273,-983.93 7273,-1036.93"/>
<text text-anchor="middle" x="7169" y="-1021.73" font-family="Times,serif" font-size="14.00">Output Proj 15</text>
<text text-anchor="middle" x="7169" y="-1006.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="7169" y="-991.73" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- attn2_15&#45;&gt;out2_15 -->
<g id="edge104" class="edge">
<title>attn2_15&#45;&gt;out2_15</title>
<path fill="none" stroke="black" d="M7169,-1121.12C7169,-1100.22 7169,-1070.52 7169,-1047.3"/>
<polygon fill="black" stroke="black" points="7172.5,-1047.14 7169,-1037.14 7165.5,-1047.14 7172.5,-1047.14"/>
</g>
<!-- ar2 -->
<g id="node82" class="node">
<title>ar2</title>
<ellipse fill="lightcoral" stroke="lightcoral" cx="6943" cy="-899.43" rx="111.03" ry="37.45"/>
<text text-anchor="middle" x="6943" y="-910.73" font-family="Times,serif" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="6943" y="-895.73" font-family="Times,serif" font-size="14.00">Sum across 8 GPUs</text>
<text text-anchor="middle" x="6943" y="-880.73" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15</text>
</g>
<!-- out2_8&#45;&gt;ar2 -->
<g id="edge77" class="edge">
<title>out2_8&#45;&gt;ar2</title>
<path fill="none" stroke="black" d="M7290.73,-984.29C7215.88,-966.24 7115.63,-942.06 7042.01,-924.31"/>
<polygon fill="black" stroke="black" points="7042.8,-920.9 7032.25,-921.95 7041.16,-927.7 7042.8,-920.9"/>
</g>
<!-- out2_9&#45;&gt;ar2 -->
<g id="edge81" class="edge">
<title>out2_9&#45;&gt;ar2</title>
<path fill="none" stroke="black" d="M7516.7,-985.59C7513.77,-985.02 7510.87,-984.46 7508,-983.93 7352.23,-954.89 7170.78,-929.57 7056.4,-914.64"/>
<polygon fill="black" stroke="black" points="7056.6,-911.13 7046.23,-913.31 7055.69,-918.08 7056.6,-911.13"/>
</g>
<!-- out2_10&#45;&gt;ar2 -->
<g id="edge85" class="edge">
<title>out2_10&#45;&gt;ar2</title>
<path fill="none" stroke="black" d="M7742.73,-985.43C7739.79,-984.91 7736.88,-984.4 7734,-983.93 7496.86,-944.79 7216.53,-920.28 7061.37,-908.59"/>
<polygon fill="black" stroke="black" points="7061.56,-905.09 7051.33,-907.84 7061.04,-912.08 7061.56,-905.09"/>
</g>
<!-- out2_11&#45;&gt;ar2 -->
<g id="edge89" class="edge">
<title>out2_11&#45;&gt;ar2</title>
<path fill="none" stroke="black" d="M6369.3,-985.59C6372.23,-985.02 6375.13,-984.46 6378,-983.93 6533.77,-954.89 6715.22,-929.57 6829.6,-914.64"/>
<polygon fill="black" stroke="black" points="6830.31,-918.08 6839.77,-913.31 6829.4,-911.13 6830.31,-918.08"/>
</g>
<!-- out2_12&#45;&gt;ar2 -->
<g id="edge93" class="edge">
<title>out2_12&#45;&gt;ar2</title>
<path fill="none" stroke="black" d="M6595.27,-984.29C6670.12,-966.24 6770.37,-942.06 6843.99,-924.31"/>
<polygon fill="black" stroke="black" points="6844.84,-927.7 6853.75,-921.95 6843.2,-920.9 6844.84,-927.7"/>
</g>
<!-- out2_13&#45;&gt;ar2 -->
<g id="edge97" class="edge">
<title>out2_13&#45;&gt;ar2</title>
<path fill="none" stroke="black" d="M6769.99,-983.87C6800.28,-969.27 6838.67,-950.75 6871.59,-934.87"/>
<polygon fill="black" stroke="black" points="6873.24,-937.96 6880.72,-930.47 6870.2,-931.66 6873.24,-937.96"/>
</g>
<!-- out2_14&#45;&gt;ar2 -->
<g id="edge101" class="edge">
<title>out2_14&#45;&gt;ar2</title>
<path fill="none" stroke="black" d="M6943,-983.87C6943,-972.96 6943,-959.87 6943,-947.32"/>
<polygon fill="black" stroke="black" points="6946.5,-946.97 6943,-936.97 6939.5,-946.97 6946.5,-946.97"/>
</g>
<!-- out2_15&#45;&gt;ar2 -->
<g id="edge105" class="edge">
<title>out2_15&#45;&gt;ar2</title>
<path fill="none" stroke="black" d="M7116.01,-983.87C7085.72,-969.27 7047.33,-950.75 7014.41,-934.87"/>
<polygon fill="black" stroke="black" points="7015.8,-931.66 7005.28,-930.47 7012.76,-937.96 7015.8,-931.66"/>
</g>
<!-- res2 -->
<g id="node111" class="node">
<title>res2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4753.88,-1358.93 4453.42,-1358.93 4376.12,-1252.93 4676.58,-1252.93 4753.88,-1358.93"/>
<text text-anchor="middle" x="4565" y="-1317.23" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="4565" y="-1302.23" font-family="Times,serif" font-size="14.00">Input: [B, L/P, d_model]</text>
<text text-anchor="middle" x="4565" y="-1287.23" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15</text>
</g>
<!-- ar2&#45;&gt;res2 -->
<g id="edge106" class="edge">
<title>ar2&#45;&gt;res2</title>
<path fill="none" stroke="black" d="M6835.11,-908.57C6682.46,-920.83 6394.95,-946.62 6152,-983.93 5611.84,-1066.88 4976.85,-1208.97 4702.58,-1272.53"/>
<polygon fill="black" stroke="black" points="4701.53,-1269.18 4692.58,-1274.85 4703.11,-1276 4701.53,-1269.18"/>
</g>
<!-- expert2_0_1 -->
<g id="node83" class="node">
<title>expert2_0_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="1247,-1756.34 1059,-1756.34 1059,-1703.34 1247,-1703.34 1247,-1756.34"/>
<text text-anchor="middle" x="1153" y="-1741.14" font-family="Times,serif" font-size="14.00">Expert 8 Linear1</text>
<text text-anchor="middle" x="1153" y="-1726.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="1153" y="-1711.14" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- expert2_0_act -->
<g id="node84" class="node">
<title>expert2_0_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="1216.5,-1621.36 1091.5,-1621.36 1091.5,-1583.36 1216.5,-1583.36 1216.5,-1621.36"/>
<text text-anchor="middle" x="1154" y="-1606.16" font-family="Times,serif" font-size="14.00">Expert 8 GELU</text>
<text text-anchor="middle" x="1154" y="-1591.16" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- expert2_0_1&#45;&gt;expert2_0_act -->
<g id="edge111" class="edge">
<title>expert2_0_1&#45;&gt;expert2_0_act</title>
<path fill="none" stroke="black" d="M1153.2,-1703.14C1153.37,-1682.41 1153.6,-1653.27 1153.77,-1631.83"/>
<polygon fill="black" stroke="black" points="1157.27,-1631.73 1153.85,-1621.7 1150.27,-1631.67 1157.27,-1631.73"/>
</g>
<!-- expert2_0_2 -->
<g id="node85" class="node">
<title>expert2_0_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="1252,-1495.91 1058,-1495.91 1058,-1442.91 1252,-1442.91 1252,-1495.91"/>
<text text-anchor="middle" x="1155" y="-1480.71" font-family="Times,serif" font-size="14.00">Expert 8 Linear2</text>
<text text-anchor="middle" x="1155" y="-1465.71" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="1155" y="-1450.71" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- expert2_0_act&#45;&gt;expert2_0_2 -->
<g id="edge112" class="edge">
<title>expert2_0_act&#45;&gt;expert2_0_2</title>
<path fill="none" stroke="black" d="M1154.14,-1583.15C1154.29,-1563.35 1154.54,-1531.2 1154.73,-1506.29"/>
<polygon fill="black" stroke="black" points="1158.23,-1506.14 1154.8,-1496.11 1151.23,-1506.09 1158.23,-1506.14"/>
</g>
<!-- combine2 -->
<g id="node109" class="node">
<title>combine2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="1896.19,-1358.93 1522.06,-1358.93 1425.81,-1252.93 1799.94,-1252.93 1896.19,-1358.93"/>
<text text-anchor="middle" x="1661" y="-1317.23" font-family="Times,serif" font-size="14.00">Combine Expert Outputs</text>
<text text-anchor="middle" x="1661" y="-1302.23" font-family="Times,serif" font-size="14.00">Weighted sum by gate scores</text>
<text text-anchor="middle" x="1661" y="-1287.23" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15</text>
</g>
<!-- expert2_0_2&#45;&gt;combine2 -->
<g id="edge113" class="edge">
<title>expert2_0_2&#45;&gt;combine2</title>
<path fill="none" stroke="black" d="M1210.82,-1442.81C1228.19,-1435.73 1247.61,-1428.69 1266,-1423.93 1331.48,-1406.99 1351.52,-1421.9 1417,-1404.93 1457.74,-1394.37 1500.78,-1378.71 1539.18,-1362.99"/>
<polygon fill="black" stroke="black" points="1540.93,-1366.05 1548.84,-1359 1538.26,-1359.58 1540.93,-1366.05"/>
</g>
<!-- expert2_1_1 -->
<g id="node86" class="node">
<title>expert2_1_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="281,-1756.34 93,-1756.34 93,-1703.34 281,-1703.34 281,-1756.34"/>
<text text-anchor="middle" x="187" y="-1741.14" font-family="Times,serif" font-size="14.00">Expert 9 Linear1</text>
<text text-anchor="middle" x="187" y="-1726.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="187" y="-1711.14" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- expert2_1_act -->
<g id="node87" class="node">
<title>expert2_1_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="250.5,-1621.36 125.5,-1621.36 125.5,-1583.36 250.5,-1583.36 250.5,-1621.36"/>
<text text-anchor="middle" x="188" y="-1606.16" font-family="Times,serif" font-size="14.00">Expert 9 GELU</text>
<text text-anchor="middle" x="188" y="-1591.16" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- expert2_1_1&#45;&gt;expert2_1_act -->
<g id="edge115" class="edge">
<title>expert2_1_1&#45;&gt;expert2_1_act</title>
<path fill="none" stroke="black" d="M187.2,-1703.14C187.37,-1682.41 187.6,-1653.27 187.77,-1631.83"/>
<polygon fill="black" stroke="black" points="191.27,-1631.73 187.85,-1621.7 184.27,-1631.67 191.27,-1631.73"/>
</g>
<!-- expert2_1_2 -->
<g id="node88" class="node">
<title>expert2_1_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="286,-1495.91 92,-1495.91 92,-1442.91 286,-1442.91 286,-1495.91"/>
<text text-anchor="middle" x="189" y="-1480.71" font-family="Times,serif" font-size="14.00">Expert 9 Linear2</text>
<text text-anchor="middle" x="189" y="-1465.71" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="189" y="-1450.71" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- expert2_1_act&#45;&gt;expert2_1_2 -->
<g id="edge116" class="edge">
<title>expert2_1_act&#45;&gt;expert2_1_2</title>
<path fill="none" stroke="black" d="M188.14,-1583.15C188.29,-1563.35 188.54,-1531.2 188.73,-1506.29"/>
<polygon fill="black" stroke="black" points="192.23,-1506.14 188.8,-1496.11 185.23,-1506.09 192.23,-1506.14"/>
</g>
<!-- expert2_1_2&#45;&gt;combine2 -->
<g id="edge117" class="edge">
<title>expert2_1_2&#45;&gt;combine2</title>
<path fill="none" stroke="black" d="M241.42,-1442.86C259.54,-1435.26 280.26,-1427.91 300,-1423.93 360.84,-1411.66 1356.17,-1417.23 1417,-1404.93 1460.69,-1396.1 1506.55,-1379.75 1546.57,-1362.9"/>
<polygon fill="black" stroke="black" points="1547.98,-1366.1 1555.81,-1358.95 1545.24,-1359.66 1547.98,-1366.1"/>
</g>
<!-- expert2_2_1 -->
<g id="node89" class="node">
<title>expert2_2_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="603,-1756.34 415,-1756.34 415,-1703.34 603,-1703.34 603,-1756.34"/>
<text text-anchor="middle" x="509" y="-1741.14" font-family="Times,serif" font-size="14.00">Expert 10 Linear1</text>
<text text-anchor="middle" x="509" y="-1726.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="509" y="-1711.14" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- expert2_2_act -->
<g id="node90" class="node">
<title>expert2_2_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="577,-1621.36 443,-1621.36 443,-1583.36 577,-1583.36 577,-1621.36"/>
<text text-anchor="middle" x="510" y="-1606.16" font-family="Times,serif" font-size="14.00">Expert 10 GELU</text>
<text text-anchor="middle" x="510" y="-1591.16" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- expert2_2_1&#45;&gt;expert2_2_act -->
<g id="edge119" class="edge">
<title>expert2_2_1&#45;&gt;expert2_2_act</title>
<path fill="none" stroke="black" d="M509.2,-1703.14C509.37,-1682.41 509.6,-1653.27 509.77,-1631.83"/>
<polygon fill="black" stroke="black" points="513.27,-1631.73 509.85,-1621.7 506.27,-1631.67 513.27,-1631.73"/>
</g>
<!-- expert2_2_2 -->
<g id="node91" class="node">
<title>expert2_2_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="608,-1495.91 414,-1495.91 414,-1442.91 608,-1442.91 608,-1495.91"/>
<text text-anchor="middle" x="511" y="-1480.71" font-family="Times,serif" font-size="14.00">Expert 10 Linear2</text>
<text text-anchor="middle" x="511" y="-1465.71" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="511" y="-1450.71" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- expert2_2_act&#45;&gt;expert2_2_2 -->
<g id="edge120" class="edge">
<title>expert2_2_act&#45;&gt;expert2_2_2</title>
<path fill="none" stroke="black" d="M510.14,-1583.15C510.29,-1563.35 510.54,-1531.2 510.73,-1506.29"/>
<polygon fill="black" stroke="black" points="514.23,-1506.14 510.8,-1496.11 507.23,-1506.09 514.23,-1506.14"/>
</g>
<!-- expert2_2_2&#45;&gt;combine2 -->
<g id="edge121" class="edge">
<title>expert2_2_2&#45;&gt;combine2</title>
<path fill="none" stroke="black" d="M563.43,-1442.87C581.55,-1435.28 602.26,-1427.93 622,-1423.93 708.6,-1406.4 1330.56,-1423.25 1417,-1404.93 1460.1,-1395.8 1505.38,-1379.62 1545.08,-1363.01"/>
<polygon fill="black" stroke="black" points="1546.67,-1366.14 1554.51,-1359.01 1543.94,-1359.69 1546.67,-1366.14"/>
</g>
<!-- expert2_3_1 -->
<g id="node92" class="node">
<title>expert2_3_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="925,-1756.34 737,-1756.34 737,-1703.34 925,-1703.34 925,-1756.34"/>
<text text-anchor="middle" x="831" y="-1741.14" font-family="Times,serif" font-size="14.00">Expert 11 Linear1</text>
<text text-anchor="middle" x="831" y="-1726.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="831" y="-1711.14" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- expert2_3_act -->
<g id="node93" class="node">
<title>expert2_3_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="899,-1621.36 765,-1621.36 765,-1583.36 899,-1583.36 899,-1621.36"/>
<text text-anchor="middle" x="832" y="-1606.16" font-family="Times,serif" font-size="14.00">Expert 11 GELU</text>
<text text-anchor="middle" x="832" y="-1591.16" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- expert2_3_1&#45;&gt;expert2_3_act -->
<g id="edge123" class="edge">
<title>expert2_3_1&#45;&gt;expert2_3_act</title>
<path fill="none" stroke="black" d="M831.2,-1703.14C831.37,-1682.41 831.6,-1653.27 831.77,-1631.83"/>
<polygon fill="black" stroke="black" points="835.27,-1631.73 831.85,-1621.7 828.27,-1631.67 835.27,-1631.73"/>
</g>
<!-- expert2_3_2 -->
<g id="node94" class="node">
<title>expert2_3_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="930,-1495.91 736,-1495.91 736,-1442.91 930,-1442.91 930,-1495.91"/>
<text text-anchor="middle" x="833" y="-1480.71" font-family="Times,serif" font-size="14.00">Expert 11 Linear2</text>
<text text-anchor="middle" x="833" y="-1465.71" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="833" y="-1450.71" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- expert2_3_act&#45;&gt;expert2_3_2 -->
<g id="edge124" class="edge">
<title>expert2_3_act&#45;&gt;expert2_3_2</title>
<path fill="none" stroke="black" d="M832.14,-1583.15C832.29,-1563.35 832.54,-1531.2 832.73,-1506.29"/>
<polygon fill="black" stroke="black" points="836.23,-1506.14 832.8,-1496.11 829.23,-1506.09 836.23,-1506.14"/>
</g>
<!-- expert2_3_2&#45;&gt;combine2 -->
<g id="edge125" class="edge">
<title>expert2_3_2&#45;&gt;combine2</title>
<path fill="none" stroke="black" d="M886.04,-1442.87C904.02,-1435.37 924.51,-1428.08 944,-1423.93 1046.89,-1402.02 1314.16,-1427.06 1417,-1404.93 1459.97,-1395.68 1505.13,-1379.53 1544.76,-1362.97"/>
<polygon fill="black" stroke="black" points="1546.33,-1366.11 1554.18,-1358.99 1543.6,-1359.66 1546.33,-1366.11"/>
</g>
<!-- expert2_4_1 -->
<g id="node95" class="node">
<title>expert2_4_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="1569,-1756.34 1381,-1756.34 1381,-1703.34 1569,-1703.34 1569,-1756.34"/>
<text text-anchor="middle" x="1475" y="-1741.14" font-family="Times,serif" font-size="14.00">Expert 12 Linear1</text>
<text text-anchor="middle" x="1475" y="-1726.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="1475" y="-1711.14" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- expert2_4_act -->
<g id="node96" class="node">
<title>expert2_4_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="1543,-1621.36 1409,-1621.36 1409,-1583.36 1543,-1583.36 1543,-1621.36"/>
<text text-anchor="middle" x="1476" y="-1606.16" font-family="Times,serif" font-size="14.00">Expert 12 GELU</text>
<text text-anchor="middle" x="1476" y="-1591.16" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- expert2_4_1&#45;&gt;expert2_4_act -->
<g id="edge127" class="edge">
<title>expert2_4_1&#45;&gt;expert2_4_act</title>
<path fill="none" stroke="black" d="M1475.2,-1703.14C1475.37,-1682.41 1475.6,-1653.27 1475.77,-1631.83"/>
<polygon fill="black" stroke="black" points="1479.27,-1631.73 1475.85,-1621.7 1472.27,-1631.67 1479.27,-1631.73"/>
</g>
<!-- expert2_4_2 -->
<g id="node97" class="node">
<title>expert2_4_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="1574,-1495.91 1380,-1495.91 1380,-1442.91 1574,-1442.91 1574,-1495.91"/>
<text text-anchor="middle" x="1477" y="-1480.71" font-family="Times,serif" font-size="14.00">Expert 12 Linear2</text>
<text text-anchor="middle" x="1477" y="-1465.71" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="1477" y="-1450.71" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- expert2_4_act&#45;&gt;expert2_4_2 -->
<g id="edge128" class="edge">
<title>expert2_4_act&#45;&gt;expert2_4_2</title>
<path fill="none" stroke="black" d="M1476.14,-1583.15C1476.29,-1563.35 1476.54,-1531.2 1476.73,-1506.29"/>
<polygon fill="black" stroke="black" points="1480.23,-1506.14 1476.8,-1496.11 1473.23,-1506.09 1480.23,-1506.14"/>
</g>
<!-- expert2_4_2&#45;&gt;combine2 -->
<g id="edge129" class="edge">
<title>expert2_4_2&#45;&gt;combine2</title>
<path fill="none" stroke="black" d="M1506.16,-1442.82C1529.7,-1422.16 1563.75,-1392.27 1593.94,-1365.78"/>
<polygon fill="black" stroke="black" points="1596.31,-1368.36 1601.52,-1359.13 1591.69,-1363.1 1596.31,-1368.36"/>
</g>
<!-- expert2_5_1 -->
<g id="node98" class="node">
<title>expert2_5_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="1891,-1756.34 1703,-1756.34 1703,-1703.34 1891,-1703.34 1891,-1756.34"/>
<text text-anchor="middle" x="1797" y="-1741.14" font-family="Times,serif" font-size="14.00">Expert 13 Linear1</text>
<text text-anchor="middle" x="1797" y="-1726.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="1797" y="-1711.14" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- expert2_5_act -->
<g id="node99" class="node">
<title>expert2_5_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="1865,-1621.36 1731,-1621.36 1731,-1583.36 1865,-1583.36 1865,-1621.36"/>
<text text-anchor="middle" x="1798" y="-1606.16" font-family="Times,serif" font-size="14.00">Expert 13 GELU</text>
<text text-anchor="middle" x="1798" y="-1591.16" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- expert2_5_1&#45;&gt;expert2_5_act -->
<g id="edge131" class="edge">
<title>expert2_5_1&#45;&gt;expert2_5_act</title>
<path fill="none" stroke="black" d="M1797.2,-1703.14C1797.37,-1682.41 1797.6,-1653.27 1797.77,-1631.83"/>
<polygon fill="black" stroke="black" points="1801.27,-1631.73 1797.85,-1621.7 1794.27,-1631.67 1801.27,-1631.73"/>
</g>
<!-- expert2_5_2 -->
<g id="node100" class="node">
<title>expert2_5_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="1896,-1495.91 1702,-1495.91 1702,-1442.91 1896,-1442.91 1896,-1495.91"/>
<text text-anchor="middle" x="1799" y="-1480.71" font-family="Times,serif" font-size="14.00">Expert 13 Linear2</text>
<text text-anchor="middle" x="1799" y="-1465.71" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="1799" y="-1450.71" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- expert2_5_act&#45;&gt;expert2_5_2 -->
<g id="edge132" class="edge">
<title>expert2_5_act&#45;&gt;expert2_5_2</title>
<path fill="none" stroke="black" d="M1798.14,-1583.15C1798.29,-1563.35 1798.54,-1531.2 1798.73,-1506.29"/>
<polygon fill="black" stroke="black" points="1802.23,-1506.14 1798.8,-1496.11 1795.23,-1506.09 1802.23,-1506.14"/>
</g>
<!-- expert2_5_2&#45;&gt;combine2 -->
<g id="edge133" class="edge">
<title>expert2_5_2&#45;&gt;combine2</title>
<path fill="none" stroke="black" d="M1777.13,-1442.82C1759.7,-1422.42 1734.58,-1393.03 1712.16,-1366.8"/>
<polygon fill="black" stroke="black" points="1714.77,-1364.46 1705.61,-1359.13 1709.45,-1369.01 1714.77,-1364.46"/>
</g>
<!-- expert2_6_1 -->
<g id="node101" class="node">
<title>expert2_6_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2113,-1756.34 1925,-1756.34 1925,-1703.34 2113,-1703.34 2113,-1756.34"/>
<text text-anchor="middle" x="2019" y="-1741.14" font-family="Times,serif" font-size="14.00">Expert 14 Linear1</text>
<text text-anchor="middle" x="2019" y="-1726.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="2019" y="-1711.14" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- expert2_6_act -->
<g id="node102" class="node">
<title>expert2_6_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2086,-1621.36 1952,-1621.36 1952,-1583.36 2086,-1583.36 2086,-1621.36"/>
<text text-anchor="middle" x="2019" y="-1606.16" font-family="Times,serif" font-size="14.00">Expert 14 GELU</text>
<text text-anchor="middle" x="2019" y="-1591.16" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- expert2_6_1&#45;&gt;expert2_6_act -->
<g id="edge135" class="edge">
<title>expert2_6_1&#45;&gt;expert2_6_act</title>
<path fill="none" stroke="black" d="M2019,-1703.14C2019,-1682.41 2019,-1653.27 2019,-1631.83"/>
<polygon fill="black" stroke="black" points="2022.5,-1631.7 2019,-1621.7 2015.5,-1631.7 2022.5,-1631.7"/>
</g>
<!-- expert2_6_2 -->
<g id="node103" class="node">
<title>expert2_6_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2114,-1495.91 1920,-1495.91 1920,-1442.91 2114,-1442.91 2114,-1495.91"/>
<text text-anchor="middle" x="2017" y="-1480.71" font-family="Times,serif" font-size="14.00">Expert 14 Linear2</text>
<text text-anchor="middle" x="2017" y="-1465.71" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="2017" y="-1450.71" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- expert2_6_act&#45;&gt;expert2_6_2 -->
<g id="edge136" class="edge">
<title>expert2_6_act&#45;&gt;expert2_6_2</title>
<path fill="none" stroke="black" d="M2018.72,-1583.15C2018.42,-1563.35 2017.93,-1531.2 2017.55,-1506.29"/>
<polygon fill="black" stroke="black" points="2021.04,-1506.06 2017.39,-1496.11 2014.05,-1506.17 2021.04,-1506.06"/>
</g>
<!-- expert2_6_2&#45;&gt;combine2 -->
<g id="edge137" class="edge">
<title>expert2_6_2&#45;&gt;combine2</title>
<path fill="none" stroke="black" d="M1960.59,-1442.82C1913.5,-1421.46 1844.67,-1390.24 1784.85,-1363.11"/>
<polygon fill="black" stroke="black" points="1786.27,-1359.91 1775.72,-1358.96 1783.38,-1366.28 1786.27,-1359.91"/>
</g>
<!-- expert2_7_1 -->
<g id="node104" class="node">
<title>expert2_7_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2435,-1756.34 2247,-1756.34 2247,-1703.34 2435,-1703.34 2435,-1756.34"/>
<text text-anchor="middle" x="2341" y="-1741.14" font-family="Times,serif" font-size="14.00">Expert 15 Linear1</text>
<text text-anchor="middle" x="2341" y="-1726.14" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="2341" y="-1711.14" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- expert2_7_act -->
<g id="node105" class="node">
<title>expert2_7_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2408,-1621.36 2274,-1621.36 2274,-1583.36 2408,-1583.36 2408,-1621.36"/>
<text text-anchor="middle" x="2341" y="-1606.16" font-family="Times,serif" font-size="14.00">Expert 15 GELU</text>
<text text-anchor="middle" x="2341" y="-1591.16" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- expert2_7_1&#45;&gt;expert2_7_act -->
<g id="edge139" class="edge">
<title>expert2_7_1&#45;&gt;expert2_7_act</title>
<path fill="none" stroke="black" d="M2341,-1703.14C2341,-1682.41 2341,-1653.27 2341,-1631.83"/>
<polygon fill="black" stroke="black" points="2344.5,-1631.7 2341,-1621.7 2337.5,-1631.7 2344.5,-1631.7"/>
</g>
<!-- expert2_7_2 -->
<g id="node106" class="node">
<title>expert2_7_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2436,-1495.91 2242,-1495.91 2242,-1442.91 2436,-1442.91 2436,-1495.91"/>
<text text-anchor="middle" x="2339" y="-1480.71" font-family="Times,serif" font-size="14.00">Expert 15 Linear2</text>
<text text-anchor="middle" x="2339" y="-1465.71" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="2339" y="-1450.71" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- expert2_7_act&#45;&gt;expert2_7_2 -->
<g id="edge140" class="edge">
<title>expert2_7_act&#45;&gt;expert2_7_2</title>
<path fill="none" stroke="black" d="M2340.72,-1583.15C2340.42,-1563.35 2339.93,-1531.2 2339.55,-1506.29"/>
<polygon fill="black" stroke="black" points="2343.04,-1506.06 2339.39,-1496.11 2336.05,-1506.17 2343.04,-1506.06"/>
</g>
<!-- expert2_7_2&#45;&gt;combine2 -->
<g id="edge141" class="edge">
<title>expert2_7_2&#45;&gt;combine2</title>
<path fill="none" stroke="black" d="M2280.93,-1442.88C2264.08,-1436.09 2245.49,-1429.19 2228,-1423.93 2119.14,-1391.17 1995.8,-1364.52 1892.02,-1344.98"/>
<polygon fill="black" stroke="black" points="1892.51,-1341.51 1882.04,-1343.11 1891.22,-1348.39 1892.51,-1341.51"/>
</g>
<!-- gate2 -->
<g id="node107" class="node">
<title>gate2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="1220,-1373.93 1032,-1305.93 1220,-1237.93 1408,-1305.93 1220,-1373.93"/>
<text text-anchor="middle" x="1220" y="-1324.73" font-family="Times,serif" font-size="14.00">Gate</text>
<text text-anchor="middle" x="1220" y="-1309.73" font-family="Times,serif" font-size="14.00">Compute routing scores</text>
<text text-anchor="middle" x="1220" y="-1294.73" font-family="Times,serif" font-size="14.00">Input: [B, L/P, d_model]</text>
<text text-anchor="middle" x="1220" y="-1279.73" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15</text>
</g>
<!-- select2 -->
<g id="node108" class="node">
<title>select2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="1374.13,-1185.93 1101.9,-1185.93 1031.87,-1109.93 1304.1,-1109.93 1374.13,-1185.93"/>
<text text-anchor="middle" x="1203" y="-1151.73" font-family="Times,serif" font-size="14.00">Select Top&#45;2 Experts</text>
<text text-anchor="middle" x="1203" y="-1136.73" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15</text>
</g>
<!-- gate2&#45;&gt;select2 -->
<g id="edge109" class="edge">
<title>gate2&#45;&gt;select2</title>
<path fill="none" stroke="black" d="M1212.94,-1240.13C1211.34,-1225.45 1209.67,-1210.13 1208.17,-1196.33"/>
<polygon fill="black" stroke="black" points="1211.61,-1195.68 1207.05,-1186.11 1204.66,-1196.43 1211.61,-1195.68"/>
</g>
<!-- select2&#45;&gt;expert2_0_1 -->
<g id="edge110" class="edge">
<title>select2&#45;&gt;expert2_0_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1083.77,-1166.26C1049.58,-1176.54 1014.88,-1192.9 990,-1218.93 962.58,-1247.62 966,-1265.25 966,-1304.93 966,-1603.36 966,-1603.36 966,-1603.36 966,-1649.9 1006.43,-1680.29 1049.69,-1699.48"/>
<polygon fill="black" stroke="black" points="1048.38,-1702.73 1058.95,-1703.41 1051.11,-1696.28 1048.38,-1702.73"/>
<text text-anchor="middle" x="1003" y="-1465.71" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- select2&#45;&gt;expert2_1_1 -->
<g id="edge114" class="edge">
<title>select2&#45;&gt;expert2_1_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1070.82,-1152.44C758.31,-1162.49 0,-1197.92 0,-1304.93 0,-1603.36 0,-1603.36 0,-1603.36 0,-1649.9 40.43,-1680.29 83.69,-1699.48"/>
<polygon fill="black" stroke="black" points="82.38,-1702.73 92.95,-1703.41 85.11,-1696.28 82.38,-1702.73"/>
<text text-anchor="middle" x="37" y="-1465.71" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- select2&#45;&gt;expert2_2_1 -->
<g id="edge118" class="edge">
<title>select2&#45;&gt;expert2_2_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1076.31,-1158.42C832.51,-1178.39 322,-1229.25 322,-1304.93 322,-1603.36 322,-1603.36 322,-1603.36 322,-1649.9 362.43,-1680.29 405.69,-1699.48"/>
<polygon fill="black" stroke="black" points="404.38,-1702.73 414.95,-1703.41 407.11,-1696.28 404.38,-1702.73"/>
<text text-anchor="middle" x="359" y="-1465.71" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- select2&#45;&gt;expert2_3_1 -->
<g id="edge122" class="edge">
<title>select2&#45;&gt;expert2_3_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1076.85,-1158.78C911.98,-1175.21 644,-1215.63 644,-1304.93 644,-1603.36 644,-1603.36 644,-1603.36 644,-1649.9 684.43,-1680.29 727.69,-1699.48"/>
<polygon fill="black" stroke="black" points="726.38,-1702.73 736.95,-1703.41 729.11,-1696.28 726.38,-1702.73"/>
<text text-anchor="middle" x="681" y="-1465.71" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- select2&#45;&gt;expert2_4_1 -->
<g id="edge126" class="edge">
<title>select2&#45;&gt;expert2_4_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1094.98,-1179.04C1066.72,-1192.36 1039.55,-1211.28 1023,-1237.93 983.84,-1300.98 972.62,-1350.42 1023,-1404.93 1059.46,-1444.38 1222.36,-1389.99 1264,-1423.93 1304.87,-1457.24 1270.98,-1492.02 1297,-1537.88 1333.27,-1601.81 1395.03,-1661.38 1435.42,-1696.46"/>
<polygon fill="black" stroke="black" points="1433.34,-1699.28 1443.2,-1703.14 1437.9,-1693.97 1433.34,-1699.28"/>
<text text-anchor="middle" x="1334" y="-1465.71" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- select2&#45;&gt;expert2_5_1 -->
<g id="edge130" class="edge">
<title>select2&#45;&gt;expert2_5_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1347.91,-1157.21C1542.67,-1169.83 1868.81,-1196.86 1905,-1237.93 1954.07,-1293.62 1955.71,-1350.74 1905,-1404.93 1861.48,-1451.44 1662.52,-1377.42 1619,-1423.93 1538.69,-1509.75 1678.57,-1638.09 1753.83,-1697.09"/>
<polygon fill="black" stroke="black" points="1751.74,-1699.9 1761.79,-1703.26 1756.03,-1694.36 1751.74,-1699.9"/>
<text text-anchor="middle" x="1656" y="-1465.71" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- select2&#45;&gt;expert2_6_1 -->
<g id="edge134" class="edge">
<title>select2&#45;&gt;expert2_6_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1348.63,-1158.14C1614.19,-1176.91 2150,-1224.72 2150,-1304.93 2150,-1603.36 2150,-1603.36 2150,-1603.36 2150,-1644.56 2115.8,-1676.41 2082.34,-1697.72"/>
<polygon fill="black" stroke="black" points="2080.12,-1694.97 2073.42,-1703.18 2083.77,-1700.95 2080.12,-1694.97"/>
<text text-anchor="middle" x="2187" y="-1465.71" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- select2&#45;&gt;expert2_7_1 -->
<g id="edge138" class="edge">
<title>select2&#45;&gt;expert2_7_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1342.74,-1151.71C1672.58,-1160.13 2472,-1192.18 2472,-1304.93 2472,-1603.36 2472,-1603.36 2472,-1603.36 2472,-1644.56 2437.8,-1676.41 2404.34,-1697.72"/>
<polygon fill="black" stroke="black" points="2402.12,-1694.97 2395.42,-1703.18 2405.77,-1700.95 2402.12,-1694.97"/>
<text text-anchor="middle" x="2509" y="-1465.71" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- res_moe2 -->
<g id="node112" class="node">
<title>res_moe2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4753.88,-1200.93 4453.42,-1200.93 4376.12,-1094.93 4676.58,-1094.93 4753.88,-1200.93"/>
<text text-anchor="middle" x="4565" y="-1159.23" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="4565" y="-1144.23" font-family="Times,serif" font-size="14.00">Input: [B, L/P, d_model]</text>
<text text-anchor="middle" x="4565" y="-1129.23" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15</text>
</g>
<!-- combine2&#45;&gt;res_moe2 -->
<g id="edge142" class="edge">
<title>combine2&#45;&gt;res_moe2</title>
<path fill="none" stroke="black" d="M1838.56,-1295.39C2365.65,-1267.08 3915.39,-1183.83 4410.83,-1157.21"/>
<polygon fill="black" stroke="black" points="4411.11,-1160.7 4420.91,-1156.67 4410.73,-1153.71 4411.11,-1160.7"/>
</g>
<!-- recv_stage1&#45;&gt;qkv2_8 -->
<g id="edge74" class="edge">
<title>recv_stage1&#45;&gt;qkv2_8</title>
<path fill="none" stroke="black" d="M4754.01,-1466.18C5103.89,-1459.59 6153.3,-1439.04 7024,-1413.93 7138.69,-1410.62 7175.22,-1446.92 7282,-1404.93 7316.09,-1391.53 7346.92,-1363.14 7367.73,-1340.35"/>
<polygon fill="black" stroke="black" points="7370.36,-1342.66 7374.4,-1332.87 7365.13,-1338.01 7370.36,-1342.66"/>
</g>
<!-- recv_stage1&#45;&gt;qkv2_9 -->
<g id="edge78" class="edge">
<title>recv_stage1&#45;&gt;qkv2_9</title>
<path fill="none" stroke="black" d="M4754.01,-1465.97C5116.23,-1458.6 6230.37,-1435.65 7154,-1413.93 7311.34,-1410.23 7361.26,-1461.83 7508,-1404.93 7542.37,-1391.6 7573.37,-1362.92 7594.17,-1340.01"/>
<polygon fill="black" stroke="black" points="7596.81,-1342.31 7600.82,-1332.5 7591.57,-1337.67 7596.81,-1342.31"/>
</g>
<!-- recv_stage1&#45;&gt;qkv2_10 -->
<g id="edge82" class="edge">
<title>recv_stage1&#45;&gt;qkv2_10</title>
<path fill="none" stroke="black" d="M4754.53,-1468.23C5308.92,-1467.12 7592.83,-1459.27 7734,-1404.93 7768.4,-1391.69 7799.4,-1363 7820.18,-1340.07"/>
<polygon fill="black" stroke="black" points="7822.84,-1342.35 7826.83,-1332.54 7817.59,-1337.72 7822.84,-1342.35"/>
</g>
<!-- recv_stage1&#45;&gt;qkv2_11 -->
<g id="edge86" class="edge">
<title>recv_stage1&#45;&gt;qkv2_11</title>
<path fill="none" stroke="black" d="M4747.72,-1457.15C5046.57,-1427.56 5851.64,-1347.85 6150.91,-1318.22"/>
<polygon fill="black" stroke="black" points="6151.31,-1321.7 6160.91,-1317.23 6150.62,-1314.74 6151.31,-1321.7"/>
</g>
<!-- recv_stage1&#45;&gt;qkv2_12 -->
<g id="edge90" class="edge">
<title>recv_stage1&#45;&gt;qkv2_12</title>
<path fill="none" stroke="black" d="M4753.44,-1464.59C5143.95,-1452.02 6359.08,-1412.39 6378,-1404.93 6412.08,-1391.5 6442.91,-1363.12 6463.72,-1340.34"/>
<polygon fill="black" stroke="black" points="6466.35,-1342.65 6470.39,-1332.86 6461.12,-1337.99 6466.35,-1342.65"/>
</g>
<!-- recv_stage1&#45;&gt;qkv2_13 -->
<g id="edge94" class="edge">
<title>recv_stage1&#45;&gt;qkv2_13</title>
<path fill="none" stroke="black" d="M4754.07,-1466.75C5168.42,-1460.75 6517.77,-1438.7 6604,-1404.93 6638.32,-1391.49 6669.33,-1362.82 6690.14,-1339.95"/>
<polygon fill="black" stroke="black" points="6692.78,-1342.24 6696.8,-1332.44 6687.54,-1337.6 6692.78,-1342.24"/>
</g>
<!-- recv_stage1&#45;&gt;qkv2_14 -->
<g id="edge98" class="edge">
<title>recv_stage1&#45;&gt;qkv2_14</title>
<path fill="none" stroke="black" d="M4753.59,-1465.32C5057.28,-1457.42 5882.95,-1435.56 6571,-1413.93 6686.12,-1410.31 6722.81,-1447.07 6830,-1404.93 6864.09,-1391.53 6894.92,-1363.14 6915.73,-1340.35"/>
<polygon fill="black" stroke="black" points="6918.36,-1342.67 6922.4,-1332.87 6913.13,-1338.01 6918.36,-1342.67"/>
</g>
<!-- recv_stage1&#45;&gt;qkv2_15 -->
<g id="edge102" class="edge">
<title>recv_stage1&#45;&gt;qkv2_15</title>
<path fill="none" stroke="black" d="M4754.17,-1467.51C5228.2,-1463.67 6947.89,-1446.9 7056,-1404.93 7090.36,-1391.59 7121.36,-1362.91 7142.16,-1340.01"/>
<polygon fill="black" stroke="black" points="7144.81,-1342.3 7148.81,-1332.49 7139.57,-1337.66 7144.81,-1342.3"/>
</g>
<!-- recv_stage1&#45;&gt;res2 -->
<g id="edge107" class="edge">
<title>recv_stage1&#45;&gt;res2</title>
<path fill="none" stroke="black" d="M4618.52,-1432.17C4610.49,-1413.38 4600.46,-1389.91 4591.26,-1368.38"/>
<polygon fill="black" stroke="black" points="4594.39,-1366.79 4587.24,-1358.97 4587.95,-1369.54 4594.39,-1366.79"/>
</g>
<!-- res2&#45;&gt;gate2 -->
<g id="edge108" class="edge">
<title>res2&#45;&gt;gate2</title>
<path fill="none" stroke="black" d="M4421.75,-1315.94C4083.55,-1339.02 3208.86,-1395.43 2477,-1414.43 2418.63,-1415.95 1482.68,-1428.44 1426,-1414.43 1379.32,-1402.89 1331.54,-1378.64 1293.76,-1355.99"/>
<polygon fill="black" stroke="black" points="1295.24,-1352.79 1284.87,-1350.58 1291.6,-1358.77 1295.24,-1352.79"/>
</g>
<!-- res2&#45;&gt;res_moe2 -->
<g id="edge143" class="edge">
<title>res2&#45;&gt;res_moe2</title>
<path fill="none" stroke="black" d="M4565,-1252.55C4565,-1239.36 4565,-1225.07 4565,-1211.44"/>
<polygon fill="black" stroke="black" points="4568.5,-1211.17 4565,-1201.17 4561.5,-1211.17 4568.5,-1211.17"/>
</g>
<!-- qkv3_8 -->
<g id="node113" class="node">
<title>qkv3_8</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3629,-1036.93 3421,-1036.93 3421,-983.93 3629,-983.93 3629,-1036.93"/>
<text text-anchor="middle" x="3525" y="-1021.73" font-family="Times,serif" font-size="14.00">QKV Projection 8</text>
<text text-anchor="middle" x="3525" y="-1006.73" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="3525" y="-991.73" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- res_moe2&#45;&gt;qkv3_8 -->
<g id="edge144" class="edge">
<title>res_moe2&#45;&gt;qkv3_8</title>
<path fill="none" stroke="black" d="M4411.19,-1143.21C4187.11,-1136.44 3782.45,-1118.73 3643,-1076.93 3617.47,-1069.28 3591.33,-1055.49 3570.16,-1042.54"/>
<polygon fill="black" stroke="black" points="3571.75,-1039.4 3561.41,-1037.06 3568.03,-1045.33 3571.75,-1039.4"/>
</g>
<!-- qkv3_9 -->
<g id="node114" class="node">
<title>qkv3_9</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2047,-1036.93 1839,-1036.93 1839,-983.93 2047,-983.93 2047,-1036.93"/>
<text text-anchor="middle" x="1943" y="-1021.73" font-family="Times,serif" font-size="14.00">QKV Projection 9</text>
<text text-anchor="middle" x="1943" y="-1006.73" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="1943" y="-991.73" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- res_moe2&#45;&gt;qkv3_9 -->
<g id="edge148" class="edge">
<title>res_moe2&#45;&gt;qkv3_9</title>
<path fill="none" stroke="black" d="M4410.33,-1142.24C4046.29,-1131.18 3106.87,-1102.46 2322,-1076.93 2203.77,-1073.09 2170.65,-1097.05 2056,-1067.93 2034.07,-1062.36 2011.46,-1052.1 1992.29,-1041.84"/>
<polygon fill="black" stroke="black" points="1993.9,-1038.74 1983.45,-1036.99 1990.53,-1044.87 1993.9,-1038.74"/>
</g>
<!-- qkv3_10 -->
<g id="node115" class="node">
<title>qkv3_10</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2273,-1036.93 2065,-1036.93 2065,-983.93 2273,-983.93 2273,-1036.93"/>
<text text-anchor="middle" x="2169" y="-1021.73" font-family="Times,serif" font-size="14.00">QKV Projection 10</text>
<text text-anchor="middle" x="2169" y="-1006.73" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="2169" y="-991.73" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- res_moe2&#45;&gt;qkv3_10 -->
<g id="edge152" class="edge">
<title>res_moe2&#45;&gt;qkv3_10</title>
<path fill="none" stroke="black" d="M4412.83,-1145.42C3935.46,-1140.17 2486.97,-1120.07 2282,-1067.93 2260.07,-1062.35 2237.47,-1052.09 2218.29,-1041.83"/>
<polygon fill="black" stroke="black" points="2219.9,-1038.73 2209.45,-1036.98 2216.53,-1044.86 2219.9,-1038.73"/>
</g>
<!-- qkv3_11 -->
<g id="node116" class="node">
<title>qkv3_11</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2499,-1036.93 2291,-1036.93 2291,-983.93 2499,-983.93 2499,-1036.93"/>
<text text-anchor="middle" x="2395" y="-1021.73" font-family="Times,serif" font-size="14.00">QKV Projection 11</text>
<text text-anchor="middle" x="2395" y="-1006.73" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="2395" y="-991.73" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- res_moe2&#45;&gt;qkv3_11 -->
<g id="edge156" class="edge">
<title>res_moe2&#45;&gt;qkv3_11</title>
<path fill="none" stroke="black" d="M4412.41,-1144.79C3967.32,-1138.02 2690.45,-1114.71 2508,-1067.93 2486.08,-1062.31 2463.48,-1052.04 2444.3,-1041.79"/>
<polygon fill="black" stroke="black" points="2445.91,-1038.68 2435.46,-1036.94 2442.55,-1044.82 2445.91,-1038.68"/>
</g>
<!-- qkv3_12 -->
<g id="node117" class="node">
<title>qkv3_12</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2725,-1036.93 2517,-1036.93 2517,-983.93 2725,-983.93 2725,-1036.93"/>
<text text-anchor="middle" x="2621" y="-1021.73" font-family="Times,serif" font-size="14.00">QKV Projection 12</text>
<text text-anchor="middle" x="2621" y="-1006.73" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="2621" y="-991.73" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- res_moe2&#45;&gt;qkv3_12 -->
<g id="edge160" class="edge">
<title>res_moe2&#45;&gt;qkv3_12</title>
<path fill="none" stroke="black" d="M4411.81,-1143.99C4000.81,-1135.59 2894.03,-1109.37 2734,-1067.93 2712.19,-1062.28 2689.68,-1052.07 2670.56,-1041.86"/>
<polygon fill="black" stroke="black" points="2672.19,-1038.77 2661.74,-1037.03 2668.83,-1044.91 2672.19,-1038.77"/>
</g>
<!-- qkv3_13 -->
<g id="node118" class="node">
<title>qkv3_13</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2951,-1036.93 2743,-1036.93 2743,-983.93 2951,-983.93 2951,-1036.93"/>
<text text-anchor="middle" x="2847" y="-1021.73" font-family="Times,serif" font-size="14.00">QKV Projection 13</text>
<text text-anchor="middle" x="2847" y="-1006.73" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="2847" y="-991.73" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- res_moe2&#45;&gt;qkv3_13 -->
<g id="edge164" class="edge">
<title>res_moe2&#45;&gt;qkv3_13</title>
<path fill="none" stroke="black" d="M4414.07,-1147.41C4069.09,-1147.22 3231.72,-1139.17 2960,-1067.93 2938.2,-1062.22 2915.7,-1051.99 2896.58,-1041.79"/>
<polygon fill="black" stroke="black" points="2898.21,-1038.7 2887.76,-1036.97 2894.85,-1044.84 2898.21,-1038.7"/>
</g>
<!-- qkv3_14 -->
<g id="node119" class="node">
<title>qkv3_14</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3177,-1036.93 2969,-1036.93 2969,-983.93 3177,-983.93 3177,-1036.93"/>
<text text-anchor="middle" x="3073" y="-1021.73" font-family="Times,serif" font-size="14.00">QKV Projection 14</text>
<text text-anchor="middle" x="3073" y="-1006.73" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="3073" y="-991.73" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- res_moe2&#45;&gt;qkv3_14 -->
<g id="edge168" class="edge">
<title>res_moe2&#45;&gt;qkv3_14</title>
<path fill="none" stroke="black" d="M4413.04,-1145.94C4104.3,-1142.68 3413.66,-1128.6 3186,-1067.93 3164.32,-1062.15 3141.92,-1051.97 3122.84,-1041.83"/>
<polygon fill="black" stroke="black" points="3124.5,-1038.74 3114.04,-1037.03 3121.15,-1044.89 3124.5,-1038.74"/>
</g>
<!-- qkv3_15 -->
<g id="node120" class="node">
<title>qkv3_15</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3403,-1036.93 3195,-1036.93 3195,-983.93 3403,-983.93 3403,-1036.93"/>
<text text-anchor="middle" x="3299" y="-1021.73" font-family="Times,serif" font-size="14.00">QKV Projection 15</text>
<text text-anchor="middle" x="3299" y="-1006.73" font-family="Times,serif" font-size="14.00">[Q,K,V]: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="3299" y="-991.73" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- res_moe2&#45;&gt;qkv3_15 -->
<g id="edge172" class="edge">
<title>res_moe2&#45;&gt;qkv3_15</title>
<path fill="none" stroke="black" d="M4411.81,-1143.89C4142.67,-1137.31 3596.03,-1118.07 3412,-1067.93 3390.54,-1062.08 3368.35,-1052 3349.38,-1041.96"/>
<polygon fill="black" stroke="black" points="3350.8,-1038.75 3340.34,-1037.05 3347.46,-1044.9 3350.8,-1038.75"/>
</g>
<!-- res3 -->
<g id="node165" class="node">
<title>res3</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3672.88,-587 3372.42,-587 3295.12,-481 3595.58,-481 3672.88,-587"/>
<text text-anchor="middle" x="3484" y="-545.3" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="3484" y="-530.3" font-family="Times,serif" font-size="14.00">Input: [B, L/P, d_model]</text>
<text text-anchor="middle" x="3484" y="-515.3" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15</text>
</g>
<!-- res_moe2&#45;&gt;res3 -->
<g id="edge177" class="edge">
<title>res_moe2&#45;&gt;res3</title>
<path fill="none" stroke="black" d="M4408.39,-1139.27C4148.65,-1124.45 3657,-1086.49 3657,-1011.43 3657,-1011.43 3657,-1011.43 3657,-842.95 3657,-757.79 3682.35,-726.45 3641,-652 3628.34,-629.21 3609.17,-609.57 3588.53,-593.24"/>
<polygon fill="black" stroke="black" points="3590.63,-590.44 3580.56,-587.15 3586.38,-596 3590.63,-590.44"/>
</g>
<!-- attn3_8 -->
<g id="node121" class="node">
<title>attn3_8</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3629,-925.93 3421,-925.93 3421,-872.93 3629,-872.93 3629,-925.93"/>
<text text-anchor="middle" x="3525" y="-910.73" font-family="Times,serif" font-size="14.00">Attention 8</text>
<text text-anchor="middle" x="3525" y="-895.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="3525" y="-880.73" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- qkv3_8&#45;&gt;attn3_8 -->
<g id="edge145" class="edge">
<title>qkv3_8&#45;&gt;attn3_8</title>
<path fill="none" stroke="black" d="M3525,-983.87C3525,-969.76 3525,-952.01 3525,-936.5"/>
<polygon fill="black" stroke="black" points="3528.5,-936.2 3525,-926.2 3521.5,-936.2 3528.5,-936.2"/>
</g>
<!-- attn3_9 -->
<g id="node122" class="node">
<title>attn3_9</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2047,-925.93 1839,-925.93 1839,-872.93 2047,-872.93 2047,-925.93"/>
<text text-anchor="middle" x="1943" y="-910.73" font-family="Times,serif" font-size="14.00">Attention 9</text>
<text text-anchor="middle" x="1943" y="-895.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="1943" y="-880.73" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- qkv3_9&#45;&gt;attn3_9 -->
<g id="edge149" class="edge">
<title>qkv3_9&#45;&gt;attn3_9</title>
<path fill="none" stroke="black" d="M1943,-983.87C1943,-969.76 1943,-952.01 1943,-936.5"/>
<polygon fill="black" stroke="black" points="1946.5,-936.2 1943,-926.2 1939.5,-936.2 1946.5,-936.2"/>
</g>
<!-- attn3_10 -->
<g id="node123" class="node">
<title>attn3_10</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2273,-925.93 2065,-925.93 2065,-872.93 2273,-872.93 2273,-925.93"/>
<text text-anchor="middle" x="2169" y="-910.73" font-family="Times,serif" font-size="14.00">Attention 10</text>
<text text-anchor="middle" x="2169" y="-895.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="2169" y="-880.73" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- qkv3_10&#45;&gt;attn3_10 -->
<g id="edge153" class="edge">
<title>qkv3_10&#45;&gt;attn3_10</title>
<path fill="none" stroke="black" d="M2169,-983.87C2169,-969.76 2169,-952.01 2169,-936.5"/>
<polygon fill="black" stroke="black" points="2172.5,-936.2 2169,-926.2 2165.5,-936.2 2172.5,-936.2"/>
</g>
<!-- attn3_11 -->
<g id="node124" class="node">
<title>attn3_11</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2499,-925.93 2291,-925.93 2291,-872.93 2499,-872.93 2499,-925.93"/>
<text text-anchor="middle" x="2395" y="-910.73" font-family="Times,serif" font-size="14.00">Attention 11</text>
<text text-anchor="middle" x="2395" y="-895.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="2395" y="-880.73" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- qkv3_11&#45;&gt;attn3_11 -->
<g id="edge157" class="edge">
<title>qkv3_11&#45;&gt;attn3_11</title>
<path fill="none" stroke="black" d="M2395,-983.87C2395,-969.76 2395,-952.01 2395,-936.5"/>
<polygon fill="black" stroke="black" points="2398.5,-936.2 2395,-926.2 2391.5,-936.2 2398.5,-936.2"/>
</g>
<!-- attn3_12 -->
<g id="node125" class="node">
<title>attn3_12</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2725,-925.93 2517,-925.93 2517,-872.93 2725,-872.93 2725,-925.93"/>
<text text-anchor="middle" x="2621" y="-910.73" font-family="Times,serif" font-size="14.00">Attention 12</text>
<text text-anchor="middle" x="2621" y="-895.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="2621" y="-880.73" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- qkv3_12&#45;&gt;attn3_12 -->
<g id="edge161" class="edge">
<title>qkv3_12&#45;&gt;attn3_12</title>
<path fill="none" stroke="black" d="M2621,-983.87C2621,-969.76 2621,-952.01 2621,-936.5"/>
<polygon fill="black" stroke="black" points="2624.5,-936.2 2621,-926.2 2617.5,-936.2 2624.5,-936.2"/>
</g>
<!-- attn3_13 -->
<g id="node126" class="node">
<title>attn3_13</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2951,-925.93 2743,-925.93 2743,-872.93 2951,-872.93 2951,-925.93"/>
<text text-anchor="middle" x="2847" y="-910.73" font-family="Times,serif" font-size="14.00">Attention 13</text>
<text text-anchor="middle" x="2847" y="-895.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="2847" y="-880.73" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- qkv3_13&#45;&gt;attn3_13 -->
<g id="edge165" class="edge">
<title>qkv3_13&#45;&gt;attn3_13</title>
<path fill="none" stroke="black" d="M2847,-983.87C2847,-969.76 2847,-952.01 2847,-936.5"/>
<polygon fill="black" stroke="black" points="2850.5,-936.2 2847,-926.2 2843.5,-936.2 2850.5,-936.2"/>
</g>
<!-- attn3_14 -->
<g id="node127" class="node">
<title>attn3_14</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3177,-925.93 2969,-925.93 2969,-872.93 3177,-872.93 3177,-925.93"/>
<text text-anchor="middle" x="3073" y="-910.73" font-family="Times,serif" font-size="14.00">Attention 14</text>
<text text-anchor="middle" x="3073" y="-895.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="3073" y="-880.73" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- qkv3_14&#45;&gt;attn3_14 -->
<g id="edge169" class="edge">
<title>qkv3_14&#45;&gt;attn3_14</title>
<path fill="none" stroke="black" d="M3073,-983.87C3073,-969.76 3073,-952.01 3073,-936.5"/>
<polygon fill="black" stroke="black" points="3076.5,-936.2 3073,-926.2 3069.5,-936.2 3076.5,-936.2"/>
</g>
<!-- attn3_15 -->
<g id="node128" class="node">
<title>attn3_15</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3403,-925.93 3195,-925.93 3195,-872.93 3403,-872.93 3403,-925.93"/>
<text text-anchor="middle" x="3299" y="-910.73" font-family="Times,serif" font-size="14.00">Attention 15</text>
<text text-anchor="middle" x="3299" y="-895.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="3299" y="-880.73" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- qkv3_15&#45;&gt;attn3_15 -->
<g id="edge173" class="edge">
<title>qkv3_15&#45;&gt;attn3_15</title>
<path fill="none" stroke="black" d="M3299,-983.87C3299,-969.76 3299,-952.01 3299,-936.5"/>
<polygon fill="black" stroke="black" points="3302.5,-936.2 3299,-926.2 3295.5,-936.2 3302.5,-936.2"/>
</g>
<!-- out3_8 -->
<g id="node129" class="node">
<title>out3_8</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3629,-824.95 3421,-824.95 3421,-771.95 3629,-771.95 3629,-824.95"/>
<text text-anchor="middle" x="3525" y="-809.75" font-family="Times,serif" font-size="14.00">Output Proj 8</text>
<text text-anchor="middle" x="3525" y="-794.75" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="3525" y="-779.75" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- attn3_8&#45;&gt;out3_8 -->
<g id="edge146" class="edge">
<title>attn3_8&#45;&gt;out3_8</title>
<path fill="none" stroke="black" d="M3525,-872.68C3525,-861.23 3525,-847.55 3525,-835.13"/>
<polygon fill="black" stroke="black" points="3528.5,-835.07 3525,-825.07 3521.5,-835.07 3528.5,-835.07"/>
</g>
<!-- out3_9 -->
<g id="node130" class="node">
<title>out3_9</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2047,-824.95 1839,-824.95 1839,-771.95 2047,-771.95 2047,-824.95"/>
<text text-anchor="middle" x="1943" y="-809.75" font-family="Times,serif" font-size="14.00">Output Proj 9</text>
<text text-anchor="middle" x="1943" y="-794.75" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="1943" y="-779.75" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- attn3_9&#45;&gt;out3_9 -->
<g id="edge150" class="edge">
<title>attn3_9&#45;&gt;out3_9</title>
<path fill="none" stroke="black" d="M1943,-872.68C1943,-861.23 1943,-847.55 1943,-835.13"/>
<polygon fill="black" stroke="black" points="1946.5,-835.07 1943,-825.07 1939.5,-835.07 1946.5,-835.07"/>
</g>
<!-- out3_10 -->
<g id="node131" class="node">
<title>out3_10</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2273,-824.95 2065,-824.95 2065,-771.95 2273,-771.95 2273,-824.95"/>
<text text-anchor="middle" x="2169" y="-809.75" font-family="Times,serif" font-size="14.00">Output Proj 10</text>
<text text-anchor="middle" x="2169" y="-794.75" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="2169" y="-779.75" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- attn3_10&#45;&gt;out3_10 -->
<g id="edge154" class="edge">
<title>attn3_10&#45;&gt;out3_10</title>
<path fill="none" stroke="black" d="M2169,-872.68C2169,-861.23 2169,-847.55 2169,-835.13"/>
<polygon fill="black" stroke="black" points="2172.5,-835.07 2169,-825.07 2165.5,-835.07 2172.5,-835.07"/>
</g>
<!-- out3_11 -->
<g id="node132" class="node">
<title>out3_11</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2499,-824.95 2291,-824.95 2291,-771.95 2499,-771.95 2499,-824.95"/>
<text text-anchor="middle" x="2395" y="-809.75" font-family="Times,serif" font-size="14.00">Output Proj 11</text>
<text text-anchor="middle" x="2395" y="-794.75" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="2395" y="-779.75" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- attn3_11&#45;&gt;out3_11 -->
<g id="edge158" class="edge">
<title>attn3_11&#45;&gt;out3_11</title>
<path fill="none" stroke="black" d="M2395,-872.68C2395,-861.23 2395,-847.55 2395,-835.13"/>
<polygon fill="black" stroke="black" points="2398.5,-835.07 2395,-825.07 2391.5,-835.07 2398.5,-835.07"/>
</g>
<!-- out3_12 -->
<g id="node133" class="node">
<title>out3_12</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2725,-824.95 2517,-824.95 2517,-771.95 2725,-771.95 2725,-824.95"/>
<text text-anchor="middle" x="2621" y="-809.75" font-family="Times,serif" font-size="14.00">Output Proj 12</text>
<text text-anchor="middle" x="2621" y="-794.75" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="2621" y="-779.75" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- attn3_12&#45;&gt;out3_12 -->
<g id="edge162" class="edge">
<title>attn3_12&#45;&gt;out3_12</title>
<path fill="none" stroke="black" d="M2621,-872.68C2621,-861.23 2621,-847.55 2621,-835.13"/>
<polygon fill="black" stroke="black" points="2624.5,-835.07 2621,-825.07 2617.5,-835.07 2624.5,-835.07"/>
</g>
<!-- out3_13 -->
<g id="node134" class="node">
<title>out3_13</title>
<polygon fill="lightcoral" stroke="lightcoral" points="2951,-824.95 2743,-824.95 2743,-771.95 2951,-771.95 2951,-824.95"/>
<text text-anchor="middle" x="2847" y="-809.75" font-family="Times,serif" font-size="14.00">Output Proj 13</text>
<text text-anchor="middle" x="2847" y="-794.75" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="2847" y="-779.75" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- attn3_13&#45;&gt;out3_13 -->
<g id="edge166" class="edge">
<title>attn3_13&#45;&gt;out3_13</title>
<path fill="none" stroke="black" d="M2847,-872.68C2847,-861.23 2847,-847.55 2847,-835.13"/>
<polygon fill="black" stroke="black" points="2850.5,-835.07 2847,-825.07 2843.5,-835.07 2850.5,-835.07"/>
</g>
<!-- out3_14 -->
<g id="node135" class="node">
<title>out3_14</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3177,-824.95 2969,-824.95 2969,-771.95 3177,-771.95 3177,-824.95"/>
<text text-anchor="middle" x="3073" y="-809.75" font-family="Times,serif" font-size="14.00">Output Proj 14</text>
<text text-anchor="middle" x="3073" y="-794.75" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="3073" y="-779.75" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- attn3_14&#45;&gt;out3_14 -->
<g id="edge170" class="edge">
<title>attn3_14&#45;&gt;out3_14</title>
<path fill="none" stroke="black" d="M3073,-872.68C3073,-861.23 3073,-847.55 3073,-835.13"/>
<polygon fill="black" stroke="black" points="3076.5,-835.07 3073,-825.07 3069.5,-835.07 3076.5,-835.07"/>
</g>
<!-- out3_15 -->
<g id="node136" class="node">
<title>out3_15</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3403,-824.95 3195,-824.95 3195,-771.95 3403,-771.95 3403,-824.95"/>
<text text-anchor="middle" x="3299" y="-809.75" font-family="Times,serif" font-size="14.00">Output Proj 15</text>
<text text-anchor="middle" x="3299" y="-794.75" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model/8]</text>
<text text-anchor="middle" x="3299" y="-779.75" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- attn3_15&#45;&gt;out3_15 -->
<g id="edge174" class="edge">
<title>attn3_15&#45;&gt;out3_15</title>
<path fill="none" stroke="black" d="M3299,-872.68C3299,-861.23 3299,-847.55 3299,-835.13"/>
<polygon fill="black" stroke="black" points="3302.5,-835.07 3299,-825.07 3295.5,-835.07 3302.5,-835.07"/>
</g>
<!-- ar3 -->
<g id="node137" class="node">
<title>ar3</title>
<ellipse fill="lightcoral" stroke="lightcoral" cx="2847" cy="-697.48" rx="111.03" ry="37.45"/>
<text text-anchor="middle" x="2847" y="-708.78" font-family="Times,serif" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="2847" y="-693.78" font-family="Times,serif" font-size="14.00">Sum across 8 GPUs</text>
<text text-anchor="middle" x="2847" y="-678.78" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15</text>
</g>
<!-- out3_8&#45;&gt;ar3 -->
<g id="edge147" class="edge">
<title>out3_8&#45;&gt;ar3</title>
<path fill="none" stroke="black" d="M3420.71,-773.55C3417.78,-773 3414.87,-772.46 3412,-771.95 3257.43,-744.52 3077.35,-722.86 2962.81,-710.36"/>
<polygon fill="black" stroke="black" points="2962.94,-706.86 2952.62,-709.25 2962.18,-713.81 2962.94,-706.86"/>
</g>
<!-- out3_9&#45;&gt;ar3 -->
<g id="edge151" class="edge">
<title>out3_9&#45;&gt;ar3</title>
<path fill="none" stroke="black" d="M2047.26,-773.41C2050.2,-772.9 2053.12,-772.41 2056,-771.95 2292.59,-734.43 2572.25,-714 2727.63,-704.74"/>
<polygon fill="black" stroke="black" points="2727.91,-708.23 2737.69,-704.15 2727.5,-701.25 2727.91,-708.23"/>
</g>
<!-- out3_10&#45;&gt;ar3 -->
<g id="edge155" class="edge">
<title>out3_10&#45;&gt;ar3</title>
<path fill="none" stroke="black" d="M2273.29,-773.55C2276.22,-773 2279.13,-772.46 2282,-771.95 2436.57,-744.52 2616.65,-722.86 2731.19,-710.36"/>
<polygon fill="black" stroke="black" points="2731.82,-713.81 2741.38,-709.25 2731.06,-706.86 2731.82,-713.81"/>
</g>
<!-- out3_11&#45;&gt;ar3 -->
<g id="edge159" class="edge">
<title>out3_11&#45;&gt;ar3</title>
<path fill="none" stroke="black" d="M2499.05,-773.94C2502.07,-773.27 2505.05,-772.6 2508,-771.95 2587.28,-754.42 2677.08,-734.97 2744.33,-720.49"/>
<polygon fill="black" stroke="black" points="2745.47,-723.83 2754.51,-718.3 2744,-716.98 2745.47,-723.83"/>
</g>
<!-- out3_12&#45;&gt;ar3 -->
<g id="edge163" class="edge">
<title>out3_12&#45;&gt;ar3</title>
<path fill="none" stroke="black" d="M2679.49,-771.84C2707.35,-759.64 2741.01,-744.9 2770.83,-731.84"/>
<polygon fill="black" stroke="black" points="2772.6,-734.88 2780.36,-727.66 2769.8,-728.47 2772.6,-734.88"/>
</g>
<!-- out3_13&#45;&gt;ar3 -->
<g id="edge167" class="edge">
<title>out3_13&#45;&gt;ar3</title>
<path fill="none" stroke="black" d="M2847,-771.71C2847,-763.63 2847,-754.45 2847,-745.39"/>
<polygon fill="black" stroke="black" points="2850.5,-745.27 2847,-735.27 2843.5,-745.27 2850.5,-745.27"/>
</g>
<!-- out3_14&#45;&gt;ar3 -->
<g id="edge171" class="edge">
<title>out3_14&#45;&gt;ar3</title>
<path fill="none" stroke="black" d="M3014.51,-771.84C2986.65,-759.64 2952.99,-744.9 2923.17,-731.84"/>
<polygon fill="black" stroke="black" points="2924.2,-728.47 2913.64,-727.66 2921.4,-734.88 2924.2,-728.47"/>
</g>
<!-- out3_15&#45;&gt;ar3 -->
<g id="edge175" class="edge">
<title>out3_15&#45;&gt;ar3</title>
<path fill="none" stroke="black" d="M3194.95,-773.94C3191.93,-773.27 3188.95,-772.6 3186,-771.95 3106.72,-754.42 3016.92,-734.97 2949.67,-720.49"/>
<polygon fill="black" stroke="black" points="2950,-716.98 2939.49,-718.3 2948.53,-723.83 2950,-716.98"/>
</g>
<!-- ar3&#45;&gt;res3 -->
<g id="edge176" class="edge">
<title>ar3&#45;&gt;res3</title>
<path fill="none" stroke="black" d="M2934.57,-674.28C3041.23,-647.24 3222.62,-601.26 3347.63,-569.57"/>
<polygon fill="black" stroke="black" points="3348.83,-572.88 3357.66,-567.03 3347.1,-566.09 3348.83,-572.88"/>
</g>
<!-- expert3_0_1 -->
<g id="node138" class="node">
<title>expert3_0_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="5492,-925.93 5304,-925.93 5304,-872.93 5492,-872.93 5492,-925.93"/>
<text text-anchor="middle" x="5398" y="-910.73" font-family="Times,serif" font-size="14.00">Expert 8 Linear1</text>
<text text-anchor="middle" x="5398" y="-895.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="5398" y="-880.73" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- expert3_0_act -->
<g id="node139" class="node">
<title>expert3_0_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="5460.5,-817.45 5335.5,-817.45 5335.5,-779.45 5460.5,-779.45 5460.5,-817.45"/>
<text text-anchor="middle" x="5398" y="-802.25" font-family="Times,serif" font-size="14.00">Expert 8 GELU</text>
<text text-anchor="middle" x="5398" y="-787.25" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- expert3_0_1&#45;&gt;expert3_0_act -->
<g id="edge181" class="edge">
<title>expert3_0_1&#45;&gt;expert3_0_act</title>
<path fill="none" stroke="black" d="M5398,-872.68C5398,-858.9 5398,-841.89 5398,-827.74"/>
<polygon fill="black" stroke="black" points="5401.5,-827.58 5398,-817.58 5394.5,-827.58 5401.5,-827.58"/>
</g>
<!-- expert3_0_2 -->
<g id="node140" class="node">
<title>expert3_0_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="5493,-723.98 5299,-723.98 5299,-670.98 5493,-670.98 5493,-723.98"/>
<text text-anchor="middle" x="5396" y="-708.78" font-family="Times,serif" font-size="14.00">Expert 8 Linear2</text>
<text text-anchor="middle" x="5396" y="-693.78" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="5396" y="-678.78" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- expert3_0_act&#45;&gt;expert3_0_2 -->
<g id="edge182" class="edge">
<title>expert3_0_act&#45;&gt;expert3_0_2</title>
<path fill="none" stroke="black" d="M5397.63,-779.3C5397.38,-766.78 5397.04,-749.73 5396.73,-734.51"/>
<polygon fill="black" stroke="black" points="5400.22,-734.27 5396.52,-724.34 5393.23,-734.41 5400.22,-734.27"/>
</g>
<!-- combine3 -->
<g id="node164" class="node">
<title>combine3</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4747.19,-587 4373.06,-587 4276.81,-481 4650.94,-481 4747.19,-587"/>
<text text-anchor="middle" x="4512" y="-545.3" font-family="Times,serif" font-size="14.00">Combine Expert Outputs</text>
<text text-anchor="middle" x="4512" y="-530.3" font-family="Times,serif" font-size="14.00">Weighted sum by gate scores</text>
<text text-anchor="middle" x="4512" y="-515.3" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15</text>
</g>
<!-- expert3_0_2&#45;&gt;combine3 -->
<g id="edge183" class="edge">
<title>expert3_0_2&#45;&gt;combine3</title>
<path fill="none" stroke="black" d="M5343.28,-670.91C5325.22,-663.37 5304.62,-656.05 5285,-652 5242.98,-643.33 4941.86,-643.9 4899,-642 4867.19,-640.59 4787.06,-640.02 4756,-633 4713.54,-623.4 4668.86,-607.35 4629.5,-591"/>
<polygon fill="black" stroke="black" points="4630.72,-587.71 4620.14,-587.06 4628,-594.16 4630.72,-587.71"/>
</g>
<!-- expert3_1_1 -->
<g id="node141" class="node">
<title>expert3_1_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3982,-925.93 3794,-925.93 3794,-872.93 3982,-872.93 3982,-925.93"/>
<text text-anchor="middle" x="3888" y="-910.73" font-family="Times,serif" font-size="14.00">Expert 9 Linear1</text>
<text text-anchor="middle" x="3888" y="-895.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="3888" y="-880.73" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- expert3_1_act -->
<g id="node142" class="node">
<title>expert3_1_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3951.5,-817.45 3826.5,-817.45 3826.5,-779.45 3951.5,-779.45 3951.5,-817.45"/>
<text text-anchor="middle" x="3889" y="-802.25" font-family="Times,serif" font-size="14.00">Expert 9 GELU</text>
<text text-anchor="middle" x="3889" y="-787.25" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- expert3_1_1&#45;&gt;expert3_1_act -->
<g id="edge185" class="edge">
<title>expert3_1_1&#45;&gt;expert3_1_act</title>
<path fill="none" stroke="black" d="M3888.26,-872.68C3888.4,-858.9 3888.57,-841.89 3888.71,-827.74"/>
<polygon fill="black" stroke="black" points="3892.22,-827.61 3888.82,-817.58 3885.22,-827.54 3892.22,-827.61"/>
</g>
<!-- expert3_1_2 -->
<g id="node143" class="node">
<title>expert3_1_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3987,-723.98 3793,-723.98 3793,-670.98 3987,-670.98 3987,-723.98"/>
<text text-anchor="middle" x="3890" y="-708.78" font-family="Times,serif" font-size="14.00">Expert 9 Linear2</text>
<text text-anchor="middle" x="3890" y="-693.78" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="3890" y="-678.78" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- expert3_1_act&#45;&gt;expert3_1_2 -->
<g id="edge186" class="edge">
<title>expert3_1_act&#45;&gt;expert3_1_2</title>
<path fill="none" stroke="black" d="M3889.18,-779.3C3889.31,-766.78 3889.48,-749.73 3889.64,-734.51"/>
<polygon fill="black" stroke="black" points="3893.14,-734.38 3889.74,-724.34 3886.14,-734.31 3893.14,-734.38"/>
</g>
<!-- expert3_1_2&#45;&gt;combine3 -->
<g id="edge187" class="edge">
<title>expert3_1_2&#45;&gt;combine3</title>
<path fill="none" stroke="black" d="M3948.72,-670.97C3965.42,-664.25 3983.76,-657.39 4001,-652 4113.22,-616.9 4242.33,-587.43 4342.69,-566.85"/>
<polygon fill="black" stroke="black" points="4343.52,-570.25 4352.62,-564.82 4342.12,-563.39 4343.52,-570.25"/>
</g>
<!-- expert3_2_1 -->
<g id="node144" class="node">
<title>expert3_2_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4526,-925.93 4338,-925.93 4338,-872.93 4526,-872.93 4526,-925.93"/>
<text text-anchor="middle" x="4432" y="-910.73" font-family="Times,serif" font-size="14.00">Expert 10 Linear1</text>
<text text-anchor="middle" x="4432" y="-895.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="4432" y="-880.73" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- expert3_2_act -->
<g id="node145" class="node">
<title>expert3_2_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4499,-817.45 4365,-817.45 4365,-779.45 4499,-779.45 4499,-817.45"/>
<text text-anchor="middle" x="4432" y="-802.25" font-family="Times,serif" font-size="14.00">Expert 10 GELU</text>
<text text-anchor="middle" x="4432" y="-787.25" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- expert3_2_1&#45;&gt;expert3_2_act -->
<g id="edge189" class="edge">
<title>expert3_2_1&#45;&gt;expert3_2_act</title>
<path fill="none" stroke="black" d="M4432,-872.68C4432,-858.9 4432,-841.89 4432,-827.74"/>
<polygon fill="black" stroke="black" points="4435.5,-827.58 4432,-817.58 4428.5,-827.58 4435.5,-827.58"/>
</g>
<!-- expert3_2_2 -->
<g id="node146" class="node">
<title>expert3_2_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4527,-723.98 4333,-723.98 4333,-670.98 4527,-670.98 4527,-723.98"/>
<text text-anchor="middle" x="4430" y="-708.78" font-family="Times,serif" font-size="14.00">Expert 10 Linear2</text>
<text text-anchor="middle" x="4430" y="-693.78" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="4430" y="-678.78" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- expert3_2_act&#45;&gt;expert3_2_2 -->
<g id="edge190" class="edge">
<title>expert3_2_act&#45;&gt;expert3_2_2</title>
<path fill="none" stroke="black" d="M4431.63,-779.3C4431.38,-766.78 4431.04,-749.73 4430.73,-734.51"/>
<polygon fill="black" stroke="black" points="4434.22,-734.27 4430.52,-724.34 4427.23,-734.41 4434.22,-734.27"/>
</g>
<!-- expert3_2_2&#45;&gt;combine3 -->
<g id="edge191" class="edge">
<title>expert3_2_2&#45;&gt;combine3</title>
<path fill="none" stroke="black" d="M4442.99,-670.89C4453.17,-650.84 4467.77,-622.11 4480.91,-596.22"/>
<polygon fill="black" stroke="black" points="4484.08,-597.7 4485.49,-587.2 4477.84,-594.53 4484.08,-597.7"/>
</g>
<!-- expert3_3_1 -->
<g id="node147" class="node">
<title>expert3_3_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="6136,-925.93 5948,-925.93 5948,-872.93 6136,-872.93 6136,-925.93"/>
<text text-anchor="middle" x="6042" y="-910.73" font-family="Times,serif" font-size="14.00">Expert 11 Linear1</text>
<text text-anchor="middle" x="6042" y="-895.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="6042" y="-880.73" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- expert3_3_act -->
<g id="node148" class="node">
<title>expert3_3_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="6108,-817.45 5974,-817.45 5974,-779.45 6108,-779.45 6108,-817.45"/>
<text text-anchor="middle" x="6041" y="-802.25" font-family="Times,serif" font-size="14.00">Expert 11 GELU</text>
<text text-anchor="middle" x="6041" y="-787.25" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- expert3_3_1&#45;&gt;expert3_3_act -->
<g id="edge193" class="edge">
<title>expert3_3_1&#45;&gt;expert3_3_act</title>
<path fill="none" stroke="black" d="M6041.74,-872.68C6041.6,-858.9 6041.43,-841.89 6041.29,-827.74"/>
<polygon fill="black" stroke="black" points="6044.78,-827.54 6041.18,-817.58 6037.78,-827.61 6044.78,-827.54"/>
</g>
<!-- expert3_3_2 -->
<g id="node149" class="node">
<title>expert3_3_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="6137,-723.98 5943,-723.98 5943,-670.98 6137,-670.98 6137,-723.98"/>
<text text-anchor="middle" x="6040" y="-708.78" font-family="Times,serif" font-size="14.00">Expert 11 Linear2</text>
<text text-anchor="middle" x="6040" y="-693.78" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="6040" y="-678.78" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- expert3_3_act&#45;&gt;expert3_3_2 -->
<g id="edge194" class="edge">
<title>expert3_3_act&#45;&gt;expert3_3_2</title>
<path fill="none" stroke="black" d="M6040.82,-779.3C6040.69,-766.78 6040.52,-749.73 6040.36,-734.51"/>
<polygon fill="black" stroke="black" points="6043.86,-734.31 6040.26,-724.34 6036.86,-734.38 6043.86,-734.31"/>
</g>
<!-- expert3_3_2&#45;&gt;combine3 -->
<g id="edge195" class="edge">
<title>expert3_3_2&#45;&gt;combine3</title>
<path fill="none" stroke="black" d="M5987.58,-670.92C5969.46,-663.32 5948.74,-655.97 5929,-652 5897.05,-645.57 4787.94,-639.44 4756,-633 4712.31,-624.19 4666.45,-607.84 4626.43,-590.99"/>
<polygon fill="black" stroke="black" points="4627.76,-587.75 4617.19,-587.04 4625.01,-594.19 4627.76,-587.75"/>
</g>
<!-- expert3_4_1 -->
<g id="node150" class="node">
<title>expert3_4_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="5815,-925.93 5627,-925.93 5627,-872.93 5815,-872.93 5815,-925.93"/>
<text text-anchor="middle" x="5721" y="-910.73" font-family="Times,serif" font-size="14.00">Expert 12 Linear1</text>
<text text-anchor="middle" x="5721" y="-895.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="5721" y="-880.73" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- expert3_4_act -->
<g id="node151" class="node">
<title>expert3_4_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="5787,-817.45 5653,-817.45 5653,-779.45 5787,-779.45 5787,-817.45"/>
<text text-anchor="middle" x="5720" y="-802.25" font-family="Times,serif" font-size="14.00">Expert 12 GELU</text>
<text text-anchor="middle" x="5720" y="-787.25" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- expert3_4_1&#45;&gt;expert3_4_act -->
<g id="edge197" class="edge">
<title>expert3_4_1&#45;&gt;expert3_4_act</title>
<path fill="none" stroke="black" d="M5720.74,-872.68C5720.6,-858.9 5720.43,-841.89 5720.29,-827.74"/>
<polygon fill="black" stroke="black" points="5723.78,-827.54 5720.18,-817.58 5716.78,-827.61 5723.78,-827.54"/>
</g>
<!-- expert3_4_2 -->
<g id="node152" class="node">
<title>expert3_4_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="5815,-723.98 5621,-723.98 5621,-670.98 5815,-670.98 5815,-723.98"/>
<text text-anchor="middle" x="5718" y="-708.78" font-family="Times,serif" font-size="14.00">Expert 12 Linear2</text>
<text text-anchor="middle" x="5718" y="-693.78" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="5718" y="-678.78" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- expert3_4_act&#45;&gt;expert3_4_2 -->
<g id="edge198" class="edge">
<title>expert3_4_act&#45;&gt;expert3_4_2</title>
<path fill="none" stroke="black" d="M5719.63,-779.3C5719.38,-766.78 5719.04,-749.73 5718.73,-734.51"/>
<polygon fill="black" stroke="black" points="5722.22,-734.27 5718.52,-724.34 5715.23,-734.41 5722.22,-734.27"/>
</g>
<!-- expert3_4_2&#45;&gt;combine3 -->
<g id="edge199" class="edge">
<title>expert3_4_2&#45;&gt;combine3</title>
<path fill="none" stroke="black" d="M5665.28,-670.87C5647.23,-663.32 5626.63,-656.01 5607,-652 5560.67,-642.53 4802.33,-642.49 4756,-633 4712.44,-624.07 4666.7,-607.75 4626.74,-590.95"/>
<polygon fill="black" stroke="black" points="4628.09,-587.72 4617.52,-587.02 4625.35,-594.16 4628.09,-587.72"/>
</g>
<!-- expert3_5_1 -->
<g id="node153" class="node">
<title>expert3_5_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4304,-925.93 4116,-925.93 4116,-872.93 4304,-872.93 4304,-925.93"/>
<text text-anchor="middle" x="4210" y="-910.73" font-family="Times,serif" font-size="14.00">Expert 13 Linear1</text>
<text text-anchor="middle" x="4210" y="-895.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="4210" y="-880.73" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- expert3_5_act -->
<g id="node154" class="node">
<title>expert3_5_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4278,-817.45 4144,-817.45 4144,-779.45 4278,-779.45 4278,-817.45"/>
<text text-anchor="middle" x="4211" y="-802.25" font-family="Times,serif" font-size="14.00">Expert 13 GELU</text>
<text text-anchor="middle" x="4211" y="-787.25" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- expert3_5_1&#45;&gt;expert3_5_act -->
<g id="edge201" class="edge">
<title>expert3_5_1&#45;&gt;expert3_5_act</title>
<path fill="none" stroke="black" d="M4210.26,-872.68C4210.4,-858.9 4210.57,-841.89 4210.71,-827.74"/>
<polygon fill="black" stroke="black" points="4214.22,-827.61 4210.82,-817.58 4207.22,-827.54 4214.22,-827.61"/>
</g>
<!-- expert3_5_2 -->
<g id="node155" class="node">
<title>expert3_5_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4309,-723.98 4115,-723.98 4115,-670.98 4309,-670.98 4309,-723.98"/>
<text text-anchor="middle" x="4212" y="-708.78" font-family="Times,serif" font-size="14.00">Expert 13 Linear2</text>
<text text-anchor="middle" x="4212" y="-693.78" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="4212" y="-678.78" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- expert3_5_act&#45;&gt;expert3_5_2 -->
<g id="edge202" class="edge">
<title>expert3_5_act&#45;&gt;expert3_5_2</title>
<path fill="none" stroke="black" d="M4211.18,-779.3C4211.31,-766.78 4211.48,-749.73 4211.64,-734.51"/>
<polygon fill="black" stroke="black" points="4215.14,-734.38 4211.74,-724.34 4208.14,-734.31 4215.14,-734.38"/>
</g>
<!-- expert3_5_2&#45;&gt;combine3 -->
<g id="edge203" class="edge">
<title>expert3_5_2&#45;&gt;combine3</title>
<path fill="none" stroke="black" d="M4259.54,-670.89C4298.89,-649.71 4356.27,-618.82 4406.39,-591.85"/>
<polygon fill="black" stroke="black" points="4408.18,-594.86 4415.33,-587.03 4404.86,-588.69 4408.18,-594.86"/>
</g>
<!-- expert3_6_1 -->
<g id="node156" class="node">
<title>expert3_6_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="5170,-925.93 4982,-925.93 4982,-872.93 5170,-872.93 5170,-925.93"/>
<text text-anchor="middle" x="5076" y="-910.73" font-family="Times,serif" font-size="14.00">Expert 14 Linear1</text>
<text text-anchor="middle" x="5076" y="-895.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="5076" y="-880.73" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- expert3_6_act -->
<g id="node157" class="node">
<title>expert3_6_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="5143,-817.45 5009,-817.45 5009,-779.45 5143,-779.45 5143,-817.45"/>
<text text-anchor="middle" x="5076" y="-802.25" font-family="Times,serif" font-size="14.00">Expert 14 GELU</text>
<text text-anchor="middle" x="5076" y="-787.25" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- expert3_6_1&#45;&gt;expert3_6_act -->
<g id="edge205" class="edge">
<title>expert3_6_1&#45;&gt;expert3_6_act</title>
<path fill="none" stroke="black" d="M5076,-872.68C5076,-858.9 5076,-841.89 5076,-827.74"/>
<polygon fill="black" stroke="black" points="5079.5,-827.58 5076,-817.58 5072.5,-827.58 5079.5,-827.58"/>
</g>
<!-- expert3_6_2 -->
<g id="node158" class="node">
<title>expert3_6_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="5171,-723.98 4977,-723.98 4977,-670.98 5171,-670.98 5171,-723.98"/>
<text text-anchor="middle" x="5074" y="-708.78" font-family="Times,serif" font-size="14.00">Expert 14 Linear2</text>
<text text-anchor="middle" x="5074" y="-693.78" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="5074" y="-678.78" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- expert3_6_act&#45;&gt;expert3_6_2 -->
<g id="edge206" class="edge">
<title>expert3_6_act&#45;&gt;expert3_6_2</title>
<path fill="none" stroke="black" d="M5075.63,-779.3C5075.38,-766.78 5075.04,-749.73 5074.73,-734.51"/>
<polygon fill="black" stroke="black" points="5078.22,-734.27 5074.52,-724.34 5071.23,-734.41 5078.22,-734.27"/>
</g>
<!-- expert3_6_2&#45;&gt;combine3 -->
<g id="edge207" class="edge">
<title>expert3_6_2&#45;&gt;combine3</title>
<path fill="none" stroke="black" d="M5019.73,-670.96C5002.01,-663.65 4982,-656.47 4963,-652 4873.07,-630.84 4845.64,-655.35 4756,-633 4714.58,-622.67 4670.87,-606.82 4632.06,-590.85"/>
<polygon fill="black" stroke="black" points="4633.41,-587.62 4622.83,-587.01 4630.72,-594.08 4633.41,-587.62"/>
</g>
<!-- expert3_7_1 -->
<g id="node159" class="node">
<title>expert3_7_1</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4848,-925.93 4660,-925.93 4660,-872.93 4848,-872.93 4848,-925.93"/>
<text text-anchor="middle" x="4754" y="-910.73" font-family="Times,serif" font-size="14.00">Expert 15 Linear1</text>
<text text-anchor="middle" x="4754" y="-895.73" font-family="Times,serif" font-size="14.00">Output: [B, L/P, ffn_dim]</text>
<text text-anchor="middle" x="4754" y="-880.73" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- expert3_7_act -->
<g id="node160" class="node">
<title>expert3_7_act</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4821,-817.45 4687,-817.45 4687,-779.45 4821,-779.45 4821,-817.45"/>
<text text-anchor="middle" x="4754" y="-802.25" font-family="Times,serif" font-size="14.00">Expert 15 GELU</text>
<text text-anchor="middle" x="4754" y="-787.25" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- expert3_7_1&#45;&gt;expert3_7_act -->
<g id="edge209" class="edge">
<title>expert3_7_1&#45;&gt;expert3_7_act</title>
<path fill="none" stroke="black" d="M4754,-872.68C4754,-858.9 4754,-841.89 4754,-827.74"/>
<polygon fill="black" stroke="black" points="4757.5,-827.58 4754,-817.58 4750.5,-827.58 4757.5,-827.58"/>
</g>
<!-- expert3_7_2 -->
<g id="node161" class="node">
<title>expert3_7_2</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4849,-723.98 4655,-723.98 4655,-670.98 4849,-670.98 4849,-723.98"/>
<text text-anchor="middle" x="4752" y="-708.78" font-family="Times,serif" font-size="14.00">Expert 15 Linear2</text>
<text text-anchor="middle" x="4752" y="-693.78" font-family="Times,serif" font-size="14.00">Output: [B, L/P, d_model]</text>
<text text-anchor="middle" x="4752" y="-678.78" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- expert3_7_act&#45;&gt;expert3_7_2 -->
<g id="edge210" class="edge">
<title>expert3_7_act&#45;&gt;expert3_7_2</title>
<path fill="none" stroke="black" d="M4753.63,-779.3C4753.38,-766.78 4753.04,-749.73 4752.73,-734.51"/>
<polygon fill="black" stroke="black" points="4756.22,-734.27 4752.52,-724.34 4749.23,-734.41 4756.22,-734.27"/>
</g>
<!-- expert3_7_2&#45;&gt;combine3 -->
<g id="edge211" class="edge">
<title>expert3_7_2&#45;&gt;combine3</title>
<path fill="none" stroke="black" d="M4713.97,-670.89C4682.88,-649.97 4637.71,-619.58 4597.97,-592.85"/>
<polygon fill="black" stroke="black" points="4599.84,-589.88 4589.58,-587.2 4595.93,-595.69 4599.84,-589.88"/>
</g>
<!-- gate3 -->
<g id="node162" class="node">
<title>gate3</title>
<polygon fill="lightcoral" stroke="lightcoral" points="4953,-602 4765,-534 4953,-466 5141,-534 4953,-602"/>
<text text-anchor="middle" x="4953" y="-552.8" font-family="Times,serif" font-size="14.00">Gate</text>
<text text-anchor="middle" x="4953" y="-537.8" font-family="Times,serif" font-size="14.00">Compute routing scores</text>
<text text-anchor="middle" x="4953" y="-522.8" font-family="Times,serif" font-size="14.00">Input: [B, L/P, d_model]</text>
<text text-anchor="middle" x="4953" y="-507.8" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15</text>
</g>
<!-- select3 -->
<g id="node163" class="node">
<title>select3</title>
<polygon fill="lightcoral" stroke="lightcoral" points="5141.13,-414 4868.9,-414 4798.87,-338 5071.1,-338 5141.13,-414"/>
<text text-anchor="middle" x="4970" y="-379.8" font-family="Times,serif" font-size="14.00">Select Top&#45;2 Experts</text>
<text text-anchor="middle" x="4970" y="-364.8" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15</text>
</g>
<!-- gate3&#45;&gt;select3 -->
<g id="edge179" class="edge">
<title>gate3&#45;&gt;select3</title>
<path fill="none" stroke="black" d="M4960.06,-468.2C4961.66,-453.52 4963.33,-438.2 4964.83,-424.4"/>
<polygon fill="black" stroke="black" points="4968.34,-424.5 4965.95,-414.18 4961.39,-423.75 4968.34,-424.5"/>
</g>
<!-- select3&#45;&gt;expert3_0_1 -->
<g id="edge180" class="edge">
<title>select3&#45;&gt;expert3_0_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5118.33,-389.15C5283.94,-406.91 5529,-447.61 5529,-533 5529,-799.45 5529,-799.45 5529,-799.45 5529,-830.06 5505.95,-852.41 5479.19,-868.03"/>
<polygon fill="black" stroke="black" points="5477.47,-864.99 5470.4,-872.87 5480.85,-871.12 5477.47,-864.99"/>
<text text-anchor="middle" x="5566" y="-693.78" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- select3&#45;&gt;expert3_1_1 -->
<g id="edge184" class="edge">
<title>select3&#45;&gt;expert3_1_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4837.19,-379.61C4511.77,-387.75 3701,-419.45 3701,-533 3701,-799.45 3701,-799.45 3701,-799.45 3701,-842.99 3741.09,-867.43 3784.15,-881.13"/>
<polygon fill="black" stroke="black" points="3783.37,-884.55 3793.95,-884.05 3785.37,-877.84 3783.37,-884.55"/>
<text text-anchor="middle" x="3738" y="-693.78" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- select3&#45;&gt;expert3_2_1 -->
<g id="edge188" class="edge">
<title>select3&#45;&gt;expert3_2_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4841.16,-384.25C4648.85,-396.4 4305.21,-423.77 4268,-466 4218.93,-521.69 4217.41,-578.69 4268,-633 4308.7,-676.69 4495.3,-608.31 4536,-652 4589.08,-708.98 4548.83,-758.65 4508,-824.95 4498.76,-839.97 4485.75,-854.06 4473.1,-865.81"/>
<polygon fill="black" stroke="black" points="4470.41,-863.52 4465.31,-872.8 4475.09,-868.72 4470.41,-863.52"/>
<text text-anchor="middle" x="4598" y="-693.78" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- select3&#45;&gt;expert3_3_1 -->
<g id="edge192" class="edge">
<title>select3&#45;&gt;expert3_3_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5110.65,-380.79C5428.15,-391.2 6173,-426.94 6173,-533 6173,-799.45 6173,-799.45 6173,-799.45 6173,-830.06 6149.95,-852.41 6123.19,-868.03"/>
<polygon fill="black" stroke="black" points="6121.47,-864.99 6114.4,-872.87 6124.85,-871.12 6121.47,-864.99"/>
<text text-anchor="middle" x="6210" y="-693.78" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- select3&#45;&gt;expert3_4_1 -->
<g id="edge196" class="edge">
<title>select3&#45;&gt;expert3_4_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5117.46,-388.21C5368.26,-409.29 5851,-459.41 5851,-533 5851,-799.45 5851,-799.45 5851,-799.45 5851,-829.78 5828.33,-852.04 5801.92,-867.68"/>
<polygon fill="black" stroke="black" points="5799.88,-864.81 5792.84,-872.73 5803.28,-870.93 5799.88,-864.81"/>
<text text-anchor="middle" x="5888" y="-693.78" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- select3&#45;&gt;expert3_5_1 -->
<g id="edge200" class="edge">
<title>select3&#45;&gt;expert3_5_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4841.79,-385C4583.08,-402.86 4023,-450.99 4023,-533 4023,-799.45 4023,-799.45 4023,-799.45 4023,-842.99 4063.09,-867.43 4106.15,-881.13"/>
<polygon fill="black" stroke="black" points="4105.37,-884.55 4115.95,-884.05 4107.37,-877.84 4105.37,-884.55"/>
<text text-anchor="middle" x="4060" y="-693.78" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- select3&#45;&gt;expert3_6_1 -->
<g id="edge204" class="edge">
<title>select3&#45;&gt;expert3_6_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5138.3,-414.06C5154.86,-422.82 5170.23,-433.63 5183,-447 5210.42,-475.69 5207,-493.32 5207,-533 5207,-799.45 5207,-799.45 5207,-799.45 5207,-830.06 5183.95,-852.41 5157.19,-868.03"/>
<polygon fill="black" stroke="black" points="5155.47,-864.99 5148.4,-872.87 5158.85,-871.12 5155.47,-864.99"/>
<text text-anchor="middle" x="5244" y="-693.78" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- select3&#45;&gt;expert3_7_1 -->
<g id="edge208" class="edge">
<title>select3&#45;&gt;expert3_7_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5092.02,-414.25C5115.04,-426.95 5136.2,-443.79 5150,-466 5189.16,-529.05 5200.53,-578.63 5150,-633 5110.71,-675.27 4936.86,-616.96 4891,-652 4874.81,-664.37 4841.01,-807.81 4830,-824.95 4820.48,-839.79 4807.4,-853.84 4794.78,-865.6"/>
<polygon fill="black" stroke="black" points="4792.08,-863.31 4787.01,-872.61 4796.78,-868.51 4792.08,-863.31"/>
<text text-anchor="middle" x="4928" y="-693.78" font-family="Times,serif" font-size="14.00">if selected</text>
</g>
<!-- res_moe3 -->
<g id="node166" class="node">
<title>res_moe3</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3672.88,-429 3372.42,-429 3295.12,-323 3595.58,-323 3672.88,-429"/>
<text text-anchor="middle" x="3484" y="-387.3" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="3484" y="-372.3" font-family="Times,serif" font-size="14.00">Input: [B, L/P, d_model]</text>
<text text-anchor="middle" x="3484" y="-357.3" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15</text>
</g>
<!-- combine3&#45;&gt;res_moe3 -->
<g id="edge212" class="edge">
<title>combine3&#45;&gt;res_moe3</title>
<path fill="none" stroke="black" d="M4293.99,-499.92C4106.52,-471.47 3839.37,-430.93 3663.89,-404.3"/>
<polygon fill="black" stroke="black" points="3664.19,-400.8 3653.78,-402.76 3663.14,-407.73 3664.19,-400.8"/>
</g>
<!-- res3&#45;&gt;gate3 -->
<g id="edge178" class="edge">
<title>res3&#45;&gt;gate3</title>
<path fill="none" stroke="black" d="M3656.68,-564.64C3816.26,-591.3 4060.26,-627.89 4274,-642.5 4326.43,-646.08 4695.98,-655.11 4747,-642.5 4793.68,-630.96 4841.46,-606.71 4879.24,-584.06"/>
<polygon fill="black" stroke="black" points="4881.4,-586.84 4888.13,-578.65 4877.76,-580.86 4881.4,-586.84"/>
</g>
<!-- res3&#45;&gt;res_moe3 -->
<g id="edge213" class="edge">
<title>res3&#45;&gt;res_moe3</title>
<path fill="none" stroke="black" d="M3484,-480.62C3484,-467.43 3484,-453.14 3484,-439.51"/>
<polygon fill="black" stroke="black" points="3487.5,-439.24 3484,-429.24 3480.5,-439.24 3487.5,-439.24"/>
</g>
<!-- gather -->
<g id="node167" class="node">
<title>gather</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3657.28,-265 3381.63,-265 3310.72,-159 3586.37,-159 3657.28,-265"/>
<text text-anchor="middle" x="3484" y="-223.3" font-family="Times,serif" font-size="14.00">Gather from Pipeline</text>
<text text-anchor="middle" x="3484" y="-208.3" font-family="Times,serif" font-size="14.00">X: [B, L, d_model]</text>
<text text-anchor="middle" x="3484" y="-193.3" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15 → Host</text>
</g>
<!-- res_moe3&#45;&gt;gather -->
<g id="edge214" class="edge">
<title>res_moe3&#45;&gt;gather</title>
<path fill="none" stroke="black" d="M3484,-322.85C3484,-307.68 3484,-290.95 3484,-275.22"/>
<polygon fill="black" stroke="black" points="3487.5,-275.05 3484,-265.05 3480.5,-275.05 3487.5,-275.05"/>
</g>
<!-- output -->
<g id="node168" class="node">
<title>output</title>
<polygon fill="lightcoral" stroke="lightcoral" points="3632.01,-122 3396.56,-122 3335.99,-16 3571.44,-16 3632.01,-122"/>
<text text-anchor="middle" x="3484" y="-80.3" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="3484" y="-65.3" font-family="Times,serif" font-size="14.00">X: [B, L, d_model]</text>
<text text-anchor="middle" x="3484" y="-50.3" font-family="Times,serif" font-size="14.00">GPU: Host</text>
</g>
<!-- gather&#45;&gt;output -->
<g id="edge215" class="edge">
<title>gather&#45;&gt;output</title>
<path fill="none" stroke="black" d="M3484,-158.9C3484,-150.33 3484,-141.37 3484,-132.57"/>
<polygon fill="black" stroke="black" points="3487.5,-132.36 3484,-122.36 3480.5,-132.36 3487.5,-132.36"/>
</g>
</g>
</svg>
