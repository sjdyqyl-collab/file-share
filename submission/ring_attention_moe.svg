<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="1440pt" height="447pt"
 viewBox="0.00 0.00 1440.00 446.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.28 0.28) rotate(0) translate(4 1589.91)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1589.91 5133,-1589.91 5133,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_gpu_0</title>
<path fill="lightblue" stroke="black" d="M20,-132.74C20,-132.74 424,-132.74 424,-132.74 430,-132.74 436,-138.74 436,-144.74 436,-144.74 436,-1468.17 436,-1468.17 436,-1474.17 430,-1480.17 424,-1480.17 424,-1480.17 20,-1480.17 20,-1480.17 14,-1480.17 8,-1474.17 8,-1468.17 8,-1468.17 8,-144.74 8,-144.74 8,-138.74 14,-132.74 20,-132.74"/>
<text text-anchor="middle" x="222" y="-1464.97" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_gpu_1</title>
<path fill="lightgreen" stroke="black" d="M456,-132.74C456,-132.74 860,-132.74 860,-132.74 866,-132.74 872,-138.74 872,-144.74 872,-144.74 872,-1468.17 872,-1468.17 872,-1474.17 866,-1480.17 860,-1480.17 860,-1480.17 456,-1480.17 456,-1480.17 450,-1480.17 444,-1474.17 444,-1468.17 444,-1468.17 444,-144.74 444,-144.74 444,-138.74 450,-132.74 456,-132.74"/>
<text text-anchor="middle" x="658" y="-1464.97" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_gpu_2</title>
<path fill="lightyellow" stroke="black" d="M892,-132.74C892,-132.74 1296,-132.74 1296,-132.74 1302,-132.74 1308,-138.74 1308,-144.74 1308,-144.74 1308,-1468.17 1308,-1468.17 1308,-1474.17 1302,-1480.17 1296,-1480.17 1296,-1480.17 892,-1480.17 892,-1480.17 886,-1480.17 880,-1474.17 880,-1468.17 880,-1468.17 880,-144.74 880,-144.74 880,-138.74 886,-132.74 892,-132.74"/>
<text text-anchor="middle" x="1094" y="-1464.97" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_gpu_3</title>
<path fill="lightcoral" stroke="black" d="M1481,-132.74C1481,-132.74 1885,-132.74 1885,-132.74 1891,-132.74 1897,-138.74 1897,-144.74 1897,-144.74 1897,-1468.17 1897,-1468.17 1897,-1474.17 1891,-1480.17 1885,-1480.17 1885,-1480.17 1481,-1480.17 1481,-1480.17 1475,-1480.17 1469,-1474.17 1469,-1468.17 1469,-1468.17 1469,-144.74 1469,-144.74 1469,-138.74 1475,-132.74 1481,-132.74"/>
<text text-anchor="middle" x="1683" y="-1464.97" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<!-- total_input -->
<g id="node1" class="node">
<title>total_input</title>
<ellipse fill="lightgray" stroke="black" cx="827" cy="-1559.04" rx="87.86" ry="26.74"/>
<text text-anchor="middle" x="827" y="-1562.84" font-family="Times,serif" font-size="14.00">Total Input</text>
<text text-anchor="middle" x="827" y="-1547.84" font-family="Times,serif" font-size="14.00">(B, L, d_model)</text>
</g>
<!-- input_0 -->
<g id="node2" class="node">
<title>input_0</title>
<ellipse fill="white" stroke="black" cx="331" cy="-1388.7" rx="96.75" ry="37.45"/>
<text text-anchor="middle" x="331" y="-1400" font-family="Times,serif" font-size="14.00">Sequence Split</text>
<text text-anchor="middle" x="331" y="-1385" font-family="Times,serif" font-size="14.00">X[0]</text>
<text text-anchor="middle" x="331" y="-1370" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- total_input&#45;&gt;input_0 -->
<g id="edge1" class="edge">
<title>total_input&#45;&gt;input_0</title>
<path fill="none" stroke="black" d="M741.31,-1552.89C660.25,-1545.28 536.93,-1526.48 440,-1480.17 414.73,-1468.1 390.37,-1448.86 371.11,-1431.23"/>
<polygon fill="black" stroke="black" points="373.42,-1428.59 363.73,-1424.31 368.63,-1433.7 373.42,-1428.59"/>
</g>
<!-- input_1 -->
<g id="node12" class="node">
<title>input_1</title>
<ellipse fill="white" stroke="black" cx="767" cy="-1388.7" rx="96.75" ry="37.45"/>
<text text-anchor="middle" x="767" y="-1400" font-family="Times,serif" font-size="14.00">Sequence Split</text>
<text text-anchor="middle" x="767" y="-1385" font-family="Times,serif" font-size="14.00">X[1]</text>
<text text-anchor="middle" x="767" y="-1370" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- total_input&#45;&gt;input_1 -->
<g id="edge27" class="edge">
<title>total_input&#45;&gt;input_1</title>
<path fill="none" stroke="black" d="M817.76,-1532.11C808.62,-1506.48 794.45,-1466.71 783.4,-1435.71"/>
<polygon fill="black" stroke="black" points="786.58,-1434.22 779.93,-1425.98 779.99,-1436.57 786.58,-1434.22"/>
</g>
<!-- input_2 -->
<g id="node22" class="node">
<title>input_2</title>
<ellipse fill="white" stroke="black" cx="985" cy="-1388.7" rx="96.75" ry="37.45"/>
<text text-anchor="middle" x="985" y="-1400" font-family="Times,serif" font-size="14.00">Sequence Split</text>
<text text-anchor="middle" x="985" y="-1385" font-family="Times,serif" font-size="14.00">X[2]</text>
<text text-anchor="middle" x="985" y="-1370" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- total_input&#45;&gt;input_2 -->
<g id="edge53" class="edge">
<title>total_input&#45;&gt;input_2</title>
<path fill="none" stroke="black" d="M850.65,-1532.84C875.76,-1506.09 915.85,-1463.38 945.71,-1431.56"/>
<polygon fill="black" stroke="black" points="948.39,-1433.82 952.68,-1424.13 943.29,-1429.03 948.39,-1433.82"/>
</g>
<!-- input_3 -->
<g id="node32" class="node">
<title>input_3</title>
<ellipse fill="white" stroke="black" cx="1683" cy="-1388.7" rx="96.75" ry="37.45"/>
<text text-anchor="middle" x="1683" y="-1400" font-family="Times,serif" font-size="14.00">Sequence Split</text>
<text text-anchor="middle" x="1683" y="-1385" font-family="Times,serif" font-size="14.00">X[3]</text>
<text text-anchor="middle" x="1683" y="-1370" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- total_input&#45;&gt;input_3 -->
<g id="edge79" class="edge">
<title>total_input&#45;&gt;input_3</title>
<path fill="none" stroke="black" d="M906.32,-1547.3C1002.65,-1533.79 1169.89,-1508.86 1312,-1480.17 1409.33,-1460.52 1519.77,-1432.9 1594.65,-1413.35"/>
<polygon fill="black" stroke="black" points="1595.73,-1416.69 1604.52,-1410.77 1593.96,-1409.92 1595.73,-1416.69"/>
</g>
<!-- attention_0 -->
<g id="node3" class="node">
<title>attention_0</title>
<polygon fill="white" stroke="black" points="399.5,-1264.22 262.5,-1264.22 262.5,-1226.22 399.5,-1226.22 399.5,-1264.22"/>
<text text-anchor="middle" x="331" y="-1249.02" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="331" y="-1234.02" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- input_0&#45;&gt;attention_0 -->
<g id="edge2" class="edge">
<title>input_0&#45;&gt;attention_0</title>
<path fill="none" stroke="black" d="M331,-1350.9C331,-1326.97 331,-1296.26 331,-1274.31"/>
<polygon fill="black" stroke="black" points="334.5,-1274.3 331,-1264.3 327.5,-1274.3 334.5,-1274.3"/>
</g>
<!-- ln1_0 -->
<g id="node4" class="node">
<title>ln1_0</title>
<polygon fill="white" stroke="black" points="427.5,-1139.22 290.5,-1139.22 290.5,-1101.22 427.5,-1101.22 427.5,-1139.22"/>
<text text-anchor="middle" x="359" y="-1124.02" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="359" y="-1109.02" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- attention_0&#45;&gt;ln1_0 -->
<g id="edge3" class="edge">
<title>attention_0&#45;&gt;ln1_0</title>
<path fill="none" stroke="black" d="M335.13,-1226.07C339.74,-1205.81 347.26,-1172.79 352.63,-1149.22"/>
<polygon fill="black" stroke="black" points="356.04,-1149.97 354.85,-1139.44 349.22,-1148.42 356.04,-1149.97"/>
</g>
<!-- residual_0 -->
<g id="node10" class="node">
<title>residual_0</title>
<ellipse fill="white" stroke="black" cx="286" cy="-308.35" rx="96.75" ry="26.74"/>
<text text-anchor="middle" x="286" y="-312.15" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="286" y="-297.15" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- attention_0&#45;&gt;residual_0 -->
<g id="edge25" class="edge">
<title>attention_0&#45;&gt;residual_0</title>
<path fill="none" stroke="black" d="M262.48,-1231.67C170.09,-1212.77 17,-1173.55 17,-1121.22 17,-1121.22 17,-1121.22 17,-440.22 17,-363.06 107.61,-331.38 183.66,-318.38"/>
<polygon fill="black" stroke="black" points="184.49,-321.79 193.8,-316.74 183.37,-314.88 184.49,-321.79"/>
</g>
<!-- gate_0 -->
<g id="node5" class="node">
<title>gate_0</title>
<polygon fill="lightpink" stroke="black" points="408.5,-985.22 127.73,-985.22 55.5,-909.22 336.27,-909.22 408.5,-985.22"/>
<text text-anchor="middle" x="232" y="-951.02" font-family="Times,serif" font-size="14.00">Gate</text>
<text text-anchor="middle" x="232" y="-936.02" font-family="Times,serif" font-size="14.00">(B, L/4, num_experts)</text>
</g>
<!-- ln1_0&#45;&gt;gate_0 -->
<g id="edge4" class="edge">
<title>ln1_0&#45;&gt;gate_0</title>
<path fill="none" stroke="black" d="M345.41,-1100.92C326.51,-1075.48 291.68,-1028.58 265.59,-993.45"/>
<polygon fill="black" stroke="black" points="268.27,-991.18 259.49,-985.24 262.65,-995.35 268.27,-991.18"/>
</g>
<!-- expert_0_0 -->
<g id="node6" class="node">
<title>expert_0_0</title>
<polygon fill="lightcyan" stroke="black" points="427.5,-793.22 304.5,-793.22 304.5,-740.22 427.5,-740.22 427.5,-793.22"/>
<text text-anchor="middle" x="366" y="-778.02" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="366" y="-763.02" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="366" y="-748.02" font-family="Times,serif" font-size="14.00">(B, k, d_model)</text>
</g>
<!-- ln1_0&#45;&gt;expert_0_0 -->
<g id="edge6" class="edge">
<title>ln1_0&#45;&gt;expert_0_0</title>
<path fill="none" stroke="black" d="M371.26,-1100.84C385.52,-1078.28 408.22,-1038.29 417,-1000.22 427.59,-954.32 425.97,-940.47 417,-894.22 410.72,-861.86 396.19,-827.28 384.24,-802.47"/>
<polygon fill="black" stroke="black" points="387.36,-800.9 379.81,-793.47 381.08,-803.99 387.36,-800.9"/>
</g>
<!-- expert_0_1 -->
<g id="node7" class="node">
<title>expert_0_1</title>
<polygon fill="lightcyan" stroke="black" points="286.5,-793.22 163.5,-793.22 163.5,-740.22 286.5,-740.22 286.5,-793.22"/>
<text text-anchor="middle" x="225" y="-778.02" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="225" y="-763.02" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="225" y="-748.02" font-family="Times,serif" font-size="14.00">(B, k, d_model)</text>
</g>
<!-- ln1_0&#45;&gt;expert_0_1 -->
<g id="edge21" class="edge">
<title>ln1_0&#45;&gt;expert_0_1</title>
<path fill="none" stroke="black" d="M290.34,-1114.78C216.23,-1105.9 101.51,-1079.35 47,-1000.22 20.27,-961.42 25.39,-936.08 47,-894.22 69.54,-850.56 114.88,-818.68 154.16,-797.85"/>
<polygon fill="black" stroke="black" points="156.19,-800.74 163.47,-793.05 152.98,-794.52 156.19,-800.74"/>
</g>
<!-- expert_comm_0_1 -->
<g id="node42" class="node">
<title>expert_comm_0_1</title>
<polygon fill="lightgray" stroke="black" points="2843,-1000.22 2717,-947.22 2843,-894.22 2969,-947.22 2843,-1000.22"/>
<text text-anchor="middle" x="2843" y="-958.52" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2843" y="-943.52" font-family="Times,serif" font-size="14.00">GPU 0→1</text>
<text text-anchor="middle" x="2843" y="-928.52" font-family="Times,serif" font-size="14.00">(B, k, d_model)</text>
</g>
<!-- ln1_0&#45;&gt;expert_comm_0_1 -->
<g id="edge9" class="edge">
<title>ln1_0&#45;&gt;expert_comm_0_1</title>
<path fill="none" stroke="black" d="M427.78,-1102.97C431.9,-1102.3 436,-1101.7 440,-1101.22 1329.32,-993.98 1566.05,-1168.43 2455,-1058.22 2569.48,-1044.03 2597.67,-1033.93 2708,-1000.22 2728.84,-993.85 2751.06,-985.83 2771.33,-978"/>
<polygon fill="black" stroke="black" points="2772.76,-981.2 2780.8,-974.31 2770.21,-974.68 2772.76,-981.2"/>
</g>
<!-- expert_comm_0_2 -->
<g id="node43" class="node">
<title>expert_comm_0_2</title>
<polygon fill="lightgray" stroke="black" points="3653,-1000.22 3527,-947.22 3653,-894.22 3779,-947.22 3653,-1000.22"/>
<text text-anchor="middle" x="3653" y="-958.52" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="3653" y="-943.52" font-family="Times,serif" font-size="14.00">GPU 0→2</text>
<text text-anchor="middle" x="3653" y="-928.52" font-family="Times,serif" font-size="14.00">(B, k, d_model)</text>
</g>
<!-- ln1_0&#45;&gt;expert_comm_0_2 -->
<g id="edge13" class="edge">
<title>ln1_0&#45;&gt;expert_comm_0_2</title>
<path fill="none" stroke="black" d="M427.78,-1102.97C431.9,-1102.29 436,-1101.7 440,-1101.22 897.91,-1046.15 2054.14,-1076.31 2515,-1058.22 2961.18,-1040.7 3081.54,-1094.49 3518,-1000.22 3540.25,-995.42 3563.66,-987.5 3584.63,-979.27"/>
<polygon fill="black" stroke="black" points="3586.1,-982.45 3594.07,-975.48 3583.49,-975.95 3586.1,-982.45"/>
</g>
<!-- expert_comm_0_3 -->
<g id="node44" class="node">
<title>expert_comm_0_3</title>
<polygon fill="lightgray" stroke="black" points="4463,-1000.22 4337,-947.22 4463,-894.22 4589,-947.22 4463,-1000.22"/>
<text text-anchor="middle" x="4463" y="-958.52" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="4463" y="-943.52" font-family="Times,serif" font-size="14.00">GPU 0→3</text>
<text text-anchor="middle" x="4463" y="-928.52" font-family="Times,serif" font-size="14.00">(B, k, d_model)</text>
</g>
<!-- ln1_0&#45;&gt;expert_comm_0_3 -->
<g id="edge17" class="edge">
<title>ln1_0&#45;&gt;expert_comm_0_3</title>
<path fill="none" stroke="black" d="M427.77,-1102.95C431.9,-1102.28 435.99,-1101.7 440,-1101.22 984.05,-1036.69 2357.37,-1074.16 2905,-1058.22 3537.7,-1039.81 3708.18,-1128.58 4328,-1000.22 4350.29,-995.6 4373.71,-987.74 4394.68,-979.51"/>
<polygon fill="black" stroke="black" points="4396.15,-982.69 4404.12,-975.71 4393.54,-976.19 4396.15,-982.69"/>
</g>
<!-- gate_0&#45;&gt;expert_0_0 -->
<g id="edge5" class="edge">
<title>gate_0&#45;&gt;expert_0_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M260.09,-908.8C283.87,-877.12 317.66,-832.11 340.63,-801.51"/>
<polygon fill="black" stroke="black" points="343.6,-803.39 346.81,-793.29 338,-799.18 343.6,-803.39"/>
<text text-anchor="middle" x="333.5" y="-840.02" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- gate_0&#45;&gt;expert_0_1 -->
<g id="edge20" class="edge">
<title>gate_0&#45;&gt;expert_0_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M230.53,-908.8C229.32,-877.8 227.6,-834.03 226.4,-803.49"/>
<polygon fill="black" stroke="black" points="229.89,-803.14 226,-793.29 222.9,-803.42 229.89,-803.14"/>
<text text-anchor="middle" x="250.5" y="-840.02" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- gate_0&#45;&gt;expert_comm_0_1 -->
<g id="edge8" class="edge">
<title>gate_0&#45;&gt;expert_comm_0_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M363.75,-985.26C388.88,-991.24 415.1,-996.63 440,-1000.22 440,-1000.22 2708,-1000.22 2708,-1000.22 2730.23,-995.59 2753.55,-987.65 2774.44,-979.3"/>
<polygon fill="black" stroke="black" points="2775.92,-982.47 2783.85,-975.44 2773.27,-975.99 2775.92,-982.47"/>
<text text-anchor="middle" x="1561" y="-1047.02" font-family="Times,serif" font-size="14.00">route</text>
</g>
<!-- gate_0&#45;&gt;expert_comm_0_2 -->
<g id="edge12" class="edge">
<title>gate_0&#45;&gt;expert_comm_0_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M363.46,-985.29C388.67,-991.28 415,-996.67 440,-1000.22 778.6,-1048.35 3182.71,-1067.66 3518,-1000.22 3540.26,-995.74 3563.59,-987.84 3584.48,-979.49"/>
<polygon fill="black" stroke="black" points="3585.97,-982.66 3593.89,-975.63 3583.31,-976.18 3585.97,-982.66"/>
<text text-anchor="middle" x="1706" y="-1047.02" font-family="Times,serif" font-size="14.00">route</text>
</g>
<!-- gate_0&#45;&gt;expert_comm_0_3 -->
<g id="edge16" class="edge">
<title>gate_0&#45;&gt;expert_comm_0_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M363.17,-985.27C388.47,-991.29 414.91,-996.69 440,-1000.22 1038.16,-1084.41 1194.52,-1032.11 1798.5,-1041.22 2079.56,-1045.46 4052.25,-1054.76 4328,-1000.22 4350.38,-995.79 4373.84,-987.86 4394.8,-979.45"/>
<polygon fill="black" stroke="black" points="4396.32,-982.61 4404.24,-975.57 4393.66,-976.14 4396.32,-982.61"/>
<text text-anchor="middle" x="1818" y="-1047.02" font-family="Times,serif" font-size="14.00">route</text>
</g>
<!-- aggregate_0 -->
<g id="node8" class="node">
<title>aggregate_0</title>
<polygon fill="white" stroke="black" points="428.07,-653.22 202.07,-653.22 143.93,-547.22 369.93,-547.22 428.07,-653.22"/>
<text text-anchor="middle" x="286" y="-611.52" font-family="Times,serif" font-size="14.00">Aggregate</text>
<text text-anchor="middle" x="286" y="-596.52" font-family="Times,serif" font-size="14.00">Expert Outputs</text>
<text text-anchor="middle" x="286" y="-581.52" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- expert_0_0&#45;&gt;aggregate_0 -->
<g id="edge7" class="edge">
<title>expert_0_0&#45;&gt;aggregate_0</title>
<path fill="none" stroke="black" d="M353.5,-740.02C343.44,-719.32 328.87,-689.38 315.85,-662.59"/>
<polygon fill="black" stroke="black" points="318.83,-660.73 311.31,-653.27 312.54,-663.79 318.83,-660.73"/>
</g>
<!-- aggregate_1 -->
<g id="node18" class="node">
<title>aggregate_1</title>
<polygon fill="white" stroke="black" points="864.07,-653.22 638.07,-653.22 579.93,-547.22 805.93,-547.22 864.07,-653.22"/>
<text text-anchor="middle" x="722" y="-611.52" font-family="Times,serif" font-size="14.00">Aggregate</text>
<text text-anchor="middle" x="722" y="-596.52" font-family="Times,serif" font-size="14.00">Expert Outputs</text>
<text text-anchor="middle" x="722" y="-581.52" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- expert_0_0&#45;&gt;aggregate_1 -->
<g id="edge34" class="edge">
<title>expert_0_0&#45;&gt;aggregate_1</title>
<path fill="none" stroke="black" d="M421.23,-740.2C474.84,-715.43 557.42,-677.27 622.5,-647.2"/>
<polygon fill="black" stroke="black" points="624.36,-650.2 631.96,-642.82 621.42,-643.84 624.36,-650.2"/>
</g>
<!-- aggregate_2 -->
<g id="node28" class="node">
<title>aggregate_2</title>
<polygon fill="white" stroke="black" points="1300.07,-653.22 1074.07,-653.22 1015.93,-547.22 1241.93,-547.22 1300.07,-653.22"/>
<text text-anchor="middle" x="1158" y="-611.52" font-family="Times,serif" font-size="14.00">Aggregate</text>
<text text-anchor="middle" x="1158" y="-596.52" font-family="Times,serif" font-size="14.00">Expert Outputs</text>
<text text-anchor="middle" x="1158" y="-581.52" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- expert_0_0&#45;&gt;aggregate_2 -->
<g id="edge60" class="edge">
<title>expert_0_0&#45;&gt;aggregate_2</title>
<path fill="none" stroke="black" d="M427.88,-743.22C431.95,-742.11 436.02,-741.09 440,-740.22 630.23,-698.66 685.69,-738.42 876,-697.22 937.15,-683.98 1003.49,-661.81 1056.45,-642.11"/>
<polygon fill="black" stroke="black" points="1057.71,-645.38 1065.84,-638.59 1055.25,-638.83 1057.71,-645.38"/>
</g>
<!-- aggregate_3 -->
<g id="node38" class="node">
<title>aggregate_3</title>
<polygon fill="white" stroke="black" points="1761.07,-653.22 1535.07,-653.22 1476.93,-547.22 1702.93,-547.22 1761.07,-653.22"/>
<text text-anchor="middle" x="1619" y="-611.52" font-family="Times,serif" font-size="14.00">Aggregate</text>
<text text-anchor="middle" x="1619" y="-596.52" font-family="Times,serif" font-size="14.00">Expert Outputs</text>
<text text-anchor="middle" x="1619" y="-581.52" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- expert_0_0&#45;&gt;aggregate_3 -->
<g id="edge86" class="edge">
<title>expert_0_0&#45;&gt;aggregate_3</title>
<path fill="none" stroke="black" d="M427.87,-743.21C431.95,-742.1 436.02,-741.08 440,-740.22 636.35,-697.64 690.08,-717.19 890,-697.22 1077.64,-678.47 1125.16,-678.76 1312,-653.22 1376.81,-644.36 1448.94,-632.26 1506.99,-621.96"/>
<polygon fill="black" stroke="black" points="1507.69,-625.39 1516.92,-620.19 1506.46,-618.5 1507.69,-625.39"/>
</g>
<!-- expert_0_1&#45;&gt;aggregate_0 -->
<g id="edge22" class="edge">
<title>expert_0_1&#45;&gt;aggregate_0</title>
<path fill="none" stroke="black" d="M234.53,-740.02C242.17,-719.41 253.21,-689.64 263.11,-662.94"/>
<polygon fill="black" stroke="black" points="266.5,-663.86 266.7,-653.27 259.94,-661.43 266.5,-663.86"/>
</g>
<!-- ln2_0 -->
<g id="node9" class="node">
<title>ln2_0</title>
<polygon fill="white" stroke="black" points="354.5,-460.22 217.5,-460.22 217.5,-422.22 354.5,-422.22 354.5,-460.22"/>
<text text-anchor="middle" x="286" y="-445.02" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="286" y="-430.02" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- aggregate_0&#45;&gt;ln2_0 -->
<g id="edge23" class="edge">
<title>aggregate_0&#45;&gt;ln2_0</title>
<path fill="none" stroke="black" d="M286,-546.94C286,-521.57 286,-492.07 286,-470.86"/>
<polygon fill="black" stroke="black" points="289.5,-470.59 286,-460.59 282.5,-470.59 289.5,-470.59"/>
</g>
<!-- ln2_0&#45;&gt;residual_0 -->
<g id="edge24" class="edge">
<title>ln2_0&#45;&gt;residual_0</title>
<path fill="none" stroke="black" d="M286,-422.02C286,-402.36 286,-370.5 286,-345.67"/>
<polygon fill="black" stroke="black" points="289.5,-345.52 286,-335.52 282.5,-345.52 289.5,-345.52"/>
</g>
<!-- output_0 -->
<g id="node11" class="node">
<title>output_0</title>
<ellipse fill="white" stroke="black" cx="320" cy="-167.61" rx="96.75" ry="26.74"/>
<text text-anchor="middle" x="320" y="-171.41" font-family="Times,serif" font-size="14.00">Output Chunk</text>
<text text-anchor="middle" x="320" y="-156.41" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- residual_0&#45;&gt;output_0 -->
<g id="edge26" class="edge">
<title>residual_0&#45;&gt;output_0</title>
<path fill="none" stroke="black" d="M292.4,-281.25C297.71,-259.55 305.34,-228.44 311.23,-204.41"/>
<polygon fill="black" stroke="black" points="314.65,-205.13 313.63,-194.59 307.85,-203.47 314.65,-205.13"/>
</g>
<!-- final_output -->
<g id="node54" class="node">
<title>final_output</title>
<ellipse fill="lightgray" stroke="black" cx="875" cy="-26.87" rx="87.86" ry="26.74"/>
<text text-anchor="middle" x="875" y="-30.67" font-family="Times,serif" font-size="14.00">Final Output</text>
<text text-anchor="middle" x="875" y="-15.67" font-family="Times,serif" font-size="14.00">(B, L, d_model)</text>
</g>
<!-- output_0&#45;&gt;final_output -->
<g id="edge105" class="edge">
<title>output_0&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M385.27,-147.69C402.99,-142.69 422.2,-137.4 440,-132.74 564.11,-100.28 709.11,-66.06 796.4,-45.86"/>
<polygon fill="black" stroke="black" points="797.28,-49.25 806.23,-43.59 795.7,-42.43 797.28,-49.25"/>
</g>
<!-- attention_1 -->
<g id="node13" class="node">
<title>attention_1</title>
<polygon fill="white" stroke="black" points="835.5,-1264.22 698.5,-1264.22 698.5,-1226.22 835.5,-1226.22 835.5,-1264.22"/>
<text text-anchor="middle" x="767" y="-1249.02" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="767" y="-1234.02" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- input_1&#45;&gt;attention_1 -->
<g id="edge28" class="edge">
<title>input_1&#45;&gt;attention_1</title>
<path fill="none" stroke="black" d="M767,-1350.9C767,-1326.97 767,-1296.26 767,-1274.31"/>
<polygon fill="black" stroke="black" points="770.5,-1274.3 767,-1264.3 763.5,-1274.3 770.5,-1274.3"/>
</g>
<!-- ln1_1 -->
<g id="node14" class="node">
<title>ln1_1</title>
<polygon fill="white" stroke="black" points="863.5,-1139.22 726.5,-1139.22 726.5,-1101.22 863.5,-1101.22 863.5,-1139.22"/>
<text text-anchor="middle" x="795" y="-1124.02" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="795" y="-1109.02" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- attention_1&#45;&gt;ln1_1 -->
<g id="edge29" class="edge">
<title>attention_1&#45;&gt;ln1_1</title>
<path fill="none" stroke="black" d="M771.13,-1226.07C775.74,-1205.81 783.26,-1172.79 788.63,-1149.22"/>
<polygon fill="black" stroke="black" points="792.04,-1149.97 790.85,-1139.44 785.22,-1148.42 792.04,-1149.97"/>
</g>
<!-- residual_1 -->
<g id="node20" class="node">
<title>residual_1</title>
<ellipse fill="white" stroke="black" cx="722" cy="-308.35" rx="96.75" ry="26.74"/>
<text text-anchor="middle" x="722" y="-312.15" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="722" y="-297.15" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- attention_1&#45;&gt;residual_1 -->
<g id="edge51" class="edge">
<title>attention_1&#45;&gt;residual_1</title>
<path fill="none" stroke="black" d="M698.48,-1231.67C606.09,-1212.77 453,-1173.55 453,-1121.22 453,-1121.22 453,-1121.22 453,-440.22 453,-363.06 543.61,-331.38 619.66,-318.38"/>
<polygon fill="black" stroke="black" points="620.49,-321.79 629.8,-316.74 619.37,-314.88 620.49,-321.79"/>
</g>
<!-- gate_1 -->
<g id="node15" class="node">
<title>gate_1</title>
<polygon fill="lightpink" stroke="black" points="844.5,-985.22 563.73,-985.22 491.5,-909.22 772.27,-909.22 844.5,-985.22"/>
<text text-anchor="middle" x="668" y="-951.02" font-family="Times,serif" font-size="14.00">Gate</text>
<text text-anchor="middle" x="668" y="-936.02" font-family="Times,serif" font-size="14.00">(B, L/4, num_experts)</text>
</g>
<!-- ln1_1&#45;&gt;gate_1 -->
<g id="edge30" class="edge">
<title>ln1_1&#45;&gt;gate_1</title>
<path fill="none" stroke="black" d="M781.41,-1100.92C762.51,-1075.48 727.68,-1028.58 701.59,-993.45"/>
<polygon fill="black" stroke="black" points="704.27,-991.18 695.49,-985.24 698.65,-995.35 704.27,-991.18"/>
</g>
<!-- expert_1_2 -->
<g id="node16" class="node">
<title>expert_1_2</title>
<polygon fill="lightcyan" stroke="black" points="863.5,-793.22 740.5,-793.22 740.5,-740.22 863.5,-740.22 863.5,-793.22"/>
<text text-anchor="middle" x="802" y="-778.02" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="802" y="-763.02" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="802" y="-748.02" font-family="Times,serif" font-size="14.00">(B, k, d_model)</text>
</g>
<!-- ln1_1&#45;&gt;expert_1_2 -->
<g id="edge36" class="edge">
<title>ln1_1&#45;&gt;expert_1_2</title>
<path fill="none" stroke="black" d="M807.26,-1100.84C821.52,-1078.28 844.22,-1038.29 853,-1000.22 863.59,-954.32 861.97,-940.47 853,-894.22 846.72,-861.86 832.19,-827.28 820.24,-802.47"/>
<polygon fill="black" stroke="black" points="823.36,-800.9 815.81,-793.47 817.08,-803.99 823.36,-800.9"/>
</g>
<!-- expert_1_3 -->
<g id="node17" class="node">
<title>expert_1_3</title>
<polygon fill="lightcyan" stroke="black" points="722.5,-793.22 599.5,-793.22 599.5,-740.22 722.5,-740.22 722.5,-793.22"/>
<text text-anchor="middle" x="661" y="-778.02" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="661" y="-763.02" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="661" y="-748.02" font-family="Times,serif" font-size="14.00">(B, k, d_model)</text>
</g>
<!-- ln1_1&#45;&gt;expert_1_3 -->
<g id="edge47" class="edge">
<title>ln1_1&#45;&gt;expert_1_3</title>
<path fill="none" stroke="black" d="M726.34,-1114.78C652.23,-1105.9 537.51,-1079.35 483,-1000.22 456.27,-961.42 461.39,-936.08 483,-894.22 505.54,-850.56 550.88,-818.68 590.16,-797.85"/>
<polygon fill="black" stroke="black" points="592.19,-800.74 599.47,-793.05 588.98,-794.52 592.19,-800.74"/>
</g>
<!-- expert_comm_1_0 -->
<g id="node45" class="node">
<title>expert_comm_1_0</title>
<polygon fill="lightgray" stroke="black" points="2033,-1000.22 1907,-947.22 2033,-894.22 2159,-947.22 2033,-1000.22"/>
<text text-anchor="middle" x="2033" y="-958.52" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2033" y="-943.52" font-family="Times,serif" font-size="14.00">GPU 1→0</text>
<text text-anchor="middle" x="2033" y="-928.52" font-family="Times,serif" font-size="14.00">(B, k, d_model)</text>
</g>
<!-- ln1_1&#45;&gt;expert_comm_1_0 -->
<g id="edge32" class="edge">
<title>ln1_1&#45;&gt;expert_comm_1_0</title>
<path fill="none" stroke="black" d="M863.78,-1103.04C867.9,-1102.35 872,-1101.73 876,-1101.22 942.28,-1092.74 2031.6,-1106.31 2078,-1058.22 2094.89,-1040.72 2086.69,-1016.02 2072.92,-994.46"/>
<polygon fill="black" stroke="black" points="2075.72,-992.35 2067.19,-986.06 2069.94,-996.29 2075.72,-992.35"/>
</g>
<!-- expert_comm_1_2 -->
<g id="node46" class="node">
<title>expert_comm_1_2</title>
<polygon fill="lightgray" stroke="black" points="3923,-1000.22 3797,-947.22 3923,-894.22 4049,-947.22 3923,-1000.22"/>
<text text-anchor="middle" x="3923" y="-958.52" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="3923" y="-943.52" font-family="Times,serif" font-size="14.00">GPU 1→2</text>
<text text-anchor="middle" x="3923" y="-928.52" font-family="Times,serif" font-size="14.00">(B, k, d_model)</text>
</g>
<!-- ln1_1&#45;&gt;expert_comm_1_2 -->
<g id="edge39" class="edge">
<title>ln1_1&#45;&gt;expert_comm_1_2</title>
<path fill="none" stroke="black" d="M863.77,-1102.95C867.9,-1102.28 871.99,-1101.69 876,-1101.22 1440.37,-1034.46 2866.97,-1108.95 3433,-1058.22 3592.23,-1043.95 3633.7,-1042.06 3788,-1000.22 3809.34,-994.43 3831.98,-986.47 3852.49,-978.52"/>
<polygon fill="black" stroke="black" points="3854.04,-981.67 3862.06,-974.75 3851.47,-975.16 3854.04,-981.67"/>
</g>
<!-- expert_comm_1_3 -->
<g id="node47" class="node">
<title>expert_comm_1_3</title>
<polygon fill="lightgray" stroke="black" points="4733,-1000.22 4607,-947.22 4733,-894.22 4859,-947.22 4733,-1000.22"/>
<text text-anchor="middle" x="4733" y="-958.52" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="4733" y="-943.52" font-family="Times,serif" font-size="14.00">GPU 1→3</text>
<text text-anchor="middle" x="4733" y="-928.52" font-family="Times,serif" font-size="14.00">(B, k, d_model)</text>
</g>
<!-- ln1_1&#45;&gt;expert_comm_1_3 -->
<g id="edge43" class="edge">
<title>ln1_1&#45;&gt;expert_comm_1_3</title>
<path fill="none" stroke="black" d="M863.77,-1102.93C867.89,-1102.27 871.99,-1101.69 876,-1101.22 1617.07,-1015.06 3489.64,-1121.71 4233,-1058.22 4396.66,-1044.24 4439.37,-1042.86 4598,-1000.22 4619.36,-994.48 4641.99,-986.53 4662.5,-978.58"/>
<polygon fill="black" stroke="black" points="4664.05,-981.73 4672.07,-974.81 4661.49,-975.22 4664.05,-981.73"/>
</g>
<!-- gate_1&#45;&gt;expert_1_2 -->
<g id="edge35" class="edge">
<title>gate_1&#45;&gt;expert_1_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M696.09,-908.8C719.87,-877.12 753.66,-832.11 776.63,-801.51"/>
<polygon fill="black" stroke="black" points="779.6,-803.39 782.81,-793.29 774,-799.18 779.6,-803.39"/>
<text text-anchor="middle" x="768.5" y="-840.02" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- gate_1&#45;&gt;expert_1_3 -->
<g id="edge46" class="edge">
<title>gate_1&#45;&gt;expert_1_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M666.53,-908.8C665.32,-877.8 663.6,-834.03 662.4,-803.49"/>
<polygon fill="black" stroke="black" points="665.89,-803.14 662,-793.29 658.9,-803.42 665.89,-803.14"/>
<text text-anchor="middle" x="685.5" y="-840.02" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- gate_1&#45;&gt;expert_comm_1_0 -->
<g id="edge31" class="edge">
<title>gate_1&#45;&gt;expert_comm_1_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M802.36,-985.26C826.71,-991.06 851.99,-996.39 876,-1000.22 876,-1000.22 1901,-1000.22 1901,-1000.22 1921.99,-994.97 1944.08,-987.11 1964.05,-979.03"/>
<polygon fill="black" stroke="black" points="1965.46,-982.24 1973.37,-975.19 1962.79,-975.77 1965.46,-982.24"/>
<text text-anchor="middle" x="1504" y="-1047.02" font-family="Times,serif" font-size="14.00">route</text>
</g>
<!-- gate_1&#45;&gt;expert_comm_1_2 -->
<g id="edge38" class="edge">
<title>gate_1&#45;&gt;expert_comm_1_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M800.04,-985.28C825.08,-991.24 851.2,-996.61 876,-1000.22 1329.14,-1066.23 1447.67,-1032.11 1905.5,-1041.22 2323.85,-1049.55 3377.76,-1082.6 3788,-1000.22 3810.26,-995.75 3833.6,-987.85 3854.48,-979.49"/>
<polygon fill="black" stroke="black" points="3855.97,-982.67 3863.89,-975.63 3853.31,-976.19 3855.97,-982.67"/>
<text text-anchor="middle" x="1925" y="-1047.02" font-family="Times,serif" font-size="14.00">route</text>
</g>
<!-- gate_1&#45;&gt;expert_comm_1_3 -->
<g id="edge42" class="edge">
<title>gate_1&#45;&gt;expert_comm_1_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M799.75,-985.28C824.87,-991.25 851.1,-996.63 876,-1000.22 1367.92,-1071.09 1496.58,-1032.11 1993.5,-1041.22 2282.88,-1046.53 4314.06,-1056.31 4598,-1000.22 4620.38,-995.8 4643.84,-987.87 4664.8,-979.46"/>
<polygon fill="black" stroke="black" points="4666.32,-982.62 4674.24,-975.58 4663.66,-976.15 4666.32,-982.62"/>
<text text-anchor="middle" x="2013" y="-1047.02" font-family="Times,serif" font-size="14.00">route</text>
</g>
<!-- expert_1_2&#45;&gt;aggregate_0 -->
<g id="edge11" class="edge">
<title>expert_1_2&#45;&gt;aggregate_0</title>
<path fill="none" stroke="black" d="M740.23,-742.99C737.46,-742.04 734.7,-741.11 732,-740.22 603.44,-697.69 569.06,-694.22 440,-653.22 438.53,-652.75 437.05,-652.28 435.57,-651.81"/>
<polygon fill="black" stroke="black" points="436.28,-648.36 425.68,-648.63 434.13,-655.02 436.28,-648.36"/>
</g>
<!-- expert_1_2&#45;&gt;aggregate_1 -->
<g id="edge37" class="edge">
<title>expert_1_2&#45;&gt;aggregate_1</title>
<path fill="none" stroke="black" d="M789.5,-740.02C779.44,-719.32 764.87,-689.38 751.85,-662.59"/>
<polygon fill="black" stroke="black" points="754.83,-660.73 747.31,-653.27 748.54,-663.79 754.83,-660.73"/>
</g>
<!-- expert_1_2&#45;&gt;aggregate_2 -->
<g id="edge64" class="edge">
<title>expert_1_2&#45;&gt;aggregate_2</title>
<path fill="none" stroke="black" d="M863.86,-743.12C867.94,-742.03 872.01,-741.05 876,-740.22 937.22,-727.54 1394.52,-743.08 1437,-697.22 1489.87,-640.15 1381.81,-617 1285.16,-607.62"/>
<polygon fill="black" stroke="black" points="1285.23,-604.11 1274.95,-606.67 1284.58,-611.08 1285.23,-604.11"/>
</g>
<!-- expert_1_2&#45;&gt;aggregate_3 -->
<g id="edge90" class="edge">
<title>expert_1_2&#45;&gt;aggregate_3</title>
<path fill="none" stroke="black" d="M863.84,-743.06C867.93,-741.99 872,-741.02 876,-740.22 1021.62,-710.99 1411.45,-766.17 1543,-697.22 1558.9,-688.89 1572.57,-675.61 1583.77,-661.56"/>
<polygon fill="black" stroke="black" points="1586.83,-663.31 1590.07,-653.22 1581.25,-659.09 1586.83,-663.31"/>
</g>
<!-- expert_1_3&#45;&gt;aggregate_1 -->
<g id="edge48" class="edge">
<title>expert_1_3&#45;&gt;aggregate_1</title>
<path fill="none" stroke="black" d="M670.53,-740.02C678.17,-719.41 689.21,-689.64 699.11,-662.94"/>
<polygon fill="black" stroke="black" points="702.5,-663.86 702.7,-653.27 695.94,-661.43 702.5,-663.86"/>
</g>
<!-- ln2_1 -->
<g id="node19" class="node">
<title>ln2_1</title>
<polygon fill="white" stroke="black" points="790.5,-460.22 653.5,-460.22 653.5,-422.22 790.5,-422.22 790.5,-460.22"/>
<text text-anchor="middle" x="722" y="-445.02" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="722" y="-430.02" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- aggregate_1&#45;&gt;ln2_1 -->
<g id="edge49" class="edge">
<title>aggregate_1&#45;&gt;ln2_1</title>
<path fill="none" stroke="black" d="M722,-546.94C722,-521.57 722,-492.07 722,-470.86"/>
<polygon fill="black" stroke="black" points="725.5,-470.59 722,-460.59 718.5,-470.59 725.5,-470.59"/>
</g>
<!-- ln2_1&#45;&gt;residual_1 -->
<g id="edge50" class="edge">
<title>ln2_1&#45;&gt;residual_1</title>
<path fill="none" stroke="black" d="M722,-422.02C722,-402.36 722,-370.5 722,-345.67"/>
<polygon fill="black" stroke="black" points="725.5,-345.52 722,-335.52 718.5,-345.52 725.5,-345.52"/>
</g>
<!-- output_1 -->
<g id="node21" class="node">
<title>output_1</title>
<ellipse fill="white" stroke="black" cx="755" cy="-167.61" rx="96.75" ry="26.74"/>
<text text-anchor="middle" x="755" y="-171.41" font-family="Times,serif" font-size="14.00">Output Chunk</text>
<text text-anchor="middle" x="755" y="-156.41" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- residual_1&#45;&gt;output_1 -->
<g id="edge52" class="edge">
<title>residual_1&#45;&gt;output_1</title>
<path fill="none" stroke="black" d="M728.21,-281.25C733.37,-259.55 740.77,-228.44 746.49,-204.41"/>
<polygon fill="black" stroke="black" points="749.91,-205.13 748.82,-194.59 743.1,-203.51 749.91,-205.13"/>
</g>
<!-- output_1&#45;&gt;final_output -->
<g id="edge106" class="edge">
<title>output_1&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M777.01,-141.16C796.55,-118.57 825.21,-85.43 846.5,-60.82"/>
<polygon fill="black" stroke="black" points="849.24,-63.01 853.13,-53.16 843.94,-58.43 849.24,-63.01"/>
</g>
<!-- attention_2 -->
<g id="node23" class="node">
<title>attention_2</title>
<polygon fill="white" stroke="black" points="1053.5,-1264.22 916.5,-1264.22 916.5,-1226.22 1053.5,-1226.22 1053.5,-1264.22"/>
<text text-anchor="middle" x="985" y="-1249.02" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="985" y="-1234.02" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- input_2&#45;&gt;attention_2 -->
<g id="edge54" class="edge">
<title>input_2&#45;&gt;attention_2</title>
<path fill="none" stroke="black" d="M985,-1350.9C985,-1326.97 985,-1296.26 985,-1274.31"/>
<polygon fill="black" stroke="black" points="988.5,-1274.3 985,-1264.3 981.5,-1274.3 988.5,-1274.3"/>
</g>
<!-- ln1_2 -->
<g id="node24" class="node">
<title>ln1_2</title>
<polygon fill="white" stroke="black" points="1299.5,-1139.22 1162.5,-1139.22 1162.5,-1101.22 1299.5,-1101.22 1299.5,-1139.22"/>
<text text-anchor="middle" x="1231" y="-1124.02" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="1231" y="-1109.02" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- attention_2&#45;&gt;ln1_2 -->
<g id="edge55" class="edge">
<title>attention_2&#45;&gt;ln1_2</title>
<path fill="none" stroke="black" d="M1021.03,-1226.2C1064.7,-1204.37 1138.3,-1167.57 1185.75,-1143.85"/>
<polygon fill="black" stroke="black" points="1187.49,-1146.89 1194.87,-1139.29 1184.36,-1140.63 1187.49,-1146.89"/>
</g>
<!-- residual_2 -->
<g id="node30" class="node">
<title>residual_2</title>
<ellipse fill="white" stroke="black" cx="985" cy="-308.35" rx="96.75" ry="26.74"/>
<text text-anchor="middle" x="985" y="-312.15" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="985" y="-297.15" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- attention_2&#45;&gt;residual_2 -->
<g id="edge77" class="edge">
<title>attention_2&#45;&gt;residual_2</title>
<path fill="none" stroke="black" d="M976.21,-1226.12C957.46,-1186.4 914.03,-1088.1 899,-1000.22 856.34,-750.85 940.93,-447.41 973.21,-345.02"/>
<polygon fill="black" stroke="black" points="976.64,-345.79 976.34,-335.2 969.97,-343.66 976.64,-345.79"/>
</g>
<!-- gate_2 -->
<g id="node25" class="node">
<title>gate_2</title>
<polygon fill="lightpink" stroke="black" points="1260.5,-985.22 979.73,-985.22 907.5,-909.22 1188.27,-909.22 1260.5,-985.22"/>
<text text-anchor="middle" x="1084" y="-951.02" font-family="Times,serif" font-size="14.00">Gate</text>
<text text-anchor="middle" x="1084" y="-936.02" font-family="Times,serif" font-size="14.00">(B, L/4, num_experts)</text>
</g>
<!-- ln1_2&#45;&gt;gate_2 -->
<g id="edge56" class="edge">
<title>ln1_2&#45;&gt;gate_2</title>
<path fill="none" stroke="black" d="M1215.27,-1100.92C1193.3,-1075.37 1152.74,-1028.18 1122.5,-993"/>
<polygon fill="black" stroke="black" points="1125,-990.54 1115.82,-985.24 1119.69,-995.1 1125,-990.54"/>
</g>
<!-- expert_2_4 -->
<g id="node26" class="node">
<title>expert_2_4</title>
<polygon fill="lightcyan" stroke="black" points="1299.5,-793.22 1176.5,-793.22 1176.5,-740.22 1299.5,-740.22 1299.5,-793.22"/>
<text text-anchor="middle" x="1238" y="-778.02" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1238" y="-763.02" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1238" y="-748.02" font-family="Times,serif" font-size="14.00">(B, k, d_model)</text>
</g>
<!-- ln1_2&#45;&gt;expert_2_4 -->
<g id="edge66" class="edge">
<title>ln1_2&#45;&gt;expert_2_4</title>
<path fill="none" stroke="black" d="M1253.06,-1101.08C1264.67,-1090.05 1277.76,-1074.91 1284,-1058.22 1318.54,-965.8 1312.75,-930.61 1284,-836.22 1280.31,-824.12 1273.7,-812.22 1266.62,-801.82"/>
<polygon fill="black" stroke="black" points="1269.29,-799.54 1260.61,-793.47 1263.61,-803.63 1269.29,-799.54"/>
</g>
<!-- expert_2_5 -->
<g id="node27" class="node">
<title>expert_2_5</title>
<polygon fill="lightcyan" stroke="black" points="1158.5,-793.22 1035.5,-793.22 1035.5,-740.22 1158.5,-740.22 1158.5,-793.22"/>
<text text-anchor="middle" x="1097" y="-778.02" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1097" y="-763.02" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1097" y="-748.02" font-family="Times,serif" font-size="14.00">(B, k, d_model)</text>
</g>
<!-- ln1_2&#45;&gt;expert_2_5 -->
<g id="edge73" class="edge">
<title>ln1_2&#45;&gt;expert_2_5</title>
<path fill="none" stroke="black" d="M1240.06,-1101.17C1258.31,-1062.26 1295.58,-968.02 1269,-894.22 1252.51,-848.44 1207.71,-816.35 1167.96,-795.94"/>
<polygon fill="black" stroke="black" points="1169.29,-792.7 1158.78,-791.39 1166.18,-798.97 1169.29,-792.7"/>
</g>
<!-- expert_comm_2_0 -->
<g id="node48" class="node">
<title>expert_comm_2_0</title>
<polygon fill="lightgray" stroke="black" points="2303,-1000.22 2177,-947.22 2303,-894.22 2429,-947.22 2303,-1000.22"/>
<text text-anchor="middle" x="2303" y="-958.52" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2303" y="-943.52" font-family="Times,serif" font-size="14.00">GPU 2→0</text>
<text text-anchor="middle" x="2303" y="-928.52" font-family="Times,serif" font-size="14.00">(B, k, d_model)</text>
</g>
<!-- ln1_2&#45;&gt;expert_comm_2_0 -->
<g id="edge58" class="edge">
<title>ln1_2&#45;&gt;expert_comm_2_0</title>
<path fill="none" stroke="black" d="M1299.57,-1113.52C1346.2,-1109.75 1409.3,-1104.86 1465,-1101.22 1554.05,-1095.41 2196.18,-1112.51 2267,-1058.22 2282.62,-1046.25 2291.55,-1027.34 2296.64,-1008.55"/>
<polygon fill="black" stroke="black" points="2300.05,-1009.31 2298.96,-998.78 2293.24,-1007.7 2300.05,-1009.31"/>
</g>
<!-- expert_comm_2_1 -->
<g id="node49" class="node">
<title>expert_comm_2_1</title>
<polygon fill="lightgray" stroke="black" points="3113,-1000.22 2987,-947.22 3113,-894.22 3239,-947.22 3113,-1000.22"/>
<text text-anchor="middle" x="3113" y="-958.52" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="3113" y="-943.52" font-family="Times,serif" font-size="14.00">GPU 2→1</text>
<text text-anchor="middle" x="3113" y="-928.52" font-family="Times,serif" font-size="14.00">(B, k, d_model)</text>
</g>
<!-- ln1_2&#45;&gt;expert_comm_2_1 -->
<g id="edge62" class="edge">
<title>ln1_2&#45;&gt;expert_comm_2_1</title>
<path fill="none" stroke="black" d="M1299.55,-1113.18C1346.17,-1109.26 1409.27,-1104.33 1465,-1101.22 2016.47,-1070.48 2158.82,-1125.83 2707,-1058.22 2829.25,-1043.14 2859.94,-1035.35 2978,-1000.22 2998.99,-993.97 3021.34,-985.95 3041.69,-978.08"/>
<polygon fill="black" stroke="black" points="3043.16,-981.27 3051.2,-974.37 3040.61,-974.75 3043.16,-981.27"/>
</g>
<!-- expert_comm_2_3 -->
<g id="node50" class="node">
<title>expert_comm_2_3</title>
<polygon fill="lightgray" stroke="black" points="5003,-1000.22 4877,-947.22 5003,-894.22 5129,-947.22 5003,-1000.22"/>
<text text-anchor="middle" x="5003" y="-958.52" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="5003" y="-943.52" font-family="Times,serif" font-size="14.00">GPU 2→3</text>
<text text-anchor="middle" x="5003" y="-928.52" font-family="Times,serif" font-size="14.00">(B, k, d_model)</text>
</g>
<!-- ln1_2&#45;&gt;expert_comm_2_3 -->
<g id="edge69" class="edge">
<title>ln1_2&#45;&gt;expert_comm_2_3</title>
<path fill="none" stroke="black" d="M1299.53,-1112.81C1346.14,-1108.73 1409.24,-1103.76 1465,-1101.22 2139.26,-1070.54 3829.52,-1115.97 4502,-1058.22 4666.09,-1044.13 4708.94,-1042.95 4868,-1000.22 4889.36,-994.48 4912,-986.54 4932.51,-978.59"/>
<polygon fill="black" stroke="black" points="4934.06,-981.74 4942.08,-974.82 4931.49,-975.23 4934.06,-981.74"/>
</g>
<!-- gate_2&#45;&gt;expert_2_4 -->
<g id="edge65" class="edge">
<title>gate_2&#45;&gt;expert_2_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1116.28,-908.8C1143.73,-876.99 1182.78,-831.73 1209.18,-801.12"/>
<polygon fill="black" stroke="black" points="1212.06,-803.14 1215.94,-793.29 1206.76,-798.57 1212.06,-803.14"/>
<text text-anchor="middle" x="1195.5" y="-840.02" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- gate_2&#45;&gt;expert_2_5 -->
<g id="edge72" class="edge">
<title>gate_2&#45;&gt;expert_2_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1086.73,-908.8C1088.98,-877.8 1092.17,-834.03 1094.39,-803.49"/>
<polygon fill="black" stroke="black" points="1097.9,-803.51 1095.14,-793.29 1090.92,-803.01 1097.9,-803.51"/>
<text text-anchor="middle" x="1112.5" y="-840.02" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- gate_2&#45;&gt;expert_comm_2_0 -->
<g id="edge57" class="edge">
<title>gate_2&#45;&gt;expert_comm_2_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1257.33,-985.26C1362.64,-1006.41 1500.13,-1030.55 1623.5,-1041.22 1865.28,-1062.13 1931.57,-1054.96 2168,-1000.22 2189.91,-995.15 2212.97,-987.16 2233.7,-978.92"/>
<polygon fill="black" stroke="black" points="2235.1,-982.12 2243.05,-975.12 2232.47,-975.64 2235.1,-982.12"/>
<text text-anchor="middle" x="1643" y="-1047.02" font-family="Times,serif" font-size="14.00">route</text>
</g>
<!-- gate_2&#45;&gt;expert_comm_2_1 -->
<g id="edge61" class="edge">
<title>gate_2&#45;&gt;expert_comm_2_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1248.32,-972.05C1315.41,-981.67 1393.82,-992.26 1465,-1000.22 1465,-1000.22 2978,-1000.22 2978,-1000.22 3000.22,-995.54 3023.54,-987.57 3044.43,-979.23"/>
<polygon fill="black" stroke="black" points="3045.91,-982.4 3053.84,-975.37 3043.26,-975.92 3045.91,-982.4"/>
<text text-anchor="middle" x="1969" y="-1047.02" font-family="Times,serif" font-size="14.00">route</text>
</g>
<!-- gate_2&#45;&gt;expert_comm_2_3 -->
<g id="edge68" class="edge">
<title>gate_2&#45;&gt;expert_comm_2_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1249.61,-973.35C1316.37,-983.08 1394.2,-993.4 1465,-1000.22 1801.05,-1032.62 1886.02,-1032.11 2223.5,-1041.22 2517.26,-1049.15 4579.7,-1057.14 4868,-1000.22 4890.39,-995.8 4913.84,-987.87 4934.8,-979.47"/>
<polygon fill="black" stroke="black" points="4936.32,-982.62 4944.24,-975.58 4933.66,-976.15 4936.32,-982.62"/>
<text text-anchor="middle" x="2243" y="-1047.02" font-family="Times,serif" font-size="14.00">route</text>
</g>
<!-- expert_2_4&#45;&gt;aggregate_0 -->
<g id="edge15" class="edge">
<title>expert_2_4&#45;&gt;aggregate_0</title>
<path fill="none" stroke="black" d="M1176.37,-742.51C1173.56,-741.69 1170.76,-740.92 1168,-740.22 852.23,-659.77 758.56,-721.78 440,-653.22 438.9,-652.98 437.79,-652.74 436.68,-652.49"/>
<polygon fill="black" stroke="black" points="437.17,-649.01 426.63,-650.13 435.57,-655.83 437.17,-649.01"/>
</g>
<!-- expert_2_4&#45;&gt;aggregate_1 -->
<g id="edge41" class="edge">
<title>expert_2_4&#45;&gt;aggregate_1</title>
<path fill="none" stroke="black" d="M1176.23,-742.99C1173.46,-742.04 1170.7,-741.11 1168,-740.22 1039.44,-697.69 1005.06,-694.22 876,-653.22 874.53,-652.75 873.05,-652.28 871.57,-651.81"/>
<polygon fill="black" stroke="black" points="872.28,-648.36 861.68,-648.63 870.13,-655.02 872.28,-648.36"/>
</g>
<!-- expert_2_4&#45;&gt;aggregate_2 -->
<g id="edge67" class="edge">
<title>expert_2_4&#45;&gt;aggregate_2</title>
<path fill="none" stroke="black" d="M1225.5,-740.02C1215.44,-719.32 1200.87,-689.38 1187.85,-662.59"/>
<polygon fill="black" stroke="black" points="1190.83,-660.73 1183.31,-653.27 1184.54,-663.79 1190.83,-660.73"/>
</g>
<!-- expert_2_4&#45;&gt;aggregate_3 -->
<g id="edge94" class="edge">
<title>expert_2_4&#45;&gt;aggregate_3</title>
<path fill="none" stroke="black" d="M1299.65,-760.45C1386.51,-751.88 1539.04,-732.24 1581,-697.22 1591.74,-688.26 1599.47,-675.83 1605.01,-662.89"/>
<polygon fill="black" stroke="black" points="1608.33,-664.01 1608.68,-653.42 1601.81,-661.48 1608.33,-664.01"/>
</g>
<!-- expert_2_5&#45;&gt;aggregate_2 -->
<g id="edge74" class="edge">
<title>expert_2_5&#45;&gt;aggregate_2</title>
<path fill="none" stroke="black" d="M1106.53,-740.02C1114.17,-719.41 1125.21,-689.64 1135.11,-662.94"/>
<polygon fill="black" stroke="black" points="1138.5,-663.86 1138.7,-653.27 1131.94,-661.43 1138.5,-663.86"/>
</g>
<!-- ln2_2 -->
<g id="node29" class="node">
<title>ln2_2</title>
<polygon fill="white" stroke="black" points="1144.5,-460.22 1007.5,-460.22 1007.5,-422.22 1144.5,-422.22 1144.5,-460.22"/>
<text text-anchor="middle" x="1076" y="-445.02" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="1076" y="-430.02" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- aggregate_2&#45;&gt;ln2_2 -->
<g id="edge75" class="edge">
<title>aggregate_2&#45;&gt;ln2_2</title>
<path fill="none" stroke="black" d="M1130.7,-546.94C1117.2,-521.11 1101.47,-490.99 1090.35,-469.7"/>
<polygon fill="black" stroke="black" points="1093.33,-467.83 1085.59,-460.59 1087.12,-471.07 1093.33,-467.83"/>
</g>
<!-- ln2_2&#45;&gt;residual_2 -->
<g id="edge76" class="edge">
<title>ln2_2&#45;&gt;residual_2</title>
<path fill="none" stroke="black" d="M1063.35,-422.02C1049.28,-401.79 1026.24,-368.67 1008.78,-343.55"/>
<polygon fill="black" stroke="black" points="1011.45,-341.25 1002.86,-335.04 1005.7,-345.25 1011.45,-341.25"/>
</g>
<!-- output_2 -->
<g id="node31" class="node">
<title>output_2</title>
<ellipse fill="white" stroke="black" cx="985" cy="-167.61" rx="96.75" ry="26.74"/>
<text text-anchor="middle" x="985" y="-171.41" font-family="Times,serif" font-size="14.00">Output Chunk</text>
<text text-anchor="middle" x="985" y="-156.41" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- residual_2&#45;&gt;output_2 -->
<g id="edge78" class="edge">
<title>residual_2&#45;&gt;output_2</title>
<path fill="none" stroke="black" d="M985,-281.25C985,-259.65 985,-228.71 985,-204.73"/>
<polygon fill="black" stroke="black" points="988.5,-204.59 985,-194.59 981.5,-204.59 988.5,-204.59"/>
</g>
<!-- output_2&#45;&gt;final_output -->
<g id="edge107" class="edge">
<title>output_2&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M964.82,-141.16C946.99,-118.67 920.86,-85.72 901.38,-61.14"/>
<polygon fill="black" stroke="black" points="904,-58.82 895.05,-53.16 898.52,-63.17 904,-58.82"/>
</g>
<!-- attention_3 -->
<g id="node33" class="node">
<title>attention_3</title>
<polygon fill="white" stroke="black" points="1815.5,-1264.22 1678.5,-1264.22 1678.5,-1226.22 1815.5,-1226.22 1815.5,-1264.22"/>
<text text-anchor="middle" x="1747" y="-1249.02" font-family="Times,serif" font-size="14.00">Ring Attention</text>
<text text-anchor="middle" x="1747" y="-1234.02" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- input_3&#45;&gt;attention_3 -->
<g id="edge80" class="edge">
<title>input_3&#45;&gt;attention_3</title>
<path fill="none" stroke="black" d="M1699.32,-1351.63C1710.28,-1327.38 1724.52,-1295.92 1734.57,-1273.7"/>
<polygon fill="black" stroke="black" points="1737.8,-1275.05 1738.73,-1264.49 1731.42,-1272.16 1737.8,-1275.05"/>
</g>
<!-- ln1_3 -->
<g id="node34" class="node">
<title>ln1_3</title>
<polygon fill="white" stroke="black" points="1815.5,-1139.22 1678.5,-1139.22 1678.5,-1101.22 1815.5,-1101.22 1815.5,-1139.22"/>
<text text-anchor="middle" x="1747" y="-1124.02" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="1747" y="-1109.02" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- attention_3&#45;&gt;ln1_3 -->
<g id="edge81" class="edge">
<title>attention_3&#45;&gt;ln1_3</title>
<path fill="none" stroke="black" d="M1747,-1226.07C1747,-1205.9 1747,-1173.08 1747,-1149.53"/>
<polygon fill="black" stroke="black" points="1750.5,-1149.44 1747,-1139.44 1743.5,-1149.44 1750.5,-1149.44"/>
</g>
<!-- residual_3 -->
<g id="node40" class="node">
<title>residual_3</title>
<ellipse fill="white" stroke="black" cx="1619" cy="-308.35" rx="96.75" ry="26.74"/>
<text text-anchor="middle" x="1619" y="-312.15" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="1619" y="-297.15" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- attention_3&#45;&gt;residual_3 -->
<g id="edge103" class="edge">
<title>attention_3&#45;&gt;residual_3</title>
<path fill="none" stroke="black" d="M1793.95,-1226.14C1834.97,-1206.93 1888,-1172.22 1888,-1121.22 1888,-1121.22 1888,-1121.22 1888,-440.22 1888,-363.06 1797.39,-331.38 1721.34,-318.38"/>
<polygon fill="black" stroke="black" points="1721.63,-314.88 1711.2,-316.74 1720.51,-321.79 1721.63,-314.88"/>
</g>
<!-- gate_3 -->
<g id="node35" class="node">
<title>gate_3</title>
<polygon fill="lightpink" stroke="black" points="1869.5,-985.22 1588.73,-985.22 1516.5,-909.22 1797.27,-909.22 1869.5,-985.22"/>
<text text-anchor="middle" x="1693" y="-951.02" font-family="Times,serif" font-size="14.00">Gate</text>
<text text-anchor="middle" x="1693" y="-936.02" font-family="Times,serif" font-size="14.00">(B, L/4, num_experts)</text>
</g>
<!-- ln1_3&#45;&gt;gate_3 -->
<g id="edge82" class="edge">
<title>ln1_3&#45;&gt;gate_3</title>
<path fill="none" stroke="black" d="M1743.77,-1101.21C1740.8,-1085.68 1735.95,-1062.75 1730,-1043.22 1725.18,-1027.39 1718.94,-1010.44 1712.97,-995.32"/>
<polygon fill="black" stroke="black" points="1716.07,-993.64 1709.1,-985.67 1709.57,-996.25 1716.07,-993.64"/>
</g>
<!-- expert_3_6 -->
<g id="node36" class="node">
<title>expert_3_6</title>
<polygon fill="lightcyan" stroke="black" points="1745.5,-793.22 1622.5,-793.22 1622.5,-740.22 1745.5,-740.22 1745.5,-793.22"/>
<text text-anchor="middle" x="1684" y="-778.02" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="1684" y="-763.02" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1684" y="-748.02" font-family="Times,serif" font-size="14.00">(B, k, d_model)</text>
</g>
<!-- ln1_3&#45;&gt;expert_3_6 -->
<g id="edge96" class="edge">
<title>ln1_3&#45;&gt;expert_3_6</title>
<path fill="none" stroke="black" d="M1678.2,-1112.91C1608.29,-1104.9 1506.97,-1088.36 1483,-1058.22 1457.76,-1026.49 1288.25,-1247.14 1508,-894.22 1534.24,-852.08 1580.17,-819.78 1618.54,-798.37"/>
<polygon fill="black" stroke="black" points="1620.5,-801.28 1627.6,-793.43 1617.15,-795.14 1620.5,-801.28"/>
</g>
<!-- expert_3_7 -->
<g id="node37" class="node">
<title>expert_3_7</title>
<polygon fill="lightcyan" stroke="black" points="1604.5,-793.22 1481.5,-793.22 1481.5,-740.22 1604.5,-740.22 1604.5,-793.22"/>
<text text-anchor="middle" x="1543" y="-778.02" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="1543" y="-763.02" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1543" y="-748.02" font-family="Times,serif" font-size="14.00">(B, k, d_model)</text>
</g>
<!-- ln1_3&#45;&gt;expert_3_7 -->
<g id="edge99" class="edge">
<title>ln1_3&#45;&gt;expert_3_7</title>
<path fill="none" stroke="black" d="M1678.45,-1113.11C1634.19,-1106.07 1577.69,-1090.89 1538,-1058.22 1526.8,-1049 1511.43,-1014.32 1508,-1000.22 1496.86,-954.44 1501.66,-940.9 1508,-894.22 1512.26,-862.86 1522.2,-828.3 1530.4,-803.24"/>
<polygon fill="black" stroke="black" points="1533.82,-804.05 1533.67,-793.46 1527.18,-801.83 1533.82,-804.05"/>
</g>
<!-- expert_comm_3_0 -->
<g id="node51" class="node">
<title>expert_comm_3_0</title>
<polygon fill="lightgray" stroke="black" points="2573,-1000.22 2447,-947.22 2573,-894.22 2699,-947.22 2573,-1000.22"/>
<text text-anchor="middle" x="2573" y="-958.52" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="2573" y="-943.52" font-family="Times,serif" font-size="14.00">GPU 3→0</text>
<text text-anchor="middle" x="2573" y="-928.52" font-family="Times,serif" font-size="14.00">(B, k, d_model)</text>
</g>
<!-- ln1_3&#45;&gt;expert_comm_3_0 -->
<g id="edge84" class="edge">
<title>ln1_3&#45;&gt;expert_comm_3_0</title>
<path fill="none" stroke="black" d="M1815.6,-1118.95C1970.31,-1117.45 2341.76,-1108.54 2455,-1058.22 2486.39,-1044.27 2514.78,-1018.45 2535.85,-995.32"/>
<polygon fill="black" stroke="black" points="2538.68,-997.4 2542.71,-987.6 2533.45,-992.75 2538.68,-997.4"/>
</g>
<!-- expert_comm_3_1 -->
<g id="node52" class="node">
<title>expert_comm_3_1</title>
<polygon fill="lightgray" stroke="black" points="3383,-1000.22 3257,-947.22 3383,-894.22 3509,-947.22 3383,-1000.22"/>
<text text-anchor="middle" x="3383" y="-958.52" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="3383" y="-943.52" font-family="Times,serif" font-size="14.00">GPU 3→1</text>
<text text-anchor="middle" x="3383" y="-928.52" font-family="Times,serif" font-size="14.00">(B, k, d_model)</text>
</g>
<!-- ln1_3&#45;&gt;expert_comm_3_1 -->
<g id="edge88" class="edge">
<title>ln1_3&#45;&gt;expert_comm_3_1</title>
<path fill="none" stroke="black" d="M1815.54,-1118.75C1997.53,-1116.84 2507.77,-1107.18 2929,-1058.22 3072.14,-1041.58 3109.26,-1039.18 3248,-1000.22 3269.19,-994.27 3291.69,-986.3 3312.12,-978.39"/>
<polygon fill="black" stroke="black" points="3313.63,-981.56 3321.66,-974.65 3311.07,-975.04 3313.63,-981.56"/>
</g>
<!-- expert_comm_3_2 -->
<g id="node53" class="node">
<title>expert_comm_3_2</title>
<polygon fill="lightgray" stroke="black" points="4193,-1000.22 4067,-947.22 4193,-894.22 4319,-947.22 4193,-1000.22"/>
<text text-anchor="middle" x="4193" y="-958.52" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="4193" y="-943.52" font-family="Times,serif" font-size="14.00">GPU 3→2</text>
<text text-anchor="middle" x="4193" y="-928.52" font-family="Times,serif" font-size="14.00">(B, k, d_model)</text>
</g>
<!-- ln1_3&#45;&gt;expert_comm_3_2 -->
<g id="edge92" class="edge">
<title>ln1_3&#45;&gt;expert_comm_3_2</title>
<path fill="none" stroke="black" d="M1815.59,-1118.25C2116.37,-1113.84 3320.42,-1094.21 3697,-1058.22 3858.76,-1042.76 3901.11,-1042.54 4058,-1000.22 4079.35,-994.46 4101.99,-986.51 4122.5,-978.56"/>
<polygon fill="black" stroke="black" points="4124.05,-981.71 4132.07,-974.79 4121.48,-975.2 4124.05,-981.71"/>
</g>
<!-- gate_3&#45;&gt;expert_3_6 -->
<g id="edge95" class="edge">
<title>gate_3&#45;&gt;expert_3_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1691.11,-908.8C1689.55,-877.8 1687.34,-834.03 1685.8,-803.49"/>
<polygon fill="black" stroke="black" points="1689.29,-803.1 1685.29,-793.29 1682.3,-803.45 1689.29,-803.1"/>
<text text-anchor="middle" x="1708.5" y="-840.02" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- gate_3&#45;&gt;expert_3_7 -->
<g id="edge98" class="edge">
<title>gate_3&#45;&gt;expert_3_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1661.56,-908.8C1634.82,-876.99 1596.79,-831.73 1571.07,-801.12"/>
<polygon fill="black" stroke="black" points="1573.6,-798.69 1564.48,-793.29 1568.24,-803.19 1573.6,-798.69"/>
<text text-anchor="middle" x="1630.5" y="-840.02" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- gate_3&#45;&gt;expert_comm_3_0 -->
<g id="edge83" class="edge">
<title>gate_3&#45;&gt;expert_comm_3_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1802.36,-985.3C1869.32,-1006.53 1957.28,-1030.76 2037.5,-1041.22 2098.03,-1049.12 2255.52,-1045.56 2438,-1000.22 2459.72,-994.82 2482.63,-986.79 2503.29,-978.59"/>
<polygon fill="black" stroke="black" points="2504.65,-981.82 2512.61,-974.82 2502.03,-975.33 2504.65,-981.82"/>
<text text-anchor="middle" x="2057" y="-1047.02" font-family="Times,serif" font-size="14.00">route</text>
</g>
<!-- gate_3&#45;&gt;expert_comm_3_1 -->
<g id="edge87" class="edge">
<title>gate_3&#45;&gt;expert_comm_3_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1832.91,-985.28C1854.62,-990.64 1876.86,-995.81 1898,-1000.22 2011.45,-1023.86 2039.97,-1032.08 2155.5,-1041.22 2397.69,-1060.38 3010.21,-1050.03 3248,-1000.22 3270.23,-995.56 3293.55,-987.61 3314.43,-979.26"/>
<polygon fill="black" stroke="black" points="3315.92,-982.44 3323.84,-975.41 3313.26,-975.96 3315.92,-982.44"/>
<text text-anchor="middle" x="2175" y="-1047.02" font-family="Times,serif" font-size="14.00">route</text>
</g>
<!-- gate_3&#45;&gt;expert_comm_3_2 -->
<g id="edge91" class="edge">
<title>gate_3&#45;&gt;expert_comm_3_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1826.26,-985.23C1850,-990.98 1874.62,-996.29 1898,-1000.22 2123.79,-1038.13 2182.73,-1032.1 2411.5,-1041.22 2777.21,-1055.8 3699.28,-1072.86 4058,-1000.22 4080.26,-995.71 4103.59,-987.8 4124.47,-979.45"/>
<polygon fill="black" stroke="black" points="4125.96,-982.62 4133.88,-975.59 4123.3,-976.15 4125.96,-982.62"/>
<text text-anchor="middle" x="2431" y="-1047.02" font-family="Times,serif" font-size="14.00">route</text>
</g>
<!-- expert_3_6&#45;&gt;aggregate_0 -->
<g id="edge19" class="edge">
<title>expert_3_6&#45;&gt;aggregate_0</title>
<path fill="none" stroke="black" d="M1622.38,-742.5C1619.56,-741.68 1616.76,-740.92 1614,-740.22 1482.48,-707.06 1447,-709.35 1312,-696.22 925.8,-658.65 821.23,-725.53 440,-653.22 438.89,-653.01 437.78,-652.79 436.66,-652.57"/>
<polygon fill="black" stroke="black" points="437.08,-649.08 426.57,-650.42 435.62,-655.93 437.08,-649.08"/>
</g>
<!-- expert_3_6&#45;&gt;aggregate_1 -->
<g id="edge45" class="edge">
<title>expert_3_6&#45;&gt;aggregate_1</title>
<path fill="none" stroke="black" d="M1622.38,-742.5C1619.56,-741.68 1616.76,-740.92 1614,-740.22 1293.75,-659.47 1198.88,-722.71 876,-653.22 874.9,-652.98 873.79,-652.74 872.68,-652.49"/>
<polygon fill="black" stroke="black" points="873.17,-649.01 862.63,-650.13 871.57,-655.83 873.17,-649.01"/>
</g>
<!-- expert_3_6&#45;&gt;aggregate_2 -->
<g id="edge71" class="edge">
<title>expert_3_6&#45;&gt;aggregate_2</title>
<path fill="none" stroke="black" d="M1622.23,-743.01C1619.45,-742.06 1616.7,-741.12 1614,-740.22 1510.62,-705.66 1392.92,-669.87 1303,-643.27"/>
<polygon fill="black" stroke="black" points="1303.86,-639.87 1293.28,-640.39 1301.88,-646.58 1303.86,-639.87"/>
</g>
<!-- expert_3_6&#45;&gt;aggregate_3 -->
<g id="edge97" class="edge">
<title>expert_3_6&#45;&gt;aggregate_3</title>
<path fill="none" stroke="black" d="M1673.84,-740.02C1665.67,-719.32 1653.83,-689.38 1643.25,-662.59"/>
<polygon fill="black" stroke="black" points="1646.5,-661.28 1639.57,-653.27 1639.99,-663.86 1646.5,-661.28"/>
</g>
<!-- expert_3_7&#45;&gt;aggregate_3 -->
<g id="edge100" class="edge">
<title>expert_3_7&#45;&gt;aggregate_3</title>
<path fill="none" stroke="black" d="M1577.88,-740.12C1590.91,-728.56 1604.39,-713.78 1612,-697.22 1616.8,-686.77 1619.53,-675 1620.95,-663.37"/>
<polygon fill="black" stroke="black" points="1624.45,-663.51 1621.88,-653.23 1617.48,-662.87 1624.45,-663.51"/>
</g>
<!-- ln2_3 -->
<g id="node39" class="node">
<title>ln2_3</title>
<polygon fill="white" stroke="black" points="1687.5,-460.22 1550.5,-460.22 1550.5,-422.22 1687.5,-422.22 1687.5,-460.22"/>
<text text-anchor="middle" x="1619" y="-445.02" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="1619" y="-430.02" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- aggregate_3&#45;&gt;ln2_3 -->
<g id="edge101" class="edge">
<title>aggregate_3&#45;&gt;ln2_3</title>
<path fill="none" stroke="black" d="M1619,-546.94C1619,-521.57 1619,-492.07 1619,-470.86"/>
<polygon fill="black" stroke="black" points="1622.5,-470.59 1619,-460.59 1615.5,-470.59 1622.5,-470.59"/>
</g>
<!-- ln2_3&#45;&gt;residual_3 -->
<g id="edge102" class="edge">
<title>ln2_3&#45;&gt;residual_3</title>
<path fill="none" stroke="black" d="M1619,-422.02C1619,-402.36 1619,-370.5 1619,-345.67"/>
<polygon fill="black" stroke="black" points="1622.5,-345.52 1619,-335.52 1615.5,-345.52 1622.5,-345.52"/>
</g>
<!-- output_3 -->
<g id="node41" class="node">
<title>output_3</title>
<ellipse fill="white" stroke="black" cx="1596" cy="-167.61" rx="96.75" ry="26.74"/>
<text text-anchor="middle" x="1596" y="-171.41" font-family="Times,serif" font-size="14.00">Output Chunk</text>
<text text-anchor="middle" x="1596" y="-156.41" font-family="Times,serif" font-size="14.00">(B, L/4, d_model)</text>
</g>
<!-- residual_3&#45;&gt;output_3 -->
<g id="edge104" class="edge">
<title>residual_3&#45;&gt;output_3</title>
<path fill="none" stroke="black" d="M1614.67,-281.25C1611.09,-259.65 1605.96,-228.71 1601.99,-204.73"/>
<polygon fill="black" stroke="black" points="1605.4,-203.88 1600.31,-194.59 1598.49,-205.03 1605.4,-203.88"/>
</g>
<!-- output_3&#45;&gt;final_output -->
<g id="edge108" class="edge">
<title>output_3&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M1517.81,-151.56C1380.66,-125.17 1097.99,-70.78 957.71,-43.79"/>
<polygon fill="black" stroke="black" points="958.34,-40.34 947.86,-41.89 957.02,-47.22 958.34,-40.34"/>
</g>
<!-- expert_comm_0_1&#45;&gt;expert_1_2 -->
<g id="edge10" class="edge">
<title>expert_comm_0_1&#45;&gt;expert_1_2</title>
<path fill="none" stroke="black" d="M2781.66,-919.79C2758.85,-910.71 2732.55,-901.11 2708,-894.22 2568.83,-855.18 2531.76,-851.21 2388,-836.22 2053.68,-801.37 1206.7,-853.45 876,-793.22 875.25,-793.08 874.49,-792.94 873.74,-792.79"/>
<polygon fill="black" stroke="black" points="874.34,-789.34 863.81,-790.54 872.79,-796.17 874.34,-789.34"/>
</g>
<!-- expert_comm_0_2&#45;&gt;expert_2_4 -->
<g id="edge14" class="edge">
<title>expert_comm_0_2&#45;&gt;expert_2_4</title>
<path fill="none" stroke="black" d="M3592.07,-919.65C3569.19,-910.5 3542.73,-900.89 3518,-894.22 3361.11,-851.9 3318.81,-851.21 3157,-836.22 2407.96,-766.85 2215.47,-844.81 1465,-793.22 1412.88,-789.64 1354.29,-782.99 1309.69,-777.38"/>
<polygon fill="black" stroke="black" points="1309.89,-773.88 1299.53,-776.09 1309.01,-780.82 1309.89,-773.88"/>
</g>
<!-- expert_comm_0_3&#45;&gt;expert_3_6 -->
<g id="edge18" class="edge">
<title>expert_comm_0_3&#45;&gt;expert_3_6</title>
<path fill="none" stroke="black" d="M4402.08,-919.62C4379.2,-910.47 4352.74,-900.87 4328,-894.22 4168.94,-851.5 4125.98,-851.62 3962,-836.22 3518.5,-794.58 2092.85,-773.2 1755.87,-768.65"/>
<polygon fill="black" stroke="black" points="1755.8,-765.15 1745.75,-768.51 1755.7,-772.15 1755.8,-765.15"/>
</g>
<!-- expert_comm_1_0&#45;&gt;expert_0_0 -->
<g id="edge33" class="edge">
<title>expert_comm_1_0&#45;&gt;expert_0_0</title>
<path fill="none" stroke="black" d="M2000.05,-907.77C1975.62,-882.3 1939.92,-850.96 1901,-836.22 1749.13,-778.69 599.76,-822.4 440,-793.22 439.25,-793.08 438.49,-792.94 437.74,-792.79"/>
<polygon fill="black" stroke="black" points="438.34,-789.34 427.81,-790.54 436.79,-796.16 438.34,-789.34"/>
</g>
<!-- expert_comm_1_2&#45;&gt;expert_2_4 -->
<g id="edge40" class="edge">
<title>expert_comm_1_2&#45;&gt;expert_2_4</title>
<path fill="none" stroke="black" d="M3863.26,-919.35C3840.17,-910 3813.27,-900.33 3788,-894.22 3552.52,-837.31 3487.75,-852.05 3246,-836.22 2455.91,-784.5 2254.96,-847.02 1465,-793.22 1412.88,-789.67 1354.29,-783.02 1309.69,-777.4"/>
<polygon fill="black" stroke="black" points="1309.89,-773.9 1299.53,-776.11 1309.01,-780.84 1309.89,-773.9"/>
</g>
<!-- expert_comm_1_3&#45;&gt;expert_3_6 -->
<g id="edge44" class="edge">
<title>expert_comm_1_3&#45;&gt;expert_3_6</title>
<path fill="none" stroke="black" d="M4673.26,-919.34C4650.17,-909.98 4623.27,-900.32 4598,-894.22 4360.78,-836.98 4295.48,-852.65 4052,-836.22 3147.58,-775.19 2045.25,-768.47 1756.17,-767.79"/>
<polygon fill="black" stroke="black" points="1755.83,-764.28 1745.83,-767.76 1755.82,-771.28 1755.83,-764.28"/>
</g>
<!-- expert_comm_2_0&#45;&gt;expert_0_0 -->
<g id="edge59" class="edge">
<title>expert_comm_2_0&#45;&gt;expert_0_0</title>
<path fill="none" stroke="black" d="M2240.75,-920.3C2218.07,-911.38 2192.09,-901.75 2168,-894.22 2063.67,-861.62 2037.33,-850.77 1929,-836.22 1600.92,-792.17 765.66,-852.6 440,-793.22 439.25,-793.08 438.49,-792.94 437.74,-792.79"/>
<polygon fill="black" stroke="black" points="438.34,-789.34 427.81,-790.54 436.79,-796.17 438.34,-789.34"/>
</g>
<!-- expert_comm_2_1&#45;&gt;expert_1_2 -->
<g id="edge63" class="edge">
<title>expert_comm_2_1&#45;&gt;expert_1_2</title>
<path fill="none" stroke="black" d="M3052.9,-919.3C3029.89,-910 3003.13,-900.38 2978,-894.22 2755.57,-839.73 2694.45,-852.22 2466,-836.22 2113.4,-811.53 1223.79,-856.31 876,-793.22 875.25,-793.08 874.49,-792.94 873.74,-792.79"/>
<polygon fill="black" stroke="black" points="874.34,-789.34 863.81,-790.55 872.79,-796.17 874.34,-789.34"/>
</g>
<!-- expert_comm_2_3&#45;&gt;expert_3_6 -->
<g id="edge70" class="edge">
<title>expert_comm_2_3&#45;&gt;expert_3_6</title>
<path fill="none" stroke="black" d="M4943.32,-919.09C4920.24,-909.71 4893.32,-900.09 4868,-894.22 4581.13,-827.76 4501.98,-853.11 4208,-836.22 3238.11,-780.49 2055.88,-769.92 1755.85,-768.08"/>
<polygon fill="black" stroke="black" points="1755.57,-764.58 1745.55,-768.02 1755.53,-771.58 1755.57,-764.58"/>
</g>
<!-- expert_comm_3_0&#45;&gt;expert_0_0 -->
<g id="edge85" class="edge">
<title>expert_comm_3_0&#45;&gt;expert_0_0</title>
<path fill="none" stroke="black" d="M2512.85,-919.5C2489.83,-910.22 2463.08,-900.57 2438,-894.22 2242.08,-844.65 2188.48,-851.94 1987,-836.22 1644.13,-809.48 778.37,-854.73 440,-793.22 439.25,-793.08 438.49,-792.94 437.74,-792.79"/>
<polygon fill="black" stroke="black" points="438.34,-789.34 427.81,-790.55 436.79,-796.17 438.34,-789.34"/>
</g>
<!-- expert_comm_3_1&#45;&gt;expert_1_2 -->
<g id="edge89" class="edge">
<title>expert_comm_3_1&#45;&gt;expert_1_2</title>
<path fill="none" stroke="black" d="M3323.31,-919.13C3300.23,-909.75 3273.32,-900.12 3248,-894.22 2970.28,-829.46 2893.69,-852.65 2609,-836.22 2224.41,-814.02 1255.12,-861.55 876,-793.22 875.25,-793.08 874.49,-792.94 873.74,-792.79"/>
<polygon fill="black" stroke="black" points="874.33,-789.34 863.81,-790.56 872.8,-796.17 874.33,-789.34"/>
</g>
<!-- expert_comm_3_2&#45;&gt;expert_2_4 -->
<g id="edge93" class="edge">
<title>expert_comm_3_2&#45;&gt;expert_2_4</title>
<path fill="none" stroke="black" d="M4133.31,-919.11C4110.23,-909.72 4083.32,-900.1 4058,-894.22 3774.18,-828.33 3695.92,-852.35 3405,-836.22 2543.89,-788.49 2325.5,-850.97 1465,-793.22 1412.87,-789.72 1354.28,-783.07 1309.68,-777.44"/>
<polygon fill="black" stroke="black" points="1309.89,-773.94 1299.53,-776.14 1309,-780.88 1309.89,-773.94"/>
</g>
</g>
</svg>
