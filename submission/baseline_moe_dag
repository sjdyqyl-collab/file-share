digraph baseline_moe {
	rankdir=TB size="20,30"
	node [fillcolor=lightblue shape=rectangle style=filled]
	node [fillcolor=lightgreen shape=ellipse style=filled]
	node [fillcolor=lightyellow shape=parallelogram style=filled]
	input [label="Total Input
[1024 tokens, hidden_size]" fillcolor=lightcoral shape=ellipse]
	subgraph cluster_layer_0 {
		label="Layer 1"
		route_0_0 [label="Routing Layer 1
Stage 1
[1024 tokens]" shape=parallelogram]
		expert_0_0 [label="Expert 0
GPU 0
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_0_1 [label="Expert 1
GPU 1
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_0_2 [label="Expert 2
GPU 2
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_0_3 [label="Expert 3
GPU 3
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_0_4 [label="Expert 4
GPU 4
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_0_5 [label="Expert 5
GPU 5
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_0_6 [label="Expert 6
GPU 6
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_0_7 [label="Expert 7
GPU 7
[1024 tokens, expert_dim]" fillcolor=lightblue]
		agg_0_0 [label="Aggregation Layer 1
Stage 1
[1024 tokens]" shape=parallelogram]
		residual_0_0 [label="Residual Add Layer 1
Stage 1
[1024 tokens]" fillcolor=orange shape=rectangle]
		route_0_1 [label="Routing Layer 1
Stage 2
[1024 tokens]" shape=parallelogram]
		expert_0_0 [label="Expert 0
GPU 8
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_0_1 [label="Expert 1
GPU 9
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_0_2 [label="Expert 2
GPU 10
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_0_3 [label="Expert 3
GPU 11
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_0_4 [label="Expert 4
GPU 12
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_0_5 [label="Expert 5
GPU 13
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_0_6 [label="Expert 6
GPU 14
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_0_7 [label="Expert 7
GPU 15
[1024 tokens, expert_dim]" fillcolor=lightblue]
		agg_0_1 [label="Aggregation Layer 1
Stage 2
[1024 tokens]" shape=parallelogram]
		residual_0_1 [label="Residual Add Layer 1
Stage 2
[1024 tokens]" fillcolor=orange shape=rectangle]
	}
	subgraph cluster_layer_1 {
		label="Layer 2"
		route_1_0 [label="Routing Layer 2
Stage 1
[1024 tokens]" shape=parallelogram]
		expert_1_0 [label="Expert 16
GPU 16
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_1_1 [label="Expert 17
GPU 17
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_1_2 [label="Expert 18
GPU 18
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_1_3 [label="Expert 19
GPU 19
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_1_4 [label="Expert 20
GPU 20
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_1_5 [label="Expert 21
GPU 21
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_1_6 [label="Expert 22
GPU 22
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_1_7 [label="Expert 23
GPU 23
[1024 tokens, expert_dim]" fillcolor=lightblue]
		agg_1_0 [label="Aggregation Layer 2
Stage 1
[1024 tokens]" shape=parallelogram]
		residual_1_0 [label="Residual Add Layer 2
Stage 1
[1024 tokens]" fillcolor=orange shape=rectangle]
		route_1_1 [label="Routing Layer 2
Stage 2
[1024 tokens]" shape=parallelogram]
		expert_1_0 [label="Expert 16
GPU 24
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_1_1 [label="Expert 17
GPU 25
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_1_2 [label="Expert 18
GPU 26
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_1_3 [label="Expert 19
GPU 27
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_1_4 [label="Expert 20
GPU 28
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_1_5 [label="Expert 21
GPU 29
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_1_6 [label="Expert 22
GPU 30
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_1_7 [label="Expert 23
GPU 31
[1024 tokens, expert_dim]" fillcolor=lightblue]
		agg_1_1 [label="Aggregation Layer 2
Stage 2
[1024 tokens]" shape=parallelogram]
		residual_1_1 [label="Residual Add Layer 2
Stage 2
[1024 tokens]" fillcolor=orange shape=rectangle]
	}
	subgraph cluster_layer_2 {
		label="Layer 3"
		route_2_0 [label="Routing Layer 3
Stage 1
[1024 tokens]" shape=parallelogram]
		expert_2_0 [label="Expert 32
GPU 32
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_2_1 [label="Expert 33
GPU 33
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_2_2 [label="Expert 34
GPU 34
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_2_3 [label="Expert 35
GPU 35
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_2_4 [label="Expert 36
GPU 36
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_2_5 [label="Expert 37
GPU 37
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_2_6 [label="Expert 38
GPU 38
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_2_7 [label="Expert 39
GPU 39
[1024 tokens, expert_dim]" fillcolor=lightblue]
		agg_2_0 [label="Aggregation Layer 3
Stage 1
[1024 tokens]" shape=parallelogram]
		residual_2_0 [label="Residual Add Layer 3
Stage 1
[1024 tokens]" fillcolor=orange shape=rectangle]
		route_2_1 [label="Routing Layer 3
Stage 2
[1024 tokens]" shape=parallelogram]
		expert_2_0 [label="Expert 32
GPU 40
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_2_1 [label="Expert 33
GPU 41
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_2_2 [label="Expert 34
GPU 42
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_2_3 [label="Expert 35
GPU 43
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_2_4 [label="Expert 36
GPU 44
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_2_5 [label="Expert 37
GPU 45
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_2_6 [label="Expert 38
GPU 46
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_2_7 [label="Expert 39
GPU 47
[1024 tokens, expert_dim]" fillcolor=lightblue]
		agg_2_1 [label="Aggregation Layer 3
Stage 2
[1024 tokens]" shape=parallelogram]
		residual_2_1 [label="Residual Add Layer 3
Stage 2
[1024 tokens]" fillcolor=orange shape=rectangle]
	}
	subgraph cluster_layer_3 {
		label="Layer 4"
		route_3_0 [label="Routing Layer 4
Stage 1
[1024 tokens]" shape=parallelogram]
		expert_3_0 [label="Expert 48
GPU 48
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_3_1 [label="Expert 49
GPU 49
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_3_2 [label="Expert 50
GPU 50
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_3_3 [label="Expert 51
GPU 51
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_3_4 [label="Expert 52
GPU 52
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_3_5 [label="Expert 53
GPU 53
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_3_6 [label="Expert 54
GPU 54
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_3_7 [label="Expert 55
GPU 55
[1024 tokens, expert_dim]" fillcolor=lightblue]
		agg_3_0 [label="Aggregation Layer 4
Stage 1
[1024 tokens]" shape=parallelogram]
		residual_3_0 [label="Residual Add Layer 4
Stage 1
[1024 tokens]" fillcolor=orange shape=rectangle]
		route_3_1 [label="Routing Layer 4
Stage 2
[1024 tokens]" shape=parallelogram]
		expert_3_0 [label="Expert 48
GPU 56
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_3_1 [label="Expert 49
GPU 57
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_3_2 [label="Expert 50
GPU 58
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_3_3 [label="Expert 51
GPU 59
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_3_4 [label="Expert 52
GPU 60
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_3_5 [label="Expert 53
GPU 61
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_3_6 [label="Expert 54
GPU 62
[1024 tokens, expert_dim]" fillcolor=lightblue]
		expert_3_7 [label="Expert 55
GPU 63
[1024 tokens, expert_dim]" fillcolor=lightblue]
		agg_3_1 [label="Aggregation Layer 4
Stage 2
[1024 tokens]" shape=parallelogram]
		residual_3_1 [label="Residual Add Layer 4
Stage 2
[1024 tokens]" fillcolor=orange shape=rectangle]
	}
	input -> route_0_0
	route_0_0 -> expert_0_0
	route_0_0 -> expert_0_1
	expert_0_0 -> agg_0_0
	expert_0_1 -> agg_0_0
	agg_0_0 -> residual_0_0
	residual_0_0 -> route_0_1
}
