<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: proposed_moe_detailed Pages: 1 -->
<svg width="3600pt" height="2322pt"
 viewBox="0.00 0.00 3600.00 2321.71" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.45 0.45) rotate(0) translate(4 5168.91)">
<title>proposed_moe_detailed</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-5168.91 8017,-5168.91 8017,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_layer1</title>
<polygon fill="none" stroke="black" points="80,-3849.95 80,-5033.95 8005,-5033.95 8005,-3849.95 80,-3849.95"/>
<text text-anchor="middle" x="4042.5" y="-5018.75" font-family="Times,serif" font-size="14.00">Layer 1 (16 experts, 1 expert/GPU)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_layer2</title>
<polygon fill="none" stroke="black" points="37,-2617.95 37,-3801.95 7962,-3801.95 7962,-2617.95 37,-2617.95"/>
<text text-anchor="middle" x="3999.5" y="-3786.75" font-family="Times,serif" font-size="14.00">Layer 2 (16 experts, 1 expert/GPU)</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_layer3</title>
<polygon fill="none" stroke="black" points="39,-1385.95 39,-2569.95 7964,-2569.95 7964,-1385.95 39,-1385.95"/>
<text text-anchor="middle" x="4001.5" y="-2554.75" font-family="Times,serif" font-size="14.00">Layer 3 (16 experts, 1 expert/GPU)</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_layer4</title>
<polygon fill="none" stroke="black" points="8,-153.95 8,-1337.95 7933,-1337.95 7933,-153.95 8,-153.95"/>
<text text-anchor="middle" x="3970.5" y="-1322.75" font-family="Times,serif" font-size="14.00">Layer 4 (16 experts, 1 expert/GPU)</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightcoral" stroke="black" cx="4042" cy="-5127.43" rx="145.83" ry="37.45"/>
<text text-anchor="middle" x="4042" y="-5138.73" font-family="Times,serif" font-size="14.00">Model Input</text>
<text text-anchor="middle" x="4042" y="-5123.73" font-family="Times,serif" font-size="14.00">[1024 tokens, hidden_dim]</text>
<text text-anchor="middle" x="4042" y="-5108.73" font-family="Times,serif" font-size="14.00">Broadcast to all 64 GPUs</text>
</g>
<!-- layer1_attn -->
<g id="node2" class="node">
<title>layer1_attn</title>
<polygon fill="lightblue" stroke="black" points="4042,-5002.95 3836,-4949.95 4042,-4896.95 4248,-4949.95 4042,-5002.95"/>
<text text-anchor="middle" x="4042" y="-4961.25" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="4042" y="-4946.25" font-family="Times,serif" font-size="14.00">[1024 tokens, hidden_dim]</text>
<text text-anchor="middle" x="4042" y="-4931.25" font-family="Times,serif" font-size="14.00">Replicated on GPUs 0&#45;15</text>
</g>
<!-- input&#45;&gt;layer1_attn -->
<g id="edge1" class="edge">
<title>input&#45;&gt;layer1_attn</title>
<path fill="none" stroke="black" d="M4042,-5089.64C4042,-5067.46 4042,-5038.64 4042,-5013.01"/>
<polygon fill="black" stroke="black" points="4045.5,-5013 4042,-5003 4038.5,-5013 4045.5,-5013"/>
</g>
<!-- layer1_gate -->
<g id="node3" class="node">
<title>layer1_gate</title>
<polygon fill="orange" stroke="black" points="4231.95,-4809.95 3929.78,-4809.95 3852.05,-4673.95 4154.22,-4673.95 4231.95,-4809.95"/>
<text text-anchor="middle" x="4042" y="-4760.75" font-family="Times,serif" font-size="14.00">Gate Network</text>
<text text-anchor="middle" x="4042" y="-4745.75" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="4042" y="-4730.75" font-family="Times,serif" font-size="14.00">Compute routing probs</text>
<text text-anchor="middle" x="4042" y="-4715.75" font-family="Times,serif" font-size="14.00">GPUs 0&#45;15</text>
</g>
<!-- layer1_attn&#45;&gt;layer1_gate -->
<g id="edge2" class="edge">
<title>layer1_attn&#45;&gt;layer1_gate</title>
<path fill="none" stroke="black" d="M4042,-4896.7C4042,-4873.45 4042,-4845.59 4042,-4820.02"/>
<polygon fill="black" stroke="black" points="4045.5,-4819.97 4042,-4809.97 4038.5,-4819.97 4045.5,-4819.97"/>
</g>
<!-- layer1_split -->
<g id="node4" class="node">
<title>layer1_split</title>
<polygon fill="orange" stroke="black" points="4266.95,-4586.95 3909.1,-4586.95 3817.05,-4480.95 4174.9,-4480.95 4266.95,-4586.95"/>
<text text-anchor="middle" x="4042" y="-4545.25" font-family="Times,serif" font-size="14.00">Split Tokens by Expert</text>
<text text-anchor="middle" x="4042" y="-4530.25" font-family="Times,serif" font-size="14.00">[Variable tokens per expert]</text>
<text text-anchor="middle" x="4042" y="-4515.25" font-family="Times,serif" font-size="14.00">Async routing</text>
</g>
<!-- layer1_gate&#45;&gt;layer1_split -->
<g id="edge3" class="edge">
<title>layer1_gate&#45;&gt;layer1_split</title>
<path fill="none" stroke="black" d="M4042,-4673.79C4042,-4649.13 4042,-4621.34 4042,-4597.14"/>
<polygon fill="black" stroke="black" points="4045.5,-4597.01 4042,-4587.01 4038.5,-4597.01 4045.5,-4597.01"/>
</g>
<!-- layer1_expert0_gpu0 -->
<g id="node5" class="node">
<title>layer1_expert0_gpu0</title>
<polygon fill="lightblue" stroke="black" points="315,-4379.95 88,-4326.95 315,-4273.95 542,-4326.95 315,-4379.95"/>
<text text-anchor="middle" x="315" y="-4338.25" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="315" y="-4323.25" font-family="Times,serif" font-size="14.00">GPU 0</text>
<text text-anchor="middle" x="315" y="-4308.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer1_split&#45;&gt;layer1_expert0_gpu0 -->
<g id="edge4" class="edge">
<title>layer1_split&#45;&gt;layer1_expert0_gpu0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3857.89,-4528.23C3430.44,-4516.84 2337.6,-4485.24 1425,-4437.95 1041.98,-4418.11 943.96,-4432.17 564,-4379.95 521.66,-4374.14 475.75,-4365.29 435.02,-4356.53"/>
<polygon fill="black" stroke="black" points="435.57,-4353.06 425.06,-4354.36 434.09,-4359.91 435.57,-4353.06"/>
<text text-anchor="middle" x="1475" y="-4426.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer1_expert1_gpu1 -->
<g id="node6" class="node">
<title>layer1_expert1_gpu1</title>
<polygon fill="lightblue" stroke="black" points="812,-4379.95 585,-4326.95 812,-4273.95 1039,-4326.95 812,-4379.95"/>
<text text-anchor="middle" x="812" y="-4338.25" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="812" y="-4323.25" font-family="Times,serif" font-size="14.00">GPU 1</text>
<text text-anchor="middle" x="812" y="-4308.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer1_split&#45;&gt;layer1_expert1_gpu1 -->
<g id="edge5" class="edge">
<title>layer1_split&#45;&gt;layer1_expert1_gpu1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3856.6,-4526.78C3479.13,-4513.8 2594.27,-4481.26 1852,-4437.95 1500.1,-4417.42 1410.07,-4428.98 1061,-4379.95 1018.78,-4374.02 972.99,-4365.17 932.33,-4356.44"/>
<polygon fill="black" stroke="black" points="932.9,-4352.99 922.38,-4354.29 931.42,-4359.83 932.9,-4352.99"/>
<text text-anchor="middle" x="1902" y="-4426.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer1_expert2_gpu2 -->
<g id="node7" class="node">
<title>layer1_expert2_gpu2</title>
<polygon fill="lightblue" stroke="black" points="1309,-4379.95 1082,-4326.95 1309,-4273.95 1536,-4326.95 1309,-4379.95"/>
<text text-anchor="middle" x="1309" y="-4338.25" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="1309" y="-4323.25" font-family="Times,serif" font-size="14.00">GPU 2</text>
<text text-anchor="middle" x="1309" y="-4308.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer1_split&#45;&gt;layer1_expert2_gpu2 -->
<g id="edge6" class="edge">
<title>layer1_split&#45;&gt;layer1_expert2_gpu2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3861.01,-4531.61C3449.73,-4526.41 2414.12,-4501.28 1558,-4379.95 1515.79,-4373.97 1470,-4365.11 1429.34,-4356.38"/>
<polygon fill="black" stroke="black" points="1429.91,-4352.92 1419.39,-4354.23 1428.43,-4359.77 1429.91,-4352.92"/>
<text text-anchor="middle" x="2080" y="-4426.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer1_expert3_gpu3 -->
<g id="node8" class="node">
<title>layer1_expert3_gpu3</title>
<polygon fill="lightblue" stroke="black" points="1806,-4379.95 1579,-4326.95 1806,-4273.95 2033,-4326.95 1806,-4379.95"/>
<text text-anchor="middle" x="1806" y="-4338.25" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1806" y="-4323.25" font-family="Times,serif" font-size="14.00">GPU 3</text>
<text text-anchor="middle" x="1806" y="-4308.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer1_split&#45;&gt;layer1_expert3_gpu3 -->
<g id="edge7" class="edge">
<title>layer1_split&#45;&gt;layer1_expert3_gpu3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3856.87,-4526.95C3504.5,-4513.69 2713.74,-4475.19 2055,-4379.95 2012.91,-4373.87 1967.24,-4365 1926.65,-4356.31"/>
<polygon fill="black" stroke="black" points="1927.23,-4352.85 1916.72,-4354.16 1925.76,-4359.69 1927.23,-4352.85"/>
<text text-anchor="middle" x="2538" y="-4426.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer1_expert4_gpu4 -->
<g id="node9" class="node">
<title>layer1_expert4_gpu4</title>
<polygon fill="lightblue" stroke="black" points="2303,-4379.95 2076,-4326.95 2303,-4273.95 2530,-4326.95 2303,-4379.95"/>
<text text-anchor="middle" x="2303" y="-4338.25" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="2303" y="-4323.25" font-family="Times,serif" font-size="14.00">GPU 4</text>
<text text-anchor="middle" x="2303" y="-4308.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer1_split&#45;&gt;layer1_expert4_gpu4 -->
<g id="edge8" class="edge">
<title>layer1_split&#45;&gt;layer1_expert4_gpu4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3850.67,-4519.68C3566.31,-4498.51 3015.81,-4452 2552,-4379.95 2510.38,-4373.49 2465.2,-4364.62 2424.9,-4356.04"/>
<polygon fill="black" stroke="black" points="2425.55,-4352.6 2415.04,-4353.93 2424.08,-4359.44 2425.55,-4352.6"/>
<text text-anchor="middle" x="3009" y="-4426.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer1_expert5_gpu5 -->
<g id="node10" class="node">
<title>layer1_expert5_gpu5</title>
<polygon fill="lightblue" stroke="black" points="2800,-4379.95 2573,-4326.95 2800,-4273.95 3027,-4326.95 2800,-4379.95"/>
<text text-anchor="middle" x="2800" y="-4338.25" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="2800" y="-4323.25" font-family="Times,serif" font-size="14.00">GPU 5</text>
<text text-anchor="middle" x="2800" y="-4308.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer1_split&#45;&gt;layer1_expert5_gpu5 -->
<g id="edge9" class="edge">
<title>layer1_split&#45;&gt;layer1_expert5_gpu5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3837.5,-4504.68C3636.37,-4476.1 3320.82,-4429.24 3049,-4379.95 3008.44,-4372.6 2964.36,-4363.69 2924.71,-4355.35"/>
<polygon fill="black" stroke="black" points="2925.24,-4351.88 2914.73,-4353.24 2923.79,-4358.73 2925.24,-4351.88"/>
<text text-anchor="middle" x="3425" y="-4426.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer1_expert6_gpu6 -->
<g id="node11" class="node">
<title>layer1_expert6_gpu6</title>
<polygon fill="lightblue" stroke="black" points="3297,-4379.95 3070,-4326.95 3297,-4273.95 3524,-4326.95 3297,-4379.95"/>
<text text-anchor="middle" x="3297" y="-4338.25" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="3297" y="-4323.25" font-family="Times,serif" font-size="14.00">GPU 6</text>
<text text-anchor="middle" x="3297" y="-4308.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer1_split&#45;&gt;layer1_expert6_gpu6 -->
<g id="edge10" class="edge">
<title>layer1_split&#45;&gt;layer1_expert6_gpu6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3852.56,-4480.83C3712.41,-4442.26 3526.24,-4391.03 3409.01,-4358.77"/>
<polygon fill="black" stroke="black" points="3409.85,-4355.38 3399.28,-4356.1 3408,-4362.13 3409.85,-4355.38"/>
<text text-anchor="middle" x="3741" y="-4426.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer1_expert7_gpu7 -->
<g id="node12" class="node">
<title>layer1_expert7_gpu7</title>
<polygon fill="lightblue" stroke="black" points="3794,-4379.95 3567,-4326.95 3794,-4273.95 4021,-4326.95 3794,-4379.95"/>
<text text-anchor="middle" x="3794" y="-4338.25" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="3794" y="-4323.25" font-family="Times,serif" font-size="14.00">GPU 7</text>
<text text-anchor="middle" x="3794" y="-4308.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer1_split&#45;&gt;layer1_expert7_gpu7 -->
<g id="edge11" class="edge">
<title>layer1_split&#45;&gt;layer1_expert7_gpu7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3978.78,-4480.69C3939.52,-4448.24 3889.47,-4406.87 3851.36,-4375.37"/>
<polygon fill="black" stroke="black" points="3853.36,-4372.48 3843.42,-4368.8 3848.9,-4377.87 3853.36,-4372.48"/>
<text text-anchor="middle" x="3975" y="-4426.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer1_expert8_gpu8 -->
<g id="node13" class="node">
<title>layer1_expert8_gpu8</title>
<polygon fill="lightblue" stroke="black" points="4291,-4379.95 4064,-4326.95 4291,-4273.95 4518,-4326.95 4291,-4379.95"/>
<text text-anchor="middle" x="4291" y="-4338.25" font-family="Times,serif" font-size="14.00">Expert 8</text>
<text text-anchor="middle" x="4291" y="-4323.25" font-family="Times,serif" font-size="14.00">GPU 8</text>
<text text-anchor="middle" x="4291" y="-4308.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer1_split&#45;&gt;layer1_expert8_gpu8 -->
<g id="edge12" class="edge">
<title>layer1_split&#45;&gt;layer1_expert8_gpu8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4105.48,-4480.69C4145.03,-4448.13 4195.49,-4406.59 4233.8,-4375.05"/>
<polygon fill="black" stroke="black" points="4236.28,-4377.53 4241.78,-4368.48 4231.84,-4372.13 4236.28,-4377.53"/>
<text text-anchor="middle" x="4223" y="-4426.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer1_expert9_gpu9 -->
<g id="node14" class="node">
<title>layer1_expert9_gpu9</title>
<polygon fill="lightblue" stroke="black" points="4788,-4379.95 4561,-4326.95 4788,-4273.95 5015,-4326.95 4788,-4379.95"/>
<text text-anchor="middle" x="4788" y="-4338.25" font-family="Times,serif" font-size="14.00">Expert 9</text>
<text text-anchor="middle" x="4788" y="-4323.25" font-family="Times,serif" font-size="14.00">GPU 9</text>
<text text-anchor="middle" x="4788" y="-4308.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer1_split&#45;&gt;layer1_expert9_gpu9 -->
<g id="edge13" class="edge">
<title>layer1_split&#45;&gt;layer1_expert9_gpu9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4185.84,-4493.43C4328.86,-4454.13 4545.27,-4394.65 4675.98,-4358.74"/>
<polygon fill="black" stroke="black" points="4676.91,-4362.11 4685.63,-4356.08 4675.06,-4355.36 4676.91,-4362.11"/>
<text text-anchor="middle" x="4487" y="-4426.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer1_expert10_gpu10 -->
<g id="node15" class="node">
<title>layer1_expert10_gpu10</title>
<polygon fill="lightblue" stroke="black" points="5285,-4379.95 5058,-4326.95 5285,-4273.95 5512,-4326.95 5285,-4379.95"/>
<text text-anchor="middle" x="5285" y="-4338.25" font-family="Times,serif" font-size="14.00">Expert 10</text>
<text text-anchor="middle" x="5285" y="-4323.25" font-family="Times,serif" font-size="14.00">GPU 10</text>
<text text-anchor="middle" x="5285" y="-4308.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer1_split&#45;&gt;layer1_expert10_gpu10 -->
<g id="edge14" class="edge">
<title>layer1_split&#45;&gt;layer1_expert10_gpu10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4201.42,-4511.15C4398.28,-4483.6 4743.16,-4433.31 5037,-4379.95 5077.3,-4372.64 5121.09,-4363.76 5160.51,-4355.43"/>
<polygon fill="black" stroke="black" points="5161.37,-4358.83 5170.43,-4353.33 5159.92,-4351.98 5161.37,-4358.83"/>
<text text-anchor="middle" x="4814" y="-4426.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer1_expert11_gpu11 -->
<g id="node16" class="node">
<title>layer1_expert11_gpu11</title>
<polygon fill="lightblue" stroke="black" points="5782,-4379.95 5555,-4326.95 5782,-4273.95 6009,-4326.95 5782,-4379.95"/>
<text text-anchor="middle" x="5782" y="-4338.25" font-family="Times,serif" font-size="14.00">Expert 11</text>
<text text-anchor="middle" x="5782" y="-4323.25" font-family="Times,serif" font-size="14.00">GPU 11</text>
<text text-anchor="middle" x="5782" y="-4308.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer1_split&#45;&gt;layer1_expert11_gpu11 -->
<g id="edge15" class="edge">
<title>layer1_split&#45;&gt;layer1_expert11_gpu11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4210.27,-4521.46C4487.36,-4501.24 5056.57,-4454.28 5534,-4379.95 5575.46,-4373.5 5620.46,-4364.63 5660.6,-4356.05"/>
<polygon fill="black" stroke="black" points="5661.38,-4359.46 5670.42,-4353.94 5659.91,-4352.62 5661.38,-4359.46"/>
<text text-anchor="middle" x="5258" y="-4426.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer1_expert12_gpu12 -->
<g id="node17" class="node">
<title>layer1_expert12_gpu12</title>
<polygon fill="lightblue" stroke="black" points="6279,-4379.95 6052,-4326.95 6279,-4273.95 6506,-4326.95 6279,-4379.95"/>
<text text-anchor="middle" x="6279" y="-4338.25" font-family="Times,serif" font-size="14.00">Expert 12</text>
<text text-anchor="middle" x="6279" y="-4323.25" font-family="Times,serif" font-size="14.00">GPU 12</text>
<text text-anchor="middle" x="6279" y="-4308.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer1_split&#45;&gt;layer1_expert12_gpu12 -->
<g id="edge16" class="edge">
<title>layer1_split&#45;&gt;layer1_expert12_gpu12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4215.46,-4527.45C4562.04,-4514.72 5364.13,-4476.6 6031,-4379.95 6072.83,-4373.89 6118.19,-4365.05 6158.55,-4356.38"/>
<polygon fill="black" stroke="black" points="6159.39,-4359.78 6168.42,-4354.24 6157.91,-4352.94 6159.39,-4359.78"/>
<text text-anchor="middle" x="5702" y="-4426.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer1_expert13_gpu13 -->
<g id="node18" class="node">
<title>layer1_expert13_gpu13</title>
<polygon fill="lightblue" stroke="black" points="6776,-4379.95 6549,-4326.95 6776,-4273.95 7003,-4326.95 6776,-4379.95"/>
<text text-anchor="middle" x="6776" y="-4338.25" font-family="Times,serif" font-size="14.00">Expert 13</text>
<text text-anchor="middle" x="6776" y="-4323.25" font-family="Times,serif" font-size="14.00">GPU 13</text>
<text text-anchor="middle" x="6776" y="-4308.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer1_split&#45;&gt;layer1_expert13_gpu13 -->
<g id="edge17" class="edge">
<title>layer1_split&#45;&gt;layer1_expert13_gpu13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4219.31,-4531.71C4628.3,-4526.74 5668.56,-4502.06 6528,-4379.95 6569.95,-4373.99 6615.43,-4365.16 6655.86,-4356.45"/>
<polygon fill="black" stroke="black" points="6656.72,-4359.85 6665.75,-4354.31 6655.23,-4353.01 6656.72,-4359.85"/>
<text text-anchor="middle" x="6173" y="-4426.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer1_expert14_gpu14 -->
<g id="node19" class="node">
<title>layer1_expert14_gpu14</title>
<polygon fill="lightblue" stroke="black" points="7273,-4379.95 7046,-4326.95 7273,-4273.95 7500,-4326.95 7273,-4379.95"/>
<text text-anchor="middle" x="7273" y="-4338.25" font-family="Times,serif" font-size="14.00">Expert 14</text>
<text text-anchor="middle" x="7273" y="-4323.25" font-family="Times,serif" font-size="14.00">GPU 14</text>
<text text-anchor="middle" x="7273" y="-4308.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer1_split&#45;&gt;layer1_expert14_gpu14 -->
<g id="edge18" class="edge">
<title>layer1_split&#45;&gt;layer1_expert14_gpu14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4215.35,-4527.19C4585.86,-4514.49 5482.31,-4481.71 6233,-4437.95 6585.34,-4417.42 6675.51,-4429.17 7025,-4379.95 7067.05,-4374.03 7112.66,-4365.18 7153.16,-4356.45"/>
<polygon fill="black" stroke="black" points="7154.04,-4359.84 7163.06,-4354.3 7152.55,-4353 7154.04,-4359.84"/>
<text text-anchor="middle" x="6599" y="-4426.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer1_expert15_gpu15 -->
<g id="node20" class="node">
<title>layer1_expert15_gpu15</title>
<polygon fill="lightblue" stroke="black" points="7770,-4379.95 7543,-4326.95 7770,-4273.95 7997,-4326.95 7770,-4379.95"/>
<text text-anchor="middle" x="7770" y="-4338.25" font-family="Times,serif" font-size="14.00">Expert 15</text>
<text text-anchor="middle" x="7770" y="-4323.25" font-family="Times,serif" font-size="14.00">GPU 15</text>
<text text-anchor="middle" x="7770" y="-4308.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer1_split&#45;&gt;layer1_expert15_gpu15 -->
<g id="edge19" class="edge">
<title>layer1_split&#45;&gt;layer1_expert15_gpu15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4216.26,-4528.48C4636.56,-4517.3 5739.3,-4485.54 6659,-4437.95 7042.91,-4418.09 7141.18,-4432.41 7522,-4379.95 7564.17,-4374.14 7609.9,-4365.3 7650.47,-4356.54"/>
<polygon fill="black" stroke="black" points="7651.37,-4359.92 7660.39,-4354.37 7649.88,-4353.08 7651.37,-4359.92"/>
<text text-anchor="middle" x="7098" y="-4426.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer1_gather -->
<g id="node21" class="node">
<title>layer1_gather</title>
<polygon fill="orange" stroke="black" points="4098.88,-4186.95 3798.42,-4186.95 3721.12,-4050.95 4021.58,-4050.95 4098.88,-4186.95"/>
<text text-anchor="middle" x="3910" y="-4137.75" font-family="Times,serif" font-size="14.00">Gather Expert Outputs</text>
<text text-anchor="middle" x="3910" y="-4122.75" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="3910" y="-4107.75" font-family="Times,serif" font-size="14.00">Async all&#45;gather</text>
<text text-anchor="middle" x="3910" y="-4092.75" font-family="Times,serif" font-size="14.00">GPUs 0&#45;15</text>
</g>
<!-- layer1_expert0_gpu0&#45;&gt;layer1_gather -->
<g id="edge20" class="edge">
<title>layer1_expert0_gpu0&#45;&gt;layer1_gather</title>
<path fill="none" stroke="black" d="M424.08,-4299.36C467.38,-4289.8 517.79,-4279.92 564,-4273.95 944.45,-4224.82 1042.83,-4248.22 1426,-4229.95 2305.9,-4188.01 3361.39,-4143.04 3753.42,-4126.52"/>
<polygon fill="black" stroke="black" points="3753.85,-4130.01 3763.7,-4126.09 3753.56,-4123.01 3753.85,-4130.01"/>
</g>
<!-- layer1_expert1_gpu1&#45;&gt;layer1_gather -->
<g id="edge21" class="edge">
<title>layer1_expert1_gpu1&#45;&gt;layer1_gather</title>
<path fill="none" stroke="black" d="M921.4,-4299.36C964.63,-4289.84 1014.91,-4279.98 1061,-4273.95 2078.9,-4140.94 3315.86,-4122.36 3750.1,-4120.11"/>
<polygon fill="black" stroke="black" points="3750.23,-4123.61 3760.21,-4120.06 3750.19,-4116.61 3750.23,-4123.61"/>
</g>
<!-- layer1_expert2_gpu2&#45;&gt;layer1_gather -->
<g id="edge22" class="edge">
<title>layer1_expert2_gpu2&#45;&gt;layer1_gather</title>
<path fill="none" stroke="black" d="M1418.74,-4299.57C1461.91,-4290.1 1512.06,-4280.22 1558,-4273.95 2378.4,-4162 3371.29,-4130.81 3751.46,-4122.66"/>
<polygon fill="black" stroke="black" points="3751.78,-4126.15 3761.7,-4122.44 3751.63,-4119.15 3751.78,-4126.15"/>
</g>
<!-- layer1_expert3_gpu3&#45;&gt;layer1_gather -->
<g id="edge23" class="edge">
<title>layer1_expert3_gpu3&#45;&gt;layer1_gather</title>
<path fill="none" stroke="black" d="M1916.73,-4299.78C1959.69,-4290.43 2009.44,-4280.58 2055,-4273.95 2680.4,-4183.04 3432.82,-4141.16 3753.23,-4126.45"/>
<polygon fill="black" stroke="black" points="3753.68,-4129.93 3763.51,-4125.98 3753.36,-4122.94 3753.68,-4129.93"/>
</g>
<!-- layer1_expert4_gpu4&#45;&gt;layer1_gather -->
<g id="edge24" class="edge">
<title>layer1_expert4_gpu4&#45;&gt;layer1_gather</title>
<path fill="none" stroke="black" d="M2415.39,-4300.17C2458.01,-4291 2507.09,-4281.17 2552,-4273.95 2986.62,-4204.08 3504.5,-4154.6 3756.71,-4132.66"/>
<polygon fill="black" stroke="black" points="3757.02,-4136.14 3766.68,-4131.79 3756.41,-4129.17 3757.02,-4136.14"/>
</g>
<!-- layer1_expert5_gpu5&#45;&gt;layer1_gather -->
<g id="edge25" class="edge">
<title>layer1_expert5_gpu5&#45;&gt;layer1_gather</title>
<path fill="none" stroke="black" d="M2916.09,-4300.98C2957.93,-4292.18 3005.54,-4282.38 3049,-4273.95 3299.31,-4225.44 3591.66,-4174.32 3763.22,-4144.88"/>
<polygon fill="black" stroke="black" points="3764.06,-4148.28 3773.33,-4143.14 3762.88,-4141.38 3764.06,-4148.28"/>
</g>
<!-- layer1_expert6_gpu6&#45;&gt;layer1_gather -->
<g id="edge26" class="edge">
<title>layer1_expert6_gpu6&#45;&gt;layer1_gather</title>
<path fill="none" stroke="black" d="M3388.44,-4295.22C3490.62,-4260.89 3657.08,-4204.95 3774.41,-4165.52"/>
<polygon fill="black" stroke="black" points="3775.83,-4168.74 3784.19,-4162.23 3773.6,-4162.1 3775.83,-4168.74"/>
</g>
<!-- layer1_expert7_gpu7&#45;&gt;layer1_gather -->
<g id="edge27" class="edge">
<title>layer1_expert7_gpu7&#45;&gt;layer1_gather</title>
<path fill="none" stroke="black" d="M3819.89,-4279.98C3833.75,-4255.37 3851.18,-4224.42 3867,-4196.31"/>
<polygon fill="black" stroke="black" points="3870.22,-4197.72 3872.08,-4187.29 3864.12,-4194.29 3870.22,-4197.72"/>
</g>
<!-- layer1_expert8_gpu8&#45;&gt;layer1_gather -->
<g id="edge28" class="edge">
<title>layer1_expert8_gpu8&#45;&gt;layer1_gather</title>
<path fill="none" stroke="black" d="M4223.76,-4289.6C4173.88,-4262.63 4104.23,-4224.97 4043.22,-4191.98"/>
<polygon fill="black" stroke="black" points="4044.75,-4188.83 4034.29,-4187.15 4041.42,-4194.99 4044.75,-4188.83"/>
</g>
<!-- layer1_expert9_gpu9&#45;&gt;layer1_gather -->
<g id="edge29" class="edge">
<title>layer1_expert9_gpu9&#45;&gt;layer1_gather</title>
<path fill="none" stroke="black" d="M4676.8,-4299.86C4530.18,-4265.46 4270.22,-4204.47 4094.07,-4163.14"/>
<polygon fill="black" stroke="black" points="4094.7,-4159.69 4084.17,-4160.82 4093.1,-4166.51 4094.7,-4159.69"/>
</g>
<!-- layer1_expert10_gpu10&#45;&gt;layer1_gather -->
<g id="edge30" class="edge">
<title>layer1_expert10_gpu10&#45;&gt;layer1_gather</title>
<path fill="none" stroke="black" d="M5171.43,-4300.38C5129.33,-4291.36 5081.11,-4281.58 5037,-4273.95 4699.95,-4215.66 4303.06,-4165.75 4081.61,-4139.56"/>
<polygon fill="black" stroke="black" points="4081.86,-4136.07 4071.52,-4138.37 4081.04,-4143.02 4081.86,-4136.07"/>
</g>
<!-- layer1_expert11_gpu11&#45;&gt;layer1_gather -->
<g id="edge31" class="edge">
<title>layer1_expert11_gpu11&#45;&gt;layer1_gather</title>
<path fill="none" stroke="black" d="M5670.76,-4299.85C5628.17,-4290.59 5579.02,-4280.79 5534,-4273.95 5004.6,-4193.61 4371.35,-4147.94 4076.41,-4129.55"/>
<polygon fill="black" stroke="black" points="4076.26,-4126.04 4066.06,-4128.91 4075.83,-4133.02 4076.26,-4126.04"/>
</g>
<!-- layer1_expert12_gpu12&#45;&gt;layer1_gather -->
<g id="edge32" class="edge">
<title>layer1_expert12_gpu12&#45;&gt;layer1_gather</title>
<path fill="none" stroke="black" d="M6169.07,-4299.59C6126.21,-4290.19 6076.52,-4280.35 6031,-4273.95 5305.39,-4172.01 4430.07,-4135.57 4073.28,-4124.34"/>
<polygon fill="black" stroke="black" points="4073.24,-4120.84 4063.14,-4124.03 4073.02,-4127.84 4073.24,-4120.84"/>
</g>
<!-- layer1_expert13_gpu13&#45;&gt;layer1_gather -->
<g id="edge33" class="edge">
<title>layer1_expert13_gpu13&#45;&gt;layer1_gather</title>
<path fill="none" stroke="black" d="M6666.73,-4299.4C6623.73,-4289.91 6573.79,-4280.07 6528,-4273.95 5604.09,-4150.61 4483.61,-4126.05 4071.82,-4121.17"/>
<polygon fill="black" stroke="black" points="4071.67,-4117.67 4061.63,-4121.05 4071.59,-4124.67 4071.67,-4117.67"/>
</g>
<!-- layer1_expert14_gpu14&#45;&gt;layer1_gather -->
<g id="edge34" class="edge">
<title>layer1_expert14_gpu14&#45;&gt;layer1_gather</title>
<path fill="none" stroke="black" d="M7164.06,-4299.29C7121,-4289.75 7070.92,-4279.91 7025,-4273.95 6645.89,-4224.8 6547.8,-4249.04 6166,-4229.95 5383.48,-4190.83 4448.2,-4145.77 4075.28,-4127.87"/>
<polygon fill="black" stroke="black" points="4075.38,-4124.37 4065.23,-4127.39 4075.05,-4131.37 4075.38,-4124.37"/>
</g>
<!-- layer1_expert15_gpu15&#45;&gt;layer1_gather -->
<g id="edge35" class="edge">
<title>layer1_expert15_gpu15&#45;&gt;layer1_gather</title>
<path fill="none" stroke="black" d="M7661.7,-4299.22C7618.5,-4289.62 7568.16,-4279.74 7522,-4273.95 6840.49,-4188.56 4684.32,-4136.62 4073,-4123.35"/>
<polygon fill="black" stroke="black" points="4072.86,-4119.84 4062.79,-4123.12 4072.71,-4126.84 4072.86,-4119.84"/>
</g>
<!-- layer1_residual -->
<g id="node22" class="node">
<title>layer1_residual</title>
<polygon fill="orange" stroke="black" points="3910,-3963.95 3766,-3910.95 3910,-3857.95 4054,-3910.95 3910,-3963.95"/>
<text text-anchor="middle" x="3910" y="-3922.25" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="3910" y="-3907.25" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="3910" y="-3892.25" font-family="Times,serif" font-size="14.00">Across GPUs 0&#45;15</text>
</g>
<!-- layer1_gather&#45;&gt;layer1_residual -->
<g id="edge36" class="edge">
<title>layer1_gather&#45;&gt;layer1_residual</title>
<path fill="none" stroke="black" d="M3910,-4050.79C3910,-4026.13 3910,-3998.34 3910,-3974.14"/>
<polygon fill="black" stroke="black" points="3913.5,-3974.01 3910,-3964.01 3906.5,-3974.01 3913.5,-3974.01"/>
</g>
<!-- layer2_attn -->
<g id="node23" class="node">
<title>layer2_attn</title>
<polygon fill="lightblue" stroke="black" points="3910,-3770.95 3704,-3717.95 3910,-3664.95 4116,-3717.95 3910,-3770.95"/>
<text text-anchor="middle" x="3910" y="-3729.25" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="3910" y="-3714.25" font-family="Times,serif" font-size="14.00">[1024 tokens, hidden_dim]</text>
<text text-anchor="middle" x="3910" y="-3699.25" font-family="Times,serif" font-size="14.00">Replicated on GPUs 16&#45;31</text>
</g>
<!-- layer1_residual&#45;&gt;layer2_attn -->
<g id="edge37" class="edge">
<title>layer1_residual&#45;&gt;layer2_attn</title>
<path fill="none" stroke="black" d="M3910,-3857.76C3910,-3834.07 3910,-3805.88 3910,-3781.11"/>
<polygon fill="black" stroke="black" points="3913.5,-3781.08 3910,-3771.08 3906.5,-3781.08 3913.5,-3781.08"/>
</g>
<!-- layer2_gate -->
<g id="node24" class="node">
<title>layer2_gate</title>
<polygon fill="orange" stroke="black" points="4099.95,-3577.95 3797.78,-3577.95 3720.05,-3441.95 4022.22,-3441.95 4099.95,-3577.95"/>
<text text-anchor="middle" x="3910" y="-3528.75" font-family="Times,serif" font-size="14.00">Gate Network</text>
<text text-anchor="middle" x="3910" y="-3513.75" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="3910" y="-3498.75" font-family="Times,serif" font-size="14.00">Compute routing probs</text>
<text text-anchor="middle" x="3910" y="-3483.75" font-family="Times,serif" font-size="14.00">GPUs 16&#45;31</text>
</g>
<!-- layer2_attn&#45;&gt;layer2_gate -->
<g id="edge38" class="edge">
<title>layer2_attn&#45;&gt;layer2_gate</title>
<path fill="none" stroke="black" d="M3910,-3664.7C3910,-3641.45 3910,-3613.59 3910,-3588.02"/>
<polygon fill="black" stroke="black" points="3913.5,-3587.97 3910,-3577.97 3906.5,-3587.97 3913.5,-3587.97"/>
</g>
<!-- layer2_split -->
<g id="node25" class="node">
<title>layer2_split</title>
<polygon fill="orange" stroke="black" points="4134.95,-3354.95 3777.1,-3354.95 3685.05,-3248.95 4042.9,-3248.95 4134.95,-3354.95"/>
<text text-anchor="middle" x="3910" y="-3313.25" font-family="Times,serif" font-size="14.00">Split Tokens by Expert</text>
<text text-anchor="middle" x="3910" y="-3298.25" font-family="Times,serif" font-size="14.00">[Variable tokens per expert]</text>
<text text-anchor="middle" x="3910" y="-3283.25" font-family="Times,serif" font-size="14.00">Async routing</text>
</g>
<!-- layer2_gate&#45;&gt;layer2_split -->
<g id="edge39" class="edge">
<title>layer2_gate&#45;&gt;layer2_split</title>
<path fill="none" stroke="black" d="M3910,-3441.79C3910,-3417.13 3910,-3389.34 3910,-3365.14"/>
<polygon fill="black" stroke="black" points="3913.5,-3365.01 3910,-3355.01 3906.5,-3365.01 3913.5,-3365.01"/>
</g>
<!-- layer2_expert0_gpu16 -->
<g id="node26" class="node">
<title>layer2_expert0_gpu16</title>
<polygon fill="lightblue" stroke="black" points="272,-3147.95 45,-3094.95 272,-3041.95 499,-3094.95 272,-3147.95"/>
<text text-anchor="middle" x="272" y="-3106.25" font-family="Times,serif" font-size="14.00">Expert 16</text>
<text text-anchor="middle" x="272" y="-3091.25" font-family="Times,serif" font-size="14.00">GPU 16</text>
<text text-anchor="middle" x="272" y="-3076.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer2_split&#45;&gt;layer2_expert0_gpu16 -->
<g id="edge40" class="edge">
<title>layer2_split&#45;&gt;layer2_expert0_gpu16</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3725.68,-3295.98C3307.25,-3284.27 2253.57,-3252.4 1373,-3205.95 993.98,-3185.96 896.99,-3199.76 521,-3147.95 478.66,-3142.12 432.75,-3133.27 392.02,-3124.51"/>
<polygon fill="black" stroke="black" points="392.57,-3121.05 382.06,-3122.35 391.09,-3127.89 392.57,-3121.05"/>
<text text-anchor="middle" x="1423" y="-3194.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer2_expert1_gpu17 -->
<g id="node27" class="node">
<title>layer2_expert1_gpu17</title>
<polygon fill="lightblue" stroke="black" points="769,-3147.95 542,-3094.95 769,-3041.95 996,-3094.95 769,-3147.95"/>
<text text-anchor="middle" x="769" y="-3106.25" font-family="Times,serif" font-size="14.00">Expert 17</text>
<text text-anchor="middle" x="769" y="-3091.25" font-family="Times,serif" font-size="14.00">GPU 17</text>
<text text-anchor="middle" x="769" y="-3076.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer2_split&#45;&gt;layer2_expert1_gpu17 -->
<g id="edge42" class="edge">
<title>layer2_split&#45;&gt;layer2_expert1_gpu17</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3724.51,-3294.48C3356.3,-3281.22 2507.04,-3248.6 1794,-3205.95 1448.77,-3185.31 1360.46,-3196.3 1018,-3147.95 975.78,-3141.99 930,-3133.13 889.34,-3124.41"/>
<polygon fill="black" stroke="black" points="889.9,-3120.95 879.39,-3122.26 888.42,-3127.79 889.9,-3120.95"/>
<text text-anchor="middle" x="1844" y="-3194.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer2_expert2_gpu18 -->
<g id="node28" class="node">
<title>layer2_expert2_gpu18</title>
<polygon fill="lightblue" stroke="black" points="1266,-3147.95 1039,-3094.95 1266,-3041.95 1493,-3094.95 1266,-3147.95"/>
<text text-anchor="middle" x="1266" y="-3106.25" font-family="Times,serif" font-size="14.00">Expert 18</text>
<text text-anchor="middle" x="1266" y="-3091.25" font-family="Times,serif" font-size="14.00">GPU 18</text>
<text text-anchor="middle" x="1266" y="-3076.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer2_split&#45;&gt;layer2_expert2_gpu18 -->
<g id="edge44" class="edge">
<title>layer2_split&#45;&gt;layer2_expert2_gpu18</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3728.37,-3298.98C3327.11,-3292.51 2335.57,-3264.95 1515,-3147.95 1472.79,-3141.94 1427.01,-3133.06 1386.35,-3124.34"/>
<polygon fill="black" stroke="black" points="1386.91,-3120.88 1376.4,-3122.19 1385.43,-3127.72 1386.91,-3120.88"/>
<text text-anchor="middle" x="2020" y="-3194.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer2_expert3_gpu19 -->
<g id="node29" class="node">
<title>layer2_expert3_gpu19</title>
<polygon fill="lightblue" stroke="black" points="1763,-3147.95 1536,-3094.95 1763,-3041.95 1990,-3094.95 1763,-3147.95"/>
<text text-anchor="middle" x="1763" y="-3106.25" font-family="Times,serif" font-size="14.00">Expert 19</text>
<text text-anchor="middle" x="1763" y="-3091.25" font-family="Times,serif" font-size="14.00">GPU 19</text>
<text text-anchor="middle" x="1763" y="-3076.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer2_split&#45;&gt;layer2_expert3_gpu19 -->
<g id="edge46" class="edge">
<title>layer2_split&#45;&gt;layer2_expert3_gpu19</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3723.58,-3293.69C3382.46,-3278.68 2635.52,-3237.83 2012,-3147.95 1969.9,-3141.89 1924.24,-3133.02 1883.65,-3124.33"/>
<polygon fill="black" stroke="black" points="1884.23,-3120.87 1873.72,-3122.18 1882.75,-3127.72 1884.23,-3120.87"/>
<text text-anchor="middle" x="2528" y="-3194.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer2_expert4_gpu20 -->
<g id="node30" class="node">
<title>layer2_expert4_gpu20</title>
<polygon fill="lightblue" stroke="black" points="2260,-3147.95 2033,-3094.95 2260,-3041.95 2487,-3094.95 2260,-3147.95"/>
<text text-anchor="middle" x="2260" y="-3106.25" font-family="Times,serif" font-size="14.00">Expert 20</text>
<text text-anchor="middle" x="2260" y="-3091.25" font-family="Times,serif" font-size="14.00">GPU 20</text>
<text text-anchor="middle" x="2260" y="-3076.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer2_split&#45;&gt;layer2_expert4_gpu20 -->
<g id="edge48" class="edge">
<title>layer2_split&#45;&gt;layer2_expert4_gpu20</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3710.39,-3278.61C3509.52,-3256.2 3190.81,-3220.8 2915,-3190.95 2734.6,-3171.43 2688.26,-3176.09 2509,-3147.95 2467.39,-3141.42 2422.21,-3132.54 2381.91,-3123.96"/>
<polygon fill="black" stroke="black" points="2382.56,-3120.52 2372.05,-3121.85 2381.09,-3127.37 2382.56,-3120.52"/>
<text text-anchor="middle" x="3100" y="-3194.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer2_expert5_gpu21 -->
<g id="node31" class="node">
<title>layer2_expert5_gpu21</title>
<polygon fill="lightblue" stroke="black" points="2757,-3147.95 2530,-3094.95 2757,-3041.95 2984,-3094.95 2757,-3147.95"/>
<text text-anchor="middle" x="2757" y="-3106.25" font-family="Times,serif" font-size="14.00">Expert 21</text>
<text text-anchor="middle" x="2757" y="-3091.25" font-family="Times,serif" font-size="14.00">GPU 21</text>
<text text-anchor="middle" x="2757" y="-3076.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer2_split&#45;&gt;layer2_expert5_gpu21 -->
<g id="edge50" class="edge">
<title>layer2_split&#45;&gt;layer2_expert5_gpu21</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3692.05,-3257.19C3582.2,-3235.84 3446.79,-3210.6 3325,-3190.95 3183.77,-3168.17 3147,-3172.15 3006,-3147.95 2965.07,-3140.93 2920.62,-3132.05 2880.75,-3123.63"/>
<polygon fill="black" stroke="black" points="2881.22,-3120.15 2870.71,-3121.5 2879.77,-3127 2881.22,-3120.15"/>
<text text-anchor="middle" x="3454" y="-3194.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer2_expert6_gpu22 -->
<g id="node32" class="node">
<title>layer2_expert6_gpu22</title>
<polygon fill="lightblue" stroke="black" points="3254,-3147.95 3027,-3094.95 3254,-3041.95 3481,-3094.95 3254,-3147.95"/>
<text text-anchor="middle" x="3254" y="-3106.25" font-family="Times,serif" font-size="14.00">Expert 22</text>
<text text-anchor="middle" x="3254" y="-3091.25" font-family="Times,serif" font-size="14.00">GPU 22</text>
<text text-anchor="middle" x="3254" y="-3076.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer2_split&#45;&gt;layer2_expert6_gpu22 -->
<g id="edge52" class="edge">
<title>layer2_split&#45;&gt;layer2_expert6_gpu22</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3772.56,-3248.9C3720.12,-3229.74 3659.6,-3208.46 3604,-3190.95 3527.3,-3166.8 3440.01,-3143.1 3371.8,-3125.42"/>
<polygon fill="black" stroke="black" points="3372.43,-3121.96 3361.87,-3122.85 3370.68,-3128.74 3372.43,-3121.96"/>
<text text-anchor="middle" x="3696" y="-3194.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer2_expert7_gpu23 -->
<g id="node33" class="node">
<title>layer2_expert7_gpu23</title>
<polygon fill="lightblue" stroke="black" points="3751,-3147.95 3524,-3094.95 3751,-3041.95 3978,-3094.95 3751,-3147.95"/>
<text text-anchor="middle" x="3751" y="-3106.25" font-family="Times,serif" font-size="14.00">Expert 23</text>
<text text-anchor="middle" x="3751" y="-3091.25" font-family="Times,serif" font-size="14.00">GPU 23</text>
<text text-anchor="middle" x="3751" y="-3076.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer2_split&#45;&gt;layer2_expert7_gpu23 -->
<g id="edge54" class="edge">
<title>layer2_split&#45;&gt;layer2_expert7_gpu23</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3869.47,-3248.69C3845.56,-3217.88 3815.42,-3179.01 3791.52,-3148.19"/>
<polygon fill="black" stroke="black" points="3794.16,-3145.9 3785.27,-3140.14 3788.63,-3150.19 3794.16,-3145.9"/>
<text text-anchor="middle" x="3885" y="-3194.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer2_expert8_gpu24 -->
<g id="node34" class="node">
<title>layer2_expert8_gpu24</title>
<polygon fill="lightblue" stroke="black" points="4248,-3147.95 4021,-3094.95 4248,-3041.95 4475,-3094.95 4248,-3147.95"/>
<text text-anchor="middle" x="4248" y="-3106.25" font-family="Times,serif" font-size="14.00">Expert 24</text>
<text text-anchor="middle" x="4248" y="-3091.25" font-family="Times,serif" font-size="14.00">GPU 24</text>
<text text-anchor="middle" x="4248" y="-3076.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer2_split&#45;&gt;layer2_expert8_gpu24 -->
<g id="edge56" class="edge">
<title>layer2_split&#45;&gt;layer2_expert8_gpu24</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3996.17,-3248.69C4052.3,-3214.64 4124.64,-3170.77 4177.38,-3138.79"/>
<polygon fill="black" stroke="black" points="4179.26,-3141.74 4185.99,-3133.56 4175.63,-3135.75 4179.26,-3141.74"/>
<text text-anchor="middle" x="4139" y="-3194.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer2_expert9_gpu25 -->
<g id="node35" class="node">
<title>layer2_expert9_gpu25</title>
<polygon fill="lightblue" stroke="black" points="4745,-3147.95 4518,-3094.95 4745,-3041.95 4972,-3094.95 4745,-3147.95"/>
<text text-anchor="middle" x="4745" y="-3106.25" font-family="Times,serif" font-size="14.00">Expert 25</text>
<text text-anchor="middle" x="4745" y="-3091.25" font-family="Times,serif" font-size="14.00">GPU 25</text>
<text text-anchor="middle" x="4745" y="-3076.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer2_split&#45;&gt;layer2_expert9_gpu25 -->
<g id="edge58" class="edge">
<title>layer2_split&#45;&gt;layer2_expert9_gpu25</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4056.88,-3264.89C4218.82,-3225.14 4476.19,-3161.95 4626.03,-3125.16"/>
<polygon fill="black" stroke="black" points="4627.3,-3128.45 4636.18,-3122.67 4625.64,-3121.65 4627.3,-3128.45"/>
<text text-anchor="middle" x="4402" y="-3194.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer2_expert10_gpu26 -->
<g id="node36" class="node">
<title>layer2_expert10_gpu26</title>
<polygon fill="lightblue" stroke="black" points="5242,-3147.95 5015,-3094.95 5242,-3041.95 5469,-3094.95 5242,-3147.95"/>
<text text-anchor="middle" x="5242" y="-3106.25" font-family="Times,serif" font-size="14.00">Expert 26</text>
<text text-anchor="middle" x="5242" y="-3091.25" font-family="Times,serif" font-size="14.00">GPU 26</text>
<text text-anchor="middle" x="5242" y="-3076.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer2_split&#45;&gt;layer2_expert10_gpu26 -->
<g id="edge60" class="edge">
<title>layer2_split&#45;&gt;layer2_expert10_gpu26</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4071.69,-3281.54C4283.99,-3255.27 4668.02,-3205.07 4994,-3147.95 5034.55,-3140.85 5078.58,-3131.99 5118.14,-3123.61"/>
<polygon fill="black" stroke="black" points="5119.05,-3127 5128.1,-3121.49 5117.59,-3120.15 5119.05,-3127"/>
<text text-anchor="middle" x="4777" y="-3194.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer2_expert11_gpu27 -->
<g id="node37" class="node">
<title>layer2_expert11_gpu27</title>
<polygon fill="lightblue" stroke="black" points="5739,-3147.95 5512,-3094.95 5739,-3041.95 5966,-3094.95 5739,-3147.95"/>
<text text-anchor="middle" x="5739" y="-3106.25" font-family="Times,serif" font-size="14.00">Expert 27</text>
<text text-anchor="middle" x="5739" y="-3091.25" font-family="Times,serif" font-size="14.00">GPU 27</text>
<text text-anchor="middle" x="5739" y="-3076.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer2_split&#45;&gt;layer2_expert11_gpu27 -->
<g id="edge62" class="edge">
<title>layer2_split&#45;&gt;layer2_expert11_gpu27</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4079.23,-3290.72C4369.35,-3271.81 4979.88,-3226.03 5491,-3147.95 5532.58,-3141.6 5577.7,-3132.74 5617.91,-3124.13"/>
<polygon fill="black" stroke="black" points="5618.71,-3127.54 5627.75,-3122.01 5617.24,-3120.7 5618.71,-3127.54"/>
<text text-anchor="middle" x="5196" y="-3194.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer2_expert12_gpu28 -->
<g id="node38" class="node">
<title>layer2_expert12_gpu28</title>
<polygon fill="lightblue" stroke="black" points="6236,-3147.95 6009,-3094.95 6236,-3041.95 6463,-3094.95 6236,-3147.95"/>
<text text-anchor="middle" x="6236" y="-3106.25" font-family="Times,serif" font-size="14.00">Expert 28</text>
<text text-anchor="middle" x="6236" y="-3091.25" font-family="Times,serif" font-size="14.00">GPU 28</text>
<text text-anchor="middle" x="6236" y="-3076.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer2_split&#45;&gt;layer2_expert12_gpu28 -->
<g id="edge64" class="edge">
<title>layer2_split&#45;&gt;layer2_expert12_gpu28</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4084.31,-3296.28C4442.57,-3284.89 5286.88,-3248.81 5988,-3147.95 6029.94,-3141.92 6075.42,-3133.07 6115.84,-3124.37"/>
<polygon fill="black" stroke="black" points="6116.71,-3127.76 6125.74,-3122.22 6115.22,-3120.92 6116.71,-3127.76"/>
<text text-anchor="middle" x="5642" y="-3194.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer2_expert13_gpu29 -->
<g id="node39" class="node">
<title>layer2_expert13_gpu29</title>
<polygon fill="lightblue" stroke="black" points="6733,-3147.95 6506,-3094.95 6733,-3041.95 6960,-3094.95 6733,-3147.95"/>
<text text-anchor="middle" x="6733" y="-3106.25" font-family="Times,serif" font-size="14.00">Expert 29</text>
<text text-anchor="middle" x="6733" y="-3091.25" font-family="Times,serif" font-size="14.00">GPU 29</text>
<text text-anchor="middle" x="6733" y="-3076.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer2_split&#45;&gt;layer2_expert13_gpu29 -->
<g id="edge66" class="edge">
<title>layer2_split&#45;&gt;layer2_expert13_gpu29</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4087.76,-3300.27C4507.22,-3296.52 5590.65,-3274.27 6485,-3147.95 6526.95,-3142.03 6572.44,-3133.2 6612.86,-3124.5"/>
<polygon fill="black" stroke="black" points="6613.73,-3127.89 6622.75,-3122.35 6612.24,-3121.05 6613.73,-3127.89"/>
<text text-anchor="middle" x="6187" y="-3194.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer2_expert14_gpu30 -->
<g id="node40" class="node">
<title>layer2_expert14_gpu30</title>
<polygon fill="lightblue" stroke="black" points="7230,-3147.95 7003,-3094.95 7230,-3041.95 7457,-3094.95 7230,-3147.95"/>
<text text-anchor="middle" x="7230" y="-3106.25" font-family="Times,serif" font-size="14.00">Expert 30</text>
<text text-anchor="middle" x="7230" y="-3091.25" font-family="Times,serif" font-size="14.00">GPU 30</text>
<text text-anchor="middle" x="7230" y="-3076.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer2_split&#45;&gt;layer2_expert14_gpu30 -->
<g id="edge68" class="edge">
<title>layer2_split&#45;&gt;layer2_expert14_gpu30</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4084.18,-3296.14C4472.6,-3284.92 5439.1,-3254.23 6247,-3205.95 6574.1,-3186.41 6657.65,-3194.56 6982,-3147.95 7023.94,-3141.93 7069.42,-3133.08 7109.85,-3124.38"/>
<polygon fill="black" stroke="black" points="7110.71,-3127.77 7119.74,-3122.23 7109.22,-3120.93 7110.71,-3127.77"/>
<text text-anchor="middle" x="6590" y="-3194.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer2_expert15_gpu31 -->
<g id="node41" class="node">
<title>layer2_expert15_gpu31</title>
<polygon fill="lightblue" stroke="black" points="7727,-3147.95 7500,-3094.95 7727,-3041.95 7954,-3094.95 7727,-3147.95"/>
<text text-anchor="middle" x="7727" y="-3106.25" font-family="Times,serif" font-size="14.00">Expert 31</text>
<text text-anchor="middle" x="7727" y="-3091.25" font-family="Times,serif" font-size="14.00">GPU 31</text>
<text text-anchor="middle" x="7727" y="-3076.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer2_split&#45;&gt;layer2_expert15_gpu31 -->
<g id="edge70" class="edge">
<title>layer2_split&#45;&gt;layer2_expert15_gpu31</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4084.8,-3297.03C4519,-3286.81 5681.51,-3256.61 6650,-3205.95 7018.84,-3186.66 7113.18,-3198.86 7479,-3147.95 7521.06,-3142.1 7566.67,-3133.27 7607.17,-3124.53"/>
<polygon fill="black" stroke="black" points="7608.05,-3127.92 7617.08,-3122.38 7606.56,-3121.08 7608.05,-3127.92"/>
<text text-anchor="middle" x="7059" y="-3194.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer2_gather -->
<g id="node42" class="node">
<title>layer2_gather</title>
<polygon fill="orange" stroke="black" points="4037.88,-2954.95 3737.42,-2954.95 3660.12,-2818.95 3960.58,-2818.95 4037.88,-2954.95"/>
<text text-anchor="middle" x="3849" y="-2905.75" font-family="Times,serif" font-size="14.00">Gather Expert Outputs</text>
<text text-anchor="middle" x="3849" y="-2890.75" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="3849" y="-2875.75" font-family="Times,serif" font-size="14.00">Async all&#45;gather</text>
<text text-anchor="middle" x="3849" y="-2860.75" font-family="Times,serif" font-size="14.00">GPUs 16&#45;31</text>
</g>
<!-- layer2_expert0_gpu16&#45;&gt;layer2_gather -->
<g id="edge41" class="edge">
<title>layer2_expert0_gpu16&#45;&gt;layer2_gather</title>
<path fill="none" stroke="black" d="M381.08,-3067.36C424.38,-3057.8 474.79,-3047.92 521,-3041.95 900.57,-2992.91 998.72,-3016.25 1381,-2997.95 2254.44,-2956.15 3302.01,-2911.16 3692.37,-2894.58"/>
<polygon fill="black" stroke="black" points="3692.75,-2898.06 3702.6,-2894.14 3692.46,-2891.07 3692.75,-2898.06"/>
</g>
<!-- layer2_expert1_gpu17&#45;&gt;layer2_gather -->
<g id="edge43" class="edge">
<title>layer2_expert1_gpu17&#45;&gt;layer2_gather</title>
<path fill="none" stroke="black" d="M878.4,-3067.37C921.63,-3057.85 971.91,-3047.98 1018,-3041.95 2028.86,-2909.68 3257.14,-2890.64 3689.34,-2888.19"/>
<polygon fill="black" stroke="black" points="3689.42,-2891.69 3699.4,-2888.13 3689.38,-2884.69 3689.42,-2891.69"/>
</g>
<!-- layer2_expert2_gpu18&#45;&gt;layer2_gather -->
<g id="edge45" class="edge">
<title>layer2_expert2_gpu18&#45;&gt;layer2_gather</title>
<path fill="none" stroke="black" d="M1376.05,-3067.51C1419.15,-3058.06 1469.17,-3048.22 1515,-3041.95 2328.12,-2930.78 3312,-2899.16 3690.28,-2890.77"/>
<polygon fill="black" stroke="black" points="3690.56,-2894.27 3700.48,-2890.55 3690.4,-2887.27 3690.56,-2894.27"/>
</g>
<!-- layer2_expert3_gpu19&#45;&gt;layer2_gather -->
<g id="edge47" class="edge">
<title>layer2_expert3_gpu19&#45;&gt;layer2_gather</title>
<path fill="none" stroke="black" d="M1873.73,-3067.8C1916.7,-3058.45 1966.44,-3048.59 2012,-3041.95 2630.56,-2951.78 3374.57,-2909.56 3692.54,-2894.61"/>
<polygon fill="black" stroke="black" points="3692.92,-2898.1 3702.75,-2894.13 3692.6,-2891.1 3692.92,-2898.1"/>
</g>
<!-- layer2_expert4_gpu20&#45;&gt;layer2_gather -->
<g id="edge49" class="edge">
<title>layer2_expert4_gpu20&#45;&gt;layer2_gather</title>
<path fill="none" stroke="black" d="M2372.7,-3068.14C2415.26,-3058.99 2464.2,-3049.19 2509,-3041.95 2936.81,-2972.85 3446.34,-2923.18 3695.89,-2900.96"/>
<polygon fill="black" stroke="black" points="3696.46,-2904.42 3706.11,-2900.05 3695.84,-2897.45 3696.46,-2904.42"/>
</g>
<!-- layer2_expert5_gpu21&#45;&gt;layer2_gather -->
<g id="edge51" class="edge">
<title>layer2_expert5_gpu21&#45;&gt;layer2_gather</title>
<path fill="none" stroke="black" d="M2873.42,-3069.01C2915.19,-3060.23 2962.66,-3050.44 3006,-3041.95 3249.9,-2994.22 3534.44,-2943.21 3702.73,-2913.52"/>
<polygon fill="black" stroke="black" points="3703.41,-2916.96 3712.65,-2911.77 3702.19,-2910.06 3703.41,-2916.96"/>
</g>
<!-- layer2_expert6_gpu22&#45;&gt;layer2_gather -->
<g id="edge53" class="edge">
<title>layer2_expert6_gpu22&#45;&gt;layer2_gather</title>
<path fill="none" stroke="black" d="M3343.72,-3062.89C3441.98,-3028.87 3600.65,-2973.94 3713.97,-2934.7"/>
<polygon fill="black" stroke="black" points="3715.45,-2937.89 3723.75,-2931.32 3713.16,-2931.28 3715.45,-2937.89"/>
</g>
<!-- layer2_expert7_gpu23&#45;&gt;layer2_gather -->
<g id="edge55" class="edge">
<title>layer2_expert7_gpu23&#45;&gt;layer2_gather</title>
<path fill="none" stroke="black" d="M3773.36,-3046.95C3784.98,-3022.52 3799.48,-2992.05 3812.66,-2964.34"/>
<polygon fill="black" stroke="black" points="3815.94,-2965.59 3817.08,-2955.06 3809.62,-2962.59 3815.94,-2965.59"/>
</g>
<!-- layer2_expert8_gpu24&#45;&gt;layer2_gather -->
<g id="edge57" class="edge">
<title>layer2_expert8_gpu24&#45;&gt;layer2_gather</title>
<path fill="none" stroke="black" d="M4178.5,-3058.07C4126.04,-3030.99 4052.34,-2992.94 3987.94,-2959.69"/>
<polygon fill="black" stroke="black" points="3989.41,-2956.51 3978.92,-2955.03 3986.2,-2962.73 3989.41,-2956.51"/>
</g>
<!-- layer2_expert9_gpu25&#45;&gt;layer2_gather -->
<g id="edge59" class="edge">
<title>layer2_expert9_gpu25&#45;&gt;layer2_gather</title>
<path fill="none" stroke="black" d="M4632.43,-3068.07C4481.74,-3033.43 4212.59,-2971.55 4032.41,-2930.12"/>
<polygon fill="black" stroke="black" points="4033.09,-2926.69 4022.56,-2927.86 4031.52,-2933.51 4033.09,-2926.69"/>
</g>
<!-- layer2_expert10_gpu26&#45;&gt;layer2_gather -->
<g id="edge61" class="edge">
<title>layer2_expert10_gpu26&#45;&gt;layer2_gather</title>
<path fill="none" stroke="black" d="M5128.75,-3068.39C5086.58,-3059.35 5038.22,-3049.55 4994,-3041.95 4650.14,-2982.86 4244.92,-2932.97 4020.49,-2907.06"/>
<polygon fill="black" stroke="black" points="4020.61,-2903.55 4010.27,-2905.88 4019.8,-2910.5 4020.61,-2903.55"/>
</g>
<!-- layer2_expert11_gpu27&#45;&gt;layer2_gather -->
<g id="edge63" class="edge">
<title>layer2_expert11_gpu27&#45;&gt;layer2_gather</title>
<path fill="none" stroke="black" d="M5627.76,-3067.83C5585.17,-3058.56 5536.02,-3048.76 5491,-3041.95 4954.25,-2960.78 4311.9,-2915.37 4014.78,-2897.28"/>
<polygon fill="black" stroke="black" points="4014.98,-2893.78 4004.79,-2896.67 4014.56,-2900.77 4014.98,-2893.78"/>
</g>
<!-- layer2_expert12_gpu28&#45;&gt;layer2_gather -->
<g id="edge65" class="edge">
<title>layer2_expert12_gpu28&#45;&gt;layer2_gather</title>
<path fill="none" stroke="black" d="M6126.07,-3067.58C6083.21,-3058.17 6033.53,-3048.34 5988,-3041.95 5255.32,-2939.24 4371.28,-2903.2 4012.32,-2892.21"/>
<polygon fill="black" stroke="black" points="4012.22,-2888.7 4002.12,-2891.9 4012.01,-2895.7 4012.22,-2888.7"/>
</g>
<!-- layer2_expert13_gpu29&#45;&gt;layer2_gather -->
<g id="edge67" class="edge">
<title>layer2_expert13_gpu29&#45;&gt;layer2_gather</title>
<path fill="none" stroke="black" d="M6623.73,-3067.39C6580.73,-3057.9 6530.79,-3048.06 6485,-3041.95 5553.89,-2917.84 4424.5,-2893.75 4010.8,-2889.08"/>
<polygon fill="black" stroke="black" points="4010.61,-2885.57 4000.57,-2888.96 4010.53,-2892.57 4010.61,-2885.57"/>
</g>
<!-- layer2_expert14_gpu30&#45;&gt;layer2_gather -->
<g id="edge69" class="edge">
<title>layer2_expert14_gpu30&#45;&gt;layer2_gather</title>
<path fill="none" stroke="black" d="M7121.06,-3067.28C7078,-3057.75 7027.92,-3047.9 6982,-3041.95 6602.01,-2992.71 6503.69,-3017 6121,-2997.95 5332.2,-2958.7 4389.26,-2913.65 4014.41,-2895.81"/>
<polygon fill="black" stroke="black" points="4014.46,-2892.31 4004.3,-2895.33 4014.12,-2899.3 4014.46,-2892.31"/>
</g>
<!-- layer2_expert15_gpu31&#45;&gt;layer2_gather -->
<g id="edge71" class="edge">
<title>layer2_expert15_gpu31&#45;&gt;layer2_gather</title>
<path fill="none" stroke="black" d="M7618.7,-3067.21C7575.5,-3057.61 7525.16,-3047.73 7479,-3041.95 6793.8,-2956.17 4625.33,-2904.47 4012.03,-2891.31"/>
<polygon fill="black" stroke="black" points="4011.86,-2887.8 4001.79,-2891.09 4011.71,-2894.8 4011.86,-2887.8"/>
</g>
<!-- layer2_residual -->
<g id="node43" class="node">
<title>layer2_residual</title>
<polygon fill="orange" stroke="black" points="3849,-2731.95 3696,-2678.95 3849,-2625.95 4002,-2678.95 3849,-2731.95"/>
<text text-anchor="middle" x="3849" y="-2690.25" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="3849" y="-2675.25" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="3849" y="-2660.25" font-family="Times,serif" font-size="14.00">Across GPUs 16&#45;31</text>
</g>
<!-- layer2_gather&#45;&gt;layer2_residual -->
<g id="edge72" class="edge">
<title>layer2_gather&#45;&gt;layer2_residual</title>
<path fill="none" stroke="black" d="M3849,-2818.79C3849,-2794.13 3849,-2766.34 3849,-2742.14"/>
<polygon fill="black" stroke="black" points="3852.5,-2742.01 3849,-2732.01 3845.5,-2742.01 3852.5,-2742.01"/>
</g>
<!-- layer3_attn -->
<g id="node44" class="node">
<title>layer3_attn</title>
<polygon fill="lightblue" stroke="black" points="3849,-2538.95 3643,-2485.95 3849,-2432.95 4055,-2485.95 3849,-2538.95"/>
<text text-anchor="middle" x="3849" y="-2497.25" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="3849" y="-2482.25" font-family="Times,serif" font-size="14.00">[1024 tokens, hidden_dim]</text>
<text text-anchor="middle" x="3849" y="-2467.25" font-family="Times,serif" font-size="14.00">Replicated on GPUs 32&#45;47</text>
</g>
<!-- layer2_residual&#45;&gt;layer3_attn -->
<g id="edge73" class="edge">
<title>layer2_residual&#45;&gt;layer3_attn</title>
<path fill="none" stroke="black" d="M3849,-2625.76C3849,-2602.07 3849,-2573.88 3849,-2549.11"/>
<polygon fill="black" stroke="black" points="3852.5,-2549.08 3849,-2539.08 3845.5,-2549.08 3852.5,-2549.08"/>
</g>
<!-- layer3_gate -->
<g id="node45" class="node">
<title>layer3_gate</title>
<polygon fill="orange" stroke="black" points="4038.95,-2345.95 3736.78,-2345.95 3659.05,-2209.95 3961.22,-2209.95 4038.95,-2345.95"/>
<text text-anchor="middle" x="3849" y="-2296.75" font-family="Times,serif" font-size="14.00">Gate Network</text>
<text text-anchor="middle" x="3849" y="-2281.75" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="3849" y="-2266.75" font-family="Times,serif" font-size="14.00">Compute routing probs</text>
<text text-anchor="middle" x="3849" y="-2251.75" font-family="Times,serif" font-size="14.00">GPUs 32&#45;47</text>
</g>
<!-- layer3_attn&#45;&gt;layer3_gate -->
<g id="edge74" class="edge">
<title>layer3_attn&#45;&gt;layer3_gate</title>
<path fill="none" stroke="black" d="M3849,-2432.7C3849,-2409.45 3849,-2381.59 3849,-2356.02"/>
<polygon fill="black" stroke="black" points="3852.5,-2355.97 3849,-2345.97 3845.5,-2355.97 3852.5,-2355.97"/>
</g>
<!-- layer3_split -->
<g id="node46" class="node">
<title>layer3_split</title>
<polygon fill="orange" stroke="black" points="4073.95,-2122.95 3716.1,-2122.95 3624.05,-2016.95 3981.9,-2016.95 4073.95,-2122.95"/>
<text text-anchor="middle" x="3849" y="-2081.25" font-family="Times,serif" font-size="14.00">Split Tokens by Expert</text>
<text text-anchor="middle" x="3849" y="-2066.25" font-family="Times,serif" font-size="14.00">[Variable tokens per expert]</text>
<text text-anchor="middle" x="3849" y="-2051.25" font-family="Times,serif" font-size="14.00">Async routing</text>
</g>
<!-- layer3_gate&#45;&gt;layer3_split -->
<g id="edge75" class="edge">
<title>layer3_gate&#45;&gt;layer3_split</title>
<path fill="none" stroke="black" d="M3849,-2209.79C3849,-2185.13 3849,-2157.34 3849,-2133.14"/>
<polygon fill="black" stroke="black" points="3852.5,-2133.01 3849,-2123.01 3845.5,-2133.01 3852.5,-2133.01"/>
</g>
<!-- layer3_expert0_gpu32 -->
<g id="node47" class="node">
<title>layer3_expert0_gpu32</title>
<polygon fill="lightblue" stroke="black" points="274,-1915.95 47,-1862.95 274,-1809.95 501,-1862.95 274,-1915.95"/>
<text text-anchor="middle" x="274" y="-1874.25" font-family="Times,serif" font-size="14.00">Expert 32</text>
<text text-anchor="middle" x="274" y="-1859.25" font-family="Times,serif" font-size="14.00">GPU 32</text>
<text text-anchor="middle" x="274" y="-1844.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer3_split&#45;&gt;layer3_expert0_gpu32 -->
<g id="edge76" class="edge">
<title>layer3_split&#45;&gt;layer3_expert0_gpu32</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3664.58,-2063.79C3252.71,-2051.85 2226.83,-2019.78 1369,-1973.95 992.65,-1953.85 896.34,-1967.49 523,-1915.95 480.67,-1910.11 434.76,-1901.25 394.02,-1892.5"/>
<polygon fill="black" stroke="black" points="394.57,-1889.04 384.06,-1890.34 393.09,-1895.88 394.57,-1889.04"/>
<text text-anchor="middle" x="1419" y="-1962.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer3_expert1_gpu33 -->
<g id="node48" class="node">
<title>layer3_expert1_gpu33</title>
<polygon fill="lightblue" stroke="black" points="771,-1915.95 544,-1862.95 771,-1809.95 998,-1862.95 771,-1915.95"/>
<text text-anchor="middle" x="771" y="-1874.25" font-family="Times,serif" font-size="14.00">Expert 33</text>
<text text-anchor="middle" x="771" y="-1859.25" font-family="Times,serif" font-size="14.00">GPU 33</text>
<text text-anchor="middle" x="771" y="-1844.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer3_split&#45;&gt;layer3_expert1_gpu33 -->
<g id="edge78" class="edge">
<title>layer3_split&#45;&gt;layer3_expert1_gpu33</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3663.27,-2062.24C3301.71,-2048.77 2478.04,-2016.08 1786,-1973.95 1445.21,-1953.21 1358.04,-1963.84 1020,-1915.95 977.79,-1909.97 932,-1901.11 891.34,-1892.39"/>
<polygon fill="black" stroke="black" points="891.91,-1888.93 881.39,-1890.23 890.43,-1895.77 891.91,-1888.93"/>
<text text-anchor="middle" x="1836" y="-1962.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer3_expert2_gpu34 -->
<g id="node49" class="node">
<title>layer3_expert2_gpu34</title>
<polygon fill="lightblue" stroke="black" points="1268,-1915.95 1041,-1862.95 1268,-1809.95 1495,-1862.95 1268,-1915.95"/>
<text text-anchor="middle" x="1268" y="-1874.25" font-family="Times,serif" font-size="14.00">Expert 34</text>
<text text-anchor="middle" x="1268" y="-1859.25" font-family="Times,serif" font-size="14.00">GPU 34</text>
<text text-anchor="middle" x="1268" y="-1844.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer3_split&#45;&gt;layer3_expert2_gpu34 -->
<g id="edge80" class="edge">
<title>layer3_split&#45;&gt;layer3_expert2_gpu34</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3666.33,-2065.68C3272.08,-2056.7 2312.71,-2024.6 1517,-1915.95 1474.56,-1910.16 1428.53,-1901.29 1387.72,-1892.51"/>
<polygon fill="black" stroke="black" points="1388.26,-1889.04 1377.74,-1890.34 1386.77,-1895.88 1388.26,-1889.04"/>
<text text-anchor="middle" x="2011" y="-1962.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer3_expert3_gpu35 -->
<g id="node50" class="node">
<title>layer3_expert3_gpu35</title>
<polygon fill="lightblue" stroke="black" points="1765,-1915.95 1538,-1862.95 1765,-1809.95 1992,-1862.95 1765,-1915.95"/>
<text text-anchor="middle" x="1765" y="-1874.25" font-family="Times,serif" font-size="14.00">Expert 35</text>
<text text-anchor="middle" x="1765" y="-1859.25" font-family="Times,serif" font-size="14.00">GPU 35</text>
<text text-anchor="middle" x="1765" y="-1844.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer3_split&#45;&gt;layer3_expert3_gpu35 -->
<g id="edge82" class="edge">
<title>layer3_split&#45;&gt;layer3_expert3_gpu35</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3653.47,-2050.95C3406.99,-2028.44 2970.24,-1989.2 2596,-1958.95 2337.47,-1938.06 2270.84,-1952.1 2014,-1915.95 1971.78,-1910.01 1926,-1901.16 1885.33,-1892.43"/>
<polygon fill="black" stroke="black" points="1885.9,-1888.97 1875.39,-1890.28 1884.42,-1895.81 1885.9,-1888.97"/>
<text text-anchor="middle" x="2816" y="-1962.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer3_expert4_gpu36 -->
<g id="node51" class="node">
<title>layer3_expert4_gpu36</title>
<polygon fill="lightblue" stroke="black" points="2262,-1915.95 2035,-1862.95 2262,-1809.95 2489,-1862.95 2262,-1915.95"/>
<text text-anchor="middle" x="2262" y="-1874.25" font-family="Times,serif" font-size="14.00">Expert 36</text>
<text text-anchor="middle" x="2262" y="-1859.25" font-family="Times,serif" font-size="14.00">GPU 36</text>
<text text-anchor="middle" x="2262" y="-1844.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer3_split&#45;&gt;layer3_expert4_gpu36 -->
<g id="edge84" class="edge">
<title>layer3_split&#45;&gt;layer3_expert4_gpu36</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3641.37,-2037.1C3480.11,-2013.17 3250.75,-1980.87 3049,-1958.95 2810.53,-1933.05 2748.43,-1950.09 2511,-1915.95 2468.9,-1909.9 2423.24,-1901.04 2382.65,-1892.35"/>
<polygon fill="black" stroke="black" points="2383.23,-1888.89 2372.72,-1890.2 2381.75,-1895.73 2383.23,-1888.89"/>
<text text-anchor="middle" x="3208" y="-1962.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer3_expert5_gpu37 -->
<g id="node52" class="node">
<title>layer3_expert5_gpu37</title>
<polygon fill="lightblue" stroke="black" points="2759,-1915.95 2532,-1862.95 2759,-1809.95 2986,-1862.95 2759,-1915.95"/>
<text text-anchor="middle" x="2759" y="-1874.25" font-family="Times,serif" font-size="14.00">Expert 37</text>
<text text-anchor="middle" x="2759" y="-1859.25" font-family="Times,serif" font-size="14.00">GPU 37</text>
<text text-anchor="middle" x="2759" y="-1844.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer3_split&#45;&gt;layer3_expert5_gpu37 -->
<g id="edge86" class="edge">
<title>layer3_split&#45;&gt;layer3_expert5_gpu37</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3633.4,-2016.89C3545.82,-1996.92 3443.43,-1975.09 3350,-1958.95 3199.04,-1932.88 3159.1,-1941.19 3008,-1915.95 2966.75,-1909.07 2921.95,-1900.16 2881.87,-1891.67"/>
<polygon fill="black" stroke="black" points="2882.57,-1888.24 2872.06,-1889.58 2881.11,-1895.08 2882.57,-1888.24"/>
<text text-anchor="middle" x="3468" y="-1962.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer3_expert6_gpu38 -->
<g id="node53" class="node">
<title>layer3_expert6_gpu38</title>
<polygon fill="lightblue" stroke="black" points="3256,-1915.95 3029,-1862.95 3256,-1809.95 3483,-1862.95 3256,-1915.95"/>
<text text-anchor="middle" x="3256" y="-1874.25" font-family="Times,serif" font-size="14.00">Expert 38</text>
<text text-anchor="middle" x="3256" y="-1859.25" font-family="Times,serif" font-size="14.00">GPU 38</text>
<text text-anchor="middle" x="3256" y="-1844.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer3_split&#45;&gt;layer3_expert6_gpu38 -->
<g id="edge88" class="edge">
<title>layer3_split&#45;&gt;layer3_expert6_gpu38</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3725.66,-2016.86C3678.56,-1997.7 3624.13,-1976.43 3574,-1958.95 3506.47,-1935.42 3429.68,-1912.37 3368.48,-1894.88"/>
<polygon fill="black" stroke="black" points="3369.37,-1891.49 3358.79,-1892.12 3367.45,-1898.22 3369.37,-1891.49"/>
<text text-anchor="middle" x="3661" y="-1962.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer3_expert7_gpu39 -->
<g id="node54" class="node">
<title>layer3_expert7_gpu39</title>
<polygon fill="lightblue" stroke="black" points="3753,-1915.95 3526,-1862.95 3753,-1809.95 3980,-1862.95 3753,-1915.95"/>
<text text-anchor="middle" x="3753" y="-1874.25" font-family="Times,serif" font-size="14.00">Expert 39</text>
<text text-anchor="middle" x="3753" y="-1859.25" font-family="Times,serif" font-size="14.00">GPU 39</text>
<text text-anchor="middle" x="3753" y="-1844.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer3_split&#45;&gt;layer3_expert7_gpu39 -->
<g id="edge90" class="edge">
<title>layer3_split&#45;&gt;layer3_expert7_gpu39</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3824.53,-2016.69C3810.68,-1987.13 3793.37,-1950.16 3779.24,-1919.99"/>
<polygon fill="black" stroke="black" points="3782.38,-1918.44 3774.97,-1910.87 3776.04,-1921.41 3782.38,-1918.44"/>
<text text-anchor="middle" x="3853" y="-1962.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer3_expert8_gpu40 -->
<g id="node55" class="node">
<title>layer3_expert8_gpu40</title>
<polygon fill="lightblue" stroke="black" points="4250,-1915.95 4023,-1862.95 4250,-1809.95 4477,-1862.95 4250,-1915.95"/>
<text text-anchor="middle" x="4250" y="-1874.25" font-family="Times,serif" font-size="14.00">Expert 40</text>
<text text-anchor="middle" x="4250" y="-1859.25" font-family="Times,serif" font-size="14.00">GPU 40</text>
<text text-anchor="middle" x="4250" y="-1844.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer3_split&#45;&gt;layer3_expert8_gpu40 -->
<g id="edge92" class="edge">
<title>layer3_split&#45;&gt;layer3_expert8_gpu40</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3950.97,-2016.83C4019.31,-1981.89 4107.97,-1936.56 4170.96,-1904.36"/>
<polygon fill="black" stroke="black" points="4172.75,-1907.37 4180.07,-1899.71 4169.57,-1901.14 4172.75,-1907.37"/>
<text text-anchor="middle" x="4111" y="-1962.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer3_expert9_gpu41 -->
<g id="node56" class="node">
<title>layer3_expert9_gpu41</title>
<polygon fill="lightblue" stroke="black" points="4747,-1915.95 4520,-1862.95 4747,-1809.95 4974,-1862.95 4747,-1915.95"/>
<text text-anchor="middle" x="4747" y="-1874.25" font-family="Times,serif" font-size="14.00">Expert 41</text>
<text text-anchor="middle" x="4747" y="-1859.25" font-family="Times,serif" font-size="14.00">GPU 41</text>
<text text-anchor="middle" x="4747" y="-1844.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer3_split&#45;&gt;layer3_expert9_gpu41 -->
<g id="edge94" class="edge">
<title>layer3_split&#45;&gt;layer3_expert9_gpu41</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3997.79,-2034.99C4173.06,-1994.97 4460.97,-1929.25 4624.13,-1892"/>
<polygon fill="black" stroke="black" points="4625.24,-1895.34 4634.21,-1889.7 4623.69,-1888.51 4625.24,-1895.34"/>
<text text-anchor="middle" x="4374" y="-1962.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer3_expert10_gpu42 -->
<g id="node57" class="node">
<title>layer3_expert10_gpu42</title>
<polygon fill="lightblue" stroke="black" points="5244,-1915.95 5017,-1862.95 5244,-1809.95 5471,-1862.95 5244,-1915.95"/>
<text text-anchor="middle" x="5244" y="-1874.25" font-family="Times,serif" font-size="14.00">Expert 42</text>
<text text-anchor="middle" x="5244" y="-1859.25" font-family="Times,serif" font-size="14.00">GPU 42</text>
<text text-anchor="middle" x="5244" y="-1844.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer3_split&#45;&gt;layer3_expert10_gpu42 -->
<g id="edge96" class="edge">
<title>layer3_split&#45;&gt;layer3_expert10_gpu42</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4011.98,-2051.06C4234.88,-2025.72 4647,-1975.73 4996,-1915.95 5036.77,-1908.97 5081.05,-1900.1 5120.76,-1891.67"/>
<polygon fill="black" stroke="black" points="5121.7,-1895.05 5130.75,-1889.54 5120.24,-1888.21 5121.7,-1895.05"/>
<text text-anchor="middle" x="4763" y="-1962.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer3_expert11_gpu43 -->
<g id="node58" class="node">
<title>layer3_expert11_gpu43</title>
<polygon fill="lightblue" stroke="black" points="5741,-1915.95 5514,-1862.95 5741,-1809.95 5968,-1862.95 5741,-1915.95"/>
<text text-anchor="middle" x="5741" y="-1874.25" font-family="Times,serif" font-size="14.00">Expert 43</text>
<text text-anchor="middle" x="5741" y="-1859.25" font-family="Times,serif" font-size="14.00">GPU 43</text>
<text text-anchor="middle" x="5741" y="-1844.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer3_split&#45;&gt;layer3_expert11_gpu43 -->
<g id="edge98" class="edge">
<title>layer3_split&#45;&gt;layer3_expert11_gpu43</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4018.99,-2059.54C4318.21,-2041.53 4958,-1996.67 5493,-1915.95 5534.59,-1909.68 5579.71,-1900.84 5619.92,-1892.22"/>
<polygon fill="black" stroke="black" points="5620.73,-1895.63 5629.76,-1890.1 5619.25,-1888.79 5620.73,-1895.63"/>
<text text-anchor="middle" x="5184" y="-1962.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer3_expert12_gpu44 -->
<g id="node59" class="node">
<title>layer3_expert12_gpu44</title>
<polygon fill="lightblue" stroke="black" points="6238,-1915.95 6011,-1862.95 6238,-1809.95 6465,-1862.95 6238,-1915.95"/>
<text text-anchor="middle" x="6238" y="-1874.25" font-family="Times,serif" font-size="14.00">Expert 44</text>
<text text-anchor="middle" x="6238" y="-1859.25" font-family="Times,serif" font-size="14.00">GPU 44</text>
<text text-anchor="middle" x="6238" y="-1844.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer3_split&#45;&gt;layer3_expert12_gpu44 -->
<g id="edge100" class="edge">
<title>layer3_split&#45;&gt;layer3_expert12_gpu44</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4023.69,-2064.84C4389.95,-2054.38 5264.44,-2019.78 5990,-1915.95 6031.94,-1909.95 6077.42,-1901.11 6117.85,-1892.41"/>
<polygon fill="black" stroke="black" points="6118.71,-1895.8 6127.74,-1890.26 6117.23,-1888.96 6118.71,-1895.8"/>
<text text-anchor="middle" x="5691" y="-1962.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer3_expert13_gpu45 -->
<g id="node60" class="node">
<title>layer3_expert13_gpu45</title>
<polygon fill="lightblue" stroke="black" points="6735,-1915.95 6508,-1862.95 6735,-1809.95 6962,-1862.95 6735,-1915.95"/>
<text text-anchor="middle" x="6735" y="-1874.25" font-family="Times,serif" font-size="14.00">Expert 45</text>
<text text-anchor="middle" x="6735" y="-1859.25" font-family="Times,serif" font-size="14.00">GPU 45</text>
<text text-anchor="middle" x="6735" y="-1844.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer3_split&#45;&gt;layer3_expert13_gpu45 -->
<g id="edge102" class="edge">
<title>layer3_split&#45;&gt;layer3_expert13_gpu45</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4021.21,-2062.01C4355.06,-2048.19 5113.6,-2014.98 5751,-1973.95 6078.45,-1952.88 6162.21,-1962.61 6487,-1915.95 6528.94,-1909.93 6574.42,-1901.08 6614.85,-1892.38"/>
<polygon fill="black" stroke="black" points="6615.71,-1895.77 6624.74,-1890.23 6614.22,-1888.93 6615.71,-1895.77"/>
<text text-anchor="middle" x="6082" y="-1962.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer3_expert14_gpu46 -->
<g id="node61" class="node">
<title>layer3_expert14_gpu46</title>
<polygon fill="lightblue" stroke="black" points="7232,-1915.95 7005,-1862.95 7232,-1809.95 7459,-1862.95 7232,-1915.95"/>
<text text-anchor="middle" x="7232" y="-1874.25" font-family="Times,serif" font-size="14.00">Expert 46</text>
<text text-anchor="middle" x="7232" y="-1859.25" font-family="Times,serif" font-size="14.00">GPU 46</text>
<text text-anchor="middle" x="7232" y="-1844.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer3_split&#45;&gt;layer3_expert14_gpu46 -->
<g id="edge104" class="edge">
<title>layer3_split&#45;&gt;layer3_expert14_gpu46</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4022.39,-2063.39C4405.07,-2050.76 5350.82,-2017.58 6142,-1973.95 6516.54,-1953.3 6612.44,-1967.45 6984,-1915.95 7026.07,-1910.12 7071.68,-1901.29 7112.17,-1892.56"/>
<polygon fill="black" stroke="black" points="7113.05,-1895.95 7122.08,-1890.4 7111.56,-1889.11 7113.05,-1895.95"/>
<text text-anchor="middle" x="6543" y="-1962.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer3_expert15_gpu47 -->
<g id="node62" class="node">
<title>layer3_expert15_gpu47</title>
<polygon fill="lightblue" stroke="black" points="7729,-1915.95 7502,-1862.95 7729,-1809.95 7956,-1862.95 7729,-1915.95"/>
<text text-anchor="middle" x="7729" y="-1874.25" font-family="Times,serif" font-size="14.00">Expert 47</text>
<text text-anchor="middle" x="7729" y="-1859.25" font-family="Times,serif" font-size="14.00">GPU 47</text>
<text text-anchor="middle" x="7729" y="-1844.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer3_split&#45;&gt;layer3_expert15_gpu47 -->
<g id="edge106" class="edge">
<title>layer3_split&#45;&gt;layer3_expert15_gpu47</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4023.88,-2064.83C4459.64,-2054.14 5628.87,-2022.92 6603,-1973.95 6993.58,-1954.32 7093.56,-1969.1 7481,-1915.95 7523.18,-1910.17 7568.9,-1901.33 7609.47,-1892.56"/>
<polygon fill="black" stroke="black" points="7610.37,-1895.95 7619.4,-1890.4 7608.88,-1889.11 7610.37,-1895.95"/>
<text text-anchor="middle" x="7049" y="-1962.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer3_gather -->
<g id="node63" class="node">
<title>layer3_gather</title>
<polygon fill="orange" stroke="black" points="4040.88,-1722.95 3740.42,-1722.95 3663.12,-1586.95 3963.58,-1586.95 4040.88,-1722.95"/>
<text text-anchor="middle" x="3852" y="-1673.75" font-family="Times,serif" font-size="14.00">Gather Expert Outputs</text>
<text text-anchor="middle" x="3852" y="-1658.75" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="3852" y="-1643.75" font-family="Times,serif" font-size="14.00">Async all&#45;gather</text>
<text text-anchor="middle" x="3852" y="-1628.75" font-family="Times,serif" font-size="14.00">GPUs 32&#45;47</text>
</g>
<!-- layer3_expert0_gpu32&#45;&gt;layer3_gather -->
<g id="edge77" class="edge">
<title>layer3_expert0_gpu32&#45;&gt;layer3_gather</title>
<path fill="none" stroke="black" d="M383.08,-1835.36C426.38,-1825.8 476.79,-1815.92 523,-1809.95 902.57,-1760.91 1000.72,-1784.25 1383,-1765.95 2256.79,-1724.14 3304.79,-1679.16 3695.3,-1662.58"/>
<polygon fill="black" stroke="black" points="3695.69,-1666.06 3705.54,-1662.14 3695.4,-1659.07 3695.69,-1666.06"/>
</g>
<!-- layer3_expert1_gpu33&#45;&gt;layer3_gather -->
<g id="edge79" class="edge">
<title>layer3_expert1_gpu33&#45;&gt;layer3_gather</title>
<path fill="none" stroke="black" d="M880.4,-1835.37C923.63,-1825.84 973.91,-1815.98 1020,-1809.95 2031.22,-1677.65 3259.93,-1658.62 3692.28,-1656.18"/>
<polygon fill="black" stroke="black" points="3692.36,-1659.68 3702.35,-1656.13 3692.33,-1652.68 3692.36,-1659.68"/>
</g>
<!-- layer3_expert2_gpu34&#45;&gt;layer3_gather -->
<g id="edge81" class="edge">
<title>layer3_expert2_gpu34&#45;&gt;layer3_gather</title>
<path fill="none" stroke="black" d="M1378.05,-1835.51C1421.15,-1826.06 1471.17,-1816.22 1517,-1809.95 2330.72,-1698.71 3315.37,-1667.13 3693.56,-1658.76"/>
<polygon fill="black" stroke="black" points="3693.83,-1662.26 3703.75,-1658.54 3693.68,-1655.26 3693.83,-1662.26"/>
</g>
<!-- layer3_expert3_gpu35&#45;&gt;layer3_gather -->
<g id="edge83" class="edge">
<title>layer3_expert3_gpu35&#45;&gt;layer3_gather</title>
<path fill="none" stroke="black" d="M1875.73,-1835.8C1918.7,-1826.45 1968.44,-1816.59 2014,-1809.95 2632.89,-1719.75 3377.31,-1677.54 3695.46,-1662.6"/>
<polygon fill="black" stroke="black" points="3695.84,-1666.09 3705.67,-1662.13 3695.52,-1659.1 3695.84,-1666.09"/>
</g>
<!-- layer3_expert4_gpu36&#45;&gt;layer3_gather -->
<g id="edge85" class="edge">
<title>layer3_expert4_gpu36&#45;&gt;layer3_gather</title>
<path fill="none" stroke="black" d="M2374.7,-1836.14C2417.25,-1826.99 2466.2,-1817.19 2511,-1809.95 2939.13,-1740.82 3449.04,-1691.16 3698.77,-1668.95"/>
<polygon fill="black" stroke="black" points="3699.35,-1672.41 3709.01,-1668.04 3698.74,-1665.44 3699.35,-1672.41"/>
</g>
<!-- layer3_expert5_gpu37&#45;&gt;layer3_gather -->
<g id="edge87" class="edge">
<title>layer3_expert5_gpu37&#45;&gt;layer3_gather</title>
<path fill="none" stroke="black" d="M2875.42,-1837C2917.18,-1828.22 2964.66,-1818.43 3008,-1809.95 3252.18,-1762.19 3537.06,-1711.19 3705.56,-1681.51"/>
<polygon fill="black" stroke="black" points="3706.24,-1684.94 3715.49,-1679.76 3705.03,-1678.05 3706.24,-1684.94"/>
</g>
<!-- layer3_expert6_gpu38&#45;&gt;layer3_gather -->
<g id="edge89" class="edge">
<title>layer3_expert6_gpu38&#45;&gt;layer3_gather</title>
<path fill="none" stroke="black" d="M3345.87,-1830.89C3444.48,-1796.81 3603.81,-1741.74 3717.35,-1702.49"/>
<polygon fill="black" stroke="black" points="3718.51,-1705.8 3726.82,-1699.22 3716.22,-1699.18 3718.51,-1705.8"/>
</g>
<!-- layer3_expert7_gpu39&#45;&gt;layer3_gather -->
<g id="edge91" class="edge">
<title>layer3_expert7_gpu39&#45;&gt;layer3_gather</title>
<path fill="none" stroke="black" d="M3775.59,-1814.95C3787.33,-1790.52 3801.97,-1760.05 3815.29,-1732.34"/>
<polygon fill="black" stroke="black" points="3818.57,-1733.59 3819.75,-1723.06 3812.26,-1730.56 3818.57,-1733.59"/>
</g>
<!-- layer3_expert8_gpu40&#45;&gt;layer3_gather -->
<g id="edge93" class="edge">
<title>layer3_expert8_gpu40&#45;&gt;layer3_gather</title>
<path fill="none" stroke="black" d="M4180.67,-1826.07C4128.35,-1798.99 4054.83,-1760.94 3990.6,-1727.69"/>
<polygon fill="black" stroke="black" points="3992.09,-1724.52 3981.6,-1723.03 3988.87,-1730.74 3992.09,-1724.52"/>
</g>
<!-- layer3_expert9_gpu41&#45;&gt;layer3_gather -->
<g id="edge95" class="edge">
<title>layer3_expert9_gpu41&#45;&gt;layer3_gather</title>
<path fill="none" stroke="black" d="M4634.55,-1836.07C4484.15,-1801.45 4215.59,-1739.64 4035.62,-1698.22"/>
<polygon fill="black" stroke="black" points="4036.31,-1694.78 4025.78,-1695.95 4034.74,-1701.61 4036.31,-1694.78"/>
</g>
<!-- layer3_expert10_gpu42&#45;&gt;layer3_gather -->
<g id="edge97" class="edge">
<title>layer3_expert10_gpu42&#45;&gt;layer3_gather</title>
<path fill="none" stroke="black" d="M5130.75,-1836.39C5088.58,-1827.36 5040.22,-1817.56 4996,-1809.95 4652.44,-1750.89 4247.57,-1700.99 4023.34,-1675.07"/>
<polygon fill="black" stroke="black" points="4023.47,-1671.56 4013.13,-1673.89 4022.66,-1678.51 4023.47,-1671.56"/>
</g>
<!-- layer3_expert11_gpu43&#45;&gt;layer3_gather -->
<g id="edge99" class="edge">
<title>layer3_expert11_gpu43&#45;&gt;layer3_gather</title>
<path fill="none" stroke="black" d="M5629.76,-1835.83C5587.17,-1826.57 5538.02,-1816.76 5493,-1809.95 4956.75,-1728.84 4315.04,-1683.42 4017.97,-1665.3"/>
<polygon fill="black" stroke="black" points="4018.17,-1661.81 4007.98,-1664.7 4017.75,-1668.8 4018.17,-1661.81"/>
</g>
<!-- layer3_expert12_gpu44&#45;&gt;layer3_gather -->
<g id="edge101" class="edge">
<title>layer3_expert12_gpu44&#45;&gt;layer3_gather</title>
<path fill="none" stroke="black" d="M6128.07,-1835.58C6085.21,-1826.17 6035.53,-1816.34 5990,-1809.95 5257.66,-1707.28 4374.03,-1671.21 4015.25,-1660.21"/>
<polygon fill="black" stroke="black" points="4015.15,-1656.71 4005.04,-1659.9 4014.93,-1663.7 4015.15,-1656.71"/>
</g>
<!-- layer3_expert13_gpu45&#45;&gt;layer3_gather -->
<g id="edge103" class="edge">
<title>layer3_expert13_gpu45&#45;&gt;layer3_gather</title>
<path fill="none" stroke="black" d="M6625.73,-1835.39C6582.73,-1825.9 6532.79,-1816.06 6487,-1809.95 5556.24,-1685.87 4427.29,-1661.76 4013.74,-1657.08"/>
<polygon fill="black" stroke="black" points="4013.55,-1653.58 4003.51,-1656.97 4013.47,-1660.58 4013.55,-1653.58"/>
</g>
<!-- layer3_expert14_gpu46&#45;&gt;layer3_gather -->
<g id="edge105" class="edge">
<title>layer3_expert14_gpu46&#45;&gt;layer3_gather</title>
<path fill="none" stroke="black" d="M7123.06,-1835.28C7080,-1825.75 7029.92,-1815.9 6984,-1809.95 6604.01,-1760.71 6505.69,-1785 6123,-1765.95 5334.55,-1726.71 4392.03,-1681.65 4017.34,-1663.81"/>
<polygon fill="black" stroke="black" points="4017.39,-1660.31 4007.23,-1663.33 4017.05,-1667.3 4017.39,-1660.31"/>
</g>
<!-- layer3_expert15_gpu47&#45;&gt;layer3_gather -->
<g id="edge107" class="edge">
<title>layer3_expert15_gpu47&#45;&gt;layer3_gather</title>
<path fill="none" stroke="black" d="M7620.7,-1835.21C7577.5,-1825.61 7527.16,-1815.73 7481,-1809.95 6795.99,-1724.19 4628.11,-1672.48 4014.98,-1659.31"/>
<polygon fill="black" stroke="black" points="4014.82,-1655.8 4004.74,-1659.09 4014.67,-1662.8 4014.82,-1655.8"/>
</g>
<!-- layer3_residual -->
<g id="node64" class="node">
<title>layer3_residual</title>
<polygon fill="orange" stroke="black" points="3852,-1499.95 3699,-1446.95 3852,-1393.95 4005,-1446.95 3852,-1499.95"/>
<text text-anchor="middle" x="3852" y="-1458.25" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="3852" y="-1443.25" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="3852" y="-1428.25" font-family="Times,serif" font-size="14.00">Across GPUs 32&#45;47</text>
</g>
<!-- layer3_gather&#45;&gt;layer3_residual -->
<g id="edge108" class="edge">
<title>layer3_gather&#45;&gt;layer3_residual</title>
<path fill="none" stroke="black" d="M3852,-1586.79C3852,-1562.13 3852,-1534.34 3852,-1510.14"/>
<polygon fill="black" stroke="black" points="3855.5,-1510.01 3852,-1500.01 3848.5,-1510.01 3855.5,-1510.01"/>
</g>
<!-- layer4_attn -->
<g id="node65" class="node">
<title>layer4_attn</title>
<polygon fill="lightblue" stroke="black" points="3852,-1306.95 3646,-1253.95 3852,-1200.95 4058,-1253.95 3852,-1306.95"/>
<text text-anchor="middle" x="3852" y="-1265.25" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="3852" y="-1250.25" font-family="Times,serif" font-size="14.00">[1024 tokens, hidden_dim]</text>
<text text-anchor="middle" x="3852" y="-1235.25" font-family="Times,serif" font-size="14.00">Replicated on GPUs 48&#45;63</text>
</g>
<!-- layer3_residual&#45;&gt;layer4_attn -->
<g id="edge109" class="edge">
<title>layer3_residual&#45;&gt;layer4_attn</title>
<path fill="none" stroke="black" d="M3852,-1393.76C3852,-1370.07 3852,-1341.88 3852,-1317.11"/>
<polygon fill="black" stroke="black" points="3855.5,-1317.08 3852,-1307.08 3848.5,-1317.08 3855.5,-1317.08"/>
</g>
<!-- layer4_gate -->
<g id="node66" class="node">
<title>layer4_gate</title>
<polygon fill="orange" stroke="black" points="4041.95,-1113.95 3739.78,-1113.95 3662.05,-977.95 3964.22,-977.95 4041.95,-1113.95"/>
<text text-anchor="middle" x="3852" y="-1064.75" font-family="Times,serif" font-size="14.00">Gate Network</text>
<text text-anchor="middle" x="3852" y="-1049.75" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="3852" y="-1034.75" font-family="Times,serif" font-size="14.00">Compute routing probs</text>
<text text-anchor="middle" x="3852" y="-1019.75" font-family="Times,serif" font-size="14.00">GPUs 48&#45;63</text>
</g>
<!-- layer4_attn&#45;&gt;layer4_gate -->
<g id="edge110" class="edge">
<title>layer4_attn&#45;&gt;layer4_gate</title>
<path fill="none" stroke="black" d="M3852,-1200.7C3852,-1177.45 3852,-1149.59 3852,-1124.02"/>
<polygon fill="black" stroke="black" points="3855.5,-1123.97 3852,-1113.97 3848.5,-1123.97 3855.5,-1123.97"/>
</g>
<!-- layer4_split -->
<g id="node67" class="node">
<title>layer4_split</title>
<polygon fill="orange" stroke="black" points="4076.95,-890.95 3719.1,-890.95 3627.05,-784.95 3984.9,-784.95 4076.95,-890.95"/>
<text text-anchor="middle" x="3852" y="-849.25" font-family="Times,serif" font-size="14.00">Split Tokens by Expert</text>
<text text-anchor="middle" x="3852" y="-834.25" font-family="Times,serif" font-size="14.00">[Variable tokens per expert]</text>
<text text-anchor="middle" x="3852" y="-819.25" font-family="Times,serif" font-size="14.00">Async routing</text>
</g>
<!-- layer4_gate&#45;&gt;layer4_split -->
<g id="edge111" class="edge">
<title>layer4_gate&#45;&gt;layer4_split</title>
<path fill="none" stroke="black" d="M3852,-977.79C3852,-953.13 3852,-925.34 3852,-901.14"/>
<polygon fill="black" stroke="black" points="3855.5,-901.01 3852,-891.01 3848.5,-901.01 3855.5,-901.01"/>
</g>
<!-- layer4_expert0_gpu48 -->
<g id="node68" class="node">
<title>layer4_expert0_gpu48</title>
<polygon fill="lightblue" stroke="black" points="243,-683.95 16,-630.95 243,-577.95 470,-630.95 243,-683.95"/>
<text text-anchor="middle" x="243" y="-642.25" font-family="Times,serif" font-size="14.00">Expert 48</text>
<text text-anchor="middle" x="243" y="-627.25" font-family="Times,serif" font-size="14.00">GPU 48</text>
<text text-anchor="middle" x="243" y="-612.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer4_split&#45;&gt;layer4_expert0_gpu48 -->
<g id="edge112" class="edge">
<title>layer4_split&#45;&gt;layer4_expert0_gpu48</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3667.62,-831.9C3252.17,-820.08 2211.18,-788.13 1341,-741.95 963.32,-721.91 866.67,-735.62 492,-683.95 449.66,-678.11 403.76,-669.26 363.02,-660.5"/>
<polygon fill="black" stroke="black" points="363.57,-657.04 353.06,-658.34 362.09,-663.88 363.57,-657.04"/>
<text text-anchor="middle" x="1391" y="-730.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer4_expert1_gpu49 -->
<g id="node69" class="node">
<title>layer4_expert1_gpu49</title>
<polygon fill="lightblue" stroke="black" points="740,-683.95 513,-630.95 740,-577.95 967,-630.95 740,-683.95"/>
<text text-anchor="middle" x="740" y="-642.25" font-family="Times,serif" font-size="14.00">Expert 49</text>
<text text-anchor="middle" x="740" y="-627.25" font-family="Times,serif" font-size="14.00">GPU 49</text>
<text text-anchor="middle" x="740" y="-612.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer4_split&#45;&gt;layer4_expert1_gpu49 -->
<g id="edge114" class="edge">
<title>layer4_split&#45;&gt;layer4_expert1_gpu49</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3666.5,-830.38C3301.33,-817.03 2463.59,-784.38 1760,-741.95 1416.99,-721.27 1329.25,-732.07 989,-683.95 946.79,-677.98 901,-669.12 860.34,-660.4"/>
<polygon fill="black" stroke="black" points="860.91,-656.94 850.39,-658.24 859.42,-663.78 860.91,-656.94"/>
<text text-anchor="middle" x="1810" y="-730.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer4_expert2_gpu50 -->
<g id="node70" class="node">
<title>layer4_expert2_gpu50</title>
<polygon fill="lightblue" stroke="black" points="1237,-683.95 1010,-630.95 1237,-577.95 1464,-630.95 1237,-683.95"/>
<text text-anchor="middle" x="1237" y="-642.25" font-family="Times,serif" font-size="14.00">Expert 50</text>
<text text-anchor="middle" x="1237" y="-627.25" font-family="Times,serif" font-size="14.00">GPU 50</text>
<text text-anchor="middle" x="1237" y="-612.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer4_split&#45;&gt;layer4_expert2_gpu50 -->
<g id="edge116" class="edge">
<title>layer4_split&#45;&gt;layer4_expert2_gpu50</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3669.95,-834.76C3271.86,-827.87 2294.85,-799.54 1486,-683.95 1443.9,-677.94 1398.23,-669.09 1357.64,-660.39"/>
<polygon fill="black" stroke="black" points="1358.22,-656.93 1347.71,-658.24 1356.74,-663.78 1358.22,-656.93"/>
<text text-anchor="middle" x="1986" y="-730.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer4_expert3_gpu51 -->
<g id="node71" class="node">
<title>layer4_expert3_gpu51</title>
<polygon fill="lightblue" stroke="black" points="1734,-683.95 1507,-630.95 1734,-577.95 1961,-630.95 1734,-683.95"/>
<text text-anchor="middle" x="1734" y="-642.25" font-family="Times,serif" font-size="14.00">Expert 51</text>
<text text-anchor="middle" x="1734" y="-627.25" font-family="Times,serif" font-size="14.00">GPU 51</text>
<text text-anchor="middle" x="1734" y="-612.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer4_split&#45;&gt;layer4_expert3_gpu51 -->
<g id="edge118" class="edge">
<title>layer4_split&#45;&gt;layer4_expert3_gpu51</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3665.75,-829.54C3328.61,-814.38 2595.27,-773.43 1983,-683.95 1941.02,-677.82 1895.47,-668.96 1854.96,-660.29"/>
<polygon fill="black" stroke="black" points="1855.55,-656.84 1845.04,-658.16 1854.08,-663.69 1855.55,-656.84"/>
<text text-anchor="middle" x="2492" y="-730.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer4_expert4_gpu52 -->
<g id="node72" class="node">
<title>layer4_expert4_gpu52</title>
<polygon fill="lightblue" stroke="black" points="2231,-683.95 2004,-630.95 2231,-577.95 2458,-630.95 2231,-683.95"/>
<text text-anchor="middle" x="2231" y="-642.25" font-family="Times,serif" font-size="14.00">Expert 52</text>
<text text-anchor="middle" x="2231" y="-627.25" font-family="Times,serif" font-size="14.00">GPU 52</text>
<text text-anchor="middle" x="2231" y="-612.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer4_split&#45;&gt;layer4_expert4_gpu52 -->
<g id="edge120" class="edge">
<title>layer4_split&#45;&gt;layer4_expert4_gpu52</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3658.37,-821.19C3391.97,-798.18 2897.87,-750.73 2480,-683.95 2438.5,-677.32 2393.46,-668.44 2353.23,-659.89"/>
<polygon fill="black" stroke="black" points="2353.89,-656.45 2343.38,-657.78 2352.43,-663.3 2353.89,-656.45"/>
<text text-anchor="middle" x="2943" y="-730.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer4_expert5_gpu53 -->
<g id="node73" class="node">
<title>layer4_expert5_gpu53</title>
<polygon fill="lightblue" stroke="black" points="2728,-683.95 2501,-630.95 2728,-577.95 2955,-630.95 2728,-683.95"/>
<text text-anchor="middle" x="2728" y="-642.25" font-family="Times,serif" font-size="14.00">Expert 53</text>
<text text-anchor="middle" x="2728" y="-627.25" font-family="Times,serif" font-size="14.00">GPU 53</text>
<text text-anchor="middle" x="2728" y="-612.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer4_split&#45;&gt;layer4_expert5_gpu53 -->
<g id="edge122" class="edge">
<title>layer4_split&#45;&gt;layer4_expert5_gpu53</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3641.7,-802.17C3464.24,-772.34 3203.61,-727.42 2977,-683.95 2936.82,-676.25 2893.11,-667.31 2853.68,-659.04"/>
<polygon fill="black" stroke="black" points="2854.26,-655.58 2843.76,-656.95 2852.82,-662.43 2854.26,-655.58"/>
<text text-anchor="middle" x="3339" y="-730.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer4_expert6_gpu54 -->
<g id="node74" class="node">
<title>layer4_expert6_gpu54</title>
<polygon fill="lightblue" stroke="black" points="3225,-683.95 2998,-630.95 3225,-577.95 3452,-630.95 3225,-683.95"/>
<text text-anchor="middle" x="3225" y="-642.25" font-family="Times,serif" font-size="14.00">Expert 54</text>
<text text-anchor="middle" x="3225" y="-627.25" font-family="Times,serif" font-size="14.00">GPU 54</text>
<text text-anchor="middle" x="3225" y="-612.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer4_split&#45;&gt;layer4_expert6_gpu54 -->
<g id="edge124" class="edge">
<title>layer4_split&#45;&gt;layer4_expert6_gpu54</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3692.57,-784.83C3577.92,-747.34 3426.7,-697.9 3327.72,-665.54"/>
<polygon fill="black" stroke="black" points="3328.6,-662.14 3318,-662.36 3326.42,-668.8 3328.6,-662.14"/>
<text text-anchor="middle" x="3607" y="-730.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer4_expert7_gpu55 -->
<g id="node75" class="node">
<title>layer4_expert7_gpu55</title>
<polygon fill="lightblue" stroke="black" points="3722,-683.95 3495,-630.95 3722,-577.95 3949,-630.95 3722,-683.95"/>
<text text-anchor="middle" x="3722" y="-642.25" font-family="Times,serif" font-size="14.00">Expert 55</text>
<text text-anchor="middle" x="3722" y="-627.25" font-family="Times,serif" font-size="14.00">GPU 55</text>
<text text-anchor="middle" x="3722" y="-612.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer4_split&#45;&gt;layer4_expert7_gpu55 -->
<g id="edge126" class="edge">
<title>layer4_split&#45;&gt;layer4_expert7_gpu55</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3818.86,-784.69C3799.76,-754.57 3775.78,-716.76 3756.46,-686.29"/>
<polygon fill="black" stroke="black" points="3759.19,-684.07 3750.88,-677.5 3753.28,-687.82 3759.19,-684.07"/>
<text text-anchor="middle" x="3840" y="-730.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer4_expert8_gpu56 -->
<g id="node76" class="node">
<title>layer4_expert8_gpu56</title>
<polygon fill="lightblue" stroke="black" points="4219,-683.95 3992,-630.95 4219,-577.95 4446,-630.95 4219,-683.95"/>
<text text-anchor="middle" x="4219" y="-642.25" font-family="Times,serif" font-size="14.00">Expert 56</text>
<text text-anchor="middle" x="4219" y="-627.25" font-family="Times,serif" font-size="14.00">GPU 56</text>
<text text-anchor="middle" x="4219" y="-612.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer4_split&#45;&gt;layer4_expert8_gpu56 -->
<g id="edge128" class="edge">
<title>layer4_split&#45;&gt;layer4_expert8_gpu56</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3945.56,-784.69C4007.14,-750.29 4086.68,-705.86 4144.08,-673.8"/>
<polygon fill="black" stroke="black" points="4146.08,-676.7 4153.1,-668.76 4142.66,-670.58 4146.08,-676.7"/>
<text text-anchor="middle" x="4096" y="-730.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer4_expert9_gpu57 -->
<g id="node77" class="node">
<title>layer4_expert9_gpu57</title>
<polygon fill="lightblue" stroke="black" points="4716,-683.95 4489,-630.95 4716,-577.95 4943,-630.95 4716,-683.95"/>
<text text-anchor="middle" x="4716" y="-642.25" font-family="Times,serif" font-size="14.00">Expert 57</text>
<text text-anchor="middle" x="4716" y="-627.25" font-family="Times,serif" font-size="14.00">GPU 57</text>
<text text-anchor="middle" x="4716" y="-612.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer4_split&#45;&gt;layer4_expert9_gpu57 -->
<g id="edge130" class="edge">
<title>layer4_split&#45;&gt;layer4_expert9_gpu57</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4000.04,-801.83C4168.14,-761.94 4439.23,-697.62 4595.14,-660.63"/>
<polygon fill="black" stroke="black" points="4596.32,-663.95 4605.24,-658.23 4594.7,-657.14 4596.32,-663.95"/>
<text text-anchor="middle" x="4359" y="-730.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer4_expert10_gpu58 -->
<g id="node78" class="node">
<title>layer4_expert10_gpu58</title>
<polygon fill="lightblue" stroke="black" points="5213,-683.95 4986,-630.95 5213,-577.95 5440,-630.95 5213,-683.95"/>
<text text-anchor="middle" x="5213" y="-642.25" font-family="Times,serif" font-size="14.00">Expert 58</text>
<text text-anchor="middle" x="5213" y="-627.25" font-family="Times,serif" font-size="14.00">GPU 58</text>
<text text-anchor="middle" x="5213" y="-612.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer4_split&#45;&gt;layer4_expert10_gpu58 -->
<g id="edge132" class="edge">
<title>layer4_split&#45;&gt;layer4_expert10_gpu58</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4014.29,-818.26C4231.5,-792.42 4628.44,-742.3 4965,-683.95 5005.66,-676.91 5049.82,-668.04 5089.45,-659.64"/>
<polygon fill="black" stroke="black" points="5090.38,-663.02 5099.43,-657.51 5088.92,-656.17 5090.38,-663.02"/>
<text text-anchor="middle" x="4741" y="-730.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer4_expert11_gpu59 -->
<g id="node79" class="node">
<title>layer4_expert11_gpu59</title>
<polygon fill="lightblue" stroke="black" points="5710,-683.95 5483,-630.95 5710,-577.95 5937,-630.95 5710,-683.95"/>
<text text-anchor="middle" x="5710" y="-642.25" font-family="Times,serif" font-size="14.00">Expert 59</text>
<text text-anchor="middle" x="5710" y="-627.25" font-family="Times,serif" font-size="14.00">GPU 59</text>
<text text-anchor="middle" x="5710" y="-612.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer4_split&#45;&gt;layer4_expert11_gpu59 -->
<g id="edge134" class="edge">
<title>layer4_split&#45;&gt;layer4_expert11_gpu59</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4021.68,-827.1C4316.06,-808.6 4939.96,-763.23 5462,-683.95 5503.59,-677.64 5548.7,-668.79 5588.91,-660.17"/>
<polygon fill="black" stroke="black" points="5589.72,-663.58 5598.76,-658.05 5588.24,-656.74 5589.72,-663.58"/>
<text text-anchor="middle" x="5160" y="-730.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer4_expert12_gpu60 -->
<g id="node80" class="node">
<title>layer4_expert12_gpu60</title>
<polygon fill="lightblue" stroke="black" points="6207,-683.95 5980,-630.95 6207,-577.95 6434,-630.95 6207,-683.95"/>
<text text-anchor="middle" x="6207" y="-642.25" font-family="Times,serif" font-size="14.00">Expert 60</text>
<text text-anchor="middle" x="6207" y="-627.25" font-family="Times,serif" font-size="14.00">GPU 60</text>
<text text-anchor="middle" x="6207" y="-612.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer4_split&#45;&gt;layer4_expert12_gpu60 -->
<g id="edge136" class="edge">
<title>layer4_split&#45;&gt;layer4_expert12_gpu60</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4026.32,-832.55C4388.18,-821.59 5246.53,-786.18 5959,-683.95 6000.94,-677.94 6046.42,-669.09 6086.85,-660.39"/>
<polygon fill="black" stroke="black" points="6087.71,-663.78 6096.74,-658.24 6086.22,-656.94 6087.71,-663.78"/>
<text text-anchor="middle" x="5666" y="-730.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer4_expert13_gpu61 -->
<g id="node81" class="node">
<title>layer4_expert13_gpu61</title>
<polygon fill="lightblue" stroke="black" points="6704,-683.95 6477,-630.95 6704,-577.95 6931,-630.95 6704,-683.95"/>
<text text-anchor="middle" x="6704" y="-642.25" font-family="Times,serif" font-size="14.00">Expert 61</text>
<text text-anchor="middle" x="6704" y="-627.25" font-family="Times,serif" font-size="14.00">GPU 61</text>
<text text-anchor="middle" x="6704" y="-612.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer4_split&#45;&gt;layer4_expert13_gpu61 -->
<g id="edge138" class="edge">
<title>layer4_split&#45;&gt;layer4_expert13_gpu61</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4024.23,-829.87C4354.48,-815.93 5099.62,-782.71 5726,-741.95 6050.78,-720.82 6133.85,-730.33 6456,-683.95 6497.94,-677.92 6543.42,-669.06 6583.84,-660.36"/>
<polygon fill="black" stroke="black" points="6584.71,-663.76 6593.74,-658.22 6583.22,-656.92 6584.71,-663.76"/>
<text text-anchor="middle" x="6055" y="-730.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer4_expert14_gpu62 -->
<g id="node82" class="node">
<title>layer4_expert14_gpu62</title>
<polygon fill="lightblue" stroke="black" points="7201,-683.95 6974,-630.95 7201,-577.95 7428,-630.95 7201,-683.95"/>
<text text-anchor="middle" x="7201" y="-642.25" font-family="Times,serif" font-size="14.00">Expert 62</text>
<text text-anchor="middle" x="7201" y="-627.25" font-family="Times,serif" font-size="14.00">GPU 62</text>
<text text-anchor="middle" x="7201" y="-612.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer4_split&#45;&gt;layer4_expert14_gpu62 -->
<g id="edge140" class="edge">
<title>layer4_split&#45;&gt;layer4_expert14_gpu62</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4025.26,-831.28C4404.31,-818.53 5335.65,-785.27 6115,-741.95 6487.76,-721.23 6583.21,-735.27 6953,-683.95 6995.07,-678.12 7040.67,-669.29 7081.17,-660.55"/>
<polygon fill="black" stroke="black" points="7082.05,-663.94 7091.08,-658.39 7080.56,-657.1 7082.05,-663.94"/>
<text text-anchor="middle" x="6514" y="-730.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer4_expert15_gpu63 -->
<g id="node83" class="node">
<title>layer4_expert15_gpu63</title>
<polygon fill="lightblue" stroke="black" points="7698,-683.95 7471,-630.95 7698,-577.95 7925,-630.95 7698,-683.95"/>
<text text-anchor="middle" x="7698" y="-642.25" font-family="Times,serif" font-size="14.00">Expert 63</text>
<text text-anchor="middle" x="7698" y="-627.25" font-family="Times,serif" font-size="14.00">GPU 63</text>
<text text-anchor="middle" x="7698" y="-612.25" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
</g>
<!-- layer4_split&#45;&gt;layer4_expert15_gpu63 -->
<g id="edge142" class="edge">
<title>layer4_split&#45;&gt;layer4_expert15_gpu63</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4026.43,-832.75C4458.37,-821.95 5612.37,-790.56 6574,-741.95 6963.69,-722.26 7063.44,-737.01 7450,-683.95 7492.18,-678.16 7537.9,-669.32 7578.47,-660.56"/>
<polygon fill="black" stroke="black" points="7579.37,-663.95 7588.39,-658.4 7577.88,-657.11 7579.37,-663.95"/>
<text text-anchor="middle" x="7019" y="-730.75" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer4_gather -->
<g id="node84" class="node">
<title>layer4_gather</title>
<polygon fill="orange" stroke="black" points="4158.88,-490.95 3858.42,-490.95 3781.12,-354.95 4081.58,-354.95 4158.88,-490.95"/>
<text text-anchor="middle" x="3970" y="-441.75" font-family="Times,serif" font-size="14.00">Gather Expert Outputs</text>
<text text-anchor="middle" x="3970" y="-426.75" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="3970" y="-411.75" font-family="Times,serif" font-size="14.00">Async all&#45;gather</text>
<text text-anchor="middle" x="3970" y="-396.75" font-family="Times,serif" font-size="14.00">GPUs 48&#45;63</text>
</g>
<!-- layer4_expert0_gpu48&#45;&gt;layer4_gather -->
<g id="edge113" class="edge">
<title>layer4_expert0_gpu48&#45;&gt;layer4_gather</title>
<path fill="none" stroke="black" d="M352.08,-603.35C395.38,-593.79 445.79,-583.91 492,-577.95 875.54,-528.5 974.7,-551.88 1361,-533.95 2291.21,-490.79 3408.34,-446.08 3813.56,-430.09"/>
<polygon fill="black" stroke="black" points="3813.74,-433.58 3823.59,-429.69 3813.46,-426.59 3813.74,-433.58"/>
</g>
<!-- layer4_expert1_gpu49&#45;&gt;layer4_gather -->
<g id="edge115" class="edge">
<title>layer4_expert1_gpu49&#45;&gt;layer4_gather</title>
<path fill="none" stroke="black" d="M849.08,-603.37C892.38,-593.82 942.79,-583.94 989,-577.95 2059.78,-439.33 3362.15,-424.34 3809.9,-423.57"/>
<polygon fill="black" stroke="black" points="3810,-427.07 3819.99,-423.55 3809.99,-420.07 3810,-427.07"/>
</g>
<!-- layer4_expert2_gpu50&#45;&gt;layer4_gather -->
<g id="edge117" class="edge">
<title>layer4_expert2_gpu50&#45;&gt;layer4_gather</title>
<path fill="none" stroke="black" d="M1346.73,-603.48C1389.9,-594 1440.05,-584.14 1486,-577.95 2358.72,-460.4 3416.23,-432.41 3811.17,-425.89"/>
<polygon fill="black" stroke="black" points="3811.29,-429.39 3821.23,-425.72 3811.18,-422.39 3811.29,-429.39"/>
</g>
<!-- layer4_expert3_gpu51&#45;&gt;layer4_gather -->
<g id="edge119" class="edge">
<title>layer4_expert3_gpu51&#45;&gt;layer4_gather</title>
<path fill="none" stroke="black" d="M1844.4,-603.72C1887.43,-594.33 1937.31,-584.47 1983,-577.95 2162.54,-552.36 3380.77,-465.39 3815.91,-434.75"/>
<polygon fill="black" stroke="black" points="3816.31,-438.23 3826.04,-434.03 3815.82,-431.25 3816.31,-438.23"/>
</g>
<!-- layer4_expert4_gpu52&#45;&gt;layer4_gather -->
<g id="edge121" class="edge">
<title>layer4_expert4_gpu52&#45;&gt;layer4_gather</title>
<path fill="none" stroke="black" d="M2340.74,-603.56C2383.91,-594.09 2434.06,-584.22 2480,-577.95 2770.38,-538.34 2846.37,-563.9 3138,-534.95 3378.22,-511.11 3655.94,-471.64 3822.03,-446.76"/>
<polygon fill="black" stroke="black" points="3822.95,-450.16 3832.32,-445.22 3821.91,-443.24 3822.95,-450.16"/>
</g>
<!-- layer4_expert5_gpu53&#45;&gt;layer4_gather -->
<g id="edge123" class="edge">
<title>layer4_expert5_gpu53&#45;&gt;layer4_gather</title>
<path fill="none" stroke="black" d="M2838.72,-603.72C2881.68,-594.36 2931.43,-584.52 2977,-577.95 3213.11,-543.95 3276.46,-572.72 3512,-534.95 3620.54,-517.55 3741.3,-487.84 3831.56,-463.54"/>
<polygon fill="black" stroke="black" points="3832.56,-466.89 3841.3,-460.9 3830.74,-460.13 3832.56,-466.89"/>
</g>
<!-- layer4_expert6_gpu54&#45;&gt;layer4_gather -->
<g id="edge125" class="edge">
<title>layer4_expert6_gpu54&#45;&gt;layer4_gather</title>
<path fill="none" stroke="black" d="M3341.44,-605.13C3383.21,-596.36 3430.68,-586.54 3474,-577.95 3575.58,-557.81 3603.76,-564.55 3703,-534.95 3749.48,-521.09 3798.92,-501.88 3842.45,-483.33"/>
<polygon fill="black" stroke="black" points="3843.84,-486.55 3851.65,-479.39 3841.08,-480.11 3843.84,-486.55"/>
</g>
<!-- layer4_expert7_gpu55&#45;&gt;layer4_gather -->
<g id="edge127" class="edge">
<title>layer4_expert7_gpu55&#45;&gt;layer4_gather</title>
<path fill="none" stroke="black" d="M3771,-589.25C3802.36,-563.2 3843.98,-528.63 3881.05,-497.84"/>
<polygon fill="black" stroke="black" points="3883.43,-500.41 3888.89,-491.33 3878.96,-495.03 3883.43,-500.41"/>
</g>
<!-- layer4_expert8_gpu56&#45;&gt;layer4_gather -->
<g id="edge129" class="edge">
<title>layer4_expert8_gpu56&#45;&gt;layer4_gather</title>
<path fill="none" stroke="black" d="M4169.81,-589.25C4138.31,-563.2 4096.52,-528.63 4059.31,-497.84"/>
<polygon fill="black" stroke="black" points="4061.38,-495.01 4051.44,-491.33 4056.91,-500.4 4061.38,-495.01"/>
</g>
<!-- layer4_expert9_gpu57&#45;&gt;layer4_gather -->
<g id="edge131" class="edge">
<title>layer4_expert9_gpu57&#45;&gt;layer4_gather</title>
<path fill="none" stroke="black" d="M4613.84,-601.74C4497.01,-569.48 4303.27,-515.98 4158.78,-476.08"/>
<polygon fill="black" stroke="black" points="4159.47,-472.64 4148.89,-473.35 4157.6,-479.39 4159.47,-472.64"/>
</g>
<!-- layer4_expert10_gpu58&#45;&gt;layer4_gather -->
<g id="edge133" class="edge">
<title>layer4_expert10_gpu58&#45;&gt;layer4_gather</title>
<path fill="none" stroke="black" d="M5098.42,-604.6C5056.54,-595.69 5008.71,-585.91 4965,-577.95 4678.14,-525.72 4342.65,-476.17 4143.71,-447.99"/>
<polygon fill="black" stroke="black" points="4144.15,-444.51 4133.75,-446.58 4143.16,-451.44 4144.15,-444.51"/>
</g>
<!-- layer4_expert11_gpu59&#45;&gt;layer4_gather -->
<g id="edge135" class="edge">
<title>layer4_expert11_gpu59&#45;&gt;layer4_gather</title>
<path fill="none" stroke="black" d="M5598.42,-603.98C5555.9,-594.77 5506.88,-584.96 5462,-577.95 4983.88,-503.36 4413.72,-455.91 4137.08,-435.51"/>
<polygon fill="black" stroke="black" points="4137.19,-432.01 4126.96,-434.76 4136.67,-438.99 4137.19,-432.01"/>
</g>
<!-- layer4_expert12_gpu60&#45;&gt;layer4_gather -->
<g id="edge137" class="edge">
<title>layer4_expert12_gpu60&#45;&gt;layer4_gather</title>
<path fill="none" stroke="black" d="M6096.74,-603.64C6053.95,-594.27 6004.4,-584.44 5959,-577.95 5285.87,-481.74 4475.38,-442.52 4134.11,-429.47"/>
<polygon fill="black" stroke="black" points="4134.03,-425.97 4123.9,-429.08 4133.76,-432.96 4134.03,-425.97"/>
</g>
<!-- layer4_expert13_gpu61&#45;&gt;layer4_gather -->
<g id="edge139" class="edge">
<title>layer4_expert13_gpu61&#45;&gt;layer4_gather</title>
<path fill="none" stroke="black" d="M6594.41,-603.41C6551.48,-593.95 6501.67,-584.12 6456,-577.95 5585.02,-460.29 4530.03,-432.39 4132.22,-425.89"/>
<polygon fill="black" stroke="black" points="4132.14,-422.39 4122.09,-425.72 4132.03,-429.38 4132.14,-422.39"/>
</g>
<!-- layer4_expert14_gpu62&#45;&gt;layer4_gather -->
<g id="edge141" class="edge">
<title>layer4_expert14_gpu62&#45;&gt;layer4_gather</title>
<path fill="none" stroke="black" d="M7092.06,-603.3C7049,-593.76 6998.92,-583.92 6953,-577.95 5882.2,-438.9 4579.83,-424.17 4131.02,-423.51"/>
<polygon fill="black" stroke="black" points="4130.9,-420.01 4120.9,-423.5 4130.89,-427.01 4130.9,-420.01"/>
</g>
<!-- layer4_expert15_gpu63&#45;&gt;layer4_gather -->
<g id="edge143" class="edge">
<title>layer4_expert15_gpu63&#45;&gt;layer4_gather</title>
<path fill="none" stroke="black" d="M7589.06,-603.27C7546,-593.74 7495.92,-583.89 7450,-577.95 7066.48,-528.34 6967.3,-551.87 6581,-533.95 5656.25,-491.06 4546.93,-446.66 4134.73,-430.41"/>
<polygon fill="black" stroke="black" points="4134.65,-426.9 4124.52,-430.01 4134.38,-433.9 4134.65,-426.9"/>
</g>
<!-- layer4_residual -->
<g id="node85" class="node">
<title>layer4_residual</title>
<polygon fill="orange" stroke="black" points="3970,-267.95 3817,-214.95 3970,-161.95 4123,-214.95 3970,-267.95"/>
<text text-anchor="middle" x="3970" y="-226.25" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="3970" y="-211.25" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="3970" y="-196.25" font-family="Times,serif" font-size="14.00">Across GPUs 48&#45;63</text>
</g>
<!-- layer4_gather&#45;&gt;layer4_residual -->
<g id="edge144" class="edge">
<title>layer4_gather&#45;&gt;layer4_residual</title>
<path fill="none" stroke="black" d="M3970,-354.79C3970,-330.13 3970,-302.34 3970,-278.14"/>
<polygon fill="black" stroke="black" points="3973.5,-278.01 3970,-268.01 3966.5,-278.01 3973.5,-278.01"/>
</g>
<!-- output -->
<g id="node86" class="node">
<title>output</title>
<ellipse fill="lightcoral" stroke="black" cx="3970" cy="-37.48" rx="145.83" ry="37.45"/>
<text text-anchor="middle" x="3970" y="-48.78" font-family="Times,serif" font-size="14.00">Model Output</text>
<text text-anchor="middle" x="3970" y="-33.78" font-family="Times,serif" font-size="14.00">[1024 tokens, hidden_dim]</text>
<text text-anchor="middle" x="3970" y="-18.78" font-family="Times,serif" font-size="14.00">From GPU 63</text>
</g>
<!-- layer4_residual&#45;&gt;output -->
<g id="edge145" class="edge">
<title>layer4_residual&#45;&gt;output</title>
<path fill="none" stroke="black" d="M3970,-161.78C3970,-137.49 3970,-108.82 3970,-85.25"/>
<polygon fill="black" stroke="black" points="3973.5,-85.15 3970,-75.15 3966.5,-85.15 3973.5,-85.15"/>
</g>
</g>
</svg>
