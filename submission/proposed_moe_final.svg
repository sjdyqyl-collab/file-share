<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: proposed_moe_final Pages: 1 -->
<svg width="3600pt" height="255pt"
 viewBox="0.00 0.00 3600.00 254.94" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.18 0.18) rotate(0) translate(4 1400.29)">
<title>proposed_moe_final</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1400.29 19826.03,-1400.29 19826.03,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="none" stroke="black" cx="2792.51" cy="-1328.29" rx="145.83" ry="37.45"/>
<text text-anchor="middle" x="2792.51" y="-1339.59" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="2792.51" y="-1324.59" font-family="Times,serif" font-size="14.00">[1024 tokens, hidden_dim]</text>
<text text-anchor="middle" x="2792.51" y="-1309.59" font-family="Times,serif" font-size="14.00">Broadcast to 64 GPUs</text>
</g>
<!-- l1_attn -->
<g id="node2" class="node">
<title>l1_attn</title>
<ellipse fill="none" stroke="black" cx="2792.51" cy="-1125.2" rx="145.83" ry="37.45"/>
<text text-anchor="middle" x="2792.51" y="-1136.5" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="2792.51" y="-1121.5" font-family="Times,serif" font-size="14.00">[1024 tokens, hidden_dim]</text>
<text text-anchor="middle" x="2792.51" y="-1106.5" font-family="Times,serif" font-size="14.00">Replicated on GPUs 0&#45;15</text>
</g>
<!-- input&#45;&gt;l1_attn -->
<g id="edge1" class="edge">
<title>input&#45;&gt;l1_attn</title>
<path fill="none" stroke="black" d="M2792.51,-1290.4C2792.51,-1257.38 2792.51,-1208.8 2792.51,-1173.04"/>
<polygon fill="black" stroke="black" points="2796.01,-1172.85 2792.51,-1162.85 2789.01,-1172.85 2796.01,-1172.85"/>
</g>
<!-- l1_gate -->
<g id="node3" class="node">
<title>l1_gate</title>
<polygon fill="none" stroke="black" points="3034.14,-1004.12 2649.77,-1004.12 2550.89,-868.12 2935.26,-868.12 3034.14,-1004.12"/>
<text text-anchor="middle" x="2792.51" y="-954.92" font-family="Times,serif" font-size="14.00">Gate Network</text>
<text text-anchor="middle" x="2792.51" y="-939.92" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="2792.51" y="-924.92" font-family="Times,serif" font-size="14.00">Compute routing probabilities</text>
<text text-anchor="middle" x="2792.51" y="-909.92" font-family="Times,serif" font-size="14.00">GPUs 0&#45;15</text>
</g>
<!-- l1_attn&#45;&gt;l1_gate -->
<g id="edge2" class="edge">
<title>l1_attn&#45;&gt;l1_gate</title>
<path fill="none" stroke="black" d="M2792.51,-1087.69C2792.51,-1066.75 2792.51,-1039.66 2792.51,-1014.23"/>
<polygon fill="black" stroke="black" points="2796.01,-1014.21 2792.51,-1004.21 2789.01,-1014.21 2796.01,-1014.21"/>
</g>
<!-- l1_split -->
<g id="node4" class="node">
<title>l1_split</title>
<polygon fill="none" stroke="black" points="3017.46,-795.12 2659.62,-795.12 2567.56,-689.12 2925.41,-689.12 3017.46,-795.12"/>
<text text-anchor="middle" x="2792.51" y="-753.42" font-family="Times,serif" font-size="14.00">Async Token Split</text>
<text text-anchor="middle" x="2792.51" y="-738.42" font-family="Times,serif" font-size="14.00">[Variable tokens per expert]</text>
<text text-anchor="middle" x="2792.51" y="-723.42" font-family="Times,serif" font-size="14.00">Send to target GPUs</text>
</g>
<!-- l1_gate&#45;&gt;l1_split -->
<g id="edge3" class="edge">
<title>l1_gate&#45;&gt;l1_split</title>
<path fill="none" stroke="black" d="M2792.51,-867.97C2792.51,-847.71 2792.51,-825.56 2792.51,-805.62"/>
<polygon fill="black" stroke="black" points="2796.01,-805.41 2792.51,-795.41 2789.01,-805.41 2796.01,-805.41"/>
</g>
<!-- l1_expert0_gpu0 -->
<g id="node5" class="node">
<title>l1_expert0_gpu0</title>
<ellipse fill="none" stroke="black" cx="160.51" cy="-554.04" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="160.51" y="-572.84" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="160.51" y="-557.84" font-family="Times,serif" font-size="14.00">GPU 0</text>
<text text-anchor="middle" x="160.51" y="-542.84" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="160.51" y="-527.84" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l1_split&#45;&gt;l1_expert0_gpu0 -->
<g id="edge4" class="edge">
<title>l1_split&#45;&gt;l1_expert0_gpu0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2609.75,-737.78C2253.99,-730.26 1443.77,-708.15 764.51,-653.12 573.13,-637.61 524.05,-638.49 335.51,-602.12 318.73,-598.88 301.18,-594.9 283.96,-590.63"/>
<polygon fill="black" stroke="black" points="284.42,-587.13 273.86,-588.09 282.71,-593.92 284.42,-587.13"/>
<text text-anchor="middle" x="849.01" y="-641.92" font-family="Times,serif" font-size="14.00">tokens routed to GPU 0</text>
</g>
<!-- l1_expert1_gpu1 -->
<g id="node6" class="node">
<title>l1_expert1_gpu1</title>
<ellipse fill="none" stroke="black" cx="510.51" cy="-554.04" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="510.51" y="-572.84" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="510.51" y="-557.84" font-family="Times,serif" font-size="14.00">GPU 1</text>
<text text-anchor="middle" x="510.51" y="-542.84" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="510.51" y="-527.84" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l1_split&#45;&gt;l1_expert1_gpu1 -->
<g id="edge5" class="edge">
<title>l1_split&#45;&gt;l1_expert1_gpu1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2607.33,-735.18C2299.09,-724.44 1661.47,-698.58 1123.51,-653.12 928.23,-636.62 877.99,-639.01 685.51,-602.12 668.72,-598.9 651.18,-594.93 633.95,-590.67"/>
<polygon fill="black" stroke="black" points="634.41,-587.17 623.86,-588.13 632.7,-593.96 634.41,-587.17"/>
<text text-anchor="middle" x="1208.01" y="-641.92" font-family="Times,serif" font-size="14.00">tokens routed to GPU 1</text>
</g>
<!-- l1_expert2_gpu2 -->
<g id="node7" class="node">
<title>l1_expert2_gpu2</title>
<ellipse fill="none" stroke="black" cx="860.51" cy="-554.04" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="860.51" y="-572.84" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="860.51" y="-557.84" font-family="Times,serif" font-size="14.00">GPU 2</text>
<text text-anchor="middle" x="860.51" y="-542.84" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="860.51" y="-527.84" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l1_split&#45;&gt;l1_expert2_gpu2 -->
<g id="edge6" class="edge">
<title>l1_split&#45;&gt;l1_expert2_gpu2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2604.31,-731.46C2348.35,-717.66 1876.31,-689.85 1474.51,-653.12 1278.91,-635.24 1228.43,-639.07 1035.51,-602.12 1018.72,-598.9 1001.18,-594.93 983.95,-590.67"/>
<polygon fill="black" stroke="black" points="984.41,-587.18 973.85,-588.13 982.7,-593.96 984.41,-587.18"/>
<text text-anchor="middle" x="1559.01" y="-641.92" font-family="Times,serif" font-size="14.00">tokens routed to GPU 2</text>
</g>
<!-- l1_expert3_gpu3 -->
<g id="node8" class="node">
<title>l1_expert3_gpu3</title>
<ellipse fill="none" stroke="black" cx="1210.51" cy="-554.04" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="1210.51" y="-572.84" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1210.51" y="-557.84" font-family="Times,serif" font-size="14.00">GPU 3</text>
<text text-anchor="middle" x="1210.51" y="-542.84" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="1210.51" y="-527.84" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l1_split&#45;&gt;l1_expert3_gpu3 -->
<g id="edge7" class="edge">
<title>l1_split&#45;&gt;l1_expert3_gpu3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2599.98,-726.55C2270.74,-700.89 1613.09,-646.19 1385.51,-602.12 1368.86,-598.89 1351.46,-594.94 1334.36,-590.71"/>
<polygon fill="black" stroke="black" points="1334.89,-587.23 1324.34,-588.18 1333.18,-594.02 1334.89,-587.23"/>
<text text-anchor="middle" x="1838.01" y="-641.92" font-family="Times,serif" font-size="14.00">tokens routed to GPU 3</text>
</g>
<!-- l1_expert4_gpu4 -->
<g id="node9" class="node">
<title>l1_expert4_gpu4</title>
<ellipse fill="none" stroke="black" cx="1560.51" cy="-554.04" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="1560.51" y="-572.84" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1560.51" y="-557.84" font-family="Times,serif" font-size="14.00">GPU 4</text>
<text text-anchor="middle" x="1560.51" y="-542.84" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="1560.51" y="-527.84" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l1_split&#45;&gt;l1_expert4_gpu4 -->
<g id="edge8" class="edge">
<title>l1_split&#45;&gt;l1_expert4_gpu4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2591.9,-717.48C2449.62,-700.42 2254.21,-676.38 2082.51,-653.12 2063.2,-650.5 1754.59,-606.07 1735.51,-602.12 1719.03,-598.7 1701.8,-594.66 1684.84,-590.4"/>
<polygon fill="black" stroke="black" points="1685.45,-586.94 1674.9,-587.87 1683.72,-593.73 1685.45,-586.94"/>
<text text-anchor="middle" x="2167.01" y="-641.92" font-family="Times,serif" font-size="14.00">tokens routed to GPU 4</text>
</g>
<!-- l1_expert5_gpu5 -->
<g id="node10" class="node">
<title>l1_expert5_gpu5</title>
<ellipse fill="none" stroke="black" cx="1910.51" cy="-554.04" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="1910.51" y="-572.84" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1910.51" y="-557.84" font-family="Times,serif" font-size="14.00">GPU 5</text>
<text text-anchor="middle" x="1910.51" y="-542.84" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="1910.51" y="-527.84" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l1_split&#45;&gt;l1_expert5_gpu5 -->
<g id="edge9" class="edge">
<title>l1_split&#45;&gt;l1_expert5_gpu5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2578.43,-701.85C2498.92,-686.99 2408.03,-669.66 2325.51,-653.12 2312.15,-650.44 2098.77,-605.31 2085.51,-602.12 2069.81,-598.34 2053.36,-594.18 2037.11,-589.95"/>
<polygon fill="black" stroke="black" points="2037.58,-586.46 2027.02,-587.31 2035.8,-593.23 2037.58,-586.46"/>
<text text-anchor="middle" x="2410.01" y="-641.92" font-family="Times,serif" font-size="14.00">tokens routed to GPU 5</text>
</g>
<!-- l1_expert6_gpu6 -->
<g id="node11" class="node">
<title>l1_expert6_gpu6</title>
<ellipse fill="none" stroke="black" cx="2260.51" cy="-554.04" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="2260.51" y="-572.84" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="2260.51" y="-557.84" font-family="Times,serif" font-size="14.00">GPU 6</text>
<text text-anchor="middle" x="2260.51" y="-542.84" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="2260.51" y="-527.84" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l1_split&#45;&gt;l1_expert6_gpu6 -->
<g id="edge10" class="edge">
<title>l1_split&#45;&gt;l1_expert6_gpu6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2641.7,-689.03C2607.75,-677.26 2571.88,-664.79 2538.51,-653.12 2483.82,-634 2423.14,-612.61 2372.46,-594.7"/>
<polygon fill="black" stroke="black" points="2373.38,-591.31 2362.79,-591.28 2371.05,-597.91 2373.38,-591.31"/>
<text text-anchor="middle" x="2623.01" y="-641.92" font-family="Times,serif" font-size="14.00">tokens routed to GPU 6</text>
</g>
<!-- l1_expert7_gpu7 -->
<g id="node12" class="node">
<title>l1_expert7_gpu7</title>
<ellipse fill="none" stroke="black" cx="2610.51" cy="-554.04" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="2610.51" y="-572.84" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2610.51" y="-557.84" font-family="Times,serif" font-size="14.00">GPU 7</text>
<text text-anchor="middle" x="2610.51" y="-542.84" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="2610.51" y="-527.84" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l1_split&#45;&gt;l1_expert7_gpu7 -->
<g id="edge11" class="edge">
<title>l1_split&#45;&gt;l1_expert7_gpu7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2757,-689.05C2744.42,-672.07 2729.62,-653.62 2714.51,-638.12 2703.43,-626.74 2690.8,-615.49 2678.25,-605.11"/>
<polygon fill="black" stroke="black" points="2680.43,-602.36 2670.47,-598.76 2676.01,-607.79 2680.43,-602.36"/>
<text text-anchor="middle" x="2811.01" y="-641.92" font-family="Times,serif" font-size="14.00">tokens routed to GPU 7</text>
</g>
<!-- l1_expert8_gpu8 -->
<g id="node13" class="node">
<title>l1_expert8_gpu8</title>
<ellipse fill="none" stroke="black" cx="2960.51" cy="-554.04" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="2960.51" y="-572.84" font-family="Times,serif" font-size="14.00">Expert 8</text>
<text text-anchor="middle" x="2960.51" y="-557.84" font-family="Times,serif" font-size="14.00">GPU 8</text>
<text text-anchor="middle" x="2960.51" y="-542.84" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="2960.51" y="-527.84" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l1_split&#45;&gt;l1_expert8_gpu8 -->
<g id="edge12" class="edge">
<title>l1_split&#45;&gt;l1_expert8_gpu8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2888.33,-688.87C2902.1,-678.37 2915.1,-666.42 2925.51,-653.12 2934.93,-641.09 2941.95,-626.32 2947.12,-611.92"/>
<polygon fill="black" stroke="black" points="2950.57,-612.65 2950.41,-602.05 2943.93,-610.43 2950.57,-612.65"/>
<text text-anchor="middle" x="3020.01" y="-641.92" font-family="Times,serif" font-size="14.00">tokens routed to GPU 8</text>
</g>
<!-- l1_expert9_gpu9 -->
<g id="node14" class="node">
<title>l1_expert9_gpu9</title>
<ellipse fill="none" stroke="black" cx="3310.51" cy="-554.04" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="3310.51" y="-572.84" font-family="Times,serif" font-size="14.00">Expert 9</text>
<text text-anchor="middle" x="3310.51" y="-557.84" font-family="Times,serif" font-size="14.00">GPU 9</text>
<text text-anchor="middle" x="3310.51" y="-542.84" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="3310.51" y="-527.84" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l1_split&#45;&gt;l1_expert9_gpu9 -->
<g id="edge13" class="edge">
<title>l1_split&#45;&gt;l1_expert9_gpu9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2940.88,-706.41C2995.28,-692.07 3056.88,-673.91 3111.51,-653.12 3149.85,-638.54 3190.72,-619.11 3225.39,-601.4"/>
<polygon fill="black" stroke="black" points="3227.24,-604.39 3234.53,-596.7 3224.04,-598.16 3227.24,-604.39"/>
<text text-anchor="middle" x="3230.01" y="-641.92" font-family="Times,serif" font-size="14.00">tokens routed to GPU 9</text>
</g>
<!-- l1_expert10_gpu10 -->
<g id="node15" class="node">
<title>l1_expert10_gpu10</title>
<ellipse fill="none" stroke="black" cx="3660.51" cy="-554.04" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="3660.51" y="-572.84" font-family="Times,serif" font-size="14.00">Expert 10</text>
<text text-anchor="middle" x="3660.51" y="-557.84" font-family="Times,serif" font-size="14.00">GPU 10</text>
<text text-anchor="middle" x="3660.51" y="-542.84" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="3660.51" y="-527.84" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l1_split&#45;&gt;l1_expert10_gpu10 -->
<g id="edge14" class="edge">
<title>l1_split&#45;&gt;l1_expert10_gpu10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2952.02,-719.55C3057.5,-704.07 3198.49,-681.05 3321.51,-653.12 3395.82,-636.25 3477.93,-612.62 3542.74,-592.79"/>
<polygon fill="black" stroke="black" points="3544.04,-596.05 3552.57,-589.76 3541.99,-589.35 3544.04,-596.05"/>
<text text-anchor="middle" x="3467.51" y="-641.92" font-family="Times,serif" font-size="14.00">tokens routed to GPU 10</text>
</g>
<!-- l1_expert11_gpu11 -->
<g id="node16" class="node">
<title>l1_expert11_gpu11</title>
<ellipse fill="none" stroke="black" cx="4010.51" cy="-554.04" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="4010.51" y="-572.84" font-family="Times,serif" font-size="14.00">Expert 11</text>
<text text-anchor="middle" x="4010.51" y="-557.84" font-family="Times,serif" font-size="14.00">GPU 11</text>
<text text-anchor="middle" x="4010.51" y="-542.84" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="4010.51" y="-527.84" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l1_split&#45;&gt;l1_expert11_gpu11 -->
<g id="edge15" class="edge">
<title>l1_split&#45;&gt;l1_expert11_gpu11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2959.93,-728.32C3167.36,-710.29 3530.72,-671.59 3835.51,-602.12 3851.67,-598.44 3868.58,-594.28 3885.26,-589.99"/>
<polygon fill="black" stroke="black" points="3886.24,-593.35 3895.04,-587.46 3884.49,-586.58 3886.24,-593.35"/>
<text text-anchor="middle" x="3727.51" y="-641.92" font-family="Times,serif" font-size="14.00">tokens routed to GPU 11</text>
</g>
<!-- l1_expert12_gpu12 -->
<g id="node17" class="node">
<title>l1_expert12_gpu12</title>
<ellipse fill="none" stroke="black" cx="4360.51" cy="-554.04" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="4360.51" y="-572.84" font-family="Times,serif" font-size="14.00">Expert 12</text>
<text text-anchor="middle" x="4360.51" y="-557.84" font-family="Times,serif" font-size="14.00">GPU 12</text>
<text text-anchor="middle" x="4360.51" y="-542.84" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="4360.51" y="-527.84" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l1_split&#45;&gt;l1_expert12_gpu12 -->
<g id="edge16" class="edge">
<title>l1_split&#45;&gt;l1_expert12_gpu12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2965.49,-735.18C3230.53,-723.55 3751.97,-690.63 4185.51,-602.12 4202.01,-598.75 4219.25,-594.74 4236.21,-590.49"/>
<polygon fill="black" stroke="black" points="4237.32,-593.82 4246.15,-587.97 4235.6,-587.03 4237.32,-593.82"/>
<text text-anchor="middle" x="4049.51" y="-641.92" font-family="Times,serif" font-size="14.00">tokens routed to GPU 12</text>
</g>
<!-- l1_expert13_gpu13 -->
<g id="node18" class="node">
<title>l1_expert13_gpu13</title>
<ellipse fill="none" stroke="black" cx="4710.51" cy="-554.04" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="4710.51" y="-572.84" font-family="Times,serif" font-size="14.00">Expert 13</text>
<text text-anchor="middle" x="4710.51" y="-557.84" font-family="Times,serif" font-size="14.00">GPU 13</text>
<text text-anchor="middle" x="4710.51" y="-542.84" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="4710.51" y="-527.84" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l1_split&#45;&gt;l1_expert13_gpu13 -->
<g id="edge17" class="edge">
<title>l1_split&#45;&gt;l1_expert13_gpu13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2964.2,-733.54C3221.39,-721.37 3721.77,-694.56 4145.51,-653.12 4319.49,-636.1 4364.07,-636.24 4535.51,-602.12 4552.15,-598.81 4569.54,-594.8 4586.63,-590.54"/>
<polygon fill="black" stroke="black" points="4587.82,-593.86 4596.65,-588.01 4586.1,-587.07 4587.82,-593.86"/>
<text text-anchor="middle" x="4391.51" y="-641.92" font-family="Times,serif" font-size="14.00">tokens routed to GPU 13</text>
</g>
<!-- l1_expert14_gpu14 -->
<g id="node19" class="node">
<title>l1_expert14_gpu14</title>
<ellipse fill="none" stroke="black" cx="5060.51" cy="-554.04" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="5060.51" y="-572.84" font-family="Times,serif" font-size="14.00">Expert 14</text>
<text text-anchor="middle" x="5060.51" y="-557.84" font-family="Times,serif" font-size="14.00">GPU 14</text>
<text text-anchor="middle" x="5060.51" y="-542.84" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="5060.51" y="-527.84" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l1_split&#45;&gt;l1_expert14_gpu14 -->
<g id="edge18" class="edge">
<title>l1_split&#45;&gt;l1_expert14_gpu14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2966.67,-736.42C3274.17,-727.15 3933.2,-702.95 4487.51,-653.12 4665.13,-637.15 4710.56,-636.7 4885.51,-602.12 4902.16,-598.83 4919.55,-594.84 4936.64,-590.58"/>
<polygon fill="black" stroke="black" points="4937.82,-593.9 4946.66,-588.05 4936.11,-587.11 4937.82,-593.9"/>
<text text-anchor="middle" x="4743.51" y="-641.92" font-family="Times,serif" font-size="14.00">tokens routed to GPU 14</text>
</g>
<!-- l1_expert15_gpu15 -->
<g id="node20" class="node">
<title>l1_expert15_gpu15</title>
<ellipse fill="none" stroke="black" cx="5410.51" cy="-554.04" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="5410.51" y="-572.84" font-family="Times,serif" font-size="14.00">Expert 15</text>
<text text-anchor="middle" x="5410.51" y="-557.84" font-family="Times,serif" font-size="14.00">GPU 15</text>
<text text-anchor="middle" x="5410.51" y="-542.84" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="5410.51" y="-527.84" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l1_split&#45;&gt;l1_expert15_gpu15 -->
<g id="edge19" class="edge">
<title>l1_split&#45;&gt;l1_expert15_gpu15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2968.42,-738.6C3322.99,-732.4 4148.64,-712.35 4839.51,-653.12 5016.32,-637.96 5061.44,-636.58 5235.51,-602.12 5252.15,-598.83 5269.55,-594.83 5286.64,-590.58"/>
<polygon fill="black" stroke="black" points="5287.82,-593.89 5296.66,-588.04 5286.11,-587.1 5287.82,-593.89"/>
<text text-anchor="middle" x="5094.51" y="-641.92" font-family="Times,serif" font-size="14.00">tokens routed to GPU 15</text>
</g>
<!-- l1_gather -->
<g id="node21" class="node">
<title>l1_gather</title>
<polygon fill="none" stroke="black" points="2977.11,-432.95 2672.32,-432.95 2593.91,-326.95 2898.71,-326.95 2977.11,-432.95"/>
<text text-anchor="middle" x="2785.51" y="-391.25" font-family="Times,serif" font-size="14.00">Async All&#45;Gather</text>
<text text-anchor="middle" x="2785.51" y="-376.25" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="2785.51" y="-361.25" font-family="Times,serif" font-size="14.00">Collect from GPUs 0&#45;15</text>
</g>
<!-- l1_expert0_gpu0&#45;&gt;l1_gather -->
<g id="edge20" class="edge">
<title>l1_expert0_gpu0&#45;&gt;l1_gather</title>
<path fill="none" stroke="black" d="M271.78,-519.33C292.78,-514.04 314.69,-509.25 335.51,-505.95 779.2,-435.76 2155.18,-396.37 2625.78,-384.68"/>
<polygon fill="black" stroke="black" points="2626.14,-388.18 2636.05,-384.43 2625.97,-381.18 2626.14,-388.18"/>
</g>
<!-- l1_expert1_gpu1&#45;&gt;l1_gather -->
<g id="edge21" class="edge">
<title>l1_expert1_gpu1&#45;&gt;l1_gather</title>
<path fill="none" stroke="black" d="M622.28,-519.4C643.14,-514.15 664.87,-509.34 685.51,-505.95 945.22,-463.33 1013.81,-484.84 1276.51,-468.95 1770.72,-439.07 2356.09,-405.44 2629.83,-389.81"/>
<polygon fill="black" stroke="black" points="2630.05,-393.31 2639.83,-389.24 2629.65,-386.32 2630.05,-393.31"/>
</g>
<!-- l1_expert2_gpu2&#45;&gt;l1_gather -->
<g id="edge22" class="edge">
<title>l1_expert2_gpu2&#45;&gt;l1_gather</title>
<path fill="none" stroke="black" d="M972.78,-519.43C993.49,-514.21 1015.04,-509.41 1035.51,-505.95 1614.62,-408.29 2314.1,-386.83 2624.13,-382.19"/>
<polygon fill="black" stroke="black" points="2624.6,-385.68 2634.54,-382.04 2624.49,-378.69 2624.6,-385.68"/>
</g>
<!-- l1_expert3_gpu3&#45;&gt;l1_gather -->
<g id="edge23" class="edge">
<title>l1_expert3_gpu3&#45;&gt;l1_gather</title>
<path fill="none" stroke="black" d="M1323.3,-519.61C1343.86,-514.4 1365.22,-509.56 1385.51,-505.95 1831.24,-426.71 2366.19,-396.68 2626.96,-386.14"/>
<polygon fill="black" stroke="black" points="2627.41,-389.63 2637.26,-385.73 2627.13,-382.63 2627.41,-389.63"/>
</g>
<!-- l1_expert4_gpu4&#45;&gt;l1_gather -->
<g id="edge24" class="edge">
<title>l1_expert4_gpu4&#45;&gt;l1_gather</title>
<path fill="none" stroke="black" d="M1673.86,-519.99C1694.27,-514.77 1715.43,-509.83 1735.51,-505.95 2050.81,-445.1 2425.46,-409.05 2631.14,-392.31"/>
<polygon fill="black" stroke="black" points="2631.73,-395.78 2641.41,-391.48 2631.16,-388.8 2631.73,-395.78"/>
</g>
<!-- l1_expert5_gpu5&#45;&gt;l1_gather -->
<g id="edge25" class="edge">
<title>l1_expert5_gpu5&#45;&gt;l1_gather</title>
<path fill="none" stroke="black" d="M2025.95,-520.47C2045.75,-515.32 2066.17,-510.27 2085.51,-505.95 2275.38,-463.54 2496.76,-425.98 2638.9,-403.36"/>
<polygon fill="black" stroke="black" points="2639.66,-406.79 2648.99,-401.76 2638.57,-399.87 2639.66,-406.79"/>
</g>
<!-- l1_expert6_gpu6&#45;&gt;l1_gather -->
<g id="edge26" class="edge">
<title>l1_expert6_gpu6&#45;&gt;l1_gather</title>
<path fill="none" stroke="black" d="M2367.39,-518.01C2450.12,-490.89 2565.13,-453.19 2653.59,-424.19"/>
<polygon fill="black" stroke="black" points="2654.74,-427.5 2663.15,-421.06 2652.56,-420.85 2654.74,-427.5"/>
</g>
<!-- l1_expert7_gpu7&#45;&gt;l1_gather -->
<g id="edge27" class="edge">
<title>l1_expert7_gpu7&#45;&gt;l1_gather</title>
<path fill="none" stroke="black" d="M2656.49,-507.82C2677.51,-487.16 2702.69,-462.4 2725.2,-440.26"/>
<polygon fill="black" stroke="black" points="2727.73,-442.68 2732.41,-433.18 2722.82,-437.69 2727.73,-442.68"/>
</g>
<!-- l1_expert8_gpu8&#45;&gt;l1_gather -->
<g id="edge28" class="edge">
<title>l1_expert8_gpu8&#45;&gt;l1_gather</title>
<path fill="none" stroke="black" d="M2914.53,-507.82C2893.52,-487.16 2868.34,-462.4 2845.83,-440.26"/>
<polygon fill="black" stroke="black" points="2848.2,-437.69 2838.62,-433.18 2843.3,-442.68 2848.2,-437.69"/>
</g>
<!-- l1_expert9_gpu9&#45;&gt;l1_gather -->
<g id="edge29" class="edge">
<title>l1_expert9_gpu9&#45;&gt;l1_gather</title>
<path fill="none" stroke="black" d="M3203.64,-518.01C3131.97,-494.52 3036.09,-463.09 2954.22,-436.25"/>
<polygon fill="black" stroke="black" points="2954.9,-432.79 2944.31,-433 2952.72,-439.44 2954.9,-432.79"/>
</g>
<!-- l1_expert10_gpu10&#45;&gt;l1_gather -->
<g id="edge30" class="edge">
<title>l1_expert10_gpu10&#45;&gt;l1_gather</title>
<path fill="none" stroke="black" d="M3545.08,-520.47C3525.28,-515.32 3504.86,-510.27 3485.51,-505.95 3311.23,-467.02 3110.41,-432.18 2968.68,-409.23"/>
<polygon fill="black" stroke="black" points="2969.01,-405.74 2958.58,-407.6 2967.9,-412.65 2969.01,-405.74"/>
</g>
<!-- l1_expert11_gpu11&#45;&gt;l1_gather -->
<g id="edge31" class="edge">
<title>l1_expert11_gpu11&#45;&gt;l1_gather</title>
<path fill="none" stroke="black" d="M3897.16,-519.99C3876.76,-514.77 3855.59,-509.83 3835.51,-505.95 3529.14,-446.82 3166.75,-411.11 2957.77,-393.78"/>
<polygon fill="black" stroke="black" points="2957.88,-390.28 2947.62,-392.95 2957.3,-397.26 2957.88,-390.28"/>
</g>
<!-- l1_expert12_gpu12&#45;&gt;l1_gather -->
<g id="edge32" class="edge">
<title>l1_expert12_gpu12&#45;&gt;l1_gather</title>
<path fill="none" stroke="black" d="M4247.73,-519.61C4227.17,-514.4 4205.8,-509.56 4185.51,-505.95 3744.61,-427.57 3216.4,-397.33 2952.63,-386.49"/>
<polygon fill="black" stroke="black" points="2952.72,-382.99 2942.58,-386.08 2952.43,-389.99 2952.72,-382.99"/>
</g>
<!-- l1_expert13_gpu13&#45;&gt;l1_gather -->
<g id="edge33" class="edge">
<title>l1_expert13_gpu13&#45;&gt;l1_gather</title>
<path fill="none" stroke="black" d="M4598.25,-519.43C4577.54,-514.21 4555.99,-509.41 4535.51,-505.95 3958.16,-408.59 3261.17,-386.97 2949.73,-382.23"/>
<polygon fill="black" stroke="black" points="2949.77,-378.73 2939.72,-382.09 2949.67,-385.73 2949.77,-378.73"/>
</g>
<!-- l1_expert14_gpu14&#45;&gt;l1_gather -->
<g id="edge34" class="edge">
<title>l1_expert14_gpu14&#45;&gt;l1_gather</title>
<path fill="none" stroke="black" d="M4948.74,-519.43C4927.88,-514.17 4906.16,-509.36 4885.51,-505.95 4632.85,-464.26 4566.12,-484.55 4310.51,-468.95 3818.62,-438.93 3237.29,-406.13 2955.56,-390.4"/>
<polygon fill="black" stroke="black" points="2955.44,-386.89 2945.26,-389.82 2955.05,-393.87 2955.44,-386.89"/>
</g>
<!-- l1_expert15_gpu15&#45;&gt;l1_gather -->
<g id="edge35" class="edge">
<title>l1_expert15_gpu15&#45;&gt;l1_gather</title>
<path fill="none" stroke="black" d="M5299.25,-519.33C5278.24,-514.04 5256.33,-509.25 5235.51,-505.95 4793.81,-436.08 3428.11,-396.73 2951.6,-384.84"/>
<polygon fill="black" stroke="black" points="2951.62,-381.34 2941.54,-384.59 2951.45,-388.34 2951.62,-381.34"/>
</g>
<!-- l1_residual -->
<g id="node22" class="node">
<title>l1_residual</title>
<polygon fill="none" stroke="black" points="2785.51,-253.95 2641.51,-200.95 2785.51,-147.95 2929.51,-200.95 2785.51,-253.95"/>
<text text-anchor="middle" x="2785.51" y="-212.25" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="2785.51" y="-197.25" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="2785.51" y="-182.25" font-family="Times,serif" font-size="14.00">Across GPUs 0&#45;15</text>
</g>
<!-- l1_gather&#45;&gt;l1_residual -->
<g id="edge36" class="edge">
<title>l1_gather&#45;&gt;l1_residual</title>
<path fill="none" stroke="black" d="M2785.51,-326.8C2785.51,-307.18 2785.51,-284.66 2785.51,-264.2"/>
<polygon fill="black" stroke="black" points="2789.01,-264.03 2785.51,-254.03 2782.01,-264.03 2789.01,-264.03"/>
</g>
<!-- l2_attn -->
<g id="node23" class="node">
<title>l2_attn</title>
<ellipse fill="none" stroke="black" cx="2785.51" cy="-37.48" rx="145.83" ry="37.45"/>
<text text-anchor="middle" x="2785.51" y="-48.78" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="2785.51" y="-33.78" font-family="Times,serif" font-size="14.00">[1024 tokens, hidden_dim]</text>
<text text-anchor="middle" x="2785.51" y="-18.78" font-family="Times,serif" font-size="14.00">Replicated on GPUs 16&#45;31</text>
</g>
<!-- l1_residual&#45;&gt;l2_attn -->
<g id="edge37" class="edge">
<title>l1_residual&#45;&gt;l2_attn</title>
<path fill="none" stroke="black" d="M2785.51,-147.53C2785.51,-127.54 2785.51,-104.91 2785.51,-85.46"/>
<polygon fill="black" stroke="black" points="2789.01,-85.32 2785.51,-75.32 2782.01,-85.32 2789.01,-85.32"/>
</g>
<!-- l2_gate -->
<g id="node24" class="node">
<title>l2_gate</title>
<polygon fill="none" stroke="black" points="4645.14,-1396.29 4260.77,-1396.29 4161.89,-1260.29 4546.26,-1260.29 4645.14,-1396.29"/>
<text text-anchor="middle" x="4403.51" y="-1347.09" font-family="Times,serif" font-size="14.00">Gate Network</text>
<text text-anchor="middle" x="4403.51" y="-1332.09" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="4403.51" y="-1317.09" font-family="Times,serif" font-size="14.00">Compute routing probabilities</text>
<text text-anchor="middle" x="4403.51" y="-1302.09" font-family="Times,serif" font-size="14.00">GPUs 16&#45;31</text>
</g>
<!-- l2_split -->
<g id="node25" class="node">
<title>l2_split</title>
<polygon fill="none" stroke="black" points="6060.46,-1381.29 5702.62,-1381.29 5610.56,-1275.29 5968.41,-1275.29 6060.46,-1381.29"/>
<text text-anchor="middle" x="5835.51" y="-1339.59" font-family="Times,serif" font-size="14.00">Async Token Split</text>
<text text-anchor="middle" x="5835.51" y="-1324.59" font-family="Times,serif" font-size="14.00">[Variable tokens per expert]</text>
<text text-anchor="middle" x="5835.51" y="-1309.59" font-family="Times,serif" font-size="14.00">Send to target GPUs</text>
</g>
<!-- l2_expert0_gpu16 -->
<g id="node26" class="node">
<title>l2_expert0_gpu16</title>
<ellipse fill="none" stroke="black" cx="3211.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="3211.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 16</text>
<text text-anchor="middle" x="3211.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 16</text>
<text text-anchor="middle" x="3211.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="3211.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l2_split&#45;&gt;l2_expert0_gpu16 -->
<g id="edge38" class="edge">
<title>l2_split&#45;&gt;l2_expert0_gpu16</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5645.37,-1315.56C5412.88,-1301.43 5007.38,-1277.44 4659.51,-1260.29 4275.65,-1241.36 4178.53,-1256.09 3795.51,-1224.29 3612.96,-1209.13 3566.28,-1208.5 3386.51,-1173.29 3369.87,-1170.03 3352.47,-1166.05 3335.37,-1161.8"/>
<polygon fill="black" stroke="black" points="3335.9,-1158.33 3325.35,-1159.28 3334.19,-1165.12 3335.9,-1158.33"/>
<text text-anchor="middle" x="3884.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 16</text>
</g>
<!-- l2_expert1_gpu17 -->
<g id="node27" class="node">
<title>l2_expert1_gpu17</title>
<ellipse fill="none" stroke="black" cx="3561.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="3561.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 17</text>
<text text-anchor="middle" x="3561.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 17</text>
<text text-anchor="middle" x="3561.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="3561.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l2_split&#45;&gt;l2_expert1_gpu17 -->
<g id="edge39" class="edge">
<title>l2_split&#45;&gt;l2_expert1_gpu17</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5646,-1316.44C5235.58,-1292.84 4289.66,-1237.88 4143.51,-1224.29 3961.99,-1207.41 3915.41,-1208.39 3736.51,-1173.29 3719.87,-1170.02 3702.47,-1166.04 3685.38,-1161.79"/>
<polygon fill="black" stroke="black" points="3685.91,-1158.32 3675.35,-1159.27 3684.19,-1165.11 3685.91,-1158.32"/>
<text text-anchor="middle" x="4232.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 17</text>
</g>
<!-- l2_expert2_gpu18 -->
<g id="node28" class="node">
<title>l2_expert2_gpu18</title>
<ellipse fill="none" stroke="black" cx="3911.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="3911.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 18</text>
<text text-anchor="middle" x="3911.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 18</text>
<text text-anchor="middle" x="3911.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="3911.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l2_split&#45;&gt;l2_expert2_gpu18 -->
<g id="edge40" class="edge">
<title>l2_split&#45;&gt;l2_expert2_gpu18</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5645.88,-1316.11C5383.27,-1299.9 4894.22,-1267.07 4478.51,-1224.29 4303.75,-1206.3 4258.84,-1207.52 4086.51,-1173.29 4069.87,-1169.98 4052.48,-1165.98 4035.39,-1161.72"/>
<polygon fill="black" stroke="black" points="4035.92,-1158.25 4025.37,-1159.19 4034.21,-1165.03 4035.92,-1158.25"/>
<text text-anchor="middle" x="4567.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 18</text>
</g>
<!-- l2_expert3_gpu19 -->
<g id="node29" class="node">
<title>l2_expert3_gpu19</title>
<ellipse fill="none" stroke="black" cx="4261.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="4261.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 19</text>
<text text-anchor="middle" x="4261.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 19</text>
<text text-anchor="middle" x="4261.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="4261.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l2_split&#45;&gt;l2_expert3_gpu19 -->
<g id="edge41" class="edge">
<title>l2_split&#45;&gt;l2_expert3_gpu19</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5647.14,-1317.5C5376.88,-1301 4864.49,-1260.49 4436.51,-1173.29 4420.02,-1169.93 4402.78,-1165.91 4385.82,-1161.67"/>
<polygon fill="black" stroke="black" points="4386.43,-1158.21 4375.87,-1159.15 4384.71,-1165 4386.43,-1158.21"/>
<text text-anchor="middle" x="4790.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 19</text>
</g>
<!-- l2_expert4_gpu20 -->
<g id="node30" class="node">
<title>l2_expert4_gpu20</title>
<ellipse fill="none" stroke="black" cx="4611.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="4611.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 20</text>
<text text-anchor="middle" x="4611.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 20</text>
<text text-anchor="middle" x="4611.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="4611.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l2_split&#45;&gt;l2_expert4_gpu20 -->
<g id="edge42" class="edge">
<title>l2_split&#45;&gt;l2_expert4_gpu20</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5638.16,-1307.2C5426.11,-1283.55 5079.97,-1238.99 4786.51,-1173.29 4770.34,-1169.67 4753.42,-1165.54 4736.74,-1161.28"/>
<polygon fill="black" stroke="black" points="4737.51,-1157.86 4726.95,-1158.75 4735.76,-1164.64 4737.51,-1157.86"/>
<text text-anchor="middle" x="5132.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 20</text>
</g>
<!-- l2_expert5_gpu21 -->
<g id="node31" class="node">
<title>l2_expert5_gpu21</title>
<ellipse fill="none" stroke="black" cx="4961.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="4961.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 21</text>
<text text-anchor="middle" x="4961.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 21</text>
<text text-anchor="middle" x="4961.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="4961.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l2_split&#45;&gt;l2_expert5_gpu21 -->
<g id="edge43" class="edge">
<title>l2_split&#45;&gt;l2_expert5_gpu21</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5622.54,-1289.24C5527.32,-1271.23 5413.91,-1248.4 5312.51,-1224.29 5235.66,-1206.01 5150.27,-1182.23 5082.96,-1162.66"/>
<polygon fill="black" stroke="black" points="5083.75,-1159.24 5073.17,-1159.81 5081.79,-1165.96 5083.75,-1159.24"/>
<text text-anchor="middle" x="5401.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 21</text>
</g>
<!-- l2_expert6_gpu22 -->
<g id="node32" class="node">
<title>l2_expert6_gpu22</title>
<ellipse fill="none" stroke="black" cx="5311.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="5311.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 22</text>
<text text-anchor="middle" x="5311.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 22</text>
<text text-anchor="middle" x="5311.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="5311.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l2_split&#45;&gt;l2_expert6_gpu22 -->
<g id="edge44" class="edge">
<title>l2_split&#45;&gt;l2_expert6_gpu22</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5674.31,-1275.21C5628.51,-1259.63 5578.79,-1241.97 5533.51,-1224.29 5491.27,-1207.79 5445.31,-1187.83 5406.23,-1170.23"/>
<polygon fill="black" stroke="black" points="5407.52,-1166.97 5396.96,-1166.05 5404.64,-1173.35 5407.52,-1166.97"/>
<text text-anchor="middle" x="5622.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 22</text>
</g>
<!-- l2_expert7_gpu23 -->
<g id="node33" class="node">
<title>l2_expert7_gpu23</title>
<ellipse fill="none" stroke="black" cx="5661.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="5661.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 23</text>
<text text-anchor="middle" x="5661.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 23</text>
<text text-anchor="middle" x="5661.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="5661.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l2_split&#45;&gt;l2_expert7_gpu23 -->
<g id="edge45" class="edge">
<title>l2_split&#45;&gt;l2_expert7_gpu23</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5776.96,-1275.08C5760.58,-1259.4 5743.25,-1241.71 5728.51,-1224.29 5717.16,-1210.86 5705.94,-1195.5 5696.02,-1180.97"/>
<polygon fill="black" stroke="black" points="5698.83,-1178.88 5690.34,-1172.54 5693.02,-1182.79 5698.83,-1178.88"/>
<text text-anchor="middle" x="5817.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 23</text>
</g>
<!-- l2_expert8_gpu24 -->
<g id="node34" class="node">
<title>l2_expert8_gpu24</title>
<ellipse fill="none" stroke="black" cx="6011.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="6011.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 24</text>
<text text-anchor="middle" x="6011.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 24</text>
<text text-anchor="middle" x="6011.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="6011.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l2_split&#45;&gt;l2_expert8_gpu24 -->
<g id="edge46" class="edge">
<title>l2_split&#45;&gt;l2_expert8_gpu24</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5881.07,-1275.24C5906.78,-1245.86 5938.85,-1209.23 5964.75,-1179.63"/>
<polygon fill="black" stroke="black" points="5967.59,-1181.7 5971.54,-1171.87 5962.32,-1177.09 5967.59,-1181.7"/>
<text text-anchor="middle" x="6023.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 24</text>
</g>
<!-- l2_expert9_gpu25 -->
<g id="node35" class="node">
<title>l2_expert9_gpu25</title>
<ellipse fill="none" stroke="black" cx="6361.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="6361.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 25</text>
<text text-anchor="middle" x="6361.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 25</text>
<text text-anchor="middle" x="6361.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="6361.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l2_split&#45;&gt;l2_expert9_gpu25 -->
<g id="edge47" class="edge">
<title>l2_split&#45;&gt;l2_expert9_gpu25</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5972.04,-1278.93C6018.93,-1262.02 6071.65,-1242.66 6119.51,-1224.29 6165.74,-1206.54 6216.58,-1186.08 6259.68,-1168.45"/>
<polygon fill="black" stroke="black" points="6261.11,-1171.65 6269.04,-1164.62 6258.46,-1165.17 6261.11,-1171.65"/>
<text text-anchor="middle" x="6242.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 25</text>
</g>
<!-- l2_expert10_gpu26 -->
<g id="node36" class="node">
<title>l2_expert10_gpu26</title>
<ellipse fill="none" stroke="black" cx="6711.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="6711.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 26</text>
<text text-anchor="middle" x="6711.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 26</text>
<text text-anchor="middle" x="6711.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="6711.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l2_split&#45;&gt;l2_expert10_gpu26 -->
<g id="edge48" class="edge">
<title>l2_split&#45;&gt;l2_expert10_gpu26</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5988.38,-1298.05C6088.29,-1278.43 6221.48,-1251.32 6338.51,-1224.29 6427.05,-1203.83 6448.64,-1196.42 6536.51,-1173.29 6551.88,-1169.24 6568,-1164.96 6583.97,-1160.69"/>
<polygon fill="black" stroke="black" points="6585.14,-1164 6593.89,-1158.03 6583.33,-1157.24 6585.14,-1164"/>
<text text-anchor="middle" x="6489.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 26</text>
</g>
<!-- l2_expert11_gpu27 -->
<g id="node37" class="node">
<title>l2_expert11_gpu27</title>
<ellipse fill="none" stroke="black" cx="7061.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="7061.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 27</text>
<text text-anchor="middle" x="7061.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 27</text>
<text text-anchor="middle" x="7061.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="7061.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l2_split&#45;&gt;l2_expert11_gpu27 -->
<g id="edge49" class="edge">
<title>l2_split&#45;&gt;l2_expert11_gpu27</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5999.28,-1310.47C6207.12,-1287.48 6575.97,-1241.21 6886.51,-1173.29 6902.83,-1169.72 6919.9,-1165.6 6936.72,-1161.33"/>
<polygon fill="black" stroke="black" points="6937.77,-1164.67 6946.58,-1158.79 6936.02,-1157.89 6937.77,-1164.67"/>
<text text-anchor="middle" x="6776.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 27</text>
</g>
<!-- l2_expert12_gpu28 -->
<g id="node38" class="node">
<title>l2_expert12_gpu28</title>
<ellipse fill="none" stroke="black" cx="7411.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="7411.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 28</text>
<text text-anchor="middle" x="7411.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 28</text>
<text text-anchor="middle" x="7411.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="7411.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l2_split&#45;&gt;l2_expert12_gpu28 -->
<g id="edge50" class="edge">
<title>l2_split&#45;&gt;l2_expert12_gpu28</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M6006.09,-1318.62C6271.44,-1302.89 6798.19,-1262.6 7236.51,-1173.29 7253.01,-1169.93 7270.25,-1165.91 7287.21,-1161.67"/>
<polygon fill="black" stroke="black" points="7288.32,-1165 7297.15,-1159.15 7286.6,-1158.21 7288.32,-1165"/>
<text text-anchor="middle" x="7099.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 28</text>
</g>
<!-- l2_expert13_gpu29 -->
<g id="node39" class="node">
<title>l2_expert13_gpu29</title>
<ellipse fill="none" stroke="black" cx="7761.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="7761.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 29</text>
<text text-anchor="middle" x="7761.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 29</text>
<text text-anchor="middle" x="7761.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="7761.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l2_split&#45;&gt;l2_expert13_gpu29 -->
<g id="edge51" class="edge">
<title>l2_split&#45;&gt;l2_expert13_gpu29</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M6005.13,-1317.4C6262.73,-1301.71 6767.86,-1268.34 7195.51,-1224.29 7369.84,-1206.33 7414.63,-1207.46 7586.51,-1173.29 7603.15,-1169.98 7620.54,-1165.98 7637.64,-1161.72"/>
<polygon fill="black" stroke="black" points="7638.82,-1165.03 7647.66,-1159.18 7637.1,-1158.24 7638.82,-1165.03"/>
<text text-anchor="middle" x="7434.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 29</text>
</g>
<!-- l2_expert14_gpu30 -->
<g id="node40" class="node">
<title>l2_expert14_gpu30</title>
<ellipse fill="none" stroke="black" cx="8111.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="8111.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 30</text>
<text text-anchor="middle" x="8111.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 30</text>
<text text-anchor="middle" x="8111.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="8111.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l2_split&#45;&gt;l2_expert14_gpu30 -->
<g id="edge52" class="edge">
<title>l2_split&#45;&gt;l2_expert14_gpu30</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M6007.82,-1320.48C6314.49,-1307.55 6974.98,-1276 7530.51,-1224.29 7711.59,-1207.43 7758.06,-1208.33 7936.51,-1173.29 7953.16,-1170.02 7970.56,-1166.04 7987.65,-1161.79"/>
<polygon fill="black" stroke="black" points="7988.83,-1165.1 7997.67,-1159.26 7987.12,-1158.31 7988.83,-1165.1"/>
<text text-anchor="middle" x="7782.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 30</text>
</g>
<!-- l2_expert15_gpu31 -->
<g id="node41" class="node">
<title>l2_expert15_gpu31</title>
<ellipse fill="none" stroke="black" cx="8461.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="8461.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 31</text>
<text text-anchor="middle" x="8461.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 31</text>
<text text-anchor="middle" x="8461.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="8461.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l2_split&#45;&gt;l2_expert15_gpu31 -->
<g id="edge53" class="edge">
<title>l2_split&#45;&gt;l2_expert15_gpu31</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M6010.04,-1322.84C6363.31,-1312.88 7188.19,-1284.75 7878.51,-1224.29 8060.56,-1208.34 8107.18,-1208.44 8286.51,-1173.29 8303.16,-1170.02 8320.56,-1166.05 8337.65,-1161.8"/>
<polygon fill="black" stroke="black" points="8338.83,-1165.11 8347.67,-1159.27 8337.12,-1158.32 8338.83,-1165.11"/>
<text text-anchor="middle" x="8138.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 31</text>
</g>
<!-- l2_gather -->
<g id="node42" class="node">
<title>l2_gather</title>
<polygon fill="none" stroke="black" points="6080.77,-989.12 5760.61,-989.12 5678.25,-883.12 5998.41,-883.12 6080.77,-989.12"/>
<text text-anchor="middle" x="5879.51" y="-947.42" font-family="Times,serif" font-size="14.00">Async All&#45;Gather</text>
<text text-anchor="middle" x="5879.51" y="-932.42" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="5879.51" y="-917.42" font-family="Times,serif" font-size="14.00">Collect from GPUs 16&#45;31</text>
</g>
<!-- l2_expert0_gpu16&#45;&gt;l2_gather -->
<g id="edge54" class="edge">
<title>l2_expert0_gpu16&#45;&gt;l2_gather</title>
<path fill="none" stroke="black" d="M3323.28,-1090.58C3344.14,-1085.32 3365.87,-1080.51 3386.51,-1077.12 3644.9,-1034.67 3713.11,-1055.41 3974.51,-1040.12 4619,-1002.42 5386.45,-962.42 5715.98,-945.47"/>
<polygon fill="black" stroke="black" points="5716.28,-948.96 5726.08,-944.96 5715.92,-941.97 5716.28,-948.96"/>
</g>
<!-- l2_expert1_gpu17&#45;&gt;l2_gather -->
<g id="edge55" class="edge">
<title>l2_expert1_gpu17&#45;&gt;l2_gather</title>
<path fill="none" stroke="black" d="M3673.29,-1090.62C3694.15,-1085.36 3715.87,-1080.54 3736.51,-1077.12 4463.54,-956.78 5345.36,-938.81 5709.57,-936.87"/>
<polygon fill="black" stroke="black" points="5709.69,-940.37 5719.67,-936.82 5709.65,-933.37 5709.69,-940.37"/>
</g>
<!-- l2_expert2_gpu18&#45;&gt;l2_gather -->
<g id="edge56" class="edge">
<title>l2_expert2_gpu18&#45;&gt;l2_gather</title>
<path fill="none" stroke="black" d="M4023.8,-1090.71C4044.5,-1085.48 4066.05,-1080.64 4086.51,-1077.12 4678.39,-975.29 5393.07,-947.45 5711.87,-939.9"/>
<polygon fill="black" stroke="black" points="5712.2,-943.39 5722.12,-939.66 5712.04,-936.39 5712.2,-943.39"/>
</g>
<!-- l2_expert3_gpu19&#45;&gt;l2_gather -->
<g id="edge57" class="edge">
<title>l2_expert3_gpu19&#45;&gt;l2_gather</title>
<path fill="none" stroke="black" d="M4374.32,-1090.91C4394.88,-1085.69 4416.24,-1080.8 4436.51,-1077.12 4895.25,-993.75 5445.66,-957.73 5714.88,-944.19"/>
<polygon fill="black" stroke="black" points="5715.31,-947.67 5725.12,-943.68 5714.96,-940.68 5715.31,-947.67"/>
</g>
<!-- l2_expert4_gpu20&#45;&gt;l2_gather -->
<g id="edge58" class="edge">
<title>l2_expert4_gpu20&#45;&gt;l2_gather</title>
<path fill="none" stroke="black" d="M4725.36,-1091.18C4745.62,-1085.99 4766.61,-1081.05 4786.51,-1077.12 5115.36,-1012.13 5506.09,-970.52 5719.93,-950.73"/>
<polygon fill="black" stroke="black" points="5720.34,-954.21 5729.98,-949.8 5719.7,-947.24 5720.34,-954.21"/>
</g>
<!-- l2_expert5_gpu21&#45;&gt;l2_gather -->
<g id="edge59" class="edge">
<title>l2_expert5_gpu21&#45;&gt;l2_gather</title>
<path fill="none" stroke="black" d="M5076.99,-1091.8C5096.78,-1086.63 5117.19,-1081.53 5136.51,-1077.12 5339.95,-1030.66 5577.24,-987.91 5727.89,-962.19"/>
<polygon fill="black" stroke="black" points="5728.87,-965.57 5738.14,-960.44 5727.69,-958.67 5728.87,-965.57"/>
</g>
<!-- l2_expert6_gpu22&#45;&gt;l2_gather -->
<g id="edge60" class="edge">
<title>l2_expert6_gpu22&#45;&gt;l2_gather</title>
<path fill="none" stroke="black" d="M5418.02,-1089.12C5509.97,-1058.84 5643.37,-1014.9 5743.12,-982.04"/>
<polygon fill="black" stroke="black" points="5744.26,-985.35 5752.66,-978.9 5742.07,-978.7 5744.26,-985.35"/>
</g>
<!-- l2_expert7_gpu23&#45;&gt;l2_gather -->
<g id="edge61" class="edge">
<title>l2_expert7_gpu23&#45;&gt;l2_gather</title>
<path fill="none" stroke="black" d="M5713.45,-1079.63C5742.59,-1054.62 5779.31,-1023.11 5810.81,-996.08"/>
<polygon fill="black" stroke="black" points="5813.38,-998.48 5818.69,-989.31 5808.83,-993.17 5813.38,-998.48"/>
</g>
<!-- l2_expert8_gpu24&#45;&gt;l2_gather -->
<g id="edge62" class="edge">
<title>l2_expert8_gpu24&#45;&gt;l2_gather</title>
<path fill="none" stroke="black" d="M5978.88,-1077.96C5961.8,-1053.74 5940.67,-1023.79 5922.29,-997.74"/>
<polygon fill="black" stroke="black" points="5925.05,-995.59 5916.43,-989.44 5919.33,-999.62 5925.05,-995.59"/>
</g>
<!-- l2_expert9_gpu25&#45;&gt;l2_gather -->
<g id="edge63" class="edge">
<title>l2_expert9_gpu25&#45;&gt;l2_gather</title>
<path fill="none" stroke="black" d="M6264.84,-1086.68C6195.65,-1059.83 6101.34,-1023.22 6023.33,-992.94"/>
<polygon fill="black" stroke="black" points="6024.49,-989.64 6013.91,-989.28 6021.96,-996.16 6024.49,-989.64"/>
</g>
<!-- l2_expert10_gpu26&#45;&gt;l2_gather -->
<g id="edge64" class="edge">
<title>l2_expert10_gpu26&#45;&gt;l2_gather</title>
<path fill="none" stroke="black" d="M6595.01,-1091.94C6575.52,-1086.81 6555.48,-1081.69 6536.51,-1077.12 6384.02,-1040.39 6210.42,-1003.61 6079.97,-976.97"/>
<polygon fill="black" stroke="black" points="6080.36,-973.48 6069.87,-974.91 6078.97,-980.34 6080.36,-973.48"/>
</g>
<!-- l2_expert11_gpu27&#45;&gt;l2_gather -->
<g id="edge65" class="edge">
<title>l2_expert11_gpu27&#45;&gt;l2_gather</title>
<path fill="none" stroke="black" d="M6947.16,-1091.24C6927.05,-1086.08 6906.25,-1081.13 6886.51,-1077.12 6602.02,-1019.31 6267.42,-977.99 6064.53,-955.84"/>
<polygon fill="black" stroke="black" points="6064.69,-952.34 6054.37,-954.73 6063.94,-959.3 6064.69,-952.34"/>
</g>
<!-- l2_expert12_gpu28&#45;&gt;l2_gather -->
<g id="edge66" class="edge">
<title>l2_expert12_gpu28&#45;&gt;l2_gather</title>
<path fill="none" stroke="black" d="M7298.21,-1090.89C7277.8,-1085.7 7256.62,-1080.84 7236.51,-1077.12 6817.95,-999.74 6318.26,-962 6057.66,-946.39"/>
<polygon fill="black" stroke="black" points="6057.53,-942.88 6047.34,-945.78 6057.11,-949.86 6057.53,-942.88"/>
</g>
<!-- l2_expert13_gpu29&#45;&gt;l2_gather -->
<g id="edge67" class="edge">
<title>l2_expert13_gpu29&#45;&gt;l2_gather</title>
<path fill="none" stroke="black" d="M7649.22,-1090.78C7628.51,-1085.53 7606.97,-1080.68 7586.51,-1077.12 7032,-980.61 6364.26,-950.28 6053.89,-941.02"/>
<polygon fill="black" stroke="black" points="6053.55,-937.51 6043.46,-940.72 6053.35,-944.51 6053.55,-937.51"/>
</g>
<!-- l2_expert14_gpu30&#45;&gt;l2_gather -->
<g id="edge68" class="edge">
<title>l2_expert14_gpu30&#45;&gt;l2_gather</title>
<path fill="none" stroke="black" d="M7999.73,-1090.66C7978.87,-1085.4 7957.15,-1080.56 7936.51,-1077.12 7244.11,-961.55 6405.38,-940.89 6050.87,-937.55"/>
<polygon fill="black" stroke="black" points="6050.81,-934.05 6040.78,-937.45 6050.75,-941.04 6050.81,-934.05"/>
</g>
<!-- l2_expert15_gpu31&#45;&gt;l2_gather -->
<g id="edge69" class="edge">
<title>l2_expert15_gpu31&#45;&gt;l2_gather</title>
<path fill="none" stroke="black" d="M8349.74,-1090.6C8328.88,-1085.34 8307.16,-1080.52 8286.51,-1077.12 8032.97,-1035.31 7966.02,-1055.56 7709.51,-1040.12 7103.74,-1003.65 6384.92,-964.36 6057.68,-946.68"/>
<polygon fill="black" stroke="black" points="6057.81,-943.19 6047.64,-946.14 6057.43,-950.18 6057.81,-943.19"/>
</g>
<!-- l2_residual -->
<g id="node43" class="node">
<title>l2_residual</title>
<polygon fill="none" stroke="black" points="5879.51,-795.12 5726.51,-742.12 5879.51,-689.12 6032.51,-742.12 5879.51,-795.12"/>
<text text-anchor="middle" x="5879.51" y="-753.42" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="5879.51" y="-738.42" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="5879.51" y="-723.42" font-family="Times,serif" font-size="14.00">Across GPUs 16&#45;31</text>
</g>
<!-- l2_gather&#45;&gt;l2_residual -->
<g id="edge70" class="edge">
<title>l2_gather&#45;&gt;l2_residual</title>
<path fill="none" stroke="black" d="M5879.51,-882.91C5879.51,-859 5879.51,-830.47 5879.51,-805.45"/>
<polygon fill="black" stroke="black" points="5883.01,-805.32 5879.51,-795.32 5876.01,-805.32 5883.01,-805.32"/>
</g>
<!-- l3_attn -->
<g id="node44" class="node">
<title>l3_attn</title>
<ellipse fill="none" stroke="black" cx="5879.51" cy="-554.04" rx="145.83" ry="37.45"/>
<text text-anchor="middle" x="5879.51" y="-565.34" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="5879.51" y="-550.34" font-family="Times,serif" font-size="14.00">[1024 tokens, hidden_dim]</text>
<text text-anchor="middle" x="5879.51" y="-535.34" font-family="Times,serif" font-size="14.00">Replicated on GPUs 32&#45;47</text>
</g>
<!-- l2_residual&#45;&gt;l3_attn -->
<g id="edge71" class="edge">
<title>l2_residual&#45;&gt;l3_attn</title>
<path fill="none" stroke="black" d="M5879.51,-688.79C5879.51,-661.46 5879.51,-628.29 5879.51,-601.82"/>
<polygon fill="black" stroke="black" points="5883.01,-601.66 5879.51,-591.66 5876.01,-601.66 5883.01,-601.66"/>
</g>
<!-- l3_gate -->
<g id="node45" class="node">
<title>l3_gate</title>
<polygon fill="none" stroke="black" points="8704.14,-1396.29 8319.77,-1396.29 8220.89,-1260.29 8605.26,-1260.29 8704.14,-1396.29"/>
<text text-anchor="middle" x="8462.51" y="-1347.09" font-family="Times,serif" font-size="14.00">Gate Network</text>
<text text-anchor="middle" x="8462.51" y="-1332.09" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="8462.51" y="-1317.09" font-family="Times,serif" font-size="14.00">Compute routing probabilities</text>
<text text-anchor="middle" x="8462.51" y="-1302.09" font-family="Times,serif" font-size="14.00">GPUs 32&#45;47</text>
</g>
<!-- l3_split -->
<g id="node46" class="node">
<title>l3_split</title>
<polygon fill="none" stroke="black" points="11662.46,-1381.29 11304.62,-1381.29 11212.56,-1275.29 11570.41,-1275.29 11662.46,-1381.29"/>
<text text-anchor="middle" x="11437.51" y="-1339.59" font-family="Times,serif" font-size="14.00">Async Token Split</text>
<text text-anchor="middle" x="11437.51" y="-1324.59" font-family="Times,serif" font-size="14.00">[Variable tokens per expert]</text>
<text text-anchor="middle" x="11437.51" y="-1309.59" font-family="Times,serif" font-size="14.00">Send to target GPUs</text>
</g>
<!-- l3_expert0_gpu32 -->
<g id="node47" class="node">
<title>l3_expert0_gpu32</title>
<ellipse fill="none" stroke="black" cx="8811.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="8811.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 32</text>
<text text-anchor="middle" x="8811.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 32</text>
<text text-anchor="middle" x="8811.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="8811.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l3_split&#45;&gt;l3_expert0_gpu32 -->
<g id="edge72" class="edge">
<title>l3_split&#45;&gt;l3_expert0_gpu32</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M11253.46,-1322.55C10895.2,-1312.31 10079.32,-1284.08 9395.51,-1224.29 9213.02,-1208.33 9166.28,-1208.5 8986.51,-1173.29 8969.87,-1170.03 8952.47,-1166.05 8935.37,-1161.8"/>
<polygon fill="black" stroke="black" points="8935.9,-1158.33 8925.35,-1159.28 8934.19,-1165.12 8935.9,-1158.33"/>
<text text-anchor="middle" x="9484.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 32</text>
</g>
<!-- l3_expert1_gpu33 -->
<g id="node48" class="node">
<title>l3_expert1_gpu33</title>
<ellipse fill="none" stroke="black" cx="9161.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="9161.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 33</text>
<text text-anchor="middle" x="9161.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 33</text>
<text text-anchor="middle" x="9161.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="9161.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l3_split&#45;&gt;l3_expert1_gpu33 -->
<g id="edge73" class="edge">
<title>l3_split&#45;&gt;l3_expert1_gpu33</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M11251.09,-1319.85C10938.79,-1306.53 10290.29,-1275.11 9743.51,-1224.29 9561.99,-1207.41 9515.41,-1208.39 9336.51,-1173.29 9319.87,-1170.02 9302.47,-1166.04 9285.38,-1161.79"/>
<polygon fill="black" stroke="black" points="9285.91,-1158.32 9275.35,-1159.27 9284.19,-1165.11 9285.91,-1158.32"/>
<text text-anchor="middle" x="9832.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 33</text>
</g>
<!-- l3_expert2_gpu34 -->
<g id="node49" class="node">
<title>l3_expert2_gpu34</title>
<ellipse fill="none" stroke="black" cx="9511.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="9511.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 34</text>
<text text-anchor="middle" x="9511.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 34</text>
<text text-anchor="middle" x="9511.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="9511.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l3_split&#45;&gt;l3_expert2_gpu34 -->
<g id="edge74" class="edge">
<title>l3_split&#45;&gt;l3_expert2_gpu34</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M11247.88,-1316.14C10984.95,-1299.95 10494.97,-1267.13 10078.51,-1224.29 9903.75,-1206.31 9858.84,-1207.52 9686.51,-1173.29 9669.87,-1169.98 9652.48,-1165.98 9635.39,-1161.72"/>
<polygon fill="black" stroke="black" points="9635.92,-1158.25 9625.37,-1159.19 9634.21,-1165.03 9635.92,-1158.25"/>
<text text-anchor="middle" x="10167.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 34</text>
</g>
<!-- l3_expert3_gpu35 -->
<g id="node50" class="node">
<title>l3_expert3_gpu35</title>
<ellipse fill="none" stroke="black" cx="9861.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="9861.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 35</text>
<text text-anchor="middle" x="9861.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 35</text>
<text text-anchor="middle" x="9861.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="9861.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l3_split&#45;&gt;l3_expert3_gpu35 -->
<g id="edge75" class="edge">
<title>l3_split&#45;&gt;l3_expert3_gpu35</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M11249.16,-1317.53C10978.59,-1301.05 10465.26,-1260.57 10036.51,-1173.29 10020.02,-1169.93 10002.78,-1165.92 9985.82,-1161.67"/>
<polygon fill="black" stroke="black" points="9986.43,-1158.22 9975.87,-1159.15 9984.71,-1165 9986.43,-1158.22"/>
<text text-anchor="middle" x="10391.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 35</text>
</g>
<!-- l3_expert4_gpu36 -->
<g id="node51" class="node">
<title>l3_expert4_gpu36</title>
<ellipse fill="none" stroke="black" cx="10211.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="10211.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 36</text>
<text text-anchor="middle" x="10211.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 36</text>
<text text-anchor="middle" x="10211.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="10211.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l3_split&#45;&gt;l3_expert4_gpu36 -->
<g id="edge76" class="edge">
<title>l3_split&#45;&gt;l3_expert4_gpu36</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M11239.4,-1306.69C11026.99,-1282.64 10680.58,-1237.78 10386.51,-1173.29 10370.2,-1169.71 10353.13,-1165.59 10336.31,-1161.31"/>
<polygon fill="black" stroke="black" points="10337.01,-1157.87 10326.45,-1158.77 10335.26,-1164.65 10337.01,-1157.87"/>
<text text-anchor="middle" x="10733.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 36</text>
</g>
<!-- l3_expert5_gpu37 -->
<g id="node52" class="node">
<title>l3_expert5_gpu37</title>
<ellipse fill="none" stroke="black" cx="10561.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="10561.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 37</text>
<text text-anchor="middle" x="10561.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 37</text>
<text text-anchor="middle" x="10561.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="10561.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l3_split&#45;&gt;l3_expert5_gpu37 -->
<g id="edge77" class="edge">
<title>l3_split&#45;&gt;l3_expert5_gpu37</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M11221.99,-1286.3C11131.69,-1268.4 11025.76,-1246.46 10930.51,-1224.29 10843.68,-1204.07 10822.67,-1196.2 10736.51,-1173.29 10721.15,-1169.2 10705.04,-1164.9 10689.07,-1160.61"/>
<polygon fill="black" stroke="black" points="10689.72,-1157.16 10679.16,-1157.95 10687.91,-1163.93 10689.72,-1157.16"/>
<text text-anchor="middle" x="11019.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 37</text>
</g>
<!-- l3_expert6_gpu38 -->
<g id="node53" class="node">
<title>l3_expert6_gpu38</title>
<ellipse fill="none" stroke="black" cx="10911.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="10911.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 38</text>
<text text-anchor="middle" x="10911.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 38</text>
<text text-anchor="middle" x="10911.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="10911.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l3_split&#45;&gt;l3_expert6_gpu38 -->
<g id="edge78" class="edge">
<title>l3_split&#45;&gt;l3_expert6_gpu38</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M11286.07,-1275.19C11241.28,-1259.33 11192.26,-1241.52 11147.51,-1224.29 11102.47,-1206.94 11053.1,-1186.63 11011.21,-1169"/>
<polygon fill="black" stroke="black" points="11012.41,-1165.71 11001.84,-1165.05 11009.69,-1172.16 11012.41,-1165.71"/>
<text text-anchor="middle" x="11236.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 38</text>
</g>
<!-- l3_expert7_gpu39 -->
<g id="node54" class="node">
<title>l3_expert7_gpu39</title>
<ellipse fill="none" stroke="black" cx="11261.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="11261.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 39</text>
<text text-anchor="middle" x="11261.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 39</text>
<text text-anchor="middle" x="11261.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="11261.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l3_split&#45;&gt;l3_expert7_gpu39 -->
<g id="edge79" class="edge">
<title>l3_split&#45;&gt;l3_expert7_gpu39</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M11389.87,-1275.18C11375.22,-1258.97 11359.1,-1240.97 11344.51,-1224.29 11332.13,-1210.12 11318.89,-1194.63 11306.71,-1180.24"/>
<polygon fill="black" stroke="black" points="11309.19,-1177.75 11300.06,-1172.37 11303.84,-1182.27 11309.19,-1177.75"/>
<text text-anchor="middle" x="11433.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 39</text>
</g>
<!-- l3_expert8_gpu40 -->
<g id="node55" class="node">
<title>l3_expert8_gpu40</title>
<ellipse fill="none" stroke="black" cx="11611.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="11611.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 40</text>
<text text-anchor="middle" x="11611.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 40</text>
<text text-anchor="middle" x="11611.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="11611.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l3_split&#45;&gt;l3_expert8_gpu40 -->
<g id="edge80" class="edge">
<title>l3_split&#45;&gt;l3_expert8_gpu40</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M11482.55,-1275.24C11507.97,-1245.86 11539.67,-1209.23 11565.28,-1179.63"/>
<polygon fill="black" stroke="black" points="11568.1,-1181.72 11572,-1171.87 11562.81,-1177.14 11568.1,-1181.72"/>
<text text-anchor="middle" x="11623.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 40</text>
</g>
<!-- l3_expert9_gpu41 -->
<g id="node56" class="node">
<title>l3_expert9_gpu41</title>
<ellipse fill="none" stroke="black" cx="11961.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="11961.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 41</text>
<text text-anchor="middle" x="11961.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 41</text>
<text text-anchor="middle" x="11961.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="11961.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l3_split&#45;&gt;l3_expert9_gpu41 -->
<g id="edge81" class="edge">
<title>l3_split&#45;&gt;l3_expert9_gpu41</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M11573.42,-1278.73C11619.88,-1261.84 11672.09,-1242.55 11719.51,-1224.29 11765.72,-1206.49 11816.56,-1186.02 11859.66,-1168.4"/>
<polygon fill="black" stroke="black" points="11861.09,-1171.6 11869.02,-1164.57 11858.44,-1165.12 11861.09,-1171.6"/>
<text text-anchor="middle" x="11841.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 41</text>
</g>
<!-- l3_expert10_gpu42 -->
<g id="node57" class="node">
<title>l3_expert10_gpu42</title>
<ellipse fill="none" stroke="black" cx="12311.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="12311.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 42</text>
<text text-anchor="middle" x="12311.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 42</text>
<text text-anchor="middle" x="12311.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="12311.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l3_split&#45;&gt;l3_expert10_gpu42 -->
<g id="edge82" class="edge">
<title>l3_split&#45;&gt;l3_expert10_gpu42</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M11590,-1297.84C11689.25,-1278.19 11821.37,-1251.12 11937.51,-1224.29 12026.47,-1203.74 12048.21,-1196.48 12136.51,-1173.29 12151.89,-1169.25 12168,-1164.97 12183.98,-1160.71"/>
<polygon fill="black" stroke="black" points="12185.14,-1164.02 12193.9,-1158.05 12183.33,-1157.26 12185.14,-1164.02"/>
<text text-anchor="middle" x="12087.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 42</text>
</g>
<!-- l3_expert11_gpu43 -->
<g id="node58" class="node">
<title>l3_expert11_gpu43</title>
<ellipse fill="none" stroke="black" cx="12661.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="12661.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 43</text>
<text text-anchor="middle" x="12661.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 43</text>
<text text-anchor="middle" x="12661.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="12661.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l3_split&#45;&gt;l3_expert11_gpu43 -->
<g id="edge83" class="edge">
<title>l3_split&#45;&gt;l3_expert11_gpu43</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M11600.95,-1310.37C11808.38,-1287.29 12176.51,-1240.91 12486.51,-1173.29 12502.83,-1169.73 12519.9,-1165.62 12536.72,-1161.34"/>
<polygon fill="black" stroke="black" points="12537.77,-1164.69 12546.58,-1158.81 12536.03,-1157.91 12537.77,-1164.69"/>
<text text-anchor="middle" x="12376.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 43</text>
</g>
<!-- l3_expert12_gpu44 -->
<g id="node59" class="node">
<title>l3_expert12_gpu44</title>
<ellipse fill="none" stroke="black" cx="13011.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="13011.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 44</text>
<text text-anchor="middle" x="13011.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 44</text>
<text text-anchor="middle" x="13011.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="13011.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l3_split&#45;&gt;l3_expert12_gpu44 -->
<g id="edge84" class="edge">
<title>l3_split&#45;&gt;l3_expert12_gpu44</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M11608.11,-1318.58C11873.18,-1302.79 12398.96,-1262.45 12836.51,-1173.29 12853.01,-1169.93 12870.25,-1165.91 12887.21,-1161.67"/>
<polygon fill="black" stroke="black" points="12888.32,-1165 12897.15,-1159.15 12886.6,-1158.21 12888.32,-1165"/>
<text text-anchor="middle" x="12698.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 44</text>
</g>
<!-- l3_expert13_gpu45 -->
<g id="node60" class="node">
<title>l3_expert13_gpu45</title>
<ellipse fill="none" stroke="black" cx="13361.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="13361.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 45</text>
<text text-anchor="middle" x="13361.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 45</text>
<text text-anchor="middle" x="13361.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="13361.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l3_split&#45;&gt;l3_expert13_gpu45 -->
<g id="edge85" class="edge">
<title>l3_split&#45;&gt;l3_expert13_gpu45</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M11607.02,-1317.35C11864.13,-1301.61 12367.94,-1268.19 12794.51,-1224.29 12969.28,-1206.3 13014.19,-1207.52 13186.51,-1173.29 13203.15,-1169.98 13220.54,-1165.98 13237.64,-1161.72"/>
<polygon fill="black" stroke="black" points="13238.82,-1165.03 13247.66,-1159.19 13237.1,-1158.25 13238.82,-1165.03"/>
<text text-anchor="middle" x="13033.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 45</text>
</g>
<!-- l3_expert14_gpu46 -->
<g id="node61" class="node">
<title>l3_expert14_gpu46</title>
<ellipse fill="none" stroke="black" cx="13711.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="13711.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 46</text>
<text text-anchor="middle" x="13711.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 46</text>
<text text-anchor="middle" x="13711.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="13711.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l3_split&#45;&gt;l3_expert14_gpu46 -->
<g id="edge86" class="edge">
<title>l3_split&#45;&gt;l3_expert14_gpu46</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M11609.82,-1320.44C11916.07,-1307.45 12575.14,-1275.84 13129.51,-1224.29 13311.03,-1207.41 13357.62,-1208.39 13536.51,-1173.29 13553.16,-1170.02 13570.56,-1166.04 13587.65,-1161.79"/>
<polygon fill="black" stroke="black" points="13588.83,-1165.11 13597.67,-1159.27 13587.12,-1158.32 13588.83,-1165.11"/>
<text text-anchor="middle" x="13381.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 46</text>
</g>
<!-- l3_expert15_gpu47 -->
<g id="node62" class="node">
<title>l3_expert15_gpu47</title>
<ellipse fill="none" stroke="black" cx="14061.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="14061.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 47</text>
<text text-anchor="middle" x="14061.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 47</text>
<text text-anchor="middle" x="14061.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="14061.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l3_split&#45;&gt;l3_expert15_gpu47 -->
<g id="edge87" class="edge">
<title>l3_split&#45;&gt;l3_expert15_gpu47</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M11611.78,-1322.81C11964.53,-1312.8 12788.2,-1284.58 13477.51,-1224.29 13660,-1208.32 13706.74,-1208.5 13886.51,-1173.29 13903.16,-1170.03 13920.56,-1166.05 13937.65,-1161.8"/>
<polygon fill="black" stroke="black" points="13938.83,-1165.12 13947.67,-1159.28 13937.12,-1158.33 13938.83,-1165.12"/>
<text text-anchor="middle" x="13737.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 47</text>
</g>
<!-- l3_gather -->
<g id="node63" class="node">
<title>l3_gather</title>
<polygon fill="none" stroke="black" points="11598.77,-989.12 11278.61,-989.12 11196.25,-883.12 11516.41,-883.12 11598.77,-989.12"/>
<text text-anchor="middle" x="11397.51" y="-947.42" font-family="Times,serif" font-size="14.00">Async All&#45;Gather</text>
<text text-anchor="middle" x="11397.51" y="-932.42" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="11397.51" y="-917.42" font-family="Times,serif" font-size="14.00">Collect from GPUs 32&#45;47</text>
</g>
<!-- l3_expert0_gpu32&#45;&gt;l3_gather -->
<g id="edge88" class="edge">
<title>l3_expert0_gpu32&#45;&gt;l3_gather</title>
<path fill="none" stroke="black" d="M8923.28,-1090.57C8944.14,-1085.31 8965.87,-1080.51 8986.51,-1077.12 9247.1,-1034.38 9315.91,-1055.81 9579.51,-1040.12 10190.03,-1003.78 10916.05,-963.54 11234.34,-946.05"/>
<polygon fill="black" stroke="black" points="11234.77,-949.53 11244.56,-945.49 11234.39,-942.54 11234.77,-949.53"/>
</g>
<!-- l3_expert1_gpu33&#45;&gt;l3_gather -->
<g id="edge89" class="edge">
<title>l3_expert1_gpu33&#45;&gt;l3_gather</title>
<path fill="none" stroke="black" d="M9273.3,-1090.66C9294.15,-1085.39 9315.88,-1080.56 9336.51,-1077.12 10031.8,-961.11 10874.34,-940.71 11228.17,-937.5"/>
<polygon fill="black" stroke="black" points="11228.27,-940.99 11238.24,-937.41 11228.21,-933.99 11228.27,-940.99"/>
</g>
<!-- l3_expert2_gpu34&#45;&gt;l3_gather -->
<g id="edge90" class="edge">
<title>l3_expert2_gpu34&#45;&gt;l3_gather</title>
<path fill="none" stroke="black" d="M9623.81,-1090.78C9644.51,-1085.53 9666.06,-1080.68 9686.51,-1077.12 10246.86,-979.64 10922.57,-949.7 11230.27,-940.77"/>
<polygon fill="black" stroke="black" points="11230.72,-944.26 11240.61,-940.47 11230.52,-937.26 11230.72,-944.26"/>
</g>
<!-- l3_expert3_gpu35&#45;&gt;l3_gather -->
<g id="edge91" class="edge">
<title>l3_expert3_gpu35&#45;&gt;l3_gather</title>
<path fill="none" stroke="black" d="M9974.81,-1090.89C9995.22,-1085.7 10016.4,-1080.83 10036.51,-1077.12 10464.52,-998.06 10977.11,-960.45 11233.9,-945.46"/>
<polygon fill="black" stroke="black" points="11234.28,-948.94 11244.06,-944.87 11233.87,-941.95 11234.28,-948.94"/>
</g>
<!-- l3_expert4_gpu36&#45;&gt;l3_gather -->
<g id="edge92" class="edge">
<title>l3_expert4_gpu36&#45;&gt;l3_gather</title>
<path fill="none" stroke="black" d="M10325.87,-1091.23C10345.98,-1086.07 10366.78,-1081.12 10386.51,-1077.12 10685.37,-1016.47 11039.3,-974.1 11239.2,-952.83"/>
<polygon fill="black" stroke="black" points="11239.62,-956.31 11249.19,-951.78 11238.88,-949.35 11239.62,-956.31"/>
</g>
<!-- l3_expert5_gpu37&#45;&gt;l3_gather -->
<g id="edge93" class="edge">
<title>l3_expert5_gpu37&#45;&gt;l3_gather</title>
<path fill="none" stroke="black" d="M10678.01,-1091.92C10697.5,-1086.79 10717.55,-1081.68 10736.51,-1077.12 10911.77,-1035.02 11114.77,-993.02 11249.08,-966.17"/>
<polygon fill="black" stroke="black" points="11249.91,-969.57 11259.03,-964.18 11248.54,-962.71 11249.91,-969.57"/>
</g>
<!-- l3_expert6_gpu38&#45;&gt;l3_gather -->
<g id="edge94" class="edge">
<title>l3_expert6_gpu38&#45;&gt;l3_gather</title>
<path fill="none" stroke="black" d="M11008.69,-1086.79C11082.16,-1058.51 11183.85,-1019.37 11264.8,-988.21"/>
<polygon fill="black" stroke="black" points="11266.5,-991.3 11274.57,-984.45 11263.98,-984.77 11266.5,-991.3"/>
</g>
<!-- l3_expert7_gpu39&#45;&gt;l3_gather -->
<g id="edge95" class="edge">
<title>l3_expert7_gpu39&#45;&gt;l3_gather</title>
<path fill="none" stroke="black" d="M11295.13,-1077.96C11312.73,-1053.74 11334.51,-1023.79 11353.44,-997.74"/>
<polygon fill="black" stroke="black" points="11356.43,-999.58 11359.48,-989.44 11350.77,-995.47 11356.43,-999.58"/>
</g>
<!-- l3_expert8_gpu40&#45;&gt;l3_gather -->
<g id="edge96" class="edge">
<title>l3_expert8_gpu40&#45;&gt;l3_gather</title>
<path fill="none" stroke="black" d="M11560.25,-1079.39C11531.64,-1054.38 11495.65,-1022.92 11464.8,-995.94"/>
<polygon fill="black" stroke="black" points="11466.9,-993.13 11457.07,-989.19 11462.3,-998.4 11466.9,-993.13"/>
</g>
<!-- l3_expert9_gpu41&#45;&gt;l3_gather -->
<g id="edge97" class="edge">
<title>l3_expert9_gpu41&#45;&gt;l3_gather</title>
<path fill="none" stroke="black" d="M11855.43,-1089.01C11773.37,-1061.79 11658.22,-1023.6 11563.92,-992.32"/>
<polygon fill="black" stroke="black" points="11564.87,-988.95 11554.28,-989.12 11562.67,-995.59 11564.87,-988.95"/>
</g>
<!-- l3_expert10_gpu42&#45;&gt;l3_gather -->
<g id="edge98" class="edge">
<title>l3_expert10_gpu42&#45;&gt;l3_gather</title>
<path fill="none" stroke="black" d="M12195.57,-1091.69C12175.92,-1086.56 12155.68,-1081.51 12136.51,-1077.12 11953.29,-1035.18 11742.47,-996.14 11593.02,-970"/>
<polygon fill="black" stroke="black" points="11593.27,-966.49 11582.82,-968.22 11592.07,-973.39 11593.27,-966.49"/>
</g>
<!-- l3_expert11_gpu43&#45;&gt;l3_gather -->
<g id="edge99" class="edge">
<title>l3_expert11_gpu43&#45;&gt;l3_gather</title>
<path fill="none" stroke="black" d="M12547.66,-1091.19C12527.41,-1086 12506.42,-1081.06 12486.51,-1077.12 12170.83,-1014.66 11797.92,-973.69 11580.54,-953.04"/>
<polygon fill="black" stroke="black" points="11580.6,-949.53 11570.31,-952.07 11579.94,-956.5 11580.6,-949.53"/>
</g>
<!-- l3_expert12_gpu44&#45;&gt;l3_gather -->
<g id="edge100" class="edge">
<title>l3_expert12_gpu44&#45;&gt;l3_gather</title>
<path fill="none" stroke="black" d="M12898.7,-1090.92C12878.14,-1085.69 12856.79,-1080.81 12836.51,-1077.12 12386.21,-995.22 11847.33,-958.97 11574.51,-944.88"/>
<polygon fill="black" stroke="black" points="11574.28,-941.36 11564.12,-944.35 11573.92,-948.36 11574.28,-941.36"/>
</g>
<!-- l3_expert13_gpu45&#45;&gt;l3_gather -->
<g id="edge101" class="edge">
<title>l3_expert13_gpu45&#45;&gt;l3_gather</title>
<path fill="none" stroke="black" d="M13249.23,-1090.72C13228.52,-1085.48 13206.98,-1080.64 13186.51,-1077.12 12599.75,-976.12 11892.03,-947.9 11570.96,-940.08"/>
<polygon fill="black" stroke="black" points="11570.72,-936.57 11560.64,-939.83 11570.56,-943.57 11570.72,-936.57"/>
</g>
<!-- l3_expert14_gpu46&#45;&gt;l3_gather -->
<g id="edge102" class="edge">
<title>l3_expert14_gpu46&#45;&gt;l3_gather</title>
<path fill="none" stroke="black" d="M13599.74,-1090.62C13578.88,-1085.36 13557.15,-1080.54 13536.51,-1077.12 12811.75,-957.11 11932.88,-938.94 11568.5,-936.9"/>
<polygon fill="black" stroke="black" points="11568.42,-933.4 11558.4,-936.85 11568.39,-940.4 11568.42,-933.4"/>
</g>
<!-- l3_expert15_gpu47&#45;&gt;l3_gather -->
<g id="edge103" class="edge">
<title>l3_expert15_gpu47&#45;&gt;l3_gather</title>
<path fill="none" stroke="black" d="M13949.74,-1090.6C13928.88,-1085.34 13907.16,-1080.53 13886.51,-1077.12 13634.73,-1035.54 13568.26,-1055.19 13313.51,-1040.12 12673.82,-1002.27 11913.62,-963.15 11575.23,-946.03"/>
<polygon fill="black" stroke="black" points="11575.26,-942.53 11565.1,-945.52 11574.91,-949.52 11575.26,-942.53"/>
</g>
<!-- l3_residual -->
<g id="node64" class="node">
<title>l3_residual</title>
<polygon fill="none" stroke="black" points="11397.51,-795.12 11244.51,-742.12 11397.51,-689.12 11550.51,-742.12 11397.51,-795.12"/>
<text text-anchor="middle" x="11397.51" y="-753.42" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="11397.51" y="-738.42" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="11397.51" y="-723.42" font-family="Times,serif" font-size="14.00">Across GPUs 32&#45;47</text>
</g>
<!-- l3_gather&#45;&gt;l3_residual -->
<g id="edge104" class="edge">
<title>l3_gather&#45;&gt;l3_residual</title>
<path fill="none" stroke="black" d="M11397.51,-882.91C11397.51,-859 11397.51,-830.47 11397.51,-805.45"/>
<polygon fill="black" stroke="black" points="11401.01,-805.32 11397.51,-795.32 11394.01,-805.32 11401.01,-805.32"/>
</g>
<!-- l4_attn -->
<g id="node65" class="node">
<title>l4_attn</title>
<ellipse fill="none" stroke="black" cx="11397.51" cy="-554.04" rx="145.83" ry="37.45"/>
<text text-anchor="middle" x="11397.51" y="-565.34" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="11397.51" y="-550.34" font-family="Times,serif" font-size="14.00">[1024 tokens, hidden_dim]</text>
<text text-anchor="middle" x="11397.51" y="-535.34" font-family="Times,serif" font-size="14.00">Replicated on GPUs 48&#45;63</text>
</g>
<!-- l3_residual&#45;&gt;l4_attn -->
<g id="edge105" class="edge">
<title>l3_residual&#45;&gt;l4_attn</title>
<path fill="none" stroke="black" d="M11397.51,-688.79C11397.51,-661.46 11397.51,-628.29 11397.51,-601.82"/>
<polygon fill="black" stroke="black" points="11401.01,-601.66 11397.51,-591.66 11394.01,-601.66 11401.01,-601.66"/>
</g>
<!-- l4_gate -->
<g id="node66" class="node">
<title>l4_gate</title>
<polygon fill="none" stroke="black" points="14652.14,-1396.29 14267.77,-1396.29 14168.89,-1260.29 14553.26,-1260.29 14652.14,-1396.29"/>
<text text-anchor="middle" x="14410.51" y="-1347.09" font-family="Times,serif" font-size="14.00">Gate Network</text>
<text text-anchor="middle" x="14410.51" y="-1332.09" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="14410.51" y="-1317.09" font-family="Times,serif" font-size="14.00">Compute routing probabilities</text>
<text text-anchor="middle" x="14410.51" y="-1302.09" font-family="Times,serif" font-size="14.00">GPUs 48&#45;63</text>
</g>
<!-- l4_split -->
<g id="node67" class="node">
<title>l4_split</title>
<polygon fill="none" stroke="black" points="17260.46,-1381.29 16902.62,-1381.29 16810.56,-1275.29 17168.41,-1275.29 17260.46,-1381.29"/>
<text text-anchor="middle" x="17035.51" y="-1339.59" font-family="Times,serif" font-size="14.00">Async Token Split</text>
<text text-anchor="middle" x="17035.51" y="-1324.59" font-family="Times,serif" font-size="14.00">[Variable tokens per expert]</text>
<text text-anchor="middle" x="17035.51" y="-1309.59" font-family="Times,serif" font-size="14.00">Send to target GPUs</text>
</g>
<!-- l4_expert0_gpu48 -->
<g id="node68" class="node">
<title>l4_expert0_gpu48</title>
<ellipse fill="none" stroke="black" cx="14411.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="14411.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 48</text>
<text text-anchor="middle" x="14411.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 48</text>
<text text-anchor="middle" x="14411.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="14411.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l4_split&#45;&gt;l4_expert0_gpu48 -->
<g id="edge106" class="edge">
<title>l4_split&#45;&gt;l4_expert0_gpu48</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M16851.55,-1322.56C16493.47,-1312.35 15677.97,-1284.17 14994.51,-1224.29 14812.47,-1208.34 14765.84,-1208.44 14586.51,-1173.29 14569.87,-1170.02 14552.47,-1166.05 14535.38,-1161.8"/>
<polygon fill="black" stroke="black" points="14535.91,-1158.32 14525.35,-1159.27 14534.19,-1165.11 14535.91,-1158.32"/>
<text text-anchor="middle" x="15083.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 48</text>
</g>
<!-- l4_expert1_gpu49 -->
<g id="node69" class="node">
<title>l4_expert1_gpu49</title>
<ellipse fill="none" stroke="black" cx="14761.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="14761.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 49</text>
<text text-anchor="middle" x="14761.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 49</text>
<text text-anchor="middle" x="14761.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="14761.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l4_split&#45;&gt;l4_expert1_gpu49 -->
<g id="edge107" class="edge">
<title>l4_split&#45;&gt;l4_expert1_gpu49</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M16849.2,-1319.87C16537.08,-1306.56 15888.96,-1275.18 15342.51,-1224.29 15161.43,-1207.42 15114.97,-1208.33 14936.51,-1173.29 14919.87,-1170.02 14902.47,-1166.04 14885.38,-1161.79"/>
<polygon fill="black" stroke="black" points="14885.91,-1158.31 14875.36,-1159.26 14884.2,-1165.1 14885.91,-1158.31"/>
<text text-anchor="middle" x="15431.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 49</text>
</g>
<!-- l4_expert2_gpu50 -->
<g id="node70" class="node">
<title>l4_expert2_gpu50</title>
<ellipse fill="none" stroke="black" cx="15111.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="15111.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 50</text>
<text text-anchor="middle" x="15111.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 50</text>
<text text-anchor="middle" x="15111.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="15111.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l4_split&#45;&gt;l4_expert2_gpu50 -->
<g id="edge108" class="edge">
<title>l4_split&#45;&gt;l4_expert2_gpu50</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M16846.02,-1316.15C16583.28,-1299.98 16093.66,-1267.18 15677.51,-1224.29 15503.19,-1206.32 15458.4,-1207.46 15286.51,-1173.29 15269.88,-1169.98 15252.48,-1165.98 15235.39,-1161.72"/>
<polygon fill="black" stroke="black" points="15235.92,-1158.24 15225.37,-1159.18 15234.21,-1165.03 15235.92,-1158.24"/>
<text text-anchor="middle" x="15766.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 50</text>
</g>
<!-- l4_expert3_gpu51 -->
<g id="node71" class="node">
<title>l4_expert3_gpu51</title>
<ellipse fill="none" stroke="black" cx="15461.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="15461.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 51</text>
<text text-anchor="middle" x="15461.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 51</text>
<text text-anchor="middle" x="15461.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="15461.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l4_split&#45;&gt;l4_expert3_gpu51 -->
<g id="edge109" class="edge">
<title>l4_split&#45;&gt;l4_expert3_gpu51</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M16847.13,-1317.53C16576.87,-1301.05 16064.48,-1260.57 15636.51,-1173.29 15620.02,-1169.92 15602.78,-1165.91 15585.82,-1161.66"/>
<polygon fill="black" stroke="black" points="15586.43,-1158.21 15575.88,-1159.14 15584.71,-1164.99 15586.43,-1158.21"/>
<text text-anchor="middle" x="15989.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 51</text>
</g>
<!-- l4_expert4_gpu52 -->
<g id="node72" class="node">
<title>l4_expert4_gpu52</title>
<ellipse fill="none" stroke="black" cx="15811.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="15811.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 52</text>
<text text-anchor="middle" x="15811.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 52</text>
<text text-anchor="middle" x="15811.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="15811.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l4_split&#45;&gt;l4_expert4_gpu52 -->
<g id="edge110" class="edge">
<title>l4_split&#45;&gt;l4_expert4_gpu52</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M16837.31,-1306.52C16625.28,-1282.37 16279.84,-1237.44 15986.51,-1173.29 15970.2,-1169.72 15953.12,-1165.6 15936.31,-1161.33"/>
<polygon fill="black" stroke="black" points="15937,-1157.89 15926.45,-1158.79 15935.26,-1164.67 15937,-1157.89"/>
<text text-anchor="middle" x="16331.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 52</text>
</g>
<!-- l4_expert5_gpu53 -->
<g id="node73" class="node">
<title>l4_expert5_gpu53</title>
<ellipse fill="none" stroke="black" cx="16161.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="16161.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 53</text>
<text text-anchor="middle" x="16161.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 53</text>
<text text-anchor="middle" x="16161.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="16161.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l4_split&#45;&gt;l4_expert5_gpu53 -->
<g id="edge111" class="edge">
<title>l4_split&#45;&gt;l4_expert5_gpu53</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M16818.92,-1285.19C16730.51,-1267.37 16627.41,-1245.78 16534.51,-1224.29 16445.98,-1203.8 16424.39,-1196.42 16336.51,-1173.29 16321.14,-1169.24 16305.03,-1164.96 16289.05,-1160.69"/>
<polygon fill="black" stroke="black" points="16289.7,-1157.24 16279.13,-1158.03 16287.89,-1164 16289.7,-1157.24"/>
<text text-anchor="middle" x="16623.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 53</text>
</g>
<!-- l4_expert6_gpu54 -->
<g id="node74" class="node">
<title>l4_expert6_gpu54</title>
<ellipse fill="none" stroke="black" cx="16511.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="16511.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 54</text>
<text text-anchor="middle" x="16511.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 54</text>
<text text-anchor="middle" x="16511.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="16511.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l4_split&#45;&gt;l4_expert6_gpu54 -->
<g id="edge112" class="edge">
<title>l4_split&#45;&gt;l4_expert6_gpu54</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M16889.34,-1275.27C16845.24,-1259.25 16796.79,-1241.35 16752.51,-1224.29 16706.47,-1206.54 16655.84,-1186.09 16612.92,-1168.46"/>
<polygon fill="black" stroke="black" points="16614.18,-1165.19 16603.6,-1164.63 16611.52,-1171.67 16614.18,-1165.19"/>
<text text-anchor="middle" x="16841.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 54</text>
</g>
<!-- l4_expert7_gpu55 -->
<g id="node75" class="node">
<title>l4_expert7_gpu55</title>
<ellipse fill="none" stroke="black" cx="16861.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="16861.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 55</text>
<text text-anchor="middle" x="16861.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 55</text>
<text text-anchor="middle" x="16861.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="16861.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l4_split&#45;&gt;l4_expert7_gpu55 -->
<g id="edge113" class="edge">
<title>l4_split&#45;&gt;l4_expert7_gpu55</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M16990.48,-1275.24C16965.06,-1245.86 16933.35,-1209.23 16907.74,-1179.63"/>
<polygon fill="black" stroke="black" points="16910.22,-1177.14 16901.03,-1171.87 16904.93,-1181.72 16910.22,-1177.14"/>
<text text-anchor="middle" x="17031.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 55</text>
</g>
<!-- l4_expert8_gpu56 -->
<g id="node76" class="node">
<title>l4_expert8_gpu56</title>
<ellipse fill="none" stroke="black" cx="17211.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="17211.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 56</text>
<text text-anchor="middle" x="17211.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 56</text>
<text text-anchor="middle" x="17211.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="17211.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l4_split&#45;&gt;l4_expert8_gpu56 -->
<g id="edge114" class="edge">
<title>l4_split&#45;&gt;l4_expert8_gpu56</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17082.53,-1275.08C17097.02,-1258.86 17112.99,-1240.89 17127.51,-1224.29 17139.97,-1210.05 17153.34,-1194.54 17165.66,-1180.15"/>
<polygon fill="black" stroke="black" points="17168.55,-1182.15 17172.39,-1172.28 17163.23,-1177.6 17168.55,-1182.15"/>
<text text-anchor="middle" x="17227.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 56</text>
</g>
<!-- l4_expert9_gpu57 -->
<g id="node77" class="node">
<title>l4_expert9_gpu57</title>
<ellipse fill="none" stroke="black" cx="17561.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="17561.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 57</text>
<text text-anchor="middle" x="17561.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 57</text>
<text text-anchor="middle" x="17561.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="17561.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l4_split&#45;&gt;l4_expert9_gpu57 -->
<g id="edge115" class="edge">
<title>l4_split&#45;&gt;l4_expert9_gpu57</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17172.61,-1279.75C17220.53,-1262.74 17274.57,-1243.11 17323.51,-1224.29 17368.88,-1206.84 17418.67,-1186.51 17460.92,-1168.9"/>
<polygon fill="black" stroke="black" points="17462.49,-1172.03 17470.37,-1164.95 17459.8,-1165.57 17462.49,-1172.03"/>
<text text-anchor="middle" x="17444.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 57</text>
</g>
<!-- l4_expert10_gpu58 -->
<g id="node78" class="node">
<title>l4_expert10_gpu58</title>
<ellipse fill="none" stroke="black" cx="17911.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="17911.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 58</text>
<text text-anchor="middle" x="17911.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 58</text>
<text text-anchor="middle" x="17911.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="17911.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l4_split&#45;&gt;l4_expert10_gpu58 -->
<g id="edge116" class="edge">
<title>l4_split&#45;&gt;l4_expert10_gpu58</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17188.45,-1298.3C17288.84,-1278.73 17422.84,-1251.58 17540.51,-1224.29 17628.2,-1203.95 17649.5,-1196.31 17736.51,-1173.29 17751.88,-1169.22 17767.99,-1164.93 17783.96,-1160.65"/>
<polygon fill="black" stroke="black" points="17785.13,-1163.96 17793.88,-1157.99 17783.32,-1157.2 17785.13,-1163.96"/>
<text text-anchor="middle" x="17689.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 58</text>
</g>
<!-- l4_expert11_gpu59 -->
<g id="node79" class="node">
<title>l4_expert11_gpu59</title>
<ellipse fill="none" stroke="black" cx="18261.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="18261.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 59</text>
<text text-anchor="middle" x="18261.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 59</text>
<text text-anchor="middle" x="18261.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="18261.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l4_split&#45;&gt;l4_expert11_gpu59 -->
<g id="edge117" class="edge">
<title>l4_split&#45;&gt;l4_expert11_gpu59</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17199.28,-1310.47C17407.12,-1287.48 17775.97,-1241.21 18086.51,-1173.29 18102.83,-1169.72 18119.9,-1165.6 18136.72,-1161.33"/>
<polygon fill="black" stroke="black" points="18137.77,-1164.67 18146.58,-1158.79 18136.02,-1157.89 18137.77,-1164.67"/>
<text text-anchor="middle" x="17975.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 59</text>
</g>
<!-- l4_expert12_gpu60 -->
<g id="node80" class="node">
<title>l4_expert12_gpu60</title>
<ellipse fill="none" stroke="black" cx="18611.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="18611.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 60</text>
<text text-anchor="middle" x="18611.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 60</text>
<text text-anchor="middle" x="18611.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="18611.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l4_split&#45;&gt;l4_expert12_gpu60 -->
<g id="edge118" class="edge">
<title>l4_split&#45;&gt;l4_expert12_gpu60</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17206.08,-1318.6C17471.43,-1302.84 17998.17,-1262.52 18436.51,-1173.29 18453.01,-1169.93 18470.25,-1165.92 18487.21,-1161.67"/>
<polygon fill="black" stroke="black" points="18488.32,-1165 18497.15,-1159.15 18486.6,-1158.22 18488.32,-1165"/>
<text text-anchor="middle" x="18298.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 60</text>
</g>
<!-- l4_expert13_gpu61 -->
<g id="node81" class="node">
<title>l4_expert13_gpu61</title>
<ellipse fill="none" stroke="black" cx="18961.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="18961.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 61</text>
<text text-anchor="middle" x="18961.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 61</text>
<text text-anchor="middle" x="18961.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="18961.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l4_split&#45;&gt;l4_expert13_gpu61 -->
<g id="edge119" class="edge">
<title>l4_split&#45;&gt;l4_expert13_gpu61</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17205,-1317.38C17462.41,-1301.66 17967.17,-1268.25 18394.51,-1224.29 18569.28,-1206.31 18614.19,-1207.52 18786.51,-1173.29 18803.15,-1169.98 18820.54,-1165.98 18837.64,-1161.72"/>
<polygon fill="black" stroke="black" points="18838.82,-1165.03 18847.66,-1159.19 18837.1,-1158.25 18838.82,-1165.03"/>
<text text-anchor="middle" x="18633.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 61</text>
</g>
<!-- l4_expert14_gpu62 -->
<g id="node82" class="node">
<title>l4_expert14_gpu62</title>
<ellipse fill="none" stroke="black" cx="19311.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="19311.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 62</text>
<text text-anchor="middle" x="19311.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 62</text>
<text text-anchor="middle" x="19311.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="19311.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l4_split&#45;&gt;l4_expert14_gpu62 -->
<g id="edge120" class="edge">
<title>l4_split&#45;&gt;l4_expert14_gpu62</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17207.72,-1320.46C17514.2,-1307.49 18174.3,-1275.9 18729.51,-1224.29 18911.03,-1207.41 18957.62,-1208.39 19136.51,-1173.29 19153.16,-1170.02 19170.56,-1166.04 19187.65,-1161.79"/>
<polygon fill="black" stroke="black" points="19188.83,-1165.11 19197.67,-1159.27 19187.12,-1158.32 19188.83,-1165.11"/>
<text text-anchor="middle" x="18981.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 62</text>
</g>
<!-- l4_expert15_gpu63 -->
<g id="node83" class="node">
<title>l4_expert15_gpu63</title>
<ellipse fill="none" stroke="black" cx="19661.51" cy="-1125.2" rx="160.53" ry="48.17"/>
<text text-anchor="middle" x="19661.51" y="-1144" font-family="Times,serif" font-size="14.00">Expert 63</text>
<text text-anchor="middle" x="19661.51" y="-1129" font-family="Times,serif" font-size="14.00">GPU 63</text>
<text text-anchor="middle" x="19661.51" y="-1114" font-family="Times,serif" font-size="14.00">[Variable tokens, expert_dim]</text>
<text text-anchor="middle" x="19661.51" y="-1099" font-family="Times,serif" font-size="14.00">1 expert/GPU</text>
</g>
<!-- l4_split&#45;&gt;l4_expert15_gpu63 -->
<g id="edge121" class="edge">
<title>l4_split&#45;&gt;l4_expert15_gpu63</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17209.95,-1322.82C17563.04,-1312.82 18387.52,-1284.62 19077.51,-1224.29 19260,-1208.33 19306.74,-1208.5 19486.51,-1173.29 19503.16,-1170.03 19520.56,-1166.05 19537.65,-1161.8"/>
<polygon fill="black" stroke="black" points="19538.83,-1165.12 19547.67,-1159.28 19537.12,-1158.33 19538.83,-1165.12"/>
<text text-anchor="middle" x="19337.51" y="-1213.09" font-family="Times,serif" font-size="14.00">tokens routed to GPU 63</text>
</g>
<!-- l4_gather -->
<g id="node84" class="node">
<title>l4_gather</title>
<polygon fill="none" stroke="black" points="17237.77,-989.12 16917.61,-989.12 16835.25,-883.12 17155.41,-883.12 17237.77,-989.12"/>
<text text-anchor="middle" x="17036.51" y="-947.42" font-family="Times,serif" font-size="14.00">Async All&#45;Gather</text>
<text text-anchor="middle" x="17036.51" y="-932.42" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="17036.51" y="-917.42" font-family="Times,serif" font-size="14.00">Collect from GPUs 48&#45;63</text>
</g>
<!-- l4_expert0_gpu48&#45;&gt;l4_gather -->
<g id="edge122" class="edge">
<title>l4_expert0_gpu48&#45;&gt;l4_gather</title>
<path fill="none" stroke="black" d="M14523.28,-1090.57C14544.14,-1085.32 14565.87,-1080.51 14586.51,-1077.12 14845.78,-1034.55 14914.23,-1055.61 15176.51,-1040.12 15803.3,-1003.11 16549.14,-963 16872.99,-945.77"/>
<polygon fill="black" stroke="black" points="16873.59,-949.25 16883.39,-945.22 16873.21,-942.26 16873.59,-949.25"/>
</g>
<!-- l4_expert1_gpu49&#45;&gt;l4_gather -->
<g id="edge123" class="edge">
<title>l4_expert1_gpu49&#45;&gt;l4_gather</title>
<path fill="none" stroke="black" d="M14873.29,-1090.64C14894.15,-1085.38 14915.87,-1080.55 14936.51,-1077.12 15646.75,-959.08 16507.77,-939.81 16866.68,-937.19"/>
<polygon fill="black" stroke="black" points="16866.92,-940.69 16876.9,-937.12 16866.87,-933.69 16866.92,-940.69"/>
</g>
<!-- l4_expert2_gpu50&#45;&gt;l4_gather -->
<g id="edge124" class="edge">
<title>l4_expert2_gpu50&#45;&gt;l4_gather</title>
<path fill="none" stroke="black" d="M15223.8,-1090.75C15244.51,-1085.5 15266.05,-1080.66 15286.51,-1077.12 15861.96,-977.55 16556.35,-948.6 16869.27,-940.34"/>
<polygon fill="black" stroke="black" points="16869.43,-943.84 16879.33,-940.08 16869.24,-936.84 16869.43,-943.84"/>
</g>
<!-- l4_expert3_gpu51&#45;&gt;l4_gather -->
<g id="edge125" class="edge">
<title>l4_expert3_gpu51&#45;&gt;l4_gather</title>
<path fill="none" stroke="black" d="M15574.33,-1090.96C15594.89,-1085.73 15616.24,-1080.83 15636.51,-1077.12 16079.22,-995.99 16609.9,-959.12 16872.58,-944.83"/>
<polygon fill="black" stroke="black" points="16872.79,-948.32 16882.58,-944.29 16872.41,-941.33 16872.79,-948.32"/>
</g>
<!-- l4_expert4_gpu52&#45;&gt;l4_gather -->
<g id="edge126" class="edge">
<title>l4_expert4_gpu52&#45;&gt;l4_gather</title>
<path fill="none" stroke="black" d="M15925.38,-1091.27C15945.63,-1086.07 15966.62,-1081.11 15986.51,-1077.12 16299.66,-1014.4 16671.12,-972.35 16877.69,-951.79"/>
<polygon fill="black" stroke="black" points="16878.1,-955.26 16887.7,-950.79 16877.41,-948.3 16878.1,-955.26"/>
</g>
<!-- l4_expert5_gpu53&#45;&gt;l4_gather -->
<g id="edge127" class="edge">
<title>l4_expert5_gpu53&#45;&gt;l4_gather</title>
<path fill="none" stroke="black" d="M16277.5,-1091.86C16297.14,-1086.71 16317.37,-1081.6 16336.51,-1077.12 16525.06,-1032.95 16744.21,-990.55 16886.38,-964.2"/>
<polygon fill="black" stroke="black" points="16887.28,-967.6 16896.48,-962.34 16886.01,-960.71 16887.28,-967.6"/>
</g>
<!-- l4_expert6_gpu54&#45;&gt;l4_gather -->
<g id="edge128" class="edge">
<title>l4_expert6_gpu54&#45;&gt;l4_gather</title>
<path fill="none" stroke="black" d="M16613.36,-1087.91C16695.58,-1058.61 16811.98,-1017.13 16901.89,-985.09"/>
<polygon fill="black" stroke="black" points="16903.08,-988.38 16911.33,-981.73 16900.73,-981.79 16903.08,-988.38"/>
</g>
<!-- l4_expert7_gpu55&#45;&gt;l4_gather -->
<g id="edge129" class="edge">
<title>l4_expert7_gpu55&#45;&gt;l4_gather</title>
<path fill="none" stroke="black" d="M16904.32,-1078.44C16927.35,-1053.82 16956.03,-1023.16 16980.78,-996.7"/>
<polygon fill="black" stroke="black" points="16983.38,-999.05 16987.65,-989.35 16978.27,-994.27 16983.38,-999.05"/>
</g>
<!-- l4_expert8_gpu56&#45;&gt;l4_gather -->
<g id="edge130" class="edge">
<title>l4_expert8_gpu56&#45;&gt;l4_gather</title>
<path fill="none" stroke="black" d="M17168.7,-1078.44C17145.67,-1053.82 17117,-1023.16 17092.24,-996.7"/>
<polygon fill="black" stroke="black" points="17094.76,-994.27 17085.37,-989.35 17089.65,-999.05 17094.76,-994.27"/>
</g>
<!-- l4_expert9_gpu57&#45;&gt;l4_gather -->
<g id="edge131" class="edge">
<title>l4_expert9_gpu57&#45;&gt;l4_gather</title>
<path fill="none" stroke="black" d="M17459.67,-1087.91C17383.72,-1060.85 17278.61,-1023.39 17192.16,-992.58"/>
<polygon fill="black" stroke="black" points="17193.11,-989.21 17182.52,-989.15 17190.76,-995.8 17193.11,-989.21"/>
</g>
<!-- l4_expert10_gpu58&#45;&gt;l4_gather -->
<g id="edge132" class="edge">
<title>l4_expert10_gpu58&#45;&gt;l4_gather</title>
<path fill="none" stroke="black" d="M17795.53,-1091.86C17775.89,-1086.71 17755.66,-1081.6 17736.51,-1077.12 17567.86,-1037.61 17374.7,-999.51 17234.07,-973.06"/>
<polygon fill="black" stroke="black" points="17234.51,-969.58 17224.04,-971.17 17233.22,-976.46 17234.51,-969.58"/>
</g>
<!-- l4_expert11_gpu59&#45;&gt;l4_gather -->
<g id="edge133" class="edge">
<title>l4_expert11_gpu59&#45;&gt;l4_gather</title>
<path fill="none" stroke="black" d="M18147.65,-1091.27C18127.39,-1086.07 18106.41,-1081.11 18086.51,-1077.12 17785.57,-1016.84 17430.76,-975.66 17220.21,-954.29"/>
<polygon fill="black" stroke="black" points="17220.29,-950.78 17209.99,-953.25 17219.58,-957.74 17220.29,-950.78"/>
</g>
<!-- l4_expert12_gpu60&#45;&gt;l4_gather -->
<g id="edge134" class="edge">
<title>l4_expert12_gpu60&#45;&gt;l4_gather</title>
<path fill="none" stroke="black" d="M18498.69,-1090.96C18478.14,-1085.73 18456.78,-1080.83 18436.51,-1077.12 18001.22,-997.35 17480.87,-960.37 17213.86,-945.57"/>
<polygon fill="black" stroke="black" points="17213.86,-942.06 17203.69,-945.01 17213.48,-949.05 17213.86,-942.06"/>
</g>
<!-- l4_expert13_gpu61&#45;&gt;l4_gather -->
<g id="edge135" class="edge">
<title>l4_expert13_gpu61&#45;&gt;l4_gather</title>
<path fill="none" stroke="black" d="M18849.22,-1090.75C18828.52,-1085.5 18806.97,-1080.66 18786.51,-1077.12 18214.96,-978.23 17526.08,-949 17210.17,-940.51"/>
<polygon fill="black" stroke="black" points="17210.1,-937.01 17200.01,-940.24 17209.91,-944 17210.1,-937.01"/>
</g>
<!-- l4_expert14_gpu62&#45;&gt;l4_gather -->
<g id="edge136" class="edge">
<title>l4_expert14_gpu62&#45;&gt;l4_gather</title>
<path fill="none" stroke="black" d="M19199.73,-1090.64C19178.88,-1085.38 19157.15,-1080.55 19136.51,-1077.12 18427.17,-959.23 17567.42,-939.86 17207.7,-937.2"/>
<polygon fill="black" stroke="black" points="17207.49,-933.7 17197.46,-937.13 17207.44,-940.7 17207.49,-933.7"/>
</g>
<!-- l4_expert15_gpu63&#45;&gt;l4_gather -->
<g id="edge137" class="edge">
<title>l4_expert15_gpu63&#45;&gt;l4_gather</title>
<path fill="none" stroke="black" d="M19549.74,-1090.6C19528.88,-1085.34 19507.16,-1080.53 19486.51,-1077.12 19233.41,-1035.37 19166.59,-1055.38 18910.51,-1040.12 18287.39,-1002.98 17547.4,-963.75 17214.43,-946.35"/>
<polygon fill="black" stroke="black" points="17214.38,-942.84 17204.21,-945.82 17214.01,-949.83 17214.38,-942.84"/>
</g>
<!-- l4_residual -->
<g id="node85" class="node">
<title>l4_residual</title>
<polygon fill="none" stroke="black" points="17036.51,-795.12 16883.51,-742.12 17036.51,-689.12 17189.51,-742.12 17036.51,-795.12"/>
<text text-anchor="middle" x="17036.51" y="-753.42" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="17036.51" y="-738.42" font-family="Times,serif" font-size="14.00">[1024 tokens]</text>
<text text-anchor="middle" x="17036.51" y="-723.42" font-family="Times,serif" font-size="14.00">Across GPUs 48&#45;63</text>
</g>
<!-- l4_gather&#45;&gt;l4_residual -->
<g id="edge138" class="edge">
<title>l4_gather&#45;&gt;l4_residual</title>
<path fill="none" stroke="black" d="M17036.51,-882.91C17036.51,-859 17036.51,-830.47 17036.51,-805.45"/>
<polygon fill="black" stroke="black" points="17040.01,-805.32 17036.51,-795.32 17033.01,-805.32 17040.01,-805.32"/>
</g>
<!-- output -->
<g id="node86" class="node">
<title>output</title>
<ellipse fill="none" stroke="black" cx="17036.51" cy="-554.04" rx="145.83" ry="37.45"/>
<text text-anchor="middle" x="17036.51" y="-565.34" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="17036.51" y="-550.34" font-family="Times,serif" font-size="14.00">[1024 tokens, hidden_dim]</text>
<text text-anchor="middle" x="17036.51" y="-535.34" font-family="Times,serif" font-size="14.00">From GPU 63</text>
</g>
<!-- l4_residual&#45;&gt;output -->
<g id="edge139" class="edge">
<title>l4_residual&#45;&gt;output</title>
<path fill="none" stroke="black" d="M17036.51,-688.79C17036.51,-661.46 17036.51,-628.29 17036.51,-601.82"/>
<polygon fill="black" stroke="black" points="17040.01,-601.66 17036.51,-591.66 17033.01,-601.66 17040.01,-601.66"/>
</g>
</g>
</svg>
